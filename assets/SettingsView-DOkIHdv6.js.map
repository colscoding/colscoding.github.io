{"version":3,"mappings":"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","names":["debounce","func","wait","timeout","args","initSettingsLogic","saveSettingsButton","settingMaxHr","settingWeight","validateNumericInput","input","min","max","value","clearValidation","settingSpeed","settingDistance","settingAltitude","settingShowCalories","settingPower","settingCadence","settingHeartrate","settingTreadmillSpeed","settingPower3s","settingHighContrast","settingColorblindPatterns","settingVoiceEnabled","settingVoiceLaps","settingVoiceZones","settingAutoPauseEnabled","settingAutoPauseSource","settingAutoPauseThreshold","settingAutoPauseDelay","autoPauseOptions","autoPauseThresholdUnit","settingExportTcx","settingExportCsv","settingExportJson","settingExportFit","settingPromptForNotes","settingPromptForExertion","settingCountdownDuration","settingCountdownBeep","settingCountdownVoice","settingAutoLapEnabled","settingAutoLapSource","settingAutoLapDistance","settingAutoLapTime","autoLapOptions","autoLapDistanceOption","autoLapTimeOption","settingVoiceSelection","settingVoiceTimeInterval","settingVoiceDistanceInterval","settingVoiceSpeechRate","settingVoiceMetricPower","settingVoiceMetricHeartrate","settingVoiceMetricCadence","settingVoiceMetricSpeed","settingVoiceMetricDistance","settingVoiceMetricTime","settingVoiceMetricPace","settingVoiceTargetFeedback","settingVoiceTemplate","settingSmartAnnouncements","settingSportType","settingShowPace","settingThresholdPace","runningOptions","settingIntervalsEnabled","settingIntervalsApiKey","toggleIntervalsApiKey","settingIntervalsAthleteId","settingIntervalsAutoUpload","intervalsOptions","settingMusicEnabled","settingMusicVolume","musicVolumeValue","settingMusicStyle","settingMusicTempoSync","settingMusicFixedBPM","settingMusicIntensityMapping","settingMusicTransitionSpeed","settingMusicDucking","settingMusicDuckingLevel","musicDuckingLevelValue","musicOptions","fixedBpmOption","duckingLevelOption","settingDebugMode","debugControls","downloadDebugLogs","clearDebugLogs","settingMockSensors","installPwaButton","updateIntervalsUI","updateMusicUI","updateMusicVolumeDisplay","updateMusicDuckingLevelDisplay","updateSportUI","isRunning","parsePace","paceStr","match","minutes","seconds","saveSportSettingsFromUI","sportSettings","getSportSettings","paceSeconds","saveSportSettings","lastActiveSport","loadSportSettings","thresholdPace","formatPace","newSport","appSettings","getSettings","saveSettingsToStorage","activityType","loadActivityScreens","__vitePreload","n","config","event","isPassword","updateAutoPauseUI","unit","getAutoPauseSourceUnit","updateAutoLapUI","isDistance","applySettings","settings","voiceFeedback","toggleMetric","metric","isVisible","el","readVoiceSettingsFromUI","defaultEnhancedVoiceSettings","defaultVoiceMetrics","loadVoiceSettingsToUI","saveSettings","updatedProfile","loadUserProfile","saveUserProfile","settingsStore","defaultSettings","defaultAutoPauseSettings","defaultWorkoutMetadataSettings","defaultCountdownSettings","defaultAutoLapSettings","defaultIntervalsSettings","defaultMusicSettings","loadSettings","profile","populateVoices","voices","voice","option","saveSettingsDebounced","attachAutoSave","element","type","currentVoice","presetsStr","presets","saved","BluetoothDebugService","outcome","triggerInstallPrompt","initFeatureFlags","container","resetButton","renderFlags","flags","featureFlagService","flag","categoryBadge","getCategoryBadge","wrapper","checkbox","showRefreshNotice","textWrapper","category","notice","SettingsView","template","content"],"ignoreList":[],"sources":["../../src/utils/debounce.ts","../../src/ui/settings.ts","../../src/views/SettingsView.ts"],"sourcesContent":["/**\n * Creates a debounced function that delays invoking func until after wait milliseconds have elapsed\n * since the last time the debounced function was invoked.\n *\n * @param func The function to debounce\n * @param wait The number of milliseconds to delay\n * @returns Debounced function\n */\nexport function debounce<T extends (...args: any[]) => void>(func: T, wait: number): (...args: Parameters<T>) => void {\n    let timeout: ReturnType<typeof setTimeout> | null = null;\n    return (...args: Parameters<T>) => {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n        timeout = setTimeout(() => {\n            func(...args);\n        }, wait);\n    };\n}\n","/**\n * Settings Modal\n *\n * Manages application settings stored in localStorage.\n *\n * @module settings\n */\n\nimport { loadUserProfile, saveUserProfile } from './onboarding.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport {\n    getSettings,\n    saveSettingsToStorage,\n    defaultSettings,\n    defaultAutoPauseSettings,\n    defaultWorkoutMetadataSettings,\n    defaultCountdownSettings,\n    defaultAutoLapSettings,\n    defaultEnhancedVoiceSettings,\n    defaultVoiceMetrics,\n    defaultIntervalsSettings,\n    defaultMusicSettings,\n} from '../config/settings.js';\nimport type { AppSettings, AutoPauseSource, AutoLapSource, EnhancedVoiceSettings } from '../config/settings.js';\nimport { triggerInstallPrompt } from './installPrompt.js';\nimport { getAutoPauseSourceUnit } from '../services/AutoPauseService.js';\nimport { getSportSettings, saveSportSettings, formatPace } from '../config/sport.js';\nimport type { SportType } from '../config/sport.js';\nimport { debounce } from '../utils/debounce.js';\nimport { settingsStore } from '../state/SettingsStore.js';\nimport { featureFlagService } from '../services/FeatureFlagService.js';\n\n// Re-export for compatibility if needed (but prefer importing from config)\nexport { getSettings };\n\n/**\n * Initialize the Settings UI logic\n */\nexport function initSettingsLogic(): void {\n    const saveSettingsButton = document.getElementById('saveSettings');\n\n    // User Profile settings\n    const settingMaxHr = document.getElementById('settingMaxHr') as HTMLInputElement | null;\n    const settingWeight = document.getElementById('settingWeight') as HTMLInputElement | null;\n\n    /**\n     * Validate numeric input and provide visual feedback\n     */\n    const validateNumericInput = (input: HTMLInputElement, min: number, max: number): boolean => {\n        const value = Number(input.value);\n        if (!input.value || isNaN(value) || value < min || value > max) {\n            input.style.borderColor = '#dc3545';\n            input.setAttribute('aria-invalid', 'true');\n            return false;\n        }\n        input.style.borderColor = '#28a745';\n        input.setAttribute('aria-invalid', 'false');\n        return true;\n    };\n\n    /**\n     * Clear validation styling\n     */\n    const clearValidation = (input: HTMLInputElement): void => {\n        input.style.borderColor = '';\n        input.removeAttribute('aria-invalid');\n    };\n\n    // Dashboard display settings\n    const settingSpeed = document.getElementById('settingSpeed') as HTMLInputElement | null;\n    const settingDistance = document.getElementById('settingDistance') as HTMLInputElement | null;\n    const settingAltitude = document.getElementById('settingAltitude') as HTMLInputElement | null;\n    const settingShowCalories = document.getElementById('settingShowCalories') as HTMLInputElement | null;\n    const settingPower = document.getElementById('settingPower') as HTMLInputElement | null;\n    const settingCadence = document.getElementById('settingCadence') as HTMLInputElement | null;\n    const settingHeartrate = document.getElementById('settingHeartrate') as HTMLInputElement | null;\n    const settingTreadmillSpeed = document.getElementById('settingTreadmillSpeed') as HTMLInputElement | null;\n    const settingPower3s = document.getElementById('settingPower3s') as HTMLInputElement | null;\n\n    // Accessibility settings\n    const settingHighContrast = document.getElementById('settingHighContrast') as HTMLInputElement | null;\n    const settingColorblindPatterns = document.getElementById('settingColorblindPatterns') as HTMLInputElement | null;\n\n    // Voice Feedback settings\n    const settingVoiceEnabled = document.getElementById('settingVoiceEnabled') as HTMLInputElement | null;\n    const settingVoiceLaps = document.getElementById('settingVoiceLaps') as HTMLInputElement | null;\n    const settingVoiceZones = document.getElementById('settingVoiceZones') as HTMLInputElement | null;\n\n    // Auto-Pause settings\n    const settingAutoPauseEnabled = document.getElementById('settingAutoPauseEnabled') as HTMLInputElement | null;\n    const settingAutoPauseSource = document.getElementById('settingAutoPauseSource') as HTMLSelectElement | null;\n    const settingAutoPauseThreshold = document.getElementById('settingAutoPauseThreshold') as HTMLInputElement | null;\n    const settingAutoPauseDelay = document.getElementById('settingAutoPauseDelay') as HTMLInputElement | null;\n    const autoPauseOptions = document.getElementById('autoPauseOptions');\n    const autoPauseThresholdUnit = document.getElementById('autoPauseThresholdUnit');\n\n    // Export format settings\n    const settingExportTcx = document.getElementById('settingExportTcx') as HTMLInputElement | null;\n    const settingExportCsv = document.getElementById('settingExportCsv') as HTMLInputElement | null;\n    const settingExportJson = document.getElementById('settingExportJson') as HTMLInputElement | null;\n    const settingExportFit = document.getElementById('settingExportFit') as HTMLInputElement | null;\n\n    // Workout metadata settings\n    const settingPromptForNotes = document.getElementById('settingPromptForNotes') as HTMLInputElement | null;\n    const settingPromptForExertion = document.getElementById('settingPromptForExertion') as HTMLInputElement | null;\n\n    // Countdown settings\n    const settingCountdownDuration = document.getElementById('settingCountdownDuration') as HTMLSelectElement | null;\n    const settingCountdownBeep = document.getElementById('settingCountdownBeep') as HTMLInputElement | null;\n    const settingCountdownVoice = document.getElementById('settingCountdownVoice') as HTMLInputElement | null;\n\n    // Auto-Lap settings\n    const settingAutoLapEnabled = document.getElementById('settingAutoLapEnabled') as HTMLInputElement | null;\n    const settingAutoLapSource = document.getElementById('settingAutoLapSource') as HTMLSelectElement | null;\n    const settingAutoLapDistance = document.getElementById('settingAutoLapDistance') as HTMLSelectElement | null;\n    const settingAutoLapTime = document.getElementById('settingAutoLapTime') as HTMLSelectElement | null;\n    const autoLapOptions = document.getElementById('autoLapOptions');\n    const autoLapDistanceOption = document.getElementById('autoLapDistanceOption');\n    const autoLapTimeOption = document.getElementById('autoLapTimeOption');\n\n    // Enhanced Voice settings\n    const settingVoiceSelection = document.getElementById('settingVoiceSelection') as HTMLSelectElement | null;\n    const settingVoiceTimeInterval = document.getElementById('settingVoiceTimeInterval') as HTMLSelectElement | null;\n    const settingVoiceDistanceInterval = document.getElementById(\n        'settingVoiceDistanceInterval'\n    ) as HTMLSelectElement | null;\n    const settingVoiceSpeechRate = document.getElementById('settingVoiceSpeechRate') as HTMLSelectElement | null;\n    const settingVoiceMetricPower = document.getElementById('settingVoiceMetricPower') as HTMLInputElement | null;\n    const settingVoiceMetricHeartrate = document.getElementById(\n        'settingVoiceMetricHeartrate'\n    ) as HTMLInputElement | null;\n    const settingVoiceMetricCadence = document.getElementById('settingVoiceMetricCadence') as HTMLInputElement | null;\n    const settingVoiceMetricSpeed = document.getElementById('settingVoiceMetricSpeed') as HTMLInputElement | null;\n    const settingVoiceMetricDistance = document.getElementById('settingVoiceMetricDistance') as HTMLInputElement | null;\n    const settingVoiceMetricTime = document.getElementById('settingVoiceMetricTime') as HTMLInputElement | null;\n    const settingVoiceMetricPace = document.getElementById('settingVoiceMetricPace') as HTMLInputElement | null;\n    const settingVoiceTargetFeedback = document.getElementById('settingVoiceTargetFeedback') as HTMLInputElement | null;\n    const settingVoiceTemplate = document.getElementById('settingVoiceTemplate') as HTMLTextAreaElement | null;\n    const settingSmartAnnouncements = document.getElementById('settingSmartAnnouncements') as HTMLInputElement | null;\n\n    // Sport Type settings\n    const settingSportType = document.getElementById('settingSportType') as HTMLSelectElement | null;\n    const settingShowPace = document.getElementById('settingShowPace') as HTMLInputElement | null;\n    const settingThresholdPace = document.getElementById('settingThresholdPace') as HTMLInputElement | null;\n    const runningOptions = document.getElementById('runningOptions');\n\n    // Intervals.icu settings\n    const settingIntervalsEnabled = document.getElementById('settingIntervalsEnabled') as HTMLInputElement | null;\n    const settingIntervalsApiKey = document.getElementById('settingIntervalsApiKey') as HTMLInputElement | null;\n    const toggleIntervalsApiKey = document.getElementById('toggleIntervalsApiKey') as HTMLButtonElement | null;\n    const settingIntervalsAthleteId = document.getElementById('settingIntervalsAthleteId') as HTMLInputElement | null;\n    const settingIntervalsAutoUpload = document.getElementById('settingIntervalsAutoUpload') as HTMLInputElement | null;\n    const intervalsOptions = document.getElementById('intervalsOptions');\n\n    // Music Generation settings\n    const settingMusicEnabled = document.getElementById('settingMusicEnabled') as HTMLInputElement | null;\n    const settingMusicVolume = document.getElementById('settingMusicVolume') as HTMLInputElement | null;\n    const musicVolumeValue = document.getElementById('musicVolumeValue');\n    const settingMusicStyle = document.getElementById('settingMusicStyle') as HTMLSelectElement | null;\n    const settingMusicTempoSync = document.getElementById('settingMusicTempoSync') as HTMLSelectElement | null;\n    const settingMusicFixedBPM = document.getElementById('settingMusicFixedBPM') as HTMLInputElement | null;\n    const settingMusicIntensityMapping = document.getElementById('settingMusicIntensityMapping') as HTMLSelectElement | null;\n    const settingMusicTransitionSpeed = document.getElementById('settingMusicTransitionSpeed') as HTMLSelectElement | null;\n    const settingMusicDucking = document.getElementById('settingMusicDucking') as HTMLInputElement | null;\n    const settingMusicDuckingLevel = document.getElementById('settingMusicDuckingLevel') as HTMLInputElement | null;\n    const musicDuckingLevelValue = document.getElementById('musicDuckingLevelValue');\n    const musicOptions = document.getElementById('musicOptions');\n    const fixedBpmOption = document.getElementById('fixedBpmOption');\n    const duckingLevelOption = document.getElementById('duckingLevelOption');\n\n    // Debug settings\n    const settingDebugMode = document.getElementById('settingDebugMode') as HTMLInputElement | null;\n    const debugControls = document.getElementById('debugControls');\n    const downloadDebugLogs = document.getElementById('downloadDebugLogs');\n    const clearDebugLogs = document.getElementById('clearDebugLogs');\n\n    // Mock sensors setting\n    const settingMockSensors = document.getElementById('settingMockSensors') as HTMLInputElement | null;\n\n    // PWA Install button\n    const installPwaButton = document.getElementById('installPwaButton');\n\n    /**\n     * Update Intervals UI visibility\n     */\n    const updateIntervalsUI = (): void => {\n        if (intervalsOptions && settingIntervalsEnabled) {\n            intervalsOptions.style.display = settingIntervalsEnabled.checked ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Update Music UI visibility\n     */\n    const updateMusicUI = (): void => {\n        if (musicOptions && settingMusicEnabled) {\n            musicOptions.style.display = settingMusicEnabled.checked ? 'flex' : 'none';\n        }\n        if (fixedBpmOption && settingMusicTempoSync) {\n            fixedBpmOption.style.display = settingMusicTempoSync.value === 'fixed' ? 'flex' : 'none';\n        }\n        if (duckingLevelOption && settingMusicDucking) {\n            duckingLevelOption.style.display = settingMusicDucking.checked ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Update music volume display\n     */\n    const updateMusicVolumeDisplay = (): void => {\n        if (musicVolumeValue && settingMusicVolume) {\n            musicVolumeValue.textContent = `${settingMusicVolume.value}%`;\n        }\n    };\n\n    /**\n     * Update music ducking level display\n     */\n    const updateMusicDuckingLevelDisplay = (): void => {\n        if (musicDuckingLevelValue && settingMusicDuckingLevel) {\n            musicDuckingLevelValue.textContent = `${settingMusicDuckingLevel.value}%`;\n        }\n    };\n\n    /**\n     * Update sport type UI visibility (show running options when running/walking selected)\n     */\n    const updateSportUI = (): void => {\n        if (runningOptions && settingSportType) {\n            const isRunning = settingSportType.value === 'running' || settingSportType.value === 'walking';\n            runningOptions.style.display = isRunning ? 'block' : 'none';\n        }\n    };\n\n    /**\n     * Parse pace string (MM:SS) to seconds per km\n     */\n    const parsePace = (paceStr: string): number | null => {\n        const match = paceStr.match(/^(\\d{1,2}):([0-5]\\d)$/);\n        if (!match) return null;\n        const minutes = parseInt(match[1], 10);\n        const seconds = parseInt(match[2], 10);\n        return minutes * 60 + seconds;\n    };\n\n    /**\n     * Save sport settings\n     */\n    const saveSportSettingsFromUI = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            sportSettings.activeSport = settingSportType.value as SportType;\n        }\n        if (settingShowPace !== null) {\n            sportSettings.running.showPace = settingShowPace.checked;\n        }\n        if (settingThresholdPace?.value) {\n            const paceSeconds = parsePace(settingThresholdPace.value);\n            if (paceSeconds !== null) {\n                // Store threshold pace as target pace range (Â±30 sec)\n                sportSettings.running.targetPaceMin = paceSeconds - 30;\n                sportSettings.running.targetPaceMax = paceSeconds + 30;\n            }\n        }\n\n        saveSportSettings(sportSettings);\n    };\n\n    let lastActiveSport = 'cycling';\n\n    /**\n     * Load sport settings into UI\n     */\n    const loadSportSettings = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            settingSportType.value = sportSettings.activeSport;\n            lastActiveSport = sportSettings.activeSport;\n        }\n        if (settingShowPace) {\n            settingShowPace.checked = sportSettings.running.showPace;\n        }\n        if (settingThresholdPace) {\n            // Calculate threshold pace from target pace (middle of range)\n            const thresholdPace = Math.round(\n                (sportSettings.running.targetPaceMin + sportSettings.running.targetPaceMax) / 2\n            );\n            settingThresholdPace.value = formatPace(thresholdPace);\n        }\n\n        updateSportUI();\n    };\n\n    /**\n     * Handle Sport Type Change\n     */\n    settingSportType?.addEventListener('change', async () => {\n        updateSportUI();\n        const newSport = settingSportType?.value;\n\n        // Save to AppSettings and reload data fields\n        if (newSport) {\n            const appSettings = getSettings();\n            appSettings.sportType = newSport as 'cycling' | 'running' | 'indoor' | 'walking';\n            saveSettingsToStorage(appSettings);\n\n            // Load and dispatch new activity screens\n            const activityType = newSport as 'cycling' | 'running' | 'indoor' | 'walking';\n            const { loadActivityScreens } = await import('../data-fields/persistence.js');\n            const config = loadActivityScreens(activityType);\n\n            const event = new CustomEvent('data-fields-activity-changed', {\n                detail: { activityType, config },\n            });\n            document.dispatchEvent(event);\n        }\n\n        // Auto-configure Auto Lap defaults based on sport\n        if (settingAutoLapDistance) {\n            if (newSport === 'running' || newSport === 'walking') {\n                // Suggest 1km for running if it was set to something else (e.g. 5km)\n                // But valid options are strings in UI, ensure we select \"1\"\n                if (settingAutoLapDistance.value === '5' || settingAutoLapDistance.value === '10') {\n                    settingAutoLapDistance.value = '1';\n                    // We should verify if we want to also ENABLE it if it was disabled?\n                    // For now just switching the distance preference is safer.\n                }\n            } else if (newSport === 'cycling') {\n                // Return to 5km for cycling if it was 1km?\n                // Or leave user preference. \"Default 1km for running\" implies changing TO running sets it to 1.\n                if (settingAutoLapDistance.value === '1' || settingAutoLapDistance.value === '0.4') {\n                    settingAutoLapDistance.value = '5';\n                }\n            }\n        }\n    });\n\n    /**\n     * Toggle API Key visibility\n     */\n    toggleIntervalsApiKey?.addEventListener('click', () => {\n        if (settingIntervalsApiKey) {\n            const isPassword = settingIntervalsApiKey.type === 'password';\n            settingIntervalsApiKey.type = isPassword ? 'text' : 'password';\n            if (toggleIntervalsApiKey) {\n                toggleIntervalsApiKey.textContent = isPassword ? 'ðŸ™ˆ' : 'ðŸ‘ï¸';\n            }\n        }\n    });\n\n    settingIntervalsEnabled?.addEventListener('change', updateIntervalsUI);\n\n    /**\n     * Update auto-pause options visibility and unit label\n     */\n    const updateAutoPauseUI = (): void => {\n        if (autoPauseOptions && settingAutoPauseEnabled) {\n            autoPauseOptions.style.opacity = settingAutoPauseEnabled.checked ? '1' : '0.5';\n            autoPauseOptions.style.pointerEvents = settingAutoPauseEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoPauseThresholdUnit && settingAutoPauseSource) {\n            const unit = getAutoPauseSourceUnit(settingAutoPauseSource.value as AutoPauseSource);\n            autoPauseThresholdUnit.textContent = unit;\n        }\n    };\n\n    // Add event listeners for auto-pause UI updates\n    settingAutoPauseEnabled?.addEventListener('change', updateAutoPauseUI);\n    settingAutoPauseSource?.addEventListener('change', updateAutoPauseUI);\n\n    /**\n     * Update auto-lap options visibility and source options\n     */\n    const updateAutoLapUI = (): void => {\n        if (autoLapOptions && settingAutoLapEnabled) {\n            autoLapOptions.style.opacity = settingAutoLapEnabled.checked ? '1' : '0.5';\n            autoLapOptions.style.pointerEvents = settingAutoLapEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoLapDistanceOption && autoLapTimeOption && settingAutoLapSource) {\n            const isDistance = settingAutoLapSource.value === 'distance';\n            autoLapDistanceOption.style.display = isDistance ? 'flex' : 'none';\n            autoLapTimeOption.style.display = isDistance ? 'none' : 'flex';\n        }\n    };\n\n    // Add event listeners for auto-lap UI updates\n    settingAutoLapEnabled?.addEventListener('change', updateAutoLapUI);\n    settingAutoLapSource?.addEventListener('change', updateAutoLapUI);\n\n    /**\n     * Apply settings to the UI\n     */\n    const applySettings = (settings: AppSettings): void => {\n        // Reload voice settings\n        voiceFeedback.reloadVoice();\n\n        // Toggle metric visibility\n        const toggleMetric = (metric: string, isVisible: boolean): void => {\n            const elements = document.querySelectorAll(`.metric-group-${metric}`);\n            elements.forEach((el) => {\n                (el as HTMLElement).style.display = isVisible ? 'flex' : 'none';\n            });\n        };\n\n        toggleMetric('speed', settings.speed);\n        toggleMetric('distance', settings.distance);\n        toggleMetric('altitude', settings.altitude);\n        toggleMetric('energy', settings.showCalories);\n        toggleMetric('power', settings.power);\n        toggleMetric('cadence', settings.cadence);\n        toggleMetric('heartrate', settings.heartrate);\n        toggleMetric('treadmillSpeed', settings.treadmillSpeed);\n\n        // Apply 3-second average power indicator\n        const powerMetrics = document.querySelectorAll('.metric-group-power');\n        powerMetrics.forEach((el) => {\n            if (settings.power3s) {\n                el.setAttribute('data-show-avg', 'true');\n            } else {\n                el.removeAttribute('data-show-avg');\n            }\n        });\n\n        // Apply high contrast mode\n        if (settings.highContrast) {\n            document.documentElement.setAttribute('data-high-contrast', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-high-contrast');\n        }\n\n        // Apply colorblind patterns (enabled when high contrast + colorblind patterns both on)\n        if (settings.colorblindPatterns) {\n            document.documentElement.setAttribute('data-colorblind-patterns', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-colorblind-patterns');\n        }\n\n        // Apply debug mode UI\n        if (debugControls) {\n            debugControls.style.display = settings.debugMode ? 'flex' : 'none';\n        }\n    };\n\n    const readVoiceSettingsFromUI = (): EnhancedVoiceSettings => ({\n        timeIntervalMinutes: (settingVoiceTimeInterval?.value\n            ? parseInt(settingVoiceTimeInterval.value)\n            : defaultEnhancedVoiceSettings.timeIntervalMinutes) as 0 | 1 | 5 | 10 | 15 | 30,\n        distanceIntervalKm: (settingVoiceDistanceInterval?.value\n            ? parseInt(settingVoiceDistanceInterval.value)\n            : defaultEnhancedVoiceSettings.distanceIntervalKm) as 0 | 1 | 5 | 10,\n        metrics: {\n            power: settingVoiceMetricPower?.checked ?? defaultVoiceMetrics.power,\n            heartrate: settingVoiceMetricHeartrate?.checked ?? defaultVoiceMetrics.heartrate,\n            cadence: settingVoiceMetricCadence?.checked ?? defaultVoiceMetrics.cadence,\n            speed: settingVoiceMetricSpeed?.checked ?? defaultVoiceMetrics.speed,\n            distance: settingVoiceMetricDistance?.checked ?? defaultVoiceMetrics.distance,\n            time: settingVoiceMetricTime?.checked ?? defaultVoiceMetrics.time,\n            pace: settingVoiceMetricPace?.checked ?? defaultVoiceMetrics.pace,\n        },\n        speechRate: (settingVoiceSpeechRate?.value\n            ? parseFloat(settingVoiceSpeechRate.value)\n            : defaultEnhancedVoiceSettings.speechRate) as 0.5 | 0.75 | 1 | 1.25 | 1.5 | 2,\n        voiceURI: settingVoiceSelection?.value || defaultEnhancedVoiceSettings.voiceURI,\n        workoutTargetFeedback:\n            settingVoiceTargetFeedback?.checked ?? defaultEnhancedVoiceSettings.workoutTargetFeedback,\n        smartAnnouncements: settingSmartAnnouncements?.checked ?? defaultEnhancedVoiceSettings.smartAnnouncements,\n        announcementTemplate: settingVoiceTemplate?.value || defaultEnhancedVoiceSettings.announcementTemplate,\n    });\n\n    const loadVoiceSettingsToUI = (settings: EnhancedVoiceSettings): void => {\n        if (settingVoiceTimeInterval) settingVoiceTimeInterval.value = settings.timeIntervalMinutes.toString();\n        if (settingVoiceDistanceInterval) settingVoiceDistanceInterval.value = settings.distanceIntervalKm.toString();\n        if (settingVoiceSpeechRate) settingVoiceSpeechRate.value = settings.speechRate.toString();\n\n        if (settingVoiceMetricPower) settingVoiceMetricPower.checked = settings.metrics.power;\n        if (settingVoiceMetricHeartrate) settingVoiceMetricHeartrate.checked = settings.metrics.heartrate;\n        if (settingVoiceMetricCadence) settingVoiceMetricCadence.checked = settings.metrics.cadence;\n        if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = settings.metrics.speed;\n        if (settingVoiceMetricDistance) settingVoiceMetricDistance.checked = settings.metrics.distance;\n        if (settingVoiceMetricTime) settingVoiceMetricTime.checked = settings.metrics.time;\n        if (settingVoiceMetricPace) settingVoiceMetricPace.checked = settings.metrics.pace;\n\n        if (settingVoiceSelection && settings.voiceURI) settingVoiceSelection.value = settings.voiceURI;\n        if (settingVoiceTargetFeedback) settingVoiceTargetFeedback.checked = settings.workoutTargetFeedback;\n        if (settingSmartAnnouncements) settingSmartAnnouncements.checked = settings.smartAnnouncements;\n        if (settingVoiceTemplate) settingVoiceTemplate.value = settings.announcementTemplate || '';\n    };\n\n    /**\n     * Save settings to localStorage\n     */\n    const saveSettings = (): void => {\n        // Save User Profile\n        const currentProfile = loadUserProfile();\n        const updatedProfile = {\n            ...currentProfile,\n            maxHr: settingMaxHr?.value ? Number(settingMaxHr.value) : null,\n            weight: settingWeight?.value ? Number(settingWeight.value) : null,\n        };\n        saveUserProfile(updatedProfile);\n        window.dispatchEvent(new CustomEvent('user-profile-changed'));\n\n        // Update SettingsStore (for HR Zones)\n        settingsStore.setMultiple({\n            maxHeartrate: updatedProfile.maxHr ?? 190,\n            weight: updatedProfile.weight ?? 75,\n        });\n\n        const settings: AppSettings = {\n            sportType: settingSportType?.value as 'cycling' | 'running' | 'indoor' | 'walking' | undefined ?? defaultSettings.sportType,\n            speed: settingSpeed?.checked ?? defaultSettings.speed,\n            distance: settingDistance?.checked ?? defaultSettings.distance,\n            altitude: settingAltitude?.checked ?? defaultSettings.altitude,\n            weightKg: settingWeight?.value ? Number(settingWeight.value) : defaultSettings.weightKg,\n            showCalories: settingShowCalories?.checked ?? defaultSettings.showCalories,\n            power: settingPower?.checked ?? defaultSettings.power,\n            cadence: settingCadence?.checked ?? defaultSettings.cadence,\n            heartrate: settingHeartrate?.checked ?? defaultSettings.heartrate,\n            treadmillSpeed: settingTreadmillSpeed?.checked ?? defaultSettings.treadmillSpeed,\n            power3s: settingPower3s?.checked ?? defaultSettings.power3s,\n            highContrast: settingHighContrast?.checked ?? defaultSettings.highContrast,\n            colorblindPatterns: settingColorblindPatterns?.checked ?? defaultSettings.colorblindPatterns,\n            voiceEnabled: settingVoiceEnabled?.checked ?? defaultSettings.voiceEnabled,\n            voiceLaps: settingVoiceLaps?.checked ?? defaultSettings.voiceLaps,\n            voiceZones: settingVoiceZones?.checked ?? defaultSettings.voiceZones,\n            autoPause: {\n                enabled: settingAutoPauseEnabled?.checked ?? defaultAutoPauseSettings.enabled,\n                source: (settingAutoPauseSource?.value as AutoPauseSource) ?? defaultAutoPauseSettings.source,\n                threshold: settingAutoPauseThreshold?.value\n                    ? Number(settingAutoPauseThreshold.value)\n                    : defaultAutoPauseSettings.threshold,\n                delay: settingAutoPauseDelay?.value\n                    ? Number(settingAutoPauseDelay.value)\n                    : defaultAutoPauseSettings.delay,\n            },\n            workoutMetadata: {\n                promptForNotes: settingPromptForNotes?.checked ?? defaultWorkoutMetadataSettings.promptForNotes,\n                promptForExertion:\n                    settingPromptForExertion?.checked ?? defaultWorkoutMetadataSettings.promptForExertion,\n            },\n            countdown: {\n                duration: (settingCountdownDuration?.value\n                    ? parseInt(settingCountdownDuration.value)\n                    : defaultCountdownSettings.duration) as 0 | 3 | 5 | 10,\n                enableBeep: settingCountdownBeep?.checked ?? defaultCountdownSettings.enableBeep,\n                enableVoice: settingCountdownVoice?.checked ?? defaultCountdownSettings.enableVoice,\n            },\n            autoLap: {\n                enabled: settingAutoLapEnabled?.checked ?? defaultAutoLapSettings.enabled,\n                source: (settingAutoLapSource?.value as AutoLapSource) ?? defaultAutoLapSettings.source,\n                distanceKm: settingAutoLapDistance?.value\n                    ? Number(settingAutoLapDistance.value)\n                    : defaultAutoLapSettings.distanceKm,\n                timeMinutes: settingAutoLapTime?.value\n                    ? Number(settingAutoLapTime.value)\n                    : defaultAutoLapSettings.timeMinutes,\n            },\n            enhancedVoice: readVoiceSettingsFromUI(),\n            intervals: {\n                enabled: settingIntervalsEnabled?.checked ?? defaultIntervalsSettings.enabled,\n                apiKey: settingIntervalsApiKey?.value ?? defaultIntervalsSettings.apiKey,\n                athleteId: settingIntervalsAthleteId?.value ?? defaultIntervalsSettings.athleteId,\n                autoUpload: settingIntervalsAutoUpload?.checked ?? defaultIntervalsSettings.autoUpload,\n            },\n            music: {\n                enabled: settingMusicEnabled?.checked ?? defaultMusicSettings.enabled,\n                volume: settingMusicVolume?.value ? Number(settingMusicVolume.value) / 100 : defaultMusicSettings.volume,\n                style: (settingMusicStyle?.value as any) ?? defaultMusicSettings.style,\n                tempoSync: (settingMusicTempoSync?.value as any) ?? defaultMusicSettings.tempoSync,\n                fixedBPM: settingMusicFixedBPM?.value ? Number(settingMusicFixedBPM.value) : defaultMusicSettings.fixedBPM,\n                intensityMapping: (settingMusicIntensityMapping?.value as any) ?? defaultMusicSettings.intensityMapping,\n                transitionSpeed: (settingMusicTransitionSpeed?.value as any) ?? defaultMusicSettings.transitionSpeed,\n                duckingEnabled: settingMusicDucking?.checked ?? defaultMusicSettings.duckingEnabled,\n                duckingLevel: settingMusicDuckingLevel?.value ? Number(settingMusicDuckingLevel.value) / 100 : defaultMusicSettings.duckingLevel,\n            },\n            exportTcx: settingExportTcx?.checked ?? defaultSettings.exportTcx,\n            exportCsv: settingExportCsv?.checked ?? defaultSettings.exportCsv,\n            exportJson: settingExportJson?.checked ?? defaultSettings.exportJson,\n            exportFit: settingExportFit?.checked ?? defaultSettings.exportFit,\n            debugMode: settingDebugMode?.checked ?? defaultSettings.debugMode,\n            mockSensors: settingMockSensors?.checked ?? defaultSettings.mockSensors,\n            wheelCircumferenceMm: getSettings().wheelCircumferenceMm, // Preserve existing value\n        };\n\n        // Sync mock sensors setting with window flag for bluetooth factory\n        (window as any).useMockSensors = settings.mockSensors;\n\n        // saveSettingsToStorage dispatches 'settings-changed' internally\n        saveSettingsToStorage(settings);\n\n        // Save sport settings separately\n        saveSportSettingsFromUI();\n\n        applySettings(settings);\n    };\n\n    /**\n     * Load settings from localStorage\n     */\n    const loadSettings = (): void => {\n        const settings = getSettings();\n        const profile = loadUserProfile();\n\n        // User Profile settings\n        if (settingMaxHr) settingMaxHr.value = profile.maxHr?.toString() ?? '';\n        if (settingWeight) settingWeight.value = profile.weight?.toString() ?? '';\n\n        // Dashboard display settings\n        if (settingPower) settingPower.checked = settings.power;\n        if (settingCadence) settingCadence.checked = settings.cadence;\n        if (settingHeartrate) settingHeartrate.checked = settings.heartrate;\n        if (settingSpeed) settingSpeed.checked = settings.speed;\n        if (settingDistance) settingDistance.checked = settings.distance;\n        if (settingAltitude) settingAltitude.checked = settings.altitude;\n        if (settingShowCalories) settingShowCalories.checked = settings.showCalories;\n        if (settingTreadmillSpeed) settingTreadmillSpeed.checked = settings.treadmillSpeed;\n        if (settingPower3s) settingPower3s.checked = settings.power3s;\n\n        // Accessibility settings\n        if (settingHighContrast) settingHighContrast.checked = settings.highContrast;\n        if (settingColorblindPatterns) settingColorblindPatterns.checked = settings.colorblindPatterns;\n\n        // Voice Feedback settings\n        if (settingVoiceEnabled) settingVoiceEnabled.checked = settings.voiceEnabled;\n        if (settingVoiceLaps) settingVoiceLaps.checked = settings.voiceLaps;\n        if (settingVoiceZones) settingVoiceZones.checked = settings.voiceZones;\n\n        if (settingVoiceSelection) {\n            const populateVoices = () => {\n                const voices = voiceFeedback.getAvailableVoices();\n\n                // Keep the default option\n                settingVoiceSelection.innerHTML = '<option value=\"\">Default System Voice</option>';\n\n                voices.forEach((voice) => {\n                    const option = document.createElement('option');\n                    option.value = voice.voiceURI;\n                    option.textContent = `${voice.name} (${voice.lang})`;\n                    settingVoiceSelection.appendChild(option);\n                });\n\n                if (settings.enhancedVoice.voiceURI) {\n                    settingVoiceSelection.value = settings.enhancedVoice.voiceURI;\n                }\n            };\n\n            populateVoices();\n\n            // Try again after a delay if voices are empty (browser timing issue)\n            if (voiceFeedback.getAvailableVoices().length === 0) {\n                setTimeout(populateVoices, 500);\n                setTimeout(populateVoices, 2000);\n            }\n        }\n\n        // Auto-Pause settings\n        if (settingAutoPauseEnabled) settingAutoPauseEnabled.checked = settings.autoPause.enabled;\n        if (settingAutoPauseSource) settingAutoPauseSource.value = settings.autoPause.source;\n        if (settingAutoPauseThreshold) settingAutoPauseThreshold.value = settings.autoPause.threshold.toString();\n        if (settingAutoPauseDelay) settingAutoPauseDelay.value = settings.autoPause.delay.toString();\n        updateAutoPauseUI();\n\n        // Export format settings\n        if (settingExportTcx) settingExportTcx.checked = settings.exportTcx;\n        if (settingExportCsv) settingExportCsv.checked = settings.exportCsv;\n        if (settingExportJson) settingExportJson.checked = settings.exportJson;\n        if (settingExportFit) settingExportFit.checked = settings.exportFit;\n\n        // Workout metadata settings\n        if (settingPromptForNotes) settingPromptForNotes.checked = settings.workoutMetadata.promptForNotes;\n        if (settingPromptForExertion) settingPromptForExertion.checked = settings.workoutMetadata.promptForExertion;\n\n        // Countdown settings\n        if (settingCountdownDuration) settingCountdownDuration.value = settings.countdown.duration.toString();\n        if (settingCountdownBeep) settingCountdownBeep.checked = settings.countdown.enableBeep;\n        if (settingCountdownVoice) settingCountdownVoice.checked = settings.countdown.enableVoice;\n\n        // Auto-Lap settings\n        if (settingAutoLapEnabled) settingAutoLapEnabled.checked = settings.autoLap.enabled;\n        if (settingAutoLapSource) settingAutoLapSource.value = settings.autoLap.source;\n        if (settingAutoLapDistance) settingAutoLapDistance.value = settings.autoLap.distanceKm.toString();\n        if (settingAutoLapTime) settingAutoLapTime.value = settings.autoLap.timeMinutes.toString();\n        updateAutoLapUI();\n\n        // Enhanced Voice settings\n        loadVoiceSettingsToUI(settings.enhancedVoice);\n\n        // Intervals.icu settings\n        if (settingIntervalsEnabled) settingIntervalsEnabled.checked = settings.intervals.enabled;\n        if (settingIntervalsApiKey) settingIntervalsApiKey.value = settings.intervals.apiKey;\n        if (settingIntervalsAthleteId) settingIntervalsAthleteId.value = settings.intervals.athleteId;\n        if (settingIntervalsAutoUpload) settingIntervalsAutoUpload.checked = settings.intervals.autoUpload;\n        updateIntervalsUI();\n\n        // Music Generation settings\n        if (settingMusicEnabled) settingMusicEnabled.checked = settings.music.enabled;\n        if (settingMusicVolume) settingMusicVolume.value = (settings.music.volume * 100).toString();\n        updateMusicVolumeDisplay();\n        if (settingMusicStyle) settingMusicStyle.value = settings.music.style;\n        if (settingMusicTempoSync) settingMusicTempoSync.value = settings.music.tempoSync;\n        if (settingMusicFixedBPM) settingMusicFixedBPM.value = settings.music.fixedBPM.toString();\n        if (settingMusicIntensityMapping) settingMusicIntensityMapping.value = settings.music.intensityMapping;\n        if (settingMusicTransitionSpeed) settingMusicTransitionSpeed.value = settings.music.transitionSpeed;\n        if (settingMusicDucking) settingMusicDucking.checked = settings.music.duckingEnabled;\n        if (settingMusicDuckingLevel) settingMusicDuckingLevel.value = (settings.music.duckingLevel * 100).toString();\n        updateMusicDuckingLevelDisplay();\n        updateMusicUI();\n\n        // Debug settings\n        if (settingDebugMode) settingDebugMode.checked = settings.debugMode;\n\n        // Mock sensors setting\n        if (settingMockSensors) settingMockSensors.checked = settings.mockSensors;\n        // Sync with window flag on load\n        (window as any).useMockSensors = settings.mockSensors;\n\n        // Sport settings (stored separately)\n        loadSportSettings();\n\n        applySettings(settings);\n    };\n\n    // Event Listeners\n\n    // Auto-save setup\n    const saveSettingsDebounced = debounce(() => saveSettings(), 500);\n    const attachAutoSave = (element: HTMLElement | null, type: 'change' | 'input' = 'change') => {\n        if (!element) return;\n        if (type === 'input') {\n            element.addEventListener('input', saveSettingsDebounced);\n        } else {\n            element.addEventListener('change', () => saveSettings());\n        }\n    };\n\n    // Attach to inputs\n    // User Profile\n    attachAutoSave(settingMaxHr, 'input');\n    attachAutoSave(settingWeight, 'input');\n\n    // Add validation for numeric inputs\n    settingMaxHr?.addEventListener('blur', () => {\n        if (settingMaxHr.value) {\n            validateNumericInput(settingMaxHr, 100, 250);\n        } else {\n            clearValidation(settingMaxHr);\n        }\n    });\n    settingMaxHr?.addEventListener('focus', () => clearValidation(settingMaxHr));\n\n    settingWeight?.addEventListener('blur', () => {\n        if (settingWeight.value) {\n            validateNumericInput(settingWeight, 30, 300);\n        } else {\n            clearValidation(settingWeight);\n        }\n    });\n    settingWeight?.addEventListener('focus', () => clearValidation(settingWeight));\n\n    // Dashboard\n    [\n        settingSpeed,\n        settingDistance,\n        settingAltitude,\n        settingShowCalories,\n        settingPower,\n        settingCadence,\n        settingHeartrate,\n        settingTreadmillSpeed,\n        settingPower3s,\n    ].forEach((el) => attachAutoSave(el));\n\n    // Accessibility\n    attachAutoSave(settingHighContrast);\n    attachAutoSave(settingColorblindPatterns);\n\n    // Voice\n    attachAutoSave(settingVoiceEnabled);\n    attachAutoSave(settingVoiceLaps);\n    attachAutoSave(settingVoiceZones);\n\n    // Auto-Pause\n    attachAutoSave(settingAutoPauseEnabled);\n    attachAutoSave(settingAutoPauseSource);\n    attachAutoSave(settingAutoPauseThreshold, 'input');\n    attachAutoSave(settingAutoPauseDelay, 'input');\n\n    // Export\n    [settingExportTcx, settingExportCsv, settingExportJson, settingExportFit].forEach((el) => attachAutoSave(el));\n\n    // Metadata\n    attachAutoSave(settingPromptForNotes);\n    attachAutoSave(settingPromptForExertion);\n\n    // Countdown\n    attachAutoSave(settingCountdownDuration);\n    attachAutoSave(settingCountdownBeep);\n    attachAutoSave(settingCountdownVoice);\n\n    // Auto-Lap\n    attachAutoSave(settingAutoLapEnabled);\n    attachAutoSave(settingAutoLapSource);\n    attachAutoSave(settingAutoLapDistance);\n    attachAutoSave(settingAutoLapTime);\n\n    // Enhanced Voice\n    attachAutoSave(settingVoiceTimeInterval);\n    attachAutoSave(settingVoiceDistanceInterval);\n    attachAutoSave(settingVoiceSpeechRate);\n    [\n        settingVoiceMetricPower,\n        settingVoiceMetricHeartrate,\n        settingVoiceMetricCadence,\n        settingVoiceMetricSpeed,\n        settingVoiceMetricDistance,\n        settingVoiceMetricTime,\n        settingVoiceMetricPace,\n        settingVoiceTargetFeedback,\n    ].forEach((el) => attachAutoSave(el));\n    attachAutoSave(settingVoiceTemplate, 'input');\n\n    // Sport\n    if (settingSportType) {\n        settingSportType.addEventListener('change', () => {\n            const newSport = settingSportType.value;\n            // Save CURRENT voice settings to PREVIOUS sport preset\n            const currentVoice = readVoiceSettingsFromUI();\n            const presetsStr = localStorage.getItem('voice_presets');\n            const presets = presetsStr ? JSON.parse(presetsStr) : {};\n            presets[lastActiveSport] = currentVoice;\n            localStorage.setItem('voice_presets', JSON.stringify(presets));\n\n            // Load NEW sport preset\n            const saved = presets[newSport];\n            if (saved) {\n                loadVoiceSettingsToUI(saved);\n            } else {\n                // Apply intelligent defaults if no preset exists\n                if (newSport === 'running' || newSport === 'walking') {\n                    if (settingVoiceMetricPace) settingVoiceMetricPace.checked = true;\n                    if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = false;\n                } else {\n                    if (settingVoiceMetricPace) settingVoiceMetricPace.checked = false;\n                    if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = true;\n                }\n                // Reset feedback for new sport (if no preset/new profile)\n                if (settingVoiceTargetFeedback) settingVoiceTargetFeedback.checked = false;\n            }\n\n            lastActiveSport = newSport;\n            saveSettings();\n        });\n    }\n    attachAutoSave(settingShowPace);\n    attachAutoSave(settingThresholdPace, 'input');\n\n    // Intervals\n    attachAutoSave(settingIntervalsEnabled);\n    attachAutoSave(settingIntervalsApiKey, 'input');\n    attachAutoSave(settingIntervalsAthleteId, 'input');\n    attachAutoSave(settingIntervalsAutoUpload);\n\n    // Music Generation\n    attachAutoSave(settingMusicEnabled);\n    attachAutoSave(settingMusicVolume, 'input');\n    attachAutoSave(settingMusicStyle);\n    attachAutoSave(settingMusicTempoSync);\n    attachAutoSave(settingMusicFixedBPM, 'input');\n    attachAutoSave(settingMusicIntensityMapping);\n    attachAutoSave(settingMusicTransitionSpeed);\n    attachAutoSave(settingMusicDucking);\n    attachAutoSave(settingMusicDuckingLevel, 'input');\n\n    // Update volume display on input\n    settingMusicVolume?.addEventListener('input', updateMusicVolumeDisplay);\n    settingMusicDuckingLevel?.addEventListener('input', updateMusicDuckingLevelDisplay);\n\n    // Update UI visibility when music enabled/disabled\n    settingMusicEnabled?.addEventListener('change', updateMusicUI);\n    settingMusicTempoSync?.addEventListener('change', updateMusicUI);\n    settingMusicDucking?.addEventListener('change', updateMusicUI);\n\n    // Debug\n    attachAutoSave(settingDebugMode);\n    attachAutoSave(settingMockSensors);\n\n    // Update Save button to Close button\n    if (saveSettingsButton) {\n        saveSettingsButton.textContent = 'Close Settings';\n        saveSettingsButton.className = 'close-settings-btn'; // Give it a specific class if we want to restyle\n        // Keep existing styles inline for now or move to CSS.\n        // The inline style in HTML is: background: #2196f3; ...\n        // We might want to change color to gray or neutral since it's just 'Close'.\n        saveSettingsButton.style.background = '#6c757d'; // Neutral gray\n\n        saveSettingsButton.addEventListener('click', () => {\n            if ((window as any).router) {\n                // Navigate back if possible, or home\n                // Ideally router.back() if tracking history\n                // Falling back to home for safety\n                (window as any).router.navigate('/');\n            } else {\n                window.history.back();\n            }\n        });\n    }\n\n    downloadDebugLogs?.addEventListener('click', () => {\n        BluetoothDebugService.exportLogs();\n    });\n\n    clearDebugLogs?.addEventListener('click', async () => {\n        if (confirm('Are you sure you want to clear all debug logs?')) {\n            await BluetoothDebugService.clearLogs();\n            alert('Logs cleared.');\n        }\n    });\n\n    // PWA Install button handler\n    installPwaButton?.addEventListener('click', async () => {\n        const outcome = await triggerInstallPrompt();\n\n        if (outcome === 'accepted') {\n            // App will be installed, button will hide automatically via installPrompt.ts\n            console.log('PWA installation accepted');\n        } else if (outcome === 'dismissed') {\n            console.log('PWA installation dismissed');\n        } else {\n            alert(\n                'Installation is not available at this time. The app may already be installed or your browser does not support installation.'\n            );\n        }\n    });\n\n    // Initialize\n    loadSettings();\n\n    // Initialize Feature Flags UI\n    initFeatureFlags();\n}\n\n/**\n * Initialize the Feature Flags UI\n */\nfunction initFeatureFlags(): void {\n    const container = document.getElementById('featureFlagsList');\n    const resetButton = document.getElementById('resetFeatureFlags');\n\n    if (!container) return;\n\n    const renderFlags = (): void => {\n        const flags = featureFlagService.getAllFlags();\n        container.innerHTML = '';\n\n        Object.values(flags).forEach((flag) => {\n            // Skip debug flags in production\n            if (flag.category === 'debug' && !import.meta.env.DEV) {\n                return;\n            }\n\n            const categoryBadge = getCategoryBadge(flag.category);\n\n            const wrapper = document.createElement('label');\n            wrapper.className = 'settings-option';\n            wrapper.style.cssText = 'display: flex; align-items: flex-start; gap: 10px; cursor: pointer;';\n\n            const checkbox = document.createElement('input');\n            checkbox.type = 'checkbox';\n            checkbox.id = `flag-${flag.key}`;\n            checkbox.checked = flag.enabled;\n            checkbox.style.cssText = 'width: 20px; height: 20px; margin-top: 2px;';\n\n            checkbox.addEventListener('change', () => {\n                if (checkbox.checked) {\n                    featureFlagService.enable(flag.key);\n                } else {\n                    featureFlagService.disable(flag.key);\n                }\n                showRefreshNotice();\n            });\n\n            const textWrapper = document.createElement('div');\n            textWrapper.style.cssText = 'flex: 1;';\n            textWrapper.innerHTML = `\n                <span style=\"font-size: 16px; display: flex; align-items: center; gap: 8px;\">\n                    ${flag.name}\n                    <span style=\"font-size: 11px; padding: 2px 6px; border-radius: 4px; ${categoryBadge}\">${flag.category}</span>\n                </span>\n                <p style=\"font-size: 12px; color: #666; margin: 2px 0 0 0;\">${flag.description}</p>\n            `;\n\n            wrapper.appendChild(checkbox);\n            wrapper.appendChild(textWrapper);\n            container.appendChild(wrapper);\n        });\n    };\n\n    const getCategoryBadge = (category: string): string => {\n        switch (category) {\n            case 'core':\n                return 'background: #e3f2fd; color: #1976d2;';\n            case 'experimental':\n                return 'background: #fff3e0; color: #f57c00;';\n            case 'premium':\n                return 'background: #f3e5f5; color: #7b1fa2;';\n            case 'debug':\n                return 'background: #fce4ec; color: #c2185b;';\n            default:\n                return 'background: #f5f5f5; color: #666;';\n        }\n    };\n\n    const showRefreshNotice = (): void => {\n        // Show a non-blocking notice that changes require refresh\n        const existingNotice = document.getElementById('feature-flag-notice');\n        if (existingNotice) return;\n\n        const notice = document.createElement('div');\n        notice.id = 'feature-flag-notice';\n        notice.style.cssText = `\n            position: fixed;\n            bottom: 80px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: #323232;\n            color: white;\n            padding: 12px 24px;\n            border-radius: 8px;\n            font-size: 14px;\n            z-index: 1000;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        `;\n        notice.innerHTML = `\n            <span>Refresh page to apply changes</span>\n            <button id=\"refreshNowBtn\" style=\"\n                background: #2196f3;\n                color: white;\n                border: none;\n                padding: 6px 12px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 14px;\n            \">Refresh Now</button>\n        `;\n        document.body.appendChild(notice);\n\n        const refreshBtn = document.getElementById('refreshNowBtn');\n        refreshBtn?.addEventListener('click', () => {\n            window.location.reload();\n        });\n\n        // Auto-dismiss after 10 seconds\n        setTimeout(() => {\n            notice.remove();\n        }, 10000);\n    };\n\n    resetButton?.addEventListener('click', () => {\n        if (confirm('Reset all feature flags to their default values?')) {\n            featureFlagService.resetToDefaults();\n            renderFlags();\n            showRefreshNotice();\n        }\n    });\n\n    renderFlags();\n}\n","import { View } from '../router/View.js';\nimport { initSettingsLogic } from '../ui/settings.js';\n// TODO: Re-enable after refactoring dataFieldsConfig to use ActivityScreensConfig\n// import { initDataFieldsConfig } from '../ui/dataFieldsConfig.js';\n\nexport class SettingsView implements View {\n    public id = 'settings';\n    // private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('settingsTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initSettingsLogic();\n                // TODO: Re-enable after refactoring\n                // initDataFieldsConfig();\n                // this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Settings template not found!');\n            container.innerHTML = '<p>Error loading settings view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        // If we needed to refresh settings from storage every time we enter,\n        // we might call loadSettings() here.\n        // But initSettingsLogic calls loadSettings internally during init.\n        // If the user changes settings, they are saved.\n        // If we want to ensure UI matches state if state changed elsewhere...\n        // initSettingsLogic sets up listeners.\n        // We might want to re-run loadSettings() if it exposed it.\n        // For now, let's assume one-time init is fine or we can expose refresh.\n\n        // Actually, since we re-clone the template only ONCE in init (if the container is empty?),\n        // Wait, the Router usually doesn't clear the container unless we implement it that way.\n        // My Router implementation:\n        /*\n            if (!this.views.has(viewId)) { ... view.init(container) }\n            this.currentView?.onLeave();\n            currentContainer.style.display = 'none';\n            newContainer.style.display = 'block';\n            view.onEnter();\n        */\n\n        // So init() is called once. The DOM elements persist.\n        // So `initSettingsLogic` is called once. The listeners persist.\n        // This is correct.\n    }\n\n    public onLeave(): void {\n        console.log('Left Settings View');\n    }\n}\n"],"file":"SettingsView-DOkIHdv6.js"}