{"version":3,"mappings":"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","names":["BaseComponent","name","oldValue","newValue","_name","_oldValue","_newValue","eventName","detail","selector","ZONE_COLORS","MetricDisplay","label","value","unit","icon","zoneName","showAvg","connected","zone","colors","POWER_ZONES","PowerGauge","size","ftp","max","showZones","radius","circumference","arcLength","ftpPercent","zoneColor","progress","dashOffset","currentFtpPercent","index","startPercent","endPercent","zoneArcLength","offset","targetValue","duration","startValue","startTime","animate","currentTime","elapsed","eased","currentValue","ZoneGauge","percent","fill","container","CHART_CONFIG","LiveChart","config","timestamp","cutoffTime","time","visibleData","noDataMsg","width","height","points","areaPoints","point","x","y","linePath","firstX","lastX","areaPath","avg","sum","p","WorkoutTimer","showMs","timeString","totalSeconds","hours","minutes","seconds","pad","n","result","ms","state","TYPE_STYLES","Toast","message","type","dismissible","styles","dismissBtn","options","toast","Modal","title","e","action","focusableElements","first","last","resolve","modal","content","footer","cancelBtn","confirmBtn","okBtn","DB_NAME","DB_VERSION","STORE_NAME","COMPLETED_STORE","DEBUG_STORE","db","openDatabase","reject","request","event","database","debugStore","saveDebugLog","sensor","data","record","getDebugLogs","clearDebugLogs","saveActiveWorkout","measurements","clearActiveWorkout","loadActiveWorkout","saveCompletedWorkout","endTime","id","getWorkoutHistory","saveTimeout","pendingSave","throttledSave","delayMs","flushPendingSave","isIndexedDBSupported","archiveWorkout","active","hasRecoverableWorkout","getCompletedWorkouts","markWorkoutSynced","store","calculateDistance","lat1","lon1","lat2","lon2","1","2","","","a","VALIDATION_LIMITS","MeasurementsState","enablePersistence","callback","entry","min","lastPoint","dist","currentTotalDistance","clearPersisted","lapNumber","lap","enabled","measurement","getInitState","exposeVariablesDuringTest","measurementsState","connectionsState","ExceptionCode","CapacitorException","code","getPlatformId","win","_a","_b","createCapacitor","capCustomPlatform","cap","Plugins","getPlatform","isNativePlatform","isPluginAvailable","pluginName","plugin","registeredPlugins","getPluginHeader","h","handleError","err","registerPlugin","jsImplementations","registeredPlugin","platform","pluginHeader","jsImplementation","loadPluginImplementation","createPluginMethod","impl","prop","methodHeader","m","createPluginMethodWrapper","remove","wrapper","args","fn","addListener","removeListener","addListenerNative","call","callbackId","proxy","_","filePath","initCapacitorGlobal","Capacitor","WebPlugin","listenerFunc","firstListener","windowListener","listener","retainUntilConsumed","listeners","windowEventName","pluginEventName","msg","handle","arg","encode","str","decode","CapacitorCookiesPluginWeb","cookies","cookieMap","cookie","key","encodedKey","encodedValue","expires","path","domain","error","readBlobAsBase64","blob","reader","base64String","normalizeHttpHeaders","headers","originalKeys","k","acc","buildUrlParams","params","shouldEncode","accumulator","item","buildRequestInit","extra","output","form","CapacitorHttpPluginWeb","requestInit","urlParams","url","response","contentType","responseType","SystemBarsStyle","SystemBarType","SystemBarsPluginWeb","App","__vitePreload","Router","canGoBack","view","viewContainer","viewId","replace","hash","matchedRoute","r","currentView","el","newView","DashboardView","_container","API_BASE_URL","API_KEY","getHeaders","extraHeaders","isDatabaseAvailable","createWorkout","streamName","sport","userId","listWorkouts","page","limit","status","startDate","endDate","getWorkout","workoutId","includeTelemetry","completeWorkout","archiveTelemetry","deleteWorkout","formatDuration","secs","formatDate","date","getFtpHistory","announce","priority","announcer","shortcuts","registerShortcut","shortcut","handleKeydown","target","keyMatch","ctrlMatch","shiftMatch","altMatch","initKeyboardNavigation","startButton","pauseButton","resumeButton","modals","closeBtn","details","firstButton","settingsBtn","router","historyBtn","exportBtn","lapBtn","summary","trapFocus","firstElement","lastElement","updateWorkoutControlsAccessibility","stopButton","controlsContainer","createModalElement","titleText","body","btn","button","b","firstFocusable","lastFocusable","handleTabKey","showModal","previousActiveElement","removeFocusTrap","autofocusEl","closeModal","handleEscape","originalOnClose","showConfirmation","confirmText","cancelText","confirmVariant","calculateWorkoutSummary","zoneState","calcStats","values","d","powerValues","powerCurve","durations","getMaxForDuration","windowSize","i","maxAvg","trainingLoad","intensityFactor","profileStr","rolling30s","sum30","pow4","v","avgPow4","np","powerDist","hrDist","formatDurationLong","parts","formatSecondsShort","mins","createZoneHistogram","distribution","z","maxTime","timeSeconds","color","timeStr","createSummaryContent","newRecords","formatValue","recordsHtml","powerChart","hrChart","showWorkoutSummary","callbacks","currentPage","totalPages","dbAvailable","filterType","filterStartDate","filterEndDate","calendarDate","dataSource","getSummary","workout","initHistoryLogic","prevBtn","nextBtn","refreshBtn","typeFilter","dateStart","dateEnd","viewListBtn","viewCalendarBtn","viewAnalyticsBtn","listView","calendarView","analyticsView","prevMonthBtn","nextMonthBtn","sourceCloudBtn","sourceLocalBtn","setSource","checkDatabaseAvailability","setView","loadWorkouts","loadCalendar","loadAnalytics","handleFilterChange","historyButton","hasIndexedDB","updateSourceToggle","storedToWorkout","stored","listContainer","pageInfo","workouts","total","start","pagination","renderWorkoutCard","card","viewWorkoutDetails","confirmDeleteWorkout","syncWorkout","s","cloudBtn","localBtn","localId","local","w","createRes","statusClass","syncBtn","detailPanel","listPanel","renderWorkoutDetail","exportWorkoutData","filename","jsonData","jsonBlob","jsonUrl","jsonLink","calendarGrid","monthLabel","monthNames","year","month","renderCalendar","renderMonthlyStats","day","firstDay","daysInMonth","empty","dayCell","dayNum","wDate","dot","today","statsContainer","totalWorkouts","totalDuration","totalDistance","totalEnergy","prList","ftpHistory","renderAnalytics","renderPersonalRecords","renderTrainingLoad","renderPowerCurve","renderFitnessTrend","renderFtpHistory","renderPrHistory","maxPower","maxHr","longestRide","maxDistance","dateStr","createRow","row","weeks","weekNum","getWeekNumber","maxLoad","week","load","yearStart","bests","maxWatts","pathD","svg","formatDurationLabel","sec","sorted","tssMap","current","dataPoints","kCTL","kATL","ctl","atl","tss","chartW","chartH","maxVal","timeSpan","getX","getY","val","ctlPath","atlPath","history","maxFtp","minFtp","ftpRange","currX","prevY","currY","events","powerCurveBests","diff","notable","labels","reversedEvents","refreshHistoryView","HistoryView","template","RAMP_TEST","SWEET_SPOT_3X10","VO2_MAX_30_30","WORKOUT_LIBRARY","getWorkoutDuration","step","showNotification","notification","backgroundColor","selectElement","element","PROFILE_KEY","defaultProfile","loadUserProfile","saveUserProfile","profile","onboardingSteps","createOnboardingModal","renderProgressDots","currentStep","totalSteps","renderStep","stepIndex","elements","inputContainer","inputField","inputLabel","inputUnit","helpText","progressDots","showOnboarding","forceShow","skipBtn","saveCurrentInput","render","goNext","goPrev","skip","shouldShowOnboarding","initOnboarding","AudioController","Ctx","muted","freq","osc","gain","now","text","utterance","audioManager","WorkoutRunner","cb","remaining","nextIndex","STORAGE_KEY","getCustomWorkouts","raw","saveCustomWorkout","saveAll","deleteCustomWorkout","filtered","activeRunner","initWorkoutSelectionLogic","initPlayerControls","initImportExport","refreshWorkoutList","importBtn","importInput","files","importWorkoutFile","file","exportWorkout","dataStr","downloadAnchorNode","custom","h3","renderWorkoutItem","hr","h3lib","isCustom","actionsHtml","actionContainerStyle","t","selectWorkout","updatePlayerUI","overlay","minimizeBtn","isHidden","nameEl","descEl","timeEl","durEl","targetEl","nextEl","progressEl","timeRemaining","formatTime","nextPwr","calculateNextTarget","pct","onWorkoutStart","onWorkoutPause","currentSteps","initWorkoutBuilder","createBtn","saveBtn","addStepBtn","openBuilder","closeBuilder","saveWorkout","addStepFromForm","targetTypeSelect","valInput","selectionModal","resetForm","renderSteps","durationStr","targetType","targetValStr","capitalize","list","desc","idx","WorkoutsView","SETTINGS_KEY","defaultSettings","getSettings","settingsJson","saveSettingsToStorage","settings","BluetoothDebugService","hex","buffer","logs","deferredPrompt","initInstallPrompt","updateInstallButtonVisibility","canInstallPwa","triggerInstallPrompt","outcome","installButton","installButtonContainer","initSettingsLogic","saveSettingsButton","settingFtp","settingMaxHr","settingWeight","settingSpeed","settingDistance","settingAltitude","settingPower","settingCadence","settingHeartrate","settingTreadmillSpeed","settingPower3s","settingHighContrast","settingColorblindPatterns","settingVoiceEnabled","settingVoiceLaps","settingVoiceZones","settingExportTcx","settingExportCsv","settingExportJson","settingExportFit","settingDebugMode","debugControls","downloadDebugLogs","installPwaButton","applySettings","toggleMetric","metric","isVisible","saveSettings","updatedProfile","loadSettings","SettingsView","ViewId","NavBar","setupRouter","dashboardView","historyView","workoutsView","settingsView","settingsButton","getTimestring","milliseconds","getWorkoutState","timeState","updateButtonVisibility","initTimerDisplay","timeElement","metricsTable","nextText","currentState","elapsedMs","handler","pausedDuration","workoutCompleteEvent","getValuesAtTimestamps","arr","timestamps","entries","ts","prevIndex","suggestedElem","isAfterLastPoint","prevTime","nextTime","mergeMeasurements","latMeasurements","lonMeasurements","sources","firstTimestamps","timeStep","syncedHR","syncedCadence","syncedPower","syncedSpeed","syncedDistance","syncedAltitude","syncedLat","syncedLon","getCsvString","header","rows","power","cadence","heartrate","speed","distance","altitude","lat","lon","hrString","cadenceString","powerString","getTcxTrackpoint","position","getTcxString","firstTimestamp","lastTimestamp","totalTimeSeconds","FIT_PROTOCOL_VERSION","FIT_PROFILE_VERSION","FIT_MESG_FILE_ID","FIT_MESG_FILE_CREATOR","FIT_MESG_ACTIVITY","FIT_MESG_SESSION","FIT_MESG_LAP","FIT_MESG_RECORD","FIT_MESG_EVENT","FIT_BASE_TYPE_ENUM","FIT_BASE_TYPE_UINT8","FIT_BASE_TYPE_UINT16","FIT_BASE_TYPE_UINT32","FILE_ID_TYPE","FILE_ID_MANUFACTURER","FILE_ID_PRODUCT","FILE_ID_SERIAL_NUMBER","FILE_ID_TIME_CREATED","RECORD_TIMESTAMP","RECORD_HEART_RATE","RECORD_CADENCE","RECORD_POWER","SESSION_TIMESTAMP","SESSION_START_TIME","SESSION_TOTAL_ELAPSED_TIME","SESSION_TOTAL_TIMER_TIME","SESSION_SPORT","SESSION_SUB_SPORT","SESSION_EVENT","SESSION_EVENT_TYPE","LAP_TIMESTAMP","LAP_START_TIME","LAP_TOTAL_ELAPSED_TIME","LAP_TOTAL_TIMER_TIME","LAP_EVENT","LAP_EVENT_TYPE","EVENT_TIMESTAMP","EVENT_EVENT","EVENT_EVENT_TYPE","ACTIVITY_TIMESTAMP","ACTIVITY_TOTAL_TIMER_TIME","ACTIVITY_NUM_SESSIONS","ACTIVITY_TYPE","ACTIVITY_EVENT","ACTIVITY_EVENT_TYPE","ACTIVITY_LOCAL_TIMESTAMP","FILE_TYPE_ACTIVITY","MANUFACTURER_DEVELOPMENT","SPORT_CYCLING","SUB_SPORT_INDOOR_CYCLING","EVENT_TIMER","EVENT_SESSION","EVENT_LAP","EVENT_ACTIVITY","EVENT_TYPE_START","EVENT_TYPE_STOP","ACTIVITY_TYPE_MANUAL","FIT_EPOCH_MS","calculateCrc","end","crcTable","crc","byte","tmp","toFitTimestamp","jsTimestamp","FitBuilder","localMsgType","globalMsgNum","fields","field","dataSize","headerCrc","dataCrc","finalBuffer","getFitData","fit","fitStartTime","fitEndTime","totalElapsedTime","totalElapsedTimeMs","LOCAL_FILE_ID","LOCAL_FILE_CREATOR","LOCAL_EVENT","LOCAL_RECORD","LOCAL_LAP","LOCAL_SESSION","LOCAL_ACTIVITY","fitTimestamp","DEFAULT_UNDO_TIMEOUT","showUndoNotification","onUndo","onExpire","timeout","timeoutSeconds","remainingSeconds","undoButton","countdownSpan","progressFill","prefersReducedMotion","isUndone","countdownInterval","dismissTimeout","dismiss","executeExpire","createWorkoutBackup","restoreWorkoutBackup","backup","VoiceFeedback","voices","timeMs","avgPower","voiceFeedback","initLapButton","lapButton","lapCounter","lapCountElement","updateLapCounter","count","updateLapButtonVisibility","isRecording","handleLapClick","laps","lastLapTime","durationMs","lapPower","elapsedStr","observer","resetLapCounter","PersonalRecordTracker","currentBest","newSummary","records","significantDurations","initMetricsToggle","toggleYour","yourMetricsSection","toggleStream","streamMetricsSection","initDiscardButton","discardButton","resetWorkoutState","totalDataPoints","restoreWorkoutUI","getExportTimestamp","downloadFile","link","initExportButton","exportDataElem","exportData","zoneData","jsonString","tcxString","tcxBlob","csvString","csvBlob","fitData","fitBlob","initWorkoutSummaryModal","getElement","calculatePowerZones","calculateHrZones","getPowerZone","zones","getHrZone","ZoneState","powerZonesDef","hrZonesDef","zoneInfo","currentZone","timeDelta","range","percentInZone","totalTimeMs","DATA_TIMEOUT_MS","UPDATE_INTERVAL_MS","initZoneGauges","powerGauge","hrGauge","powerMetricGroup","hrMetricGroup","initLiveCharts","chartsContainer","metricsSection","initChartsToggle","chartsVisible","toggleBtn","topBarControls","workoutControls","updateZoneDisplays","powerZone","hrZone","applyZoneColorToMetric","_type","parent","zoneColors","initMetricsDisplay","chartsToggle","lastPowerIndex","lastHrIndex","lastPowerZone","lastHrZone","cachedSettings","updateLiveCharts","updateInclineDisplay","inclineDisplay","inclineContainer","validIncline","displayValue","latest","updateMetricDisplay","connectionState","isEnabled","latestMeasurement","metricTypes","createStream","listStreams","addMessage","author","createFetchSSE","onMessage","onConnected","onError","controller","isActive","connection","decoder","done","messages","dataMatch","parseError","listenToStream","listenToAllStreams","sendWorkoutData","workoutData","StreamViewer","toggleViewBtn","grid","viewAllBtn","streamsList","streams","stream","streamItem","div","streamTitle","statusEl","allStreamsStatus","messageData","powerEl","cadenceEl","hrEl","messageStr","lastUpdateEl","heartrateEl","speedEl","distanceEl","altitudeEl","elapsedEl","streamLastUpdate","initStreamViewer","viewer","viewStreamsBtn","initStreamingControls","streamManager","startStreamButton","nameInput","toolbar","toolbarStreamName","playPauseBtn","stopBtn","streamIndicator","updateToolbar","startStreaming","customName","stopStreaming","handleWorkoutPause","DARK_MODE_KEY","getStoredThemePreference","saveThemePreference","preference","systemPrefersDark","applyTheme","theme","getEffectiveTheme","initDarkMode","effectiveTheme","systemDark","setupDarkModeToggle","toggleElement","isDark","newTheme","newPreference","formatElapsedTime","createRecoveryModal","elapsedTime","addRecoveryStyles","style","showRecoveryModal","restoreBtn","discardBtn","cleanup","initWorkoutRecovery","initAboutModal","aboutButton","aboutModal","closeAboutModal","openModal","handleWakeLock","wakeLock","requestWakeLock","registerSW","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","Workbox","registerServiceWorker","registrations","registration","updateSW","showUpdateNotification","updateContainer","initUi","darkModeToggle","recovered","ScanMode","ConnectionPriority","numbersToDataView","dataViewToNumbers","numberToUUID","hexStringToDataView","bin","c","isEmpty","dataViewToHexString","webUUIDToString","uuid","mapToObject","map","obj","toUint8Array","dataView","toHexString","BluetoothLe","makeQueue","currentTask","getQueue","parseUUID","BleClientClass","displayStrings","resultInternal","deviceIds","services","deviceId","onDisconnect","connectionPriority","service","characteristic","writeValue","descriptor","filter","BleClient","parseTreadmillData","flags","hasAverageSpeed","hasTotalDistance","hasInclination","rawSpeed","rawAvgSpeed","b0","b1","b2","rawDist","rawIncline","rawRamp","CYCLING_POWER_SERVICE","CYCLING_POWER_MEASUREMENT","HEART_RATE_SERVICE","HEART_RATE_MEASUREMENT","CYCLING_SPEED_AND_CADENCE_SERVICE","CSC_MEASUREMENT","FITNESS_MACHINE_SERVICE","TREADMILL_DATA_CHARACTERISTIC","MAX_RECONNECT_ATTEMPTS","RECONNECT_BASE_DELAY","isBleInitialized","ensureBleInitialized","connectPowerNative","statusListeners","isManualDisconnect","reconnectAttempts","device","deviceName","notifyStatus","connect","attemptReconnect","delay","disconnectedDeviceId","connectHeartRateNative","heartRate","connectCadenceNative","lastCrankRevs","lastCrankTime","crankRevs","crankTime","revDelta","timeInSeconds","rpm","connectTreadmillNative","ftmsData","connectPowerWeb","handleCharacteristicChange","connectHeartRateWeb","connectCadenceWeb","connectTreadmillWeb","server","BluetoothFactory","connectCadence","connectHeartRate","connectPower","connectTreadmill","BackgroundGeolocation","createNativeGpsService","watcherId","location","createWebGpsService","watchId","GpsFactory","connectGps","sensorLabels","sensorIcons","parseBluetoothError","sensorType","sensorLabel","errorMessage","errorName","createErrorContent","errorInfo","messageEl","troubleshootingEl","titleEl","listEl","suggestion","itemEl","showConnectionError","onRetry","sensorIcon","buttons","showReconnectionFailed","tipsEl","tip","emojis","getSensorLabel","initConnectionButtons","updateButtonText","connectElem","emoji","disconnectFn","displayElem","handleStatusChange","connectFn","gpsConnection","disconnect","onStatusChange","StreamManager","safeName","incline","array","initHardware","initApp"],"ignoreList":[14,15,67,68,69,70,71,72],"sources":["../../src/components/base/BaseComponent.ts","../../src/components/MetricDisplay.ts","../../src/components/PowerGauge.ts","../../src/components/ZoneGauge.ts","../../src/components/LiveChart.ts","../../src/components/WorkoutTimer.ts","../../src/components/Toast.ts","../../src/components/Modal.ts","../../src/storage/workoutStorage.ts","../../src/utils/geo.ts","../../src/config/constants.ts","../../src/measurements-state.ts","../../src/getInitState.ts","../../src/exposeVariablesDuringTest.ts","../../../../node_modules/.pnpm/@capacitor+core@8.0.0/node_modules/@capacitor/core/dist/index.js","../../../../node_modules/.pnpm/@capacitor+app@8.0.0_@capacitor+core@8.0.0/node_modules/@capacitor/app/dist/esm/index.js","../../src/router/Router.ts","../../src/views/DashboardView.ts","../../src/api/workoutClient.ts","../../src/api/userClient.ts","../../src/ui/accessibility.ts","../../src/ui/modal.ts","../../src/ui/workoutHistory.ts","../../src/views/HistoryView.ts","../../src/workouts/workoutLibrary.ts","../../src/ui/notifications.ts","../../src/utils/dom.ts","../../src/ui/onboarding.ts","../../src/ui/audio.ts","../../src/workouts/WorkoutRunner.ts","../../src/storage/customWorkouts.ts","../../src/ui/workoutPlayer.ts","../../src/ui/workoutBuilder.ts","../../src/views/WorkoutsView.ts","../../src/config/settings.ts","../../src/services/debug/BluetoothDebugService.ts","../../src/ui/installPrompt.ts","../../src/ui/settings.ts","../../src/views/SettingsView.ts","../../src/router/view-ids.ts","../../src/components/NavBar.ts","../../src/init/router.ts","../../src/getTimestring.ts","../../src/ui/time.ts","../../src/merge-measurements.ts","../../src/create-csv.ts","../../src/create-tcx.ts","../../src/create-fit.ts","../../src/ui/undoNotification.ts","../../src/services/VoiceFeedback.ts","../../src/ui/lap.ts","../../src/ui/analyticsHelper.ts","../../src/types/settings.ts","../../src/ui/menu.ts","../../src/elements.ts","../../src/zone-state.ts","../../src/initMetricsDisplay.ts","../../src/api/streamClient.ts","../../src/ui/streamViewer.ts","../../src/initStreamingControls.ts","../../src/ui/darkMode.ts","../../src/ui/workoutRecovery.ts","../../src/ui/about.ts","../../src/ui/wakeLock.ts","../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/ui/serviceWorker.ts","../../src/init/ui.ts","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/definitions.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/plugin.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/queue.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/validators.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/bleClient.js","../../src/services/bluetooth/ftms.ts","../../src/services/bluetooth/native-bluetooth.ts","../../src/services/bluetooth/web-bluetooth.ts","../../src/services/bluetooth/factory.ts","../../src/connect-cadence.ts","../../src/connect-heartrate.ts","../../src/connect-power.ts","../../src/connect-treadmill.ts","../../src/services/gps/native-gps.ts","../../src/services/gps/web-gps.ts","../../src/services/gps/factory.ts","../../src/connect-gps.ts","../../src/ui/connectionError.ts","../../src/initConnectionButtons.ts","../../src/stream-manager.ts","../../src/init/hardware.ts","../../src/main.ts"],"sourcesContent":["/**\n * Base Component\n * \n * Abstract base class for all Web Components in the application.\n * Provides common functionality like shadow DOM, theming, and lifecycle hooks.\n * \n * @module BaseComponent\n */\n\n/**\n * Base class for all custom elements\n */\nexport abstract class BaseComponent extends HTMLElement {\n    protected shadow: ShadowRoot;\n    private _initialized = false;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    /**\n     * Called when the element is added to the DOM\n     */\n    connectedCallback(): void {\n        if (!this._initialized) {\n            this.render();\n            this.setupEventListeners();\n            this._initialized = true;\n        }\n        this.onConnected();\n    }\n\n    /**\n     * Called when the element is removed from the DOM\n     */\n    disconnectedCallback(): void {\n        this.onDisconnected();\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue !== newValue && this._initialized) {\n            this.onAttributeChanged(name, oldValue, newValue);\n        }\n    }\n\n    /**\n     * Get base styles that apply to all components\n     */\n    protected getBaseStyles(): string {\n        return `\n            :host {\n                display: block;\n                box-sizing: border-box;\n            }\n            \n            :host([hidden]) {\n                display: none;\n            }\n            \n            *,\n            *::before,\n            *::after {\n                box-sizing: inherit;\n            }\n            \n            /* Respect reduced motion preferences */\n            @media (prefers-reduced-motion: reduce) {\n                *,\n                *::before,\n                *::after {\n                    animation-duration: 0.01ms !important;\n                    animation-iteration-count: 1 !important;\n                    transition-duration: 0.01ms !important;\n                }\n            }\n        `;\n    }\n\n    /**\n     * Get the component's styles - override in subclasses\n     */\n    protected abstract getStyles(): string;\n\n    /**\n     * Get the component's template - override in subclasses\n     */\n    protected abstract getTemplate(): string;\n\n    /**\n     * Render the component\n     */\n    protected render(): void {\n        this.shadow.innerHTML = `\n            <style>\n                ${this.getBaseStyles()}\n                ${this.getStyles()}\n            </style>\n            ${this.getTemplate()}\n        `;\n    }\n\n    /**\n     * Set up event listeners - override in subclasses\n     */\n    protected setupEventListeners(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called after the component is connected to the DOM\n     */\n    protected onConnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when the component is disconnected from the DOM\n     */\n    protected onDisconnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Emit a custom event\n     */\n    protected emit<T>(eventName: string, detail?: T): void {\n        this.dispatchEvent(new CustomEvent(eventName, {\n            detail,\n            bubbles: true,\n            composed: true, // Allows event to cross shadow DOM boundary\n        }));\n    }\n\n    /**\n     * Query an element in the shadow DOM\n     */\n    protected query<T extends Element>(selector: string): T | null {\n        return this.shadow.querySelector<T>(selector);\n    }\n\n    /**\n     * Query all elements in the shadow DOM\n     */\n    protected queryAll<T extends Element>(selector: string): NodeListOf<T> {\n        return this.shadow.querySelectorAll<T>(selector);\n    }\n}\n","/**\n * Metric Display Component\n * \n * A Web Component for displaying a single workout metric (power, heart rate, cadence).\n * Supports theming, zones, and real-time updates.\n * \n * @example\n * ```html\n * <bpt-metric-display\n *   label=\"Power\"\n *   value=\"250\"\n *   unit=\"W\"\n *   icon=\"\"\n *   zone=\"4\"\n *   zone-name=\"Threshold\">\n * </bpt-metric-display>\n * ```\n * \n * @module MetricDisplay\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Zone color mapping for power/HR zones\n */\nconst ZONE_COLORS: Record<string, { bg: string; text: string; border: string }> = {\n    '1': { bg: 'rgba(74, 144, 226, 0.15)', text: '#2563eb', border: '#3b82f6' },\n    '2': { bg: 'rgba(34, 197, 94, 0.15)', text: '#16a34a', border: '#22c55e' },\n    '3': { bg: 'rgba(234, 179, 8, 0.15)', text: '#ca8a04', border: '#eab308' },\n    '4': { bg: 'rgba(249, 115, 22, 0.15)', text: '#ea580c', border: '#f97316' },\n    '5': { bg: 'rgba(239, 68, 68, 0.15)', text: '#dc2626', border: '#ef4444' },\n    '6': { bg: 'rgba(168, 85, 247, 0.15)', text: '#9333ea', border: '#a855f7' },\n    '7': { bg: 'rgba(236, 72, 153, 0.15)', text: '#db2777', border: '#ec4899' },\n};\n\n/**\n * Metric Display Web Component\n */\nexport class MetricDisplay extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['label', 'value', 'unit', 'icon', 'zone', 'zone-name', 'connected', 'show-avg'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: 8px;\n                transition: background-color 0.3s ease, border-color 0.3s ease;\n                border-radius: 8px;\n                min-width: 100px;\n            }\n            \n            :host([zone]) {\n                border-left: 4px solid var(--zone-border-color, transparent);\n            }\n            \n            .label {\n                font-size: clamp(12px, 3cqh, 16px);\n                color: var(--color-text-secondary, #656d76);\n                margin-bottom: 4px;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            \n            .icon {\n                font-size: 1.1em;\n            }\n            \n            .value-container {\n                display: flex;\n                align-items: baseline;\n                gap: 4px;\n            }\n            \n            .value {\n                font-size: clamp(32px, 16cqh, 72px);\n                font-weight: bold;\n                color: var(--zone-text-color, var(--color-text-primary, #1f2328));\n                line-height: 1;\n                transition: color 0.3s ease;\n            }\n            \n            .value.disconnected {\n                color: var(--color-text-muted, #8b949e);\n            }\n            \n            .unit {\n                font-size: clamp(12px, 4cqh, 18px);\n                color: var(--color-text-secondary, #656d76);\n            }\n            \n            .avg-indicator {\n                font-size: clamp(8px, 2cqh, 12px);\n                color: var(--color-text-muted, #8b949e);\n                vertical-align: super;\n            }\n            \n            .zone-badge {\n                font-size: clamp(10px, 2.5cqh, 14px);\n                padding: 2px 8px;\n                border-radius: 12px;\n                margin-top: 4px;\n                background-color: var(--zone-bg-color, transparent);\n                color: var(--zone-text-color, var(--color-text-secondary, #656d76));\n                font-weight: 500;\n                opacity: 0;\n                transform: translateY(-4px);\n                transition: opacity 0.2s ease, transform 0.2s ease;\n            }\n            \n            :host([zone]) .zone-badge {\n                opacity: 1;\n                transform: translateY(0);\n            }\n            \n            /* High contrast mode support */\n            :host-context([data-high-contrast=\"true\"]) .value {\n                text-decoration: underline;\n                text-decoration-style: dotted;\n                text-underline-offset: 4px;\n            }\n            \n            :host-context([data-high-contrast=\"true\"]) {\n                border-width: 3px;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const label = this.getAttribute('label') || '';\n        const value = this.getAttribute('value') || '--';\n        const unit = this.getAttribute('unit') || '';\n        const icon = this.getAttribute('icon') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const showAvg = this.hasAttribute('show-avg');\n        const connected = this.getAttribute('connected') !== 'false';\n\n        return `\n            <div class=\"label\">\n                ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                <span>${label}</span>\n            </div>\n            <div class=\"value-container\">\n                <span class=\"value ${!connected ? 'disconnected' : ''}\" \n                      aria-live=\"polite\" \n                      aria-label=\"${label}: ${value} ${unit}\">\n                    ${value}${showAvg ? '<span class=\"avg-indicator\">(3s)</span>' : ''}\n                </span>\n                ${unit ? `<span class=\"unit\">${unit}</span>` : ''}\n            </div>\n            <div class=\"zone-badge\" aria-live=\"polite\">\n                ${zoneName ? `Zone: ${zoneName}` : ''}\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'zone') {\n            this.updateZoneStyles(newValue);\n        }\n        // Re-render on any attribute change\n        this.render();\n    }\n\n    /**\n     * Update zone-specific styles\n     */\n    private updateZoneStyles(zone: string | null): void {\n        if (zone && ZONE_COLORS[zone]) {\n            const colors = ZONE_COLORS[zone];\n            this.style.setProperty('--zone-bg-color', colors.bg);\n            this.style.setProperty('--zone-text-color', colors.text);\n            this.style.setProperty('--zone-border-color', colors.border);\n            this.style.backgroundColor = colors.bg;\n        } else {\n            this.style.removeProperty('--zone-bg-color');\n            this.style.removeProperty('--zone-text-color');\n            this.style.removeProperty('--zone-border-color');\n            this.style.backgroundColor = '';\n        }\n    }\n\n    /**\n     * Update the displayed value\n     */\n    public setValue(value: number | string): void {\n        this.setAttribute('value', String(value));\n    }\n\n    /**\n     * Update the zone\n     */\n    public setZone(zone: number | null, zoneName?: string): void {\n        if (zone !== null) {\n            this.setAttribute('zone', String(zone));\n            if (zoneName) {\n                this.setAttribute('zone-name', zoneName);\n            }\n        } else {\n            this.removeAttribute('zone');\n            this.removeAttribute('zone-name');\n        }\n    }\n\n    /**\n     * Set connected state\n     */\n    public setConnected(connected: boolean): void {\n        this.setAttribute('connected', String(connected));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-metric-display', MetricDisplay);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-metric-display': MetricDisplay;\n    }\n}\n","/**\n * Power Gauge Component\n * \n * A circular gauge Web Component for displaying power output with zone visualization.\n * Shows current power, target zone, and provides visual feedback.\n * \n * @example\n * ```html\n * <bpt-power-gauge\n *   value=\"250\"\n *   ftp=\"280\"\n *   max=\"500\"\n *   show-zones=\"true\">\n * </bpt-power-gauge>\n * ```\n * \n * @module PowerGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Power zone definitions (Coggan 7-zone model)\n */\nconst POWER_ZONES = [\n    { name: 'Recovery', min: 0, max: 0.55, color: '#4a90d9' },\n    { name: 'Endurance', min: 0.55, max: 0.75, color: '#22c55e' },\n    { name: 'Tempo', min: 0.75, max: 0.90, color: '#eab308' },\n    { name: 'Threshold', min: 0.90, max: 1.05, color: '#f97316' },\n    { name: 'VO2max', min: 1.05, max: 1.20, color: '#ef4444' },\n    { name: 'Anaerobic', min: 1.20, max: 1.50, color: '#a855f7' },\n    { name: 'Neuromuscular', min: 1.50, max: 2.0, color: '#ec4899' },\n];\n\n/**\n * Power Gauge Web Component\n */\nexport class PowerGauge extends BaseComponent {\n    private animationFrame: number | null = null;\n    private currentDisplayValue = 0;\n\n    static get observedAttributes(): string[] {\n        return ['value', 'ftp', 'max', 'show-zones', 'size'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                --gauge-size: 200px;\n            }\n            \n            .gauge-container {\n                position: relative;\n                width: var(--gauge-size);\n                height: var(--gauge-size);\n            }\n            \n            .gauge-svg {\n                width: 100%;\n                height: 100%;\n                transform: rotate(-135deg);\n            }\n            \n            .gauge-background {\n                fill: none;\n                stroke: var(--color-bg-tertiary, #f0f0f0);\n                stroke-width: 12;\n                stroke-linecap: round;\n            }\n            \n            .gauge-zone {\n                fill: none;\n                stroke-width: 12;\n                stroke-linecap: round;\n                opacity: 0.3;\n                transition: opacity 0.3s ease;\n            }\n            \n            .gauge-zone.active {\n                opacity: 1;\n            }\n            \n            .gauge-value-arc {\n                fill: none;\n                stroke: var(--gauge-color, #2196F3);\n                stroke-width: 14;\n                stroke-linecap: round;\n                transition: stroke 0.3s ease;\n            }\n            \n            .gauge-center {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                text-align: center;\n            }\n            \n            .gauge-value {\n                font-size: calc(var(--gauge-size) * 0.2);\n                font-weight: bold;\n                color: var(--gauge-color, var(--color-text-primary, #1f2328));\n                line-height: 1;\n                transition: color 0.3s ease;\n            }\n            \n            .gauge-unit {\n                font-size: calc(var(--gauge-size) * 0.08);\n                color: var(--color-text-secondary, #656d76);\n            }\n            \n            .gauge-zone-label {\n                font-size: calc(var(--gauge-size) * 0.07);\n                color: var(--gauge-color, var(--color-text-secondary, #656d76));\n                margin-top: 4px;\n                font-weight: 500;\n                transition: color 0.3s ease;\n            }\n            \n            .gauge-ftp {\n                font-size: calc(var(--gauge-size) * 0.06);\n                color: var(--color-text-muted, #8b949e);\n                margin-top: 2px;\n            }\n            \n            /* Animation */\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n            \n            .gauge-value-arc.high-power {\n                animation: pulse 0.5s ease-in-out infinite;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const size = parseInt(this.getAttribute('size') || '200', 10);\n        this.style.setProperty('--gauge-size', `${size}px`);\n\n        const value = parseInt(this.getAttribute('value') || '0', 10);\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n        const showZones = this.getAttribute('show-zones') !== 'false';\n\n        const radius = 80;\n        const circumference = 2 * Math.PI * radius;\n        const arcLength = circumference * 0.75; // 270 degrees\n\n        // Calculate the current zone and color\n        const ftpPercent = ftp > 0 ? value / ftp : 0;\n        const zone = this.getZone(ftpPercent);\n        const zoneColor = zone ? zone.color : '#2196F3';\n\n        // Calculate arc progress\n        const progress = Math.min(value / max, 1);\n        const dashOffset = arcLength * (1 - progress);\n\n        return `\n            <div class=\"gauge-container\">\n                <svg class=\"gauge-svg\" viewBox=\"0 0 200 200\">\n                    <!-- Background arc -->\n                    <circle \n                        class=\"gauge-background\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                    />\n                    \n                    ${showZones ? this.renderZoneArcs(radius, arcLength, circumference, ftpPercent) : ''}\n                    \n                    <!-- Value arc -->\n                    <circle \n                        class=\"gauge-value-arc ${ftpPercent > 1.2 ? 'high-power' : ''}\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                        stroke-dashoffset=\"${dashOffset}\"\n                        style=\"stroke: ${zoneColor}\"\n                    />\n                </svg>\n                \n                <div class=\"gauge-center\">\n                    <div class=\"gauge-value\" style=\"color: ${zoneColor}\">${value}</div>\n                    <div class=\"gauge-unit\">watts</div>\n                    ${zone ? `<div class=\"gauge-zone-label\" style=\"color: ${zoneColor}\">${zone.name}</div>` : ''}\n                    ${ftp > 0 ? `<div class=\"gauge-ftp\">FTP: ${ftp}W</div>` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Render zone arcs on the gauge\n     */\n    private renderZoneArcs(radius: number, arcLength: number, circumference: number, currentFtpPercent: number): string {\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n\n        if (ftp <= 0) return '';\n\n        return POWER_ZONES.map((zone, index) => {\n            const startPercent = (zone.min * ftp) / max;\n            const endPercent = Math.min((zone.max * ftp) / max, 1);\n            const zoneArcLength = (endPercent - startPercent) * arcLength;\n            const offset = arcLength * (1 - endPercent);\n\n            const isActive = currentFtpPercent >= zone.min && currentFtpPercent < zone.max;\n\n            return `\n                <circle \n                    class=\"gauge-zone ${isActive ? 'active' : ''}\"\n                    cx=\"100\" cy=\"100\" r=\"${radius}\"\n                    stroke=\"${zone.color}\"\n                    stroke-dasharray=\"${zoneArcLength} ${circumference}\"\n                    stroke-dashoffset=\"${offset}\"\n                    data-zone=\"${index + 1}\"\n                />\n            `;\n        }).join('');\n    }\n\n    /**\n     * Get the current zone based on FTP percentage\n     */\n    private getZone(ftpPercent: number): typeof POWER_ZONES[0] | null {\n        for (const zone of POWER_ZONES) {\n            if (ftpPercent >= zone.min && ftpPercent < zone.max) {\n                return zone;\n            }\n        }\n        // Above all zones\n        if (ftpPercent >= POWER_ZONES[POWER_ZONES.length - 1].max) {\n            return POWER_ZONES[POWER_ZONES.length - 1];\n        }\n        return null;\n    }\n\n    protected onAttributeChanged(): void {\n        this.render();\n    }\n\n    protected onDisconnected(): void {\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n    }\n\n    /**\n     * Animate value change\n     */\n    public animateToValue(targetValue: number, duration = 300): void {\n        const startValue = this.currentDisplayValue;\n        const startTime = performance.now();\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n\n            // Ease out cubic\n            const eased = 1 - Math.pow(1 - progress, 3);\n            const currentValue = Math.round(startValue + (targetValue - startValue) * eased);\n\n            this.currentDisplayValue = currentValue;\n            this.setAttribute('value', String(currentValue));\n\n            if (progress < 1) {\n                this.animationFrame = requestAnimationFrame(animate);\n            }\n        };\n\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n        this.animationFrame = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Set the current power value\n     */\n    public setValue(value: number, animate = false): void {\n        if (animate) {\n            this.animateToValue(value);\n        } else {\n            this.currentDisplayValue = value;\n            this.setAttribute('value', String(value));\n        }\n    }\n\n    /**\n     * Set FTP for zone calculations\n     */\n    public setFTP(ftp: number): void {\n        this.setAttribute('ftp', String(ftp));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-power-gauge', PowerGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-power-gauge': PowerGauge;\n    }\n}\n","/**\n * Zone Gauge Component\n * \n * A Web Component for displaying a zone progress bar/gauge.\n * Shows position within current zone with color coding.\n * \n * @example\n * ```html\n * <bpt-zone-gauge\n *   zone=\"4\"\n *   zone-name=\"Threshold\"\n *   percent=\"65\"\n *   type=\"power\">\n * </bpt-zone-gauge>\n * ```\n * \n * @module ZoneGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Zone color mapping (matches MetricDisplay)\n */\nconst ZONE_COLORS: Record<string, { bg: string; fill: string; text: string }> = {\n    '1': { bg: 'rgba(74, 144, 226, 0.15)', fill: '#3b82f6', text: '#2563eb' },\n    '2': { bg: 'rgba(34, 197, 94, 0.15)', fill: '#22c55e', text: '#16a34a' },\n    '3': { bg: 'rgba(234, 179, 8, 0.15)', fill: '#eab308', text: '#ca8a04' },\n    '4': { bg: 'rgba(249, 115, 22, 0.15)', fill: '#f97316', text: '#ea580c' },\n    '5': { bg: 'rgba(239, 68, 68, 0.15)', fill: '#ef4444', text: '#dc2626' },\n    '6': { bg: 'rgba(168, 85, 247, 0.15)', fill: '#a855f7', text: '#9333ea' },\n    '7': { bg: 'rgba(236, 72, 153, 0.15)', fill: '#ec4899', text: '#db2777' },\n};\n\n/**\n * Zone Gauge Web Component\n */\nexport class ZoneGauge extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['zone', 'zone-name', 'percent', 'type', 'compact'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                padding: 8px;\n                border-radius: 8px;\n                background: var(--zone-bg-color, var(--color-bg-secondary, #f6f8fa));\n                transition: background-color 0.3s ease;\n                min-width: 80px;\n            }\n\n            :host([compact]) {\n                padding: 4px 8px;\n                min-width: 60px;\n            }\n\n            .zone-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n            }\n\n            .zone-number {\n                font-size: 12px;\n                font-weight: 700;\n                color: var(--zone-text-color, var(--color-text-primary, #1f2328));\n                background: var(--zone-fill-color, #d0d7de);\n                padding: 2px 8px;\n                border-radius: 10px;\n                white-space: nowrap;\n            }\n\n            :host([compact]) .zone-number {\n                font-size: 10px;\n                padding: 1px 6px;\n            }\n\n            .zone-name {\n                font-size: 11px;\n                color: var(--zone-text-color, var(--color-text-secondary, #656d76));\n                font-weight: 500;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n\n            :host([compact]) .zone-name {\n                display: none;\n            }\n\n            .gauge-container {\n                height: 8px;\n                background: var(--color-bg-tertiary, #e1e4e8);\n                border-radius: 4px;\n                overflow: hidden;\n                position: relative;\n            }\n\n            :host([compact]) .gauge-container {\n                height: 6px;\n            }\n\n            .gauge-fill {\n                height: 100%;\n                background: var(--zone-fill-color, #3b82f6);\n                border-radius: 4px;\n                transition: width 0.3s ease, background-color 0.3s ease;\n                min-width: 4px;\n            }\n\n            .gauge-markers {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                display: flex;\n                justify-content: space-between;\n                padding: 0 2px;\n                pointer-events: none;\n            }\n\n            .gauge-marker {\n                width: 1px;\n                height: 100%;\n                background: rgba(255, 255, 255, 0.3);\n            }\n\n            /* High contrast mode */\n            :host-context([data-high-contrast=\"true\"]) .gauge-fill {\n                background-image: repeating-linear-gradient(\n                    45deg,\n                    transparent,\n                    transparent 2px,\n                    rgba(255,255,255,0.2) 2px,\n                    rgba(255,255,255,0.2) 4px\n                );\n            }\n\n            /* Hidden state */\n            :host([hidden]) {\n                display: none;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const zone = this.getAttribute('zone') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const percent = parseFloat(this.getAttribute('percent') || '0');\n\n        return `\n            <div class=\"zone-header\">\n                <span class=\"zone-number\" aria-label=\"Zone ${zone}\">Z${zone}</span>\n                <span class=\"zone-name\">${zoneName}</span>\n            </div>\n            <div class=\"gauge-container\" role=\"progressbar\" aria-valuenow=\"${percent}\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-label=\"${zoneName} zone progress\">\n                <div class=\"gauge-fill\" style=\"width: ${Math.max(4, percent)}%\"></div>\n                <div class=\"gauge-markers\">\n                    <span class=\"gauge-marker\"></span>\n                    <span class=\"gauge-marker\"></span>\n                    <span class=\"gauge-marker\"></span>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'zone') {\n            this.updateZoneStyles(newValue);\n        }\n        if (name === 'percent') {\n            this.updateGaugeFill(parseFloat(newValue || '0'));\n        }\n        // Re-render on zone or zone-name change\n        if (name === 'zone' || name === 'zone-name') {\n            this.render();\n        }\n    }\n\n    /**\n     * Update zone-specific styles\n     */\n    private updateZoneStyles(zone: string | null): void {\n        if (zone && ZONE_COLORS[zone]) {\n            const colors = ZONE_COLORS[zone];\n            this.style.setProperty('--zone-bg-color', colors.bg);\n            this.style.setProperty('--zone-fill-color', colors.fill);\n            this.style.setProperty('--zone-text-color', colors.text);\n        } else {\n            this.style.removeProperty('--zone-bg-color');\n            this.style.removeProperty('--zone-fill-color');\n            this.style.removeProperty('--zone-text-color');\n        }\n    }\n\n    /**\n     * Update gauge fill without full re-render\n     */\n    private updateGaugeFill(percent: number): void {\n        const fill = this.shadow.querySelector('.gauge-fill') as HTMLElement;\n        const container = this.shadow.querySelector('.gauge-container') as HTMLElement;\n        if (fill) {\n            fill.style.width = `${Math.max(4, percent)}%`;\n        }\n        if (container) {\n            container.setAttribute('aria-valuenow', String(percent));\n        }\n    }\n\n    /**\n     * Set zone information\n     */\n    public setZone(zone: number, name: string, percent: number): void {\n        this.setAttribute('zone', String(zone));\n        this.setAttribute('zone-name', name);\n        this.setAttribute('percent', String(Math.round(percent)));\n        this.updateZoneStyles(String(zone));\n    }\n\n    /**\n     * Clear/hide the gauge\n     */\n    public clear(): void {\n        this.removeAttribute('zone');\n        this.removeAttribute('zone-name');\n        this.setAttribute('percent', '0');\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-zone-gauge', ZoneGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-zone-gauge': ZoneGauge;\n    }\n}\n","/**\n * Live Chart Component\n *\n * A Web Component for displaying real-time rolling charts of workout metrics.\n * Uses SVG for rendering and requestAnimationFrame for smooth 60fps updates.\n * Optimized for mobile performance with minimal DOM operations.\n *\n * @example\n * ```html\n * <bpt-live-chart\n *   type=\"power\"\n *   duration=\"60\"\n *   max-value=\"400\">\n * </bpt-live-chart>\n * ```\n *\n * @module LiveChart\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Data point for the chart\n */\ninterface DataPoint {\n    timestamp: number;\n    value: number;\n}\n\n/**\n * Chart configuration by type\n */\nconst CHART_CONFIG: Record<\n    string,\n    { color: string; gradientStart: string; gradientEnd: string; label: string; unit: string; defaultMax: number }\n> = {\n    power: {\n        color: '#f97316',\n        gradientStart: 'rgba(249, 115, 22, 0.4)',\n        gradientEnd: 'rgba(249, 115, 22, 0.05)',\n        label: 'Power',\n        unit: 'W',\n        defaultMax: 400,\n    },\n    heartrate: {\n        color: '#ef4444',\n        gradientStart: 'rgba(239, 68, 68, 0.4)',\n        gradientEnd: 'rgba(239, 68, 68, 0.05)',\n        label: 'Heart Rate',\n        unit: 'bpm',\n        defaultMax: 200,\n    },\n};\n\n/**\n * Live Chart Web Component\n */\nexport class LiveChart extends BaseComponent {\n    private _data: DataPoint[] = [];\n    private _animationId: number | null = null;\n    private _lastRenderTime = 0;\n    private _isVisible = true;\n    private _duration = 60; // seconds\n    private _maxValue: number;\n    private _type: string;\n    private _svgPath: SVGPathElement | null = null;\n    private _svgArea: SVGPathElement | null = null;\n    private _currentValueEl: HTMLElement | null = null;\n    private _avgValueEl: HTMLElement | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['type', 'duration', 'max-value', 'hidden'];\n    }\n\n    constructor() {\n        super();\n        this._type = 'power';\n        this._maxValue = CHART_CONFIG.power.defaultMax;\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                background: var(--color-bg-secondary, #f6f8fa);\n                border-radius: 8px;\n                overflow: hidden;\n                contain: layout style paint;\n            }\n\n            :host([hidden]) {\n                display: none;\n            }\n\n            .chart-container {\n                position: relative;\n                width: 100%;\n                height: 120px;\n                padding: 8px;\n            }\n\n            .chart-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 0 4px 4px 4px;\n                font-size: 11px;\n                color: var(--color-text-secondary, #656d76);\n            }\n\n            .chart-label {\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .chart-values {\n                display: flex;\n                gap: 12px;\n            }\n\n            .chart-value {\n                display: flex;\n                align-items: baseline;\n                gap: 2px;\n            }\n\n            .chart-value-number {\n                font-size: 14px;\n                font-weight: 700;\n                color: var(--chart-color, #f97316);\n            }\n\n            .chart-value-label {\n                font-size: 10px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            .chart-svg-container {\n                position: relative;\n                width: 100%;\n                height: 80px;\n            }\n\n            svg {\n                width: 100%;\n                height: 100%;\n                display: block;\n            }\n\n            .chart-line {\n                fill: none;\n                stroke: var(--chart-color, #f97316);\n                stroke-width: 2;\n                stroke-linecap: round;\n                stroke-linejoin: round;\n                vector-effect: non-scaling-stroke;\n            }\n\n            .chart-area {\n                fill: url(#chartGradient);\n                opacity: 0.8;\n            }\n\n            .chart-grid-line {\n                stroke: var(--color-border, #d0d7de);\n                stroke-width: 1;\n                stroke-dasharray: 4 4;\n                opacity: 0.5;\n            }\n\n            .chart-axis-label {\n                font-size: 9px;\n                fill: var(--color-text-muted, #8b949e);\n            }\n\n            .no-data-message {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 12px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .chart-line,\n                .chart-area {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n\n        return `\n            <div class=\"chart-container\">\n                <div class=\"chart-header\">\n                    <span class=\"chart-label\">\n                        <span>${config.label}</span>\n                        <span style=\"font-weight: normal; font-size: 10px;\">(${this._duration}s)</span>\n                    </span>\n                    <div class=\"chart-values\">\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"currentValue\">--</span>\n                            <span class=\"chart-value-label\">${config.unit}</span>\n                        </div>\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"avgValue\" style=\"opacity: 0.7;\">--</span>\n                            <span class=\"chart-value-label\">avg</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chart-svg-container\">\n                    <svg viewBox=\"0 0 300 80\" preserveAspectRatio=\"none\" aria-hidden=\"true\">\n                        <defs>\n                            <linearGradient id=\"chartGradient-${this._type}\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" stop-color=\"${config.gradientStart}\" />\n                                <stop offset=\"100%\" stop-color=\"${config.gradientEnd}\" />\n                            </linearGradient>\n                        </defs>\n                        <!-- Grid lines -->\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"20\" x2=\"300\" y2=\"20\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"40\" x2=\"300\" y2=\"40\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"60\" x2=\"300\" y2=\"60\" />\n                        <!-- Axis labels -->\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"18\">${this._maxValue}</text>\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"78\">0</text>\n                        <!-- Chart paths -->\n                        <path class=\"chart-area\" id=\"chartArea\" d=\"M0,80 L300,80\" style=\"fill: url(#chartGradient-${this._type});\" />\n                        <path class=\"chart-line\" id=\"chartLine\" d=\"\" style=\"stroke: ${config.color};\" />\n                    </svg>\n                    <div class=\"no-data-message\" id=\"noDataMessage\">Waiting for data...</div>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onConnected(): void {\n        // Cache DOM references\n        this._svgPath = this.shadow.getElementById('chartLine') as SVGPathElement | null;\n        this._svgArea = this.shadow.getElementById('chartArea') as SVGPathElement | null;\n        this._currentValueEl = this.shadow.getElementById('currentValue');\n        this._avgValueEl = this.shadow.getElementById('avgValue');\n\n        // Set CSS variable for chart color\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n        this.style.setProperty('--chart-color', config.color);\n\n        // Start animation loop\n        this.startAnimation();\n\n        // Listen for visibility changes to save battery\n        document.addEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onDisconnected(): void {\n        this.stopAnimation();\n        document.removeEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        switch (name) {\n            case 'type':\n                this._type = newValue || 'power';\n                this._maxValue = CHART_CONFIG[this._type]?.defaultMax || 400;\n                this.render();\n                this.onConnected(); // Re-cache DOM refs\n                break;\n            case 'duration':\n                this._duration = parseInt(newValue || '60', 10);\n                this.render();\n                break;\n            case 'max-value':\n                this._maxValue = parseInt(newValue || '400', 10);\n                this.render();\n                break;\n            case 'hidden':\n                this._isVisible = newValue === null;\n                if (this._isVisible) {\n                    this.startAnimation();\n                } else {\n                    this.stopAnimation();\n                }\n                break;\n        }\n    }\n\n    private handleVisibilityChange = (): void => {\n        if (document.hidden) {\n            this.stopAnimation();\n        } else if (this._isVisible) {\n            this.startAnimation();\n        }\n    };\n\n    /**\n     * Add a data point to the chart\n     */\n    public addDataPoint(value: number, timestamp: number = Date.now()): void {\n        this._data.push({ timestamp, value });\n\n        // Remove old data points (keep duration + 5s buffer)\n        const cutoffTime = timestamp - (this._duration + 5) * 1000;\n        while (this._data.length > 0 && this._data[0].timestamp < cutoffTime) {\n            this._data.shift();\n        }\n\n        // Auto-adjust max value if needed\n        if (value > this._maxValue * 0.9) {\n            this._maxValue = Math.ceil(value * 1.2 / 50) * 50; // Round to nearest 50\n        }\n    }\n\n    /**\n     * Clear all data points\n     */\n    public clear(): void {\n        this._data = [];\n        this.renderChart();\n    }\n\n    /**\n     * Start the animation loop\n     */\n    private startAnimation(): void {\n        if (this._animationId !== null) return;\n\n        const animate = (time: number): void => {\n            // Throttle to ~30fps for better performance\n            if (time - this._lastRenderTime >= 33) {\n                this.renderChart();\n                this._lastRenderTime = time;\n            }\n            this._animationId = requestAnimationFrame(animate);\n        };\n\n        this._animationId = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Stop the animation loop\n     */\n    private stopAnimation(): void {\n        if (this._animationId !== null) {\n            cancelAnimationFrame(this._animationId);\n            this._animationId = null;\n        }\n    }\n\n    /**\n     * Render the chart paths\n     */\n    private renderChart(): void {\n        if (!this._svgPath || !this._svgArea) return;\n\n        const now = Date.now();\n        const startTime = now - this._duration * 1000;\n\n        // Filter data to visible range\n        const visibleData = this._data.filter((d) => d.timestamp >= startTime);\n\n        // Update no-data message\n        const noDataMsg = this.shadow.getElementById('noDataMessage');\n        if (noDataMsg) {\n            noDataMsg.style.display = visibleData.length === 0 ? 'block' : 'none';\n        }\n\n        if (visibleData.length === 0) {\n            this._svgPath.setAttribute('d', '');\n            this._svgArea.setAttribute('d', 'M0,80 L300,80');\n            return;\n        }\n\n        // Calculate path\n        const width = 300;\n        const height = 80;\n        const points: string[] = [];\n        const areaPoints: string[] = [];\n\n        visibleData.forEach((point) => {\n            const x = ((point.timestamp - startTime) / (this._duration * 1000)) * width;\n            const y = height - (Math.min(point.value, this._maxValue) / this._maxValue) * height;\n            points.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n            areaPoints.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n        });\n\n        // Build path strings\n        if (points.length > 0) {\n            const linePath = 'M' + points.join(' L');\n            this._svgPath.setAttribute('d', linePath);\n\n            // Area path: line + close to bottom\n            const firstX = ((visibleData[0].timestamp - startTime) / (this._duration * 1000)) * width;\n            const lastX =\n                ((visibleData[visibleData.length - 1].timestamp - startTime) / (this._duration * 1000)) * width;\n            const areaPath = `M${firstX.toFixed(1)},${height} L` + areaPoints.join(' L') + ` L${lastX.toFixed(1)},${height} Z`;\n            this._svgArea.setAttribute('d', areaPath);\n        }\n\n        // Update current and average values\n        if (this._currentValueEl && visibleData.length > 0) {\n            const currentValue = visibleData[visibleData.length - 1].value;\n            this._currentValueEl.textContent = Math.round(currentValue).toString();\n        }\n\n        if (this._avgValueEl && visibleData.length > 0) {\n            const avg = visibleData.reduce((sum, p) => sum + p.value, 0) / visibleData.length;\n            this._avgValueEl.textContent = Math.round(avg).toString();\n        }\n    }\n\n    /**\n     * Get current data for debugging/testing\n     */\n    public getData(): DataPoint[] {\n        return [...this._data];\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-live-chart', LiveChart);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-live-chart': LiveChart;\n    }\n}\n","/**\n * Workout Timer Component\n * \n * A Web Component for displaying workout elapsed time.\n * Supports different states: idle, recording, paused.\n * \n * @example\n * ```html\n * <bpt-workout-timer\n *   elapsed=\"3661\"\n *   state=\"recording\">\n * </bpt-workout-timer>\n * ```\n * \n * @module WorkoutTimer\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Workout state enum\n */\nexport type WorkoutTimerState = 'idle' | 'recording' | 'paused';\n\n/**\n * Workout Timer Web Component\n */\nexport class WorkoutTimer extends BaseComponent {\n    private intervalId: number | null = null;\n    private startTimestamp = 0;\n    private pausedElapsed = 0;\n\n    static get observedAttributes(): string[] {\n        return ['elapsed', 'state', 'show-milliseconds'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;\n            }\n            \n            .timer {\n                font-size: clamp(20px, 5vw, 32px);\n                font-weight: 600;\n                color: var(--color-text-primary, #1f2328);\n                letter-spacing: 0.5px;\n                transition: color 0.3s ease;\n            }\n            \n            :host([state=\"recording\"]) .timer {\n                color: var(--color-success, #15803d);\n            }\n            \n            :host([state=\"paused\"]) .timer {\n                color: var(--color-warning, #a16207);\n                animation: blink 1s ease-in-out infinite;\n            }\n            \n            :host([state=\"idle\"]) .timer {\n                color: var(--color-text-muted, #8b949e);\n            }\n            \n            .milliseconds {\n                font-size: 0.5em;\n                opacity: 0.7;\n            }\n            \n            @keyframes blink {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.5; }\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host([state=\"paused\"]) .timer {\n                    animation: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const elapsed = parseInt(this.getAttribute('elapsed') || '0', 10);\n        const showMs = this.hasAttribute('show-milliseconds');\n        const timeString = this.formatTime(elapsed, showMs);\n\n        return `\n            <time class=\"timer\" datetime=\"PT${elapsed}S\" aria-live=\"off\">\n                ${timeString}\n            </time>\n        `;\n    }\n\n    /**\n     * Format elapsed seconds to HH:MM:SS or HH:MM:SS.ms\n     */\n    private formatTime(totalSeconds: number, showMs = false): string {\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = Math.floor(totalSeconds % 60);\n\n        const pad = (n: number) => n.toString().padStart(2, '0');\n        let result = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;\n\n        if (showMs) {\n            const ms = Math.floor((totalSeconds % 1) * 100);\n            result += `<span class=\"milliseconds\">.${pad(ms)}</span>`;\n        }\n\n        return result;\n    }\n\n    protected onAttributeChanged(name: string): void {\n        if (name === 'state') {\n            this.handleStateChange();\n        }\n        this.render();\n    }\n\n    /**\n     * Handle state changes\n     */\n    private handleStateChange(): void {\n        const state = this.getAttribute('state') as WorkoutTimerState;\n\n        if (state === 'recording' && !this.intervalId) {\n            this.startTicking();\n        } else if (state !== 'recording' && this.intervalId) {\n            this.stopTicking();\n        }\n    }\n\n    /**\n     * Start the internal tick\n     */\n    private startTicking(): void {\n        this.startTimestamp = Date.now() - (this.pausedElapsed * 1000);\n        this.intervalId = window.setInterval(() => {\n            const elapsed = (Date.now() - this.startTimestamp) / 1000;\n            this.setAttribute('elapsed', String(elapsed));\n        }, 100);\n    }\n\n    /**\n     * Stop the internal tick\n     */\n    private stopTicking(): void {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n        this.pausedElapsed = parseFloat(this.getAttribute('elapsed') || '0');\n    }\n\n    protected onDisconnected(): void {\n        this.stopTicking();\n    }\n\n    /**\n     * Start the timer\n     */\n    public start(): void {\n        this.setAttribute('state', 'recording');\n        this.emit('timer-start');\n    }\n\n    /**\n     * Pause the timer\n     */\n    public pause(): void {\n        this.setAttribute('state', 'paused');\n        this.emit('timer-pause');\n    }\n\n    /**\n     * Resume the timer\n     */\n    public resume(): void {\n        this.setAttribute('state', 'recording');\n        this.emit('timer-resume');\n    }\n\n    /**\n     * Stop and reset the timer\n     */\n    public stop(): void {\n        this.setAttribute('state', 'idle');\n        this.pausedElapsed = 0;\n        this.emit('timer-stop', { elapsed: parseFloat(this.getAttribute('elapsed') || '0') });\n    }\n\n    /**\n     * Reset the timer to zero\n     */\n    public reset(): void {\n        this.pausedElapsed = 0;\n        this.startTimestamp = Date.now();\n        this.setAttribute('elapsed', '0');\n        this.emit('timer-reset');\n    }\n\n    /**\n     * Get the current elapsed time in seconds\n     */\n    public getElapsed(): number {\n        return parseFloat(this.getAttribute('elapsed') || '0');\n    }\n\n    /**\n     * Get the current state\n     */\n    public getState(): WorkoutTimerState {\n        return (this.getAttribute('state') as WorkoutTimerState) || 'idle';\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-workout-timer', WorkoutTimer);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-workout-timer': WorkoutTimer;\n    }\n}\n","/**\n * Notification Toast Component\n * \n * A Web Component for displaying toast-style notifications.\n * Accessible, auto-dismissing, and supports different notification types.\n * \n * @example\n * ```html\n * <bpt-toast\n *   message=\"Workout saved!\"\n *   type=\"success\"\n *   duration=\"3000\">\n * </bpt-toast>\n * ```\n * \n * Or programmatically:\n * ```typescript\n * Toast.show('Workout saved!', 'success');\n * ```\n * \n * @module Toast\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Notification type determines styling\n */\nexport type ToastType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Toast configuration options\n */\nexport interface ToastOptions {\n    message: string;\n    type?: ToastType;\n    duration?: number;\n    dismissible?: boolean;\n}\n\n/**\n * Type-specific colors (WCAG AA compliant)\n */\nconst TYPE_STYLES: Record<ToastType, { bg: string; icon: string }> = {\n    info: { bg: '#1d4ed8', icon: '' },\n    success: { bg: '#15803d', icon: '' },\n    error: { bg: '#b91c1c', icon: '' },\n    warning: { bg: '#a16207', icon: '' },\n};\n\n/**\n * Toast Notification Web Component\n */\nexport class Toast extends BaseComponent {\n    private timeoutId: number | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['message', 'type', 'duration', 'dismissible'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 80px;\n                left: 50%;\n                transform: translateX(-50%) translateY(-20px);\n                z-index: 10001;\n                opacity: 0;\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                pointer-events: none;\n            }\n            \n            :host(.visible) {\n                transform: translateX(-50%) translateY(0);\n                opacity: 1;\n                pointer-events: auto;\n            }\n            \n            :host(.hiding) {\n                transform: translateX(-50%) translateY(-20px);\n                opacity: 0;\n            }\n            \n            .toast {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 12px 20px;\n                border-radius: 8px;\n                background-color: var(--toast-bg, #1d4ed8);\n                color: white;\n                font-size: 14px;\n                font-weight: 500;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                max-width: 90vw;\n            }\n            \n            .icon {\n                font-size: 18px;\n                flex-shrink: 0;\n            }\n            \n            .message {\n                flex: 1;\n            }\n            \n            .dismiss-btn {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 18px;\n                cursor: pointer;\n                padding: 0 4px;\n                opacity: 0.8;\n                transition: opacity 0.2s ease;\n                flex-shrink: 0;\n            }\n            \n            .dismiss-btn:hover {\n                opacity: 1;\n            }\n            \n            .dismiss-btn:focus-visible {\n                outline: 2px solid white;\n                outline-offset: 2px;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const message = this.getAttribute('message') || '';\n        const type = (this.getAttribute('type') || 'info') as ToastType;\n        const dismissible = this.getAttribute('dismissible') !== 'false';\n        const styles = TYPE_STYLES[type] || TYPE_STYLES.info;\n\n        this.style.setProperty('--toast-bg', styles.bg);\n\n        return `\n            <div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n                <span class=\"icon\" aria-hidden=\"true\">${styles.icon}</span>\n                <span class=\"message\">${message}</span>\n                ${dismissible ? `\n                    <button class=\"dismiss-btn\" aria-label=\"Dismiss notification\">&times;</button>\n                ` : ''}\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        const dismissBtn = this.query('.dismiss-btn');\n        if (dismissBtn) {\n            dismissBtn.addEventListener('click', () => this.dismiss());\n        }\n    }\n\n    protected onConnected(): void {\n        // Trigger show animation\n        requestAnimationFrame(() => {\n            requestAnimationFrame(() => {\n                this.classList.add('visible');\n            });\n        });\n\n        // Auto-dismiss after duration\n        const duration = parseInt(this.getAttribute('duration') || '3000', 10);\n        if (duration > 0) {\n            this.timeoutId = window.setTimeout(() => this.dismiss(), duration);\n        }\n    }\n\n    protected onDisconnected(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n    }\n\n    /**\n     * Dismiss the toast\n     */\n    public dismiss(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n\n        this.classList.remove('visible');\n        this.classList.add('hiding');\n\n        // Remove after animation\n        setTimeout(() => {\n            this.remove();\n        }, 300);\n    }\n\n    /**\n     * Static method to show a toast notification\n     */\n    static show(message: string, type: ToastType = 'info', options: Partial<ToastOptions> = {}): Toast {\n        const toast = document.createElement('bpt-toast') as Toast;\n        toast.setAttribute('message', message);\n        toast.setAttribute('type', type);\n\n        if (options.duration !== undefined) {\n            toast.setAttribute('duration', String(options.duration));\n        }\n        if (options.dismissible !== undefined) {\n            toast.setAttribute('dismissible', String(options.dismissible));\n        }\n\n        document.body.appendChild(toast);\n        return toast;\n    }\n\n    /**\n     * Convenience methods for different types\n     */\n    static info(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'info', options);\n    }\n\n    static success(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'success', options);\n    }\n\n    static error(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'error', options);\n    }\n\n    static warning(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'warning', options);\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-toast', Toast);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-toast': Toast;\n    }\n}\n","/**\n * Modal Dialog Component\n * \n * A Web Component for displaying modal dialogs.\n * Fully accessible with keyboard navigation, focus trapping, and screen reader support.\n * \n * @example\n * ```html\n * <bpt-modal title=\"Confirm\" icon=\"\" open>\n *   <p>Are you sure you want to delete this workout?</p>\n *   <div slot=\"footer\">\n *     <button data-action=\"cancel\">Cancel</button>\n *     <button data-action=\"confirm\">Delete</button>\n *   </div>\n * </bpt-modal>\n * ```\n * \n * Or programmatically:\n * ```typescript\n * const result = await Modal.confirm({\n *   title: 'Delete Workout',\n *   message: 'Are you sure?',\n *   confirmText: 'Delete',\n *   variant: 'danger'\n * });\n * ```\n * \n * @module Modal\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Button variant determines styling\n */\nexport type ButtonVariant = 'primary' | 'secondary' | 'danger';\n\n/**\n * Modal configuration for programmatic usage\n */\nexport interface ModalConfig {\n    title: string;\n    message: string | HTMLElement;\n    icon?: string;\n    confirmText?: string;\n    cancelText?: string;\n    variant?: ButtonVariant;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Modal Dialog Web Component\n */\nexport class Modal extends BaseComponent {\n    private previousActiveElement: HTMLElement | null = null;\n    private focusTrapHandler: ((e: KeyboardEvent) => void) | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['title', 'icon', 'open', 'close-on-overlay'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 1000;\n                display: none;\n                align-items: center;\n                justify-content: center;\n            }\n            \n            :host([open]) {\n                display: flex;\n            }\n            \n            .overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-color: rgba(0, 0, 0, 0.5);\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n            \n            :host([open]) .overlay {\n                opacity: 1;\n            }\n            \n            .modal {\n                position: relative;\n                background: var(--modal-bg, white);\n                border-radius: 12px;\n                max-width: 90%;\n                max-height: 85vh;\n                min-width: 300px;\n                display: flex;\n                flex-direction: column;\n                box-shadow: 0 8px 24px var(--color-shadow, rgba(0, 0, 0, 0.15));\n                transform: scale(0.95) translateY(20px);\n                opacity: 0;\n                transition: transform 0.2s ease, opacity 0.2s ease;\n            }\n            \n            :host([open]) .modal {\n                transform: scale(1) translateY(0);\n                opacity: 1;\n            }\n            \n            .header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 20px 24px;\n                border-bottom: 1px solid var(--color-border, #d0d7de);\n            }\n            \n            .title {\n                font-size: 20px;\n                font-weight: 600;\n                color: var(--color-text-primary, #1f2328);\n                margin: 0;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            \n            .icon {\n                font-size: 24px;\n            }\n            \n            .close-btn {\n                background: none;\n                border: none;\n                font-size: 24px;\n                color: var(--color-text-secondary, #656d76);\n                cursor: pointer;\n                padding: 4px;\n                border-radius: 4px;\n                transition: background-color 0.15s ease;\n                line-height: 1;\n            }\n            \n            .close-btn:hover {\n                background-color: var(--color-bg-hover, rgba(0, 0, 0, 0.05));\n            }\n            \n            .close-btn:focus-visible {\n                outline: 2px solid var(--color-accent, #2196F3);\n                outline-offset: 2px;\n            }\n            \n            .body {\n                padding: 20px 24px;\n                overflow-y: auto;\n                flex: 1;\n                color: var(--color-text-primary, #1f2328);\n            }\n            \n            .footer {\n                padding: 16px 24px;\n                border-top: 1px solid var(--color-border, #d0d7de);\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n            }\n            \n            ::slotted([slot=\"footer\"]) {\n                display: flex;\n                gap: 8px;\n            }\n            \n            /* Default button styles for slotted buttons */\n            .btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: background-color 0.15s ease;\n            }\n            \n            .btn-secondary {\n                background: white;\n                border: 1px solid var(--color-border, #d0d7de);\n                color: var(--color-text-primary, #1f2328);\n            }\n            \n            .btn-secondary:hover {\n                background: var(--color-bg-secondary, #f6f8fa);\n            }\n            \n            .btn-primary {\n                background: var(--color-accent, #2196F3);\n                border: none;\n                color: white;\n            }\n            \n            .btn-primary:hover {\n                background: var(--color-accent-hover, #1976d2);\n            }\n            \n            .btn-danger {\n                background: var(--color-error, #cf222e);\n                border: none;\n                color: white;\n            }\n            \n            .btn-danger:hover {\n                background: #a40e26;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .overlay,\n                .modal {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const title = this.getAttribute('title') || '';\n        const icon = this.getAttribute('icon') || '';\n\n        return `\n            <div class=\"overlay\" part=\"overlay\"></div>\n            <div class=\"modal\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-title\">\n                <div class=\"header\">\n                    <h2 class=\"title\" id=\"modal-title\">\n                        ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                        ${title}\n                    </h2>\n                    <button class=\"close-btn\" aria-label=\"Close dialog\">&times;</button>\n                </div>\n                <div class=\"body\">\n                    <slot></slot>\n                </div>\n                <div class=\"footer\">\n                    <slot name=\"footer\"></slot>\n                </div>\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        // Close button\n        const closeBtn = this.query('.close-btn');\n        closeBtn?.addEventListener('click', () => this.close());\n\n        // Overlay click\n        const overlay = this.query('.overlay');\n        overlay?.addEventListener('click', () => {\n            if (this.getAttribute('close-on-overlay') !== 'false') {\n                this.close();\n            }\n        });\n\n        // Escape key\n        this.addEventListener('keydown', (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                this.close();\n            }\n        });\n\n        // Button actions in footer\n        this.addEventListener('click', (e: Event) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset?.action;\n            if (action) {\n                this.emit('modal-action', { action });\n                if (action === 'cancel' || action === 'confirm') {\n                    this.close();\n                }\n            }\n        });\n    }\n\n    protected onConnected(): void {\n        if (this.hasAttribute('open')) {\n            this.onOpen();\n        }\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'open') {\n            if (newValue !== null) {\n                this.onOpen();\n            } else {\n                this.onClose();\n            }\n        }\n    }\n\n    /**\n     * Called when modal opens\n     */\n    private onOpen(): void {\n        this.previousActiveElement = document.activeElement as HTMLElement;\n        this.setupFocusTrap();\n\n        // Focus first focusable element\n        requestAnimationFrame(() => {\n            const firstFocusable = this.shadow.querySelector<HTMLElement>(\n                'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n            );\n            firstFocusable?.focus();\n        });\n\n        this.emit('modal-open');\n    }\n\n    /**\n     * Called when modal closes\n     */\n    private onClose(): void {\n        this.removeFocusTrap();\n        this.previousActiveElement?.focus();\n        this.emit('modal-close');\n    }\n\n    /**\n     * Set up focus trap\n     */\n    private setupFocusTrap(): void {\n        this.focusTrapHandler = (e: KeyboardEvent) => {\n            if (e.key !== 'Tab') return;\n\n            const focusableElements = this.shadow.querySelectorAll<HTMLElement>(\n                'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n            );\n            const first = focusableElements[0];\n            const last = focusableElements[focusableElements.length - 1];\n\n            if (e.shiftKey && document.activeElement === first) {\n                e.preventDefault();\n                last?.focus();\n            } else if (!e.shiftKey && document.activeElement === last) {\n                e.preventDefault();\n                first?.focus();\n            }\n        };\n\n        this.addEventListener('keydown', this.focusTrapHandler);\n    }\n\n    /**\n     * Remove focus trap\n     */\n    private removeFocusTrap(): void {\n        if (this.focusTrapHandler) {\n            this.removeEventListener('keydown', this.focusTrapHandler);\n            this.focusTrapHandler = null;\n        }\n    }\n\n    /**\n     * Open the modal\n     */\n    public open(): void {\n        this.setAttribute('open', '');\n    }\n\n    /**\n     * Close the modal\n     */\n    public close(): void {\n        this.removeAttribute('open');\n    }\n\n    /**\n     * Toggle modal visibility\n     */\n    public toggle(): void {\n        if (this.hasAttribute('open')) {\n            this.close();\n        } else {\n            this.open();\n        }\n    }\n\n    /**\n     * Static method to show a confirmation dialog\n     */\n    static confirm(config: ModalConfig): Promise<boolean> {\n        return new Promise((resolve) => {\n            const modal = document.createElement('bpt-modal') as Modal;\n            modal.setAttribute('title', config.title);\n            if (config.icon) {\n                modal.setAttribute('icon', config.icon);\n            }\n\n            // Set content\n            const content = document.createElement('div');\n            if (typeof config.message === 'string') {\n                content.innerHTML = `<p>${config.message}</p>`;\n            } else {\n                content.appendChild(config.message);\n            }\n            modal.appendChild(content);\n\n            // Create footer with buttons\n            const footer = document.createElement('div');\n            footer.setAttribute('slot', 'footer');\n\n            const cancelBtn = document.createElement('button');\n            cancelBtn.className = 'btn btn-secondary';\n            cancelBtn.textContent = config.cancelText || 'Cancel';\n            cancelBtn.dataset.action = 'cancel';\n\n            const confirmBtn = document.createElement('button');\n            confirmBtn.className = `btn btn-${config.variant || 'primary'}`;\n            confirmBtn.textContent = config.confirmText || 'Confirm';\n            confirmBtn.dataset.action = 'confirm';\n\n            footer.appendChild(cancelBtn);\n            footer.appendChild(confirmBtn);\n            modal.appendChild(footer);\n\n            // Handle actions\n            modal.addEventListener('modal-action', ((e: CustomEvent) => {\n                resolve(e.detail.action === 'confirm');\n                modal.remove();\n            }) as EventListener);\n\n            modal.addEventListener('modal-close', () => {\n                resolve(false);\n                modal.remove();\n            });\n\n            document.body.appendChild(modal);\n            modal.open();\n        });\n    }\n\n    /**\n     * Static method to show an alert dialog\n     */\n    static alert(title: string, message: string, icon?: string): Promise<void> {\n        return new Promise((resolve) => {\n            const modal = document.createElement('bpt-modal') as Modal;\n            modal.setAttribute('title', title);\n            if (icon) {\n                modal.setAttribute('icon', icon);\n            }\n\n            const content = document.createElement('p');\n            content.textContent = message;\n            modal.appendChild(content);\n\n            const footer = document.createElement('div');\n            footer.setAttribute('slot', 'footer');\n\n            const okBtn = document.createElement('button');\n            okBtn.className = 'btn btn-primary';\n            okBtn.textContent = 'OK';\n            okBtn.dataset.action = 'confirm';\n            footer.appendChild(okBtn);\n            modal.appendChild(footer);\n\n            modal.addEventListener('modal-close', () => {\n                resolve();\n                modal.remove();\n            });\n\n            document.body.appendChild(modal);\n            modal.open();\n        });\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-modal', Modal);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-modal': Modal;\n    }\n}\n","/**\n * IndexedDB Storage for Workout Data\n * \n * Provides persistent storage for workout recordings using IndexedDB.\n * This ensures workout data survives page refreshes, crashes, and accidental closures.\n * \n * @module storage/workoutStorage\n */\n\nimport type { MeasurementsData, Measurement, LapMarker, GpsPoint, TreadmillMeasurement } from '../types/measurements.js';\n\nconst DB_NAME = 'BikeTrackerDB';\nconst DB_VERSION = 4; // Bump version for schema change\nconst STORE_NAME = 'activeWorkout';\nconst COMPLETED_STORE = 'completedWorkouts';\nconst DEBUG_STORE = 'rawDebugData';\n\n/**\n * Raw Debug Log Entry\n */\nexport interface DebugLogEntry {\n    id?: number;\n    timestamp: number;\n    sensor: string;\n    data: string; // Hex representation\n}\n\n/**\n * Stored workout data with metadata\n */\nexport interface StoredWorkout {\n    id: string;\n    startTime: number;\n    lastUpdated: number;\n    measurements: MeasurementsData;\n    isCompleted: boolean;\n    synced?: boolean;\n    syncedTime?: number;\n}\n\n/**\n * Active workout record for recovery\n */\nexport interface ActiveWorkoutRecord {\n    id: 'current';\n    startTime: number;\n    lastUpdated: number;\n    heartrate: Measurement[];\n    power: Measurement[];\n    cadence: Measurement[];\n    speed: Measurement[];\n    distance: Measurement[];\n    altitude: Measurement[];\n    gps: GpsPoint[];\n    treadmill: TreadmillMeasurement[];\n    laps: LapMarker[];\n}\n\nlet db: IDBDatabase | null = null;\n\n/**\n * Opens the IndexedDB database, creating stores if needed\n */\nexport async function openDatabase(): Promise<IDBDatabase> {\n    if (db) return db;\n\n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n        request.onerror = () => {\n            console.error('Failed to open IndexedDB:', request.error);\n            reject(request.error);\n        };\n\n        request.onsuccess = () => {\n            db = request.result;\n            resolve(db);\n        };\n\n        request.onupgradeneeded = (event) => {\n            const database = (event.target as IDBOpenDBRequest).result;\n\n            // Store for the currently active workout (single record)\n            if (!database.objectStoreNames.contains(STORE_NAME)) {\n                database.createObjectStore(STORE_NAME, { keyPath: 'id' });\n            }\n\n            // Store for completed workouts (backup/history)\n            if (!database.objectStoreNames.contains(COMPLETED_STORE)) {\n                const completedStore = database.createObjectStore(COMPLETED_STORE, { keyPath: 'id' });\n                completedStore.createIndex('startTime', 'startTime', { unique: false });\n            }\n\n            // Store for raw debug data\n            if (!database.objectStoreNames.contains(DEBUG_STORE)) {\n                const debugStore = database.createObjectStore(DEBUG_STORE, { keyPath: 'id', autoIncrement: true });\n                debugStore.createIndex('timestamp', 'timestamp', { unique: false });\n                debugStore.createIndex('sensor', 'sensor', { unique: false });\n            }\n        };\n    });\n}\n\n/**\n * Save a raw debug log entry\n */\nexport async function saveDebugLog(sensor: string, data: string): Promise<void> {\n    try {\n        const database = await openDatabase();\n        const record: DebugLogEntry = {\n            timestamp: Date.now(),\n            sensor,\n            data\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([DEBUG_STORE], 'readwrite');\n            const store = transaction.objectStore(DEBUG_STORE);\n            const request = store.add(record); // Using add since key is auto-increment\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not save debug log:', e);\n    }\n}\n\n/**\n * Get all debug logs\n */\nexport async function getDebugLogs(): Promise<DebugLogEntry[]> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([DEBUG_STORE], 'readonly');\n            const store = transaction.objectStore(DEBUG_STORE);\n            const index = store.index('timestamp');\n            const request = index.getAll();\n\n            request.onsuccess = () => resolve(request.result || []);\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not load debug logs:', e);\n        return [];\n    }\n}\n\n/**\n * Clear all debug logs\n */\nexport async function clearDebugLogs(): Promise<void> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([DEBUG_STORE], 'readwrite');\n            const store = transaction.objectStore(DEBUG_STORE);\n            const request = store.clear();\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not clear debug logs:', e);\n    }\n}\n\n/**\n * Saves the current workout state to IndexedDB\n */\nexport async function saveActiveWorkout(\n    measurements: MeasurementsData,\n    startTime: number | null\n): Promise<void> {\n    try {\n        const database = await openDatabase();\n\n        const record: ActiveWorkoutRecord = {\n            id: 'current',\n            startTime: startTime ?? Date.now(),\n            lastUpdated: Date.now(),\n            heartrate: measurements.heartrate,\n            power: measurements.power,\n            cadence: measurements.cadence,\n            speed: measurements.speed,\n            distance: measurements.distance,\n            altitude: measurements.altitude,\n            gps: measurements.gps,\n            treadmill: measurements.treadmill || [],\n            laps: measurements.laps || [],\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.put(record);\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not save active workout:', e);\n    }\n}\n\n/**\n * Clear the active workout from storage\n */\nexport async function clearActiveWorkout(): Promise<void> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.delete('current');\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not clear active workout:', e);\n    }\n}\n\n/**\n * Load the active workout from storage\n */\nexport async function loadActiveWorkout(): Promise<ActiveWorkoutRecord | null> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([STORE_NAME], 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.get('current');\n\n            request.onsuccess = () => {\n                if (request.result) {\n                    // Normalize optional arrays if missing in older DB versions\n                    const record = request.result;\n                    if (!record.treadmill) record.treadmill = [];\n                    if (!record.laps) record.laps = [];\n                    resolve(record);\n                } else {\n                    resolve(null);\n                }\n            };\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not load active workout:', e);\n        return null;\n    }\n}\n\n/**\n * Save a completed workout to history\n */\nexport async function saveCompletedWorkout(\n    measurements: MeasurementsData,\n    startTime: number,\n    endTime: number\n): Promise<string> {\n    const id = `workout_${startTime}`;\n\n    try {\n        const database = await openDatabase();\n\n        const record: StoredWorkout = {\n            id,\n            startTime,\n            lastUpdated: endTime,\n            isCompleted: true,\n            measurements: { ...measurements }, // Clone\n            synced: false\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([COMPLETED_STORE], 'readwrite');\n            const store = transaction.objectStore(COMPLETED_STORE);\n            const request = store.put(record);\n\n            request.onsuccess = () => resolve(id);\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.error('Failed to save completed workout:', e);\n        throw e;\n    }\n}\n\n/**\n * Get all completed workouts from history\n */\nexport async function getWorkoutHistory(): Promise<StoredWorkout[]> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([COMPLETED_STORE], 'readonly');\n            const store = transaction.objectStore(COMPLETED_STORE);\n            const index = store.index('startTime');\n            // Get all, sorted by start time (newest first requires manual reverse or cursor)\n            const request = index.getAll();\n\n            request.onsuccess = () => {\n                // Return newest first\n                resolve((request.result || []).reverse());\n            };\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not load workout history:', e);\n        return [];\n    }\n}\n\n// Throttled save mechanism\nlet saveTimeout: any = null;\nlet pendingSave: { measurements: MeasurementsData; startTime: number | null } | null = null;\n\n// Allow a 3rd optional parameter for delay to satisfy legacy tests, even if ignored or treated differently\nexport const throttledSave = (measurements: MeasurementsData, startTime: number | null, delayMs?: number): void => {\n    pendingSave = { measurements, startTime };\n    if (!saveTimeout) {\n        saveTimeout = setTimeout(async () => {\n            if (pendingSave) {\n                await saveActiveWorkout(pendingSave.measurements, pendingSave.startTime);\n                pendingSave = null;\n            }\n            saveTimeout = null;\n        }, delayMs || 2000); // Use provided delay or default 2s\n    }\n};\n\nexport const flushPendingSave = async (): Promise<void> => {\n    if (saveTimeout) {\n        clearTimeout(saveTimeout);\n        saveTimeout = null;\n    }\n    if (pendingSave) {\n        await saveActiveWorkout(pendingSave.measurements, pendingSave.startTime);\n        pendingSave = null;\n    }\n};\n\nexport const isIndexedDBSupported = (): boolean => {\n    return typeof window !== 'undefined' && 'indexedDB' in window;\n};\n\n/**\n * Legacy API Support / Aliases\n */\n\nexport const archiveWorkout = async (): Promise<string | null> => {\n    // Ensure any pending throttled saves are written to DB first\n    await flushPendingSave();\n\n    const active = await loadActiveWorkout();\n    if (!active) return null;\n\n    await saveCompletedWorkout(\n        {\n            heartrate: active.heartrate,\n            power: active.power,\n            cadence: active.cadence,\n            speed: active.speed,\n            distance: active.distance,\n            altitude: active.altitude,\n            gps: active.gps,\n            treadmill: active.treadmill,\n            laps: active.laps\n        },\n        active.startTime,\n        active.lastUpdated\n    );\n    await clearActiveWorkout();\n    return `workout_${active.startTime}`;\n};\n\nexport const hasRecoverableWorkout = async (): Promise<boolean> => {\n    const active = await loadActiveWorkout();\n    return !!active;\n};\n\nexport const getCompletedWorkouts = getWorkoutHistory; // Alias\n\nexport const markWorkoutSynced = async (id: string): Promise<void> => {\n    const db = await openDatabase();\n    return new Promise((resolve, reject) => {\n        const tx = db.transaction(COMPLETED_STORE, 'readwrite');\n        const store = tx.objectStore(COMPLETED_STORE);\n        const request = store.get(id);\n\n        request.onsuccess = () => {\n            const data = request.result as StoredWorkout;\n            if (data) {\n                data.synced = true;\n                data.syncedTime = Date.now();\n                store.put(data);\n                resolve();\n            } else {\n                reject(new Error('Workout not found'));\n            }\n        };\n        request.onerror = () => reject(request.error);\n    });\n};\n","/**\n * Calculate distance between two coordinates in meters (Haversine formula)\n */\nexport function calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371e3; // metres\n    const 1 = lat1 * Math.PI / 180;\n    const 2 = lat2 * Math.PI / 180;\n    const  = (lat2 - lat1) * Math.PI / 180;\n    const  = (lon2 - lon1) * Math.PI / 180;\n\n    const a = Math.sin( / 2) * Math.sin( / 2) +\n        Math.cos(1) * Math.cos(2) *\n        Math.sin( / 2) * Math.sin( / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n    return R * c;\n}\n","/**\n * Validation limits for measurement values\n */\nexport const VALIDATION_LIMITS = {\n    heartrate: { min: 0, max: 300 },\n    power: { min: 0, max: 3000 },\n    cadence: { min: 0, max: 300 },\n    speed: { min: 0, max: 150 }, // km/h\n    distance: { min: 0, max: 1000000 }, // meters\n    altitude: { min: -500, max: 9000 }, // meters\n} as const;\n","/**\n * Measurements State Management\n * \n * Central state container for all workout measurement data.\n * Integrates with IndexedDB for persistent storage and crash recovery.\n * \n * @module MeasurementsState\n */\n\nimport type { Measurement, MeasurementsData, MeasurementType, LapMarker, GpsPoint, TreadmillMeasurement } from './types/measurements.js';\nimport {\n    throttledSave,\n    flushPendingSave,\n    clearActiveWorkout,\n    isIndexedDBSupported\n} from './storage/workoutStorage.js';\nimport { calculateDistance } from './utils/geo.js';\nimport { VALIDATION_LIMITS } from './config/constants.js';\n\n/**\n * Callback type for state change notifications\n */\nexport type StateChangeCallback = () => void;\n\n/**\n * State container for workout measurements.\n * \n * Stores heart rate, power, and cadence measurements with timestamps.\n * Includes validation to reject invalid values.\n * Automatically persists to IndexedDB for crash recovery.\n * \n * @example\n * const state = new MeasurementsState();\n * state.addPower({ timestamp: Date.now(), value: 200 });\n * console.log(state.power); // [{ timestamp: ..., value: 200 }]\n */\nexport class MeasurementsState implements MeasurementsData {\n    heartrate: Measurement[] = [];\n    power: Measurement[] = [];\n    cadence: Measurement[] = [];\n    speed: Measurement[] = [];\n    distance: Measurement[] = [];\n    altitude: Measurement[] = [];\n    gps: GpsPoint[] = [];\n    treadmill: TreadmillMeasurement[] = [];\n    treadmillSpeed: Measurement[] = [];\n    laps: LapMarker[] = [];\n\n    private _persistenceEnabled: boolean;\n    private _startTime: number | null = null;\n    private _onChangeCallbacks: StateChangeCallback[] = [];\n\n    constructor(enablePersistence: boolean = true) {\n        this._persistenceEnabled = enablePersistence && isIndexedDBSupported();\n\n        // Set up page unload handler to save any pending changes\n        if (this._persistenceEnabled && typeof window !== 'undefined') {\n            window.addEventListener('beforeunload', () => {\n                flushPendingSave();\n            });\n\n            // Also save on visibility change (mobile browsers)\n            document.addEventListener('visibilitychange', () => {\n                if (document.hidden) {\n                    flushPendingSave();\n                }\n            });\n        }\n    }\n\n    /**\n     * Set the workout start time (used for persistence)\n     */\n    setStartTime(time: number | null): void {\n        this._startTime = time;\n    }\n\n    /**\n     * Get the workout start time\n     */\n    getStartTime(): number | null {\n        return this._startTime;\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: StateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: StateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    /**\n     * Notify listeners and persist state\n     */\n    private _notifyChange(): void {\n        // Notify listeners\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n\n        // Persist to IndexedDB\n        if (this._persistenceEnabled) {\n            throttledSave(this.toJSON(), this._startTime);\n        }\n    }\n\n    /**\n     * Add a heart rate measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 bpm)\n     */\n    addHeartrate(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.heartrate;\n        if (entry.value <= min || entry.value >= max) {\n            console.warn(`Invalid heartrate value: ${entry.value}`);\n            return;\n        }\n        this.heartrate.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    /**\n     * Add a power measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-3000 watts)\n     */\n    addPower(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.power;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid power value: ${entry.value}`);\n            return;\n        }\n        this.power.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    /**\n     * Add a cadence measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 rpm)\n     */\n    addCadence(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.cadence;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid cadence value: ${entry.value}`);\n            return;\n        }\n        this.cadence.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addSpeed(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid speed value: ${entry.value}`);\n            return;\n        }\n        this.speed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addDistance(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.distance;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid distance value: ${entry.value}`);\n            return;\n        }\n        this.distance.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addAltitude(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.altitude;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid altitude value: ${entry.value}`);\n            return;\n        }\n        this.altitude.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addTreadmillSpeed(entry: Measurement): void {\n        // Use same limits as speed for now\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid treadmill speed value: ${entry.value}`);\n            return;\n        }\n        this.treadmillSpeed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addGps(point: GpsPoint): void {\n        // Calculate distance if we have a previous point\n        if (this.gps.length > 0) {\n            const lastPoint = this.gps[this.gps.length - 1];\n            const dist = calculateDistance(lastPoint.lat, lastPoint.lon, point.lat, point.lon);\n\n            let currentTotalDistance = 0;\n            if (this.distance.length > 0) {\n                currentTotalDistance = this.distance[this.distance.length - 1].value;\n            }\n\n            this.addDistance({\n                timestamp: point.timestamp,\n                value: currentTotalDistance + dist\n            });\n        } else if (this.distance.length === 0) {\n            this.addDistance({\n                timestamp: point.timestamp,\n                value: 0\n            });\n        }\n\n        // Add speed if available (convert m/s to km/h)\n        if (point.speed !== null) {\n            this.addSpeed({\n                timestamp: point.timestamp,\n                value: point.speed * 3.6\n            });\n        }\n\n        // Add altitude if available\n        if (point.altitude !== null) {\n            this.addAltitude({\n                timestamp: point.timestamp,\n                value: point.altitude\n            });\n        }\n\n        this.gps.push(point);\n        this._notifyChange();\n    }\n\n    /**\n     * Add a measurement of any type\n     * \n     * @param type - The measurement type\n     * @param entry - Measurement with timestamp and value\n     * @throws Error if type is unknown\n     */\n    add(type: MeasurementType, entry: Measurement): void {\n        switch (type) {\n            case 'heartrate':\n                this.addHeartrate(entry);\n                break;\n            case 'power':\n                this.addPower(entry);\n                break;\n            case 'cadence':\n                this.addCadence(entry);\n                break;\n            case 'speed':\n                this.addSpeed(entry);\n                break;\n            case 'distance':\n                this.addDistance(entry);\n                break;\n            case 'altitude':\n                this.addAltitude(entry);\n                break;\n            case 'treadmillSpeed':\n                this.addTreadmillSpeed(entry);\n                break;\n            default:\n                throw new Error(`Unknown measurement type: ${type}`);\n        }\n    }\n\n    /**\n     * Clear all measurements\n     * @param clearPersisted - Also clear persisted data from IndexedDB\n     */\n    async clear(clearPersisted: boolean = true): Promise<void> {\n        this.heartrate = [];\n        this.power = [];\n        this.cadence = [];\n        this.speed = [];\n        this.distance = [];\n        this.altitude = [];\n        this.treadmillSpeed = [];\n        this.laps = [];\n        this._startTime = null;\n\n        if (clearPersisted && this._persistenceEnabled) {\n            await clearActiveWorkout();\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a lap marker\n     * \n     * @param startTime - The workout start time for calculating elapsed time\n     * @returns The new lap marker\n     */\n    addLap(startTime: number | null): LapMarker {\n        const timestamp = Date.now();\n        const lapNumber = this.laps.length + 1;\n        const lap: LapMarker = {\n            timestamp,\n            number: lapNumber,\n            elapsedMs: startTime ? timestamp - startTime : undefined,\n        };\n        this.laps.push(lap);\n        this._notifyChange();\n        return lap;\n    }\n\n    /**\n     * Get the current lap count\n     */\n    getLapCount(): number {\n        return this.laps.length;\n    }\n\n    /**\n     * Get all measurements as a plain object\n     */\n    toJSON(): MeasurementsData {\n        return {\n            heartrate: [...this.heartrate],\n            power: [...this.power],\n            cadence: [...this.cadence],\n            speed: [...this.speed],\n            distance: [...this.distance],\n            altitude: [...this.altitude],\n            treadmillSpeed: [...this.treadmillSpeed],\n            gps: [...this.gps],\n            laps: [...this.laps],\n        };\n    }\n\n    /**\n     * Restore state from persisted data\n     * @param data - The measurement data to restore\n     * @param startTime - The workout start time\n     */\n    restore(data: MeasurementsData, startTime: number | null): void {\n        this.heartrate = [...(data.heartrate || [])];\n        this.power = [...(data.power || [])];\n        this.cadence = [...(data.cadence || [])];\n        this.speed = [...(data.speed || [])];\n        this.distance = [...(data.distance || [])];\n        this.altitude = [...(data.altitude || [])];\n        this.treadmillSpeed = [...(data.treadmillSpeed || [])];\n        this.laps = [...(data.laps || [])];\n        this._startTime = startTime;\n\n        // Don't persist on restore - data is already persisted\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Enable or disable persistence\n     */\n    setPersistenceEnabled(enabled: boolean): void {\n        this._persistenceEnabled = enabled && isIndexedDBSupported();\n    }\n\n    /**\n     * Check if any measurements have been recorded\n     */\n    hasData(): boolean {\n        return this.heartrate.length > 0 || this.power.length > 0 || this.cadence.length > 0;\n    }\n\n    /**\n     * Get the count of measurements for each type\n     */\n    getCounts(): Record<MeasurementType, number> {\n        return {\n            heartrate: this.heartrate.length,\n            power: this.power.length,\n            cadence: this.cadence.length,\n            speed: this.speed.length,\n            distance: this.distance.length,\n            altitude: this.altitude.length,\n            gps: this.gps.length,\n            treadmillSpeed: this.treadmillSpeed.length,\n        };\n    }\n\n    /**\n     * Add a treadmill measurement\n     * \n     * @param entry - Treadmill measurement (speed/incline)\n     */\n    addTreadmillData(entry: TreadmillMeasurement): void {\n        this.treadmill.push(entry);\n\n        if (entry.speed != null) {\n            const measurement = {\n                timestamp: entry.timestamp,\n                value: entry.speed\n            };\n\n            // Add to specific treadmill Speed metric\n            this.addTreadmillSpeed(measurement);\n\n            // Speed from treadmill is already in km/h\n            this.addSpeed(measurement);\n        }\n\n        // Note: We don't explicitly notifyChange here if addSpeed/addTreadmillSpeed was called, \n        // because they call it. But if only incline changed, we must notify.\n        if (entry.speed == null) {\n            this._notifyChange();\n        }\n    }\n}\n","/**\n * Application State Initialization\n * \n * Creates and returns the initial application state objects.\n * \n * @module getInitState\n */\n\nimport { MeasurementsState } from './measurements-state.js';\nimport type { ConnectionsState, SensorConnectionState } from './types/connections.js';\n\n// Re-export types for convenience\nexport type { SensorConnectionState };\nexport type { ConnectionsState };\n\n/**\n * Workout time state\n */\nexport interface TimeState {\n    running: boolean;\n    startTime: number | null;\n    endTime: number | null;\n}\n\n/**\n * Complete application state\n */\nexport interface AppState {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n}\n\n/**\n * Creates the initial application state.\n * \n * @returns Object containing all state objects\n * \n * @example\n * const { measurementsState, connectionsState, timeState } = getInitState();\n */\nexport const getInitState = (): AppState => {\n    return {\n        measurementsState: new MeasurementsState(),\n        connectionsState: {\n            power: {\n                isConnected: false,\n                disconnect: null,\n            },\n            heartrate: {\n                isConnected: false,\n                disconnect: null,\n            },\n            cadence: {\n                isConnected: false,\n                disconnect: null,\n            },\n            speed: {\n                isConnected: false,\n                disconnect: null,\n            },\n            distance: {\n                isConnected: false,\n                disconnect: null,\n            },\n            altitude: {\n                isConnected: false,\n                disconnect: null,\n            },\n            gps: {\n                isConnected: false,\n                disconnect: null,\n            },\n        },\n        timeState: {\n            running: false,\n            startTime: null,\n            endTime: null,\n        },\n    };\n};\n","/**\n * Test exposure utilities\n * \n * Exposes application state for end-to-end testing.\n * \n * @module exposeVariablesDuringTest\n */\n\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { ConnectionsState } from './types/connections.js';\n\n/**\n * Extended window interface for test variables\n */\ndeclare global {\n    interface Window {\n        bike?: MeasurementsState;\n        connectionsState?: ConnectionsState;\n    }\n}\n\n/**\n * Parameters for test exposure\n */\ninterface ExposeTestVariablesParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n}\n\n/**\n * Exposes application state variables on the window object for E2E testing.\n * \n * This allows Playwright and other testing frameworks to access and verify\n * application state during tests.\n * \n * @param params - Object containing state objects to expose\n * \n * @example\n * // In test:\n * const state = await page.evaluate(() => window.bike);\n */\nexport function exposeVariablesDuringTest({\n    measurementsState,\n    connectionsState,\n}: ExposeTestVariablesParams): void {\n    // Always expose in non-production builds for testing purposes\n    if (typeof window !== 'undefined') {\n        window.bike = measurementsState;\n        window.connectionsState = connectionsState;\n    }\n}\n","/*! Capacitor: https://capacitorjs.com/ - MIT License */\nvar ExceptionCode;\n(function (ExceptionCode) {\n    /**\n     * API is not implemented.\n     *\n     * This usually means the API can't be used because it is not implemented for\n     * the current platform.\n     */\n    ExceptionCode[\"Unimplemented\"] = \"UNIMPLEMENTED\";\n    /**\n     * API is not available.\n     *\n     * This means the API can't be used right now because:\n     *   - it is currently missing a prerequisite, such as network connectivity\n     *   - it requires a particular platform or browser version\n     */\n    ExceptionCode[\"Unavailable\"] = \"UNAVAILABLE\";\n})(ExceptionCode || (ExceptionCode = {}));\nclass CapacitorException extends Error {\n    constructor(message, code, data) {\n        super(message);\n        this.message = message;\n        this.code = code;\n        this.data = data;\n    }\n}\nconst getPlatformId = (win) => {\n    var _a, _b;\n    if (win === null || win === void 0 ? void 0 : win.androidBridge) {\n        return 'android';\n    }\n    else if ((_b = (_a = win === null || win === void 0 ? void 0 : win.webkit) === null || _a === void 0 ? void 0 : _a.messageHandlers) === null || _b === void 0 ? void 0 : _b.bridge) {\n        return 'ios';\n    }\n    else {\n        return 'web';\n    }\n};\n\nconst createCapacitor = (win) => {\n    const capCustomPlatform = win.CapacitorCustomPlatform || null;\n    const cap = win.Capacitor || {};\n    const Plugins = (cap.Plugins = cap.Plugins || {});\n    const getPlatform = () => {\n        return capCustomPlatform !== null ? capCustomPlatform.name : getPlatformId(win);\n    };\n    const isNativePlatform = () => getPlatform() !== 'web';\n    const isPluginAvailable = (pluginName) => {\n        const plugin = registeredPlugins.get(pluginName);\n        if (plugin === null || plugin === void 0 ? void 0 : plugin.platforms.has(getPlatform())) {\n            // JS implementation available for the current platform.\n            return true;\n        }\n        if (getPluginHeader(pluginName)) {\n            // Native implementation available.\n            return true;\n        }\n        return false;\n    };\n    const getPluginHeader = (pluginName) => { var _a; return (_a = cap.PluginHeaders) === null || _a === void 0 ? void 0 : _a.find((h) => h.name === pluginName); };\n    const handleError = (err) => win.console.error(err);\n    const registeredPlugins = new Map();\n    const registerPlugin = (pluginName, jsImplementations = {}) => {\n        const registeredPlugin = registeredPlugins.get(pluginName);\n        if (registeredPlugin) {\n            console.warn(`Capacitor plugin \"${pluginName}\" already registered. Cannot register plugins twice.`);\n            return registeredPlugin.proxy;\n        }\n        const platform = getPlatform();\n        const pluginHeader = getPluginHeader(pluginName);\n        let jsImplementation;\n        const loadPluginImplementation = async () => {\n            if (!jsImplementation && platform in jsImplementations) {\n                jsImplementation =\n                    typeof jsImplementations[platform] === 'function'\n                        ? (jsImplementation = await jsImplementations[platform]())\n                        : (jsImplementation = jsImplementations[platform]);\n            }\n            else if (capCustomPlatform !== null && !jsImplementation && 'web' in jsImplementations) {\n                jsImplementation =\n                    typeof jsImplementations['web'] === 'function'\n                        ? (jsImplementation = await jsImplementations['web']())\n                        : (jsImplementation = jsImplementations['web']);\n            }\n            return jsImplementation;\n        };\n        const createPluginMethod = (impl, prop) => {\n            var _a, _b;\n            if (pluginHeader) {\n                const methodHeader = pluginHeader === null || pluginHeader === void 0 ? void 0 : pluginHeader.methods.find((m) => prop === m.name);\n                if (methodHeader) {\n                    if (methodHeader.rtype === 'promise') {\n                        return (options) => cap.nativePromise(pluginName, prop.toString(), options);\n                    }\n                    else {\n                        return (options, callback) => cap.nativeCallback(pluginName, prop.toString(), options, callback);\n                    }\n                }\n                else if (impl) {\n                    return (_a = impl[prop]) === null || _a === void 0 ? void 0 : _a.bind(impl);\n                }\n            }\n            else if (impl) {\n                return (_b = impl[prop]) === null || _b === void 0 ? void 0 : _b.bind(impl);\n            }\n            else {\n                throw new CapacitorException(`\"${pluginName}\" plugin is not implemented on ${platform}`, ExceptionCode.Unimplemented);\n            }\n        };\n        const createPluginMethodWrapper = (prop) => {\n            let remove;\n            const wrapper = (...args) => {\n                const p = loadPluginImplementation().then((impl) => {\n                    const fn = createPluginMethod(impl, prop);\n                    if (fn) {\n                        const p = fn(...args);\n                        remove = p === null || p === void 0 ? void 0 : p.remove;\n                        return p;\n                    }\n                    else {\n                        throw new CapacitorException(`\"${pluginName}.${prop}()\" is not implemented on ${platform}`, ExceptionCode.Unimplemented);\n                    }\n                });\n                if (prop === 'addListener') {\n                    p.remove = async () => remove();\n                }\n                return p;\n            };\n            // Some flair \n            wrapper.toString = () => `${prop.toString()}() { [capacitor code] }`;\n            Object.defineProperty(wrapper, 'name', {\n                value: prop,\n                writable: false,\n                configurable: false,\n            });\n            return wrapper;\n        };\n        const addListener = createPluginMethodWrapper('addListener');\n        const removeListener = createPluginMethodWrapper('removeListener');\n        const addListenerNative = (eventName, callback) => {\n            const call = addListener({ eventName }, callback);\n            const remove = async () => {\n                const callbackId = await call;\n                removeListener({\n                    eventName,\n                    callbackId,\n                }, callback);\n            };\n            const p = new Promise((resolve) => call.then(() => resolve({ remove })));\n            p.remove = async () => {\n                console.warn(`Using addListener() without 'await' is deprecated.`);\n                await remove();\n            };\n            return p;\n        };\n        const proxy = new Proxy({}, {\n            get(_, prop) {\n                switch (prop) {\n                    // https://github.com/facebook/react/issues/20030\n                    case '$$typeof':\n                        return undefined;\n                    case 'toJSON':\n                        return () => ({});\n                    case 'addListener':\n                        return pluginHeader ? addListenerNative : addListener;\n                    case 'removeListener':\n                        return removeListener;\n                    default:\n                        return createPluginMethodWrapper(prop);\n                }\n            },\n        });\n        Plugins[pluginName] = proxy;\n        registeredPlugins.set(pluginName, {\n            name: pluginName,\n            proxy,\n            platforms: new Set([...Object.keys(jsImplementations), ...(pluginHeader ? [platform] : [])]),\n        });\n        return proxy;\n    };\n    // Add in convertFileSrc for web, it will already be available in native context\n    if (!cap.convertFileSrc) {\n        cap.convertFileSrc = (filePath) => filePath;\n    }\n    cap.getPlatform = getPlatform;\n    cap.handleError = handleError;\n    cap.isNativePlatform = isNativePlatform;\n    cap.isPluginAvailable = isPluginAvailable;\n    cap.registerPlugin = registerPlugin;\n    cap.Exception = CapacitorException;\n    cap.DEBUG = !!cap.DEBUG;\n    cap.isLoggingEnabled = !!cap.isLoggingEnabled;\n    return cap;\n};\nconst initCapacitorGlobal = (win) => (win.Capacitor = createCapacitor(win));\n\nconst Capacitor = /*#__PURE__*/ initCapacitorGlobal(typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof self !== 'undefined'\n        ? self\n        : typeof window !== 'undefined'\n            ? window\n            : typeof global !== 'undefined'\n                ? global\n                : {});\nconst registerPlugin = Capacitor.registerPlugin;\n\n/**\n * Base class web plugins should extend.\n */\nclass WebPlugin {\n    constructor() {\n        this.listeners = {};\n        this.retainedEventArguments = {};\n        this.windowListeners = {};\n    }\n    addListener(eventName, listenerFunc) {\n        let firstListener = false;\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            this.listeners[eventName] = [];\n            firstListener = true;\n        }\n        this.listeners[eventName].push(listenerFunc);\n        // If we haven't added a window listener for this event and it requires one,\n        // go ahead and add it\n        const windowListener = this.windowListeners[eventName];\n        if (windowListener && !windowListener.registered) {\n            this.addWindowListener(windowListener);\n        }\n        if (firstListener) {\n            this.sendRetainedArgumentsForEvent(eventName);\n        }\n        const remove = async () => this.removeListener(eventName, listenerFunc);\n        const p = Promise.resolve({ remove });\n        return p;\n    }\n    async removeAllListeners() {\n        this.listeners = {};\n        for (const listener in this.windowListeners) {\n            this.removeWindowListener(this.windowListeners[listener]);\n        }\n        this.windowListeners = {};\n    }\n    notifyListeners(eventName, data, retainUntilConsumed) {\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            if (retainUntilConsumed) {\n                let args = this.retainedEventArguments[eventName];\n                if (!args) {\n                    args = [];\n                }\n                args.push(data);\n                this.retainedEventArguments[eventName] = args;\n            }\n            return;\n        }\n        listeners.forEach((listener) => listener(data));\n    }\n    hasListeners(eventName) {\n        var _a;\n        return !!((_a = this.listeners[eventName]) === null || _a === void 0 ? void 0 : _a.length);\n    }\n    registerWindowListener(windowEventName, pluginEventName) {\n        this.windowListeners[pluginEventName] = {\n            registered: false,\n            windowEventName,\n            pluginEventName,\n            handler: (event) => {\n                this.notifyListeners(pluginEventName, event);\n            },\n        };\n    }\n    unimplemented(msg = 'not implemented') {\n        return new Capacitor.Exception(msg, ExceptionCode.Unimplemented);\n    }\n    unavailable(msg = 'not available') {\n        return new Capacitor.Exception(msg, ExceptionCode.Unavailable);\n    }\n    async removeListener(eventName, listenerFunc) {\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            return;\n        }\n        const index = listeners.indexOf(listenerFunc);\n        this.listeners[eventName].splice(index, 1);\n        // If there are no more listeners for this type of event,\n        // remove the window listener\n        if (!this.listeners[eventName].length) {\n            this.removeWindowListener(this.windowListeners[eventName]);\n        }\n    }\n    addWindowListener(handle) {\n        window.addEventListener(handle.windowEventName, handle.handler);\n        handle.registered = true;\n    }\n    removeWindowListener(handle) {\n        if (!handle) {\n            return;\n        }\n        window.removeEventListener(handle.windowEventName, handle.handler);\n        handle.registered = false;\n    }\n    sendRetainedArgumentsForEvent(eventName) {\n        const args = this.retainedEventArguments[eventName];\n        if (!args) {\n            return;\n        }\n        delete this.retainedEventArguments[eventName];\n        args.forEach((arg) => {\n            this.notifyListeners(eventName, arg);\n        });\n    }\n}\n\nconst WebView = /*#__PURE__*/ registerPlugin('WebView');\n/******** END WEB VIEW PLUGIN ********/\n/******** COOKIES PLUGIN ********/\n/**\n * Safely web encode a string value (inspired by js-cookie)\n * @param str The string value to encode\n */\nconst encode = (str) => encodeURIComponent(str)\n    .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n    .replace(/[()]/g, escape);\n/**\n * Safely web decode a string value (inspired by js-cookie)\n * @param str The string value to decode\n */\nconst decode = (str) => str.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent);\nclass CapacitorCookiesPluginWeb extends WebPlugin {\n    async getCookies() {\n        const cookies = document.cookie;\n        const cookieMap = {};\n        cookies.split(';').forEach((cookie) => {\n            if (cookie.length <= 0)\n                return;\n            // Replace first \"=\" with CAP_COOKIE to prevent splitting on additional \"=\"\n            let [key, value] = cookie.replace(/=/, 'CAP_COOKIE').split('CAP_COOKIE');\n            key = decode(key).trim();\n            value = decode(value).trim();\n            cookieMap[key] = value;\n        });\n        return cookieMap;\n    }\n    async setCookie(options) {\n        try {\n            // Safely Encoded Key/Value\n            const encodedKey = encode(options.key);\n            const encodedValue = encode(options.value);\n            // Clean & sanitize options\n            const expires = `; expires=${(options.expires || '').replace('expires=', '')}`; // Default is \"; expires=\"\n            const path = (options.path || '/').replace('path=', ''); // Default is \"path=/\"\n            const domain = options.url != null && options.url.length > 0 ? `domain=${options.url}` : '';\n            document.cookie = `${encodedKey}=${encodedValue || ''}${expires}; path=${path}; ${domain};`;\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async deleteCookie(options) {\n        try {\n            document.cookie = `${options.key}=; Max-Age=0`;\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async clearCookies() {\n        try {\n            const cookies = document.cookie.split(';') || [];\n            for (const cookie of cookies) {\n                document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date().toUTCString()};path=/`);\n            }\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async clearAllCookies() {\n        try {\n            await this.clearCookies();\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n}\nconst CapacitorCookies = registerPlugin('CapacitorCookies', {\n    web: () => new CapacitorCookiesPluginWeb(),\n});\n// UTILITY FUNCTIONS\n/**\n * Read in a Blob value and return it as a base64 string\n * @param blob The blob value to convert to a base64 string\n */\nconst readBlobAsBase64 = async (blob) => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n        const base64String = reader.result;\n        // remove prefix \"data:application/pdf;base64,\"\n        resolve(base64String.indexOf(',') >= 0 ? base64String.split(',')[1] : base64String);\n    };\n    reader.onerror = (error) => reject(error);\n    reader.readAsDataURL(blob);\n});\n/**\n * Normalize an HttpHeaders map by lowercasing all of the values\n * @param headers The HttpHeaders object to normalize\n */\nconst normalizeHttpHeaders = (headers = {}) => {\n    const originalKeys = Object.keys(headers);\n    const loweredKeys = Object.keys(headers).map((k) => k.toLocaleLowerCase());\n    const normalized = loweredKeys.reduce((acc, key, index) => {\n        acc[key] = headers[originalKeys[index]];\n        return acc;\n    }, {});\n    return normalized;\n};\n/**\n * Builds a string of url parameters that\n * @param params A map of url parameters\n * @param shouldEncode true if you should encodeURIComponent() the values (true by default)\n */\nconst buildUrlParams = (params, shouldEncode = true) => {\n    if (!params)\n        return null;\n    const output = Object.entries(params).reduce((accumulator, entry) => {\n        const [key, value] = entry;\n        let encodedValue;\n        let item;\n        if (Array.isArray(value)) {\n            item = '';\n            value.forEach((str) => {\n                encodedValue = shouldEncode ? encodeURIComponent(str) : str;\n                item += `${key}=${encodedValue}&`;\n            });\n            // last character will always be \"&\" so slice it off\n            item.slice(0, -1);\n        }\n        else {\n            encodedValue = shouldEncode ? encodeURIComponent(value) : value;\n            item = `${key}=${encodedValue}`;\n        }\n        return `${accumulator}&${item}`;\n    }, '');\n    // Remove initial \"&\" from the reduce\n    return output.substr(1);\n};\n/**\n * Build the RequestInit object based on the options passed into the initial request\n * @param options The Http plugin options\n * @param extra Any extra RequestInit values\n */\nconst buildRequestInit = (options, extra = {}) => {\n    const output = Object.assign({ method: options.method || 'GET', headers: options.headers }, extra);\n    // Get the content-type\n    const headers = normalizeHttpHeaders(options.headers);\n    const type = headers['content-type'] || '';\n    // If body is already a string, then pass it through as-is.\n    if (typeof options.data === 'string') {\n        output.body = options.data;\n    }\n    // Build request initializers based off of content-type\n    else if (type.includes('application/x-www-form-urlencoded')) {\n        const params = new URLSearchParams();\n        for (const [key, value] of Object.entries(options.data || {})) {\n            params.set(key, value);\n        }\n        output.body = params.toString();\n    }\n    else if (type.includes('multipart/form-data') || options.data instanceof FormData) {\n        const form = new FormData();\n        if (options.data instanceof FormData) {\n            options.data.forEach((value, key) => {\n                form.append(key, value);\n            });\n        }\n        else {\n            for (const key of Object.keys(options.data)) {\n                form.append(key, options.data[key]);\n            }\n        }\n        output.body = form;\n        const headers = new Headers(output.headers);\n        headers.delete('content-type'); // content-type will be set by `window.fetch` to includy boundary\n        output.headers = headers;\n    }\n    else if (type.includes('application/json') || typeof options.data === 'object') {\n        output.body = JSON.stringify(options.data);\n    }\n    return output;\n};\n// WEB IMPLEMENTATION\nclass CapacitorHttpPluginWeb extends WebPlugin {\n    /**\n     * Perform an Http request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async request(options) {\n        const requestInit = buildRequestInit(options, options.webFetchExtra);\n        const urlParams = buildUrlParams(options.params, options.shouldEncodeUrlParams);\n        const url = urlParams ? `${options.url}?${urlParams}` : options.url;\n        const response = await fetch(url, requestInit);\n        const contentType = response.headers.get('content-type') || '';\n        // Default to 'text' responseType so no parsing happens\n        let { responseType = 'text' } = response.ok ? options : {};\n        // If the response content-type is json, force the response to be json\n        if (contentType.includes('application/json')) {\n            responseType = 'json';\n        }\n        let data;\n        let blob;\n        switch (responseType) {\n            case 'arraybuffer':\n            case 'blob':\n                blob = await response.blob();\n                data = await readBlobAsBase64(blob);\n                break;\n            case 'json':\n                data = await response.json();\n                break;\n            case 'document':\n            case 'text':\n            default:\n                data = await response.text();\n        }\n        // Convert fetch headers to Capacitor HttpHeaders\n        const headers = {};\n        response.headers.forEach((value, key) => {\n            headers[key] = value;\n        });\n        return {\n            data,\n            headers,\n            status: response.status,\n            url: response.url,\n        };\n    }\n    /**\n     * Perform an Http GET request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async get(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'GET' }));\n    }\n    /**\n     * Perform an Http POST request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async post(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'POST' }));\n    }\n    /**\n     * Perform an Http PUT request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async put(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'PUT' }));\n    }\n    /**\n     * Perform an Http PATCH request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async patch(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'PATCH' }));\n    }\n    /**\n     * Perform an Http DELETE request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async delete(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'DELETE' }));\n    }\n}\nconst CapacitorHttp = registerPlugin('CapacitorHttp', {\n    web: () => new CapacitorHttpPluginWeb(),\n});\n/******** END HTTP PLUGIN ********/\n/******** SYSTEM BARS PLUGIN ********/\n/**\n * Available status bar styles.\n */\nvar SystemBarsStyle;\n(function (SystemBarsStyle) {\n    /**\n     * Light system bar content on a dark background.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Dark\"] = \"DARK\";\n    /**\n     * For dark system bar content on a light background.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Light\"] = \"LIGHT\";\n    /**\n     * The style is based on the device appearance or the underlying content.\n     * If the device is using Dark mode, the system bars content will be light.\n     * If the device is using Light mode, the system bars content will be dark.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Default\"] = \"DEFAULT\";\n})(SystemBarsStyle || (SystemBarsStyle = {}));\n/**\n * Available system bar types.\n */\nvar SystemBarType;\n(function (SystemBarType) {\n    /**\n     * The top status bar on both Android and iOS.\n     *\n     * @since 8.0.0\n     */\n    SystemBarType[\"StatusBar\"] = \"StatusBar\";\n    /**\n     * The navigation bar (or gesture bar on iOS) on both Android and iOS.\n     *\n     * @since 8.0.0\n     */\n    SystemBarType[\"NavigationBar\"] = \"NavigationBar\";\n})(SystemBarType || (SystemBarType = {}));\nclass SystemBarsPluginWeb extends WebPlugin {\n    async setStyle() {\n        this.unavailable('not available for web');\n    }\n    async setAnimation() {\n        this.unavailable('not available for web');\n    }\n    async show() {\n        this.unavailable('not available for web');\n    }\n    async hide() {\n        this.unavailable('not available for web');\n    }\n}\nconst SystemBars = registerPlugin('SystemBars', {\n    web: () => new SystemBarsPluginWeb(),\n});\n/******** END SYSTEM BARS PLUGIN ********/\n\nexport { Capacitor, CapacitorCookies, CapacitorException, CapacitorHttp, ExceptionCode, SystemBarType, SystemBars, SystemBarsStyle, WebPlugin, WebView, buildRequestInit, registerPlugin };\n//# sourceMappingURL=index.js.map\n","import { registerPlugin } from '@capacitor/core';\nconst App = registerPlugin('App', {\n    web: () => import('./web').then((m) => new m.AppWeb()),\n});\nexport * from './definitions';\nexport { App };\n//# sourceMappingURL=index.js.map","import { View } from './View.js';\nimport { IRouter } from './types.js';\nimport { Capacitor } from '@capacitor/core';\nimport { App } from '@capacitor/app';\n\ninterface Route {\n    path: string;\n    viewId: string;\n}\n\nexport class Router implements IRouter {\n    private views: Map<string, View> = new Map();\n    private routes: Route[] = [];\n    private currentViewId: string | null = null;\n    private container: HTMLElement;\n    private isNative: boolean;\n\n    constructor(container: HTMLElement) {\n        this.container = container;\n        this.isNative = Capacitor.isNativePlatform();\n\n        // Handle browser back/forward buttons and hash changes\n        window.addEventListener('popstate', () => {\n            this.handleLocationChange();\n        });\n\n        // Also listen for hash changes (for Capacitor/native)\n        if (this.isNative) {\n            window.addEventListener('hashchange', () => {\n                this.handleLocationChange();\n            });\n        }\n\n        // Hardware back button handling for Capacitor\n        if (this.isNative) {\n            App.addListener('backButton', ({ canGoBack }) => {\n                if (canGoBack) {\n                    window.history.back();\n                } else {\n                    App.exitApp();\n                }\n            });\n        }\n    }\n\n    /**\n     * Register a view with the router.\n     */\n    public registerView(view: View): void {\n        this.views.set(view.id, view);\n\n        // Find existing container or create one\n        let viewContainer = document.getElementById(`page-${view.id}`);\n\n        if (!viewContainer) {\n            viewContainer = document.createElement('div');\n            viewContainer.id = `page-${view.id}`;\n            viewContainer.className = 'page-view';\n            viewContainer.style.display = 'none'; // Hidden by default\n            this.container.appendChild(viewContainer);\n        }\n\n        // Initialize the view with its container\n        view.init(viewContainer);\n    }\n\n    /**\n     * Add a route mapping to a view.\n     */\n    public addRoute(path: string, viewId: string): void {\n        this.routes.push({ path, viewId });\n    }\n\n    /**\n     * Navigate to a specific path.\n     * Uses hash-based routing on native platforms for better compatibility.\n     */\n    public navigate(path: string, replace = false): void {\n        if (this.isNative) {\n            // Use hash-based routing on Capacitor/native for file:// compatibility\n            if (replace) {\n                window.location.replace('#' + path);\n            } else {\n                window.location.hash = path;\n            }\n        } else {\n            // Use History API for web browsers\n            if (replace) {\n                window.history.replaceState({}, '', path);\n            } else {\n                window.history.pushState({}, '', path);\n            }\n            this.handleLocationChange();\n        }\n    }\n\n    /**\n     * Start the router and load the initial view.\n     */\n    public start(): void {\n        if (this.isNative) {\n            // On native, start with initial hash check\n            if (!window.location.hash) {\n                // If no hash, default to root\n                window.location.hash = '/';\n            }\n        }\n        this.handleLocationChange();\n    }\n\n    /**\n     * Go back in history.\n     */\n    public back(): void {\n        window.history.back();\n    }\n\n    /**\n     * Handle location changes (popstate or navigate).\n     */\n    private handleLocationChange(): void {\n        let path: string;\n\n        if (this.isNative) {\n            // On native platforms, use hash-based routing\n            // Hash format: #/path -> extract '/path'\n            const hash = window.location.hash;\n            path = hash ? hash.slice(1) : '/';\n            // Normalize empty hash to root\n            if (!path || path === '') {\n                path = '/';\n            }\n        } else {\n            // On web, use pathname\n            path = window.location.pathname;\n            // Normalize /index.html to /\n            if (path.endsWith('/index.html') || path.endsWith('.html')) {\n                path = '/';\n            }\n        }\n\n        // Simple matching logic\n        let matchedRoute = this.routes.find(r => r.path === path);\n\n        // Fallback to strict root or first registered route if no match\n        // Useful for initial load if path is just \"/\" or empty\n        if (!matchedRoute) {\n            matchedRoute = this.routes.find(r => r.path === '/') || this.routes[0];\n        }\n\n        if (matchedRoute) {\n            this.switchView(matchedRoute.viewId);\n        }\n    }\n\n    /**\n     * Switch the visible view.\n     */\n    private switchView(viewId: string): void {\n        if (this.currentViewId === viewId) return;\n\n        // Leave current view\n        if (this.currentViewId) {\n            const currentView = this.views.get(this.currentViewId);\n            if (currentView) {\n                currentView.onLeave();\n                const el = document.getElementById(`page-${this.currentViewId}`);\n                if (el) el.style.display = 'none';\n            }\n        }\n\n        // Enter new view\n        const newView = this.views.get(viewId);\n        if (newView) {\n            const el = document.getElementById(`page-${viewId}`);\n            if (el) el.style.display = '';\n            newView.onEnter();\n            this.currentViewId = viewId;\n\n            // Dispatch event for UI updates (e.g. Nav Bar)\n            window.dispatchEvent(new CustomEvent('route-changed', { detail: { viewId } }));\n        }\n    }\n}\n","import { View } from '../router/View.js';\n\nexport class DashboardView implements View {\n    public id = 'dashboard';\n\n    public init(_container: HTMLElement): void {\n        console.log('Dashboard View initialized');\n    }\n\n    public onEnter(): void {\n        console.log('Entered Dashboard View');\n    }\n\n    public onLeave(): void {\n        console.log('Left Dashboard View');\n    }\n}\n","/**\n * API client for workout database operations\n * Handles communication with the workout history API\n * \n * @module workoutClient\n */\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Workout data from API\n */\nexport interface Workout {\n    id: string;\n    userId?: string;\n    streamName?: string;\n    title?: string;\n    description?: string;\n    sport: string;\n    startTime: string;\n    endTime?: string;\n    duration?: number;\n    status: 'ACTIVE' | 'PAUSED' | 'COMPLETED' | 'ARCHIVED' | 'DELETED';\n    summary?: string;\n    telemetry?: string;\n    createdAt: string;\n    updatedAt: string;\n}\n\n/**\n * Pagination info\n */\nexport interface PaginationInfo {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n}\n\n/**\n * List workouts response\n */\nexport interface ListWorkoutsResponse {\n    workouts: Workout[];\n    pagination: PaginationInfo;\n}\n\n/**\n * List workouts options\n */\nexport interface ListWorkoutsOptions {\n    page?: number;\n    limit?: number;\n    status?: string;\n    userId?: string;\n    startDate?: Date;\n    endDate?: Date;\n    sport?: string;\n}\n\n/**\n * Create workout params\n */\nexport interface CreateWorkoutParams {\n    streamName: string;\n    title?: string;\n    sport?: string;\n    userId?: string;\n}\n\n/**\n * Create workout response\n */\nexport interface CreateWorkoutResponse {\n    success: boolean;\n    workout: Workout;\n}\n\n/**\n * Update workout params\n */\nexport interface UpdateWorkoutParams {\n    title?: string;\n    description?: string;\n    sport?: string;\n}\n\n/**\n * Complete workout response\n */\nexport interface CompleteWorkoutResponse {\n    success: boolean;\n    workout: Workout;\n    archivedMessages: number;\n}\n\n/**\n * Delete workout response\n */\nexport interface DeleteWorkoutResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * User statistics\n */\nexport interface UserStats {\n    totalWorkouts: number;\n    totalDuration: number;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Check if database features are available\n * \n * @returns Promise resolving to true if database is connected\n */\nexport async function isDatabaseAvailable(): Promise<boolean> {\n    try {\n        const response = await fetch(`${API_BASE_URL}/health`, {\n            headers: getHeaders(),\n        });\n        if (!response.ok) return false;\n        const health = await response.json();\n        return health.database === 'connected';\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Create a new workout\n * \n * @param params - Workout parameters\n * @returns Promise with created workout\n */\nexport async function createWorkout({\n    streamName,\n    title,\n    sport = 'cycling',\n    userId,\n}: CreateWorkoutParams): Promise<CreateWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName, title, sport, userId }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create workout');\n    }\n\n    return response.json();\n}\n\n/**\n * List workouts with pagination\n * \n * @param options - Query options\n * @returns Promise with workouts and pagination info\n */\nexport async function listWorkouts({\n    page = 1,\n    limit = 20,\n    status,\n    userId,\n    startDate,\n    endDate,\n    sport,\n}: ListWorkoutsOptions = {}): Promise<ListWorkoutsResponse> {\n    const params = new URLSearchParams();\n    params.set('page', page.toString());\n    params.set('limit', limit.toString());\n    if (status) params.set('status', status);\n    if (userId) params.set('userId', userId);\n    if (startDate) params.set('startDate', startDate.toISOString());\n    if (endDate) params.set('endDate', endDate.toISOString());\n    if (sport) params.set('sport', sport);\n\n    const response = await fetch(`${API_BASE_URL}/api/workouts?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to list workouts');\n    }\n\n    return response.json();\n}\n\n/**\n * Get a single workout by ID\n * \n * @param workoutId - Workout ID\n * @param includeTelemetry - Include full telemetry data\n * @returns Promise with workout data\n */\nexport async function getWorkout(\n    workoutId: string,\n    includeTelemetry: boolean = false\n): Promise<Workout> {\n    const params = new URLSearchParams();\n    if (includeTelemetry) params.set('includeTelemetry', 'true');\n\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Update workout metadata\n * \n * @param workoutId - Workout ID\n * @param data - Fields to update\n * @returns Promise with updated workout\n */\nexport async function updateWorkout(\n    workoutId: string,\n    { title, description, sport }: UpdateWorkoutParams\n): Promise<CreateWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}`, {\n        method: 'PATCH',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ title, description, sport }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to update workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Complete a workout (archive from Redis to database)\n * \n * @param workoutId - Workout ID\n * @param archiveTelemetry - Archive telemetry data\n * @returns Promise with completion result\n */\nexport async function completeWorkout(\n    workoutId: string,\n    archiveTelemetry: boolean = true\n): Promise<CompleteWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}/complete`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ archiveTelemetry }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to complete workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Delete a workout\n * \n * @param workoutId - Workout ID\n * @returns Promise with deletion result\n */\nexport async function deleteWorkout(workoutId: string): Promise<DeleteWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Get active workout by stream name\n * \n * @param streamName - Stream name\n * @returns Promise with workout or null if not found\n */\nexport async function getWorkoutByStream(streamName: string): Promise<Workout | null> {\n    try {\n        const response = await fetch(\n            `${API_BASE_URL}/api/workouts/by-stream/${encodeURIComponent(streamName)}`,\n            {\n                headers: getHeaders(),\n            }\n        );\n\n        if (response.status === 404) {\n            return null;\n        }\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to get workout');\n        }\n\n        return response.json();\n    } catch (error) {\n        if (error instanceof Error && error.message.includes('not found')) {\n            return null;\n        }\n        throw error;\n    }\n}\n\n/**\n * Get user statistics\n * \n * @param userId - User ID\n * @returns Promise with user stats\n */\nexport async function getUserStats(userId: string): Promise<UserStats> {\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/stats`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get user stats');\n    }\n\n    return response.json();\n}\n\n/**\n * Format duration in seconds to human-readable string\n * \n * @param seconds - Duration in seconds\n * @returns Formatted duration string\n */\nexport function formatDuration(seconds: number | undefined | null): string {\n    if (!seconds) return '--';\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n\n    if (hours > 0) {\n        return `${hours}h ${minutes}m`;\n    }\n    if (minutes > 0) {\n        return `${minutes}m ${secs}s`;\n    }\n    return `${secs}s`;\n}\n\n/**\n * Format date to locale string\n * \n * @param date - Date to format\n * @returns Formatted date string\n */\nexport function formatDate(date: string | Date | undefined | null): string {\n    if (!date) return '--';\n    return new Date(date).toLocaleDateString(undefined, {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n    });\n}\n","/**\n * API client for user operations\n * Handles communication with the user API including FTP history\n *\n * @module userClient\n */\n\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\nexport interface FtpHistoryEntry {\n    id: string;\n    userId: string;\n    ftp: number;\n    source: string | null;\n    createdAt: string;\n}\n\nexport interface UserSettings {\n    theme?: 'light' | 'dark' | 'system';\n    units?: 'metric' | 'imperial';\n    notifications?: boolean;\n    ftp?: number;\n}\n\n/**\n * Get user FTP history\n */\nexport async function getFtpHistory(userId: string): Promise<FtpHistoryEntry[]> {\n    const headers: Record<string, string> = {\n        'Content-Type': 'application/json'\n    };\n\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/ftp-history`, {\n        headers\n    });\n\n    if (!response.ok) {\n        throw new Error(`Failed to fetch FTP history: ${response.statusText}`);\n    }\n\n    return response.json();\n}\n\n/**\n * Update user FTP\n */\nexport async function updateUserFtp(userId: string, ftp: number, source: string = 'manual'): Promise<{ ftp: number }> {\n    const headers: Record<string, string> = {\n        'Content-Type': 'application/json'\n    };\n\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/ftp`, {\n        method: 'PUT',\n        headers,\n        body: JSON.stringify({ ftp, source })\n    });\n\n    if (!response.ok) {\n        throw new Error(`Failed to update FTP: ${response.statusText}`);\n    }\n\n    return response.json();\n}\n","/**\n * Accessibility utilities and keyboard navigation\n *\n * Implements keyboard shortcuts and screen reader announcements.\n *\n * @module accessibility\n */\n\n/**\n * Announce a message to screen readers\n *\n * Uses an aria-live region to announce status changes.\n *\n * @param message - The message to announce\n * @param priority - 'polite' for non-urgent, 'assertive' for urgent\n */\nexport function announce(\n    message: string,\n    priority: 'polite' | 'assertive' = 'polite'\n): void {\n    const announcer = document.getElementById('srAnnouncements');\n    if (announcer) {\n        announcer.setAttribute('aria-live', priority);\n        announcer.textContent = message;\n\n        // Clear after announcement to allow repeated messages\n        setTimeout(() => {\n            announcer.textContent = '';\n        }, 1000);\n    }\n}\n\n/**\n * Keyboard shortcut definitions\n */\ninterface KeyboardShortcut {\n    key: string;\n    description: string;\n    action: () => void;\n    ctrl?: boolean;\n    shift?: boolean;\n    alt?: boolean;\n}\n\nconst shortcuts: KeyboardShortcut[] = [];\n\n/**\n * Register a keyboard shortcut\n *\n * @param shortcut - The shortcut definition\n */\nexport function registerShortcut(shortcut: KeyboardShortcut): void {\n    shortcuts.push(shortcut);\n}\n\n/**\n * Handle keyboard events for shortcuts\n */\nfunction handleKeydown(event: KeyboardEvent): void {\n    // Don't trigger shortcuts when typing in inputs\n    const target = event.target as HTMLElement;\n    if (\n        target.tagName === 'INPUT' ||\n        target.tagName === 'TEXTAREA' ||\n        target.isContentEditable\n    ) {\n        // Allow Escape in inputs to blur\n        if (event.key === 'Escape') {\n            target.blur();\n        }\n        return;\n    }\n\n    for (const shortcut of shortcuts) {\n        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();\n        const ctrlMatch = shortcut.ctrl ? event.ctrlKey || event.metaKey : !event.ctrlKey && !event.metaKey;\n        const shiftMatch = shortcut.shift ? event.shiftKey : !event.shiftKey;\n        const altMatch = shortcut.alt ? event.altKey : !event.altKey;\n\n        if (keyMatch && ctrlMatch && shiftMatch && altMatch) {\n            event.preventDefault();\n            shortcut.action();\n            return;\n        }\n    }\n}\n\n/**\n * Initialize keyboard navigation\n *\n * Sets up global keyboard shortcuts:\n * - Space: Start/pause/resume recording (context-aware)\n * - Escape: Close modal/menu\n * - M: Toggle menu\n * - S: Open settings\n * - H: Open workout history\n * - L: Mark lap\n * - ?: Show keyboard shortcuts\n */\nexport function initKeyboardNavigation(): void {\n    // Space - Context-aware workout control\n    registerShortcut({\n        key: ' ',\n        description: 'Start/pause/resume workout (context-aware)',\n        action: () => {\n            // Garmin-style: Space toggles between recording and paused\n            const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n            const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n            const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n\n            // Click whichever button is currently visible\n            if (startButton && startButton.style.display !== 'none') {\n                startButton.click();\n            } else if (pauseButton && pauseButton.style.display !== 'none') {\n                pauseButton.click();\n            } else if (resumeButton && resumeButton.style.display !== 'none') {\n                resumeButton.click();\n            }\n        },\n    });\n\n    // Escape - Close modal/menu\n    registerShortcut({\n        key: 'Escape',\n        description: 'Close modal or menu',\n        action: () => {\n            // Close any open modal\n            const modals = document.querySelectorAll<HTMLElement>('.stream-modal[style*=\"display: block\"], .stream-modal:not([style*=\"display: none\"])');\n            for (const modal of modals) {\n                if (modal.style.display !== 'none') {\n                    const closeBtn = modal.querySelector<HTMLButtonElement>('.close-button');\n                    if (closeBtn) {\n                        closeBtn.click();\n                        announce('Dialog closed');\n                        return;\n                    }\n                }\n            }\n\n            // Close menu if open\n            const details = document.querySelector('details[open]') as HTMLDetailsElement | null;\n            if (details) {\n                details.removeAttribute('open');\n                announce('Menu closed');\n            }\n        },\n    });\n\n    // M - Toggle menu\n    registerShortcut({\n        key: 'm',\n        description: 'Toggle menu',\n        action: () => {\n            const details = document.querySelector('header details') as HTMLDetailsElement | null;\n            if (details) {\n                const isOpen = details.hasAttribute('open');\n                if (isOpen) {\n                    details.removeAttribute('open');\n                    announce('Menu closed');\n                } else {\n                    details.setAttribute('open', '');\n                    announce('Menu opened');\n                    // Focus first menu item\n                    const firstButton = details.querySelector<HTMLButtonElement>('#controls button');\n                    if (firstButton) {\n                        firstButton.focus();\n                    }\n                }\n            }\n        },\n    });\n\n    // S - Open settings\n    registerShortcut({\n        key: 's',\n        description: 'Open settings',\n        action: () => {\n            const settingsBtn = document.getElementById('settingsButton');\n            if (settingsBtn) {\n                settingsBtn.click();\n                announce('Settings opened');\n            }\n        },\n    });\n\n    // H - Open workout history\n    registerShortcut({\n        key: 'h',\n        description: 'Open workout history',\n        action: () => {\n            const router = (window as any).router;\n            if (router) {\n                router.navigate('/history');\n                announce('Workout history opened');\n            } else {\n                const historyBtn = document.getElementById('workoutHistoryButton');\n                if (historyBtn) {\n                    historyBtn.click();\n                    announce('Workout history opened');\n                }\n            }\n        },\n    });\n\n    // E - Export data\n    registerShortcut({\n        key: 'e',\n        description: 'Export workout data',\n        action: () => {\n            const exportBtn = document.getElementById('exportData');\n            if (exportBtn) {\n                exportBtn.click();\n            }\n        },\n    });\n\n    // L - Mark lap\n    registerShortcut({\n        key: 'l',\n        description: 'Mark lap',\n        action: () => {\n            const lapBtn = document.getElementById('lapButton');\n            if (lapBtn) {\n                lapBtn.click();\n            }\n        },\n    });\n\n    // Add event listener\n    document.addEventListener('keydown', handleKeydown);\n\n    // Update summary element to indicate keyboard accessibility\n    const summary = document.querySelector('header summary');\n    if (summary) {\n        summary.setAttribute('aria-keyshortcuts', 'M');\n    }\n\n    console.log('Keyboard navigation initialized');\n}\n\n/**\n * Trap focus within a modal dialog\n *\n * @param modal - The modal element\n */\nexport function trapFocus(modal: HTMLElement): void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n\n    if (focusableElements.length === 0) return;\n\n    const firstElement = focusableElements[0];\n    const lastElement = focusableElements[focusableElements.length - 1];\n\n    // Focus first element\n    firstElement.focus();\n\n    modal.addEventListener('keydown', (event) => {\n        if (event.key !== 'Tab') return;\n\n        if (event.shiftKey) {\n            // Shift + Tab\n            if (document.activeElement === firstElement) {\n                event.preventDefault();\n                lastElement.focus();\n            }\n        } else {\n            // Tab\n            if (document.activeElement === lastElement) {\n                event.preventDefault();\n                firstElement.focus();\n            }\n        }\n    });\n}\n\n/**\n * Update workout controls accessibility state\n *\n * @param state - The current workout state: 'idle', 'recording', or 'paused'\n */\nexport function updateWorkoutControlsAccessibility(\n    state: 'idle' | 'recording' | 'paused'\n): void {\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    // Update ARIA labels based on state\n    if (startButton) {\n        startButton.setAttribute('aria-label', 'Start workout');\n    }\n    if (pauseButton) {\n        pauseButton.setAttribute('aria-label', 'Pause workout');\n    }\n    if (resumeButton) {\n        resumeButton.setAttribute('aria-label', 'Resume workout');\n    }\n    if (stopButton) {\n        stopButton.setAttribute('aria-label', 'Stop and save workout');\n    }\n\n    // Update workout controls container with current state\n    const controlsContainer = document.getElementById('workoutControls');\n    if (controlsContainer) {\n        controlsContainer.setAttribute('data-workout-state', state);\n    }\n}\n\n/**\n * Update start/stop button accessibility state\n * @deprecated Use updateWorkoutControlsAccessibility instead\n * @param isRunning - Whether the workout is running\n */\nexport function updateStartStopAccessibility(isRunning: boolean): void {\n    // Backward compatibility - map to new function\n    updateWorkoutControlsAccessibility(isRunning ? 'recording' : 'paused');\n}\n\n/**\n * Announce connection status change\n *\n * @param sensorType - The type of sensor\n * @param isConnected - Whether the sensor is connected\n */\nexport function announceConnectionStatus(\n    sensorType: 'power' | 'cadence' | 'heartrate',\n    isConnected: boolean\n): void {\n    const sensorNames = {\n        power: 'Power meter',\n        cadence: 'Cadence sensor',\n        heartrate: 'Heart rate monitor',\n    };\n\n    const message = isConnected\n        ? `${sensorNames[sensorType]} connected`\n        : `${sensorNames[sensorType]} disconnected`;\n\n    announce(message, 'assertive');\n}\n","/**\n * Modal Component\n *\n * Reusable modal dialog system for confirmations and content display.\n * Fully accessible with keyboard navigation and screen reader support.\n *\n * @module modal\n */\n\nimport { announce } from './accessibility.js';\nimport type { ZoneState, ZoneDistribution } from '../zone-state.js';\n\n/**\n * Modal button configuration\n */\nexport interface ModalButton {\n    text: string;\n    variant: 'primary' | 'secondary' | 'danger';\n    onClick: () => void;\n}\n\n/**\n * Modal configuration options\n */\nexport interface ModalOptions {\n    title: string;\n    content: string | HTMLElement;\n    buttons: ModalButton[];\n    icon?: string;\n    onClose?: () => void;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Create a modal element\n */\nfunction createModalElement(options: ModalOptions): HTMLElement {\n    const modal = document.createElement('div');\n    modal.className = 'custom-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-modal', 'true');\n    modal.setAttribute('aria-labelledby', 'modal-title');\n\n    const titleText = options.icon ? `${options.icon} ${options.title}` : options.title;\n\n    modal.innerHTML = `\n        <div class=\"custom-modal-overlay\"></div>\n        <div class=\"custom-modal-container\">\n            <div class=\"custom-modal-header\">\n                <h2 id=\"modal-title\">${titleText}</h2>\n                <button class=\"modal-close-btn\" aria-label=\"Close dialog\">&times;</button>\n            </div>\n            <div class=\"custom-modal-body\"></div>\n            <div class=\"custom-modal-footer\"></div>\n        </div>\n    `;\n\n    // Add content\n    const body = modal.querySelector('.custom-modal-body') as HTMLElement;\n    if (typeof options.content === 'string') {\n        body.innerHTML = options.content;\n    } else {\n        body.appendChild(options.content);\n    }\n\n    // Add buttons\n    const footer = modal.querySelector('.custom-modal-footer') as HTMLElement;\n    options.buttons.forEach((btn, index) => {\n        const button = document.createElement('button');\n        button.textContent = btn.text;\n        button.className = `modal-btn modal-btn-${btn.variant}`;\n        button.addEventListener('click', btn.onClick);\n\n        // Auto-focus the first primary button, or first button if no primary\n        if (btn.variant === 'primary' || (index === 0 && !options.buttons.some(b => b.variant === 'primary'))) {\n            button.setAttribute('data-autofocus', 'true');\n        }\n\n        footer.appendChild(button);\n    });\n\n    return modal;\n}\n\n/**\n * Focus trap for modal accessibility\n */\nfunction trapFocus(modal: HTMLElement): () => void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    const handleTabKey = (e: KeyboardEvent) => {\n        if (e.key !== 'Tab') return;\n\n        if (e.shiftKey) {\n            if (document.activeElement === firstFocusable) {\n                e.preventDefault();\n                lastFocusable?.focus();\n            }\n        } else {\n            if (document.activeElement === lastFocusable) {\n                e.preventDefault();\n                firstFocusable?.focus();\n            }\n        }\n    };\n\n    modal.addEventListener('keydown', handleTabKey);\n    return () => modal.removeEventListener('keydown', handleTabKey);\n}\n\n/**\n * Show a modal dialog\n *\n * @param options - Modal configuration\n * @returns A function to close the modal\n */\nexport function showModal(options: ModalOptions): () => void {\n    const modal = createModalElement(options);\n    const previousActiveElement = document.activeElement as HTMLElement;\n\n    document.body.appendChild(modal);\n\n    // Force reflow for animation\n    modal.offsetHeight;\n    modal.classList.add('modal-visible');\n\n    // Set up focus trap\n    const removeFocusTrap = trapFocus(modal);\n\n    // Focus the autofocus element or first focusable\n    const autofocusEl = modal.querySelector<HTMLElement>('[data-autofocus]');\n    setTimeout(() => {\n        autofocusEl?.focus();\n    }, 50);\n\n    // Close function\n    const closeModal = () => {\n        modal.classList.remove('modal-visible');\n\n        // Remove after animation\n        setTimeout(() => {\n            modal.remove();\n            removeFocusTrap();\n\n            // Restore focus\n            previousActiveElement?.focus();\n\n            options.onClose?.();\n        }, 200);\n    };\n\n    // Close button\n    const closeBtn = modal.querySelector('.modal-close-btn');\n    closeBtn?.addEventListener('click', closeModal);\n\n    // Overlay click\n    if (options.closeOnOverlay !== false) {\n        const overlay = modal.querySelector('.custom-modal-overlay');\n        overlay?.addEventListener('click', closeModal);\n    }\n\n    // Escape key\n    const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n            e.preventDefault();\n            closeModal();\n        }\n    };\n    document.addEventListener('keydown', handleEscape);\n\n    // Cleanup escape listener when modal closes\n    const originalOnClose = options.onClose;\n    options.onClose = () => {\n        document.removeEventListener('keydown', handleEscape);\n        originalOnClose?.();\n    };\n\n    announce(`${options.title} dialog opened`, 'polite');\n\n    return closeModal;\n}\n\n/**\n * Show a confirmation dialog\n *\n * @param title - Dialog title\n * @param message - Confirmation message\n * @param options - Additional options\n * @returns Promise resolving to true if confirmed, false if cancelled\n */\nexport function showConfirmation(\n    title: string,\n    message: string,\n    options: {\n        confirmText?: string;\n        cancelText?: string;\n        confirmVariant?: 'primary' | 'danger';\n        icon?: string;\n    } = {}\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const {\n            confirmText = 'Confirm',\n            cancelText = 'Cancel',\n            confirmVariant = 'primary',\n            icon,\n        } = options;\n\n        let closeModal: (() => void) | null = null;\n\n        closeModal = showModal({\n            title,\n            content: `<p class=\"modal-message\">${message}</p>`,\n            icon,\n            buttons: [\n                {\n                    text: cancelText,\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(false);\n                    },\n                },\n                {\n                    text: confirmText,\n                    variant: confirmVariant,\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(true);\n                    },\n                },\n            ],\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Workout summary data\n */\nexport interface WorkoutSummary {\n    duration: number;\n    startTime: number;\n    endTime: number;\n    power: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    heartrate: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    cadence: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    powerZoneDistribution?: ZoneDistribution;\n    hrZoneDistribution?: ZoneDistribution;\n    powerCurve?: { duration: number; watts: number }[];\n    trainingLoad?: number;\n    intensityFactor?: number;\n}\n\n/**\n * Calculate workout summary statistics\n */\nexport function calculateWorkoutSummary(\n    startTime: number,\n    endTime: number,\n    measurements: {\n        power: { value: number }[];\n        heartrate: { value: number }[];\n        cadence: { value: number }[];\n    },\n    zoneState?: ZoneState\n): WorkoutSummary {\n    const calcStats = (data: { value: number }[]) => {\n        if (data.length === 0) {\n            return { avg: null, max: null, count: 0 };\n        }\n        const values = data.map((d) => d.value);\n        const sum = values.reduce((a, b) => a + b, 0);\n        return {\n            avg: Math.round(sum / values.length),\n            max: Math.max(...values),\n            count: values.length,\n        };\n    };\n\n    // Calculate Power Curve\n    const powerValues = measurements.power.map(p => p.value);\n    const powerCurve: { duration: number; watts: number }[] = [];\n    const durations = [1, 5, 10, 30, 60, 300, 1200, 3600]; // 1s, 5s, 10s, 30s, 1m, 5m, 20m, 1h\n\n    // Helper for sliding window max\n    const getMaxForDuration = (windowSize: number) => {\n        if (powerValues.length < windowSize) return 0;\n        let sum = 0;\n        for (let i = 0; i < windowSize; i++) sum += powerValues[i];\n        let maxAvg = sum / windowSize;\n\n        for (let i = windowSize; i < powerValues.length; i++) {\n            sum = sum - powerValues[i - windowSize] + powerValues[i];\n            if ((sum / windowSize) > maxAvg) maxAvg = sum / windowSize;\n        }\n        return Math.round(maxAvg);\n    };\n\n    for (const d of durations) {\n        if (powerValues.length >= d) {\n            powerCurve.push({ duration: d, watts: getMaxForDuration(d) });\n        }\n    }\n\n    // Calculate TSS & IF (Assuming FTP = 200 if not set, should ideally come from user profile)\n    // TODO: Fetch user profile FTP properly. Using a fallback for now.\n    // Normalized power approximation: xPower (simple moving average for now or just avg)\n    // Real NP requires 30s rolling avg, raised to 4th power, avg, 4th root.\n\n    let trainingLoad = 0;\n    let intensityFactor = 0;\n\n    // Quick and dirty TSS if we have \"bpt-user-profile\" in localstorage\n    try {\n        const profileStr = localStorage.getItem('bpt-user-profile');\n        if (profileStr && powerValues.length > 0) {\n            const profile = JSON.parse(profileStr);\n            const ftp = profile.ftp || 200;\n\n            // Calculate Normalized Power (Simplified algorithm)\n            // 1. 30s rolling avg\n            const rolling30s: number[] = [];\n            let sum30 = 0;\n            for (let i = 0; i < powerValues.length; i++) {\n                sum30 += powerValues[i];\n                if (i >= 30) sum30 -= powerValues[i - 30];\n                if (i >= 29) rolling30s.push(sum30 / 30);\n            }\n\n            if (rolling30s.length > 0) {\n                // 2. raise to 4th power\n                const pow4 = rolling30s.map(v => Math.pow(v, 4));\n                // 3. average\n                const avgPow4 = pow4.reduce((a, b) => a + b, 0) / pow4.length;\n                // 4. 4th root\n                const np = Math.pow(avgPow4, 0.25);\n\n                intensityFactor = np / ftp;\n                // TSS = (sec x NP x IF) / (FTP x 3600) x 100\n                const durationSec = (endTime - startTime) / 1000;\n                trainingLoad = (durationSec * np * intensityFactor) / (ftp * 3600) * 100;\n            }\n        }\n    } catch (e) {\n        console.warn('Error calculating TSS', e);\n    }\n\n    const summary: WorkoutSummary = {\n        duration: endTime - startTime,\n        startTime,\n        endTime,\n        power: calcStats(measurements.power),\n        heartrate: calcStats(measurements.heartrate),\n        cadence: calcStats(measurements.cadence),\n        powerCurve: powerCurve.length > 0 ? powerCurve : undefined,\n        trainingLoad: trainingLoad > 0 ? Math.round(trainingLoad) : undefined,\n        intensityFactor: intensityFactor > 0 ? parseFloat(intensityFactor.toFixed(2)) : undefined,\n    };\n\n    // Add zone distributions if available\n    if (zoneState) {\n        const powerDist = zoneState.getPowerZoneDistribution();\n        const hrDist = zoneState.getHrZoneDistribution();\n\n        if (powerDist.totalTimeMs > 0) {\n            summary.powerZoneDistribution = powerDist;\n        }\n        if (hrDist.totalTimeMs > 0) {\n            summary.hrZoneDistribution = hrDist;\n        }\n    }\n\n    return summary;\n}\n\n/**\n * Format duration in milliseconds to human readable string\n */\nexport function formatDurationLong(ms: number): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    const parts: string[] = [];\n    if (hours > 0) parts.push(`${hours}h`);\n    if (minutes > 0) parts.push(`${minutes}m`);\n    if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);\n\n    return parts.join(' ');\n}\n\n/**\n * Format seconds to MM:SS format\n */\nfunction formatSecondsShort(seconds: number): string {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n}\n\n/**\n * Zone colors for the histogram\n */\nconst ZONE_COLORS: Record<number, string> = {\n    1: '#3b82f6', // Blue - Recovery\n    2: '#22c55e', // Green - Endurance\n    3: '#eab308', // Yellow - Tempo\n    4: '#f97316', // Orange - Threshold\n    5: '#ef4444', // Red - VO2max/Anaerobic\n    6: '#a855f7', // Purple - Anaerobic (power)\n    7: '#ec4899', // Pink - Neuromuscular (power)\n};\n\n/**\n * Create zone distribution histogram chart\n */\nfunction createZoneHistogram(distribution: ZoneDistribution, title: string): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'zone-distribution';\n\n    // Filter zones with time > 0\n    const activeZones = distribution.zones.filter(z => z.timeInZoneMs > 0);\n\n    if (activeZones.length === 0) {\n        return container; // Return empty if no zone data\n    }\n\n    const maxTime = Math.max(...distribution.zones.map(z => z.timeInZoneMs));\n\n    container.innerHTML = `\n        <h4 class=\"zone-distribution-title\">${title}</h4>\n        <div class=\"zone-chart\">\n            ${distribution.zones.map(zone => {\n        const percent = maxTime > 0 ? (zone.timeInZoneMs / maxTime) * 100 : 0;\n        const timeSeconds = Math.round(zone.timeInZoneMs / 1000);\n        const color = ZONE_COLORS[zone.zone] || '#888';\n        const timeStr = formatSecondsShort(timeSeconds);\n\n        return `\n                    <div class=\"zone-bar-row\" title=\"${zone.name}: ${timeStr}\">\n                        <span class=\"zone-bar-label\">Z${zone.zone}</span>\n                        <div class=\"zone-bar-container\">\n                            <div class=\"zone-bar\" style=\"width: ${Math.max(percent, 2)}%; background-color: ${color};\" aria-valuenow=\"${timeSeconds}\" aria-label=\"${zone.name}\"></div>\n                        </div>\n                        <span class=\"zone-bar-time\">${timeStr}</span>\n                    </div>\n                `;\n    }).join('')}\n        </div>\n    `;\n\n    return container;\n}\n\n/**\n * Create workout summary content HTML element\n */\nexport function createSummaryContent(summary: WorkoutSummary, newRecords: string[] = []): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'workout-summary';\n\n    const formatValue = (value: number | null, unit: string): string => {\n        return value !== null ? `${value}${unit}` : '--';\n    };\n\n    // New Records Section\n    let recordsHtml = '';\n    if (newRecords.length > 0) {\n        recordsHtml = `\n            <div class=\"summary-records\" style=\"background: rgba(255, 215, 0, 0.1); border: 1px solid var(--color-accent); border-radius: 8px; padding: 12px; margin-bottom: 16px;\">\n                <h4 style=\"margin: 0 0 8px 0; color: var(--color-accent); display: flex; align-items: center; gap: 8px;\">\n                     New Personal Records!\n                </h4>\n                <ul style=\"margin: 0; padding-left: 20px; list-style-type: none;\">\n                    ${newRecords.map(r => `<li style=\"margin-bottom: 4px;\"> ${r}</li>`).join('')}\n                </ul>\n            </div>\n        `;\n    }\n\n    container.innerHTML = `\n        ${recordsHtml}\n        <div class=\"summary-duration\">\n            <span class=\"summary-label\">Duration</span>\n            <span class=\"summary-value\">${formatDurationLong(summary.duration)}</span>\n        </div>\n        <div class=\"summary-grid\">\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Power</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.power.avg, 'W')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.power.max, 'W')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Heart Rate</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.heartrate.avg, ' bpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.heartrate.max, ' bpm')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Cadence</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.cadence.avg, ' rpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.cadence.max, ' rpm')}</span>\n                </div>\n            </div>\n        </div>\n        <div class=\"summary-samples\">\n            <span class=\"summary-samples-text\">\n                ${summary.power.count + summary.heartrate.count + summary.cadence.count} data points recorded\n            </span>\n        </div>\n    `;\n\n    // Add zone distribution charts if available\n    if (summary.powerZoneDistribution && summary.powerZoneDistribution.totalTimeMs > 0) {\n        const powerChart = createZoneHistogram(summary.powerZoneDistribution, ' Power Zone Distribution');\n        container.appendChild(powerChart);\n    }\n\n    if (summary.hrZoneDistribution && summary.hrZoneDistribution.totalTimeMs > 0) {\n        const hrChart = createZoneHistogram(summary.hrZoneDistribution, ' Heart Rate Zone Distribution');\n        container.appendChild(hrChart);\n    }\n\n    return container;\n}\n\n/**\n * Show post-workout summary modal\n *\n * @param summary - Workout summary data\n * @param callbacks - Action callbacks\n * @returns Promise resolving to the chosen action\n */\nexport function showWorkoutSummary(\n    summary: WorkoutSummary,\n    callbacks: {\n        onExport: () => void;\n        onDiscard: () => void;\n        onKeepRecording: () => void;\n    },\n    newRecords: string[] = []\n): Promise<'export' | 'discard' | 'keep'> {\n    return new Promise((resolve) => {\n        let closeModal: (() => void) | null = null;\n\n        const content = createSummaryContent(summary, newRecords);\n\n        closeModal = showModal({\n            title: 'Workout Complete',\n            content,\n            icon: '',\n            closeOnOverlay: false,\n            buttons: [\n                {\n                    text: ' Discard',\n                    variant: 'danger',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onDiscard();\n                        resolve('discard');\n                    },\n                },\n                {\n                    text: ' Keep Recording',\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onKeepRecording();\n                        resolve('keep');\n                    },\n                },\n                {\n                    text: ' Save & Finish',\n                    variant: 'primary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onExport();\n                        resolve('export');\n                    },\n                },\n            ],\n            onClose: () => {\n                callbacks.onKeepRecording();\n                resolve('keep');\n            },\n        });\n    });\n}\n","/**\n * Workout History UI\n * \n * Displays saved workouts and allows viewing details.\n * \n * @module workoutHistory\n */\n\nimport {\n  isDatabaseAvailable,\n  listWorkouts,\n  getWorkout,\n  deleteWorkout,\n  createWorkout,\n  completeWorkout,\n  formatDuration,\n  formatDate,\n  type Workout,\n  type ListWorkoutsResponse,\n  type ListWorkoutsOptions,\n} from '../api/workoutClient.js';\nimport {\n  getCompletedWorkouts,\n  markWorkoutSynced,\n  isIndexedDBSupported,\n  type StoredWorkout\n} from '../storage/workoutStorage.js';\nimport { getFtpHistory, type FtpHistoryEntry } from '../api/userClient.js';\nimport { calculateWorkoutSummary } from './modal.js';\nimport { announce } from './accessibility.js';\n\n/** Current pagination page */\nlet currentPage = 1;\n/** Total number of pages */\nlet totalPages = 1;\n/** Database availability flag */\nlet dbAvailable = false;\n\n/* Filter State */\nlet filterType = '';\nlet filterStartDate = '';\nlet filterEndDate = '';\n\n/* View State */\nlet currentView: 'list' | 'calendar' | 'analytics' = 'list';\nlet calendarDate = new Date(); // Points to current month\nlet dataSource: 'cloud' | 'local' = 'cloud';\n\n/**\n * Workout summary data from API\n */\ninterface WorkoutSummary {\n  avgPower?: number;\n  maxPower?: number;\n  normalizedPower?: number;\n  avgCadence?: number;\n  maxCadence?: number;\n  avgHeartrate?: number;\n  maxHeartrate?: number;\n  totalEnergy?: number;\n  totalDistance?: number;\n  sampleCount?: number;\n  powerCurve?: { duration: number; watts: number }[];\n  trainingLoad?: number;\n  intensityFactor?: number;\n}\n\n/**\n * Helper to safely parse summary\n */\nfunction getSummary(workout: Workout): WorkoutSummary {\n  if (!workout.summary) return {};\n  if (typeof workout.summary === 'string') {\n    try {\n      return JSON.parse(workout.summary);\n    } catch {\n      return {};\n    }\n  }\n  return workout.summary as unknown as WorkoutSummary;\n}\n\n/**\n * Initialize the workout history feature logic\n * NOTE: This should be called after the History View is mounted to DOM.\n */\nexport function initHistoryLogic(): void {\n  const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n  const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n  const refreshBtn = document.getElementById('historyRefresh');\n\n  // Filters & Views\n  const typeFilter = document.getElementById('workoutTypeFilter') as HTMLSelectElement | null;\n  const dateStart = document.getElementById('workoutDateStart') as HTMLInputElement | null;\n  const dateEnd = document.getElementById('workoutDateEnd') as HTMLInputElement | null;\n  const viewListBtn = document.getElementById('viewListBtn');\n  const viewCalendarBtn = document.getElementById('viewCalendarBtn');\n  const viewAnalyticsBtn = document.getElementById('viewAnalyticsBtn');\n\n  const listView = document.getElementById('workoutListView');\n  const calendarView = document.getElementById('workoutCalendarView');\n  const analyticsView = document.getElementById('workoutAnalyticsView');\n\n  // Calendar Controls\n  const prevMonthBtn = document.getElementById('calendarPrevMonth');\n  const nextMonthBtn = document.getElementById('calendarNextMonth');\n\n  // Source Toggle\n  const sourceCloudBtn = document.getElementById('sourceCloudBtn');\n  const sourceLocalBtn = document.getElementById('sourceLocalBtn');\n\n  if (sourceCloudBtn && sourceLocalBtn) {\n    sourceCloudBtn.addEventListener('click', () => setSource('cloud'));\n    sourceLocalBtn.addEventListener('click', () => setSource('local'));\n  }\n\n  // Check if database is available on load\n  checkDatabaseAvailability();\n\n  // Toggle Views\n  const setView = (view: 'list' | 'calendar' | 'analytics') => {\n    currentView = view;\n\n    // Buttons\n    if (viewListBtn) {\n      viewListBtn.classList.toggle('active', view === 'list');\n      viewListBtn.setAttribute('aria-pressed', (view === 'list').toString());\n      viewListBtn.style.background = view === 'list' ? 'var(--color-bg-active)' : 'transparent';\n    }\n    if (viewCalendarBtn) {\n      viewCalendarBtn.classList.toggle('active', view === 'calendar');\n      viewCalendarBtn.setAttribute('aria-pressed', (view === 'calendar').toString());\n      viewCalendarBtn.style.background = view === 'calendar' ? 'var(--color-bg-active)' : 'transparent';\n    }\n    if (viewAnalyticsBtn) {\n      viewAnalyticsBtn.classList.toggle('active', view === 'analytics');\n      viewAnalyticsBtn.setAttribute('aria-pressed', (view === 'analytics').toString());\n      viewAnalyticsBtn.style.background = view === 'analytics' ? 'var(--color-bg-active)' : 'transparent';\n    }\n\n    // Panels\n    if (listView) listView.style.display = view === 'list' ? 'block' : 'none';\n    if (calendarView) calendarView.style.display = view === 'calendar' ? 'block' : 'none';\n    if (analyticsView) analyticsView.style.display = view === 'analytics' ? 'block' : 'none';\n\n    // Filters visibility (hide generic filters for analytics maybe? Keeping for now)\n  };\n\n  viewListBtn?.addEventListener('click', () => {\n    setView('list');\n    loadWorkouts();\n  });\n\n  viewCalendarBtn?.addEventListener('click', () => {\n    setView('calendar');\n    loadCalendar();\n  });\n\n  viewAnalyticsBtn?.addEventListener('click', () => {\n    setView('analytics');\n    loadAnalytics();\n  });\n\n  // Filter Change Listeners\n  const handleFilterChange = () => {\n    if (typeFilter) filterType = typeFilter.value;\n    if (dateStart) filterStartDate = dateStart.value;\n    if (dateEnd) filterEndDate = dateEnd.value;\n\n    currentPage = 1;\n\n    if (currentView === 'list') {\n      loadWorkouts();\n    } else if (currentView === 'calendar') {\n      loadCalendar();\n    } else if (currentView === 'analytics') {\n      loadAnalytics();\n    }\n  };\n\n  typeFilter?.addEventListener('change', handleFilterChange);\n  dateStart?.addEventListener('change', handleFilterChange);\n  dateEnd?.addEventListener('change', handleFilterChange);\n\n  // Calendar Navigation\n  prevMonthBtn?.addEventListener('click', () => {\n    calendarDate.setMonth(calendarDate.getMonth() - 1);\n    loadCalendar();\n  });\n\n  nextMonthBtn?.addEventListener('click', () => {\n    calendarDate.setMonth(calendarDate.getMonth() + 1);\n    loadCalendar();\n  });\n\n  // Pagination\n  prevBtn?.addEventListener('click', async () => {\n    if (currentPage > 1) {\n      currentPage--;\n      await loadWorkouts();\n    }\n  });\n\n  nextBtn?.addEventListener('click', async () => {\n    if (currentPage < totalPages) {\n      currentPage++;\n      await loadWorkouts();\n    }\n  });\n\n  // Refresh\n  refreshBtn?.addEventListener('click', async () => {\n    await loadWorkouts();\n  });\n}\n\n/**\n * Check if database features are available\n */\nasync function checkDatabaseAvailability(): Promise<void> {\n  const historyButton = document.getElementById('workoutHistoryButton') as HTMLButtonElement | null;\n  const hasIndexedDB = isIndexedDBSupported();\n\n  try {\n    dbAvailable = await isDatabaseAvailable();\n  } catch {\n    dbAvailable = false;\n  }\n\n  // Default to local if cloud is unavailable\n  if (!dbAvailable && hasIndexedDB) {\n    dataSource = 'local';\n    updateSourceToggle();\n  }\n\n  if (historyButton) {\n    historyButton.disabled = !(dbAvailable || hasIndexedDB);\n    historyButton.title = (dbAvailable || hasIndexedDB)\n      ? 'View workout history'\n      : 'History not available';\n  }\n}\n\n/**\n * Convert locally stored workout to Workout interface\n */\nfunction storedToWorkout(stored: StoredWorkout): Workout & { _synced?: boolean } {\n  const summary = calculateWorkoutSummary(\n    stored.startTime,\n    stored.lastUpdated,\n    stored.measurements\n  );\n\n  return {\n    id: stored.id,\n    title: 'Local Workout',\n    sport: 'cycling',\n    startTime: new Date(stored.startTime).toISOString(),\n    endTime: new Date(stored.lastUpdated).toISOString(),\n    duration: Math.round((stored.lastUpdated - stored.startTime) / 1000),\n    status: 'COMPLETED', // API status enum\n    summary: JSON.stringify(summary),\n    createdAt: new Date(stored.startTime).toISOString(),\n    updatedAt: new Date(stored.lastUpdated).toISOString(),\n    _synced: stored.synced\n  };\n}\n\n/**\n * Load and display workouts\n */\nasync function loadWorkouts(): Promise<void> {\n  const listContainer = document.getElementById('workoutList');\n  const pageInfo = document.getElementById('historyPageInfo');\n  const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n  const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n\n  if (!listContainer) return;\n\n  // Show loading state\n  listContainer.innerHTML = '<div class=\"workout-loading\">Loading workouts...</div>';\n\n  try {\n    let workouts: (Workout & { _synced?: boolean })[] = [];\n\n    if (dataSource === 'local') {\n      const stored = await getCompletedWorkouts();\n      // TODO: Apply filters locally if needed\n      stored.sort((a, b) => b.startTime - a.startTime);\n\n      const total = stored.length;\n      totalPages = Math.ceil(total / 10) || 1;\n      const start = (currentPage - 1) * 10;\n      const pageItems = stored.slice(start, start + 10);\n\n      workouts = pageItems.map(storedToWorkout);\n\n      if (pageInfo) {\n        pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${total} local)`;\n      }\n    } else {\n      const options: ListWorkoutsOptions = {\n        page: currentPage,\n        limit: 10\n      };\n\n      if (filterType) options.sport = filterType;\n      if (filterStartDate) options.startDate = new Date(filterStartDate);\n      if (filterEndDate) options.endDate = new Date(filterEndDate);\n\n      const result: ListWorkoutsResponse = await listWorkouts(options);\n      workouts = result.workouts;\n      const { pagination } = result;\n\n      totalPages = pagination.totalPages;\n\n      // Update pagination info\n      if (pageInfo) {\n        pageInfo.textContent = `Page ${pagination.page} of ${pagination.totalPages} (${pagination.total} total)`;\n      }\n    }\n\n    // Update pagination buttons\n    if (prevBtn) prevBtn.disabled = currentPage <= 1;\n    if (nextBtn) nextBtn.disabled = currentPage >= totalPages;\n\n    // Render workouts\n    if (workouts.length === 0) {\n      listContainer.innerHTML = `\n        <div class=\"workout-empty\">\n          <p>No workouts found</p>\n          <p class=\"workout-empty-hint\">Start a workout to see it here!</p>\n        </div>\n      `;\n      return;\n    }\n\n    listContainer.innerHTML = workouts.map((workout) => renderWorkoutCard(workout)).join('');\n\n    // Add event listeners for workout cards\n    listContainer.querySelectorAll('.workout-card').forEach((card) => {\n      const workoutId = (card as HTMLElement).dataset.workoutId;\n      if (!workoutId) return;\n\n      // View details\n      card.querySelector('.workout-view-btn')?.addEventListener('click', (e: Event) => {\n        e.stopPropagation();\n        viewWorkoutDetails(workoutId);\n      });\n\n      // Delete\n      card.querySelector('.workout-delete-btn')?.addEventListener('click', (e: Event) => {\n        e.stopPropagation();\n        confirmDeleteWorkout(workoutId);\n      });\n\n      // Sync\n      card.querySelector('.workout-sync-btn')?.addEventListener('click', (e: Event) => {\n        e.stopPropagation();\n        syncWorkout(workoutId);\n      });\n    });\n  } catch (error) {\n    console.error('Failed to load workouts:', error);\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    listContainer.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workouts</p>\n        <p class=\"workout-error-detail\">${message}</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Switch data source and reload\n */\nfunction setSource(s: 'cloud' | 'local'): void {\n  if (dataSource === s) return;\n  dataSource = s;\n  updateSourceToggle();\n  currentPage = 1;\n  loadWorkouts();\n}\n\n/**\n * Update toggle UI\n */\nfunction updateSourceToggle(): void {\n  const cloudBtn = document.getElementById('sourceCloudBtn');\n  const localBtn = document.getElementById('sourceLocalBtn');\n\n  if (cloudBtn && localBtn) {\n    if (dataSource === 'cloud') {\n      cloudBtn.classList.add('active');\n      cloudBtn.setAttribute('aria-pressed', 'true');\n      cloudBtn.style.background = 'var(--color-bg-active)';\n\n      localBtn.classList.remove('active');\n      localBtn.setAttribute('aria-pressed', 'false');\n      localBtn.style.background = 'transparent';\n    } else {\n      localBtn.classList.add('active');\n      localBtn.setAttribute('aria-pressed', 'true');\n      localBtn.style.background = 'var(--color-bg-active)';\n\n      cloudBtn.classList.remove('active');\n      cloudBtn.setAttribute('aria-pressed', 'false');\n      cloudBtn.style.background = 'transparent';\n    }\n  }\n}\n\n/**\n * Sync a local workout to server\n */\nasync function syncWorkout(localId: string): Promise<void> {\n  const workouts = await getCompletedWorkouts();\n  const local = workouts.find(w => w.id === localId);\n  if (!local) return;\n\n  try {\n    announce('Syncing workout...', 'polite');\n\n    // 1. Create Workout on server\n    const createRes = await createWorkout({\n      streamName: `sync-${localId}`,\n      title: `Synced: ${formatDate(new Date(local.startTime))}`,\n      sport: 'cycling'\n    });\n\n    if (createRes.success && createRes.workout) {\n      // 2. Mark as complete (updates status to COMPLETED)\n      const completeRes = await completeWorkout(createRes.workout.id, false);\n\n      if (completeRes.success) {\n        await markWorkoutSynced(localId);\n        announce('Workout synced successfully', 'assertive');\n        await loadWorkouts();\n      } else {\n        throw new Error('Failed to complete workout on server');\n      }\n    }\n  } catch (e) {\n    console.error('Sync failed', e);\n    announce('Sync failed', 'assertive');\n  }\n}\n\n/**\n * Render a workout card\n */\nfunction renderWorkoutCard(workout: Workout & { _synced?: boolean }): string {\n  const statusClass = workout.status.toLowerCase();\n  const summary = getSummary(workout);\n\n  const isUnsynced = workout._synced === false;\n  const syncBtn = isUnsynced\n    ? `<button class=\"workout-sync-btn\" title=\"Upload to server\"> Sync</button>`\n    : (workout._synced === true ? `<span title=\"Synced\" style=\"margin-right:8px;\"></span>` : '');\n\n  return `\n    <div class=\"workout-card\" data-workout-id=\"${workout.id}\">\n      <div class=\"workout-card-header\">\n        <span class=\"workout-title\">${workout.title || 'Untitled Workout'}</span>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n      <div class=\"workout-card-body\">\n        <div class=\"workout-date\">\n           ${formatDate(workout.startTime)}\n        </div>\n        <div class=\"workout-stats\">\n          ${workout.duration ? `<span class=\"workout-stat\"> ${formatDuration(workout.duration)}</span>` : ''}\n          ${summary.avgPower ? `<span class=\"workout-stat\"> ${summary.avgPower}W avg</span>` : ''}\n          ${summary.maxPower ? `<span class=\"workout-stat\"> ${summary.maxPower}W max</span>` : ''}\n          ${summary.avgHeartrate ? `<span class=\"workout-stat\"> ${summary.avgHeartrate} bpm</span>` : ''}\n          ${summary.totalEnergy ? `<span class=\"workout-stat\"> ${summary.totalEnergy} kJ</span>` : ''}\n        </div>\n      </div>\n      <div class=\"workout-card-actions\">\n        ${syncBtn}\n        <button class=\"workout-view-btn\" title=\"View details\"> View</button>\n        <button class=\"workout-delete-btn\" title=\"Delete workout\"></button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * View workout details in a detail panel\n */\nasync function viewWorkoutDetails(workoutId: string): Promise<void> {\n  const detailPanel = document.getElementById('workoutDetailPanel');\n  const listPanel = document.getElementById('workoutListPanel');\n\n  if (!detailPanel || !listPanel) return;\n\n  // Show detail panel\n  listPanel.style.display = 'none';\n  detailPanel.style.display = 'block';\n  detailPanel.innerHTML = '<div class=\"workout-loading\">Loading workout details...</div>';\n\n  try {\n    const workout = await getWorkout(workoutId, true);\n    detailPanel.innerHTML = renderWorkoutDetail(workout);\n\n    // Back button\n    detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n      detailPanel.style.display = 'none';\n      listPanel.style.display = 'block';\n    });\n\n    // Export button\n    detailPanel.querySelector('.workout-export-btn')?.addEventListener('click', () => {\n      exportWorkoutData(workout);\n    });\n  } catch (error) {\n    console.error('Failed to load workout details:', error);\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    detailPanel.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workout</p>\n        <p class=\"workout-error-detail\">${message}</p>\n        <button class=\"workout-back-btn\"> Back to list</button>\n      </div>\n    `;\n    detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n      detailPanel.style.display = 'none';\n      listPanel.style.display = 'block';\n    });\n  }\n}\n\n/**\n * Render workout detail view\n */\nfunction renderWorkoutDetail(workout: Workout): string {\n  const summary = getSummary(workout);\n  const statusClass = workout.status.toLowerCase();\n\n  return `\n    <div class=\"workout-detail\">\n      <div class=\"workout-detail-header\">\n        <button class=\"workout-back-btn\"> Back</button>\n        <h3>${workout.title || 'Untitled Workout'}</h3>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n\n      <div class=\"workout-detail-meta\">\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Sport</span>\n          <span class=\"meta-value\">${workout.sport || 'cycling'}</span>\n        </div>\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Start Time</span>\n          <span class=\"meta-value\">${formatDate(workout.startTime)}</span>\n        </div>\n        ${workout.endTime ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">End Time</span>\n            <span class=\"meta-value\">${formatDate(workout.endTime)}</span>\n          </div>\n        ` : ''}\n        ${workout.duration ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">Duration</span>\n            <span class=\"meta-value\">${formatDuration(workout.duration)}</span>\n          </div>\n        ` : ''}\n      </div>\n\n      ${Object.keys(summary).length > 0 ? `\n        <div class=\"workout-detail-summary\">\n          <h4>Summary</h4>\n          <div class=\"summary-grid\">\n            ${summary.avgPower ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Power</span>\n                <span class=\"summary-value\">${summary.avgPower} W</span>\n              </div>\n            ` : ''}\n            ${summary.maxPower ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Max Power</span>\n                <span class=\"summary-value\">${summary.maxPower} W</span>\n              </div>\n            ` : ''}\n            ${summary.avgCadence ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Cadence</span>\n                <span class=\"summary-value\">${summary.avgCadence} rpm</span>\n              </div>\n            ` : ''}\n            ${summary.avgHeartrate ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Heart Rate</span>\n                <span class=\"summary-value\">${summary.avgHeartrate} bpm</span>\n              </div>\n            ` : ''}\n            ${summary.totalEnergy ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Total Energy</span>\n                <span class=\"summary-value\">${summary.totalEnergy} kJ</span>\n              </div>\n            ` : ''}\n          </div>\n        </div>\n      ` : ''}\n\n      ${workout.description ? `\n        <div class=\"workout-detail-description\">\n          <h4>Notes</h4>\n          <p>${workout.description}</p>\n        </div>\n      ` : ''}\n\n      <div class=\"workout-detail-actions\">\n        ${workout.telemetry ? `\n          <button class=\"workout-export-btn\"> Export Data</button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Export workout data to files\n */\nfunction exportWorkoutData(workout: Workout): void {\n  const timestamp = new Date(workout.startTime).toISOString().replace(/[:.]/g, '-').slice(0, 19);\n  const filename = `workout-${timestamp}`;\n\n  const jsonData = {\n    id: workout.id,\n    title: workout.title,\n    sport: workout.sport,\n    startTime: workout.startTime,\n    endTime: workout.endTime,\n    duration: workout.duration,\n    summary: workout.summary,\n    telemetry: workout.telemetry,\n  };\n\n  const jsonBlob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });\n  const jsonUrl = URL.createObjectURL(jsonBlob);\n  const jsonLink = document.createElement('a');\n  jsonLink.href = jsonUrl;\n  jsonLink.download = `${filename}.json`;\n  jsonLink.click();\n  URL.revokeObjectURL(jsonUrl);\n}\n\n/**\n * Confirm and delete a workout\n */\nasync function confirmDeleteWorkout(workoutId: string): Promise<void> {\n  if (!confirm('Are you sure you want to delete this workout? This cannot be undone.')) {\n    return;\n  }\n\n  try {\n    await deleteWorkout(workoutId);\n    await loadWorkouts();\n  } catch (error) {\n    console.error('Failed to delete workout:', error);\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    alert(`Failed to delete workout: ${message}`);\n  }\n}\n\n/**\n * Check database availability (exported for other modules)\n */\nexport function getDatabaseAvailable(): boolean {\n  return dbAvailable;\n}\n\n/**\n * Load and display calendar view\n */\nasync function loadCalendar(): Promise<void> {\n  const calendarGrid = document.getElementById('workoutCalendarGrid');\n  const monthLabel = document.getElementById('calendarMonthLabel');\n\n  if (!calendarGrid || !monthLabel) return;\n\n  // Set month label\n  const monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n  monthLabel.textContent = `${monthNames[calendarDate.getMonth()]} ${calendarDate.getFullYear()}`;\n\n  // Show loading\n  calendarGrid.innerHTML = '<div style=\"grid-column: 1 / -1; text-align: center; padding: 20px;\">Loading calendar...</div>';\n\n  // Calculate start and end of month\n  const year = calendarDate.getFullYear();\n  const month = calendarDate.getMonth();\n  const startDate = new Date(year, month, 1);\n  const endDate = new Date(year, month + 1, 0, 23, 59, 59, 999);\n\n  try {\n    const options: ListWorkoutsOptions = {\n      startDate,\n      endDate,\n      limit: 1000 // Get all workouts for the month\n    };\n    if (filterType) options.sport = filterType;\n\n    const result = await listWorkouts(options);\n    const workouts = result.workouts;\n\n    renderCalendar(workouts);\n    renderMonthlyStats(workouts);\n  } catch (error) {\n    console.error('Failed to load calendar:', error);\n    calendarGrid.innerHTML = '<div style=\"grid-column: 1 / -1; text-align: center; color: var(--color-error);\">Failed to load calendar data</div>';\n  }\n}\n\n/**\n * Render the calendar grid\n */\nfunction renderCalendar(workouts: Workout[]): void {\n  const calendarGrid = document.getElementById('workoutCalendarGrid');\n  if (!calendarGrid) return;\n\n  calendarGrid.innerHTML = '';\n\n  // Add day headers\n  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  days.forEach(day => {\n    const d = document.createElement('div');\n    d.textContent = day;\n    d.style.textAlign = 'center';\n    d.style.fontWeight = 'bold';\n    d.style.padding = '4px';\n    d.style.fontSize = '0.9em';\n    d.style.color = 'var(--color-text-secondary)';\n    calendarGrid.appendChild(d);\n  });\n\n  const year = calendarDate.getFullYear();\n  const month = calendarDate.getMonth();\n\n  // First day of the month\n  const firstDay = new Date(year, month, 1).getDay();\n  // Days in month\n  const daysInMonth = new Date(year, month + 1, 0).getDate();\n\n  // Empty cells for days before first of month\n  for (let i = 0; i < firstDay; i++) {\n    const empty = document.createElement('div');\n    calendarGrid.appendChild(empty);\n  }\n\n  // Days\n  for (let day = 1; day <= daysInMonth; day++) {\n    const dayCell = document.createElement('div');\n    dayCell.style.border = '1px solid var(--color-border)';\n    dayCell.style.borderRadius = '4px';\n    dayCell.style.minHeight = '60px';\n    dayCell.style.padding = '4px';\n    dayCell.style.background = 'var(--card-bg)';\n    dayCell.style.position = 'relative';\n\n    const dayNum = document.createElement('div');\n    dayNum.textContent = day.toString();\n    dayNum.style.fontSize = '0.8em';\n    dayNum.style.marginBottom = '4px';\n    dayCell.appendChild(dayNum);\n\n    // Find workouts for this day\n    const dayWorkouts = workouts.filter(w => {\n      const wDate = new Date(w.startTime);\n      return wDate.getDate() === day && wDate.getMonth() === month && wDate.getFullYear() === year;\n    });\n\n    dayWorkouts.forEach(w => {\n      const dot = document.createElement('div');\n      dot.title = `${w.title || 'Workout'} (${formatDuration(w.duration || 0)})`;\n      dot.style.fontSize = '0.7em';\n      dot.style.whiteSpace = 'nowrap';\n      dot.style.overflow = 'hidden';\n      dot.style.textOverflow = 'ellipsis';\n      dot.style.cursor = 'pointer';\n      dot.style.padding = '2px';\n      dot.style.marginTop = '2px';\n      dot.style.borderRadius = '2px';\n      dot.style.background = 'var(--color-bg-active)';\n      dot.style.color = 'var(--color-text-primary)';\n\n      // Icon based on sport\n      const icon = w.sport === 'running' ? '' : '';\n      dot.textContent = `${icon} ${formatDuration(w.duration || 0)}`;\n\n      dot.addEventListener('click', (e) => {\n        e.stopPropagation();\n        viewWorkoutDetails(w.id);\n      });\n\n      dayCell.appendChild(dot);\n    });\n\n    // Highlight today\n    const today = new Date();\n    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {\n      dayCell.style.borderColor = 'var(--color-accent)';\n      dayNum.style.fontWeight = 'bold';\n      dayNum.style.color = 'var(--color-accent)';\n    }\n\n    calendarGrid.appendChild(dayCell);\n  }\n}\n\n/**\n * Render monthly statistics\n */\nfunction renderMonthlyStats(workouts: Workout[]): void {\n  const statsContainer = document.getElementById('monthlyStats');\n  if (!statsContainer) return;\n\n  const totalWorkouts = workouts.length;\n  const totalDuration = workouts.reduce((acc, w) => acc + (w.duration || 0), 0);\n  const totalDistance = workouts.reduce((acc, w) => {\n    const summary = getSummary(w);\n    return acc + (summary.totalDistance || 0);\n  }, 0);\n  const totalEnergy = workouts.reduce((acc, w) => {\n    const summary = getSummary(w);\n    return acc + (summary.totalEnergy || 0);\n  }, 0);\n\n  statsContainer.innerHTML = `\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Workouts</div>\n            <div style=\"font-weight: bold;\">${totalWorkouts}</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Duration</div>\n            <div style=\"font-weight: bold;\">${formatDuration(totalDuration)}</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Distance</div>\n            <div style=\"font-weight: bold;\">${(totalDistance / 1000).toFixed(1)} km</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Energy</div>\n            <div style=\"font-weight: bold;\">${totalEnergy.toFixed(0)} kJ</div>\n        </div>\n    `;\n}\n\n/**\n * Load and display analytics\n */\nasync function loadAnalytics(): Promise<void> {\n  const analyticsView = document.getElementById('workoutAnalyticsView');\n  if (!analyticsView) return;\n\n  // Show loading\n  const prList = document.getElementById('prList');\n  if (prList) prList.innerHTML = '<div style=\"padding: 12px; text-align: center;\">Loading records...</div>';\n\n  try {\n    // Fetch all history (might be heavy, better to have a dedicated endpoint in future)\n    // For now, fetch with large limit but minimal fields? \n    // Unfortunately getWorkoutHistory fetches all summary fields.\n    // We can respect filters though.\n\n    const options: ListWorkoutsOptions = {\n      limit: 1000, // Reasonable cap\n    };\n    if (filterType) options.sport = filterType;\n    if (filterStartDate) options.startDate = new Date(filterStartDate);\n    if (filterEndDate) options.endDate = new Date(filterEndDate);\n\n    const result = await listWorkouts(options);\n    const workouts = result.workouts;\n\n    // Fetch FTP History if we have a user ID\n    let ftpHistory: FtpHistoryEntry[] = [];\n    if (workouts.length > 0 && workouts[0].userId) {\n      try {\n        ftpHistory = await getFtpHistory(workouts[0].userId);\n      } catch (e) {\n        console.warn('Failed to load FTP history', e);\n      }\n    }\n\n    renderAnalytics(workouts, ftpHistory);\n  } catch (error) {\n    console.error('Failed to load analytics:', error);\n    if (prList) prList.innerHTML = '<div style=\"color: var(--color-error); text-align: center;\">Failed to load data</div>';\n  }\n}\n\n/**\n * Render all analytics charts and stats\n */\nfunction renderAnalytics(workouts: Workout[], ftpHistory: FtpHistoryEntry[] = []): void {\n  renderPersonalRecords(workouts);\n  renderTrainingLoad(workouts);\n  renderPowerCurve(workouts);\n  renderFitnessTrend(workouts);\n  renderFtpHistory(ftpHistory);\n  renderPrHistory(workouts);\n}\n\n/**\n * Render Personal Records\n */\nfunction renderPersonalRecords(workouts: Workout[]): void {\n  const container = document.getElementById('prList');\n  if (!container) return;\n\n  let maxPower = { val: 0, date: '', id: '' };\n  let maxHr = { val: 0, date: '', id: '' };\n  let longestRide = { val: 0, date: '', id: '' }; // Duration\n  let maxDistance = { val: 0, date: '', id: '' };\n\n  workouts.forEach(w => {\n    const summary = getSummary(w);\n    const dateStr = formatDate(w.startTime);\n\n    if (summary.maxPower && summary.maxPower > maxPower.val) {\n      maxPower = { val: summary.maxPower, date: dateStr, id: w.id };\n    }\n    if (summary.maxHeartrate && summary.maxHeartrate > maxHr.val) {\n      maxHr = { val: summary.maxHeartrate, date: dateStr, id: w.id };\n    }\n    if (w.duration && w.duration > longestRide.val) {\n      longestRide = { val: w.duration, date: dateStr, id: w.id };\n    }\n    if (summary.totalDistance && summary.totalDistance > maxDistance.val) {\n      maxDistance = { val: summary.totalDistance, date: dateStr, id: w.id };\n    }\n  });\n\n  const createRow = (label: string, value: string, date: string, id: string) => `\n        <div class=\"pr-row\" data-id=\"${id}\" style=\"display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--color-border); cursor: pointer;\">\n            <div style=\"font-weight: 500;\">${label}</div>\n            <div style=\"text-align: right;\">\n                <div style=\"font-weight: bold; color: var(--color-accent);\">${value}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">${date}</div>\n            </div>\n        </div>\n    `;\n\n  container.innerHTML = `\n        ${maxPower.val > 0 ? createRow('Max Power (1s)', `${maxPower.val} W`, maxPower.date, maxPower.id) : ''}\n        ${maxHr.val > 0 ? createRow('Max Heart Rate', `${maxHr.val} bpm`, maxHr.date, maxHr.id) : ''}\n        ${longestRide.val > 0 ? createRow('Longest Duration', formatDuration(longestRide.val), longestRide.date, longestRide.id) : ''}\n        ${maxDistance.val > 0 ? createRow('Longest Distance', `${(maxDistance.val / 1000).toFixed(1)} km`, maxDistance.date, maxDistance.id) : ''}\n    `;\n\n  // Re-attach click listeners\n  container.querySelectorAll('.pr-row').forEach(row => {\n    row.addEventListener('click', () => {\n      const id = (row as HTMLElement).dataset.id;\n      if (id) viewWorkoutDetails(id);\n    });\n  });\n}\n\n/**\n * Render Training Load (Weekly TSS)\n */\nfunction renderTrainingLoad(workouts: Workout[]): void {\n  const container = document.getElementById('trainingLoadChart');\n  if (!container) return;\n\n  // Group by week\n  const weeks: Record<string, number> = {};\n  // Generate last 4 weeks keys\n  for (let i = 3; i >= 0; i--) {\n    const d = new Date();\n    d.setDate(d.getDate() - (i * 7));\n    const weekNum = getWeekNumber(d);\n    weeks[`${d.getFullYear()}-W${weekNum}`] = 0;\n  }\n\n  workouts.forEach(w => {\n    const summary = getSummary(w);\n    if (summary.trainingLoad) {\n      const date = new Date(w.startTime);\n      const key = `${date.getFullYear()}-W${getWeekNumber(date)}`;\n      if (weeks[key] !== undefined) {\n        weeks[key] += summary.trainingLoad;\n      }\n    }\n  });\n\n  const maxLoad = Math.max(...Object.values(weeks), 100); // Scale max\n\n  container.innerHTML = Object.entries(weeks).map(([week, load]) => {\n    const height = (load / maxLoad) * 100;\n    return `\n            <div style=\"display: flex; flex-direction: column; align-items: center; width: 20%;\">\n                <div style=\"font-size: 0.8em; font-weight: bold; margin-bottom: 4px;\">${Math.round(load)}</div>\n                <div style=\"width: 100%; height: 100px; display: flex; align-items: flex-end; justify-content: center;\">\n                    <div style=\"width: 80%; background: var(--color-accent); height: ${height}%; border-radius: 4px 4px 0 0; min-height: 4px;\"></div>\n                </div>\n                <div style=\"font-size: 0.7em; color: var(--color-text-secondary); margin-top: 4px;\">${week.split('-')[1]}</div>\n            </div>\n        `;\n  }).join('');\n}\n\nfunction getWeekNumber(d: Date): number {\n  d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));\n  d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7);\n}\n\n/**\n * Render Power Curve (SVG Chart)\n */\nfunction renderPowerCurve(workouts: Workout[]): void {\n  const container = document.getElementById('powerCurveChart');\n  if (!container) return;\n\n  // Aggregate best power for each duration\n  const bests: Record<number, number> = {};\n  const durations = [1, 5, 10, 30, 60, 300, 1200, 3600];\n\n  workouts.forEach(w => {\n    const summary = getSummary(w);\n    if (summary.powerCurve) {\n      summary.powerCurve.forEach(p => {\n        if (!bests[p.duration] || p.watts > bests[p.duration]) {\n          bests[p.duration] = p.watts;\n        }\n      });\n    }\n    // Fallback for older workouts if we have maxPower (1s)\n    if (summary.maxPower && (!bests[1] || summary.maxPower > bests[1])) {\n      bests[1] = summary.maxPower;\n    }\n  });\n\n  if (Object.keys(bests).length === 0) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">No power data available</div>';\n    return;\n  }\n\n  // Chart Dimensions\n  const width = container.clientWidth || 300;\n  const height = 200;\n  const pad = 30;\n\n  // Scales\n  const maxWatts = Math.max(...Object.values(bests)) * 1.1; // 10% overhead\n\n  const points = durations.map((d, i) => {\n    if (!bests[d]) return null;\n    const x = pad + (i * ((width - pad * 2) / (durations.length - 1)));\n    const y = height - pad - ((bests[d] / maxWatts) * (height - pad * 2));\n    return { x, y, val: bests[d], duration: d };\n  }).filter(p => p !== null);\n\n  if (points.length < 2) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">Insufficient data points</div>';\n    return;\n  }\n\n  const pathD = `M ${points.map(p => `${p!.x},${p!.y}`).join(' L ')}`;\n\n  // SVG Content\n  const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad}\" y1=\"${pad}\" x2=\"${pad}\" y2=\"${height - pad}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad}\" y1=\"${height - pad}\" x2=\"${width - pad}\" y2=\"${height - pad}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- Path -->\n            <path d=\"${pathD}\" fill=\"none\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n            \n            <!-- Points -->\n            ${points.map(p => `\n                <circle cx=\"${p!.x}\" cy=\"${p!.y}\" r=\"4\" fill=\"var(--card-bg)\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n                <text x=\"${p!.x}\" y=\"${p!.y - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-primary)\">${p!.val}W</text>\n                <text x=\"${p!.x}\" y=\"${height - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${formatDurationLabel(p!.duration)}</text>\n            `).join('')}\n        </svg>\n    `;\n\n  container.innerHTML = svg;\n}\n\nfunction formatDurationLabel(sec: number): string {\n  if (sec < 60) return `${sec}s`;\n  if (sec < 3600) return `${sec / 60}m`;\n  return `${sec / 3600}h`;\n}\n\n/**\n * Render Fitness Trend (CTL/ATL)\n */\nfunction renderFitnessTrend(workouts: Workout[]): void {\n  const container = document.getElementById('fitnessTrendChart');\n  if (!container) return;\n\n  // Sort workouts by date ascending\n  const sorted = [...workouts].sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n\n  if (sorted.length < 2) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">Not enough data for trend analysis</div>';\n    return;\n  }\n\n  // Daily TSS Map\n  const tssMap = new Map<string, number>();\n  sorted.forEach(w => {\n    const summary = getSummary(w);\n    if (summary.trainingLoad) {\n      const dateStr = new Date(w.startTime).toISOString().split('T')[0];\n      const current = tssMap.get(dateStr) || 0;\n      tssMap.set(dateStr, current + summary.trainingLoad);\n    }\n  });\n\n  // Calculate CTL/ATL day by day\n  const dataPoints: { date: Date, ctl: number, atl: number, tsb: number }[] = [];\n  const startDate = new Date(sorted[0].startTime);\n  const endDate = new Date(); // Today\n\n  // Constants\n  const kCTL = Math.exp(-1 / 42);\n  const kATL = Math.exp(-1 / 7);\n\n  let ctl = 0;\n  let atl = 0;\n\n  // Iterate day by day\n  for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {\n    const dateStr = d.toISOString().split('T')[0];\n    const tss = tssMap.get(dateStr) || 0;\n\n    ctl = ctl * kCTL + tss * (1 - kCTL);\n    atl = atl * kATL + tss * (1 - kATL);\n\n    dataPoints.push({\n      date: new Date(d),\n      ctl,\n      atl,\n      tsb: ctl - atl\n    });\n  }\n\n  // Chart Dimensions\n  const width = container.clientWidth || 600;\n  const height = 250;\n  const pad = { top: 20, right: 30, bottom: 30, left: 40 };\n  const chartW = width - pad.left - pad.right;\n  const chartH = height - pad.top - pad.bottom;\n\n  // Scales\n  const maxVal = Math.max(...dataPoints.map(p => Math.max(p.ctl, p.atl))) * 1.1;\n\n  const timeSpan = endDate.getTime() - startDate.getTime();\n  if (timeSpan === 0) return;\n\n  const getX = (date: Date) => pad.left + ((date.getTime() - startDate.getTime()) / timeSpan) * chartW;\n  const getY = (val: number) => pad.top + chartH - ((val / maxVal) * chartH);\n\n  // Generate Paths\n  const ctlPath = 'M ' + dataPoints.map(p => `${getX(p.date)},${getY(p.ctl)}`).join(' L ');\n  const atlPath = 'M ' + dataPoints.map(p => `${getX(p.date)},${getY(p.atl)}`).join(' L ');\n\n  // SVG Content\n  const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad.left}\" y1=\"${pad.top}\" x2=\"${pad.left}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad.left}\" y1=\"${height - pad.bottom}\" x2=\"${width - pad.right}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- CTL Line (Fitness) - Blue -->\n            <path d=\"${ctlPath}\" fill=\"none\" stroke=\"#3b82f6\" stroke-width=\"2\" />\n            \n            <!-- ATL Line (Fatigue) - Pink/Purple -->\n            <path d=\"${atlPath}\" fill=\"none\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n            \n            <!-- Legend -->\n            <g transform=\"translate(${pad.left + 10}, ${pad.top})\">\n                <rect x=\"0\" y=\"0\" width=\"10\" height=\"10\" fill=\"#3b82f6\" />\n                <text x=\"15\" y=\"10\" font-size=\"12\" fill=\"var(--color-text-secondary)\">Fitness (CTL)</text>\n                \n                <rect x=\"100\" y=\"0\" width=\"10\" height=\"10\" fill=\"none\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n                <text x=\"115\" y=\"10\" font-size=\"12\" fill=\"var(--color-text-secondary)\">Fatigue (ATL)</text>\n            </g>\n\n            <!-- Latest Stats -->\n             <text x=\"${width - pad.right}\" y=\"${pad.top}\" text-anchor=\"end\" font-size=\"12\" fill=\"var(--color-text-primary)\">\n                CTL: ${Math.round(ctl)} | ATL: ${Math.round(atl)} | TSB: ${Math.round(ctl - atl)}\n            </text>\n        </svg>\n    `;\n\n  container.innerHTML = svg;\n}\n\n/**\n * Render FTP History Chart\n */\nfunction renderFtpHistory(history: FtpHistoryEntry[]): void {\n  const container = document.getElementById('ftpHistoryChart');\n  if (!container) return;\n\n  if (history.length === 0) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">No FTP history available</div>';\n    return;\n  }\n\n  // Sort by date ascending\n  const sorted = [...history].sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n  // Chart Dimensions\n  const width = container.clientWidth || 600;\n  const height = 200;\n  const pad = { top: 20, right: 30, bottom: 30, left: 40 };\n  const chartW = width - pad.left - pad.right;\n  const chartH = height - pad.top - pad.bottom;\n\n  // Scales\n  const maxFtp = Math.max(...sorted.map(h => h.ftp)) * 1.1;\n  const minFtp = Math.max(0, Math.min(...sorted.map(h => h.ftp)) * 0.9);\n  const ftpRange = maxFtp - minFtp || 100; // avoid div by zero\n\n  const startDate = new Date(sorted[0].createdAt);\n  const endDate = new Date();\n  const timeSpan = endDate.getTime() - startDate.getTime();\n\n  const getX = (dateStr: string | Date) => {\n    const d = new Date(dateStr);\n    return pad.left + ((d.getTime() - startDate.getTime()) / timeSpan) * chartW;\n  };\n  const getY = (val: number) => pad.top + chartH - ((val - minFtp) / ftpRange) * chartH;\n\n  // Generate Path\n  let d = '';\n  if (sorted.length > 0) {\n    d = `M ${getX(sorted[0].createdAt)},${getY(sorted[0].ftp)}`;\n    for (let i = 1; i < sorted.length; i++) {\n      const currX = getX(sorted[i].createdAt);\n      const prevY = getY(sorted[i - 1].ftp);\n      const currY = getY(sorted[i].ftp);\n\n      // Step line: Horizontal then Vertical\n      d += ` L ${currX},${prevY} L ${currX},${currY}`;\n    }\n    // Extend to now\n    d += ` L ${width - pad.right},${getY(sorted[sorted.length - 1].ftp)}`;\n  }\n\n  // SVG Content\n  const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad.left}\" y1=\"${pad.top}\" x2=\"${pad.left}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad.left}\" y1=\"${height - pad.bottom}\" x2=\"${width - pad.right}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- FTP Line -->\n            <path d=\"${d}\" fill=\"none\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n            \n            <!-- Points -->\n            ${sorted.map(h => `\n                <circle cx=\"${getX(h.createdAt)}\" cy=\"${getY(h.ftp)}\" r=\"4\" fill=\"var(--card-bg)\" stroke=\"var(--color-accent)\" stroke-width=\"2\">\n                    <title>${h.ftp} W (${formatDate(h.createdAt)})</title>\n                </circle>\n                <text x=\"${getX(h.createdAt)}\" y=\"${getY(h.ftp) - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-primary)\">${h.ftp}</text>\n            `).join('')}\n\n            <!-- Axis Labels (simplified) -->\n            <text x=\"${pad.left}\" y=\"${height - 10}\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${formatDate(startDate)}</text>\n            <text x=\"${width - pad.right}\" y=\"${height - 10}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">Today</text>\n        </svg>\n    `;\n\n  container.innerHTML = svg;\n}\n\n/**\n * Render PR History (Chronological improvements)\n */\nfunction renderPrHistory(workouts: Workout[]): void {\n  const container = document.getElementById('prHistoryList');\n  if (!container) return;\n\n  // Sort strictly chronological\n  const sorted = [...workouts].sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n\n  interface RecordEvent {\n    date: string;\n    metric: string;\n    value: string;\n    improvement: string;\n    workoutId: string;\n  }\n\n  const events: RecordEvent[] = [];\n\n  // State to track maxes\n  let maxPower = 0;\n  let maxHr = 0;\n  const powerCurveBests: Record<number, number> = {};\n\n  sorted.forEach(w => {\n    const summary = getSummary(w);\n    const dateStr = formatDate(w.startTime);\n\n    // Power (1s)\n    if (summary.maxPower && summary.maxPower > maxPower) {\n      if (maxPower > 0) {\n        const diff = summary.maxPower - maxPower;\n        events.push({\n          date: dateStr,\n          metric: 'Max Power',\n          value: `${summary.maxPower} W`,\n          improvement: `+${diff} W`,\n          workoutId: w.id\n        });\n      } else {\n        events.push({ date: dateStr, metric: 'Max Power', value: `${summary.maxPower} W`, improvement: 'New!', workoutId: w.id });\n      }\n      maxPower = summary.maxPower;\n    }\n\n    // HR\n    if (summary.maxHeartrate && summary.maxHeartrate > maxHr) {\n      if (maxHr > 0) {\n        const diff = summary.maxHeartrate - maxHr;\n        events.push({\n          date: dateStr,\n          metric: 'Max Heart Rate',\n          value: `${summary.maxHeartrate} bpm`,\n          improvement: `+${diff} bpm`,\n          workoutId: w.id\n        });\n      } else {\n        events.push({ date: dateStr, metric: 'Max Heart Rate', value: `${summary.maxHeartrate} bpm`, improvement: 'New!', workoutId: w.id });\n      }\n      maxHr = summary.maxHeartrate;\n    }\n\n    // Power Curve - Notable durations (1m, 5m, 20m)\n    if (summary.powerCurve) {\n      const notable = [60, 300, 1200];\n      const labels: Record<number, string> = { 60: '1m Power', 300: '5m Power', 1200: '20m Power' };\n      summary.powerCurve.forEach((p: { duration: number, watts: number }) => {\n        if (notable.includes(p.duration)) {\n          const current = powerCurveBests[p.duration] || 0;\n          if (p.watts > current) {\n            if (current > 0) {\n              events.push({\n                date: dateStr,\n                metric: labels[p.duration],\n                value: `${p.watts} W`,\n                improvement: `+${p.watts - current} W`,\n                workoutId: w.id\n              });\n            } else {\n              events.push({ date: dateStr, metric: labels[p.duration], value: `${p.watts} W`, improvement: 'New!', workoutId: w.id });\n            }\n            powerCurveBests[p.duration] = p.watts;\n          }\n        }\n      });\n    }\n  });\n\n  if (events.length === 0) {\n    container.innerHTML = '<div style=\"text-align: center; color: var(--color-text-secondary); padding: 20px;\">No records found</div>';\n    return;\n  }\n\n  // Sort events reverse chronological (newest first)\n  const reversedEvents = events.reverse();\n\n  container.innerHTML = reversedEvents.map(e => `\n        <div class=\"pr-history-row\" data-id=\"${e.workoutId}\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--color-border); cursor: pointer;\">\n            <div style=\"flex: 1;\">\n                <div style=\"font-weight: 500;\">${e.metric}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">${e.date}</div>\n            </div>\n            <div style=\"text-align: right;\">\n                <div style=\"font-weight: bold; color: var(--color-accent);\">${e.value}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-success);\">${e.improvement}</div>\n            </div>\n        </div>\n    `).join('');\n\n  container.querySelectorAll('.pr-history-row').forEach(row => {\n    row.addEventListener('click', () => {\n      const id = (row as HTMLElement).dataset.id;\n      if (id) viewWorkoutDetails(id);\n    });\n  });\n}\n// Exported helper for the View\nexport async function refreshHistoryView(): Promise<void> {\n  // Reset to today if needed, or just refresh current view\n  if (currentView === 'list') {\n    await loadWorkouts();\n  } else if (currentView === 'calendar') {\n    await loadCalendar();\n  } else if (currentView === 'analytics') {\n    await loadAnalytics();\n  }\n}\n","import { View } from '../router/View.js';\nimport { initHistoryLogic, refreshHistoryView } from '../ui/workoutHistory.js';\n\nexport class HistoryView implements View {\n    public id = 'history';\n    private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('workoutHistoryTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initHistoryLogic();\n                this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('History template not found!');\n            container.innerHTML = '<p>Error loading history view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        if (this.isInitialized) {\n            refreshHistoryView();\n        } else {\n            // Fallback if onEnter is called too fast (shouldn't happen with sync init)\n            // logic is initialized in init(), but data might need loading\n            setTimeout(() => refreshHistoryView(), 50);\n        }\n    }\n\n    public onLeave(): void {\n        // Cleanup if needed\n    }\n}\n","/**\n * Workout Library\n * \n * Pre-built structured workouts.\n */\n\nimport type { StructuredWorkout, WorkoutStep } from './types.js';\n\nconst RAMP_TEST: StructuredWorkout = {\n    id: 'ramp-test',\n    name: 'Ramp Test',\n    description: 'Standard Ramp Test to estimate FTP. Start at 100W, increase by 20W every minute until failure.',\n    tags: ['test', 'ftp'],\n    steps: [\n        { type: 'warmup', duration: 300, targetType: 'open', description: 'Free warmup' },\n        { type: 'active', duration: 60, targetValue: 100, targetType: 'power', description: 'Step 1' },\n        { type: 'active', duration: 60, targetValue: 120, targetType: 'power', description: 'Step 2' },\n        { type: 'active', duration: 60, targetValue: 140, targetType: 'power', description: 'Step 3' },\n        { type: 'active', duration: 60, targetValue: 160, targetType: 'power', description: 'Step 4' },\n        { type: 'active', duration: 60, targetValue: 180, targetType: 'power', description: 'Step 5' },\n        { type: 'active', duration: 60, targetValue: 200, targetType: 'power', description: 'Step 6' },\n        { type: 'active', duration: 60, targetValue: 220, targetType: 'power', description: 'Step 7' },\n        { type: 'active', duration: 60, targetValue: 240, targetType: 'power', description: 'Step 8' },\n        { type: 'active', duration: 60, targetValue: 260, targetType: 'power', description: 'Step 9' },\n        { type: 'active', duration: 60, targetValue: 280, targetType: 'power', description: 'Step 10' },\n        { type: 'active', duration: 60, targetValue: 300, targetType: 'power', description: 'Step 11' },\n        { type: 'active', duration: 60, targetValue: 320, targetType: 'power', description: 'Step 12' },\n        { type: 'active', duration: 60, targetValue: 340, targetType: 'power', description: 'Step 13' },\n        { type: 'active', duration: 60, targetValue: 360, targetType: 'power', description: 'Step 14' },\n        { type: 'active', duration: 60, targetValue: 380, targetType: 'power', description: 'Step 15' },\n        { type: 'active', duration: 60, targetValue: 400, targetType: 'power', description: 'Step 16 (Elite!)' },\n        { type: 'cooldown', duration: 300, targetType: 'open', description: 'Cooldown' }\n    ]\n};\n\nconst SWEET_SPOT_3X10: StructuredWorkout = {\n    id: 'sweet-spot-3x10',\n    name: 'Sweet Spot 3x10',\n    description: 'Classic Sweet Spot workout to build aerobic engine. 3 intervals of 10 minutes at 88-93% FTP.',\n    tags: ['sweet-spot', 'aerobic'],\n    steps: [\n        { type: 'warmup', duration: 600, targetType: 'percent_ftp', targetValue: 50, description: 'Warmup' },\n        // Interval 1\n        { type: 'active', duration: 600, targetType: 'percent_ftp', targetValue: 90, description: 'Sweet Spot' },\n        { type: 'rest', duration: 300, targetType: 'percent_ftp', targetValue: 50, description: 'Recovery' },\n        // Interval 2\n        { type: 'active', duration: 600, targetType: 'percent_ftp', targetValue: 90, description: 'Sweet Spot' },\n        { type: 'rest', duration: 300, targetType: 'percent_ftp', targetValue: 50, description: 'Recovery' },\n        // Interval 3\n        { type: 'active', duration: 600, targetType: 'percent_ftp', targetValue: 90, description: 'Sweet Spot' },\n        { type: 'cooldown', duration: 600, targetType: 'percent_ftp', targetValue: 50, description: 'Cooldown' }\n    ]\n};\n\nconst VO2_MAX_30_30: StructuredWorkout = {\n    id: 'vo2-30-30',\n    name: 'VO2 Max 30/30s',\n    description: 'High intensity intervals. 3 sets of 8x 30s ON / 30s OFF.',\n    tags: ['vo2max', 'hiit'],\n    steps: [\n        { type: 'warmup', duration: 600, targetType: 'percent_ftp', targetValue: 50, description: 'Warmup' },\n        { type: 'warmup', duration: 60, targetType: 'percent_ftp', targetValue: 100, description: 'Opener' },\n        { type: 'rest', duration: 120, targetType: 'percent_ftp', targetValue: 50, description: 'Recover' },\n\n        // Set 1 (8 reps)\n        ...Array(8).fill(null).flatMap((_, i) => [\n            { type: 'active', duration: 30, targetType: 'percent_ftp', targetValue: 120, description: `Rep ${i + 1}` } as WorkoutStep,\n            { type: 'rest', duration: 30, targetType: 'percent_ftp', targetValue: 50, description: 'Float' } as WorkoutStep\n        ]),\n\n        { type: 'rest', duration: 300, targetType: 'percent_ftp', targetValue: 50, description: 'Set Recovery' },\n\n        // Set 2 (8 reps)\n        ...Array(8).fill(null).flatMap((_, i) => [\n            { type: 'active', duration: 30, targetType: 'percent_ftp', targetValue: 120, description: `Rep ${i + 1}` } as WorkoutStep,\n            { type: 'rest', duration: 30, targetType: 'percent_ftp', targetValue: 50, description: 'Float' } as WorkoutStep\n        ]),\n\n        { type: 'cooldown', duration: 600, targetType: 'percent_ftp', targetValue: 40, description: 'Cooldown' }\n    ]\n};\n\nexport const WORKOUT_LIBRARY: StructuredWorkout[] = [\n    RAMP_TEST,\n    SWEET_SPOT_3X10,\n    VO2_MAX_30_30\n];\n\nexport function getWorkoutById(id: string): StructuredWorkout | undefined {\n    return WORKOUT_LIBRARY.find(w => w.id === id);\n}\n\n/**\n * Calculate total duration in seconds\n */\nexport function getWorkoutDuration(workout: StructuredWorkout): number {\n    return workout.steps.reduce((acc, step) => acc + step.duration, 0);\n}\n","/**\n * Notification utilities\n * \n * Displays toast-style notifications to the user.\n * Accessible to screen readers via role=\"alert\".\n * \n * Now uses the bpt-toast Web Component when available,\n * with fallback to inline styles for progressive enhancement.\n * \n * @module notifications\n */\n\nimport { Toast } from '../components/Toast.js';\n\n/**\n * Notification types\n */\nexport type NotificationType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Show a notification to the user\n * \n * Creates an accessible toast notification that:\n * - Is announced to screen readers via role=\"alert\"\n * - Has proper color contrast (WCAG AA compliant)\n * - Respects reduced motion preferences\n * \n * @param message - The message to display\n * @param type - The type of notification (affects styling)\n * @param duration - How long to show the notification (ms)\n */\nexport function showNotification(\n    message: string,\n    type: NotificationType = 'info',\n    duration = 3000\n): void {\n    // Use the Web Component if available\n    if (customElements.get('bpt-toast')) {\n        Toast.show(message, type, { duration });\n        return;\n    }\n\n    // Fallback to inline notification (for cases where components aren't loaded)\n    const notification = document.createElement('div');\n\n    // Use WCAG AA compliant colors\n    const backgroundColor = type === 'error' ? '#b91c1c'\n        : type === 'success' ? '#15803d'\n            : type === 'warning' ? '#a16207'\n                : '#1d4ed8';\n\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    notification.style.cssText = `\n    position: fixed;\n    top: 80px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: ${backgroundColor};\n    color: white;\n    padding: 12px 24px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 1001;\n    font-size: 14px;\n    max-width: 90%;\n    text-align: center;\n    font-weight: 500;\n  `;\n\n    notification.textContent = message;\n    document.body.appendChild(notification);\n\n    setTimeout(() => {\n        // Check for reduced motion preference\n        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n        if (prefersReducedMotion) {\n            notification.remove();\n        } else {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 0.3s ease';\n            setTimeout(() => notification.remove(), 300);\n        }\n    }, duration);\n}\n\n","/**\n * Safely select a DOM element by ID.\n * Throws a specific error if the element is not found,\n * allowing for easier debugging than standard null pointer exceptions.\n * \n * @param id The ID of the element to select\n * @returns The selected element\n * @throws Error if element not found\n */\nexport function selectElement<T extends HTMLElement>(id: string): T {\n    const element = document.getElementById(id);\n    if (!element) {\n        throw new Error(`Critical DOM element missing: #${id}. Ensure index.html is correct.`);\n    }\n    return element as T;\n}\n","/**\n * Onboarding Flow\n *\n * First-run setup wizard for new users.\n * Guides users through:\n * - FTP (Functional Threshold Power) entry\n * - Max Heart Rate entry\n * - Weight entry\n * - Sensor pairing guide\n * - Feature tour\n *\n * @module onboarding\n */\n\nimport { announce, trapFocus } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { selectElement } from '../utils/dom.js';\n\n/**\n * User profile settings for training zones\n */\nexport interface UserProfile {\n    /** Functional Threshold Power in watts */\n    ftp: number | null;\n    /** Maximum heart rate in bpm */\n    maxHr: number | null;\n    /** Body weight in kg */\n    weight: number | null;\n    /** Whether onboarding has been completed */\n    onboardingComplete: boolean;\n    /** Timestamp of last profile update */\n    lastUpdated: number | null;\n}\n\n/** Storage key for user profile */\nconst PROFILE_KEY = 'bpt-user-profile';\n\n/** Default profile values */\nconst defaultProfile: UserProfile = {\n    ftp: null,\n    maxHr: null,\n    weight: null,\n    onboardingComplete: false,\n    lastUpdated: null,\n};\n\n/**\n * Load user profile from localStorage\n */\nexport function loadUserProfile(): UserProfile {\n    try {\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return { ...defaultProfile, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ...defaultProfile };\n}\n\n/**\n * Save user profile to localStorage\n */\nexport function saveUserProfile(profile: UserProfile): void {\n    try {\n        profile.lastUpdated = Date.now();\n        localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));\n    } catch (e) {\n        console.warn('Failed to save user profile:', e);\n    }\n}\n\n/**\n * Onboarding step configuration\n */\ninterface OnboardingStep {\n    id: string;\n    title: string;\n    icon: string;\n    content: string;\n    inputType?: 'number' | 'none';\n    inputLabel?: string;\n    inputPlaceholder?: string;\n    inputUnit?: string;\n    inputMin?: number;\n    inputMax?: number;\n    profileKey?: keyof UserProfile;\n    helpText?: string;\n}\n\n/**\n * Onboarding steps configuration\n */\nconst onboardingSteps: OnboardingStep[] = [\n    {\n        id: 'welcome',\n        title: 'Welcome to Bike Power Tracker!',\n        icon: '',\n        content: `\n            <p>Let's set up your profile for personalized training zones and better workout analysis.</p>\n            <p>This will only take a minute, and you can update these settings anytime.</p>\n        `,\n    },\n    {\n        id: 'ftp',\n        title: 'Functional Threshold Power (FTP)',\n        icon: '',\n        content: `\n            <p>Your FTP is the highest power you can sustain for about an hour.</p>\n            <p>If you don't know your FTP, you can skip this and do an FTP test later.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your FTP',\n        inputPlaceholder: 'e.g., 200',\n        inputUnit: 'watts',\n        inputMin: 50,\n        inputMax: 500,\n        profileKey: 'ftp',\n        helpText: 'Typical range: 100-400W for recreational to elite cyclists',\n    },\n    {\n        id: 'maxhr',\n        title: 'Maximum Heart Rate',\n        icon: '',\n        content: `\n            <p>Your max HR is used to calculate heart rate training zones.</p>\n            <p>A common estimate is 220 minus your age, but actual max HR varies.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Max HR',\n        inputPlaceholder: 'e.g., 185',\n        inputUnit: 'bpm',\n        inputMin: 100,\n        inputMax: 230,\n        profileKey: 'maxHr',\n        helpText: 'If unsure, use 220 - your age as a starting point',\n    },\n    {\n        id: 'weight',\n        title: 'Body Weight',\n        icon: '',\n        content: `\n            <p>Your weight is used to calculate power-to-weight ratio (W/kg), an important metric for climbing.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Weight',\n        inputPlaceholder: 'e.g., 70',\n        inputUnit: 'kg',\n        inputMin: 30,\n        inputMax: 200,\n        profileKey: 'weight',\n        helpText: 'Used for calculating watts per kilogram (W/kg)',\n    },\n    {\n        id: 'sensors',\n        title: 'Connect Your Sensors',\n        icon: '',\n        content: `\n            <p>Bike Power Tracker works with Bluetooth cycling sensors:</p>\n            <ul style=\"text-align: left; margin: 16px auto; max-width: 280px;\">\n                <li><strong> Power Meter</strong> - Measures your power output in watts</li>\n                <li><strong> Cadence Sensor</strong> - Tracks your pedaling speed (RPM)</li>\n                <li><strong> Heart Rate Monitor</strong> - Monitors your heart rate</li>\n            </ul>\n            <p>Use the menu () to connect your sensors before starting a workout.</p>\n        `,\n    },\n    {\n        id: 'shortcuts',\n        title: 'Keyboard Shortcuts',\n        icon: '',\n        content: `\n            <p>Quick access to common actions:</p>\n            <table style=\"margin: 16px auto; text-align: left; border-collapse: collapse;\">\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Space</kbd></td><td>Start/pause workout</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>L</kbd></td><td>Mark lap</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>M</kbd></td><td>Open menu</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>S</kbd></td><td>Open settings</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>E</kbd></td><td>Export data</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Escape</kbd></td><td>Close modal</td></tr>\n            </table>\n        `,\n    },\n    {\n        id: 'done',\n        title: 'You\\'re All Set!',\n        icon: '',\n        content: `\n            <p>Your profile has been saved. You can update your settings anytime from the menu.</p>\n            <p>Ready to start your first workout? Connect a sensor and press the <strong> Start</strong> button!</p>\n        `,\n    },\n];\n\n/**\n * Create the onboarding modal element\n */\nfunction createOnboardingModal(): HTMLElement {\n    const modal = document.createElement('div');\n    modal.id = 'onboardingModal';\n    modal.className = 'stream-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-labelledby', 'onboardingTitle');\n    modal.setAttribute('aria-modal', 'true');\n    modal.style.display = 'none';\n\n    modal.innerHTML = `\n        <div class=\"stream-modal-content onboarding-modal\" style=\"max-width: 480px;\">\n            <div class=\"stream-modal-header\">\n                <h2 id=\"onboardingTitle\">\n                    <span id=\"onboardingIcon\"></span>\n                    <span id=\"onboardingStepTitle\">Welcome</span>\n                </h2>\n                <button id=\"skipOnboarding\" class=\"close-button\" aria-label=\"Skip onboarding\">&times;</button>\n            </div>\n            <div class=\"stream-modal-body\" style=\"text-align: center; padding: 24px;\">\n                <div id=\"onboardingContent\"></div>\n                <div id=\"onboardingInput\" style=\"margin: 20px 0; display: none;\">\n                    <label for=\"onboardingInputField\" id=\"onboardingInputLabel\" style=\"display: block; margin-bottom: 8px; font-weight: bold;\"></label>\n                    <div style=\"display: flex; align-items: center; justify-content: center; gap: 8px;\">\n                        <input type=\"number\" id=\"onboardingInputField\" \n                            style=\"width: 120px; padding: 12px; font-size: 18px; text-align: center; border: 2px solid #d0d7de; border-radius: 8px;\"\n                            aria-describedby=\"onboardingHelpText\">\n                        <span id=\"onboardingInputUnit\" style=\"font-size: 16px; color: #666;\"></span>\n                    </div>\n                    <p id=\"onboardingHelpText\" style=\"margin-top: 8px; font-size: 12px; color: #666;\"></p>\n                </div>\n                <div class=\"onboarding-progress\" style=\"margin: 24px 0;\">\n                    <div id=\"onboardingProgressDots\" style=\"display: flex; justify-content: center; gap: 8px;\"></div>\n                </div>\n                <div class=\"onboarding-buttons\" style=\"display: flex; justify-content: center; gap: 12px; margin-top: 20px;\">\n                    <button id=\"onboardingPrev\" style=\"padding: 12px 24px; border: 1px solid #d0d7de; background: white; border-radius: 8px; cursor: pointer; font-size: 16px;\">\n                         Back\n                    </button>\n                    <button id=\"onboardingNext\" style=\"padding: 12px 24px; border: none; background: #2196F3; color: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;\">\n                        Next \n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Render progress dots\n */\nfunction renderProgressDots(container: HTMLElement, currentStep: number, totalSteps: number): void {\n    container.innerHTML = '';\n    for (let i = 0; i < totalSteps; i++) {\n        const dot = document.createElement('span');\n        dot.style.cssText = `\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n            background: ${i === currentStep ? '#2196F3' : '#d0d7de'};\n            transition: background 0.3s ease;\n        `;\n        dot.setAttribute('aria-hidden', 'true');\n        container.appendChild(dot);\n    }\n}\n\n/**\n * Render a step in the onboarding flow\n */\nfunction renderStep(\n    step: OnboardingStep,\n    stepIndex: number,\n    profile: UserProfile,\n    elements: {\n        icon: HTMLElement;\n        title: HTMLElement;\n        content: HTMLElement;\n        inputContainer: HTMLElement;\n        inputField: HTMLInputElement;\n        inputLabel: HTMLElement;\n        inputUnit: HTMLElement;\n        helpText: HTMLElement;\n        prevBtn: HTMLButtonElement;\n        nextBtn: HTMLButtonElement;\n        progressDots: HTMLElement;\n    }\n): void {\n    const { icon, title, content, inputContainer, inputField, inputLabel, inputUnit, helpText, prevBtn, nextBtn, progressDots } = elements;\n\n    // Update header\n    icon.textContent = step.icon;\n    title.textContent = step.title;\n\n    // Update content\n    content.innerHTML = step.content;\n\n    // Handle input\n    if (step.inputType === 'number' && step.profileKey) {\n        inputContainer.style.display = 'block';\n        inputLabel.textContent = step.inputLabel || '';\n        inputField.placeholder = step.inputPlaceholder || '';\n        inputField.min = String(step.inputMin || 0);\n        inputField.max = String(step.inputMax || 9999);\n        inputUnit.textContent = step.inputUnit || '';\n        helpText.textContent = step.helpText || '';\n\n        // Load existing value\n        const currentValue = profile[step.profileKey];\n        inputField.value = currentValue ? String(currentValue) : '';\n        inputField.focus();\n    } else {\n        inputContainer.style.display = 'none';\n    }\n\n    // Update buttons\n    prevBtn.style.display = stepIndex === 0 ? 'none' : 'inline-block';\n\n    if (stepIndex === onboardingSteps.length - 1) {\n        nextBtn.textContent = 'Get Started! ';\n    } else if (step.inputType === 'number') {\n        nextBtn.textContent = 'Next ';\n    } else {\n        nextBtn.textContent = 'Next ';\n    }\n\n    // Update progress dots\n    renderProgressDots(progressDots, stepIndex, onboardingSteps.length);\n\n    // Announce for screen readers\n    announce(`Step ${stepIndex + 1} of ${onboardingSteps.length}: ${step.title}`);\n}\n\n/**\n * Show the onboarding flow\n */\nexport function showOnboarding(forceShow = false): Promise<UserProfile> {\n    return new Promise((resolve) => {\n        const profile = loadUserProfile();\n\n        // Check if onboarding should be shown\n        if (!forceShow && profile.onboardingComplete) {\n            resolve(profile);\n            return;\n        }\n\n        // Create modal if it doesn't exist\n        let modal = document.getElementById('onboardingModal');\n        if (!modal) {\n            modal = createOnboardingModal();\n            document.body.appendChild(modal);\n        }\n\n        // Get elements\n        const icon = selectElement('onboardingIcon');\n        const title = selectElement('onboardingStepTitle');\n        const content = selectElement('onboardingContent');\n        const inputContainer = selectElement('onboardingInput');\n        const inputField = selectElement<HTMLInputElement>('onboardingInputField');\n        const inputLabel = selectElement('onboardingInputLabel');\n        const inputUnit = selectElement('onboardingInputUnit');\n        const helpText = selectElement('onboardingHelpText');\n        const prevBtn = selectElement<HTMLButtonElement>('onboardingPrev');\n        const nextBtn = selectElement<HTMLButtonElement>('onboardingNext');\n        const skipBtn = selectElement<HTMLButtonElement>('skipOnboarding');\n        const progressDots = selectElement('onboardingProgressDots');\n\n        const elements = { icon, title, content, inputContainer, inputField, inputLabel, inputUnit, helpText, prevBtn, nextBtn, progressDots };\n\n        let currentStep = 0;\n\n        // Save input value for current step\n        const saveCurrentInput = (): void => {\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number' && step.profileKey) {\n                const value = inputField.value ? parseFloat(inputField.value) : null;\n                if (value !== null && step.profileKey !== 'onboardingComplete' && step.profileKey !== 'lastUpdated') {\n                    profile[step.profileKey] = value;\n                }\n            }\n        };\n\n        // Render current step\n        const render = (): void => {\n            renderStep(onboardingSteps[currentStep], currentStep, profile, elements);\n        };\n\n        // Navigation handlers\n        const goNext = (): void => {\n            // Validate input if it's a number step\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number') {\n                if (!inputField.checkValidity()) {\n                    inputField.reportValidity();\n                    return;\n                }\n            }\n\n            saveCurrentInput();\n\n            if (currentStep < onboardingSteps.length - 1) {\n                currentStep++;\n                render();\n            } else {\n                // Complete onboarding\n                profile.onboardingComplete = true;\n                saveUserProfile(profile);\n                modal!.style.display = 'none';\n                showNotification('Profile saved! Ready to ride ', 'success');\n                announce('Onboarding complete. Profile saved.');\n                resolve(profile);\n            }\n        };\n\n        const goPrev = (): void => {\n            saveCurrentInput();\n            if (currentStep > 0) {\n                currentStep--;\n                render();\n            }\n        };\n\n        const skip = (): void => {\n            profile.onboardingComplete = true;\n            saveUserProfile(profile);\n            modal!.style.display = 'none';\n            announce('Onboarding skipped');\n            resolve(profile);\n        };\n\n        // Event listeners\n        nextBtn.addEventListener('click', goNext);\n        prevBtn.addEventListener('click', goPrev);\n        skipBtn.addEventListener('click', skip);\n\n        // Enter key advances\n        inputField.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                goNext();\n            }\n        });\n\n        // Show modal\n        modal.style.display = 'flex';\n        render();\n        trapFocus(modal.querySelector('.stream-modal-content')!);\n    });\n}\n\n/**\n * Check if user should see onboarding\n */\nexport function shouldShowOnboarding(): boolean {\n    const profile = loadUserProfile();\n    return !profile.onboardingComplete;\n}\n\n/**\n * Initialize onboarding - shows wizard if first run\n */\nexport function initOnboarding(): void {\n    if (shouldShowOnboarding()) {\n        // Small delay to let the app render first\n        setTimeout(() => {\n            showOnboarding();\n        }, 500);\n    }\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nexport function calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.90) },\n        { name: 'Threshold', min: Math.round(ftp * 0.90), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.20) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.20), max: Math.round(ftp * 1.50) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.50), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nexport function calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.50), max: Math.round(maxHr * 0.60) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.60), max: Math.round(maxHr * 0.70) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.70), max: Math.round(maxHr * 0.80) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.80), max: Math.round(maxHr * 0.90) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.90), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nexport function getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nexport function getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n","/**\n * Audio cues for workouts and notifications\n * Using Web Audio API for synthetic sounds (no assets needed)\n * and SpeechSynthesis for voice announcements.\n */\n\nclass AudioController {\n    private audioCtx: AudioContext | null = null;\n    private gainNode: GainNode | null = null;\n    private isMuted: boolean = false;\n\n    constructor() {\n        // Initialize AudioContext on first user interaction if possible\n        // But for now we just prepare it.\n        // Modern browsers require user gesture to resume AudioContext.\n    }\n\n    public init() {\n        this.ensureContext();\n    }\n\n    private ensureContext() {\n        if (!this.audioCtx) {\n            const Ctx = window.AudioContext || (window as any).webkitAudioContext;\n            if (Ctx) {\n                this.audioCtx = new Ctx();\n                this.gainNode = this.audioCtx.createGain();\n                this.gainNode.connect(this.audioCtx.destination);\n                this.gainNode.gain.value = 0.5; // Default volume\n            }\n        }\n\n        if (this.audioCtx && this.audioCtx.state === 'suspended') {\n            this.audioCtx.resume();\n        }\n    }\n\n    public setMuted(muted: boolean) {\n        this.isMuted = muted;\n    }\n\n    /**\n     * Play a synthesized beep\n     * @param freq Frequency in Hz\n     * @param duration Duration in ms\n     * @param type Oscillator type\n     */\n    public beep(freq: number = 440, duration: number = 200, type: OscillatorType = 'sine') {\n        if (this.isMuted) return;\n        this.ensureContext();\n\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const osc = this.audioCtx.createOscillator();\n        const gain = this.audioCtx.createGain();\n\n        osc.type = type;\n        osc.frequency.setValueAtTime(freq, this.audioCtx.currentTime);\n\n        // Envelope to avoid clicking\n        gain.gain.setValueAtTime(0, this.audioCtx.currentTime);\n        gain.gain.linearRampToValueAtTime(0.5, this.audioCtx.currentTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.001, this.audioCtx.currentTime + (duration / 1000));\n\n        osc.connect(gain);\n        gain.connect(this.gainNode);\n\n        osc.start();\n        osc.stop(this.audioCtx.currentTime + (duration / 1000));\n    }\n\n    /**\n     * Play a sequence of beeps (e.g. countdown)\n     * High pitch: 880Hz, Low pitch: 440Hz\n     */\n    public playCountdown() {\n        this.beep(440, 150); // 3\n    }\n\n    public playStart() {\n        this.beep(880, 400); // GO\n    }\n\n    public playSuccess() {\n        if (this.isMuted) return;\n        this.ensureContext();\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const now = this.audioCtx.currentTime;\n\n        // Arpeggio C E G\n        this.scheduleNote(523.25, now, 0.1);\n        this.scheduleNote(659.25, now + 0.1, 0.1);\n        this.scheduleNote(783.99, now + 0.2, 0.2);\n    }\n\n    private scheduleNote(freq: number, startTime: number, duration: number) {\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const osc = this.audioCtx.createOscillator();\n        const gain = this.audioCtx.createGain();\n\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0, startTime);\n        gain.gain.linearRampToValueAtTime(0.3, startTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);\n\n        osc.connect(gain);\n        gain.connect(this.gainNode);\n\n        osc.start(startTime);\n        osc.stop(startTime + duration);\n    }\n\n    /**\n     * Speak text using SpeechSynthesis\n     */\n    public speak(text: string) {\n        if (this.isMuted || !window.speechSynthesis) return;\n\n        // Cancel current utterance\n        window.speechSynthesis.cancel();\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        utterance.rate = 1.0;\n        utterance.pitch = 1.0;\n        utterance.volume = 1.0;\n\n        window.speechSynthesis.speak(utterance);\n    }\n}\n\nexport const audioManager = new AudioController();\n","/**\n * Workout Runner\n * \n * Manages the execution state of a structured workout.\n */\n\nimport type { StructuredWorkout, WorkoutStep } from './types.js';\nimport { loadUserProfile } from '../ui/onboarding.js';\nimport { audioManager } from '../ui/audio.js';\n\nexport interface RunnerState {\n    workout: StructuredWorkout;\n    currentStepIndex: number;\n    stepElapsedTime: number; // Seconds\n    totalElapsedTime: number;\n    currentStep: WorkoutStep;\n    nextStep: WorkoutStep | null;\n    targetPower: number | null; // Calculated watts\n    isPaused: boolean;\n    isFinished: boolean;\n}\n\nexport type StateChangeCallback = (state: RunnerState) => void;\n\nexport class WorkoutRunner {\n    private state: RunnerState;\n    private timerInterval: ReturnType<typeof setInterval> | null = null;\n    private onStateChange: StateChangeCallback | null = null;\n    private userFtp: number = 200; // Default fallback\n\n    constructor(workout: StructuredWorkout) {\n        // Load User FTP\n        const profile = loadUserProfile();\n        if (profile.ftp) {\n            this.userFtp = profile.ftp;\n        }\n\n        this.state = {\n            workout,\n            currentStepIndex: 0,\n            stepElapsedTime: 0,\n            totalElapsedTime: 0,\n            currentStep: workout.steps[0],\n            nextStep: workout.steps.length > 1 ? workout.steps[1] : null,\n            targetPower: this.calculateTargetPower(workout.steps[0]),\n            isPaused: true,\n            isFinished: false\n        };\n    }\n\n    /**\n     * Set callback for state updates\n     */\n    public setCallback(cb: StateChangeCallback): void {\n        this.onStateChange = cb;\n        // Emit initial state\n        cb(this.state);\n    }\n\n    /**\n     * Start or Resume the workout\n     */\n    public start(): void {\n        if (this.state.isFinished) return;\n        if (!this.state.isPaused && this.timerInterval) return;\n\n        this.state.isPaused = false;\n        this.emitState();\n\n        this.timerInterval = setInterval(() => {\n            this.tick();\n        }, 1000);\n    }\n\n    /**\n     * Pause the workout\n     */\n    public pause(): void {\n        this.state.isPaused = true;\n        if (this.timerInterval) {\n            clearInterval(this.timerInterval);\n            this.timerInterval = null;\n        }\n        this.emitState();\n    }\n\n    /**\n     * Skip to next step\n     */\n    public nextStep(): void {\n        this.advanceStep();\n    }\n\n    /**\n     * Stop and cleanup\n     */\n    public stop(): void {\n        this.pause();\n        this.onStateChange = null;\n    }\n\n    private tick(): void {\n        if (this.state.isPaused || this.state.isFinished) return;\n\n        this.state.stepElapsedTime++;\n        this.state.totalElapsedTime++;\n\n        const remaining = this.state.currentStep.duration - this.state.stepElapsedTime;\n\n        // Audio Cues (3, 2, 1)\n        if (remaining <= 3 && remaining > 0) {\n            audioManager.playCountdown();\n        }\n\n        // Check if step is complete\n        if (this.state.stepElapsedTime >= this.state.currentStep.duration) {\n            this.advanceStep();\n        } else {\n            this.emitState();\n        }\n    }\n\n    private advanceStep(): void {\n        const nextIndex = this.state.currentStepIndex + 1;\n\n        if (nextIndex >= this.state.workout.steps.length) {\n            this.finish();\n            return;\n        }\n\n        this.state.currentStepIndex = nextIndex;\n        this.state.currentStep = this.state.workout.steps[nextIndex];\n        this.state.nextStep = nextIndex + 1 < this.state.workout.steps.length\n            ? this.state.workout.steps[nextIndex + 1]\n            : null;\n\n        this.state.stepElapsedTime = 0;\n        this.state.targetPower = this.calculateTargetPower(this.state.currentStep);\n\n        // Play interval start sound\n        audioManager.playStart();\n\n        this.emitState();\n    }\n\n    private finish(): void {\n        this.state.isFinished = true;\n        this.pause();\n        audioManager.playSuccess();\n        this.emitState();\n    }\n\n    private calculateTargetPower(step: WorkoutStep): number | null {\n        if (!step.targetValue) return null;\n\n        if (step.targetType === 'power') {\n            return step.targetValue;\n        } else if (step.targetType === 'percent_ftp') {\n            return Math.round(this.userFtp * (step.targetValue / 100));\n        }\n\n        return null;\n    }\n\n    private emitState(): void {\n        if (this.onStateChange) {\n            this.onStateChange({ ...this.state });\n        }\n    }\n\n    public getState(): RunnerState {\n        return { ...this.state };\n    }\n}\n","/**\n * Custom Workout Storage\n * \n * Manages saving and loading user-created structured workouts in LocalStorage.\n */\n\nimport type { StructuredWorkout } from '../workouts/types.js';\n\nconst STORAGE_KEY = 'bpt_custom_workouts';\n\n/**\n * Get all custom workouts\n */\nexport function getCustomWorkouts(): StructuredWorkout[] {\n    try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return [];\n        return JSON.parse(raw);\n    } catch (e) {\n        console.error('Failed to load custom workouts', e);\n        return [];\n    }\n}\n\n/**\n * Save a custom workout\n */\nexport function saveCustomWorkout(workout: StructuredWorkout): void {\n    const workouts = getCustomWorkouts();\n\n    // Check if updating existing\n    const index = workouts.findIndex(w => w.id === workout.id);\n    if (index >= 0) {\n        workouts[index] = workout;\n    } else {\n        workouts.push(workout);\n    }\n\n    saveAll(workouts);\n}\n\n/**\n * Delete a custom workout\n */\nexport function deleteCustomWorkout(id: string): void {\n    const workouts = getCustomWorkouts();\n    const filtered = workouts.filter(w => w.id !== id);\n    saveAll(filtered);\n}\n\nfunction saveAll(workouts: StructuredWorkout[]): void {\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(workouts));\n    } catch (e) {\n        console.error('Failed to save custom workouts', e);\n        alert('Failed to save workout. Storage might be full.');\n    }\n}\n","/**\n * Workout UI Manager\n * \n * Handles the Workout Selection Modal and the Active Workout Player Overlay.\n */\n\nimport { WORKOUT_LIBRARY, getWorkoutDuration } from '../workouts/workoutLibrary.js';\nimport type { StructuredWorkout, WorkoutStep } from '../workouts/types.js';\nimport { WorkoutRunner, type RunnerState } from '../workouts/WorkoutRunner.js';\nimport { formatDuration } from '../api/workoutClient.js';\nimport { announce } from './accessibility.js';\nimport { audioManager } from './audio.js';\nimport { getCustomWorkouts, deleteCustomWorkout, saveCustomWorkout } from '../storage/customWorkouts.js';\n\nlet activeRunner: WorkoutRunner | null = null;\n// let playerVisible = false;\n\n// export function initWorkoutUI(): void {\n//     initSelectionModal();\n//     initPlayerControls();\n//     initImportExport();\n// }\n\n/**\n * Initialize Workout Selection Logic\n * Call this from the Workouts View\n */\nexport function initWorkoutSelectionLogic(): void {\n    initPlayerControls(); // Logic only, assuming container exists\n    initImportExport();\n    refreshWorkoutList();\n}\n\n\n/**\n * Initialize Import/Export controls\n */\nfunction initImportExport(): void {\n    const importBtn = document.getElementById('importWorkoutBtn');\n    const importInput = document.getElementById('importWorkoutInput') as HTMLInputElement;\n\n    if (importBtn && importInput) {\n        importBtn.addEventListener('click', () => {\n            importInput.click();\n        });\n\n        importInput.addEventListener('change', (e) => {\n            const files = (e.target as HTMLInputElement).files;\n            if (files && files.length > 0) {\n                importWorkoutFile(files[0]);\n                // Reset input\n                importInput.value = '';\n            }\n        });\n    }\n}\n\nasync function importWorkoutFile(file: File): Promise<void> {\n    try {\n        const text = await file.text();\n        const workout = JSON.parse(text);\n\n        // Basic validation\n        if (!workout.name || !Array.isArray(workout.steps)) {\n            throw new Error('Invalid workout format');\n        }\n\n        // Ensure unique ID for imported workout\n        workout.id = crypto.randomUUID();\n        workout.tags = [...(workout.tags || []), 'imported'];\n\n        saveCustomWorkout(workout);\n        refreshWorkoutList();\n        announce(`Imported workout: ${workout.name}`, 'assertive');\n    } catch (err) {\n        console.error('Import failed', err);\n        alert('Failed to import workout: Invalid file format.');\n    }\n}\n\nfunction exportWorkout(workout: StructuredWorkout): void {\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(workout, null, 2));\n    const downloadAnchorNode = document.createElement('a');\n    downloadAnchorNode.setAttribute(\"href\", dataStr);\n    downloadAnchorNode.setAttribute(\"download\", `${workout.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`);\n    document.body.appendChild(downloadAnchorNode); // required for firefox\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n}\n\n// function initSelectionModal(): void {\n//     const btn = document.getElementById('workoutsButton');\n//     const modal = document.getElementById('workoutSelectionModal');\n//     const closeBtn = document.getElementById('closeWorkoutModal');\n//     // const list = document.getElementById('workoutList'); \n\n//     if (!btn || !modal || !closeBtn) return;\n\n//     // Open Modal\n//     btn.addEventListener('click', () => {\n//         modal.style.display = 'flex';\n//         refreshWorkoutList();\n//         announce('Workout selection opened', 'polite');\n//     });\n\n//     // Close Modal\n//     closeBtn.addEventListener('click', () => {\n//         modal.style.display = 'none';\n//     });\n// }\n\n/**\n * Render list of workouts (Exported for Builder to update)\n */\nexport function refreshWorkoutList(): void {\n    const container = document.getElementById('workoutList');\n    if (!container) return;\n\n    container.innerHTML = '';\n\n    const custom = getCustomWorkouts();\n\n    if (custom.length > 0) {\n        const h3 = document.createElement('h3');\n        h3.textContent = 'My Workouts';\n        h3.style.margin = '0 0 8px 0';\n        h3.style.fontSize = '1rem';\n        h3.style.color = 'var(--color-text-secondary)';\n        container.appendChild(h3);\n\n        custom.forEach(w => renderWorkoutItem(w, container, true));\n\n        const hr = document.createElement('hr');\n        hr.style.margin = '16px 0';\n        hr.style.border = '0';\n        hr.style.borderTop = '1px solid var(--color-border)';\n        container.appendChild(hr);\n\n        const h3lib = document.createElement('h3');\n        h3lib.textContent = 'Library';\n        h3lib.style.margin = '0 0 8px 0';\n        h3lib.style.fontSize = '1rem';\n        h3lib.style.color = 'var(--color-text-secondary)';\n        container.appendChild(h3lib);\n    }\n\n    WORKOUT_LIBRARY.forEach(w => renderWorkoutItem(w, container, false));\n}\n\nfunction renderWorkoutItem(w: StructuredWorkout, container: HTMLElement, isCustom: boolean): void {\n    const duration = getWorkoutDuration(w);\n\n    const el = document.createElement('div');\n    el.className = 'workout-item';\n    el.setAttribute('role', 'button');\n    el.setAttribute('tabindex', '0');\n    el.style.position = 'relative'; // For action buttons\n\n    let actionsHtml = '';\n    // Always allow exporting, but deleting only for custom\n    actionsHtml += `<button class=\"export-workout-btn\" aria-label=\"Export ${w.name}\" title=\"Export JSON\" style=\"background: none; border: none; font-size: 1.2rem; cursor: pointer;\"></button>`;\n\n    if (isCustom) {\n        actionsHtml += `<button class=\"delete-workout-btn\" aria-label=\"Delete ${w.name}\" title=\"Delete\" style=\"background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--color-error);\"></button>`;\n    }\n\n    const actionContainerStyle = \"position: absolute; right: 10px; top: 10px; display: flex; gap: 8px; z-index: 2;\";\n\n    el.innerHTML = `\n        <div class=\"workout-item-header\">\n            <span class=\"workout-item-title\">${w.name}</span>\n            <span class=\"workout-item-duration\"> ${formatDuration(duration * 1000)}</span>\n        </div>\n        <div class=\"workout-item-desc\">${w.description}</div>\n        <div class=\"workout-tags\">\n            ${(w.tags || []).map(t => `<span class=\"workout-tag\">${t}</span>`).join('')}\n        </div>\n        <div style=\"${actionContainerStyle}\">\n            ${actionsHtml}\n        </div>\n    `;\n\n    // Handle Export\n    const exportBtn = el.querySelector('.export-workout-btn');\n    exportBtn?.addEventListener('click', (e) => {\n        e.stopPropagation();\n        exportWorkout(w);\n    });\n\n    // Handle Delete\n    if (isCustom) {\n        const delBtn = el.querySelector('.delete-workout-btn');\n        delBtn?.addEventListener('click', (e) => {\n            e.stopPropagation();\n            if (confirm(`Delete workout \"${w.name}\"?`)) {\n                deleteCustomWorkout(w.id);\n                refreshWorkoutList();\n                announce(`Deleted workout: ${w.name}`, 'assertive');\n            }\n        });\n    }\n\n    // Start workout on click (prevent if clicking actions)\n    el.addEventListener('click', (e) => {\n        // Simple check to ensure we didn't click a button\n        if ((e.target as HTMLElement).tagName === 'BUTTON') return;\n\n        selectWorkout(w);\n        const modal = document.getElementById('workoutSelectionModal');\n        if (modal) modal.style.display = 'none';\n    });\n\n    // Keyboard support\n    el.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            selectWorkout(w);\n            const modal = document.getElementById('workoutSelectionModal');\n            if (modal) modal.style.display = 'none';\n        }\n    });\n\n    container.appendChild(el);\n}\n\n/**\n * Select and start a workout\n */\nfunction selectWorkout(workout: StructuredWorkout): void {\n    if (activeRunner) {\n        if (!confirm('A workout is already active. Stop it and start this one?')) {\n            return;\n        }\n        activeRunner.stop();\n    }\n\n    // Initialize audio on user interaction\n    audioManager.init();\n\n    activeRunner = new WorkoutRunner(workout);\n    activeRunner.setCallback(updatePlayerUI);\n\n    // Show player\n    const overlay = document.getElementById('workoutPlayerOverlay');\n    if (overlay) {\n        overlay.style.display = 'block';\n        // playerVisible = true;\n    }\n\n    // Announce\n    announce(`Starting workout: ${workout.name}. Ready to start.`, 'assertive');\n}\n\n/**\n * Initialize player controls (Minimize, Close, Skip)\n */\nfunction initPlayerControls(): void {\n    const overlay = document.getElementById('workoutPlayerOverlay');\n    const minimizeBtn = document.getElementById('wpMinimize');\n    const closeBtn = document.getElementById('wpClose');\n    const skipBtn = document.getElementById('wpSkip');\n\n    if (!overlay) return;\n\n    // Close/Stop\n    closeBtn?.addEventListener('click', () => {\n        if (!activeRunner) return;\n        if (confirm('Stop current workout?')) {\n            activeRunner.stop();\n            activeRunner = null;\n            overlay.style.display = 'none';\n            announce('Workout stopped', 'polite');\n        }\n    });\n\n    // Minimize (Toggle visibility of body)\n    minimizeBtn?.addEventListener('click', () => {\n        const body = overlay.querySelector('.workout-player-body') as HTMLElement;\n        if (body) {\n            const isHidden = body.style.display === 'none';\n            body.style.display = isHidden ? 'block' : 'none';\n            minimizeBtn.textContent = isHidden ? '_' : '';\n        }\n    });\n\n    // Skip\n    skipBtn?.addEventListener('click', () => {\n        if (activeRunner) {\n            activeRunner.nextStep();\n            announce('Skipped to next step', 'polite');\n        }\n    });\n}\n\n/**\n * Update the player UI based on state\n */\nfunction updatePlayerUI(state: RunnerState): void {\n    const nameEl = document.getElementById('wpWorkoutName');\n    const descEl = document.getElementById('wpStepDescription');\n    const timeEl = document.getElementById('wpStepTime');\n    const durEl = document.getElementById('wpStepDuration');\n    const targetEl = document.getElementById('wpTargetPower');\n    const nextEl = document.getElementById('wpNextStep');\n    const progressEl = document.getElementById('wpProgress');\n\n    if (nameEl) nameEl.textContent = state.workout.name;\n\n    if (state.currentStep) {\n        if (descEl) descEl.textContent = state.currentStep.description || state.currentStep.type.toUpperCase();\n\n        // Timer\n        const timeRemaining = state.currentStep.duration - state.stepElapsedTime;\n        if (timeEl) timeEl.textContent = formatTime(timeRemaining);\n        if (durEl) durEl.textContent = formatTime(state.currentStep.duration);\n\n        // Target\n        if (targetEl) {\n            targetEl.textContent = state.targetPower ? state.targetPower.toString() : '--';\n        }\n    }\n\n    // Next Step\n    if (nextEl) {\n        if (state.nextStep) {\n            const nextPwr = calculateNextTarget(state.nextStep);\n            nextEl.textContent = `${state.nextStep.type} (${formatTime(state.nextStep.duration)}${nextPwr})`;\n        } else {\n            nextEl.textContent = 'Finish';\n        }\n    }\n\n    // Progress Bar\n    if (progressEl) {\n        const pct = (state.stepElapsedTime / state.currentStep.duration) * 100;\n        progressEl.style.width = `${Math.min(100, pct)}%`;\n\n        // Change color based on zone/intensity?\n        // simple: blue for warmup/rest, orange for active\n        if (state.currentStep.type === 'active') {\n            progressEl.style.backgroundColor = '#ff9800'; // Orange\n        } else if (state.currentStep.type === 'rest' || state.currentStep.type === 'warmup') {\n            progressEl.style.backgroundColor = '#2196F3'; // Blue\n        } else {\n            progressEl.style.backgroundColor = '#4CAF50'; // Green\n        }\n    }\n\n    // Finished?\n    if (state.isFinished) {\n        const overlay = document.getElementById('workoutPlayerOverlay');\n        if (overlay) overlay.style.display = 'none';\n        activeRunner = null;\n        alert('Workout Complete!');\n        announce('Workout Complete!', 'assertive');\n    }\n}\n\n/**\n * Basic time formatter (mm:ss)\n */\nfunction formatTime(seconds: number): string {\n    const m = Math.floor(seconds / 60);\n    const s = seconds % 60;\n    return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n}\n\n// Temporary helper until I expose calculation from Runner or pass it in state\nfunction calculateNextTarget(step: WorkoutStep): string {\n    // This logic is duplicated from Runner, improving later\n    return step.targetValue ? ` @ ~${step.targetValue}${step.targetType === 'percent_ftp' ? '%' : 'W'}` : '';\n}\n\n/**\n * Hook to link main timer start/pause to workout runner\n * Call this from main.ts or connection logic\n */\nexport function onWorkoutStart(): void {\n    if (activeRunner) {\n        activeRunner.start();\n    }\n}\n\nexport function onWorkoutPause(): void {\n    if (activeRunner) {\n        activeRunner.pause();\n    }\n}\n","/**\n * Workout Builder UI\n * \n * Manages the UI for creating custom structured workouts.\n */\n\nimport type { StructuredWorkout, WorkoutStep, IntervalType, TargetType } from '../workouts/types.js';\nimport { saveCustomWorkout } from '../storage/customWorkouts.js';\nimport { announce } from './accessibility.js';\nimport { refreshWorkoutList } from './workoutPlayer.js';\n\nlet currentSteps: WorkoutStep[] = [];\n\n/**\n * Initialize Builder UI\n */\nexport function initWorkoutBuilder(): void {\n    const createBtn = document.getElementById('createWorkoutBtn');\n    const closeBtn = document.getElementById('closeBuilderModal');\n    const cancelBtn = document.getElementById('wbCancel');\n    const saveBtn = document.getElementById('wbSave');\n    const addStepBtn = document.getElementById('wbAddStepRef');\n\n    if (createBtn) {\n        createBtn.addEventListener('click', openBuilder);\n    }\n\n    if (closeBtn) closeBtn.addEventListener('click', closeBuilder);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeBuilder);\n\n    if (saveBtn) {\n        saveBtn.addEventListener('click', saveWorkout);\n    }\n\n    if (addStepBtn) {\n        addStepBtn.addEventListener('click', addStepFromForm);\n    }\n\n    // Toggle target value visibility based on type\n    const targetTypeSelect = document.getElementById('wbTargetType') as HTMLSelectElement;\n    if (targetTypeSelect) {\n        targetTypeSelect.addEventListener('change', () => {\n            const valInput = document.getElementById('wbTargetValue') as HTMLInputElement;\n            if (valInput) {\n                valInput.parentElement!.style.display = targetTypeSelect.value === 'open' ? 'none' : 'block';\n            }\n        });\n    }\n}\n\nfunction openBuilder(): void {\n    const modal = document.getElementById('workoutBuilderModal');\n    const selectionModal = document.getElementById('workoutSelectionModal');\n\n    if (selectionModal) selectionModal.style.display = 'none';\n    if (modal) {\n        modal.style.display = 'flex';\n        resetForm();\n    }\n}\n\nfunction closeBuilder(): void {\n    const modal = document.getElementById('workoutBuilderModal');\n    if (modal) modal.style.display = 'none';\n}\n\nfunction resetForm(): void {\n    currentSteps = [];\n    (document.getElementById('wbName') as HTMLInputElement).value = '';\n    (document.getElementById('wbDesc') as HTMLTextAreaElement).value = '';\n    renderSteps();\n}\n\nfunction addStepFromForm(): void {\n    const type = (document.getElementById('wbStepType') as HTMLSelectElement).value as IntervalType;\n    const durationStr = (document.getElementById('wbStepDuration') as HTMLInputElement).value;\n    const targetType = (document.getElementById('wbTargetType') as HTMLSelectElement).value as TargetType;\n    const targetValStr = (document.getElementById('wbTargetValue') as HTMLInputElement).value;\n\n    const duration = parseInt(durationStr, 10);\n    if (isNaN(duration) || duration <= 0) {\n        alert('Invalid duration');\n        return;\n    }\n\n    let targetValue: number | undefined = undefined;\n    if (targetType !== 'open') {\n        targetValue = parseInt(targetValStr, 10);\n        if (isNaN(targetValue)) {\n            alert('Invalid target value');\n            return;\n        }\n    }\n\n    const step: WorkoutStep = {\n        type,\n        duration,\n        targetType,\n        targetValue,\n        description: `${capitalize(type)} (${formatDuration(duration)})`\n    };\n\n    currentSteps.push(step);\n    renderSteps();\n    announce(`Added step: ${step.description}`, 'polite');\n}\n\nfunction renderSteps(): void {\n    const list = document.getElementById('wbStepsList');\n    if (!list) return;\n\n    if (currentSteps.length === 0) {\n        list.innerHTML = `<div class=\"wb-step-empty\" style=\"text-align: center; color: var(--color-text-secondary); padding: 1rem; border: 1px dashed var(--color-border);\">\n                        No steps added yet.\n                    </div>`;\n        return;\n    }\n\n    list.innerHTML = '';\n\n    currentSteps.forEach((step, index) => {\n        const row = document.createElement('div');\n        row.className = 'wb-step-item';\n        // Add minimal styles inline for now, ideally strictly in CSS\n        row.style.background = 'var(--card-bg-hover)';\n        row.style.padding = '8px';\n        row.style.borderRadius = '4px';\n        row.style.display = 'flex';\n        row.style.justifyContent = 'space-between';\n        row.style.alignItems = 'center';\n        row.style.border = '1px solid var(--color-border)';\n\n        const desc = step.targetType === 'open'\n            ? 'Open effort'\n            : `${step.targetValue} ${step.targetType === 'percent_ftp' ? '%' : 'W'}`;\n\n        row.innerHTML = `\n            <div>\n                <strong>${index + 1}. ${capitalize(step.type)}</strong> - ${formatDuration(step.duration)}\n                <div style=\"font-size: 0.85em; color: var(--color-text-secondary)\">${desc}</div>\n            </div>\n            <button class=\"remove-step-btn\" data-index=\"${index}\" style=\"color: var(--color-error); background: none; border: none; cursor: pointer;\"></button>\n        `;\n\n        list.appendChild(row);\n    });\n\n    // Add event listeners for remove buttons\n    list.querySelectorAll('.remove-step-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            const idx = parseInt((e.target as HTMLElement).getAttribute('data-index') || '-1', 10);\n            if (idx >= 0) {\n                currentSteps.splice(idx, 1);\n                renderSteps();\n            }\n        });\n    });\n}\n\nfunction saveWorkout(): void {\n    const name = (document.getElementById('wbName') as HTMLInputElement).value.trim();\n    const desc = (document.getElementById('wbDesc') as HTMLTextAreaElement).value.trim();\n\n    if (!name) {\n        alert('Please enter a workout name');\n        return;\n    }\n\n    if (currentSteps.length === 0) {\n        alert('Please add at least one step');\n        return;\n    }\n\n    const workout: StructuredWorkout = {\n        id: crypto.randomUUID(), // Native UUID\n        name,\n        description: desc,\n        steps: currentSteps,\n        tags: ['custom']\n    };\n\n    saveCustomWorkout(workout);\n    refreshWorkoutList(); // Note: need to export this from workoutPlayer\n    closeBuilder();\n    announce(`Workout saved: ${name}`, 'assertive');\n}\n\nfunction capitalize(s: string): string {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction formatDuration(sec: number): string {\n    const m = Math.floor(sec / 60);\n    const s = sec % 60;\n    if (m > 0) return `${m}m ${s}s`;\n    return `${s}s`;\n}\n","import { View } from '../router/View.js';\nimport { initWorkoutSelectionLogic, refreshWorkoutList } from '../ui/workoutPlayer.js';\nimport { initWorkoutBuilder } from '../ui/workoutBuilder.js';\n\nexport class WorkoutsView implements View {\n    public id = 'workouts';\n    private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('workoutSelectionTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            setTimeout(() => {\n                initWorkoutSelectionLogic();\n                initWorkoutBuilder(); // Initialize builder logic (it still uses a modal, which is fine)\n                this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Workouts template not found!');\n            container.innerHTML = '<p>Error loading workouts view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        if (this.isInitialized) {\n            refreshWorkoutList();\n        } else {\n            setTimeout(() => refreshWorkoutList(), 50);\n        }\n    }\n\n    public onLeave(): void {\n        // Cleanup if needed\n    }\n}\n","/**\n * Application Settings Configuration\n * \n * Manages data structure and persistence only. \n * UI logic is in ui/settings.ts.\n */\n\n/**\n * Application settings\n */\nexport interface AppSettings {\n    // Dashboard display settings\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    speed: boolean;\n    distance: boolean;\n    altitude: boolean;\n    treadmillSpeed: boolean;\n    power3s: boolean;\n\n    // Accessibility settings\n    highContrast: boolean;\n    colorblindPatterns: boolean;\n\n    // Voice Feedback settings\n    voiceEnabled: boolean;\n    voiceLaps: boolean;\n    voiceZones: boolean;\n\n    // Export format settings\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n\n    // Debug settings\n    debugMode: boolean;\n}\n\n/** Storage key for settings */\nexport const SETTINGS_KEY = 'bpt-settings';\n\n/** Default settings */\nexport const defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    speed: true,\n    distance: true,\n    altitude: true,\n    treadmillSpeed: false,\n    power3s: false,\n    highContrast: false,\n    colorblindPatterns: false,\n    voiceEnabled: false,\n    voiceLaps: true,\n    voiceZones: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n    debugMode: false,\n};\n\n/**\n * Get current settings from localStorage\n */\nexport function getSettings(): AppSettings {\n    const settingsJson = localStorage.getItem(SETTINGS_KEY);\n    return settingsJson\n        ? { ...defaultSettings, ...JSON.parse(settingsJson) }\n        : { ...defaultSettings };\n}\n\n/**\n * Save settings to localStorage\n */\nexport function saveSettingsToStorage(settings: AppSettings): void {\n    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n    // Dispatch event so UI can react if needed (though UI usually initiates the save)\n    window.dispatchEvent(new CustomEvent('settings-changed'));\n}\n","/**\n * Bluetooth Debug Service\n * \n * Handles capturing, storing, and exporting raw Bluetooth sensor data\n * for debugging purposes.\n */\n\nimport { saveDebugLog, getDebugLogs, clearDebugLogs } from '../../storage/workoutStorage.js';\nimport { getSettings } from '../../config/settings.js';\n\n/**\n * Service for logging raw Bluetooth data\n */\nexport const BluetoothDebugService = {\n    /**\n     * Check if debug mode is enabled\n     */\n    isEnabled(): boolean {\n        // Try to avoid excessive localStorage reads by checking if we are in a tight loop\n        // But getSettings parses JSON, so maybe we should cache this?\n        // for now, let's just read it.\n        const settings = getSettings();\n        return !!settings.debugMode;\n    },\n\n    /**\n     * Log a raw data packet\n     * @param sensor - The sensor type identifier\n     * @param data - The raw DataView from the Bluetooth characteristic\n     */\n    async log(sensor: string, data: DataView): Promise<void> {\n        if (!this.isEnabled()) return;\n\n        try {\n            const hex = this.bufferToHex(data.buffer);\n            await saveDebugLog(sensor, hex);\n        } catch (e) {\n            console.warn('Failed to log debug data', e);\n        }\n    },\n\n    /**\n     * Convert ArrayBuffer to Hex string\n     */\n    bufferToHex(buffer: ArrayBufferLike): string {\n        return [...new Uint8Array(buffer)]\n            .map(b => b.toString(16).padStart(2, '0'))\n            .join('')\n            .toUpperCase();\n    },\n\n    /**\n     * Export all logs as a JSON file\n     */\n    async exportLogs(): Promise<void> {\n        const logs = await getDebugLogs();\n        const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `bpt-debug-logs-${Date.now()}.json`;\n        document.body.appendChild(a);\n        a.click();\n\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    },\n\n    /**\n     * Clear all debug logs\n     */\n    async clearLogs(): Promise<void> {\n        await clearDebugLogs();\n    },\n\n    /**\n     * Get count of stored logs\n     */\n    async getLogCount(): Promise<number> {\n        const logs = await getDebugLogs();\n        return logs.length;\n    }\n};\n","/**\n * PWA Install Prompt\n * \n * Handles the PWA installation prompt for supported browsers.\n * \n * @module installPrompt\n */\n\n/**\n * Deferred install prompt event\n */\nlet deferredPrompt: BeforeInstallPromptEvent | null = null;\n\n/**\n * Extended event interface for beforeinstallprompt\n */\ninterface BeforeInstallPromptEvent extends Event {\n    prompt(): Promise<void>;\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\n/**\n * Initialize the PWA install prompt handler.\n * \n * Listens for the beforeinstallprompt event and captures it for later use.\n */\nexport const initInstallPrompt = (): void => {\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    // Listen for the beforeinstallprompt event\n    window.addEventListener('beforeinstallprompt', (e: Event) => {\n        // Prevent the mini-infobar from appearing on mobile\n        e.preventDefault();\n\n        // Stash the event so it can be triggered later\n        deferredPrompt = e as BeforeInstallPromptEvent;\n\n        // Update install button visibility in settings\n        updateInstallButtonVisibility();\n    });\n\n    // Listen for the app installed event\n    window.addEventListener('appinstalled', () => {\n        console.log('PWA was installed successfully');\n        deferredPrompt = null;\n        updateInstallButtonVisibility();\n    });\n};\n\n/**\n * Check if the app can be installed.\n * @returns true if install is available\n */\nexport const canInstallPwa = (): boolean => {\n    return deferredPrompt !== null;\n};\n\n/**\n * Trigger the PWA install prompt.\n * @returns Promise that resolves to the user's choice outcome\n */\nexport const triggerInstallPrompt = async (): Promise<'accepted' | 'dismissed' | 'unavailable'> => {\n    if (!deferredPrompt) {\n        return 'unavailable';\n    }\n\n    try {\n        // Show the install prompt\n        await deferredPrompt.prompt();\n\n        // Wait for the user to respond to the prompt\n        const { outcome } = await deferredPrompt.userChoice;\n        console.log(`User response to the install prompt: ${outcome}`);\n\n        // Clear the deferredPrompt\n        deferredPrompt = null;\n        updateInstallButtonVisibility();\n\n        return outcome;\n    } catch (error) {\n        console.error('Error triggering install prompt:', error);\n        return 'unavailable';\n    }\n};\n\n/**\n * Update the visibility of install buttons based on availability.\n */\nconst updateInstallButtonVisibility = (): void => {\n    const installButton = document.getElementById('installPwaButton');\n    const installButtonContainer = document.getElementById('installPwaContainer');\n\n    if (installButton) {\n        installButton.style.display = canInstallPwa() ? 'block' : 'none';\n    }\n\n    if (installButtonContainer) {\n        installButtonContainer.style.display = canInstallPwa() ? 'block' : 'none';\n    }\n};\n","/**\n * Settings Modal\n * \n * Manages application settings stored in localStorage.\n * \n * @module settings\n */\n\nimport { loadUserProfile, saveUserProfile } from './onboarding.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { getSettings, saveSettingsToStorage, defaultSettings } from '../config/settings.js';\nimport type { AppSettings } from '../config/settings.js';\nimport { triggerInstallPrompt } from './installPrompt.js';\n\n// Re-export for compatibility if needed (but prefer importing from config)\nexport { getSettings };\n\n\n/**\n * Initialize the Settings UI logic\n */\nexport function initSettingsLogic(): void {\n    const saveSettingsButton = document.getElementById('saveSettings');\n\n    // User Profile settings\n    const settingFtp = document.getElementById('settingFtp') as HTMLInputElement | null;\n    const settingMaxHr = document.getElementById('settingMaxHr') as HTMLInputElement | null;\n    const settingWeight = document.getElementById('settingWeight') as HTMLInputElement | null;\n\n    // Dashboard display settings\n    const settingSpeed = document.getElementById('settingSpeed') as HTMLInputElement | null;\n    const settingDistance = document.getElementById('settingDistance') as HTMLInputElement | null;\n    const settingAltitude = document.getElementById('settingAltitude') as HTMLInputElement | null;\n    const settingPower = document.getElementById('settingPower') as HTMLInputElement | null;\n    const settingCadence = document.getElementById('settingCadence') as HTMLInputElement | null;\n    const settingHeartrate = document.getElementById('settingHeartrate') as HTMLInputElement | null;\n    const settingTreadmillSpeed = document.getElementById('settingTreadmillSpeed') as HTMLInputElement | null;\n    const settingPower3s = document.getElementById('settingPower3s') as HTMLInputElement | null;\n\n    // Accessibility settings\n    const settingHighContrast = document.getElementById('settingHighContrast') as HTMLInputElement | null;\n    const settingColorblindPatterns = document.getElementById('settingColorblindPatterns') as HTMLInputElement | null;\n\n    // Voice Feedback settings\n    const settingVoiceEnabled = document.getElementById('settingVoiceEnabled') as HTMLInputElement | null;\n    const settingVoiceLaps = document.getElementById('settingVoiceLaps') as HTMLInputElement | null;\n    const settingVoiceZones = document.getElementById('settingVoiceZones') as HTMLInputElement | null;\n\n    // Export format settings\n    const settingExportTcx = document.getElementById('settingExportTcx') as HTMLInputElement | null;\n    const settingExportCsv = document.getElementById('settingExportCsv') as HTMLInputElement | null;\n    const settingExportJson = document.getElementById('settingExportJson') as HTMLInputElement | null;\n    const settingExportFit = document.getElementById('settingExportFit') as HTMLInputElement | null;\n\n    // Debug settings\n    const settingDebugMode = document.getElementById('settingDebugMode') as HTMLInputElement | null;\n    const debugControls = document.getElementById('debugControls');\n    const downloadDebugLogs = document.getElementById('downloadDebugLogs');\n    const clearDebugLogs = document.getElementById('clearDebugLogs');\n\n    // PWA Install button\n    const installPwaButton = document.getElementById('installPwaButton');\n\n\n    /**\n     * Apply settings to the UI\n     */\n    const applySettings = (settings: AppSettings): void => {\n        // Toggle metric visibility\n        const toggleMetric = (metric: string, isVisible: boolean): void => {\n            const elements = document.querySelectorAll(`.metric-group-${metric}`);\n            elements.forEach((el) => {\n                (el as HTMLElement).style.display = isVisible ? 'flex' : 'none';\n            });\n        };\n\n        toggleMetric('speed', settings.speed);\n        toggleMetric('distance', settings.distance);\n        toggleMetric('altitude', settings.altitude);\n        toggleMetric('power', settings.power);\n        toggleMetric('cadence', settings.cadence);\n        toggleMetric('heartrate', settings.heartrate);\n        toggleMetric('treadmillSpeed', settings.treadmillSpeed);\n\n        // Apply 3-second average power indicator\n        const powerMetrics = document.querySelectorAll('.metric-group-power');\n        powerMetrics.forEach((el) => {\n            if (settings.power3s) {\n                el.setAttribute('data-show-avg', 'true');\n            } else {\n                el.removeAttribute('data-show-avg');\n            }\n        });\n\n        // Apply high contrast mode\n        if (settings.highContrast) {\n            document.documentElement.setAttribute('data-high-contrast', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-high-contrast');\n        }\n\n        // Apply colorblind patterns (enabled when high contrast + colorblind patterns both on)\n        if (settings.colorblindPatterns) {\n            document.documentElement.setAttribute('data-colorblind-patterns', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-colorblind-patterns');\n        }\n\n        // Apply debug mode UI\n        if (debugControls) {\n            debugControls.style.display = settings.debugMode ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Save settings to localStorage\n     */\n    const saveSettings = (): void => {\n        // Save User Profile\n        const currentProfile = loadUserProfile();\n        const updatedProfile = {\n            ...currentProfile,\n            ftp: settingFtp?.value ? Number(settingFtp.value) : null,\n            maxHr: settingMaxHr?.value ? Number(settingMaxHr.value) : null,\n            weight: settingWeight?.value ? Number(settingWeight.value) : null,\n        };\n        saveUserProfile(updatedProfile);\n        window.dispatchEvent(new CustomEvent('user-profile-changed'));\n\n        const settings: AppSettings = {\n            speed: settingSpeed?.checked ?? defaultSettings.speed,\n            distance: settingDistance?.checked ?? defaultSettings.distance,\n            altitude: settingAltitude?.checked ?? defaultSettings.altitude,\n            power: settingPower?.checked ?? defaultSettings.power,\n            cadence: settingCadence?.checked ?? defaultSettings.cadence,\n            heartrate: settingHeartrate?.checked ?? defaultSettings.heartrate,\n            treadmillSpeed: settingTreadmillSpeed?.checked ?? defaultSettings.treadmillSpeed,\n            power3s: settingPower3s?.checked ?? defaultSettings.power3s,\n            highContrast: settingHighContrast?.checked ?? defaultSettings.highContrast,\n            colorblindPatterns: settingColorblindPatterns?.checked ?? defaultSettings.colorblindPatterns,\n            voiceEnabled: settingVoiceEnabled?.checked ?? defaultSettings.voiceEnabled,\n            voiceLaps: settingVoiceLaps?.checked ?? defaultSettings.voiceLaps,\n            voiceZones: settingVoiceZones?.checked ?? defaultSettings.voiceZones,\n            exportTcx: settingExportTcx?.checked ?? defaultSettings.exportTcx,\n            exportCsv: settingExportCsv?.checked ?? defaultSettings.exportCsv,\n            exportJson: settingExportJson?.checked ?? defaultSettings.exportJson,\n            exportFit: settingExportFit?.checked ?? defaultSettings.exportFit,\n            debugMode: settingDebugMode?.checked ?? defaultSettings.debugMode,\n        };\n\n        // saveSettingsToStorage dispatches 'settings-changed' internally\n        saveSettingsToStorage(settings);\n        applySettings(settings);\n    };\n\n    /**\n     * Load settings from localStorage\n     */\n    const loadSettings = (): void => {\n        const settings = getSettings();\n        const profile = loadUserProfile();\n\n        // User Profile settings\n        if (settingFtp) settingFtp.value = profile.ftp?.toString() ?? '';\n        if (settingMaxHr) settingMaxHr.value = profile.maxHr?.toString() ?? '';\n        if (settingWeight) settingWeight.value = profile.weight?.toString() ?? '';\n\n        // Dashboard display settings\n        if (settingPower) settingPower.checked = settings.power;\n        if (settingCadence) settingCadence.checked = settings.cadence;\n        if (settingHeartrate) settingHeartrate.checked = settings.heartrate;\n        if (settingSpeed) settingSpeed.checked = settings.speed;\n        if (settingDistance) settingDistance.checked = settings.distance;\n        if (settingAltitude) settingAltitude.checked = settings.altitude;\n        if (settingTreadmillSpeed) settingTreadmillSpeed.checked = settings.treadmillSpeed;\n        if (settingPower3s) settingPower3s.checked = settings.power3s;\n\n        // Accessibility settings\n        if (settingHighContrast) settingHighContrast.checked = settings.highContrast;\n        if (settingColorblindPatterns) settingColorblindPatterns.checked = settings.colorblindPatterns;\n\n        // Voice Feedback settings\n        if (settingVoiceEnabled) settingVoiceEnabled.checked = settings.voiceEnabled;\n        if (settingVoiceLaps) settingVoiceLaps.checked = settings.voiceLaps;\n        if (settingVoiceZones) settingVoiceZones.checked = settings.voiceZones;\n\n        // Export format settings\n        if (settingExportTcx) settingExportTcx.checked = settings.exportTcx;\n        if (settingExportCsv) settingExportCsv.checked = settings.exportCsv;\n        if (settingExportJson) settingExportJson.checked = settings.exportJson;\n        if (settingExportFit) settingExportFit.checked = settings.exportFit;\n\n        // Debug settings\n        if (settingDebugMode) settingDebugMode.checked = settings.debugMode;\n\n        applySettings(settings);\n    };\n\n    // Event Listeners\n    saveSettingsButton?.addEventListener('click', saveSettings);\n\n    downloadDebugLogs?.addEventListener('click', () => {\n        BluetoothDebugService.exportLogs();\n    });\n\n    clearDebugLogs?.addEventListener('click', async () => {\n        if (confirm('Are you sure you want to clear all debug logs?')) {\n            await BluetoothDebugService.clearLogs();\n            alert('Logs cleared.');\n        }\n    });\n\n    // PWA Install button handler\n    installPwaButton?.addEventListener('click', async () => {\n        const outcome = await triggerInstallPrompt();\n\n        if (outcome === 'accepted') {\n            // App will be installed, button will hide automatically via installPrompt.ts\n            console.log('PWA installation accepted');\n        } else if (outcome === 'dismissed') {\n            console.log('PWA installation dismissed');\n        } else {\n            alert('Installation is not available at this time. The app may already be installed or your browser does not support installation.');\n        }\n    });\n\n    // Initialize\n    loadSettings();\n}\n","import { View } from '../router/View.js';\nimport { initSettingsLogic } from '../ui/settings.js';\n\nexport class SettingsView implements View {\n    public id = 'settings';\n    // private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('settingsTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initSettingsLogic();\n                // this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Settings template not found!');\n            container.innerHTML = '<p>Error loading settings view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        console.log('Entered Settings View');\n        // If we needed to refresh settings from storage every time we enter, \n        // we might call loadSettings() here. \n        // But initSettingsLogic calls loadSettings internally during init.\n        // If the user changes settings, they are saved. \n        // If we want to ensure UI matches state if state changed elsewhere...\n        // initSettingsLogic sets up listeners. \n        // We might want to re-run loadSettings() if it exposed it.\n        // For now, let's assume one-time init is fine or we can expose refresh.\n\n        // Actually, since we re-clone the template only ONCE in init (if the container is empty?),\n        // Wait, the Router usually doesn't clear the container unless we implement it that way.\n        // My Router implementation:\n        /*\n            if (!this.views.has(viewId)) { ... view.init(container) }\n            this.currentView?.onLeave();\n            currentContainer.style.display = 'none';\n            newContainer.style.display = 'block';\n            view.onEnter();\n        */\n\n        // So init() is called once. The DOM elements persist.\n        // So `initSettingsLogic` is called once. The listeners persist.\n        // This is correct.\n    }\n\n    public onLeave(): void {\n        console.log('Left Settings View');\n    }\n}\n","/**\n * View IDs for application navigation\n */\nexport enum ViewId {\n    Dashboard = 'dashboard',\n    History = 'history',\n    Workouts = 'workouts',\n    Settings = 'settings'\n}\n","/**\n * Navigation Bar Component\n * \n * Handles the bottom navigation bar.\n */\n\nimport { IRouter } from '../router/types.js';\nimport { ViewId } from '../router/view-ids.js';\n\nexport class NavBar {\n    private container: HTMLElement;\n    private router: IRouter;\n\n    constructor(router: IRouter) {\n        this.router = router;\n        this.container = document.createElement('nav');\n        this.container.id = 'bottom-nav';\n        this.container.className = 'bottom-nav';\n\n        // Mobile-first styles should be in CSS, but injecting basic structure here\n        this.render();\n        document.body.appendChild(this.container);\n\n        // Listen for route changes\n        window.addEventListener('route-changed', (e: Event) => {\n            const detail = (e as CustomEvent).detail;\n            this.setActive(detail.viewId);\n        });\n    }\n\n    private render(): void {\n        this.container.innerHTML = `\n            <button class=\"nav-item active\" data-target=\"${ViewId.Dashboard}\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Dashboard</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.History}\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">History</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Workouts}\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Workouts</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Settings}\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Settings</span>\n            </button>\n        `;\n\n        this.container.querySelectorAll('.nav-item').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const target = (btn as HTMLElement).dataset.target;\n                if (target === ViewId.Dashboard) {\n                    this.router.navigate('/');\n                } else if (target) {\n                    this.router.navigate('/' + target);\n                }\n            });\n        });\n    }\n\n    public setActive(viewId: string): void {\n        this.container.querySelectorAll('.nav-item').forEach(btn => {\n            const target = (btn as HTMLElement).dataset.target;\n            if (target === viewId) {\n                btn.classList.add('active');\n                btn.setAttribute('aria-current', 'page');\n            } else {\n                btn.classList.remove('active');\n                btn.removeAttribute('aria-current');\n            }\n        });\n    }\n}\n","import { Router } from '../router/Router.js';\nimport { DashboardView } from '../views/DashboardView.js';\nimport { HistoryView } from '../views/HistoryView.js';\nimport { WorkoutsView } from '../views/WorkoutsView.js';\nimport { SettingsView } from '../views/SettingsView.js';\nimport { NavBar } from '../components/NavBar.js';\nimport { ViewId } from '../router/view-ids.js';\nimport { selectElement } from '../utils/dom.js';\n\n/**\n * Initializes the Router, registers Views, and sets up the Navigation Bar.\n */\nexport function setupRouter(): Router {\n    const router = new Router(selectElement('mainContent'));\n\n    const dashboardView = new DashboardView();\n    const historyView = new HistoryView();\n    const workoutsView = new WorkoutsView();\n    const settingsView = new SettingsView();\n\n    router.registerView(dashboardView);\n    router.registerView(historyView);\n    router.registerView(workoutsView);\n    router.registerView(settingsView);\n\n    router.addRoute('/', ViewId.Dashboard);\n    router.addRoute('/history', ViewId.History);\n    router.addRoute('/workouts', ViewId.Workouts);\n    router.addRoute('/settings', ViewId.Settings);\n\n    // Initialize Navigation Bar\n    new NavBar(router);\n\n    // Wire up Sidebar Settings Button (for mobile/hamburger menu)\n    const settingsButton = document.getElementById('settingsButton');\n    if (settingsButton) {\n        settingsButton.addEventListener('click', () => {\n            router.navigate('/settings');\n            // Close the details menu if open\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    return router;\n}\n","/**\n * Time formatting utilities\n * \n * @module getTimestring\n */\n\n/**\n * Converts milliseconds to a formatted time string (HH:MM:SS)\n * \n * @param milliseconds - Time duration in milliseconds\n * @returns Formatted time string in HH:MM:SS format\n * \n * @example\n * getTimestring(3661000) // \"01:01:01\"\n * getTimestring(0)       // \"00:00:00\"\n */\nexport const getTimestring = (milliseconds: number): string => {\n    const totalSeconds = Math.floor(milliseconds / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    return (\n        `${hours.toString().padStart(2, '0')}:` +\n        `${minutes.toString().padStart(2, '0')}:` +\n        `${seconds.toString().padStart(2, '0')}`\n    );\n};\n","/**\n * Timer Display Initialization\n *\n * Sets up the workout timer display and Garmin-style workout controls.\n *\n * Workout states:\n * - Idle: Not started, show Start button\n * - Recording: Timer running, show Pause button\n * - Paused: Timer paused, show Resume and Stop buttons\n *\n * @module time\n */\n\nimport { getTimestring } from '../getTimestring.js';\nimport { announce, updateWorkoutControlsAccessibility } from './accessibility.js';\nimport { onWorkoutStart, onWorkoutPause } from './workoutPlayer.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Workout state enum for clarity\n */\nexport type WorkoutState = 'idle' | 'recording' | 'paused';\n\n/**\n * Get the current workout state from time state\n */\nexport function getWorkoutState(timeState: TimeState): WorkoutState {\n    if (!timeState.startTime) {\n        return 'idle';\n    }\n    if (timeState.running) {\n        return 'recording';\n    }\n    return 'paused';\n}\n\n/**\n * Workout control button elements\n */\ninterface WorkoutControlElements {\n    startButton: HTMLButtonElement;\n    pauseButton: HTMLButtonElement;\n    resumeButton: HTMLButtonElement;\n    stopButton: HTMLButtonElement;\n}\n\n/**\n * Update button visibility based on workout state\n */\nfunction updateButtonVisibility(\n    elements: WorkoutControlElements,\n    state: WorkoutState\n): void {\n    const { startButton, pauseButton, resumeButton, stopButton } = elements;\n\n    // Hide all buttons first\n    startButton.style.display = 'none';\n    pauseButton.style.display = 'none';\n    resumeButton.style.display = 'none';\n    stopButton.style.display = 'none';\n\n    switch (state) {\n        case 'idle':\n            startButton.style.display = 'inline-flex';\n            break;\n        case 'recording':\n            pauseButton.style.display = 'inline-flex';\n            break;\n        case 'paused':\n            resumeButton.style.display = 'inline-flex';\n            stopButton.style.display = 'inline-flex';\n            break;\n    }\n}\n\n/**\n * Initialize the timer display and Garmin-style workout controls.\n *\n * Sets up:\n * - Timer display that updates every 100ms\n * - Start button to begin a new workout\n * - Pause button to pause recording\n * - Resume button to continue a paused workout\n * - Stop button to end and save the workout\n * - Visual state changes for workout status\n *\n * @param timeState - The workout time state object\n */\nexport const initTimerDisplay = (timeState: TimeState): void => {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n    const metricsTable = document.getElementById('metricsTable');\n\n    if (!startButton || !pauseButton || !resumeButton || !stopButton || !timeElement || !metricsTable) {\n        console.warn('Workout control elements not found in DOM');\n        return;\n    }\n\n    const elements: WorkoutControlElements = {\n        startButton,\n        pauseButton,\n        resumeButton,\n        stopButton,\n    };\n\n    // Update timer display every 100ms\n    setInterval(() => {\n        let nextText = '00:00:00';\n        const currentState = getWorkoutState(timeState);\n\n        if (timeState.startTime && timeState.running) {\n            const elapsedMs = Date.now() - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        } else if (timeState.startTime && timeState.endTime) {\n            const elapsedMs = timeState.endTime - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        }\n\n        if (timeElement.textContent !== nextText) {\n            timeElement.textContent = nextText;\n        }\n\n        // Update metrics table styling based on state\n        metricsTable.classList.remove('recording', 'paused');\n        if (currentState === 'recording') {\n            metricsTable.classList.add('recording');\n        } else if (currentState === 'paused') {\n            metricsTable.classList.add('paused');\n        }\n    }, 100);\n\n    // Initialize button visibility\n    updateButtonVisibility(elements, getWorkoutState(timeState));\n\n    // Helper to add robust touch/click listeners\n    const addListener = (btn: HTMLButtonElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    // Handle Start button click - begin new workout\n    addListener(startButton, () => {\n        timeState.startTime = Date.now();\n        timeState.endTime = null;\n        timeState.running = true;\n\n        onWorkoutStart();\n\n        updateButtonVisibility(elements, 'recording');\n        updateWorkoutControlsAccessibility('recording');\n        announce('Workout started', 'assertive');\n    });\n\n    // Handle Pause button click - pause recording\n    addListener(pauseButton, () => {\n        timeState.running = false;\n        timeState.endTime = Date.now();\n\n        onWorkoutPause();\n\n        updateButtonVisibility(elements, 'paused');\n        updateWorkoutControlsAccessibility('paused');\n        announce('Workout paused. Press resume to continue or stop to save.', 'assertive');\n    });\n\n    // Handle Resume button click - continue paused workout\n    addListener(resumeButton, () => {\n        if (timeState.endTime && timeState.startTime) {\n            // Adjust startTime to account for paused duration\n            const pausedDuration = Date.now() - timeState.endTime;\n            timeState.startTime += pausedDuration;\n        }\n        timeState.endTime = null;\n        timeState.running = true;\n\n        onWorkoutStart();\n\n        updateButtonVisibility(elements, 'recording');\n        updateWorkoutControlsAccessibility('recording');\n        announce('Workout resumed', 'assertive');\n    });\n\n    // Handle Stop button click - end and save workout\n    addListener(stopButton, () => {\n        // Keep endTime as is (already set when paused)\n        // Reset to idle state for next workout\n        timeState.running = false;\n\n        onWorkoutPause();\n\n        updateButtonVisibility(elements, 'paused');\n        updateWorkoutControlsAccessibility('paused');\n        announce('Workout stopped and saved. Press resume to continue or export your data.', 'assertive');\n\n        // Dispatch custom event for workout completion\n        const workoutCompleteEvent = new CustomEvent('workoutComplete', {\n            detail: {\n                startTime: timeState.startTime,\n                endTime: timeState.endTime,\n                duration: timeState.endTime && timeState.startTime\n                    ? timeState.endTime - timeState.startTime\n                    : 0,\n            },\n        });\n        document.dispatchEvent(workoutCompleteEvent);\n    });\n};\n\n/**\n * Reset workout to idle state\n *\n * @param timeState - The workout time state object\n */\nexport function resetWorkout(timeState: TimeState): void {\n    timeState.startTime = null;\n    timeState.endTime = null;\n    timeState.running = false;\n\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton && pauseButton && resumeButton && stopButton) {\n        updateButtonVisibility(\n            { startButton, pauseButton, resumeButton, stopButton },\n            'idle'\n        );\n        updateWorkoutControlsAccessibility('idle');\n    }\n\n    announce('Workout reset', 'polite');\n}\n","/**\n * Measurement merging utilities\n * \n * Combines heart rate, cadence, and power measurements into synchronized data points.\n * \n * @module merge-measurements\n */\n\nimport type { Measurement, MeasurementsData } from './types/measurements.js';\n\n/**\n * A merged data point containing all measurement types at a single timestamp\n */\nexport interface MergedDataPoint {\n    timestamp: number;\n    heartrate: number | null;\n    cadence: number | null;\n    power: number | null;\n    speed: number | null;\n    distance: number | null;\n    altitude: number | null;\n    lat: number | null;\n    lon: number | null;\n}\n\n/**\n * Gets values from a measurement array at specific timestamps.\n * Uses nearest-neighbor interpolation with a 1000ms threshold.\n * \n * @param arr - Array of measurements sorted by timestamp\n * @param timestamps - Array of target timestamps to find values for\n * @returns Array of values (or null if no measurement within threshold)\n */\nexport const getValuesAtTimestamps = (\n    arr: Measurement[],\n    timestamps: number[]\n): (number | null)[] => {\n    const entries: (number | null)[] = [];\n    let index = 0;\n\n    for (const ts of timestamps) {\n        // Find the first measurement at or after the target timestamp\n        while (index < arr.length && arr[index].timestamp < ts) {\n            index++;\n        }\n\n        const prevIndex = index - 1;\n        let suggestedElem: Measurement | undefined = undefined;\n        const isAfterLastPoint = index >= arr.length;\n\n        if (prevIndex < 0) {\n            // Before first measurement - use first if available\n            suggestedElem = arr[index];\n        } else if (isAfterLastPoint) {\n            // After last measurement - use last\n            suggestedElem = arr[prevIndex];\n        } else {\n            // Between measurements - use nearest\n            const prevTime = arr[prevIndex]?.timestamp ?? 0;\n            const nextTime = arr[index]?.timestamp ?? 0;\n            suggestedElem = (ts - prevTime) <= (nextTime - ts) ? arr[prevIndex] : arr[index];\n        }\n\n        if (suggestedElem?.timestamp !== undefined) {\n            const distance = Math.abs(suggestedElem.timestamp - ts);\n            // Values must be strictly less than 1000ms away\n            if (distance < 1000) {\n                entries.push(suggestedElem.value);\n            } else {\n                entries.push(null);\n            }\n        } else {\n            entries.push(null);\n        }\n    }\n\n    return entries;\n};\n\n/**\n * Merges heart rate, cadence, and power measurements into synchronized data points.\n * \n * Creates a timeline with 1-second intervals from the earliest to the latest measurement,\n * then maps each measurement type to the nearest value at each timestamp.\n * \n * @param measurements - Object containing heartrate, cadence, and power measurement arrays\n * @returns Array of merged data points with all measurement types\n * \n * @example\n * const merged = mergeMeasurements({\n *   heartrate: [{ timestamp: 1000, value: 120 }],\n *   cadence: [{ timestamp: 1000, value: 80 }],\n *   power: [{ timestamp: 1000, value: 200 }]\n * });\n * // Returns: [{ timestamp: 1000, heartrate: 120, cadence: 80, power: 200 }]\n */\nexport const mergeMeasurements = (measurements: MeasurementsData): MergedDataPoint[] => {\n    // Convert GPS points to measurements for interpolation\n    const latMeasurements: Measurement[] = measurements.gps.map(p => ({ timestamp: p.timestamp, value: p.lat }));\n    const lonMeasurements: Measurement[] = measurements.gps.map(p => ({ timestamp: p.timestamp, value: p.lon }));\n\n    const sources = [\n        measurements.heartrate,\n        measurements.cadence,\n        measurements.power,\n        measurements.speed,\n        measurements.distance,\n        measurements.altitude,\n        latMeasurements\n    ];\n    const hasData = sources.some(data => data.length > 0);\n\n    if (!hasData) {\n        return [];\n    }\n\n    // Find the time range\n    const firstTimestamps = sources.map(data => data.length > 0 ? data[0].timestamp : Infinity);\n    const startTime = Math.min(...firstTimestamps);\n    const endTime = Math.max(\n        ...sources.map(data => data.length > 0 ? data[data.length - 1].timestamp : -Infinity)\n    );\n\n    // Create timestamps at 1-second intervals\n    const timeStep = 1000;\n    const timestamps: number[] = [];\n    let time = startTime;\n\n    while (time <= endTime) {\n        timestamps.push(time);\n        time += timeStep;\n    }\n\n    // Get synchronized values for each measurement type\n    const syncedHR = getValuesAtTimestamps(measurements.heartrate, timestamps);\n    const syncedCadence = getValuesAtTimestamps(measurements.cadence, timestamps);\n    const syncedPower = getValuesAtTimestamps(measurements.power, timestamps);\n    const syncedSpeed = getValuesAtTimestamps(measurements.speed, timestamps);\n    const syncedDistance = getValuesAtTimestamps(measurements.distance, timestamps);\n    const syncedAltitude = getValuesAtTimestamps(measurements.altitude, timestamps);\n    const syncedLat = getValuesAtTimestamps(latMeasurements, timestamps);\n    const syncedLon = getValuesAtTimestamps(lonMeasurements, timestamps);\n\n    // Combine into data points\n    const dataPoints: MergedDataPoint[] = [];\n\n    for (let i = 0; i < timestamps.length; i++) {\n        dataPoints.push({\n            timestamp: timestamps[i],\n            heartrate: syncedHR[i],\n            cadence: syncedCadence[i],\n            power: syncedPower[i],\n            speed: syncedSpeed[i],\n            distance: syncedDistance[i],\n            altitude: syncedAltitude[i],\n            lat: syncedLat[i],\n            lon: syncedLon[i],\n        });\n    }\n\n    return dataPoints;\n};\n","/**\n * CSV export utilities\n * \n * @module create-csv\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\n\n/**\n * Creates a CSV string from workout measurements.\n * \n * Merges all measurement types (heart rate, cadence, power) into synchronized\n * data points and exports them as a CSV file with ISO timestamps.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns CSV formatted string with header row\n * \n * @example\n * const csv = getCsvString(measurementsState);\n * // Returns:\n * // \"timestamp,power,cadence,heartrate\n * //  2024-01-01T00:00:00.000Z,200,80,120\n * //  ...\"\n */\nexport const getCsvString = (measurements: MeasurementsData): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    // CSV header\n    const header = 'timestamp,power,cadence,heartrate,speed,distance,altitude,lat,lon';\n\n    // Convert each data point to CSV row\n    const rows = dataPoints.map((point: MergedDataPoint) => {\n        const timestamp = new Date(point.timestamp).toISOString();\n        const power = point.power !== null ? Math.round(point.power) : '';\n        const cadence = point.cadence !== null ? Math.round(point.cadence) : '';\n        const heartrate = point.heartrate !== null ? Math.round(point.heartrate) : '';\n        const speed = point.speed !== null ? point.speed.toFixed(1) : '';\n        const distance = point.distance !== null ? Math.round(point.distance) : '';\n        const altitude = point.altitude !== null ? Math.round(point.altitude) : '';\n        const lat = point.lat !== null ? point.lat.toFixed(6) : '';\n        const lon = point.lon !== null ? point.lon.toFixed(6) : '';\n\n        return `${timestamp},${power},${cadence},${heartrate},${speed},${distance},${altitude},${lat},${lon}`;\n    });\n\n    return [header, ...rows].join('\\n');\n};\n","/**\n * TCX (Training Center XML) export utilities\n * \n * Creates Garmin-compatible TCX files from workout measurements.\n * \n * @module create-tcx\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\n\n/**\n * Creates heart rate XML element\n */\nconst hrString = (hr: number | null): string =>\n    hr !== null ? `<HeartRateBpm><Value>${Math.round(hr)}</Value></HeartRateBpm>` : '';\n\n/**\n * Creates cadence XML element\n */\nconst cadenceString = (cadence: number | null): string =>\n    cadence !== null ? `<Cadence>${Math.round(cadence)}</Cadence>` : '';\n\n/**\n * Creates power XML element using Garmin extension format\n */\nconst powerString = (power: number | null): string => {\n    if (power === null) return '';\n    return `<Extensions>\n              <TPX xmlns=\"http://www.garmin.com/xmlschemas/ActivityExtension/v2\">\n                <Watts>${Math.round(power)}</Watts>\n              </TPX>\n            </Extensions>`;\n};\n\n/**\n * Creates a TCX trackpoint element from a merged data point\n * \n * @param point - Merged data point with timestamp and measurements\n * @returns TCX Trackpoint XML string\n */\nconst getTcxTrackpoint = (point: MergedDataPoint): string => {\n    const timestamp = new Date(point.timestamp).toISOString();\n\n    // Order matters in TCX schema: Time, Position, Altitude, Distance, HeartRate, Cadence, Extensions\n\n    let position = '';\n    if (point.lat !== null && point.lon !== null) {\n        position = `\n        <Position>\n            <LatitudeDegrees>${point.lat}</LatitudeDegrees>\n            <LongitudeDegrees>${point.lon}</LongitudeDegrees>\n        </Position>`;\n    }\n\n    let altitude = '';\n    if (point.altitude !== null) {\n        altitude = `<AltitudeMeters>${point.altitude}</AltitudeMeters>`;\n    }\n\n    let distance = '';\n    if (point.distance !== null) {\n        distance = `<DistanceMeters>${point.distance}</DistanceMeters>`;\n    }\n\n    const parts: string[] = [];\n\n    if (point.heartrate !== null) {\n        parts.push(hrString(point.heartrate));\n    }\n\n    if (point.cadence !== null) {\n        parts.push(cadenceString(point.cadence));\n    }\n\n    if (point.power !== null) {\n        parts.push(powerString(point.power));\n    }\n\n    return `\n<Trackpoint>\n    <Time>${timestamp}</Time>\n    ${position}\n    ${altitude}\n    ${distance}\n    ${parts.join('\\n')}\n</Trackpoint>\n    `.trim();\n};\n\n/**\n * Creates a Garmin TCX (Training Center XML) string from workout measurements.\n * \n * TCX is a standard format supported by most fitness platforms including\n * Strava, Garmin Connect, and TrainingPeaks.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns TCX formatted XML string\n * \n * @example\n * const tcx = getTcxString(measurementsState);\n * // Returns a valid TCX XML document\n */\nexport const getTcxString = (measurements: MeasurementsData): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const totalTimeSeconds = Math.round((lastTimestamp - firstTimestamp) / 1000);\n    const startDate = new Date(firstTimestamp).toISOString();\n\n    const tcx = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <TrainingCenterDatabase xmlns=\"http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2\">\n        <Activities>\n            <Activity Sport=\"Biking\">\n                <Id>${startDate}</Id>\n                <Lap StartTime=\"${startDate}\">\n                    <TotalTimeSeconds>${totalTimeSeconds}</TotalTimeSeconds>\n                    <Calories>0</Calories>\n                    <Intensity>Active</Intensity>\n                    <TriggerMethod>Manual</TriggerMethod>\n                    <Track>\n${dataPoints.map(getTcxTrackpoint).join('\\n')}\n                    </Track>\n                </Lap>\n            </Activity>\n        </Activities>\n    </TrainingCenterDatabase>`;\n\n    return tcx;\n};\n","/**\n * FIT (Flexible and Interoperable Data Transfer) export utilities\n * \n * Creates Garmin FIT files from workout measurements.\n * FIT is a binary format optimized for storing and sharing fitness data.\n * \n * @module create-fit\n */\n\nimport { mergeMeasurements } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\n\n// FIT Protocol Constants\nconst FIT_PROTOCOL_VERSION = 0x20; // 2.0\nconst FIT_PROFILE_VERSION = 0x0813; // 20.83\n\n// FIT Message Numbers\nconst FIT_MESG_FILE_ID = 0;\nconst FIT_MESG_FILE_CREATOR = 1;\nconst FIT_MESG_ACTIVITY = 34;\nconst FIT_MESG_SESSION = 18;\nconst FIT_MESG_LAP = 19;\nconst FIT_MESG_RECORD = 20;\nconst FIT_MESG_EVENT = 21;\n\n// FIT Base Types (only used types are uncommented)\nconst FIT_BASE_TYPE_ENUM = 0x00;\n// const FIT_BASE_TYPE_SINT8 = 0x01;\nconst FIT_BASE_TYPE_UINT8 = 0x02;\n// const FIT_BASE_TYPE_SINT16 = 0x83;\nconst FIT_BASE_TYPE_UINT16 = 0x84;\n// const FIT_BASE_TYPE_SINT32 = 0x85;\nconst FIT_BASE_TYPE_UINT32 = 0x86;\n// const FIT_BASE_TYPE_STRING = 0x07;\n\n// FIT Field IDs for File ID message\nconst FILE_ID_TYPE = 0;\nconst FILE_ID_MANUFACTURER = 1;\nconst FILE_ID_PRODUCT = 2;\nconst FILE_ID_SERIAL_NUMBER = 3;\nconst FILE_ID_TIME_CREATED = 4;\n\n// FIT Field IDs for Record message\nconst RECORD_TIMESTAMP = 253;\nconst RECORD_HEART_RATE = 3;\nconst RECORD_CADENCE = 4;\nconst RECORD_POWER = 7;\n\n// FIT Field IDs for Session message\nconst SESSION_TIMESTAMP = 253;\nconst SESSION_START_TIME = 2;\nconst SESSION_TOTAL_ELAPSED_TIME = 7;\nconst SESSION_TOTAL_TIMER_TIME = 8;\nconst SESSION_SPORT = 5;\nconst SESSION_SUB_SPORT = 6;\nconst SESSION_EVENT = 0;\nconst SESSION_EVENT_TYPE = 1;\n\n// FIT Field IDs for Lap message\nconst LAP_TIMESTAMP = 253;\nconst LAP_START_TIME = 2;\nconst LAP_TOTAL_ELAPSED_TIME = 7;\nconst LAP_TOTAL_TIMER_TIME = 8;\nconst LAP_EVENT = 0;\nconst LAP_EVENT_TYPE = 1;\n\n// FIT Field IDs for Event message\nconst EVENT_TIMESTAMP = 253;\nconst EVENT_EVENT = 0;\nconst EVENT_EVENT_TYPE = 1;\n\n// FIT Field IDs for Activity message\nconst ACTIVITY_TIMESTAMP = 253;\nconst ACTIVITY_TOTAL_TIMER_TIME = 0;\nconst ACTIVITY_NUM_SESSIONS = 1;\nconst ACTIVITY_TYPE = 2;\nconst ACTIVITY_EVENT = 3;\nconst ACTIVITY_EVENT_TYPE = 4;\nconst ACTIVITY_LOCAL_TIMESTAMP = 5;\n\n// FIT Type values\nconst FILE_TYPE_ACTIVITY = 4;\nconst MANUFACTURER_DEVELOPMENT = 255;\nconst SPORT_CYCLING = 2;\nconst SUB_SPORT_INDOOR_CYCLING = 6;\nconst EVENT_TIMER = 0;\nconst EVENT_SESSION = 8;\nconst EVENT_LAP = 9;\nconst EVENT_ACTIVITY = 26;\nconst EVENT_TYPE_START = 0;\nconst EVENT_TYPE_STOP = 1;\nconst ACTIVITY_TYPE_MANUAL = 0;\n\n// FIT timestamp epoch (1989-12-31 00:00:00 UTC)\nconst FIT_EPOCH_MS = Date.UTC(1989, 11, 31, 0, 0, 0);\n\n/**\n * Calculate CRC-16 (CCITT) for FIT file\n */\nfunction calculateCrc(buffer: Uint8Array, start: number, end: number): number {\n    const crcTable = [\n        0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401,\n        0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400\n    ];\n\n    let crc = 0;\n    for (let i = start; i < end; i++) {\n        const byte = buffer[i];\n        // Low nibble\n        let tmp = crcTable[crc & 0xF];\n        crc = (crc >> 4) & 0x0FFF;\n        crc = crc ^ tmp ^ crcTable[byte & 0xF];\n        // High nibble\n        tmp = crcTable[crc & 0xF];\n        crc = (crc >> 4) & 0x0FFF;\n        crc = crc ^ tmp ^ crcTable[(byte >> 4) & 0xF];\n    }\n    return crc;\n}\n\n/**\n * Convert JavaScript timestamp to FIT timestamp\n */\nfunction toFitTimestamp(jsTimestamp: number): number {\n    return Math.round((jsTimestamp - FIT_EPOCH_MS) / 1000);\n}\n\n/**\n * FIT file builder class\n */\nclass FitBuilder {\n    private buffer: number[] = [];\n    private definedMessages: Map<number, boolean> = new Map();\n\n    /**\n     * Write header (14 bytes)\n     */\n    writeHeader(): void {\n        // Header size (1 byte)\n        this.buffer.push(14);\n        // Protocol version (1 byte)\n        this.buffer.push(FIT_PROTOCOL_VERSION);\n        // Profile version (2 bytes, little-endian)\n        this.buffer.push(FIT_PROFILE_VERSION & 0xFF);\n        this.buffer.push((FIT_PROFILE_VERSION >> 8) & 0xFF);\n        // Data size placeholder (4 bytes) - will be updated later\n        this.buffer.push(0, 0, 0, 0);\n        // Data type \".FIT\" (4 bytes)\n        this.buffer.push(0x2E, 0x46, 0x49, 0x54); // \".FIT\"\n        // CRC (2 bytes) - will be updated later\n        this.buffer.push(0, 0);\n    }\n\n    /**\n     * Write definition message\n     */\n    writeDefinition(localMsgType: number, globalMsgNum: number, fields: { fieldDefNum: number; size: number; baseType: number }[]): void {\n        // Record header: definition message (bit 6 = 1)\n        this.buffer.push(0x40 | (localMsgType & 0x0F));\n        // Reserved byte\n        this.buffer.push(0);\n        // Architecture (0 = little-endian)\n        this.buffer.push(0);\n        // Global message number (2 bytes, little-endian)\n        this.buffer.push(globalMsgNum & 0xFF);\n        this.buffer.push((globalMsgNum >> 8) & 0xFF);\n        // Number of fields\n        this.buffer.push(fields.length);\n        // Field definitions\n        for (const field of fields) {\n            this.buffer.push(field.fieldDefNum);\n            this.buffer.push(field.size);\n            this.buffer.push(field.baseType);\n        }\n        this.definedMessages.set(localMsgType, true);\n    }\n\n    /**\n     * Write data message\n     */\n    writeData(localMsgType: number, values: (number | null)[]): void {\n        // Record header: data message (bit 6 = 0)\n        this.buffer.push(localMsgType & 0x0F);\n        // Field values\n        for (const value of values) {\n            if (typeof value === 'number') {\n                // Handled by caller based on field size\n            }\n        }\n    }\n\n    /**\n     * Write uint8 value\n     */\n    writeUint8(value: number): void {\n        this.buffer.push(value & 0xFF);\n    }\n\n    /**\n     * Write uint16 value (little-endian)\n     */\n    writeUint16(value: number): void {\n        this.buffer.push(value & 0xFF);\n        this.buffer.push((value >> 8) & 0xFF);\n    }\n\n    /**\n     * Write uint32 value (little-endian)\n     */\n    writeUint32(value: number): void {\n        this.buffer.push(value & 0xFF);\n        this.buffer.push((value >> 8) & 0xFF);\n        this.buffer.push((value >> 16) & 0xFF);\n        this.buffer.push((value >> 24) & 0xFF);\n    }\n\n    /**\n     * Write data message header\n     */\n    writeDataHeader(localMsgType: number): void {\n        this.buffer.push(localMsgType & 0x0F);\n    }\n\n    /**\n     * Finalize the FIT file with CRC\n     */\n    finalize(): Uint8Array {\n        const result = new Uint8Array(this.buffer);\n\n        // Update data size in header (bytes 4-7)\n        const dataSize = this.buffer.length - 14; // Exclude header\n        result[4] = dataSize & 0xFF;\n        result[5] = (dataSize >> 8) & 0xFF;\n        result[6] = (dataSize >> 16) & 0xFF;\n        result[7] = (dataSize >> 24) & 0xFF;\n\n        // Calculate header CRC (bytes 12-13)\n        const headerCrc = calculateCrc(result, 0, 12);\n        result[12] = headerCrc & 0xFF;\n        result[13] = (headerCrc >> 8) & 0xFF;\n\n        // Calculate and append data CRC\n        const dataCrc = calculateCrc(result, 0, result.length);\n        const finalBuffer = new Uint8Array(result.length + 2);\n        finalBuffer.set(result);\n        finalBuffer[result.length] = dataCrc & 0xFF;\n        finalBuffer[result.length + 1] = (dataCrc >> 8) & 0xFF;\n\n        return finalBuffer;\n    }\n\n    /**\n     * Get current buffer as array\n     */\n    getBuffer(): number[] {\n        return this.buffer;\n    }\n}\n\n/**\n * Creates a Garmin FIT binary file from workout measurements.\n * \n * FIT (Flexible and Interoperable Data Transfer) is a binary format\n * used by Garmin devices and supported by most fitness platforms.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns FIT binary data as Uint8Array, or null if no data\n * \n * @example\n * const fitData = getFitData(measurementsState);\n * if (fitData) {\n *     const blob = new Blob([fitData], { type: 'application/fit' });\n *     // Download or upload the file\n * }\n */\nexport const getFitData = (measurements: MeasurementsData): Uint8Array | null => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return null;\n    }\n\n    const fit = new FitBuilder();\n    fit.writeHeader();\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const fitStartTime = toFitTimestamp(firstTimestamp);\n    const fitEndTime = toFitTimestamp(lastTimestamp);\n    const totalElapsedTime = (lastTimestamp - firstTimestamp) / 1000; // seconds\n    const totalElapsedTimeMs = Math.round(totalElapsedTime * 1000); // milliseconds for FIT\n\n    // Local message type assignments\n    const LOCAL_FILE_ID = 0;\n    const LOCAL_FILE_CREATOR = 1;\n    const LOCAL_EVENT = 2;\n    const LOCAL_RECORD = 3;\n    const LOCAL_LAP = 4;\n    const LOCAL_SESSION = 5;\n    const LOCAL_ACTIVITY = 6;\n\n    // === File ID Message ===\n    fit.writeDefinition(LOCAL_FILE_ID, FIT_MESG_FILE_ID, [\n        { fieldDefNum: FILE_ID_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: FILE_ID_MANUFACTURER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_PRODUCT, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_SERIAL_NUMBER, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: FILE_ID_TIME_CREATED, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_ID);\n    fit.writeUint8(FILE_TYPE_ACTIVITY);\n    fit.writeUint16(MANUFACTURER_DEVELOPMENT);\n    fit.writeUint16(1); // Product ID\n    fit.writeUint32(12345678); // Serial number\n    fit.writeUint32(fitStartTime);\n\n    // === File Creator Message ===\n    fit.writeDefinition(LOCAL_FILE_CREATOR, FIT_MESG_FILE_CREATOR, [\n        { fieldDefNum: 0, size: 2, baseType: FIT_BASE_TYPE_UINT16 }, // software_version\n        { fieldDefNum: 1, size: 1, baseType: FIT_BASE_TYPE_UINT8 }, // hardware_version\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_CREATOR);\n    fit.writeUint16(100); // Software version\n    fit.writeUint8(1); // Hardware version\n\n    // === Timer Start Event ===\n    fit.writeDefinition(LOCAL_EVENT, FIT_MESG_EVENT, [\n        { fieldDefNum: EVENT_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: EVENT_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: EVENT_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_START);\n\n    // === Record Messages (one per data point) ===\n    fit.writeDefinition(LOCAL_RECORD, FIT_MESG_RECORD, [\n        { fieldDefNum: RECORD_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: RECORD_HEART_RATE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_CADENCE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_POWER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n    ]);\n\n    for (const point of dataPoints) {\n        const fitTimestamp = toFitTimestamp(point.timestamp);\n        fit.writeDataHeader(LOCAL_RECORD);\n        fit.writeUint32(fitTimestamp);\n        // Heart rate (0xFF = invalid)\n        fit.writeUint8(point.heartrate !== null ? Math.min(255, Math.round(point.heartrate)) : 0xFF);\n        // Cadence (0xFF = invalid)\n        fit.writeUint8(point.cadence !== null ? Math.min(255, Math.round(point.cadence)) : 0xFF);\n        // Power (0xFFFF = invalid)\n        fit.writeUint16(point.power !== null ? Math.round(point.power) : 0xFFFF);\n    }\n\n    // === Timer Stop Event ===\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Lap Message ===\n    fit.writeDefinition(LOCAL_LAP, FIT_MESG_LAP, [\n        { fieldDefNum: LAP_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: LAP_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_LAP);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint8(EVENT_LAP);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Session Message ===\n    fit.writeDefinition(LOCAL_SESSION, FIT_MESG_SESSION, [\n        { fieldDefNum: SESSION_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_SUB_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_SESSION);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint8(SPORT_CYCLING);\n    fit.writeUint8(SUB_SPORT_INDOOR_CYCLING);\n    fit.writeUint8(EVENT_SESSION);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Activity Message ===\n    fit.writeDefinition(LOCAL_ACTIVITY, FIT_MESG_ACTIVITY, [\n        { fieldDefNum: ACTIVITY_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_NUM_SESSIONS, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: ACTIVITY_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_LOCAL_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_ACTIVITY);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint16(1); // Number of sessions\n    fit.writeUint8(ACTIVITY_TYPE_MANUAL);\n    fit.writeUint8(EVENT_ACTIVITY);\n    fit.writeUint8(EVENT_TYPE_STOP);\n    fit.writeUint32(fitEndTime); // Local timestamp\n\n    return fit.finalize();\n};\n","/**\n * Undo Notification Module\n * \n * Displays a toast notification with an undo button that allows users\n * to reverse a destructive action within a time limit.\n * \n * @module undoNotification\n */\n\nimport { announce } from './accessibility.js';\n\n/** Default undo timeout in milliseconds */\nconst DEFAULT_UNDO_TIMEOUT = 5000;\n\n/**\n * Undo notification options\n */\nexport interface UndoNotificationOptions {\n    /** The message to display */\n    message: string;\n    /** Callback when undo is clicked */\n    onUndo: () => void;\n    /** Callback when the timeout expires without undo */\n    onExpire?: () => void;\n    /** Time in ms before the notification disappears (default: 5000) */\n    timeout?: number;\n    /** Icon to display (optional) */\n    icon?: string;\n}\n\n/**\n * Show an undo notification toast\n * \n * Displays a notification with a countdown timer and undo button.\n * The notification auto-dismisses after the timeout, executing onExpire.\n * If the user clicks undo, onUndo is called and the notification closes.\n * \n * @param options - Configuration for the undo notification\n * @returns A function to manually dismiss the notification\n */\nexport function showUndoNotification(options: UndoNotificationOptions): () => void {\n    const {\n        message,\n        onUndo,\n        onExpire,\n        timeout = DEFAULT_UNDO_TIMEOUT,\n        icon = '',\n    } = options;\n\n    // Remove any existing undo notifications\n    const existing = document.querySelector('.undo-notification');\n    existing?.remove();\n\n    // Create notification element\n    const notification = document.createElement('div');\n    notification.className = 'undo-notification';\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    // Calculate countdown in seconds\n    const timeoutSeconds = Math.ceil(timeout / 1000);\n    let remainingSeconds = timeoutSeconds;\n\n    // Create content\n    notification.innerHTML = `\n        <div class=\"undo-notification-content\">\n            <span class=\"undo-notification-icon\" aria-hidden=\"true\">${icon}</span>\n            <span class=\"undo-notification-message\">${message}</span>\n        </div>\n        <div class=\"undo-notification-actions\">\n            <button class=\"undo-notification-btn\" type=\"button\">\n                Undo <span class=\"undo-countdown\">(${remainingSeconds}s)</span>\n            </button>\n        </div>\n        <div class=\"undo-progress-bar\">\n            <div class=\"undo-progress-fill\"></div>\n        </div>\n    `;\n\n    document.body.appendChild(notification);\n\n    // Get elements\n    const undoButton = notification.querySelector('.undo-notification-btn') as HTMLButtonElement;\n    const countdownSpan = notification.querySelector('.undo-countdown') as HTMLSpanElement;\n    const progressFill = notification.querySelector('.undo-progress-fill') as HTMLDivElement;\n\n    // Check reduced motion preference\n    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n    // Set up progress bar animation\n    if (!prefersReducedMotion) {\n        progressFill.style.transition = `width ${timeout}ms linear`;\n        // Force reflow before starting animation\n        progressFill.offsetHeight;\n        progressFill.style.width = '0%';\n    } else {\n        progressFill.style.width = '0%';\n    }\n\n    // Animate in\n    requestAnimationFrame(() => {\n        notification.classList.add('undo-notification-visible');\n    });\n\n    let isUndone = false;\n    let countdownInterval: ReturnType<typeof setInterval> | null = null;\n    let dismissTimeout: ReturnType<typeof setTimeout> | null = null;\n\n    /**\n     * Dismiss the notification with cleanup\n     */\n    const dismiss = (executeExpire = false) => {\n        if (countdownInterval) {\n            clearInterval(countdownInterval);\n            countdownInterval = null;\n        }\n        if (dismissTimeout) {\n            clearTimeout(dismissTimeout);\n            dismissTimeout = null;\n        }\n\n        if (prefersReducedMotion) {\n            notification.remove();\n            if (executeExpire && !isUndone && onExpire) {\n                onExpire();\n            }\n        } else {\n            notification.classList.remove('undo-notification-visible');\n            notification.classList.add('undo-notification-hiding');\n            setTimeout(() => {\n                notification.remove();\n                if (executeExpire && !isUndone && onExpire) {\n                    onExpire();\n                }\n            }, 200);\n        }\n    };\n\n    // Start countdown display\n    countdownInterval = setInterval(() => {\n        remainingSeconds--;\n        if (remainingSeconds > 0) {\n            countdownSpan.textContent = `(${remainingSeconds}s)`;\n        } else {\n            if (countdownInterval) {\n                clearInterval(countdownInterval);\n            }\n        }\n    }, 1000);\n\n    // Set up auto-dismiss\n    dismissTimeout = setTimeout(() => {\n        dismiss(true);\n    }, timeout);\n\n    // Handle undo click\n    undoButton.addEventListener('click', () => {\n        isUndone = true;\n        dismiss(false);\n        onUndo();\n        announce('Action undone', 'assertive');\n    });\n\n    // Focus the undo button for accessibility\n    undoButton.focus();\n\n    // Announce to screen readers\n    announce(`${message} Press undo within ${timeoutSeconds} seconds to restore.`, 'assertive');\n\n    return () => dismiss(false);\n}\n\n/**\n * Data backup for undo functionality\n */\nexport interface WorkoutBackup {\n    power: Array<{ timestamp: number; value: number }>;\n    heartrate: Array<{ timestamp: number; value: number }>;\n    cadence: Array<{ timestamp: number; value: number }>;\n    startTime: number | null;\n    endTime: number | null;\n    running: boolean;\n}\n\n/**\n * Create a backup of workout data for undo\n * \n * @param measurementsState - The measurements state to backup\n * @param timeState - The time state to backup\n * @returns A backup object that can be restored\n */\nexport function createWorkoutBackup(\n    measurementsState: { power: Array<{ timestamp: number; value: number }>; heartrate: Array<{ timestamp: number; value: number }>; cadence: Array<{ timestamp: number; value: number }> },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): WorkoutBackup {\n    return {\n        power: [...measurementsState.power],\n        heartrate: [...measurementsState.heartrate],\n        cadence: [...measurementsState.cadence],\n        startTime: timeState.startTime,\n        endTime: timeState.endTime,\n        running: timeState.running,\n    };\n}\n\n/**\n * Restore workout data from a backup\n * \n * @param backup - The backup to restore\n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n */\nexport function restoreWorkoutBackup(\n    backup: WorkoutBackup,\n    measurementsState: { power: Array<{ timestamp: number; value: number }>; heartrate: Array<{ timestamp: number; value: number }>; cadence: Array<{ timestamp: number; value: number }> },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): void {\n    measurementsState.power = [...backup.power];\n    measurementsState.heartrate = [...backup.heartrate];\n    measurementsState.cadence = [...backup.cadence];\n    timeState.startTime = backup.startTime;\n    timeState.endTime = backup.endTime;\n    timeState.running = backup.running;\n}\n","import { getSettings } from '../ui/settings.js';\n\nexport class VoiceFeedback {\n    private synth: SpeechSynthesis | null;\n    private voice: SpeechSynthesisVoice | null = null;\n\n    constructor() {\n        this.synth = window.speechSynthesis || null;\n\n        if (!this.synth) {\n            console.warn('Speech Synthesis not supported on this device');\n            return;\n        }\n\n        // Wait for voices to be loaded\n        if (this.synth.onvoiceschanged !== undefined) {\n            this.synth.onvoiceschanged = () => this.loadVoice();\n        }\n        this.loadVoice();\n    }\n\n    private loadVoice() {\n        if (!this.synth) return;\n\n        const voices = this.synth.getVoices();\n        // Prefer English voices\n        this.voice = voices.find(v => v.lang.startsWith('en')) || voices[0] || null;\n    }\n\n    private formatTimeForSpeech(ms: number): string {\n        const totalSeconds = Math.floor(ms / 1000);\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = totalSeconds % 60;\n\n        const parts = [];\n        if (hours > 0) parts.push(`${hours} hours`);\n        if (minutes > 0) parts.push(`${minutes} minutes`);\n        if (seconds > 0 || parts.length === 0) parts.push(`${seconds} seconds`);\n\n        return parts.join(' ');\n    }\n\n    public speak(text: string) {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceEnabled) return;\n\n        if (this.synth.speaking) {\n            this.synth.cancel();\n        }\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        if (this.voice) {\n            utterance.voice = this.voice;\n        }\n        this.synth.speak(utterance);\n    }\n\n    public announceLap(lapNumber: number, timeMs: number, avgPower: number) {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceLaps) return;\n\n        const timeStr = this.formatTimeForSpeech(timeMs);\n        const text = `Lap ${lapNumber}. Time ${timeStr}. Average Power ${Math.round(avgPower)} watts.`;\n        this.speak(text);\n    }\n\n    public announceZoneChange(zoneName: string) {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceZones) return;\n\n        const text = `Entering ${zoneName} Zone`;\n        this.speak(text);\n    }\n}\n\nexport const voiceFeedback = new VoiceFeedback();\n","/**\n * Lap Button Functionality\n *\n * Handles lap marking during workouts.\n * Shows lap button during recording and updates lap counter.\n *\n * @module lap\n */\n\nimport { announce } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { getTimestring } from '../getTimestring.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Parameters for lap button initialization\n */\ninterface InitLapButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n}\n\n/**\n * Initialize the lap button functionality.\n *\n * Sets up:\n * - Lap button visibility based on workout state\n * - Lap counter display\n * - Click handler for marking laps\n *\n * @param params - Object containing state objects\n */\nexport function initLapButton({ measurementsState, timeState }: InitLapButtonParams): void {\n    const lapButton = document.getElementById('lapButton') as HTMLButtonElement | null;\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    if (!lapButton || !lapCounter || !lapCountElement) {\n        console.warn('Lap button elements not found in DOM');\n        return;\n    }\n\n    /**\n     * Update lap counter display\n     */\n    const updateLapCounter = (): void => {\n        const count = measurementsState.getLapCount();\n        lapCountElement.textContent = String(count);\n        lapCounter.style.display = count > 0 ? 'block' : 'none';\n    };\n\n    /**\n     * Show/hide lap button based on workout state\n     */\n    const updateLapButtonVisibility = (): void => {\n        const isRecording = timeState.running && timeState.startTime !== null;\n        lapButton.style.display = isRecording ? 'inline-flex' : 'none';\n    };\n\n    /**\n     * Handle lap button click\n     */\n    const handleLapClick = (): void => {\n        if (!timeState.running || !timeState.startTime) {\n            return;\n        }\n\n        // Get previous lap timestamp or start time\n        const laps = measurementsState.laps;\n        const lastLapTime = laps.length > 0 ? laps[laps.length - 1].timestamp : timeState.startTime;\n\n        const lap = measurementsState.addLap(timeState.startTime);\n        updateLapCounter();\n\n        // Calculate stats for the lap that just finished\n        const now = lap.timestamp;\n        const durationMs = now - lastLapTime;\n\n        // Calculate average power\n        const lapPower = measurementsState.power.filter(p => p.timestamp >= lastLapTime && p.timestamp <= now);\n        const avgPower = lapPower.length > 0\n            ? lapPower.reduce((sum, p) => sum + p.value, 0) / lapPower.length\n            : 0;\n\n        // Voice announcement\n        voiceFeedback.announceLap(lap.number, durationMs, avgPower);\n\n        // Format elapsed time for the lap\n        const elapsedStr = lap.elapsedMs ? getTimestring(lap.elapsedMs) : '';\n        const message = `Lap ${lap.number}${elapsedStr ? ` at ${elapsedStr}` : ''}`;\n\n        // Show toast notification\n        showNotification(` ${message}`, 'info');\n\n        // Announce for screen readers\n        announce(message, 'assertive');\n\n        console.log(`Lap marked: ${lap.number} at ${new Date(lap.timestamp).toISOString()}`);\n    };\n\n    // Lap button click handler\n    lapButton.addEventListener('click', handleLapClick);\n\n    // Watch for workout state changes by observing button visibility\n    // This is a simple approach - in a more complex app, use events or state management\n    const observer = new MutationObserver(() => {\n        updateLapButtonVisibility();\n    });\n\n    // Observe the start/pause/resume buttons for visibility changes\n    [startButton, pauseButton, resumeButton, stopButton].forEach(btn => {\n        if (btn) {\n            observer.observe(btn, { attributes: true, attributeFilter: ['style'] });\n        }\n    });\n\n    // Initial state\n    updateLapButtonVisibility();\n    updateLapCounter();\n\n    // Also update when recording starts (observe start button click)\n    startButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    pauseButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    resumeButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    stopButton?.addEventListener('click', () => {\n        setTimeout(() => {\n            updateLapButtonVisibility();\n            // Reset lap counter display after workout stops\n            // (laps are cleared when workout data is discarded)\n        }, 10);\n    });\n\n    console.log('Lap button initialized');\n}\n\n/**\n * Reset lap counter display (called when workout is discarded)\n */\nexport function resetLapCounter(): void {\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n\n    if (lapCounter && lapCountElement) {\n        lapCountElement.textContent = '0';\n        lapCounter.style.display = 'none';\n    }\n}\n","/**\n * Analytics Helper for BPT\n * \n * Shared logic for calculating statistics, parsing summaries, and tracking personal records.\n */\n\nimport type { Workout } from '../api/workoutClient.js';\nimport type { WorkoutSummary } from './modal.js';\n\ninterface PrState {\n    maxPower: number;\n    maxHr: number;\n    longestDuration: number;\n    longestDistance: number;\n    powerCurve: Record<number, number>; // duration -> watts\n}\n\nexport class PersonalRecordTracker {\n    private state: PrState = {\n        maxPower: 0,\n        maxHr: 0,\n        longestDuration: 0,\n        longestDistance: 0,\n        powerCurve: {}\n    };\n\n    /**\n     * Initialize tracker with historical workouts\n     */\n    constructor(workouts: Workout[]) {\n        this.processHistory(workouts);\n    }\n\n    private processHistory(workouts: Workout[]): void {\n        workouts.forEach(w => {\n            const summary = getSummary(w);\n\n            if (summary.power?.max && summary.power.max > this.state.maxPower) {\n                this.state.maxPower = summary.power.max;\n            }\n            if (summary.heartrate?.max && summary.heartrate.max > this.state.maxHr) {\n                this.state.maxHr = summary.heartrate.max;\n            }\n            if (w.duration && w.duration > this.state.longestDuration) {\n                this.state.longestDuration = w.duration;\n            }\n            /*\n            if (summary.totalDistance && summary.totalDistance > this.state.longestDistance) {\n                this.state.longestDistance = summary.totalDistance;\n            }\n            */\n\n            // Power Curve\n            if (summary.powerCurve) {\n                summary.powerCurve.forEach((p: { duration: number; watts: number }) => {\n                    const currentBest = this.state.powerCurve[p.duration] || 0;\n                    if (p.watts > currentBest) {\n                        this.state.powerCurve[p.duration] = p.watts;\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * Check a new workout for records\n     * @returns Array of strings describing any new records\n     */\n    public checkNewRecords(newSummary: WorkoutSummary): string[] {\n        const records: string[] = [];\n\n        if (newSummary.power.max && newSummary.power.max > this.state.maxPower) {\n            records.push(`Max Power: ${newSummary.power.max} W`);\n        }\n\n        if (newSummary.heartrate.max && newSummary.heartrate.max > this.state.maxHr) {\n            records.push(`Max Heart Rate: ${newSummary.heartrate.max} bpm`);\n        }\n\n        // duration is in ms in Workout (DB), but WorkoutSummary.duration might be ms?\n        // Let's verify modal.ts. duration = endTime - startTime (ms).\n        if (newSummary.duration && newSummary.duration > this.state.longestDuration) {\n            // Only report significant duration records (>10% improvement or >1h) to avoid noise?\n            // For now, just simplistic check\n            records.push(`Longest Ride: ${formatDuration(newSummary.duration)}`);\n        }\n\n        // Modal summary doesn't have totalDistance computed yet unfortunately calculateWorkoutSummary doesn't do distance from GPS\n        // We might skip distance for live summary check unless we update calculateWorkoutSummary to include it.\n\n        // Power Curve\n        if (newSummary.powerCurve) {\n            const significantDurations = [1, 5, 60, 300, 1200, 3600]; // 1s, 5s, 1m, 5m, 20m, 1h\n            const labels: Record<number, string> = {\n                1: '1s Power',\n                5: '5s Power',\n                60: '1m Power',\n                300: '5m Power',\n                1200: '20m Power',\n                3600: '1h Power'\n            };\n\n            newSummary.powerCurve.forEach(p => {\n                if (significantDurations.includes(p.duration)) {\n                    const currentBest = this.state.powerCurve[p.duration] || 0;\n                    if (p.watts > currentBest) {\n                        // Avoid duplicates if multiple durations map to \"Max Power\" (like 1s)\n                        if (p.duration === 1 && records.some(r => r.startsWith('Max Power'))) return;\n\n                        records.push(`${labels[p.duration]}: ${p.watts} W`);\n                    }\n                }\n            });\n        }\n\n        return records;\n    }\n}\n\n/**\n * Helper to safely parse summary from DB workout\n * Note: Local WorkoutSummary type has different shape than DB text/json summary.\n * We cast to 'any' for reading flexible fields.\n */\nexport function getSummary(workout: Workout): Partial<WorkoutSummary> {\n    if (!workout.summary) return {};\n    if (typeof workout.summary === 'string') {\n        try {\n            return JSON.parse(workout.summary) as Partial<WorkoutSummary>;\n        } catch {\n            return {};\n        }\n    }\n    return workout.summary as unknown as Partial<WorkoutSummary>;\n}\n\nfunction formatDuration(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const h = Math.floor(seconds / 3600);\n    const m = Math.floor((seconds % 3600) / 60);\n    const s = seconds % 60;\n    if (h > 0) return `${h}h ${m}m`;\n    return `${m}m ${s}s`;\n}\n","/**\n * Application settings stored in localStorage\n */\nexport interface AppSettings {\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n}\n\n/**\n * Default settings\n */\nexport const defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n};\n","/**\n * Menu Controls\n * \n * Initializes menu buttons for export, discard, and settings toggle.\n * \n * @module menu\n */\n\nimport { getCsvString } from '../create-csv.js';\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js';\nimport { showConfirmation, showWorkoutSummary, calculateWorkoutSummary } from './modal.js';\nimport { announce } from './accessibility.js';\nimport { showUndoNotification, createWorkoutBackup, restoreWorkoutBackup, type WorkoutBackup } from './undoNotification.js';\nimport { resetLapCounter } from './lap.js';\nimport { PersonalRecordTracker } from './analyticsHelper.js';\nimport { listWorkouts, isDatabaseAvailable } from '../api/workoutClient.js';\nimport { archiveWorkout } from '../storage/workoutStorage.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { ZoneState } from '../zone-state.js';\nimport { type AppSettings, defaultSettings } from '../types/settings.js';\n\n/**\n * Initialize the metrics visibility toggles.\n * \n * Sets up toggle switches for showing/hiding \"Your Metrics\" and \"Stream Metrics\" sections.\n */\nexport const initMetricsToggle = (): void => {\n    // Your Metrics Toggle\n    const toggleYour = document.getElementById('toggleYourMetrics') as HTMLInputElement | null;\n    const yourMetricsSection = document.getElementById('yourMetrics');\n\n    if (toggleYour && yourMetricsSection) {\n        // Initial state check\n        toggleYour.checked = yourMetricsSection.style.display !== 'none';\n\n        toggleYour.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            yourMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n\n    // Stream Metrics Toggle\n    const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n    const streamMetricsSection = document.getElementById('streamMetrics');\n\n    if (toggleStream && streamMetricsSection) {\n        // Initial state check\n        toggleStream.checked = streamMetricsSection.style.display !== 'none';\n\n        toggleStream.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            streamMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n};\n\n/**\n * Parameters for discard button initialization\n */\ninterface InitDiscardButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/**\n * Initialize the discard button.\n * \n * Shows a custom confirmation dialog before clearing all workout data.\n * After discard, shows an undo notification for 5 seconds allowing\n * the user to restore their data.\n * \n * @param params - Object containing state objects\n */\nexport const initDiscardButton = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitDiscardButtonParams): void => {\n    const discardButton = document.getElementById('discardButton');\n\n    if (!discardButton) {\n        console.warn('Discard button not found in DOM');\n        return;\n    }\n\n    const addListener = (btn: HTMLElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    addListener(discardButton, async () => {\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0 ||\n            timeState.startTime !== null;\n\n        // If no data, just reset silently\n        if (!hasData) {\n            resetWorkoutState(measurementsState, timeState);\n            return;\n        }\n\n        // Count data points for the warning message\n        const totalDataPoints =\n            measurementsState.power.length +\n            measurementsState.heartrate.length +\n            measurementsState.cadence.length;\n\n        const confirmed = await showConfirmation(\n            'Discard Workout',\n            `Are you sure you want to discard this workout? You have ${totalDataPoints} data points that will be deleted. You'll have 5 seconds to undo this action.`,\n            {\n                confirmText: 'Discard',\n                cancelText: 'Keep Data',\n                confirmVariant: 'danger',\n                icon: '',\n            }\n        );\n\n        if (confirmed) {\n            // Create backup before clearing\n            const backup = createWorkoutBackup(measurementsState, timeState);\n\n            // Clear the workout data\n            resetWorkoutState(measurementsState, timeState);\n\n            // Reset zone tracking\n            if (zoneState) {\n                zoneState.reset();\n            }\n\n            // Dispatch event for zone state to reset\n            document.dispatchEvent(new CustomEvent('workout-discarded'));\n\n            // Reset lap counter display\n            resetLapCounter();\n\n            // Show undo notification\n            showUndoNotification({\n                message: 'Workout data discarded',\n                icon: '',\n                timeout: 5000,\n                onUndo: () => {\n                    // Restore the backup\n                    restoreWorkoutBackup(backup, measurementsState, timeState);\n\n                    // Restore UI state based on the backup\n                    restoreWorkoutUI(backup);\n\n                    announce('Workout data restored', 'polite');\n                },\n                onExpire: () => {\n                    // Data is already cleared, nothing more to do\n                    announce('Discard complete', 'polite');\n                },\n            });\n        }\n    });\n};\n\n/**\n * Restore the workout UI based on backed up state\n */\nfunction restoreWorkoutUI(backup: WorkoutBackup): void {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n\n    if (backup.running) {\n        // Was running when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'inline-flex';\n        if (resumeButton) resumeButton.style.display = 'none';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    } else if (backup.startTime !== null) {\n        // Was paused when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'none';\n        if (resumeButton) resumeButton.style.display = 'inline-flex';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    }\n\n    // Restore timer display if there was a start time\n    if (timeElement && backup.startTime !== null) {\n        const elapsed = (backup.endTime || Date.now()) - backup.startTime;\n        const seconds = Math.floor(elapsed / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        timeElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\n    }\n}\n\n/**\n * Reset workout state to initial values\n */\nfunction resetWorkoutState(measurementsState: MeasurementsState, timeState: TimeState): void {\n    // Reset time state\n    timeState.running = false;\n    timeState.startTime = null;\n    timeState.endTime = null;\n\n    // Reset measurements\n    measurementsState.power = [];\n    measurementsState.heartrate = [];\n    measurementsState.cadence = [];\n\n    // Reset workout controls to idle state\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton) startButton.style.display = 'inline-flex';\n    if (pauseButton) pauseButton.style.display = 'none';\n    if (resumeButton) resumeButton.style.display = 'none';\n    if (stopButton) stopButton.style.display = 'none';\n\n    // Reset timer display\n    const timeElement = document.getElementById('time');\n    if (timeElement) timeElement.textContent = '00:00:00';\n}\n\n/**\n * Generate a timestamp string for filenames.\n */\nfunction getExportTimestamp(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;\n}\n\n/**\n * Download a file by creating a temporary link element.\n */\nfunction downloadFile(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n}\n\n/**\n * Initialize the export button.\n * \n * Exports workout data in configured formats (TCX, CSV, JSON).\n * \n * @param measurementsState - The measurements state object\n * @param zoneState - Optional zone state for including zone data in exports\n */\nexport const initExportButton = (measurementsState: MeasurementsState, zoneState?: ZoneState): void => {\n    const exportDataElem = document.getElementById('exportData');\n\n    if (!exportDataElem) {\n        console.warn('Export button not found in DOM');\n        return;\n    }\n\n    const addListener = (btn: HTMLElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    addListener(exportDataElem, () => {\n        try {\n            // Get export format settings\n            const settingsJson = localStorage.getItem('bpt-settings');\n            const settings: AppSettings = settingsJson\n                ? { ...defaultSettings, ...JSON.parse(settingsJson) }\n                : defaultSettings;\n\n            const timestamp = getExportTimestamp();\n\n            // Download JSON file (includes zone data)\n            if (settings.exportJson) {\n                const exportData: Record<string, unknown> = {\n                    power: measurementsState.power,\n                    heartrate: measurementsState.heartrate,\n                    cadence: measurementsState.cadence,\n                };\n\n                // Include zone distribution data if available\n                if (zoneState) {\n                    const zoneData = zoneState.toJSON();\n                    if (zoneData.powerZones.some(z => z.timeInZoneMs > 0) ||\n                        zoneData.hrZones.some(z => z.timeInZoneMs > 0)) {\n                        exportData.zoneDistribution = {\n                            power: zoneData.powerZones.map(z => ({\n                                zone: z.zone,\n                                name: z.name,\n                                timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                            })),\n                            heartrate: zoneData.hrZones.map(z => ({\n                                zone: z.zone,\n                                name: z.name,\n                                timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                            })),\n                            ftp: zoneData.ftp,\n                            maxHr: zoneData.maxHr,\n                        };\n                    }\n                }\n\n                const jsonString = JSON.stringify(exportData, null, 2);\n                const jsonBlob = new Blob([jsonString], { type: 'application/json' });\n                downloadFile(jsonBlob, `bike-measurements-${timestamp}.json`);\n            }\n\n            // Download TCX file\n            if (settings.exportTcx) {\n                const tcxString = getTcxString(measurementsState);\n                if (tcxString) {\n                    const tcxBlob = new Blob([tcxString], { type: 'application/xml' });\n                    downloadFile(tcxBlob, `bike-workout-${timestamp}.tcx`);\n                }\n            }\n\n            // Download CSV file\n            if (settings.exportCsv) {\n                const csvString = getCsvString(measurementsState);\n                if (csvString) {\n                    const csvBlob = new Blob([csvString], { type: 'text/csv' });\n                    downloadFile(csvBlob, `bike-workout-${timestamp}.csv`);\n                }\n            }\n\n            // Download FIT file\n            if (settings.exportFit) {\n                const fitData = getFitData(measurementsState);\n                if (fitData) {\n                    const fitBlob = new Blob([new Uint8Array(fitData)], { type: 'application/fit' });\n                    downloadFile(fitBlob, `bike-workout-${timestamp}.fit`);\n                }\n            }\n        } catch (error) {\n            console.error('Error exporting data:', error);\n        }\n    });\n};\n\n/**\n * Parameters for workout summary initialization\n */\ninterface InitWorkoutSummaryParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/**\n * Initialize the post-workout summary modal.\n * \n * Listens for the 'workoutComplete' event and shows a summary modal\n * with workout statistics and export options.\n * \n * @param params - Object containing state objects\n */\nexport const initWorkoutSummaryModal = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitWorkoutSummaryParams): void => {\n    document.addEventListener('workoutComplete', async (event) => {\n        const detail = (event as CustomEvent).detail;\n\n        // Only show summary if we have data\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0;\n\n        if (!hasData && !detail.startTime) {\n            return;\n        }\n\n        const summary = calculateWorkoutSummary(\n            detail.startTime || timeState.startTime || Date.now(),\n            detail.endTime || timeState.endTime || Date.now(),\n            measurementsState,\n            zoneState\n        );\n\n        // Check for Personal Records\n        let newRecords: string[] = [];\n        try {\n            if (await isDatabaseAvailable()) {\n                const history = await listWorkouts({ limit: 1000 }); // Fetch simplified list\n                const tracker = new PersonalRecordTracker(history.workouts);\n                newRecords = tracker.checkNewRecords(summary);\n\n                if (newRecords.length > 0) {\n                    announce(`Congratulations! You set ${newRecords.length} new personal records!`, 'assertive');\n                }\n            }\n        } catch (e) {\n            console.warn('Failed to check for PRs:', e);\n        }\n\n        await showWorkoutSummary(summary, {\n            onExport: async () => {\n                try {\n                    // Archive to IndexedDB\n                    await archiveWorkout();\n                    announce('Workout saved to local history', 'polite');\n                } catch (err) {\n                    console.error('Failed to save to local history', err);\n                    announce('Failed to save to local history', 'assertive');\n                }\n\n                // Trigger the export button click\n                const exportButton = document.getElementById('exportData');\n                exportButton?.click();\n\n                // Reset state after export\n                resetWorkoutState(measurementsState, timeState);\n            },\n            onDiscard: () => {\n                resetWorkoutState(measurementsState, timeState);\n                announce('Workout discarded', 'polite');\n            },\n            onKeepRecording: () => {\n                // Resume the workout\n                const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n                resumeButton?.click();\n            },\n        }, newRecords);\n    });\n};\n","/**\n * DOM Element References\n * \n * Centralized access to DOM elements used throughout the application.\n * \n * @module elements\n */\n\nimport type { SensorType } from './types/connections.js';\n\n/**\n * Sensor element configuration\n */\nexport interface SensorElements {\n    display: HTMLElement | null;\n    connect: HTMLElement | null;\n}\n\n/**\n * All sensor elements by type\n */\nexport type SensorElementsMap = Record<SensorType, SensorElements>;\n\n/**\n * Get DOM element by ID with null check\n * \n * @param id - Element ID\n * @returns The element or null if not found\n */\nfunction getElement<T extends HTMLElement = HTMLElement>(id: string): T | null {\n    const el = document.getElementById(id) as T | null;\n    if (!el) {\n        // console.warn(`Element with ID \"${id}\" not found`);\n    }\n    return el;\n}\n\n/**\n * Grouped elements by sensor type.\n * Uses getters to lazily retrieve elements from the DOM, ensuring they are found\n * even if this module is imported before the DOM is fully constructed.\n */\nexport const elements: SensorElementsMap = {\n    get power() { return { display: getElement('power'), connect: getElement('connectPower') }; },\n    get heartrate() { return { display: getElement('heartrate'), connect: getElement('connectHeartrate') }; },\n    get cadence() { return { display: getElement('cadence'), connect: getElement('connectCadence') }; },\n    get gps() { return { display: null, connect: getElement('connectGps') }; },\n    get speed() { return { display: getElement('speed'), connect: null }; },\n    get distance() { return { display: getElement('distance'), connect: null }; },\n    get altitude() { return { display: getElement('altitude'), connect: null }; },\n    get treadmill() { return { display: getElement('value-incline'), connect: getElement('connectTreadmill') }; },\n    get treadmillSpeed() { return { display: getElement('treadmillSpeed'), connect: null }; },\n};\n\n/**\n * Get element by ID (type-safe helper)\n */\nexport { getElement };\n","/**\n * Zone State Management\n * \n * Tracks time spent in each power and heart rate zone during a workout.\n * Integrates with UserProfile for zone thresholds.\n * \n * @module ZoneState\n */\n\n/**\n * User profile for zone calculations\n */\ninterface UserProfile {\n    ftp: number | null;\n    maxHr: number | null;\n}\n\n/** Storage key for user profile */\nconst PROFILE_KEY = 'bpt-user-profile';\n\n/**\n * Load user profile from localStorage\n */\nfunction loadUserProfile(): UserProfile {\n    try {\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return JSON.parse(stored);\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ftp: null, maxHr: null };\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nfunction calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.90) },\n        { name: 'Threshold', min: Math.round(ftp * 0.90), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.20) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.20), max: Math.round(ftp * 1.50) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.50), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nfunction calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.50), max: Math.round(maxHr * 0.60) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.60), max: Math.round(maxHr * 0.70) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.70), max: Math.round(maxHr * 0.80) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.80), max: Math.round(maxHr * 0.90) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.90), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nfunction getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nfunction getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Zone information with time tracking\n */\nexport interface ZoneInfo {\n    zone: number;\n    name: string;\n    min: number;\n    max: number;\n    timeInZoneMs: number;\n}\n\n/**\n * Current zone status for real-time display\n */\nexport interface CurrentZoneStatus {\n    zone: number;\n    name: string;\n    percentInZone: number; // 0-100, position within zone range\n}\n\n/**\n * Zone distribution data for summary\n */\nexport interface ZoneDistribution {\n    zones: ZoneInfo[];\n    totalTimeMs: number;\n}\n\n/**\n * State change callback type\n */\nexport type ZoneStateChangeCallback = () => void;\n\n/**\n * Zone State class for tracking time in zones\n */\nexport class ZoneState {\n    private _powerZones: ZoneInfo[] = [];\n    private _hrZones: ZoneInfo[] = [];\n    private _lastPowerZone: number | null = null;\n    private _lastHrZone: number | null = null;\n    private _lastUpdateTime: number | null = null;\n    private _ftp: number | null = null;\n    private _maxHr: number | null = null;\n    private _currentPowerZone: CurrentZoneStatus | null = null;\n    private _currentHrZone: CurrentZoneStatus | null = null;\n    private _onChangeCallbacks: ZoneStateChangeCallback[] = [];\n\n    constructor() {\n        this.loadProfile();\n    }\n\n    /**\n     * Load user profile and initialize zones\n     */\n    loadProfile(): void {\n        const profile = loadUserProfile();\n        this._ftp = profile.ftp;\n        this._maxHr = profile.maxHr;\n\n        // Initialize power zones\n        if (this._ftp) {\n            const powerZonesDef = calculatePowerZones(this._ftp);\n            this._powerZones = powerZonesDef.map((z, i) => ({\n                zone: i + 1,\n                name: z.name,\n                min: z.min,\n                max: z.max,\n                timeInZoneMs: 0,\n            }));\n        }\n\n        // Initialize HR zones\n        if (this._maxHr) {\n            const hrZonesDef = calculateHrZones(this._maxHr);\n            this._hrZones = hrZonesDef.map((z, i) => ({\n                zone: i + 1,\n                name: z.name,\n                min: z.min,\n                max: z.max,\n                timeInZoneMs: 0,\n            }));\n        }\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: ZoneStateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: ZoneStateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    /**\n     * Notify listeners of state change\n     */\n    private _notifyChange(): void {\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('Zone state change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Update power value and track zone time\n     */\n    updatePower(power: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._ftp) return null;\n\n        const zoneInfo = getPowerZone(power, this._ftp);\n        if (!zoneInfo) return null;\n\n        const currentZone = zoneInfo.zone;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastPowerZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._powerZones[this._lastPowerZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                // Only count if less than 5 seconds (avoid large gaps)\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastPowerZone = currentZone;\n        this._lastUpdateTime = timestamp;\n\n        // Calculate position within zone\n        const zoneData = this._powerZones[currentZone - 1];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0\n            ? Math.min(100, Math.max(0, ((power - zoneData.min) / range) * 100))\n            : 50;\n\n        this._currentPowerZone = {\n            zone: currentZone,\n            name: zoneInfo.name,\n            percentInZone,\n        };\n\n        this._notifyChange();\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Update heart rate value and track zone time\n     */\n    updateHeartRate(hr: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._maxHr) return null;\n\n        const zoneInfo = getHrZone(hr, this._maxHr);\n        if (!zoneInfo) return null;\n\n        const currentZone = zoneInfo.zone;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastHrZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._hrZones[this._lastHrZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastHrZone = currentZone;\n        // Only update if no power update occurred (prevent double counting)\n        if (this._lastUpdateTime === null || timestamp - this._lastUpdateTime > 50) {\n            this._lastUpdateTime = timestamp;\n        }\n\n        // Calculate position within zone\n        const zoneData = this._hrZones[currentZone - 1];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0\n            ? Math.min(100, Math.max(0, ((hr - zoneData.min) / range) * 100))\n            : 50;\n\n        this._currentHrZone = {\n            zone: currentZone,\n            name: zoneInfo.name,\n            percentInZone,\n        };\n\n        this._notifyChange();\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get current power zone status\n     */\n    getCurrentPowerZone(): CurrentZoneStatus | null {\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Get current HR zone status\n     */\n    getCurrentHrZone(): CurrentZoneStatus | null {\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get power zone distribution for summary\n     */\n    getPowerZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._powerZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._powerZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Get HR zone distribution for summary\n     */\n    getHrZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._hrZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._hrZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Check if power zones are configured\n     */\n    hasPowerZones(): boolean {\n        return this._ftp !== null && this._ftp > 0;\n    }\n\n    /**\n     * Check if HR zones are configured\n     */\n    hasHrZones(): boolean {\n        return this._maxHr !== null && this._maxHr > 0;\n    }\n\n    /**\n     * Get FTP value\n     */\n    getFtp(): number | null {\n        return this._ftp;\n    }\n\n    /**\n     * Get Max HR value\n     */\n    getMaxHr(): number | null {\n        return this._maxHr;\n    }\n\n    /**\n     * Reset all zone tracking data\n     */\n    reset(): void {\n        this._powerZones.forEach(z => z.timeInZoneMs = 0);\n        this._hrZones.forEach(z => z.timeInZoneMs = 0);\n        this._lastPowerZone = null;\n        this._lastHrZone = null;\n        this._lastUpdateTime = null;\n        this._currentPowerZone = null;\n        this._currentHrZone = null;\n        this._notifyChange();\n    }\n\n    /**\n     * Export zone data as JSON (for exports/summary)\n     */\n    toJSON(): {\n        powerZones: ZoneInfo[];\n        hrZones: ZoneInfo[];\n        ftp: number | null;\n        maxHr: number | null;\n    } {\n        return {\n            powerZones: [...this._powerZones],\n            hrZones: [...this._hrZones],\n            ftp: this._ftp,\n            maxHr: this._maxHr,\n        };\n    }\n}\n","/**\n * Metrics Display Initialization\n * \n * Sets up real-time display updates for workout metrics.\n * Includes zone tracking and visual zone indicators.\n * \n * @module initMetricsDisplay\n */\n\nimport { elements } from './elements.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { MeasurementType } from './types/measurements.js';\nimport type { ConnectionsState } from './getInitState.js';\nimport { ZoneState } from './zone-state.js';\nimport type { ZoneGauge } from './components/ZoneGauge.js';\nimport type { LiveChart } from './components/LiveChart.js';\nimport { voiceFeedback } from './services/VoiceFeedback.js';\nimport { getSettings } from './config/settings.js';\n\n/**\n * Parameters for metrics display initialization\n */\ninterface InitMetricsDisplayParams {\n    connectionsState: ConnectionsState;\n    measurementsState: MeasurementsState;\n}\n\n/** Maximum age of measurement data before showing as disconnected (ms) */\nconst DATA_TIMEOUT_MS = 5000;\n\n/** Update interval for display refresh (ms) */\nconst UPDATE_INTERVAL_MS = 100;\n\n/** Zone state instance - exported for use in summary/exports */\nexport let zoneState: ZoneState;\n\n/**\n * Initialize zone gauges in the DOM\n */\nfunction initZoneGauges(): { powerGauge: ZoneGauge | null; hrGauge: ZoneGauge | null } {\n    // Look for existing zone gauges or create them\n    let powerGauge = document.getElementById('powerZoneGauge') as ZoneGauge | null;\n    let hrGauge = document.getElementById('hrZoneGauge') as ZoneGauge | null;\n\n    // Create power zone gauge if it doesn't exist\n    if (!powerGauge) {\n        const powerMetricGroup = document.querySelector('.metric-group-power');\n        if (powerMetricGroup) {\n            powerGauge = document.createElement('bpt-zone-gauge') as ZoneGauge;\n            powerGauge.id = 'powerZoneGauge';\n            powerGauge.setAttribute('type', 'power');\n            powerGauge.setAttribute('compact', '');\n            powerGauge.style.display = 'none'; // Hidden until zones are active\n            powerMetricGroup.appendChild(powerGauge);\n        }\n    }\n\n    // Create HR zone gauge if it doesn't exist\n    if (!hrGauge) {\n        const hrMetricGroup = document.querySelector('.metric-group-heartrate');\n        if (hrMetricGroup) {\n            hrGauge = document.createElement('bpt-zone-gauge') as ZoneGauge;\n            hrGauge.id = 'hrZoneGauge';\n            hrGauge.setAttribute('type', 'heartrate');\n            hrGauge.setAttribute('compact', '');\n            hrGauge.style.display = 'none'; // Hidden until zones are active\n            hrMetricGroup.appendChild(hrGauge);\n        }\n    }\n\n    return { powerGauge, hrGauge };\n}\n\n/**\n * Initialize live charts for power and heart rate\n */\nfunction initLiveCharts(): { powerChart: LiveChart | null; hrChart: LiveChart | null } {\n    let powerChart = document.getElementById('powerLiveChart') as LiveChart | null;\n    let hrChart = document.getElementById('hrLiveChart') as LiveChart | null;\n\n    // Create charts container if it doesn't exist\n    let chartsContainer = document.getElementById('liveChartsContainer');\n    if (!chartsContainer) {\n        const metricsSection = document.getElementById('yourMetrics');\n        if (metricsSection) {\n            chartsContainer = document.createElement('div');\n            chartsContainer.id = 'liveChartsContainer';\n            chartsContainer.className = 'live-charts-container';\n            chartsContainer.style.display = 'none'; // Hidden by default\n\n            // Insert after metricsTable\n            const metricsTable = document.getElementById('metricsTable');\n            if (metricsTable && metricsTable.nextSibling) {\n                metricsSection.insertBefore(chartsContainer, metricsTable.nextSibling);\n            } else {\n                metricsSection.appendChild(chartsContainer);\n            }\n        }\n    }\n\n    if (chartsContainer) {\n        // Create power chart if it doesn't exist\n        if (!powerChart) {\n            powerChart = document.createElement('bpt-live-chart') as LiveChart;\n            powerChart.id = 'powerLiveChart';\n            powerChart.setAttribute('type', 'power');\n            powerChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(powerChart);\n        }\n\n        // Create HR chart if it doesn't exist\n        if (!hrChart) {\n            hrChart = document.createElement('bpt-live-chart') as LiveChart;\n            hrChart.id = 'hrLiveChart';\n            hrChart.setAttribute('type', 'heartrate');\n            hrChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(hrChart);\n        }\n    }\n\n    return { powerChart, hrChart };\n}\n\n/**\n * Get or create the charts toggle button\n */\nfunction initChartsToggle(chartsVisible: boolean): HTMLButtonElement | null {\n    let toggleBtn = document.getElementById('toggleLiveCharts') as HTMLButtonElement | null;\n\n    if (!toggleBtn) {\n        const topBarControls = document.getElementById('topBarControls');\n        if (topBarControls) {\n            toggleBtn = document.createElement('button');\n            toggleBtn.id = 'toggleLiveCharts';\n            toggleBtn.className = 'workout-btn workout-btn-chart';\n            toggleBtn.setAttribute('aria-label', 'Toggle live charts');\n            toggleBtn.setAttribute('title', 'Toggle Charts');\n            toggleBtn.innerHTML = '';\n            toggleBtn.style.display = 'none'; // Hidden until workout starts\n\n            // Insert before workout controls\n            const workoutControls = document.querySelector('.workout-controls');\n            if (workoutControls) {\n                topBarControls.insertBefore(toggleBtn, workoutControls);\n            } else {\n                topBarControls.appendChild(toggleBtn);\n            }\n        }\n    }\n\n    if (toggleBtn) {\n        toggleBtn.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n    }\n\n    return toggleBtn;\n}\n\n/**\n * Update the zone display elements\n */\nfunction updateZoneDisplays(\n    powerGauge: ZoneGauge | null,\n    hrGauge: ZoneGauge | null,\n    zoneState: ZoneState\n): void {\n    // Update power zone gauge\n    if (powerGauge) {\n        const powerZone = zoneState.getCurrentPowerZone();\n        if (powerZone && zoneState.hasPowerZones()) {\n            powerGauge.style.display = '';\n            powerGauge.setZone(powerZone.zone, powerZone.name, powerZone.percentInZone);\n        } else if (!zoneState.hasPowerZones()) {\n            powerGauge.style.display = 'none';\n        }\n    }\n\n    // Update HR zone gauge\n    if (hrGauge) {\n        const hrZone = zoneState.getCurrentHrZone();\n        if (hrZone && zoneState.hasHrZones()) {\n            hrGauge.style.display = '';\n            hrGauge.setZone(hrZone.zone, hrZone.name, hrZone.percentInZone);\n        } else if (!zoneState.hasHrZones()) {\n            hrGauge.style.display = 'none';\n        }\n    }\n}\n\n/**\n * Apply zone color to metric display element\n */\nfunction applyZoneColorToMetric(element: HTMLElement, zone: number | null, _type: 'power' | 'heartrate'): void {\n    const parent = element.closest('.metric-group');\n    if (!parent) return;\n\n    // Zone colors for power (7 zones) and HR (5 zones)\n    const zoneColors: Record<number, string> = {\n        1: '#3b82f6', // Blue - Recovery/Active Recovery\n        2: '#22c55e', // Green - Endurance/Aerobic\n        3: '#eab308', // Yellow - Tempo\n        4: '#f97316', // Orange - Threshold\n        5: '#ef4444', // Red - VO2max/Anaerobic\n        6: '#a855f7', // Purple - Anaerobic (power only)\n        7: '#ec4899', // Pink - Neuromuscular (power only)\n    };\n\n    if (zone !== null && zone >= 1 && zone <= 7) {\n        const color = zoneColors[zone];\n        element.style.color = color;\n        (parent as HTMLElement).style.borderLeftColor = color;\n        (parent as HTMLElement).style.borderLeftWidth = '4px';\n        (parent as HTMLElement).style.borderLeftStyle = 'solid';\n    } else {\n        element.style.color = '';\n        (parent as HTMLElement).style.borderLeftColor = '';\n        (parent as HTMLElement).style.borderLeftWidth = '';\n        (parent as HTMLElement).style.borderLeftStyle = '';\n    }\n}\n\n/**\n * Initialize the metrics display update loop.\n * \n * Creates an interval that updates the display elements with the latest\n * measurements from connected sensors. Shows '--' for disconnected sensors\n * or stale data (older than 5 seconds).\n * \n * @param params - Object containing state objects\n * @returns The ZoneState instance for external use\n */\nexport const initMetricsDisplay = ({\n    connectionsState,\n    measurementsState,\n}: InitMetricsDisplayParams): ZoneState => {\n    const emptyValue = '--';\n\n    // Initialize zone state\n    zoneState = new ZoneState();\n\n    // Initialize zone gauges\n    const { powerGauge, hrGauge } = initZoneGauges();\n\n    // Initialize live charts\n    const { powerChart, hrChart } = initLiveCharts();\n    let chartsVisible = localStorage.getItem('bpt-charts-visible') === 'true';\n\n    // Initialize charts toggle button\n    const chartsToggle = initChartsToggle(chartsVisible);\n    const chartsContainer = document.getElementById('liveChartsContainer');\n\n    // Set initial visibility\n    if (chartsContainer) {\n        chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n    }\n\n    // Charts toggle click handler\n    if (chartsToggle) {\n        chartsToggle.addEventListener('click', () => {\n            chartsVisible = !chartsVisible;\n            localStorage.setItem('bpt-charts-visible', chartsVisible ? 'true' : 'false');\n            chartsToggle.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n            if (chartsContainer) {\n                chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n            }\n        });\n    }\n\n    // Track last data index to only push new data points\n    let lastPowerIndex = 0;\n    let lastHrIndex = 0;\n\n    // Track last zones for voice feedback\n    let lastPowerZone: number | null = null;\n    let lastHrZone: number | null = null;\n\n    // Cache settings to avoid reading localStorage in loop\n    let cachedSettings = getSettings();\n\n    // Listen for settings changes\n    window.addEventListener('storage', (e) => {\n        if (e.key === 'bpt-settings') {\n            cachedSettings = getSettings();\n        }\n    });\n\n    // Custom event for same-window updates\n    window.addEventListener('settings-changed', () => {\n        cachedSettings = getSettings();\n    });\n\n    /**\n     * Update live charts with new data\n     */\n    const updateLiveCharts = (): void => {\n        // Update power chart\n        if (powerChart && measurementsState.power.length > lastPowerIndex) {\n            for (let i = lastPowerIndex; i < measurementsState.power.length; i++) {\n                const point = measurementsState.power[i];\n                powerChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastPowerIndex = measurementsState.power.length;\n        }\n\n        // Update HR chart\n        if (hrChart && measurementsState.heartrate.length > lastHrIndex) {\n            for (let i = lastHrIndex; i < measurementsState.heartrate.length; i++) {\n                const point = measurementsState.heartrate[i];\n                hrChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastHrIndex = measurementsState.heartrate.length;\n        }\n    };\n\n    /**\n     * Update incline display from Treadmill data\n     */\n    const updateInclineDisplay = (): void => {\n        const inclineDisplay = document.getElementById('value-incline');\n        const inclineContainer = document.querySelector('.metric-group-incline') as HTMLElement;\n\n        // Show container if we have treadmill data or checks\n\n        let validIncline = false;\n        let displayValue = emptyValue;\n\n        if (measurementsState.treadmill.length > 0) {\n            const latest = measurementsState.treadmill[measurementsState.treadmill.length - 1];\n            if (Date.now() - latest.timestamp < DATA_TIMEOUT_MS && latest.incline != null) {\n                validIncline = true;\n                displayValue = latest.incline.toFixed(1) + '%';\n            }\n        }\n\n        if (inclineDisplay) {\n            inclineDisplay.textContent = displayValue;\n        }\n\n        if (inclineContainer) {\n            // Only show incline metric group if we have valid data at some point or connectionsState has treadmill\n            // For simplicity, let's toggle based on data\n            inclineContainer.style.display = validIncline ? '' : 'none';\n        }\n    };\n\n    /**\n     * Update the display for a single metric type\n     */\n    const updateMetricDisplay = (key: MeasurementType): void => {\n        if (key === 'gps') return;\n\n        const element = elements[key]?.display;\n        const connectionState = connectionsState[key];\n\n        // console.log(`Debug ${key}:`, { element: !!element, connected: connectionState?.isConnected });\n\n        if (!element || !connectionState) {\n            return;\n        }\n\n        const container = element.closest('.metric-group') as HTMLElement;\n\n        // Skip if this metric is disabled in settings\n        // @ts-ignore - dynamic key access\n        const isEnabled = cachedSettings[key];\n\n        if (container) {\n            // Respect settings-based visibility\n            if (isEnabled === false) {\n                container.style.display = 'none';\n                return;\n            } else {\n                // Enabled in settings (or undefined), so ensure it is visible\n                if (container.style.display === 'none') {\n                    container.style.display = '';\n                }\n            }\n        }\n\n        // Show empty value if not connected\n        if (!connectionState.isConnected) {\n            element.textContent = emptyValue;\n            // Clear zone color when disconnected\n            if (key === 'power' || key === 'heartrate') {\n                applyZoneColorToMetric(element, null, key);\n            }\n            return;\n        }\n\n        const arr = measurementsState[key];\n\n        // Show empty value if no measurements\n        if (!Array.isArray(arr) || arr.length === 0) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        const latestMeasurement = arr[arr.length - 1];\n        // console.log(`Debug ${key} measurement:`, latestMeasurement);\n\n        // Validate measurement data\n        if (\n            !latestMeasurement ||\n            typeof latestMeasurement.value !== 'number' ||\n            typeof latestMeasurement.timestamp !== 'number'\n        ) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        // Check if data is stale\n        const timeDiff = Date.now() - latestMeasurement.timestamp;\n        if (timeDiff > DATA_TIMEOUT_MS) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        // Display the current value\n        element.textContent = String(latestMeasurement.value);\n\n        // Update zone tracking and apply zone colors\n        if (key === 'power') {\n            const zoneInfo = zoneState.updatePower(latestMeasurement.value, latestMeasurement.timestamp);\n            const currentZone = zoneInfo?.zone ?? null;\n\n            if (currentZone !== lastPowerZone) {\n                if (currentZone !== null && lastPowerZone !== null) {\n                    voiceFeedback.announceZoneChange(zoneInfo!.name);\n                }\n                lastPowerZone = currentZone;\n            }\n\n            applyZoneColorToMetric(element, currentZone, 'power');\n        } else if (key === 'heartrate') {\n            const zoneInfo = zoneState.updateHeartRate(latestMeasurement.value, latestMeasurement.timestamp);\n            const currentZone = zoneInfo?.zone ?? null;\n\n            if (currentZone !== lastHrZone) {\n                if (currentZone !== null && lastHrZone !== null) {\n                    voiceFeedback.announceZoneChange(zoneInfo!.name);\n                }\n                lastHrZone = currentZone;\n            }\n\n            applyZoneColorToMetric(element, currentZone, 'heartrate');\n        }\n    };\n\n    const metricTypes: MeasurementType[] = ['power', 'heartrate', 'cadence', 'speed', 'distance', 'altitude', 'treadmillSpeed'];\n\n    // Start the update loop\n    setInterval(() => {\n        metricTypes.forEach(updateMetricDisplay);\n        updateInclineDisplay();\n        updateZoneDisplays(powerGauge, hrGauge, zoneState);\n        updateLiveCharts();\n    }, UPDATE_INTERVAL_MS);\n\n    // Show/hide charts toggle based on workout state\n    document.addEventListener('workoutStarted', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'inline-flex';\n        }\n    });\n\n    document.addEventListener('workoutStopped', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'none';\n        }\n    });\n\n    // Listen for profile updates to reload zones\n    window.addEventListener('storage', (e) => {\n        if (e.key === 'bpt-user-profile') {\n            zoneState.loadProfile();\n        }\n    });\n\n    // Listen for workout discard to reset zones and charts\n    document.addEventListener('workout-discarded', () => {\n        zoneState.reset();\n        lastPowerIndex = 0;\n        lastHrIndex = 0;\n        if (powerChart) powerChart.clear();\n        if (hrChart) hrChart.clear();\n    });\n\n    return zoneState;\n};\n","/**\n * API client for the BPT streaming service\n * Handles communication with the Redis Streams API\n * \n * @module streamClient\n */\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Stream information\n */\nexport interface StreamInfo {\n    name: string;\n    length: number;\n    firstMessageId: string;\n    lastMessageId: string;\n}\n\n/**\n * Stream creation response\n */\nexport interface CreateStreamResponse {\n    success: boolean;\n    streamName: string;\n    messageId: string;\n}\n\n/**\n * Message response\n */\nexport interface MessageResponse {\n    success: boolean;\n    messageId: string;\n    streamName: string;\n}\n\n/**\n * Messages query options\n */\nexport interface GetMessagesOptions {\n    start?: string;\n    end?: string;\n    count?: number;\n}\n\n/**\n * Stream messages response\n */\nexport interface StreamMessagesResponse {\n    streamName: string;\n    messages: StreamMessageData[];\n}\n\n/**\n * Message data from stream\n */\nexport interface StreamMessageData {\n    id: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE message callback\n */\nexport type SSEMessageCallback = (data: SSEMessageData) => void;\n\n/**\n * SSE connected callback\n */\nexport type SSEConnectedCallback = (data: SSEConnectedData) => void;\n\n/**\n * SSE error callback\n */\nexport type SSEErrorCallback = (error: Error | Event) => void;\n\n/**\n * SSE message data\n */\nexport interface SSEMessageData {\n    type: 'message';\n    id: string;\n    streamName: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE connected data\n */\nexport interface SSEConnectedData {\n    type: 'connected';\n    streamName: string;\n    listenerId: string;\n}\n\n/**\n * Workout data to send\n */\nexport interface WorkoutDataPayload {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    incline?: number | null;\n    timestamp: number;\n    elapsed: string; // usually seconds as string, or mm:ss\n}\n\n/**\n * Delete stream response\n */\nexport interface DeleteStreamResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Create a new stream\n * \n * @param streamName - Unique name for the stream\n * @returns Promise with stream creation result\n */\nexport async function createStream(streamName: string): Promise<CreateStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/create`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create stream');\n    }\n\n    return response.json();\n}\n\n/**\n * List all available streams\n * \n * @returns Promise with list of streams\n */\nexport async function listStreams(): Promise<{ streams: StreamInfo[] }> {\n    const response = await fetch(`${API_BASE_URL}/api/streams`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(error || 'Failed to list streams');\n    }\n\n    return response.json();\n}\n\n/**\n * Add a message to a stream\n * \n * @param streamName - Name of the stream\n * @param message - Message content\n * @param author - Message author\n * @returns Promise with message result\n */\nexport async function addMessage(\n    streamName: string,\n    message: string,\n    author: string = 'anonymous'\n): Promise<MessageResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ message, author }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to add message');\n    }\n\n    return response.json();\n}\n\n/**\n * Get messages from a stream\n * \n * @param streamName - Name of the stream\n * @param options - Query options\n * @returns Promise with stream messages\n */\nexport async function getMessages(\n    streamName: string,\n    options: GetMessagesOptions = {}\n): Promise<StreamMessagesResponse> {\n    const { start = '-', end = '+', count = 100 } = options;\n    const params = new URLSearchParams({ start, end, count: count.toString() });\n\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get messages');\n    }\n\n    return response.json();\n}\n\n/**\n * SSE Connection interface for fetch-based SSE\n * Provides a consistent API similar to EventSource\n */\nexport interface SSEConnection {\n    /** Close the SSE connection */\n    close: () => void;\n    /** Whether the connection is active */\n    readonly active: boolean;\n}\n\n/**\n * Create a fetch-based SSE connection that supports custom headers\n * Unlike EventSource, this allows sending authentication via headers\n * \n * @param url - The SSE endpoint URL\n * @param onMessage - Callback for each SSE message\n * @param onConnected - Callback when connection is established\n * @param onError - Callback for errors\n * @returns SSEConnection object with close() method\n */\nfunction createFetchSSE(\n    url: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const controller = new AbortController();\n    let isActive = true;\n\n    const connection: SSEConnection = {\n        close: () => {\n            isActive = false;\n            controller.abort();\n        },\n        get active() {\n            return isActive;\n        }\n    };\n\n    // Start the fetch in the background\n    (async () => {\n        try {\n            const response = await fetch(url, {\n                method: 'GET',\n                headers: getHeaders({\n                    'Accept': 'text/event-stream',\n                    'Cache-Control': 'no-cache',\n                }),\n                signal: controller.signal,\n            });\n\n            if (!response.ok) {\n                throw new Error(`SSE connection failed: ${response.status} ${response.statusText}`);\n            }\n\n            if (!response.body) {\n                throw new Error('SSE response has no body');\n            }\n\n            const reader = response.body.getReader();\n            const decoder = new TextDecoder();\n            let buffer = '';\n\n            while (isActive) {\n                const { done, value } = await reader.read();\n\n                if (done) {\n                    break;\n                }\n\n                buffer += decoder.decode(value, { stream: true });\n\n                // Process complete SSE messages (separated by double newlines)\n                const messages = buffer.split('\\n\\n');\n                buffer = messages.pop() || ''; // Keep incomplete message in buffer\n\n                for (const message of messages) {\n                    if (!message.trim()) continue;\n\n                    // Parse SSE format: \"data: {...}\\n\"\n                    const dataMatch = message.match(/^data:\\s*(.+)$/m);\n                    if (dataMatch) {\n                        try {\n                            const data = JSON.parse(dataMatch[1]);\n\n                            if (data.type === 'connected' && onConnected) {\n                                onConnected(data);\n                            } else if (data.type === 'message') {\n                                onMessage(data);\n                            }\n                        } catch (parseError) {\n                            console.error('Error parsing SSE data:', parseError);\n                        }\n                    }\n                }\n            }\n        } catch (error) {\n            if ((error as Error).name === 'AbortError') {\n                // Connection was intentionally closed\n                return;\n            }\n            console.error('SSE connection error:', error);\n            if (onError) {\n                onError(error as Error);\n            }\n        } finally {\n            isActive = false;\n        }\n    })();\n\n    return connection;\n}\n\n/**\n * Connect to a stream and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n * \n * @param streamName - Name of the stream to listen to\n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToStream(\n    streamName: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/${streamName}/listen`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Connect to all streams and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n * \n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToAllStreams(\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/listenAll`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Send workout data to a stream\n * \n * @param streamName - Name of the stream\n * @param workoutData - Workout data to send\n * @returns Promise with message result\n */\nexport async function sendWorkoutData(\n    streamName: string,\n    workoutData: WorkoutDataPayload\n): Promise<MessageResponse> {\n    const message = JSON.stringify({\n        power: workoutData.power ?? null,\n        cadence: workoutData.cadence ?? null,\n        heartrate: workoutData.heartrate ?? null,\n        speed: workoutData.speed ?? null,\n        distance: workoutData.distance ?? null,\n        altitude: workoutData.altitude ?? null,\n        incline: workoutData.incline ?? null,\n        timestamp: workoutData.timestamp,\n        elapsed: workoutData.elapsed,\n        dataType: 'workout_metrics',\n    });\n\n    return addMessage(streamName, message, 'bike-power-tracker');\n}\n\n/**\n * Delete a stream\n * \n * @param streamName - Name of the stream to delete\n * @returns Promise with deletion result\n */\nexport async function deleteStream(streamName: string): Promise<DeleteStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete stream');\n    }\n\n    return response.json();\n}\n","/**\n * Stream Viewer UI\n * \n * Displays available streams and allows viewing live workout data.\n * \n * @module streamViewer\n */\n\nimport { listStreams, listenToStream, listenToAllStreams } from '../api/streamClient.js';\nimport type { StreamInfo, SSEMessageData, SSEConnection } from '../api/streamClient.js';\n\n/**\n * Workout metrics data from stream message\n */\ninterface WorkoutMetrics {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    elapsed?: string;\n    dataType?: string;\n}\n\n/**\n * All streams message data\n */\ninterface AllStreamsMessageData {\n    stream: string;\n    data: {\n        message: string;\n    } | WorkoutMetrics;\n}\n\n/**\n * Stream viewer class that manages the stream viewing UI\n */\nexport class StreamViewer {\n    private modal: HTMLDivElement | null = null;\n    private currentConnection: SSEConnection | null = null;\n    private streamMetricsSection: HTMLElement | null = null;\n    private allStreamsMetricsSection: HTMLElement | null = null;\n    private allStreamsConnection: SSEConnection | null = null;\n    private streamCards: Map<string, HTMLElement> = new Map();\n    private streamRows: Map<string, HTMLElement> = new Map();\n    private isCompactView: boolean = false;\n\n    constructor() {\n        this.initModal();\n        this.initInlineViewer();\n        this.initAllStreamsViewer();\n    }\n\n    /**\n     * Initialize the inline stream viewer in main content\n     */\n    private initInlineViewer(): void {\n        this.streamMetricsSection = document.getElementById('streamMetrics');\n        if (!this.streamMetricsSection) {\n            console.warn('Stream metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeStreamView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromStream());\n        }\n    }\n\n    /**\n     * Initialize the all streams viewer\n     */\n    private initAllStreamsViewer(): void {\n        this.allStreamsMetricsSection = document.getElementById('allStreamsMetrics');\n        if (!this.allStreamsMetricsSection) {\n            console.warn('All streams metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeAllStreamsView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromAllStreams());\n        }\n\n        const toggleViewBtn = document.getElementById('toggleViewBtn');\n        if (toggleViewBtn) {\n            toggleViewBtn.addEventListener('click', () => this.toggleAllStreamsView());\n        }\n    }\n\n    /**\n     * Toggle between grid and compact list view\n     */\n    private toggleAllStreamsView(): void {\n        this.isCompactView = !this.isCompactView;\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        const toggleBtn = document.getElementById('toggleViewBtn');\n\n        if (this.isCompactView) {\n            if (grid) grid.style.display = 'none';\n            if (list) list.style.display = 'flex';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle grid view';\n                toggleBtn.classList.add('active');\n            }\n        } else {\n            if (grid) grid.style.display = 'grid';\n            if (list) list.style.display = 'none';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle compact view';\n                toggleBtn.classList.remove('active');\n            }\n        }\n    }\n\n    /**\n     * Initialize the stream viewer modal\n     */\n    private initModal(): void {\n        const modal = document.createElement('div');\n        modal.id = 'streamViewerModal';\n        modal.className = 'stream-modal';\n        modal.innerHTML = `\n      <div class=\"stream-modal-content\">\n        <div class=\"stream-modal-header\">\n          <h2> Live Streams</h2>\n          <button id=\"closeStreamModal\" class=\"close-button\">&times;</button>\n        </div>\n        <div class=\"stream-modal-body\">\n          <div class=\"stream-list-container\">\n            <div class=\"stream-list-controls\" style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n              <button id=\"refreshStreamList\" class=\"refresh-button\"> Refresh List</button>\n              <button id=\"viewAllStreamsBtn\" class=\"connect-button\" style=\"background-color: #4CAF50;\"> View All Streams</button>\n            </div>\n            <div id=\"streamsList\" class=\"streams-list\">\n              <p class=\"loading\">Loading streams...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n        document.body.appendChild(modal);\n        this.modal = modal;\n        this.setupEventListeners();\n    }\n\n    /**\n     * Set up event listeners for modal controls\n     */\n    private setupEventListeners(): void {\n        const closeBtn = document.getElementById('closeStreamModal');\n        const refreshBtn = document.getElementById('refreshStreamList');\n        const viewAllBtn = document.getElementById('viewAllStreamsBtn');\n\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.close());\n        }\n        if (refreshBtn) {\n            refreshBtn.addEventListener('click', () => this.refreshStreamList());\n        }\n        if (viewAllBtn) {\n            viewAllBtn.addEventListener('click', () => this.connectToAllStreams());\n        }\n\n        if (this.modal) {\n            this.modal.addEventListener('click', (e: MouseEvent) => {\n                if (e.target === this.modal) {\n                    this.close();\n                }\n            });\n        }\n    }\n\n    /**\n     * Open the stream viewer modal\n     */\n    async open(): Promise<void> {\n        if (this.modal) {\n            this.modal.style.display = 'flex';\n        }\n        await this.refreshStreamList();\n    }\n\n    /**\n     * Close the stream viewer modal\n     */\n    close(): void {\n        if (this.modal) {\n            this.modal.style.display = 'none';\n        }\n    }\n\n    /**\n     * Refresh the list of available streams\n     */\n    async refreshStreamList(): Promise<void> {\n        const streamsList = document.getElementById('streamsList');\n        if (!streamsList) return;\n\n        streamsList.innerHTML = '<p class=\"loading\">Loading streams...</p>';\n\n        try {\n            const { streams } = await listStreams();\n\n            if (streams.length === 0) {\n                streamsList.innerHTML = '<p class=\"no-streams\">No active streams found</p>';\n                return;\n            }\n\n            streamsList.innerHTML = '';\n            streams.forEach((stream: StreamInfo) => {\n                const streamItem = this.createStreamItem(stream);\n                streamsList.appendChild(streamItem);\n            });\n        } catch (error) {\n            console.error('Failed to load streams:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            streamsList.innerHTML = `<p class=\"error\">Failed to load streams: ${message}</p>`;\n        }\n    }\n\n    /**\n     * Create a stream list item element\n     */\n    private createStreamItem(stream: StreamInfo): HTMLElement {\n        const div = document.createElement('div');\n        div.className = 'stream-item';\n\n        const isWorkoutStream = stream.name.startsWith('workout-');\n        const icon = isWorkoutStream ? '' : '';\n\n        div.innerHTML = `\n      <div class=\"stream-item-info\">\n        <div class=\"stream-item-name\">${icon} ${stream.name}</div>\n        <div class=\"stream-item-meta\">\n          ${stream.length} message${stream.length !== 1 ? 's' : ''}\n        </div>\n      </div>\n      <button class=\"connect-button\" data-stream=\"${stream.name}\">\n         View\n      </button>\n    `;\n\n        const connectBtn = div.querySelector('.connect-button');\n        connectBtn?.addEventListener('click', () => {\n            this.connectToStream(stream.name);\n        });\n\n        return div;\n    }\n\n    /**\n     * Connect to a stream and view live data\n     */\n    connectToStream(streamName: string): void {\n        this.disconnectFromStream();\n\n        if (!this.streamMetricsSection) {\n            console.error('Stream metrics section not available');\n            return;\n        }\n\n        this.streamMetricsSection.style.display = 'flex';\n\n        const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n        if (toggleStream) toggleStream.checked = true;\n\n        const streamTitle = document.getElementById('streamTitle');\n        const statusEl = document.getElementById('streamStatus');\n\n        if (streamTitle) streamTitle.textContent = streamName;\n        if (statusEl) {\n            statusEl.textContent = 'Connecting...';\n            statusEl.className = 'status-badge connecting';\n        }\n\n        this.close();\n\n        this.currentConnection = listenToStream(\n            streamName,\n            (data: SSEMessageData) => this.handleStreamMessage(data),\n            () => this.handleStreamConnected(),\n            (error: Error | Event) => this.handleStreamError(error)\n        );\n    }\n\n    /**\n     * Connect to all streams\n     */\n    connectToAllStreams(): void {\n        this.disconnectFromStream();\n        this.disconnectFromAllStreams();\n\n        if (!this.allStreamsMetricsSection) {\n            console.error('All streams metrics section not available');\n            return;\n        }\n\n        this.allStreamsMetricsSection.style.display = 'flex';\n        this.close();\n\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        if (grid) grid.innerHTML = '';\n        if (list) list.innerHTML = '';\n        this.streamCards.clear();\n        this.streamRows.clear();\n\n        const allStreamsStatus = document.getElementById('allStreamsStatus');\n        if (allStreamsStatus) {\n            allStreamsStatus.textContent = 'Connecting...';\n            allStreamsStatus.className = 'status-badge connecting';\n        }\n\n        this.allStreamsConnection = listenToAllStreams(\n            (data: SSEMessageData) => this.handleAllStreamsMessage(data as unknown as AllStreamsMessageData),\n            () => this.handleAllStreamsConnected(),\n            (error: Error | Event) => this.handleAllStreamsError(error)\n        );\n    }\n\n    /**\n     * Handle all streams connected event\n     */\n    private handleAllStreamsConnected(): void {\n        console.log('Connected to all streams');\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle all streams error\n     */\n    private handleAllStreamsError(error: Error | Event): void {\n        console.error('All streams error:', error);\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (!statusEl) return;\n\n        if (this.allStreamsConnection && this.allStreamsConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Disconnect from all streams\n     */\n    disconnectFromAllStreams(): void {\n        if (this.allStreamsConnection) {\n            this.allStreamsConnection.close();\n            this.allStreamsConnection = null;\n        }\n\n        if (this.allStreamsMetricsSection) {\n            this.allStreamsMetricsSection.style.display = 'none';\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n    }\n\n    /**\n     * Handle incoming message for all streams view\n     */\n    private handleAllStreamsMessage(data: AllStreamsMessageData): void {\n        try {\n            const streamName = data.stream;\n            const messageData = typeof data.data === 'string'\n                ? JSON.parse(data.data)\n                : data.data;\n\n            this.updateStreamCard(streamName, messageData);\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update or create a stream card\n     */\n    private updateStreamCard(streamName: string, data: { message?: string } & WorkoutMetrics): void {\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n\n        let messageData: WorkoutMetrics = {};\n        try {\n            if (data.message) {\n                messageData = JSON.parse(data.message);\n            } else {\n                messageData = data;\n            }\n        } catch {\n            // Ignore parse errors\n        }\n\n        if (grid) {\n            let card = this.streamCards.get(streamName);\n\n            if (!card) {\n                card = document.createElement('div');\n                card.className = 'stream-card';\n                card.innerHTML = `\n          <div class=\"stream-card-name\" title=\"${streamName}\">${streamName}</div>\n          <div class=\"stream-card-power\">--</div>\n          <div class=\"stream-card-secondary\">\n            <div class=\"stream-card-metric\">\n              <span>CAD</span>\n              <span class=\"card-cadence\">--</span>\n            </div>\n            <div class=\"stream-card-metric\">\n              <span>HR</span>\n              <span class=\"card-heartrate\">--</span>\n            </div>\n          </div>\n        `;\n                grid.appendChild(card);\n                this.streamCards.set(streamName, card);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = card.querySelector('.stream-card-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n\n            if (messageData.cadence !== undefined && messageData.cadence !== null) {\n                const cadenceEl = card.querySelector('.card-cadence');\n                if (cadenceEl) cadenceEl.textContent = String(messageData.cadence);\n            }\n\n            if (messageData.heartrate !== undefined && messageData.heartrate !== null) {\n                const hrEl = card.querySelector('.card-heartrate');\n                if (hrEl) hrEl.textContent = String(messageData.heartrate);\n            }\n        }\n\n        if (list) {\n            let row = this.streamRows.get(streamName);\n\n            if (!row) {\n                row = document.createElement('div');\n                row.className = 'stream-row';\n                row.innerHTML = `\n          <span class=\"stream-row-name\" title=\"${streamName}\">${streamName}</span>\n          <span class=\"stream-row-power\">--</span>\n        `;\n                list.appendChild(row);\n                this.streamRows.set(streamName, row);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = row.querySelector('.stream-row-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n        }\n    }\n\n    /**\n     * Disconnect from the current stream\n     */\n    disconnectFromStream(): void {\n        this.disconnectFromAllStreams();\n\n        if (this.currentConnection) {\n            this.currentConnection.close();\n            this.currentConnection = null;\n        }\n\n        if (this.streamMetricsSection) {\n            this.streamMetricsSection.style.display = 'none';\n\n            const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n            if (toggleStream) toggleStream.checked = false;\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n\n        this.resetViewer();\n    }\n\n    /**\n     * Handle stream connected event\n     */\n    private handleStreamConnected(): void {\n        const statusEl = document.getElementById('streamStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle incoming stream message\n     */\n    private handleStreamMessage(data: SSEMessageData): void {\n        try {\n            const messageStr = (data as unknown as { data: { message: string } }).data?.message;\n            const messageData: WorkoutMetrics = typeof messageStr === 'string'\n                ? JSON.parse(messageStr)\n                : (data as unknown as { data: WorkoutMetrics }).data;\n\n            if (\n                messageData.dataType === 'workout_metrics' ||\n                messageData.power !== undefined ||\n                messageData.cadence !== undefined ||\n                messageData.heartrate !== undefined\n            ) {\n                this.updateMetrics(messageData);\n            }\n\n            const lastUpdateEl = document.getElementById('streamLastUpdate');\n            if (lastUpdateEl) {\n                const now = new Date();\n                lastUpdateEl.textContent = `Last update: ${now.toLocaleTimeString()}`;\n            }\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update metrics display with new data\n     */\n    private updateMetrics(data: WorkoutMetrics): void {\n        const powerEl = document.getElementById('streamPower');\n        const cadenceEl = document.getElementById('streamCadence');\n        const heartrateEl = document.getElementById('streamHeartrate');\n        const speedEl = document.getElementById('streamSpeed');\n        const distanceEl = document.getElementById('streamDistance');\n        const altitudeEl = document.getElementById('streamAltitude');\n        const elapsedEl = document.getElementById('streamElapsed');\n\n        if (powerEl && data.power !== null && data.power !== undefined) {\n            powerEl.textContent = String(data.power);\n        }\n        if (cadenceEl && data.cadence !== null && data.cadence !== undefined) {\n            cadenceEl.textContent = String(data.cadence);\n        }\n        if (heartrateEl && data.heartrate !== null && data.heartrate !== undefined) {\n            heartrateEl.textContent = String(data.heartrate);\n        }\n        if (speedEl && data.speed !== null && data.speed !== undefined) {\n            speedEl.textContent = String(data.speed);\n        }\n        if (distanceEl && data.distance !== null && data.distance !== undefined) {\n            distanceEl.textContent = String(data.distance);\n        }\n        if (altitudeEl && data.altitude !== null && data.altitude !== undefined) {\n            altitudeEl.textContent = String(data.altitude);\n        }\n        if (elapsedEl && data.elapsed) {\n            elapsedEl.textContent = data.elapsed;\n        }\n    }\n\n    /**\n     * Handle stream error\n     */\n    private handleStreamError(error: Error | Event): void {\n        console.error('Stream error:', error);\n        const statusEl = document.getElementById('streamStatus');\n        if (!statusEl) return;\n\n        if (this.currentConnection && this.currentConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Reset viewer display\n     */\n    private resetViewer(): void {\n        const elements = [\n            'streamPower',\n            'streamCadence',\n            'streamHeartrate',\n            'streamSpeed',\n            'streamDistance',\n            'streamAltitude',\n            'streamElapsed',\n        ];\n\n        elements.forEach((id) => {\n            const el = document.getElementById(id);\n            if (el) el.textContent = '--';\n        });\n\n        const streamLastUpdate = document.getElementById('streamLastUpdate');\n        if (streamLastUpdate) streamLastUpdate.textContent = 'Waiting for data...';\n    }\n}\n\n/**\n * Initialize stream viewer UI\n */\nexport function initStreamViewer(): StreamViewer {\n    const viewer = new StreamViewer();\n\n    const viewStreamsBtn = document.getElementById('viewStreamsButton');\n    if (viewStreamsBtn) {\n        viewStreamsBtn.addEventListener('click', () => viewer.open());\n    }\n\n    return viewer;\n}\n","/**\n * Streaming Controls Initialization\n * \n * Sets up UI controls for starting, pausing, and stopping workout streaming.\n * \n * @module initStreamingControls\n */\n\nimport { showNotification } from './ui/notifications.js';\nimport type { StreamManager, StreamStatus } from './stream-manager.js';\nimport type { TimeState } from './getInitState.js';\n\n/**\n * Initialize streaming controls.\n * \n * Sets up event handlers for:\n * - Start/stop streaming button\n * - Stream name modal\n * - Toolbar play/pause/stop buttons\n * - Auto-stop when workout ends\n * \n * @param streamManager - The stream manager instance\n * @param timeState - The workout time state\n */\nexport function initStreamingControls(\n    streamManager: StreamManager,\n    timeState: TimeState\n): void {\n    // Main button\n    const startStreamButton = document.getElementById('startStreamButton') as HTMLButtonElement | null;\n\n    // Modal elements\n    const modal = document.getElementById('streamNameModal') as HTMLDivElement | null;\n    const closeBtn = document.getElementById('closeStreamNameModal') as HTMLButtonElement | null;\n    const cancelBtn = document.getElementById('cancelStreamName') as HTMLButtonElement | null;\n    const confirmBtn = document.getElementById('confirmStreamName') as HTMLButtonElement | null;\n    const nameInput = document.getElementById('streamNameInput') as HTMLInputElement | null;\n\n    // Toolbar elements\n    const toolbar = document.getElementById('activeStreamToolbar') as HTMLDivElement | null;\n    const toolbarStreamName = document.getElementById('toolbarStreamName') as HTMLSpanElement | null;\n    const playPauseBtn = document.getElementById('streamPlayPauseBtn') as HTMLButtonElement | null;\n    const stopBtn = document.getElementById('streamStopBtn') as HTMLButtonElement | null;\n    const streamIndicator = document.querySelector('.stream-indicator') as HTMLElement | null;\n\n    /**\n     * Update toolbar visibility and state\n     */\n    const updateToolbar = (status: StreamStatus): void => {\n        if (!toolbar) return;\n\n        if (status.isStreaming) {\n            toolbar.style.display = 'flex';\n            document.body.classList.add('has-stream-toolbar');\n\n            if (toolbarStreamName) {\n                toolbarStreamName.textContent = status.streamName;\n            }\n\n            // Update Play/Pause button\n            if (playPauseBtn) {\n                if (status.isPaused) {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Resume Stream';\n                    streamIndicator?.classList.add('paused');\n                } else {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Pause Stream';\n                    streamIndicator?.classList.remove('paused');\n                }\n            }\n        } else {\n            toolbar.style.display = 'none';\n            document.body.classList.remove('has-stream-toolbar');\n        }\n    };\n\n    if (!startStreamButton) {\n        console.warn('Start stream button not found in DOM');\n        return;\n    }\n\n    /**\n     * Close the stream name modal\n     */\n    const closeModal = (): void => {\n        if (modal) modal.style.display = 'none';\n        if (nameInput) nameInput.value = '';\n    };\n\n    /**\n     * Start streaming with optional custom name\n     */\n    const startStreaming = async (): Promise<void> => {\n        const customName = nameInput?.value.trim() || '';\n\n        try {\n            const streamName = await streamManager.startStreaming(customName || undefined);\n            startStreamButton.textContent = ' Stop Streaming';\n            startStreamButton.classList.add('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification(`Streaming to: ${streamName}`, 'success');\n            closeModal();\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            showNotification('Failed to start streaming: ' + message, 'error');\n        }\n    };\n\n    /**\n     * Stop streaming\n     */\n    const stopStreaming = async (): Promise<void> => {\n        try {\n            await streamManager.stopStreaming();\n            startStreamButton.textContent = ' Start Streaming';\n            startStreamButton.classList.remove('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification('Streaming stopped', 'info');\n        } catch (error) {\n            console.error(error);\n            showNotification('Error stopping stream', 'error');\n        }\n    };\n\n    // Wire up toolbar buttons\n    if (playPauseBtn) {\n        playPauseBtn.addEventListener('click', () => {\n            const status = streamManager.getStatus();\n            if (status.isPaused) {\n                streamManager.resumeStreaming();\n                showNotification('Stream Resumed', 'success');\n            } else {\n                streamManager.pauseStreaming();\n                showNotification('Stream Paused', 'info');\n            }\n            updateToolbar(streamManager.getStatus());\n        });\n    }\n\n    if (stopBtn) {\n        stopBtn.addEventListener('click', async () => {\n            if (confirm('Stop streaming?')) {\n                await stopStreaming();\n            }\n        });\n    }\n\n    // Event listeners for modal\n    if (closeBtn) closeBtn.addEventListener('click', closeModal);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);\n\n    if (confirmBtn) {\n        confirmBtn.addEventListener('click', startStreaming);\n    }\n\n    if (nameInput) {\n        nameInput.addEventListener('keypress', (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n                startStreaming();\n            }\n        });\n    }\n\n    // Close on click outside\n    if (modal) {\n        modal.addEventListener('click', (e: MouseEvent) => {\n            if (e.target === modal) closeModal();\n        });\n    }\n\n    // Main button click handler\n    startStreamButton.addEventListener('click', async () => {\n        if (streamManager.isStreaming) {\n            await stopStreaming();\n        } else {\n            if (modal) {\n                modal.style.display = 'flex';\n                nameInput?.focus();\n            } else {\n                // Fallback if modal missing\n                try {\n                    const streamName = await streamManager.startStreaming();\n                    startStreamButton.textContent = ' Stop Streaming';\n                    startStreamButton.classList.add('streaming');\n                    updateToolbar(streamManager.getStatus());\n                    showNotification(`Streaming to: ${streamName}`, 'success');\n                } catch (error) {\n                    console.error('Failed to start streaming:', error);\n                    const message = error instanceof Error ? error.message : 'Unknown error';\n                    showNotification('Failed to start streaming: ' + message, 'error');\n                }\n            }\n        }\n    });\n\n    // Auto-stop streaming when workout is stopped (Pause or Stop buttons)\n    const pauseButton = document.getElementById('pauseButton');\n    const stopButton = document.getElementById('stopButton');\n\n    const handleWorkoutPause = () => {\n        if (timeState.running === false && streamManager.isStreaming) {\n            // Workout was just paused\n            setTimeout(() => {\n                if (!timeState.running && streamManager.isStreaming) {\n                    streamManager.stopStreaming();\n                    startStreamButton.textContent = ' Start Streaming';\n                    startStreamButton.classList.remove('streaming');\n                    updateToolbar(streamManager.getStatus());\n                }\n            }, 100);\n        }\n    };\n\n    if (pauseButton) {\n        pauseButton.addEventListener('click', handleWorkoutPause);\n    }\n    if (stopButton) {\n        stopButton.addEventListener('click', handleWorkoutPause);\n    }\n}\n","/**\n * Dark Mode Module\n * Handles theme switching and persistence for the app\n */\n\nimport { announce } from './accessibility.js';\n\nconst DARK_MODE_KEY = 'bpt-dark-mode';\n\nexport type ThemePreference = 'light' | 'dark' | 'system';\n\n/**\n * Get the stored theme preference from localStorage\n */\nexport function getStoredThemePreference(): ThemePreference | null {\n    try {\n        const stored = localStorage.getItem(DARK_MODE_KEY);\n        if (stored === 'light' || stored === 'dark' || stored === 'system') {\n            return stored;\n        }\n        return null;\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Save theme preference to localStorage\n */\nexport function saveThemePreference(preference: ThemePreference): void {\n    try {\n        localStorage.setItem(DARK_MODE_KEY, preference);\n    } catch {\n        // localStorage might not be available\n    }\n}\n\n/**\n * Check if the system prefers dark mode\n */\nexport function systemPrefersDark(): boolean {\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n}\n\n/**\n * Apply the theme to the document\n */\nexport function applyTheme(theme: 'light' | 'dark'): void {\n    document.documentElement.setAttribute('data-theme', theme);\n}\n\n/**\n * Get the effective theme based on preference\n */\nexport function getEffectiveTheme(preference: ThemePreference): 'light' | 'dark' {\n    if (preference === 'system') {\n        return systemPrefersDark() ? 'dark' : 'light';\n    }\n    return preference;\n}\n\n/**\n * Check if dark mode is currently active\n */\nexport function isDarkMode(): boolean {\n    return document.documentElement.getAttribute('data-theme') === 'dark';\n}\n\n/**\n * Toggle dark mode on/off\n */\nexport function toggleDarkMode(): boolean {\n    const currentlyDark = isDarkMode();\n    const newTheme = currentlyDark ? 'light' : 'dark';\n    applyTheme(newTheme);\n    saveThemePreference(newTheme);\n    return !currentlyDark;\n}\n\n/**\n * Initialize dark mode based on stored preference or system preference\n */\nexport function initDarkMode(): boolean {\n    const stored = getStoredThemePreference();\n\n    if (stored) {\n        const effectiveTheme = getEffectiveTheme(stored);\n        applyTheme(effectiveTheme);\n        return effectiveTheme === 'dark';\n    }\n\n    // Default to system preference if no stored preference\n    const systemDark = systemPrefersDark();\n    if (systemDark) {\n        applyTheme('dark');\n    }\n    // Note: Don't save preference when using system default\n    return systemDark;\n}\n\n/**\n * Set up the dark mode toggle checkbox\n */\nexport function setupDarkModeToggle(toggleElement: HTMLInputElement): void {\n    // Initialize toggle state\n    const isDark = initDarkMode();\n    toggleElement.checked = isDark;\n\n    // Handle toggle changes\n    toggleElement.addEventListener('change', () => {\n        const newTheme = toggleElement.checked ? 'dark' : 'light';\n        applyTheme(newTheme);\n        saveThemePreference(newTheme);\n        announce(`Dark mode ${toggleElement.checked ? 'enabled' : 'disabled'}`);\n    });\n\n    // Listen for system preference changes (when using system theme)\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    mediaQuery.addEventListener('change', (e) => {\n        // Only auto-switch if user hasn't set a preference\n        const stored = getStoredThemePreference();\n        if (!stored || stored === 'system') {\n            const newTheme = e.matches ? 'dark' : 'light';\n            applyTheme(newTheme);\n            toggleElement.checked = e.matches;\n            announce(`Dark mode ${e.matches ? 'enabled' : 'disabled'}`);\n        }\n    });\n\n    // Listen for storage changes (sync across tabs)\n    window.addEventListener('storage', (e) => {\n        if (e.key === DARK_MODE_KEY) {\n            const newPreference = e.newValue as ThemePreference | null;\n            if (newPreference) {\n                const effectiveTheme = getEffectiveTheme(newPreference);\n                applyTheme(effectiveTheme);\n                toggleElement.checked = effectiveTheme === 'dark';\n            } else {\n                // If cleared, revert to system\n                const systemDark = systemPrefersDark();\n                applyTheme(systemDark ? 'dark' : 'light');\n                toggleElement.checked = systemDark;\n            }\n        }\n    });\n}\n","/**\n * Workout Recovery\n * \n * Handles detection and recovery of interrupted workouts from IndexedDB.\n * Shows a modal to the user when a recoverable workout is found.\n * \n * @module ui/workoutRecovery\n */\n\nimport {\n    loadActiveWorkout,\n    clearActiveWorkout,\n    hasRecoverableWorkout,\n    type ActiveWorkoutRecord\n} from '../storage/workoutStorage.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Format elapsed time as human-readable string\n */\nfunction formatElapsedTime(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n\n    if (hours > 0) {\n        return `${hours}h ${minutes % 60}m`;\n    } else if (minutes > 0) {\n        return `${minutes}m ${seconds % 60}s`;\n    }\n    return `${seconds}s`;\n}\n\n/**\n * Format timestamp as human-readable date/time\n */\nfunction formatTime(timestamp: number): string {\n    return new Date(timestamp).toLocaleString();\n}\n\n/**\n * Create the recovery modal HTML\n */\nfunction createRecoveryModal(workout: ActiveWorkoutRecord): HTMLDialogElement {\n    const modal = document.createElement('dialog');\n    modal.id = 'workout-recovery-modal';\n    modal.className = 'modal';\n    modal.setAttribute('aria-labelledby', 'recovery-modal-title');\n\n    const dataPoints = workout.power.length + workout.heartrate.length + workout.cadence.length;\n    const elapsedTime = workout.lastUpdated - workout.startTime;\n\n    modal.innerHTML = `\n        <div class=\"modal-content\">\n            <h2 id=\"recovery-modal-title\"> Recover Workout?</h2>\n            <p>An interrupted workout was found from your last session.</p>\n            \n            <div class=\"recovery-summary\">\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Started</span>\n                    <span class=\"recovery-stat-value\">${formatTime(workout.startTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Duration</span>\n                    <span class=\"recovery-stat-value\">${formatElapsedTime(elapsedTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Data Points</span>\n                    <span class=\"recovery-stat-value\">${dataPoints.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Power Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.power.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Heart Rate Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.heartrate.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Cadence Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.cadence.length.toLocaleString()}</span>\n                </div>\n                ${workout.laps.length > 0 ? `\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Laps</span>\n                    <span class=\"recovery-stat-value\">${workout.laps.length}</span>\n                </div>\n                ` : ''}\n            </div>\n            \n            <div class=\"modal-actions\">\n                <button type=\"button\" id=\"recovery-restore-btn\" class=\"btn btn-primary\">\n                     Restore Workout\n                </button>\n                <button type=\"button\" id=\"recovery-discard-btn\" class=\"btn btn-secondary\">\n                     Start Fresh\n                </button>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Add styles for the recovery modal\n */\nfunction addRecoveryStyles(): void {\n    if (document.getElementById('recovery-modal-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'recovery-modal-styles';\n    style.textContent = `\n        #workout-recovery-modal {\n            max-width: 400px;\n        }\n        \n        .recovery-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 0.75rem;\n            margin: 1.5rem 0;\n            padding: 1rem;\n            background: var(--surface-2, #2a2a2a);\n            border-radius: 8px;\n        }\n        \n        .recovery-stat {\n            display: flex;\n            flex-direction: column;\n            gap: 0.25rem;\n        }\n        \n        .recovery-stat-label {\n            font-size: 0.75rem;\n            color: var(--text-muted, #888);\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n        }\n        \n        .recovery-stat-value {\n            font-size: 1rem;\n            font-weight: 600;\n            color: var(--text-primary, #fff);\n        }\n        \n        #workout-recovery-modal .modal-actions {\n            display: flex;\n            flex-direction: column;\n            gap: 0.75rem;\n            margin-top: 1.5rem;\n        }\n        \n        #workout-recovery-modal .btn {\n            width: 100%;\n            padding: 0.875rem 1.5rem;\n            font-size: 1rem;\n        }\n    `;\n\n    document.head.appendChild(style);\n}\n\n/**\n * Show the recovery modal and wait for user decision\n */\nasync function showRecoveryModal(workout: ActiveWorkoutRecord): Promise<'restore' | 'discard'> {\n    addRecoveryStyles();\n\n    const modal = createRecoveryModal(workout);\n    document.body.appendChild(modal);\n\n    return new Promise((resolve) => {\n        const restoreBtn = modal.querySelector('#recovery-restore-btn') as HTMLButtonElement;\n        const discardBtn = modal.querySelector('#recovery-discard-btn') as HTMLButtonElement;\n\n        const cleanup = () => {\n            modal.close();\n            modal.remove();\n        };\n\n        restoreBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('restore');\n        });\n\n        discardBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('discard');\n        });\n\n        // Handle escape key\n        modal.addEventListener('cancel', (e) => {\n            e.preventDefault(); // Don't close on escape - force user to choose\n        });\n\n        modal.showModal();\n    });\n}\n\n/**\n * Check for and handle workout recovery\n * \n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n * @returns True if a workout was recovered\n */\nexport async function initWorkoutRecovery(\n    measurementsState: MeasurementsState,\n    timeState: TimeState\n): Promise<boolean> {\n    try {\n        // Check if there's a recoverable workout\n        if (!await hasRecoverableWorkout()) {\n            return false;\n        }\n\n        // Load the workout data\n        const workout = await loadActiveWorkout();\n        if (!workout) {\n            return false;\n        }\n\n        // Show recovery modal and get user choice\n        const choice = await showRecoveryModal(workout);\n\n        if (choice === 'restore') {\n            // Restore the workout data\n            measurementsState.restore(\n                {\n                    heartrate: workout.heartrate,\n                    power: workout.power,\n                    cadence: workout.cadence,\n                    speed: workout.speed,\n                    distance: workout.distance,\n                    altitude: workout.altitude,\n                    laps: workout.laps, gps: workout.gps || [],\n                },\n                workout.startTime\n            );\n\n            // Restore time state\n            timeState.startTime = workout.startTime;\n            timeState.running = false; // Don't auto-resume - let user reconnect sensors\n\n            console.log(`Restored workout with ${workout.power.length} power readings`);\n            return true;\n        } else {\n            // User chose to discard\n            await clearActiveWorkout();\n            console.log('User discarded recovered workout');\n            return false;\n        }\n    } catch (error) {\n        console.error('Error during workout recovery:', error);\n        return false;\n    }\n}\n\n/**\n * Clear any pending workout data (for testing or manual cleanup)\n */\nexport async function clearRecoverableWorkout(): Promise<void> {\n    await clearActiveWorkout();\n}\n","/**\n * About Modal\n * \n * Manages the About modal.\n * \n * @module about\n */\n\n/**\n * Initialize the About modal\n */\nexport function initAboutModal(): void {\n    const aboutButton = document.getElementById('aboutButton');\n    const aboutModal = document.getElementById('aboutModal');\n    const closeAboutModal = document.getElementById('closeAboutModal');\n\n    if (!aboutButton || !aboutModal) {\n        return;\n    }\n\n    /**\n     * Open the about modal\n     */\n    const openModal = (): void => {\n        aboutModal.style.display = 'flex';\n        // Close the main menu details element\n        const details = document.querySelector('header details');\n        if (details) {\n            details.removeAttribute('open');\n        }\n    };\n\n    /**\n     * Close the about modal\n     */\n    const closeModal = (): void => {\n        aboutModal.style.display = 'none';\n    };\n\n    // Event Listeners\n    aboutButton.addEventListener('click', openModal);\n    closeAboutModal?.addEventListener('click', closeModal);\n\n    // Close modal when clicking outside\n    window.addEventListener('click', (event: MouseEvent) => {\n        if (event.target === aboutModal) {\n            closeModal();\n        }\n    });\n}\n","/**\n * Wake Lock Handler\n * \n * Keeps the screen awake during workouts using the Screen Wake Lock API.\n * \n * @module wakeLock\n */\n\n/**\n * Initialize wake lock to keep the screen awake.\n * \n * Requests a screen wake lock when the page is visible,\n * and re-requests it if the page visibility changes.\n */\nexport const handleWakeLock = (): void => {\n    let wakeLock: WakeLockSentinel | null = null;\n\n    /**\n     * Request a screen wake lock\n     */\n    const requestWakeLock = async (): Promise<void> => {\n        try {\n            if ('wakeLock' in navigator) {\n                wakeLock = await navigator.wakeLock.request('screen');\n                console.log('Screen wake lock activated');\n\n                // Re-request wake lock if page becomes visible again\n                wakeLock.addEventListener('release', () => {\n                    console.log('Screen wake lock released');\n                });\n            }\n        } catch (err) {\n            console.error('Wake lock request failed:', err);\n        }\n    };\n\n    // Request wake lock when page loads\n    if (document.visibilityState === 'visible') {\n        requestWakeLock();\n    }\n\n    // Re-request wake lock when page becomes visible\n    document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n            requestWakeLock();\n        }\n    });\n};\n","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","/**\n * Service Worker Registration\n * \n * Handles PWA service worker registration using vite-plugin-pwa.\n * \n * @module serviceWorker\n */\n\nimport { registerSW } from 'virtual:pwa-register';\nimport { Capacitor } from '@capacitor/core';\n\n/**\n * Update callback type\n */\ntype UpdateCallback = (reloadPage?: boolean) => Promise<void>;\n\n/**\n * Register the service worker for PWA functionality.\n * \n * In development mode, service workers are disabled to avoid caching issues.\n * In production, registers the service worker and handles updates.\n */\nexport const registerServiceWorker = (): void => {\n    // Capacitor apps should not use service workers. They can cause hard-to-debug\n    // caching and asset-loading issues in Android WebView.\n    if (Capacitor.isNativePlatform()) {\n        console.log('Service Worker disabled on native platform');\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                }\n            });\n        }\n        return;\n    }\n\n    // Don't register service worker in development to avoid caching issues\n    if (import.meta.env.DEV) {\n        console.log('Service Worker disabled in development mode');\n        // Unregister existing service workers if any to ensure fresh content\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                    console.log('Unregistered existing service worker');\n                }\n            });\n        }\n        return;\n    }\n\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    const updateSW = registerSW({\n        onNeedRefresh() {\n            showUpdateNotification(updateSW);\n        },\n        onOfflineReady() {\n            console.log('App ready to work offline');\n        },\n        onRegistered(registration?: ServiceWorkerRegistration) {\n            console.log('Service Worker registered successfully');\n\n            // Check for updates periodically (every hour)\n            if (registration) {\n                setInterval(() => {\n                    registration.update();\n                }, 60 * 60 * 1000);\n            }\n        },\n        onRegisterError(error: Error) {\n            console.log('Service Worker registration failed:', error);\n        },\n    });\n};\n\n/**\n * Show update notification when a new version is available.\n * \n * @param updateSW - Function to trigger the update\n */\nconst showUpdateNotification = (updateSW: UpdateCallback): void => {\n    const updateContainer = document.getElementById('updateNotification');\n    if (!updateContainer) return;\n\n    updateContainer.style.display = 'block';\n\n    const updateButton = document.getElementById('updateButton');\n    updateButton?.addEventListener(\n        'click',\n        () => {\n            updateSW(true); // Force reload after update\n        },\n        { once: true }\n    );\n\n    const dismissUpdateButton = document.getElementById('dismissUpdate');\n    dismissUpdateButton?.addEventListener(\n        'click',\n        () => {\n            updateContainer.style.display = 'none';\n        },\n        { once: true }\n    );\n};\n","import { initTimerDisplay } from '../ui/time.js';\nimport { initDiscardButton, initExportButton, initMetricsToggle, initWorkoutSummaryModal } from '../ui/menu.js';\nimport { initMetricsDisplay } from '../initMetricsDisplay.js';\nimport { initStreamViewer } from '../ui/streamViewer.js';\nimport { initStreamingControls } from '../initStreamingControls.js';\nimport { initWorkoutBuilder } from '../ui/workoutBuilder.js';\nimport { initKeyboardNavigation } from '../ui/accessibility.js';\nimport { setupDarkModeToggle } from '../ui/darkMode.js';\nimport { initOnboarding } from '../ui/onboarding.js';\nimport { initLapButton } from '../ui/lap.js';\nimport { initWorkoutRecovery } from '../ui/workoutRecovery.js';\nimport { initInstallPrompt } from '../ui/installPrompt.js';\nimport { initAboutModal } from '../ui/about.js';\nimport { handleWakeLock } from '../ui/wakeLock.js';\nimport { registerServiceWorker } from '../ui/serviceWorker.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState, ConnectionsState } from '../getInitState.js';\nimport type { ZoneState } from '../zone-state.js';\nimport type { StreamManager } from '../stream-manager.js';\n\n/**\n * Parameters for UI initialization\n */\ninterface UiInitParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    connectionsState: ConnectionsState;\n    streamManager: StreamManager;\n}\n\n/**\n * Initialize all User Interface components\n * \n * Sets up:\n * - Metrics displays (Power, HR, Cadence)\n * - Navigation and Menus\n * - Streaming controls and viewer\n * - Workout builder\n * - System features (Wake lock, PWA install, Service Worker)\n * - Accessibility features\n * \n * @param params - State objects and dependencies\n * @returns The initialized ZoneState for zone distribution tracking\n */\nexport function initUi({ measurementsState, timeState, connectionsState, streamManager }: UiInitParams): ZoneState {\n    // Initialize UI components\n    initTimerDisplay(timeState);\n    const zoneState = initMetricsDisplay({ connectionsState, measurementsState });\n\n    // PWA & System features\n    handleWakeLock();\n    registerServiceWorker();\n    initInstallPrompt();\n\n    // UI Modules\n    initAboutModal();\n    initStreamViewer();\n    initStreamingControls(streamManager, timeState);\n    initWorkoutBuilder();\n    initKeyboardNavigation();\n\n    const darkModeToggle = document.getElementById('toggleDarkMode') as HTMLInputElement | null;\n    if (darkModeToggle) {\n        setupDarkModeToggle(darkModeToggle);\n    }\n\n    initOnboarding();\n    initLapButton({ measurementsState, timeState });\n\n    initWorkoutRecovery(measurementsState, timeState).then((recovered) => {\n        if (recovered) {\n            console.log('Workout recovered from previous session');\n            // Update UI to reflect recovered data\n            document.dispatchEvent(new CustomEvent('workout-recovered'));\n        }\n    });\n\n    // Initialize menu controls \n    // Note: Some of these were at the bottom of main.ts before\n    initDiscardButton({ measurementsState, timeState, zoneState });\n    initExportButton(measurementsState, zoneState);\n    initMetricsToggle();\n    initWorkoutSummaryModal({ measurementsState, timeState, zoneState });\n\n    return zoneState;\n}\n","/**\r\n * Android scan mode\r\n */\r\nexport var ScanMode;\r\n(function (ScanMode) {\r\n    /**\r\n     * Perform Bluetooth LE scan in low power mode. This mode is enforced if the scanning application is not in foreground.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_LOW_POWER\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_LOW_POWER\"] = 0] = \"SCAN_MODE_LOW_POWER\";\r\n    /**\r\n     * Perform Bluetooth LE scan in balanced power mode. (default) Scan results are returned at a rate that provides a good trade-off between scan frequency and power consumption.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_BALANCED\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_BALANCED\"] = 1] = \"SCAN_MODE_BALANCED\";\r\n    /**\r\n     * Scan using highest duty cycle. It's recommended to only use this mode when the application is running in the foreground.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_LOW_LATENCY\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_LOW_LATENCY\"] = 2] = \"SCAN_MODE_LOW_LATENCY\";\r\n})(ScanMode || (ScanMode = {}));\r\n/**\r\n * Android connection priority used in `requestConnectionPriority`\r\n */\r\nexport var ConnectionPriority;\r\n(function (ConnectionPriority) {\r\n    /**\r\n     * Use the connection parameters recommended by the Bluetooth SIG. This is the default value if no connection parameter update is requested.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_BALANCED\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_BALANCED\"] = 0] = \"CONNECTION_PRIORITY_BALANCED\";\r\n    /**\r\n     * Request a high priority, low latency connection. An application should only request high priority connection parameters to transfer large amounts of data over LE quickly. Once the transfer is complete, the application should request CONNECTION_PRIORITY_BALANCED connection parameters to reduce energy use.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_HIGH\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_HIGH\"] = 1] = \"CONNECTION_PRIORITY_HIGH\";\r\n    /**\r\n     * Request low power, reduced data rate connection parameters.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_LOW_POWER\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_LOW_POWER\"] = 2] = \"CONNECTION_PRIORITY_LOW_POWER\";\r\n})(ConnectionPriority || (ConnectionPriority = {}));\r\n//# sourceMappingURL=definitions.js.map","/**\r\n * Convert an array of numbers into a DataView.\r\n */\r\nexport function numbersToDataView(value) {\r\n    return new DataView(Uint8Array.from(value).buffer);\r\n}\r\n/**\r\n * Convert a DataView into an array of numbers.\r\n */\r\nexport function dataViewToNumbers(value) {\r\n    return Array.from(new Uint8Array(value.buffer, value.byteOffset, value.byteLength));\r\n}\r\n/**\r\n * Convert a string into a DataView.\r\n */\r\nexport function textToDataView(value) {\r\n    return numbersToDataView(value.split('').map((s) => s.charCodeAt(0)));\r\n}\r\n/**\r\n * Convert a DataView into a string.\r\n */\r\nexport function dataViewToText(value) {\r\n    return String.fromCharCode(...dataViewToNumbers(value));\r\n}\r\n/**\r\n * Convert a 16 bit UUID into a 128 bit UUID string\r\n * @param value number, e.g. 0x180d\r\n * @return string, e.g. '0000180d-0000-1000-8000-00805f9b34fb'\r\n */\r\nexport function numberToUUID(value) {\r\n    return `0000${value.toString(16).padStart(4, '0')}-0000-1000-8000-00805f9b34fb`;\r\n}\r\n/**\r\n * Convert a string of hex into a DataView of raw bytes.\r\n * Note: characters other than [0-9a-fA-F] are ignored\r\n * @param hex string of values, e.g. \"00 01 02\" or \"000102\"\r\n * @return DataView of raw bytes\r\n */\r\nexport function hexStringToDataView(hex) {\r\n    const bin = [];\r\n    let i, c, isEmpty = 1, buffer = 0;\r\n    for (i = 0; i < hex.length; i++) {\r\n        c = hex.charCodeAt(i);\r\n        if ((c > 47 && c < 58) || (c > 64 && c < 71) || (c > 96 && c < 103)) {\r\n            buffer = (buffer << 4) ^ ((c > 64 ? c + 9 : c) & 15);\r\n            if ((isEmpty ^= 1)) {\r\n                bin.push(buffer & 0xff);\r\n            }\r\n        }\r\n    }\r\n    return numbersToDataView(bin);\r\n}\r\nexport function dataViewToHexString(value) {\r\n    return dataViewToNumbers(value)\r\n        .map((n) => {\r\n        let s = n.toString(16);\r\n        if (s.length == 1) {\r\n            s = '0' + s;\r\n        }\r\n        return s;\r\n    })\r\n        .join('');\r\n}\r\nexport function webUUIDToString(uuid) {\r\n    if (typeof uuid === 'string') {\r\n        return uuid;\r\n    }\r\n    else if (typeof uuid === 'number') {\r\n        return numberToUUID(uuid);\r\n    }\r\n    else {\r\n        throw new Error('Invalid UUID');\r\n    }\r\n}\r\nexport function mapToObject(map) {\r\n    const obj = {};\r\n    if (!map) {\r\n        return undefined;\r\n    }\r\n    map.forEach((value, key) => {\r\n        obj[key.toString()] = value;\r\n    });\r\n    return obj;\r\n}\r\n/**\r\n * Convert Data or Uint8Array to Uint8Array.\r\n * @param value DataView, Uint8Array, or undefined\r\n * @return Uint8Array or undefined\r\n */\r\nexport function toUint8Array(value) {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (typeof value === 'string') {\r\n        const dataView = hexStringToDataView(value);\r\n        return new Uint8Array(dataView.buffer, dataView.byteOffset, dataView.byteLength);\r\n    }\r\n    if (value instanceof DataView) {\r\n        return new Uint8Array(value.buffer, value.byteOffset, value.byteLength);\r\n    }\r\n    return value; // Already Uint8Array\r\n}\r\n/**\r\n * Convert Data, Uint8Array, or string to hex string.\r\n * @param value DataView, Uint8Array, or undefined\r\n * @return hex string or undefined\r\n */\r\nexport function toHexString(value) {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (value instanceof DataView) {\r\n        return dataViewToHexString(value);\r\n    }\r\n    // Uint8Array\r\n    return dataViewToHexString(new DataView(value.buffer, value.byteOffset, value.byteLength));\r\n}\r\n//# sourceMappingURL=conversion.js.map","import { registerPlugin } from '@capacitor/core';\r\nexport const BluetoothLe = registerPlugin('BluetoothLe', {\r\n    web: () => import('./web').then((m) => new m.BluetoothLeWeb()),\r\n});\r\n//# sourceMappingURL=plugin.js.map","const makeQueue = () => {\r\n    let currentTask = Promise.resolve();\r\n    // create a new promise so that errors can be bubbled\r\n    // up to the caller without being caught by the queue\r\n    return (fn) => new Promise((resolve, reject) => {\r\n        currentTask = currentTask\r\n            .then(() => fn())\r\n            .then(resolve)\r\n            .catch(reject);\r\n    });\r\n};\r\nexport function getQueue(enabled) {\r\n    if (enabled) {\r\n        return makeQueue();\r\n    }\r\n    return (fn) => fn();\r\n}\r\n//# sourceMappingURL=queue.js.map","export function parseUUID(uuid) {\r\n    if (typeof uuid !== 'string') {\r\n        throw new Error(`Invalid UUID type ${typeof uuid}. Expected string.`);\r\n    }\r\n    uuid = uuid.toLowerCase();\r\n    const is128BitUuid = uuid.search(/^[0-9a-f]{8}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{12}$/) >= 0;\r\n    if (!is128BitUuid) {\r\n        throw new Error(`Invalid UUID format ${uuid}. Expected 128 bit string (e.g. \"0000180d-0000-1000-8000-00805f9b34fb\").`);\r\n    }\r\n    return uuid;\r\n}\r\n//# sourceMappingURL=validators.js.map","import { Capacitor } from '@capacitor/core';\r\nimport { dataViewToHexString, hexStringToDataView, toUint8Array, toHexString } from './conversion';\r\nimport { BluetoothLe } from './plugin';\r\nimport { getQueue } from './queue';\r\nimport { parseUUID } from './validators';\r\nclass BleClientClass {\r\n    constructor() {\r\n        this.scanListener = null;\r\n        this.eventListeners = new Map();\r\n        this.queue = getQueue(true);\r\n    }\r\n    enableQueue() {\r\n        this.queue = getQueue(true);\r\n    }\r\n    disableQueue() {\r\n        this.queue = getQueue(false);\r\n    }\r\n    async initialize(options) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.initialize(options);\r\n        });\r\n    }\r\n    async isEnabled() {\r\n        const enabled = await this.queue(async () => {\r\n            const result = await BluetoothLe.isEnabled();\r\n            return result.value;\r\n        });\r\n        return enabled;\r\n    }\r\n    async requestEnable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.requestEnable();\r\n        });\r\n    }\r\n    async enable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.enable();\r\n        });\r\n    }\r\n    async disable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.disable();\r\n        });\r\n    }\r\n    async startEnabledNotifications(callback) {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `onEnabledChanged`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            const listener = await BluetoothLe.addListener(key, (result) => {\r\n                callback(result.value);\r\n            });\r\n            this.eventListeners.set(key, listener);\r\n            await BluetoothLe.startEnabledNotifications();\r\n        });\r\n    }\r\n    async stopEnabledNotifications() {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `onEnabledChanged`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.eventListeners.delete(key);\r\n            await BluetoothLe.stopEnabledNotifications();\r\n        });\r\n    }\r\n    async isLocationEnabled() {\r\n        const enabled = await this.queue(async () => {\r\n            const result = await BluetoothLe.isLocationEnabled();\r\n            return result.value;\r\n        });\r\n        return enabled;\r\n    }\r\n    async openLocationSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openLocationSettings();\r\n        });\r\n    }\r\n    async openBluetoothSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openBluetoothSettings();\r\n        });\r\n    }\r\n    async openAppSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openAppSettings();\r\n        });\r\n    }\r\n    async setDisplayStrings(displayStrings) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.setDisplayStrings(displayStrings);\r\n        });\r\n    }\r\n    async requestDevice(options) {\r\n        options = options ? this.validateRequestBleDeviceOptions(options) : undefined;\r\n        const result = await this.queue(async () => {\r\n            const device = await BluetoothLe.requestDevice(options);\r\n            return device;\r\n        });\r\n        return result;\r\n    }\r\n    async requestLEScan(options, callback) {\r\n        options = this.validateRequestBleDeviceOptions(options);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            await ((_a = this.scanListener) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.scanListener = await BluetoothLe.addListener('onScanResult', (resultInternal) => {\r\n                const result = Object.assign(Object.assign({}, resultInternal), { manufacturerData: this.convertObject(resultInternal.manufacturerData), serviceData: this.convertObject(resultInternal.serviceData), rawAdvertisement: resultInternal.rawAdvertisement\r\n                        ? this.convertValue(resultInternal.rawAdvertisement)\r\n                        : undefined });\r\n                callback(result);\r\n            });\r\n            await BluetoothLe.requestLEScan(options);\r\n        });\r\n    }\r\n    async stopLEScan() {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            await ((_a = this.scanListener) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.scanListener = null;\r\n            await BluetoothLe.stopLEScan();\r\n        });\r\n    }\r\n    async getDevices(deviceIds) {\r\n        if (!Array.isArray(deviceIds)) {\r\n            throw new Error('deviceIds must be an array');\r\n        }\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getDevices({ deviceIds });\r\n            return result.devices;\r\n        });\r\n    }\r\n    async getConnectedDevices(services) {\r\n        if (!Array.isArray(services)) {\r\n            throw new Error('services must be an array');\r\n        }\r\n        services = services.map(parseUUID);\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getConnectedDevices({ services });\r\n            return result.devices;\r\n        });\r\n    }\r\n    async getBondedDevices() {\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getBondedDevices();\r\n            return result.devices;\r\n        });\r\n    }\r\n    async connect(deviceId, onDisconnect, options) {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            if (onDisconnect) {\r\n                const key = `disconnected|${deviceId}`;\r\n                await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n                const listener = await BluetoothLe.addListener(key, () => {\r\n                    onDisconnect(deviceId);\r\n                });\r\n                this.eventListeners.set(key, listener);\r\n            }\r\n            await BluetoothLe.connect(Object.assign({ deviceId }, options));\r\n        });\r\n    }\r\n    async createBond(deviceId, options) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.createBond(Object.assign({ deviceId }, options));\r\n        });\r\n    }\r\n    async isBonded(deviceId) {\r\n        const isBonded = await this.queue(async () => {\r\n            const result = await BluetoothLe.isBonded({ deviceId });\r\n            return result.value;\r\n        });\r\n        return isBonded;\r\n    }\r\n    async disconnect(deviceId) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.disconnect({ deviceId });\r\n        });\r\n    }\r\n    async getServices(deviceId) {\r\n        const services = await this.queue(async () => {\r\n            const result = await BluetoothLe.getServices({ deviceId });\r\n            return result.services;\r\n        });\r\n        return services;\r\n    }\r\n    async discoverServices(deviceId) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.discoverServices({ deviceId });\r\n        });\r\n    }\r\n    async getMtu(deviceId) {\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.getMtu({ deviceId });\r\n            return result.value;\r\n        });\r\n        return value;\r\n    }\r\n    async requestConnectionPriority(deviceId, connectionPriority) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.requestConnectionPriority({ deviceId, connectionPriority });\r\n        });\r\n    }\r\n    async readRssi(deviceId) {\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.readRssi({ deviceId });\r\n            return parseFloat(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async read(deviceId, service, characteristic, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.read(Object.assign({ deviceId,\r\n                service,\r\n                characteristic }, options));\r\n            return this.convertValue(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async write(deviceId, service, characteristic, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        return this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.write(Object.assign({ deviceId,\r\n                service,\r\n                characteristic, value: writeValue }, options));\r\n        });\r\n    }\r\n    async writeWithoutResponse(deviceId, service, characteristic, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.writeWithoutResponse(Object.assign({ deviceId,\r\n                service,\r\n                characteristic, value: writeValue }, options));\r\n        });\r\n    }\r\n    async readDescriptor(deviceId, service, characteristic, descriptor, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        descriptor = parseUUID(descriptor);\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.readDescriptor(Object.assign({ deviceId,\r\n                service,\r\n                characteristic,\r\n                descriptor }, options));\r\n            return this.convertValue(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async writeDescriptor(deviceId, service, characteristic, descriptor, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        descriptor = parseUUID(descriptor);\r\n        return this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.writeDescriptor(Object.assign({ deviceId,\r\n                service,\r\n                characteristic,\r\n                descriptor, value: writeValue }, options));\r\n        });\r\n    }\r\n    async startNotifications(deviceId, service, characteristic, callback, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `notification|${deviceId}|${service}|${characteristic}`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            const listener = await BluetoothLe.addListener(key, (event) => {\r\n                callback(this.convertValue(event === null || event === void 0 ? void 0 : event.value));\r\n            });\r\n            this.eventListeners.set(key, listener);\r\n            await BluetoothLe.startNotifications(Object.assign({ deviceId,\r\n                service,\r\n                characteristic }, options));\r\n        });\r\n    }\r\n    async stopNotifications(deviceId, service, characteristic) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `notification|${deviceId}|${service}|${characteristic}`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.eventListeners.delete(key);\r\n            await BluetoothLe.stopNotifications({\r\n                deviceId,\r\n                service,\r\n                characteristic,\r\n            });\r\n        });\r\n    }\r\n    validateRequestBleDeviceOptions(options) {\r\n        if (options.services) {\r\n            options.services = options.services.map(parseUUID);\r\n        }\r\n        if (options.optionalServices) {\r\n            options.optionalServices = options.optionalServices.map(parseUUID);\r\n        }\r\n        if (options.serviceData && Capacitor.getPlatform() !== 'web') {\r\n            // Native platforms: convert to hex strings\r\n            options.serviceData = options.serviceData.map((filter) => (Object.assign(Object.assign({}, filter), { serviceUuid: parseUUID(filter.serviceUuid), dataPrefix: toHexString(filter.dataPrefix), mask: toHexString(filter.mask) })));\r\n        }\r\n        if (options.manufacturerData) {\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // Native platforms: convert to hex strings\r\n                options.manufacturerData = options.manufacturerData.map((filter) => (Object.assign(Object.assign({}, filter), { dataPrefix: toHexString(filter.dataPrefix), mask: toHexString(filter.mask) })));\r\n            }\r\n            else {\r\n                // Web platform: convert to Uint8Array for Web Bluetooth API\r\n                options.manufacturerData = options.manufacturerData.map((filter) => (Object.assign(Object.assign({}, filter), { dataPrefix: toUint8Array(filter.dataPrefix), mask: toUint8Array(filter.mask) })));\r\n            }\r\n        }\r\n        return options;\r\n    }\r\n    convertValue(value) {\r\n        if (typeof value === 'string') {\r\n            return hexStringToDataView(value);\r\n        }\r\n        else if (value === undefined) {\r\n            return new DataView(new ArrayBuffer(0));\r\n        }\r\n        return value;\r\n    }\r\n    convertObject(obj) {\r\n        if (obj === undefined) {\r\n            return undefined;\r\n        }\r\n        const result = {};\r\n        for (const key of Object.keys(obj)) {\r\n            result[key] = this.convertValue(obj[key]);\r\n        }\r\n        return result;\r\n    }\r\n}\r\nexport const BleClient = new BleClientClass();\r\n//# sourceMappingURL=bleClient.js.map","/**\n * FTMS (Fitness Machine Service) Parser\n * \n * Handles parsing of Bluetooth LE data from Fitness Machines (Treadmills).\n * \n * Specs: https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/\n */\n\nexport interface FTMSValues {\n    speed?: number;      // km/h\n    averageSpeed?: number; // km/h\n    totalDistance?: number; // meters\n    incline?: number;    // %\n    rampAngle?: number;  // degrees\n}\n\n/**\n * Parses Treadmill Data characteristic (0x2ACD)\n * \n * @param data DataView containing the raw bytes\n * @returns Parsed values object\n */\nexport const parseTreadmillData = (data: DataView): FTMSValues => {\n    // Check flags in first 2 bytes (16-bit LE)\n    const flags = data.getUint16(0, true);\n    let offset = 2;\n    const result: FTMSValues = {};\n\n    // Bit 0: More Data (ignored for now)\n    // Bit 1: Average Speed Present\n    const hasAverageSpeed = (flags & (1 << 1)) !== 0;\n    // Bit 2: Total Distance Present\n    const hasTotalDistance = (flags & (1 << 2)) !== 0;\n    // Bit 3: Inclination and Ramp Angle Present\n    const hasInclination = (flags & (1 << 3)) !== 0;\n\n    // Other bits ignored for now to avoid unused variable warnings\n    /*\n    // Bit 4: Elevation Gain Present\n    const hasElevationGain = (flags & (1 << 4)) !== 0;\n    // Bit 5: Instantaneous Pace Present\n    const hasPace = (flags & (1 << 5)) !== 0;\n    // Bit 6: Average Pace Present\n    const hasAveragePace = (flags & (1 << 6)) !== 0;\n    // Bit 7: Expended Energy Present\n    const hasEnergy = (flags & (1 << 7)) !== 0;\n    // Bit 8: Heart Rate Present\n    const hasHeartRate = (flags & (1 << 8)) !== 0;\n    // Bit 9: Metabolic Equivalent Present\n    const hasMetabolic = (flags & (1 << 9)) !== 0;\n    // Bit 10: Elapsed Time Present\n    const hasElapsedTime = (flags & (1 << 10)) !== 0;\n    // Bit 11: Remaining Time Present\n    const hasRemainingTime = (flags & (1 << 11)) !== 0;\n    // Bit 12: Force on Belt and Power Output Present\n    const hasForcePower = (flags & (1 << 12)) !== 0;\n    */\n\n    // Instantaneous Speed (Always present unless noted otherwise, but spec says \"C1\" - Mandatory)\n    // Unit: 0.01 km/h, uint16\n    // Note: Some legacy devices might interpret flags differently, but standard says first field after flags is Inst. Speed.\n    if (data.byteLength >= offset + 2) {\n        const rawSpeed = data.getUint16(offset, true);\n        result.speed = rawSpeed / 100.0;\n        offset += 2;\n    }\n\n    if (hasAverageSpeed && data.byteLength >= offset + 2) {\n        const rawAvgSpeed = data.getUint16(offset, true);\n        result.averageSpeed = rawAvgSpeed / 100.0;\n        offset += 2;\n    }\n\n    if (hasTotalDistance && data.byteLength >= offset + 3) {\n        // unit24 is tricky. Read 3 bytes.\n        // Little endian: byte[0] + byte[1]<<8 + byte[2]<<16\n        const b0 = data.getUint8(offset);\n        const b1 = data.getUint8(offset + 1);\n        const b2 = data.getUint8(offset + 2);\n        const rawDist = b0 + (b1 << 8) + (b2 << 16);\n\n        result.totalDistance = rawDist;\n        offset += 3;\n    }\n\n    if (hasInclination && data.byteLength >= offset + 4) {\n        // Inclination: sint16, 0.1 %\n        const rawIncline = data.getInt16(offset, true);\n        result.incline = rawIncline / 10.0;\n        offset += 2;\n\n        // Ramp Angle: sint16, 0.1 degree\n        const rawRamp = data.getInt16(offset, true);\n        result.rampAngle = rawRamp / 10.0;\n        offset += 2;\n    }\n\n    // We can parse more if needed (Heart Rate, etc.)\n\n    return result;\n};\n","import { BleClient } from '@capacitor-community/bluetooth-le';\nimport type { SensorConnection, TreadmillConnection, MeasurementListener, TreadmillListener, ConnectionStatusListener, ConnectionStatus } from '../../types/bluetooth.js';\nimport type { Measurement, TreadmillMeasurement } from '../../types/measurements.js';\nimport { parseTreadmillData } from './ftms.js';\nimport { BluetoothDebugService } from '../debug/BluetoothDebugService.js';\n\nconst CYCLING_POWER_SERVICE = '00001818-0000-1000-8000-00805f9b34fb';\nconst CYCLING_POWER_MEASUREMENT = '00002a63-0000-1000-8000-00805f9b34fb';\n\nconst HEART_RATE_SERVICE = '0000180d-0000-1000-8000-00805f9b34fb';\nconst HEART_RATE_MEASUREMENT = '00002a37-0000-1000-8000-00805f9b34fb';\n\nconst CYCLING_SPEED_AND_CADENCE_SERVICE = '00001816-0000-1000-8000-00805f9b34fb';\nconst CSC_MEASUREMENT = '00002a5b-0000-1000-8000-00805f9b34fb';\n\nconst FITNESS_MACHINE_SERVICE = '00001826-0000-1000-8000-00805f9b34fb';\nconst TREADMILL_DATA_CHARACTERISTIC = '00002acd-0000-1000-8000-00805f9b34fb';\n\n/** Maximum reconnection attempts before giving up */\nconst MAX_RECONNECT_ATTEMPTS = 5;\n/** Base delay between reconnection attempts (ms) */\nconst RECONNECT_BASE_DELAY = 1000;\n\n// Track if BleClient has been initialized\nlet isBleInitialized = false;\n\nconst ensureBleInitialized = async () => {\n    if (!isBleInitialized) {\n        try {\n            await BleClient.initialize();\n            isBleInitialized = true;\n        } catch (error) {\n            console.error('Failed to initialize BleClient:', error);\n            // On some versions/platforms, re-initializing might throw but not be fatal if already initialized.\n            // But usually we want to propagate this error if it's the first time.\n            throw error;\n        }\n    }\n};\n\nexport const connectPowerNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [CYCLING_POWER_SERVICE],\n            optionalServices: []\n        });\n    } catch (error) {\n        console.error('Error requesting Power device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Power Sensor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            CYCLING_POWER_SERVICE,\n            CYCLING_POWER_MEASUREMENT,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n                const power = value.getInt16(2, true);\n                const entry: Measurement = { timestamp: Date.now(), value: power };\n                listeners.forEach(listener => listener(entry));\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Power sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Power sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Power sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Power sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Power sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, CYCLING_POWER_SERVICE, CYCLING_POWER_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectHeartRateNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [HEART_RATE_SERVICE],\n            optionalServices: [HEART_RATE_SERVICE]\n        });\n    } catch (error) {\n        console.error('Error requesting Heart Rate device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Heart Rate Monitor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            HEART_RATE_SERVICE,\n            HEART_RATE_MEASUREMENT,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                const flags = value.getUint8(0);\n                let heartRate: number;\n\n                // Check Heart Rate Value Format bit (bit 0)\n                if (flags & 0x01) {\n                    // UINT16\n                    heartRate = value.getUint16(1, true); // little-endian\n                } else {\n                    // UINT8\n                    heartRate = value.getUint8(1);\n                }\n\n                const entry: Measurement = { timestamp: Date.now(), value: heartRate };\n                listeners.forEach(listener => listener(entry));\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Heart Rate sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Heart Rate sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Heart Rate sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Heart Rate sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Heart Rate sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, HEART_RATE_SERVICE, HEART_RATE_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectCadenceNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let lastCrankRevs: number | null = null;\n    let lastCrankTime: number | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [CYCLING_SPEED_AND_CADENCE_SERVICE],\n            optionalServices: [CYCLING_SPEED_AND_CADENCE_SERVICE]\n        });\n    } catch (error) {\n        console.error('Error requesting Cadence device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Cadence Sensor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            CYCLING_SPEED_AND_CADENCE_SERVICE,\n            CSC_MEASUREMENT,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                const flags = value.getUint8(0);\n\n                // Check if crank revolution data is present (bit 1 of flags)\n                if (flags & 0x02) {\n                    let offset = 1; // Start after flags byte\n\n                    // If wheel revolution data is present (bit 0), skip it (6 bytes: 4 for revs + 2 for time)\n                    if (flags & 0x01) {\n                        offset = 7;\n                    }\n\n                    const crankRevs = value.getUint16(offset, true);\n                    const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n                    // Calculate RPM from delta between measurements\n                    if (lastCrankRevs !== null && lastCrankTime !== null) {\n                        let revDelta = crankRevs - lastCrankRevs;\n                        let timeDelta = crankTime - lastCrankTime;\n\n                        // Handle rollover (uint16 max is 65535)\n                        if (revDelta < 0) revDelta += 65536;\n                        if (timeDelta < 0) timeDelta += 65536;\n\n                        // Calculate RPM: (revolutions / time_in_seconds) * 60\n                        // Time is in 1/1024 seconds, so convert to seconds\n                        if (timeDelta > 0) {\n                            const timeInSeconds = timeDelta / 1024;\n                            const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                            // Sanity check for reasonable cadence values\n                            if (rpm >= 0 && rpm < 300) {\n                                const entry: Measurement = { timestamp: Date.now(), value: rpm };\n                                listeners.forEach(listener => listener(entry));\n                            }\n                        }\n                    }\n\n                    lastCrankRevs = crankRevs;\n                    lastCrankTime = crankTime;\n                }\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Cadence sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Cadence sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Cadence sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Cadence sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Cadence sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, CYCLING_SPEED_AND_CADENCE_SERVICE, CSC_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectTreadmillNative = async (): Promise<TreadmillConnection> => {\n    const listeners: TreadmillListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [FITNESS_MACHINE_SERVICE],\n            optionalServices: [FITNESS_MACHINE_SERVICE]\n        });\n    } catch (error) {\n        console.error('Error requesting Treadmill device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Treadmill';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Treadmill: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            FITNESS_MACHINE_SERVICE,\n            TREADMILL_DATA_CHARACTERISTIC,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                try {\n                    const ftmsData = parseTreadmillData(value);\n\n                    if (ftmsData.speed !== undefined || ftmsData.incline !== undefined) {\n                        const entry: TreadmillMeasurement = {\n                            timestamp: Date.now(),\n                            speed: ftmsData.speed ?? null,\n                            incline: ftmsData.incline ?? null\n                        };\n                        listeners.forEach(listener => listener(entry));\n                    }\n                } catch (e) {\n                    console.error('Error parsing treadmill data', e);\n                }\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect) return;\n\n        if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            console.error('Treadmill: Max reconnection attempts reached');\n            notifyStatus('failed');\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Treadmill: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Treadmill: Reconnected successfully');\n        } catch (error) {\n            console.error('Treadmill: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    try {\n        await connect();\n    } catch (error) {\n        if (deviceId) {\n            try {\n                await BleClient.disconnect(deviceId);\n            } catch (e) { /* ignore */ }\n        }\n        throw error;\n    }\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, FITNESS_MACHINE_SERVICE, TREADMILL_DATA_CHARACTERISTIC);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting treadmill', e);\n                }\n            }\n            notifyStatus('disconnected');\n        },\n        addListener: (callback: TreadmillListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n","import type { SensorConnection, TreadmillConnection, MeasurementListener, TreadmillListener, ConnectionStatusListener, ConnectionStatus } from '../../types/bluetooth.js';\nimport type { Measurement, TreadmillMeasurement } from '../../types/measurements.js';\nimport { parseTreadmillData } from './ftms.js';\nimport { BluetoothDebugService } from '../debug/BluetoothDebugService.js';\n\n/** Maximum reconnection attempts before giving up */\nconst MAX_RECONNECT_ATTEMPTS = 5;\n/** Base delay between reconnection attempts (ms) */\nconst RECONNECT_BASE_DELAY = 1000;\n\nexport const connectPowerWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n\n    // Request Bluetooth device with cycling power service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_power'] }],\n        optionalServices: ['cycling_power'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Power Sensor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n        const power = value.getInt16(2, true);\n        const entry: Measurement = { timestamp: Date.now(), value: power };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('cycling_power');\n        characteristic = await service.getCharacteristic('cycling_power_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Power sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Power sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Power sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Power sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Power sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectHeartRateWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n\n    // Request Bluetooth device with heart rate service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['heart_rate'] }],\n        optionalServices: ['heart_rate'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Heart Rate Monitor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        const flags = value.getUint8(0);\n        let heartRate: number;\n\n        // Check Heart Rate Value Format bit (bit 0)\n        if (flags & 0x01) {\n            // UINT16\n            heartRate = value.getUint16(1, true); // little-endian\n        } else {\n            // UINT8\n            heartRate = value.getUint8(1);\n        }\n\n        const entry: Measurement = { timestamp: Date.now(), value: heartRate };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('heart_rate');\n        characteristic = await service.getCharacteristic('heart_rate_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Heart rate sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Heart rate sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Heart rate sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Heart rate sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Heart rate sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectCadenceWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n    let lastCrankRevs: number | null = null;\n    let lastCrankTime: number | null = null;\n\n    // Request Bluetooth device with cycling speed and cadence service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_speed_and_cadence'] }],\n        optionalServices: ['cycling_speed_and_cadence'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Cadence Sensor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        const flags = value.getUint8(0);\n\n        // Check if crank revolution data is present (bit 1 of flags)\n        if (flags & 0x02) {\n            // Crank revolution data format:\n            // - Cumulative Crank Revolutions (uint16, bytes 1-2 or 5-6 depending on wheel data)\n            // - Last Crank Event Time (uint16, bytes 3-4 or 7-8, units: 1/1024 seconds)\n\n            let offset = 1; // Start after flags byte\n\n            // If wheel revolution data is present (bit 0), skip it (6 bytes: 4 for revs + 2 for time)\n            if (flags & 0x01) {\n                offset = 7;\n            }\n\n            const crankRevs = value.getUint16(offset, true);\n            const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n            // Calculate RPM from delta between measurements\n            if (lastCrankRevs !== null && lastCrankTime !== null) {\n                let revDelta = crankRevs - lastCrankRevs;\n                let timeDelta = crankTime - lastCrankTime;\n\n                // Handle rollover (uint16 max is 65535)\n                if (revDelta < 0) revDelta += 65536;\n                if (timeDelta < 0) timeDelta += 65536;\n\n                // Calculate RPM: (revolutions / time_in_seconds) * 60\n                // Time is in 1/1024 seconds, so convert to seconds\n                if (timeDelta > 0) {\n                    const timeInSeconds = timeDelta / 1024;\n                    const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                    // Sanity check for reasonable cadence values\n                    if (rpm >= 0 && rpm < 300) {\n                        const entry: Measurement = { timestamp: Date.now(), value: rpm };\n                        listeners.forEach(listener => listener(entry));\n                    }\n                }\n            }\n\n            lastCrankRevs = crankRevs;\n            lastCrankTime = crankTime;\n        }\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('cycling_speed_and_cadence');\n        characteristic = await service.getCharacteristic('csc_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Cadence sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Cadence sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Cadence sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Cadence sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Cadence sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectTreadmillWeb = async (): Promise<TreadmillConnection> => {\n    const listeners: TreadmillListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n    let server: BluetoothRemoteGATTServer | undefined;\n\n    // Request Bluetooth device with Fitness Machine Service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['fitness_machine'] }],\n        optionalServices: ['fitness_machine'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Treadmill';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        try {\n            const ftmsData = parseTreadmillData(value);\n\n            // Only emit if we have relevant data\n            if (ftmsData.speed !== undefined || ftmsData.incline !== undefined) {\n                const entry: TreadmillMeasurement = {\n                    timestamp: Date.now(),\n                    speed: ftmsData.speed ?? null,\n                    incline: ftmsData.incline ?? null\n                };\n                listeners.forEach(listener => listener(entry));\n            }\n        } catch (e) {\n            console.error('Error parsing treadmill data', e);\n        }\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        server = await device.gatt.connect();\n        const service = await server.getPrimaryService('fitness_machine');\n        characteristic = await service.getCharacteristic('treadmill_data');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Treadmill: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Treadmill: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Treadmill: Reconnected successfully');\n        } catch (error) {\n            console.error('Treadmill: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Treadmill: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    try {\n        await connect();\n    } catch (error) {\n        if (server && server.connected) {\n            server.disconnect();\n        }\n        throw error;\n    }\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                try {\n                    characteristic.stopNotifications();\n                    characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                } catch (e) { /* ignore */ }\n            }\n            if (device.gatt?.connected) {\n                device.gatt.disconnect();\n            }\n            notifyStatus('disconnected');\n        },\n        addListener: (callback: TreadmillListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { SensorConnection, TreadmillConnection } from '../../types/bluetooth.js';\nimport { connectPowerNative, connectHeartRateNative, connectCadenceNative, connectTreadmillNative } from './native-bluetooth.js';\nimport { connectPowerWeb, connectHeartRateWeb, connectCadenceWeb, connectTreadmillWeb } from './web-bluetooth.js';\n\n/**\n * Bluetooth Factory\n * \n * Abstract factory for creating Bluetooth sensor connections.\n * Automatically selects the appropriate implementation (Web Bluetooth or Native)\n * based on the current platform.\n */\nexport const BluetoothFactory = {\n    /**\n     * Connect to a Power Meter\n     * @returns Promise resolving to a SensorConnection\n     */\n    connectPower: async (): Promise<SensorConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectPowerNative();\n        } else {\n            return connectPowerWeb();\n        }\n    },\n\n    /**\n     * Connect to a Heart Rate Monitor\n     * @returns Promise resolving to a SensorConnection\n     */\n    connectHeartRate: async (): Promise<SensorConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectHeartRateNative();\n        } else {\n            return connectHeartRateWeb();\n        }\n    },\n\n    /**\n     * Connect to a Cadence Sensor\n     * @returns Promise resolving to a SensorConnection\n     */\n    connectCadence: async (): Promise<SensorConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectCadenceNative();\n        } else {\n            return connectCadenceWeb();\n        }\n    },\n\n    /**\n     * Connect to a Treadmill\n     * @returns Promise resolving to a TreadmillConnection\n     */\n    connectTreadmill: async (): Promise<TreadmillConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectTreadmillNative();\n        } else {\n            return connectTreadmillWeb();\n        }\n    }\n};\n","/**\n * Cadence Sensor Connection Module\n * \n * Connects to Bluetooth cadence sensors supporting the Cycling Speed and Cadence Service.\n * \n * @module connect-cadence\n */\n\nimport type { SensorConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Connect to a cadence sensor.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectCadence = async (): Promise<SensorConnection> => {\n    return BluetoothFactory.connectCadence();\n};\n","/**\n * Heart Rate Sensor Connection Module\n * \n * Connects to Bluetooth heart rate monitors supporting the Heart Rate Service.\n * \n * @module connect-heartrate\n */\n\nimport type { SensorConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Connect to a heart rate sensor.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectHeartRate = async (): Promise<SensorConnection> => {\n    return BluetoothFactory.connectHeartRate();\n};\n","/**\n * Power Sensor Connection Module\n * \n * Connects to Bluetooth cycling power meters supporting the Cycling Power Service.\n * \n * @module connect-power\n */\n\nimport type { SensorConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Connect to a power sensor.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectPower = async (): Promise<SensorConnection> => {\n    return BluetoothFactory.connectPower();\n};\n","import type { TreadmillConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\nexport const connectTreadmill = async (): Promise<TreadmillConnection> => {\n    return BluetoothFactory.connectTreadmill();\n};\n","import { registerPlugin } from '@capacitor/core';\nimport type { BackgroundGeolocationPlugin, Location, CallbackError } from '@capacitor-community/background-geolocation';\nimport type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nconst BackgroundGeolocation = registerPlugin<BackgroundGeolocationPlugin>('BackgroundGeolocation');\n\nexport const createNativeGpsService = (): GpsService => {\n    let watcherId: string | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            try {\n                watcherId = await BackgroundGeolocation.addWatcher(\n                    {\n                        backgroundMessage: \"Tracking your ride.\",\n                        backgroundTitle: \"Bike Power Tracker\",\n                        requestPermissions: true,\n                        stale: false,\n                        distanceFilter: 10\n                    },\n                    (location: Location | null | undefined, error?: CallbackError | null) => {\n                        if (error) {\n                            if (error.code === \"NOT_AUTHORIZED\") {\n                                if (window.confirm(\n                                    \"This app needs your location, \" +\n                                    \"but does not have permission.\\n\\n\" +\n                                    \"Open settings now?\"\n                                )) {\n                                    BackgroundGeolocation.openSettings();\n                                }\n                            }\n                            return console.error(error);\n                        }\n\n                        if (location) {\n                            const point: GpsPoint = {\n                                timestamp: location.time || Date.now(),\n                                lat: location.latitude,\n                                lon: location.longitude,\n                                accuracy: location.accuracy,\n                                altitude: location.altitude,\n                                speed: location.speed,\n                                heading: location.bearing\n                            };\n                            listener(point);\n                        }\n                    }\n                );\n            } catch (e) {\n                console.error('Error starting native GPS:', e);\n            }\n        },\n        stop: async () => {\n            if (watcherId) {\n                await BackgroundGeolocation.removeWatcher({\n                    id: watcherId\n                });\n                watcherId = null;\n            }\n        }\n    };\n};\n","import type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nexport const createWebGpsService = (): GpsService => {\n    let watchId: number | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            if (!('geolocation' in navigator)) {\n                console.warn('Geolocation is not supported by this browser.');\n                return;\n            }\n\n            watchId = navigator.geolocation.watchPosition(\n                (position) => {\n                    const point: GpsPoint = {\n                        timestamp: position.timestamp,\n                        lat: position.coords.latitude,\n                        lon: position.coords.longitude,\n                        accuracy: position.coords.accuracy,\n                        altitude: position.coords.altitude,\n                        speed: position.coords.speed,\n                        heading: position.coords.heading\n                    };\n                    listener(point);\n                },\n                (error) => {\n                    console.error('Error watching position:', error);\n                },\n                {\n                    enableHighAccuracy: true,\n                    timeout: 5000,\n                    maximumAge: 0\n                }\n            );\n        },\n        stop: async () => {\n            if (watchId !== null) {\n                navigator.geolocation.clearWatch(watchId);\n                watchId = null;\n            }\n        }\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { GpsService } from './types.js';\nimport { createNativeGpsService } from './native-gps.js';\nimport { createWebGpsService } from './web-gps.js';\n\nexport const GpsFactory = {\n    create: (): GpsService => {\n        if (Capacitor.isNativePlatform()) {\n            return createNativeGpsService();\n        } else {\n            return createWebGpsService();\n        }\n    }\n};\n","import type { GpsPoint } from './types/measurements.js';\nimport { GpsFactory } from './services/gps/factory.js';\nimport type { GpsListener } from './services/gps/types.js';\nimport { Capacitor } from '@capacitor/core';\n\nexport interface GpsConnection {\n    stop: () => Promise<void>;\n    deviceName?: string;\n}\n\nexport const connectGpsMock = async (listener: GpsListener): Promise<GpsConnection> => {\n    const interval = setInterval(() => {\n        const point: GpsPoint = {\n            timestamp: Date.now(),\n            lat: 52.5200 + (Math.random() - 0.5) * 0.01,\n            lon: 13.4050 + (Math.random() - 0.5) * 0.01,\n            accuracy: 5,\n            speed: (25 + (Math.random() - 0.5) * 5) / 3.6, // ~25 km/h in m/s\n            altitude: 50,\n            heading: 0\n        };\n        listener(point);\n    }, 1000);\n\n    return {\n        stop: async () => clearInterval(interval),\n        deviceName: 'Mock GPS',\n    };\n};\n\nexport const connectGps = async (listener: GpsListener): Promise<GpsConnection> => {\n    // Use mock GPS only in development/test mode AND when not on native platform\n    // Native platforms should always use real GPS regardless of build mode\n    const useMock = (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') &&\n        !Capacitor.isNativePlatform();\n\n    if (useMock) {\n        return connectGpsMock(listener);\n    }\n\n    const service = GpsFactory.create();\n    await service.start(listener);\n\n    return {\n        stop: async () => service.stop(),\n        deviceName: 'GPS Sensor'\n    };\n};\n","/**\n * Connection Error UI Module\n * \n * Displays user-friendly error messages for Bluetooth connection failures\n * with troubleshooting suggestions and retry functionality.\n * \n * @module connectionError\n */\n\nimport { showModal } from './modal.js';\nimport { announce } from './accessibility.js';\nimport type { MeasurementType } from '../types/measurements.js';\n\n/**\n * Bluetooth error codes and their user-friendly messages\n */\ninterface ErrorInfo {\n    title: string;\n    message: string;\n    suggestions: string[];\n    canRetry: boolean;\n}\n\n/**\n * Sensor type display names\n */\nconst sensorLabels: Record<MeasurementType | 'treadmill', string> = {\n    power: 'Power Meter',\n    heartrate: 'Heart Rate Monitor',\n    cadence: 'Cadence Sensor',\n    speed: 'Speed Sensor',\n    distance: 'Distance Sensor',\n    altitude: 'Altimeter',\n    gps: 'GPS',\n    treadmill: 'Treadmill',\n    treadmillSpeed: 'Treadmill Speed',\n};\n\n/**\n * Sensor type icons\n */\nconst sensorIcons: Record<MeasurementType | 'treadmill', string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n    treadmill: '',\n    treadmillSpeed: '',\n};\n\n/**\n * Parse a Bluetooth error and return user-friendly information\n */\nfunction parseBluetoothError(error: unknown, sensorType: MeasurementType | 'treadmill'): ErrorInfo {\n    const sensorLabel = sensorLabels[sensorType];\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorName = error instanceof Error ? error.name : '';\n\n    // User cancelled the device selection\n    if (errorMessage.includes('User cancelled') || errorMessage.includes('cancelled the requestDevice')) {\n        return {\n            title: 'Connection Cancelled',\n            message: `${sensorLabel} pairing was cancelled.`,\n            suggestions: [\n                'Click the connect button to try again',\n                'Make sure your sensor is powered on and in range',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Bluetooth not available\n    if (errorMessage.includes('Bluetooth adapter not available') ||\n        errorMessage.includes('Web Bluetooth API is not available') ||\n        errorName === 'NotFoundError' && errorMessage.includes('Bluetooth')) {\n        return {\n            title: 'Bluetooth Unavailable',\n            message: 'Bluetooth is not available on this device or browser.',\n            suggestions: [\n                'Check that Bluetooth is enabled in your device settings',\n                'Try using Chrome, Edge, or another browser that supports Web Bluetooth',\n                'On macOS, ensure Bluetooth permissions are granted in System Preferences',\n                'On Windows, check that your Bluetooth adapter is working',\n            ],\n            canRetry: false,\n        };\n    }\n\n    // No devices found\n    if (errorMessage.includes('No Bluetooth devices') ||\n        errorMessage.includes('No devices found') ||\n        (errorName === 'NotFoundError' && !errorMessage.includes('Bluetooth'))) {\n        return {\n            title: 'No Sensors Found',\n            message: `No compatible ${sensorLabel.toLowerCase()} was found nearby.`,\n            suggestions: [\n                'Make sure your sensor is powered on',\n                'Wake up the sensor by spinning the pedals or moving',\n                'Bring the sensor closer to your device',\n                'Check that the sensor battery is not depleted',\n                'Ensure the sensor is not connected to another device',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // GATT connection failed\n    if (errorMessage.includes('GATT') ||\n        errorMessage.includes('Connection failed') ||\n        errorMessage.includes('connect') && errorMessage.includes('fail')) {\n        return {\n            title: 'Connection Failed',\n            message: `Could not connect to the ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Try moving closer to the sensor',\n                'Power cycle the sensor (turn off and on again)',\n                'Check that no other device is connected to this sensor',\n                'Restart Bluetooth on your device',\n                'If using a phone, try closing other Bluetooth apps',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Security/permission error\n    if (errorMessage.includes('SecurityError') ||\n        errorMessage.includes('permission') ||\n        errorName === 'SecurityError') {\n        return {\n            title: 'Permission Denied',\n            message: 'Bluetooth permission was denied.',\n            suggestions: [\n                'Check your browser settings to allow Bluetooth access',\n                'If prompted, click \"Allow\" to grant Bluetooth permission',\n                'Try refreshing the page and connecting again',\n                'On some browsers, you may need to access this site over HTTPS',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Network/timeout error\n    if (errorMessage.includes('NetworkError') ||\n        errorMessage.includes('timeout') ||\n        errorName === 'NetworkError') {\n        return {\n            title: 'Connection Timed Out',\n            message: `The connection to your ${sensorLabel.toLowerCase()} timed out.`,\n            suggestions: [\n                'Make sure the sensor is in range and powered on',\n                'Try moving closer to the sensor',\n                'Power cycle the sensor and try again',\n                'Check for interference from other wireless devices',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Service not found\n    if (errorMessage.includes('Service') && errorMessage.includes('not found')) {\n        return {\n            title: 'Incompatible Sensor',\n            message: `This device doesn't appear to be a compatible ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Make sure you selected the correct sensor type',\n                'Check that your sensor supports standard Bluetooth protocols',\n                'Some sensors may require a firmware update',\n                'Consult your sensor\\'s documentation for compatibility',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Generic/unknown error\n    return {\n        title: 'Connection Error',\n        message: `Failed to connect to ${sensorLabel.toLowerCase()}.`,\n        suggestions: [\n            'Make sure the sensor is powered on and nearby',\n            'Try power cycling the sensor',\n            'Restart Bluetooth on your device',\n            'Refresh the page and try again',\n        ],\n        canRetry: true,\n    };\n}\n\n/**\n * Create the error content HTML element\n */\nfunction createErrorContent(errorInfo: ErrorInfo): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'connection-error-content';\n\n    // Error message\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = errorInfo.message;\n    container.appendChild(messageEl);\n\n    // Troubleshooting section\n    if (errorInfo.suggestions.length > 0) {\n        const troubleshootingEl = document.createElement('div');\n        troubleshootingEl.className = 'connection-error-troubleshooting';\n\n        const titleEl = document.createElement('h3');\n        titleEl.textContent = ' Troubleshooting Tips';\n        troubleshootingEl.appendChild(titleEl);\n\n        const listEl = document.createElement('ul');\n        listEl.setAttribute('role', 'list');\n        errorInfo.suggestions.forEach(suggestion => {\n            const itemEl = document.createElement('li');\n            itemEl.textContent = suggestion;\n            listEl.appendChild(itemEl);\n        });\n        troubleshootingEl.appendChild(listEl);\n\n        container.appendChild(troubleshootingEl);\n    }\n\n    return container;\n}\n\n/**\n * Show a connection error dialog with troubleshooting suggestions\n * \n * @param error - The error that occurred\n * @param sensorType - The type of sensor that failed to connect\n * @param onRetry - Optional callback for retry button\n * @returns Promise resolving to true if user wants to retry, false otherwise\n */\nexport function showConnectionError(\n    error: unknown,\n    sensorType: MeasurementType | 'treadmill',\n    onRetry?: () => void\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const errorInfo = parseBluetoothError(error, sensorType);\n        const sensorIcon = sensorIcons[sensorType];\n        const content = createErrorContent(errorInfo);\n\n        // Log the actual error for debugging\n        console.error(`[${sensorType}] Connection error:`, error);\n\n        // Announce to screen readers\n        announce(`${errorInfo.title}. ${errorInfo.message}`, 'assertive');\n\n        let closeModal: (() => void) | null = null;\n\n        const buttons = [];\n\n        // Always add a dismiss button\n        buttons.push({\n            text: 'Dismiss',\n            variant: 'secondary' as const,\n            onClick: () => {\n                closeModal?.();\n                resolve(false);\n            },\n        });\n\n        // Add retry button if applicable\n        if (errorInfo.canRetry) {\n            buttons.push({\n                text: 'Try Again',\n                variant: 'primary' as const,\n                onClick: () => {\n                    closeModal?.();\n                    if (onRetry) {\n                        onRetry();\n                    }\n                    resolve(true);\n                },\n            });\n        }\n\n        closeModal = showModal({\n            title: errorInfo.title,\n            icon: sensorIcon,\n            content,\n            buttons,\n            closeOnOverlay: true,\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Show a reconnection failure notification\n * \n * Called when auto-reconnect has exhausted all attempts.\n * \n * @param sensorType - The type of sensor that failed to reconnect\n * @param onRetry - Optional callback to manually retry connection\n */\nexport function showReconnectionFailed(\n    sensorType: MeasurementType | 'treadmill',\n    onRetry?: () => void\n): void {\n    const sensorLabel = sensorLabels[sensorType];\n    const sensorIcon = sensorIcons[sensorType];\n\n    const content = document.createElement('div');\n    content.className = 'connection-error-content';\n\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = `Lost connection to your ${sensorLabel.toLowerCase()} and automatic reconnection failed.`;\n    content.appendChild(messageEl);\n\n    const tipsEl = document.createElement('div');\n    tipsEl.className = 'connection-error-troubleshooting';\n\n    const titleEl = document.createElement('h3');\n    titleEl.textContent = ' To reconnect:';\n    tipsEl.appendChild(titleEl);\n\n    const listEl = document.createElement('ul');\n    listEl.setAttribute('role', 'list');\n    [\n        'Make sure the sensor is still powered on',\n        'Move closer to the sensor',\n        'Click \"Try Again\" to reconnect manually',\n    ].forEach(tip => {\n        const itemEl = document.createElement('li');\n        itemEl.textContent = tip;\n        listEl.appendChild(itemEl);\n    });\n    tipsEl.appendChild(listEl);\n    content.appendChild(tipsEl);\n\n    announce(`${sensorLabel} connection lost. Automatic reconnection failed.`, 'assertive');\n\n    let closeModal: (() => void) | null = null;\n\n    closeModal = showModal({\n        title: 'Connection Lost',\n        icon: sensorIcon,\n        content,\n        buttons: [\n            {\n                text: 'Dismiss',\n                variant: 'secondary',\n                onClick: () => {\n                    closeModal?.();\n                },\n            },\n            {\n                text: 'Try Again',\n                variant: 'primary',\n                onClick: () => {\n                    closeModal?.();\n                    onRetry?.();\n                },\n            },\n        ],\n        closeOnOverlay: true,\n    });\n}\n","/**\n * Connection Button Initialization\n * \n * Sets up Bluetooth sensor connection buttons with connect/disconnect functionality.\n * \n * @module initConnectionButtons\n */\n\nimport { connectCadence } from './connect-cadence.js';\nimport { connectHeartRate } from './connect-heartrate.js';\nimport { connectPower } from './connect-power.js';\nimport { connectTreadmill } from './connect-treadmill.js';\nimport { connectGps, type GpsConnection } from './connect-gps.js';\nimport { elements } from './elements.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { MeasurementType, Measurement, TreadmillMeasurement } from './types/measurements.js';\nimport type { ConnectionsState } from './getInitState.js';\nimport type { ConnectionStatus, SensorConnection, TreadmillConnection } from './types/bluetooth.js';\nimport { showNotification } from './ui/notifications.js';\nimport { showConnectionError, showReconnectionFailed } from './ui/connectionError.js';\n\n/**\n * Parameters for connection button initialization\n */\ninterface InitConnectionButtonsParams {\n    connectionsState: ConnectionsState;\n    measurementsState: MeasurementsState;\n}\n\n/**\n * Emoji icons for each sensor type\n */\nconst emojis: Record<MeasurementType | 'treadmill', string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n    treadmill: '',\n    treadmillSpeed: ''\n};\n\n/**\n * Get formatted sensor type label\n */\nconst getSensorLabel = (key: MeasurementType | 'treadmill'): string => {\n    return key.charAt(0).toUpperCase() + key.slice(1);\n};\n\n/**\n * Initialize connection buttons for all sensor types.\n * \n * Sets up click handlers for connect/disconnect buttons that:\n * - Connect to Bluetooth sensors\n * - Update connection state\n * - Register measurement listeners\n * - Update UI to reflect connection status\n * - Display device name when connected\n * - Handle auto-reconnect status updates\n * \n * @param params - Object containing state objects\n */\nexport const initConnectionButtons = ({\n    connectionsState,\n    measurementsState,\n}: InitConnectionButtonsParams): void => {\n\n    /**\n     * Update button text based on connection status\n     */\n    const updateButtonText = (\n        key: MeasurementType | 'treadmill',\n        status: 'connected' | 'disconnected' | 'reconnecting',\n        deviceName?: string\n    ): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const label = getSensorLabel(key);\n        const emoji = emojis[key];\n\n        switch (status) {\n            case 'connected':\n                if (deviceName) {\n                    connectElem.textContent = `${emoji} Disconnect ${label} (${deviceName})`;\n                } else {\n                    connectElem.textContent = `${emoji} Disconnect ${label}`;\n                }\n                break;\n            case 'reconnecting':\n                connectElem.textContent = `${emoji} Reconnecting ${label}...`;\n                break;\n            case 'disconnected':\n                connectElem.textContent = `${emoji} Connect ${label}`;\n                break;\n        }\n    };\n\n    /**\n     * Disconnect from a sensor\n     */\n    const disconnectFn = (key: MeasurementType | 'treadmill'): void => {\n        const connectionState = connectionsState[key];\n        if (!connectionState) return;\n\n        if (typeof connectionState.disconnect === 'function') {\n            connectionState.disconnect();\n            connectionState.disconnect = null;\n            connectionState.isConnected = false;\n\n            updateButtonText(key, 'disconnected');\n\n            const displayElem = elements[key]?.display;\n            if (displayElem) {\n                displayElem.textContent = '--';\n            }\n        }\n    };\n\n    /**\n     * Handle connection status changes from auto-reconnect\n     */\n    const handleStatusChange = (key: MeasurementType | 'treadmill', deviceName: string) => (status: ConnectionStatus): void => {\n        const label = getSensorLabel(key);\n\n        switch (status) {\n            case 'connected':\n                updateButtonText(key, 'connected', deviceName);\n                showNotification(`${label} sensor reconnected`, 'success');\n                break;\n            case 'reconnecting':\n                updateButtonText(key, 'reconnecting');\n                break;\n            case 'failed':\n                if (connectionsState[key]) {\n                    connectionsState[key]!.isConnected = false;\n                    connectionsState[key]!.disconnect = null;\n                }\n                updateButtonText(key, 'disconnected');\n                // Show reconnection failed dialog with retry option\n                showReconnectionFailed(key, () => connectFn(key));\n                break;\n            case 'disconnected':\n                // Initial disconnect event, wait for reconnect attempt\n                break;\n        }\n    };\n\n    /**\n     * Connect to a sensor\n     */\n    const connectFn = async (key: MeasurementType | 'treadmill'): Promise<void> => {\n        try {\n            updateButtonText(key, 'reconnecting'); // Show loading state\n\n            let connection: SensorConnection | TreadmillConnection | GpsConnection;\n\n            if (key === 'gps') {\n                // GPS has a different interface - uses listener callback instead of addListener\n                const gpsConnection = await connectGps((point) => {\n                    measurementsState.addGps(point);\n                });\n\n                // Adapt GpsConnection to match expected interface\n                const state = connectionsState[key];\n                if (state) {\n                    state.disconnect = async () => {\n                        await gpsConnection.stop();\n                    };\n                    state.isConnected = true;\n                }\n\n                // Update UI\n                updateButtonText(key, 'connected', gpsConnection.deviceName);\n                showNotification(`Connected to ${getSensorLabel(key)}`, 'success');\n                return; // GPS doesn't have onStatusChange, early return\n            } else if (key === 'treadmill') {\n                connection = await connectTreadmill();\n                connection.addListener((entry: TreadmillMeasurement) => {\n                    measurementsState.addTreadmillData(entry);\n                });\n            } else if (key === 'power') {\n                connection = await connectPower();\n                connection.addListener((entry: Measurement) => {\n                    measurementsState.addPower(entry);\n                });\n            } else if (key === 'heartrate') {\n                connection = await connectHeartRate();\n                connection.addListener((entry: Measurement) => {\n                    measurementsState.addHeartrate(entry);\n                });\n            } else if (key === 'cadence') {\n                connection = await connectCadence();\n                connection.addListener((entry: Measurement) => {\n                    measurementsState.addCadence(entry);\n                });\n            } else {\n                return; // Unsupported type for connection\n            }\n\n            const { disconnect, deviceName, onStatusChange } = connection;\n\n            // Update state\n            const state = connectionsState[key];\n            if (state) {\n                state.disconnect = disconnect;\n                state.isConnected = true;\n            }\n\n            // Update UI\n            updateButtonText(key, 'connected', deviceName);\n            showNotification(`Connected to ${getSensorLabel(key)}`, 'success');\n\n            // Subscribe to status changes for auto-reconnect feedback\n            if (onStatusChange) {\n                onStatusChange(handleStatusChange(key, deviceName || 'Sensor'));\n            }\n\n        } catch (error) {\n            updateButtonText(key, 'disconnected');\n\n            // Check if user wants to retry\n            const shouldRetry = await showConnectionError(error, key, () => connectFn(key));\n            if (!shouldRetry) {\n                // Reset state just in case\n                if (connectionsState[key]) {\n                    connectionsState[key]!.isConnected = false;\n                }\n            }\n        }\n    };\n\n    /**\n     * Add click listener to a button\n     */\n    const addListener = (key: MeasurementType | 'treadmill'): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const handler = (e: Event) => {\n            // Prevent propagation\n            e.stopPropagation();\n\n            const isConnected = connectionsState[key]?.isConnected;\n            if (isConnected) {\n                disconnectFn(key);\n            } else {\n                connectFn(key);\n            }\n        };\n\n        // Add click listener\n        connectElem.addEventListener('click', handler);\n    };\n\n    // Initialize all supported buttons\n    const supportedTypes: (MeasurementType | 'treadmill')[] = ['power', 'heartrate', 'cadence', 'gps', 'treadmill'];\n    supportedTypes.forEach(addListener);\n};\n","/**\n * Stream Manager\n * Handles streaming workout data to the backend service.\n * Used for live sharing of workout metrics.\n * \n * @module StreamManager\n */\n\nimport { createStream, sendWorkoutData, type CreateStreamResponse } from './api/streamClient.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { TimeState } from './getInitState.js';\nimport type { MeasurementType } from './types/measurements.js';\n\nexport interface StreamStatus {\n    isStreaming: boolean;\n    isPaused: boolean;\n    streamName: string | null;\n}\n\nexport class StreamManager {\n    // Made public readonly to support access from UI checks (temporary fix for existing code)\n    // In a future refactor, prefer getStatus()\n    public isStreaming = false;\n    private isPaused = false;\n    private streamName: string | null = null;\n    private streamInterval: any = null;\n    private measurementsState: MeasurementsState;\n    private timeState: TimeState;\n\n    constructor(measurementsState: MeasurementsState, timeState: TimeState) {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Start streaming workout data\n     * @param streamName - Optional custom stream name\n     * @returns Promise resolving to the stream name\n     */\n    async startStreaming(name?: string): Promise<string> {\n        if (this.isStreaming) {\n            return this.streamName!;\n        }\n\n        try {\n            const safeName = name || `workout-${Date.now()}`;\n            const response: CreateStreamResponse = await createStream(safeName);\n\n            if (!response.success) {\n                throw new Error('Failed to create stream');\n            }\n\n            this.streamName = response.streamName;\n            this.isStreaming = true;\n            this.isPaused = false;\n\n            this._startStreamingLoop();\n\n            return this.streamName;\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            this.streamName = null;\n            throw error;\n        }\n    }\n\n    /**\n     * Pause the stream (stop sending data but keep stream alive)\n     */\n    pauseStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = true;\n        }\n    }\n\n    /**\n     * Resume the stream\n     */\n    resumeStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = false;\n        }\n    }\n\n    /**\n     * Stop streaming workout data\n     */\n    async stopStreaming(): Promise<void> {\n        if (!this.isStreaming) {\n            return;\n        }\n\n        this.isStreaming = false;\n        this.isPaused = false;\n\n        if (this.streamInterval) {\n            clearInterval(this.streamInterval);\n            this.streamInterval = null;\n        }\n\n        // We don't delete the stream here so that data persists for a while (handled by server cleanup)\n        this.streamName = null;\n    }\n\n    /**\n     * Get current streaming status\n     */\n    getStatus(): StreamStatus {\n        return {\n            isStreaming: this.isStreaming,\n            isPaused: this.isPaused,\n            streamName: this.streamName,\n        };\n    }\n\n    /**\n     * Start the streaming loop\n     * @private\n     */\n    private _startStreamingLoop(): void {\n        // Send data every 1 second\n        this.streamInterval = setInterval(async () => {\n            if (!this.isStreaming || this.isPaused || !this.timeState.running) {\n                return;\n            }\n\n            try {\n                await this._sendCurrentData();\n            } catch (error) {\n                console.error('Error sending workout data:', error);\n            }\n        }, 1000);\n    }\n\n    /**\n     * Send current workout data\n     * @private\n     */\n    private async _sendCurrentData(): Promise<void> {\n        if (!this.streamName) return;\n\n        const power = this._getLatestValue('power');\n        const cadence = this._getLatestValue('cadence');\n        const heartrate = this._getLatestValue('heartrate');\n        const speed = this._getLatestValue('speed');\n        const distance = this._getLatestValue('distance');\n        const altitude = this._getLatestValue('altitude');\n        const incline = this._getLatestTreadmillIncline();\n\n        // Only send if we have at least one measurement\n        if (power === null && cadence === null && heartrate === null && speed === null && distance === null && altitude === null && incline === null) {\n            return;\n        }\n\n        const elapsedMs = this.timeState.running && this.timeState.startTime\n            ? Date.now() - this.timeState.startTime\n            : (this.timeState.endTime && this.timeState.startTime)\n                ? this.timeState.endTime - this.timeState.startTime\n                : 0;\n\n        await sendWorkoutData(this.streamName, {\n            timestamp: Date.now(),\n            elapsed: Math.floor(elapsedMs / 1000).toString(),\n            power,\n            cadence,\n            heartrate,\n            speed,\n            distance,\n            altitude,\n            incline\n        });\n    }\n\n    /**\n     * Get latest value for a measurement type\n     * @private\n     */\n    private _getLatestValue(type: Exclude<MeasurementType, 'gps'>): number | null {\n        // @ts-ignore - dynamic access\n        const array = this.measurementsState[type];\n        if (!Array.isArray(array) || array.length === 0) {\n            return null;\n        }\n\n        // Only send data newer than 5 seconds\n        const latest = array[array.length - 1];\n        if (Date.now() - latest.timestamp > 5000) {\n            return null;\n        }\n\n        return latest.value;\n    }\n\n    /**\n     * Get latest treadmill incline value\n     * @private\n     */\n    private _getLatestTreadmillIncline(): number | null {\n        const array = this.measurementsState.treadmill;\n        if (!Array.isArray(array) || array.length === 0) {\n            return null;\n        }\n\n        // Only send data newer than 5 seconds\n        const latest = array[array.length - 1];\n        if (Date.now() - latest.timestamp > 5000) {\n            return null;\n        }\n\n        return latest.incline;\n    }\n}\n","import { initConnectionButtons } from '../initConnectionButtons.js';\nimport { StreamManager } from '../stream-manager.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState, ConnectionsState } from '../getInitState.js';\n\ninterface HardwareInitParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n}\n\nexport function initHardware({ measurementsState, connectionsState, timeState }: HardwareInitParams) {\n    // Initialize Bluetooth connection buttons\n    initConnectionButtons({ connectionsState, measurementsState });\n\n    // Stream manager for live workout streaming\n    const streamManager = new StreamManager(measurementsState, timeState);\n\n    return { streamManager };\n}\n","/**\n * BPT Client - Main Entry Point\n *\n * Progressive Web App for tracking cycling workouts with Bluetooth sensors.\n *\n * This module initializes all application features:\n * - Bluetooth sensor connections (power, cadence, heart rate)\n * - Real-time metrics display\n * - Workout timer\n * - Data export (JSON, TCX, CSV)\n * - Live streaming\n * - PWA features (service worker, install prompt)\n *\n * @module main\n *\n * @description\n * The app uses a state-based architecture with three main state objects:\n * - measurementsState: Tracks workout data (power, cadence, HR measurements)\n * - connectionsState: Tracks Bluetooth connection status\n * - timeState: Tracks recording state and elapsed time\n *\n * @example\n * // State is initialized automatically on app load\n * // Access exposed state in tests:\n * window.measurementsState\n * window.connectionsState\n */\n\nimport './main.css';\n\n// Register Web Components (must be imported before they're used in DOM)\nimport './components/index.js';\n\nimport { getInitState } from './getInitState.js';\nimport { exposeVariablesDuringTest } from './exposeVariablesDuringTest.js';\nimport { setupRouter } from './init/router.js';\nimport { initUi } from './init/ui.js';\nimport { initHardware } from './init/hardware.js';\nimport './ui/navbar.css';\n\nconst initApp = (): void => {\n    try {\n        /**\n         * Initialize application state\n         */\n        const { measurementsState, connectionsState, timeState } = getInitState();\n\n        // Expose state for E2E testing\n        exposeVariablesDuringTest({ measurementsState, connectionsState });\n\n        // Initialize Hardware (Sensors & Streaming)\n        const { streamManager } = initHardware({ measurementsState, connectionsState, timeState });\n\n        // Initialize UI\n        initUi({ measurementsState, timeState, connectionsState, streamManager });\n\n        // Initialize Navigation Logic\n        const router = setupRouter();\n        router.start();\n\n        // Expose router to window for global access (navigation)\n        (window as any).router = router;\n    } catch (error: any) {\n        console.error('Failed to initialize app:', error);\n    }\n};\n\n// Initialize app when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp, { once: true });\n} else {\n    initApp();\n}\n\nconsole.log('Bike Power Tracker initialized');\n"],"file":"index-Bdq_nS1h.js"}