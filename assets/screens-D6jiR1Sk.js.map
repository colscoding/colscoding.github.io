{"version":3,"file":"screens-D6jiR1Sk.js","sources":["../../src/data-fields/screens.ts"],"sourcesContent":["/**\n * Data Screen Configuration Types\n * \n * Defines the structure for configurable data screens and activity profiles.\n * Users can create multiple screens with different data field layouts,\n * similar to Garmin/Wahoo bike computers.\n * \n * @module data-fields/screens\n */\n\nimport type {\n    DataFieldSize,\n    DataFieldSlot,\n    DataScreen,\n    ActivityProfile,\n    ScreenLayout,\n    ActivityType,\n} from './types.js';\n\n// Re-export types for backward compatibility\nexport type {\n    DataFieldSlot,\n    DataScreen,\n    ActivityProfile,\n    ScreenLayout,\n    ActivityType,\n};\n\n// ============================================================================\n// Data Field Settings\n// ============================================================================\n\n/**\n * Per-field preferences and alert settings\n */\nexport interface FieldPreferences {\n    /** Show this field in workout summary */\n    showInSummary: boolean;\n    /** Announce this field via voice */\n    voiceAnnounce: boolean;\n    /** Optional alert threshold value */\n    alertThreshold?: number;\n    /** Alert when value goes above or below threshold */\n    alertType?: 'above' | 'below';\n    /** Custom color override */\n    customColor?: string;\n}\n\n/**\n * Complete data field settings stored in user preferences\n */\nexport interface DataFieldSettings {\n    /** All activity profiles */\n    profiles: ActivityProfile[];\n    /** Currently active profile ID */\n    activeProfileId: string;\n    /** Unit system preference */\n    unitSystem: 'metric' | 'imperial';\n    /** Per-field preferences keyed by field ID */\n    fieldPreferences: Record<string, FieldPreferences>;\n    /** Schema version for migrations */\n    version: number;\n}\n\n// ============================================================================\n// Screen Utility Functions\n// ============================================================================\n\n/**\n * Generate a unique slot ID\n */\nexport function generateSlotId(): string {\n    return `slot-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Generate a unique screen ID\n */\nexport function generateScreenId(): string {\n    return `screen-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Generate a unique profile ID\n */\nexport function generateProfileId(): string {\n    return `profile-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Create an empty data screen with default settings\n */\nexport function createEmptyScreen(name: string, icon: string = 'ðŸ“Š'): DataScreen {\n    return {\n        id: generateScreenId(),\n        name,\n        icon,\n        layout: 'auto',\n        slots: [],\n    };\n}\n\n/**\n * Create a data field slot\n */\nexport function createSlot(\n    fieldId: string,\n    size: DataFieldSize = 'medium',\n    position: number = 1\n): DataFieldSlot {\n    return {\n        id: generateSlotId(),\n        fieldId,\n        size,\n        position,\n    };\n}\n\n/**\n * Create an empty activity profile\n */\nexport function createEmptyProfile(\n    name: string,\n    activityType: ActivityType,\n    icon: string = 'ðŸš´'\n): ActivityProfile {\n    return {\n        id: generateProfileId(),\n        name,\n        activityType,\n        icon,\n        screens: [createEmptyScreen('Main', 'ðŸ“Š')],\n        activeScreenIndex: 0,\n    };\n}\n\n/**\n * Add a slot to a screen\n */\nexport function addSlotToScreen(\n    screen: DataScreen,\n    fieldId: string,\n    size: DataFieldSize = 'medium'\n): DataScreen {\n    const position = screen.slots.length + 1;\n    return {\n        ...screen,\n        slots: [...screen.slots, createSlot(fieldId, size, position)],\n    };\n}\n\n/**\n * Remove a slot from a screen\n */\nexport function removeSlotFromScreen(\n    screen: DataScreen,\n    slotId: string\n): DataScreen {\n    const filteredSlots = screen.slots.filter(s => s.id !== slotId);\n    // Reorder positions\n    const reorderedSlots = filteredSlots.map((slot, index) => ({\n        ...slot,\n        position: index + 1,\n    }));\n    return {\n        ...screen,\n        slots: reorderedSlots,\n    };\n}\n\n/**\n * Update a slot's field or size\n */\nexport function updateSlot(\n    screen: DataScreen,\n    slotId: string,\n    updates: Partial<Pick<DataFieldSlot, 'fieldId' | 'size'>>\n): DataScreen {\n    return {\n        ...screen,\n        slots: screen.slots.map(slot =>\n            slot.id === slotId ? { ...slot, ...updates } : slot\n        ),\n    };\n}\n\n/**\n * Reorder slots in a screen\n */\nexport function reorderSlots(\n    screen: DataScreen,\n    slotIds: string[]\n): DataScreen {\n    const slotMap = new Map(screen.slots.map(s => [s.id, s]));\n    const reorderedSlots = slotIds\n        .map((id, index) => {\n            const slot = slotMap.get(id);\n            if (!slot) return null;\n            return { ...slot, position: index + 1 };\n        })\n        .filter((s): s is DataFieldSlot => s !== null);\n\n    return {\n        ...screen,\n        slots: reorderedSlots,\n    };\n}\n\n/**\n * Add a screen to a profile\n */\nexport function addScreenToProfile(\n    profile: ActivityProfile,\n    screen: DataScreen\n): ActivityProfile {\n    return {\n        ...profile,\n        screens: [...profile.screens, screen],\n    };\n}\n\n/**\n * Remove a screen from a profile\n */\nexport function removeScreenFromProfile(\n    profile: ActivityProfile,\n    screenId: string\n): ActivityProfile {\n    const filteredScreens = profile.screens.filter(s => s.id !== screenId);\n    // Ensure at least one screen exists\n    if (filteredScreens.length === 0) {\n        filteredScreens.push(createEmptyScreen('Main'));\n    }\n    // Adjust active index if needed\n    const activeIndex = Math.min(\n        profile.activeScreenIndex,\n        filteredScreens.length - 1\n    );\n    return {\n        ...profile,\n        screens: filteredScreens,\n        activeScreenIndex: activeIndex,\n    };\n}\n\n/**\n * Get the currently active screen from a profile\n */\nexport function getActiveScreen(profile: ActivityProfile): DataScreen {\n    return profile.screens[profile.activeScreenIndex] || profile.screens[0];\n}\n\n/**\n * Set the active screen index\n */\nexport function setActiveScreenIndex(\n    profile: ActivityProfile,\n    index: number\n): ActivityProfile {\n    const safeIndex = Math.max(0, Math.min(index, profile.screens.length - 1));\n    return {\n        ...profile,\n        activeScreenIndex: safeIndex,\n    };\n}\n\n/**\n * Navigate to next screen\n */\nexport function nextScreen(profile: ActivityProfile): ActivityProfile {\n    const nextIndex = (profile.activeScreenIndex + 1) % profile.screens.length;\n    return setActiveScreenIndex(profile, nextIndex);\n}\n\n/**\n * Navigate to previous screen\n */\nexport function previousScreen(profile: ActivityProfile): ActivityProfile {\n    const prevIndex = profile.activeScreenIndex === 0\n        ? profile.screens.length - 1\n        : profile.activeScreenIndex - 1;\n    return setActiveScreenIndex(profile, prevIndex);\n}\n\n// ============================================================================\n// Validation Functions\n// ============================================================================\n\n/**\n * Validate a data screen configuration\n */\nexport function validateScreen(screen: DataScreen): string[] {\n    const errors: string[] = [];\n\n    if (!screen.id) {\n        errors.push('Screen must have an ID');\n    }\n    if (!screen.name || screen.name.trim().length === 0) {\n        errors.push('Screen must have a name');\n    }\n    if (screen.slots.length === 0) {\n        errors.push('Screen must have at least one data field');\n    }\n    if (screen.slots.length > 12) {\n        errors.push('Screen cannot have more than 12 data fields');\n    }\n\n    // Check for duplicate slot IDs\n    const slotIds = screen.slots.map(s => s.id);\n    const uniqueIds = new Set(slotIds);\n    if (slotIds.length !== uniqueIds.size) {\n        errors.push('Screen has duplicate slot IDs');\n    }\n\n    return errors;\n}\n\n/**\n * Validate an activity profile\n */\nexport function validateProfile(profile: ActivityProfile): string[] {\n    const errors: string[] = [];\n\n    if (!profile.id) {\n        errors.push('Profile must have an ID');\n    }\n    if (!profile.name || profile.name.trim().length === 0) {\n        errors.push('Profile must have a name');\n    }\n    if (profile.screens.length === 0) {\n        errors.push('Profile must have at least one screen');\n    }\n    if (profile.screens.length > 10) {\n        errors.push('Profile cannot have more than 10 screens');\n    }\n    if (profile.activeScreenIndex < 0 || profile.activeScreenIndex >= profile.screens.length) {\n        errors.push('Invalid active screen index');\n    }\n\n    // Validate each screen\n    for (const screen of profile.screens) {\n        const screenErrors = validateScreen(screen);\n        errors.push(...screenErrors.map(e => `Screen \"${screen.name}\": ${e}`));\n    }\n\n    return errors;\n}\n"],"names":["generateSlotId","generateScreenId","createEmptyScreen","name","icon","createSlot","fieldId","size","position","addSlotToScreen","screen","removeSlotFromScreen","slotId","reorderedSlots","s","slot","index","updateSlot","updates","reorderSlots","slotIds","slotMap","id"],"mappings":"AAuEO,SAASA,GAAyB,CACrC,MAAO,QAAQ,KAAK,IAAA,CAAK,IAAI,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,EACvE,CAKO,SAASC,GAA2B,CACvC,MAAO,UAAU,KAAK,IAAA,CAAK,IAAI,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,MAAM,EAAG,CAAC,CAAC,EACzE,CAYO,SAASC,EAAkBC,EAAcC,EAAe,KAAkB,CAC7E,MAAO,CACH,GAAIH,EAAA,EACJ,KAAAE,EACA,KAAAC,EACA,OAAQ,OACR,MAAO,CAAA,CAAC,CAEhB,CAKO,SAASC,EACZC,EACAC,EAAsB,SACtBC,EAAmB,EACN,CACb,MAAO,CACH,GAAIR,EAAA,EACJ,QAAAM,EACA,KAAAC,EACA,SAAAC,CAAA,CAER,CAuBO,SAASC,EACZC,EACAJ,EACAC,EAAsB,SACZ,CACV,MAAMC,EAAWE,EAAO,MAAM,OAAS,EACvC,MAAO,CACH,GAAGA,EACH,MAAO,CAAC,GAAGA,EAAO,MAAOL,EAAWC,EAASC,EAAMC,CAAQ,CAAC,CAAA,CAEpE,CAKO,SAASG,EACZD,EACAE,EACU,CAGV,MAAMC,EAFgBH,EAAO,MAAM,OAAOI,GAAKA,EAAE,KAAOF,CAAM,EAEzB,IAAI,CAACG,EAAMC,KAAW,CACvD,GAAGD,EACH,SAAUC,EAAQ,CAAA,EACpB,EACF,MAAO,CACH,GAAGN,EACH,MAAOG,CAAA,CAEf,CAKO,SAASI,EACZP,EACAE,EACAM,EACU,CACV,MAAO,CACH,GAAGR,EACH,MAAOA,EAAO,MAAM,IAAIK,GACpBA,EAAK,KAAOH,EAAS,CAAE,GAAGG,EAAM,GAAGG,GAAYH,CAAA,CACnD,CAER,CAKO,SAASI,EACZT,EACAU,EACU,CACV,MAAMC,EAAU,IAAI,IAAIX,EAAO,MAAM,IAAII,GAAK,CAACA,EAAE,GAAIA,CAAC,CAAC,CAAC,EAClDD,EAAiBO,EAClB,IAAI,CAACE,EAAIN,IAAU,CAChB,MAAMD,EAAOM,EAAQ,IAAIC,CAAE,EAC3B,OAAKP,EACE,CAAE,GAAGA,EAAM,SAAUC,EAAQ,CAAA,EADlB,IAEtB,CAAC,EACA,OAAQF,GAA0BA,IAAM,IAAI,EAEjD,MAAO,CACH,GAAGJ,EACH,MAAOG,CAAA,CAEf"}