import{t as lt,u as ut,v as Je,w as gt,x as Ae,y as je,z as mt,A as ft,b as et,E as pt,g as ht,d as vt,e as yt,f as bt}from"./index-WoRBJzVU.js";import{p as B,q as L,u as We,s as Qe,g as _e,v as g,w as be,x as Se,y as Te,z as Xe,A as Ie,D as St}from"./feature-bluetooth-VMdsGD3M.js";import{a as It,b as Et,u as kt}from"./screens-D6jiR1Sk.js";import"./vendor-core-Dob3nYDb.js";import"./feature-export-7zlEGvkQ.js";import"./vendor-leaflet-3-yx3GaH.js";function wt(t,n){let o=null;return(...c)=>{o&&clearTimeout(o),o=setTimeout(()=>{t(...c)},n)}}function Ge(t){return[{name:"Active Recovery",min:0,max:Math.round(t*.55),color:"#808080"},{name:"Endurance",min:Math.round(t*.55),max:Math.round(t*.75),color:"#2196f3"},{name:"Tempo",min:Math.round(t*.75),max:Math.round(t*.9),color:"#4caf50"},{name:"Threshold",min:Math.round(t*.9),max:Math.round(t*1.05),color:"#ffeb3b"},{name:"VO2max",min:Math.round(t*1.05),max:Math.round(t*1.2),color:"#ff9800"},{name:"Anaerobic",min:Math.round(t*1.2),max:Math.round(t*1.5),color:"#f44336"},{name:"Neuromuscular",min:Math.round(t*1.5),max:9999,color:"#9c27b0"}]}function xt(t){return[{name:"Recovery",min:0,max:Math.round(t*.6),color:"#808080"},{name:"Endurance",min:Math.round(t*.6),max:Math.round(t*.8),color:"#2196f3"},{name:"Tempo",min:Math.round(t*.8),max:Math.round(t*.95),color:"#4caf50"},{name:"Threshold",min:Math.round(t*.95),max:Math.round(t*1.05),color:"#ff9800"},{name:"VO2max",min:Math.round(t*1.05),max:9999,color:"#f44336"}]}function Mt(t){return[{name:"Endurance",min:0,max:Math.round(t*.75),color:"#2196f3"},{name:"Threshold",min:Math.round(t*.75),max:Math.round(t*1.05),color:"#ff9800"},{name:"High Intensity",min:Math.round(t*1.05),max:9999,color:"#f44336"}]}function Bt(t,n){switch(n){case"3":return Mt(t);case"5":return xt(t);case"7":return Ge(t);default:return Ge(t)}}function Lt(){const t=document.getElementById("saveSettings"),n=document.getElementById("settingFtp"),o=document.getElementById("settingPowerZoneModel"),c=document.getElementById("settingMaxHr"),d=document.getElementById("settingWeight"),i=document.getElementById("settingSpeed"),l=document.getElementById("settingDistance"),a=document.getElementById("settingAltitude"),u=document.getElementById("settingShowCalories"),K=document.getElementById("settingPower"),Z=document.getElementById("settingCadence"),J=document.getElementById("settingHeartrate"),j=document.getElementById("settingTreadmillSpeed"),W=document.getElementById("settingPower3s"),Q=document.getElementById("settingHighContrast"),_=document.getElementById("settingColorblindPatterns"),X=document.getElementById("settingVoiceEnabled"),G=document.getElementById("settingVoiceLaps"),Y=document.getElementById("settingVoiceZones"),y=document.getElementById("settingAutoPauseEnabled"),E=document.getElementById("settingAutoPauseSource"),V=document.getElementById("settingAutoPauseThreshold"),F=document.getElementById("settingAutoPauseDelay"),ke=document.getElementById("autoPauseOptions"),$e=document.getElementById("autoPauseThresholdUnit"),ee=document.getElementById("settingExportTcx"),te=document.getElementById("settingExportCsv"),ne=document.getElementById("settingExportJson"),oe=document.getElementById("settingExportFit"),ce=document.getElementById("settingPromptForNotes"),se=document.getElementById("settingPromptForExertion"),$=document.getElementById("settingCountdownDuration"),ie=document.getElementById("settingCountdownBeep"),ae=document.getElementById("settingCountdownVoice"),b=document.getElementById("settingAutoLapEnabled"),k=document.getElementById("settingAutoLapSource"),p=document.getElementById("settingAutoLapDistance"),D=document.getElementById("settingAutoLapTime"),we=document.getElementById("autoLapOptions"),De=document.getElementById("autoLapDistanceOption"),Ue=document.getElementById("autoLapTimeOption"),w=document.getElementById("settingVoiceSelection"),U=document.getElementById("settingVoiceTimeInterval"),H=document.getElementById("settingVoiceDistanceInterval"),N=document.getElementById("settingVoiceSpeechRate"),de=document.getElementById("settingVoiceMetricPower"),re=document.getElementById("settingVoiceMetricHeartrate"),le=document.getElementById("settingVoiceMetricCadence"),S=document.getElementById("settingVoiceMetricSpeed"),ue=document.getElementById("settingVoiceMetricDistance"),ge=document.getElementById("settingVoiceMetricTime"),I=document.getElementById("settingVoiceMetricPace"),P=document.getElementById("settingVoiceTargetFeedback"),me=document.getElementById("settingVoiceTemplate"),xe=document.getElementById("settingSmartAnnouncements"),h=document.getElementById("settingSportType"),O=document.getElementById("settingShowPace"),q=document.getElementById("settingThresholdPace"),He=document.getElementById("runningOptions"),x=document.getElementById("settingIntervalsEnabled"),M=document.getElementById("settingIntervalsApiKey"),Me=document.getElementById("toggleIntervalsApiKey"),fe=document.getElementById("settingIntervalsAthleteId"),pe=document.getElementById("settingIntervalsAutoUpload"),Ne=document.getElementById("intervalsOptions"),he=document.getElementById("settingDebugMode"),Oe=document.getElementById("debugControls"),nt=document.getElementById("downloadDebugLogs"),ot=document.getElementById("clearDebugLogs"),ve=document.getElementById("settingMockSensors"),ct=document.getElementById("installPwaButton"),qe=()=>{Ne&&x&&(Ne.style.display=x.checked?"flex":"none")},Re=()=>{if(He&&h){const e=h.value==="running"||h.value==="walking";He.style.display=e?"block":"none"}},st=e=>{const r=e.match(/^(\d{1,2}):([0-5]\d)$/);if(!r)return null;const v=parseInt(r[1],10),f=parseInt(r[2],10);return v*60+f},it=()=>{const e=je();if(h&&(e.activeSport=h.value),O!==null&&(e.running.showPace=O.checked),q?.value){const r=st(q.value);r!==null&&(e.running.targetPaceMin=r-30,e.running.targetPaceMax=r+30)}mt(e)};let Be="cycling";const at=()=>{const e=je();if(h&&(h.value=e.activeSport,Be=e.activeSport),O&&(O.checked=e.running.showPace),q){const r=Math.round((e.running.targetPaceMin+e.running.targetPaceMax)/2);q.value=ft(r)}Re()};h?.addEventListener("change",()=>{Re();const e=h?.value;p&&(e==="running"||e==="walking"?(p.value==="5"||p.value==="10")&&(p.value="1"):e==="cycling"&&(p.value==="1"||p.value==="0.4")&&(p.value="5"))}),Me?.addEventListener("click",()=>{if(M){const e=M.type==="password";M.type=e?"text":"password",Me&&(Me.textContent=e?"üôà":"üëÅÔ∏è")}}),x?.addEventListener("change",qe);const Le=()=>{if(ke&&y&&(ke.style.opacity=y.checked?"1":"0.5",ke.style.pointerEvents=y.checked?"auto":"none"),$e&&E){const e=ut(E.value);$e.textContent=e}};y?.addEventListener("change",Le),E?.addEventListener("change",Le);const Ce=()=>{if(we&&b&&(we.style.opacity=b.checked?"1":"0.5",we.style.pointerEvents=b.checked?"auto":"none"),De&&Ue&&k){const e=k.value==="distance";De.style.display=e?"flex":"none",Ue.style.display=e?"none":"flex"}};b?.addEventListener("change",Ce),k?.addEventListener("change",Ce);const ze=e=>{Ae.reloadVoice();const r=(f,A)=>{document.querySelectorAll(`.metric-group-${f}`).forEach(R=>{R.style.display=A?"flex":"none"})};r("speed",e.speed),r("distance",e.distance),r("altitude",e.altitude),r("energy",e.showCalories),r("power",e.power),r("cadence",e.cadence),r("heartrate",e.heartrate),r("treadmillSpeed",e.treadmillSpeed),document.querySelectorAll(".metric-group-power").forEach(f=>{e.power3s?f.setAttribute("data-show-avg","true"):f.removeAttribute("data-show-avg")}),e.highContrast?document.documentElement.setAttribute("data-high-contrast","true"):document.documentElement.removeAttribute("data-high-contrast"),e.colorblindPatterns?document.documentElement.setAttribute("data-colorblind-patterns","true"):document.documentElement.removeAttribute("data-colorblind-patterns"),Oe&&(Oe.style.display=e.debugMode?"flex":"none")},Ke=()=>({timeIntervalMinutes:U?.value?parseInt(U.value):B.timeIntervalMinutes,distanceIntervalKm:H?.value?parseInt(H.value):B.distanceIntervalKm,metrics:{power:de?.checked??L.power,heartrate:re?.checked??L.heartrate,cadence:le?.checked??L.cadence,speed:S?.checked??L.speed,distance:ue?.checked??L.distance,time:ge?.checked??L.time,pace:I?.checked??L.pace},speechRate:N?.value?parseFloat(N.value):B.speechRate,voiceURI:w?.value||B.voiceURI,workoutTargetFeedback:P?.checked??B.workoutTargetFeedback,smartAnnouncements:xe?.checked??B.smartAnnouncements,announcementTemplate:me?.value||B.announcementTemplate}),Ze=e=>{U&&(U.value=e.timeIntervalMinutes.toString()),H&&(H.value=e.distanceIntervalKm.toString()),N&&(N.value=e.speechRate.toString()),de&&(de.checked=e.metrics.power),re&&(re.checked=e.metrics.heartrate),le&&(le.checked=e.metrics.cadence),S&&(S.checked=e.metrics.speed),ue&&(ue.checked=e.metrics.distance),ge&&(ge.checked=e.metrics.time),I&&(I.checked=e.metrics.pace),w&&e.voiceURI&&(w.value=e.voiceURI),P&&(P.checked=e.workoutTargetFeedback),xe&&(xe.checked=e.smartAnnouncements),me&&(me.value=e.announcementTemplate||"")},Pe=()=>{const r={...Je(),ftp:n?.value?Number(n.value):null,maxHr:c?.value?Number(c.value):null,weight:d?.value?Number(d.value):null};gt(r),window.dispatchEvent(new CustomEvent("user-profile-changed"));const v=o?.value||"7";Qe.setMultiple({ftp:r.ftp??200,maxHeartrate:r.maxHr??190,weight:r.weight??75,powerZoneModel:v,powerZones:Bt(100,v)});const f={speed:i?.checked??g.speed,distance:l?.checked??g.distance,altitude:a?.checked??g.altitude,weightKg:d?.value?Number(d.value):g.weightKg,showCalories:u?.checked??g.showCalories,power:K?.checked??g.power,cadence:Z?.checked??g.cadence,heartrate:J?.checked??g.heartrate,treadmillSpeed:j?.checked??g.treadmillSpeed,power3s:W?.checked??g.power3s,highContrast:Q?.checked??g.highContrast,colorblindPatterns:_?.checked??g.colorblindPatterns,voiceEnabled:X?.checked??g.voiceEnabled,voiceLaps:G?.checked??g.voiceLaps,voiceZones:Y?.checked??g.voiceZones,autoPause:{enabled:y?.checked??Ie.enabled,source:E?.value??Ie.source,threshold:V?.value?Number(V.value):Ie.threshold,delay:F?.value?Number(F.value):Ie.delay},workoutMetadata:{promptForNotes:ce?.checked??Xe.promptForNotes,promptForExertion:se?.checked??Xe.promptForExertion},countdown:{duration:$?.value?parseInt($.value):Te.duration,enableBeep:ie?.checked??Te.enableBeep,enableVoice:ae?.checked??Te.enableVoice},autoLap:{enabled:b?.checked??Se.enabled,source:k?.value??Se.source,distanceKm:p?.value?Number(p.value):Se.distanceKm,timeMinutes:D?.value?Number(D.value):Se.timeMinutes},enhancedVoice:Ke(),intervals:{enabled:x?.checked??be.enabled,apiKey:M?.value??be.apiKey,athleteId:fe?.value??be.athleteId,autoUpload:pe?.checked??be.autoUpload},exportTcx:ee?.checked??g.exportTcx,exportCsv:te?.checked??g.exportCsv,exportJson:ne?.checked??g.exportJson,exportFit:oe?.checked??g.exportFit,debugMode:he?.checked??g.debugMode,mockSensors:ve?.checked??g.mockSensors,wheelCircumferenceMm:_e().wheelCircumferenceMm};window.useMockSensors=f.mockSensors,St(f),it(),ze(f)},dt=()=>{const e=_e(),r=Je();n&&(n.value=r.ftp?.toString()??""),c&&(c.value=r.maxHr?.toString()??""),d&&(d.value=r.weight?.toString()??"");const v=Qe.getAll();if(o&&(o.value=v.powerZoneModel||"7"),K&&(K.checked=e.power),Z&&(Z.checked=e.cadence),J&&(J.checked=e.heartrate),i&&(i.checked=e.speed),l&&(l.checked=e.distance),a&&(a.checked=e.altitude),u&&(u.checked=e.showCalories),j&&(j.checked=e.treadmillSpeed),W&&(W.checked=e.power3s),Q&&(Q.checked=e.highContrast),_&&(_.checked=e.colorblindPatterns),X&&(X.checked=e.voiceEnabled),G&&(G.checked=e.voiceLaps),Y&&(Y.checked=e.voiceZones),w){const f=()=>{const A=Ae.getAvailableVoices();w.innerHTML='<option value="">Default System Voice</option>',A.forEach(ye=>{const R=document.createElement("option");R.value=ye.voiceURI,R.textContent=`${ye.name} (${ye.lang})`,w.appendChild(R)}),e.enhancedVoice.voiceURI&&(w.value=e.enhancedVoice.voiceURI)};f(),Ae.getAvailableVoices().length===0&&(setTimeout(f,500),setTimeout(f,2e3))}y&&(y.checked=e.autoPause.enabled),E&&(E.value=e.autoPause.source),V&&(V.value=e.autoPause.threshold.toString()),F&&(F.value=e.autoPause.delay.toString()),Le(),ee&&(ee.checked=e.exportTcx),te&&(te.checked=e.exportCsv),ne&&(ne.checked=e.exportJson),oe&&(oe.checked=e.exportFit),ce&&(ce.checked=e.workoutMetadata.promptForNotes),se&&(se.checked=e.workoutMetadata.promptForExertion),$&&($.value=e.countdown.duration.toString()),ie&&(ie.checked=e.countdown.enableBeep),ae&&(ae.checked=e.countdown.enableVoice),b&&(b.checked=e.autoLap.enabled),k&&(k.value=e.autoLap.source),p&&(p.value=e.autoLap.distanceKm.toString()),D&&(D.value=e.autoLap.timeMinutes.toString()),Ce(),Ze(e.enhancedVoice),x&&(x.checked=e.intervals.enabled),M&&(M.value=e.intervals.apiKey),fe&&(fe.value=e.intervals.athleteId),pe&&(pe.checked=e.intervals.autoUpload),qe(),he&&(he.checked=e.debugMode),ve&&(ve.checked=e.mockSensors),window.useMockSensors=e.mockSensors,at(),ze(e)},rt=wt(()=>Pe(),500),s=(e,r="change")=>{e&&(r==="input"?e.addEventListener("input",rt):e.addEventListener("change",()=>Pe()))};s(n,"input"),s(o),s(c,"input"),s(d,"input"),[i,l,a,u,K,Z,J,j,W].forEach(e=>s(e)),s(Q),s(_),s(X),s(G),s(Y),s(y),s(E),s(V,"input"),s(F,"input"),[ee,te,ne,oe].forEach(e=>s(e)),s(ce),s(se),s($),s(ie),s(ae),s(b),s(k),s(p),s(D),s(U),s(H),s(N),[de,re,le,S,ue,ge,I,P].forEach(e=>s(e)),s(me,"input"),h&&h.addEventListener("change",()=>{const e=h.value,r=Ke(),v=localStorage.getItem("voice_presets"),f=v?JSON.parse(v):{};f[Be]=r,localStorage.setItem("voice_presets",JSON.stringify(f));const A=f[e];A?Ze(A):(e==="running"||e==="walking"?(I&&(I.checked=!0),S&&(S.checked=!1)):(I&&(I.checked=!1),S&&(S.checked=!0)),P&&(P.checked=!1)),Be=e,Pe()}),s(O),s(q,"input"),s(x),s(M,"input"),s(fe,"input"),s(pe),s(he),s(ve),t&&(t.textContent="Close Settings",t.className="close-settings-btn",t.style.background="#6c757d",t.addEventListener("click",()=>{window.router?window.router.navigate("/"):window.history.back()})),nt?.addEventListener("click",()=>{We.exportLogs()}),ot?.addEventListener("click",async()=>{confirm("Are you sure you want to clear all debug logs?")&&(await We.clearLogs(),alert("Logs cleared."))}),ct?.addEventListener("click",async()=>{const e=await lt();e==="accepted"?console.log("PWA installation accepted"):e==="dismissed"?console.log("PWA installation dismissed"):alert("Installation is not available at this time. The app may already be installed or your browser does not support installation.")}),dt()}let m={profile:et(),selectedScreenIndex:0,isEditing:!1,searchQuery:"",selectedCategory:"all"};const Ve=new Set;function Ct(t){return Ve.add(t),()=>Ve.delete(t)}function tt(){Ve.forEach(t=>t())}function T(t){m={...m,...t},tt()}function Pt(){const t=et();T({profile:t,selectedScreenIndex:Math.min(m.selectedScreenIndex,t.screens.length-1)})}function At(){const t=pt(m.profile);return t&&document.dispatchEvent(new CustomEvent("data-fields-profile-changed",{detail:{profile:m.profile}})),t}function C(){return m.profile.screens[m.selectedScreenIndex]??null}function Tt(t,n="medium"){const o=C();if(!o)return;const c=It(o,t,n);z(c)}function Vt(t){const n=C();if(!n)return;const o=Et(n,t);z(o)}function Ft(t,n){const o=C();if(!o)return;const c=kt(o,t,n);z(c)}function $t(t){const n=C();if(!n)return;const o={...n,layout:t};z(o)}function z(t){const n=[...m.profile.screens];n[m.selectedScreenIndex]=t,T({profile:{...m.profile,screens:n}})}function Dt(t,n){const o=C();if(!o)return;const c=[...o.slots],[d]=c.splice(t,1);c.splice(n,0,d);const i=c.map((l,a)=>({...l,position:a}));z({...o,slots:i})}function Ut(){let t;if(m.searchQuery.trim())t=vt(m.searchQuery);else if(m.selectedCategory==="all"){const n=yt();t=Array.from(n.values()).flat()}else t=bt(m.selectedCategory);return t}const Ht={all:"üìä",power:"‚ö°",heartrate:"‚ù§Ô∏è",cadence:"üîÑ",speed:"üö¥",distance:"üìç",elevation:"‚õ∞Ô∏è",time:"‚è±Ô∏è",laps:"üèÅ",energy:"üî•",environment:"üå°Ô∏è",device:"üîã",charts:"üìà",map:"üó∫Ô∏è"};function Nt(t){t.innerHTML=`
        <div class="data-fields-config">
            <div class="dfc-header">
                <h3>üìä Data Fields</h3>
                <p class="dfc-help-text">Configure which metrics appear on your dashboard screens.</p>
            </div>
            
            <div class="dfc-screens">
                <div class="dfc-screens-tabs" role="tablist"></div>
            </div>
            
            <div class="dfc-current-screen">
                <div class="dfc-screen-header">
                    <span class="dfc-screen-name"></span>
                    <select class="dfc-layout-select" aria-label="Screen layout">
                        <option value="auto">Auto Layout</option>
                        <option value="grid-2">2 Columns</option>
                        <option value="grid-3">3 Columns</option>
                        <option value="grid-4">4 Columns</option>
                        <option value="list">List</option>
                    </select>
                </div>
                <div class="dfc-fields-list" role="list" aria-label="Current screen fields"></div>
                <button class="dfc-add-field-btn" type="button">
                    <span>+</span> Add Field
                </button>
            </div>
            
            <div class="dfc-field-picker" style="display: none;">
                <div class="dfc-picker-header">
                    <h4>Select a Field</h4>
                    <button class="dfc-picker-close" type="button" aria-label="Close field picker">&times;</button>
                </div>
                <input type="search" class="dfc-search" placeholder="Search fields..." aria-label="Search data fields">
                <div class="dfc-categories" role="tablist"></div>
                <div class="dfc-available-fields" role="listbox" aria-label="Available fields"></div>
            </div>
            
            <div class="dfc-actions">
                <button class="dfc-save-btn" type="button">Save Changes</button>
                <button class="dfc-reset-btn" type="button">Reset to Defaults</button>
            </div>
        </div>
    `,zt(t),Ye(t),Ct(()=>Ye(t))}function Ye(t){Ot(t),qt(t),Rt(t)}function Ot(t){const n=t.querySelector(".dfc-screens-tabs");n&&(n.innerHTML=m.profile.screens.map((o,c)=>`
            <button 
                class="dfc-screen-tab ${c===m.selectedScreenIndex?"dfc-screen-tab--active":""}"
                data-screen-index="${c}"
                role="tab"
                aria-selected="${c===m.selectedScreenIndex}"
                aria-label="${o.name} screen"
            >
                <span class="dfc-tab-icon">${o.icon}</span>
                <span class="dfc-tab-name">${Ee(o.name)}</span>
            </button>
        `).join(""))}function qt(t){const n=C(),o=t.querySelector(".dfc-screen-name"),c=t.querySelector(".dfc-layout-select"),d=t.querySelector(".dfc-fields-list");if(!(!n||!o||!d||!c)){if(o.textContent=`${n.icon} ${n.name}`,c.value=n.layout,n.slots.length===0){d.innerHTML=`
            <div class="dfc-empty-screen">
                <p>No fields on this screen</p>
                <p class="dfc-empty-hint">Click "Add Field" to add metrics</p>
            </div>
        `;return}d.innerHTML=n.slots.sort((i,l)=>i.position-l.position).map(i=>{const l=ht(i.fieldId),a=l?.name??"Unknown",u=l?.icon??"‚ùì";return`
                <div class="dfc-field-item" data-slot-id="${i.id}" role="listitem" draggable="true">
                    <span class="dfc-field-drag" title="Drag to reorder">‚ãÆ‚ãÆ</span>
                    <span class="dfc-field-icon">${u}</span>
                    <div class="dfc-field-info">
                        <span class="dfc-field-name">${Ee(a)}</span>
                        <span class="dfc-field-id">${i.fieldId}</span>
                    </div>
                    <select class="dfc-field-size" data-slot-id="${i.id}" aria-label="Field size">
                        <option value="small" ${i.size==="small"?"selected":""}>Small</option>
                        <option value="medium" ${i.size==="medium"?"selected":""}>Medium</option>
                        <option value="large" ${i.size==="large"?"selected":""}>Large</option>
                        <option value="wide" ${i.size==="wide"?"selected":""}>Wide</option>
                        <option value="tall" ${i.size==="tall"?"selected":""}>Tall</option>
                        <option value="full" ${i.size==="full"?"selected":""}>Full</option>
                        <option value="xlarge" ${i.size==="xlarge"?"selected":""}>Extra Large</option>
                        <option value="xxlarge" ${i.size==="xxlarge"?"selected":""}>XX-Large</option>
                        <option value="jumbo" ${i.size==="jumbo"?"selected":""}>Jumbo</option>
                    </select>
                    <button class="dfc-field-remove" data-slot-id="${i.id}" aria-label="Remove ${a}" title="Remove">
                        üóëÔ∏è
                    </button>
                </div>
            `}).join("")}}function Rt(t){const n=t.querySelector(".dfc-categories"),o=t.querySelector(".dfc-available-fields");if(!n||!o)return;const c=["all","power","heartrate","cadence","speed","distance","elevation","time"];n.innerHTML=c.map(a=>`
            <button 
                class="dfc-category-btn ${a===m.selectedCategory?"dfc-category-btn--active":""}"
                data-category="${a}"
                role="tab"
                aria-selected="${a===m.selectedCategory}"
            >
                <span>${Ht[a]}</span>
                <span>${a==="all"?"All":a.charAt(0).toUpperCase()+a.slice(1)}</span>
            </button>
        `).join("");const d=Ut(),i=C(),l=new Set(i?.slots.map(a=>a.fieldId)??[]);o.innerHTML=d.map(a=>{const u=l.has(a.id);return`
                <button 
                    class="dfc-available-field ${u?"dfc-available-field--used":""}"
                    data-field-id="${a.id}"
                    role="option"
                    aria-selected="false"
                    ${u?"disabled":""}
                >
                    <span class="dfc-af-icon">${a.icon}</span>
                    <div class="dfc-af-info">
                        <span class="dfc-af-name">${Ee(a.name)}</span>
                        <span class="dfc-af-desc">${Ee(a.description)}</span>
                    </div>
                    ${u?'<span class="dfc-af-badge">Added</span>':""}
                </button>
            `}).join("")}function zt(t){t.addEventListener("click",o=>{const c=o.target,d=c.closest(".dfc-screen-tab");if(d){const u=parseInt(d.dataset.screenIndex??"0",10);T({selectedScreenIndex:u});return}if(c.closest(".dfc-add-field-btn")){Zt(t);return}if(c.closest(".dfc-picker-close")){Jt(t);return}const i=c.closest(".dfc-category-btn");if(i){const u=i.dataset.category;T({selectedCategory:u});return}const l=c.closest(".dfc-available-field");if(l&&!l.hasAttribute("disabled")){const u=l.dataset.fieldId;u&&(Tt(u),tt());return}const a=c.closest(".dfc-field-remove");if(a){const u=a.dataset.slotId;u&&Vt(u);return}if(c.closest(".dfc-save-btn")){At()?Fe("Settings saved!","success"):Fe("Failed to save settings","error");return}if(c.closest(".dfc-reset-btn")){confirm("Reset data fields to defaults? This cannot be undone.")&&jt();return}}),t.addEventListener("change",o=>{const c=o.target;if(c.classList.contains("dfc-layout-select")){$t(c.value);return}if(c.classList.contains("dfc-field-size")){const d=c.dataset.slotId;d&&Ft(d,{size:c.value});return}});const n=t.querySelector(".dfc-search");n&&n.addEventListener("input",o=>{const c=o.target;T({searchQuery:c.value})}),Kt(t)}function Kt(t){const n=t.querySelector(".dfc-fields-list");if(!n)return;let o=null,c=-1;n.addEventListener("dragstart",d=>{o=d.target.closest(".dfc-field-item"),o&&(c=Array.from(n.children).indexOf(o),o.classList.add("dfc-field-item--dragging"))}),n.addEventListener("dragend",()=>{o&&o.classList.remove("dfc-field-item--dragging"),o=null,c=-1}),n.addEventListener("dragover",d=>{d.preventDefault();const l=d.target.closest(".dfc-field-item");l&&l!==o&&Array.from(n.querySelectorAll(".dfc-field-item:not(.dfc-field-item--dragging)")).indexOf(l)!==-1&&l.classList.add("dfc-field-item--drag-over")}),n.addEventListener("dragleave",d=>{const l=d.target.closest(".dfc-field-item");l&&l.classList.remove("dfc-field-item--drag-over")}),n.addEventListener("drop",d=>{d.preventDefault();const l=d.target.closest(".dfc-field-item");if(n.querySelectorAll(".dfc-field-item--drag-over").forEach(a=>{a.classList.remove("dfc-field-item--drag-over")}),l&&o&&l!==o){const u=Array.from(n.querySelectorAll(".dfc-field-item")).indexOf(l);c!==-1&&u!==-1&&c!==u&&Dt(c,u)}})}function Zt(t){const n=t.querySelector(".dfc-field-picker");if(n){n.style.display="block";const o=n.querySelector(".dfc-search");o&&o.focus()}}function Jt(t){const n=t.querySelector(".dfc-field-picker");n&&(n.style.display="none",T({searchQuery:"",selectedCategory:"all"}))}function jt(){localStorage.removeItem("bpt-data-fields"),Pt(),Fe("Data fields reset to defaults","info")}function Fe(t,n){const o=new CustomEvent("show-notification",{detail:{message:t,type:n}});document.dispatchEvent(o),console.log(`[DataFieldsConfig] ${n}: ${t}`)}function Ee(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function Wt(){const t=document.querySelector("#page-settings .page-content");if(!t){console.warn("[DataFieldsConfig] Settings page content not found");return}if(t.querySelector(".data-fields-config"))return;const n=document.createElement("fieldset");n.className="settings-fieldset",n.style.cssText="border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;",n.innerHTML='<legend style="font-weight: 600; padding: 0 8px;">üìä Data Fields Configuration</legend>';const o=t.querySelector("fieldset:nth-child(4)");o&&o.nextSibling?t.insertBefore(n,o.nextSibling):t.appendChild(n),Nt(n),console.log("[DataFieldsConfig] Initialized")}class tn{id="settings";init(n){const o=document.getElementById("settingsTemplate");if(o){const c=o.content.cloneNode(!0);n.appendChild(c),setTimeout(()=>{Lt(),Wt()},0)}else console.error("Settings template not found!"),n.innerHTML="<p>Error loading settings view</p>"}onEnter(){console.log("Entered Settings View")}onLeave(){console.log("Left Settings View")}}export{tn as SettingsView};
//# sourceMappingURL=SettingsView-Bhh1NdAB.js.map
