{"version":3,"file":"DebugView-DEcIAOy3.js","sources":["../../src/views/DebugView.ts"],"sourcesContent":["import { View } from '../router/View.js';\nimport { BluetoothFactory } from '../services/bluetooth/factory.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { ViewId } from '../router/view-ids.js';\n\nexport class DebugView implements View {\n    public id = ViewId.Debug;\n    private logArea: HTMLTextAreaElement | null = null;\n    private boundOnLog = this.onLog.bind(this);\n    private logBuffer: Array<{ timestamp: string; sensor: string; data: string }> = [];\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('debugTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n            this.setupEvents(container);\n        } else {\n            console.error('Debug template not found');\n            container.innerHTML = '<p>Error loading debug view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        BluetoothDebugService.addListener(this.boundOnLog);\n    }\n\n    public onLeave(): void {\n        BluetoothDebugService.removeListener(this.boundOnLog);\n    }\n\n    private onLog(sensor: string, hex: string) {\n        const timestamp = new Date().toISOString();\n        this.logBuffer.push({ timestamp, sensor, data: hex });\n\n        if (this.logArea) {\n            const timeDisplay = timestamp.split('T')[1].slice(0, -1);\n            this.logArea.value += `[${timeDisplay}] ${sensor}: ${hex}\\n`;\n            this.logArea.scrollTop = this.logArea.scrollHeight;\n        }\n    }\n\n    private setupEvents(container: HTMLElement): void {\n        this.logArea = container.querySelector('#debugLog');\n\n        const btnTreadmill = container.querySelector('#connectTreadmillDebug');\n        const btnRower = container.querySelector('#connectRowerDebug');\n        const btnConcept2 = container.querySelector('#connectConcept2Debug');\n        const btnDownload = container.querySelector('#downloadLogs');\n\n        btnTreadmill?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Treadmill...');\n                await BluetoothFactory.connectTreadmill();\n                this.log('System', 'Connected to Treadmill');\n            } catch (e) {\n                this.log('System', `Treadmill connection failed: ${e}`);\n            }\n        });\n\n        btnRower?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Rower...');\n                await BluetoothFactory.connectRowing();\n                this.log('System', 'Connected to Rower');\n            } catch (e) {\n                this.log('System', `Rower connection failed: ${e}`);\n            }\n        });\n\n        btnConcept2?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Concept2...');\n                await BluetoothFactory.connectConcept2();\n                this.log('System', 'Connected to Concept2');\n            } catch (e) {\n                this.log('System', `Concept2 connection failed: ${e}`);\n            }\n        });\n\n        btnDownload?.addEventListener('click', () => {\n            this.downloadLocalLogs();\n        });\n    }\n\n    private downloadLocalLogs() {\n        const blob = new Blob([JSON.stringify(this.logBuffer, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `bpt-debug-session-${Date.now()}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n\n    private log(source: string, message: string) {\n        if (this.logArea) {\n            const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);\n            this.logArea.value += `[${timestamp}] ${source}: ${message}\\n`;\n            this.logArea.scrollTop = this.logArea.scrollHeight;\n        }\n    }\n}\n"],"names":["DebugView","ViewId","container","template","content","BluetoothDebugService","sensor","hex","timestamp","timeDisplay","btnTreadmill","btnRower","btnConcept2","btnDownload","BluetoothFactory","e","blob","url","a","source","message"],"mappings":"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"}