{"version":3,"file":"DataFieldComponent-Dcvj5OLm.js","sources":["../../src/data-fields/calculators/common.ts","../../src/data-fields/definitions/power-fields.ts","../../src/data-fields/definitions/heartrate-fields.ts","../../src/data-fields/definitions/cadence-fields.ts","../../src/data-fields/definitions/speed-fields.ts","../../src/data-fields/definitions/distance-fields.ts","../../src/data-fields/definitions/time-fields.ts","../../src/data-fields/definitions/elevation-fields.ts","../../src/data-fields/definitions/energy-fields.ts","../../src/data-fields/index.ts","../../src/components/data-fields/DataFieldComponent.ts"],"sourcesContent":["/**\n * Common Calculator Functions\n * \n * Shared calculation utilities used across multiple data field definitions.\n * \n * @module data-fields/calculators/common\n */\n\nimport type { ZoneConfig, ZoneColor } from '../types.js';\n\n// ============================================================================\n// Rolling Average Calculations\n// ============================================================================\n\n/**\n * Generic measurement with timestamp and value\n */\ninterface TimestampedValue {\n    timestamp: number;\n    value: number;\n}\n\n/**\n * Calculate rolling average for a measurement array over a time window\n * @param measurements - Array of timestamped measurements\n * @param windowMs - Time window in milliseconds\n * @param referenceTime - Reference time (defaults to Date.now())\n * @returns Average value or null if no data in window\n */\nexport function calculateRollingAverage(\n    measurements: TimestampedValue[],\n    windowMs: number,\n    referenceTime: number = Date.now()\n): number | null {\n    if (measurements.length === 0) return null;\n\n    const windowStart = referenceTime - windowMs;\n    const windowValues = measurements.filter(m => m.timestamp >= windowStart);\n\n    if (windowValues.length === 0) return null;\n\n    const sum = windowValues.reduce((acc, m) => acc + m.value, 0);\n    return sum / windowValues.length;\n}\n\n/**\n * Calculate weighted rolling average (more recent values weighted higher)\n * @param measurements - Array of timestamped measurements\n * @param windowMs - Time window in milliseconds\n * @param referenceTime - Reference time (defaults to Date.now())\n * @returns Weighted average or null if no data\n */\nexport function calculateWeightedRollingAverage(\n    measurements: TimestampedValue[],\n    windowMs: number,\n    referenceTime: number = Date.now()\n): number | null {\n    if (measurements.length === 0) return null;\n\n    const windowStart = referenceTime - windowMs;\n    const windowValues = measurements.filter(m => m.timestamp >= windowStart);\n\n    if (windowValues.length === 0) return null;\n\n    let weightedSum = 0;\n    let totalWeight = 0;\n\n    for (const m of windowValues) {\n        // Weight increases as we get closer to reference time\n        const age = referenceTime - m.timestamp;\n        const weight = 1 - (age / windowMs);\n        weightedSum += m.value * weight;\n        totalWeight += weight;\n    }\n\n    return totalWeight > 0 ? weightedSum / totalWeight : null;\n}\n\n// ============================================================================\n// Aggregate Calculations\n// ============================================================================\n\n/**\n * Calculate average of all measurements\n * @param measurements - Array of timestamped measurements\n * @returns Average value or null if empty\n */\nexport function calculateAverage(measurements: TimestampedValue[]): number | null {\n    if (measurements.length === 0) return null;\n    const sum = measurements.reduce((acc, m) => acc + m.value, 0);\n    return sum / measurements.length;\n}\n\n/**\n * Calculate maximum value\n * @param measurements - Array of timestamped measurements\n * @returns Maximum value or null if empty\n */\nexport function calculateMax(measurements: TimestampedValue[]): number | null {\n    if (measurements.length === 0) return null;\n    return Math.max(...measurements.map(m => m.value));\n}\n\n/**\n * Calculate minimum value\n * @param measurements - Array of timestamped measurements\n * @returns Minimum value or null if empty\n */\nexport function calculateMin(measurements: TimestampedValue[]): number | null {\n    if (measurements.length === 0) return null;\n    return Math.min(...measurements.map(m => m.value));\n}\n\n/**\n * Get the most recent value\n * @param measurements - Array of timestamped measurements\n * @param maxAge - Maximum age in ms (default 5000ms)\n * @returns Most recent value or null if stale/empty\n */\nexport function getLatestValue(\n    measurements: TimestampedValue[],\n    maxAge: number = 5000\n): number | null {\n    if (measurements.length === 0) return null;\n\n    const latest = measurements[measurements.length - 1];\n    const age = Date.now() - latest.timestamp;\n\n    return age <= maxAge ? latest.value : null;\n}\n\n// ============================================================================\n// Zone Calculations\n// ============================================================================\n\n/**\n * Determine which zone a value falls into\n * @param value - The value to check\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @param zones - Zone configuration array\n * @returns Zone number (1-based) or null\n */\nexport function getZoneForValue(\n    value: number | null,\n    referenceValue: number | null,\n    zones: ZoneConfig[]\n): number | null {\n    if (value === null || referenceValue === null || referenceValue <= 0) {\n        return null;\n    }\n\n    const percent = (value / referenceValue) * 100;\n\n    for (const zone of zones) {\n        if (percent >= zone.minPercent && percent < zone.maxPercent) {\n            return zone.zone;\n        }\n    }\n\n    // Check if above highest zone\n    const highestZone = zones[zones.length - 1];\n    if (highestZone && percent >= highestZone.minPercent) {\n        return highestZone.zone;\n    }\n\n    return null;\n}\n\n/**\n * Get zone info including color for a value\n * @param value - The value to check\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @param zones - Zone configuration array\n * @returns ZoneColor object or null\n */\nexport function getZoneColor(\n    value: number | null,\n    referenceValue: number | null,\n    zones: ZoneConfig[]\n): ZoneColor | null {\n    const zoneNum = getZoneForValue(value, referenceValue, zones);\n    if (zoneNum === null) return null;\n\n    const zoneConfig = zones.find(z => z.zone === zoneNum);\n    if (!zoneConfig) return null;\n\n    // Generate colors based on zone color\n    return {\n        zone: zoneNum,\n        zoneName: zoneConfig.name,\n        bg: hexToRgba(zoneConfig.color, 0.15),\n        text: darkenColor(zoneConfig.color, 20),\n        border: zoneConfig.color,\n    };\n}\n\n/**\n * Calculate percentage of reference value\n * @param value - Current value\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @returns Percentage or null\n */\nexport function calculatePercentOfReference(\n    value: number | null,\n    referenceValue: number | null\n): number | null {\n    if (value === null || referenceValue === null || referenceValue <= 0) {\n        return null;\n    }\n    return (value / referenceValue) * 100;\n}\n\n// ============================================================================\n// Time-based Calculations\n// ============================================================================\n\n/**\n * Calculate time in each zone\n * @param measurements - Array of timestamped measurements\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @param zones - Zone configuration array\n * @returns Map of zone number to time in milliseconds\n */\nexport function calculateTimeInZones(\n    measurements: TimestampedValue[],\n    referenceValue: number | null,\n    zones: ZoneConfig[]\n): Map<number, number> {\n    const timeInZones = new Map<number, number>();\n\n    // Initialize all zones to 0\n    for (const zone of zones) {\n        timeInZones.set(zone.zone, 0);\n    }\n\n    if (measurements.length < 2 || referenceValue === null) {\n        return timeInZones;\n    }\n\n    // Calculate time between each measurement and assign to zone\n    for (let i = 1; i < measurements.length; i++) {\n        const prev = measurements[i - 1];\n        const curr = measurements[i];\n        const timeDelta = curr.timestamp - prev.timestamp;\n\n        // Use average value for the interval\n        const avgValue = (prev.value + curr.value) / 2;\n        const zone = getZoneForValue(avgValue, referenceValue, zones);\n\n        if (zone !== null) {\n            const current = timeInZones.get(zone) || 0;\n            timeInZones.set(zone, current + timeDelta);\n        }\n    }\n\n    return timeInZones;\n}\n\n// ============================================================================\n// Color Utilities\n// ============================================================================\n\n/**\n * Convert hex color to rgba\n * @param hex - Hex color string\n * @param alpha - Alpha value (0-1)\n * @returns RGBA color string\n */\nexport function hexToRgba(hex: string, alpha: number): string {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (!result) return hex;\n\n    const r = parseInt(result[1], 16);\n    const g = parseInt(result[2], 16);\n    const b = parseInt(result[3], 16);\n\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n}\n\n/**\n * Darken a hex color\n * @param hex - Hex color string\n * @param percent - Percentage to darken (0-100)\n * @returns Darkened hex color\n */\nexport function darkenColor(hex: string, percent: number): string {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (!result) return hex;\n\n    const factor = 1 - percent / 100;\n    const r = Math.round(parseInt(result[1], 16) * factor);\n    const g = Math.round(parseInt(result[2], 16) * factor);\n    const b = Math.round(parseInt(result[3], 16) * factor);\n\n    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n}\n\n// ============================================================================\n// Format Utilities\n// ============================================================================\n\n/**\n * Format a duration in milliseconds to HH:MM:SS or MM:SS\n * @param ms - Duration in milliseconds\n * @param showHours - Force showing hours even if < 1 hour\n * @returns Formatted time string\n */\nexport function formatDuration(ms: number, showHours: boolean = false): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    if (hours > 0 || showHours) {\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format pace (min/km or min/mi)\n * @param speedMs - Speed in meters per second\n * @param imperial - Use imperial units (miles)\n * @returns Formatted pace string (e.g., \"5:30\")\n */\nexport function formatPace(speedMs: number | null, imperial: boolean = false): string {\n    if (speedMs === null || speedMs <= 0) return '--:--';\n\n    // Convert m/s to seconds per km or mile\n    const metersPerUnit = imperial ? 1609.344 : 1000;\n    const secondsPerUnit = metersPerUnit / speedMs;\n\n    const minutes = Math.floor(secondsPerUnit / 60);\n    const seconds = Math.floor(secondsPerUnit % 60);\n\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format distance\n * @param meters - Distance in meters\n * @param imperial - Use imperial units (miles)\n * @param decimals - Number of decimal places\n * @returns Formatted distance string\n */\nexport function formatDistance(\n    meters: number | null,\n    imperial: boolean = false,\n    decimals: number = 2\n): string {\n    if (meters === null) return '--';\n\n    const value = imperial ? meters / 1609.344 : meters / 1000;\n    return value.toFixed(decimals);\n}\n\n/**\n * Format speed\n * @param speedMs - Speed in meters per second\n * @param imperial - Use imperial units (mph)\n * @param decimals - Number of decimal places\n * @returns Formatted speed string\n */\nexport function formatSpeed(\n    speedMs: number | null,\n    imperial: boolean = false,\n    decimals: number = 1\n): string {\n    if (speedMs === null) return '--';\n\n    // Convert m/s to km/h or mph\n    const factor = imperial ? 2.23694 : 3.6;\n    const value = speedMs * factor;\n\n    return value.toFixed(decimals);\n}\n\n/**\n * Format altitude/elevation\n * @param meters - Altitude in meters\n * @param imperial - Use imperial units (feet)\n * @param decimals - Number of decimal places\n * @returns Formatted altitude string\n */\nexport function formatAltitude(\n    meters: number | null,\n    imperial: boolean = false,\n    decimals: number = 0\n): string {\n    if (meters === null) return '--';\n\n    const value = imperial ? meters * 3.28084 : meters;\n    return value.toFixed(decimals);\n}\n\n// ============================================================================\n// Validation Utilities\n// ============================================================================\n\n/**\n * Clamp a value between min and max\n * @param value - Value to clamp\n * @param min - Minimum value\n * @param max - Maximum value\n * @returns Clamped value\n */\nexport function clamp(value: number, min: number, max: number): number {\n    return Math.min(Math.max(value, min), max);\n}\n\n/**\n * Check if a value is within a valid range\n * @param value - Value to check\n * @param min - Minimum valid value\n * @param max - Maximum valid value\n * @returns True if valid\n */\nexport function isValidValue(value: number | null, min: number, max: number): boolean {\n    if (value === null) return false;\n    return value >= min && value <= max;\n}\n","/**\n * Power Data Field Definitions\n * \n * All power-related data fields including current, averages, and calculated metrics.\n * \n * @module data-fields/definitions/power-fields\n */\n\nimport type { DataFieldDefinition, UserSettings, ZoneColor } from '../types.js';\nimport { DEFAULT_POWER_ZONES } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n    getZoneColor,\n    getZoneForValue,\n    calculatePercentOfReference,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Power Zone Colorizer (shared by power fields)\n// ============================================================================\n\n/**\n * Colorizer for power-based zone coloring\n */\nconst powerZoneColorizer = (value: number | null, settings: UserSettings): ZoneColor | null => {\n    return getZoneColor(value, settings.ftp, settings.powerZones || DEFAULT_POWER_ZONES);\n};\n\n// ============================================================================\n// Power Field Definitions\n// ============================================================================\n\n/** Power - Current (real-time from sensor) */\nexport const powerCurrent: DataFieldDefinition = {\n    id: 'power-current',\n    name: 'Power',\n    shortName: 'PWR',\n    category: 'power',\n    description: 'Current power output from power meter',\n    unit: 'W',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    decimals: 0,\n    minValue: 0,\n    maxValue: 2500,\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - 3 Second Average */\nexport const power3s: DataFieldDefinition = {\n    id: 'power-3s',\n    name: 'Power (3s)',\n    shortName: '3s PWR',\n    category: 'power',\n    description: '3-second rolling average power for smoother display',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    decimals: 0,\n    minValue: 0,\n    maxValue: 2500,\n    calculator: (measurements) => calculateRollingAverage(measurements.power, 3000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - 10 Second Average */\nexport const power10s: DataFieldDefinition = {\n    id: 'power-10s',\n    name: 'Power (10s)',\n    shortName: '10s PWR',\n    category: 'power',\n    description: '10-second rolling average power',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.power, 10000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - 30 Second Average */\nexport const power30s: DataFieldDefinition = {\n    id: 'power-30s',\n    name: 'Power (30s)',\n    shortName: '30s PWR',\n    category: 'power',\n    description: '30-second rolling average power',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.power, 30000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - Workout Average */\nexport const powerAvg: DataFieldDefinition = {\n    id: 'power-avg',\n    name: 'Avg Power',\n    shortName: 'Avg PWR',\n    category: 'power',\n    description: 'Average power for entire workout',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateAverage(measurements.power),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Power - Lap Average */\nexport const powerLapAvg: DataFieldDefinition = {\n    id: 'power-lap-avg',\n    name: 'Lap Avg Power',\n    shortName: 'Lap PWR',\n    category: 'power',\n    description: 'Average power for current lap',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.power.filter(\n            m => m.timestamp >= workoutState.lapStartTime!\n        );\n        return calculateAverage(lapMeasurements);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Power - Maximum */\nexport const powerMax: DataFieldDefinition = {\n    id: 'power-max',\n    name: 'Max Power',\n    shortName: 'Max PWR',\n    category: 'power',\n    description: 'Maximum power during workout',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateMax(measurements.power),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Power Zone */\nexport const powerZone: DataFieldDefinition = {\n    id: 'power-zone',\n    name: 'Power Zone',\n    shortName: 'P Zone',\n    category: 'power',\n    description: 'Current power training zone (1-7)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸŽ¯',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const power = getLatestValue(measurements.power);\n        return getZoneForValue(power, settings.ftp, settings.powerZones || DEFAULT_POWER_ZONES);\n    },\n    formatter: (value, settings) => {\n        if (value === null) return '--';\n        const zones = settings.powerZones || DEFAULT_POWER_ZONES;\n        const zone = zones.find(z => z.zone === value);\n        return zone ? `Z${value}` : `Z${value}`;\n    },\n    colorizer: (value, settings) => {\n        if (value === null) return null;\n        const zones = settings.powerZones || DEFAULT_POWER_ZONES;\n        const zone = zones.find(z => z.zone === value);\n        if (!zone) return null;\n        return {\n            zone: value,\n            zoneName: zone.name,\n            bg: zone.color + '26', // 15% opacity\n            text: zone.color,\n            border: zone.color,\n        };\n    },\n};\n\n/** Power - % of FTP */\nexport const powerPercentFtp: DataFieldDefinition = {\n    id: 'power-percent-ftp',\n    name: 'Power % FTP',\n    shortName: '% FTP',\n    category: 'power',\n    description: 'Current power as percentage of FTP',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“Š',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const power = getLatestValue(measurements.power);\n        return calculatePercentOfReference(power, settings.ftp);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Normalized Power (NP) */\nexport const powerNormalized: DataFieldDefinition = {\n    id: 'power-normalized',\n    name: 'Normalized Power',\n    shortName: 'NP',\n    category: 'power',\n    description: 'Normalized Power - accounts for variability in effort',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš¡',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const powerData = measurements.power;\n        if (powerData.length < 30) return null;\n\n        // Calculate 30-second rolling averages\n        const thirtySecondAverages: number[] = [];\n        const windowSize = 30000; // 30 seconds\n\n        for (let i = 0; i < powerData.length; i++) {\n            const windowEnd = powerData[i].timestamp;\n            const windowStart = windowEnd - windowSize;\n\n            const windowValues = powerData.filter(\n                p => p.timestamp >= windowStart && p.timestamp <= windowEnd\n            );\n\n            if (windowValues.length > 0) {\n                const avg = windowValues.reduce((s, p) => s + p.value, 0) / windowValues.length;\n                thirtySecondAverages.push(avg);\n            }\n        }\n\n        if (thirtySecondAverages.length === 0) return null;\n\n        // Raise to 4th power, average, then 4th root\n        const fourthPowers = thirtySecondAverages.map(v => Math.pow(v, 4));\n        const avgFourthPower = fourthPowers.reduce((s, v) => s + v, 0) / fourthPowers.length;\n\n        return Math.pow(avgFourthPower, 0.25);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Intensity Factor (IF) */\nexport const intensityFactor: DataFieldDefinition = {\n    id: 'power-if',\n    name: 'Intensity Factor',\n    shortName: 'IF',\n    category: 'power',\n    description: 'Intensity Factor - NP divided by FTP',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“ˆ',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, workoutState, settings) => {\n        if (!settings.ftp || settings.ftp <= 0) return null;\n\n        // Calculate NP first\n        const npCalc = powerNormalized.calculator;\n        if (!npCalc) return null;\n        const np = npCalc(measurements, workoutState, settings);\n        if (np === null) return null;\n\n        return np / settings.ftp;\n    },\n    formatter: (value) => value !== null ? value.toFixed(2) : '--',\n};\n\n/** Training Stress Score (TSS) */\nexport const tss: DataFieldDefinition = {\n    id: 'power-tss',\n    name: 'TSS',\n    shortName: 'TSS',\n    category: 'power',\n    description: 'Training Stress Score - workout load metric',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“Š',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState, settings) => {\n        if (!settings.ftp || settings.ftp <= 0) return null;\n\n        const npCalc = powerNormalized.calculator;\n        if (!npCalc) return null;\n        const np = npCalc(measurements, workoutState, settings);\n        if (np === null) return null;\n\n        const durationSeconds = workoutState.elapsedTime / 1000;\n        const ifValue = np / settings.ftp;\n\n        return (durationSeconds * np * ifValue) / (settings.ftp * 3600) * 100;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Kilojoules (Work) */\nexport const kilojoules: DataFieldDefinition = {\n    id: 'power-kj',\n    name: 'Kilojoules',\n    shortName: 'kJ',\n    category: 'power',\n    description: 'Total work done in kilojoules',\n    unit: 'kJ',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”¥',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const powerData = measurements.power;\n        if (powerData.length < 2) return null;\n\n        // Calculate total joules (power * time)\n        let totalJoules = 0;\n\n        for (let i = 1; i < powerData.length; i++) {\n            const prev = powerData[i - 1];\n            const curr = powerData[i];\n            const timeDeltaSeconds = (curr.timestamp - prev.timestamp) / 1000;\n            const avgPower = (prev.value + curr.value) / 2;\n            totalJoules += avgPower * timeDeltaSeconds;\n        }\n\n        return totalJoules / 1000; // Convert to kJ\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Watts per Kilogram (W/kg) */\nexport const wattsPerKg: DataFieldDefinition = {\n    id: 'power-wkg',\n    name: 'W/kg',\n    shortName: 'W/kg',\n    category: 'power',\n    description: 'Power to weight ratio',\n    unit: 'W/kg',\n    sourceType: 'calculated',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš–ï¸',\n    requiresSensor: ['power'],\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        const power = getLatestValue(measurements.power);\n        if (power === null || !settings.weight || settings.weight <= 0) return null;\n        return power / settings.weight;\n    },\n    formatter: (value) => value !== null ? value.toFixed(2) : '--',\n};\n\n// ============================================================================\n// Export All Power Fields\n// ============================================================================\n\nexport const POWER_FIELDS: DataFieldDefinition[] = [\n    powerCurrent,\n    power3s,\n    power10s,\n    power30s,\n    powerAvg,\n    powerLapAvg,\n    powerMax,\n    powerZone,\n    powerPercentFtp,\n    powerNormalized,\n    intensityFactor,\n    tss,\n    kilojoules,\n    wattsPerKg,\n];\n","/**\n * Heart Rate Data Field Definitions\n * \n * All heart rate-related data fields including current, averages, zones, and calculated metrics.\n * \n * @module data-fields/definitions/heartrate-fields\n */\n\nimport type { DataFieldDefinition, UserSettings, ZoneColor } from '../types.js';\nimport { DEFAULT_HR_ZONES } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n    getZoneColor,\n    getZoneForValue,\n    calculatePercentOfReference,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Heart Rate Zone Colorizer (shared by HR fields)\n// ============================================================================\n\n/**\n * Colorizer for heart rate-based zone coloring\n */\nconst hrZoneColorizer = (value: number | null, settings: UserSettings): ZoneColor | null => {\n    return getZoneColor(value, settings.maxHr, settings.hrZones || DEFAULT_HR_ZONES);\n};\n\n// ============================================================================\n// Heart Rate Field Definitions\n// ============================================================================\n\n/** Heart Rate - Current (real-time from sensor) */\nexport const hrCurrent: DataFieldDefinition = {\n    id: 'heartrate-current',\n    name: 'Heart Rate',\n    shortName: 'HR',\n    category: 'heartrate',\n    description: 'Current heart rate from heart rate monitor',\n    unit: 'bpm',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    minValue: 30,\n    maxValue: 220,\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - 5 Second Average */\nexport const hr5s: DataFieldDefinition = {\n    id: 'hr-5s',\n    name: 'HR (5s)',\n    shortName: '5s HR',\n    category: 'heartrate',\n    description: '5-second rolling average heart rate',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.heartrate, 5000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - 30 Second Average */\nexport const hr30s: DataFieldDefinition = {\n    id: 'hr-30s',\n    name: 'HR (30s)',\n    shortName: '30s HR',\n    category: 'heartrate',\n    description: '30-second rolling average heart rate',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.heartrate, 30000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - Workout Average */\nexport const hrAvg: DataFieldDefinition = {\n    id: 'hr-avg',\n    name: 'Avg HR',\n    shortName: 'Avg HR',\n    category: 'heartrate',\n    description: 'Average heart rate for entire workout',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateAverage(measurements.heartrate),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate - Lap Average */\nexport const hrLapAvg: DataFieldDefinition = {\n    id: 'hr-lap-avg',\n    name: 'Lap Avg HR',\n    shortName: 'Lap HR',\n    category: 'heartrate',\n    description: 'Average heart rate for current lap',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.heartrate.filter(\n            (m) => m.timestamp >= workoutState.lapStartTime!\n        );\n        return calculateAverage(lapMeasurements);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate - Maximum */\nexport const hrMax: DataFieldDefinition = {\n    id: 'hr-max',\n    name: 'Max HR',\n    shortName: 'Max HR',\n    category: 'heartrate',\n    description: 'Maximum heart rate during workout',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateMax(measurements.heartrate),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate - Minimum */\nexport const hrMin: DataFieldDefinition = {\n    id: 'hr-min',\n    name: 'Min HR',\n    shortName: 'Min HR',\n    category: 'heartrate',\n    description: 'Minimum heart rate during workout',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¤ï¸',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const data = measurements.heartrate;\n        if (data.length === 0) return null;\n        return Math.min(...data.map((d) => d.value));\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate Zone */\nexport const hrZone: DataFieldDefinition = {\n    id: 'hr-zone',\n    name: 'HR Zone',\n    shortName: 'HR Zone',\n    category: 'heartrate',\n    description: 'Current heart rate training zone (1-5)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸŽ¯',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hr = getLatestValue(measurements.heartrate);\n        return getZoneForValue(hr, settings.maxHr, settings.hrZones || DEFAULT_HR_ZONES);\n    },\n    formatter: (value, settings) => {\n        if (value === null) return '--';\n        const zones = settings.hrZones || DEFAULT_HR_ZONES;\n        const zone = zones.find((z) => z.zone === value);\n        return zone ? `Z${value}` : `Z${value}`;\n    },\n    colorizer: (value, settings) => {\n        if (value === null) return null;\n        const zones = settings.hrZones || DEFAULT_HR_ZONES;\n        const zone = zones.find((z) => z.zone === value);\n        if (!zone) return null;\n        return {\n            zone: value,\n            zoneName: zone.name,\n            bg: zone.color + '26', // 15% opacity\n            text: zone.color,\n            border: zone.color,\n        };\n    },\n};\n\n/** Heart Rate - % of Max */\nexport const hrPercentMax: DataFieldDefinition = {\n    id: 'hr-percent-max',\n    name: 'HR % Max',\n    shortName: '% Max',\n    category: 'heartrate',\n    description: 'Current heart rate as percentage of max HR',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“Š',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hr = getLatestValue(measurements.heartrate);\n        return calculatePercentOfReference(hr, settings.maxHr);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - % of Heart Rate Reserve (HRR) */\nexport const hrPercentReserve: DataFieldDefinition = {\n    id: 'hr-percent-reserve',\n    name: 'HR % Reserve',\n    shortName: '% HRR',\n    category: 'heartrate',\n    description: 'Current heart rate as percentage of heart rate reserve',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“Š',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hr = getLatestValue(measurements.heartrate);\n        if (hr === null || !settings.maxHr || !settings.restingHr) return null;\n        const reserve = settings.maxHr - settings.restingHr;\n        if (reserve <= 0) return null;\n        return ((hr - settings.restingHr) / reserve) * 100;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Calories Burned (estimated from HR) */\nexport const caloriesFromHr: DataFieldDefinition = {\n    id: 'hr-calories',\n    name: 'Calories',\n    shortName: 'Cal',\n    category: 'heartrate',\n    description: 'Estimated calories burned based on heart rate',\n    unit: 'kcal',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”¥',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hrData = measurements.heartrate;\n        if (hrData.length < 2 || !settings.weight || !settings.maxHr) return null;\n\n        // Using heart rate-based calorie estimation\n        // Formula varies by gender - using simplified version\n        let totalCalories = 0;\n\n        for (let i = 1; i < hrData.length; i++) {\n            const prev = hrData[i - 1];\n            const curr = hrData[i];\n            const timeDeltaMinutes = (curr.timestamp - prev.timestamp) / 60000;\n            const avgHr = (prev.value + curr.value) / 2;\n\n            // Simplified formula (assumes average adult, ~50% gender split)\n            // Male: (-55.0969 + (0.6309 Ã— HR) + (0.1988 Ã— weight kg) + (0.2017 Ã— age)) / 4.184\n            // Using simplified: 0.6309 * HR * weight * time / 60\n            const caloriesPerMinute = (0.6309 * avgHr + 0.1988 * settings.weight) / 4.184;\n            totalCalories += caloriesPerMinute * timeDeltaMinutes;\n        }\n\n        return totalCalories;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Time in Zone Display */\nexport const hrTimeInZone: DataFieldDefinition = {\n    id: 'hr-time-in-zone',\n    name: 'Time in Zone',\n    shortName: 'T-Zone',\n    category: 'heartrate',\n    description: 'Time spent in each heart rate zone',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'large',\n    supportedSizes: ['large'],\n    icon: 'â±ï¸',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hrData = measurements.heartrate;\n        if (hrData.length < 2 || !settings.maxHr) return null;\n\n        const zones = settings.hrZones || DEFAULT_HR_ZONES;\n        const timeInZones: number[] = new Array(zones.length).fill(0);\n\n        for (let i = 1; i < hrData.length; i++) {\n            const prev = hrData[i - 1];\n            const curr = hrData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n            const avgHr = (prev.value + curr.value) / 2;\n            const zone = getZoneForValue(avgHr, settings.maxHr, zones);\n\n            if (zone !== null && zone > 0 && zone <= zones.length) {\n                timeInZones[zone - 1] += timeDelta;\n            }\n        }\n\n        // Return the zone with most time as the \"primary\" zone\n        const maxTimeIdx = timeInZones.indexOf(Math.max(...timeInZones));\n        return maxTimeIdx + 1; // Return 1-indexed zone\n    },\n    formatter: (value) => value !== null ? `Z${value}` : '--',\n};\n\n// ============================================================================\n// Export All Heart Rate Fields\n// ============================================================================\n\nexport const HEARTRATE_FIELDS: DataFieldDefinition[] = [\n    hrCurrent,\n    hr5s,\n    hr30s,\n    hrAvg,\n    hrLapAvg,\n    hrMax,\n    hrMin,\n    hrZone,\n    hrPercentMax,\n    hrPercentReserve,\n    caloriesFromHr,\n    hrTimeInZone,\n];\n","/**\n * Cadence Data Field Definitions\n * \n * All cadence-related data fields including current, averages, and target ranges.\n * \n * @module data-fields/definitions/cadence-fields\n */\n\nimport type { DataFieldDefinition, ZoneColor } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Cadence Zone Configuration\n// ============================================================================\n\n/** Cadence ranges for zone coloring */\nconst CADENCE_RANGES = {\n    veryLow: { min: 0, max: 60 },\n    low: { min: 60, max: 75 },\n    optimal: { min: 75, max: 95 },\n    high: { min: 95, max: 110 },\n    veryHigh: { min: 110, max: 200 },\n};\n\n/** Cadence zone colors */\nconst CADENCE_COLORS: Record<string, string> = {\n    veryLow: '#9CA3AF',   // Gray - very low\n    low: '#3B82F6',       // Blue - low\n    optimal: '#10B981',   // Green - optimal\n    high: '#F59E0B',      // Orange - high\n    veryHigh: '#EF4444',  // Red - very high\n};\n\n/**\n * Get color for cadence value\n */\nconst getCadenceColor = (cadence: number | null): ZoneColor | null => {\n    if (cadence === null) return null;\n\n    if (cadence < CADENCE_RANGES.veryLow.max) {\n        return {\n            zone: 1,\n            zoneName: 'Very Low',\n            bg: CADENCE_COLORS.veryLow + '26',\n            text: CADENCE_COLORS.veryLow,\n            border: CADENCE_COLORS.veryLow,\n        };\n    }\n    if (cadence < CADENCE_RANGES.low.max) {\n        return {\n            zone: 2,\n            zoneName: 'Low',\n            bg: CADENCE_COLORS.low + '26',\n            text: CADENCE_COLORS.low,\n            border: CADENCE_COLORS.low,\n        };\n    }\n    if (cadence < CADENCE_RANGES.optimal.max) {\n        return {\n            zone: 3,\n            zoneName: 'Optimal',\n            bg: CADENCE_COLORS.optimal + '26',\n            text: CADENCE_COLORS.optimal,\n            border: CADENCE_COLORS.optimal,\n        };\n    }\n    if (cadence < CADENCE_RANGES.high.max) {\n        return {\n            zone: 4,\n            zoneName: 'High',\n            bg: CADENCE_COLORS.high + '26',\n            text: CADENCE_COLORS.high,\n            border: CADENCE_COLORS.high,\n        };\n    }\n    return {\n        zone: 5,\n        zoneName: 'Very High',\n        bg: CADENCE_COLORS.veryHigh + '26',\n        text: CADENCE_COLORS.veryHigh,\n        border: CADENCE_COLORS.veryHigh,\n    };\n};\n\n// ============================================================================\n// Cadence Field Definitions\n// ============================================================================\n\n/** Cadence - Current (real-time from sensor) */\nexport const cadenceCurrent: DataFieldDefinition = {\n    id: 'cadence-current',\n    name: 'Cadence',\n    shortName: 'CAD',\n    category: 'cadence',\n    description: 'Current pedaling cadence from sensor',\n    unit: 'rpm',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”„',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    minValue: 0,\n    maxValue: 200,\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: (value) => getCadenceColor(value),\n};\n\n/** Cadence - 5 Second Average */\nexport const cadence5s: DataFieldDefinition = {\n    id: 'cadence-5s',\n    name: 'Cadence (5s)',\n    shortName: '5s CAD',\n    category: 'cadence',\n    description: '5-second rolling average cadence',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”„',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.cadence, 5000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: (value) => getCadenceColor(value),\n};\n\n/** Cadence - 30 Second Average */\nexport const cadence30s: DataFieldDefinition = {\n    id: 'cadence-30s',\n    name: 'Cadence (30s)',\n    shortName: '30s CAD',\n    category: 'cadence',\n    description: '30-second rolling average cadence',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”„',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.cadence, 30000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: (value) => getCadenceColor(value),\n};\n\n/** Cadence - Workout Average */\nexport const cadenceAvg: DataFieldDefinition = {\n    id: 'cadence-avg',\n    name: 'Avg Cadence',\n    shortName: 'Avg CAD',\n    category: 'cadence',\n    description: 'Average cadence for entire workout (excluding zeros)',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”„',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        // Filter out zero values (coasting)\n        const nonZeroData = measurements.cadence.filter(m => m.value > 0);\n        return calculateAverage(nonZeroData);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Cadence - Lap Average */\nexport const cadenceLapAvg: DataFieldDefinition = {\n    id: 'cadence-lap-avg',\n    name: 'Lap Avg Cadence',\n    shortName: 'Lap CAD',\n    category: 'cadence',\n    description: 'Average cadence for current lap (excluding zeros)',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”„',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.cadence.filter(\n            m => m.timestamp >= workoutState.lapStartTime! && m.value > 0\n        );\n        return calculateAverage(lapMeasurements);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Cadence - Maximum */\nexport const cadenceMax: DataFieldDefinition = {\n    id: 'cadence-max',\n    name: 'Max Cadence',\n    shortName: 'Max CAD',\n    category: 'cadence',\n    description: 'Maximum cadence during workout',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”„',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateMax(measurements.cadence),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Cadence Zone Indicator */\nexport const cadenceZone: DataFieldDefinition = {\n    id: 'cadence-zone',\n    name: 'Cadence Zone',\n    shortName: 'CAD Zone',\n    category: 'cadence',\n    description: 'Current cadence zone (Very Low, Low, Optimal, High, Very High)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸŽ¯',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    calculator: (measurements) => {\n        const cadence = getLatestValue(measurements.cadence);\n        if (cadence === null) return null;\n\n        if (cadence < CADENCE_RANGES.veryLow.max) return 1;\n        if (cadence < CADENCE_RANGES.low.max) return 2;\n        if (cadence < CADENCE_RANGES.optimal.max) return 3;\n        if (cadence < CADENCE_RANGES.high.max) return 4;\n        return 5;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const names = ['V.Low', 'Low', 'Optimal', 'High', 'V.High'];\n        return names[value - 1] || '--';\n    },\n    colorizer: (value) => {\n        if (value === null) return null;\n        const names = ['Very Low', 'Low', 'Optimal', 'High', 'Very High'];\n        const colors = [\n            CADENCE_COLORS.veryLow,\n            CADENCE_COLORS.low,\n            CADENCE_COLORS.optimal,\n            CADENCE_COLORS.high,\n            CADENCE_COLORS.veryHigh,\n        ];\n        return {\n            zone: value,\n            zoneName: names[value - 1],\n            bg: colors[value - 1] + '26',\n            text: colors[value - 1],\n            border: colors[value - 1],\n        };\n    },\n};\n\n/** Pedal Balance (if supported) */\nexport const pedalBalance: DataFieldDefinition = {\n    id: 'cadence-balance',\n    name: 'Pedal Balance',\n    shortName: 'Balance',\n    category: 'cadence',\n    description: 'Left/Right pedal balance percentage',\n    unit: '%',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'âš–ï¸',\n    requiresSensor: ['power'], // Balance often comes from power meter\n    decimals: 0,\n    minValue: 0,\n    maxValue: 100,\n    formatter: (value) => {\n        if (value === null) return '--';\n        return `${Math.round(value)}/${Math.round(100 - value)}`;\n    },\n    colorizer: (value) => {\n        if (value === null) return null;\n        const deviation = Math.abs(50 - value);\n        if (deviation < 3) {\n            return {\n                zone: 1,\n                zoneName: 'Balanced',\n                bg: '#10B98126',\n                text: '#10B981',\n                border: '#10B981',\n            };\n        }\n        if (deviation < 5) {\n            return {\n                zone: 2,\n                zoneName: 'Slight Imbalance',\n                bg: '#F59E0B26',\n                text: '#F59E0B',\n                border: '#F59E0B',\n            };\n        }\n        return {\n            zone: 3,\n            zoneName: 'Imbalanced',\n            bg: '#EF444426',\n            text: '#EF4444',\n            border: '#EF4444',\n        };\n    },\n};\n\n/** Time Pedaling vs Coasting */\nexport const pedalingTime: DataFieldDefinition = {\n    id: 'cadence-pedaling-time',\n    name: 'Pedaling Time',\n    shortName: 'Pedal %',\n    category: 'cadence',\n    description: 'Percentage of time actively pedaling',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const cadenceData = measurements.cadence;\n        if (cadenceData.length < 2) return null;\n\n        let pedalingTime = 0;\n        let totalTime = 0;\n\n        for (let i = 1; i < cadenceData.length; i++) {\n            const prev = cadenceData[i - 1];\n            const curr = cadenceData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n\n            totalTime += timeDelta;\n            if (prev.value > 0 || curr.value > 0) {\n                pedalingTime += timeDelta;\n            }\n        }\n\n        if (totalTime === 0) return null;\n        return (pedalingTime / totalTime) * 100;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Total Revolutions */\nexport const totalRevolutions: DataFieldDefinition = {\n    id: 'cadence-revolutions',\n    name: 'Total Revolutions',\n    shortName: 'Revs',\n    category: 'cadence',\n    description: 'Total crank revolutions during workout',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ”¢',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const cadenceData = measurements.cadence;\n        if (cadenceData.length < 2) return null;\n\n        let totalRevs = 0;\n\n        for (let i = 1; i < cadenceData.length; i++) {\n            const prev = cadenceData[i - 1];\n            const curr = cadenceData[i];\n            const timeDeltaMinutes = (curr.timestamp - prev.timestamp) / 60000;\n            const avgCadence = (prev.value + curr.value) / 2;\n            totalRevs += avgCadence * timeDeltaMinutes;\n        }\n\n        return Math.round(totalRevs);\n    },\n    formatter: (value) => value !== null ? value.toLocaleString() : '--',\n};\n\n// ============================================================================\n// Export All Cadence Fields\n// ============================================================================\n\nexport const CADENCE_FIELDS: DataFieldDefinition[] = [\n    cadenceCurrent,\n    cadence5s,\n    cadence30s,\n    cadenceAvg,\n    cadenceLapAvg,\n    cadenceMax,\n    cadenceZone,\n    pedalBalance,\n    pedalingTime,\n    totalRevolutions,\n];\n","/**\n * Speed Data Field Definitions\n * \n * All speed-related data fields including current, averages, and pace-based metrics.\n * \n * @module data-fields/definitions/speed-fields\n */\n\nimport type { DataFieldDefinition, UserSettings } from '../types.js';\nimport { isImperial } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n    formatPace,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Speed Unit Conversion Helpers\n// ============================================================================\n\n/** Convert m/s to km/h */\nconst msToKmh = (ms: number): number => ms * 3.6;\n\n/** Convert m/s to mph */\nconst msToMph = (ms: number): number => ms * 2.23694;\n\n/** Get speed in user's preferred unit (km/h or mph) */\nconst getSpeedInUserUnit = (ms: number | null, settings: UserSettings): number | null => {\n    if (ms === null) return null;\n    return isImperial(settings) ? msToMph(ms) : msToKmh(ms);\n};\n\n/** Get pace in user's preferred unit (min/km or min/mile) */\nconst getPaceInUserUnit = (ms: number | null, settings: UserSettings): number | null => {\n    if (ms === null || ms <= 0) return null;\n    const kmh = msToKmh(ms);\n    if (kmh <= 0) return null;\n\n    // min/km\n    const minPerKm = 60 / kmh;\n\n    // Convert to min/mile if imperial\n    return isImperial(settings) ? minPerKm * 1.60934 : minPerKm;\n};\n\n// ============================================================================\n// Speed Field Definitions\n// ============================================================================\n\n/** Speed - Current (real-time from GPS) */\nexport const speedCurrent: DataFieldDefinition = {\n    id: 'speed-current',\n    name: 'Speed',\n    shortName: 'SPD',\n    category: 'speed',\n    description: 'Current speed from GPS',\n    unit: 'km/h',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸš´',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    minValue: 0,\n    maxValue: 100,\n    calculator: (measurements, _workoutState, settings) => {\n        const speed = getLatestValue(measurements.speed);\n        return getSpeedInUserUnit(speed, settings);\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return `${value.toFixed(1)}`;\n    },\n};\n\n/** Speed - 5 Second Average */\nexport const speed5s: DataFieldDefinition = {\n    id: 'speed-5s',\n    name: 'Speed (5s)',\n    shortName: '5s SPD',\n    category: 'speed',\n    description: '5-second rolling average speed',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸš´',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        const avgMs = calculateRollingAverage(measurements.speed, 5000);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - 30 Second Average */\nexport const speed30s: DataFieldDefinition = {\n    id: 'speed-30s',\n    name: 'Speed (30s)',\n    shortName: '30s SPD',\n    category: 'speed',\n    description: '30-second rolling average speed',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸš´',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        const avgMs = calculateRollingAverage(measurements.speed, 30000);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - Workout Average */\nexport const speedAvg: DataFieldDefinition = {\n    id: 'speed-avg',\n    name: 'Avg Speed',\n    shortName: 'Avg SPD',\n    category: 'speed',\n    description: 'Average speed for entire workout (moving time)',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸš´',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        // Exclude very low speeds (stopped) from average\n        const movingData = measurements.speed.filter(m => m.value > 0.5);\n        const avgMs = calculateAverage(movingData);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - Lap Average */\nexport const speedLapAvg: DataFieldDefinition = {\n    id: 'speed-lap-avg',\n    name: 'Lap Avg Speed',\n    shortName: 'Lap SPD',\n    category: 'speed',\n    description: 'Average speed for current lap',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸš´',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements, workoutState, settings) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.speed.filter(\n            m => m.timestamp >= workoutState.lapStartTime! && m.value > 0.5\n        );\n        const avgMs = calculateAverage(lapMeasurements);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - Maximum */\nexport const speedMax: DataFieldDefinition = {\n    id: 'speed-max',\n    name: 'Max Speed',\n    shortName: 'Max SPD',\n    category: 'speed',\n    description: 'Maximum speed during workout',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸš´',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        const maxMs = calculateMax(measurements.speed);\n        return getSpeedInUserUnit(maxMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Pace - Current */\nexport const paceCurrent: DataFieldDefinition = {\n    id: 'speed-pace',\n    name: 'Pace',\n    shortName: 'Pace',\n    category: 'speed',\n    description: 'Current pace (time per km or mile)',\n    unit: 'min/km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const speed = getLatestValue(measurements.speed);\n        return getPaceInUserUnit(speed, settings);\n    },\n    formatter: (value) => {\n        if (value === null || value > 30) return '--'; // Cap at 30 min/km\n        return formatPace(value);\n    },\n};\n\n/** Pace - Average */\nexport const paceAvg: DataFieldDefinition = {\n    id: 'speed-pace-avg',\n    name: 'Avg Pace',\n    shortName: 'Avg Pace',\n    category: 'speed',\n    description: 'Average pace for entire workout',\n    unit: 'min/km',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const movingData = measurements.speed.filter(m => m.value > 0.5);\n        const avgMs = calculateAverage(movingData);\n        return getPaceInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => {\n        if (value === null || value > 30) return '--';\n        return formatPace(value);\n    },\n};\n\n/** Moving Time */\nexport const movingTime: DataFieldDefinition = {\n    id: 'speed-moving-time',\n    name: 'Moving Time',\n    shortName: 'Moving',\n    category: 'speed',\n    description: 'Time spent moving (speed > 0.5 m/s)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const speedData = measurements.speed;\n        if (speedData.length < 2) return null;\n\n        let movingMs = 0;\n        const MOVING_THRESHOLD = 0.5; // m/s\n\n        for (let i = 1; i < speedData.length; i++) {\n            const prev = speedData[i - 1];\n            const curr = speedData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n\n            if ((prev.value + curr.value) / 2 > MOVING_THRESHOLD) {\n                movingMs += timeDelta;\n            }\n        }\n\n        return movingMs;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const seconds = Math.floor(value / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n\n        if (hours > 0) {\n            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        }\n        return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    },\n};\n\n/** Stopped Time */\nexport const stoppedTime: DataFieldDefinition = {\n    id: 'speed-stopped-time',\n    name: 'Stopped Time',\n    shortName: 'Stopped',\n    category: 'speed',\n    description: 'Time spent stopped (speed < 0.5 m/s)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â¸ï¸',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const speedData = measurements.speed;\n        if (speedData.length < 2) return null;\n\n        let stoppedMs = 0;\n        const MOVING_THRESHOLD = 0.5; // m/s\n\n        for (let i = 1; i < speedData.length; i++) {\n            const prev = speedData[i - 1];\n            const curr = speedData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n\n            if ((prev.value + curr.value) / 2 <= MOVING_THRESHOLD) {\n                stoppedMs += timeDelta;\n            }\n        }\n\n        return stoppedMs;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const seconds = Math.floor(value / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n\n        if (hours > 0) {\n            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        }\n        return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    },\n};\n\n/** Vertical Speed (climbing rate) */\nexport const verticalSpeed: DataFieldDefinition = {\n    id: 'speed-vertical',\n    name: 'Vertical Speed',\n    shortName: 'VAM',\n    category: 'speed',\n    description: 'Vertical climbing rate in meters per hour',\n    unit: 'm/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“ˆ',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements) => {\n        // Need at least 30 seconds of data\n        const elevationData = measurements.altitude;\n        if (elevationData.length < 2) return null;\n\n        const windowMs = 30000;\n        const now = Date.now();\n        const recentData = elevationData.filter((e) => e.timestamp >= now - windowMs);\n\n        if (recentData.length < 2) return null;\n\n        const first = recentData[0];\n        const last = recentData[recentData.length - 1];\n\n        const elevationGain = last.value - first.value;\n        const timeDeltaHours = (last.timestamp - first.timestamp) / 3600000;\n\n        if (timeDeltaHours <= 0) return null;\n\n        // VAM = meters gained / hours\n        return Math.max(0, elevationGain / timeDeltaHours);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Efficiency Factor (speed vs power) */\nexport const efficiencyFactor: DataFieldDefinition = {\n    id: 'speed-efficiency',\n    name: 'Efficiency Factor',\n    shortName: 'EF',\n    category: 'speed',\n    description: 'Speed per watt of power (efficiency indicator)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“Š',\n    requiresSensor: ['gps', 'power'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        const movingSpeedData = measurements.speed.filter(m => m.value > 0.5);\n        const powerData = measurements.power.filter(p => p.value > 0);\n\n        if (movingSpeedData.length === 0 || powerData.length === 0) return null;\n\n        const avgSpeedMs = calculateAverage(movingSpeedData);\n        const avgPower = calculateAverage(powerData);\n\n        if (!avgSpeedMs || !avgPower || avgPower <= 0) return null;\n\n        // Speed (km/h) / Power (W)\n        const avgSpeedKmh = getSpeedInUserUnit(avgSpeedMs, settings);\n        if (!avgSpeedKmh) return null;\n\n        return avgSpeedKmh / avgPower;\n    },\n    formatter: (value) => value !== null ? value.toFixed(3) : '--',\n};\n\n// ============================================================================\n// Export All Speed Fields\n// ============================================================================\n\nexport const SPEED_FIELDS: DataFieldDefinition[] = [\n    speedCurrent,\n    speed5s,\n    speed30s,\n    speedAvg,\n    speedLapAvg,\n    speedMax,\n    paceCurrent,\n    paceAvg,\n    movingTime,\n    stoppedTime,\n    verticalSpeed,\n    efficiencyFactor,\n];\n","/**\n * Distance Data Field Definitions\n * \n * All distance-related data fields including total, lap, and remaining distances.\n * \n * @module data-fields/definitions/distance-fields\n */\n\nimport type { DataFieldDefinition, UserSettings } from '../types.js';\nimport { isImperial } from '../types.js';\n\n// ============================================================================\n// Distance Conversion Helpers\n// ============================================================================\n\n/** Convert meters to kilometers */\nconst metersToKm = (meters: number): number => meters / 1000;\n\n/** Convert meters to miles */\nconst metersToMiles = (meters: number): number => meters / 1609.344;\n\n/** Get distance in user's preferred unit */\nconst getDistanceInUserUnit = (meters: number | null, settings: UserSettings): number | null => {\n    if (meters === null) return null;\n    return isImperial(settings) ? metersToMiles(meters) : metersToKm(meters);\n};\n\n// ============================================================================\n// Distance Field Definitions\n// ============================================================================\n\n/** Distance - Total */\nexport const distanceTotal: DataFieldDefinition = {\n    id: 'distance-total',\n    name: 'Distance',\n    shortName: 'Dist',\n    category: 'distance',\n    description: 'Total distance traveled',\n    unit: 'km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'large',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        const positions = measurements.gps;\n        if (positions.length < 2) return 0;\n\n        let totalMeters = 0;\n\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            // Haversine formula for distance\n            const R = 6371000; // Earth radius in meters\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        return getDistanceInUserUnit(totalMeters, settings);\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return value.toFixed(2);\n    },\n};\n\n/** Distance - Lap */\nexport const distanceLap: DataFieldDefinition = {\n    id: 'distance-lap',\n    name: 'Lap Distance',\n    shortName: 'Lap Dist',\n    category: 'distance',\n    description: 'Distance for current lap',\n    unit: 'km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, workoutState, settings) => {\n        if (!workoutState.lapStartTime) return 0;\n\n        const lapPositions = measurements.gps.filter(\n            (p) => p.timestamp >= workoutState.lapStartTime!\n        );\n        if (lapPositions.length < 2) return 0;\n\n        let totalMeters = 0;\n\n        for (let i = 1; i < lapPositions.length; i++) {\n            const prev = lapPositions[i - 1];\n            const curr = lapPositions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        return getDistanceInUserUnit(totalMeters, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(2) : '--',\n};\n\n/** Distance to Next Kilometer/Mile Marker */\nexport const distanceToMarker: DataFieldDefinition = {\n    id: 'distance-to-marker',\n    name: 'To Next Marker',\n    shortName: 'To Marker',\n    category: 'distance',\n    description: 'Distance remaining to next km/mile marker',\n    unit: 'km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸŽ¯',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        // Calculate total distance first\n        const positions = measurements.gps;\n        if (positions.length < 2) return null;\n\n        let totalMeters = 0;\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        const totalUnits = isImperial(settings)\n            ? metersToMiles(totalMeters)\n            : metersToKm(totalMeters);\n\n        const nextMarker = Math.ceil(totalUnits);\n        return nextMarker - totalUnits;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return value.toFixed(2);\n    },\n};\n\n// ============================================================================\n// Export All Distance Fields\n// ============================================================================\n\nexport const DISTANCE_FIELDS: DataFieldDefinition[] = [\n    distanceTotal,\n    distanceLap,\n    distanceToMarker,\n];\n","/**\n * Time Data Field Definitions\n * \n * All time-related data fields including elapsed, lap, and clock times.\n * \n * @module data-fields/definitions/time-fields\n */\n\nimport type { DataFieldDefinition } from '../types.js';\nimport { isImperial } from '../types.js';\nimport { formatDuration } from '../calculators/common.js';\n\n// ============================================================================\n// Time Field Definitions\n// ============================================================================\n\n/** Elapsed Time - Total workout time */\nexport const timeElapsed: DataFieldDefinition = {\n    id: 'time-elapsed',\n    name: 'Elapsed Time',\n    shortName: 'Time',\n    category: 'time',\n    description: 'Total elapsed time since workout start',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'large',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => workoutState.elapsedTime,\n    formatter: (value) => value !== null ? formatDuration(value) : '--',\n};\n\n/** Lap Time */\nexport const timeLap: DataFieldDefinition = {\n    id: 'time-lap',\n    name: 'Lap Time',\n    shortName: 'Lap',\n    category: 'time',\n    description: 'Elapsed time for current lap',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return 0;\n        return Date.now() - workoutState.lapStartTime;\n    },\n    formatter: (value) => value !== null ? formatDuration(value) : '--',\n};\n\n/** Last Lap Time */\nexport const timeLastLap: DataFieldDefinition = {\n    id: 'time-last-lap',\n    name: 'Last Lap Time',\n    shortName: 'Last Lap',\n    category: 'time',\n    description: 'Duration of the previous lap',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â±ï¸',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => {\n        const laps = workoutState.laps || [];\n        if (laps.length === 0) return null;\n        const lastLap = laps[laps.length - 1];\n        return lastLap.endTime - lastLap.startTime;\n    },\n    formatter: (value) => value !== null ? formatDuration(value) : '--',\n};\n\n/** Time of Day */\nexport const timeClock: DataFieldDefinition = {\n    id: 'time-clock',\n    name: 'Time of Day',\n    shortName: 'Clock',\n    category: 'time',\n    description: 'Current time',\n    unit: null,\n    sourceType: 'system',\n    updateFrequency: 'second',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸ•',\n    decimals: 0,\n    calculator: () => Date.now(),\n    formatter: (value) => {\n        if (value === null) return '--';\n        const date = new Date(value);\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    },\n};\n\n/** Workout Start Time */\nexport const timeStarted: DataFieldDefinition = {\n    id: 'time-started',\n    name: 'Start Time',\n    shortName: 'Start',\n    category: 'time',\n    description: 'Time when workout was started',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸ•',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => workoutState.startTime,\n    formatter: (value) => {\n        if (value === null) return '--';\n        const date = new Date(value);\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    },\n};\n\n/** Estimated Time of Arrival (for target distance) */\nexport const timeEta: DataFieldDefinition = {\n    id: 'time-eta',\n    name: 'ETA',\n    shortName: 'ETA',\n    category: 'time',\n    description: 'Estimated time to complete target distance',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸŽ¯',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState, settings) => {\n        const targetDistance = settings.targetDistance; // in user units\n        if (!targetDistance || targetDistance <= 0) return null;\n\n        // Calculate current distance\n        const positions = measurements.gps;\n        if (positions.length < 2) return null;\n\n        let totalMeters = 0;\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        const currentDistance = isImperial(settings)\n            ? totalMeters / 1609.344\n            : totalMeters / 1000;\n\n        if (currentDistance <= 0) return null;\n\n        const remainingDistance = targetDistance - currentDistance;\n        if (remainingDistance <= 0) return 0;\n\n        // Calculate average speed\n        const elapsedHours = workoutState.elapsedTime / 3600000;\n        if (elapsedHours <= 0) return null;\n\n        const avgSpeed = currentDistance / elapsedHours;\n        if (avgSpeed <= 0) return null;\n\n        // Time remaining in ms\n        const remainingTimeHours = remainingDistance / avgSpeed;\n        return remainingTimeHours * 3600000;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        if (value <= 0) return 'Done!';\n        return formatDuration(value);\n    },\n};\n\n/** Lap Number */\nexport const lapNumber: DataFieldDefinition = {\n    id: 'time-lap-number',\n    name: 'Lap',\n    shortName: 'Lap #',\n    category: 'time',\n    description: 'Current lap number',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸ”¢',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => workoutState.currentLap || 1,\n    formatter: (value) => value !== null ? value.toString() : '--',\n};\n\n/** Sunrise / Sunset */\nexport const timeSunset: DataFieldDefinition = {\n    id: 'time-sunset',\n    name: 'Sunset',\n    shortName: 'Sunset',\n    category: 'time',\n    description: 'Time until sunset',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸŒ…',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements) => {\n        const positions = measurements.gps;\n        if (positions.length === 0) return null;\n\n        const latest = positions[positions.length - 1];\n        const lat = latest.lat;\n\n        // Simplified sunset calculation\n        const now = new Date();\n        const dayOfYear = Math.floor(\n            (now.getTime() - new Date(now.getFullYear(), 0, 0).getTime()) / 86400000\n        );\n\n        // Approximate sunset hour (very simplified)\n        const declination = 23.45 * Math.sin((2 * Math.PI / 365) * (dayOfYear - 81));\n        const hourAngle = Math.acos(\n            -Math.tan(lat * Math.PI / 180) * Math.tan(declination * Math.PI / 180)\n        );\n        const sunsetHour = 12 + (hourAngle * 180 / Math.PI / 15);\n\n        const sunsetTime = new Date(now);\n        sunsetTime.setHours(Math.floor(sunsetHour), Math.round((sunsetHour % 1) * 60), 0);\n\n        return sunsetTime.getTime() - now.getTime();\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        if (value <= 0) return 'Past';\n\n        const hours = Math.floor(value / 3600000);\n        const minutes = Math.floor((value % 3600000) / 60000);\n\n        if (hours > 0) {\n            return `${hours}h ${minutes}m`;\n        }\n        return `${minutes}m`;\n    },\n};\n\n// ============================================================================\n// Export All Time Fields\n// ============================================================================\n\nexport const TIME_FIELDS: DataFieldDefinition[] = [\n    timeElapsed,\n    timeLap,\n    timeLastLap,\n    timeClock,\n    timeStarted,\n    timeEta,\n    lapNumber,\n    timeSunset,\n];\n","/**\n * Elevation Data Field Definitions\n * \n * All elevation-related data fields including current, gain/loss, and grade.\n * \n * @module data-fields/definitions/elevation-fields\n */\n\nimport type { DataFieldDefinition, UserSettings } from '../types.js';\nimport { isImperial } from '../types.js';\nimport { getLatestValue } from '../calculators/common.js';\n\n// ============================================================================\n// Elevation Conversion Helpers\n// ============================================================================\n\n/** Convert meters to feet */\nconst metersToFeet = (meters: number): number => meters * 3.28084;\n\n/** Get elevation in user's preferred unit */\nconst getElevationInUserUnit = (meters: number | null, settings: UserSettings): number | null => {\n    if (meters === null) return null;\n    return isImperial(settings) ? metersToFeet(meters) : meters;\n};\n\n// ============================================================================\n// Elevation Field Definitions\n// ============================================================================\n\n/** Elevation - Current */\nexport const elevationCurrent: DataFieldDefinition = {\n    id: 'elevation-current',\n    name: 'Elevation',\n    shortName: 'Elev',\n    category: 'elevation',\n    description: 'Current elevation above sea level',\n    unit: 'm',\n    sourceType: 'sensor',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'â›°ï¸',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevation = getLatestValue(measurements.altitude);\n        return getElevationInUserUnit(elevation, settings);\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return Math.round(value).toString();\n    },\n};\n\n/** Elevation Gain - Total */\nexport const elevationGain: DataFieldDefinition = {\n    id: 'elevation-gain',\n    name: 'Elevation Gain',\n    shortName: 'Gain',\n    category: 'elevation',\n    description: 'Total elevation gained during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“ˆ',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length < 2) return 0;\n\n        let totalGain = 0;\n        const THRESHOLD = 2; // Minimum elevation change to count (noise filter)\n\n        for (let i = 1; i < elevationData.length; i++) {\n            const prev = elevationData[i - 1].value;\n            const curr = elevationData[i].value;\n            const diff = curr - prev;\n\n            if (diff > THRESHOLD) {\n                totalGain += diff;\n            }\n        }\n\n        return getElevationInUserUnit(totalGain, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Elevation Loss - Total */\nexport const elevationLoss: DataFieldDefinition = {\n    id: 'elevation-loss',\n    name: 'Elevation Loss',\n    shortName: 'Loss',\n    category: 'elevation',\n    description: 'Total elevation lost during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“‰',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length < 2) return 0;\n\n        let totalLoss = 0;\n        const THRESHOLD = 2;\n\n        for (let i = 1; i < elevationData.length; i++) {\n            const prev = elevationData[i - 1].value;\n            const curr = elevationData[i].value;\n            const diff = prev - curr;\n\n            if (diff > THRESHOLD) {\n                totalLoss += diff;\n            }\n        }\n\n        return getElevationInUserUnit(totalLoss, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Elevation - Lap Gain */\nexport const elevationLapGain: DataFieldDefinition = {\n    id: 'elevation-lap-gain',\n    name: 'Lap Elevation Gain',\n    shortName: 'Lap Gain',\n    category: 'elevation',\n    description: 'Elevation gained during current lap',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸ“ˆ',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState, settings) => {\n        if (!workoutState.lapStartTime) return 0;\n\n        const lapData = measurements.altitude.filter(\n            (e) => e.timestamp >= workoutState.lapStartTime!\n        );\n        if (lapData.length < 2) return 0;\n\n        let totalGain = 0;\n        const THRESHOLD = 2;\n\n        for (let i = 1; i < lapData.length; i++) {\n            const diff = lapData[i].value - lapData[i - 1].value;\n            if (diff > THRESHOLD) {\n                totalGain += diff;\n            }\n        }\n\n        return getElevationInUserUnit(totalGain, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Grade - Current */\nexport const gradeCurrent: DataFieldDefinition = {\n    id: 'elevation-grade',\n    name: 'Grade',\n    shortName: 'Grade',\n    category: 'elevation',\n    description: 'Current road gradient (positive = uphill)',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: 'ðŸ“',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    calculator: (measurements) => {\n        const positions = measurements.gps;\n        const elevations = measurements.altitude;\n\n        if (positions.length < 5 || elevations.length < 5) return null;\n\n        // Use last 5 points for smoothing\n        const recentPositions = positions.slice(-5);\n        const recentElevations = elevations.slice(-5);\n\n        // Calculate horizontal distance\n        let horizontalDistance = 0;\n        for (let i = 1; i < recentPositions.length; i++) {\n            const prev = recentPositions[i - 1];\n            const curr = recentPositions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            horizontalDistance += R * c;\n        }\n\n        if (horizontalDistance < 10) return null; // Need at least 10m\n\n        // Calculate vertical change\n        const elevationChange = recentElevations[recentElevations.length - 1].value -\n            recentElevations[0].value;\n\n        // Grade as percentage\n        return (elevationChange / horizontalDistance) * 100;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const sign = value >= 0 ? '+' : '';\n        return `${sign}${value.toFixed(1)}`;\n    },\n    colorizer: (value) => {\n        if (value === null) return null;\n\n        if (value <= -5) {\n            return {\n                zone: 1,\n                zoneName: 'Steep Descent',\n                bg: '#3B82F626',\n                text: '#3B82F6',\n                border: '#3B82F6',\n            };\n        }\n        if (value < 0) {\n            return {\n                zone: 2,\n                zoneName: 'Descent',\n                bg: '#60A5FA26',\n                text: '#60A5FA',\n                border: '#60A5FA',\n            };\n        }\n        if (value < 3) {\n            return {\n                zone: 3,\n                zoneName: 'Flat',\n                bg: '#10B98126',\n                text: '#10B981',\n                border: '#10B981',\n            };\n        }\n        if (value < 6) {\n            return {\n                zone: 4,\n                zoneName: 'Moderate Climb',\n                bg: '#F59E0B26',\n                text: '#F59E0B',\n                border: '#F59E0B',\n            };\n        }\n        if (value < 10) {\n            return {\n                zone: 5,\n                zoneName: 'Steep Climb',\n                bg: '#EF444426',\n                text: '#EF4444',\n                border: '#EF4444',\n            };\n        }\n        return {\n            zone: 6,\n            zoneName: 'Very Steep',\n            bg: '#7C3AED26',\n            text: '#7C3AED',\n            border: '#7C3AED',\n        };\n    },\n};\n\n/** Average Grade - Workout */\nexport const gradeAvg: DataFieldDefinition = {\n    id: 'elevation-grade-avg',\n    name: 'Avg Grade',\n    shortName: 'Avg Grade',\n    category: 'elevation',\n    description: 'Average gradient over entire workout',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸ“',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements) => {\n        const positions = measurements.gps;\n        const elevations = measurements.altitude;\n\n        if (positions.length < 2 || elevations.length < 2) return null;\n\n        // Calculate total horizontal distance\n        let totalDistance = 0;\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalDistance += R * c;\n        }\n\n        if (totalDistance < 100) return null;\n\n        // Total elevation change\n        const elevationChange = elevations[elevations.length - 1].value - elevations[0].value;\n\n        return (elevationChange / totalDistance) * 100;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const sign = value >= 0 ? '+' : '';\n        return `${sign}${value.toFixed(1)}`;\n    },\n};\n\n/** Maximum Elevation */\nexport const elevationMax: DataFieldDefinition = {\n    id: 'elevation-max',\n    name: 'Max Elevation',\n    shortName: 'Max Elev',\n    category: 'elevation',\n    description: 'Highest elevation reached during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'â›°ï¸',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length === 0) return null;\n\n        const maxElevation = Math.max(...elevationData.map((e) => e.value));\n        return getElevationInUserUnit(maxElevation, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Minimum Elevation */\nexport const elevationMin: DataFieldDefinition = {\n    id: 'elevation-min',\n    name: 'Min Elevation',\n    shortName: 'Min Elev',\n    category: 'elevation',\n    description: 'Lowest elevation reached during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: 'ðŸœï¸',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length === 0) return null;\n\n        const minElevation = Math.min(...elevationData.map((e) => e.value));\n        return getElevationInUserUnit(minElevation, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n// ============================================================================\n// Export All Elevation Fields\n// ============================================================================\n\nexport const ELEVATION_FIELDS: DataFieldDefinition[] = [\n    elevationCurrent,\n    elevationGain,\n    elevationLoss,\n    elevationLapGain,\n    gradeCurrent,\n    gradeAvg,\n    elevationMax,\n    elevationMin,\n];\n","import type { DataFieldDefinition, DataFieldCalculator, DataFieldFormatter, WorkoutState, UserSettings } from '../types.js';\nimport type { MeasurementsState } from '../../measurements-state.js';\n\nconst calorieCalculator: DataFieldCalculator = (measurements: MeasurementsState, _workoutState: WorkoutState, settings: UserSettings) => {\n    if (!settings.showCalories) return null;\n    if (!measurements.energy || measurements.energy.length === 0) return 0;\n    return measurements.energy[measurements.energy.length - 1].value;\n};\n\nconst calorieRateCalculator: DataFieldCalculator = (measurements: MeasurementsState, _workoutState: WorkoutState, settings: UserSettings) => {\n    if (!settings.showCalories) return null;\n\n    // If power is present, use Power * 3.6\n    const power = measurements.power.length > 0 ? measurements.power[measurements.power.length - 1].value : 0;\n    if (power > 0) {\n        return power * 3.6;\n    }\n\n    const hr = measurements.heartrate.length > 0 ? measurements.heartrate[measurements.heartrate.length - 1].value : 0;\n    if (hr > 0) {\n        const weight = settings.weight || 75;\n        const age = 30; // Default\n        const termAge = age * 0.2017;\n        const termWeight = weight * 0.1988;\n        const termHr = hr * 0.6309;\n        const calPerMin = (termAge + termWeight + termHr - 55.0969) / 4.184;\n        return Math.max(0, calPerMin * 60);\n    }\n\n    return 0;\n};\n\nconst defaultFormatter: DataFieldFormatter = (value: number | null) => {\n    if (value === null) return '--';\n    return Math.round(value).toString();\n};\n\nexport const energyFields: DataFieldDefinition[] = [\n    {\n        id: 'calories_total',\n        name: 'Calories',\n        shortName: 'Cals',\n        category: 'energy',\n        sourceType: 'calculated',\n        updateFrequency: 'second',\n        description: 'Total energy expenditure in kcal',\n        calculator: calorieCalculator,\n        formatter: defaultFormatter,\n        unit: 'kcal',\n        icon: 'ðŸ”¥',\n        defaultSize: 'medium',\n        supportedSizes: ['small', 'medium', 'large', 'wide', 'tall', 'full']\n    },\n    {\n        id: 'calories_hour',\n        name: 'Calories/Hr',\n        shortName: 'Cal/h',\n        category: 'energy',\n        sourceType: 'calculated',\n        updateFrequency: 'realtime',\n        description: 'Current calorie burn rate',\n        calculator: calorieRateCalculator,\n        formatter: defaultFormatter,\n        unit: 'kcal/h',\n        icon: 'ðŸ”¥',\n        defaultSize: 'medium',\n        supportedSizes: ['small', 'medium', 'large', 'wide', 'tall']\n    }\n];\n","/**\n * Data Fields Module Entry Point\n * \n * Central export for the entire data fields system.\n * Automatically registers all field definitions on import.\n * \n * @module data-fields\n */\n\n// Export core types\nexport * from './types.js';\n\n// Export screen utility functions (types already in types.ts)\nexport {\n    generateSlotId,\n    generateScreenId,\n    generateProfileId,\n    createEmptyScreen,\n    createSlot,\n    createEmptyProfile,\n    addSlotToScreen,\n    removeSlotFromScreen,\n    updateSlot,\n    reorderSlots,\n    addScreenToProfile,\n    removeScreenFromProfile,\n    getActiveScreen,\n    setActiveScreenIndex,\n    nextScreen,\n    previousScreen,\n    validateScreen,\n    validateProfile,\n} from './screens.js';\n\n// Export registry and functions\nexport {\n    registerDataField,\n    registerDataFields,\n    unregisterDataField,\n    clearRegistry,\n    getDataField,\n    hasDataField,\n    getAllDataFields,\n    getFieldCount,\n    getFieldsByCategory,\n    getAllCategories,\n    getCategoriesWithCounts,\n    getFieldsRequiringSensor,\n    getFieldsRequiringGps,\n    getFieldsRequiringWorkout,\n    searchFields,\n    getFieldsByIds,\n} from './registry.js';\n\n// Export calculators\nexport * from './calculators/common.js';\n\n// Export default configurations\nexport {\n    DEFAULT_CYCLING_PROFILE,\n    DEFAULT_INDOOR_PROFILE,\n    DEFAULT_RUNNING_PROFILE,\n    DEFAULT_SIMPLE_PROFILE,\n    DEFAULT_PROFILES,\n    DEFAULT_DATA_FIELD_SETTINGS,\n    SCREEN_PRESETS,\n    createDefaultCyclingProfile,\n    createDefaultIndoorProfile,\n    createDefaultRunningProfile,\n    createDefaultSettings,\n    getDefaultProfileForActivity,\n    migrateFromLegacySettings,\n} from './defaults.js';\n\n// Export CalculationManager\nexport {\n    CalculationManager,\n    createCalculationManager,\n    getGlobalCalculationManager,\n    initGlobalCalculationManager,\n    destroyGlobalCalculationManager,\n} from './CalculationManager.js';\nexport type { FieldUpdateCallback, CalculationManagerConfig } from './CalculationManager.js';\n\n// Export DataFieldsManager\nexport {\n    DataFieldsManager,\n    createDataFieldsManager,\n    initGlobalDataFieldsManager,\n    getGlobalDataFieldsManager,\n} from './DataFieldsManager.js';\nexport type { DataFieldsManagerConfig } from './DataFieldsManager.js';\n\n// Export persistence functions\nexport {\n    loadDataFieldSettings,\n    saveDataFieldSettings,\n    loadProfile,\n    loadActiveProfile,\n    saveProfile,\n    deleteProfile,\n    setActiveProfile,\n    loadFieldPreference,\n    saveFieldPreference,\n    saveActiveScreenIndex,\n    resetToDefaults,\n    resetProfileToDefault,\n    exportSettings,\n    importSettings,\n    exportProfile,\n    importProfile,\n    onStorageChange,\n} from './persistence.js';\n\n// Export individual field definitions for direct access\nexport { POWER_FIELDS } from './definitions/power-fields.js';\nexport { HEARTRATE_FIELDS } from './definitions/heartrate-fields.js';\nexport { CADENCE_FIELDS } from './definitions/cadence-fields.js';\nexport { SPEED_FIELDS } from './definitions/speed-fields.js';\nexport { DISTANCE_FIELDS } from './definitions/distance-fields.js';\nexport { TIME_FIELDS } from './definitions/time-fields.js';\nexport { ELEVATION_FIELDS } from './definitions/elevation-fields.js';\nexport { energyFields as ENERGY_FIELDS } from './definitions/energy-fields.js';\n\n// Import and register all field definitions\nimport { registerDataField } from './registry.js';\nimport { POWER_FIELDS } from './definitions/power-fields.js';\nimport { HEARTRATE_FIELDS } from './definitions/heartrate-fields.js';\nimport { CADENCE_FIELDS } from './definitions/cadence-fields.js';\nimport { SPEED_FIELDS } from './definitions/speed-fields.js';\nimport { DISTANCE_FIELDS } from './definitions/distance-fields.js';\nimport { TIME_FIELDS } from './definitions/time-fields.js';\nimport { ELEVATION_FIELDS } from './definitions/elevation-fields.js';\nimport { energyFields as ENERGY_FIELDS } from './definitions/energy-fields.js';\n\n/**\n * Initialize and register all data fields\n * This is called automatically when this module is imported\n */\nconst initializeDataFields = (): void => {\n    // Register all field definitions\n    const allFields = [\n        ...POWER_FIELDS,\n        ...HEARTRATE_FIELDS,\n        ...CADENCE_FIELDS,\n        ...SPEED_FIELDS,\n        ...DISTANCE_FIELDS,\n        ...TIME_FIELDS,\n        ...ELEVATION_FIELDS,\n        ...ENERGY_FIELDS,\n    ];\n\n    for (const field of allFields) {\n        registerDataField(field);\n    }\n\n    console.log(`[DataFields] Registered ${allFields.length} data fields`);\n};\n\n// Auto-initialize on module load\ninitializeDataFields();\n\n/**\n * Get all registered fields as an array\n */\nexport const getAllFields = (): import('./types.js').DataFieldDefinition[] => {\n    return [\n        ...POWER_FIELDS,\n        ...HEARTRATE_FIELDS,\n        ...CADENCE_FIELDS,\n        ...SPEED_FIELDS,\n        ...DISTANCE_FIELDS,\n        ...TIME_FIELDS,\n        ...ELEVATION_FIELDS,\n        ...ENERGY_FIELDS,\n    ];\n};\n\n/**\n * Summary of available data fields by category\n */\nexport const DATA_FIELD_SUMMARY = {\n    power: POWER_FIELDS.length,\n    heartrate: HEARTRATE_FIELDS.length,\n    cadence: CADENCE_FIELDS.length,\n    speed: SPEED_FIELDS.length,\n    distance: DISTANCE_FIELDS.length,\n    time: TIME_FIELDS.length,\n    elevation: ELEVATION_FIELDS.length,\n    energy: ENERGY_FIELDS.length,\n    total: POWER_FIELDS.length +\n        HEARTRATE_FIELDS.length +\n        CADENCE_FIELDS.length +\n        SPEED_FIELDS.length +\n        DISTANCE_FIELDS.length +\n        TIME_FIELDS.length +\n        ELEVATION_FIELDS.length +\n        ENERGY_FIELDS.length,\n};\n","/**\n * Data Field Web Component\n * \n * Renders a single data field with configurable size, styling, and behavior.\n * Supports zone-based coloring, unit conversion, and responsive sizing.\n * \n * @example\n * ```html\n * <bpt-data-field field-id=\"power-current\" size=\"large\"></bpt-data-field>\n * ```\n * \n * @module components/data-fields/DataFieldComponent\n */\n\nimport { getDataField } from '../../data-fields/index.js';\nimport type { DataFieldDefinition, DataFieldSize, UserSettings, ZoneColor } from '../../data-fields/types.js';\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Custom element for displaying a single data field\n */\nexport class DataFieldComponent extends HTMLElement {\n    static get observedAttributes(): string[] {\n        return ['field-id', 'size', 'value', 'connected', 'highlight'];\n    }\n\n    private fieldDefinition: DataFieldDefinition | null = null;\n    private currentValue: number | null = null;\n    private settings: UserSettings | null = null;\n    private shadow: ShadowRoot;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n    }\n\n    disconnectedCallback(): void {\n        // Cleanup if needed\n    }\n\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue === newValue) return;\n\n        switch (name) {\n            case 'field-id':\n                this.fieldDefinition = newValue ? getDataField(newValue) ?? null : null;\n                this.render();\n                break;\n            case 'size':\n                this.updateSize(newValue as DataFieldSize);\n                break;\n            case 'value':\n                this.updateValue(newValue);\n                break;\n            case 'connected':\n                this.updateConnectionState(newValue === 'true');\n                break;\n            case 'highlight':\n                this.updateHighlight(newValue === 'true');\n                break;\n        }\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Set user settings for formatting and unit conversion\n     */\n    public setSettings(settings: UserSettings): void {\n        this.settings = settings;\n        this.updateDisplay();\n    }\n\n    /**\n     * Update the field value programmatically\n     */\n    public setValue(value: number | null): void {\n        this.currentValue = value;\n        this.updateDisplay();\n    }\n\n    /**\n     * Get the current field ID\n     */\n    public getFieldId(): string | null {\n        return this.getAttribute('field-id');\n    }\n\n    /**\n     * Get the current value\n     */\n    public getValue(): number | null {\n        return this.currentValue;\n    }\n\n    /**\n     * Get the field definition\n     */\n    public getFieldDefinition(): DataFieldDefinition | null {\n        return this.fieldDefinition;\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        const size = (this.getAttribute('size') || this.fieldDefinition?.defaultSize || 'medium') as DataFieldSize;\n        const connected = this.getAttribute('connected') !== 'false';\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"data-field data-field--${size} ${!connected ? 'data-field--disconnected' : ''}\"\n                 data-category=\"${this.fieldDefinition?.category || 'unknown'}\">\n                ${this.renderContent(size)}\n            </div>\n        `;\n\n        this.updateDisplay();\n    }\n\n    private renderContent(size: DataFieldSize): string {\n        if (!this.fieldDefinition) {\n            return `\n                <div class=\"data-field__error\">\n                    <span class=\"data-field__error-icon\">âš ï¸</span>\n                    <span class=\"data-field__error-text\">Unknown field</span>\n                </div>\n            `;\n        }\n\n        const showLabel = size !== 'small';\n        const showIcon = size === 'small' || size === 'medium';\n\n        return `\n            ${showLabel ? `\n                <div class=\"data-field__header\">\n                    ${showIcon ? `<span class=\"data-field__icon\">${this.fieldDefinition.icon}</span>` : ''}\n                    <span class=\"data-field__label\">${this.fieldDefinition.shortName}</span>\n                </div>\n            ` : ''}\n            <div class=\"data-field__body\">\n                <span class=\"data-field__value\" data-value=\"--\">--</span>\n                ${this.fieldDefinition.unit ? `\n                    <span class=\"data-field__unit\">${this.getDisplayUnit()}</span>\n                ` : ''}\n            </div>\n            ${size === 'small' ? `\n                <span class=\"data-field__mini-label\">${this.fieldDefinition.shortName}</span>\n            ` : ''}\n        `;\n    }\n\n    private getDisplayUnit(): string {\n        if (!this.fieldDefinition) return '';\n\n        // Check for imperial unit override\n        if (this.settings && this.fieldDefinition.unitImperial) {\n            const isImperial = this.settings.unitSystem === 'imperial';\n            return isImperial ? this.fieldDefinition.unitImperial : (this.fieldDefinition.unit || '');\n        }\n\n        return this.fieldDefinition.unit || '';\n    }\n\n    // ========================================================================\n    // Updates\n    // ========================================================================\n\n    private updateValue(rawValue: string | null): void {\n        if (rawValue === null || rawValue === '--') {\n            this.currentValue = null;\n        } else {\n            this.currentValue = parseFloat(rawValue);\n            if (isNaN(this.currentValue)) {\n                this.currentValue = null;\n            }\n        }\n        this.updateDisplay();\n    }\n\n    private updateDisplay(): void {\n        const valueEl = this.shadow.querySelector('.data-field__value');\n        if (!valueEl || !this.fieldDefinition) return;\n\n        // Format the value\n        const formattedValue = this.fieldDefinition.formatter(\n            this.currentValue,\n            this.settings || this.getDefaultSettings()\n        );\n\n        valueEl.textContent = formattedValue;\n        valueEl.setAttribute('data-value', formattedValue);\n\n        // Apply zone coloring if available\n        this.updateZoneColoring();\n\n        // Update unit display\n        const unitEl = this.shadow.querySelector('.data-field__unit');\n        if (unitEl) {\n            unitEl.textContent = this.getDisplayUnit();\n        }\n    }\n\n    private updateZoneColoring(): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl || !this.fieldDefinition) return;\n\n        // Remove existing zone classes\n        fieldEl.classList.remove(\n            'data-field--zone-1', 'data-field--zone-2', 'data-field--zone-3',\n            'data-field--zone-4', 'data-field--zone-5', 'data-field--zone-6',\n            'data-field--zone-7'\n        );\n\n        // Apply colorizer if available\n        if (this.fieldDefinition.colorizer && this.currentValue !== null) {\n            const colors = this.fieldDefinition.colorizer(\n                this.currentValue,\n                this.settings || this.getDefaultSettings()\n            );\n\n            if (colors) {\n                this.applyZoneColors(colors);\n            }\n        }\n    }\n\n    private applyZoneColors(colors: ZoneColor): void {\n        const fieldEl = this.shadow.querySelector('.data-field') as HTMLElement;\n        if (!fieldEl) return;\n\n        fieldEl.style.setProperty('--field-bg', colors.bg);\n        fieldEl.style.setProperty('--field-text', colors.text);\n        fieldEl.style.setProperty('--field-border', colors.border);\n        fieldEl.classList.add('data-field--has-zone');\n    }\n\n    private updateSize(size: DataFieldSize | null): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl) return;\n\n        // Remove existing size classes\n        fieldEl.classList.remove(\n            'data-field--small', 'data-field--medium', 'data-field--large',\n            'data-field--wide', 'data-field--tall', 'data-field--full'\n        );\n\n        // Add new size class\n        const newSize = size || this.fieldDefinition?.defaultSize || 'medium';\n        fieldEl.classList.add(`data-field--${newSize}`);\n\n        // Re-render content if size changes label visibility\n        this.render();\n    }\n\n    private updateConnectionState(connected: boolean): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl) return;\n\n        fieldEl.classList.toggle('data-field--disconnected', !connected);\n    }\n\n    private updateHighlight(highlight: boolean): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl) return;\n\n        fieldEl.classList.toggle('data-field--highlight', highlight);\n    }\n\n    // ========================================================================\n    // Default Settings\n    // ========================================================================\n\n    private getDefaultSettings(): UserSettings {\n        return {\n            ftp: 200,\n            maxHr: 185,\n            weight: 70,\n            restingHr: 60,\n            unitSystem: 'metric',\n            showCalories: true,\n            powerZones: [],\n            hrZones: [],\n        };\n    }\n\n    // ========================================================================\n    // Styles\n    // ========================================================================\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n                contain: content;\n            }\n\n            .data-field {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: var(--field-padding, 8px);\n                border-radius: var(--field-radius, 8px);\n                background: var(--field-bg, var(--surface-color, #1a1a2e));\n                border-left: 4px solid var(--field-border, transparent);\n                color: var(--field-text, var(--text-color, #fff));\n                transition: all 0.2s ease;\n                height: 100%;\n                box-sizing: border-box;\n                position: relative;\n                overflow: hidden;\n            }\n\n            .data-field--has-zone {\n                background: var(--field-bg);\n                color: var(--field-text);\n                border-left-color: var(--field-border);\n            }\n\n            .data-field--disconnected {\n                opacity: 0.5;\n            }\n\n            .data-field--highlight {\n                animation: pulse 1s ease-in-out infinite;\n            }\n\n            @keyframes pulse {\n                0%, 100% { transform: scale(1); }\n                50% { transform: scale(1.02); }\n            }\n\n            /* Header */\n            .data-field__header {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                margin-bottom: 4px;\n                opacity: 0.8;\n            }\n\n            .data-field__icon {\n                font-size: 14px;\n            }\n\n            .data-field__label {\n                font-size: 11px;\n                font-weight: 500;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n            }\n\n            /* Body */\n            .data-field__body {\n                display: flex;\n                align-items: baseline;\n                gap: 4px;\n            }\n\n            .data-field__value {\n                font-variant-numeric: tabular-nums;\n                font-weight: 700;\n                line-height: 1;\n            }\n\n            .data-field__unit {\n                font-size: 12px;\n                font-weight: 400;\n                opacity: 0.7;\n            }\n\n            .data-field__mini-label {\n                font-size: 9px;\n                text-transform: uppercase;\n                opacity: 0.6;\n                margin-top: 2px;\n            }\n\n            /* Size variants */\n            .data-field--small {\n                min-width: 70px;\n                min-height: 55px;\n                padding: 6px;\n            }\n\n            .data-field--small .data-field__value {\n                font-size: 24px;\n            }\n\n            .data-field--small .data-field__unit {\n                font-size: 10px;\n            }\n\n            .data-field--medium {\n                min-width: 100px;\n                min-height: 80px;\n            }\n\n            .data-field--medium .data-field__value {\n                font-size: 32px;\n            }\n\n            .data-field--large {\n                min-width: 160px;\n                min-height: 100px;\n                padding: 12px;\n            }\n\n            .data-field--large .data-field__header {\n                margin-bottom: 8px;\n            }\n\n            .data-field--large .data-field__icon {\n                font-size: 18px;\n            }\n\n            .data-field--large .data-field__label {\n                font-size: 13px;\n            }\n\n            .data-field--large .data-field__value {\n                font-size: 48px;\n            }\n\n            .data-field--large .data-field__unit {\n                font-size: 16px;\n            }\n\n            .data-field--wide {\n                min-width: 200px;\n                min-height: 80px;\n                flex-direction: row;\n                justify-content: space-between;\n                padding: 12px 16px;\n            }\n\n            .data-field--wide .data-field__header {\n                margin-bottom: 0;\n            }\n\n            .data-field--wide .data-field__value {\n                font-size: 36px;\n            }\n\n            .data-field--tall {\n                min-width: 100px;\n                min-height: 160px;\n            }\n\n            .data-field--tall .data-field__value {\n                font-size: 40px;\n            }\n\n            .data-field--full {\n                min-width: 200px;\n                min-height: 160px;\n                padding: 16px;\n            }\n\n            .data-field--full .data-field__value {\n                font-size: 56px;\n            }\n\n            /* Error state */\n            .data-field__error {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n                color: var(--error-color, #ff6b6b);\n            }\n\n            .data-field__error-icon {\n                font-size: 24px;\n            }\n\n            .data-field__error-text {\n                font-size: 11px;\n            }\n\n            /* Category-specific accent colors */\n            .data-field[data-category=\"power\"] {\n                --category-accent: #ffd700;\n            }\n\n            .data-field[data-category=\"heartrate\"] {\n                --category-accent: #ff6b6b;\n            }\n\n            .data-field[data-category=\"cadence\"] {\n                --category-accent: #4ecdc4;\n            }\n\n            .data-field[data-category=\"speed\"] {\n                --category-accent: #45b7d1;\n            }\n\n            .data-field[data-category=\"distance\"] {\n                --category-accent: #96ceb4;\n            }\n\n            .data-field[data-category=\"elevation\"] {\n                --category-accent: #a8e6cf;\n            }\n\n            .data-field[data-category=\"time\"] {\n                --category-accent: #dda0dd;\n            }\n\n            /* Touch feedback */\n            @media (hover: hover) {\n                .data-field:hover {\n                    transform: translateY(-1px);\n                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                }\n            }\n\n            .data-field:active {\n                transform: scale(0.98);\n            }\n        `;\n    }\n}\n\n// ============================================================================\n// Register Custom Element\n// ============================================================================\n\nif (!customElements.get('bpt-data-field')) {\n    customElements.define('bpt-data-field', DataFieldComponent);\n}\n\nexport default DataFieldComponent;\n"],"names":["calculateRollingAverage","measurements","windowMs","referenceTime","windowStart","windowValues","m","acc","calculateAverage","calculateMax","getLatestValue","maxAge","latest","getZoneForValue","value","referenceValue","zones","percent","zone","highestZone","getZoneColor","zoneNum","zoneConfig","z","hexToRgba","darkenColor","calculatePercentOfReference","hex","alpha","result","r","g","b","factor","formatDuration","ms","showHours","totalSeconds","hours","minutes","seconds","formatPace","speedMs","imperial","secondsPerUnit","powerZoneColorizer","settings","DEFAULT_POWER_ZONES","powerCurrent","power3s","power10s","power30s","powerAvg","powerLapAvg","workoutState","lapMeasurements","powerMax","powerZone","_workoutState","power","powerPercentFtp","powerNormalized","powerData","thirtySecondAverages","windowSize","windowEnd","p","avg","s","fourthPowers","v","avgFourthPower","intensityFactor","npCalc","np","tss","durationSeconds","ifValue","kilojoules","totalJoules","i","prev","curr","timeDeltaSeconds","avgPower","wattsPerKg","POWER_FIELDS","hrZoneColorizer","DEFAULT_HR_ZONES","hrCurrent","hr5s","hr30s","hrAvg","hrLapAvg","hrMax","hrMin","data","d","hrZone","hr","hrPercentMax","hrPercentReserve","reserve","caloriesFromHr","hrData","totalCalories","timeDeltaMinutes","caloriesPerMinute","hrTimeInZone","timeInZones","timeDelta","avgHr","HEARTRATE_FIELDS","CADENCE_RANGES","CADENCE_COLORS","getCadenceColor","cadence","cadenceCurrent","cadence5s","cadence30s","cadenceAvg","nonZeroData","cadenceLapAvg","cadenceMax","cadenceZone","names","colors","pedalBalance","deviation","pedalingTime","cadenceData","totalTime","totalRevolutions","totalRevs","avgCadence","CADENCE_FIELDS","msToKmh","msToMph","getSpeedInUserUnit","isImperial","getPaceInUserUnit","kmh","minPerKm","speedCurrent","speed","speed5s","avgMs","speed30s","speedAvg","movingData","speedLapAvg","speedMax","maxMs","paceCurrent","paceAvg","movingTime","speedData","movingMs","MOVING_THRESHOLD","secs","stoppedTime","stoppedMs","verticalSpeed","elevationData","now","recentData","e","first","last","elevationGain","timeDeltaHours","efficiencyFactor","movingSpeedData","avgSpeedMs","avgSpeedKmh","SPEED_FIELDS","metersToKm","meters","metersToMiles","getDistanceInUserUnit","distanceTotal","positions","totalMeters","R","lat1","lat2","deltaLat","deltaLon","a","c","distanceLap","lapPositions","distanceToMarker","totalUnits","DISTANCE_FIELDS","timeElapsed","_measurements","timeLap","timeLastLap","laps","lastLap","timeClock","timeStarted","timeEta","targetDistance","currentDistance","remainingDistance","elapsedHours","avgSpeed","lapNumber","timeSunset","lat","dayOfYear","declination","sunsetHour","sunsetTime","TIME_FIELDS","metersToFeet","getElevationInUserUnit","elevationCurrent","elevation","totalGain","THRESHOLD","diff","elevationLoss","totalLoss","elevationLapGain","lapData","gradeCurrent","elevations","recentPositions","recentElevations","horizontalDistance","gradeAvg","totalDistance","elevationMax","maxElevation","elevationMin","minElevation","ELEVATION_FIELDS","calorieCalculator","calorieRateCalculator","weight","termAge","termWeight","termHr","calPerMin","defaultFormatter","energyFields","initializeDataFields","allFields","ENERGY_FIELDS","field","registerDataField","DataFieldComponent","name","oldValue","newValue","getDataField","size","connected","rawValue","valueEl","formattedValue","unitEl","fieldEl","newSize","highlight"],"mappings":"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"}