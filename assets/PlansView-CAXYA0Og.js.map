{"version":3,"file":"PlansView-CAXYA0Og.js","sources":["../../src/views/PlansView.ts"],"sourcesContent":["import { View } from '../router/View.js';\nimport { ViewId } from '../router/view-ids.js';\nimport { planRepository, type PlanProgress } from '../plans/planRepository.js';\nimport type { TrainingPlan, PlanWeek, PlanDay } from '../plans/types.js';\nimport { formatDuration } from '../utils/formatters.js';\nimport { startStructuredWorkout } from '../ui/workoutPlayer.js';\nimport { WORKOUT_LIBRARY } from '../workouts/workoutLibrary.js';\nimport { getCustomWorkouts } from '../storage/customWorkouts.js';\nimport type { StructuredWorkout, WorkoutStep } from '../workouts/types.js';\n\nexport class PlansView implements View {\n    public id = ViewId.Plans;\n    private container: HTMLElement | null = null;\n\n    public init(container: HTMLElement): void {\n        this.container = container;\n        this.render();\n    }\n\n    public onEnter(): void {\n        console.log('Entered Plans View');\n        this.render();\n    }\n\n    public onLeave(): void {\n        console.log('Left Plans View');\n    }\n\n    private render(): void {\n        if (!this.container) return;\n\n        // Simple state checking to see if we are viewing details\n        // For now, simpler to just always render dashboard, and handle details via innerHTML replacement\n        // Ideally we would have sub-routes like /plans/:id\n        this.renderDashboard();\n    }\n\n    private renderDashboard() {\n        if (!this.container) return;\n        const activeProgress = planRepository.getActiveProgress();\n        const plans = planRepository.getAllPlans();\n\n        let html = `\n            <div class=\"page-header\" style=\"padding: 16px; border-bottom: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center;\">\n                <h2>üìÖ Training Plans</h2>\n            </div>\n            <div class=\"page-content\" style=\"padding: 16px;\">\n        `;\n\n        // Active Plan Section\n        if (activeProgress) {\n            const activePlan = planRepository.getPlan(activeProgress.planId);\n            if (activePlan) {\n                html += this.renderActivePlan(activePlan, activeProgress);\n            }\n        }\n\n        // Available Plans Section\n        html += `\n            <h3>Available Plans</h3>\n            <div class=\"plans-list\" style=\"display: grid; gap: 16px; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\">\n                ${plans.map((plan) => this.renderPlanCard(plan, activeProgress?.planId === plan.id)).join('')}\n            </div>\n        </div>`;\n\n        this.container.innerHTML = html;\n        this.attachListeners(this.container);\n    }\n\n    private renderActivePlan(plan: TrainingPlan, progress: PlanProgress): string {\n        const daysSinceStart = Math.floor((Date.now() - progress.startDate) / (1000 * 60 * 60 * 24));\n        const currentWeekNum = Math.floor(daysSinceStart / 7) + 1;\n        const currentDayNum = (daysSinceStart % 7) + 1;\n\n        return `\n            <div class=\"active-plan-card\" style=\"background: var(--card-bg); padding: 16px; border-radius: 8px; margin-bottom: 24px; border: 2px solid var(--color-primary);\">\n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px;\">\n                    <h3 style=\"margin: 0;\">Currently Following: ${plan.name}</h3>\n                    <span class=\"status-badge\" style=\"background: var(--color-primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;\">Active</span>\n                </div>\n                <p><strong>Week ${currentWeekNum}, Day ${currentDayNum}</strong></p>\n                <div style=\"margin-top: 12px;\">\n                    <button class=\"workout-btn btn-stop-plan\" data-id=\"${plan.id}\" style=\"background: var(--color-error); font-size: 0.9em;\">Stop Plan</button>\n                    <button class=\"workout-btn btn-view-plan\" data-id=\"${plan.id}\" style=\"font-size: 0.9em;\">View Schedule</button>\n                </div>\n            </div>\n        `;\n    }\n\n    private renderPlanCard(plan: TrainingPlan, isActive: boolean): string {\n        return `\n            <div class=\"plan-card\" style=\"background: var(--card-bg); padding: 16px; border-radius: 8px; border: 1px solid var(--color-border); ${isActive ? 'opacity: 0.6;' : ''}\">\n                <h4 style=\"margin: 0 0 8px 0;\">${plan.name}</h4>\n                <div style=\"font-size: 0.9em; color: var(--color-text-secondary); margin-bottom: 12px;\">\n                    ${plan.weeks.length} Weeks ‚Ä¢ ${plan.difficulty || 'Intermediate'}\n                </div>\n                <p style=\"font-size: 0.9em; margin-bottom: 16px; line-height: 1.4;\">${plan.description}</p>\n                <button class=\"workout-btn btn-view-plan\" data-id=\"${plan.id}\" style=\"width: 100%;\">View Details</button>\n            </div>\n        `;\n    }\n\n    private renderDetails(planId: string) {\n        if (!this.container) return;\n        const plan = planRepository.getPlan(planId);\n        if (!plan) return;\n\n        const progress = planRepository.getActiveProgress();\n        const isActive = progress?.planId === planId;\n\n        let html = `\n            <div class=\"page-header\" style=\"padding: 16px; border-bottom: 1px solid var(--color-border); display: flex; gap: 8px; align-items: center;\">\n                <button class=\"btn-back-plans\" style=\"background: none; border: none; font-size: 1.2em; cursor: pointer;\">‚Üê</button>\n                <h2 style=\"margin: 0;\">${plan.name}</h2>\n            </div>\n            <div class=\"page-content\" style=\"padding: 16px;\">\n                <p>${plan.description}</p>\n                \n                <div style=\"margin: 16px 0;\">\n                    ${\n                        isActive\n                            ? `<button class=\"workout-btn btn-stop-plan\" data-id=\"${plan.id}\" style=\"background: var(--color-error);\">Stop Plan</button>`\n                            : `<button class=\"workout-btn btn-start-plan\" data-id=\"${plan.id}\" style=\"background: var(--color-success);\">Start Plan</button>`\n                    }\n                </div>\n    \n                <div class=\"plan-weeks\">\n                    ${plan.weeks.map((week) => this.renderWeek(week, isActive ? progress : null)).join('')}\n                </div>\n            </div>\n        `;\n\n        this.container.innerHTML = html;\n        this.attachListeners(this.container, planId);\n    }\n\n    private renderWeek(week: PlanWeek, progress: PlanProgress | null): string {\n        return `\n            <div class=\"plan-week\" style=\"margin-bottom: 20px;\">\n                <h4 style=\"background: var(--bg-secondary); padding: 8px; border-radius: 4px; margin-bottom: 8px;\">\n                    Week ${week.weekNumber}: ${week.focus || ''}\n                </h4>\n                <div class=\"week-days\" style=\"display: grid; gap: 8px;\">\n                    ${week.days.map((day) => this.renderDay(day, week.weekNumber, progress)).join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    private renderDay(day: PlanDay, weekNum: number, progress: PlanProgress | null): string {\n        const isComplete = progress ? progress.completedDays[`${weekNum}-${day.dayOfWeek}`] : false;\n\n        let isToday = false;\n        if (progress) {\n            const daysSinceStart = Math.floor((Date.now() - progress.startDate) / (1000 * 60 * 60 * 24));\n            const currentDayAbsolute = daysSinceStart + 1;\n            const thisDayAbsolute = (weekNum - 1) * 7 + day.dayOfWeek;\n            if (currentDayAbsolute === thisDayAbsolute) isToday = true;\n        }\n\n        let content = '';\n        if (day.isRestDay) {\n            content = `<em>Rest Day</em> ${day.notes ? `- ${day.notes}` : ''}`;\n        } else if (day.workout) {\n            content = `<strong>${day.workout.name}</strong><br><span style=\"font-size: 0.85em; color: var(--color-text-secondary);\">${formatDuration(this.getTotalDuration(day.workout))}</span>`;\n        } else {\n            content = `Workout ID: ${day.workoutId}`;\n        }\n\n        return `\n            <div class=\"plan-day\" style=\"\n                padding: 12px; \n                border: 1px solid var(--color-border); \n                border-radius: 6px; \n                display: flex; \n                align-items: center; \n                gap: 12px;\n                background: ${isToday ? 'var(--bg-highlight, rgba(33, 150, 243, 0.1))' : 'var(--card-bg)'};\n                ${isToday ? 'border-color: var(--color-primary);' : ''}\n            \">\n                <div style=\"\n                    width: 24px; height: 24px; \n                    border-radius: 50%; \n                    background: ${isComplete ? 'var(--color-success)' : '#ccc'}; \n                    color: white;\n                    display: flex; align-items: center; justify-content: center;\n                    font-size: 0.8em;\n                \">${day.dayOfWeek}</div>\n                \n                <div style=\"flex: 1;\">${content}</div>\n    \n                ${\n                    !day.isRestDay && day.workout\n                        ? `\n                    <button class=\"workout-btn btn-preview-workout\" style=\"padding: 4px 8px; font-size: 0.8em;\">Preview</button>\n                    ${progress && !isComplete ? `<button class=\"workout-btn btn-do-workout\" data-week=\"${weekNum}\" data-day=\"${day.dayOfWeek}\" style=\"margin-left:8px; padding: 4px 8px; font-size: 0.8em; background: var(--color-primary);\">Start</button>` : ''}\n                `\n                        : ''\n                }\n            </div>\n        `;\n    }\n\n    private getTotalDuration(workout: StructuredWorkout): number {\n        return workout.steps.reduce((sum: number, step: WorkoutStep) => sum + step.duration, 0);\n    }\n\n    private attachListeners(container: HTMLElement, currentDetailId?: string) {\n        container.onclick = (e) => {\n            const target = e.target as HTMLElement;\n\n            if (target.classList.contains('btn-view-plan')) {\n                const id = target.dataset.id;\n                if (id) this.renderDetails(id);\n            }\n\n            if (target.classList.contains('btn-back-plans')) {\n                this.renderDashboard();\n            }\n\n            if (target.classList.contains('btn-start-plan')) {\n                const id = target.dataset.id;\n                if (id && confirm('Start this training plan? This will become your active plan.')) {\n                    planRepository.startPlan(id);\n                    this.renderDetails(id); // Re-render to show stop button\n                }\n            }\n\n            if (target.classList.contains('btn-stop-plan')) {\n                if (confirm('Are you sure you want to stop the current plan? Progress will be lost.')) {\n                    planRepository.stopActivePlan();\n                    if (currentDetailId) {\n                        this.renderDetails(currentDetailId);\n                    } else {\n                        this.renderDashboard();\n                    }\n                }\n            }\n\n            if (target.classList.contains('btn-do-workout')) {\n                const weekNum = parseInt(target.dataset.week || '0');\n                const dayNum = parseInt(target.dataset.day || '0');\n\n                const progress = planRepository.getActiveProgress();\n                if (!progress) return;\n\n                const plan = planRepository.getPlan(progress.planId);\n                if (!plan) return;\n\n                const week = plan.weeks.find((w) => w.weekNumber === weekNum);\n                const day = week?.days.find((d) => d.dayOfWeek === dayNum);\n\n                if (day) {\n                    let workout: StructuredWorkout | undefined = day.workout;\n\n                    if (!workout && day.workoutId) {\n                        // Resolve ID\n                        workout =\n                            WORKOUT_LIBRARY.find((w) => w.id === day.workoutId) ||\n                            getCustomWorkouts().find((w) => w.id === day.workoutId);\n                    }\n\n                    if (workout) {\n                        startStructuredWorkout(workout, () => {\n                            planRepository.markDayComplete(weekNum, dayNum);\n                            // Refresh view to show progress\n                            this.render();\n                        });\n                    } else {\n                        alert('Workout definition not found!');\n                    }\n                }\n            }\n        };\n    }\n}\n"],"names":["PlansView","ViewId","container","activeProgress","planRepository","plans","html","activePlan","plan","progress","daysSinceStart","currentWeekNum","currentDayNum","isActive","planId","week","day","weekNum","isComplete","isToday","currentDayAbsolute","thisDayAbsolute","content","formatDuration","workout","sum","step","currentDetailId","e","target","id","dayNum","w","d","WORKOUT_LIBRARY","getCustomWorkouts","startStructuredWorkout"],"mappings":"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"}