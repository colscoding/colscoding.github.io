{"version":3,"file":"PowerGauge-Bf290PO8.js","sources":["../../src/components/PowerGauge.ts"],"sourcesContent":["/**\n * Power Gauge Component\n *\n * A circular gauge Web Component for displaying power output with zone visualization.\n * Shows current power, target zone, and provides visual feedback.\n *\n * @example\n * ```html\n * <bpt-power-gauge\n *   value=\"250\"\n *   ftp=\"280\"\n *   max=\"500\"\n *   show-zones=\"true\">\n * </bpt-power-gauge>\n * ```\n *\n * @module PowerGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\nimport { sharedStyles } from './styles/shared.js';\nimport { elementCache } from '../utils/elementCache.js';\n\n/**\n * Power zone definitions (Coggan 7-zone model)\n */\nconst POWER_ZONES = [\n    { name: 'Recovery', min: 0, max: 0.55 },\n    { name: 'Endurance', min: 0.55, max: 0.75 },\n    { name: 'Tempo', min: 0.75, max: 0.9 },\n    { name: 'Threshold', min: 0.9, max: 1.05 },\n    { name: 'VO2 Max', min: 1.05, max: 1.2 },\n    { name: 'Anaerobic', min: 1.2, max: 1.5 },\n    { name: 'Neuromuscular', min: 1.5, max: 99.9 },\n];\n\n/**\n * Power Gauge Web Component\n */\nexport class PowerGauge extends BaseComponent {\n    private animationFrame: number | null = null;\n    private currentDisplayValue = 0;\n\n    static get observedAttributes(): string[] {\n        return ['value', 'ftp', 'max', 'show-zones', 'size'];\n    }\n\n    protected getStyles(): string {\n        return `\n            ${sharedStyles}\n\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                --gauge-size: 200px;\n                /* Default to accent color if no zone */\n                --gauge-color: var(--color-primary-500); \n            }\n            \n            .gauge-container {\n                position: relative;\n                width: var(--gauge-size);\n                height: var(--gauge-size);\n            }\n            \n            .gauge-svg {\n                width: 100%;\n                height: 100%;\n                transform: rotate(-135deg);\n            }\n            \n            .gauge-background {\n                fill: none;\n                stroke: var(--bg-tertiary);\n                stroke-width: 12;\n                stroke-linecap: round;\n            }\n            \n            .gauge-zone {\n                fill: none;\n                stroke-width: 12;\n                stroke-linecap: round;\n                opacity: 0.3;\n                transition: opacity var(--transition-normal);\n            }\n            \n            .gauge-zone.active {\n                opacity: 1;\n            }\n            \n            /* Zone Colors binding via CSS variables */\n            .gauge-zone[data-zone=\"1\"] { stroke: var(--zone-1-color); }\n            .gauge-zone[data-zone=\"2\"] { stroke: var(--zone-2-color); }\n            .gauge-zone[data-zone=\"3\"] { stroke: var(--zone-3-color); }\n            .gauge-zone[data-zone=\"4\"] { stroke: var(--zone-4-color); }\n            .gauge-zone[data-zone=\"5\"] { stroke: var(--zone-5-color); }\n            .gauge-zone[data-zone=\"6\"] { stroke: var(--zone-6-color); }\n            .gauge-zone[data-zone=\"7\"] { stroke: var(--zone-7-color); }\n            \n            .gauge-value-arc {\n                fill: none;\n                stroke: var(--gauge-color);\n                stroke-width: 14;\n                stroke-linecap: round;\n                transition: stroke var(--transition-normal);\n            }\n            \n            .gauge-center {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                text-align: center;\n            }\n            \n            .gauge-value {\n                font-size: calc(var(--gauge-size) * 0.2);\n                font-weight: var(--font-weight-bold);\n                color: var(--gauge-color, var(--text-primary));\n                line-height: 1;\n                transition: color var(--transition-normal);\n            }\n            \n            .gauge-unit {\n                font-size: calc(var(--gauge-size) * 0.08);\n                color: var(--text-secondary);\n            }\n            \n            .gauge-zone-label {\n                font-size: calc(var(--gauge-size) * 0.07);\n                color: var(--gauge-color, var(--text-secondary));\n                margin-top: var(--space-1);\n                font-weight: var(--font-weight-medium);\n                transition: color var(--transition-normal);\n            }\n            \n            .gauge-ftp {\n                font-size: calc(var(--gauge-size) * 0.06);\n                color: var(--text-tertiary);\n                margin-top: 2px;\n            }\n            \n            /* Animation */\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n            \n            .gauge-value-arc.high-power {\n                animation: pulse 0.5s ease-in-out infinite;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const size = parseInt(this.getAttribute('size') || '200', 10);\n        this.style.setProperty('--gauge-size', `${size}px`);\n\n        const value = parseInt(this.getAttribute('value') || '0', 10);\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n        const showZones = this.getAttribute('show-zones') !== 'false';\n\n        const radius = 80;\n        const circumference = 2 * Math.PI * radius;\n        const arcLength = circumference * 0.75; // 270 degrees\n\n        // Calculate the current zone and color\n        const ftpPercent = ftp > 0 ? value / ftp : 0;\n        const _zone = this.getZone(ftpPercent);\n\n        // Map internal zone object back to zone number (1-7)\n        // This is a bit of a hack since getZone returns the object from the local POWER_ZONES array\n        // We really should unify the data structures more deeply, but for now we just want styling\n        // We can infer the zone number by finding the index + 1\n        const zoneIndex = _zone ? POWER_ZONES.indexOf(_zone) : -1;\n        const zoneNumber = zoneIndex >= 0 ? zoneIndex + 1 : 0;\n\n        let zoneColorVar = 'var(--color-primary-500)';\n        if (zoneNumber > 0) {\n            zoneColorVar = `var(--zone-${zoneNumber}-color)`;\n        }\n\n        // Calculate arc progress\n        const progress = Math.min(value / max, 1);\n        const dashOffset = arcLength * (1 - progress);\n\n        // Update CSS variable on the host for color\n        this.style.setProperty('--gauge-color', zoneColorVar);\n\n        return `\n            <div class=\"gauge-container\">\n                <svg class=\"gauge-svg\" viewBox=\"0 0 200 200\">\n                    <!-- Background arc -->\n                    <circle \n                        class=\"gauge-background\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                    />\n                    \n                    ${showZones ? this.renderZoneArcs(radius, arcLength, circumference, ftpPercent) : ''}\n                    \n                    <!-- Value arc -->\n                    <circle \n                        class=\"gauge-value-arc ${ftpPercent > 1.2 ? 'high-power' : ''}\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                        stroke-dashoffset=\"${dashOffset}\"\n                    />\n                </svg>\n                \n                <div class=\"gauge-center\">\n                    <div class=\"gauge-value\">${value}</div>\n                    <div class=\"gauge-unit\">watts</div>\n                    ${_zone ? `<div class=\"gauge-zone-label\">${_zone.name}</div>` : ''}\n                    ${ftp > 0 ? `<div class=\"gauge-ftp\">FTP: ${ftp}W</div>` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Render zone arcs on the gauge\n     */\n    private renderZoneArcs(\n        radius: number,\n        arcLength: number,\n        circumference: number,\n        currentFtpPercent: number\n    ): string {\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n\n        if (ftp <= 0) return '';\n\n        return POWER_ZONES.map((zone, index) => {\n            const startPercent = (zone.min * ftp) / max;\n            const endPercent = Math.min((zone.max * ftp) / max, 1);\n            const zoneArcLength = (endPercent - startPercent) * arcLength;\n            const offset = arcLength * (1 - endPercent);\n\n            const isActive = currentFtpPercent >= zone.min && currentFtpPercent < zone.max;\n\n            return `\n                <circle \n                    class=\"gauge-zone ${isActive ? 'active' : ''}\"\n                    cx=\"100\" cy=\"100\" r=\"${radius}\"\n                    stroke-dasharray=\"${zoneArcLength} ${circumference}\"\n                    stroke-dashoffset=\"${offset}\"\n                    data-zone=\"${index + 1}\"\n                />\n            `;\n        }).join('');\n    }\n\n    /**\n     * Get the current zone based on FTP percentage\n     */\n    private getZone(ftpPercent: number): (typeof POWER_ZONES)[0] | null {\n        for (const zone of POWER_ZONES) {\n            if (ftpPercent >= zone.min && ftpPercent < zone.max) {\n                return zone;\n            }\n        }\n        // Above all zones\n        if (ftpPercent >= POWER_ZONES[POWER_ZONES.length - 1].max) {\n            return POWER_ZONES[POWER_ZONES.length - 1];\n        }\n        return null;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, _newValue: string | null): void {\n        const radius = 80;\n        const circumference = 2 * Math.PI * radius;\n        const arcLength = circumference * 0.75;\n\n        if (name === 'value' && this.shadow.childElementCount > 0) {\n            const value = parseInt(_newValue || '0', 10);\n            const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n            const max = parseInt(this.getAttribute('max') || '500', 10);\n\n            // 1. Update Text\n            const textEl = elementCache.getShadow<HTMLElement>(this, '.gauge-value');\n            if (textEl) textEl.textContent = String(value);\n\n            // 2. Update active zone styling (color)\n            const ftpPercent = ftp > 0 ? value / ftp : 0;\n            const _zone = this.getZone(ftpPercent);\n            const zoneIndex = _zone ? POWER_ZONES.indexOf(_zone) : -1;\n            const zoneNumber = zoneIndex >= 0 ? zoneIndex + 1 : 0;\n\n            let zoneColorVar = 'var(--color-primary-500)';\n            if (zoneNumber > 0) {\n                zoneColorVar = `var(--zone-${zoneNumber}-color)`;\n            }\n            this.style.setProperty('--gauge-color', zoneColorVar);\n\n            // 3. Update Arc\n            const arcEl = elementCache.getShadow<SVGElement>(this, '.gauge-value-arc');\n            if (arcEl) {\n                const progress = Math.min(value / max, 1);\n                const dashOffset = arcLength * (1 - progress);\n                arcEl.setAttribute('stroke-dashoffset', String(dashOffset));\n\n                // 4. Update 'high-power' class\n                if (ftpPercent > 1.2) {\n                    arcEl.classList.add('high-power');\n                } else {\n                    arcEl.classList.remove('high-power');\n                }\n            }\n\n            return;\n        }\n\n        this.render();\n    }\n\n    protected onDisconnected(): void {\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n    }\n\n    /**\n     * Animate value change\n     */\n    public animateToValue(targetValue: number, duration = 300): void {\n        const startValue = this.currentDisplayValue;\n        const startTime = performance.now();\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n\n            // Ease out cubic\n            const eased = 1 - Math.pow(1 - progress, 3);\n            const currentValue = Math.round(startValue + (targetValue - startValue) * eased);\n\n            this.currentDisplayValue = currentValue;\n            this.setAttribute('value', String(currentValue));\n\n            if (progress < 1) {\n                this.animationFrame = requestAnimationFrame(animate);\n            }\n        };\n\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n        this.animationFrame = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Set the current power value\n     */\n    public setValue(value: number, animate = false): void {\n        if (animate) {\n            this.animateToValue(value);\n        } else {\n            this.currentDisplayValue = value;\n            this.setAttribute('value', String(value));\n        }\n    }\n\n    /**\n     * Set FTP for zone calculations\n     */\n    public setFTP(ftp: number): void {\n        this.setAttribute('ftp', String(ftp));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-power-gauge', PowerGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-power-gauge': PowerGauge;\n    }\n}\n"],"names":["POWER_ZONES","PowerGauge","BaseComponent","sharedStyles","size","value","ftp","max","showZones","radius","circumference","arcLength","ftpPercent","_zone","zoneIndex","zoneNumber","zoneColorVar","progress","dashOffset","currentFtpPercent","zone","index","startPercent","endPercent","zoneArcLength","offset","name","_oldValue","_newValue","textEl","elementCache","arcEl","targetValue","duration","startValue","startTime","animate","currentTime","elapsed","eased","currentValue"],"mappings":"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"}