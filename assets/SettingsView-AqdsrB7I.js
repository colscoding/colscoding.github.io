import{y as Ze,z as _e,A as Ae,C as Ge,b as $e,E as Ye,g as Xe,d as et,e as tt,f as nt}from"./index-N21XmhYf.js";import{d as Me,e as u,j as $,k as he,n as E,o as N,p as ye,q as Fe,s as U,u as st,g as ot}from"./feature-bluetooth-WlFmxkI9.js";import{a as ct,b as it,u as at}from"./screens-D6jiR1Sk.js";import"./vendor-core-Dob3nYDb.js";import"./feature-export-7zlEGvkQ.js";import"./vendor-leaflet-3-yx3GaH.js";const Te={activeSport:"cycling",running:{targetPaceMin:300,targetPaceMax:360,useRunningCadence:!0,showPace:!0},cycling:{showPower:!0}},Ne="bpt-sport-settings";function Ve(){try{const e=localStorage.getItem(Ne);if(e)return{...Te,...JSON.parse(e)}}catch(e){console.warn("Failed to load sport settings:",e)}return{...Te}}function dt(e){localStorage.setItem(Ne,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("sport-settings-changed",{detail:e}))}function rt(e){if(e>=9999||e<=0)return"--:--";const n=Math.floor(e/60),s=Math.round(e%60);return`${n}:${s.toString().padStart(2,"0")}`}function lt(){const e=document.getElementById("saveSettings"),n=document.getElementById("settingFtp"),s=document.getElementById("settingMaxHr"),o=document.getElementById("settingWeight"),a=document.getElementById("settingSpeed"),d=document.getElementById("settingDistance"),i=document.getElementById("settingAltitude"),c=document.getElementById("settingShowCalories"),r=document.getElementById("settingPower"),H=document.getElementById("settingCadence"),O=document.getElementById("settingHeartrate"),K=document.getElementById("settingTreadmillSpeed"),R=document.getElementById("settingPower3s"),z=document.getElementById("settingHighContrast"),J=document.getElementById("settingColorblindPatterns"),j=document.getElementById("settingVoiceEnabled"),Q=document.getElementById("settingVoiceLaps"),W=document.getElementById("settingVoiceZones"),p=document.getElementById("settingAutoPauseEnabled"),h=document.getElementById("settingAutoPauseSource"),C=document.getElementById("settingAutoPauseThreshold"),L=document.getElementById("settingAutoPauseDelay"),Z=document.getElementById("autoPauseOptions"),Ie=document.getElementById("autoPauseThresholdUnit"),_=document.getElementById("settingExportTcx"),G=document.getElementById("settingExportCsv"),Y=document.getElementById("settingExportJson"),X=document.getElementById("settingExportFit"),ee=document.getElementById("settingPromptForNotes"),te=document.getElementById("settingPromptForExertion"),x=document.getElementById("settingCountdownDuration"),ne=document.getElementById("settingCountdownBeep"),se=document.getElementById("settingCountdownVoice"),m=document.getElementById("settingAutoLapEnabled"),y=document.getElementById("settingAutoLapSource"),P=document.getElementById("settingAutoLapDistance"),A=document.getElementById("settingAutoLapTime"),oe=document.getElementById("autoLapOptions"),Ee=document.getElementById("autoLapDistanceOption"),ke=document.getElementById("autoLapTimeOption"),M=document.getElementById("settingVoiceTimeInterval"),F=document.getElementById("settingVoiceDistanceInterval"),T=document.getElementById("settingVoiceSpeechRate"),ce=document.getElementById("settingVoiceMetricPower"),ie=document.getElementById("settingVoiceMetricHeartrate"),ae=document.getElementById("settingVoiceMetricCadence"),de=document.getElementById("settingVoiceMetricSpeed"),re=document.getElementById("settingVoiceMetricDistance"),le=document.getElementById("settingVoiceMetricTime"),f=document.getElementById("settingSportType"),V=document.getElementById("settingShowPace"),D=document.getElementById("settingThresholdPace"),we=document.getElementById("runningOptions"),b=document.getElementById("settingIntervalsEnabled"),S=document.getElementById("settingIntervalsApiKey"),ue=document.getElementById("toggleIntervalsApiKey"),ge=document.getElementById("settingIntervalsAthleteId"),fe=document.getElementById("settingIntervalsAutoUpload"),Be=document.getElementById("intervalsOptions"),pe=document.getElementById("settingDebugMode"),Ce=document.getElementById("debugControls"),qe=document.getElementById("downloadDebugLogs"),He=document.getElementById("clearDebugLogs"),Oe=document.getElementById("installPwaButton"),Le=()=>{Be&&b&&(Be.style.display=b.checked?"flex":"none")},xe=()=>{if(we&&f){const t=f.value==="running"||f.value==="walking";we.style.display=t?"block":"none"}},Ke=t=>{const l=t.match(/^(\d{1,2}):([0-5]\d)$/);if(!l)return null;const w=parseInt(l[1],10),I=parseInt(l[2],10);return w*60+I},Re=()=>{const t=Ve();if(f&&(t.activeSport=f.value),V!==null&&(t.running.showPace=V.checked),D?.value){const l=Ke(D.value);l!==null&&(t.running.targetPaceMin=l-30,t.running.targetPaceMax=l+30)}dt(t)},ze=()=>{const t=Ve();if(f&&(f.value=t.activeSport),V&&(V.checked=t.running.showPace),D){const l=Math.round((t.running.targetPaceMin+t.running.targetPaceMax)/2);D.value=rt(l)}xe()};f?.addEventListener("change",xe),ue?.addEventListener("click",()=>{if(S){const t=S.type==="password";S.type=t?"text":"password",ue&&(ue.textContent=t?"üôà":"üëÅÔ∏è")}}),b?.addEventListener("change",Le);const me=()=>{if(Z&&p&&(Z.style.opacity=p.checked?"1":"0.5",Z.style.pointerEvents=p.checked?"auto":"none"),Ie&&h){const t=_e(h.value);Ie.textContent=t}};p?.addEventListener("change",me),h?.addEventListener("change",me);const ve=()=>{if(oe&&m&&(oe.style.opacity=m.checked?"1":"0.5",oe.style.pointerEvents=m.checked?"auto":"none"),Ee&&ke&&y){const t=y.value==="distance";Ee.style.display=t?"flex":"none",ke.style.display=t?"none":"flex"}};m?.addEventListener("change",ve),y?.addEventListener("change",ve);const Pe=t=>{const l=(I,Qe)=>{document.querySelectorAll(`.metric-group-${I}`).forEach(We=>{We.style.display=Qe?"flex":"none"})};l("speed",t.speed),l("distance",t.distance),l("altitude",t.altitude),l("energy",t.showCalories),l("power",t.power),l("cadence",t.cadence),l("heartrate",t.heartrate),l("treadmillSpeed",t.treadmillSpeed),document.querySelectorAll(".metric-group-power").forEach(I=>{t.power3s?I.setAttribute("data-show-avg","true"):I.removeAttribute("data-show-avg")}),t.highContrast?document.documentElement.setAttribute("data-high-contrast","true"):document.documentElement.removeAttribute("data-high-contrast"),t.colorblindPatterns?document.documentElement.setAttribute("data-colorblind-patterns","true"):document.documentElement.removeAttribute("data-colorblind-patterns"),Ce&&(Ce.style.display=t.debugMode?"flex":"none")},Je=()=>{const l={...Ae(),ftp:n?.value?Number(n.value):null,maxHr:s?.value?Number(s.value):null,weight:o?.value?Number(o.value):null};Ge(l),window.dispatchEvent(new CustomEvent("user-profile-changed"));const w={speed:a?.checked??u.speed,distance:d?.checked??u.distance,altitude:i?.checked??u.altitude,weightKg:o?.value?Number(o.value):u.weightKg,showCalories:c?.checked??u.showCalories,power:r?.checked??u.power,cadence:H?.checked??u.cadence,heartrate:O?.checked??u.heartrate,treadmillSpeed:K?.checked??u.treadmillSpeed,power3s:R?.checked??u.power3s,highContrast:z?.checked??u.highContrast,colorblindPatterns:J?.checked??u.colorblindPatterns,voiceEnabled:j?.checked??u.voiceEnabled,voiceLaps:Q?.checked??u.voiceLaps,voiceZones:W?.checked??u.voiceZones,autoPause:{enabled:p?.checked??U.enabled,source:h?.value??U.source,threshold:C?.value?Number(C.value):U.threshold,delay:L?.value?Number(L.value):U.delay},workoutMetadata:{promptForNotes:ee?.checked??Fe.promptForNotes,promptForExertion:te?.checked??Fe.promptForExertion},countdown:{duration:x?.value?parseInt(x.value):ye.duration,enableBeep:ne?.checked??ye.enableBeep,enableVoice:se?.checked??ye.enableVoice},autoLap:{enabled:m?.checked??N.enabled,source:y?.value??N.source,distanceKm:P?.value?Number(P.value):N.distanceKm,timeMinutes:A?.value?Number(A.value):N.timeMinutes},enhancedVoice:{timeIntervalMinutes:M?.value?parseInt(M.value):he.timeIntervalMinutes,distanceIntervalKm:F?.value?parseInt(F.value):he.distanceIntervalKm,metrics:{power:ce?.checked??E.power,heartrate:ie?.checked??E.heartrate,cadence:ae?.checked??E.cadence,speed:de?.checked??E.speed,distance:re?.checked??E.distance,time:le?.checked??E.time},speechRate:T?.value?parseFloat(T.value):he.speechRate},intervals:{enabled:b?.checked??$.enabled,apiKey:S?.value??$.apiKey,athleteId:ge?.value??$.athleteId,autoUpload:fe?.checked??$.autoUpload},exportTcx:_?.checked??u.exportTcx,exportCsv:G?.checked??u.exportCsv,exportJson:Y?.checked??u.exportJson,exportFit:X?.checked??u.exportFit,debugMode:pe?.checked??u.debugMode};st(w),Re(),Pe(w)},je=()=>{const t=ot(),l=Ae();n&&(n.value=l.ftp?.toString()??""),s&&(s.value=l.maxHr?.toString()??""),o&&(o.value=l.weight?.toString()??""),r&&(r.checked=t.power),H&&(H.checked=t.cadence),O&&(O.checked=t.heartrate),a&&(a.checked=t.speed),d&&(d.checked=t.distance),i&&(i.checked=t.altitude),c&&(c.checked=t.showCalories),K&&(K.checked=t.treadmillSpeed),R&&(R.checked=t.power3s),z&&(z.checked=t.highContrast),J&&(J.checked=t.colorblindPatterns),j&&(j.checked=t.voiceEnabled),Q&&(Q.checked=t.voiceLaps),W&&(W.checked=t.voiceZones),p&&(p.checked=t.autoPause.enabled),h&&(h.value=t.autoPause.source),C&&(C.value=t.autoPause.threshold.toString()),L&&(L.value=t.autoPause.delay.toString()),me(),_&&(_.checked=t.exportTcx),G&&(G.checked=t.exportCsv),Y&&(Y.checked=t.exportJson),X&&(X.checked=t.exportFit),ee&&(ee.checked=t.workoutMetadata.promptForNotes),te&&(te.checked=t.workoutMetadata.promptForExertion),x&&(x.value=t.countdown.duration.toString()),ne&&(ne.checked=t.countdown.enableBeep),se&&(se.checked=t.countdown.enableVoice),m&&(m.checked=t.autoLap.enabled),y&&(y.value=t.autoLap.source),P&&(P.value=t.autoLap.distanceKm.toString()),A&&(A.value=t.autoLap.timeMinutes.toString()),ve(),M&&(M.value=t.enhancedVoice.timeIntervalMinutes.toString()),F&&(F.value=t.enhancedVoice.distanceIntervalKm.toString()),T&&(T.value=t.enhancedVoice.speechRate.toString()),ce&&(ce.checked=t.enhancedVoice.metrics.power),ie&&(ie.checked=t.enhancedVoice.metrics.heartrate),ae&&(ae.checked=t.enhancedVoice.metrics.cadence),de&&(de.checked=t.enhancedVoice.metrics.speed),re&&(re.checked=t.enhancedVoice.metrics.distance),le&&(le.checked=t.enhancedVoice.metrics.time),b&&(b.checked=t.intervals.enabled),S&&(S.value=t.intervals.apiKey),ge&&(ge.value=t.intervals.athleteId),fe&&(fe.checked=t.intervals.autoUpload),Le(),pe&&(pe.checked=t.debugMode),ze(),Pe(t)};e?.addEventListener("click",Je),qe?.addEventListener("click",()=>{Me.exportLogs()}),He?.addEventListener("click",async()=>{confirm("Are you sure you want to clear all debug logs?")&&(await Me.clearLogs(),alert("Logs cleared."))}),Oe?.addEventListener("click",async()=>{const t=await Ze();t==="accepted"?console.log("PWA installation accepted"):t==="dismissed"?console.log("PWA installation dismissed"):alert("Installation is not available at this time. The app may already be installed or your browser does not support installation.")}),je()}let g={profile:$e(),selectedScreenIndex:0,isEditing:!1,searchQuery:"",selectedCategory:"all"};const be=new Set;function ut(e){return be.add(e),()=>be.delete(e)}function Ue(){be.forEach(e=>e())}function k(e){g={...g,...e},Ue()}function gt(){const e=$e();k({profile:e,selectedScreenIndex:Math.min(g.selectedScreenIndex,e.screens.length-1)})}function ft(){const e=Ye(g.profile);return e&&document.dispatchEvent(new CustomEvent("data-fields-profile-changed",{detail:{profile:g.profile}})),e}function v(){return g.profile.screens[g.selectedScreenIndex]??null}function pt(e,n="medium"){const s=v();if(!s)return;const o=ct(s,e,n);B(o)}function mt(e){const n=v();if(!n)return;const s=it(n,e);B(s)}function vt(e,n){const s=v();if(!s)return;const o=at(s,e,n);B(o)}function ht(e){const n=v();if(!n)return;const s={...n,layout:e};B(s)}function B(e){const n=[...g.profile.screens];n[g.selectedScreenIndex]=e,k({profile:{...g.profile,screens:n}})}function yt(e,n){const s=v();if(!s)return;const o=[...s.slots],[a]=o.splice(e,1);o.splice(n,0,a);const d=o.map((i,c)=>({...i,position:c}));B({...s,slots:d})}function bt(){let e;if(g.searchQuery.trim())e=et(g.searchQuery);else if(g.selectedCategory==="all"){const n=tt();e=Array.from(n.values()).flat()}else e=nt(g.selectedCategory);return e}const St={all:"üìä",power:"‚ö°",heartrate:"‚ù§Ô∏è",cadence:"üîÑ",speed:"üö¥",distance:"üìç",elevation:"‚õ∞Ô∏è",time:"‚è±Ô∏è",laps:"üèÅ",energy:"üî•",environment:"üå°Ô∏è",device:"üîã",charts:"üìà",map:"üó∫Ô∏è"};function It(e){e.innerHTML=`
        <div class="data-fields-config">
            <div class="dfc-header">
                <h3>üìä Data Fields</h3>
                <p class="dfc-help-text">Configure which metrics appear on your dashboard screens.</p>
            </div>
            
            <div class="dfc-screens">
                <div class="dfc-screens-tabs" role="tablist"></div>
            </div>
            
            <div class="dfc-current-screen">
                <div class="dfc-screen-header">
                    <span class="dfc-screen-name"></span>
                    <select class="dfc-layout-select" aria-label="Screen layout">
                        <option value="auto">Auto Layout</option>
                        <option value="grid-2">2 Columns</option>
                        <option value="grid-3">3 Columns</option>
                        <option value="grid-4">4 Columns</option>
                        <option value="list">List</option>
                    </select>
                </div>
                <div class="dfc-fields-list" role="list" aria-label="Current screen fields"></div>
                <button class="dfc-add-field-btn" type="button">
                    <span>+</span> Add Field
                </button>
            </div>
            
            <div class="dfc-field-picker" style="display: none;">
                <div class="dfc-picker-header">
                    <h4>Select a Field</h4>
                    <button class="dfc-picker-close" type="button" aria-label="Close field picker">&times;</button>
                </div>
                <input type="search" class="dfc-search" placeholder="Search fields..." aria-label="Search data fields">
                <div class="dfc-categories" role="tablist"></div>
                <div class="dfc-available-fields" role="listbox" aria-label="Available fields"></div>
            </div>
            
            <div class="dfc-actions">
                <button class="dfc-save-btn" type="button">Save Changes</button>
                <button class="dfc-reset-btn" type="button">Reset to Defaults</button>
            </div>
        </div>
    `,Bt(e),De(e),ut(()=>De(e))}function De(e){Et(e),kt(e),wt(e)}function Et(e){const n=e.querySelector(".dfc-screens-tabs");n&&(n.innerHTML=g.profile.screens.map((s,o)=>`
            <button 
                class="dfc-screen-tab ${o===g.selectedScreenIndex?"dfc-screen-tab--active":""}"
                data-screen-index="${o}"
                role="tab"
                aria-selected="${o===g.selectedScreenIndex}"
                aria-label="${s.name} screen"
            >
                <span class="dfc-tab-icon">${s.icon}</span>
                <span class="dfc-tab-name">${q(s.name)}</span>
            </button>
        `).join(""))}function kt(e){const n=v(),s=e.querySelector(".dfc-screen-name"),o=e.querySelector(".dfc-layout-select"),a=e.querySelector(".dfc-fields-list");if(!(!n||!s||!a||!o)){if(s.textContent=`${n.icon} ${n.name}`,o.value=n.layout,n.slots.length===0){a.innerHTML=`
            <div class="dfc-empty-screen">
                <p>No fields on this screen</p>
                <p class="dfc-empty-hint">Click "Add Field" to add metrics</p>
            </div>
        `;return}a.innerHTML=n.slots.sort((d,i)=>d.position-i.position).map(d=>{const i=Xe(d.fieldId),c=i?.name??"Unknown",r=i?.icon??"‚ùì";return`
                <div class="dfc-field-item" data-slot-id="${d.id}" role="listitem" draggable="true">
                    <span class="dfc-field-drag" title="Drag to reorder">‚ãÆ‚ãÆ</span>
                    <span class="dfc-field-icon">${r}</span>
                    <div class="dfc-field-info">
                        <span class="dfc-field-name">${q(c)}</span>
                        <span class="dfc-field-id">${d.fieldId}</span>
                    </div>
                    <select class="dfc-field-size" data-slot-id="${d.id}" aria-label="Field size">
                        <option value="small" ${d.size==="small"?"selected":""}>Small</option>
                        <option value="medium" ${d.size==="medium"?"selected":""}>Medium</option>
                        <option value="large" ${d.size==="large"?"selected":""}>Large</option>
                    </select>
                    <button class="dfc-field-remove" data-slot-id="${d.id}" aria-label="Remove ${c}" title="Remove">
                        üóëÔ∏è
                    </button>
                </div>
            `}).join("")}}function wt(e){const n=e.querySelector(".dfc-categories"),s=e.querySelector(".dfc-available-fields");if(!n||!s)return;const o=["all","power","heartrate","cadence","speed","distance","elevation","time"];n.innerHTML=o.map(c=>`
            <button 
                class="dfc-category-btn ${c===g.selectedCategory?"dfc-category-btn--active":""}"
                data-category="${c}"
                role="tab"
                aria-selected="${c===g.selectedCategory}"
            >
                <span>${St[c]}</span>
                <span>${c==="all"?"All":c.charAt(0).toUpperCase()+c.slice(1)}</span>
            </button>
        `).join("");const a=bt(),d=v(),i=new Set(d?.slots.map(c=>c.fieldId)??[]);s.innerHTML=a.map(c=>{const r=i.has(c.id);return`
                <button 
                    class="dfc-available-field ${r?"dfc-available-field--used":""}"
                    data-field-id="${c.id}"
                    role="option"
                    aria-selected="false"
                    ${r?"disabled":""}
                >
                    <span class="dfc-af-icon">${c.icon}</span>
                    <div class="dfc-af-info">
                        <span class="dfc-af-name">${q(c.name)}</span>
                        <span class="dfc-af-desc">${q(c.description)}</span>
                    </div>
                    ${r?'<span class="dfc-af-badge">Added</span>':""}
                </button>
            `}).join("")}function Bt(e){e.addEventListener("click",s=>{const o=s.target,a=o.closest(".dfc-screen-tab");if(a){const r=parseInt(a.dataset.screenIndex??"0",10);k({selectedScreenIndex:r});return}if(o.closest(".dfc-add-field-btn")){Lt(e);return}if(o.closest(".dfc-picker-close")){xt(e);return}const d=o.closest(".dfc-category-btn");if(d){const r=d.dataset.category;k({selectedCategory:r});return}const i=o.closest(".dfc-available-field");if(i&&!i.hasAttribute("disabled")){const r=i.dataset.fieldId;r&&(pt(r),Ue());return}const c=o.closest(".dfc-field-remove");if(c){const r=c.dataset.slotId;r&&mt(r);return}if(o.closest(".dfc-save-btn")){ft()?Se("Settings saved!","success"):Se("Failed to save settings","error");return}if(o.closest(".dfc-reset-btn")){confirm("Reset data fields to defaults? This cannot be undone.")&&Pt();return}}),e.addEventListener("change",s=>{const o=s.target;if(o.classList.contains("dfc-layout-select")){ht(o.value);return}if(o.classList.contains("dfc-field-size")){const a=o.dataset.slotId;a&&vt(a,{size:o.value});return}});const n=e.querySelector(".dfc-search");n&&n.addEventListener("input",s=>{const o=s.target;k({searchQuery:o.value})}),Ct(e)}function Ct(e){const n=e.querySelector(".dfc-fields-list");if(!n)return;let s=null,o=-1;n.addEventListener("dragstart",a=>{s=a.target.closest(".dfc-field-item"),s&&(o=Array.from(n.children).indexOf(s),s.classList.add("dfc-field-item--dragging"))}),n.addEventListener("dragend",()=>{s&&s.classList.remove("dfc-field-item--dragging"),s=null,o=-1}),n.addEventListener("dragover",a=>{a.preventDefault();const i=a.target.closest(".dfc-field-item");i&&i!==s&&Array.from(n.querySelectorAll(".dfc-field-item:not(.dfc-field-item--dragging)")).indexOf(i)!==-1&&i.classList.add("dfc-field-item--drag-over")}),n.addEventListener("dragleave",a=>{const i=a.target.closest(".dfc-field-item");i&&i.classList.remove("dfc-field-item--drag-over")}),n.addEventListener("drop",a=>{a.preventDefault();const i=a.target.closest(".dfc-field-item");if(n.querySelectorAll(".dfc-field-item--drag-over").forEach(c=>{c.classList.remove("dfc-field-item--drag-over")}),i&&s&&i!==s){const r=Array.from(n.querySelectorAll(".dfc-field-item")).indexOf(i);o!==-1&&r!==-1&&o!==r&&yt(o,r)}})}function Lt(e){const n=e.querySelector(".dfc-field-picker");if(n){n.style.display="block";const s=n.querySelector(".dfc-search");s&&s.focus()}}function xt(e){const n=e.querySelector(".dfc-field-picker");n&&(n.style.display="none",k({searchQuery:"",selectedCategory:"all"}))}function Pt(){localStorage.removeItem("bpt-data-fields"),gt(),Se("Data fields reset to defaults","info")}function Se(e,n){const s=new CustomEvent("show-notification",{detail:{message:e,type:n}});document.dispatchEvent(s),console.log(`[DataFieldsConfig] ${n}: ${e}`)}function q(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}function At(){const e=document.querySelector("#page-settings .page-content");if(!e){console.warn("[DataFieldsConfig] Settings page content not found");return}if(e.querySelector(".data-fields-config"))return;const n=document.createElement("fieldset");n.className="settings-fieldset",n.style.cssText="border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;",n.innerHTML='<legend style="font-weight: 600; padding: 0 8px;">üìä Data Fields Configuration</legend>';const s=e.querySelector("fieldset:nth-child(4)");s&&s.nextSibling?e.insertBefore(n,s.nextSibling):e.appendChild(n),It(n),console.log("[DataFieldsConfig] Initialized")}class Ut{id="settings";init(n){const s=document.getElementById("settingsTemplate");if(s){const o=s.content.cloneNode(!0);n.appendChild(o),setTimeout(()=>{lt(),At()},0)}else console.error("Settings template not found!"),n.innerHTML="<p>Error loading settings view</p>"}onEnter(){console.log("Entered Settings View")}onLeave(){console.log("Left Settings View")}}export{Ut as SettingsView};
//# sourceMappingURL=SettingsView-AqdsrB7I.js.map
