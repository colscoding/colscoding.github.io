{"version":3,"file":"VO2maxView-OfUZaM3z.js","sources":["../../src/calculations/vo2maxEstimator.ts","../../src/views/VO2maxView.ts"],"sourcesContent":["/**\n * VO2max Estimator\n *\n * Estimates VO2max from workout data using multiple methods:\n * - Running: Firstbeat-style algorithm (HR + pace + profile)\n * - Cycling: Power-based estimation (power + HR + profile)\n * - Cooper Test: 12-minute run distance\n * - Step Test: Recovery heart rate\n *\n * VO2max is the maximum rate of oxygen consumption during exercise,\n * measured in ml/kg/min. It's a key indicator of cardiovascular fitness.\n *\n * @module calculations/vo2maxEstimator\n */\n\nimport type { UserProfile } from '../storage/userSettings.js';\n\n/**\n * VO2max estimation result\n */\nexport interface VO2maxEstimate {\n    vo2max: number; // ml/kg/min\n    confidence: 'low' | 'medium' | 'high';\n    method: string;\n    timestamp: number;\n    activityType: 'running' | 'cycling' | 'other';\n    notes?: string;\n}\n\n/**\n * Running workout data for VO2max estimation\n */\nexport interface RunningWorkoutData {\n    avgPace: number; // seconds per km\n    avgHeartRate: number; // bpm\n    duration: number; // seconds\n    distance: number; // meters\n}\n\n/**\n * Cycling workout data for VO2max estimation\n */\nexport interface CyclingWorkoutData {\n    avgPower: number; // watts\n    avgHeartRate: number; // bpm\n    duration: number; // seconds\n    normalizedPower?: number; // watts\n}\n\n// ============================================================================\n// Running VO2max Estimation (Firstbeat-style)\n// ============================================================================\n\n/**\n * Estimate VO2max from running workout data\n *\n * Uses a Firstbeat-inspired algorithm that considers:\n * - Running speed and oxygen cost\n * - Heart rate relative to max HR\n * - User profile (age, weight, resting HR)\n *\n * Formula basis:\n * - VO2 (ml/kg/min) = velocity-based oxygen cost\n * - Adjust for HR% (higher HR = higher % of VO2max used)\n * - Account for running economy variations\n *\n * Confidence factors:\n * - High: Steady-state run at 70-90% max HR for >10 min\n * - Medium: Moderate intensity or shorter duration\n * - Low: Variable pace/HR or extreme conditions\n *\n * @param workoutData - Running workout metrics\n * @param profile - User profile data\n * @returns VO2max estimate with confidence level\n */\nexport function estimateVO2maxRunning(workoutData: RunningWorkoutData, profile: UserProfile): VO2maxEstimate {\n    const { avgPace, avgHeartRate, duration } = workoutData;\n    const { maxHr, restingHr, age } = profile;\n\n    // Validate required fields\n    if (!maxHr || !restingHr || !age) {\n        throw new Error('Profile must include maxHr, restingHr, and age');\n    }\n\n    // Convert pace to velocity (m/s)\n    const velocityMPS = 1000 / avgPace; // km/h to m/s\n    const velocityKMH = velocityMPS * 3.6;\n\n    // Calculate oxygen cost at this running speed (ACSM formula)\n    // VO2 (ml/kg/min) = 0.2 √ó speed (m/min) + 3.5 (resting metabolism)\n    // For running: VO2 = 0.2 √ó velocity + 0.9 √ó velocity + 3.5\n    const velocityMPM = velocityMPS * 60;\n    const vo2AtPace = 0.2 * velocityMPM + 0.9 * velocityMPM + 3.5;\n\n    // Calculate HR reserve used\n    const hrReserve = maxHr - restingHr;\n    const hrUsed = avgHeartRate - restingHr;\n    const hrPercent = hrUsed / hrReserve;\n\n    // Estimate VO2max assuming HR% correlates with VO2% used\n    // At steady state, HR% ‚âà VO2% (simplified assumption)\n    const estimatedVO2max = vo2AtPace / Math.max(0.5, Math.min(0.95, hrPercent));\n\n    // Apply age adjustment (VO2max declines ~10% per decade after 25)\n    const ageAdjustment = age > 25 ? 1 - (age - 25) * 0.01 : 1.0;\n    const adjustedVO2max = estimatedVO2max * ageAdjustment;\n\n    // Determine confidence based on workout characteristics\n    let confidence: 'low' | 'medium' | 'high' = 'medium';\n    let notes = '';\n\n    // High confidence: steady-state aerobic run\n    if (\n        duration >= 600 && // >10 minutes\n        hrPercent >= 0.7 &&\n        hrPercent <= 0.9 &&\n        velocityKMH >= 8 &&\n        velocityKMH <= 20\n    ) {\n        confidence = 'high';\n        notes = 'Ideal conditions for VO2max estimation (steady-state aerobic run)';\n    }\n    // Low confidence: too easy, too hard, or too short\n    else if (duration < 300 || hrPercent < 0.6 || hrPercent > 0.95 || velocityKMH < 6) {\n        confidence = 'low';\n        if (duration < 300) notes = 'Duration too short for reliable estimate';\n        else if (hrPercent < 0.6) notes = 'Intensity too low for accurate VO2max estimation';\n        else if (hrPercent > 0.95) notes = 'Intensity too high (likely anaerobic)';\n        else notes = 'Pace too slow for reliable estimation';\n    } else {\n        notes = 'Moderate confidence - reasonable workout conditions';\n    }\n\n    return {\n        vo2max: Math.round(adjustedVO2max * 10) / 10,\n        confidence,\n        method: 'Running (Firstbeat-style)',\n        timestamp: Date.now(),\n        activityType: 'running',\n        notes,\n    };\n}\n\n// ============================================================================\n// Cycling VO2max Estimation (Power-based)\n// ============================================================================\n\n/**\n * Estimate VO2max from cycling workout data\n *\n * Uses power output to estimate oxygen consumption:\n * - Mechanical power is ~25% efficient (cycling)\n * - Remaining 75% dissipated as heat\n * - VO2 (L/min) = Power (W) / (Efficiency √ó Energy per L O2)\n * - Efficiency ‚âà 0.24 for cycling\n * - Energy per L O2 ‚âà 20.9 kJ/L\n *\n * Formula:\n * VO2 (ml/kg/min) = (Power √ó 10.8 / weight) + 7\n *\n * Confidence factors:\n * - High: FTP test or sustained threshold effort (20+ min at 85-95% max HR)\n * - Medium: Steady moderate-high intensity\n * - Low: Variable power or subthreshold intensity\n *\n * @param workoutData - Cycling workout metrics\n * @param profile - User profile data\n * @returns VO2max estimate with confidence level\n */\nexport function estimateVO2maxCycling(workoutData: CyclingWorkoutData, profile: UserProfile): VO2maxEstimate {\n    const { avgPower, avgHeartRate, duration, normalizedPower } = workoutData;\n    const { maxHr, restingHr, weight } = profile;\n\n    // Validate required fields\n    if (!maxHr || !restingHr || !weight) {\n        throw new Error('Profile must include maxHr, restingHr, and weight');\n    }\n\n    // Use normalized power if available (better for variable efforts)\n    const effectivePower = normalizedPower || avgPower;\n\n    // Calculate VO2 at this power output (ACSM formula)\n    // VO2 (ml/kg/min) = (Power √ó 10.8 / weight) + 7\n    const vo2AtPower = (effectivePower * 10.8) / weight + 7;\n\n    // Calculate HR reserve used\n    const hrReserve = maxHr - restingHr;\n    const hrUsed = avgHeartRate - restingHr;\n    const hrPercent = hrUsed / hrReserve;\n\n    // Estimate VO2max assuming this is sustainable VO2% based on HR%\n    // For cycling, threshold is typically ~85% VO2max at ~90% max HR\n    const estimatedVO2max = vo2AtPower / Math.max(0.6, Math.min(0.95, hrPercent));\n\n    // Determine confidence based on workout characteristics\n    let confidence: 'low' | 'medium' | 'high' = 'medium';\n    let notes = '';\n\n    // High confidence: FTP test or sustained threshold\n    if (\n        duration >= 1200 && // >20 minutes\n        hrPercent >= 0.85 &&\n        hrPercent <= 0.95 &&\n        effectivePower >= 150\n    ) {\n        confidence = 'high';\n        notes = 'Ideal conditions for VO2max estimation (sustained threshold effort)';\n    }\n    // Low confidence: too easy, too hard, too short, or too low power\n    else if (duration < 600 || hrPercent < 0.7 || hrPercent > 0.98 || effectivePower < 100) {\n        confidence = 'low';\n        if (duration < 600) notes = 'Duration too short for reliable estimate';\n        else if (hrPercent < 0.7) notes = 'Intensity too low for accurate VO2max estimation';\n        else if (hrPercent > 0.98) notes = 'Intensity at maximum (unsustainable)';\n        else notes = 'Power too low for reliable estimation';\n    } else {\n        notes = 'Moderate confidence - reasonable workout conditions';\n    }\n\n    return {\n        vo2max: Math.round(estimatedVO2max * 10) / 10,\n        confidence,\n        method: 'Cycling (Power-based)',\n        timestamp: Date.now(),\n        activityType: 'cycling',\n        notes,\n    };\n}\n\n// ============================================================================\n// Cooper Test (12-minute run)\n// ============================================================================\n\n/**\n * Estimate VO2max from Cooper 12-minute test\n *\n * The Cooper test estimates VO2max from distance covered in 12 minutes.\n * Formula: VO2max = (Distance in meters - 504.9) / 44.73\n *\n * This is a validated field test used by many fitness organizations.\n *\n * @param distanceMeters - Distance covered in 12 minutes\n * @returns VO2max estimate\n */\nexport function estimateVO2maxCooperTest(distanceMeters: number): VO2maxEstimate {\n    // Cooper formula\n    const vo2max = (distanceMeters - 504.9) / 44.73;\n\n    // Determine confidence based on distance (should be maximal effort)\n    let confidence: 'low' | 'medium' | 'high' = 'medium';\n    let notes = '';\n\n    if (distanceMeters >= 2400 && distanceMeters <= 3600) {\n        confidence = 'high';\n        notes = 'Distance suggests maximal effort';\n    } else if (distanceMeters < 2000 || distanceMeters > 4000) {\n        confidence = 'low';\n        notes = 'Distance outside typical range - verify test was maximal effort';\n    } else {\n        notes = 'Standard Cooper test protocol';\n    }\n\n    return {\n        vo2max: Math.round(vo2max * 10) / 10,\n        confidence,\n        method: 'Cooper 12-minute test',\n        timestamp: Date.now(),\n        activityType: 'running',\n        notes,\n    };\n}\n\n// ============================================================================\n// Historical Tracking\n// ============================================================================\n\nconst VO2MAX_STORAGE_KEY = 'bpt-vo2max-history';\n\n/**\n * Save VO2max estimate to history\n */\nexport function saveVO2maxEstimate(estimate: VO2maxEstimate): void {\n    const history = getVO2maxHistory();\n    history.push(estimate);\n\n    // Keep only last 100 estimates\n    const trimmed = history.slice(-100);\n\n    try {\n        localStorage.setItem(VO2MAX_STORAGE_KEY, JSON.stringify(trimmed));\n    } catch (error) {\n        console.error('Failed to save VO2max estimate:', error);\n    }\n}\n\n/**\n * Get VO2max estimation history\n */\nexport function getVO2maxHistory(): VO2maxEstimate[] {\n    try {\n        const stored = localStorage.getItem(VO2MAX_STORAGE_KEY);\n        if (!stored) return [];\n        return JSON.parse(stored);\n    } catch (error) {\n        console.error('Failed to load VO2max history:', error);\n        return [];\n    }\n}\n\n/**\n * Get latest VO2max estimate by activity type\n */\nexport function getLatestVO2max(activityType?: 'running' | 'cycling'): VO2maxEstimate | null {\n    const history = getVO2maxHistory();\n    if (history.length === 0) return null;\n\n    const filtered = activityType ? history.filter((e) => e.activityType === activityType) : history;\n\n    if (filtered.length === 0) return null;\n\n    // Return most recent with high confidence, or just most recent\n    const highConfidence = filtered.filter((e) => e.confidence === 'high');\n    if (highConfidence.length > 0) {\n        return highConfidence[highConfidence.length - 1];\n    }\n\n    return filtered[filtered.length - 1];\n}\n\n/**\n * Calculate VO2max trend over time\n *\n * Returns trend data for charting and analysis\n */\nexport interface VO2maxTrend {\n    averageVO2max: number;\n    recentVO2max: number;\n    trend: 'improving' | 'stable' | 'declining';\n    changePercent: number;\n    dataPoints: Array<{ timestamp: number; vo2max: number; confidence: string }>;\n}\n\nexport function calculateVO2maxTrend(activityType?: 'running' | 'cycling', daysBack: number = 90): VO2maxTrend | null {\n    const history = getVO2maxHistory();\n    if (history.length < 2) return null;\n\n    // Filter by activity type and time range\n    const cutoffTime = Date.now() - daysBack * 24 * 60 * 60 * 1000;\n    let filtered = history.filter((e) => e.timestamp >= cutoffTime);\n    if (activityType) {\n        filtered = filtered.filter((e) => e.activityType === activityType);\n    }\n\n    if (filtered.length < 2) return null;\n\n    // Calculate averages\n    const allValues = filtered.map((e) => e.vo2max);\n    const averageVO2max = allValues.reduce((sum, val) => sum + val, 0) / allValues.length;\n\n    // Get recent average (last 30 days or 5 estimates, whichever is more)\n    const recentCutoff = Date.now() - 30 * 24 * 60 * 60 * 1000;\n    const recentValues = filtered.filter((e) => e.timestamp >= recentCutoff).map((e) => e.vo2max);\n    const minRecentEstimates = Math.min(5, filtered.length);\n    const recentEstimates =\n        recentValues.length >= minRecentEstimates ? recentValues : allValues.slice(-minRecentEstimates);\n    const recentVO2max = recentEstimates.reduce((sum, val) => sum + val, 0) / recentEstimates.length;\n\n    // Calculate trend\n    const changePercent = ((recentVO2max - averageVO2max) / averageVO2max) * 100;\n    let trend: 'improving' | 'stable' | 'declining' = 'stable';\n    if (changePercent > 2) trend = 'improving';\n    else if (changePercent < -2) trend = 'declining';\n\n    // Prepare data points for charting\n    const dataPoints = filtered.map((e) => ({\n        timestamp: e.timestamp,\n        vo2max: e.vo2max,\n        confidence: e.confidence,\n    }));\n\n    return {\n        averageVO2max: Math.round(averageVO2max * 10) / 10,\n        recentVO2max: Math.round(recentVO2max * 10) / 10,\n        trend,\n        changePercent: Math.round(changePercent * 10) / 10,\n        dataPoints,\n    };\n}\n\n// ============================================================================\n// VO2max Fitness Level Classification\n// ============================================================================\n\n/**\n * Classify VO2max fitness level by age and gender\n *\n * Based on ACSM and Cooper Institute norms\n */\nexport function classifyVO2maxLevel(vo2max: number, age: number, gender: 'male' | 'female' = 'male'): string {\n    // Age group thresholds (male)\n    const maleThresholds: Record<string, number[]> = {\n        '20-29': [38, 43, 52, 56],\n        '30-39': [35, 40, 48, 53],\n        '40-49': [33, 38, 46, 51],\n        '50-59': [31, 35, 43, 48],\n        '60+': [28, 32, 40, 44],\n    };\n\n    // Age group thresholds (female) - generally 10-15% lower\n    const femaleThresholds: Record<string, number[]> = {\n        '20-29': [32, 37, 44, 48],\n        '30-39': [30, 34, 41, 45],\n        '40-49': [28, 32, 39, 43],\n        '50-59': [26, 30, 36, 41],\n        '60+': [23, 27, 34, 38],\n    };\n\n    // Determine age group\n    let ageGroup = '60+';\n    if (age < 30) ageGroup = '20-29';\n    else if (age < 40) ageGroup = '30-39';\n    else if (age < 50) ageGroup = '40-49';\n    else if (age < 60) ageGroup = '50-59';\n\n    const thresholds = gender === 'male' ? maleThresholds[ageGroup] : femaleThresholds[ageGroup];\n    const [poor, fair, good, excellent] = thresholds;\n\n    if (vo2max < poor) return 'Poor';\n    if (vo2max < fair) return 'Fair';\n    if (vo2max < good) return 'Good';\n    if (vo2max < excellent) return 'Excellent';\n    return 'Superior';\n}\n\n/**\n * Get recommended VO2max range for age/gender\n */\nexport function getRecommendedVO2maxRange(age: number, gender: 'male' | 'female' = 'male'): [number, number] {\n    // Return \"Good\" range (50th-75th percentile)\n    if (gender === 'male') {\n        if (age < 30) return [43, 52];\n        if (age < 40) return [40, 48];\n        if (age < 50) return [38, 46];\n        if (age < 60) return [35, 43];\n        return [32, 40];\n    } else {\n        if (age < 30) return [37, 44];\n        if (age < 40) return [34, 41];\n        if (age < 50) return [32, 39];\n        if (age < 60) return [30, 36];\n        return [27, 34];\n    }\n}\n","/**\n * VO2max Estimator View\n *\n * UI for estimating and tracking VO2max from workout data\n * Supports both running and cycling activities\n *\n * @module views/VO2maxView\n */\n\nimport type {\n    VO2maxEstimate,\n    RunningWorkoutData,\n    CyclingWorkoutData,\n    VO2maxTrend,\n} from '../calculations/vo2maxEstimator.js';\nimport type { UserProfile } from '../storage/userSettings.js';\nimport {\n    estimateVO2maxRunning,\n    estimateVO2maxCycling,\n    estimateVO2maxCooperTest,\n    saveVO2maxEstimate,\n    getVO2maxHistory,\n    getLatestVO2max,\n    calculateVO2maxTrend,\n    classifyVO2maxLevel,\n    getRecommendedVO2maxRange,\n} from '../calculations/vo2maxEstimator.js';\nimport { loadUserProfile } from '../storage/userSettings.js';\nimport { View } from '../router/View.js';\nimport { ViewId } from '../router/view-ids.js';\n\n/**\n * VO2max Estimator View Component\n */\nexport class VO2maxView implements View {\n    public id = ViewId.VO2max;\n    private container: HTMLElement | null = null;\n\n    public init(container: HTMLElement): void {\n        this.container = container;\n        this.render();\n    }\n\n    public onEnter(): void {\n        console.log('Entered VO2max View');\n        this.render();\n    }\n\n    public onLeave(): void {\n        console.log('Left VO2max View');\n    }\n\n    /**\n     * Render the VO2max estimator UI\n     */\n    private render(): void {\n        if (!this.container) return;\n\n        const latestRunning = getLatestVO2max('running');\n        const latestCycling = getLatestVO2max('cycling');\n        const history = getVO2maxHistory();\n\n        this.container.innerHTML = `\n            <div class=\"vo2max-view\">\n                <header class=\"vo2max-header\">\n                    <h1>ü´Å VO2max Estimator</h1>\n                    <p class=\"subtitle\">Estimate and track your cardiovascular fitness</p>\n                </header>\n\n                <!-- Current VO2max Summary -->\n                <section class=\"vo2max-summary\">\n                    <div class=\"summary-cards\">\n                        <div class=\"summary-card ${latestRunning ? '' : 'no-data'}\">\n                            <div class=\"card-icon\">üèÉ</div>\n                            <div class=\"card-content\">\n                                <div class=\"card-label\">Running VO2max</div>\n                                <div class=\"card-value\">${latestRunning ? latestRunning.vo2max : '--'}</div>\n                                <div class=\"card-unit\">ml/kg/min</div>\n                                ${\n                                    latestRunning\n                                        ? `<div class=\"card-badge badge-${latestRunning.confidence}\">${latestRunning.confidence} confidence</div>`\n                                        : '<div class=\"card-info\">No estimates yet</div>'\n                                }\n                            </div>\n                        </div>\n                        <div class=\"summary-card ${latestCycling ? '' : 'no-data'}\">\n                            <div class=\"card-icon\">üö¥</div>\n                            <div class=\"card-content\">\n                                <div class=\"card-label\">Cycling VO2max</div>\n                                <div class=\"card-value\">${latestCycling ? latestCycling.vo2max : '--'}</div>\n                                <div class=\"card-unit\">ml/kg/min</div>\n                                ${\n                                    latestCycling\n                                        ? `<div class=\"card-badge badge-${latestCycling.confidence}\">${latestCycling.confidence} confidence</div>`\n                                        : '<div class=\"card-info\">No estimates yet</div>'\n                                }\n                            </div>\n                        </div>\n                    </div>\n                </section>\n\n                <!-- Activity Type Selector -->\n                <section class=\"input-section\">\n                    <h2>Estimate VO2max</h2>\n                    \n                    <div class=\"activity-tabs\">\n                        <button class=\"activity-tab active\" data-activity=\"running\">\n                            <span class=\"tab-icon\">üèÉ</span>\n                            <span class=\"tab-label\">Running</span>\n                        </button>\n                        <button class=\"activity-tab\" data-activity=\"cycling\">\n                            <span class=\"tab-icon\">üö¥</span>\n                            <span class=\"tab-label\">Cycling</span>\n                        </button>\n                        <button class=\"activity-tab\" data-activity=\"cooper\">\n                            <span class=\"tab-icon\">‚è±Ô∏è</span>\n                            <span class=\"tab-label\">Cooper Test</span>\n                        </button>\n                    </div>\n\n                    <!-- Running Form -->\n                    <div id=\"running-form\" class=\"estimation-form\">\n                        <div class=\"form-description\">\n                            <p>Estimate VO2max from a steady-state run. Best results with 10+ minute runs at moderate-high intensity (70-90% max HR).</p>\n                        </div>\n                        \n                        <div class=\"input-group\">\n                            <label for=\"running-pace\">Average Pace (min:sec per km)</label>\n                            <input type=\"text\" id=\"running-pace\" class=\"input-field\" placeholder=\"5:00\" />\n                        </div>\n\n                        <div class=\"input-group\">\n                            <label for=\"running-hr\">Average Heart Rate (bpm)</label>\n                            <input type=\"number\" id=\"running-hr\" class=\"input-field\" placeholder=\"165\" min=\"60\" max=\"220\" />\n                        </div>\n\n                        <div class=\"input-group\">\n                            <label for=\"running-duration\">Duration (minutes)</label>\n                            <input type=\"number\" id=\"running-duration\" class=\"input-field\" placeholder=\"30\" min=\"1\" max=\"300\" />\n                        </div>\n\n                        <div class=\"input-group\">\n                            <label for=\"running-distance\">Distance (km)</label>\n                            <input type=\"number\" id=\"running-distance\" class=\"input-field\" placeholder=\"6.0\" step=\"0.1\" min=\"0.1\" />\n                        </div>\n\n                        <button class=\"btn btn-primary\" data-form=\"running\">Calculate Running VO2max</button>\n                    </div>\n\n                    <!-- Cycling Form -->\n                    <div id=\"cycling-form\" class=\"estimation-form\" style=\"display: none;\">\n                        <div class=\"form-description\">\n                            <p>Estimate VO2max from a power-based cycling workout. Best results with 20+ minute efforts at threshold intensity (85-95% max HR).</p>\n                        </div>\n                        \n                        <div class=\"input-group\">\n                            <label for=\"cycling-power\">Average Power (watts)</label>\n                            <input type=\"number\" id=\"cycling-power\" class=\"input-field\" placeholder=\"250\" min=\"50\" max=\"800\" />\n                        </div>\n\n                        <div class=\"input-group\">\n                            <label for=\"cycling-hr\">Average Heart Rate (bpm)</label>\n                            <input type=\"number\" id=\"cycling-hr\" class=\"input-field\" placeholder=\"170\" min=\"60\" max=\"220\" />\n                        </div>\n\n                        <div class=\"input-group\">\n                            <label for=\"cycling-duration\">Duration (minutes)</label>\n                            <input type=\"number\" id=\"cycling-duration\" class=\"input-field\" placeholder=\"20\" min=\"1\" max=\"300\" />\n                        </div>\n\n                        <button class=\"btn btn-primary\" data-form=\"cycling\">Calculate Cycling VO2max</button>\n                    </div>\n\n                    <!-- Cooper Test Form -->\n                    <div id=\"cooper-form\" class=\"estimation-form\" style=\"display: none;\">\n                        <div class=\"form-description\">\n                            <p>The Cooper 12-minute test: Run as far as possible in 12 minutes at maximum effort.</p>\n                        </div>\n                        \n                        <div class=\"input-group\">\n                            <label for=\"cooper-distance\">Distance Covered (meters)</label>\n                            <input type=\"number\" id=\"cooper-distance\" class=\"input-field\" placeholder=\"2800\" min=\"1000\" max=\"5000\" />\n                        </div>\n\n                        <button class=\"btn btn-primary\" data-form=\"cooper\">Calculate VO2max from Cooper Test</button>\n                    </div>\n\n                    <div id=\"profile-warning\" class=\"warning-box\" style=\"display: none;\">\n                        ‚ö†Ô∏è Please set your profile data (age, weight, max HR, resting HR) in Settings for accurate VO2max estimation.\n                    </div>\n                </section>\n\n                <!-- Results Section -->\n                <section id=\"results-section\" class=\"results-section\" style=\"display: none;\"></section>\n\n                <!-- Trend Section -->\n                ${history.length >= 2 ? this.renderTrendSection() : ''}\n\n                <!-- History Section -->\n                ${history.length > 0 ? this.renderHistorySection() : ''}\n\n                <!-- Info Section -->\n                <section class=\"info-section\">\n                    <h2>About VO2max</h2>\n                    \n                    <details>\n                        <summary><strong>What is VO2max?</strong></summary>\n                        <p>VO2max (maximal oxygen uptake) is the maximum rate at which your body can consume oxygen during exercise. It's measured in milliliters per kilogram of body weight per minute (ml/kg/min).</p>\n                        <p>VO2max is considered the gold standard measure of cardiovascular fitness and aerobic endurance capacity.</p>\n                    </details>\n\n                    <details>\n                        <summary><strong>Running Estimation Method</strong></summary>\n                        <p>Uses a Firstbeat-inspired algorithm that considers:</p>\n                        <ul>\n                            <li>Running speed and oxygen cost (ACSM formula)</li>\n                            <li>Heart rate relative to maximum HR</li>\n                            <li>Your age, weight, and resting heart rate</li>\n                        </ul>\n                        <p><strong>Best conditions:</strong> Steady-state run for 10+ minutes at 70-90% max HR</p>\n                    </details>\n\n                    <details>\n                        <summary><strong>Cycling Estimation Method</strong></summary>\n                        <p>Uses power output to estimate oxygen consumption:</p>\n                        <ul>\n                            <li>Mechanical power efficiency (~24% for cycling)</li>\n                            <li>VO2 (ml/kg/min) = (Power √ó 10.8 / weight) + 7</li>\n                            <li>Adjusted based on heart rate intensity</li>\n                        </ul>\n                        <p><strong>Best conditions:</strong> 20+ minute FTP test or threshold effort at 85-95% max HR</p>\n                    </details>\n\n                    <details>\n                        <summary><strong>Confidence Levels</strong></summary>\n                        <ul>\n                            <li><strong>High:</strong> Ideal workout conditions (duration, intensity, data quality)</li>\n                            <li><strong>Medium:</strong> Reasonable conditions but some factors not optimal</li>\n                            <li><strong>Low:</strong> Suboptimal conditions (too short, too easy/hard, poor data)</li>\n                        </ul>\n                        <p>Higher confidence estimates are more reliable for tracking fitness changes.</p>\n                    </details>\n\n                    <details>\n                        <summary><strong>VO2max Norms by Age</strong></summary>\n                        <p>Average VO2max values for healthy adults (ml/kg/min):</p>\n                        <table class=\"norms-table\">\n                            <tr>\n                                <th>Age</th>\n                                <th>Male (Fair-Good)</th>\n                                <th>Female (Fair-Good)</th>\n                            </tr>\n                            <tr><td>20-29</td><td>38-52</td><td>32-44</td></tr>\n                            <tr><td>30-39</td><td>35-48</td><td>30-41</td></tr>\n                            <tr><td>40-49</td><td>33-46</td><td>28-39</td></tr>\n                            <tr><td>50-59</td><td>31-43</td><td>26-36</td></tr>\n                            <tr><td>60+</td><td>28-40</td><td>23-34</td></tr>\n                        </table>\n                        <p><small>Source: ACSM and Cooper Institute norms</small></p>\n                    </details>\n                </section>\n            </div>\n        `;\n\n        this.attachEventListeners();\n        this.checkProfileData();\n    }\n\n    /**\n     * Render trend analysis section\n     */\n    private renderTrendSection(): string {\n        const runningTrend = calculateVO2maxTrend('running', 90);\n        const cyclingTrend = calculateVO2maxTrend('cycling', 90);\n\n        if (!runningTrend && !cyclingTrend) return '';\n\n        let html = '<section class=\"trend-section\"><h2>üìà Fitness Trends (Last 90 Days)</h2>';\n\n        if (runningTrend) {\n            html += this.renderTrendCard('Running', runningTrend, 'üèÉ');\n        }\n\n        if (cyclingTrend) {\n            html += this.renderTrendCard('Cycling', cyclingTrend, 'üö¥');\n        }\n\n        html += '</section>';\n        return html;\n    }\n\n    /**\n     * Render individual trend card\n     */\n    private renderTrendCard(activity: string, trend: VO2maxTrend, icon: string): string {\n        const trendIcon = trend.trend === 'improving' ? 'üìà' : trend.trend === 'declining' ? 'üìâ' : '‚û°Ô∏è';\n        const trendClass =\n            trend.trend === 'improving' ? 'improving' : trend.trend === 'declining' ? 'declining' : 'stable';\n\n        return `\n            <div class=\"trend-card\">\n                <div class=\"trend-header\">\n                    <span class=\"trend-icon\">${icon}</span>\n                    <h3>${activity} VO2max Trend</h3>\n                </div>\n                <div class=\"trend-stats\">\n                    <div class=\"trend-stat\">\n                        <div class=\"stat-label\">Recent Average</div>\n                        <div class=\"stat-value\">${trend.recentVO2max} <span class=\"stat-unit\">ml/kg/min</span></div>\n                    </div>\n                    <div class=\"trend-stat\">\n                        <div class=\"stat-label\">90-Day Average</div>\n                        <div class=\"stat-value\">${trend.averageVO2max} <span class=\"stat-unit\">ml/kg/min</span></div>\n                    </div>\n                    <div class=\"trend-stat\">\n                        <div class=\"stat-label\">Trend</div>\n                        <div class=\"stat-value trend-${trendClass}\">\n                            ${trendIcon} ${trend.changePercent > 0 ? '+' : ''}${trend.changePercent}%\n                        </div>\n                    </div>\n                </div>\n                <div class=\"trend-message ${trendClass}\">\n                    ${this.getTrendMessage(trend)}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Get trend interpretation message\n     */\n    private getTrendMessage(trend: VO2maxTrend): string {\n        if (trend.trend === 'improving') {\n            return `Your fitness is improving! Keep up the consistent training.`;\n        } else if (trend.trend === 'declining') {\n            return `Your fitness is declining. Consider reviewing your training volume and consistency.`;\n        } else {\n            return `Your fitness is stable. Consistent training is maintaining your current level.`;\n        }\n    }\n\n    /**\n     * Render history section\n     */\n    private renderHistorySection(): string {\n        const history = getVO2maxHistory().slice(-10).reverse();\n\n        return `\n            <section class=\"history-section\">\n                <h2>üìã Recent Estimates</h2>\n                <div class=\"history-table\">\n                    <table>\n                        <thead>\n                            <tr>\n                                <th>Date</th>\n                                <th>Activity</th>\n                                <th>VO2max</th>\n                                <th>Confidence</th>\n                                <th>Method</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${history\n                                .map(\n                                    (est) => `\n                                <tr>\n                                    <td>${new Date(est.timestamp).toLocaleDateString()}</td>\n                                    <td>${est.activityType === 'running' ? 'üèÉ Running' : 'üö¥ Cycling'}</td>\n                                    <td><strong>${est.vo2max}</strong> ml/kg/min</td>\n                                    <td><span class=\"badge-${est.confidence}\">${est.confidence}</span></td>\n                                    <td>${est.method}</td>\n                                </tr>\n                            `\n                                )\n                                .join('')}\n                        </tbody>\n                    </table>\n                </div>\n            </section>\n        `;\n    }\n\n    /**\n     * Attach event listeners\n     */\n    private attachEventListeners(): void {\n        if (!this.container) return;\n\n        // Activity tab switching\n        const tabs = this.container.querySelectorAll('.activity-tab');\n        tabs.forEach((tab) => {\n            tab.addEventListener('click', () => {\n                const activity = (tab as HTMLElement).dataset.activity as 'running' | 'cycling' | 'cooper';\n                this.switchActivity(activity);\n            });\n        });\n\n        // Calculate buttons\n        const calculateButtons = this.container.querySelectorAll('.btn-primary');\n        calculateButtons.forEach((btn) => {\n            btn.addEventListener('click', () => {\n                const form = (btn as HTMLElement).dataset.form as string;\n                this.handleCalculate(form);\n            });\n        });\n    }\n\n    /**\n     * Switch between activity types\n     */\n    private switchActivity(activity: 'running' | 'cycling' | 'cooper'): void {\n        if (!this.container) return;\n\n        // Update tabs\n        this.container.querySelectorAll('.activity-tab').forEach((tab) => {\n            tab.classList.remove('active');\n        });\n        this.container.querySelector(`[data-activity=\"${activity}\"]`)?.classList.add('active');\n\n        // Show/hide forms\n        this.container.querySelectorAll('.estimation-form').forEach((form) => {\n            (form as HTMLElement).style.display = 'none';\n        });\n        const formId = activity === 'cooper' ? 'cooper-form' : `${activity}-form`;\n        const activeForm = this.container.querySelector(`#${formId}`) as HTMLElement;\n        if (activeForm) activeForm.style.display = 'block';\n    }\n\n    /**\n     * Check if profile data is complete\n     */\n    private checkProfileData(): void {\n        const profile = loadUserProfile();\n        const profileWarning = document.getElementById('profile-warning');\n\n        const hasProfile = profile.maxHr !== null && profile.weight !== null && profile.maxHr > 0 && profile.weight > 0;\n\n        if (profileWarning) {\n            profileWarning.style.display = hasProfile ? 'none' : 'block';\n        }\n    }\n\n    /**\n     * Handle calculate button click\n     */\n    private handleCalculate(formType: string): void {\n        const profile = loadUserProfile();\n\n        // Validate profile\n        if (!profile.weight || !profile.maxHr || !profile.age || !profile.restingHr) {\n            this.showError(\n                'Please complete your profile in Settings (Weight, Max HR, Age, and Resting HR) before estimating VO2max.'\n            );\n            return;\n        }\n\n        let estimate: VO2maxEstimate | null = null;\n\n        try {\n            if (formType === 'running') {\n                estimate = this.calculateRunningVO2max(profile);\n            } else if (formType === 'cycling') {\n                estimate = this.calculateCyclingVO2max(profile);\n            } else if (formType === 'cooper') {\n                estimate = this.calculateCooperVO2max(profile);\n            }\n\n            if (estimate) {\n                saveVO2maxEstimate(estimate);\n                this.displayResult(estimate, profile);\n            }\n        } catch (error) {\n            this.showError(error instanceof Error ? error.message : 'Invalid input. Please check your data.');\n        }\n    }\n\n    /**\n     * Calculate running VO2max from form\n     */\n    private calculateRunningVO2max(profile: UserProfile): VO2maxEstimate {\n        const paceInput = (document.getElementById('running-pace') as HTMLInputElement).value.trim();\n        const avgHR = parseInt((document.getElementById('running-hr') as HTMLInputElement).value);\n        const duration = parseFloat((document.getElementById('running-duration') as HTMLInputElement).value) * 60;\n        const distance = parseFloat((document.getElementById('running-distance') as HTMLInputElement).value) * 1000;\n\n        // Parse pace (min:sec format)\n        const paceMatch = paceInput.match(/^(\\d+):(\\d+)$/);\n        if (!paceMatch) {\n            throw new Error('Invalid pace format. Use MM:SS (e.g., 5:00)');\n        }\n        const paceMinutes = parseInt(paceMatch[1]);\n        const paceSeconds = parseInt(paceMatch[2]);\n        const avgPace = paceMinutes * 60 + paceSeconds; // seconds per km\n\n        if (!avgPace || !avgHR || !duration || !distance) {\n            throw new Error('Please fill in all fields');\n        }\n\n        if (avgPace < 120 || avgPace > 900) {\n            throw new Error('Pace must be between 2:00 and 15:00 per km');\n        }\n\n        const workoutData: RunningWorkoutData = { avgPace, avgHeartRate: avgHR, duration, distance };\n        return estimateVO2maxRunning(workoutData, profile);\n    }\n\n    /**\n     * Calculate cycling VO2max from form\n     */\n    private calculateCyclingVO2max(profile: UserProfile): VO2maxEstimate {\n        const avgPower = parseInt((document.getElementById('cycling-power') as HTMLInputElement).value);\n        const avgHR = parseInt((document.getElementById('cycling-hr') as HTMLInputElement).value);\n        const duration = parseFloat((document.getElementById('cycling-duration') as HTMLInputElement).value) * 60;\n\n        if (!avgPower || !avgHR || !duration) {\n            throw new Error('Please fill in all fields');\n        }\n\n        if (avgPower < 50 || avgPower > 800) {\n            throw new Error('Power must be between 50 and 800 watts');\n        }\n\n        const workoutData: CyclingWorkoutData = { avgPower, avgHeartRate: avgHR, duration };\n        return estimateVO2maxCycling(workoutData, profile);\n    }\n\n    /**\n     * Calculate VO2max from Cooper test\n     */\n    private calculateCooperVO2max(_profile: UserProfile): VO2maxEstimate {\n        const distance = parseInt((document.getElementById('cooper-distance') as HTMLInputElement).value);\n\n        if (!distance) {\n            throw new Error('Please enter the distance covered');\n        }\n\n        if (distance < 1000 || distance > 5000) {\n            throw new Error('Distance must be between 1000 and 5000 meters');\n        }\n\n        return estimateVO2maxCooperTest(distance);\n    }\n\n    /**\n     * Display estimation result\n     */\n    private displayResult(estimate: VO2maxEstimate, profile: UserProfile): void {\n        const resultsSection = document.getElementById('results-section');\n        if (!resultsSection) return;\n\n        const fitnessLevel = classifyVO2maxLevel(estimate.vo2max, profile.age || 30, profile.gender || 'male');\n        const [minRec, maxRec] = getRecommendedVO2maxRange(profile.age || 30, profile.gender || 'male');\n\n        resultsSection.style.display = 'block';\n        resultsSection.innerHTML = `\n            <div class=\"result-card\">\n                <h2>üìä Estimation Result</h2>\n                \n                <div class=\"result-main\">\n                    <div class=\"result-value\">${estimate.vo2max}</div>\n                    <div class=\"result-unit\">ml/kg/min</div>\n                </div>\n\n                <div class=\"result-details\">\n                    <div class=\"result-row\">\n                        <span class=\"result-label\">Fitness Level:</span>\n                        <span class=\"result-data\"><strong>${fitnessLevel}</strong></span>\n                    </div>\n                    <div class=\"result-row\">\n                        <span class=\"result-label\">Confidence:</span>\n                        <span class=\"result-data badge-${estimate.confidence}\">${estimate.confidence}</span>\n                    </div>\n                    <div class=\"result-row\">\n                        <span class=\"result-label\">Method:</span>\n                        <span class=\"result-data\">${estimate.method}</span>\n                    </div>\n                    <div class=\"result-row\">\n                        <span class=\"result-label\">Activity:</span>\n                        <span class=\"result-data\">${estimate.activityType === 'running' ? 'üèÉ Running' : 'üö¥ Cycling'}</span>\n                    </div>\n                    <div class=\"result-row\">\n                        <span class=\"result-label\">Recommended Range:</span>\n                        <span class=\"result-data\">${minRec}-${maxRec} ml/kg/min</span>\n                    </div>\n                </div>\n\n                ${estimate.notes ? `<div class=\"result-notes\">‚ÑπÔ∏è ${estimate.notes}</div>` : ''}\n\n                <div class=\"result-actions\">\n                    <button class=\"btn btn-secondary\" onclick=\"window.location.reload()\">New Estimate</button>\n                </div>\n            </div>\n        `;\n\n        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    }\n\n    /**\n     * Show error message\n     */\n    private showError(message: string): void {\n        const resultsSection = document.getElementById('results-section');\n        if (resultsSection) {\n            resultsSection.style.display = 'block';\n            resultsSection.innerHTML = `\n                <div class=\"error-card\">\n                    <p>‚ùå ${message}</p>\n                </div>\n            `;\n        }\n    }\n\n    /**\n     * Clean up the view\n     */\n    public destroy(): void {\n        if (this.container) {\n            this.container.innerHTML = '';\n        }\n    }\n}\n"],"names":["estimateVO2maxRunning","workoutData","profile","avgPace","avgHeartRate","duration","maxHr","restingHr","age","velocityMPS","velocityKMH","velocityMPM","vo2AtPace","hrReserve","hrPercent","estimatedVO2max","ageAdjustment","adjustedVO2max","confidence","notes","estimateVO2maxCycling","avgPower","normalizedPower","weight","effectivePower","vo2AtPower","estimateVO2maxCooperTest","distanceMeters","vo2max","VO2MAX_STORAGE_KEY","saveVO2maxEstimate","estimate","history","getVO2maxHistory","trimmed","error","stored","getLatestVO2max","activityType","filtered","e","highConfidence","calculateVO2maxTrend","daysBack","cutoffTime","allValues","averageVO2max","sum","val","recentCutoff","recentValues","minRecentEstimates","recentEstimates","recentVO2max","changePercent","trend","dataPoints","classifyVO2maxLevel","gender","maleThresholds","femaleThresholds","ageGroup","thresholds","poor","fair","good","excellent","getRecommendedVO2maxRange","VO2maxView","ViewId","container","latestRunning","latestCycling","runningTrend","cyclingTrend","html","activity","icon","trendIcon","trendClass","est","tab","btn","form","formId","activeForm","loadUserProfile","profileWarning","hasProfile","formType","paceInput","avgHR","distance","paceMatch","paceMinutes","paceSeconds","_profile","resultsSection","fitnessLevel","minRec","maxRec","message"],"mappings":"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"}