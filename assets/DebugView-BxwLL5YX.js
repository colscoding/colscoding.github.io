import{b as T,v as b,B as g}from"./feature-bluetooth-BY8rQx0J.js";import{V as $}from"./index-CmfhMaTA.js";import"./vendor-core-Dob3nYDb.js";import"./feature-export-7zlEGvkQ.js";import"./vendor-leaflet-3-yx3GaH.js";async function A(p=90,t=4){const e=[],o=new Date,a=250;for(let s=p;s>=0;s--){const c=new Date(o);if(c.setDate(c.getDate()-s),Math.random()>t/7)continue;const n=(30+Math.floor(Math.random()*60))*60,l=[],d=[],u=c.getTime();let f=150+Math.floor(Math.random()*100);const k=20;for(let r=0;r<n;r++){const i=u+r*1e3,E=(Math.random()-.5)*k,w=Math.max(0,f+E+Math.sin(r/600)*50),D=60+w*.4+Math.random()*5;l.push({timestamp:i,value:Math.round(w)}),d.push({timestamp:i,value:Math.round(D)})}const h=l.reduce((r,i)=>r+i.value,0)/l.length,m=h*1.05,y=m/a,v=n*m*y/(a*3600)*100,L={heartrate:d,power:l,cadence:[],speed:[],distance:[],altitude:[],gps:[],treadmill:[]},M={avgPower:Math.round(h),maxPower:Math.round(h*1.5),normalizedPower:Math.round(m),avgHeartrate:Math.round(d.reduce((r,i)=>r+i.value,0)/d.length),maxHeartrate:190,trainingLoad:Math.round(v),intensityFactor:Number(y.toFixed(2)),totalTimeMs:n*1e3,sampleCount:n},C={id:crypto.randomUUID(),startTime:u,lastUpdated:u+n*1e3,measurements:L,isCompleted:!0,summary:M};e.push(C)}console.log(`Generating ${e.length} mock workouts...`);for(const s of e)await T(s.measurements,s.startTime,s.lastUpdated,s.summary);console.log("Mock history generation complete."),alert(`Generated ${e.length} workouts. Please refresh the page.`)}class q{id=$.Debug;logArea=null;boundOnLog=this.onLog.bind(this);logBuffer=[];init(t){const e=document.getElementById("debugTemplate");if(e){const o=e.content.cloneNode(!0);t.appendChild(o),this.setupEvents(t)}else console.error("Debug template not found"),t.innerHTML="<p>Error loading debug view</p>"}onEnter(){b.addListener(this.boundOnLog)}onLeave(){b.removeListener(this.boundOnLog)}onLog(t,e){const o=new Date().toISOString();if(this.logBuffer.push({timestamp:o,sensor:t,data:e}),this.logArea){const a=o.split("T")[1].slice(0,-1);this.logArea.value+=`[${a}] ${t}: ${e}
`,this.logArea.scrollTop=this.logArea.scrollHeight}}setupEvents(t){this.logArea=t.querySelector("#debugLog");const e=t.querySelector("#connectTreadmillDebug"),o=t.querySelector("#connectRowerDebug"),a=t.querySelector("#connectConcept2Debug"),s=t.querySelector("#connectSkiErgDebug"),c=t.querySelector("#downloadLogs");t.querySelector("#generateMockHistoryBtn")?.addEventListener("click",async()=>{if(confirm("This will add random workout data to your history. Continue?")){this.log("System","Generating mock history...");try{await A(),this.log("System","Mock history generated.")}catch(n){this.log("Error",`Failed to generate mock history: ${n}`)}}}),e?.addEventListener("click",async()=>{try{this.log("System","Connecting to Treadmill..."),await g.connectTreadmill(),this.log("System","Connected to Treadmill")}catch(n){this.log("System",`Treadmill connection failed: ${n}`)}}),o?.addEventListener("click",async()=>{try{this.log("System","Connecting to Rower..."),await g.connectRowing(),this.log("System","Connected to Rower")}catch(n){this.log("System",`Rower connection failed: ${n}`)}}),a?.addEventListener("click",async()=>{try{this.log("System","Connecting to Concept2..."),await g.connectConcept2(),this.log("System","Connected to Concept2")}catch(n){this.log("System",`Concept2 connection failed: ${n}`)}}),s?.addEventListener("click",async()=>{try{this.log("System","Connecting to Ski Erg..."),await g.connectSkiErg(),this.log("System","Connected to Ski Erg")}catch(n){this.log("System",`Ski Erg connection failed: ${n}`)}}),c?.addEventListener("click",()=>{this.downloadLocalLogs()})}downloadLocalLogs(){const t=new Blob([JSON.stringify(this.logBuffer,null,2)],{type:"application/json"}),e=URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download=`bpt-debug-session-${Date.now()}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(e)}log(t,e){if(this.logArea){const o=new Date().toISOString().split("T")[1].slice(0,-1);this.logArea.value+=`[${o}] ${t}: ${e}
`,this.logArea.scrollTop=this.logArea.scrollHeight}}}export{q as DebugView};
//# sourceMappingURL=DebugView-BxwLL5YX.js.map
