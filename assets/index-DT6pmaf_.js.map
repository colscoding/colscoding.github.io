{"version":3,"mappings":"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","names":["BaseComponent","name","oldValue","newValue","_name","_oldValue","_newValue","eventName","detail","selector","sharedStyles","MetricDisplay","label","value","unit","icon","zoneName","showAvg","connected","zone","POWER_ZONES","PowerGauge","size","ftp","max","showZones","radius","circumference","arcLength","ftpPercent","_zone","zoneIndex","zoneNumber","zoneColorVar","progress","dashOffset","currentFtpPercent","index","startPercent","endPercent","zoneArcLength","offset","targetValue","duration","startValue","startTime","animate","currentTime","elapsed","eased","currentValue","ZoneGauge","percent","fill","container","CHART_CONFIG","LiveChart","config","timestamp","cutoffTime","time","visibleData","d","noDataMsg","width","height","points","areaPoints","point","x","y","linePath","firstX","lastX","areaPath","avg","sum","p","WorkoutTimer","showMs","timeString","totalSeconds","hours","minutes","seconds","pad","n","result","ms","state","TYPE_STYLES","Toast","message","type","dismissible","styles","dismissBtn","options","toast","Modal","title","e","action","focusableElements","first","last","resolve","modal","content","footer","cancelBtn","confirmBtn","okBtn","isImperial","settings","DEFAULT_POWER_ZONES","DEFAULT_HR_ZONES","generateSlotId","generateScreenId","createEmptyScreen","createSlot","fieldId","position","addSlotToScreen","screen","removeSlotFromScreen","slotId","reorderedSlots","slot","updateSlot","updates","reorderSlots","slotIds","slotMap","id","DATA_FIELD_REGISTRY","registrationOrder","registerDataField","field","getDataField","getAllDataFields","getFieldsByCategory","category","f","getAllCategories","categories","list","searchFields","query","lowerQuery","calculateRollingAverage","measurements","windowMs","referenceTime","windowStart","windowValues","m","acc","calculateAverage","calculateMax","getLatestValue","maxAge","latest","getZoneForValue","referenceValue","zones","highestZone","getZoneColor","zoneNum","zoneConfig","z","hexToRgba","darkenColor","calculatePercentOfReference","hex","alpha","g","b","factor","r","formatDuration","showHours","formatPace","speedMs","imperial","secondsPerUnit","slotCounter","resetSlotCounter","createCyclingMainScreen","createCyclingPowerScreen","createCyclingHrScreen","createCyclingClimbScreen","createCyclingLapScreen","createCyclingSimpleScreen","createIndoorMainScreen","createIndoorPowerScreen","createIndoorTrainingScreen","createIndoorZonesScreen","createRunningMainScreen","createRunningPaceScreen","DEFAULT_CYCLING_PROFILE","DEFAULT_INDOOR_PROFILE","DEFAULT_RUNNING_PROFILE","DEFAULT_SIMPLE_PROFILE","DEFAULT_PROFILES","DEFAULT_DATA_FIELD_SETTINGS","createDefaultIndoorProfile","createDefaultSettings","migrateFromLegacySettings","legacySettings","slots","s","i","DEFAULT_UPDATE_INTERVALS","CalculationManager","workoutState","frequency","fields","interval","timerId","callback","fieldIds","allFields","results","frequencies","freq","error","listener","createCalculationManager","SENSOR_FIELD_MAP","DataFieldsManager","profile","carousel","prop","set","connections","powerConnected","hrConnected","cadenceConnected","gpsConnected","property","callbacks","cb","laps","lapCount","lapStartTime","lap","idx","createDataFieldsManager","STORAGE_KEY","LEGACY_SETTINGS_KEY","SCHEMA_VERSION","loadDataFieldSettings","stored","parsed","migrated","migrateStoredSettings","validateSettings","legacyStored","legacy","saveDataFieldSettings","loadActiveProfile","saveProfile","existingIndex","saveActiveScreenIndex","profileId","screenIndex","version","validateProfile","storageCallbacks","event","powerZoneColorizer","powerCurrent","power3s","power10s","power30s","powerAvg","powerLapAvg","lapMeasurements","powerMax","powerZone","_workoutState","power","powerPercentFtp","powerNormalized","powerData","thirtySecondAverages","windowSize","windowEnd","fourthPowers","v","avgFourthPower","intensityFactor","npCalc","np","tss","durationSeconds","ifValue","kilojoules","totalJoules","prev","curr","timeDeltaSeconds","avgPower","wattsPerKg","POWER_FIELDS","hrZoneColorizer","hrCurrent","hr5s","hr30s","hrAvg","hrLapAvg","hrMax","hrMin","data","hrZone","hr","hrPercentMax","hrPercentReserve","reserve","caloriesFromHr","hrData","totalCalories","timeDeltaMinutes","caloriesPerMinute","hrTimeInZone","timeInZones","timeDelta","avgHr","HEARTRATE_FIELDS","CADENCE_RANGES","CADENCE_COLORS","getCadenceColor","cadence","cadenceCurrent","cadence5s","cadence30s","cadenceAvg","nonZeroData","cadenceLapAvg","cadenceMax","cadenceZone","names","colors","pedalBalance","deviation","pedalingTime","cadenceData","totalTime","totalRevolutions","totalRevs","avgCadence","CADENCE_FIELDS","msToKmh","msToMph","getSpeedInUserUnit","getPaceInUserUnit","kmh","minPerKm","speedCurrent","speed","speed5s","avgMs","speed30s","speedAvg","movingData","speedLapAvg","speedMax","maxMs","paceCurrent","paceAvg","movingTime","speedData","movingMs","MOVING_THRESHOLD","secs","stoppedTime","stoppedMs","verticalSpeed","elevationData","now","recentData","elevationGain","timeDeltaHours","efficiencyFactor","movingSpeedData","avgSpeedMs","avgSpeedKmh","SPEED_FIELDS","metersToKm","meters","metersToMiles","getDistanceInUserUnit","distanceTotal","positions","totalMeters","R","lat1","lat2","deltaLat","deltaLon","a","c","distanceLap","lapPositions","distanceToMarker","totalUnits","DISTANCE_FIELDS","timeElapsed","_measurements","timeLap","timeLastLap","lastLap","timeClock","timeStarted","timeEta","targetDistance","currentDistance","remainingDistance","elapsedHours","avgSpeed","lapNumber","timeSunset","lat","dayOfYear","declination","sunsetHour","sunsetTime","TIME_FIELDS","metersToFeet","getElevationInUserUnit","elevationCurrent","elevation","totalGain","THRESHOLD","diff","elevationLoss","totalLoss","elevationLapGain","lapData","gradeCurrent","elevations","recentPositions","recentElevations","horizontalDistance","gradeAvg","totalDistance","elevationMax","maxElevation","elevationMin","minElevation","ELEVATION_FIELDS","calorieCalculator","calorieRateCalculator","weight","termAge","termWeight","termHr","calPerMin","defaultFormatter","energyFields","initializeDataFields","ENERGY_FIELDS","DataFieldComponent","rawValue","valueEl","formattedValue","unitEl","fieldEl","newSize","highlight","DataScreenComponent","_slotId","sensorType","el","screenEl","ScreenCarouselComponent","newIndex","direction","clampedIndex","activeScreen","_screen","track","slide","dot","deltaX","deltaY","baseOffset","swipeOffset","_e","target","FieldPickerComponent","preselectedFieldId","cat","categoryBtn","fieldBtn","sizeBtn","_cat","catFields","available","str","div","ScreenEditorComponent","originalScreen","l","fieldName","fieldIcon","actionElement","slotEl","targetEl","targetSlotId","currentOrder","fromIndex","toIndex","editingSlotId","ProfileSettingsComponent","profiles","activeId","screens","btn","item","htmlItem","templateProfile","newProfile","defaultProfile","newScreen","screenId","duplicate","dropTarget","draggedId","targetId","draggedIndex","targetIndex","draggedScreen","isNew","editor","updatedScreen","registerDataFieldComponents","DB_NAME","DB_VERSION","STORE_NAME","COMPLETED_STORE","DEBUG_STORE","db","openDatabase","reject","request","database","debugStore","saveDebugLog","sensor","record","getDebugLogs","clearDebugLogs","saveActiveWorkout","clearActiveWorkout","loadActiveWorkout","saveCompletedWorkout","endTime","getWorkoutHistory","saveTimeout","pendingSave","throttledSave","delayMs","flushPendingSave","isIndexedDBSupported","archiveWorkout","active","hasRecoverableWorkout","getCompletedWorkouts","markWorkoutSynced","store","calculateDistance","lon1","lon2","1","2","","","VALIDATION_LIMITS","instanceOfAny","object","constructors","idbProxyableTypes","cursorAdvanceMethods","getIdbProxyableTypes","getCursorAdvanceMethods","transactionDoneMap","transformCache","reverseTransformCache","promisifyRequest","promise","unlisten","success","wrap","cacheDonePromiseForTransaction","tx","done","complete","idbProxyTraps","receiver","replaceTraps","wrapFunction","func","args","unwrap","transformCachableValue","openDB","blocked","upgrade","blocking","terminated","openPromise","readMethods","writeMethods","cachedMethods","getMethod","targetFuncName","useIndex","isWrite","method","storeName","oldTraps","advanceMethodProps","methodMap","advanceResults","ittrProxiedCursorToOriginalProxy","cursorIteratorTraps","cachedFunc","iterate","cursor","proxiedCursor","isIteratorProp","DEFAULT_SETTINGS","SettingsStore","key","settingsStore","calculateCaloriesFromPower","powerWatts","calculateCaloriesFromHeartRate","heartRate","weightKg","age","MeasurementsState","enablePersistence","_settings","source","dt","kcal","entry","min","lastPoint","dist","currentTotalDistance","clearPersisted","enabled","measurement","getInitState","exposeVariablesDuringTest","measurementsState","connectionsState","ExceptionCode","CapacitorException","code","getPlatformId","win","_a","_b","createCapacitor","capCustomPlatform","cap","Plugins","getPlatform","isNativePlatform","isPluginAvailable","pluginName","plugin","registeredPlugins","getPluginHeader","h","handleError","err","registerPlugin","jsImplementations","registeredPlugin","platform","pluginHeader","jsImplementation","loadPluginImplementation","createPluginMethod","impl","methodHeader","createPluginMethodWrapper","remove","wrapper","fn","addListener","removeListener","addListenerNative","call","callbackId","proxy","_","filePath","initCapacitorGlobal","Capacitor","WebPlugin","listenerFunc","firstListener","windowListener","retainUntilConsumed","listeners","windowEventName","pluginEventName","msg","handle","arg","encode","decode","CapacitorCookiesPluginWeb","cookies","cookieMap","cookie","encodedKey","encodedValue","expires","path","domain","readBlobAsBase64","blob","reader","base64String","normalizeHttpHeaders","headers","originalKeys","k","buildUrlParams","params","shouldEncode","accumulator","buildRequestInit","extra","output","form","CapacitorHttpPluginWeb","requestInit","urlParams","url","response","contentType","responseType","SystemBarsStyle","SystemBarType","SystemBarsPluginWeb","App","__vitePreload","Router","canGoBack","view","viewContainer","viewId","replace","hash","matchedRoute","currentView","newView","DashboardView","_container","API_BASE_URL","API_KEY","parseError","body","getHeaders","extraHeaders","isDatabaseAvailable","createWorkout","streamName","sport","userId","errorData","listWorkouts","page","limit","status","startDate","endDate","getWorkout","workoutId","includeTelemetry","completeWorkout","archiveTelemetry","deleteWorkout","formatDate","date","getFtpHistory","announce","priority","announcer","shortcuts","registerShortcut","shortcut","handleKeydown","keyMatch","ctrlMatch","shiftMatch","altMatch","initKeyboardNavigation","startButton","pauseButton","resumeButton","modals","closeBtn","details","firstButton","settingsBtn","router","historyBtn","exportBtn","lapBtn","summary","trapFocus","firstElement","lastElement","updateWorkoutControlsAccessibility","stopButton","controlsContainer","createModalElement","titleText","button","firstFocusable","lastFocusable","handleTabKey","showModal","previousActiveElement","removeFocusTrap","autofocusEl","closeModal","handleEscape","originalOnClose","showConfirmation","confirmText","cancelText","confirmVariant","calculateWorkoutSummary","zoneState","calcStats","values","powerValues","powerCurve","durations","getMaxForDuration","maxAvg","trainingLoad","profileStr","rolling30s","sum30","pow4","avgPow4","powerDist","hrDist","formatDurationLong","parts","formatSecondsShort","mins","ZONE_COLORS","createZoneHistogram","distribution","maxTime","timeSeconds","color","timeStr","createSummaryContent","newRecords","formatValue","recordsHtml","powerChart","hrChart","showWorkoutSummary","renderLineChart","padTop","padBottom","padLeft","padRight","processedData","downsample","xValues","yValues","minX","maxX","minY","maxY","yRange","getX","val","getY","pathD","areaD","gridLines","yStep","startTimeStr","formatTime","midTimeStr","endTimeStr","svg","step","renderBarChart","barGap","availableWidth","barWidth","bars","labelStep","xLabels","emptyStats","getSummary","workout","currentWorkouts","trendMetric","renderPeriodStatistics","containerId","workouts","statsContainer","renderSummaryTable","renderTrendsChart","parent","card","startOfWeek","day","startOfLastWeek","endOfLastWeek","startOfMonth","startOfLastMonth","endOfLastMonth","startOfYear","periods","w","buckets","stat","dur","renderCell","rows","row","updateChart","select","weeks","weekKey","getWeekKey","year","week","getDateFromWeek","dayNum","yearStart","weekNo","cropWorkout","originalStartTime","newStartTime","newEndTime","start","end","filterMeasurements","croppedMeasurements","t","modalSummary","currentPage","totalPages","dbAvailable","filterType","filterStartDate","filterEndDate","calendarDate","dataSource","initHistoryLogic","prevBtn","nextBtn","refreshBtn","typeFilter","dateStart","dateEnd","viewListBtn","viewCalendarBtn","viewAnalyticsBtn","listView","calendarView","analyticsView","prevMonthBtn","nextMonthBtn","sourceCloudBtn","sourceLocalBtn","setSource","checkDatabaseAvailability","setView","loadWorkouts","loadCalendar","loadAnalytics","handleFilterChange","historyButton","hasIndexedDB","updateSourceToggle","storedToWorkout","listContainer","pageInfo","total","pagination","renderWorkoutCard","viewWorkoutDetails","confirmDeleteWorkout","syncWorkout","cloudBtn","localBtn","localId","local","createRes","statusClass","syncBtn","detailPanel","listPanel","renderWorkoutDetail","renderWorkoutCharts","exportWorkoutData","startCropTool","filename","jsonData","jsonBlob","jsonUrl","jsonLink","calendarGrid","monthLabel","monthNames","month","renderCalendar","renderMonthlyStats","firstDay","daysInMonth","empty","dayCell","wDate","today","totalWorkouts","totalDuration","totalEnergy","prList","ftpHistory","renderAnalytics","renderPersonalRecords","renderTrainingLoad","renderPowerCurve","renderFitnessTrend","renderFtpHistory","renderPrHistory","maxPower","maxHr","longestRide","maxDistance","dateStr","createRow","weekNum","getWeekNumber","maxLoad","load","bests","maxWatts","formatDurationLabel","sec","sorted","tssMap","current","dataPoints","kCTL","kATL","ctl","atl","chartW","chartH","maxVal","timeSpan","ctlPath","atlPath","history","maxFtp","minFtp","ftpRange","currX","prevY","currY","events","powerCurveBests","notable","labels","reversedEvents","refreshHistoryView","telemetryJson","startTimeIso","startTs","powerContainer","hrContainer","cadContainer","altContainer","validPoints","originalStart","originalEnd","currentStart","currentEnd","durationMs","sliderStart","sliderEnd","displayStart","displayEnd","displayDuration","chartContainer","renderPreview","updateUI","startOffset","endOffset","workoutStorage","HistoryView","template","generateRampSteps","startWatts","stepWatts","steps","watts","RAMP_TEST","SWEET_SPOT_3X10","VO2_MAX_30_30","WORKOUT_LIBRARY","getWorkoutDuration","PROFILE_KEY","loadUserProfile","saveUserProfile","AudioController","Ctx","muted","osc","gain","text","utterance","audioManager","WorkoutRunner","nextIndex","startVal","endVal","currentVal","getCustomWorkouts","raw","saveCustomWorkout","saveAll","deleteCustomWorkout","filtered","activeRunner","initWorkoutSelectionLogic","initPlayerControls","initImportExport","refreshWorkoutList","importBtn","importInput","files","importWorkoutFile","file","exportWorkout","dataStr","downloadAnchorNode","custom","h3","renderWorkoutItem","h3lib","isCustom","actionsHtml","actionContainerStyle","startStructuredWorkout","onComplete","completed","updatePlayerUI","overlay","minimizeBtn","skipBtn","isHidden","nameEl","descEl","timeEl","durEl","nextEl","progressEl","timeRemaining","nextPwr","calculateNextTarget","pct","onWorkoutStart","onWorkoutPause","currentSteps","initWorkoutBuilder","createBtn","saveBtn","addStepBtn","openBuilder","closeBuilder","saveWorkout","addStepFromForm","targetTypeSelect","valInput","selectionModal","resetForm","renderSteps","durationStr","targetType","targetValStr","targetTypeStr","capitalize","desc","WorkoutsView","showNotification","notification","backgroundColor","selectElement","element","onboardingSteps","createOnboardingModal","renderProgressDots","currentStep","totalSteps","renderStep","stepIndex","elements","inputContainer","inputField","inputLabel","inputUnit","helpText","progressDots","showOnboarding","forceShow","saveCurrentInput","render","goNext","goPrev","skip","shouldShowOnboarding","initOnboarding","SETTINGS_KEY","defaultAutoPauseSettings","defaultWorkoutMetadataSettings","defaultCountdownSettings","defaultAutoLapSettings","defaultVoiceMetrics","defaultEnhancedVoiceSettings","defaultIntervalsSettings","defaultSettings","getSettings","settingsJson","saveSettingsToStorage","BluetoothDebugService","buffer","logs","deferredPrompt","initInstallPrompt","updateInstallButtonVisibility","canInstallPwa","triggerInstallPrompt","outcome","installButton","installButtonContainer","AutoPauseService","timeState","minTimestamp","recentMeasurements","threshold","delay","isAboveThreshold","timeBelow","getAutoPauseSourceUnit","defaultSportSettings","SPORT_SETTINGS_KEY","getSportSettings","saveSportSettings","paceSecPerKm","initSettingsLogic","saveSettingsButton","settingFtp","settingMaxHr","settingWeight","settingSpeed","settingDistance","settingAltitude","settingShowCalories","settingPower","settingCadence","settingHeartrate","settingTreadmillSpeed","settingPower3s","settingHighContrast","settingColorblindPatterns","settingVoiceEnabled","settingVoiceLaps","settingVoiceZones","settingAutoPauseEnabled","settingAutoPauseSource","settingAutoPauseThreshold","settingAutoPauseDelay","autoPauseOptions","autoPauseThresholdUnit","settingExportTcx","settingExportCsv","settingExportJson","settingExportFit","settingPromptForNotes","settingPromptForExertion","settingCountdownDuration","settingCountdownBeep","settingCountdownVoice","settingAutoLapEnabled","settingAutoLapSource","settingAutoLapDistance","settingAutoLapTime","autoLapOptions","autoLapDistanceOption","autoLapTimeOption","settingVoiceTimeInterval","settingVoiceDistanceInterval","settingVoiceSpeechRate","settingVoiceMetricPower","settingVoiceMetricHeartrate","settingVoiceMetricCadence","settingVoiceMetricSpeed","settingVoiceMetricDistance","settingVoiceMetricTime","settingSportType","settingShowPace","settingThresholdPace","runningOptions","settingIntervalsEnabled","settingIntervalsApiKey","toggleIntervalsApiKey","settingIntervalsAthleteId","settingIntervalsAutoUpload","intervalsOptions","settingDebugMode","debugControls","downloadDebugLogs","installPwaButton","updateIntervalsUI","updateSportUI","isRunning","parsePace","paceStr","match","saveSportSettingsFromUI","sportSettings","paceSeconds","loadSportSettings","thresholdPace","isPassword","updateAutoPauseUI","updateAutoLapUI","isDistance","applySettings","toggleMetric","metric","isVisible","saveSettings","updatedProfile","loadSettings","updateCallbacks","subscribe","notifyUpdate","updateState","loadProfile","saveCurrentProfile","getSelectedScreen","addFieldToScreen","updateScreenInProfile","removeFieldFromScreen","updateFieldSlot","updateScreenLayout","layout","reorderFields","removed","getFilteredFields","CATEGORY_ICONS","createConfigUI","setupConfigEventListeners","renderConfigUI","renderScreenTabs","renderCurrentScreen","renderFieldPicker","tabsContainer","escapeHtml","layoutSelect","fieldsList","categoriesContainer","fieldsContainer","currentScreen","usedFieldIds","isUsed","tab","showFieldPicker","hideFieldPicker","catBtn","removeBtn","resetToDefaults","searchInput","setupDragAndDrop","draggedEl","targetItem","picker","initDataFieldsConfig","settingsContent","voiceFeedback","SettingsView","ViewId","createIntervalWorkout","description","createEnduranceWorkout","ftpBuilderPlan","STORAGE_KEY_PLANS","STORAGE_KEY_PROGRESS","PlanRepository","plan","userPlans","plans","planId","planRepository","PlansView","activeProgress","html","activePlan","daysSinceStart","currentWeekNum","currentDayNum","isActive","isComplete","isToday","currentDayAbsolute","thisDayAbsolute","currentDetailId","ScanMode","ConnectionPriority","numbersToDataView","dataViewToNumbers","numberToUUID","hexStringToDataView","bin","isEmpty","dataViewToHexString","webUUIDToString","uuid","mapToObject","map","obj","toUint8Array","dataView","toHexString","BluetoothLe","makeQueue","currentTask","getQueue","parseUUID","BleClientClass","displayStrings","resultInternal","deviceIds","services","deviceId","onDisconnect","connectionPriority","service","characteristic","writeValue","descriptor","filter","BleClient","parseTreadmillData","flags","hasAverageSpeed","hasTotalDistance","hasInclination","rawSpeed","rawAvgSpeed","b0","b1","b2","rawDist","rawIncline","rawRamp","CYCLING_POWER_SERVICE","CYCLING_POWER_MEASUREMENT","HEART_RATE_SERVICE","HEART_RATE_MEASUREMENT","CYCLING_SPEED_AND_CADENCE_SERVICE","CSC_MEASUREMENT","FITNESS_MACHINE_SERVICE","TREADMILL_DATA_CHARACTERISTIC","MAX_RECONNECT_ATTEMPTS","RECONNECT_BASE_DELAY","isBleInitialized","ensureBleInitialized","connectPowerNative","statusListeners","isManualDisconnect","reconnectAttempts","device","deviceName","notifyStatus","connect","attemptReconnect","disconnectedDeviceId","connectHeartRateNative","connectCadenceNative","lastCrankRevs","lastCrankTime","crankRevs","crankTime","revDelta","timeInSeconds","rpm","connectTreadmillNative","ftmsData","connectPowerWeb","handleCharacteristicChange","connectHeartRateWeb","connectCadenceWeb","connectTreadmillWeb","server","connectRowingWeb","BluetoothFactory","MockPowerSensor","MockHeartrateSensor","MockCadenceSensor","DebugView","timeDisplay","btnTreadmill","btnRower","btnDownload","NavBar","setupRouter","dashboardView","historyView","workoutsView","settingsView","plansView","debugView","settingsButton","workoutsButton","plansButton","getTimestring","milliseconds","calculateTotalDistanceKm","gpsPoints","VoiceFeedback","voices","timeMs","count","intervalMinutes","elapsedMs","intervalMs","currentInterval","lastInterval","intervalKm","totalKm","metrics","recentThreshold","recentPower","recentHr","recentCadence","recentSpeed","trigger","metricsSettings","showCountdown","createCountdownOverlay","currentCount","intervalId","isCancelled","updateDisplay","countElement","playBeep","handleCancel","isFinal","audioContext","oscillator","gainNode","getWorkoutState","updateButtonVisibility","workoutControlElements","pauseWorkout","isAutoPause","resumeWorkout","isAutoResume","pausedDuration","initTimerDisplay","timeElement","nextText","handler","workoutCompleteEvent","getValuesAtTimestamps","arr","timestamps","entries","ts","prevIndex","suggestedElem","isAfterLastPoint","prevTime","nextTime","mergeMeasurements","latMeasurements","lonMeasurements","energyData","sources","firstTimestamps","timeStep","syncedHR","syncedCadence","syncedPower","syncedSpeed","syncedDistance","syncedAltitude","syncedLat","syncedLon","syncedEnergy","getLapNumber","getCsvString","header","heartrate","distance","altitude","lon","getTcxSport","hrString","cadenceString","powerString","getTcxTrackpoint","getTcxString","firstTimestamp","lastTimestamp","lapElements","buildLapBoundaries","boundary","_index","lapDataPoints","lapStartDate","totalTimeSeconds","distancePoints","validEnergyValues","boundaries","validValues","FIT_PROTOCOL_VERSION","FIT_PROFILE_VERSION","FIT_MESG_FILE_ID","FIT_MESG_FILE_CREATOR","FIT_MESG_ACTIVITY","FIT_MESG_SESSION","FIT_MESG_LAP","FIT_MESG_RECORD","FIT_MESG_EVENT","FIT_BASE_TYPE_ENUM","FIT_BASE_TYPE_UINT8","FIT_BASE_TYPE_UINT16","FIT_BASE_TYPE_UINT32","FILE_ID_TYPE","FILE_ID_MANUFACTURER","FILE_ID_PRODUCT","FILE_ID_SERIAL_NUMBER","FILE_ID_TIME_CREATED","RECORD_TIMESTAMP","RECORD_HEART_RATE","RECORD_CADENCE","RECORD_POWER","SESSION_TIMESTAMP","SESSION_START_TIME","SESSION_TOTAL_ELAPSED_TIME","SESSION_TOTAL_TIMER_TIME","SESSION_TOTAL_DISTANCE","SESSION_TOTAL_CALORIES","SESSION_SPORT","SESSION_SUB_SPORT","SESSION_EVENT","SESSION_EVENT_TYPE","LAP_TIMESTAMP","LAP_START_TIME","LAP_TOTAL_ELAPSED_TIME","LAP_TOTAL_TIMER_TIME","LAP_TOTAL_DISTANCE","LAP_TOTAL_CALORIES","LAP_EVENT","LAP_EVENT_TYPE","EVENT_TIMESTAMP","EVENT_EVENT","EVENT_EVENT_TYPE","ACTIVITY_TIMESTAMP","ACTIVITY_TOTAL_TIMER_TIME","ACTIVITY_NUM_SESSIONS","ACTIVITY_TYPE","ACTIVITY_EVENT","ACTIVITY_EVENT_TYPE","ACTIVITY_LOCAL_TIMESTAMP","FILE_TYPE_ACTIVITY","MANUFACTURER_DEVELOPMENT","SPORT_CYCLING","SPORT_RUNNING","SPORT_WALKING","SUB_SPORT_INDOOR_CYCLING","SUB_SPORT_GENERIC","EVENT_TIMER","EVENT_SESSION","EVENT_LAP","EVENT_ACTIVITY","EVENT_TYPE_START","EVENT_TYPE_STOP","ACTIVITY_TYPE_MANUAL","FIT_EPOCH_MS","calculateCrc","crcTable","crc","byte","tmp","toFitTimestamp","jsTimestamp","FitBuilder","localMsgType","globalMsgNum","dataSize","headerCrc","dataCrc","finalBuffer","getFitSportValues","getFitData","fitSportValues","fit","fitStartTime","fitEndTime","totalElapsedTime","totalElapsedTimeMs","validEnergy","validDistance","LOCAL_FILE_ID","LOCAL_FILE_CREATOR","LOCAL_EVENT","LOCAL_RECORD","LOCAL_LAP","LOCAL_SESSION","LOCAL_ACTIVITY","fitTimestamp","RPE_DESCRIPTIONS","generateDefaultTitle","timeOfDay","createRpeSelector","selectedValue","info","buttons","rpe","createMetadataFormContent","showNotes","showExertion","titleSection","notesSection","rpeSection","getMetadataFromForm","titleInput","notesInput","selectedRpe","metadata","showWorkoutMetadataModal","promptForNotes","promptForExertion","formContent","shouldShowMetadataModal","DEFAULT_UNDO_TIMEOUT","showUndoNotification","onUndo","onExpire","timeout","timeoutSeconds","remainingSeconds","undoButton","countdownSpan","progressFill","prefersReducedMotion","isUndone","countdownInterval","dismissTimeout","dismiss","executeExpire","createWorkoutBackup","restoreWorkoutBackup","backup","initLapButton","lapButton","lapCounter","lapCountElement","updateLapCounter","updateLapButtonVisibility","isRecording","handleLapClick","lastLapTime","lapPower","elapsedStr","observer","resetLapCounter","PersonalRecordTracker","currentBest","newSummary","records","significantDurations","IntervalsService","workoutName","fitData","formData","athleteId","auth","STRAVA_UPLOAD_URL","StravaService","filePrefix","tcxString","stravaService","initMetricsToggle","toggleYour","yourMetricsSection","toggleStream","streamMetricsSection","initDiscardButton","discardButton","resetWorkoutState","totalDataPoints","restoreWorkoutUI","getExportTimestamp","downloadFile","link","initExportButton","exportDataElem","getWorkoutMetadata","safeTitle","isDownload","exportData","zoneData","jsonStr","csvString","fitBlob","collectedMetadata","clearWorkoutMetadata","initWorkoutSummaryModal","workoutMetadataModal","calculatePowerZones","calculateHrZones","getPowerZone","getHrZone","ZoneState","powerZonesDef","hrZonesDef","zoneInfo","currentZone","range","percentInZone","totalTimeMs","DATA_TIMEOUT_MS","UPDATE_INTERVAL_MS","initLiveCharts","chartsContainer","metricsSection","dataFieldsCarousel","initChartsToggle","chartsVisible","toggleBtn","topBarControls","workoutControls","initMetricsDisplay","chartsToggle","lastPowerIndex","lastHrIndex","lastPowerZone","lastHrZone","updateLiveCharts","updateZoneTracking","createStream","listStreams","addMessage","author","createFetchSSE","onMessage","onConnected","onError","controller","connection","decoder","messages","dataMatch","listenToStream","listenToAllStreams","sendWorkoutData","workoutData","StreamViewer","toggleViewBtn","grid","viewAllBtn","streamsList","streams","stream","streamItem","streamTitle","statusEl","allStreamsStatus","messageData","powerEl","cadenceEl","hrEl","messageStr","lastUpdateEl","heartrateEl","speedEl","distanceEl","altitudeEl","elapsedEl","streamLastUpdate","initStreamViewer","viewer","viewStreamsBtn","initStreamingControls","streamManager","startStreamButton","nameInput","toolbar","toolbarStreamName","playPauseBtn","stopBtn","streamIndicator","updateToolbar","startStreaming","customName","stopStreaming","handleWorkoutPause","DARK_MODE_KEY","getStoredThemePreference","saveThemePreference","preference","systemPrefersDark","applyTheme","theme","getEffectiveTheme","initDarkMode","effectiveTheme","systemDark","setupDarkModeToggle","toggleElement","isDark","newTheme","newPreference","formatElapsedTime","createRecoveryModal","elapsedTime","addRecoveryStyles","style","showRecoveryModal","restoreBtn","discardBtn","cleanup","initWorkoutRecovery","initAboutModal","aboutButton","aboutModal","closeAboutModal","openModal","handleWakeLock","wakeLock","requestWakeLock","registerSW","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","Workbox","registerServiceWorker","registrations","registration","updateSW","showUpdateNotification","updateContainer","global","factory","exports","this","extend","dest","j","len","src","create$2","F","proto","bind","slice","lastId","stamp","throttle","context","lock","wrapperFn","later","wrapNum","includeMax","falseFn","formatNum","num","precision","pow","trim","splitWords","setOptions","getParamString","existingUrl","uppercase","templateRe","isArray","indexOf","array","emptyImageUrl","getPrefixed","lastTime","timeoutDefer","timeToCall","requestFn","cancelFn","requestAnimFrame","cancelAnimFrame","Util","Class","props","NewClass","parentProto","checkDeprecatedMixinEvents","parentOptions","init","includes","Events","types","removeAll","_once","newListener","propagate","_fn","Evented","Point","round","trunc","toPoint","Bounds","min2","max2","toBounds","bounds","xIntersects","yIntersects","xOverlaps","yOverlaps","bufferRatio","heightBuffer","widthBuffer","LatLngBounds","corner1","corner2","latlngs","sw","ne","sw2","ne2","LatLng","toLatLng","toLatLngBounds","latIntersects","lngIntersects","latOverlaps","lngOverlaps","maxMargin","lng","alt","margin","other","Earth","sizeInMeters","latAccuracy","lngAccuracy","CRS","latlng","zoom","projectedPoint","scale","untransformedPoint","center","newCenter","latShift","lngShift","newSw","newNe","latlng1","latlng2","rad","sinDLat","sinDLon","earthRadius","SphericalMercator","sin","Transformation","toTransformation","EPSG3857","EPSG900913","svgCreate","pointsToPath","rings","closed","len2","Browser","ie","ielt9","edge","webkit","userAgentContains","android","android23","webkitVer","androidStock","opera","chrome","gecko","safari","phantom","opera12","ie3d","webkit3d","gecko3d","any3d","mobile","mobileWebkit","mobileWebkit3d","msPointer","pointer","touchNative","touch","mobileOpera","mobileGecko","retina","passiveEvents","supportsPassiveOption","opts","canvas$1","svg$1","inlineSvg","vml","shape","mac","linux","POINTER_DOWN","POINTER_MOVE","POINTER_UP","POINTER_CANCEL","pEvent","_onPointerStart","_handlePointer","_pointers","_pointerDocListener","addPointerListener","_addPointerDocListener","removePointerListener","_globalPointerDown","_globalPointerMove","_globalPointerUp","preventDefault","makeDblclick","newEvent","addDoubleTapListener","simDblclick","getPropagationPath","removeDoubleTapListener","handlers","TRANSFORM","testProp","TRANSITION","TRANSITION_END","get","getStyle","css","create$1","tagName","className","toFront","toBack","hasClass","getClass","addClass","classes","setClass","removeClass","setOpacity","_setOpacityIE","filterName","setTransform","pos","setPosition","getPosition","disableTextSelection","enableTextSelection","_userSelect","on","off","userSelectProperty","disableImageDrag","enableImageDrag","_outlineElement","_outlineStyle","preventOutline","restoreOutline","getSizedParentNode","getScale","rect","DomUtil","addOne","eventsKey","batchRemove","removeOne","filterFn","mouseSubst","originalHandler","isExternalTarget","stopPropagation","disableScrollPropagation","disableClickPropagation","stop","ev","getMousePosition","wheelPxFactor","getWheelDelta","related","DomEvent","PosAnimation","newPos","easeLinearity","Map","moved","delta","viewHalf","containerPoint","centerOffset","paddingTL","paddingBR","paddingOffset","swPoint","nePoint","targetCenter","targetZoom","from","to","startZoom","w0","w1","u1","rho","rho2","s1","s2","t1","sq","log","sinh","cosh","tanh","r0","u","easeOut","S","frame","oldZoom","pixelCenter","pixelPoint","pixelBounds","paddedBounds","paddedSize","oldSize","oldCenter","onResponse","HandlerClass","pane","inside","padding","nw","se","boundsSize","snap","scalex","scaley","topLeftPoint","toZoom","fromZoom","crs","layerPoint","panes","noMoveStart","loading","zoomChanged","supressEvent","onOff","targets","isHover","dragging","canvasTargets","synth","isMarker","pixelOrigin","topLeft","latLngBounds","centerPoint","viewBounds","newBounds","pxBounds","maxBounds","projectedMaxBounds","minOffset","maxOffset","dx","dy","left","right","transform","startAnim","noUpdate","createMap","Control","corner","control","corners","createCorner","vSide","hSide","Layers","layerA","layerB","nameA","nameB","baseLayers","overlays","layer","acceptableHeight","collapsed","section","baseLayersPresent","overlaysPresent","baseLayersCount","checked","radioHtml","radioFragment","input","holder","inputs","addedLayers","removedLayers","that","layers","Zoom","zoomName","Scale","maxMeters","maxFeet","maxMiles","miles","feet","ratio","pow10","ukrainianFlag","Attribution","prefix","attribs","prefixAndAttribs","attribution","Handler","Mixin","START","Draggable","dragStartTarget","sizedParent","mouseevent","noInertia","fireDragend","clipPolygon","clippedPoints","edges","_getBitCode","_getEdgeIntersection","polygonCenter","p1","p2","area","isFlat","centroidLatLng","areaBounds","centroid","latlngCenter","coords","latSum","lngSum","PolyUtil","simplify","tolerance","sqTolerance","_reducePoints","_simplifyDP","pointToSegmentDistance","_sqClosestPointOnSegment","closestPointOnSegment","ArrayConstructor","markers","_simplifyDPStep","newPoints","maxSqDist","sqDist","reducedPoints","_sqDist","_lastCode","clipSegment","useLastCode","codeA","codeB","codeOut","newCode","_flat","polylineCenter","halfDist","segDist","LineUtil","LonLat","Mercator","con","phi","dphi","EPSG3395","EPSG4326","Simple","Layer","minZoom","maxZoom","oldZoomSpan","LayerGroup","layerId","methodName","zIndex","layerGroup","FeatureGroup","featureGroup","Icon","oldIcon","img","sizeOption","anchor","IconDefault","strip","re","MarkerDrag","marker","iconPos","origin","panBounds","movement","shadow","Marker","oldLatLng","classToAdd","addIcon","newShadow","addShadow","opt","draggable","opacity","iconOpts","Path","CircleMarker","r2","circleMarker","Circle","legacyOptions","half","latR","top","bottom","lngR","circle","Polyline","minDistance","minPoint","closest","jLen","flat","projectedBounds","ring","segment","part","polyline","Polygon","clipped","polygon","GeoJSON","geojson","features","feature","geometryToLayer","asFeature","geometry","pointToLayer","_coordsToLatLng","coordsToLatLng","_pointToLayer","coordsToLatLngs","geoLayer","featureLayer","pointToLayerFn","levelsDeep","latLngToCoords","latLngsToCoords","getFeature","newGeometry","PointToGeoJSON","multi","holes","isGeometryCollection","jsons","json","geoJSON","geoJson","ImageOverlay","styleOpts","wasElementSupplied","image","errorUrl","imageOverlay","VideoOverlay","vid","sourceElements","videoOverlay","video","SVGOverlay","svgOverlay","DivOverlay","node","OverlayClass","old","Popup","closeButton","maxHeight","scrolledClass","marginBottom","containerHeight","containerWidth","layerPos","containerPos","popup","Tooltip","subX","subY","tooltipPoint","tooltipWidth","tooltipHeight","tooltip","DivIcon","bgPos","divIcon","GridLayer","tileZoom","compare","edgeZIndex","nextFrame","willPrune","tile","fade","level","x2","y2","z2","coords2","animating","noPrune","tileZoomChanged","translate","tileSize","mapZoom","halfSize","tileRange","tileCenter","queue","noPruneRange","fragment","tileBounds","nwPoint","sePoint","bp","tilePos","newCoords","gridLayer","TileLayer","noRedraw","invertedY","zoomReverse","zoomOffset","tilePoint","tileLayer","TileLayerWMS","wmsParams","realRetina","projectionKey","bbox","tileLayerWMS","Renderer","currentCenterPoint","topLeftOffset","Canvas","order","next","dashArray","dashValue","ctx","clickedLayer","candidateHoveredLayer","canvas","vmlCreate","vmlMixin","stroke","create","SVG","arc","renderer","Rectangle","rectangle","BoxZoom","DoubleClickZoom","Drag","pxCenter","pxWorldCenter","worldWidth","halfWidth","newX1","newX2","newX","ease","speedVector","limitedSpeed","limitedSpeedVector","decelerationDuration","Keyboard","docEl","panDelta","keys","codes","zoomDelta","newLatLng","ScrollWheelZoom","debounce","d2","d3","d4","tapHoldDelay","TapHold","cancelClickPrevent","simulatedEvent","TouchZoom","moveFn","oldL","MapComponent","elementId","L","hasData","initialLat","initialLon","initialZoom","gpsData","latLng","loop","initMap","mapContainerId","toggleBtnId","carouselId","mapContainer","mapComponent","isMapVisible","hasGpsData","calculateTotalDistanceMeters","AutoLapService","autoLapService","initUi","dataFieldsManager","activeProfile","customEvent","darkModeToggle","autoPauseService","recovered","connectCadence","connectHeartRate","connectPower","connectTreadmill","BackgroundGeolocation","createNativeGpsService","watcherId","location","createWebGpsService","watchId","GpsFactory","connectGps","getElement","sensorLabels","sensorIcons","parseBluetoothError","sensorLabel","errorMessage","errorName","createErrorContent","errorInfo","messageEl","troubleshootingEl","titleEl","listEl","suggestion","itemEl","showConnectionError","onRetry","sensorIcon","showReconnectionFailed","tipsEl","tip","emojis","getSensorLabel","initConnectionButtons","updateButtonText","connectElem","emoji","disconnectFn","connectionState","displayElem","handleStatusChange","connectFn","gpsConnection","disconnect","onStatusChange","StreamManager","safeName","incline","initHardware","initApp"],"ignoreList":[36,42,43,78,79,80,81,82,83,118],"sources":["../../src/components/base/BaseComponent.ts","../../src/components/styles/shared.ts","../../src/components/MetricDisplay.ts","../../src/components/PowerGauge.ts","../../src/components/ZoneGauge.ts","../../src/components/LiveChart.ts","../../src/components/WorkoutTimer.ts","../../src/components/Toast.ts","../../src/components/Modal.ts","../../src/data-fields/types.ts","../../src/data-fields/screens.ts","../../src/data-fields/registry.ts","../../src/data-fields/calculators/common.ts","../../src/data-fields/defaults.ts","../../src/data-fields/CalculationManager.ts","../../src/data-fields/DataFieldsManager.ts","../../src/data-fields/persistence.ts","../../src/data-fields/definitions/power-fields.ts","../../src/data-fields/definitions/heartrate-fields.ts","../../src/data-fields/definitions/cadence-fields.ts","../../src/data-fields/definitions/speed-fields.ts","../../src/data-fields/definitions/distance-fields.ts","../../src/data-fields/definitions/time-fields.ts","../../src/data-fields/definitions/elevation-fields.ts","../../src/data-fields/definitions/energy-fields.ts","../../src/data-fields/index.ts","../../src/components/data-fields/DataFieldComponent.ts","../../src/components/data-fields/DataScreenComponent.ts","../../src/components/data-fields/ScreenCarouselComponent.ts","../../src/components/data-fields/FieldPickerComponent.ts","../../src/components/data-fields/ScreenEditorComponent.ts","../../src/components/data-fields/ProfileSettingsComponent.ts","../../src/components/data-fields/index.ts","../../src/storage/workoutStorage.ts","../../src/utils/geo.ts","../../src/config/constants.ts","../../../../node_modules/.pnpm/idb@8.0.3/node_modules/idb/build/index.js","../../src/state/SettingsStore.ts","../../src/calculations/calories.ts","../../src/measurements-state.ts","../../src/getInitState.ts","../../src/exposeVariablesDuringTest.ts","../../../../node_modules/.pnpm/@capacitor+core@8.0.0/node_modules/@capacitor/core/dist/index.js","../../../../node_modules/.pnpm/@capacitor+app@8.0.0_@capacitor+core@8.0.0/node_modules/@capacitor/app/dist/esm/index.js","../../src/router/Router.ts","../../src/views/DashboardView.ts","../../src/api/workoutClient.ts","../../src/api/userClient.ts","../../src/ui/accessibility.ts","../../src/ui/modal.ts","../../src/ui/charts.ts","../../src/ui/statistics.ts","../../src/utils/cropWorkout.ts","../../src/ui/workoutHistory.ts","../../src/views/HistoryView.ts","../../src/workouts/workoutLibrary.ts","../../src/storage/userSettings.ts","../../src/ui/audio.ts","../../src/workouts/WorkoutRunner.ts","../../src/storage/customWorkouts.ts","../../src/ui/workoutPlayer.ts","../../src/ui/workoutBuilder.ts","../../src/views/WorkoutsView.ts","../../src/ui/notifications.ts","../../src/utils/dom.ts","../../src/ui/onboarding.ts","../../src/config/settings.ts","../../src/services/debug/BluetoothDebugService.ts","../../src/ui/installPrompt.ts","../../src/services/AutoPauseService.ts","../../src/config/sport.ts","../../src/ui/settings.ts","../../src/ui/dataFieldsConfig.ts","../../src/views/SettingsView.ts","../../src/router/view-ids.ts","../../src/plans/library/ftpBuilder.ts","../../src/plans/planRepository.ts","../../src/views/PlansView.ts","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/definitions.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/plugin.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/queue.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/validators.js","../../../../node_modules/.pnpm/@capacitor-community+bluetooth-le@7.3.0_@capacitor+core@8.0.0/node_modules/@capacitor-community/bluetooth-le/dist/esm/bleClient.js","../../src/services/bluetooth/ftms.ts","../../src/services/bluetooth/native-bluetooth.ts","../../src/services/bluetooth/web-bluetooth.ts","../../src/services/bluetooth/factory.ts","../../src/views/DebugView.ts","../../src/components/NavBar.ts","../../src/init/router.ts","../../src/getTimestring.ts","../../src/services/VoiceFeedback.ts","../../src/ui/countdown.ts","../../src/ui/time.ts","../../src/merge-measurements.ts","../../src/create-csv.ts","../../src/create-tcx.ts","../../src/create-fit.ts","../../src/ui/workoutMetadataModal.ts","../../src/ui/undoNotification.ts","../../src/ui/lap.ts","../../src/ui/analyticsHelper.ts","../../src/services/IntervalsService.ts","../../src/types/settings.ts","../../src/integrations/strava.ts","../../src/ui/menu.ts","../../src/zone-state.ts","../../src/initMetricsDisplay.ts","../../src/api/streamClient.ts","../../src/ui/streamViewer.ts","../../src/initStreamingControls.ts","../../src/ui/darkMode.ts","../../src/ui/workoutRecovery.ts","../../src/ui/about.ts","../../src/ui/wakeLock.ts","../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/ui/serviceWorker.ts","../../../../node_modules/.pnpm/leaflet@1.9.4/node_modules/leaflet/dist/leaflet-src.js","../../src/ui/map-component.ts","../../src/init/map.ts","../../src/services/AutoLapService.ts","../../src/init/ui.ts","../../src/connect-cadence.ts","../../src/connect-heartrate.ts","../../src/connect-power.ts","../../src/connect-treadmill.ts","../../src/services/gps/native-gps.ts","../../src/services/gps/web-gps.ts","../../src/services/gps/factory.ts","../../src/connect-gps.ts","../../src/elements.ts","../../src/ui/connectionError.ts","../../src/initConnectionButtons.ts","../../src/stream-manager.ts","../../src/init/hardware.ts","../../src/main.ts"],"sourcesContent":["/**\n * Base Component\n * \n * Abstract base class for all Web Components in the application.\n * Provides common functionality like shadow DOM, theming, and lifecycle hooks.\n * \n * @module BaseComponent\n */\n\n/**\n * Base class for all custom elements\n */\nexport abstract class BaseComponent extends HTMLElement {\n    protected shadow: ShadowRoot;\n    private _initialized = false;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    /**\n     * Called when the element is added to the DOM\n     */\n    connectedCallback(): void {\n        if (!this._initialized) {\n            this.render();\n            this.setupEventListeners();\n            this._initialized = true;\n        }\n        this.onConnected();\n    }\n\n    /**\n     * Called when the element is removed from the DOM\n     */\n    disconnectedCallback(): void {\n        this.onDisconnected();\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue !== newValue && this._initialized) {\n            this.onAttributeChanged(name, oldValue, newValue);\n        }\n    }\n\n    /**\n     * Get base styles that apply to all components\n     */\n    protected getBaseStyles(): string {\n        return `\n            :host {\n                display: block;\n                box-sizing: border-box;\n            }\n            \n            :host([hidden]) {\n                display: none;\n            }\n            \n            *,\n            *::before,\n            *::after {\n                box-sizing: inherit;\n            }\n            \n            /* Respect reduced motion preferences */\n            @media (prefers-reduced-motion: reduce) {\n                *,\n                *::before,\n                *::after {\n                    animation-duration: 0.01ms !important;\n                    animation-iteration-count: 1 !important;\n                    transition-duration: 0.01ms !important;\n                }\n            }\n        `;\n    }\n\n    /**\n     * Get the component's styles - override in subclasses\n     */\n    protected abstract getStyles(): string;\n\n    /**\n     * Get the component's template - override in subclasses\n     */\n    protected abstract getTemplate(): string;\n\n    /**\n     * Render the component\n     */\n    protected render(): void {\n        this.shadow.innerHTML = `\n            <style>\n                ${this.getBaseStyles()}\n                ${this.getStyles()}\n            </style>\n            ${this.getTemplate()}\n        `;\n    }\n\n    /**\n     * Set up event listeners - override in subclasses\n     */\n    protected setupEventListeners(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called after the component is connected to the DOM\n     */\n    protected onConnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when the component is disconnected from the DOM\n     */\n    protected onDisconnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Emit a custom event\n     */\n    protected emit<T>(eventName: string, detail?: T): void {\n        this.dispatchEvent(new CustomEvent(eventName, {\n            detail,\n            bubbles: true,\n            composed: true, // Allows event to cross shadow DOM boundary\n        }));\n    }\n\n    /**\n     * Query an element in the shadow DOM\n     */\n    protected query<T extends Element>(selector: string): T | null {\n        return this.shadow.querySelector<T>(selector);\n    }\n\n    /**\n     * Query all elements in the shadow DOM\n     */\n    protected queryAll<T extends Element>(selector: string): NodeListOf<T> {\n        return this.shadow.querySelectorAll<T>(selector);\n    }\n}\n","/**\n * Shared styles for Web Components\n * Imports CSS custom properties from the design system\n */\n\nexport const sharedStyles = `\n  /* Import design tokens */\n  :host {\n    /* Zone colors */\n    --zone-1-color: var(--zone-1-color, #808080);\n    --zone-2-color: var(--zone-2-color, #2196f3);\n    --zone-3-color: var(--zone-3-color, #4caf50);\n    --zone-4-color: var(--zone-4-color, #ffeb3b);\n    --zone-5-color: var(--zone-5-color, #ff9800);\n    --zone-6-color: var(--zone-6-color, #f44336);\n    --zone-7-color: var(--zone-7-color, #9c27b0);\n\n    /* Semantic colors */\n    --bg-primary: var(--bg-primary, #fafafa);\n    --bg-secondary: var(--bg-secondary, #f5f5f5);\n    --text-primary: var(--text-primary, #212121);\n    --text-secondary: var(--text-secondary, #616161);\n\n    /* Spacing */\n    --space-2: var(--space-2, 0.5rem);\n    --space-3: var(--space-3, 0.75rem);\n    --space-4: var(--space-4, 1rem);\n\n    /* Typography */\n    --font-family-sans: var(--font-family-sans, sans-serif);\n    --font-size-metric-value: var(--font-size-metric-value, 2rem);\n    --font-size-metric-label: var(--font-size-metric-label, 0.875rem);\n  }\n`;\n\n/**\n * Get zone-specific styles\n */\nexport function getZoneStyles(zone: number): string {\n    return `\n    .zone-indicator {\n      --current-zone-color: var(--zone-${zone}-color);\n      color: var(--current-zone-color);\n    }\n\n    .zone-bg {\n      background-color: var(--zone-${zone}-color-bg);\n    }\n  `;\n}\n","/**\n * Metric Display Component\n * \n * A Web Component for displaying a single workout metric (power, heart rate, cadence).\n * Supports theming, zones, and real-time updates.\n * \n * @example\n * ```html\n * <bpt-metric-display\n *   label=\"Power\"\n *   value=\"250\"\n *   unit=\"W\"\n *   icon=\"\"\n *   zone=\"4\"\n *   zone-name=\"Threshold\">\n * </bpt-metric-display>\n * ```\n * \n * @module MetricDisplay\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\nimport { sharedStyles } from './styles/shared.js';\n\n/**\n * Metric Display Web Component\n */\nexport class MetricDisplay extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['label', 'value', 'unit', 'icon', 'zone', 'zone-name', 'connected', 'show-avg'];\n    }\n\n    protected getStyles(): string {\n        return `\n            ${sharedStyles}\n\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: var(--space-2);\n                transition: background-color var(--transition-normal), border-color var(--transition-normal);\n                border-radius: var(--radius-md);\n                min-width: 100px;\n                background-color: var(--zone-bg, var(--bg-secondary));\n                color: var(--text-primary);\n            }\n            \n            /* Zone bindings */\n            :host([zone=\"1\"]) { --zone-color: var(--zone-1-color); --zone-bg: var(--zone-1-color-bg); }\n            :host([zone=\"2\"]) { --zone-color: var(--zone-2-color); --zone-bg: var(--zone-2-color-bg); }\n            :host([zone=\"3\"]) { --zone-color: var(--zone-3-color); --zone-bg: var(--zone-3-color-bg); }\n            :host([zone=\"4\"]) { --zone-color: var(--zone-4-color); --zone-bg: var(--zone-4-color-bg); }\n            :host([zone=\"5\"]) { --zone-color: var(--zone-5-color); --zone-bg: var(--zone-5-color-bg); }\n            :host([zone=\"6\"]) { --zone-color: var(--zone-6-color); --zone-bg: var(--zone-6-color-bg); }\n            :host([zone=\"7\"]) { --zone-color: var(--zone-7-color); --zone-bg: var(--zone-7-color-bg); }\n\n            :host([zone]) {\n                border-left: 4px solid var(--zone-color, transparent);\n            }\n            \n            .label {\n                font-size: var(--font-size-metric-label);\n                color: var(--text-secondary);\n                margin-bottom: var(--space-1);\n                display: flex;\n                align-items: center;\n                gap: var(--space-1);\n            }\n            \n            .icon {\n                font-size: 1.1em;\n            }\n            \n            .value-container {\n                display: flex;\n                align-items: baseline;\n                gap: var(--space-1);\n            }\n            \n            .value {\n                font-size: var(--font-size-metric-value);\n                font-weight: var(--font-weight-bold);\n                color: var(--zone-color, var(--text-primary));\n                line-height: 1;\n                transition: color var(--transition-normal);\n            }\n            \n            .value.disconnected {\n                color: var(--text-tertiary);\n            }\n            \n            .unit {\n                font-size: var(--font-size-metric-unit);\n                color: var(--text-secondary);\n            }\n            \n            .avg-indicator {\n                font-size: var(--font-size-xs);\n                color: var(--text-tertiary);\n                vertical-align: super;\n            }\n            \n            .zone-badge {\n                font-size: var(--font-size-sm);\n                padding: 2px 8px;\n                border-radius: 12px;\n                margin-top: var(--space-1);\n                background-color: var(--zone-bg, transparent);\n                color: var(--zone-color, var(--text-secondary));\n                font-weight: var(--font-weight-medium);\n                opacity: 0;\n                transform: translateY(-4px);\n                transition: opacity var(--transition-fast), transform var(--transition-fast);\n            }\n            \n            :host([zone]) .zone-badge {\n                opacity: 1;\n                transform: translateY(0);\n            }\n            \n            /* High contrast mode support */\n            :host-context([data-high-contrast=\"true\"]) .value {\n                text-decoration: underline;\n                text-decoration-style: dotted;\n                text-underline-offset: 4px;\n            }\n            \n            :host-context([data-high-contrast=\"true\"]) {\n                border-width: 3px;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const label = this.getAttribute('label') || '';\n        const value = this.getAttribute('value') || '--';\n        const unit = this.getAttribute('unit') || '';\n        const icon = this.getAttribute('icon') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const showAvg = this.hasAttribute('show-avg');\n        const connected = this.getAttribute('connected') !== 'false';\n\n        return `\n            <div class=\"label\">\n                ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                <span>${label}</span>\n            </div>\n            <div class=\"value-container\">\n                <span class=\"value ${!connected ? 'disconnected' : ''}\" \n                      aria-live=\"polite\" \n                      aria-label=\"${label}: ${value} ${unit}\">\n                    ${value}${showAvg ? '<span class=\"avg-indicator\">(3s)</span>' : ''}\n                </span>\n                ${unit ? `<span class=\"unit\">${unit}</span>` : ''}\n            </div>\n            <div class=\"zone-badge\" aria-live=\"polite\">\n                ${zoneName ? `Zone: ${zoneName}` : ''}\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Re-render on any attribute change\n        this.render();\n    }\n\n    /**\n     * Update the displayed value\n     */\n    public setValue(value: number | string): void {\n        this.setAttribute('value', String(value));\n    }\n\n    /**\n     * Update the zone\n     */\n    public setZone(zone: number | null, zoneName?: string): void {\n        if (zone !== null) {\n            this.setAttribute('zone', String(zone));\n            if (zoneName) {\n                this.setAttribute('zone-name', zoneName);\n            }\n        } else {\n            this.removeAttribute('zone');\n            this.removeAttribute('zone-name');\n        }\n    }\n\n    /**\n     * Set connected state\n     */\n    public setConnected(connected: boolean): void {\n        this.setAttribute('connected', String(connected));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-metric-display', MetricDisplay);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-metric-display': MetricDisplay;\n    }\n}\n","/**\n * Power Gauge Component\n * \n * A circular gauge Web Component for displaying power output with zone visualization.\n * Shows current power, target zone, and provides visual feedback.\n * \n * @example\n * ```html\n * <bpt-power-gauge\n *   value=\"250\"\n *   ftp=\"280\"\n *   max=\"500\"\n *   show-zones=\"true\">\n * </bpt-power-gauge>\n * ```\n * \n * @module PowerGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\nimport { sharedStyles } from './styles/shared.js';\n\n/**\n * Power zone definitions (Coggan 7-zone model)\n */\nconst POWER_ZONES = [\n    { name: 'Recovery', min: 0, max: 0.55 },\n    { name: 'Endurance', min: 0.55, max: 0.75 },\n    { name: 'Tempo', min: 0.75, max: 0.90 },\n    { name: 'Threshold', min: 0.90, max: 1.05 },\n    { name: 'VO2 Max', min: 1.05, max: 1.20 },\n    { name: 'Anaerobic', min: 1.20, max: 1.50 },\n    { name: 'Neuromuscular', min: 1.50, max: 99.9 }\n];\n\n/**\n * Power Gauge Web Component\n */\nexport class PowerGauge extends BaseComponent {\n    private animationFrame: number | null = null;\n    private currentDisplayValue = 0;\n\n    static get observedAttributes(): string[] {\n        return ['value', 'ftp', 'max', 'show-zones', 'size'];\n    }\n\n    protected getStyles(): string {\n        return `\n            ${sharedStyles}\n\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                --gauge-size: 200px;\n                /* Default to accent color if no zone */\n                --gauge-color: var(--color-primary-500); \n            }\n            \n            .gauge-container {\n                position: relative;\n                width: var(--gauge-size);\n                height: var(--gauge-size);\n            }\n            \n            .gauge-svg {\n                width: 100%;\n                height: 100%;\n                transform: rotate(-135deg);\n            }\n            \n            .gauge-background {\n                fill: none;\n                stroke: var(--bg-tertiary);\n                stroke-width: 12;\n                stroke-linecap: round;\n            }\n            \n            .gauge-zone {\n                fill: none;\n                stroke-width: 12;\n                stroke-linecap: round;\n                opacity: 0.3;\n                transition: opacity var(--transition-normal);\n            }\n            \n            .gauge-zone.active {\n                opacity: 1;\n            }\n            \n            /* Zone Colors binding via CSS variables */\n            .gauge-zone[data-zone=\"1\"] { stroke: var(--zone-1-color); }\n            .gauge-zone[data-zone=\"2\"] { stroke: var(--zone-2-color); }\n            .gauge-zone[data-zone=\"3\"] { stroke: var(--zone-3-color); }\n            .gauge-zone[data-zone=\"4\"] { stroke: var(--zone-4-color); }\n            .gauge-zone[data-zone=\"5\"] { stroke: var(--zone-5-color); }\n            .gauge-zone[data-zone=\"6\"] { stroke: var(--zone-6-color); }\n            .gauge-zone[data-zone=\"7\"] { stroke: var(--zone-7-color); }\n            \n            .gauge-value-arc {\n                fill: none;\n                stroke: var(--gauge-color);\n                stroke-width: 14;\n                stroke-linecap: round;\n                transition: stroke var(--transition-normal);\n            }\n            \n            .gauge-center {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                text-align: center;\n            }\n            \n            .gauge-value {\n                font-size: calc(var(--gauge-size) * 0.2);\n                font-weight: var(--font-weight-bold);\n                color: var(--gauge-color, var(--text-primary));\n                line-height: 1;\n                transition: color var(--transition-normal);\n            }\n            \n            .gauge-unit {\n                font-size: calc(var(--gauge-size) * 0.08);\n                color: var(--text-secondary);\n            }\n            \n            .gauge-zone-label {\n                font-size: calc(var(--gauge-size) * 0.07);\n                color: var(--gauge-color, var(--text-secondary));\n                margin-top: var(--space-1);\n                font-weight: var(--font-weight-medium);\n                transition: color var(--transition-normal);\n            }\n            \n            .gauge-ftp {\n                font-size: calc(var(--gauge-size) * 0.06);\n                color: var(--text-tertiary);\n                margin-top: 2px;\n            }\n            \n            /* Animation */\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n            \n            .gauge-value-arc.high-power {\n                animation: pulse 0.5s ease-in-out infinite;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const size = parseInt(this.getAttribute('size') || '200', 10);\n        this.style.setProperty('--gauge-size', `${size}px`);\n\n        const value = parseInt(this.getAttribute('value') || '0', 10);\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n        const showZones = this.getAttribute('show-zones') !== 'false';\n\n        const radius = 80;\n        const circumference = 2 * Math.PI * radius;\n        const arcLength = circumference * 0.75; // 270 degrees\n\n        // Calculate the current zone and color\n        const ftpPercent = ftp > 0 ? value / ftp : 0;\n        const _zone = this.getZone(ftpPercent);\n\n        // Map internal zone object back to zone number (1-7)\n        // This is a bit of a hack since getZone returns the object from the local POWER_ZONES array\n        // We really should unify the data structures more deeply, but for now we just want styling\n        // We can infer the zone number by finding the index + 1\n        const zoneIndex = _zone ? POWER_ZONES.indexOf(_zone) : -1;\n        const zoneNumber = zoneIndex >= 0 ? zoneIndex + 1 : 0;\n\n        let zoneColorVar = 'var(--color-primary-500)';\n        if (zoneNumber > 0) {\n            zoneColorVar = `var(--zone-${zoneNumber}-color)`;\n        }\n\n        // Calculate arc progress\n        const progress = Math.min(value / max, 1);\n        const dashOffset = arcLength * (1 - progress);\n\n        // Update CSS variable on the host for color\n        this.style.setProperty('--gauge-color', zoneColorVar);\n\n        return `\n            <div class=\"gauge-container\">\n                <svg class=\"gauge-svg\" viewBox=\"0 0 200 200\">\n                    <!-- Background arc -->\n                    <circle \n                        class=\"gauge-background\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                    />\n                    \n                    ${showZones ? this.renderZoneArcs(radius, arcLength, circumference, ftpPercent) : ''}\n                    \n                    <!-- Value arc -->\n                    <circle \n                        class=\"gauge-value-arc ${ftpPercent > 1.2 ? 'high-power' : ''}\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                        stroke-dashoffset=\"${dashOffset}\"\n                    />\n                </svg>\n                \n                <div class=\"gauge-center\">\n                    <div class=\"gauge-value\">${value}</div>\n                    <div class=\"gauge-unit\">watts</div>\n                    ${_zone ? `<div class=\"gauge-zone-label\">${_zone.name}</div>` : ''}\n                    ${ftp > 0 ? `<div class=\"gauge-ftp\">FTP: ${ftp}W</div>` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Render zone arcs on the gauge\n     */\n    private renderZoneArcs(radius: number, arcLength: number, circumference: number, currentFtpPercent: number): string {\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n\n        if (ftp <= 0) return '';\n\n        return POWER_ZONES.map((zone, index) => {\n            const startPercent = (zone.min * ftp) / max;\n            const endPercent = Math.min((zone.max * ftp) / max, 1);\n            const zoneArcLength = (endPercent - startPercent) * arcLength;\n            const offset = arcLength * (1 - endPercent);\n\n            const isActive = currentFtpPercent >= zone.min && currentFtpPercent < zone.max;\n\n            return `\n                <circle \n                    class=\"gauge-zone ${isActive ? 'active' : ''}\"\n                    cx=\"100\" cy=\"100\" r=\"${radius}\"\n                    stroke-dasharray=\"${zoneArcLength} ${circumference}\"\n                    stroke-dashoffset=\"${offset}\"\n                    data-zone=\"${index + 1}\"\n                />\n            `;\n        }).join('');\n    }\n\n    /**\n     * Get the current zone based on FTP percentage\n     */\n    private getZone(ftpPercent: number): typeof POWER_ZONES[0] | null {\n        for (const zone of POWER_ZONES) {\n            if (ftpPercent >= zone.min && ftpPercent < zone.max) {\n                return zone;\n            }\n        }\n        // Above all zones\n        if (ftpPercent >= POWER_ZONES[POWER_ZONES.length - 1].max) {\n            return POWER_ZONES[POWER_ZONES.length - 1];\n        }\n        return null;\n    }\n\n    protected onAttributeChanged(): void {\n        this.render();\n    }\n\n    protected onDisconnected(): void {\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n    }\n\n    /**\n     * Animate value change\n     */\n    public animateToValue(targetValue: number, duration = 300): void {\n        const startValue = this.currentDisplayValue;\n        const startTime = performance.now();\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n\n            // Ease out cubic\n            const eased = 1 - Math.pow(1 - progress, 3);\n            const currentValue = Math.round(startValue + (targetValue - startValue) * eased);\n\n            this.currentDisplayValue = currentValue;\n            this.setAttribute('value', String(currentValue));\n\n            if (progress < 1) {\n                this.animationFrame = requestAnimationFrame(animate);\n            }\n        };\n\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n        this.animationFrame = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Set the current power value\n     */\n    public setValue(value: number, animate = false): void {\n        if (animate) {\n            this.animateToValue(value);\n        } else {\n            this.currentDisplayValue = value;\n            this.setAttribute('value', String(value));\n        }\n    }\n\n    /**\n     * Set FTP for zone calculations\n     */\n    public setFTP(ftp: number): void {\n        this.setAttribute('ftp', String(ftp));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-power-gauge', PowerGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-power-gauge': PowerGauge;\n    }\n}\n","/**\n * Zone Gauge Component\n * \n * A Web Component for displaying a zone progress bar/gauge.\n * Shows position within current zone with color coding.\n * \n * @example\n * ```html\n * <bpt-zone-gauge\n *   zone=\"4\"\n *   zone-name=\"Threshold\"\n *   percent=\"65\"\n *   type=\"power\">\n * </bpt-zone-gauge>\n * ```\n * \n * @module ZoneGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\nimport { sharedStyles } from './styles/shared.js';\n\n/**\n * Zone Gauge Web Component\n */\nexport class ZoneGauge extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['zone', 'zone-name', 'percent', 'type', 'compact'];\n    }\n\n    protected getStyles(): string {\n        return `\n            ${sharedStyles}\n\n            :host {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                padding: var(--space-2);\n                border-radius: var(--radius-md);\n                background: var(--zone-bg, var(--bg-secondary));\n                transition: background-color var(--transition-normal);\n                min-width: 80px;\n            }\n\n            :host([compact]) {\n                padding: 4px 8px;\n                min-width: 60px;\n            }\n\n            /* Zone bindings */\n            :host([zone=\"1\"]) { --zone-color: var(--zone-1-color); --zone-bg: var(--zone-1-color-bg); }\n            :host([zone=\"2\"]) { --zone-color: var(--zone-2-color); --zone-bg: var(--zone-2-color-bg); }\n            :host([zone=\"3\"]) { --zone-color: var(--zone-3-color); --zone-bg: var(--zone-3-color-bg); }\n            :host([zone=\"4\"]) { --zone-color: var(--zone-4-color); --zone-bg: var(--zone-4-color-bg); }\n            :host([zone=\"5\"]) { --zone-color: var(--zone-5-color); --zone-bg: var(--zone-5-color-bg); }\n            :host([zone=\"6\"]) { --zone-color: var(--zone-6-color); --zone-bg: var(--zone-6-color-bg); }\n            :host([zone=\"7\"]) { --zone-color: var(--zone-7-color); --zone-bg: var(--zone-7-color-bg); }\n\n            .zone-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n            }\n\n            .zone-number {\n                font-size: var(--font-size-xs);\n                font-weight: var(--font-weight-bold);\n                color: var(--text-primary);\n                background: var(--zone-color, #d0d7de);\n                padding: 2px 8px;\n                border-radius: 10px;\n                white-space: nowrap;\n                /* Optimize contrast for zone number badge if needed, for now using text-primary on zone-color might be tricky without contrast calc.\n                   Let's assume zone colors are light enough or we'd need a specific text color for badges. \n                   Actually, looking at previous code, it used a specific fill color and text color. \n                   Let's use our background colors which are transparent, so maybe we want solid colors for badges?\n                   The previous code used 'fill' which was solid color for the badge background, and valid text color.\n                   Let's stick to using the zone color for text and background for bg, or maybe reverse for pill.\n                */\n                background: var(--zone-color);\n                color: white; /* Most zone colors work well with white text except maybe yellow */\n            }\n            \n            /* Specific overrides for light colors if needed - zone 4 is yellow */\n            :host([zone=\"4\"]) .zone-number {\n                color: black;\n            }\n\n            :host([compact]) .zone-number {\n                font-size: 10px;\n                padding: 1px 6px;\n            }\n\n            .zone-name {\n                font-size: 11px;\n                color: var(--text-secondary);\n                font-weight: var(--font-weight-medium);\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n\n            :host([compact]) .zone-name {\n                display: none;\n            }\n\n            .gauge-container {\n                height: 8px;\n                background: var(--bg-tertiary);\n                border-radius: 4px;\n                overflow: hidden;\n                position: relative;\n            }\n\n            :host([compact]) .gauge-container {\n                height: 6px;\n            }\n\n            .gauge-fill {\n                height: 100%;\n                background: var(--zone-color, var(--interactive-default));\n                border-radius: 4px;\n                transition: width var(--transition-normal), background-color var(--transition-normal);\n                min-width: 4px;\n            }\n\n            .gauge-markers {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                display: flex;\n                justify-content: space-between;\n                padding: 0 2px;\n                pointer-events: none;\n            }\n\n            .gauge-marker {\n                width: 1px;\n                height: 100%;\n                background: rgba(255, 255, 255, 0.3);\n            }\n\n            /* High contrast mode */\n            :host-context([data-high-contrast=\"true\"]) .gauge-fill {\n                background-image: repeating-linear-gradient(\n                    45deg,\n                    transparent,\n                    transparent 2px,\n                    rgba(255,255,255,0.2) 2px,\n                    rgba(255,255,255,0.2) 4px\n                );\n            }\n\n            /* Hidden state */\n            :host([hidden]) {\n                display: none;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const zone = this.getAttribute('zone') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const percent = parseFloat(this.getAttribute('percent') || '0');\n\n        return `\n            <div class=\"zone-header\">\n                <span class=\"zone-number\" aria-label=\"Zone ${zone}\">Z${zone}</span>\n                <span class=\"zone-name\">${zoneName}</span>\n            </div>\n            <div class=\"gauge-container\" role=\"progressbar\" aria-valuenow=\"${percent}\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-label=\"${zoneName} zone progress\">\n                <div class=\"gauge-fill\" style=\"width: ${Math.max(4, percent)}%\"></div>\n                <div class=\"gauge-markers\">\n                    <span class=\"gauge-marker\"></span>\n                    <span class=\"gauge-marker\"></span>\n                    <span class=\"gauge-marker\"></span>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'percent') {\n            this.updateGaugeFill(parseFloat(newValue || '0'));\n        }\n        // Re-render on zone change\n        if (name === 'zone' || name === 'zone-name') {\n            this.render();\n        }\n    }\n\n    /**\n     * Update gauge fill without full re-render\n     */\n    private updateGaugeFill(percent: number): void {\n        const fill = this.shadow.querySelector('.gauge-fill') as HTMLElement;\n        const container = this.shadow.querySelector('.gauge-container') as HTMLElement;\n        if (fill) {\n            fill.style.width = `${Math.max(4, percent)}%`;\n        }\n        if (container) {\n            container.setAttribute('aria-valuenow', String(percent));\n        }\n    }\n\n    /**\n     * Set zone information\n     */\n    public setZone(zone: number, name: string, percent: number): void {\n        this.setAttribute('zone', String(zone));\n        this.setAttribute('zone-name', name);\n        this.setAttribute('percent', String(Math.round(percent)));\n        // Styles are updated declaratively via CSS based on attribute\n    }\n\n    /**\n     * Clear/hide the gauge\n     */\n    public clear(): void {\n        this.removeAttribute('zone');\n        this.removeAttribute('zone-name');\n        this.setAttribute('percent', '0');\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-zone-gauge', ZoneGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-zone-gauge': ZoneGauge;\n    }\n}\n","/**\n * Live Chart Component\n *\n * A Web Component for displaying real-time rolling charts of workout metrics.\n * Uses SVG for rendering and requestAnimationFrame for smooth 60fps updates.\n * Optimized for mobile performance with minimal DOM operations.\n *\n * @example\n * ```html\n * <bpt-live-chart\n *   type=\"power\"\n *   duration=\"60\"\n *   max-value=\"400\">\n * </bpt-live-chart>\n * ```\n *\n * @module LiveChart\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Data point for the chart\n */\ninterface DataPoint {\n    timestamp: number;\n    value: number;\n}\n\n/**\n * Chart configuration by type\n */\nconst CHART_CONFIG: Record<\n    string,\n    { color: string; gradientStart: string; gradientEnd: string; label: string; unit: string; defaultMax: number }\n> = {\n    power: {\n        color: '#f97316',\n        gradientStart: 'rgba(249, 115, 22, 0.4)',\n        gradientEnd: 'rgba(249, 115, 22, 0.05)',\n        label: 'Power',\n        unit: 'W',\n        defaultMax: 400,\n    },\n    heartrate: {\n        color: '#ef4444',\n        gradientStart: 'rgba(239, 68, 68, 0.4)',\n        gradientEnd: 'rgba(239, 68, 68, 0.05)',\n        label: 'Heart Rate',\n        unit: 'bpm',\n        defaultMax: 200,\n    },\n};\n\n/**\n * Live Chart Web Component\n */\nexport class LiveChart extends BaseComponent {\n    private _data: DataPoint[] = [];\n    private _animationId: number | null = null;\n    private _lastRenderTime = 0;\n    private _isVisible = true;\n    private _duration = 60; // seconds\n    private _maxValue: number;\n    private _type: string;\n    private _svgPath: SVGPathElement | null = null;\n    private _svgArea: SVGPathElement | null = null;\n    private _currentValueEl: HTMLElement | null = null;\n    private _avgValueEl: HTMLElement | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['type', 'duration', 'max-value', 'hidden'];\n    }\n\n    constructor() {\n        super();\n        this._type = 'power';\n        this._maxValue = CHART_CONFIG.power.defaultMax;\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                background: var(--color-bg-secondary, #f6f8fa);\n                border-radius: 8px;\n                overflow: hidden;\n                contain: layout style paint;\n            }\n\n            :host([hidden]) {\n                display: none;\n            }\n\n            .chart-container {\n                position: relative;\n                width: 100%;\n                height: 120px;\n                padding: 8px;\n            }\n\n            .chart-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 0 4px 4px 4px;\n                font-size: 11px;\n                color: var(--color-text-secondary, #656d76);\n            }\n\n            .chart-label {\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .chart-values {\n                display: flex;\n                gap: 12px;\n            }\n\n            .chart-value {\n                display: flex;\n                align-items: baseline;\n                gap: 2px;\n            }\n\n            .chart-value-number {\n                font-size: 14px;\n                font-weight: 700;\n                color: var(--chart-color, #f97316);\n            }\n\n            .chart-value-label {\n                font-size: 10px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            .chart-svg-container {\n                position: relative;\n                width: 100%;\n                height: 80px;\n            }\n\n            svg {\n                width: 100%;\n                height: 100%;\n                display: block;\n            }\n\n            .chart-line {\n                fill: none;\n                stroke: var(--chart-color, #f97316);\n                stroke-width: 2;\n                stroke-linecap: round;\n                stroke-linejoin: round;\n                vector-effect: non-scaling-stroke;\n            }\n\n            .chart-area {\n                fill: url(#chartGradient);\n                opacity: 0.8;\n            }\n\n            .chart-grid-line {\n                stroke: var(--color-border, #d0d7de);\n                stroke-width: 1;\n                stroke-dasharray: 4 4;\n                opacity: 0.5;\n            }\n\n            .chart-axis-label {\n                font-size: 9px;\n                fill: var(--color-text-muted, #8b949e);\n            }\n\n            .no-data-message {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 12px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .chart-line,\n                .chart-area {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n\n        return `\n            <div class=\"chart-container\">\n                <div class=\"chart-header\">\n                    <span class=\"chart-label\">\n                        <span>${config.label}</span>\n                        <span style=\"font-weight: normal; font-size: 10px;\">(${this._duration}s)</span>\n                    </span>\n                    <div class=\"chart-values\">\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"currentValue\">--</span>\n                            <span class=\"chart-value-label\">${config.unit}</span>\n                        </div>\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"avgValue\" style=\"opacity: 0.7;\">--</span>\n                            <span class=\"chart-value-label\">avg</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chart-svg-container\">\n                    <svg viewBox=\"0 0 300 80\" preserveAspectRatio=\"none\" aria-hidden=\"true\">\n                        <defs>\n                            <linearGradient id=\"chartGradient-${this._type}\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" stop-color=\"${config.gradientStart}\" />\n                                <stop offset=\"100%\" stop-color=\"${config.gradientEnd}\" />\n                            </linearGradient>\n                        </defs>\n                        <!-- Grid lines -->\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"20\" x2=\"300\" y2=\"20\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"40\" x2=\"300\" y2=\"40\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"60\" x2=\"300\" y2=\"60\" />\n                        <!-- Axis labels -->\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"18\">${this._maxValue}</text>\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"78\">0</text>\n                        <!-- Chart paths -->\n                        <path class=\"chart-area\" id=\"chartArea\" d=\"M0,80 L300,80\" style=\"fill: url(#chartGradient-${this._type});\" />\n                        <path class=\"chart-line\" id=\"chartLine\" d=\"\" style=\"stroke: ${config.color};\" />\n                    </svg>\n                    <div class=\"no-data-message\" id=\"noDataMessage\">Waiting for data...</div>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onConnected(): void {\n        // Cache DOM references\n        this._svgPath = this.shadow.getElementById('chartLine') as SVGPathElement | null;\n        this._svgArea = this.shadow.getElementById('chartArea') as SVGPathElement | null;\n        this._currentValueEl = this.shadow.getElementById('currentValue');\n        this._avgValueEl = this.shadow.getElementById('avgValue');\n\n        // Set CSS variable for chart color\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n        this.style.setProperty('--chart-color', config.color);\n\n        // Start animation loop\n        this.startAnimation();\n\n        // Listen for visibility changes to save battery\n        document.addEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onDisconnected(): void {\n        this.stopAnimation();\n        document.removeEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        switch (name) {\n            case 'type':\n                this._type = newValue || 'power';\n                this._maxValue = CHART_CONFIG[this._type]?.defaultMax || 400;\n                this.render();\n                this.onConnected(); // Re-cache DOM refs\n                break;\n            case 'duration':\n                this._duration = parseInt(newValue || '60', 10);\n                this.render();\n                break;\n            case 'max-value':\n                this._maxValue = parseInt(newValue || '400', 10);\n                this.render();\n                break;\n            case 'hidden':\n                this._isVisible = newValue === null;\n                if (this._isVisible) {\n                    this.startAnimation();\n                } else {\n                    this.stopAnimation();\n                }\n                break;\n        }\n    }\n\n    private handleVisibilityChange = (): void => {\n        if (document.hidden) {\n            this.stopAnimation();\n        } else if (this._isVisible) {\n            this.startAnimation();\n        }\n    };\n\n    /**\n     * Add a data point to the chart\n     */\n    public addDataPoint(value: number, timestamp: number = Date.now()): void {\n        this._data.push({ timestamp, value });\n\n        // Remove old data points (keep duration + 5s buffer)\n        const cutoffTime = timestamp - (this._duration + 5) * 1000;\n        while (this._data.length > 0 && this._data[0].timestamp < cutoffTime) {\n            this._data.shift();\n        }\n\n        // Auto-adjust max value if needed\n        if (value > this._maxValue * 0.9) {\n            this._maxValue = Math.ceil(value * 1.2 / 50) * 50; // Round to nearest 50\n        }\n    }\n\n    /**\n     * Clear all data points\n     */\n    public clear(): void {\n        this._data = [];\n        this.renderChart();\n    }\n\n    /**\n     * Start the animation loop\n     */\n    private startAnimation(): void {\n        if (this._animationId !== null) return;\n\n        const animate = (time: number): void => {\n            // Throttle to ~30fps for better performance\n            if (time - this._lastRenderTime >= 33) {\n                this.renderChart();\n                this._lastRenderTime = time;\n            }\n            this._animationId = requestAnimationFrame(animate);\n        };\n\n        this._animationId = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Stop the animation loop\n     */\n    private stopAnimation(): void {\n        if (this._animationId !== null) {\n            cancelAnimationFrame(this._animationId);\n            this._animationId = null;\n        }\n    }\n\n    /**\n     * Render the chart paths\n     */\n    private renderChart(): void {\n        if (!this._svgPath || !this._svgArea) return;\n\n        const now = Date.now();\n        const startTime = now - this._duration * 1000;\n\n        // Filter data to visible range\n        const visibleData = this._data.filter((d) => d.timestamp >= startTime);\n\n        // Update no-data message\n        const noDataMsg = this.shadow.getElementById('noDataMessage');\n        if (noDataMsg) {\n            noDataMsg.style.display = visibleData.length === 0 ? 'block' : 'none';\n        }\n\n        if (visibleData.length === 0) {\n            this._svgPath.setAttribute('d', '');\n            this._svgArea.setAttribute('d', 'M0,80 L300,80');\n            return;\n        }\n\n        // Calculate path\n        const width = 300;\n        const height = 80;\n        const points: string[] = [];\n        const areaPoints: string[] = [];\n\n        visibleData.forEach((point) => {\n            const x = ((point.timestamp - startTime) / (this._duration * 1000)) * width;\n            const y = height - (Math.min(point.value, this._maxValue) / this._maxValue) * height;\n            points.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n            areaPoints.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n        });\n\n        // Build path strings\n        if (points.length > 0) {\n            const linePath = 'M' + points.join(' L');\n            this._svgPath.setAttribute('d', linePath);\n\n            // Area path: line + close to bottom\n            const firstX = ((visibleData[0].timestamp - startTime) / (this._duration * 1000)) * width;\n            const lastX =\n                ((visibleData[visibleData.length - 1].timestamp - startTime) / (this._duration * 1000)) * width;\n            const areaPath = `M${firstX.toFixed(1)},${height} L` + areaPoints.join(' L') + ` L${lastX.toFixed(1)},${height} Z`;\n            this._svgArea.setAttribute('d', areaPath);\n        }\n\n        // Update current and average values\n        if (this._currentValueEl && visibleData.length > 0) {\n            const currentValue = visibleData[visibleData.length - 1].value;\n            this._currentValueEl.textContent = Math.round(currentValue).toString();\n        }\n\n        if (this._avgValueEl && visibleData.length > 0) {\n            const avg = visibleData.reduce((sum, p) => sum + p.value, 0) / visibleData.length;\n            this._avgValueEl.textContent = Math.round(avg).toString();\n        }\n    }\n\n    /**\n     * Get current data for debugging/testing\n     */\n    public getData(): DataPoint[] {\n        return [...this._data];\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-live-chart', LiveChart);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-live-chart': LiveChart;\n    }\n}\n","/**\n * Workout Timer Component\n * \n * A Web Component for displaying workout elapsed time.\n * Supports different states: idle, recording, paused.\n * \n * @example\n * ```html\n * <bpt-workout-timer\n *   elapsed=\"3661\"\n *   state=\"recording\">\n * </bpt-workout-timer>\n * ```\n * \n * @module WorkoutTimer\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Workout state enum\n */\nexport type WorkoutTimerState = 'idle' | 'recording' | 'paused';\n\n/**\n * Workout Timer Web Component\n */\nexport class WorkoutTimer extends BaseComponent {\n    private intervalId: number | null = null;\n    private startTimestamp = 0;\n    private pausedElapsed = 0;\n\n    static get observedAttributes(): string[] {\n        return ['elapsed', 'state', 'show-milliseconds'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;\n            }\n            \n            .timer {\n                font-size: clamp(20px, 5vw, 32px);\n                font-weight: 600;\n                color: var(--color-text-primary, #1f2328);\n                letter-spacing: 0.5px;\n                transition: color 0.3s ease;\n            }\n            \n            :host([state=\"recording\"]) .timer {\n                color: var(--color-success, #15803d);\n            }\n            \n            :host([state=\"paused\"]) .timer {\n                color: var(--color-warning, #a16207);\n                animation: blink 1s ease-in-out infinite;\n            }\n            \n            :host([state=\"idle\"]) .timer {\n                color: var(--color-text-muted, #8b949e);\n            }\n            \n            .milliseconds {\n                font-size: 0.5em;\n                opacity: 0.7;\n            }\n            \n            @keyframes blink {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.5; }\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host([state=\"paused\"]) .timer {\n                    animation: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const elapsed = parseInt(this.getAttribute('elapsed') || '0', 10);\n        const showMs = this.hasAttribute('show-milliseconds');\n        const timeString = this.formatTime(elapsed, showMs);\n\n        return `\n            <time class=\"timer\" datetime=\"PT${elapsed}S\" aria-live=\"off\">\n                ${timeString}\n            </time>\n        `;\n    }\n\n    /**\n     * Format elapsed seconds to HH:MM:SS or HH:MM:SS.ms\n     */\n    private formatTime(totalSeconds: number, showMs = false): string {\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = Math.floor(totalSeconds % 60);\n\n        const pad = (n: number) => n.toString().padStart(2, '0');\n        let result = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;\n\n        if (showMs) {\n            const ms = Math.floor((totalSeconds % 1) * 100);\n            result += `<span class=\"milliseconds\">.${pad(ms)}</span>`;\n        }\n\n        return result;\n    }\n\n    protected onAttributeChanged(name: string): void {\n        if (name === 'state') {\n            this.handleStateChange();\n        }\n        this.render();\n    }\n\n    /**\n     * Handle state changes\n     */\n    private handleStateChange(): void {\n        const state = this.getAttribute('state') as WorkoutTimerState;\n\n        if (state === 'recording' && !this.intervalId) {\n            this.startTicking();\n        } else if (state !== 'recording' && this.intervalId) {\n            this.stopTicking();\n        }\n    }\n\n    /**\n     * Start the internal tick\n     */\n    private startTicking(): void {\n        this.startTimestamp = Date.now() - (this.pausedElapsed * 1000);\n        this.intervalId = window.setInterval(() => {\n            const elapsed = (Date.now() - this.startTimestamp) / 1000;\n            this.setAttribute('elapsed', String(elapsed));\n        }, 100);\n    }\n\n    /**\n     * Stop the internal tick\n     */\n    private stopTicking(): void {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n        this.pausedElapsed = parseFloat(this.getAttribute('elapsed') || '0');\n    }\n\n    protected onDisconnected(): void {\n        this.stopTicking();\n    }\n\n    /**\n     * Start the timer\n     */\n    public start(): void {\n        this.setAttribute('state', 'recording');\n        this.emit('timer-start');\n    }\n\n    /**\n     * Pause the timer\n     */\n    public pause(): void {\n        this.setAttribute('state', 'paused');\n        this.emit('timer-pause');\n    }\n\n    /**\n     * Resume the timer\n     */\n    public resume(): void {\n        this.setAttribute('state', 'recording');\n        this.emit('timer-resume');\n    }\n\n    /**\n     * Stop and reset the timer\n     */\n    public stop(): void {\n        this.setAttribute('state', 'idle');\n        this.pausedElapsed = 0;\n        this.emit('timer-stop', { elapsed: parseFloat(this.getAttribute('elapsed') || '0') });\n    }\n\n    /**\n     * Reset the timer to zero\n     */\n    public reset(): void {\n        this.pausedElapsed = 0;\n        this.startTimestamp = Date.now();\n        this.setAttribute('elapsed', '0');\n        this.emit('timer-reset');\n    }\n\n    /**\n     * Get the current elapsed time in seconds\n     */\n    public getElapsed(): number {\n        return parseFloat(this.getAttribute('elapsed') || '0');\n    }\n\n    /**\n     * Get the current state\n     */\n    public getState(): WorkoutTimerState {\n        return (this.getAttribute('state') as WorkoutTimerState) || 'idle';\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-workout-timer', WorkoutTimer);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-workout-timer': WorkoutTimer;\n    }\n}\n","/**\n * Notification Toast Component\n * \n * A Web Component for displaying toast-style notifications.\n * Accessible, auto-dismissing, and supports different notification types.\n * \n * @example\n * ```html\n * <bpt-toast\n *   message=\"Workout saved!\"\n *   type=\"success\"\n *   duration=\"3000\">\n * </bpt-toast>\n * ```\n * \n * Or programmatically:\n * ```typescript\n * Toast.show('Workout saved!', 'success');\n * ```\n * \n * @module Toast\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Notification type determines styling\n */\nexport type ToastType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Toast configuration options\n */\nexport interface ToastOptions {\n    message: string;\n    type?: ToastType;\n    duration?: number;\n    dismissible?: boolean;\n}\n\n/**\n * Type-specific colors (WCAG AA compliant)\n */\nconst TYPE_STYLES: Record<ToastType, { bg: string; icon: string }> = {\n    info: { bg: '#1d4ed8', icon: '' },\n    success: { bg: '#15803d', icon: '' },\n    error: { bg: '#b91c1c', icon: '' },\n    warning: { bg: '#a16207', icon: '' },\n};\n\n/**\n * Toast Notification Web Component\n */\nexport class Toast extends BaseComponent {\n    private timeoutId: number | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['message', 'type', 'duration', 'dismissible'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 80px;\n                left: 50%;\n                transform: translateX(-50%) translateY(-20px);\n                z-index: 10001;\n                opacity: 0;\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                pointer-events: none;\n            }\n\n            :host(.stacked) {\n                position: relative;\n                top: auto;\n                left: auto;\n                transform: translateX(100%); /* Start from right */\n                margin-bottom: 10px;\n                pointer-events: auto; /* Container handles layout */\n                opacity: 0;\n            }\n            \n            :host(.visible) {\n                transform: translateX(-50%) translateY(0);\n                opacity: 1;\n                pointer-events: auto;\n            }\n\n            :host(.stacked.visible) {\n                transform: translateX(0);\n                opacity: 1;\n            }\n            \n            :host(.hiding) {\n                transform: translateX(-50%) translateY(-20px);\n                opacity: 0;\n            }\n\n            :host(.stacked.hiding) {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            \n            .toast {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 12px 20px;\n                border-radius: 8px;\n                background-color: var(--toast-bg, #1d4ed8);\n                color: white;\n                font-size: 14px;\n                font-weight: 500;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                max-width: 90vw;\n            }\n            \n            .icon {\n                font-size: 18px;\n                flex-shrink: 0;\n            }\n            \n            .message {\n                flex: 1;\n            }\n            \n            .dismiss-btn {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 18px;\n                cursor: pointer;\n                padding: 0 4px;\n                opacity: 0.8;\n                transition: opacity 0.2s ease;\n                flex-shrink: 0;\n            }\n            \n            .dismiss-btn:hover {\n                opacity: 1;\n            }\n            \n            .dismiss-btn:focus-visible {\n                outline: 2px solid white;\n                outline-offset: 2px;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const message = this.getAttribute('message') || '';\n        const type = (this.getAttribute('type') || 'info') as ToastType;\n        const dismissible = this.getAttribute('dismissible') !== 'false';\n        const styles = TYPE_STYLES[type] || TYPE_STYLES.info;\n\n        this.style.setProperty('--toast-bg', styles.bg);\n\n        return `\n            <div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n                <span class=\"icon\" aria-hidden=\"true\">${styles.icon}</span>\n                <span class=\"message\">${message}</span>\n                ${dismissible ? `\n                    <button class=\"dismiss-btn\" aria-label=\"Dismiss notification\">&times;</button>\n                ` : ''}\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        const dismissBtn = this.query('.dismiss-btn');\n        if (dismissBtn) {\n            dismissBtn.addEventListener('click', () => this.dismiss());\n        }\n    }\n\n    protected onConnected(): void {\n        // Trigger show animation\n        requestAnimationFrame(() => {\n            requestAnimationFrame(() => {\n                this.classList.add('visible');\n            });\n        });\n\n        // Auto-dismiss after duration\n        const duration = parseInt(this.getAttribute('duration') || '3000', 10);\n        if (duration > 0) {\n            this.timeoutId = window.setTimeout(() => this.dismiss(), duration);\n        }\n    }\n\n    protected onDisconnected(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n    }\n\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Re-render when attributes change\n        this.render();\n        this.setupEventListeners();\n    }\n\n    /**\n     * Dismiss the toast\n     */\n    public dismiss(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n\n        this.classList.remove('visible');\n        this.classList.add('hiding');\n\n        // Remove after animation\n        setTimeout(() => {\n            this.remove();\n        }, 300);\n    }\n\n    /**\n     * Static method to show a toast notification\n     */\n    static show(message: string, type: ToastType = 'info', options: Partial<ToastOptions> = {}): Toast {\n        const toast = document.createElement('bpt-toast') as Toast;\n        toast.setAttribute('message', message);\n        toast.setAttribute('type', type);\n\n        if (options.duration !== undefined) {\n            toast.setAttribute('duration', String(options.duration));\n        }\n        if (options.dismissible !== undefined) {\n            toast.setAttribute('dismissible', String(options.dismissible));\n        }\n\n        document.body.appendChild(toast);\n        return toast;\n    }\n\n    /**\n     * Convenience methods for different types\n     */\n    static info(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'info', options);\n    }\n\n    static success(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'success', options);\n    }\n\n    static error(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'error', options);\n    }\n\n    static warning(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'warning', options);\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-toast', Toast);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-toast': Toast;\n    }\n}\n","/**\n * Modal Dialog Component\n * \n * A Web Component for displaying modal dialogs.\n * Fully accessible with keyboard navigation, focus trapping, and screen reader support.\n * \n * @example\n * ```html\n * <bpt-modal title=\"Confirm\" icon=\"\" open>\n *   <p>Are you sure you want to delete this workout?</p>\n *   <div slot=\"footer\">\n *     <button data-action=\"cancel\">Cancel</button>\n *     <button data-action=\"confirm\">Delete</button>\n *   </div>\n * </bpt-modal>\n * ```\n * \n * Or programmatically:\n * ```typescript\n * const result = await Modal.confirm({\n *   title: 'Delete Workout',\n *   message: 'Are you sure?',\n *   confirmText: 'Delete',\n *   variant: 'danger'\n * });\n * ```\n * \n * @module Modal\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Button variant determines styling\n */\nexport type ButtonVariant = 'primary' | 'secondary' | 'danger';\n\n/**\n * Modal configuration for programmatic usage\n */\nexport interface ModalConfig {\n    title: string;\n    message: string | HTMLElement;\n    icon?: string;\n    confirmText?: string;\n    cancelText?: string;\n    variant?: ButtonVariant;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Modal Dialog Web Component\n */\nexport class Modal extends BaseComponent {\n    private previousActiveElement: HTMLElement | null = null;\n    private focusTrapHandler: ((e: KeyboardEvent) => void) | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['title', 'icon', 'open', 'close-on-overlay'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 1000;\n                display: none;\n                align-items: center;\n                justify-content: center;\n            }\n            \n            :host([open]) {\n                display: flex;\n            }\n            \n            .overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-color: rgba(0, 0, 0, 0.5);\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n            \n            :host([open]) .overlay {\n                opacity: 1;\n            }\n            \n            .modal {\n                position: relative;\n                background: var(--modal-bg, white);\n                border-radius: 12px;\n                max-width: 90%;\n                max-height: 85vh;\n                min-width: 300px;\n                display: flex;\n                flex-direction: column;\n                box-shadow: 0 8px 24px var(--color-shadow, rgba(0, 0, 0, 0.15));\n                transform: scale(0.95) translateY(20px);\n                opacity: 0;\n                transition: transform 0.2s ease, opacity 0.2s ease;\n            }\n            \n            :host([open]) .modal {\n                transform: scale(1) translateY(0);\n                opacity: 1;\n            }\n            \n            .header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 20px 24px;\n                border-bottom: 1px solid var(--color-border, #d0d7de);\n            }\n            \n            .title {\n                font-size: 20px;\n                font-weight: 600;\n                color: var(--color-text-primary, #1f2328);\n                margin: 0;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            \n            .icon {\n                font-size: 24px;\n            }\n            \n            .close-btn {\n                background: none;\n                border: none;\n                font-size: 24px;\n                color: var(--color-text-secondary, #656d76);\n                cursor: pointer;\n                padding: 4px;\n                border-radius: 4px;\n                transition: background-color 0.15s ease;\n                line-height: 1;\n            }\n            \n            .close-btn:hover {\n                background-color: var(--color-bg-hover, rgba(0, 0, 0, 0.05));\n            }\n            \n            .close-btn:focus-visible {\n                outline: 2px solid var(--color-accent, #2196F3);\n                outline-offset: 2px;\n            }\n            \n            .body {\n                padding: 20px 24px;\n                overflow-y: auto;\n                flex: 1;\n                color: var(--color-text-primary, #1f2328);\n            }\n            \n            .footer {\n                padding: 16px 24px;\n                border-top: 1px solid var(--color-border, #d0d7de);\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n            }\n            \n            ::slotted([slot=\"footer\"]) {\n                display: flex;\n                gap: 8px;\n            }\n            \n            /* Default button styles for slotted buttons */\n            .btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: background-color 0.15s ease;\n            }\n            \n            .btn-secondary {\n                background: white;\n                border: 1px solid var(--color-border, #d0d7de);\n                color: var(--color-text-primary, #1f2328);\n            }\n            \n            .btn-secondary:hover {\n                background: var(--color-bg-secondary, #f6f8fa);\n            }\n            \n            .btn-primary {\n                background: var(--color-accent, #2196F3);\n                border: none;\n                color: white;\n            }\n            \n            .btn-primary:hover {\n                background: var(--color-accent-hover, #1976d2);\n            }\n            \n            .btn-danger {\n                background: var(--color-error, #cf222e);\n                border: none;\n                color: white;\n            }\n            \n            .btn-danger:hover {\n                background: #a40e26;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .overlay,\n                .modal {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const title = this.getAttribute('title') || '';\n        const icon = this.getAttribute('icon') || '';\n\n        return `\n            <div class=\"overlay\" part=\"overlay\"></div>\n            <div class=\"modal\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-title\">\n                <div class=\"header\">\n                    <h2 class=\"title\" id=\"modal-title\">\n                        ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                        ${title}\n                    </h2>\n                    <button class=\"close-btn\" aria-label=\"Close dialog\">&times;</button>\n                </div>\n                <div class=\"body\">\n                    <slot></slot>\n                </div>\n                <div class=\"footer\">\n                    <slot name=\"footer\"></slot>\n                </div>\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        // Close button\n        const closeBtn = this.query('.close-btn');\n        closeBtn?.addEventListener('click', () => this.close());\n\n        // Overlay click\n        const overlay = this.query('.overlay');\n        overlay?.addEventListener('click', () => {\n            if (this.getAttribute('close-on-overlay') !== 'false') {\n                this.close();\n            }\n        });\n\n        // Escape key\n        this.addEventListener('keydown', (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                this.close();\n            }\n        });\n\n        // Button actions in footer\n        this.addEventListener('click', (e: Event) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset?.action;\n            if (action) {\n                this.emit('modal-action', { action });\n                if (action === 'cancel' || action === 'confirm') {\n                    this.close();\n                }\n            }\n        });\n    }\n\n    protected onConnected(): void {\n        if (this.hasAttribute('open')) {\n            this.onOpen();\n        }\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'open') {\n            if (newValue !== null) {\n                this.onOpen();\n            } else {\n                this.onClose();\n            }\n        }\n    }\n\n    /**\n     * Called when modal opens\n     */\n    private onOpen(): void {\n        this.previousActiveElement = document.activeElement as HTMLElement;\n        this.setupFocusTrap();\n\n        // Focus first focusable element\n        requestAnimationFrame(() => {\n            const firstFocusable = this.shadow.querySelector<HTMLElement>(\n                'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n            );\n            firstFocusable?.focus();\n        });\n\n        this.emit('modal-open');\n    }\n\n    /**\n     * Called when modal closes\n     */\n    private onClose(): void {\n        this.removeFocusTrap();\n        this.previousActiveElement?.focus();\n        this.emit('modal-close');\n    }\n\n    /**\n     * Set up focus trap\n     */\n    private setupFocusTrap(): void {\n        this.focusTrapHandler = (e: KeyboardEvent) => {\n            if (e.key !== 'Tab') return;\n\n            const focusableElements = this.shadow.querySelectorAll<HTMLElement>(\n                'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n            );\n            const first = focusableElements[0];\n            const last = focusableElements[focusableElements.length - 1];\n\n            if (e.shiftKey && document.activeElement === first) {\n                e.preventDefault();\n                last?.focus();\n            } else if (!e.shiftKey && document.activeElement === last) {\n                e.preventDefault();\n                first?.focus();\n            }\n        };\n\n        this.addEventListener('keydown', this.focusTrapHandler);\n    }\n\n    /**\n     * Remove focus trap\n     */\n    private removeFocusTrap(): void {\n        if (this.focusTrapHandler) {\n            this.removeEventListener('keydown', this.focusTrapHandler);\n            this.focusTrapHandler = null;\n        }\n    }\n\n    /**\n     * Open the modal\n     */\n    public open(): void {\n        this.setAttribute('open', '');\n    }\n\n    /**\n     * Close the modal\n     */\n    public close(): void {\n        this.removeAttribute('open');\n    }\n\n    /**\n     * Toggle modal visibility\n     */\n    public toggle(): void {\n        if (this.hasAttribute('open')) {\n            this.close();\n        } else {\n            this.open();\n        }\n    }\n\n    /**\n     * Static method to show a confirmation dialog\n     */\n    static confirm(config: ModalConfig): Promise<boolean> {\n        return new Promise((resolve) => {\n            const modal = document.createElement('bpt-modal') as Modal;\n            modal.setAttribute('title', config.title);\n            if (config.icon) {\n                modal.setAttribute('icon', config.icon);\n            }\n\n            // Set content\n            const content = document.createElement('div');\n            if (typeof config.message === 'string') {\n                content.innerHTML = `<p>${config.message}</p>`;\n            } else {\n                content.appendChild(config.message);\n            }\n            modal.appendChild(content);\n\n            // Create footer with buttons\n            const footer = document.createElement('div');\n            footer.setAttribute('slot', 'footer');\n\n            const cancelBtn = document.createElement('button');\n            cancelBtn.className = 'btn btn-secondary';\n            cancelBtn.textContent = config.cancelText || 'Cancel';\n            cancelBtn.dataset.action = 'cancel';\n\n            const confirmBtn = document.createElement('button');\n            confirmBtn.className = `btn btn-${config.variant || 'primary'}`;\n            confirmBtn.textContent = config.confirmText || 'Confirm';\n            confirmBtn.dataset.action = 'confirm';\n\n            footer.appendChild(cancelBtn);\n            footer.appendChild(confirmBtn);\n            modal.appendChild(footer);\n\n            // Handle actions\n            modal.addEventListener('modal-action', ((e: CustomEvent) => {\n                resolve(e.detail.action === 'confirm');\n                modal.remove();\n            }) as EventListener);\n\n            modal.addEventListener('modal-close', () => {\n                resolve(false);\n                modal.remove();\n            });\n\n            document.body.appendChild(modal);\n            modal.open();\n        });\n    }\n\n    /**\n     * Static method to show an alert dialog\n     */\n    static alert(title: string, message: string, icon?: string): Promise<void> {\n        return new Promise((resolve) => {\n            const modal = document.createElement('bpt-modal') as Modal;\n            modal.setAttribute('title', title);\n            if (icon) {\n                modal.setAttribute('icon', icon);\n            }\n\n            const content = document.createElement('p');\n            content.textContent = message;\n            modal.appendChild(content);\n\n            const footer = document.createElement('div');\n            footer.setAttribute('slot', 'footer');\n\n            const okBtn = document.createElement('button');\n            okBtn.className = 'btn btn-primary';\n            okBtn.textContent = 'OK';\n            okBtn.dataset.action = 'confirm';\n            footer.appendChild(okBtn);\n            modal.appendChild(footer);\n\n            modal.addEventListener('modal-close', () => {\n                resolve();\n                modal.remove();\n            });\n\n            document.body.appendChild(modal);\n            modal.open();\n        });\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-modal', Modal);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-modal': Modal;\n    }\n}\n","/**\n * Data Fields Type System\n * \n * Core type definitions for the customizable data fields system.\n * Based on industry standards from Garmin, Wahoo, and Hammerhead devices.\n * \n * @module data-fields/types\n */\n\nimport type { MeasurementsState } from '../measurements-state.js';\n\n// ============================================================================\n// Category Types\n// ============================================================================\n\n/** Data field category for organization and filtering */\nexport type DataFieldCategory =\n    | 'power'\n    | 'cadence'\n    | 'heartrate'\n    | 'speed'\n    | 'distance'\n    | 'elevation'\n    | 'time'\n    | 'laps'\n    | 'energy'\n    | 'environment'\n    | 'device'\n    | 'charts'\n    | 'map';\n\n/** Category metadata for UI display */\nexport interface CategoryInfo {\n    id: DataFieldCategory;\n    name: string;\n    icon: string;\n    description: string;\n}\n\n/** All category metadata */\nexport const CATEGORY_INFO: Record<DataFieldCategory, CategoryInfo> = {\n    power: { id: 'power', name: 'Power', icon: '', description: 'Power meter data and calculations' },\n    cadence: { id: 'cadence', name: 'Cadence', icon: '', description: 'Pedaling cadence metrics' },\n    heartrate: { id: 'heartrate', name: 'Heart Rate', icon: '', description: 'Heart rate monitoring' },\n    speed: { id: 'speed', name: 'Speed & Pace', icon: '', description: 'Speed and pace metrics' },\n    distance: { id: 'distance', name: 'Distance', icon: '', description: 'Distance tracking' },\n    elevation: { id: 'elevation', name: 'Elevation', icon: '', description: 'Altitude and climbing' },\n    time: { id: 'time', name: 'Time', icon: '', description: 'Time and duration' },\n    laps: { id: 'laps', name: 'Laps', icon: '', description: 'Lap-specific metrics' },\n    energy: { id: 'energy', name: 'Energy', icon: '', description: 'Calories and Work' },\n    environment: { id: 'environment', name: 'Environment', icon: '', description: 'Weather and conditions' },\n    device: { id: 'device', name: 'Device', icon: '', description: 'Device and sensor status' },\n    charts: { id: 'charts', name: 'Charts', icon: '', description: 'Graphical data displays' },\n    map: { id: 'map', name: 'Map', icon: '', description: 'Route and location' },\n};\n\n// ============================================================================\n// Size Types\n// ============================================================================\n\n/** Data field size options for layout */\nexport type DataFieldSize =\n    | 'small'    // 1x1 - compact, value only (no label)\n    | 'medium'   // 1x1 - label + value (default)\n    | 'large'    // 2x1 - label + large value\n    | 'wide'     // 2x1 - for charts/graphs\n    | 'tall'     // 1x2 - vertical layout\n    | 'full';    // 2x2 - maps, large charts\n\n/** Size metadata for UI */\nexport interface SizeInfo {\n    id: DataFieldSize;\n    name: string;\n    gridSpan: { cols: number; rows: number };\n    showLabel: boolean;\n}\n\n/** All size metadata */\nexport const SIZE_INFO: Record<DataFieldSize, SizeInfo> = {\n    small: { id: 'small', name: 'Small', gridSpan: { cols: 1, rows: 1 }, showLabel: false },\n    medium: { id: 'medium', name: 'Medium', gridSpan: { cols: 1, rows: 1 }, showLabel: true },\n    large: { id: 'large', name: 'Large', gridSpan: { cols: 2, rows: 1 }, showLabel: true },\n    wide: { id: 'wide', name: 'Wide', gridSpan: { cols: 2, rows: 1 }, showLabel: true },\n    tall: { id: 'tall', name: 'Tall', gridSpan: { cols: 1, rows: 2 }, showLabel: true },\n    full: { id: 'full', name: 'Full', gridSpan: { cols: 2, rows: 2 }, showLabel: true },\n};\n\n// ============================================================================\n// Source & Update Types\n// ============================================================================\n\n/** Data source type - where the data comes from */\nexport type DataSourceType =\n    | 'sensor'      // Direct from Bluetooth sensor\n    | 'gps'         // From GPS/location services\n    | 'calculated'  // Derived from other data\n    | 'system'      // Device info (battery, etc.)\n    | 'workout'     // From workout state (laps, time, etc.)\n    | 'external';   // Weather API, etc.\n\n/** Update frequency - how often the field refreshes */\nexport type UpdateFrequency =\n    | 'realtime'    // Every measurement (~100ms)\n    | 'second'      // Once per second\n    | 'periodic'    // Every few seconds (5s)\n    | 'on-change'   // Only when value changes\n    | 'manual';     // User triggered\n\n// ============================================================================\n// Workout State Interface (for calculators)\n// ============================================================================\n\n/** Workout state passed to calculators */\nexport interface WorkoutState {\n    isActive: boolean;\n    isPaused: boolean;\n    startTime: number | null;\n    elapsedTime: number;        // ms\n    movingTime: number;         // ms (excluding paused/stopped)\n    pausedTime: number;         // ms\n    currentLap: number;\n    lapStartTime: number | null;\n    lapElapsedTime: number;     // ms\n    laps: LapData[];\n}\n\n/** Individual lap data */\nexport interface LapData {\n    lapNumber: number;\n    startTime: number;\n    endTime: number;\n    duration: number;           // ms\n    distance: number;           // meters\n    avgPower: number | null;\n    avgHeartrate: number | null;\n    avgCadence: number | null;\n    avgSpeed: number | null;    // m/s\n    elevationGain: number;      // meters\n}\n\n// ============================================================================\n// User Settings Interface (for formatters/colorizers)\n// ============================================================================\n\n/** User settings passed to formatters and colorizers */\nexport interface UserSettings {\n    unitSystem: 'metric' | 'imperial';\n    ftp: number | null;              // Functional Threshold Power (watts)\n    maxHr: number | null;            // Maximum heart rate (bpm)\n    weight: number | null;           // User weight (kg)\n    restingHr: number | null;        // Resting heart rate (bpm)\n    showCalories: boolean;           // Show calorie estimation\n    targetDistance?: number | null;  // Target distance in user units (km/mi)\n\n    // Zone configurations\n    powerZones: ZoneConfig[];\n    hrZones: ZoneConfig[];\n}\n\n/** Check if user is using imperial units */\nexport const isImperial = (settings: UserSettings): boolean => settings.unitSystem === 'imperial';\n\n/** Zone configuration */\nexport interface ZoneConfig {\n    zone: number;\n    name: string;\n    minPercent: number;         // % of FTP or MaxHR\n    maxPercent: number;\n    color: string;              // CSS color\n}\n\n/** Default power zones (based on Coggan) */\nexport const DEFAULT_POWER_ZONES: ZoneConfig[] = [\n    { zone: 1, name: 'Recovery', minPercent: 0, maxPercent: 55, color: '#9ca3af' },\n    { zone: 2, name: 'Endurance', minPercent: 55, maxPercent: 75, color: '#22c55e' },\n    { zone: 3, name: 'Tempo', minPercent: 75, maxPercent: 90, color: '#eab308' },\n    { zone: 4, name: 'Threshold', minPercent: 90, maxPercent: 105, color: '#f97316' },\n    { zone: 5, name: 'VO2max', minPercent: 105, maxPercent: 120, color: '#ef4444' },\n    { zone: 6, name: 'Anaerobic', minPercent: 120, maxPercent: 150, color: '#a855f7' },\n    { zone: 7, name: 'Neuromuscular', minPercent: 150, maxPercent: 999, color: '#ec4899' },\n];\n\n/** Default HR zones (5-zone model) */\nexport const DEFAULT_HR_ZONES: ZoneConfig[] = [\n    { zone: 1, name: 'Recovery', minPercent: 50, maxPercent: 60, color: '#9ca3af' },\n    { zone: 2, name: 'Aerobic', minPercent: 60, maxPercent: 70, color: '#22c55e' },\n    { zone: 3, name: 'Tempo', minPercent: 70, maxPercent: 80, color: '#eab308' },\n    { zone: 4, name: 'Threshold', minPercent: 80, maxPercent: 90, color: '#f97316' },\n    { zone: 5, name: 'VO2max', minPercent: 90, maxPercent: 100, color: '#ef4444' },\n];\n\n// ============================================================================\n// Calculator & Formatter Types\n// ============================================================================\n\n/** Calculator function for derived/calculated fields */\nexport type DataFieldCalculator = (\n    measurements: MeasurementsState,\n    workoutState: WorkoutState,\n    settings: UserSettings\n) => number | null;\n\n/** Formatter function to convert value to display string */\nexport type DataFieldFormatter = (\n    value: number | null,\n    settings: UserSettings\n) => string;\n\n/** Zone color result */\nexport interface ZoneColor {\n    bg: string;\n    text: string;\n    border: string;\n    zone: number;\n    zoneName: string;\n}\n\n/** Colorizer function for zone-based coloring */\nexport type DataFieldColorizer = (\n    value: number | null,\n    settings: UserSettings\n) => ZoneColor | null;\n\n// ============================================================================\n// Data Field Definition\n// ============================================================================\n\n/** Complete data field definition */\nexport interface DataFieldDefinition {\n    /** Unique identifier: 'power-current', 'heartrate-avg', etc. */\n    id: string;\n\n    /** Display name: 'Power', 'Avg Heart Rate', etc. */\n    name: string;\n\n    /** Abbreviated name for small displays: 'PWR', 'Avg HR', etc. */\n    shortName: string;\n\n    /** Category for organization */\n    category: DataFieldCategory;\n\n    /** Description for field picker */\n    description: string;\n\n    /** Unit string (metric): 'W', 'bpm', 'km/h', null for unitless */\n    unit: string | null;\n\n    /** Unit string for imperial: 'mph', 'ft', etc. */\n    unitImperial?: string;\n\n    /** Where the data comes from */\n    sourceType: DataSourceType;\n\n    /** How often the field updates */\n    updateFrequency: UpdateFrequency;\n\n    /** Default size when added to a screen */\n    defaultSize: DataFieldSize;\n\n    /** Sizes this field supports */\n    supportedSizes: DataFieldSize[];\n\n    /** Icon (emoji or class) for display */\n    icon: string;\n\n    /** Required sensors to show this field */\n    requiresSensor?: string[];\n\n    /** Requires GPS to be active */\n    requiresGps?: boolean;\n\n    /** Only available during active workout */\n    requiresWorkoutActive?: boolean;\n\n    /** Calculator for derived fields (optional) */\n    calculator?: DataFieldCalculator;\n\n    /** Formatter to convert value to display string */\n    formatter: DataFieldFormatter;\n\n    /** Colorizer for zone-based coloring (optional) */\n    colorizer?: DataFieldColorizer;\n\n    /** Number of decimal places for default formatting */\n    decimals?: number;\n\n    /** Minimum valid value (for sanity checking) */\n    minValue?: number;\n\n    /** Maximum valid value (for sanity checking) */\n    maxValue?: number;\n}\n\n// ============================================================================\n// Screen & Layout Types\n// ============================================================================\n\n/** A configured data field slot in a screen */\nexport interface DataFieldSlot {\n    /** Unique slot ID within the screen */\n    id: string;\n\n    /** Reference to DataFieldDefinition.id */\n    fieldId: string;\n\n    /** Size override (or default from field) */\n    size: DataFieldSize;\n\n    /** Position/order in the grid (1-based) */\n    position: number;\n}\n\n/** Screen layout options */\nexport type ScreenLayout =\n    | 'auto'       // Automatic grid based on field count\n    | 'grid-2'     // 2 columns\n    | 'grid-3'     // 3 columns  \n    | 'grid-4'     // 4 columns\n    | 'list'       // Vertical list (1 column)\n    | 'custom';    // User-defined positions\n\n/** A complete data screen configuration */\nexport interface DataScreen {\n    /** Unique screen ID */\n    id: string;\n\n    /** Screen name for display */\n    name: string;\n\n    /** Screen icon */\n    icon: string;\n\n    /** Field slots on this screen */\n    slots: DataFieldSlot[];\n\n    /** Layout mode */\n    layout: ScreenLayout;\n}\n\n/** Activity type for profiles */\nexport type ActivityType = 'cycling' | 'running' | 'indoor' | 'custom';\n\n/** Activity profile containing multiple screens */\nexport interface ActivityProfile {\n    /** Unique profile ID */\n    id: string;\n\n    /** Profile name */\n    name: string;\n\n    /** Profile icon */\n    icon: string;\n\n    /** Activity type */\n    activityType: ActivityType;\n\n    /** Screens in this profile */\n    screens: DataScreen[];\n\n    /** Currently active screen index */\n    activeScreenIndex: number;\n}\n\n// ============================================================================\n// Settings Types\n// ============================================================================\n\n/** Data field settings stored in localStorage */\nexport interface DataFieldSettings {\n    /** User's activity profiles */\n    profiles: ActivityProfile[];\n\n    /** Currently active profile ID */\n    activeProfileId: string;\n\n    /** Unit system preference */\n    unitSystem: 'metric' | 'imperial';\n\n    /** Per-field preferences */\n    fieldPreferences: Record<string, FieldPreference>;\n}\n\n/** Per-field user preferences */\nexport interface FieldPreference {\n    /** Show this field in workout summary */\n    showInSummary: boolean;\n\n    /** Announce this field via voice */\n    voiceAnnounce: boolean;\n\n    /** Alert threshold value */\n    alertThreshold?: number;\n\n    /** Alert when above or below threshold */\n    alertType?: 'above' | 'below';\n}\n\n// ============================================================================\n// Event Types\n// ============================================================================\n\n/** Event dispatched when a data field value updates */\nexport interface DataFieldUpdateEvent {\n    fieldId: string;\n    value: number | null;\n    formattedValue: string;\n    timestamp: number;\n}\n\n/** Event dispatched when screen changes */\nexport interface ScreenChangeEvent {\n    profileId: string;\n    screenIndex: number;\n    screen: DataScreen;\n}\n\n// ============================================================================\n// User Settings & State Types\n// ============================================================================\n\n","/**\n * Data Screen Configuration Types\n * \n * Defines the structure for configurable data screens and activity profiles.\n * Users can create multiple screens with different data field layouts,\n * similar to Garmin/Wahoo bike computers.\n * \n * @module data-fields/screens\n */\n\nimport type {\n    DataFieldSize,\n    DataFieldSlot,\n    DataScreen,\n    ActivityProfile,\n    ScreenLayout,\n    ActivityType,\n} from './types.js';\n\n// Re-export types for backward compatibility\nexport type {\n    DataFieldSlot,\n    DataScreen,\n    ActivityProfile,\n    ScreenLayout,\n    ActivityType,\n};\n\n// ============================================================================\n// Data Field Settings\n// ============================================================================\n\n/**\n * Per-field preferences and alert settings\n */\nexport interface FieldPreferences {\n    /** Show this field in workout summary */\n    showInSummary: boolean;\n    /** Announce this field via voice */\n    voiceAnnounce: boolean;\n    /** Optional alert threshold value */\n    alertThreshold?: number;\n    /** Alert when value goes above or below threshold */\n    alertType?: 'above' | 'below';\n    /** Custom color override */\n    customColor?: string;\n}\n\n/**\n * Complete data field settings stored in user preferences\n */\nexport interface DataFieldSettings {\n    /** All activity profiles */\n    profiles: ActivityProfile[];\n    /** Currently active profile ID */\n    activeProfileId: string;\n    /** Unit system preference */\n    unitSystem: 'metric' | 'imperial';\n    /** Per-field preferences keyed by field ID */\n    fieldPreferences: Record<string, FieldPreferences>;\n    /** Schema version for migrations */\n    version: number;\n}\n\n// ============================================================================\n// Screen Utility Functions\n// ============================================================================\n\n/**\n * Generate a unique slot ID\n */\nexport function generateSlotId(): string {\n    return `slot-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Generate a unique screen ID\n */\nexport function generateScreenId(): string {\n    return `screen-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Generate a unique profile ID\n */\nexport function generateProfileId(): string {\n    return `profile-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\n/**\n * Create an empty data screen with default settings\n */\nexport function createEmptyScreen(name: string, icon: string = ''): DataScreen {\n    return {\n        id: generateScreenId(),\n        name,\n        icon,\n        layout: 'auto',\n        slots: [],\n    };\n}\n\n/**\n * Create a data field slot\n */\nexport function createSlot(\n    fieldId: string,\n    size: DataFieldSize = 'medium',\n    position: number = 1\n): DataFieldSlot {\n    return {\n        id: generateSlotId(),\n        fieldId,\n        size,\n        position,\n    };\n}\n\n/**\n * Create an empty activity profile\n */\nexport function createEmptyProfile(\n    name: string,\n    activityType: ActivityType,\n    icon: string = ''\n): ActivityProfile {\n    return {\n        id: generateProfileId(),\n        name,\n        activityType,\n        icon,\n        screens: [createEmptyScreen('Main', '')],\n        activeScreenIndex: 0,\n    };\n}\n\n/**\n * Add a slot to a screen\n */\nexport function addSlotToScreen(\n    screen: DataScreen,\n    fieldId: string,\n    size: DataFieldSize = 'medium'\n): DataScreen {\n    const position = screen.slots.length + 1;\n    return {\n        ...screen,\n        slots: [...screen.slots, createSlot(fieldId, size, position)],\n    };\n}\n\n/**\n * Remove a slot from a screen\n */\nexport function removeSlotFromScreen(\n    screen: DataScreen,\n    slotId: string\n): DataScreen {\n    const filteredSlots = screen.slots.filter(s => s.id !== slotId);\n    // Reorder positions\n    const reorderedSlots = filteredSlots.map((slot, index) => ({\n        ...slot,\n        position: index + 1,\n    }));\n    return {\n        ...screen,\n        slots: reorderedSlots,\n    };\n}\n\n/**\n * Update a slot's field or size\n */\nexport function updateSlot(\n    screen: DataScreen,\n    slotId: string,\n    updates: Partial<Pick<DataFieldSlot, 'fieldId' | 'size'>>\n): DataScreen {\n    return {\n        ...screen,\n        slots: screen.slots.map(slot =>\n            slot.id === slotId ? { ...slot, ...updates } : slot\n        ),\n    };\n}\n\n/**\n * Reorder slots in a screen\n */\nexport function reorderSlots(\n    screen: DataScreen,\n    slotIds: string[]\n): DataScreen {\n    const slotMap = new Map(screen.slots.map(s => [s.id, s]));\n    const reorderedSlots = slotIds\n        .map((id, index) => {\n            const slot = slotMap.get(id);\n            if (!slot) return null;\n            return { ...slot, position: index + 1 };\n        })\n        .filter((s): s is DataFieldSlot => s !== null);\n\n    return {\n        ...screen,\n        slots: reorderedSlots,\n    };\n}\n\n/**\n * Add a screen to a profile\n */\nexport function addScreenToProfile(\n    profile: ActivityProfile,\n    screen: DataScreen\n): ActivityProfile {\n    return {\n        ...profile,\n        screens: [...profile.screens, screen],\n    };\n}\n\n/**\n * Remove a screen from a profile\n */\nexport function removeScreenFromProfile(\n    profile: ActivityProfile,\n    screenId: string\n): ActivityProfile {\n    const filteredScreens = profile.screens.filter(s => s.id !== screenId);\n    // Ensure at least one screen exists\n    if (filteredScreens.length === 0) {\n        filteredScreens.push(createEmptyScreen('Main'));\n    }\n    // Adjust active index if needed\n    const activeIndex = Math.min(\n        profile.activeScreenIndex,\n        filteredScreens.length - 1\n    );\n    return {\n        ...profile,\n        screens: filteredScreens,\n        activeScreenIndex: activeIndex,\n    };\n}\n\n/**\n * Get the currently active screen from a profile\n */\nexport function getActiveScreen(profile: ActivityProfile): DataScreen {\n    return profile.screens[profile.activeScreenIndex] || profile.screens[0];\n}\n\n/**\n * Set the active screen index\n */\nexport function setActiveScreenIndex(\n    profile: ActivityProfile,\n    index: number\n): ActivityProfile {\n    const safeIndex = Math.max(0, Math.min(index, profile.screens.length - 1));\n    return {\n        ...profile,\n        activeScreenIndex: safeIndex,\n    };\n}\n\n/**\n * Navigate to next screen\n */\nexport function nextScreen(profile: ActivityProfile): ActivityProfile {\n    const nextIndex = (profile.activeScreenIndex + 1) % profile.screens.length;\n    return setActiveScreenIndex(profile, nextIndex);\n}\n\n/**\n * Navigate to previous screen\n */\nexport function previousScreen(profile: ActivityProfile): ActivityProfile {\n    const prevIndex = profile.activeScreenIndex === 0\n        ? profile.screens.length - 1\n        : profile.activeScreenIndex - 1;\n    return setActiveScreenIndex(profile, prevIndex);\n}\n\n// ============================================================================\n// Validation Functions\n// ============================================================================\n\n/**\n * Validate a data screen configuration\n */\nexport function validateScreen(screen: DataScreen): string[] {\n    const errors: string[] = [];\n\n    if (!screen.id) {\n        errors.push('Screen must have an ID');\n    }\n    if (!screen.name || screen.name.trim().length === 0) {\n        errors.push('Screen must have a name');\n    }\n    if (screen.slots.length === 0) {\n        errors.push('Screen must have at least one data field');\n    }\n    if (screen.slots.length > 12) {\n        errors.push('Screen cannot have more than 12 data fields');\n    }\n\n    // Check for duplicate slot IDs\n    const slotIds = screen.slots.map(s => s.id);\n    const uniqueIds = new Set(slotIds);\n    if (slotIds.length !== uniqueIds.size) {\n        errors.push('Screen has duplicate slot IDs');\n    }\n\n    return errors;\n}\n\n/**\n * Validate an activity profile\n */\nexport function validateProfile(profile: ActivityProfile): string[] {\n    const errors: string[] = [];\n\n    if (!profile.id) {\n        errors.push('Profile must have an ID');\n    }\n    if (!profile.name || profile.name.trim().length === 0) {\n        errors.push('Profile must have a name');\n    }\n    if (profile.screens.length === 0) {\n        errors.push('Profile must have at least one screen');\n    }\n    if (profile.screens.length > 10) {\n        errors.push('Profile cannot have more than 10 screens');\n    }\n    if (profile.activeScreenIndex < 0 || profile.activeScreenIndex >= profile.screens.length) {\n        errors.push('Invalid active screen index');\n    }\n\n    // Validate each screen\n    for (const screen of profile.screens) {\n        const screenErrors = validateScreen(screen);\n        errors.push(...screenErrors.map(e => `Screen \"${screen.name}\": ${e}`));\n    }\n\n    return errors;\n}\n","/**\n * Data Field Registry\n * \n * Central registry for all data field definitions.\n * Provides lookup, filtering, and category organization.\n * \n * @module data-fields/registry\n */\n\nimport type {\n    DataFieldDefinition,\n    DataFieldCategory,\n    CategoryInfo,\n} from './types.js';\nimport { CATEGORY_INFO } from './types.js';\n\n// ============================================================================\n// Registry Storage\n// ============================================================================\n\n/** Central registry of all data fields */\nconst DATA_FIELD_REGISTRY: Map<string, DataFieldDefinition> = new Map();\n\n/** Track registration order for consistent iteration */\nconst registrationOrder: string[] = [];\n\n// ============================================================================\n// Registration Functions\n// ============================================================================\n\n/**\n * Register a new data field definition\n * @param field - The field definition to register\n * @throws Error if field with same ID already exists\n */\nexport function registerDataField(field: DataFieldDefinition): void {\n    if (DATA_FIELD_REGISTRY.has(field.id)) {\n        console.warn(`Data field '${field.id}' is already registered. Skipping duplicate.`);\n        return;\n    }\n\n    // Validate required properties\n    if (!field.id || !field.name || !field.category || !field.formatter) {\n        throw new Error(`Invalid data field definition: missing required properties for '${field.id}'`);\n    }\n\n    DATA_FIELD_REGISTRY.set(field.id, field);\n    registrationOrder.push(field.id);\n}\n\n/**\n * Register multiple data fields at once\n * @param fields - Array of field definitions\n */\nexport function registerDataFields(fields: DataFieldDefinition[]): void {\n    for (const field of fields) {\n        registerDataField(field);\n    }\n}\n\n/**\n * Unregister a data field (for testing or dynamic removal)\n * @param fieldId - The field ID to remove\n */\nexport function unregisterDataField(fieldId: string): boolean {\n    const removed = DATA_FIELD_REGISTRY.delete(fieldId);\n    if (removed) {\n        const index = registrationOrder.indexOf(fieldId);\n        if (index > -1) {\n            registrationOrder.splice(index, 1);\n        }\n    }\n    return removed;\n}\n\n/**\n * Clear all registered fields (for testing)\n */\nexport function clearRegistry(): void {\n    DATA_FIELD_REGISTRY.clear();\n    registrationOrder.length = 0;\n}\n\n// ============================================================================\n// Lookup Functions\n// ============================================================================\n\n/**\n * Get a data field by ID\n * @param id - The field ID to look up\n * @returns The field definition or undefined\n */\nexport function getDataField(id: string): DataFieldDefinition | undefined {\n    return DATA_FIELD_REGISTRY.get(id);\n}\n\n/**\n * Check if a field exists\n * @param id - The field ID to check\n */\nexport function hasDataField(id: string): boolean {\n    return DATA_FIELD_REGISTRY.has(id);\n}\n\n/**\n * Get all registered data fields\n * @returns Array of all field definitions in registration order\n */\nexport function getAllDataFields(): DataFieldDefinition[] {\n    return registrationOrder.map(id => DATA_FIELD_REGISTRY.get(id)!);\n}\n\n/**\n * Get the total count of registered fields\n */\nexport function getFieldCount(): number {\n    return DATA_FIELD_REGISTRY.size;\n}\n\n// ============================================================================\n// Category Functions\n// ============================================================================\n\n/**\n * Get all fields in a specific category\n * @param category - The category to filter by\n * @returns Array of field definitions in that category\n */\nexport function getFieldsByCategory(category: DataFieldCategory): DataFieldDefinition[] {\n    return getAllDataFields().filter(f => f.category === category);\n}\n\n/**\n * Get all categories that have registered fields\n * @returns Map of category to field definitions\n */\nexport function getAllCategories(): Map<DataFieldCategory, DataFieldDefinition[]> {\n    const categories = new Map<DataFieldCategory, DataFieldDefinition[]>();\n\n    for (const field of getAllDataFields()) {\n        const list = categories.get(field.category) || [];\n        list.push(field);\n        categories.set(field.category, list);\n    }\n\n    return categories;\n}\n\n/**\n * Get category info with field counts\n * @returns Array of categories with their field counts\n */\nexport function getCategoriesWithCounts(): Array<CategoryInfo & { count: number }> {\n    const categoryMap = getAllCategories();\n\n    return Object.values(CATEGORY_INFO).map((info) => ({\n        ...info,\n        count: categoryMap.get(info.id)?.length || 0,\n    })).filter(c => c.count > 0);\n}\n\n// ============================================================================\n// Filtering Functions\n// ============================================================================\n\n/**\n * Get fields that require specific sensors\n * @param sensorType - The sensor type ('power', 'heartrate', 'cadence', 'gps')\n */\nexport function getFieldsRequiringSensor(sensorType: string): DataFieldDefinition[] {\n    return getAllDataFields().filter(f =>\n        f.requiresSensor?.includes(sensorType)\n    );\n}\n\n/**\n * Get fields that require GPS\n */\nexport function getFieldsRequiringGps(): DataFieldDefinition[] {\n    return getAllDataFields().filter(f => f.requiresGps === true);\n}\n\n/**\n * Get fields that are always available (no sensor requirements)\n */\nexport function getAlwaysAvailableFields(): DataFieldDefinition[] {\n    return getAllDataFields().filter(f =>\n        !f.requiresSensor?.length && !f.requiresGps\n    );\n}\n\n/**\n * Get calculated fields (have a calculator function)\n */\nexport function getCalculatedFields(): DataFieldDefinition[] {\n    return getAllDataFields().filter(f => f.calculator !== undefined);\n}\n\n/**\n * Get real-time sensor fields (direct from sensors)\n */\nexport function getSensorFields(): DataFieldDefinition[] {\n    return getAllDataFields().filter(f => f.sourceType === 'sensor');\n}\n\n/**\n * Get fields that require an active workout\n */\nexport function getFieldsRequiringWorkout(): DataFieldDefinition[] {\n    return getAllDataFields().filter(f => f.requiresWorkoutActive === true);\n}\n\n/**\n * Get fields by their IDs\n */\nexport function getFieldsByIds(ids: string[]): DataFieldDefinition[] {\n    return ids\n        .map(id => getDataField(id))\n        .filter((f): f is DataFieldDefinition => f !== undefined);\n}\n\n// ============================================================================\n// Search Functions\n// ============================================================================\n\n/**\n * Search fields by name or description\n * @param query - Search query string\n * @returns Matching field definitions\n */\nexport function searchFields(query: string): DataFieldDefinition[] {\n    const lowerQuery = query.toLowerCase().trim();\n    if (!lowerQuery) {\n        return getAllDataFields();\n    }\n\n    return getAllDataFields().filter(f =>\n        f.name.toLowerCase().includes(lowerQuery) ||\n        f.shortName.toLowerCase().includes(lowerQuery) ||\n        f.description.toLowerCase().includes(lowerQuery) ||\n        f.id.toLowerCase().includes(lowerQuery)\n    );\n}\n\n// ============================================================================\n// Validation Functions\n// ============================================================================\n\n/**\n * Validate a field ID exists\n * @param fieldId - The field ID to validate\n * @throws Error if field doesn't exist\n */\nexport function validateFieldId(fieldId: string): DataFieldDefinition {\n    const field = getDataField(fieldId);\n    if (!field) {\n        throw new Error(`Unknown data field: '${fieldId}'`);\n    }\n    return field;\n}\n\n/**\n * Validate multiple field IDs\n * @param fieldIds - Array of field IDs to validate\n * @returns Array of valid field definitions\n */\nexport function validateFieldIds(fieldIds: string[]): DataFieldDefinition[] {\n    return fieldIds.map(id => validateFieldId(id));\n}\n\n// ============================================================================\n// Debug/Development Helpers\n// ============================================================================\n\n/**\n * Get registry statistics for debugging\n */\nexport function getRegistryStats(): {\n    totalFields: number;\n    byCategory: Record<string, number>;\n    bySensor: Record<string, number>;\n    calculated: number;\n    gpsRequired: number;\n} {\n    const fields = getAllDataFields();\n\n    const byCategory: Record<string, number> = {};\n    const bySensor: Record<string, number> = {};\n    let calculated = 0;\n    let gpsRequired = 0;\n\n    for (const field of fields) {\n        // Count by category\n        byCategory[field.category] = (byCategory[field.category] || 0) + 1;\n\n        // Count by required sensor\n        for (const sensor of field.requiresSensor || []) {\n            bySensor[sensor] = (bySensor[sensor] || 0) + 1;\n        }\n\n        // Count calculated\n        if (field.calculator) {\n            calculated++;\n        }\n\n        // Count GPS required\n        if (field.requiresGps) {\n            gpsRequired++;\n        }\n    }\n\n    return {\n        totalFields: fields.length,\n        byCategory,\n        bySensor,\n        calculated,\n        gpsRequired,\n    };\n}\n\n/**\n * Log registry contents for debugging\n */\nexport function debugLogRegistry(): void {\n    const stats = getRegistryStats();\n    console.group(' Data Field Registry');\n    console.log(`Total fields: ${stats.totalFields}`);\n    console.log('By category:', stats.byCategory);\n    console.log('By sensor:', stats.bySensor);\n    console.log(`Calculated fields: ${stats.calculated}`);\n    console.log(`GPS required: ${stats.gpsRequired}`);\n    console.groupEnd();\n}\n","/**\n * Common Calculator Functions\n * \n * Shared calculation utilities used across multiple data field definitions.\n * \n * @module data-fields/calculators/common\n */\n\nimport type { ZoneConfig, ZoneColor } from '../types.js';\n\n// ============================================================================\n// Rolling Average Calculations\n// ============================================================================\n\n/**\n * Generic measurement with timestamp and value\n */\ninterface TimestampedValue {\n    timestamp: number;\n    value: number;\n}\n\n/**\n * Calculate rolling average for a measurement array over a time window\n * @param measurements - Array of timestamped measurements\n * @param windowMs - Time window in milliseconds\n * @param referenceTime - Reference time (defaults to Date.now())\n * @returns Average value or null if no data in window\n */\nexport function calculateRollingAverage(\n    measurements: TimestampedValue[],\n    windowMs: number,\n    referenceTime: number = Date.now()\n): number | null {\n    if (measurements.length === 0) return null;\n\n    const windowStart = referenceTime - windowMs;\n    const windowValues = measurements.filter(m => m.timestamp >= windowStart);\n\n    if (windowValues.length === 0) return null;\n\n    const sum = windowValues.reduce((acc, m) => acc + m.value, 0);\n    return sum / windowValues.length;\n}\n\n/**\n * Calculate weighted rolling average (more recent values weighted higher)\n * @param measurements - Array of timestamped measurements\n * @param windowMs - Time window in milliseconds\n * @param referenceTime - Reference time (defaults to Date.now())\n * @returns Weighted average or null if no data\n */\nexport function calculateWeightedRollingAverage(\n    measurements: TimestampedValue[],\n    windowMs: number,\n    referenceTime: number = Date.now()\n): number | null {\n    if (measurements.length === 0) return null;\n\n    const windowStart = referenceTime - windowMs;\n    const windowValues = measurements.filter(m => m.timestamp >= windowStart);\n\n    if (windowValues.length === 0) return null;\n\n    let weightedSum = 0;\n    let totalWeight = 0;\n\n    for (const m of windowValues) {\n        // Weight increases as we get closer to reference time\n        const age = referenceTime - m.timestamp;\n        const weight = 1 - (age / windowMs);\n        weightedSum += m.value * weight;\n        totalWeight += weight;\n    }\n\n    return totalWeight > 0 ? weightedSum / totalWeight : null;\n}\n\n// ============================================================================\n// Aggregate Calculations\n// ============================================================================\n\n/**\n * Calculate average of all measurements\n * @param measurements - Array of timestamped measurements\n * @returns Average value or null if empty\n */\nexport function calculateAverage(measurements: TimestampedValue[]): number | null {\n    if (measurements.length === 0) return null;\n    const sum = measurements.reduce((acc, m) => acc + m.value, 0);\n    return sum / measurements.length;\n}\n\n/**\n * Calculate maximum value\n * @param measurements - Array of timestamped measurements\n * @returns Maximum value or null if empty\n */\nexport function calculateMax(measurements: TimestampedValue[]): number | null {\n    if (measurements.length === 0) return null;\n    return Math.max(...measurements.map(m => m.value));\n}\n\n/**\n * Calculate minimum value\n * @param measurements - Array of timestamped measurements\n * @returns Minimum value or null if empty\n */\nexport function calculateMin(measurements: TimestampedValue[]): number | null {\n    if (measurements.length === 0) return null;\n    return Math.min(...measurements.map(m => m.value));\n}\n\n/**\n * Get the most recent value\n * @param measurements - Array of timestamped measurements\n * @param maxAge - Maximum age in ms (default 5000ms)\n * @returns Most recent value or null if stale/empty\n */\nexport function getLatestValue(\n    measurements: TimestampedValue[],\n    maxAge: number = 5000\n): number | null {\n    if (measurements.length === 0) return null;\n\n    const latest = measurements[measurements.length - 1];\n    const age = Date.now() - latest.timestamp;\n\n    return age <= maxAge ? latest.value : null;\n}\n\n// ============================================================================\n// Zone Calculations\n// ============================================================================\n\n/**\n * Determine which zone a value falls into\n * @param value - The value to check\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @param zones - Zone configuration array\n * @returns Zone number (1-based) or null\n */\nexport function getZoneForValue(\n    value: number | null,\n    referenceValue: number | null,\n    zones: ZoneConfig[]\n): number | null {\n    if (value === null || referenceValue === null || referenceValue <= 0) {\n        return null;\n    }\n\n    const percent = (value / referenceValue) * 100;\n\n    for (const zone of zones) {\n        if (percent >= zone.minPercent && percent < zone.maxPercent) {\n            return zone.zone;\n        }\n    }\n\n    // Check if above highest zone\n    const highestZone = zones[zones.length - 1];\n    if (highestZone && percent >= highestZone.minPercent) {\n        return highestZone.zone;\n    }\n\n    return null;\n}\n\n/**\n * Get zone info including color for a value\n * @param value - The value to check\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @param zones - Zone configuration array\n * @returns ZoneColor object or null\n */\nexport function getZoneColor(\n    value: number | null,\n    referenceValue: number | null,\n    zones: ZoneConfig[]\n): ZoneColor | null {\n    const zoneNum = getZoneForValue(value, referenceValue, zones);\n    if (zoneNum === null) return null;\n\n    const zoneConfig = zones.find(z => z.zone === zoneNum);\n    if (!zoneConfig) return null;\n\n    // Generate colors based on zone color\n    return {\n        zone: zoneNum,\n        zoneName: zoneConfig.name,\n        bg: hexToRgba(zoneConfig.color, 0.15),\n        text: darkenColor(zoneConfig.color, 20),\n        border: zoneConfig.color,\n    };\n}\n\n/**\n * Calculate percentage of reference value\n * @param value - Current value\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @returns Percentage or null\n */\nexport function calculatePercentOfReference(\n    value: number | null,\n    referenceValue: number | null\n): number | null {\n    if (value === null || referenceValue === null || referenceValue <= 0) {\n        return null;\n    }\n    return (value / referenceValue) * 100;\n}\n\n// ============================================================================\n// Time-based Calculations\n// ============================================================================\n\n/**\n * Calculate time in each zone\n * @param measurements - Array of timestamped measurements\n * @param referenceValue - Reference value (FTP or MaxHR)\n * @param zones - Zone configuration array\n * @returns Map of zone number to time in milliseconds\n */\nexport function calculateTimeInZones(\n    measurements: TimestampedValue[],\n    referenceValue: number | null,\n    zones: ZoneConfig[]\n): Map<number, number> {\n    const timeInZones = new Map<number, number>();\n\n    // Initialize all zones to 0\n    for (const zone of zones) {\n        timeInZones.set(zone.zone, 0);\n    }\n\n    if (measurements.length < 2 || referenceValue === null) {\n        return timeInZones;\n    }\n\n    // Calculate time between each measurement and assign to zone\n    for (let i = 1; i < measurements.length; i++) {\n        const prev = measurements[i - 1];\n        const curr = measurements[i];\n        const timeDelta = curr.timestamp - prev.timestamp;\n\n        // Use average value for the interval\n        const avgValue = (prev.value + curr.value) / 2;\n        const zone = getZoneForValue(avgValue, referenceValue, zones);\n\n        if (zone !== null) {\n            const current = timeInZones.get(zone) || 0;\n            timeInZones.set(zone, current + timeDelta);\n        }\n    }\n\n    return timeInZones;\n}\n\n// ============================================================================\n// Color Utilities\n// ============================================================================\n\n/**\n * Convert hex color to rgba\n * @param hex - Hex color string\n * @param alpha - Alpha value (0-1)\n * @returns RGBA color string\n */\nexport function hexToRgba(hex: string, alpha: number): string {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (!result) return hex;\n\n    const r = parseInt(result[1], 16);\n    const g = parseInt(result[2], 16);\n    const b = parseInt(result[3], 16);\n\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n}\n\n/**\n * Darken a hex color\n * @param hex - Hex color string\n * @param percent - Percentage to darken (0-100)\n * @returns Darkened hex color\n */\nexport function darkenColor(hex: string, percent: number): string {\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n    if (!result) return hex;\n\n    const factor = 1 - percent / 100;\n    const r = Math.round(parseInt(result[1], 16) * factor);\n    const g = Math.round(parseInt(result[2], 16) * factor);\n    const b = Math.round(parseInt(result[3], 16) * factor);\n\n    return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;\n}\n\n// ============================================================================\n// Format Utilities\n// ============================================================================\n\n/**\n * Format a duration in milliseconds to HH:MM:SS or MM:SS\n * @param ms - Duration in milliseconds\n * @param showHours - Force showing hours even if < 1 hour\n * @returns Formatted time string\n */\nexport function formatDuration(ms: number, showHours: boolean = false): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    if (hours > 0 || showHours) {\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    }\n\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format pace (min/km or min/mi)\n * @param speedMs - Speed in meters per second\n * @param imperial - Use imperial units (miles)\n * @returns Formatted pace string (e.g., \"5:30\")\n */\nexport function formatPace(speedMs: number | null, imperial: boolean = false): string {\n    if (speedMs === null || speedMs <= 0) return '--:--';\n\n    // Convert m/s to seconds per km or mile\n    const metersPerUnit = imperial ? 1609.344 : 1000;\n    const secondsPerUnit = metersPerUnit / speedMs;\n\n    const minutes = Math.floor(secondsPerUnit / 60);\n    const seconds = Math.floor(secondsPerUnit % 60);\n\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format distance\n * @param meters - Distance in meters\n * @param imperial - Use imperial units (miles)\n * @param decimals - Number of decimal places\n * @returns Formatted distance string\n */\nexport function formatDistance(\n    meters: number | null,\n    imperial: boolean = false,\n    decimals: number = 2\n): string {\n    if (meters === null) return '--';\n\n    const value = imperial ? meters / 1609.344 : meters / 1000;\n    return value.toFixed(decimals);\n}\n\n/**\n * Format speed\n * @param speedMs - Speed in meters per second\n * @param imperial - Use imperial units (mph)\n * @param decimals - Number of decimal places\n * @returns Formatted speed string\n */\nexport function formatSpeed(\n    speedMs: number | null,\n    imperial: boolean = false,\n    decimals: number = 1\n): string {\n    if (speedMs === null) return '--';\n\n    // Convert m/s to km/h or mph\n    const factor = imperial ? 2.23694 : 3.6;\n    const value = speedMs * factor;\n\n    return value.toFixed(decimals);\n}\n\n/**\n * Format altitude/elevation\n * @param meters - Altitude in meters\n * @param imperial - Use imperial units (feet)\n * @param decimals - Number of decimal places\n * @returns Formatted altitude string\n */\nexport function formatAltitude(\n    meters: number | null,\n    imperial: boolean = false,\n    decimals: number = 0\n): string {\n    if (meters === null) return '--';\n\n    const value = imperial ? meters * 3.28084 : meters;\n    return value.toFixed(decimals);\n}\n\n// ============================================================================\n// Validation Utilities\n// ============================================================================\n\n/**\n * Clamp a value between min and max\n * @param value - Value to clamp\n * @param min - Minimum value\n * @param max - Maximum value\n * @returns Clamped value\n */\nexport function clamp(value: number, min: number, max: number): number {\n    return Math.min(Math.max(value, min), max);\n}\n\n/**\n * Check if a value is within a valid range\n * @param value - Value to check\n * @param min - Minimum valid value\n * @param max - Maximum valid value\n * @returns True if valid\n */\nexport function isValidValue(value: number | null, min: number, max: number): boolean {\n    if (value === null) return false;\n    return value >= min && value <= max;\n}\n","/**\n * Default Screen Configurations\n * \n * Pre-configured data screens and activity profiles for common use cases.\n * Users can use these as starting points and customize them.\n * \n * @module data-fields/defaults\n */\n\nimport type {\n    DataScreen,\n    DataFieldSlot,\n    ActivityProfile,\n    DataFieldSettings,\n} from './screens.js';\n\n// ============================================================================\n// Helper to create slots\n// ============================================================================\n\nlet slotCounter = 0;\n\nfunction slot(\n    fieldId: string,\n    size: 'small' | 'medium' | 'large' = 'medium'\n): DataFieldSlot {\n    slotCounter++;\n    return {\n        id: `default-slot-${slotCounter}`,\n        fieldId,\n        size,\n        position: slotCounter,\n    };\n}\n\nfunction resetSlotCounter(): void {\n    slotCounter = 0;\n}\n\n// ============================================================================\n// Default Cycling Screens\n// ============================================================================\n\n/** Main cycling screen - overview of key metrics */\nfunction createCyclingMainScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-main',\n        name: 'Main',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('heartrate-current', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('speed-current', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n}\n\n/** Power-focused screen for training */\nfunction createCyclingPowerScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-power',\n        name: 'Power',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('power-3s', 'medium'),\n            slot('power-avg', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('power-max', 'medium'),\n            slot('power-zone', 'medium'),\n        ],\n    };\n}\n\n/** Heart rate focused screen */\nfunction createCyclingHrScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-hr',\n        name: 'Heart Rate',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('heartrate-current', 'large'),\n            slot('heartrate-avg', 'medium'),\n            slot('heartrate-max', 'medium'),\n            slot('heartrate-zone', 'medium'),\n            slot('heartrate-percent-max', 'medium'),\n            slot('calories-burned', 'medium'),\n        ],\n    };\n}\n\n/** Climbing/elevation focused screen */\nfunction createCyclingClimbScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-climb',\n        name: 'Climbing',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('grade-current', 'large'),\n            slot('elevation-current', 'medium'),\n            slot('elevation-gain', 'medium'),\n            slot('elevation-loss', 'medium'),\n            slot('vertical-speed', 'medium'),\n            slot('power-current', 'medium'),\n        ],\n    };\n}\n\n/** Lap-focused screen */\nfunction createCyclingLapScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-laps',\n        name: 'Laps',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('time-lap-number', 'medium'),\n            slot('time-lap', 'large'),\n            slot('distance-lap', 'medium'),\n            slot('power-lap-avg', 'medium'),\n            slot('hr-lap-avg', 'medium'),\n            slot('speed-lap-avg', 'medium'),\n        ],\n    };\n}\n\n/** Minimal screen for casual riding */\nfunction createCyclingSimpleScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-simple',\n        name: 'Simple',\n        icon: '',\n        layout: 'grid-2',\n        slots: [\n            slot('speed-current', 'large'),\n            slot('distance-total', 'large'),\n            slot('time-elapsed', 'large'),\n            slot('elevation-gain', 'large'),\n        ],\n    };\n}\n\n// ============================================================================\n// Default Indoor/Trainer Screens\n// ============================================================================\n\n/** Main indoor training screen */\nfunction createIndoorMainScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-main',\n        name: 'Main',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('heartrate-current', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('time-elapsed', 'medium'),\n            slot('power-avg', 'medium'),\n            slot('kilojoules', 'medium'),\n        ],\n    };\n}\n\n/** Indoor power screen */\nfunction createIndoorPowerScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-power',\n        name: 'Power',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('power-3s', 'medium'),\n            slot('power-10s', 'medium'),\n            slot('power-30s', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('intensity-factor', 'medium'),\n        ],\n    };\n}\n\n/** TSS/training load screen */\nfunction createIndoorTrainingScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-training',\n        name: 'Training',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('tss', 'large'),\n            slot('intensity-factor', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('kilojoules', 'medium'),\n            slot('time-elapsed', 'medium'),\n            slot('power-avg', 'medium'),\n        ],\n    };\n}\n\n/** Zone-focused screen for structured training */\nfunction createIndoorZonesScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-zones',\n        name: 'Zones',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-zone', 'large'),\n            slot('heartrate-zone', 'large'),\n            slot('power-percent-ftp', 'medium'),\n            slot('heartrate-percent-max', 'medium'),\n            slot('cadence-zone', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n}\n\n// ============================================================================\n// Default Running Screens\n// ============================================================================\n\n/** Main running screen */\nfunction createRunningMainScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'running-main',\n        name: 'Main',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('pace-current', 'large'),\n            slot('heartrate-current', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('time-elapsed', 'medium'),\n            slot('pace-avg', 'medium'),\n        ],\n    };\n}\n\n/** Running pace screen */\nfunction createRunningPaceScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'running-pace',\n        name: 'Pace',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('pace-current', 'large'),\n            slot('pace-avg', 'medium'),\n            slot('speed-current', 'medium'),\n            slot('speed-avg', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n}\n\n// ============================================================================\n// Default Activity Profiles\n// ============================================================================\n\n/** Default outdoor cycling profile */\nexport const DEFAULT_CYCLING_PROFILE: ActivityProfile = {\n    id: 'default-cycling',\n    name: 'Outdoor Cycling',\n    activityType: 'cycling',\n    icon: '',\n    screens: [\n        createCyclingMainScreen(),\n        createCyclingPowerScreen(),\n        createCyclingHrScreen(),\n        createCyclingClimbScreen(),\n        createCyclingLapScreen(),\n    ],\n    activeScreenIndex: 0,\n};\n\n/** Default indoor/trainer profile */\nexport const DEFAULT_INDOOR_PROFILE: ActivityProfile = {\n    id: 'default-indoor',\n    name: 'Indoor Training',\n    activityType: 'indoor',\n    icon: '',\n    screens: [\n        createIndoorMainScreen(),\n        createIndoorPowerScreen(),\n        createIndoorTrainingScreen(),\n        createIndoorZonesScreen(),\n    ],\n    activeScreenIndex: 0,\n};\n\n/** Default running profile */\nexport const DEFAULT_RUNNING_PROFILE: ActivityProfile = {\n    id: 'default-running',\n    name: 'Running',\n    activityType: 'running',\n    icon: '',\n    screens: [\n        createRunningMainScreen(),\n        createRunningPaceScreen(),\n    ],\n    activeScreenIndex: 0,\n};\n\n/** Simple cycling profile for casual users */\nexport const DEFAULT_SIMPLE_PROFILE: ActivityProfile = {\n    id: 'default-simple',\n    name: 'Simple',\n    activityType: 'cycling',\n    icon: '',\n    screens: [\n        createCyclingSimpleScreen(),\n    ],\n    activeScreenIndex: 0,\n};\n\n// ============================================================================\n// All Default Profiles\n// ============================================================================\n\n/** All default profiles */\nexport const DEFAULT_PROFILES: ActivityProfile[] = [\n    DEFAULT_CYCLING_PROFILE,\n    DEFAULT_INDOOR_PROFILE,\n    DEFAULT_RUNNING_PROFILE,\n    DEFAULT_SIMPLE_PROFILE,\n];\n\n// ============================================================================\n// Default Settings\n// ============================================================================\n\n/** Default data field settings for new users */\nexport const DEFAULT_DATA_FIELD_SETTINGS: DataFieldSettings = {\n    profiles: [\n        // Clone the default profiles so users can modify them\n        JSON.parse(JSON.stringify(DEFAULT_CYCLING_PROFILE)),\n        JSON.parse(JSON.stringify(DEFAULT_INDOOR_PROFILE)),\n    ],\n    activeProfileId: 'default-cycling',\n    unitSystem: 'metric',\n    fieldPreferences: {},\n    version: 1,\n};\n\n// ============================================================================\n// Profile Factory Functions\n// ============================================================================\n\n/**\n * Create a fresh copy of the default cycling profile\n */\nexport function createDefaultCyclingProfile(): ActivityProfile {\n    return JSON.parse(JSON.stringify(DEFAULT_CYCLING_PROFILE));\n}\n\n/**\n * Create a fresh copy of the default indoor profile\n */\nexport function createDefaultIndoorProfile(): ActivityProfile {\n    return JSON.parse(JSON.stringify(DEFAULT_INDOOR_PROFILE));\n}\n\n/**\n * Create a fresh copy of the default running profile\n */\nexport function createDefaultRunningProfile(): ActivityProfile {\n    return JSON.parse(JSON.stringify(DEFAULT_RUNNING_PROFILE));\n}\n\n/**\n * Get a default profile by activity type\n */\nexport function getDefaultProfileForActivity(activityType: string): ActivityProfile {\n    switch (activityType) {\n        case 'cycling':\n            return createDefaultCyclingProfile();\n        case 'indoor':\n            return createDefaultIndoorProfile();\n        case 'running':\n            return createDefaultRunningProfile();\n        default:\n            return createDefaultCyclingProfile();\n    }\n}\n\n/**\n * Create default settings for a new user\n */\nexport function createDefaultSettings(): DataFieldSettings {\n    return JSON.parse(JSON.stringify(DEFAULT_DATA_FIELD_SETTINGS));\n}\n\n// ============================================================================\n// Migration from Legacy Settings\n// ============================================================================\n\n/**\n * Legacy settings structure (for migration)\n */\ninterface LegacyDisplaySettings {\n    power?: boolean;\n    cadence?: boolean;\n    heartrate?: boolean;\n    speed?: boolean;\n    distance?: boolean;\n    altitude?: boolean;\n}\n\n/**\n * Migrate from legacy display settings to new data field settings\n */\nexport function migrateFromLegacySettings(\n    legacySettings: LegacyDisplaySettings\n): DataFieldSettings {\n    resetSlotCounter();\n\n    // Build slots based on which fields were enabled\n    const slots: DataFieldSlot[] = [];\n\n    if (legacySettings.power !== false) {\n        slots.push(slot('power-current', 'large'));\n    }\n    if (legacySettings.heartrate !== false) {\n        slots.push(slot('heartrate-current', 'medium'));\n    }\n    if (legacySettings.cadence !== false) {\n        slots.push(slot('cadence-current', 'medium'));\n    }\n    if (legacySettings.speed !== false) {\n        slots.push(slot('speed-current', 'medium'));\n    }\n    if (legacySettings.distance !== false) {\n        slots.push(slot('distance-total', 'medium'));\n    }\n    if (legacySettings.altitude !== false) {\n        slots.push(slot('elevation-current', 'medium'));\n    }\n\n    // If no fields were enabled, use defaults\n    if (slots.length === 0) {\n        return createDefaultSettings();\n    }\n\n    // Create a migrated profile\n    const migratedProfile: ActivityProfile = {\n        id: 'migrated-profile',\n        name: 'Migrated',\n        activityType: 'cycling',\n        icon: '',\n        screens: [\n            {\n                id: 'migrated-main',\n                name: 'Main',\n                icon: '',\n                layout: 'auto',\n                slots: slots.map((s, i) => ({ ...s, position: i + 1 })),\n            },\n        ],\n        activeScreenIndex: 0,\n    };\n\n    return {\n        profiles: [migratedProfile, createDefaultIndoorProfile()],\n        activeProfileId: 'migrated-profile',\n        unitSystem: 'metric',\n        fieldPreferences: {},\n        version: 1,\n    };\n}\n\n// ============================================================================\n// Quick Presets\n// ============================================================================\n\n/** Quick preset: Power-focused 6-field screen */\nexport const PRESET_POWER_FOCUS: DataScreen = (() => {\n    resetSlotCounter();\n    return {\n        id: 'preset-power',\n        name: 'Power Focus',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-3s', 'large'),\n            slot('power-avg', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('watts-per-kg', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('heartrate-current', 'medium'),\n        ],\n    };\n})();\n\n/** Quick preset: Endurance ride */\nexport const PRESET_ENDURANCE: DataScreen = (() => {\n    resetSlotCounter();\n    return {\n        id: 'preset-endurance',\n        name: 'Endurance',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('heartrate-zone', 'large'),\n            slot('time-elapsed', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('speed-avg', 'medium'),\n            slot('elevation-gain', 'medium'),\n            slot('calories-burned', 'medium'),\n        ],\n    };\n})();\n\n/** Quick preset: Interval training */\nexport const PRESET_INTERVALS: DataScreen = (() => {\n    resetSlotCounter();\n    return {\n        id: 'preset-intervals',\n        name: 'Intervals',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('time-lap', 'large'),\n            slot('power-lap-avg', 'medium'),\n            slot('heartrate-current', 'medium'),\n            slot('time-lap-number', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n})();\n\n/** All quick presets */\nexport const SCREEN_PRESETS: DataScreen[] = [\n    PRESET_POWER_FOCUS,\n    PRESET_ENDURANCE,\n    PRESET_INTERVALS,\n];\n","/**\n * Calculation Manager\n * \n * Manages the calculation and updates of derived data fields.\n * Handles update scheduling based on field requirements and\n * efficiently batches calculations to minimize performance impact.\n * \n * @module data-fields/CalculationManager\n */\n\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type {\n    DataFieldDefinition,\n    WorkoutState,\n    UserSettings,\n    UpdateFrequency,\n} from './types.js';\nimport { getAllDataFields, getDataField } from './registry.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Callback for field value updates */\nexport type FieldUpdateCallback = (fieldId: string, value: number | null) => void;\n\n/** Configuration for the calculation manager */\nexport interface CalculationManagerConfig {\n    /** Enable/disable real-time updates (default: true) */\n    enableRealtime?: boolean;\n    /** Override update intervals in ms (for testing) */\n    updateIntervals?: Partial<Record<UpdateFrequency, number>>;\n}\n\n/** Field calculation result */\ninterface CalculationResult {\n    fieldId: string;\n    value: number | null;\n    timestamp: number;\n}\n\n// ============================================================================\n// Default Update Intervals\n// ============================================================================\n\nconst DEFAULT_UPDATE_INTERVALS: Record<UpdateFrequency, number> = {\n    realtime: 100,    // 10Hz - for critical real-time data\n    second: 1000,     // 1Hz - once per second\n    periodic: 5000,   // Every 5 seconds\n    'on-change': 0,   // Manual trigger only\n    manual: 0,        // Manual trigger only\n};\n\n// ============================================================================\n// Calculation Manager Class\n// ============================================================================\n\n/**\n * Manages calculated data field updates\n * \n * The CalculationManager schedules and executes calculations for\n * derived data fields (NP, TSS, rolling averages, etc.) based on\n * their update frequency requirements.\n * \n * @example\n * ```typescript\n * const manager = new CalculationManager(measurements, workoutState, settings);\n * manager.onUpdate((fieldId, value) => {\n *     updateUIField(fieldId, value);\n * });\n * manager.start();\n * // ... during workout ...\n * manager.stop();\n * ```\n */\nexport class CalculationManager {\n    private calculatedValues: Map<string, number | null> = new Map();\n    private updateTimers: Map<UpdateFrequency, number> = new Map();\n    private listeners: Set<FieldUpdateCallback> = new Set();\n    private isRunning = false;\n    private config: Required<CalculationManagerConfig>;\n    private fieldsByFrequency: Map<UpdateFrequency, DataFieldDefinition[]> = new Map();\n\n    constructor(\n        private measurements: MeasurementsState,\n        private workoutState: WorkoutState,\n        private settings: UserSettings,\n        config: CalculationManagerConfig = {}\n    ) {\n        this.config = {\n            enableRealtime: config.enableRealtime ?? true,\n            updateIntervals: {\n                ...DEFAULT_UPDATE_INTERVALS,\n                ...config.updateIntervals,\n            },\n        };\n\n        this.categorizeFieldsByFrequency();\n    }\n\n    // ========================================================================\n    // Lifecycle Methods\n    // ========================================================================\n\n    /**\n     * Start the calculation manager\n     * \n     * Sets up update timers for each frequency group and begins\n     * calculating field values.\n     */\n    public start(): void {\n        if (this.isRunning) return;\n        this.isRunning = true;\n\n        // Initial calculation of all fields\n        this.calculateAllFields();\n\n        // Set up timers for each frequency\n        for (const [frequency, fields] of this.fieldsByFrequency) {\n            if (fields.length === 0) continue;\n\n            const interval = this.config.updateIntervals[frequency];\n            if (interval === undefined || interval <= 0) continue; // Skip manual/on-change\n\n            // Skip realtime if disabled\n            if (frequency === 'realtime' && !this.config.enableRealtime) continue;\n\n            const timerId = window.setInterval(() => {\n                this.calculateFieldsForFrequency(frequency);\n            }, interval);\n\n            this.updateTimers.set(frequency, timerId);\n        }\n    }\n\n    /**\n     * Stop the calculation manager\n     * \n     * Clears all update timers and stops calculations.\n     */\n    public stop(): void {\n        if (!this.isRunning) return;\n        this.isRunning = false;\n\n        // Clear all timers\n        for (const timerId of this.updateTimers.values()) {\n            clearInterval(timerId);\n        }\n        this.updateTimers.clear();\n    }\n\n    /**\n     * Pause calculations temporarily\n     */\n    public pause(): void {\n        this.stop();\n    }\n\n    /**\n     * Resume calculations after pause\n     */\n    public resume(): void {\n        if (!this.isRunning) {\n            this.start();\n        }\n    }\n\n    /**\n     * Check if the manager is currently running\n     */\n    public isActive(): boolean {\n        return this.isRunning;\n    }\n\n    // ========================================================================\n    // Update Methods\n    // ========================================================================\n\n    /**\n     * Update the measurements state reference\n     * \n     * Call this when the measurements state is replaced or updated.\n     */\n    public updateMeasurements(measurements: MeasurementsState): void {\n        this.measurements = measurements;\n    }\n\n    /**\n     * Update the workout state reference\n     */\n    public updateWorkoutState(workoutState: WorkoutState): void {\n        this.workoutState = workoutState;\n    }\n\n    /**\n     * Update user settings\n     */\n    public updateSettings(settings: UserSettings): void {\n        this.settings = settings;\n        // Recalculate all fields when settings change\n        if (this.isRunning) {\n            this.calculateAllFields();\n        }\n    }\n\n    // ========================================================================\n    // Event Handling\n    // ========================================================================\n\n    /**\n     * Register a callback for field updates\n     * \n     * @param callback Function called when a field value changes\n     * @returns Unsubscribe function\n     */\n    public onUpdate(callback: FieldUpdateCallback): () => void {\n        this.listeners.add(callback);\n        return () => this.listeners.delete(callback);\n    }\n\n    /**\n     * Remove all update listeners\n     */\n    public removeAllListeners(): void {\n        this.listeners.clear();\n    }\n\n    // ========================================================================\n    // Value Access\n    // ========================================================================\n\n    /**\n     * Get the current calculated value for a field\n     */\n    public getValue(fieldId: string): number | null {\n        return this.calculatedValues.get(fieldId) ?? null;\n    }\n\n    /**\n     * Get all calculated values\n     */\n    public getAllValues(): Map<string, number | null> {\n        return new Map(this.calculatedValues);\n    }\n\n    /**\n     * Get values for specific fields\n     */\n    public getValues(fieldIds: string[]): Map<string, number | null> {\n        const result = new Map<string, number | null>();\n        for (const id of fieldIds) {\n            result.set(id, this.calculatedValues.get(id) ?? null);\n        }\n        return result;\n    }\n\n    // ========================================================================\n    // Manual Calculation\n    // ========================================================================\n\n    /**\n     * Force calculation of a specific field\n     * \n     * Use for 'on-change' or 'manual' fields, or to refresh a value.\n     */\n    public calculateField(fieldId: string): number | null {\n        const field = getDataField(fieldId);\n        if (!field) return null;\n\n        const value = this.executeCalculation(field);\n        this.updateValue(fieldId, value);\n        return value;\n    }\n\n    /**\n     * Force calculation of all fields\n     */\n    public calculateAllFields(): void {\n        const allFields = getAllDataFields();\n        const results: CalculationResult[] = [];\n\n        for (const field of allFields) {\n            if (field.calculator) {\n                const value = this.executeCalculation(field);\n                results.push({\n                    fieldId: field.id,\n                    value,\n                    timestamp: Date.now(),\n                });\n            }\n        }\n\n        // Batch update all values\n        for (const result of results) {\n            this.updateValue(result.fieldId, result.value);\n        }\n    }\n\n    /**\n     * Calculate fields that match a specific frequency\n     */\n    public calculateFieldsForFrequency(frequency: UpdateFrequency): void {\n        const fields = this.fieldsByFrequency.get(frequency);\n        if (!fields) return;\n\n        for (const field of fields) {\n            if (field.calculator) {\n                const value = this.executeCalculation(field);\n                this.updateValue(field.id, value);\n            }\n        }\n    }\n\n    // ========================================================================\n    // Private Methods\n    // ========================================================================\n\n    /**\n     * Categorize all fields by their update frequency\n     */\n    private categorizeFieldsByFrequency(): void {\n        this.fieldsByFrequency.clear();\n\n        // Initialize all frequency buckets\n        const frequencies: UpdateFrequency[] = [\n            'realtime', 'second', 'periodic', 'on-change', 'manual'\n        ];\n        for (const freq of frequencies) {\n            this.fieldsByFrequency.set(freq, []);\n        }\n\n        // Categorize fields with calculators\n        const allFields = getAllDataFields();\n        for (const field of allFields) {\n            if (field.calculator) {\n                const list = this.fieldsByFrequency.get(field.updateFrequency);\n                if (list) {\n                    list.push(field);\n                }\n            }\n        }\n    }\n\n    /**\n     * Execute a field's calculator function\n     */\n    private executeCalculation(field: DataFieldDefinition): number | null {\n        if (!field.calculator) return null;\n\n        try {\n            return field.calculator(\n                this.measurements,\n                this.workoutState,\n                this.settings\n            );\n        } catch (error) {\n            console.warn(`Calculation error for field ${field.id}:`, error);\n            return null;\n        }\n    }\n\n    /**\n     * Update a field value and notify listeners\n     */\n    private updateValue(fieldId: string, value: number | null): void {\n        const previousValue = this.calculatedValues.get(fieldId);\n\n        // Only notify if value actually changed\n        if (previousValue !== value) {\n            this.calculatedValues.set(fieldId, value);\n            this.notifyListeners(fieldId, value);\n        }\n    }\n\n    /**\n     * Notify all listeners of a field update\n     */\n    private notifyListeners(fieldId: string, value: number | null): void {\n        for (const listener of this.listeners) {\n            try {\n                listener(fieldId, value);\n            } catch (error) {\n                console.warn(`Error in field update listener:`, error);\n            }\n        }\n    }\n}\n\n// ============================================================================\n// Factory Function\n// ============================================================================\n\n/**\n * Create a new CalculationManager instance\n */\nexport function createCalculationManager(\n    measurements: MeasurementsState,\n    workoutState: WorkoutState,\n    settings: UserSettings,\n    config?: CalculationManagerConfig\n): CalculationManager {\n    return new CalculationManager(measurements, workoutState, settings, config);\n}\n\n// ============================================================================\n// Singleton Instance (optional)\n// ============================================================================\n\nlet globalManager: CalculationManager | null = null;\n\n/**\n * Get or create a global CalculationManager instance\n * \n * Use this for app-wide access to calculated field values.\n */\nexport function getGlobalCalculationManager(): CalculationManager | null {\n    return globalManager;\n}\n\n/**\n * Initialize the global CalculationManager\n */\nexport function initGlobalCalculationManager(\n    measurements: MeasurementsState,\n    workoutState: WorkoutState,\n    settings: UserSettings,\n    config?: CalculationManagerConfig\n): CalculationManager {\n    if (globalManager) {\n        globalManager.stop();\n    }\n    globalManager = createCalculationManager(measurements, workoutState, settings, config);\n    return globalManager;\n}\n\n/**\n * Destroy the global CalculationManager\n */\nexport function destroyGlobalCalculationManager(): void {\n    if (globalManager) {\n        globalManager.stop();\n        globalManager.removeAllListeners();\n        globalManager = null;\n    }\n}\n","/**\n * Data Fields Manager\n *\n * Integration layer that connects the data fields system with the app's\n * MeasurementsState and UI components. Handles:\n * - Real-time data updates from sensors\n * - Calculated field scheduling\n * - UI component synchronization\n * - Profile/screen management\n *\n * @module DataFieldsManager\n */\n\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { ConnectionsState, TimeState } from '../getInitState.js';\nimport { DEFAULT_HR_ZONES, DEFAULT_POWER_ZONES, type ActivityProfile, type UserSettings, type WorkoutState } from './types.js';\nimport type { ScreenCarouselComponent } from '../components/data-fields/ScreenCarouselComponent.js';\nimport { getDataField } from './registry.js';\nimport { createCalculationManager, type CalculationManager } from './CalculationManager.js';\nimport { DEFAULT_CYCLING_PROFILE } from './defaults.js';\n\n/**\n * Maps MeasurementsState properties to data field IDs\n */\nconst SENSOR_FIELD_MAP: Record<string, string> = {\n    power: 'power-current',\n    heartrate: 'heartrate-current',\n    cadence: 'cadence-current',\n    speed: 'speed-current',\n    distance: 'distance-total',\n    altitude: 'elevation-current',\n};\n\n/**\n * Data fields manager configuration\n */\nexport interface DataFieldsManagerConfig {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState?: TimeState;\n    initialProfile?: ActivityProfile;\n}\n\n/**\n * Data Fields Manager\n *\n * Orchestrates the data fields system, connecting sensor data\n * with UI components and calculated fields.\n */\nexport class DataFieldsManager {\n    private measurementsState: MeasurementsState;\n    private connectionsState: ConnectionsState;\n    private timeState?: TimeState;\n    private calculationManager: CalculationManager;\n    private activeProfile: ActivityProfile;\n    private carouselComponent: ScreenCarouselComponent | null = null;\n    private updateIntervalId: number | null = null;\n    private listeners: Map<string, Set<(value: number | null) => void>> = new Map();\n\n    /** Update interval for UI refresh (ms) */\n    private static readonly UPDATE_INTERVAL_MS = 100;\n\n    constructor(config: DataFieldsManagerConfig) {\n        this.measurementsState = config.measurementsState;\n        this.connectionsState = config.connectionsState;\n        this.timeState = config.timeState;\n        this.activeProfile = config.initialProfile ?? DEFAULT_CYCLING_PROFILE;\n\n        // Create calculation manager\n        this.calculationManager = createCalculationManager(\n            this.measurementsState,\n            this.createWorkoutState(),\n            this.createUserSettings()\n        );\n\n        // Listen to calculation updates\n        this.calculationManager.onUpdate((fieldId, value) => {\n            this.notifyFieldUpdate(fieldId, value);\n            this.updateCarouselField(fieldId, value);\n        });\n    }\n\n    /**\n     * Start the data fields manager\n     */\n    public start(): void {\n        // Start calculation manager\n        this.calculationManager.start();\n\n        // Start UI update loop\n        this.startUpdateLoop();\n\n        console.log('[DataFieldsManager] Started');\n    }\n\n    /**\n     * Stop the data fields manager\n     */\n    public stop(): void {\n        // Stop calculation manager\n        this.calculationManager.stop();\n\n        // Stop UI update loop\n        this.stopUpdateLoop();\n\n        console.log('[DataFieldsManager] Stopped');\n    }\n\n    /**\n     * Set the active profile\n     */\n    public setProfile(profile: ActivityProfile): void {\n        this.activeProfile = profile;\n        if (this.carouselComponent) {\n            this.carouselComponent.setProfile(profile);\n        }\n    }\n\n    /**\n     * Get the active profile\n     */\n    public getProfile(): ActivityProfile {\n        return this.activeProfile;\n    }\n\n    /**\n     * Attach to a screen carousel component\n     */\n    public attachToCarousel(carousel: ScreenCarouselComponent): void {\n        this.carouselComponent = carousel;\n        carousel.setProfile(this.activeProfile);\n\n        // Update connection states\n        this.updateSensorConnections();\n    }\n\n    /**\n     * Detach from carousel\n     */\n    public detachFromCarousel(): void {\n        this.carouselComponent = null;\n    }\n\n    /**\n     * Get current value for a data field\n     */\n    public getFieldValue(fieldId: string): number | null {\n        const field = getDataField(fieldId);\n        if (!field) return null;\n\n        // Check if it's a direct sensor field\n        for (const [prop, id] of Object.entries(SENSOR_FIELD_MAP)) {\n            if (id === fieldId) {\n                return this.getSensorValue(prop);\n            }\n        }\n\n        // Otherwise try to calculate it\n        return this.calculationManager.calculateField(fieldId);\n    }\n\n    /**\n     * Subscribe to field value updates\n     */\n    public onFieldUpdate(\n        fieldId: string,\n        callback: (value: number | null) => void\n    ): () => void {\n        if (!this.listeners.has(fieldId)) {\n            this.listeners.set(fieldId, new Set());\n        }\n        this.listeners.get(fieldId)!.add(callback);\n\n        // Return unsubscribe function\n        return () => {\n            const set = this.listeners.get(fieldId);\n            if (set) {\n                set.delete(callback);\n                if (set.size === 0) {\n                    this.listeners.delete(fieldId);\n                }\n            }\n        };\n    }\n\n    /**\n     * Get all fields used in the current profile\n     */\n    public getActiveFields(): string[] {\n        const fields = new Set<string>();\n        for (const screen of this.activeProfile.screens) {\n            for (const slot of screen.slots) {\n                fields.add(slot.fieldId);\n            }\n        }\n        return Array.from(fields);\n    }\n\n    // ========================================================================\n    // Private Methods\n    // ========================================================================\n\n    private startUpdateLoop(): void {\n        if (this.updateIntervalId !== null) return;\n\n        this.updateIntervalId = window.setInterval(() => {\n            this.updateSensorFields();\n            this.updateSensorConnections();\n        }, DataFieldsManager.UPDATE_INTERVAL_MS);\n    }\n\n    private stopUpdateLoop(): void {\n        if (this.updateIntervalId !== null) {\n            window.clearInterval(this.updateIntervalId);\n            this.updateIntervalId = null;\n        }\n    }\n\n    private updateSensorFields(): void {\n        // Update direct sensor readings\n        for (const [prop, fieldId] of Object.entries(SENSOR_FIELD_MAP)) {\n            const value = this.getSensorValue(prop);\n            this.notifyFieldUpdate(fieldId, value);\n            this.updateCarouselField(fieldId, value);\n        }\n\n        // Update time-based fields\n        if (this.timeState) {\n            const elapsed = this.getElapsedTime();\n            this.notifyFieldUpdate('time-elapsed', elapsed);\n            this.updateCarouselField('time-elapsed', elapsed);\n        }\n    }\n\n    private updateSensorConnections(): void {\n        if (!this.carouselComponent) return;\n\n        // Update connection states based on ConnectionsState\n        const connections = this.connectionsState;\n\n        // Power\n        const powerConnected = connections.power?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('power', powerConnected);\n\n        // Heart rate\n        const hrConnected = connections.heartrate?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('heartrate', hrConnected);\n\n        // Cadence\n        const cadenceConnected = connections.cadence?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('cadence', cadenceConnected);\n\n        // Speed (from GPS or calculated)\n        const gpsConnected = connections.gps?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('speed', gpsConnected);\n    }\n\n    /**\n     * Get the latest sensor value from measurement arrays\n     */\n    private getSensorValue(property: string): number | null {\n        const state = this.measurementsState;\n\n        switch (property) {\n            case 'power':\n                return this.getLatestValue(state.power);\n            case 'heartrate':\n                return this.getLatestValue(state.heartrate);\n            case 'cadence':\n                return this.getLatestValue(state.cadence);\n            case 'speed':\n                return this.getLatestValue(state.speed);\n            case 'distance':\n                return this.getLatestValue(state.distance);\n            case 'altitude':\n                return this.getLatestValue(state.altitude);\n            default:\n                return null;\n        }\n    }\n\n    /**\n     * Get the latest value from a measurement array\n     */\n    private getLatestValue(measurements: Array<{ value: number; timestamp: number }> | undefined): number | null {\n        if (!measurements || measurements.length === 0) {\n            return null;\n        }\n        return measurements[measurements.length - 1].value;\n    }\n\n    private notifyFieldUpdate(fieldId: string, value: number | null): void {\n        const callbacks = this.listeners.get(fieldId);\n        if (callbacks) {\n            for (const cb of callbacks) {\n                cb(value);\n            }\n        }\n    }\n\n    private updateCarouselField(fieldId: string, value: number | null): void {\n        if (this.carouselComponent) {\n            this.carouselComponent.updateFieldValue(fieldId, value);\n        }\n    }\n\n    private createWorkoutState(): WorkoutState {\n        const laps = this.measurementsState.laps || [];\n        const lapCount = laps.length;\n        const lastLapTimestamp = lapCount > 0 ? laps[lapCount - 1].timestamp : null;\n        const lapStartTime = lastLapTimestamp ?? this.timeState?.startTime ?? null;\n\n        return {\n            isActive: this.timeState?.running ?? false,\n            isPaused: false,\n            startTime: this.timeState?.startTime ?? null,\n            elapsedTime: this.getElapsedTime(),\n            movingTime: this.getElapsedTime(),\n            pausedTime: 0,\n            currentLap: lapCount + 1,\n            lapStartTime,\n            lapElapsedTime: lapStartTime ? Date.now() - lapStartTime : 0,\n            laps: laps.map((lap, idx) => ({\n                lapNumber: lap.number,\n                startTime: idx === 0 ? (this.timeState?.startTime ?? lap.timestamp) : laps[idx - 1].timestamp,\n                endTime: lap.timestamp,\n                duration: lap.elapsedMs ?? 0,\n                distance: 0,\n                avgPower: null,\n                avgHeartrate: null,\n                avgCadence: null,\n                avgSpeed: null,\n                elevationGain: 0,\n            })),\n        };\n    }\n\n    private getElapsedTime(): number {\n        if (!this.timeState?.running || !this.timeState.startTime) {\n            return 0;\n        }\n        return Date.now() - this.timeState.startTime;\n    }\n\n    /**\n     * Create user settings for data field calculations.\n     * These settings are currently hardcoded defaults since\n     * the AppSettings interface doesn't include training zones.\n     * TODO: Add these to settings UI and persist them.\n     */\n    private createUserSettings(): UserSettings {\n        // AppSettings doesn't have training-specific settings yet,\n        // so we use reasonable defaults\n        return {\n            unitSystem: 'metric' as const,\n            ftp: 200,        // Functional Threshold Power (watts)\n            maxHr: 190,      // Maximum heart rate (bpm)\n            weight: 70,      // Rider weight (kg)\n            restingHr: 60,   // Resting heart rate (bpm)\n            showCalories: true,\n            // Power zones as percentage of FTP\n            powerZones: DEFAULT_POWER_ZONES,\n            // HR zones as percentage of max HR\n            hrZones: DEFAULT_HR_ZONES,\n        };\n    }\n}\n\n/**\n * Create a new DataFieldsManager instance\n */\nexport function createDataFieldsManager(\n    config: DataFieldsManagerConfig\n): DataFieldsManager {\n    return new DataFieldsManager(config);\n}\n\n/**\n * Global data fields manager instance\n */\nlet globalManager: DataFieldsManager | null = null;\n\n/**\n * Initialize the global data fields manager\n */\nexport function initGlobalDataFieldsManager(\n    config: DataFieldsManagerConfig\n): DataFieldsManager {\n    if (globalManager) {\n        globalManager.stop();\n    }\n    globalManager = new DataFieldsManager(config);\n    return globalManager;\n}\n\n/**\n * Get the global data fields manager\n */\nexport function getGlobalDataFieldsManager(): DataFieldsManager | null {\n    return globalManager;\n}\n","/**\n * Data Fields Persistence\n *\n * Handles saving and loading data field configurations to localStorage.\n * Supports:\n * - Activity profiles with custom screens\n * - Field preferences (alerts, voice announcements)\n * - Migration from legacy settings\n *\n * @module data-fields/persistence\n */\n\nimport type {\n    ActivityProfile,\n    DataFieldSettings,\n    FieldPreference\n} from './types.js';\nimport {\n    DEFAULT_CYCLING_PROFILE,\n    DEFAULT_INDOOR_PROFILE,\n    DEFAULT_RUNNING_PROFILE,\n    DEFAULT_DATA_FIELD_SETTINGS,\n    migrateFromLegacySettings,\n} from './defaults.js';\n\n/** LocalStorage key for data field settings */\nconst STORAGE_KEY = 'bpt-data-fields';\n\n/** LocalStorage key for legacy settings (for migration) */\nconst LEGACY_SETTINGS_KEY = 'bpt-settings';\n\n/** Current schema version for data migration */\nconst SCHEMA_VERSION = 1;\n\n/**\n * Stored settings format with version for migrations\n */\ninterface StoredSettings {\n    version: number;\n    settings: DataFieldSettings;\n}\n\n// ============================================================================\n// Load Functions\n// ============================================================================\n\n/**\n * Load data field settings from localStorage\n * \n * @returns The loaded settings or defaults if none exist\n */\nexport function loadDataFieldSettings(): DataFieldSettings {\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n\n        if (stored) {\n            const parsed = JSON.parse(stored) as StoredSettings;\n\n            // Handle version migrations\n            const migrated = migrateStoredSettings(parsed);\n\n            // Validate loaded settings\n            if (validateSettings(migrated)) {\n                return migrated;\n            }\n\n            console.warn('[DataFields] Invalid stored settings, using defaults');\n        }\n\n        // Try to migrate from legacy settings\n        const legacyStored = localStorage.getItem(LEGACY_SETTINGS_KEY);\n        if (legacyStored) {\n            try {\n                const legacy = JSON.parse(legacyStored);\n                const migrated = migrateFromLegacySettings(legacy);\n                saveDataFieldSettings(migrated);\n                return migrated;\n            } catch {\n                console.warn('[DataFields] Failed to migrate legacy settings');\n            }\n        }\n\n        return { ...DEFAULT_DATA_FIELD_SETTINGS };\n    } catch (error) {\n        console.error('[DataFields] Error loading settings:', error);\n        return { ...DEFAULT_DATA_FIELD_SETTINGS };\n    }\n}\n\n/**\n * Load a specific profile by ID\n */\nexport function loadProfile(profileId: string): ActivityProfile | null {\n    const settings = loadDataFieldSettings();\n    return settings.profiles.find(p => p.id === profileId) ?? null;\n}\n\n/**\n * Load the currently active profile\n */\nexport function loadActiveProfile(): ActivityProfile {\n    const settings = loadDataFieldSettings();\n    const active = settings.profiles.find(p => p.id === settings.activeProfileId);\n    return active ?? settings.profiles[0] ?? DEFAULT_CYCLING_PROFILE;\n}\n\n/**\n * Load field preferences for a specific field\n */\nexport function loadFieldPreference(fieldId: string): FieldPreference | null {\n    const settings = loadDataFieldSettings();\n    return settings.fieldPreferences[fieldId] ?? null;\n}\n\n// ============================================================================\n// Save Functions\n// ============================================================================\n\n/**\n * Save data field settings to localStorage\n */\nexport function saveDataFieldSettings(settings: DataFieldSettings): boolean {\n    try {\n        const stored: StoredSettings = {\n            version: SCHEMA_VERSION,\n            settings,\n        };\n\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(stored));\n        return true;\n    } catch (error) {\n        console.error('[DataFields] Error saving settings:', error);\n        return false;\n    }\n}\n\n/**\n * Save a single profile (creates or updates)\n */\nexport function saveProfile(profile: ActivityProfile): boolean {\n    const settings = loadDataFieldSettings();\n\n    const existingIndex = settings.profiles.findIndex(p => p.id === profile.id);\n    if (existingIndex >= 0) {\n        settings.profiles[existingIndex] = profile;\n    } else {\n        settings.profiles.push(profile);\n    }\n\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Delete a profile by ID\n * \n * @returns false if trying to delete the last profile\n */\nexport function deleteProfile(profileId: string): boolean {\n    const settings = loadDataFieldSettings();\n\n    // Don't allow deleting the last profile\n    if (settings.profiles.length <= 1) {\n        console.warn('[DataFields] Cannot delete the last profile');\n        return false;\n    }\n\n    const index = settings.profiles.findIndex(p => p.id === profileId);\n    if (index < 0) {\n        return false;\n    }\n\n    settings.profiles.splice(index, 1);\n\n    // If we deleted the active profile, set a new one\n    if (settings.activeProfileId === profileId) {\n        settings.activeProfileId = settings.profiles[0].id;\n    }\n\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Set the active profile by ID\n */\nexport function setActiveProfile(profileId: string): boolean {\n    const settings = loadDataFieldSettings();\n\n    const exists = settings.profiles.some(p => p.id === profileId);\n    if (!exists) {\n        console.warn('[DataFields] Profile not found:', profileId);\n        return false;\n    }\n\n    settings.activeProfileId = profileId;\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Save field preferences for a specific field\n */\nexport function saveFieldPreference(fieldId: string, preference: FieldPreference): boolean {\n    const settings = loadDataFieldSettings();\n    settings.fieldPreferences[fieldId] = preference;\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Update the active screen index for a profile\n */\nexport function saveActiveScreenIndex(profileId: string, screenIndex: number): boolean {\n    const settings = loadDataFieldSettings();\n\n    const profile = settings.profiles.find(p => p.id === profileId);\n    if (!profile) {\n        return false;\n    }\n\n    profile.activeScreenIndex = Math.max(0, Math.min(screenIndex, profile.screens.length - 1));\n    return saveDataFieldSettings(settings);\n}\n\n// ============================================================================\n// Reset Functions\n// ============================================================================\n\n/**\n * Reset all settings to defaults\n */\nexport function resetToDefaults(): boolean {\n    try {\n        localStorage.removeItem(STORAGE_KEY);\n        return true;\n    } catch (error) {\n        console.error('[DataFields] Error resetting settings:', error);\n        return false;\n    }\n}\n\n/**\n * Reset a specific profile to its default configuration\n */\nexport function resetProfileToDefault(profileId: string): boolean {\n    const settings = loadDataFieldSettings();\n\n    const profile = settings.profiles.find(p => p.id === profileId);\n    if (!profile) {\n        return false;\n    }\n\n    // Find the default profile that matches this activity type\n    const defaults = getDefaultProfileForType(profile.activityType);\n    if (defaults) {\n        const index = settings.profiles.findIndex(p => p.id === profileId);\n        settings.profiles[index] = { ...defaults, id: profileId };\n        return saveDataFieldSettings(settings);\n    }\n\n    return false;\n}\n\n// ============================================================================\n// Export/Import Functions\n// ============================================================================\n\n/**\n * Export settings as JSON string for backup\n */\nexport function exportSettings(): string {\n    const settings = loadDataFieldSettings();\n    return JSON.stringify(settings, null, 2);\n}\n\n/**\n * Import settings from JSON string\n * \n * @returns true if import was successful\n */\nexport function importSettings(jsonString: string): boolean {\n    try {\n        const parsed = JSON.parse(jsonString) as DataFieldSettings;\n\n        if (!validateSettings(parsed)) {\n            console.error('[DataFields] Invalid settings format');\n            return false;\n        }\n\n        return saveDataFieldSettings(parsed);\n    } catch (error) {\n        console.error('[DataFields] Error importing settings:', error);\n        return false;\n    }\n}\n\n/**\n * Export a single profile as JSON\n */\nexport function exportProfile(profileId: string): string | null {\n    const profile = loadProfile(profileId);\n    if (!profile) {\n        return null;\n    }\n    return JSON.stringify(profile, null, 2);\n}\n\n/**\n * Import a profile from JSON string\n */\nexport function importProfile(jsonString: string): ActivityProfile | null {\n    try {\n        const parsed = JSON.parse(jsonString) as ActivityProfile;\n\n        if (!validateProfile(parsed)) {\n            console.error('[DataFields] Invalid profile format');\n            return null;\n        }\n\n        // Generate new ID to avoid conflicts\n        parsed.id = generateUniqueId();\n\n        // Save the imported profile\n        if (saveProfile(parsed)) {\n            return parsed;\n        }\n\n        return null;\n    } catch (error) {\n        console.error('[DataFields] Error importing profile:', error);\n        return null;\n    }\n}\n\n// ============================================================================\n// Migration Functions\n// ============================================================================\n\n/**\n * Migrate stored settings to current schema version\n */\nfunction migrateStoredSettings(stored: StoredSettings): DataFieldSettings {\n    let settings = stored.settings;\n    let version = stored.version;\n\n    // Apply migrations in order\n    while (version < SCHEMA_VERSION) {\n        switch (version) {\n            case 0:\n                // v0 -> v1: Add fieldPreferences if missing\n                settings.fieldPreferences = settings.fieldPreferences ?? {};\n                break;\n            // Add future migrations here\n        }\n        version++;\n    }\n\n    return settings;\n}\n\n// ============================================================================\n// Validation Functions\n// ============================================================================\n\n/**\n * Validate complete settings object\n */\nfunction validateSettings(settings: unknown): settings is DataFieldSettings {\n    if (!settings || typeof settings !== 'object') {\n        return false;\n    }\n\n    const s = settings as DataFieldSettings; // Safe to cast for property checking after object check\n\n    if (!Array.isArray(s.profiles) || s.profiles.length === 0) {\n        return false;\n    }\n\n    if (typeof s.activeProfileId !== 'string') {\n        return false;\n    }\n\n    if (!['metric', 'imperial'].includes(s.unitSystem)) {\n        return false;\n    }\n\n    // Validate each profile\n    return s.profiles.every(validateProfile);\n}\n\n/**\n * Validate a single profile\n */\nfunction validateProfile(profile: unknown): profile is ActivityProfile {\n    if (!profile || typeof profile !== 'object') {\n        return false;\n    }\n\n    const p = profile as { id?: unknown; name?: unknown; screens?: unknown };\n\n    if (typeof p.id !== 'string' || p.id.length === 0) {\n        return false;\n    }\n\n    if (typeof p.name !== 'string' || p.name.length === 0) {\n        return false;\n    }\n\n    if (!Array.isArray(p.screens)) {\n        return false;\n    }\n\n    return true;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Generate a unique ID for new profiles\n */\nfunction generateUniqueId(): string {\n    return `profile-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n}\n\n/**\n * Get default profile for an activity type\n */\nfunction getDefaultProfileForType(activityType: string): ActivityProfile | null {\n    switch (activityType) {\n        case 'cycling':\n            return DEFAULT_CYCLING_PROFILE;\n        case 'indoor':\n            return DEFAULT_INDOOR_PROFILE;\n        case 'running':\n            return DEFAULT_RUNNING_PROFILE;\n        default:\n            return DEFAULT_CYCLING_PROFILE;\n    }\n}\n\n// ============================================================================\n// Storage Event Handling\n// ============================================================================\n\n/** Callbacks for storage change events */\ntype StorageChangeCallback = (settings: DataFieldSettings) => void;\nconst storageCallbacks: Set<StorageChangeCallback> = new Set();\n\n/**\n * Subscribe to storage changes (useful for syncing across tabs)\n */\nexport function onStorageChange(callback: StorageChangeCallback): () => void {\n    storageCallbacks.add(callback);\n\n    // Return unsubscribe function\n    return () => {\n        storageCallbacks.delete(callback);\n    };\n}\n\n// Listen for storage events from other tabs\nif (typeof window !== 'undefined') {\n    window.addEventListener('storage', (event) => {\n        if (event.key === STORAGE_KEY && event.newValue) {\n            try {\n                const stored = JSON.parse(event.newValue) as StoredSettings;\n                for (const callback of storageCallbacks) {\n                    callback(stored.settings);\n                }\n            } catch {\n                // Ignore parse errors\n            }\n        }\n    });\n}\n","/**\n * Power Data Field Definitions\n * \n * All power-related data fields including current, averages, and calculated metrics.\n * \n * @module data-fields/definitions/power-fields\n */\n\nimport type { DataFieldDefinition, UserSettings, ZoneColor } from '../types.js';\nimport { DEFAULT_POWER_ZONES } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n    getZoneColor,\n    getZoneForValue,\n    calculatePercentOfReference,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Power Zone Colorizer (shared by power fields)\n// ============================================================================\n\n/**\n * Colorizer for power-based zone coloring\n */\nconst powerZoneColorizer = (value: number | null, settings: UserSettings): ZoneColor | null => {\n    return getZoneColor(value, settings.ftp, settings.powerZones || DEFAULT_POWER_ZONES);\n};\n\n// ============================================================================\n// Power Field Definitions\n// ============================================================================\n\n/** Power - Current (real-time from sensor) */\nexport const powerCurrent: DataFieldDefinition = {\n    id: 'power-current',\n    name: 'Power',\n    shortName: 'PWR',\n    category: 'power',\n    description: 'Current power output from power meter',\n    unit: 'W',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 0,\n    minValue: 0,\n    maxValue: 2500,\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - 3 Second Average */\nexport const power3s: DataFieldDefinition = {\n    id: 'power-3s',\n    name: 'Power (3s)',\n    shortName: '3s PWR',\n    category: 'power',\n    description: '3-second rolling average power for smoother display',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 0,\n    minValue: 0,\n    maxValue: 2500,\n    calculator: (measurements) => calculateRollingAverage(measurements.power, 3000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - 10 Second Average */\nexport const power10s: DataFieldDefinition = {\n    id: 'power-10s',\n    name: 'Power (10s)',\n    shortName: '10s PWR',\n    category: 'power',\n    description: '10-second rolling average power',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.power, 10000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - 30 Second Average */\nexport const power30s: DataFieldDefinition = {\n    id: 'power-30s',\n    name: 'Power (30s)',\n    shortName: '30s PWR',\n    category: 'power',\n    description: '30-second rolling average power',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.power, 30000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Power - Workout Average */\nexport const powerAvg: DataFieldDefinition = {\n    id: 'power-avg',\n    name: 'Avg Power',\n    shortName: 'Avg PWR',\n    category: 'power',\n    description: 'Average power for entire workout',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateAverage(measurements.power),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Power - Lap Average */\nexport const powerLapAvg: DataFieldDefinition = {\n    id: 'power-lap-avg',\n    name: 'Lap Avg Power',\n    shortName: 'Lap PWR',\n    category: 'power',\n    description: 'Average power for current lap',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.power.filter(\n            m => m.timestamp >= workoutState.lapStartTime!\n        );\n        return calculateAverage(lapMeasurements);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Power - Maximum */\nexport const powerMax: DataFieldDefinition = {\n    id: 'power-max',\n    name: 'Max Power',\n    shortName: 'Max PWR',\n    category: 'power',\n    description: 'Maximum power during workout',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateMax(measurements.power),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Power Zone */\nexport const powerZone: DataFieldDefinition = {\n    id: 'power-zone',\n    name: 'Power Zone',\n    shortName: 'P Zone',\n    category: 'power',\n    description: 'Current power training zone (1-7)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const power = getLatestValue(measurements.power);\n        return getZoneForValue(power, settings.ftp, settings.powerZones || DEFAULT_POWER_ZONES);\n    },\n    formatter: (value, settings) => {\n        if (value === null) return '--';\n        const zones = settings.powerZones || DEFAULT_POWER_ZONES;\n        const zone = zones.find(z => z.zone === value);\n        return zone ? `Z${value}` : `Z${value}`;\n    },\n    colorizer: (value, settings) => {\n        if (value === null) return null;\n        const zones = settings.powerZones || DEFAULT_POWER_ZONES;\n        const zone = zones.find(z => z.zone === value);\n        if (!zone) return null;\n        return {\n            zone: value,\n            zoneName: zone.name,\n            bg: zone.color + '26', // 15% opacity\n            text: zone.color,\n            border: zone.color,\n        };\n    },\n};\n\n/** Power - % of FTP */\nexport const powerPercentFtp: DataFieldDefinition = {\n    id: 'power-percent-ftp',\n    name: 'Power % FTP',\n    shortName: '% FTP',\n    category: 'power',\n    description: 'Current power as percentage of FTP',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const power = getLatestValue(measurements.power);\n        return calculatePercentOfReference(power, settings.ftp);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: powerZoneColorizer,\n};\n\n/** Normalized Power (NP) */\nexport const powerNormalized: DataFieldDefinition = {\n    id: 'power-normalized',\n    name: 'Normalized Power',\n    shortName: 'NP',\n    category: 'power',\n    description: 'Normalized Power - accounts for variability in effort',\n    unit: 'W',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const powerData = measurements.power;\n        if (powerData.length < 30) return null;\n\n        // Calculate 30-second rolling averages\n        const thirtySecondAverages: number[] = [];\n        const windowSize = 30000; // 30 seconds\n\n        for (let i = 0; i < powerData.length; i++) {\n            const windowEnd = powerData[i].timestamp;\n            const windowStart = windowEnd - windowSize;\n\n            const windowValues = powerData.filter(\n                p => p.timestamp >= windowStart && p.timestamp <= windowEnd\n            );\n\n            if (windowValues.length > 0) {\n                const avg = windowValues.reduce((s, p) => s + p.value, 0) / windowValues.length;\n                thirtySecondAverages.push(avg);\n            }\n        }\n\n        if (thirtySecondAverages.length === 0) return null;\n\n        // Raise to 4th power, average, then 4th root\n        const fourthPowers = thirtySecondAverages.map(v => Math.pow(v, 4));\n        const avgFourthPower = fourthPowers.reduce((s, v) => s + v, 0) / fourthPowers.length;\n\n        return Math.pow(avgFourthPower, 0.25);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Intensity Factor (IF) */\nexport const intensityFactor: DataFieldDefinition = {\n    id: 'power-if',\n    name: 'Intensity Factor',\n    shortName: 'IF',\n    category: 'power',\n    description: 'Intensity Factor - NP divided by FTP',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, workoutState, settings) => {\n        if (!settings.ftp || settings.ftp <= 0) return null;\n\n        // Calculate NP first\n        const npCalc = powerNormalized.calculator;\n        if (!npCalc) return null;\n        const np = npCalc(measurements, workoutState, settings);\n        if (np === null) return null;\n\n        return np / settings.ftp;\n    },\n    formatter: (value) => value !== null ? value.toFixed(2) : '--',\n};\n\n/** Training Stress Score (TSS) */\nexport const tss: DataFieldDefinition = {\n    id: 'power-tss',\n    name: 'TSS',\n    shortName: 'TSS',\n    category: 'power',\n    description: 'Training Stress Score - workout load metric',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState, settings) => {\n        if (!settings.ftp || settings.ftp <= 0) return null;\n\n        const npCalc = powerNormalized.calculator;\n        if (!npCalc) return null;\n        const np = npCalc(measurements, workoutState, settings);\n        if (np === null) return null;\n\n        const durationSeconds = workoutState.elapsedTime / 1000;\n        const ifValue = np / settings.ftp;\n\n        return (durationSeconds * np * ifValue) / (settings.ftp * 3600) * 100;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Kilojoules (Work) */\nexport const kilojoules: DataFieldDefinition = {\n    id: 'power-kj',\n    name: 'Kilojoules',\n    shortName: 'kJ',\n    category: 'power',\n    description: 'Total work done in kilojoules',\n    unit: 'kJ',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const powerData = measurements.power;\n        if (powerData.length < 2) return null;\n\n        // Calculate total joules (power * time)\n        let totalJoules = 0;\n\n        for (let i = 1; i < powerData.length; i++) {\n            const prev = powerData[i - 1];\n            const curr = powerData[i];\n            const timeDeltaSeconds = (curr.timestamp - prev.timestamp) / 1000;\n            const avgPower = (prev.value + curr.value) / 2;\n            totalJoules += avgPower * timeDeltaSeconds;\n        }\n\n        return totalJoules / 1000; // Convert to kJ\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Watts per Kilogram (W/kg) */\nexport const wattsPerKg: DataFieldDefinition = {\n    id: 'power-wkg',\n    name: 'W/kg',\n    shortName: 'W/kg',\n    category: 'power',\n    description: 'Power to weight ratio',\n    unit: 'W/kg',\n    sourceType: 'calculated',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'],\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        const power = getLatestValue(measurements.power);\n        if (power === null || !settings.weight || settings.weight <= 0) return null;\n        return power / settings.weight;\n    },\n    formatter: (value) => value !== null ? value.toFixed(2) : '--',\n};\n\n// ============================================================================\n// Export All Power Fields\n// ============================================================================\n\nexport const POWER_FIELDS: DataFieldDefinition[] = [\n    powerCurrent,\n    power3s,\n    power10s,\n    power30s,\n    powerAvg,\n    powerLapAvg,\n    powerMax,\n    powerZone,\n    powerPercentFtp,\n    powerNormalized,\n    intensityFactor,\n    tss,\n    kilojoules,\n    wattsPerKg,\n];\n","/**\n * Heart Rate Data Field Definitions\n * \n * All heart rate-related data fields including current, averages, zones, and calculated metrics.\n * \n * @module data-fields/definitions/heartrate-fields\n */\n\nimport type { DataFieldDefinition, UserSettings, ZoneColor } from '../types.js';\nimport { DEFAULT_HR_ZONES } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n    getZoneColor,\n    getZoneForValue,\n    calculatePercentOfReference,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Heart Rate Zone Colorizer (shared by HR fields)\n// ============================================================================\n\n/**\n * Colorizer for heart rate-based zone coloring\n */\nconst hrZoneColorizer = (value: number | null, settings: UserSettings): ZoneColor | null => {\n    return getZoneColor(value, settings.maxHr, settings.hrZones || DEFAULT_HR_ZONES);\n};\n\n// ============================================================================\n// Heart Rate Field Definitions\n// ============================================================================\n\n/** Heart Rate - Current (real-time from sensor) */\nexport const hrCurrent: DataFieldDefinition = {\n    id: 'heartrate-current',\n    name: 'Heart Rate',\n    shortName: 'HR',\n    category: 'heartrate',\n    description: 'Current heart rate from heart rate monitor',\n    unit: 'bpm',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    minValue: 30,\n    maxValue: 220,\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - 5 Second Average */\nexport const hr5s: DataFieldDefinition = {\n    id: 'hr-5s',\n    name: 'HR (5s)',\n    shortName: '5s HR',\n    category: 'heartrate',\n    description: '5-second rolling average heart rate',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.heartrate, 5000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - 30 Second Average */\nexport const hr30s: DataFieldDefinition = {\n    id: 'hr-30s',\n    name: 'HR (30s)',\n    shortName: '30s HR',\n    category: 'heartrate',\n    description: '30-second rolling average heart rate',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.heartrate, 30000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - Workout Average */\nexport const hrAvg: DataFieldDefinition = {\n    id: 'hr-avg',\n    name: 'Avg HR',\n    shortName: 'Avg HR',\n    category: 'heartrate',\n    description: 'Average heart rate for entire workout',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateAverage(measurements.heartrate),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate - Lap Average */\nexport const hrLapAvg: DataFieldDefinition = {\n    id: 'hr-lap-avg',\n    name: 'Lap Avg HR',\n    shortName: 'Lap HR',\n    category: 'heartrate',\n    description: 'Average heart rate for current lap',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.heartrate.filter(\n            (m) => m.timestamp >= workoutState.lapStartTime!\n        );\n        return calculateAverage(lapMeasurements);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate - Maximum */\nexport const hrMax: DataFieldDefinition = {\n    id: 'hr-max',\n    name: 'Max HR',\n    shortName: 'Max HR',\n    category: 'heartrate',\n    description: 'Maximum heart rate during workout',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateMax(measurements.heartrate),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate - Minimum */\nexport const hrMin: DataFieldDefinition = {\n    id: 'hr-min',\n    name: 'Min HR',\n    shortName: 'Min HR',\n    category: 'heartrate',\n    description: 'Minimum heart rate during workout',\n    unit: 'bpm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const data = measurements.heartrate;\n        if (data.length === 0) return null;\n        return Math.min(...data.map((d) => d.value));\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Heart Rate Zone */\nexport const hrZone: DataFieldDefinition = {\n    id: 'hr-zone',\n    name: 'HR Zone',\n    shortName: 'HR Zone',\n    category: 'heartrate',\n    description: 'Current heart rate training zone (1-5)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hr = getLatestValue(measurements.heartrate);\n        return getZoneForValue(hr, settings.maxHr, settings.hrZones || DEFAULT_HR_ZONES);\n    },\n    formatter: (value, settings) => {\n        if (value === null) return '--';\n        const zones = settings.hrZones || DEFAULT_HR_ZONES;\n        const zone = zones.find((z) => z.zone === value);\n        return zone ? `Z${value}` : `Z${value}`;\n    },\n    colorizer: (value, settings) => {\n        if (value === null) return null;\n        const zones = settings.hrZones || DEFAULT_HR_ZONES;\n        const zone = zones.find((z) => z.zone === value);\n        if (!zone) return null;\n        return {\n            zone: value,\n            zoneName: zone.name,\n            bg: zone.color + '26', // 15% opacity\n            text: zone.color,\n            border: zone.color,\n        };\n    },\n};\n\n/** Heart Rate - % of Max */\nexport const hrPercentMax: DataFieldDefinition = {\n    id: 'hr-percent-max',\n    name: 'HR % Max',\n    shortName: '% Max',\n    category: 'heartrate',\n    description: 'Current heart rate as percentage of max HR',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hr = getLatestValue(measurements.heartrate);\n        return calculatePercentOfReference(hr, settings.maxHr);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: hrZoneColorizer,\n};\n\n/** Heart Rate - % of Heart Rate Reserve (HRR) */\nexport const hrPercentReserve: DataFieldDefinition = {\n    id: 'hr-percent-reserve',\n    name: 'HR % Reserve',\n    shortName: '% HRR',\n    category: 'heartrate',\n    description: 'Current heart rate as percentage of heart rate reserve',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hr = getLatestValue(measurements.heartrate);\n        if (hr === null || !settings.maxHr || !settings.restingHr) return null;\n        const reserve = settings.maxHr - settings.restingHr;\n        if (reserve <= 0) return null;\n        return ((hr - settings.restingHr) / reserve) * 100;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Calories Burned (estimated from HR) */\nexport const caloriesFromHr: DataFieldDefinition = {\n    id: 'hr-calories',\n    name: 'Calories',\n    shortName: 'Cal',\n    category: 'heartrate',\n    description: 'Estimated calories burned based on heart rate',\n    unit: 'kcal',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hrData = measurements.heartrate;\n        if (hrData.length < 2 || !settings.weight || !settings.maxHr) return null;\n\n        // Using heart rate-based calorie estimation\n        // Formula varies by gender - using simplified version\n        let totalCalories = 0;\n\n        for (let i = 1; i < hrData.length; i++) {\n            const prev = hrData[i - 1];\n            const curr = hrData[i];\n            const timeDeltaMinutes = (curr.timestamp - prev.timestamp) / 60000;\n            const avgHr = (prev.value + curr.value) / 2;\n\n            // Simplified formula (assumes average adult, ~50% gender split)\n            // Male: (-55.0969 + (0.6309  HR) + (0.1988  weight kg) + (0.2017  age)) / 4.184\n            // Using simplified: 0.6309 * HR * weight * time / 60\n            const caloriesPerMinute = (0.6309 * avgHr + 0.1988 * settings.weight) / 4.184;\n            totalCalories += caloriesPerMinute * timeDeltaMinutes;\n        }\n\n        return totalCalories;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Time in Zone Display */\nexport const hrTimeInZone: DataFieldDefinition = {\n    id: 'hr-time-in-zone',\n    name: 'Time in Zone',\n    shortName: 'T-Zone',\n    category: 'heartrate',\n    description: 'Time spent in each heart rate zone',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'large',\n    supportedSizes: ['large'],\n    icon: '',\n    requiresSensor: ['heartrate'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const hrData = measurements.heartrate;\n        if (hrData.length < 2 || !settings.maxHr) return null;\n\n        const zones = settings.hrZones || DEFAULT_HR_ZONES;\n        const timeInZones: number[] = new Array(zones.length).fill(0);\n\n        for (let i = 1; i < hrData.length; i++) {\n            const prev = hrData[i - 1];\n            const curr = hrData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n            const avgHr = (prev.value + curr.value) / 2;\n            const zone = getZoneForValue(avgHr, settings.maxHr, zones);\n\n            if (zone !== null && zone > 0 && zone <= zones.length) {\n                timeInZones[zone - 1] += timeDelta;\n            }\n        }\n\n        // Return the zone with most time as the \"primary\" zone\n        const maxTimeIdx = timeInZones.indexOf(Math.max(...timeInZones));\n        return maxTimeIdx + 1; // Return 1-indexed zone\n    },\n    formatter: (value) => value !== null ? `Z${value}` : '--',\n};\n\n// ============================================================================\n// Export All Heart Rate Fields\n// ============================================================================\n\nexport const HEARTRATE_FIELDS: DataFieldDefinition[] = [\n    hrCurrent,\n    hr5s,\n    hr30s,\n    hrAvg,\n    hrLapAvg,\n    hrMax,\n    hrMin,\n    hrZone,\n    hrPercentMax,\n    hrPercentReserve,\n    caloriesFromHr,\n    hrTimeInZone,\n];\n","/**\n * Cadence Data Field Definitions\n * \n * All cadence-related data fields including current, averages, and target ranges.\n * \n * @module data-fields/definitions/cadence-fields\n */\n\nimport type { DataFieldDefinition, ZoneColor } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Cadence Zone Configuration\n// ============================================================================\n\n/** Cadence ranges for zone coloring */\nconst CADENCE_RANGES = {\n    veryLow: { min: 0, max: 60 },\n    low: { min: 60, max: 75 },\n    optimal: { min: 75, max: 95 },\n    high: { min: 95, max: 110 },\n    veryHigh: { min: 110, max: 200 },\n};\n\n/** Cadence zone colors */\nconst CADENCE_COLORS: Record<string, string> = {\n    veryLow: '#9CA3AF',   // Gray - very low\n    low: '#3B82F6',       // Blue - low\n    optimal: '#10B981',   // Green - optimal\n    high: '#F59E0B',      // Orange - high\n    veryHigh: '#EF4444',  // Red - very high\n};\n\n/**\n * Get color for cadence value\n */\nconst getCadenceColor = (cadence: number | null): ZoneColor | null => {\n    if (cadence === null) return null;\n\n    if (cadence < CADENCE_RANGES.veryLow.max) {\n        return {\n            zone: 1,\n            zoneName: 'Very Low',\n            bg: CADENCE_COLORS.veryLow + '26',\n            text: CADENCE_COLORS.veryLow,\n            border: CADENCE_COLORS.veryLow,\n        };\n    }\n    if (cadence < CADENCE_RANGES.low.max) {\n        return {\n            zone: 2,\n            zoneName: 'Low',\n            bg: CADENCE_COLORS.low + '26',\n            text: CADENCE_COLORS.low,\n            border: CADENCE_COLORS.low,\n        };\n    }\n    if (cadence < CADENCE_RANGES.optimal.max) {\n        return {\n            zone: 3,\n            zoneName: 'Optimal',\n            bg: CADENCE_COLORS.optimal + '26',\n            text: CADENCE_COLORS.optimal,\n            border: CADENCE_COLORS.optimal,\n        };\n    }\n    if (cadence < CADENCE_RANGES.high.max) {\n        return {\n            zone: 4,\n            zoneName: 'High',\n            bg: CADENCE_COLORS.high + '26',\n            text: CADENCE_COLORS.high,\n            border: CADENCE_COLORS.high,\n        };\n    }\n    return {\n        zone: 5,\n        zoneName: 'Very High',\n        bg: CADENCE_COLORS.veryHigh + '26',\n        text: CADENCE_COLORS.veryHigh,\n        border: CADENCE_COLORS.veryHigh,\n    };\n};\n\n// ============================================================================\n// Cadence Field Definitions\n// ============================================================================\n\n/** Cadence - Current (real-time from sensor) */\nexport const cadenceCurrent: DataFieldDefinition = {\n    id: 'cadence-current',\n    name: 'Cadence',\n    shortName: 'CAD',\n    category: 'cadence',\n    description: 'Current pedaling cadence from sensor',\n    unit: 'rpm',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    minValue: 0,\n    maxValue: 200,\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: (value) => getCadenceColor(value),\n};\n\n/** Cadence - 5 Second Average */\nexport const cadence5s: DataFieldDefinition = {\n    id: 'cadence-5s',\n    name: 'Cadence (5s)',\n    shortName: '5s CAD',\n    category: 'cadence',\n    description: '5-second rolling average cadence',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.cadence, 5000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: (value) => getCadenceColor(value),\n};\n\n/** Cadence - 30 Second Average */\nexport const cadence30s: DataFieldDefinition = {\n    id: 'cadence-30s',\n    name: 'Cadence (30s)',\n    shortName: '30s CAD',\n    category: 'cadence',\n    description: '30-second rolling average cadence',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    calculator: (measurements) => calculateRollingAverage(measurements.cadence, 30000),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n    colorizer: (value) => getCadenceColor(value),\n};\n\n/** Cadence - Workout Average */\nexport const cadenceAvg: DataFieldDefinition = {\n    id: 'cadence-avg',\n    name: 'Avg Cadence',\n    shortName: 'Avg CAD',\n    category: 'cadence',\n    description: 'Average cadence for entire workout (excluding zeros)',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        // Filter out zero values (coasting)\n        const nonZeroData = measurements.cadence.filter(m => m.value > 0);\n        return calculateAverage(nonZeroData);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Cadence - Lap Average */\nexport const cadenceLapAvg: DataFieldDefinition = {\n    id: 'cadence-lap-avg',\n    name: 'Lap Avg Cadence',\n    shortName: 'Lap CAD',\n    category: 'cadence',\n    description: 'Average cadence for current lap (excluding zeros)',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.cadence.filter(\n            m => m.timestamp >= workoutState.lapStartTime! && m.value > 0\n        );\n        return calculateAverage(lapMeasurements);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Cadence - Maximum */\nexport const cadenceMax: DataFieldDefinition = {\n    id: 'cadence-max',\n    name: 'Max Cadence',\n    shortName: 'Max CAD',\n    category: 'cadence',\n    description: 'Maximum cadence during workout',\n    unit: 'rpm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => calculateMax(measurements.cadence),\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Cadence Zone Indicator */\nexport const cadenceZone: DataFieldDefinition = {\n    id: 'cadence-zone',\n    name: 'Cadence Zone',\n    shortName: 'CAD Zone',\n    category: 'cadence',\n    description: 'Current cadence zone (Very Low, Low, Optimal, High, Very High)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    decimals: 0,\n    calculator: (measurements) => {\n        const cadence = getLatestValue(measurements.cadence);\n        if (cadence === null) return null;\n\n        if (cadence < CADENCE_RANGES.veryLow.max) return 1;\n        if (cadence < CADENCE_RANGES.low.max) return 2;\n        if (cadence < CADENCE_RANGES.optimal.max) return 3;\n        if (cadence < CADENCE_RANGES.high.max) return 4;\n        return 5;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const names = ['V.Low', 'Low', 'Optimal', 'High', 'V.High'];\n        return names[value - 1] || '--';\n    },\n    colorizer: (value) => {\n        if (value === null) return null;\n        const names = ['Very Low', 'Low', 'Optimal', 'High', 'Very High'];\n        const colors = [\n            CADENCE_COLORS.veryLow,\n            CADENCE_COLORS.low,\n            CADENCE_COLORS.optimal,\n            CADENCE_COLORS.high,\n            CADENCE_COLORS.veryHigh,\n        ];\n        return {\n            zone: value,\n            zoneName: names[value - 1],\n            bg: colors[value - 1] + '26',\n            text: colors[value - 1],\n            border: colors[value - 1],\n        };\n    },\n};\n\n/** Pedal Balance (if supported) */\nexport const pedalBalance: DataFieldDefinition = {\n    id: 'cadence-balance',\n    name: 'Pedal Balance',\n    shortName: 'Balance',\n    category: 'cadence',\n    description: 'Left/Right pedal balance percentage',\n    unit: '%',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['power'], // Balance often comes from power meter\n    decimals: 0,\n    minValue: 0,\n    maxValue: 100,\n    formatter: (value) => {\n        if (value === null) return '--';\n        return `${Math.round(value)}/${Math.round(100 - value)}`;\n    },\n    colorizer: (value) => {\n        if (value === null) return null;\n        const deviation = Math.abs(50 - value);\n        if (deviation < 3) {\n            return {\n                zone: 1,\n                zoneName: 'Balanced',\n                bg: '#10B98126',\n                text: '#10B981',\n                border: '#10B981',\n            };\n        }\n        if (deviation < 5) {\n            return {\n                zone: 2,\n                zoneName: 'Slight Imbalance',\n                bg: '#F59E0B26',\n                text: '#F59E0B',\n                border: '#F59E0B',\n            };\n        }\n        return {\n            zone: 3,\n            zoneName: 'Imbalanced',\n            bg: '#EF444426',\n            text: '#EF4444',\n            border: '#EF4444',\n        };\n    },\n};\n\n/** Time Pedaling vs Coasting */\nexport const pedalingTime: DataFieldDefinition = {\n    id: 'cadence-pedaling-time',\n    name: 'Pedaling Time',\n    shortName: 'Pedal %',\n    category: 'cadence',\n    description: 'Percentage of time actively pedaling',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const cadenceData = measurements.cadence;\n        if (cadenceData.length < 2) return null;\n\n        let pedalingTime = 0;\n        let totalTime = 0;\n\n        for (let i = 1; i < cadenceData.length; i++) {\n            const prev = cadenceData[i - 1];\n            const curr = cadenceData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n\n            totalTime += timeDelta;\n            if (prev.value > 0 || curr.value > 0) {\n                pedalingTime += timeDelta;\n            }\n        }\n\n        if (totalTime === 0) return null;\n        return (pedalingTime / totalTime) * 100;\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Total Revolutions */\nexport const totalRevolutions: DataFieldDefinition = {\n    id: 'cadence-revolutions',\n    name: 'Total Revolutions',\n    shortName: 'Revs',\n    category: 'cadence',\n    description: 'Total crank revolutions during workout',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['cadence'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const cadenceData = measurements.cadence;\n        if (cadenceData.length < 2) return null;\n\n        let totalRevs = 0;\n\n        for (let i = 1; i < cadenceData.length; i++) {\n            const prev = cadenceData[i - 1];\n            const curr = cadenceData[i];\n            const timeDeltaMinutes = (curr.timestamp - prev.timestamp) / 60000;\n            const avgCadence = (prev.value + curr.value) / 2;\n            totalRevs += avgCadence * timeDeltaMinutes;\n        }\n\n        return Math.round(totalRevs);\n    },\n    formatter: (value) => value !== null ? value.toLocaleString() : '--',\n};\n\n// ============================================================================\n// Export All Cadence Fields\n// ============================================================================\n\nexport const CADENCE_FIELDS: DataFieldDefinition[] = [\n    cadenceCurrent,\n    cadence5s,\n    cadence30s,\n    cadenceAvg,\n    cadenceLapAvg,\n    cadenceMax,\n    cadenceZone,\n    pedalBalance,\n    pedalingTime,\n    totalRevolutions,\n];\n","/**\n * Speed Data Field Definitions\n * \n * All speed-related data fields including current, averages, and pace-based metrics.\n * \n * @module data-fields/definitions/speed-fields\n */\n\nimport type { DataFieldDefinition, UserSettings } from '../types.js';\nimport { isImperial } from '../types.js';\nimport {\n    calculateRollingAverage,\n    calculateAverage,\n    calculateMax,\n    getLatestValue,\n    formatPace,\n} from '../calculators/common.js';\n\n// ============================================================================\n// Speed Unit Conversion Helpers\n// ============================================================================\n\n/** Convert m/s to km/h */\nconst msToKmh = (ms: number): number => ms * 3.6;\n\n/** Convert m/s to mph */\nconst msToMph = (ms: number): number => ms * 2.23694;\n\n/** Get speed in user's preferred unit (km/h or mph) */\nconst getSpeedInUserUnit = (ms: number | null, settings: UserSettings): number | null => {\n    if (ms === null) return null;\n    return isImperial(settings) ? msToMph(ms) : msToKmh(ms);\n};\n\n/** Get pace in user's preferred unit (min/km or min/mile) */\nconst getPaceInUserUnit = (ms: number | null, settings: UserSettings): number | null => {\n    if (ms === null || ms <= 0) return null;\n    const kmh = msToKmh(ms);\n    if (kmh <= 0) return null;\n\n    // min/km\n    const minPerKm = 60 / kmh;\n\n    // Convert to min/mile if imperial\n    return isImperial(settings) ? minPerKm * 1.60934 : minPerKm;\n};\n\n// ============================================================================\n// Speed Field Definitions\n// ============================================================================\n\n/** Speed - Current (real-time from GPS) */\nexport const speedCurrent: DataFieldDefinition = {\n    id: 'speed-current',\n    name: 'Speed',\n    shortName: 'SPD',\n    category: 'speed',\n    description: 'Current speed from GPS',\n    unit: 'km/h',\n    sourceType: 'sensor',\n    updateFrequency: 'realtime',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    minValue: 0,\n    maxValue: 100,\n    calculator: (measurements, _workoutState, settings) => {\n        const speed = getLatestValue(measurements.speed);\n        return getSpeedInUserUnit(speed, settings);\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return `${value.toFixed(1)}`;\n    },\n};\n\n/** Speed - 5 Second Average */\nexport const speed5s: DataFieldDefinition = {\n    id: 'speed-5s',\n    name: 'Speed (5s)',\n    shortName: '5s SPD',\n    category: 'speed',\n    description: '5-second rolling average speed',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        const avgMs = calculateRollingAverage(measurements.speed, 5000);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - 30 Second Average */\nexport const speed30s: DataFieldDefinition = {\n    id: 'speed-30s',\n    name: 'Speed (30s)',\n    shortName: '30s SPD',\n    category: 'speed',\n    description: '30-second rolling average speed',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        const avgMs = calculateRollingAverage(measurements.speed, 30000);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - Workout Average */\nexport const speedAvg: DataFieldDefinition = {\n    id: 'speed-avg',\n    name: 'Avg Speed',\n    shortName: 'Avg SPD',\n    category: 'speed',\n    description: 'Average speed for entire workout (moving time)',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        // Exclude very low speeds (stopped) from average\n        const movingData = measurements.speed.filter(m => m.value > 0.5);\n        const avgMs = calculateAverage(movingData);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - Lap Average */\nexport const speedLapAvg: DataFieldDefinition = {\n    id: 'speed-lap-avg',\n    name: 'Lap Avg Speed',\n    shortName: 'Lap SPD',\n    category: 'speed',\n    description: 'Average speed for current lap',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements, workoutState, settings) => {\n        if (!workoutState.lapStartTime) return null;\n        const lapMeasurements = measurements.speed.filter(\n            m => m.timestamp >= workoutState.lapStartTime! && m.value > 0.5\n        );\n        const avgMs = calculateAverage(lapMeasurements);\n        return getSpeedInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Speed - Maximum */\nexport const speedMax: DataFieldDefinition = {\n    id: 'speed-max',\n    name: 'Max Speed',\n    shortName: 'Max SPD',\n    category: 'speed',\n    description: 'Maximum speed during workout',\n    unit: 'km/h',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements, _workoutState, settings) => {\n        const maxMs = calculateMax(measurements.speed);\n        return getSpeedInUserUnit(maxMs, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(1) : '--',\n};\n\n/** Pace - Current */\nexport const paceCurrent: DataFieldDefinition = {\n    id: 'speed-pace',\n    name: 'Pace',\n    shortName: 'Pace',\n    category: 'speed',\n    description: 'Current pace (time per km or mile)',\n    unit: 'min/km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const speed = getLatestValue(measurements.speed);\n        return getPaceInUserUnit(speed, settings);\n    },\n    formatter: (value) => {\n        if (value === null || value > 30) return '--'; // Cap at 30 min/km\n        return formatPace(value);\n    },\n};\n\n/** Pace - Average */\nexport const paceAvg: DataFieldDefinition = {\n    id: 'speed-pace-avg',\n    name: 'Avg Pace',\n    shortName: 'Avg Pace',\n    category: 'speed',\n    description: 'Average pace for entire workout',\n    unit: 'min/km',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const movingData = measurements.speed.filter(m => m.value > 0.5);\n        const avgMs = calculateAverage(movingData);\n        return getPaceInUserUnit(avgMs, settings);\n    },\n    formatter: (value) => {\n        if (value === null || value > 30) return '--';\n        return formatPace(value);\n    },\n};\n\n/** Moving Time */\nexport const movingTime: DataFieldDefinition = {\n    id: 'speed-moving-time',\n    name: 'Moving Time',\n    shortName: 'Moving',\n    category: 'speed',\n    description: 'Time spent moving (speed > 0.5 m/s)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const speedData = measurements.speed;\n        if (speedData.length < 2) return null;\n\n        let movingMs = 0;\n        const MOVING_THRESHOLD = 0.5; // m/s\n\n        for (let i = 1; i < speedData.length; i++) {\n            const prev = speedData[i - 1];\n            const curr = speedData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n\n            if ((prev.value + curr.value) / 2 > MOVING_THRESHOLD) {\n                movingMs += timeDelta;\n            }\n        }\n\n        return movingMs;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const seconds = Math.floor(value / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n\n        if (hours > 0) {\n            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        }\n        return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    },\n};\n\n/** Stopped Time */\nexport const stoppedTime: DataFieldDefinition = {\n    id: 'speed-stopped-time',\n    name: 'Stopped Time',\n    shortName: 'Stopped',\n    category: 'speed',\n    description: 'Time spent stopped (speed < 0.5 m/s)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements) => {\n        const speedData = measurements.speed;\n        if (speedData.length < 2) return null;\n\n        let stoppedMs = 0;\n        const MOVING_THRESHOLD = 0.5; // m/s\n\n        for (let i = 1; i < speedData.length; i++) {\n            const prev = speedData[i - 1];\n            const curr = speedData[i];\n            const timeDelta = curr.timestamp - prev.timestamp;\n\n            if ((prev.value + curr.value) / 2 <= MOVING_THRESHOLD) {\n                stoppedMs += timeDelta;\n            }\n        }\n\n        return stoppedMs;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const seconds = Math.floor(value / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n\n        if (hours > 0) {\n            return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n        }\n        return `${minutes}:${secs.toString().padStart(2, '0')}`;\n    },\n};\n\n/** Vertical Speed (climbing rate) */\nexport const verticalSpeed: DataFieldDefinition = {\n    id: 'speed-vertical',\n    name: 'Vertical Speed',\n    shortName: 'VAM',\n    category: 'speed',\n    description: 'Vertical climbing rate in meters per hour',\n    unit: 'm/h',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements) => {\n        // Need at least 30 seconds of data\n        const elevationData = measurements.altitude;\n        if (elevationData.length < 2) return null;\n\n        const windowMs = 30000;\n        const now = Date.now();\n        const recentData = elevationData.filter((e) => e.timestamp >= now - windowMs);\n\n        if (recentData.length < 2) return null;\n\n        const first = recentData[0];\n        const last = recentData[recentData.length - 1];\n\n        const elevationGain = last.value - first.value;\n        const timeDeltaHours = (last.timestamp - first.timestamp) / 3600000;\n\n        if (timeDeltaHours <= 0) return null;\n\n        // VAM = meters gained / hours\n        return Math.max(0, elevationGain / timeDeltaHours);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Efficiency Factor (speed vs power) */\nexport const efficiencyFactor: DataFieldDefinition = {\n    id: 'speed-efficiency',\n    name: 'Efficiency Factor',\n    shortName: 'EF',\n    category: 'speed',\n    description: 'Speed per watt of power (efficiency indicator)',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps', 'power'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        const movingSpeedData = measurements.speed.filter(m => m.value > 0.5);\n        const powerData = measurements.power.filter(p => p.value > 0);\n\n        if (movingSpeedData.length === 0 || powerData.length === 0) return null;\n\n        const avgSpeedMs = calculateAverage(movingSpeedData);\n        const avgPower = calculateAverage(powerData);\n\n        if (!avgSpeedMs || !avgPower || avgPower <= 0) return null;\n\n        // Speed (km/h) / Power (W)\n        const avgSpeedKmh = getSpeedInUserUnit(avgSpeedMs, settings);\n        if (!avgSpeedKmh) return null;\n\n        return avgSpeedKmh / avgPower;\n    },\n    formatter: (value) => value !== null ? value.toFixed(3) : '--',\n};\n\n// ============================================================================\n// Export All Speed Fields\n// ============================================================================\n\nexport const SPEED_FIELDS: DataFieldDefinition[] = [\n    speedCurrent,\n    speed5s,\n    speed30s,\n    speedAvg,\n    speedLapAvg,\n    speedMax,\n    paceCurrent,\n    paceAvg,\n    movingTime,\n    stoppedTime,\n    verticalSpeed,\n    efficiencyFactor,\n];\n","/**\n * Distance Data Field Definitions\n * \n * All distance-related data fields including total, lap, and remaining distances.\n * \n * @module data-fields/definitions/distance-fields\n */\n\nimport type { DataFieldDefinition, UserSettings } from '../types.js';\nimport { isImperial } from '../types.js';\n\n// ============================================================================\n// Distance Conversion Helpers\n// ============================================================================\n\n/** Convert meters to kilometers */\nconst metersToKm = (meters: number): number => meters / 1000;\n\n/** Convert meters to miles */\nconst metersToMiles = (meters: number): number => meters / 1609.344;\n\n/** Get distance in user's preferred unit */\nconst getDistanceInUserUnit = (meters: number | null, settings: UserSettings): number | null => {\n    if (meters === null) return null;\n    return isImperial(settings) ? metersToMiles(meters) : metersToKm(meters);\n};\n\n// ============================================================================\n// Distance Field Definitions\n// ============================================================================\n\n/** Distance - Total */\nexport const distanceTotal: DataFieldDefinition = {\n    id: 'distance-total',\n    name: 'Distance',\n    shortName: 'Dist',\n    category: 'distance',\n    description: 'Total distance traveled',\n    unit: 'km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'large',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        const positions = measurements.gps;\n        if (positions.length < 2) return 0;\n\n        let totalMeters = 0;\n\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            // Haversine formula for distance\n            const R = 6371000; // Earth radius in meters\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        return getDistanceInUserUnit(totalMeters, settings);\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return value.toFixed(2);\n    },\n};\n\n/** Distance - Lap */\nexport const distanceLap: DataFieldDefinition = {\n    id: 'distance-lap',\n    name: 'Lap Distance',\n    shortName: 'Lap Dist',\n    category: 'distance',\n    description: 'Distance for current lap',\n    unit: 'km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, workoutState, settings) => {\n        if (!workoutState.lapStartTime) return 0;\n\n        const lapPositions = measurements.gps.filter(\n            (p) => p.timestamp >= workoutState.lapStartTime!\n        );\n        if (lapPositions.length < 2) return 0;\n\n        let totalMeters = 0;\n\n        for (let i = 1; i < lapPositions.length; i++) {\n            const prev = lapPositions[i - 1];\n            const curr = lapPositions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        return getDistanceInUserUnit(totalMeters, settings);\n    },\n    formatter: (value) => value !== null ? value.toFixed(2) : '--',\n};\n\n/** Distance to Next Kilometer/Mile Marker */\nexport const distanceToMarker: DataFieldDefinition = {\n    id: 'distance-to-marker',\n    name: 'To Next Marker',\n    shortName: 'To Marker',\n    category: 'distance',\n    description: 'Distance remaining to next km/mile marker',\n    unit: 'km',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 2,\n    calculator: (measurements, _workoutState, settings) => {\n        // Calculate total distance first\n        const positions = measurements.gps;\n        if (positions.length < 2) return null;\n\n        let totalMeters = 0;\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        const totalUnits = isImperial(settings)\n            ? metersToMiles(totalMeters)\n            : metersToKm(totalMeters);\n\n        const nextMarker = Math.ceil(totalUnits);\n        return nextMarker - totalUnits;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return value.toFixed(2);\n    },\n};\n\n// ============================================================================\n// Export All Distance Fields\n// ============================================================================\n\nexport const DISTANCE_FIELDS: DataFieldDefinition[] = [\n    distanceTotal,\n    distanceLap,\n    distanceToMarker,\n];\n","/**\n * Time Data Field Definitions\n * \n * All time-related data fields including elapsed, lap, and clock times.\n * \n * @module data-fields/definitions/time-fields\n */\n\nimport type { DataFieldDefinition } from '../types.js';\nimport { isImperial } from '../types.js';\nimport { formatDuration } from '../calculators/common.js';\n\n// ============================================================================\n// Time Field Definitions\n// ============================================================================\n\n/** Elapsed Time - Total workout time */\nexport const timeElapsed: DataFieldDefinition = {\n    id: 'time-elapsed',\n    name: 'Elapsed Time',\n    shortName: 'Time',\n    category: 'time',\n    description: 'Total elapsed time since workout start',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'large',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => workoutState.elapsedTime,\n    formatter: (value) => value !== null ? formatDuration(value) : '--',\n};\n\n/** Lap Time */\nexport const timeLap: DataFieldDefinition = {\n    id: 'time-lap',\n    name: 'Lap Time',\n    shortName: 'Lap',\n    category: 'time',\n    description: 'Elapsed time for current lap',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => {\n        if (!workoutState.lapStartTime) return 0;\n        return Date.now() - workoutState.lapStartTime;\n    },\n    formatter: (value) => value !== null ? formatDuration(value) : '--',\n};\n\n/** Last Lap Time */\nexport const timeLastLap: DataFieldDefinition = {\n    id: 'time-last-lap',\n    name: 'Last Lap Time',\n    shortName: 'Last Lap',\n    category: 'time',\n    description: 'Duration of the previous lap',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => {\n        const laps = workoutState.laps || [];\n        if (laps.length === 0) return null;\n        const lastLap = laps[laps.length - 1];\n        return lastLap.endTime - lastLap.startTime;\n    },\n    formatter: (value) => value !== null ? formatDuration(value) : '--',\n};\n\n/** Time of Day */\nexport const timeClock: DataFieldDefinition = {\n    id: 'time-clock',\n    name: 'Time of Day',\n    shortName: 'Clock',\n    category: 'time',\n    description: 'Current time',\n    unit: null,\n    sourceType: 'system',\n    updateFrequency: 'second',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    decimals: 0,\n    calculator: () => Date.now(),\n    formatter: (value) => {\n        if (value === null) return '--';\n        const date = new Date(value);\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    },\n};\n\n/** Workout Start Time */\nexport const timeStarted: DataFieldDefinition = {\n    id: 'time-started',\n    name: 'Start Time',\n    shortName: 'Start',\n    category: 'time',\n    description: 'Time when workout was started',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => workoutState.startTime,\n    formatter: (value) => {\n        if (value === null) return '--';\n        const date = new Date(value);\n        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    },\n};\n\n/** Estimated Time of Arrival (for target distance) */\nexport const timeEta: DataFieldDefinition = {\n    id: 'time-eta',\n    name: 'ETA',\n    shortName: 'ETA',\n    category: 'time',\n    description: 'Estimated time to complete target distance',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState, settings) => {\n        const targetDistance = settings.targetDistance; // in user units\n        if (!targetDistance || targetDistance <= 0) return null;\n\n        // Calculate current distance\n        const positions = measurements.gps;\n        if (positions.length < 2) return null;\n\n        let totalMeters = 0;\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalMeters += R * c;\n        }\n\n        const currentDistance = isImperial(settings)\n            ? totalMeters / 1609.344\n            : totalMeters / 1000;\n\n        if (currentDistance <= 0) return null;\n\n        const remainingDistance = targetDistance - currentDistance;\n        if (remainingDistance <= 0) return 0;\n\n        // Calculate average speed\n        const elapsedHours = workoutState.elapsedTime / 3600000;\n        if (elapsedHours <= 0) return null;\n\n        const avgSpeed = currentDistance / elapsedHours;\n        if (avgSpeed <= 0) return null;\n\n        // Time remaining in ms\n        const remainingTimeHours = remainingDistance / avgSpeed;\n        return remainingTimeHours * 3600000;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        if (value <= 0) return 'Done!';\n        return formatDuration(value);\n    },\n};\n\n/** Lap Number */\nexport const lapNumber: DataFieldDefinition = {\n    id: 'time-lap-number',\n    name: 'Lap',\n    shortName: 'Lap #',\n    category: 'time',\n    description: 'Current lap number',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (_measurements, workoutState) => workoutState.currentLap || 1,\n    formatter: (value) => value !== null ? value.toString() : '--',\n};\n\n/** Sunrise / Sunset */\nexport const timeSunset: DataFieldDefinition = {\n    id: 'time-sunset',\n    name: 'Sunset',\n    shortName: 'Sunset',\n    category: 'time',\n    description: 'Time until sunset',\n    unit: null,\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements) => {\n        const positions = measurements.gps;\n        if (positions.length === 0) return null;\n\n        const latest = positions[positions.length - 1];\n        const lat = latest.lat;\n\n        // Simplified sunset calculation\n        const now = new Date();\n        const dayOfYear = Math.floor(\n            (now.getTime() - new Date(now.getFullYear(), 0, 0).getTime()) / 86400000\n        );\n\n        // Approximate sunset hour (very simplified)\n        const declination = 23.45 * Math.sin((2 * Math.PI / 365) * (dayOfYear - 81));\n        const hourAngle = Math.acos(\n            -Math.tan(lat * Math.PI / 180) * Math.tan(declination * Math.PI / 180)\n        );\n        const sunsetHour = 12 + (hourAngle * 180 / Math.PI / 15);\n\n        const sunsetTime = new Date(now);\n        sunsetTime.setHours(Math.floor(sunsetHour), Math.round((sunsetHour % 1) * 60), 0);\n\n        return sunsetTime.getTime() - now.getTime();\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        if (value <= 0) return 'Past';\n\n        const hours = Math.floor(value / 3600000);\n        const minutes = Math.floor((value % 3600000) / 60000);\n\n        if (hours > 0) {\n            return `${hours}h ${minutes}m`;\n        }\n        return `${minutes}m`;\n    },\n};\n\n// ============================================================================\n// Export All Time Fields\n// ============================================================================\n\nexport const TIME_FIELDS: DataFieldDefinition[] = [\n    timeElapsed,\n    timeLap,\n    timeLastLap,\n    timeClock,\n    timeStarted,\n    timeEta,\n    lapNumber,\n    timeSunset,\n];\n","/**\n * Elevation Data Field Definitions\n * \n * All elevation-related data fields including current, gain/loss, and grade.\n * \n * @module data-fields/definitions/elevation-fields\n */\n\nimport type { DataFieldDefinition, UserSettings } from '../types.js';\nimport { isImperial } from '../types.js';\nimport { getLatestValue } from '../calculators/common.js';\n\n// ============================================================================\n// Elevation Conversion Helpers\n// ============================================================================\n\n/** Convert meters to feet */\nconst metersToFeet = (meters: number): number => meters * 3.28084;\n\n/** Get elevation in user's preferred unit */\nconst getElevationInUserUnit = (meters: number | null, settings: UserSettings): number | null => {\n    if (meters === null) return null;\n    return isImperial(settings) ? metersToFeet(meters) : meters;\n};\n\n// ============================================================================\n// Elevation Field Definitions\n// ============================================================================\n\n/** Elevation - Current */\nexport const elevationCurrent: DataFieldDefinition = {\n    id: 'elevation-current',\n    name: 'Elevation',\n    shortName: 'Elev',\n    category: 'elevation',\n    description: 'Current elevation above sea level',\n    unit: 'm',\n    sourceType: 'sensor',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevation = getLatestValue(measurements.altitude);\n        return getElevationInUserUnit(elevation, settings);\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        return Math.round(value).toString();\n    },\n};\n\n/** Elevation Gain - Total */\nexport const elevationGain: DataFieldDefinition = {\n    id: 'elevation-gain',\n    name: 'Elevation Gain',\n    shortName: 'Gain',\n    category: 'elevation',\n    description: 'Total elevation gained during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length < 2) return 0;\n\n        let totalGain = 0;\n        const THRESHOLD = 2; // Minimum elevation change to count (noise filter)\n\n        for (let i = 1; i < elevationData.length; i++) {\n            const prev = elevationData[i - 1].value;\n            const curr = elevationData[i].value;\n            const diff = curr - prev;\n\n            if (diff > THRESHOLD) {\n                totalGain += diff;\n            }\n        }\n\n        return getElevationInUserUnit(totalGain, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Elevation Loss - Total */\nexport const elevationLoss: DataFieldDefinition = {\n    id: 'elevation-loss',\n    name: 'Elevation Loss',\n    shortName: 'Loss',\n    category: 'elevation',\n    description: 'Total elevation lost during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length < 2) return 0;\n\n        let totalLoss = 0;\n        const THRESHOLD = 2;\n\n        for (let i = 1; i < elevationData.length; i++) {\n            const prev = elevationData[i - 1].value;\n            const curr = elevationData[i].value;\n            const diff = prev - curr;\n\n            if (diff > THRESHOLD) {\n                totalLoss += diff;\n            }\n        }\n\n        return getElevationInUserUnit(totalLoss, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Elevation - Lap Gain */\nexport const elevationLapGain: DataFieldDefinition = {\n    id: 'elevation-lap-gain',\n    name: 'Lap Elevation Gain',\n    shortName: 'Lap Gain',\n    category: 'elevation',\n    description: 'Elevation gained during current lap',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, workoutState, settings) => {\n        if (!workoutState.lapStartTime) return 0;\n\n        const lapData = measurements.altitude.filter(\n            (e) => e.timestamp >= workoutState.lapStartTime!\n        );\n        if (lapData.length < 2) return 0;\n\n        let totalGain = 0;\n        const THRESHOLD = 2;\n\n        for (let i = 1; i < lapData.length; i++) {\n            const diff = lapData[i].value - lapData[i - 1].value;\n            if (diff > THRESHOLD) {\n                totalGain += diff;\n            }\n        }\n\n        return getElevationInUserUnit(totalGain, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Grade - Current */\nexport const gradeCurrent: DataFieldDefinition = {\n    id: 'elevation-grade',\n    name: 'Grade',\n    shortName: 'Grade',\n    category: 'elevation',\n    description: 'Current road gradient (positive = uphill)',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'second',\n    defaultSize: 'medium',\n    supportedSizes: ['small', 'medium', 'large'],\n    icon: '',\n    requiresSensor: ['gps'],\n    decimals: 1,\n    calculator: (measurements) => {\n        const positions = measurements.gps;\n        const elevations = measurements.altitude;\n\n        if (positions.length < 5 || elevations.length < 5) return null;\n\n        // Use last 5 points for smoothing\n        const recentPositions = positions.slice(-5);\n        const recentElevations = elevations.slice(-5);\n\n        // Calculate horizontal distance\n        let horizontalDistance = 0;\n        for (let i = 1; i < recentPositions.length; i++) {\n            const prev = recentPositions[i - 1];\n            const curr = recentPositions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            horizontalDistance += R * c;\n        }\n\n        if (horizontalDistance < 10) return null; // Need at least 10m\n\n        // Calculate vertical change\n        const elevationChange = recentElevations[recentElevations.length - 1].value -\n            recentElevations[0].value;\n\n        // Grade as percentage\n        return (elevationChange / horizontalDistance) * 100;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const sign = value >= 0 ? '+' : '';\n        return `${sign}${value.toFixed(1)}`;\n    },\n    colorizer: (value) => {\n        if (value === null) return null;\n\n        if (value <= -5) {\n            return {\n                zone: 1,\n                zoneName: 'Steep Descent',\n                bg: '#3B82F626',\n                text: '#3B82F6',\n                border: '#3B82F6',\n            };\n        }\n        if (value < 0) {\n            return {\n                zone: 2,\n                zoneName: 'Descent',\n                bg: '#60A5FA26',\n                text: '#60A5FA',\n                border: '#60A5FA',\n            };\n        }\n        if (value < 3) {\n            return {\n                zone: 3,\n                zoneName: 'Flat',\n                bg: '#10B98126',\n                text: '#10B981',\n                border: '#10B981',\n            };\n        }\n        if (value < 6) {\n            return {\n                zone: 4,\n                zoneName: 'Moderate Climb',\n                bg: '#F59E0B26',\n                text: '#F59E0B',\n                border: '#F59E0B',\n            };\n        }\n        if (value < 10) {\n            return {\n                zone: 5,\n                zoneName: 'Steep Climb',\n                bg: '#EF444426',\n                text: '#EF4444',\n                border: '#EF4444',\n            };\n        }\n        return {\n            zone: 6,\n            zoneName: 'Very Steep',\n            bg: '#7C3AED26',\n            text: '#7C3AED',\n            border: '#7C3AED',\n        };\n    },\n};\n\n/** Average Grade - Workout */\nexport const gradeAvg: DataFieldDefinition = {\n    id: 'elevation-grade-avg',\n    name: 'Avg Grade',\n    shortName: 'Avg Grade',\n    category: 'elevation',\n    description: 'Average gradient over entire workout',\n    unit: '%',\n    sourceType: 'calculated',\n    updateFrequency: 'periodic',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 1,\n    calculator: (measurements) => {\n        const positions = measurements.gps;\n        const elevations = measurements.altitude;\n\n        if (positions.length < 2 || elevations.length < 2) return null;\n\n        // Calculate total horizontal distance\n        let totalDistance = 0;\n        for (let i = 1; i < positions.length; i++) {\n            const prev = positions[i - 1];\n            const curr = positions[i];\n\n            const R = 6371000;\n            const lat1 = prev.lat * Math.PI / 180;\n            const lat2 = curr.lat * Math.PI / 180;\n            const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n            const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n                Math.cos(lat1) * Math.cos(lat2) *\n                Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n            totalDistance += R * c;\n        }\n\n        if (totalDistance < 100) return null;\n\n        // Total elevation change\n        const elevationChange = elevations[elevations.length - 1].value - elevations[0].value;\n\n        return (elevationChange / totalDistance) * 100;\n    },\n    formatter: (value) => {\n        if (value === null) return '--';\n        const sign = value >= 0 ? '+' : '';\n        return `${sign}${value.toFixed(1)}`;\n    },\n};\n\n/** Maximum Elevation */\nexport const elevationMax: DataFieldDefinition = {\n    id: 'elevation-max',\n    name: 'Max Elevation',\n    shortName: 'Max Elev',\n    category: 'elevation',\n    description: 'Highest elevation reached during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length === 0) return null;\n\n        const maxElevation = Math.max(...elevationData.map((e) => e.value));\n        return getElevationInUserUnit(maxElevation, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n/** Minimum Elevation */\nexport const elevationMin: DataFieldDefinition = {\n    id: 'elevation-min',\n    name: 'Min Elevation',\n    shortName: 'Min Elev',\n    category: 'elevation',\n    description: 'Lowest elevation reached during workout',\n    unit: 'm',\n    sourceType: 'calculated',\n    updateFrequency: 'on-change',\n    defaultSize: 'small',\n    supportedSizes: ['small', 'medium'],\n    icon: '',\n    requiresSensor: ['gps'],\n    requiresWorkoutActive: true,\n    decimals: 0,\n    calculator: (measurements, _workoutState, settings) => {\n        const elevationData = measurements.altitude;\n        if (elevationData.length === 0) return null;\n\n        const minElevation = Math.min(...elevationData.map((e) => e.value));\n        return getElevationInUserUnit(minElevation, settings);\n    },\n    formatter: (value) => value !== null ? Math.round(value).toString() : '--',\n};\n\n// ============================================================================\n// Export All Elevation Fields\n// ============================================================================\n\nexport const ELEVATION_FIELDS: DataFieldDefinition[] = [\n    elevationCurrent,\n    elevationGain,\n    elevationLoss,\n    elevationLapGain,\n    gradeCurrent,\n    gradeAvg,\n    elevationMax,\n    elevationMin,\n];\n","import type { DataFieldDefinition, DataFieldCalculator, DataFieldFormatter, WorkoutState, UserSettings } from '../types.js';\nimport type { MeasurementsState } from '../../measurements-state.js';\n\nconst calorieCalculator: DataFieldCalculator = (measurements: MeasurementsState, _workoutState: WorkoutState, settings: UserSettings) => {\n    if (!settings.showCalories) return null;\n    if (!measurements.energy || measurements.energy.length === 0) return 0;\n    return measurements.energy[measurements.energy.length - 1].value;\n};\n\nconst calorieRateCalculator: DataFieldCalculator = (measurements: MeasurementsState, _workoutState: WorkoutState, settings: UserSettings) => {\n    if (!settings.showCalories) return null;\n\n    // If power is present, use Power * 3.6\n    const power = measurements.power.length > 0 ? measurements.power[measurements.power.length - 1].value : 0;\n    if (power > 0) {\n        return power * 3.6;\n    }\n\n    const hr = measurements.heartrate.length > 0 ? measurements.heartrate[measurements.heartrate.length - 1].value : 0;\n    if (hr > 0) {\n        const weight = settings.weight || 75;\n        const age = 30; // Default\n        const termAge = age * 0.2017;\n        const termWeight = weight * 0.1988;\n        const termHr = hr * 0.6309;\n        const calPerMin = (termAge + termWeight + termHr - 55.0969) / 4.184;\n        return Math.max(0, calPerMin * 60);\n    }\n\n    return 0;\n};\n\nconst defaultFormatter: DataFieldFormatter = (value: number | null) => {\n    if (value === null) return '--';\n    return Math.round(value).toString();\n};\n\nexport const energyFields: DataFieldDefinition[] = [\n    {\n        id: 'calories_total',\n        name: 'Calories',\n        shortName: 'Cals',\n        category: 'energy',\n        sourceType: 'calculated',\n        updateFrequency: 'second',\n        description: 'Total energy expenditure in kcal',\n        calculator: calorieCalculator,\n        formatter: defaultFormatter,\n        unit: 'kcal',\n        icon: '',\n        defaultSize: 'medium',\n        supportedSizes: ['small', 'medium', 'large', 'wide', 'tall', 'full']\n    },\n    {\n        id: 'calories_hour',\n        name: 'Calories/Hr',\n        shortName: 'Cal/h',\n        category: 'energy',\n        sourceType: 'calculated',\n        updateFrequency: 'realtime',\n        description: 'Current calorie burn rate',\n        calculator: calorieRateCalculator,\n        formatter: defaultFormatter,\n        unit: 'kcal/h',\n        icon: '',\n        defaultSize: 'medium',\n        supportedSizes: ['small', 'medium', 'large', 'wide', 'tall']\n    }\n];\n","/**\n * Data Fields Module Entry Point\n * \n * Central export for the entire data fields system.\n * Automatically registers all field definitions on import.\n * \n * @module data-fields\n */\n\n// Export core types\nexport * from './types.js';\n\n// Export screen utility functions (types already in types.ts)\nexport {\n    generateSlotId,\n    generateScreenId,\n    generateProfileId,\n    createEmptyScreen,\n    createSlot,\n    createEmptyProfile,\n    addSlotToScreen,\n    removeSlotFromScreen,\n    updateSlot,\n    reorderSlots,\n    addScreenToProfile,\n    removeScreenFromProfile,\n    getActiveScreen,\n    setActiveScreenIndex,\n    nextScreen,\n    previousScreen,\n    validateScreen,\n    validateProfile,\n} from './screens.js';\n\n// Export registry and functions\nexport {\n    registerDataField,\n    registerDataFields,\n    unregisterDataField,\n    clearRegistry,\n    getDataField,\n    hasDataField,\n    getAllDataFields,\n    getFieldCount,\n    getFieldsByCategory,\n    getAllCategories,\n    getCategoriesWithCounts,\n    getFieldsRequiringSensor,\n    getFieldsRequiringGps,\n    getFieldsRequiringWorkout,\n    searchFields,\n    getFieldsByIds,\n} from './registry.js';\n\n// Export calculators\nexport * from './calculators/common.js';\n\n// Export default configurations\nexport {\n    DEFAULT_CYCLING_PROFILE,\n    DEFAULT_INDOOR_PROFILE,\n    DEFAULT_RUNNING_PROFILE,\n    DEFAULT_SIMPLE_PROFILE,\n    DEFAULT_PROFILES,\n    DEFAULT_DATA_FIELD_SETTINGS,\n    SCREEN_PRESETS,\n    createDefaultCyclingProfile,\n    createDefaultIndoorProfile,\n    createDefaultRunningProfile,\n    createDefaultSettings,\n    getDefaultProfileForActivity,\n    migrateFromLegacySettings,\n} from './defaults.js';\n\n// Export CalculationManager\nexport {\n    CalculationManager,\n    createCalculationManager,\n    getGlobalCalculationManager,\n    initGlobalCalculationManager,\n    destroyGlobalCalculationManager,\n} from './CalculationManager.js';\nexport type { FieldUpdateCallback, CalculationManagerConfig } from './CalculationManager.js';\n\n// Export DataFieldsManager\nexport {\n    DataFieldsManager,\n    createDataFieldsManager,\n    initGlobalDataFieldsManager,\n    getGlobalDataFieldsManager,\n} from './DataFieldsManager.js';\nexport type { DataFieldsManagerConfig } from './DataFieldsManager.js';\n\n// Export persistence functions\nexport {\n    loadDataFieldSettings,\n    saveDataFieldSettings,\n    loadProfile,\n    loadActiveProfile,\n    saveProfile,\n    deleteProfile,\n    setActiveProfile,\n    loadFieldPreference,\n    saveFieldPreference,\n    saveActiveScreenIndex,\n    resetToDefaults,\n    resetProfileToDefault,\n    exportSettings,\n    importSettings,\n    exportProfile,\n    importProfile,\n    onStorageChange,\n} from './persistence.js';\n\n// Export individual field definitions for direct access\nexport { POWER_FIELDS } from './definitions/power-fields.js';\nexport { HEARTRATE_FIELDS } from './definitions/heartrate-fields.js';\nexport { CADENCE_FIELDS } from './definitions/cadence-fields.js';\nexport { SPEED_FIELDS } from './definitions/speed-fields.js';\nexport { DISTANCE_FIELDS } from './definitions/distance-fields.js';\nexport { TIME_FIELDS } from './definitions/time-fields.js';\nexport { ELEVATION_FIELDS } from './definitions/elevation-fields.js';\nexport { energyFields as ENERGY_FIELDS } from './definitions/energy-fields.js';\n\n// Import and register all field definitions\nimport { registerDataField } from './registry.js';\nimport { POWER_FIELDS } from './definitions/power-fields.js';\nimport { HEARTRATE_FIELDS } from './definitions/heartrate-fields.js';\nimport { CADENCE_FIELDS } from './definitions/cadence-fields.js';\nimport { SPEED_FIELDS } from './definitions/speed-fields.js';\nimport { DISTANCE_FIELDS } from './definitions/distance-fields.js';\nimport { TIME_FIELDS } from './definitions/time-fields.js';\nimport { ELEVATION_FIELDS } from './definitions/elevation-fields.js';\nimport { energyFields as ENERGY_FIELDS } from './definitions/energy-fields.js';\n\n/**\n * Initialize and register all data fields\n * This is called automatically when this module is imported\n */\nconst initializeDataFields = (): void => {\n    // Register all field definitions\n    const allFields = [\n        ...POWER_FIELDS,\n        ...HEARTRATE_FIELDS,\n        ...CADENCE_FIELDS,\n        ...SPEED_FIELDS,\n        ...DISTANCE_FIELDS,\n        ...TIME_FIELDS,\n        ...ELEVATION_FIELDS,\n        ...ENERGY_FIELDS,\n    ];\n\n    for (const field of allFields) {\n        registerDataField(field);\n    }\n\n    console.log(`[DataFields] Registered ${allFields.length} data fields`);\n};\n\n// Auto-initialize on module load\ninitializeDataFields();\n\n/**\n * Get all registered fields as an array\n */\nexport const getAllFields = (): import('./types.js').DataFieldDefinition[] => {\n    return [\n        ...POWER_FIELDS,\n        ...HEARTRATE_FIELDS,\n        ...CADENCE_FIELDS,\n        ...SPEED_FIELDS,\n        ...DISTANCE_FIELDS,\n        ...TIME_FIELDS,\n        ...ELEVATION_FIELDS,\n        ...ENERGY_FIELDS,\n    ];\n};\n\n/**\n * Summary of available data fields by category\n */\nexport const DATA_FIELD_SUMMARY = {\n    power: POWER_FIELDS.length,\n    heartrate: HEARTRATE_FIELDS.length,\n    cadence: CADENCE_FIELDS.length,\n    speed: SPEED_FIELDS.length,\n    distance: DISTANCE_FIELDS.length,\n    time: TIME_FIELDS.length,\n    elevation: ELEVATION_FIELDS.length,\n    energy: ENERGY_FIELDS.length,\n    total: POWER_FIELDS.length +\n        HEARTRATE_FIELDS.length +\n        CADENCE_FIELDS.length +\n        SPEED_FIELDS.length +\n        DISTANCE_FIELDS.length +\n        TIME_FIELDS.length +\n        ELEVATION_FIELDS.length +\n        ENERGY_FIELDS.length,\n};\n","/**\n * Data Field Web Component\n * \n * Renders a single data field with configurable size, styling, and behavior.\n * Supports zone-based coloring, unit conversion, and responsive sizing.\n * \n * @example\n * ```html\n * <bpt-data-field field-id=\"power-current\" size=\"large\"></bpt-data-field>\n * ```\n * \n * @module components/data-fields/DataFieldComponent\n */\n\nimport { getDataField } from '../../data-fields/index.js';\nimport type { DataFieldDefinition, DataFieldSize, UserSettings, ZoneColor } from '../../data-fields/types.js';\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Custom element for displaying a single data field\n */\nexport class DataFieldComponent extends HTMLElement {\n    static get observedAttributes(): string[] {\n        return ['field-id', 'size', 'value', 'connected', 'highlight'];\n    }\n\n    private fieldDefinition: DataFieldDefinition | null = null;\n    private currentValue: number | null = null;\n    private settings: UserSettings | null = null;\n    private shadow: ShadowRoot;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n    }\n\n    disconnectedCallback(): void {\n        // Cleanup if needed\n    }\n\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue === newValue) return;\n\n        switch (name) {\n            case 'field-id':\n                this.fieldDefinition = newValue ? getDataField(newValue) ?? null : null;\n                this.render();\n                break;\n            case 'size':\n                this.updateSize(newValue as DataFieldSize);\n                break;\n            case 'value':\n                this.updateValue(newValue);\n                break;\n            case 'connected':\n                this.updateConnectionState(newValue === 'true');\n                break;\n            case 'highlight':\n                this.updateHighlight(newValue === 'true');\n                break;\n        }\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Set user settings for formatting and unit conversion\n     */\n    public setSettings(settings: UserSettings): void {\n        this.settings = settings;\n        this.updateDisplay();\n    }\n\n    /**\n     * Update the field value programmatically\n     */\n    public setValue(value: number | null): void {\n        this.currentValue = value;\n        this.updateDisplay();\n    }\n\n    /**\n     * Get the current field ID\n     */\n    public getFieldId(): string | null {\n        return this.getAttribute('field-id');\n    }\n\n    /**\n     * Get the current value\n     */\n    public getValue(): number | null {\n        return this.currentValue;\n    }\n\n    /**\n     * Get the field definition\n     */\n    public getFieldDefinition(): DataFieldDefinition | null {\n        return this.fieldDefinition;\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        const size = (this.getAttribute('size') || this.fieldDefinition?.defaultSize || 'medium') as DataFieldSize;\n        const connected = this.getAttribute('connected') !== 'false';\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"data-field data-field--${size} ${!connected ? 'data-field--disconnected' : ''}\"\n                 data-category=\"${this.fieldDefinition?.category || 'unknown'}\">\n                ${this.renderContent(size)}\n            </div>\n        `;\n\n        this.updateDisplay();\n    }\n\n    private renderContent(size: DataFieldSize): string {\n        if (!this.fieldDefinition) {\n            return `\n                <div class=\"data-field__error\">\n                    <span class=\"data-field__error-icon\"></span>\n                    <span class=\"data-field__error-text\">Unknown field</span>\n                </div>\n            `;\n        }\n\n        const showLabel = size !== 'small';\n        const showIcon = size === 'small' || size === 'medium';\n\n        return `\n            ${showLabel ? `\n                <div class=\"data-field__header\">\n                    ${showIcon ? `<span class=\"data-field__icon\">${this.fieldDefinition.icon}</span>` : ''}\n                    <span class=\"data-field__label\">${this.fieldDefinition.shortName}</span>\n                </div>\n            ` : ''}\n            <div class=\"data-field__body\">\n                <span class=\"data-field__value\" data-value=\"--\">--</span>\n                ${this.fieldDefinition.unit ? `\n                    <span class=\"data-field__unit\">${this.getDisplayUnit()}</span>\n                ` : ''}\n            </div>\n            ${size === 'small' ? `\n                <span class=\"data-field__mini-label\">${this.fieldDefinition.shortName}</span>\n            ` : ''}\n        `;\n    }\n\n    private getDisplayUnit(): string {\n        if (!this.fieldDefinition) return '';\n\n        // Check for imperial unit override\n        if (this.settings && this.fieldDefinition.unitImperial) {\n            const isImperial = this.settings.unitSystem === 'imperial';\n            return isImperial ? this.fieldDefinition.unitImperial : (this.fieldDefinition.unit || '');\n        }\n\n        return this.fieldDefinition.unit || '';\n    }\n\n    // ========================================================================\n    // Updates\n    // ========================================================================\n\n    private updateValue(rawValue: string | null): void {\n        if (rawValue === null || rawValue === '--') {\n            this.currentValue = null;\n        } else {\n            this.currentValue = parseFloat(rawValue);\n            if (isNaN(this.currentValue)) {\n                this.currentValue = null;\n            }\n        }\n        this.updateDisplay();\n    }\n\n    private updateDisplay(): void {\n        const valueEl = this.shadow.querySelector('.data-field__value');\n        if (!valueEl || !this.fieldDefinition) return;\n\n        // Format the value\n        const formattedValue = this.fieldDefinition.formatter(\n            this.currentValue,\n            this.settings || this.getDefaultSettings()\n        );\n\n        valueEl.textContent = formattedValue;\n        valueEl.setAttribute('data-value', formattedValue);\n\n        // Apply zone coloring if available\n        this.updateZoneColoring();\n\n        // Update unit display\n        const unitEl = this.shadow.querySelector('.data-field__unit');\n        if (unitEl) {\n            unitEl.textContent = this.getDisplayUnit();\n        }\n    }\n\n    private updateZoneColoring(): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl || !this.fieldDefinition) return;\n\n        // Remove existing zone classes\n        fieldEl.classList.remove(\n            'data-field--zone-1', 'data-field--zone-2', 'data-field--zone-3',\n            'data-field--zone-4', 'data-field--zone-5', 'data-field--zone-6',\n            'data-field--zone-7'\n        );\n\n        // Apply colorizer if available\n        if (this.fieldDefinition.colorizer && this.currentValue !== null) {\n            const colors = this.fieldDefinition.colorizer(\n                this.currentValue,\n                this.settings || this.getDefaultSettings()\n            );\n\n            if (colors) {\n                this.applyZoneColors(colors);\n            }\n        }\n    }\n\n    private applyZoneColors(colors: ZoneColor): void {\n        const fieldEl = this.shadow.querySelector('.data-field') as HTMLElement;\n        if (!fieldEl) return;\n\n        fieldEl.style.setProperty('--field-bg', colors.bg);\n        fieldEl.style.setProperty('--field-text', colors.text);\n        fieldEl.style.setProperty('--field-border', colors.border);\n        fieldEl.classList.add('data-field--has-zone');\n    }\n\n    private updateSize(size: DataFieldSize | null): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl) return;\n\n        // Remove existing size classes\n        fieldEl.classList.remove(\n            'data-field--small', 'data-field--medium', 'data-field--large',\n            'data-field--wide', 'data-field--tall', 'data-field--full'\n        );\n\n        // Add new size class\n        const newSize = size || this.fieldDefinition?.defaultSize || 'medium';\n        fieldEl.classList.add(`data-field--${newSize}`);\n\n        // Re-render content if size changes label visibility\n        this.render();\n    }\n\n    private updateConnectionState(connected: boolean): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl) return;\n\n        fieldEl.classList.toggle('data-field--disconnected', !connected);\n    }\n\n    private updateHighlight(highlight: boolean): void {\n        const fieldEl = this.shadow.querySelector('.data-field');\n        if (!fieldEl) return;\n\n        fieldEl.classList.toggle('data-field--highlight', highlight);\n    }\n\n    // ========================================================================\n    // Default Settings\n    // ========================================================================\n\n    private getDefaultSettings(): UserSettings {\n        return {\n            ftp: 200,\n            maxHr: 185,\n            weight: 70,\n            restingHr: 60,\n            unitSystem: 'metric',\n            showCalories: true,\n            powerZones: [],\n            hrZones: [],\n        };\n    }\n\n    // ========================================================================\n    // Styles\n    // ========================================================================\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n                contain: content;\n            }\n\n            .data-field {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: var(--field-padding, 8px);\n                border-radius: var(--field-radius, 8px);\n                background: var(--field-bg, var(--surface-color, #1a1a2e));\n                border-left: 4px solid var(--field-border, transparent);\n                color: var(--field-text, var(--text-color, #fff));\n                transition: all 0.2s ease;\n                height: 100%;\n                box-sizing: border-box;\n                position: relative;\n                overflow: hidden;\n            }\n\n            .data-field--has-zone {\n                background: var(--field-bg);\n                color: var(--field-text);\n                border-left-color: var(--field-border);\n            }\n\n            .data-field--disconnected {\n                opacity: 0.5;\n            }\n\n            .data-field--highlight {\n                animation: pulse 1s ease-in-out infinite;\n            }\n\n            @keyframes pulse {\n                0%, 100% { transform: scale(1); }\n                50% { transform: scale(1.02); }\n            }\n\n            /* Header */\n            .data-field__header {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                margin-bottom: 4px;\n                opacity: 0.8;\n            }\n\n            .data-field__icon {\n                font-size: 14px;\n            }\n\n            .data-field__label {\n                font-size: 11px;\n                font-weight: 500;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n            }\n\n            /* Body */\n            .data-field__body {\n                display: flex;\n                align-items: baseline;\n                gap: 4px;\n            }\n\n            .data-field__value {\n                font-variant-numeric: tabular-nums;\n                font-weight: 700;\n                line-height: 1;\n            }\n\n            .data-field__unit {\n                font-size: 12px;\n                font-weight: 400;\n                opacity: 0.7;\n            }\n\n            .data-field__mini-label {\n                font-size: 9px;\n                text-transform: uppercase;\n                opacity: 0.6;\n                margin-top: 2px;\n            }\n\n            /* Size variants */\n            .data-field--small {\n                min-width: 70px;\n                min-height: 55px;\n                padding: 6px;\n            }\n\n            .data-field--small .data-field__value {\n                font-size: 24px;\n            }\n\n            .data-field--small .data-field__unit {\n                font-size: 10px;\n            }\n\n            .data-field--medium {\n                min-width: 100px;\n                min-height: 80px;\n            }\n\n            .data-field--medium .data-field__value {\n                font-size: 32px;\n            }\n\n            .data-field--large {\n                min-width: 160px;\n                min-height: 100px;\n                padding: 12px;\n            }\n\n            .data-field--large .data-field__header {\n                margin-bottom: 8px;\n            }\n\n            .data-field--large .data-field__icon {\n                font-size: 18px;\n            }\n\n            .data-field--large .data-field__label {\n                font-size: 13px;\n            }\n\n            .data-field--large .data-field__value {\n                font-size: 48px;\n            }\n\n            .data-field--large .data-field__unit {\n                font-size: 16px;\n            }\n\n            .data-field--wide {\n                min-width: 200px;\n                min-height: 80px;\n                flex-direction: row;\n                justify-content: space-between;\n                padding: 12px 16px;\n            }\n\n            .data-field--wide .data-field__header {\n                margin-bottom: 0;\n            }\n\n            .data-field--wide .data-field__value {\n                font-size: 36px;\n            }\n\n            .data-field--tall {\n                min-width: 100px;\n                min-height: 160px;\n            }\n\n            .data-field--tall .data-field__value {\n                font-size: 40px;\n            }\n\n            .data-field--full {\n                min-width: 200px;\n                min-height: 160px;\n                padding: 16px;\n            }\n\n            .data-field--full .data-field__value {\n                font-size: 56px;\n            }\n\n            /* Error state */\n            .data-field__error {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n                color: var(--error-color, #ff6b6b);\n            }\n\n            .data-field__error-icon {\n                font-size: 24px;\n            }\n\n            .data-field__error-text {\n                font-size: 11px;\n            }\n\n            /* Category-specific accent colors */\n            .data-field[data-category=\"power\"] {\n                --category-accent: #ffd700;\n            }\n\n            .data-field[data-category=\"heartrate\"] {\n                --category-accent: #ff6b6b;\n            }\n\n            .data-field[data-category=\"cadence\"] {\n                --category-accent: #4ecdc4;\n            }\n\n            .data-field[data-category=\"speed\"] {\n                --category-accent: #45b7d1;\n            }\n\n            .data-field[data-category=\"distance\"] {\n                --category-accent: #96ceb4;\n            }\n\n            .data-field[data-category=\"elevation\"] {\n                --category-accent: #a8e6cf;\n            }\n\n            .data-field[data-category=\"time\"] {\n                --category-accent: #dda0dd;\n            }\n\n            /* Touch feedback */\n            @media (hover: hover) {\n                .data-field:hover {\n                    transform: translateY(-1px);\n                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                }\n            }\n\n            .data-field:active {\n                transform: scale(0.98);\n            }\n        `;\n    }\n}\n\n// ============================================================================\n// Register Custom Element\n// ============================================================================\n\nif (!customElements.get('bpt-data-field')) {\n    customElements.define('bpt-data-field', DataFieldComponent);\n}\n\nexport default DataFieldComponent;\n","/**\n * Data Screen Web Component\n * \n * Renders a complete data screen with multiple data fields arranged in a grid.\n * Supports different layout modes and responsive sizing.\n * \n * @example\n * ```html\n * <bpt-data-screen screen-id=\"cycling-main\"></bpt-data-screen>\n * ```\n * \n * @module components/data-fields/DataScreenComponent\n */\n\nimport type { DataScreen, DataFieldSlot, ScreenLayout } from '../../data-fields/types.js';\nimport type { UserSettings } from '../../data-fields/types.js';\nimport { DataFieldComponent } from './DataFieldComponent.js';\n\n// Ensure DataFieldComponent is registered\nimport './DataFieldComponent.js';\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Custom element for displaying a complete data screen\n */\nexport class DataScreenComponent extends HTMLElement {\n    static get observedAttributes(): string[] {\n        return ['layout'];\n    }\n\n    private screen: DataScreen | null = null;\n    private fieldElements: Map<string, DataFieldComponent> = new Map();\n    private settings: UserSettings | null = null;\n    private shadow: ShadowRoot;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n    }\n\n    disconnectedCallback(): void {\n        this.cleanup();\n    }\n\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue === newValue) return;\n\n        if (name === 'layout' && this.screen) {\n            this.screen = { ...this.screen, layout: newValue as ScreenLayout };\n            this.updateLayout();\n        }\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Set the screen configuration to display\n     */\n    public setScreen(screen: DataScreen): void {\n        this.screen = screen;\n        this.render();\n    }\n\n    /**\n     * Get the current screen configuration\n     */\n    public getScreen(): DataScreen | null {\n        return this.screen;\n    }\n\n    /**\n     * Set user settings for all fields\n     */\n    public setSettings(settings: UserSettings): void {\n        this.settings = settings;\n        for (const fieldEl of this.fieldElements.values()) {\n            fieldEl.setSettings(settings);\n        }\n    }\n\n    /**\n     * Update a specific field's value\n     */\n    public updateFieldValue(slotId: string, value: number | null): void {\n        const fieldEl = this.fieldElements.get(slotId);\n        if (fieldEl) {\n            fieldEl.setValue(value);\n        }\n    }\n\n    /**\n     * Update multiple field values at once\n     */\n    public updateFieldValues(updates: Map<string, number | null>): void {\n        for (const [slotId, value] of updates) {\n            this.updateFieldValue(slotId, value);\n        }\n    }\n\n    /**\n     * Update field value by field ID (not slot ID)\n     */\n    public updateFieldByFieldId(fieldId: string, value: number | null): void {\n        for (const [_slotId, fieldEl] of this.fieldElements) {\n            if (fieldEl.getFieldId() === fieldId) {\n                fieldEl.setValue(value);\n            }\n        }\n    }\n\n    /**\n     * Get a field element by slot ID\n     */\n    public getFieldElement(slotId: string): DataFieldComponent | undefined {\n        return this.fieldElements.get(slotId);\n    }\n\n    /**\n     * Get all field elements\n     */\n    public getAllFieldElements(): Map<string, DataFieldComponent> {\n        return new Map(this.fieldElements);\n    }\n\n    /**\n     * Set connection state for a specific sensor type\n     */\n    public setSensorConnected(sensorType: string, connected: boolean): void {\n        for (const fieldEl of this.fieldElements.values()) {\n            const definition = fieldEl.getFieldDefinition();\n            if (definition?.requiresSensor?.includes(sensorType)) {\n                fieldEl.setAttribute('connected', String(connected));\n            }\n        }\n    }\n\n    /**\n     * Highlight a specific field temporarily\n     */\n    public highlightField(slotId: string, duration: number = 1000): void {\n        const fieldEl = this.fieldElements.get(slotId);\n        if (fieldEl) {\n            fieldEl.setAttribute('highlight', 'true');\n            setTimeout(() => {\n                fieldEl.removeAttribute('highlight');\n            }, duration);\n        }\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        this.cleanup();\n\n        if (!this.screen) {\n            this.shadow.innerHTML = `\n                <style>${this.getStyles()}</style>\n                <div class=\"data-screen data-screen--empty\">\n                    <p>No screen configured</p>\n                </div>\n            `;\n            return;\n        }\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"data-screen data-screen--${this.screen.layout}\" \n                 data-slot-count=\"${this.screen.slots.length}\">\n                ${this.renderSlots()}\n            </div>\n        `;\n\n        this.setupFieldElements();\n    }\n\n    private renderSlots(): string {\n        if (!this.screen) return '';\n\n        return this.screen.slots\n            .sort((a, b) => a.position - b.position)\n            .map(slot => this.renderSlot(slot))\n            .join('');\n    }\n\n    private renderSlot(slot: DataFieldSlot): string {\n        return `\n            <div class=\"data-screen__slot data-screen__slot--${slot.size}\"\n                 data-slot-id=\"${slot.id}\"\n                 style=\"order: ${slot.position}\">\n                <bpt-data-field \n                    field-id=\"${slot.fieldId}\" \n                    size=\"${slot.size}\"\n                    data-slot-id=\"${slot.id}\">\n                </bpt-data-field>\n            </div>\n        `;\n    }\n\n    private setupFieldElements(): void {\n        const fieldEls = this.shadow.querySelectorAll('bpt-data-field');\n        fieldEls.forEach(el => {\n            const fieldEl = el as DataFieldComponent;\n            const slotId = fieldEl.getAttribute('data-slot-id');\n            if (slotId) {\n                this.fieldElements.set(slotId, fieldEl);\n                if (this.settings) {\n                    fieldEl.setSettings(this.settings);\n                }\n            }\n        });\n    }\n\n    private updateLayout(): void {\n        const screenEl = this.shadow.querySelector('.data-screen');\n        if (!screenEl || !this.screen) return;\n\n        // Remove existing layout classes\n        screenEl.className = 'data-screen';\n        screenEl.classList.add(`data-screen--${this.screen.layout}`);\n    }\n\n    private cleanup(): void {\n        this.fieldElements.clear();\n    }\n\n    // ========================================================================\n    // Styles\n    // ========================================================================\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                height: 100%;\n            }\n\n            .data-screen {\n                display: grid;\n                gap: var(--screen-gap, 8px);\n                padding: var(--screen-padding, 8px);\n                height: 100%;\n                box-sizing: border-box;\n                align-content: start;\n            }\n\n            .data-screen--empty {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--text-muted, #888);\n            }\n\n            /* Auto layout - responsive grid */\n            .data-screen--auto {\n                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n            }\n\n            /* Fixed column layouts */\n            .data-screen--grid-2 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .data-screen--grid-3 {\n                grid-template-columns: repeat(3, 1fr);\n            }\n\n            .data-screen--grid-4 {\n                grid-template-columns: repeat(4, 1fr);\n            }\n\n            /* List layout - single column */\n            .data-screen--list {\n                grid-template-columns: 1fr;\n            }\n\n            /* Custom layout - explicit positioning */\n            .data-screen--custom {\n                grid-template-columns: repeat(4, 1fr);\n                grid-auto-rows: minmax(80px, auto);\n            }\n\n            /* Slot container */\n            .data-screen__slot {\n                display: flex;\n                min-height: 60px;\n            }\n\n            .data-screen__slot > * {\n                flex: 1;\n            }\n\n            /* Size-based grid spanning */\n            .data-screen__slot--large,\n            .data-screen__slot--wide {\n                grid-column: span 2;\n            }\n\n            .data-screen__slot--tall {\n                grid-row: span 2;\n            }\n\n            .data-screen__slot--full {\n                grid-column: span 2;\n                grid-row: span 2;\n            }\n\n            /* Responsive adjustments */\n            @media (max-width: 400px) {\n                .data-screen--auto {\n                    grid-template-columns: repeat(2, 1fr);\n                }\n\n                .data-screen--grid-3,\n                .data-screen--grid-4 {\n                    grid-template-columns: repeat(2, 1fr);\n                }\n\n                .data-screen__slot--large,\n                .data-screen__slot--wide {\n                    grid-column: span 2;\n                }\n            }\n\n            @media (min-width: 600px) {\n                .data-screen--auto {\n                    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n                }\n            }\n\n            @media (min-width: 900px) {\n                .data-screen--auto {\n                    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n                }\n\n                .data-screen {\n                    gap: var(--screen-gap, 12px);\n                    padding: var(--screen-padding, 12px);\n                }\n            }\n\n            /* Animation for slot changes */\n            .data-screen__slot {\n                transition: transform 0.2s ease, opacity 0.2s ease;\n            }\n\n            .data-screen__slot:empty {\n                opacity: 0.3;\n                border: 2px dashed var(--border-color, #444);\n                border-radius: 8px;\n            }\n        `;\n    }\n}\n\n// ============================================================================\n// Register Custom Element\n// ============================================================================\n\nif (!customElements.get('bpt-data-screen')) {\n    customElements.define('bpt-data-screen', DataScreenComponent);\n}\n\nexport default DataScreenComponent;\n","/**\n * Screen Carousel Web Component\n * \n * Provides swipe navigation between multiple data screens.\n * Supports touch gestures and keyboard navigation.\n * \n * @example\n * ```html\n * <bpt-screen-carousel>\n *   <bpt-data-screen screen-id=\"main\"></bpt-data-screen>\n *   <bpt-data-screen screen-id=\"power\"></bpt-data-screen>\n * </bpt-screen-carousel>\n * ```\n * \n * @module components/data-fields/ScreenCarouselComponent\n */\n\nimport type { ActivityProfile, DataScreen } from '../../data-fields/types.js';\nimport type { UserSettings } from '../../data-fields/types.js';\nimport { DataScreenComponent } from './DataScreenComponent.js';\n\n// Ensure dependencies are registered\nimport './DataScreenComponent.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ScreenChangeEvent {\n    screenIndex: number;\n    screen: DataScreen;\n    direction: 'next' | 'prev' | 'direct';\n}\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Custom element for swipeable screen navigation\n */\nexport class ScreenCarouselComponent extends HTMLElement {\n    private profile: ActivityProfile | null = null;\n    private activeIndex = 0;\n    private screenElements: DataScreenComponent[] = [];\n    private settings: UserSettings | null = null;\n    private shadow: ShadowRoot;\n\n    // Touch handling\n    private touchStartX = 0;\n    private touchStartY = 0;\n    private touchDeltaX = 0;\n    private isSwiping = false;\n    private swipeThreshold = 50;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n        this.setupEventListeners();\n    }\n\n    disconnectedCallback(): void {\n        this.removeEventListeners();\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Set the activity profile with screens to display\n     */\n    public setProfile(profile: ActivityProfile): void {\n        this.profile = profile;\n        this.activeIndex = profile.activeScreenIndex;\n        this.render();\n    }\n\n    /**\n     * Get the current profile\n     */\n    public getProfile(): ActivityProfile | null {\n        return this.profile;\n    }\n\n    /**\n     * Set user settings for all screens\n     */\n    public setSettings(settings: UserSettings): void {\n        this.settings = settings;\n        for (const screenEl of this.screenElements) {\n            screenEl.setSettings(settings);\n        }\n    }\n\n    /**\n     * Navigate to the next screen\n     */\n    public nextScreen(): void {\n        if (!this.profile) return;\n        const newIndex = (this.activeIndex + 1) % this.profile.screens.length;\n        this.goToScreen(newIndex, 'next');\n    }\n\n    /**\n     * Navigate to the previous screen\n     */\n    public prevScreen(): void {\n        if (!this.profile) return;\n        const newIndex = this.activeIndex === 0\n            ? this.profile.screens.length - 1\n            : this.activeIndex - 1;\n        this.goToScreen(newIndex, 'prev');\n    }\n\n    /**\n     * Navigate to a specific screen by index\n     */\n    public goToScreen(index: number, direction: 'next' | 'prev' | 'direct' = 'direct'): void {\n        if (!this.profile) return;\n\n        const clampedIndex = Math.max(0, Math.min(index, this.profile.screens.length - 1));\n        if (clampedIndex === this.activeIndex) return;\n\n        this.activeIndex = clampedIndex;\n        this.updateActiveScreen();\n        this.dispatchScreenChange(direction);\n    }\n\n    /**\n     * Get the currently active screen index\n     */\n    public getActiveIndex(): number {\n        return this.activeIndex;\n    }\n\n    /**\n     * Get the currently active screen\n     */\n    public getActiveScreen(): DataScreen | null {\n        return this.profile?.screens[this.activeIndex] ?? null;\n    }\n\n    /**\n     * Get the active screen component\n     */\n    public getActiveScreenElement(): DataScreenComponent | null {\n        return this.screenElements[this.activeIndex] ?? null;\n    }\n\n    /**\n     * Update a field value on the active screen\n     */\n    public updateFieldValue(fieldId: string, value: number | null): void {\n        const activeScreen = this.getActiveScreenElement();\n        if (activeScreen) {\n            activeScreen.updateFieldByFieldId(fieldId, value);\n        }\n    }\n\n    /**\n     * Update field values on all screens\n     */\n    public updateAllFieldValues(updates: Map<string, number | null>): void {\n        for (const screenEl of this.screenElements) {\n            for (const [fieldId, value] of updates) {\n                screenEl.updateFieldByFieldId(fieldId, value);\n            }\n        }\n    }\n\n    /**\n     * Set sensor connection status for fields that require the sensor\n     */\n    public setSensorConnected(sensorType: string, connected: boolean): void {\n        for (const screenEl of this.screenElements) {\n            screenEl.setSensorConnected(sensorType, connected);\n        }\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        this.screenElements = [];\n\n        if (!this.profile || this.profile.screens.length === 0) {\n            this.shadow.innerHTML = `\n                <style>${this.getStyles()}</style>\n                <div class=\"carousel carousel--empty\">\n                    <p>No screens configured</p>\n                </div>\n            `;\n            return;\n        }\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"carousel\">\n                <div class=\"carousel__track\" style=\"transform: translateX(-${this.activeIndex * 100}%)\">\n                    ${this.renderScreens()}\n                </div>\n                ${this.renderIndicator()}\n            </div>\n        `;\n\n        this.setupScreenElements();\n    }\n\n    private renderScreens(): string {\n        if (!this.profile) return '';\n\n        return this.profile.screens\n            .map((_screen, index) => `\n                <div class=\"carousel__slide ${index === this.activeIndex ? 'carousel__slide--active' : ''}\"\n                     data-index=\"${index}\">\n                    <bpt-data-screen data-screen-index=\"${index}\"></bpt-data-screen>\n                </div>\n            `)\n            .join('');\n    }\n\n    private renderIndicator(): string {\n        if (!this.profile || this.profile.screens.length <= 1) return '';\n\n        const dots = this.profile.screens\n            .map((screen, index) => `\n                <button class=\"carousel__dot ${index === this.activeIndex ? 'carousel__dot--active' : ''}\"\n                        data-index=\"${index}\"\n                        aria-label=\"Go to ${screen.name} screen\"\n                        title=\"${screen.name}\">\n                    <span class=\"carousel__dot-icon\">${screen.icon}</span>\n                </button>\n            `)\n            .join('');\n\n        return `\n            <div class=\"carousel__indicator\">\n                <button class=\"carousel__arrow carousel__arrow--prev\" \n                        aria-label=\"Previous screen\"\n                        title=\"Previous screen ()\">\n                    \n                </button>\n                <div class=\"carousel__dots\">\n                    ${dots}\n                </div>\n                <button class=\"carousel__arrow carousel__arrow--next\" \n                        aria-label=\"Next screen\"\n                        title=\"Next screen ()\">\n                    \n                </button>\n            </div>\n        `;\n    }\n\n    private setupScreenElements(): void {\n        if (!this.profile) return;\n\n        const screenEls = this.shadow.querySelectorAll('bpt-data-screen');\n        screenEls.forEach((el, index) => {\n            const screenEl = el as DataScreenComponent;\n            const screen = this.profile!.screens[index];\n            screenEl.setScreen(screen);\n            if (this.settings) {\n                screenEl.setSettings(this.settings);\n            }\n            this.screenElements.push(screenEl);\n        });\n    }\n\n    private updateActiveScreen(): void {\n        // Update track position\n        const track = this.shadow.querySelector('.carousel__track') as HTMLElement;\n        if (track) {\n            track.style.transform = `translateX(-${this.activeIndex * 100}%)`;\n        }\n\n        // Update slide classes\n        const slides = this.shadow.querySelectorAll('.carousel__slide');\n        slides.forEach((slide, index) => {\n            slide.classList.toggle('carousel__slide--active', index === this.activeIndex);\n        });\n\n        // Update indicator\n        const dots = this.shadow.querySelectorAll('.carousel__dot');\n        dots.forEach((dot, index) => {\n            dot.classList.toggle('carousel__dot--active', index === this.activeIndex);\n        });\n    }\n\n    // ========================================================================\n    // Event Handling\n    // ========================================================================\n\n    private setupEventListeners(): void {\n        const container = this.shadow.querySelector('.carousel') as HTMLElement;\n        if (!container) return;\n\n        // Touch events on the container element\n        container.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: true });\n        container.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });\n        container.addEventListener('touchend', this.handleTouchEnd.bind(this), { passive: true });\n\n        // Indicator clicks\n        container.addEventListener('click', this.handleClick.bind(this));\n\n        // Keyboard navigation\n        this.addEventListener('keydown', this.handleKeydown.bind(this));\n    }\n\n    private removeEventListeners(): void {\n        // Event listeners are automatically removed when shadow DOM is cleared\n    }\n\n    private handleTouchStart(e: TouchEvent): void {\n        this.touchStartX = e.touches[0].clientX;\n        this.touchStartY = e.touches[0].clientY;\n        this.touchDeltaX = 0;\n        this.isSwiping = false;\n    }\n\n    private handleTouchMove(e: TouchEvent): void {\n        if (!this.profile || this.profile.screens.length <= 1) return;\n\n        const deltaX = e.touches[0].clientX - this.touchStartX;\n        const deltaY = e.touches[0].clientY - this.touchStartY;\n\n        // Determine if this is a horizontal swipe\n        if (!this.isSwiping && Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {\n            this.isSwiping = true;\n        }\n\n        if (this.isSwiping) {\n            e.preventDefault();\n            this.touchDeltaX = deltaX;\n\n            // Apply visual feedback during swipe\n            const track = this.shadow.querySelector('.carousel__track') as HTMLElement;\n            if (track) {\n                const baseOffset = -this.activeIndex * 100;\n                const swipeOffset = (deltaX / this.offsetWidth) * 100;\n                track.style.transform = `translateX(calc(${baseOffset}% + ${swipeOffset}%))`;\n                track.style.transition = 'none';\n            }\n        }\n    }\n\n    private handleTouchEnd(_e: TouchEvent): void {\n        if (!this.isSwiping) return;\n\n        const track = this.shadow.querySelector('.carousel__track') as HTMLElement;\n        if (track) {\n            track.style.transition = '';\n        }\n\n        if (Math.abs(this.touchDeltaX) > this.swipeThreshold) {\n            if (this.touchDeltaX > 0) {\n                this.prevScreen();\n            } else {\n                this.nextScreen();\n            }\n        } else {\n            // Snap back to current screen\n            this.updateActiveScreen();\n        }\n\n        this.isSwiping = false;\n        this.touchDeltaX = 0;\n    }\n\n    private handleClick(e: Event): void {\n        const target = e.target as HTMLElement;\n\n        // Handle arrow button clicks\n        const prevArrow = target.closest('.carousel__arrow--prev');\n        if (prevArrow) {\n            this.prevScreen();\n            return;\n        }\n\n        const nextArrow = target.closest('.carousel__arrow--next');\n        if (nextArrow) {\n            this.nextScreen();\n            return;\n        }\n\n        // Handle dot clicks\n        const dot = target.closest('.carousel__dot') as HTMLElement;\n        if (dot) {\n            const index = parseInt(dot.dataset.index || '0', 10);\n            const direction = index > this.activeIndex ? 'next' : 'prev';\n            this.goToScreen(index, direction);\n        }\n    }\n\n    private handleKeydown(e: KeyboardEvent): void {\n        switch (e.key) {\n            case 'ArrowLeft':\n                e.preventDefault();\n                this.prevScreen();\n                break;\n            case 'ArrowRight':\n                e.preventDefault();\n                this.nextScreen();\n                break;\n        }\n    }\n\n    private dispatchScreenChange(direction: 'next' | 'prev' | 'direct'): void {\n        const screen = this.getActiveScreen();\n        if (!screen) return;\n\n        const event = new CustomEvent<ScreenChangeEvent>('screen-change', {\n            detail: {\n                screenIndex: this.activeIndex,\n                screen,\n                direction,\n            },\n            bubbles: true,\n            composed: true,\n        });\n\n        this.dispatchEvent(event);\n    }\n\n    // ========================================================================\n    // Styles\n    // ========================================================================\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                height: 100%;\n                overflow: hidden;\n            }\n\n            .carousel {\n                position: relative;\n                width: 100%;\n                height: 100%;\n                overflow: hidden;\n            }\n\n            .carousel--empty {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--text-muted, #888);\n            }\n\n            .carousel__track {\n                display: flex;\n                height: calc(100% - 40px);\n                transition: transform 0.3s ease-out;\n                will-change: transform;\n            }\n\n            .carousel__slide {\n                flex: 0 0 100%;\n                width: 100%;\n                height: 100%;\n                overflow: hidden;\n            }\n\n            .carousel__slide > * {\n                width: 100%;\n                height: 100%;\n            }\n\n            /* Screen indicator */\n            .carousel__indicator {\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                gap: 8px;\n                padding: 8px;\n                height: 32px;\n                background: var(--surface-color, #1a1a2e);\n            }\n\n            .carousel__dots {\n                display: flex;\n                gap: 8px;\n            }\n\n            .carousel__arrow {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                width: 28px;\n                height: 28px;\n                padding: 0;\n                border: none;\n                border-radius: 50%;\n                background: var(--arrow-bg, rgba(255, 255, 255, 0.1));\n                color: var(--arrow-color, rgba(255, 255, 255, 0.7));\n                cursor: pointer;\n                transition: all 0.2s ease;\n                font-size: 18px;\n                font-weight: bold;\n                line-height: 1;\n            }\n\n            .carousel__arrow:hover {\n                background: var(--arrow-hover-bg, rgba(255, 255, 255, 0.2));\n                color: var(--arrow-hover-color, #fff);\n            }\n\n            .carousel__arrow:active {\n                transform: scale(0.95);\n            }\n\n            .carousel__arrow:focus {\n                outline: 2px solid var(--focus-color, #4ecdc4);\n                outline-offset: 2px;\n            }\n\n            .carousel__arrow:focus:not(:focus-visible) {\n                outline: none;\n            }\n\n            .carousel__dot {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                width: 32px;\n                height: 24px;\n                padding: 0;\n                border: none;\n                border-radius: 12px;\n                background: var(--dot-bg, rgba(255, 255, 255, 0.2));\n                color: var(--dot-color, rgba(255, 255, 255, 0.6));\n                cursor: pointer;\n                transition: all 0.2s ease;\n                font-size: 12px;\n            }\n\n            .carousel__dot:hover {\n                background: var(--dot-hover-bg, rgba(255, 255, 255, 0.3));\n            }\n\n            .carousel__dot--active {\n                background: var(--primary-color, #4ecdc4);\n                color: var(--primary-text, #000);\n                width: 48px;\n            }\n\n            .carousel__dot-icon {\n                font-size: 14px;\n            }\n\n            /* Hide indicator for single screen */\n            .carousel__indicator:has(.carousel__dot:only-child) {\n                display: none;\n            }\n\n            /* Animation classes */\n            .carousel__slide--entering {\n                animation: slideIn 0.3s ease-out;\n            }\n\n            .carousel__slide--leaving {\n                animation: slideOut 0.3s ease-out;\n            }\n\n            @keyframes slideIn {\n                from { opacity: 0; transform: scale(0.95); }\n                to { opacity: 1; transform: scale(1); }\n            }\n\n            @keyframes slideOut {\n                from { opacity: 1; transform: scale(1); }\n                to { opacity: 0; transform: scale(0.95); }\n            }\n\n            /* Touch feedback */\n            .carousel__track.is-dragging {\n                cursor: grabbing;\n            }\n\n            /* Accessibility */\n            .carousel__dot:focus {\n                outline: 2px solid var(--focus-color, #4ecdc4);\n                outline-offset: 2px;\n            }\n\n            .carousel__dot:focus:not(:focus-visible) {\n                outline: none;\n            }\n        `;\n    }\n}\n\n// ============================================================================\n// Register Custom Element\n// ============================================================================\n\nif (!customElements.get('bpt-screen-carousel')) {\n    customElements.define('bpt-screen-carousel', ScreenCarouselComponent);\n}\n\nexport default ScreenCarouselComponent;\n","/**\n * Data Field Picker Web Component\n *\n * Modal dialog for selecting and configuring data fields.\n * Used when adding or editing fields in a data screen.\n *\n * @example\n * ```typescript\n * const picker = document.createElement('bpt-field-picker') as FieldPickerComponent;\n * picker.addEventListener('select', (e) => {\n *   console.log('Selected field:', e.detail.fieldId);\n * });\n * document.body.appendChild(picker);\n * picker.open();\n * ```\n *\n * @module components/data-fields/FieldPickerComponent\n */\n\nimport type { DataFieldDefinition, DataFieldCategory, DataFieldSize } from '../../data-fields/types.js';\nimport {\n    getAllCategories,\n    getFieldsByCategory,\n    searchFields,\n    getDataField,\n} from '../../data-fields/registry.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface FieldSelectEvent {\n    fieldId: string;\n    field: DataFieldDefinition;\n    size: DataFieldSize;\n}\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Data field picker modal component\n */\nexport class FieldPickerComponent extends HTMLElement {\n    private shadow: ShadowRoot;\n    private isOpen = false;\n    private selectedCategory: DataFieldCategory | 'all' = 'all';\n    private searchQuery = '';\n    private selectedFieldId: string | null = null;\n    private selectedSize: DataFieldSize = 'medium';\n\n    // Category icons\n    private static readonly CATEGORY_ICONS: Record<DataFieldCategory | 'all', string> = {\n        all: '',\n        power: '',\n        heartrate: '',\n        cadence: '',\n        speed: '',\n        distance: '',\n        elevation: '',\n        time: '',\n        laps: '',\n        energy: '',\n        environment: '',\n        device: '',\n        charts: '',\n        map: '',\n    };\n\n    // Category display names\n    private static readonly CATEGORY_NAMES: Record<DataFieldCategory | 'all', string> = {\n        all: 'All Fields',\n        power: 'Power',\n        heartrate: 'Heart Rate',\n        cadence: 'Cadence',\n        speed: 'Speed & Pace',\n        distance: 'Distance',\n        elevation: 'Elevation',\n        time: 'Time',\n        laps: 'Laps',\n        energy: 'Energy',\n        environment: 'Environment',\n        device: 'Device',\n        charts: 'Charts',\n        map: 'Map',\n    };\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n        this.setupEventListeners();\n    }\n\n    disconnectedCallback(): void {\n        this.removeEventListeners();\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Open the picker modal\n     */\n    public open(preselectedFieldId?: string): void {\n        this.isOpen = true;\n        this.selectedFieldId = preselectedFieldId ?? null;\n\n        if (preselectedFieldId) {\n            const field = getDataField(preselectedFieldId);\n            if (field) {\n                this.selectedCategory = field.category;\n                this.selectedSize = field.defaultSize;\n            }\n        }\n\n        this.render();\n        this.setAttribute('open', '');\n\n        // Focus search input\n        requestAnimationFrame(() => {\n            const searchInput = this.shadow.querySelector('.picker__search') as HTMLInputElement;\n            searchInput?.focus();\n        });\n    }\n\n    /**\n     * Close the picker modal\n     */\n    public close(): void {\n        this.isOpen = false;\n        this.removeAttribute('open');\n        this.render();\n\n        this.dispatchEvent(new CustomEvent('close'));\n    }\n\n    /**\n     * Get whether the picker is currently open\n     */\n    public getIsOpen(): boolean {\n        return this.isOpen;\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        if (!this.isOpen) {\n            this.shadow.innerHTML = `<style>${this.getStyles()}</style>`;\n            return;\n        }\n\n        const fields = this.getFilteredFields();\n        const categories = this.getAvailableCategories();\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"picker__overlay\" data-action=\"close\">\n                <div class=\"picker__dialog\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Select Data Field\">\n                    <header class=\"picker__header\">\n                        <h2 class=\"picker__title\">Select Data Field</h2>\n                        <button class=\"picker__close\" data-action=\"close\" aria-label=\"Close\"></button>\n                    </header>\n                    \n                    <div class=\"picker__search-container\">\n                        <input \n                            type=\"search\" \n                            class=\"picker__search\" \n                            placeholder=\"Search fields...\"\n                            value=\"${this.escapeHtml(this.searchQuery)}\"\n                        >\n                    </div>\n                    \n                    <div class=\"picker__categories\">\n                        ${categories.map(cat => `\n                            <button \n                                class=\"picker__category ${cat === this.selectedCategory ? 'picker__category--active' : ''}\"\n                                data-category=\"${cat}\"\n                            >\n                                <span class=\"picker__category-icon\">${FieldPickerComponent.CATEGORY_ICONS[cat]}</span>\n                                <span class=\"picker__category-name\">${FieldPickerComponent.CATEGORY_NAMES[cat]}</span>\n                            </button>\n                        `).join('')}\n                    </div>\n                    \n                    <div class=\"picker__fields\">\n                        ${fields.length === 0\n                ? '<p class=\"picker__empty\">No fields found</p>'\n                : fields.map(field => this.renderFieldOption(field)).join('')\n            }\n                    </div>\n                    \n                    ${this.selectedFieldId ? this.renderSizeSelector() : ''}\n                    \n                    <footer class=\"picker__footer\">\n                        <button class=\"picker__btn picker__btn--cancel\" data-action=\"close\">Cancel</button>\n                        <button \n                            class=\"picker__btn picker__btn--confirm\" \n                            data-action=\"confirm\"\n                            ${!this.selectedFieldId ? 'disabled' : ''}\n                        >\n                            Add Field\n                        </button>\n                    </footer>\n                </div>\n            </div>\n        `;\n    }\n\n    private renderFieldOption(field: DataFieldDefinition): string {\n        const isSelected = field.id === this.selectedFieldId;\n\n        return `\n            <button \n                class=\"picker__field ${isSelected ? 'picker__field--selected' : ''}\"\n                data-field-id=\"${field.id}\"\n            >\n                <span class=\"picker__field-icon\">${field.icon}</span>\n                <div class=\"picker__field-info\">\n                    <span class=\"picker__field-name\">${this.escapeHtml(field.name)}</span>\n                    <span class=\"picker__field-desc\">${this.escapeHtml(field.description)}</span>\n                </div>\n                ${field.requiresSensor?.length ? `\n                    <span class=\"picker__field-badge\" title=\"Requires sensor\"></span>\n                ` : ''}\n                ${field.requiresWorkoutActive ? `\n                    <span class=\"picker__field-badge\" title=\"Requires active workout\"></span>\n                ` : ''}\n            </button>\n        `;\n    }\n\n    private renderSizeSelector(): string {\n        const field = getDataField(this.selectedFieldId!);\n        if (!field) return '';\n\n        const sizes: DataFieldSize[] = field.supportedSizes;\n\n        return `\n            <div class=\"picker__size-selector\">\n                <label class=\"picker__size-label\">Field Size:</label>\n                <div class=\"picker__sizes\">\n                    ${sizes.map(size => `\n                        <button \n                            class=\"picker__size ${size === this.selectedSize ? 'picker__size--active' : ''}\"\n                            data-size=\"${size}\"\n                        >\n                            ${this.getSizeLabel(size)}\n                        </button>\n                    `).join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    private getSizeLabel(size: DataFieldSize): string {\n        const labels: Record<DataFieldSize, string> = {\n            small: 'S',\n            medium: 'M',\n            large: 'L',\n            wide: 'W',\n            tall: 'T',\n            full: 'XL',\n        };\n        return labels[size];\n    }\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: contents;\n            }\n            \n            :host(:not([open])) .picker__overlay {\n                display: none;\n            }\n            \n            .picker__overlay {\n                position: fixed;\n                inset: 0;\n                background: rgba(0, 0, 0, 0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 1000;\n                padding: 1rem;\n            }\n            \n            .picker__dialog {\n                background: var(--color-bg, #1a1a2e);\n                border-radius: 12px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\n                width: 100%;\n                max-width: 500px;\n                max-height: 80vh;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n            \n            .picker__header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                padding: 1rem;\n                border-bottom: 1px solid var(--color-border, #333);\n            }\n            \n            .picker__title {\n                margin: 0;\n                font-size: 1.25rem;\n                font-weight: 600;\n                color: var(--color-text, #fff);\n            }\n            \n            .picker__close {\n                background: none;\n                border: none;\n                color: var(--color-text-secondary, #999);\n                font-size: 1.5rem;\n                cursor: pointer;\n                padding: 0.25rem 0.5rem;\n                line-height: 1;\n                border-radius: 4px;\n            }\n            \n            .picker__close:hover {\n                background: var(--color-bg-hover, #333);\n            }\n            \n            .picker__search-container {\n                padding: 0.75rem 1rem;\n                border-bottom: 1px solid var(--color-border, #333);\n            }\n            \n            .picker__search {\n                width: 100%;\n                padding: 0.5rem 0.75rem;\n                border: 1px solid var(--color-border, #333);\n                border-radius: 6px;\n                background: var(--color-bg-secondary, #252540);\n                color: var(--color-text, #fff);\n                font-size: 0.9rem;\n            }\n            \n            .picker__search::placeholder {\n                color: var(--color-text-secondary, #999);\n            }\n            \n            .picker__categories {\n                display: flex;\n                gap: 0.5rem;\n                padding: 0.75rem 1rem;\n                overflow-x: auto;\n                border-bottom: 1px solid var(--color-border, #333);\n                -webkit-overflow-scrolling: touch;\n            }\n            \n            .picker__category {\n                display: flex;\n                align-items: center;\n                gap: 0.25rem;\n                padding: 0.375rem 0.625rem;\n                border: 1px solid var(--color-border, #333);\n                border-radius: 16px;\n                background: none;\n                color: var(--color-text-secondary, #999);\n                font-size: 0.8rem;\n                cursor: pointer;\n                white-space: nowrap;\n                transition: all 0.2s ease;\n            }\n            \n            .picker__category:hover {\n                border-color: var(--color-primary, #4361ee);\n                color: var(--color-text, #fff);\n            }\n            \n            .picker__category--active {\n                background: var(--color-primary, #4361ee);\n                border-color: var(--color-primary, #4361ee);\n                color: #fff;\n            }\n            \n            .picker__category-icon {\n                font-size: 1rem;\n            }\n            \n            .picker__fields {\n                flex: 1;\n                overflow-y: auto;\n                padding: 0.5rem;\n            }\n            \n            .picker__empty {\n                text-align: center;\n                color: var(--color-text-secondary, #999);\n                padding: 2rem;\n            }\n            \n            .picker__field {\n                display: flex;\n                align-items: center;\n                gap: 0.75rem;\n                width: 100%;\n                padding: 0.75rem;\n                border: 2px solid transparent;\n                border-radius: 8px;\n                background: var(--color-bg-secondary, #252540);\n                color: var(--color-text, #fff);\n                cursor: pointer;\n                text-align: left;\n                margin-bottom: 0.5rem;\n                transition: all 0.2s ease;\n            }\n            \n            .picker__field:hover {\n                border-color: var(--color-primary, #4361ee);\n            }\n            \n            .picker__field--selected {\n                border-color: var(--color-primary, #4361ee);\n                background: rgba(67, 97, 238, 0.1);\n            }\n            \n            .picker__field-icon {\n                font-size: 1.5rem;\n            }\n            \n            .picker__field-info {\n                flex: 1;\n                min-width: 0;\n            }\n            \n            .picker__field-name {\n                display: block;\n                font-weight: 500;\n                margin-bottom: 0.125rem;\n            }\n            \n            .picker__field-desc {\n                display: block;\n                font-size: 0.75rem;\n                color: var(--color-text-secondary, #999);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            \n            .picker__field-badge {\n                font-size: 0.9rem;\n                opacity: 0.7;\n            }\n            \n            .picker__size-selector {\n                padding: 0.75rem 1rem;\n                border-top: 1px solid var(--color-border, #333);\n                display: flex;\n                align-items: center;\n                gap: 1rem;\n            }\n            \n            .picker__size-label {\n                color: var(--color-text-secondary, #999);\n                font-size: 0.9rem;\n            }\n            \n            .picker__sizes {\n                display: flex;\n                gap: 0.5rem;\n            }\n            \n            .picker__size {\n                width: 2.5rem;\n                height: 2.5rem;\n                border: 2px solid var(--color-border, #333);\n                border-radius: 6px;\n                background: none;\n                color: var(--color-text, #fff);\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            \n            .picker__size:hover {\n                border-color: var(--color-primary, #4361ee);\n            }\n            \n            .picker__size--active {\n                border-color: var(--color-primary, #4361ee);\n                background: var(--color-primary, #4361ee);\n            }\n            \n            .picker__footer {\n                display: flex;\n                justify-content: flex-end;\n                gap: 0.75rem;\n                padding: 1rem;\n                border-top: 1px solid var(--color-border, #333);\n            }\n            \n            .picker__btn {\n                padding: 0.5rem 1rem;\n                border-radius: 6px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            \n            .picker__btn--cancel {\n                background: none;\n                border: 1px solid var(--color-border, #333);\n                color: var(--color-text, #fff);\n            }\n            \n            .picker__btn--cancel:hover {\n                background: var(--color-bg-hover, #333);\n            }\n            \n            .picker__btn--confirm {\n                background: var(--color-primary, #4361ee);\n                border: none;\n                color: #fff;\n            }\n            \n            .picker__btn--confirm:hover:not(:disabled) {\n                background: var(--color-primary-hover, #3451de);\n            }\n            \n            .picker__btn--confirm:disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n        `;\n    }\n\n    // ========================================================================\n    // Event Handling\n    // ========================================================================\n\n    private setupEventListeners(): void {\n        this.shadow.addEventListener('click', this.handleClick.bind(this));\n        this.shadow.addEventListener('input', this.handleInput.bind(this));\n    }\n\n    private removeEventListeners(): void {\n        // Listeners are cleaned up with shadow DOM\n    }\n\n    private handleClick(e: Event): void {\n        const target = e.target as HTMLElement;\n\n        // Check for action buttons\n        const action = target.closest('[data-action]')?.getAttribute('data-action');\n        if (action === 'close') {\n            this.close();\n            return;\n        }\n        if (action === 'confirm') {\n            this.confirmSelection();\n            return;\n        }\n\n        // Check for category selection\n        const categoryBtn = target.closest('[data-category]') as HTMLElement;\n        if (categoryBtn) {\n            this.selectedCategory = categoryBtn.dataset.category as DataFieldCategory | 'all';\n            this.render();\n            return;\n        }\n\n        // Check for field selection\n        const fieldBtn = target.closest('[data-field-id]') as HTMLElement;\n        if (fieldBtn) {\n            const fieldId = fieldBtn.dataset.fieldId!;\n            this.selectedFieldId = fieldId;\n            const field = getDataField(fieldId);\n            if (field) {\n                this.selectedSize = field.defaultSize;\n            }\n            this.render();\n            return;\n        }\n\n        // Check for size selection\n        const sizeBtn = target.closest('[data-size]') as HTMLElement;\n        if (sizeBtn) {\n            this.selectedSize = sizeBtn.dataset.size as DataFieldSize;\n            this.render();\n            return;\n        }\n    }\n\n    private handleInput(e: Event): void {\n        const target = e.target as HTMLElement;\n\n        if (target.classList.contains('picker__search')) {\n            this.searchQuery = (target as HTMLInputElement).value;\n            this.render();\n        }\n    }\n\n    private confirmSelection(): void {\n        if (!this.selectedFieldId) return;\n\n        const field = getDataField(this.selectedFieldId);\n        if (!field) return;\n\n        const event = new CustomEvent<FieldSelectEvent>('select', {\n            detail: {\n                fieldId: this.selectedFieldId,\n                field,\n                size: this.selectedSize,\n            },\n        });\n\n        this.dispatchEvent(event);\n        this.close();\n    }\n\n    // ========================================================================\n    // Helper Methods\n    // ========================================================================\n\n    private getFilteredFields(): DataFieldDefinition[] {\n        let fields: DataFieldDefinition[];\n\n        if (this.searchQuery.trim()) {\n            fields = searchFields(this.searchQuery);\n        } else if (this.selectedCategory === 'all') {\n            fields = [];\n            const categories = getAllCategories();\n            for (const [_cat, catFields] of categories) {\n                fields.push(...catFields);\n            }\n        } else {\n            fields = getFieldsByCategory(this.selectedCategory);\n        }\n\n        return fields;\n    }\n\n    private getAvailableCategories(): (DataFieldCategory | 'all')[] {\n        const categories = getAllCategories();\n        const available: (DataFieldCategory | 'all')[] = ['all'];\n\n        for (const cat of categories.keys()) {\n            available.push(cat);\n        }\n\n        return available;\n    }\n\n    private escapeHtml(str: string): string {\n        const div = document.createElement('div');\n        div.textContent = str;\n        return div.innerHTML;\n    }\n}\n\n// Register the custom element\nif (!customElements.get('bpt-field-picker')) {\n    customElements.define('bpt-field-picker', FieldPickerComponent);\n}\n","/**\n * Screen Editor Web Component\n *\n * Allows users to edit a data screen's configuration:\n * - Add/remove/reorder data fields\n * - Change field sizes\n * - Change screen layout\n *\n * @example\n * ```typescript\n * const editor = document.createElement('bpt-screen-editor') as ScreenEditorComponent;\n * editor.setScreen(myScreen);\n * editor.addEventListener('save', (e) => {\n *   console.log('Updated screen:', e.detail.screen);\n * });\n * ```\n *\n * @module components/data-fields/ScreenEditorComponent\n */\n\nimport type { DataScreen, DataFieldSlot, ScreenLayout } from '../../data-fields/types.js';\nimport { getDataField } from '../../data-fields/registry.js';\nimport {\n    addSlotToScreen,\n    removeSlotFromScreen,\n    updateSlot,\n    reorderSlots,\n} from '../../data-fields/screens.js';\nimport { FieldPickerComponent, type FieldSelectEvent } from './FieldPickerComponent.js';\n\n// Ensure FieldPicker is registered\nimport './FieldPickerComponent.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ScreenSaveEvent {\n    screen: DataScreen;\n}\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Screen editor component for configuring data screens\n */\nexport class ScreenEditorComponent extends HTMLElement {\n    private shadow: ShadowRoot;\n    private screen: DataScreen | null = null;\n    private draggedSlotId: string | null = null;\n    private fieldPicker: FieldPickerComponent | null = null;\n    private editingSlotId: string | null = null;\n\n    // Layout options\n    private static readonly LAYOUTS: { value: ScreenLayout; label: string }[] = [\n        { value: 'auto', label: 'Auto' },\n        { value: 'grid-2', label: '2 Columns' },\n        { value: 'grid-3', label: '3 Columns' },\n        { value: 'grid-4', label: '4 Columns' },\n        { value: 'list', label: 'List' },\n    ];\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n        this.setupEventListeners();\n    }\n\n    disconnectedCallback(): void {\n        this.removeEventListeners();\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Set the screen to edit\n     */\n    public setScreen(screen: DataScreen): void {\n        this.screen = { ...screen, slots: [...screen.slots] };\n        this.render();\n    }\n\n    /**\n     * Get the current screen configuration\n     */\n    public getScreen(): DataScreen | null {\n        return this.screen;\n    }\n\n    /**\n     * Reset to original screen (discard changes)\n     */\n    public reset(originalScreen: DataScreen): void {\n        this.screen = { ...originalScreen, slots: [...originalScreen.slots] };\n        this.render();\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        if (!this.screen) {\n            this.shadow.innerHTML = `\n                <style>${this.getStyles()}</style>\n                <div class=\"editor editor--empty\">\n                    <p>No screen selected</p>\n                </div>\n            `;\n            return;\n        }\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"editor\">\n                <header class=\"editor__header\">\n                    <div class=\"editor__name-group\">\n                        <span class=\"editor__icon\">${this.screen.icon}</span>\n                        <input \n                            type=\"text\" \n                            class=\"editor__name-input\" \n                            value=\"${this.escapeHtml(this.screen.name)}\"\n                            placeholder=\"Screen Name\"\n                            data-action=\"rename\"\n                        >\n                    </div>\n                    <select class=\"editor__layout-select\" data-action=\"layout\">\n                        ${ScreenEditorComponent.LAYOUTS.map(l => `\n                            <option value=\"${l.value}\" ${l.value === this.screen!.layout ? 'selected' : ''}>\n                                ${l.label}\n                            </option>\n                        `).join('')}\n                    </select>\n                </header>\n                \n                <div class=\"editor__slots\">\n                    ${this.screen.slots.length === 0\n                ? '<p class=\"editor__empty\">No fields added yet. Click \"Add Field\" to get started.</p>'\n                : this.screen.slots.map(slot => this.renderSlot(slot)).join('')\n            }\n                </div>\n                \n                <div class=\"editor__actions\">\n                    <button class=\"editor__btn editor__btn--add\" data-action=\"add-field\">\n                        <span>+</span> Add Field\n                    </button>\n                </div>\n                \n                <footer class=\"editor__footer\">\n                    <button class=\"editor__btn editor__btn--cancel\" data-action=\"cancel\">Cancel</button>\n                    <button class=\"editor__btn editor__btn--save\" data-action=\"save\">Save Changes</button>\n                </footer>\n            </div>\n        `;\n    }\n\n    private renderSlot(slot: DataFieldSlot): string {\n        const field = getDataField(slot.fieldId);\n        const fieldName = field?.name ?? 'Unknown Field';\n        const fieldIcon = field?.icon ?? '';\n\n        return `\n            <div \n                class=\"editor__slot\" \n                data-slot-id=\"${slot.id}\"\n                draggable=\"true\"\n            >\n                <div class=\"editor__slot-drag\" title=\"Drag to reorder\"></div>\n                <span class=\"editor__slot-icon\">${fieldIcon}</span>\n                <div class=\"editor__slot-info\">\n                    <span class=\"editor__slot-name\">${this.escapeHtml(fieldName)}</span>\n                    <span class=\"editor__slot-size\">${slot.size}</span>\n                </div>\n                <div class=\"editor__slot-actions\">\n                    <button class=\"editor__slot-btn\" data-action=\"edit-slot\" data-slot-id=\"${slot.id}\" title=\"Edit\">\n                        \n                    </button>\n                    <button class=\"editor__slot-btn editor__slot-btn--delete\" data-action=\"delete-slot\" data-slot-id=\"${slot.id}\" title=\"Remove\">\n                        \n                    </button>\n                </div>\n            </div>\n        `;\n    }\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n            }\n            \n            .editor {\n                background: var(--color-bg, #1a1a2e);\n                border-radius: 12px;\n                overflow: hidden;\n            }\n            \n            .editor--empty {\n                padding: 2rem;\n                text-align: center;\n                color: var(--color-text-secondary, #999);\n            }\n            \n            .editor__header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 1rem;\n                padding: 1rem;\n                border-bottom: 1px solid var(--color-border, #333);\n            }\n            \n            .editor__name-group {\n                display: flex;\n                align-items: center;\n                gap: 0.5rem;\n                flex: 1;\n            }\n            \n            .editor__icon {\n                font-size: 1.5rem;\n            }\n            \n            .editor__name-input {\n                flex: 1;\n                padding: 0.5rem;\n                border: 1px solid transparent;\n                border-radius: 6px;\n                background: transparent;\n                color: var(--color-text, #fff);\n                font-size: 1.125rem;\n                font-weight: 600;\n            }\n            \n            .editor__name-input:hover,\n            .editor__name-input:focus {\n                border-color: var(--color-border, #333);\n                background: var(--color-bg-secondary, #252540);\n            }\n            \n            .editor__layout-select {\n                padding: 0.5rem 0.75rem;\n                border: 1px solid var(--color-border, #333);\n                border-radius: 6px;\n                background: var(--color-bg-secondary, #252540);\n                color: var(--color-text, #fff);\n                font-size: 0.9rem;\n                cursor: pointer;\n            }\n            \n            .editor__slots {\n                padding: 1rem;\n                min-height: 200px;\n            }\n            \n            .editor__empty {\n                text-align: center;\n                color: var(--color-text-secondary, #999);\n                padding: 2rem;\n            }\n            \n            .editor__slot {\n                display: flex;\n                align-items: center;\n                gap: 0.75rem;\n                padding: 0.75rem;\n                background: var(--color-bg-secondary, #252540);\n                border: 2px solid transparent;\n                border-radius: 8px;\n                margin-bottom: 0.5rem;\n                cursor: grab;\n                transition: all 0.2s ease;\n            }\n            \n            .editor__slot:hover {\n                border-color: var(--color-border, #333);\n            }\n            \n            .editor__slot.dragging {\n                opacity: 0.5;\n                cursor: grabbing;\n            }\n            \n            .editor__slot.drag-over {\n                border-color: var(--color-primary, #4361ee);\n                border-style: dashed;\n            }\n            \n            .editor__slot-drag {\n                color: var(--color-text-secondary, #999);\n                font-weight: bold;\n                cursor: grab;\n            }\n            \n            .editor__slot-icon {\n                font-size: 1.25rem;\n            }\n            \n            .editor__slot-info {\n                flex: 1;\n                min-width: 0;\n            }\n            \n            .editor__slot-name {\n                display: block;\n                font-weight: 500;\n                color: var(--color-text, #fff);\n            }\n            \n            .editor__slot-size {\n                display: block;\n                font-size: 0.75rem;\n                color: var(--color-text-secondary, #999);\n                text-transform: uppercase;\n            }\n            \n            .editor__slot-actions {\n                display: flex;\n                gap: 0.25rem;\n            }\n            \n            .editor__slot-btn {\n                background: none;\n                border: none;\n                padding: 0.375rem;\n                cursor: pointer;\n                border-radius: 4px;\n                opacity: 0.6;\n                transition: all 0.2s ease;\n            }\n            \n            .editor__slot-btn:hover {\n                opacity: 1;\n                background: var(--color-bg-hover, #333);\n            }\n            \n            .editor__slot-btn--delete:hover {\n                background: rgba(255, 0, 0, 0.2);\n            }\n            \n            .editor__actions {\n                padding: 0 1rem 1rem;\n            }\n            \n            .editor__btn {\n                padding: 0.625rem 1rem;\n                border-radius: 6px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n            \n            .editor__btn--add {\n                width: 100%;\n                background: var(--color-bg-secondary, #252540);\n                border: 2px dashed var(--color-border, #333);\n                color: var(--color-text, #fff);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 0.5rem;\n            }\n            \n            .editor__btn--add:hover {\n                border-color: var(--color-primary, #4361ee);\n                background: rgba(67, 97, 238, 0.1);\n            }\n            \n            .editor__btn--add span {\n                font-size: 1.25rem;\n                font-weight: bold;\n            }\n            \n            .editor__footer {\n                display: flex;\n                justify-content: flex-end;\n                gap: 0.75rem;\n                padding: 1rem;\n                border-top: 1px solid var(--color-border, #333);\n            }\n            \n            .editor__btn--cancel {\n                background: none;\n                border: 1px solid var(--color-border, #333);\n                color: var(--color-text, #fff);\n            }\n            \n            .editor__btn--cancel:hover {\n                background: var(--color-bg-hover, #333);\n            }\n            \n            .editor__btn--save {\n                background: var(--color-primary, #4361ee);\n                border: none;\n                color: #fff;\n            }\n            \n            .editor__btn--save:hover {\n                background: var(--color-primary-hover, #3451de);\n            }\n        `;\n    }\n\n    // ========================================================================\n    // Event Handling\n    // ========================================================================\n\n    private setupEventListeners(): void {\n        const container = this.shadow.querySelector('.editor') as HTMLElement;\n        if (!container) return;\n\n        this.shadow.addEventListener('click', this.handleClick.bind(this));\n        this.shadow.addEventListener('input', this.handleInput.bind(this));\n        this.shadow.addEventListener('change', this.handleChange.bind(this));\n        container.addEventListener('dragstart', this.handleDragStart.bind(this));\n        container.addEventListener('dragover', this.handleDragOver.bind(this));\n        container.addEventListener('drop', this.handleDrop.bind(this));\n        container.addEventListener('dragend', this.handleDragEnd.bind(this));\n    }\n\n    private removeEventListeners(): void {\n        // Listeners are cleaned up with shadow DOM\n    }\n\n    private handleClick(e: Event): void {\n        const target = e.target as HTMLElement;\n        const actionElement = target.closest('[data-action]') as HTMLElement;\n\n        if (!actionElement) return;\n\n        const action = actionElement.dataset.action;\n        const slotId = actionElement.dataset.slotId;\n\n        switch (action) {\n            case 'add-field':\n                this.openFieldPicker();\n                break;\n            case 'edit-slot':\n                if (slotId) this.editSlot(slotId);\n                break;\n            case 'delete-slot':\n                if (slotId) this.deleteSlot(slotId);\n                break;\n            case 'save':\n                this.saveChanges();\n                break;\n            case 'cancel':\n                this.dispatchEvent(new CustomEvent('cancel'));\n                break;\n        }\n    }\n\n    private handleInput(e: Event): void {\n        const target = e.target as HTMLElement;\n\n        if (target.classList.contains('editor__name-input') && this.screen) {\n            this.screen.name = (target as HTMLInputElement).value;\n        }\n    }\n\n    private handleChange(e: Event): void {\n        const target = e.target as HTMLElement;\n\n        if (target.classList.contains('editor__layout-select') && this.screen) {\n            this.screen.layout = (target as HTMLSelectElement).value as ScreenLayout;\n        }\n    }\n\n    // Drag and drop handlers\n    private handleDragStart(e: DragEvent): void {\n        const slotEl = (e.target as HTMLElement).closest('.editor__slot') as HTMLElement;\n        if (!slotEl) return;\n\n        this.draggedSlotId = slotEl.dataset.slotId ?? null;\n        slotEl.classList.add('dragging');\n\n        if (e.dataTransfer) {\n            e.dataTransfer.effectAllowed = 'move';\n        }\n    }\n\n    private handleDragOver(e: DragEvent): void {\n        e.preventDefault();\n\n        const slotEl = (e.target as HTMLElement).closest('.editor__slot') as HTMLElement;\n        if (!slotEl || slotEl.dataset.slotId === this.draggedSlotId) return;\n\n        // Remove drag-over from all slots\n        this.shadow.querySelectorAll('.editor__slot').forEach(el => {\n            el.classList.remove('drag-over');\n        });\n\n        slotEl.classList.add('drag-over');\n    }\n\n    private handleDrop(e: DragEvent): void {\n        e.preventDefault();\n\n        const targetEl = (e.target as HTMLElement).closest('.editor__slot') as HTMLElement;\n        if (!targetEl || !this.draggedSlotId || !this.screen) return;\n\n        const targetSlotId = targetEl.dataset.slotId;\n        if (!targetSlotId || targetSlotId === this.draggedSlotId) return;\n\n        // Reorder: move dragged slot to target position\n        const currentOrder = this.screen.slots.map(s => s.id);\n        const fromIndex = currentOrder.indexOf(this.draggedSlotId);\n        const toIndex = currentOrder.indexOf(targetSlotId);\n\n        if (fromIndex >= 0 && toIndex >= 0) {\n            // Remove from original position\n            currentOrder.splice(fromIndex, 1);\n            // Insert at new position\n            currentOrder.splice(toIndex, 0, this.draggedSlotId);\n            // Apply new order\n            this.screen = reorderSlots(this.screen, currentOrder);\n            this.render();\n        }\n    }\n\n    private handleDragEnd(_e: DragEvent): void {\n        this.draggedSlotId = null;\n        this.shadow.querySelectorAll('.editor__slot').forEach(el => {\n            el.classList.remove('dragging', 'drag-over');\n        });\n    }\n\n    // ========================================================================\n    // Actions\n    // ========================================================================\n\n    private openFieldPicker(editingSlotId?: string): void {\n        // Create picker if needed\n        if (!this.fieldPicker) {\n            this.fieldPicker = document.createElement('bpt-field-picker') as FieldPickerComponent;\n            this.fieldPicker.addEventListener('select', this.handleFieldSelect.bind(this));\n            this.fieldPicker.addEventListener('close', () => {\n                this.editingSlotId = null;\n            });\n            document.body.appendChild(this.fieldPicker);\n        }\n\n        this.editingSlotId = editingSlotId ?? null;\n\n        // Get pre-selected field ID if editing\n        let preselectedFieldId: string | undefined;\n        if (editingSlotId && this.screen) {\n            const slot = this.screen.slots.find(s => s.id === editingSlotId);\n            preselectedFieldId = slot?.fieldId;\n        }\n\n        this.fieldPicker.open(preselectedFieldId);\n    }\n\n    private handleFieldSelect(e: Event): void {\n        const detail = (e as CustomEvent<FieldSelectEvent>).detail;\n\n        if (!this.screen) return;\n\n        if (this.editingSlotId) {\n            // Update existing slot\n            this.screen = updateSlot(this.screen, this.editingSlotId, {\n                fieldId: detail.fieldId,\n                size: detail.size,\n            });\n        } else {\n            // Add new slot using fieldId and size\n            this.screen = addSlotToScreen(this.screen, detail.fieldId, detail.size);\n        }\n\n        this.editingSlotId = null;\n        this.render();\n    }\n\n    private editSlot(slotId: string): void {\n        this.openFieldPicker(slotId);\n    }\n\n    private deleteSlot(slotId: string): void {\n        if (!this.screen) return;\n\n        this.screen = removeSlotFromScreen(this.screen, slotId);\n        this.render();\n    }\n\n    private saveChanges(): void {\n        if (!this.screen) return;\n\n        this.dispatchEvent(new CustomEvent<ScreenSaveEvent>('save', {\n            detail: { screen: this.screen },\n        }));\n    }\n\n    // ========================================================================\n    // Helper Methods\n    // ========================================================================\n\n    private escapeHtml(str: string): string {\n        const div = document.createElement('div');\n        div.textContent = str;\n        return div.innerHTML;\n    }\n}\n\n// Register the custom element\nif (!customElements.get('bpt-screen-editor')) {\n    customElements.define('bpt-screen-editor', ScreenEditorComponent);\n}\n","/**\n * Profile Settings Web Component\n *\n * Settings UI for managing activity profiles and data screens.\n * Allows users to:\n * - Select active profile\n * - Enable/disable screens within a profile\n * - Reorder screens\n * - Create new screens\n * - Edit existing screens\n *\n * @example\n * ```typescript\n * const settings = document.createElement('bpt-profile-settings') as ProfileSettingsComponent;\n * settings.addEventListener('profile-changed', (e) => {\n *   console.log('Profile updated:', e.detail.profile);\n * });\n * ```\n *\n * @module components/data-fields/ProfileSettingsComponent\n */\n\nimport type { ActivityProfile, DataScreen } from '../../data-fields/types.js';\nimport {\n    loadDataFieldSettings,\n    saveDataFieldSettings,\n    loadActiveProfile,\n} from '../../data-fields/persistence.js';\nimport { DEFAULT_PROFILES } from '../../data-fields/defaults.js';\nimport { generateScreenId, createEmptyScreen } from '../../data-fields/screens.js';\nimport type { ScreenEditorComponent } from './ScreenEditorComponent.js';\n\n// Ensure ScreenEditor is registered\nimport './ScreenEditorComponent.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface ProfileChangedEvent {\n    profile: ActivityProfile;\n}\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Profile settings component for managing data screens\n */\nexport class ProfileSettingsComponent extends HTMLElement {\n    private shadow: ShadowRoot;\n    private settings = loadDataFieldSettings();\n    private activeProfile: ActivityProfile;\n    private draggedScreenId: string | null = null;\n    private editingScreen: DataScreen | null = null;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n        this.activeProfile = loadActiveProfile();\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n        this.setupEventListeners();\n    }\n\n    disconnectedCallback(): void {\n        this.removeEventListeners();\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Refresh the component with latest settings\n     */\n    public refresh(): void {\n        this.settings = loadDataFieldSettings();\n        this.activeProfile = loadActiveProfile();\n        this.render();\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"profile-settings\">\n                ${this.renderProfileSelector()}\n                ${this.renderScreensList()}\n                ${this.renderScreenActions()}\n            </div>\n            ${this.renderScreenEditorModal()}\n        `;\n\n        // Re-setup event listeners after render\n        this.setupEventListeners();\n    }\n\n    private renderProfileSelector(): string {\n        const profiles = this.settings.profiles;\n        const activeId = this.settings.activeProfileId;\n\n        return `\n            <div class=\"profile-selector\">\n                <label for=\"profile-select\">Activity Profile:</label>\n                <select id=\"profile-select\" class=\"profile-dropdown\">\n                    ${profiles.map(p => `\n                        <option value=\"${p.id}\" ${p.id === activeId ? 'selected' : ''}>\n                            ${p.icon} ${p.name}\n                        </option>\n                    `).join('')}\n                </select>\n                <button class=\"btn-icon btn-add-profile\" title=\"Add Profile\" aria-label=\"Add new profile\">\n                    \n                </button>\n            </div>\n            <p class=\"profile-description\">\n                ${this.activeProfile.screens.length} screen${this.activeProfile.screens.length !== 1 ? 's' : ''}  \n                Swipe or tap dots to switch screens during workout\n            </p>\n        `;\n    }\n\n    private renderScreensList(): string {\n        const screens = this.activeProfile.screens;\n\n        if (screens.length === 0) {\n            return `\n                <div class=\"screens-empty\">\n                    <p>No screens configured.</p>\n                    <button class=\"btn-primary btn-add-screen\"> Add Screen</button>\n                </div>\n            `;\n        }\n\n        return `\n            <div class=\"screens-list\" role=\"list\" aria-label=\"Data screens\">\n                ${screens.map((screen, index) => this.renderScreenItem(screen, index)).join('')}\n            </div>\n        `;\n    }\n\n    private renderScreenItem(screen: DataScreen, index: number): string {\n        const isActive = index === this.activeProfile.activeScreenIndex;\n\n        return `\n            <div class=\"screen-item ${isActive ? 'screen-item--active' : ''}\"\n                 role=\"listitem\"\n                 draggable=\"true\"\n                 data-screen-id=\"${screen.id}\"\n                 data-index=\"${index}\">\n                <div class=\"screen-drag-handle\" aria-hidden=\"true\"></div>\n                <div class=\"screen-icon\">${screen.icon}</div>\n                <div class=\"screen-info\">\n                    <div class=\"screen-name\">${screen.name}</div>\n                    <div class=\"screen-details\">${screen.slots.length} field${screen.slots.length !== 1 ? 's' : ''}</div>\n                </div>\n                <div class=\"screen-actions\">\n                    <button class=\"btn-icon btn-edit-screen\" \n                            data-screen-id=\"${screen.id}\"\n                            title=\"Edit screen\"\n                            aria-label=\"Edit ${screen.name} screen\">\n                        \n                    </button>\n                    <button class=\"btn-icon btn-duplicate-screen\" \n                            data-screen-id=\"${screen.id}\"\n                            title=\"Duplicate screen\"\n                            aria-label=\"Duplicate ${screen.name} screen\">\n                        \n                    </button>\n                    <button class=\"btn-icon btn-delete-screen ${this.activeProfile.screens.length <= 1 ? 'btn-disabled' : ''}\" \n                            data-screen-id=\"${screen.id}\"\n                            title=\"Delete screen\"\n                            aria-label=\"Delete ${screen.name} screen\"\n                            ${this.activeProfile.screens.length <= 1 ? 'disabled' : ''}>\n                        \n                    </button>\n                </div>\n            </div>\n        `;\n    }\n\n    private renderScreenActions(): string {\n        return `\n            <div class=\"screen-actions-bar\">\n                <button class=\"btn-secondary btn-add-screen\">\n                     Add Screen\n                </button>\n                <button class=\"btn-secondary btn-reset-profile\" title=\"Reset to default screens\">\n                     Reset to Defaults\n                </button>\n            </div>\n        `;\n    }\n\n    private renderScreenEditorModal(): string {\n        return `\n            <div class=\"screen-editor-modal\" id=\"screenEditorModal\" style=\"display: none;\">\n                <div class=\"modal-backdrop\"></div>\n                <div class=\"modal-content\">\n                    <div class=\"modal-header\">\n                        <h3 id=\"screenEditorTitle\">Edit Screen</h3>\n                        <button class=\"btn-close\" id=\"closeScreenEditor\" aria-label=\"Close\">&times;</button>\n                    </div>\n                    <div class=\"modal-body\">\n                        <bpt-screen-editor id=\"screenEditor\"></bpt-screen-editor>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button class=\"btn-secondary\" id=\"cancelScreenEdit\">Cancel</button>\n                        <button class=\"btn-primary\" id=\"saveScreenEdit\">Save Changes</button>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n                font-family: var(--font-family, system-ui, -apple-system, sans-serif);\n            }\n\n            .profile-settings {\n                display: flex;\n                flex-direction: column;\n                gap: 16px;\n            }\n\n            /* Profile Selector */\n            .profile-selector {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                flex-wrap: wrap;\n            }\n\n            .profile-selector label {\n                font-weight: 500;\n                font-size: 14px;\n                color: var(--color-text-secondary, #666);\n            }\n\n            .profile-dropdown {\n                flex: 1;\n                min-width: 180px;\n                padding: 8px 12px;\n                border: 1px solid var(--color-border, #d0d7de);\n                border-radius: 6px;\n                font-size: 16px;\n                background: var(--input-bg, white);\n                color: var(--color-text-primary, #1a1a1a);\n            }\n\n            .profile-description {\n                font-size: 13px;\n                color: var(--color-text-secondary, #666);\n                margin: -8px 0 8px;\n            }\n\n            /* Screens List */\n            .screens-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                min-height: 100px;\n            }\n\n            .screens-empty {\n                text-align: center;\n                padding: 24px;\n                background: var(--bg-secondary, #f6f8fa);\n                border-radius: 8px;\n                color: var(--color-text-secondary, #666);\n            }\n\n            .screen-item {\n                display: flex;\n                align-items: center;\n                gap: 12px;\n                padding: 12px;\n                background: var(--bg-secondary, #f6f8fa);\n                border: 1px solid var(--color-border, #d0d7de);\n                border-radius: 8px;\n                cursor: grab;\n                transition: all 0.15s ease;\n            }\n\n            .screen-item:hover {\n                border-color: var(--color-primary, #2196F3);\n                background: var(--bg-primary, white);\n            }\n\n            .screen-item--active {\n                border-color: var(--color-primary, #2196F3);\n                border-width: 2px;\n                background: var(--bg-primary, white);\n            }\n\n            .screen-item--dragging {\n                opacity: 0.5;\n                transform: scale(0.98);\n            }\n\n            .screen-item--drag-over {\n                border-style: dashed;\n                border-color: var(--color-primary, #2196F3);\n            }\n\n            .screen-drag-handle {\n                color: var(--color-text-secondary, #666);\n                font-size: 14px;\n                cursor: grab;\n                padding: 4px;\n                user-select: none;\n            }\n\n            .screen-icon {\n                font-size: 24px;\n                width: 36px;\n                text-align: center;\n            }\n\n            .screen-info {\n                flex: 1;\n                min-width: 0;\n            }\n\n            .screen-name {\n                font-weight: 500;\n                font-size: 15px;\n                color: var(--color-text-primary, #1a1a1a);\n            }\n\n            .screen-details {\n                font-size: 13px;\n                color: var(--color-text-secondary, #666);\n            }\n\n            .screen-actions {\n                display: flex;\n                gap: 4px;\n            }\n\n            /* Buttons */\n            .btn-icon {\n                padding: 6px 8px;\n                border: none;\n                background: transparent;\n                cursor: pointer;\n                font-size: 16px;\n                border-radius: 4px;\n                transition: background 0.15s ease;\n            }\n\n            .btn-icon:hover {\n                background: var(--color-border, #d0d7de);\n            }\n\n            .btn-icon.btn-disabled {\n                opacity: 0.4;\n                cursor: not-allowed;\n            }\n\n            .btn-icon.btn-disabled:hover {\n                background: transparent;\n            }\n\n            .btn-primary {\n                padding: 10px 16px;\n                border: none;\n                background: var(--color-primary, #2196F3);\n                color: white;\n                border-radius: 6px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: background 0.15s ease;\n            }\n\n            .btn-primary:hover {\n                background: var(--color-primary-dark, #1976D2);\n            }\n\n            .btn-secondary {\n                padding: 10px 16px;\n                border: 1px solid var(--color-border, #d0d7de);\n                background: var(--bg-primary, white);\n                color: var(--color-text-primary, #1a1a1a);\n                border-radius: 6px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.15s ease;\n            }\n\n            .btn-secondary:hover {\n                background: var(--bg-secondary, #f6f8fa);\n            }\n\n            .screen-actions-bar {\n                display: flex;\n                gap: 8px;\n                flex-wrap: wrap;\n                padding-top: 8px;\n                border-top: 1px solid var(--color-border, #d0d7de);\n            }\n\n            /* Modal */\n            .screen-editor-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                z-index: 1000;\n            }\n\n            .modal-backdrop {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0, 0, 0, 0.5);\n            }\n\n            .modal-content {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 90%;\n                max-width: 600px;\n                max-height: 90vh;\n                background: var(--bg-primary, white);\n                border-radius: 12px;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n\n            .modal-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 16px 20px;\n                border-bottom: 1px solid var(--color-border, #d0d7de);\n            }\n\n            .modal-header h3 {\n                margin: 0;\n                font-size: 18px;\n            }\n\n            .btn-close {\n                padding: 4px 8px;\n                border: none;\n                background: transparent;\n                font-size: 24px;\n                cursor: pointer;\n                color: var(--color-text-secondary, #666);\n            }\n\n            .modal-body {\n                flex: 1;\n                overflow-y: auto;\n                padding: 20px;\n            }\n\n            .modal-footer {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                padding: 16px 20px;\n                border-top: 1px solid var(--color-border, #d0d7de);\n            }\n\n            /* Add Profile Dialog */\n            .add-profile-dialog {\n                padding: 20px;\n            }\n\n            .form-group {\n                margin-bottom: 16px;\n            }\n\n            .form-group label {\n                display: block;\n                margin-bottom: 6px;\n                font-weight: 500;\n                font-size: 14px;\n            }\n\n            .form-input {\n                width: 100%;\n                padding: 10px 12px;\n                border: 1px solid var(--color-border, #d0d7de);\n                border-radius: 6px;\n                font-size: 16px;\n            }\n\n            .template-options {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .template-option {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 12px;\n                border: 1px solid var(--color-border, #d0d7de);\n                border-radius: 8px;\n                cursor: pointer;\n                transition: all 0.15s ease;\n            }\n\n            .template-option:hover {\n                border-color: var(--color-primary, #2196F3);\n            }\n\n            .template-option input {\n                width: 18px;\n                height: 18px;\n            }\n        `;\n    }\n\n    // ========================================================================\n    // Event Handling\n    // ========================================================================\n\n    private setupEventListeners(): void {\n        // Profile selector\n        const profileSelect = this.shadow.getElementById('profile-select') as HTMLSelectElement;\n        profileSelect?.addEventListener('change', this.handleProfileChange.bind(this));\n\n        // Add profile button\n        const addProfileBtn = this.shadow.querySelector('.btn-add-profile');\n        addProfileBtn?.addEventListener('click', this.handleAddProfile.bind(this));\n\n        // Add screen button\n        const addScreenBtns = this.shadow.querySelectorAll('.btn-add-screen');\n        addScreenBtns.forEach(btn => btn.addEventListener('click', this.handleAddScreen.bind(this)));\n\n        // Reset profile button\n        const resetBtn = this.shadow.querySelector('.btn-reset-profile');\n        resetBtn?.addEventListener('click', this.handleResetProfile.bind(this));\n\n        // Screen item actions\n        this.shadow.querySelectorAll('.btn-edit-screen').forEach(btn => {\n            btn.addEventListener('click', this.handleEditScreen.bind(this));\n        });\n\n        this.shadow.querySelectorAll('.btn-duplicate-screen').forEach(btn => {\n            btn.addEventListener('click', this.handleDuplicateScreen.bind(this));\n        });\n\n        this.shadow.querySelectorAll('.btn-delete-screen').forEach(btn => {\n            btn.addEventListener('click', this.handleDeleteScreen.bind(this));\n        });\n\n        // Drag and drop - cast Event to DragEvent in wrappers\n        this.shadow.querySelectorAll('.screen-item').forEach(item => {\n            const htmlItem = item as HTMLElement;\n            htmlItem.addEventListener('dragstart', (e: Event) => this.handleDragStart(e as DragEvent));\n            htmlItem.addEventListener('dragend', (e: Event) => this.handleDragEnd(e as DragEvent));\n            htmlItem.addEventListener('dragover', (e: Event) => this.handleDragOver(e as DragEvent));\n            htmlItem.addEventListener('dragleave', (e: Event) => this.handleDragLeave(e as DragEvent));\n            htmlItem.addEventListener('drop', (e: Event) => this.handleDrop(e as DragEvent));\n        });\n\n        // Modal controls\n        const closeBtn = this.shadow.getElementById('closeScreenEditor');\n        closeBtn?.addEventListener('click', this.closeScreenEditor.bind(this));\n\n        const cancelBtn = this.shadow.getElementById('cancelScreenEdit');\n        cancelBtn?.addEventListener('click', this.closeScreenEditor.bind(this));\n\n        const saveBtn = this.shadow.getElementById('saveScreenEdit');\n        saveBtn?.addEventListener('click', this.handleSaveScreen.bind(this));\n\n        const backdrop = this.shadow.querySelector('.modal-backdrop');\n        backdrop?.addEventListener('click', this.closeScreenEditor.bind(this));\n    }\n\n    private removeEventListeners(): void {\n        // Event listeners are cleaned up when shadow DOM is replaced\n    }\n\n    // ========================================================================\n    // Profile Actions\n    // ========================================================================\n\n    private handleProfileChange(e: Event): void {\n        const select = e.target as HTMLSelectElement;\n        const profileId = select.value;\n\n        this.settings.activeProfileId = profileId;\n        saveDataFieldSettings(this.settings);\n\n        const profile = this.settings.profiles.find(p => p.id === profileId);\n        if (profile) {\n            this.activeProfile = profile;\n            this.render();\n            this.dispatchProfileChanged();\n        }\n    }\n\n    private handleAddProfile(): void {\n        const name = prompt('Enter profile name:', 'My Profile');\n        if (!name) return;\n\n        // Find a template to use\n        const templateProfile = DEFAULT_PROFILES.find(p => p.activityType === 'cycling') || DEFAULT_PROFILES[0];\n\n        const newProfile: ActivityProfile = {\n            id: `profile-${Date.now()}`,\n            name,\n            activityType: templateProfile.activityType,\n            icon: templateProfile.icon,\n            screens: JSON.parse(JSON.stringify(templateProfile.screens)),\n            activeScreenIndex: 0,\n        };\n\n        this.settings.profiles.push(newProfile);\n        this.settings.activeProfileId = newProfile.id;\n        saveDataFieldSettings(this.settings);\n\n        this.activeProfile = newProfile;\n        this.render();\n        this.dispatchProfileChanged();\n    }\n\n    private handleResetProfile(): void {\n        if (!confirm('Reset all screens to defaults? Your custom screens will be lost.')) {\n            return;\n        }\n\n        const defaultProfile = DEFAULT_PROFILES.find(\n            p => p.activityType === this.activeProfile.activityType\n        ) || DEFAULT_PROFILES[0];\n\n        this.activeProfile.screens = JSON.parse(JSON.stringify(defaultProfile.screens));\n        this.activeProfile.activeScreenIndex = 0;\n        this.saveCurrentProfile();\n        this.render();\n        this.dispatchProfileChanged();\n    }\n\n    // ========================================================================\n    // Screen Actions\n    // ========================================================================\n\n    private handleAddScreen(): void {\n        const newScreen = createEmptyScreen(\n            `Screen ${this.activeProfile.screens.length + 1}`,\n            ''\n        );\n        this.activeProfile.screens.push(newScreen);\n        this.saveCurrentProfile();\n        this.render();\n        this.dispatchProfileChanged();\n\n        // Open editor for the new screen\n        this.openScreenEditor(newScreen, true);\n    }\n\n    private handleEditScreen(e: Event): void {\n        const btn = e.currentTarget as HTMLElement;\n        const screenId = btn.dataset.screenId;\n        const screen = this.activeProfile.screens.find(s => s.id === screenId);\n        if (screen) {\n            this.openScreenEditor(screen, false);\n        }\n    }\n\n    private handleDuplicateScreen(e: Event): void {\n        const btn = e.currentTarget as HTMLElement;\n        const screenId = btn.dataset.screenId;\n        const screen = this.activeProfile.screens.find(s => s.id === screenId);\n\n        if (screen) {\n            const duplicate: DataScreen = {\n                ...JSON.parse(JSON.stringify(screen)),\n                id: generateScreenId(),\n                name: `${screen.name} (Copy)`,\n            };\n            this.activeProfile.screens.push(duplicate);\n            this.saveCurrentProfile();\n            this.render();\n            this.dispatchProfileChanged();\n        }\n    }\n\n    private handleDeleteScreen(e: Event): void {\n        const btn = e.currentTarget as HTMLElement;\n        if (btn.classList.contains('btn-disabled')) return;\n\n        const screenId = btn.dataset.screenId;\n        const screen = this.activeProfile.screens.find(s => s.id === screenId);\n\n        if (screen && confirm(`Delete \"${screen.name}\" screen?`)) {\n            const index = this.activeProfile.screens.findIndex(s => s.id === screenId);\n            this.activeProfile.screens.splice(index, 1);\n\n            // Adjust active index if needed\n            if (this.activeProfile.activeScreenIndex >= this.activeProfile.screens.length) {\n                this.activeProfile.activeScreenIndex = Math.max(0, this.activeProfile.screens.length - 1);\n            }\n\n            this.saveCurrentProfile();\n            this.render();\n            this.dispatchProfileChanged();\n        }\n    }\n\n    // ========================================================================\n    // Drag and Drop\n    // ========================================================================\n\n    private handleDragStart(e: DragEvent): void {\n        const item = e.currentTarget as HTMLElement;\n        item.classList.add('screen-item--dragging');\n        this.draggedScreenId = item.dataset.screenId || null;\n\n        if (e.dataTransfer) {\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/plain', this.draggedScreenId || '');\n        }\n    }\n\n    private handleDragEnd(e: DragEvent): void {\n        const item = e.currentTarget as HTMLElement;\n        item.classList.remove('screen-item--dragging');\n        this.draggedScreenId = null;\n\n        // Remove all drag-over classes\n        this.shadow.querySelectorAll('.screen-item--drag-over').forEach(el => {\n            el.classList.remove('screen-item--drag-over');\n        });\n    }\n\n    private handleDragOver(e: DragEvent): void {\n        e.preventDefault();\n        const item = e.currentTarget as HTMLElement;\n        if (item.dataset.screenId !== this.draggedScreenId) {\n            item.classList.add('screen-item--drag-over');\n        }\n    }\n\n    private handleDragLeave(e: DragEvent): void {\n        const item = e.currentTarget as HTMLElement;\n        item.classList.remove('screen-item--drag-over');\n    }\n\n    private handleDrop(e: DragEvent): void {\n        e.preventDefault();\n        const dropTarget = e.currentTarget as HTMLElement;\n        dropTarget.classList.remove('screen-item--drag-over');\n\n        const draggedId = this.draggedScreenId;\n        const targetId = dropTarget.dataset.screenId;\n\n        if (draggedId && targetId && draggedId !== targetId) {\n            const screens = this.activeProfile.screens;\n            const draggedIndex = screens.findIndex(s => s.id === draggedId);\n            const targetIndex = screens.findIndex(s => s.id === targetId);\n\n            if (draggedIndex !== -1 && targetIndex !== -1) {\n                // Reorder screens\n                const [draggedScreen] = screens.splice(draggedIndex, 1);\n                screens.splice(targetIndex, 0, draggedScreen);\n\n                // Update active screen index if needed\n                if (this.activeProfile.activeScreenIndex === draggedIndex) {\n                    this.activeProfile.activeScreenIndex = targetIndex;\n                } else if (\n                    this.activeProfile.activeScreenIndex > draggedIndex &&\n                    this.activeProfile.activeScreenIndex <= targetIndex\n                ) {\n                    this.activeProfile.activeScreenIndex--;\n                } else if (\n                    this.activeProfile.activeScreenIndex < draggedIndex &&\n                    this.activeProfile.activeScreenIndex >= targetIndex\n                ) {\n                    this.activeProfile.activeScreenIndex++;\n                }\n\n                this.saveCurrentProfile();\n                this.render();\n                this.dispatchProfileChanged();\n            }\n        }\n    }\n\n    // ========================================================================\n    // Screen Editor Modal\n    // ========================================================================\n\n    private openScreenEditor(screen: DataScreen, isNew: boolean): void {\n        this.editingScreen = screen;\n\n        const modal = this.shadow.getElementById('screenEditorModal');\n        const title = this.shadow.getElementById('screenEditorTitle');\n        const editor = this.shadow.getElementById('screenEditor') as ScreenEditorComponent;\n\n        if (modal && title && editor) {\n            title.textContent = isNew ? 'New Screen' : `Edit: ${screen.name}`;\n            editor.setScreen(screen);\n            modal.style.display = 'block';\n        }\n    }\n\n    private closeScreenEditor(): void {\n        const modal = this.shadow.getElementById('screenEditorModal');\n        if (modal) {\n            modal.style.display = 'none';\n        }\n        this.editingScreen = null;\n    }\n\n    private handleSaveScreen(): void {\n        const editor = this.shadow.getElementById('screenEditor') as ScreenEditorComponent;\n        const updatedScreen = editor?.getScreen();\n\n        if (updatedScreen && this.editingScreen) {\n            const index = this.activeProfile.screens.findIndex(\n                s => s.id === this.editingScreen!.id\n            );\n\n            if (index !== -1) {\n                this.activeProfile.screens[index] = updatedScreen;\n            } else {\n                // New screen - already added when created\n                const newIndex = this.activeProfile.screens.findIndex(\n                    s => s.id === updatedScreen.id\n                );\n                if (newIndex !== -1) {\n                    this.activeProfile.screens[newIndex] = updatedScreen;\n                }\n            }\n\n            this.saveCurrentProfile();\n            this.closeScreenEditor();\n            this.render();\n            this.dispatchProfileChanged();\n        }\n    }\n\n    // ========================================================================\n    // Persistence & Events\n    // ========================================================================\n\n    private saveCurrentProfile(): void {\n        const index = this.settings.profiles.findIndex(p => p.id === this.activeProfile.id);\n        if (index !== -1) {\n            this.settings.profiles[index] = this.activeProfile;\n            saveDataFieldSettings(this.settings);\n        }\n    }\n\n    private dispatchProfileChanged(): void {\n        const event = new CustomEvent<ProfileChangedEvent>('profile-changed', {\n            detail: { profile: this.activeProfile },\n            bubbles: true,\n            composed: true,\n        });\n        this.dispatchEvent(event);\n\n        // Also dispatch to document for other listeners\n        document.dispatchEvent(\n            new CustomEvent('data-fields-profile-changed', {\n                detail: { profile: this.activeProfile },\n            })\n        );\n    }\n}\n\n// Register the custom element\nif (!customElements.get('bpt-profile-settings')) {\n    customElements.define('bpt-profile-settings', ProfileSettingsComponent);\n}\n","/**\n * Data Field Components\n * \n * Web Components for displaying and interacting with data fields.\n * \n * @module components/data-fields\n */\n\n// Export components\nexport { DataFieldComponent } from './DataFieldComponent.js';\nexport { DataScreenComponent } from './DataScreenComponent.js';\nexport { ScreenCarouselComponent } from './ScreenCarouselComponent.js';\nexport { FieldPickerComponent } from './FieldPickerComponent.js';\nexport { ScreenEditorComponent } from './ScreenEditorComponent.js';\nexport { ProfileSettingsComponent } from './ProfileSettingsComponent.js';\n\n// Export types\nexport type { ScreenChangeEvent } from './ScreenCarouselComponent.js';\nexport type { FieldSelectEvent } from './FieldPickerComponent.js';\nexport type { ScreenSaveEvent } from './ScreenEditorComponent.js';\nexport type { ProfileChangedEvent } from './ProfileSettingsComponent.js';\n\n// Re-export for convenience - ensures all components are registered\nimport './DataFieldComponent.js';\nimport './DataScreenComponent.js';\nimport './ScreenCarouselComponent.js';\nimport './FieldPickerComponent.js';\nimport './ScreenEditorComponent.js';\nimport './ProfileSettingsComponent.js';\n\n/**\n * Register all data field components.\n * Components are auto-registered on import, but this provides an explicit way\n * to ensure registration has occurred.\n */\nexport function registerDataFieldComponents(): void {\n    // Components are registered by their imports above.\n    // This function exists for explicit registration semantics.\n    console.log('[DataFieldComponents] Components registered');\n}","/**\n * IndexedDB Storage for Workout Data\n * \n * Provides persistent storage for workout recordings using IndexedDB.\n * This ensures workout data survives page refreshes, crashes, and accidental closures.\n * \n * @module storage/workoutStorage\n */\n\nimport type { MeasurementsData, Measurement, LapMarker, GpsPoint, TreadmillMeasurement } from '../types/measurements.js';\n\nconst DB_NAME = 'BikeTrackerDB';\nconst DB_VERSION = 4; // Bump version for schema change\nconst STORE_NAME = 'activeWorkout';\nconst COMPLETED_STORE = 'completedWorkouts';\nconst DEBUG_STORE = 'rawDebugData';\n\n/**\n * Raw Debug Log Entry\n */\nexport interface DebugLogEntry {\n    id?: number;\n    timestamp: number;\n    sensor: string;\n    data: string; // Hex representation\n}\n\n/**\n * Stored workout data with metadata\n */\nexport interface StoredWorkout {\n    id: string;\n    startTime: number;\n    lastUpdated: number;\n    measurements: MeasurementsData;\n    isCompleted: boolean;\n    synced?: boolean;\n    syncedTime?: number;\n}\n\n/**\n * Active workout record for recovery\n */\nexport interface ActiveWorkoutRecord {\n    id: 'current';\n    startTime: number;\n    lastUpdated: number;\n    heartrate: Measurement[];\n    power: Measurement[];\n    cadence: Measurement[];\n    speed: Measurement[];\n    distance: Measurement[];\n    altitude: Measurement[];\n    gps: GpsPoint[];\n    treadmill: TreadmillMeasurement[];\n    laps: LapMarker[];\n}\n\nlet db: IDBDatabase | null = null;\n\n/**\n * Opens the IndexedDB database, creating stores if needed\n */\nexport async function openDatabase(): Promise<IDBDatabase> {\n    if (db) return db;\n\n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n        request.onerror = () => {\n            console.error('Failed to open IndexedDB:', request.error);\n            reject(request.error);\n        };\n\n        request.onsuccess = () => {\n            db = request.result;\n            resolve(db);\n        };\n\n        request.onupgradeneeded = (event) => {\n            const database = (event.target as IDBOpenDBRequest).result;\n\n            // Store for the currently active workout (single record)\n            if (!database.objectStoreNames.contains(STORE_NAME)) {\n                database.createObjectStore(STORE_NAME, { keyPath: 'id' });\n            }\n\n            // Store for completed workouts (backup/history)\n            if (!database.objectStoreNames.contains(COMPLETED_STORE)) {\n                const completedStore = database.createObjectStore(COMPLETED_STORE, { keyPath: 'id' });\n                completedStore.createIndex('startTime', 'startTime', { unique: false });\n            }\n\n            // Store for raw debug data\n            if (!database.objectStoreNames.contains(DEBUG_STORE)) {\n                const debugStore = database.createObjectStore(DEBUG_STORE, { keyPath: 'id', autoIncrement: true });\n                debugStore.createIndex('timestamp', 'timestamp', { unique: false });\n                debugStore.createIndex('sensor', 'sensor', { unique: false });\n            }\n        };\n    });\n}\n\n/**\n * Save a raw debug log entry\n */\nexport async function saveDebugLog(sensor: string, data: string): Promise<void> {\n    try {\n        const database = await openDatabase();\n        const record: DebugLogEntry = {\n            timestamp: Date.now(),\n            sensor,\n            data\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([DEBUG_STORE], 'readwrite');\n            const store = transaction.objectStore(DEBUG_STORE);\n            const request = store.add(record); // Using add since key is auto-increment\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not save debug log:', e);\n    }\n}\n\n/**\n * Get all debug logs\n */\nexport async function getDebugLogs(): Promise<DebugLogEntry[]> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([DEBUG_STORE], 'readonly');\n            const store = transaction.objectStore(DEBUG_STORE);\n            const index = store.index('timestamp');\n            const request = index.getAll();\n\n            request.onsuccess = () => resolve(request.result || []);\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not load debug logs:', e);\n        return [];\n    }\n}\n\n/**\n * Clear all debug logs\n */\nexport async function clearDebugLogs(): Promise<void> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([DEBUG_STORE], 'readwrite');\n            const store = transaction.objectStore(DEBUG_STORE);\n            const request = store.clear();\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not clear debug logs:', e);\n    }\n}\n\n/**\n * Saves the current workout state to IndexedDB\n */\nexport async function saveActiveWorkout(\n    measurements: MeasurementsData,\n    startTime: number | null\n): Promise<void> {\n    try {\n        const database = await openDatabase();\n\n        const record: ActiveWorkoutRecord = {\n            id: 'current',\n            startTime: startTime ?? Date.now(),\n            lastUpdated: Date.now(),\n            heartrate: measurements.heartrate,\n            power: measurements.power,\n            cadence: measurements.cadence,\n            speed: measurements.speed,\n            distance: measurements.distance,\n            altitude: measurements.altitude,\n            gps: measurements.gps,\n            treadmill: measurements.treadmill || [],\n            laps: measurements.laps || [],\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.put(record);\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not save active workout:', e);\n    }\n}\n\n/**\n * Clear the active workout from storage\n */\nexport async function clearActiveWorkout(): Promise<void> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.delete('current');\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not clear active workout:', e);\n    }\n}\n\n/**\n * Load the active workout from storage\n */\nexport async function loadActiveWorkout(): Promise<ActiveWorkoutRecord | null> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([STORE_NAME], 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.get('current');\n\n            request.onsuccess = () => {\n                if (request.result) {\n                    // Normalize optional arrays if missing in older DB versions\n                    const record = request.result;\n                    if (!record.treadmill) record.treadmill = [];\n                    if (!record.laps) record.laps = [];\n                    resolve(record);\n                } else {\n                    resolve(null);\n                }\n            };\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not load active workout:', e);\n        return null;\n    }\n}\n\n/**\n * Save a completed workout to history\n */\nexport async function saveCompletedWorkout(\n    measurements: MeasurementsData,\n    startTime: number,\n    endTime: number\n): Promise<string> {\n    const id = `workout_${startTime}`;\n\n    try {\n        const database = await openDatabase();\n\n        const record: StoredWorkout = {\n            id,\n            startTime,\n            lastUpdated: endTime,\n            isCompleted: true,\n            measurements: { ...measurements }, // Clone\n            synced: false\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([COMPLETED_STORE], 'readwrite');\n            const store = transaction.objectStore(COMPLETED_STORE);\n            const request = store.put(record);\n\n            request.onsuccess = () => resolve(id);\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.error('Failed to save completed workout:', e);\n        throw e;\n    }\n}\n\n/**\n * Get all completed workouts from history\n */\nexport async function getWorkoutHistory(): Promise<StoredWorkout[]> {\n    try {\n        const database = await openDatabase();\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([COMPLETED_STORE], 'readonly');\n            const store = transaction.objectStore(COMPLETED_STORE);\n            const index = store.index('startTime');\n            // Get all, sorted by start time (newest first requires manual reverse or cursor)\n            const request = index.getAll();\n\n            request.onsuccess = () => {\n                // Return newest first\n                resolve((request.result || []).reverse());\n            };\n            request.onerror = () => reject(request.error);\n        });\n    } catch (e) {\n        console.warn('Could not load workout history:', e);\n        return [];\n    }\n}\n\n// Throttled save mechanism\nlet saveTimeout: ReturnType<typeof setTimeout> | null = null;\nlet pendingSave: { measurements: MeasurementsData; startTime: number | null } | null = null;\n\n// Allow a 3rd optional parameter for delay to satisfy legacy tests, even if ignored or treated differently\nexport const throttledSave = (measurements: MeasurementsData, startTime: number | null, delayMs?: number): void => {\n    pendingSave = { measurements, startTime };\n    if (!saveTimeout) {\n        saveTimeout = setTimeout(async () => {\n            if (pendingSave) {\n                await saveActiveWorkout(pendingSave.measurements, pendingSave.startTime);\n                pendingSave = null;\n            }\n            saveTimeout = null;\n        }, delayMs || 2000); // Use provided delay or default 2s\n    }\n};\n\nexport const flushPendingSave = async (): Promise<void> => {\n    if (saveTimeout) {\n        clearTimeout(saveTimeout);\n        saveTimeout = null;\n    }\n    if (pendingSave) {\n        await saveActiveWorkout(pendingSave.measurements, pendingSave.startTime);\n        pendingSave = null;\n    }\n};\n\nexport const isIndexedDBSupported = (): boolean => {\n    return typeof window !== 'undefined' && 'indexedDB' in window;\n};\n\n/**\n * Legacy API Support / Aliases\n */\n\nexport const archiveWorkout = async (): Promise<string | null> => {\n    // Ensure any pending throttled saves are written to DB first\n    await flushPendingSave();\n\n    const active = await loadActiveWorkout();\n    if (!active) return null;\n\n    await saveCompletedWorkout(\n        {\n            heartrate: active.heartrate,\n            power: active.power,\n            cadence: active.cadence,\n            speed: active.speed,\n            distance: active.distance,\n            altitude: active.altitude,\n            gps: active.gps,\n            treadmill: active.treadmill,\n            laps: active.laps\n        },\n        active.startTime,\n        active.lastUpdated\n    );\n    await clearActiveWorkout();\n    return `workout_${active.startTime}`;\n};\n\nexport const hasRecoverableWorkout = async (): Promise<boolean> => {\n    const active = await loadActiveWorkout();\n    return !!active;\n};\n\nexport const getCompletedWorkouts = getWorkoutHistory; // Alias\n\nexport const markWorkoutSynced = async (id: string): Promise<void> => {\n    const db = await openDatabase();\n    return new Promise((resolve, reject) => {\n        const tx = db.transaction(COMPLETED_STORE, 'readwrite');\n        const store = tx.objectStore(COMPLETED_STORE);\n        const request = store.get(id);\n\n        request.onsuccess = () => {\n            const data = request.result as StoredWorkout;\n            if (data) {\n                data.synced = true;\n                data.syncedTime = Date.now();\n                store.put(data);\n                resolve();\n            } else {\n                reject(new Error('Workout not found'));\n            }\n        };\n        request.onerror = () => reject(request.error);\n    });\n};\n","/**\n * Calculate distance between two coordinates in meters (Haversine formula)\n */\nexport function calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371e3; // metres\n    const 1 = lat1 * Math.PI / 180;\n    const 2 = lat2 * Math.PI / 180;\n    const  = (lat2 - lat1) * Math.PI / 180;\n    const  = (lon2 - lon1) * Math.PI / 180;\n\n    const a = Math.sin( / 2) * Math.sin( / 2) +\n        Math.cos(1) * Math.cos(2) *\n        Math.sin( / 2) * Math.sin( / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n    return R * c;\n}\n","/**\n * Validation limits for measurement values\n */\nexport const VALIDATION_LIMITS = {\n    heartrate: { min: 0, max: 300 },\n    power: { min: 0, max: 3000 },\n    cadence: { min: 0, max: 300 },\n    speed: { min: 0, max: 150 }, // km/h\n    distance: { min: 0, max: 1000000 }, // meters\n    altitude: { min: -500, max: 9000 }, // meters\n} as const;\n","const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst transactionDoneMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    // This mapping exists in reverseTransformCache but doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(this.request);\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nconst advanceMethodProps = ['continue', 'continuePrimaryKey', 'advance'];\nconst methodMap = {};\nconst advanceResults = new WeakMap();\nconst ittrProxiedCursorToOriginalProxy = new WeakMap();\nconst cursorIteratorTraps = {\n    get(target, prop) {\n        if (!advanceMethodProps.includes(prop))\n            return target[prop];\n        let cachedFunc = methodMap[prop];\n        if (!cachedFunc) {\n            cachedFunc = methodMap[prop] = function (...args) {\n                advanceResults.set(this, ittrProxiedCursorToOriginalProxy.get(this)[prop](...args));\n            };\n        }\n        return cachedFunc;\n    },\n};\nasync function* iterate(...args) {\n    // tslint:disable-next-line:no-this-assignment\n    let cursor = this;\n    if (!(cursor instanceof IDBCursor)) {\n        cursor = await cursor.openCursor(...args);\n    }\n    if (!cursor)\n        return;\n    cursor = cursor;\n    const proxiedCursor = new Proxy(cursor, cursorIteratorTraps);\n    ittrProxiedCursorToOriginalProxy.set(proxiedCursor, cursor);\n    // Map this double-proxy back to the original, so other cursor methods work.\n    reverseTransformCache.set(proxiedCursor, unwrap(cursor));\n    while (cursor) {\n        yield proxiedCursor;\n        // If one of the advancing methods was not called, call continue().\n        cursor = await (advanceResults.get(proxiedCursor) || cursor.continue());\n        advanceResults.delete(proxiedCursor);\n    }\n}\nfunction isIteratorProp(target, prop) {\n    return ((prop === Symbol.asyncIterator &&\n        instanceOfAny(target, [IDBIndex, IDBObjectStore, IDBCursor])) ||\n        (prop === 'iterate' && instanceOfAny(target, [IDBIndex, IDBObjectStore])));\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get(target, prop, receiver) {\n        if (isIteratorProp(target, prop))\n            return iterate;\n        return oldTraps.get(target, prop, receiver);\n    },\n    has(target, prop) {\n        return isIteratorProp(target, prop) || oldTraps.has(target, prop);\n    },\n}));\n\nexport { deleteDB, openDB, unwrap, wrap };\n","import { openDB, IDBPDatabase } from 'idb';\n\nexport interface ZoneDefinition {\n    name: string;\n    min: number;\n    max: number;\n    color: string;\n}\n\nexport interface UserSettings {\n    // User profile\n    weight: number;          // kg\n    height: number;          // cm\n    age: number;\n    gender: 'male' | 'female' | 'other';\n    ftp: number;             // Functional Threshold Power\n    maxHeartrate: number;\n    restingHeartrate: number;\n\n    // Display preferences\n    units: 'metric' | 'imperial';\n    dateFormat: 'ISO' | 'US' | 'EU';\n    clockFormat: '12h' | '24h';\n\n    // Calculation settings\n    energyMethod: 'power' | 'heartrate' | 'combined';\n    gapThreshold: number;    // seconds before resetting energy calc\n    stalenessThreshold: number; // seconds before data considered stale\n\n    // Power zones (percentage of FTP)\n    powerZones: ZoneDefinition[];\n\n    // Heart rate zones (percentage of max HR)\n    heartrateZones: ZoneDefinition[];\n}\n\nconst DEFAULT_SETTINGS: UserSettings = {\n    weight: 75,\n    height: 175,\n    age: 30,\n    gender: 'other',\n    ftp: 200,\n    maxHeartrate: 190,\n    restingHeartrate: 60,\n\n    units: 'metric',\n    dateFormat: 'ISO',\n    clockFormat: '24h',\n\n    energyMethod: 'combined',\n    gapThreshold: 20,\n    stalenessThreshold: 5,\n\n    powerZones: [\n        { name: 'Recovery', min: 0, max: 55, color: '#808080' },\n        { name: 'Endurance', min: 55, max: 75, color: '#2196f3' },\n        { name: 'Tempo', min: 75, max: 90, color: '#4caf50' },\n        { name: 'Threshold', min: 90, max: 105, color: '#ffeb3b' },\n        { name: 'VO2max', min: 105, max: 120, color: '#ff9800' },\n        { name: 'Anaerobic', min: 120, max: 150, color: '#f44336' },\n        { name: 'Neuromuscular', min: 150, max: 1000, color: '#9c27b0' },\n    ],\n\n    heartrateZones: [\n        { name: 'Recovery', min: 0, max: 60, color: '#808080' },\n        { name: 'Endurance', min: 60, max: 70, color: '#2196f3' },\n        { name: 'Tempo', min: 70, max: 80, color: '#4caf50' },\n        { name: 'Threshold', min: 80, max: 90, color: '#ff9800' },\n        { name: 'VO2max', min: 90, max: 100, color: '#f44336' },\n    ],\n};\n\ntype SettingsListener = (settings: UserSettings) => void;\n\nclass SettingsStore {\n    private settings: UserSettings = { ...DEFAULT_SETTINGS };\n    private listeners: SettingsListener[] = [];\n    private db: IDBPDatabase | null = null;\n    private initialized = false;\n\n    async initialize(): Promise<void> {\n        if (this.initialized) return;\n\n        // Try-catch block for environments that don't support IndexedDB\n        try {\n            this.db = await openDB('bpt-settings', 1, {\n                upgrade(db) {\n                    db.createObjectStore('settings');\n                },\n            });\n\n            const stored = await this.db.get('settings', 'user');\n            if (stored) {\n                // Merge stored settings with defaults to handle new fields\n                this.settings = { ...DEFAULT_SETTINGS, ...stored };\n            }\n        } catch (e) {\n            console.warn('Settings storage unavailable, using defaults/in-memory:', e);\n        }\n\n        this.initialized = true;\n        this.notifyListeners();\n    }\n\n    get<K extends keyof UserSettings>(key: K): UserSettings[K] {\n        return this.settings[key];\n    }\n\n    getAll(): UserSettings {\n        return { ...this.settings };\n    }\n\n    async set<K extends keyof UserSettings>(key: K, value: UserSettings[K]): Promise<void> {\n        this.settings[key] = value;\n        await this.persist();\n        this.notifyListeners();\n    }\n\n    async setMultiple(updates: Partial<UserSettings>): Promise<void> {\n        this.settings = { ...this.settings, ...updates };\n        await this.persist();\n        this.notifyListeners();\n    }\n\n    async reset(): Promise<void> {\n        this.settings = { ...DEFAULT_SETTINGS };\n        await this.persist();\n        this.notifyListeners();\n    }\n\n    onChange(listener: SettingsListener): () => void {\n        this.listeners.push(listener);\n        // Call immediately with current settings\n        // listener(this.getAll()); \n        // Logic: maybe we shouldn't call immediate if they just subscribe? \n        // Let's stick to standard observable pattern where it calls on next change.\n        return () => {\n            const index = this.listeners.indexOf(listener);\n            if (index !== -1) this.listeners.splice(index, 1);\n        };\n    }\n\n    private async persist(): Promise<void> {\n        if (this.db) {\n            try {\n                await this.db.put('settings', this.settings, 'user');\n            } catch (e) {\n                console.error('Failed to save settings:', e);\n            }\n        }\n    }\n\n    private notifyListeners(): void {\n        const settings = this.getAll();\n        for (const listener of this.listeners) {\n            try {\n                listener(settings);\n            } catch (e) {\n                console.error('Settings listener error:', e);\n            }\n        }\n    }\n}\n\nexport const settingsStore = new SettingsStore();\n","/**\n * Calorie calculation utilities\n * \n * Provides methods to estimate energy expenditure from power (preferred)\n * or heart rate (fallback).\n */\n\n/**\n * Calculate calories burned based on mechanical work (Power).\n * Uses the standard conversion where 1 kJ of mechanical work  1 kcal of energy expenditure.\n * This assumes a mechanical efficiency of ~24% (1 kcal = 4.184 kJ).\n * \n * @param powerWatts - Average power in Watts\n * @param durationSeconds - Duration in seconds\n * @returns Energy expenditure in kcal\n */\nexport function calculateCaloriesFromPower(powerWatts: number, durationSeconds: number): number {\n    if (powerWatts <= 0 || durationSeconds <= 0) return 0;\n\n    // Energy (Joules) = Power (Watts) * Time (Seconds)\n    const joules = powerWatts * durationSeconds;\n\n    // Convert to kJ (which is approx equal to kcal due to human efficiency)\n    return joules / 1000;\n}\n\n/**\n * Calculate calories burned based on Heart Rate.\n * Uses a simplified prediction equation (Keytel et al.) with default assumptions\n * for missing demographic data (Male, 30 years old).\n * \n * @param heartRate - Average heart rate in bpm\n * @param weightKg - User weight in kg\n * @param durationSeconds - Duration in seconds\n * @returns Energy expenditure in kcal\n */\nexport function calculateCaloriesFromHeartRate(heartRate: number, weightKg: number, durationSeconds: number): number {\n    if (heartRate <= 0 || weightKg <= 0 || durationSeconds <= 0) return 0;\n\n    // Default parameters if not provided in settings\n    const age = 30; // Default age\n    // Formula for Male: Cal = [(Age x 0.2017) + (Weight x 0.1988) + (HR x 0.6309)  55.0969] x Time / 4.184\n    // Time in minutes\n\n    const minutes = durationSeconds / 60;\n\n    const termAge = age * 0.2017;\n    const termWeight = weightKg * 0.1988;\n    const termHr = heartRate * 0.6309;\n\n    const caloriesPerMinute = (termAge + termWeight + termHr - 55.0969) / 4.184;\n\n    return Math.max(0, caloriesPerMinute * minutes);\n}\n","/**\n * Measurements State Management\n * \n * Central state container for all workout measurement data.\n * Integrates with IndexedDB for persistent storage and crash recovery.\n * \n * @module MeasurementsState\n */\n\nimport type { Measurement, MeasurementsData, MeasurementType, LapMarker, GpsPoint, TreadmillMeasurement } from './types/measurements.js';\nimport {\n    throttledSave,\n    flushPendingSave,\n    clearActiveWorkout,\n    isIndexedDBSupported\n} from './storage/workoutStorage.js';\nimport { calculateDistance } from './utils/geo.js';\nimport { VALIDATION_LIMITS } from './config/constants.js';\n// import { getSettings } from './config/settings.js'; // Keep for legacy until fully migrated? \n// Actually, I should check if I can remove it. But let's import settingsStore first.\nimport { settingsStore, type UserSettings } from './state/SettingsStore.js';\nimport { calculateCaloriesFromPower, calculateCaloriesFromHeartRate } from './calculations/calories.js';\n\n/**\n * Callback type for state change notifications\n */\nexport type StateChangeCallback = (state: MeasurementsData) => void;\n\n/**\n * State container for workout measurements.\n * \n * Stores heart rate, power, and cadence measurements with timestamps.\n * Includes validation to reject invalid values.\n * Automatically persists to IndexedDB for crash recovery.\n * \n * @example\n * const state = new MeasurementsState();\n * state.addPower({ timestamp: Date.now(), value: 200 });\n * console.log(state.power); // [{ timestamp: ..., value: 200 }]\n */\nexport class MeasurementsState implements MeasurementsData {\n    heartrate: Measurement[] = [];\n    power: Measurement[] = [];\n    cadence: Measurement[] = [];\n    speed: Measurement[] = [];\n    distance: Measurement[] = [];\n    altitude: Measurement[] = [];\n    energy: Measurement[] = [];\n    gps: GpsPoint[] = [];\n    treadmill: TreadmillMeasurement[] = [];\n    treadmillSpeed: Measurement[] = [];\n    laps: LapMarker[] = [];\n\n    private _persistenceEnabled: boolean;\n    private _startTime: number | null = null;\n    private _onChangeCallbacks: StateChangeCallback[] = [];\n\n    // Energy calculation state\n    private _lastEnergyTime: number = 0;\n    private _lastPowerTime: number = 0;\n    private _totalEnergy: number = 0; // accumulated kcal\n\n    constructor(enablePersistence: boolean = true) {\n        this._persistenceEnabled = enablePersistence && isIndexedDBSupported();\n\n        // Subscribe to settings changes\n        settingsStore.onChange((settings) => {\n            this.onSettingsChange(settings);\n        });\n\n        if (typeof window !== 'undefined') {\n            // Set up page unload handler to save any pending changes\n            window.addEventListener('beforeunload', () => {\n                flushPendingSave();\n            });\n\n            // Also save on visibility change (mobile browsers)\n            document.addEventListener('visibilitychange', () => {\n                if (document.hidden) {\n                    flushPendingSave();\n                }\n            });\n        }\n    }\n\n    /**\n     * Set the workout start time (used for persistence)\n     */\n    setStartTime(time: number | null): void {\n        this._startTime = time;\n    }\n\n    /**\n     * Get the workout start time\n     */\n    getStartTime(): number | null {\n        return this._startTime;\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: StateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: StateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    private get userWeight(): number {\n        return settingsStore.get('weight');\n    }\n\n    private get gapThreshold(): number {\n        return settingsStore.get('gapThreshold') * 1000; // Convert to ms\n    }\n\n    private onSettingsChange(_settings: UserSettings): void {\n        // Recalculate or handle changes if needed\n        // For now, getters handle the dynamic values\n    }\n\n    /**\n     * Update energy calculation\n     */\n    private _updateEnergy(timestamp: number, value: number, source: 'power' | 'heartrate'): void {\n        const method = settingsStore.get('energyMethod');\n\n        // Only use configured method\n        if (method === 'power' && source !== 'power') return;\n        if (method === 'heartrate' && source !== 'heartrate') return;\n\n        // If combined, we prefer power, but fall back to HR? \n        // Or \"combined\" usually means use power if available, else HR? \n        // For simplicity and to avoid double counting, let's assume 'combined' means smart switching or both contribute to separate buckets?\n        // The original code handled both. \n        // If source is 'heartrate', but we assume power also exists, we shouldn't double add.\n        // Let's implement a simple priority: Power > Heartrate if combined.\n        // But since this method is called per measurement, we need to know context.\n        // If we recently received power, ignore heartrate energy updates?\n\n        // For now, let's stick to the simpler logic of allowing both if 'combined' is set \n        // BUT preventing double counting is hard without knowing implicit state.\n        // Let's assume the user selects one main method or 'combined' means we simply log both if they come in?\n        // Actually, if we use both, we double count calories.\n        // Let's modify logic: If 'combined', use Power. If Power not available (gap), use HR.\n\n        if (method === 'combined') {\n            if (source === 'heartrate') {\n                // If we have recent power data (within gap threshold), ignore HR energy\n                if (timestamp - this._lastPowerTime < this.gapThreshold) {\n                    return;\n                }\n            } else if (source === 'power') {\n                this._lastPowerTime = timestamp;\n            }\n        }\n\n        // Initialize or reset if gap is too large\n        if (this._lastEnergyTime === 0 || (timestamp - this._lastEnergyTime) > this.gapThreshold) {\n            this._lastEnergyTime = timestamp;\n            return;\n        }\n\n        const dt = (timestamp - this._lastEnergyTime) / 1000;\n        if (dt <= 0) return;\n\n        let kcal = 0;\n        if (source === 'power') {\n            kcal = calculateCaloriesFromPower(value, dt);\n        } else {\n            kcal = calculateCaloriesFromHeartRate(value, this.userWeight, dt);\n        }\n\n        if (kcal > 0) {\n            this._totalEnergy += kcal;\n            // Store cumulative energy point\n            this.energy.push({\n                timestamp,\n                value: this._totalEnergy\n            });\n        }\n\n        this._lastEnergyTime = timestamp;\n    }\n\n    /**\n     * Notify listeners and persist state\n     */\n    private _notifyChange(): void {\n        // Notify listeners\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback(this);\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n\n        // Persist to IndexedDB\n        if (this._persistenceEnabled) {\n            throttledSave(this.toJSON(), this._startTime);\n        }\n    }\n\n    /**\n     * Add a heart rate measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 bpm)\n     */\n    addHeartrate(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.heartrate;\n        if (entry.value <= min || entry.value >= max) {\n            console.warn(`Invalid heartrate value: ${entry.value}`);\n            return;\n        }\n        this.heartrate.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n\n        // Calculate energy if power is missing/stale (>5s)\n        if (this._lastPowerTime === 0 || (entry.timestamp - this._lastPowerTime) > 5000) {\n            this._updateEnergy(entry.timestamp, entry.value, 'heartrate');\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a power measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-3000 watts)\n     */\n    addPower(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.power;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid power value: ${entry.value}`);\n            return;\n        }\n        this.power.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n\n        this._lastPowerTime = entry.timestamp;\n        this._updateEnergy(entry.timestamp, entry.value, 'power');\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a cadence measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 rpm)\n     */\n    addCadence(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.cadence;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid cadence value: ${entry.value}`);\n            return;\n        }\n        this.cadence.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addSpeed(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid speed value: ${entry.value}`);\n            return;\n        }\n        this.speed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addDistance(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.distance;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid distance value: ${entry.value}`);\n            return;\n        }\n        this.distance.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addAltitude(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.altitude;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid altitude value: ${entry.value}`);\n            return;\n        }\n        this.altitude.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addTreadmillSpeed(entry: Measurement): void {\n        // Use same limits as speed for now\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid treadmill speed value: ${entry.value}`);\n            return;\n        }\n        this.treadmillSpeed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addGps(point: GpsPoint): void {\n        // Calculate distance if we have a previous point\n        if (this.gps.length > 0) {\n            const lastPoint = this.gps[this.gps.length - 1];\n            const dist = calculateDistance(lastPoint.lat, lastPoint.lon, point.lat, point.lon);\n\n            let currentTotalDistance = 0;\n            if (this.distance.length > 0) {\n                currentTotalDistance = this.distance[this.distance.length - 1].value;\n            }\n\n            this.addDistance({\n                timestamp: point.timestamp,\n                value: currentTotalDistance + dist\n            });\n        } else if (this.distance.length === 0) {\n            this.addDistance({\n                timestamp: point.timestamp,\n                value: 0\n            });\n        }\n\n        // Add speed if available (convert m/s to km/h)\n        if (point.speed !== null) {\n            this.addSpeed({\n                timestamp: point.timestamp,\n                value: point.speed * 3.6\n            });\n        }\n\n        // Add altitude if available\n        if (point.altitude !== null) {\n            this.addAltitude({\n                timestamp: point.timestamp,\n                value: point.altitude\n            });\n        }\n\n        this.gps.push(point);\n        this._notifyChange();\n    }\n\n    /**\n     * Add a measurement of any type\n     * \n     * @param type - The measurement type\n     * @param entry - Measurement with timestamp and value\n     * @throws Error if type is unknown\n     */\n    add(type: MeasurementType, entry: Measurement): void {\n        switch (type) {\n            case 'heartrate':\n                this.addHeartrate(entry);\n                break;\n            case 'power':\n                this.addPower(entry);\n                break;\n            case 'cadence':\n                this.addCadence(entry);\n                break;\n            case 'speed':\n                this.addSpeed(entry);\n                break;\n            case 'distance':\n                this.addDistance(entry);\n                break;\n            case 'altitude':\n                this.addAltitude(entry);\n                break;\n            case 'treadmillSpeed':\n                this.addTreadmillSpeed(entry);\n                break;\n            default:\n                throw new Error(`Unknown measurement type: ${type}`);\n        }\n    }\n\n    /**\n     * Clear all measurements\n     * @param clearPersisted - Also clear persisted data from IndexedDB\n     */\n    async clear(clearPersisted: boolean = true): Promise<void> {\n        this.heartrate = [];\n        this.power = [];\n        this.cadence = [];\n        this.speed = [];\n        this.distance = [];\n        this.altitude = [];\n        this.treadmillSpeed = [];\n        this.laps = [];\n        this._startTime = null;\n\n        if (clearPersisted && this._persistenceEnabled) {\n            await clearActiveWorkout();\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a lap marker\n     * \n     * @param startTime - The workout start time for calculating elapsed time\n     * @returns The new lap marker\n     */\n    addLap(startTime: number | null): LapMarker {\n        const timestamp = Date.now();\n        const lapNumber = this.laps.length + 1;\n        const lap: LapMarker = {\n            timestamp,\n            number: lapNumber,\n            elapsedMs: startTime ? timestamp - startTime : undefined,\n        };\n        this.laps.push(lap);\n        this._notifyChange();\n        return lap;\n    }\n\n    /**\n     * Get the current lap count\n     */\n    getLapCount(): number {\n        return this.laps.length;\n    }\n\n    /**\n     * Get all measurements as a plain object\n     */\n    toJSON(): MeasurementsData {\n        return {\n            heartrate: [...this.heartrate],\n            power: [...this.power],\n            cadence: [...this.cadence],\n            speed: [...this.speed],\n            distance: [...this.distance],\n            altitude: [...this.altitude],\n            treadmillSpeed: [...this.treadmillSpeed],\n            gps: [...this.gps],\n            laps: [...this.laps],\n        };\n    }\n\n    /**\n     * Restore state from persisted data\n     * @param data - The measurement data to restore\n     * @param startTime - The workout start time\n     */\n    restore(data: MeasurementsData, startTime: number | null): void {\n        this.heartrate = [...(data.heartrate || [])];\n        this.power = [...(data.power || [])];\n        this.cadence = [...(data.cadence || [])];\n        this.speed = [...(data.speed || [])];\n        this.distance = [...(data.distance || [])];\n        this.altitude = [...(data.altitude || [])];\n        this.treadmillSpeed = [...(data.treadmillSpeed || [])];\n        this.laps = [...(data.laps || [])];\n        this._startTime = startTime;\n\n        // Don't persist on restore - data is already persisted\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback(this);\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Enable or disable persistence\n     */\n    setPersistenceEnabled(enabled: boolean): void {\n        this._persistenceEnabled = enabled && isIndexedDBSupported();\n    }\n\n    /**\n     * Check if any measurements have been recorded\n     */\n    hasData(): boolean {\n        return this.heartrate.length > 0 || this.power.length > 0 || this.cadence.length > 0;\n    }\n\n    /**\n     * Get the count of measurements for each type\n     */\n    getCounts(): Record<MeasurementType, number> {\n        return {\n            heartrate: this.heartrate.length,\n            power: this.power.length,\n            cadence: this.cadence.length,\n            speed: this.speed.length,\n            distance: this.distance.length,\n            altitude: this.altitude.length,\n            gps: this.gps.length,\n            treadmillSpeed: this.treadmillSpeed.length,\n            energy: this.energy.length,\n        };\n    }\n\n    /**\n     * Add a treadmill measurement\n     * \n     * @param entry - Treadmill measurement (speed/incline)\n     */\n    addTreadmillData(entry: TreadmillMeasurement): void {\n        this.treadmill.push(entry);\n\n        if (entry.speed != null) {\n            const measurement = {\n                timestamp: entry.timestamp,\n                value: entry.speed\n            };\n\n            // Add to specific treadmill Speed metric\n            this.addTreadmillSpeed(measurement);\n\n            // Speed from treadmill is already in km/h\n            this.addSpeed(measurement);\n        }\n\n        // Note: We don't explicitly notifyChange here if addSpeed/addTreadmillSpeed was called, \n        // because they call it. But if only incline changed, we must notify.\n        if (entry.speed == null) {\n            this._notifyChange();\n        }\n    }\n}\n","/**\n * Application State Initialization\n * \n * Creates and returns the initial application state objects.\n * \n * @module getInitState\n */\n\nimport { MeasurementsState } from './measurements-state.js';\nimport type { ConnectionsState, SensorConnectionState } from './types/connections.js';\n\n// Re-export types for convenience\nexport type { SensorConnectionState };\nexport type { ConnectionsState };\n\n/**\n * Workout time state\n */\nexport interface TimeState {\n    running: boolean;\n    startTime: number | null;\n    endTime: number | null;\n}\n\n/**\n * Complete application state\n */\nexport interface AppState {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n}\n\n/**\n * Creates the initial application state.\n * \n * @returns Object containing all state objects\n * \n * @example\n * const { measurementsState, connectionsState, timeState } = getInitState();\n */\nexport const getInitState = (): AppState => {\n    return {\n        measurementsState: new MeasurementsState(),\n        connectionsState: {\n            power: {\n                isConnected: false,\n                disconnect: null,\n            },\n            heartrate: {\n                isConnected: false,\n                disconnect: null,\n            },\n            cadence: {\n                isConnected: false,\n                disconnect: null,\n            },\n            speed: {\n                isConnected: false,\n                disconnect: null,\n            },\n            distance: {\n                isConnected: false,\n                disconnect: null,\n            },\n            altitude: {\n                isConnected: false,\n                disconnect: null,\n            },\n            gps: {\n                isConnected: false,\n                disconnect: null,\n            },\n        },\n        timeState: {\n            running: false,\n            startTime: null,\n            endTime: null,\n        },\n    };\n};\n","/**\n * Test exposure utilities\n * \n * Exposes application state for end-to-end testing.\n * \n * @module exposeVariablesDuringTest\n */\n\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { ConnectionsState } from './types/connections.js';\n\n/**\n * Extended window interface for test variables\n */\ndeclare global {\n    interface Window {\n        bike?: MeasurementsState;\n        connectionsState?: ConnectionsState;\n    }\n}\n\n/**\n * Parameters for test exposure\n */\ninterface ExposeTestVariablesParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n}\n\n/**\n * Exposes application state variables on the window object for E2E testing.\n * \n * This allows Playwright and other testing frameworks to access and verify\n * application state during tests.\n * \n * @param params - Object containing state objects to expose\n * \n * @example\n * // In test:\n * const state = await page.evaluate(() => window.bike);\n */\nexport function exposeVariablesDuringTest({\n    measurementsState,\n    connectionsState,\n}: ExposeTestVariablesParams): void {\n    // Always expose in non-production builds for testing purposes\n    if (typeof window !== 'undefined') {\n        window.bike = measurementsState;\n        window.connectionsState = connectionsState;\n    }\n}\n","/*! Capacitor: https://capacitorjs.com/ - MIT License */\nvar ExceptionCode;\n(function (ExceptionCode) {\n    /**\n     * API is not implemented.\n     *\n     * This usually means the API can't be used because it is not implemented for\n     * the current platform.\n     */\n    ExceptionCode[\"Unimplemented\"] = \"UNIMPLEMENTED\";\n    /**\n     * API is not available.\n     *\n     * This means the API can't be used right now because:\n     *   - it is currently missing a prerequisite, such as network connectivity\n     *   - it requires a particular platform or browser version\n     */\n    ExceptionCode[\"Unavailable\"] = \"UNAVAILABLE\";\n})(ExceptionCode || (ExceptionCode = {}));\nclass CapacitorException extends Error {\n    constructor(message, code, data) {\n        super(message);\n        this.message = message;\n        this.code = code;\n        this.data = data;\n    }\n}\nconst getPlatformId = (win) => {\n    var _a, _b;\n    if (win === null || win === void 0 ? void 0 : win.androidBridge) {\n        return 'android';\n    }\n    else if ((_b = (_a = win === null || win === void 0 ? void 0 : win.webkit) === null || _a === void 0 ? void 0 : _a.messageHandlers) === null || _b === void 0 ? void 0 : _b.bridge) {\n        return 'ios';\n    }\n    else {\n        return 'web';\n    }\n};\n\nconst createCapacitor = (win) => {\n    const capCustomPlatform = win.CapacitorCustomPlatform || null;\n    const cap = win.Capacitor || {};\n    const Plugins = (cap.Plugins = cap.Plugins || {});\n    const getPlatform = () => {\n        return capCustomPlatform !== null ? capCustomPlatform.name : getPlatformId(win);\n    };\n    const isNativePlatform = () => getPlatform() !== 'web';\n    const isPluginAvailable = (pluginName) => {\n        const plugin = registeredPlugins.get(pluginName);\n        if (plugin === null || plugin === void 0 ? void 0 : plugin.platforms.has(getPlatform())) {\n            // JS implementation available for the current platform.\n            return true;\n        }\n        if (getPluginHeader(pluginName)) {\n            // Native implementation available.\n            return true;\n        }\n        return false;\n    };\n    const getPluginHeader = (pluginName) => { var _a; return (_a = cap.PluginHeaders) === null || _a === void 0 ? void 0 : _a.find((h) => h.name === pluginName); };\n    const handleError = (err) => win.console.error(err);\n    const registeredPlugins = new Map();\n    const registerPlugin = (pluginName, jsImplementations = {}) => {\n        const registeredPlugin = registeredPlugins.get(pluginName);\n        if (registeredPlugin) {\n            console.warn(`Capacitor plugin \"${pluginName}\" already registered. Cannot register plugins twice.`);\n            return registeredPlugin.proxy;\n        }\n        const platform = getPlatform();\n        const pluginHeader = getPluginHeader(pluginName);\n        let jsImplementation;\n        const loadPluginImplementation = async () => {\n            if (!jsImplementation && platform in jsImplementations) {\n                jsImplementation =\n                    typeof jsImplementations[platform] === 'function'\n                        ? (jsImplementation = await jsImplementations[platform]())\n                        : (jsImplementation = jsImplementations[platform]);\n            }\n            else if (capCustomPlatform !== null && !jsImplementation && 'web' in jsImplementations) {\n                jsImplementation =\n                    typeof jsImplementations['web'] === 'function'\n                        ? (jsImplementation = await jsImplementations['web']())\n                        : (jsImplementation = jsImplementations['web']);\n            }\n            return jsImplementation;\n        };\n        const createPluginMethod = (impl, prop) => {\n            var _a, _b;\n            if (pluginHeader) {\n                const methodHeader = pluginHeader === null || pluginHeader === void 0 ? void 0 : pluginHeader.methods.find((m) => prop === m.name);\n                if (methodHeader) {\n                    if (methodHeader.rtype === 'promise') {\n                        return (options) => cap.nativePromise(pluginName, prop.toString(), options);\n                    }\n                    else {\n                        return (options, callback) => cap.nativeCallback(pluginName, prop.toString(), options, callback);\n                    }\n                }\n                else if (impl) {\n                    return (_a = impl[prop]) === null || _a === void 0 ? void 0 : _a.bind(impl);\n                }\n            }\n            else if (impl) {\n                return (_b = impl[prop]) === null || _b === void 0 ? void 0 : _b.bind(impl);\n            }\n            else {\n                throw new CapacitorException(`\"${pluginName}\" plugin is not implemented on ${platform}`, ExceptionCode.Unimplemented);\n            }\n        };\n        const createPluginMethodWrapper = (prop) => {\n            let remove;\n            const wrapper = (...args) => {\n                const p = loadPluginImplementation().then((impl) => {\n                    const fn = createPluginMethod(impl, prop);\n                    if (fn) {\n                        const p = fn(...args);\n                        remove = p === null || p === void 0 ? void 0 : p.remove;\n                        return p;\n                    }\n                    else {\n                        throw new CapacitorException(`\"${pluginName}.${prop}()\" is not implemented on ${platform}`, ExceptionCode.Unimplemented);\n                    }\n                });\n                if (prop === 'addListener') {\n                    p.remove = async () => remove();\n                }\n                return p;\n            };\n            // Some flair \n            wrapper.toString = () => `${prop.toString()}() { [capacitor code] }`;\n            Object.defineProperty(wrapper, 'name', {\n                value: prop,\n                writable: false,\n                configurable: false,\n            });\n            return wrapper;\n        };\n        const addListener = createPluginMethodWrapper('addListener');\n        const removeListener = createPluginMethodWrapper('removeListener');\n        const addListenerNative = (eventName, callback) => {\n            const call = addListener({ eventName }, callback);\n            const remove = async () => {\n                const callbackId = await call;\n                removeListener({\n                    eventName,\n                    callbackId,\n                }, callback);\n            };\n            const p = new Promise((resolve) => call.then(() => resolve({ remove })));\n            p.remove = async () => {\n                console.warn(`Using addListener() without 'await' is deprecated.`);\n                await remove();\n            };\n            return p;\n        };\n        const proxy = new Proxy({}, {\n            get(_, prop) {\n                switch (prop) {\n                    // https://github.com/facebook/react/issues/20030\n                    case '$$typeof':\n                        return undefined;\n                    case 'toJSON':\n                        return () => ({});\n                    case 'addListener':\n                        return pluginHeader ? addListenerNative : addListener;\n                    case 'removeListener':\n                        return removeListener;\n                    default:\n                        return createPluginMethodWrapper(prop);\n                }\n            },\n        });\n        Plugins[pluginName] = proxy;\n        registeredPlugins.set(pluginName, {\n            name: pluginName,\n            proxy,\n            platforms: new Set([...Object.keys(jsImplementations), ...(pluginHeader ? [platform] : [])]),\n        });\n        return proxy;\n    };\n    // Add in convertFileSrc for web, it will already be available in native context\n    if (!cap.convertFileSrc) {\n        cap.convertFileSrc = (filePath) => filePath;\n    }\n    cap.getPlatform = getPlatform;\n    cap.handleError = handleError;\n    cap.isNativePlatform = isNativePlatform;\n    cap.isPluginAvailable = isPluginAvailable;\n    cap.registerPlugin = registerPlugin;\n    cap.Exception = CapacitorException;\n    cap.DEBUG = !!cap.DEBUG;\n    cap.isLoggingEnabled = !!cap.isLoggingEnabled;\n    return cap;\n};\nconst initCapacitorGlobal = (win) => (win.Capacitor = createCapacitor(win));\n\nconst Capacitor = /*#__PURE__*/ initCapacitorGlobal(typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof self !== 'undefined'\n        ? self\n        : typeof window !== 'undefined'\n            ? window\n            : typeof global !== 'undefined'\n                ? global\n                : {});\nconst registerPlugin = Capacitor.registerPlugin;\n\n/**\n * Base class web plugins should extend.\n */\nclass WebPlugin {\n    constructor() {\n        this.listeners = {};\n        this.retainedEventArguments = {};\n        this.windowListeners = {};\n    }\n    addListener(eventName, listenerFunc) {\n        let firstListener = false;\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            this.listeners[eventName] = [];\n            firstListener = true;\n        }\n        this.listeners[eventName].push(listenerFunc);\n        // If we haven't added a window listener for this event and it requires one,\n        // go ahead and add it\n        const windowListener = this.windowListeners[eventName];\n        if (windowListener && !windowListener.registered) {\n            this.addWindowListener(windowListener);\n        }\n        if (firstListener) {\n            this.sendRetainedArgumentsForEvent(eventName);\n        }\n        const remove = async () => this.removeListener(eventName, listenerFunc);\n        const p = Promise.resolve({ remove });\n        return p;\n    }\n    async removeAllListeners() {\n        this.listeners = {};\n        for (const listener in this.windowListeners) {\n            this.removeWindowListener(this.windowListeners[listener]);\n        }\n        this.windowListeners = {};\n    }\n    notifyListeners(eventName, data, retainUntilConsumed) {\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            if (retainUntilConsumed) {\n                let args = this.retainedEventArguments[eventName];\n                if (!args) {\n                    args = [];\n                }\n                args.push(data);\n                this.retainedEventArguments[eventName] = args;\n            }\n            return;\n        }\n        listeners.forEach((listener) => listener(data));\n    }\n    hasListeners(eventName) {\n        var _a;\n        return !!((_a = this.listeners[eventName]) === null || _a === void 0 ? void 0 : _a.length);\n    }\n    registerWindowListener(windowEventName, pluginEventName) {\n        this.windowListeners[pluginEventName] = {\n            registered: false,\n            windowEventName,\n            pluginEventName,\n            handler: (event) => {\n                this.notifyListeners(pluginEventName, event);\n            },\n        };\n    }\n    unimplemented(msg = 'not implemented') {\n        return new Capacitor.Exception(msg, ExceptionCode.Unimplemented);\n    }\n    unavailable(msg = 'not available') {\n        return new Capacitor.Exception(msg, ExceptionCode.Unavailable);\n    }\n    async removeListener(eventName, listenerFunc) {\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            return;\n        }\n        const index = listeners.indexOf(listenerFunc);\n        this.listeners[eventName].splice(index, 1);\n        // If there are no more listeners for this type of event,\n        // remove the window listener\n        if (!this.listeners[eventName].length) {\n            this.removeWindowListener(this.windowListeners[eventName]);\n        }\n    }\n    addWindowListener(handle) {\n        window.addEventListener(handle.windowEventName, handle.handler);\n        handle.registered = true;\n    }\n    removeWindowListener(handle) {\n        if (!handle) {\n            return;\n        }\n        window.removeEventListener(handle.windowEventName, handle.handler);\n        handle.registered = false;\n    }\n    sendRetainedArgumentsForEvent(eventName) {\n        const args = this.retainedEventArguments[eventName];\n        if (!args) {\n            return;\n        }\n        delete this.retainedEventArguments[eventName];\n        args.forEach((arg) => {\n            this.notifyListeners(eventName, arg);\n        });\n    }\n}\n\nconst WebView = /*#__PURE__*/ registerPlugin('WebView');\n/******** END WEB VIEW PLUGIN ********/\n/******** COOKIES PLUGIN ********/\n/**\n * Safely web encode a string value (inspired by js-cookie)\n * @param str The string value to encode\n */\nconst encode = (str) => encodeURIComponent(str)\n    .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n    .replace(/[()]/g, escape);\n/**\n * Safely web decode a string value (inspired by js-cookie)\n * @param str The string value to decode\n */\nconst decode = (str) => str.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent);\nclass CapacitorCookiesPluginWeb extends WebPlugin {\n    async getCookies() {\n        const cookies = document.cookie;\n        const cookieMap = {};\n        cookies.split(';').forEach((cookie) => {\n            if (cookie.length <= 0)\n                return;\n            // Replace first \"=\" with CAP_COOKIE to prevent splitting on additional \"=\"\n            let [key, value] = cookie.replace(/=/, 'CAP_COOKIE').split('CAP_COOKIE');\n            key = decode(key).trim();\n            value = decode(value).trim();\n            cookieMap[key] = value;\n        });\n        return cookieMap;\n    }\n    async setCookie(options) {\n        try {\n            // Safely Encoded Key/Value\n            const encodedKey = encode(options.key);\n            const encodedValue = encode(options.value);\n            // Clean & sanitize options\n            const expires = `; expires=${(options.expires || '').replace('expires=', '')}`; // Default is \"; expires=\"\n            const path = (options.path || '/').replace('path=', ''); // Default is \"path=/\"\n            const domain = options.url != null && options.url.length > 0 ? `domain=${options.url}` : '';\n            document.cookie = `${encodedKey}=${encodedValue || ''}${expires}; path=${path}; ${domain};`;\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async deleteCookie(options) {\n        try {\n            document.cookie = `${options.key}=; Max-Age=0`;\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async clearCookies() {\n        try {\n            const cookies = document.cookie.split(';') || [];\n            for (const cookie of cookies) {\n                document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date().toUTCString()};path=/`);\n            }\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async clearAllCookies() {\n        try {\n            await this.clearCookies();\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n}\nconst CapacitorCookies = registerPlugin('CapacitorCookies', {\n    web: () => new CapacitorCookiesPluginWeb(),\n});\n// UTILITY FUNCTIONS\n/**\n * Read in a Blob value and return it as a base64 string\n * @param blob The blob value to convert to a base64 string\n */\nconst readBlobAsBase64 = async (blob) => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n        const base64String = reader.result;\n        // remove prefix \"data:application/pdf;base64,\"\n        resolve(base64String.indexOf(',') >= 0 ? base64String.split(',')[1] : base64String);\n    };\n    reader.onerror = (error) => reject(error);\n    reader.readAsDataURL(blob);\n});\n/**\n * Normalize an HttpHeaders map by lowercasing all of the values\n * @param headers The HttpHeaders object to normalize\n */\nconst normalizeHttpHeaders = (headers = {}) => {\n    const originalKeys = Object.keys(headers);\n    const loweredKeys = Object.keys(headers).map((k) => k.toLocaleLowerCase());\n    const normalized = loweredKeys.reduce((acc, key, index) => {\n        acc[key] = headers[originalKeys[index]];\n        return acc;\n    }, {});\n    return normalized;\n};\n/**\n * Builds a string of url parameters that\n * @param params A map of url parameters\n * @param shouldEncode true if you should encodeURIComponent() the values (true by default)\n */\nconst buildUrlParams = (params, shouldEncode = true) => {\n    if (!params)\n        return null;\n    const output = Object.entries(params).reduce((accumulator, entry) => {\n        const [key, value] = entry;\n        let encodedValue;\n        let item;\n        if (Array.isArray(value)) {\n            item = '';\n            value.forEach((str) => {\n                encodedValue = shouldEncode ? encodeURIComponent(str) : str;\n                item += `${key}=${encodedValue}&`;\n            });\n            // last character will always be \"&\" so slice it off\n            item.slice(0, -1);\n        }\n        else {\n            encodedValue = shouldEncode ? encodeURIComponent(value) : value;\n            item = `${key}=${encodedValue}`;\n        }\n        return `${accumulator}&${item}`;\n    }, '');\n    // Remove initial \"&\" from the reduce\n    return output.substr(1);\n};\n/**\n * Build the RequestInit object based on the options passed into the initial request\n * @param options The Http plugin options\n * @param extra Any extra RequestInit values\n */\nconst buildRequestInit = (options, extra = {}) => {\n    const output = Object.assign({ method: options.method || 'GET', headers: options.headers }, extra);\n    // Get the content-type\n    const headers = normalizeHttpHeaders(options.headers);\n    const type = headers['content-type'] || '';\n    // If body is already a string, then pass it through as-is.\n    if (typeof options.data === 'string') {\n        output.body = options.data;\n    }\n    // Build request initializers based off of content-type\n    else if (type.includes('application/x-www-form-urlencoded')) {\n        const params = new URLSearchParams();\n        for (const [key, value] of Object.entries(options.data || {})) {\n            params.set(key, value);\n        }\n        output.body = params.toString();\n    }\n    else if (type.includes('multipart/form-data') || options.data instanceof FormData) {\n        const form = new FormData();\n        if (options.data instanceof FormData) {\n            options.data.forEach((value, key) => {\n                form.append(key, value);\n            });\n        }\n        else {\n            for (const key of Object.keys(options.data)) {\n                form.append(key, options.data[key]);\n            }\n        }\n        output.body = form;\n        const headers = new Headers(output.headers);\n        headers.delete('content-type'); // content-type will be set by `window.fetch` to includy boundary\n        output.headers = headers;\n    }\n    else if (type.includes('application/json') || typeof options.data === 'object') {\n        output.body = JSON.stringify(options.data);\n    }\n    return output;\n};\n// WEB IMPLEMENTATION\nclass CapacitorHttpPluginWeb extends WebPlugin {\n    /**\n     * Perform an Http request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async request(options) {\n        const requestInit = buildRequestInit(options, options.webFetchExtra);\n        const urlParams = buildUrlParams(options.params, options.shouldEncodeUrlParams);\n        const url = urlParams ? `${options.url}?${urlParams}` : options.url;\n        const response = await fetch(url, requestInit);\n        const contentType = response.headers.get('content-type') || '';\n        // Default to 'text' responseType so no parsing happens\n        let { responseType = 'text' } = response.ok ? options : {};\n        // If the response content-type is json, force the response to be json\n        if (contentType.includes('application/json')) {\n            responseType = 'json';\n        }\n        let data;\n        let blob;\n        switch (responseType) {\n            case 'arraybuffer':\n            case 'blob':\n                blob = await response.blob();\n                data = await readBlobAsBase64(blob);\n                break;\n            case 'json':\n                data = await response.json();\n                break;\n            case 'document':\n            case 'text':\n            default:\n                data = await response.text();\n        }\n        // Convert fetch headers to Capacitor HttpHeaders\n        const headers = {};\n        response.headers.forEach((value, key) => {\n            headers[key] = value;\n        });\n        return {\n            data,\n            headers,\n            status: response.status,\n            url: response.url,\n        };\n    }\n    /**\n     * Perform an Http GET request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async get(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'GET' }));\n    }\n    /**\n     * Perform an Http POST request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async post(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'POST' }));\n    }\n    /**\n     * Perform an Http PUT request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async put(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'PUT' }));\n    }\n    /**\n     * Perform an Http PATCH request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async patch(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'PATCH' }));\n    }\n    /**\n     * Perform an Http DELETE request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async delete(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'DELETE' }));\n    }\n}\nconst CapacitorHttp = registerPlugin('CapacitorHttp', {\n    web: () => new CapacitorHttpPluginWeb(),\n});\n/******** END HTTP PLUGIN ********/\n/******** SYSTEM BARS PLUGIN ********/\n/**\n * Available status bar styles.\n */\nvar SystemBarsStyle;\n(function (SystemBarsStyle) {\n    /**\n     * Light system bar content on a dark background.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Dark\"] = \"DARK\";\n    /**\n     * For dark system bar content on a light background.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Light\"] = \"LIGHT\";\n    /**\n     * The style is based on the device appearance or the underlying content.\n     * If the device is using Dark mode, the system bars content will be light.\n     * If the device is using Light mode, the system bars content will be dark.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Default\"] = \"DEFAULT\";\n})(SystemBarsStyle || (SystemBarsStyle = {}));\n/**\n * Available system bar types.\n */\nvar SystemBarType;\n(function (SystemBarType) {\n    /**\n     * The top status bar on both Android and iOS.\n     *\n     * @since 8.0.0\n     */\n    SystemBarType[\"StatusBar\"] = \"StatusBar\";\n    /**\n     * The navigation bar (or gesture bar on iOS) on both Android and iOS.\n     *\n     * @since 8.0.0\n     */\n    SystemBarType[\"NavigationBar\"] = \"NavigationBar\";\n})(SystemBarType || (SystemBarType = {}));\nclass SystemBarsPluginWeb extends WebPlugin {\n    async setStyle() {\n        this.unavailable('not available for web');\n    }\n    async setAnimation() {\n        this.unavailable('not available for web');\n    }\n    async show() {\n        this.unavailable('not available for web');\n    }\n    async hide() {\n        this.unavailable('not available for web');\n    }\n}\nconst SystemBars = registerPlugin('SystemBars', {\n    web: () => new SystemBarsPluginWeb(),\n});\n/******** END SYSTEM BARS PLUGIN ********/\n\nexport { Capacitor, CapacitorCookies, CapacitorException, CapacitorHttp, ExceptionCode, SystemBarType, SystemBars, SystemBarsStyle, WebPlugin, WebView, buildRequestInit, registerPlugin };\n//# sourceMappingURL=index.js.map\n","import { registerPlugin } from '@capacitor/core';\nconst App = registerPlugin('App', {\n    web: () => import('./web').then((m) => new m.AppWeb()),\n});\nexport * from './definitions';\nexport { App };\n//# sourceMappingURL=index.js.map","import { View } from './View.js';\nimport { IRouter } from './types.js';\nimport { Capacitor } from '@capacitor/core';\nimport { App } from '@capacitor/app';\n\ninterface Route {\n    path: string;\n    viewId: string;\n}\n\nexport class Router implements IRouter {\n    private views: Map<string, View> = new Map();\n    private routes: Route[] = [];\n    private currentViewId: string | null = null;\n    private container: HTMLElement;\n    private isNative: boolean;\n\n    constructor(container: HTMLElement) {\n        this.container = container;\n        this.isNative = Capacitor.isNativePlatform();\n\n        // Handle browser back/forward buttons and hash changes\n        window.addEventListener('popstate', () => {\n            this.handleLocationChange();\n        });\n\n        // Also listen for hash changes (for Capacitor/native)\n        if (this.isNative) {\n            window.addEventListener('hashchange', () => {\n                this.handleLocationChange();\n            });\n        }\n\n        // Hardware back button handling for Capacitor\n        if (this.isNative) {\n            App.addListener('backButton', ({ canGoBack }) => {\n                if (canGoBack) {\n                    window.history.back();\n                } else {\n                    App.exitApp();\n                }\n            });\n        }\n    }\n\n    /**\n     * Register a view with the router.\n     */\n    public registerView(view: View): void {\n        this.views.set(view.id, view);\n\n        // Find existing container or create one\n        let viewContainer = document.getElementById(`page-${view.id}`);\n\n        if (!viewContainer) {\n            viewContainer = document.createElement('div');\n            viewContainer.id = `page-${view.id}`;\n            viewContainer.className = 'page-view';\n            viewContainer.style.display = 'none'; // Hidden by default\n            this.container.appendChild(viewContainer);\n        }\n\n        // Initialize the view with its container\n        view.init(viewContainer);\n    }\n\n    /**\n     * Add a route mapping to a view.\n     */\n    public addRoute(path: string, viewId: string): void {\n        this.routes.push({ path, viewId });\n    }\n\n    /**\n     * Navigate to a specific path.\n     * Uses hash-based routing on native platforms for better compatibility.\n     */\n    public navigate(path: string, replace = false): void {\n        if (this.isNative) {\n            // Use hash-based routing on Capacitor/native for file:// compatibility\n            if (replace) {\n                window.location.replace('#' + path);\n            } else {\n                window.location.hash = path;\n            }\n        } else {\n            // Use History API for web browsers\n            if (replace) {\n                window.history.replaceState({}, '', path);\n            } else {\n                window.history.pushState({}, '', path);\n            }\n            this.handleLocationChange();\n        }\n    }\n\n    /**\n     * Start the router and load the initial view.\n     */\n    public start(): void {\n        if (this.isNative) {\n            // On native, start with initial hash check\n            if (!window.location.hash) {\n                // If no hash, default to root\n                window.location.hash = '/';\n            }\n        }\n        this.handleLocationChange();\n    }\n\n    /**\n     * Go back in history.\n     */\n    public back(): void {\n        window.history.back();\n    }\n\n    /**\n     * Handle location changes (popstate or navigate).\n     */\n    private handleLocationChange(): void {\n        let path: string;\n\n        if (this.isNative) {\n            // On native platforms, use hash-based routing\n            // Hash format: #/path -> extract '/path'\n            const hash = window.location.hash;\n            path = hash ? hash.slice(1) : '/';\n            // Normalize empty hash to root\n            if (!path || path === '') {\n                path = '/';\n            }\n        } else {\n            // On web, use pathname\n            path = window.location.pathname;\n            // Normalize /index.html to /\n            if (path.endsWith('/index.html') || path.endsWith('.html')) {\n                path = '/';\n            }\n        }\n\n        // Simple matching logic\n        let matchedRoute = this.routes.find(r => r.path === path);\n\n        // Fallback to strict root or first registered route if no match\n        // Useful for initial load if path is just \"/\" or empty\n        if (!matchedRoute) {\n            matchedRoute = this.routes.find(r => r.path === '/') || this.routes[0];\n        }\n\n        if (matchedRoute) {\n            this.switchView(matchedRoute.viewId);\n        }\n    }\n\n    /**\n     * Switch the visible view.\n     */\n    private switchView(viewId: string): void {\n        if (this.currentViewId === viewId) return;\n\n        // Leave current view\n        if (this.currentViewId) {\n            const currentView = this.views.get(this.currentViewId);\n            if (currentView) {\n                currentView.onLeave();\n                const el = document.getElementById(`page-${this.currentViewId}`);\n                if (el) el.style.display = 'none';\n            }\n        }\n\n        // Enter new view\n        const newView = this.views.get(viewId);\n        if (newView) {\n            const el = document.getElementById(`page-${viewId}`);\n            if (el) el.style.display = '';\n            newView.onEnter();\n            this.currentViewId = viewId;\n\n            // Dispatch event for UI updates (e.g. Nav Bar)\n            window.dispatchEvent(new CustomEvent('route-changed', { detail: { viewId } }));\n        }\n    }\n}\n","import { View } from '../router/View.js';\n\nexport class DashboardView implements View {\n    public id = 'dashboard';\n\n    public init(_container: HTMLElement): void {\n        console.log('Dashboard View initialized');\n    }\n\n    public onEnter(): void {\n        console.log('Entered Dashboard View');\n    }\n\n    public onLeave(): void {\n        console.log('Left Dashboard View');\n    }\n}\n","/**\n * API client for workout database operations\n * Handles communication with the workout history API\n * \n * @module workoutClient\n */\n\nimport type { ApiError } from './types.js';\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Helper to parse API errors\n */\nasync function parseError(response: Response): Promise<ApiError> {\n    try {\n        const body = await response.json();\n        return {\n            status: response.status,\n            message: body.error || body.message || 'Unknown error',\n            code: body.code,\n            details: body.details,\n        };\n    } catch {\n        return {\n            status: response.status,\n            message: response.statusText || 'Unknown error',\n        };\n    }\n}\n\n/**\n * Workout data from API\n */\nexport interface Workout {\n    id: string;\n    userId?: string;\n    streamName?: string;\n    title?: string;\n    description?: string;\n    sport: string;\n    startTime: string;\n    endTime?: string;\n    duration?: number;\n    status: 'ACTIVE' | 'PAUSED' | 'COMPLETED' | 'ARCHIVED' | 'DELETED';\n    summary?: string;\n    telemetry?: string;\n    createdAt: string;\n    updatedAt: string;\n}\n\n/**\n * Pagination info\n */\nexport interface PaginationInfo {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n}\n\n/**\n * List workouts response\n */\nexport interface ListWorkoutsResponse {\n    workouts: Workout[];\n    pagination: PaginationInfo;\n}\n\n/**\n * List workouts options\n */\nexport interface ListWorkoutsOptions {\n    page?: number;\n    limit?: number;\n    status?: string;\n    userId?: string;\n    startDate?: Date;\n    endDate?: Date;\n    sport?: string;\n}\n\n/**\n * Create workout params\n */\nexport interface CreateWorkoutParams {\n    streamName: string;\n    title?: string;\n    sport?: string;\n    userId?: string;\n}\n\n/**\n * Create workout response\n */\nexport interface CreateWorkoutResponse {\n    success: boolean;\n    workout: Workout;\n}\n\n/**\n * Update workout params\n */\nexport interface UpdateWorkoutParams {\n    title?: string;\n    description?: string;\n    sport?: string;\n}\n\n/**\n * Complete workout response\n */\nexport interface CompleteWorkoutResponse {\n    success: boolean;\n    workout: Workout;\n    archivedMessages: number;\n}\n\n/**\n * Delete workout response\n */\nexport interface DeleteWorkoutResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * User statistics\n */\nexport interface UserStats {\n    totalWorkouts: number;\n    totalDuration: number;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Check if database features are available\n * \n * @returns Promise resolving to true if database is connected\n */\nexport async function isDatabaseAvailable(): Promise<boolean> {\n    try {\n        const response = await fetch(`${API_BASE_URL}/health`, {\n            headers: getHeaders(),\n        });\n        if (!response.ok) return false;\n        const health = await response.json();\n        return health.database === 'connected';\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Create a new workout\n * \n * @param params - Workout parameters\n * @returns Promise with created workout\n */\nexport async function createWorkout({\n    streamName,\n    title,\n    sport = 'cycling',\n    userId,\n}: CreateWorkoutParams): Promise<CreateWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName, title, sport, userId }),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<CreateWorkoutResponse>;\n}\n\n/**\n * List workouts with pagination\n * \n * @param options - Query options\n * @returns Promise with workouts and pagination info\n */\nexport async function listWorkouts({\n    page = 1,\n    limit = 20,\n    status,\n    userId,\n    startDate,\n    endDate,\n    sport,\n}: ListWorkoutsOptions = {}): Promise<ListWorkoutsResponse> {\n    const params = new URLSearchParams();\n    params.set('page', page.toString());\n    params.set('limit', limit.toString());\n    if (status) params.set('status', status);\n    if (userId) params.set('userId', userId);\n    if (startDate) params.set('startDate', startDate.toISOString());\n    if (endDate) params.set('endDate', endDate.toISOString());\n    if (sport) params.set('sport', sport);\n\n    const response = await fetch(`${API_BASE_URL}/api/workouts?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<ListWorkoutsResponse>;\n}\n\n/**\n * Get a single workout by ID\n * \n * @param workoutId - Workout ID\n * @param includeTelemetry - Include full telemetry data\n * @returns Promise with workout data\n */\nexport async function getWorkout(\n    workoutId: string,\n    includeTelemetry: boolean = false\n): Promise<Workout> {\n    const params = new URLSearchParams();\n    if (includeTelemetry) params.set('includeTelemetry', 'true');\n\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<Workout>;\n}\n\n/**\n * Update workout metadata\n * \n * @param workoutId - Workout ID\n * @param data - Fields to update\n * @returns Promise with updated workout\n */\nexport async function updateWorkout(\n    workoutId: string,\n    { title, description, sport }: UpdateWorkoutParams\n): Promise<CreateWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}`, {\n        method: 'PATCH',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ title, description, sport }),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<CreateWorkoutResponse>;\n}\n\n/**\n * Complete a workout (archive from Redis to database)\n * \n * @param workoutId - Workout ID\n * @param archiveTelemetry - Archive telemetry data\n * @returns Promise with completion result\n */\nexport async function completeWorkout(\n    workoutId: string,\n    archiveTelemetry: boolean = true\n): Promise<CompleteWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}/complete`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ archiveTelemetry }),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<CompleteWorkoutResponse>;\n}\n\n/**\n * Delete a workout\n * \n * @param workoutId - Workout ID\n * @returns Promise with deletion result\n */\nexport async function deleteWorkout(workoutId: string): Promise<DeleteWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<DeleteWorkoutResponse>;\n}\n\n/**\n * Get active workout by stream name\n * \n * @param streamName - Stream name\n * @returns Promise with workout or null if not found\n */\nexport async function getWorkoutByStream(streamName: string): Promise<Workout | null> {\n    try {\n        const response = await fetch(\n            `${API_BASE_URL}/api/workouts/by-stream/${encodeURIComponent(streamName)}`,\n            {\n                headers: getHeaders(),\n            }\n        );\n\n        if (response.status === 404) {\n            return null;\n        }\n\n        if (!response.ok) {\n            const errorData = await parseError(response);\n            throw new Error(errorData.message);\n        }\n\n        return response.json() as Promise<Workout>;\n    } catch (error) {\n        if (error instanceof Error && error.message.includes('not found')) {\n            return null;\n        }\n        throw error;\n    }\n}\n\n/**\n * Get user statistics\n * \n * @param userId - User ID\n * @returns Promise with user stats\n */\nexport async function getUserStats(userId: string): Promise<UserStats> {\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/stats`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const errorData = await parseError(response);\n        throw new Error(errorData.message);\n    }\n\n    return response.json() as Promise<UserStats>;\n}\n\n/**\n * Format duration in seconds to human-readable string\n * \n * @param seconds - Duration in seconds\n * @returns Formatted duration string\n */\nexport function formatDuration(seconds: number | undefined | null): string {\n    if (!seconds) return '--';\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n\n    if (hours > 0) {\n        return `${hours}h ${minutes}m`;\n    }\n    if (minutes > 0) {\n        return `${minutes}m ${secs}s`;\n    }\n    return `${secs}s`;\n}\n\n/**\n * Format date to locale string\n * \n * @param date - Date to format\n * @returns Formatted date string\n */\nexport function formatDate(date: string | Date | undefined | null): string {\n    if (!date) return '--';\n    return new Date(date).toLocaleDateString(undefined, {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n    });\n}\n","/**\n * API client for user operations\n * Handles communication with the user API including FTP history\n *\n * @module userClient\n */\n\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\nexport interface FtpHistoryEntry {\n    id: string;\n    userId: string;\n    ftp: number;\n    source: string | null;\n    createdAt: string;\n}\n\nexport interface UserSettings {\n    theme?: 'light' | 'dark' | 'system';\n    units?: 'metric' | 'imperial';\n    notifications?: boolean;\n    ftp?: number;\n}\n\n/**\n * Get user FTP history\n */\nexport async function getFtpHistory(userId: string): Promise<FtpHistoryEntry[]> {\n    const headers: Record<string, string> = {\n        'Content-Type': 'application/json'\n    };\n\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/ftp-history`, {\n        headers\n    });\n\n    if (!response.ok) {\n        throw new Error(`Failed to fetch FTP history: ${response.statusText}`);\n    }\n\n    return response.json();\n}\n\n/**\n * Update user FTP\n */\nexport async function updateUserFtp(userId: string, ftp: number, source: string = 'manual'): Promise<{ ftp: number }> {\n    const headers: Record<string, string> = {\n        'Content-Type': 'application/json'\n    };\n\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/ftp`, {\n        method: 'PUT',\n        headers,\n        body: JSON.stringify({ ftp, source })\n    });\n\n    if (!response.ok) {\n        throw new Error(`Failed to update FTP: ${response.statusText}`);\n    }\n\n    return response.json();\n}\n","/**\n * Accessibility utilities and keyboard navigation\n *\n * Implements keyboard shortcuts and screen reader announcements.\n *\n * @module accessibility\n */\n\n/**\n * Announce a message to screen readers\n *\n * Uses an aria-live region to announce status changes.\n *\n * @param message - The message to announce\n * @param priority - 'polite' for non-urgent, 'assertive' for urgent\n */\nexport function announce(\n    message: string,\n    priority: 'polite' | 'assertive' = 'polite'\n): void {\n    const announcer = document.getElementById('srAnnouncements');\n    if (announcer) {\n        announcer.setAttribute('aria-live', priority);\n        announcer.textContent = message;\n\n        // Clear after announcement to allow repeated messages\n        setTimeout(() => {\n            announcer.textContent = '';\n        }, 1000);\n    }\n}\n\n/**\n * Keyboard shortcut definitions\n */\ninterface KeyboardShortcut {\n    key: string;\n    description: string;\n    action: () => void;\n    ctrl?: boolean;\n    shift?: boolean;\n    alt?: boolean;\n}\n\nconst shortcuts: KeyboardShortcut[] = [];\n\n/**\n * Register a keyboard shortcut\n *\n * @param shortcut - The shortcut definition\n */\nexport function registerShortcut(shortcut: KeyboardShortcut): void {\n    shortcuts.push(shortcut);\n}\n\n/**\n * Handle keyboard events for shortcuts\n */\nfunction handleKeydown(event: KeyboardEvent): void {\n    // Don't trigger shortcuts when typing in inputs\n    const target = event.target as HTMLElement;\n    if (\n        target.tagName === 'INPUT' ||\n        target.tagName === 'TEXTAREA' ||\n        target.isContentEditable\n    ) {\n        // Allow Escape in inputs to blur\n        if (event.key === 'Escape') {\n            target.blur();\n        }\n        return;\n    }\n\n    for (const shortcut of shortcuts) {\n        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();\n        const ctrlMatch = shortcut.ctrl ? event.ctrlKey || event.metaKey : !event.ctrlKey && !event.metaKey;\n        const shiftMatch = shortcut.shift ? event.shiftKey : !event.shiftKey;\n        const altMatch = shortcut.alt ? event.altKey : !event.altKey;\n\n        if (keyMatch && ctrlMatch && shiftMatch && altMatch) {\n            event.preventDefault();\n            shortcut.action();\n            return;\n        }\n    }\n}\n\n/**\n * Initialize keyboard navigation\n *\n * Sets up global keyboard shortcuts:\n * - Space: Start/pause/resume recording (context-aware)\n * - Escape: Close modal/menu\n * - M: Toggle menu\n * - S: Open settings\n * - H: Open workout history\n * - L: Mark lap\n * - ?: Show keyboard shortcuts\n */\nexport function initKeyboardNavigation(): void {\n    // Space - Context-aware workout control\n    registerShortcut({\n        key: ' ',\n        description: 'Start/pause/resume workout (context-aware)',\n        action: () => {\n            // Garmin-style: Space toggles between recording and paused\n            const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n            const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n            const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n\n            // Click whichever button is currently visible\n            if (startButton && startButton.style.display !== 'none') {\n                startButton.click();\n            } else if (pauseButton && pauseButton.style.display !== 'none') {\n                pauseButton.click();\n            } else if (resumeButton && resumeButton.style.display !== 'none') {\n                resumeButton.click();\n            }\n        },\n    });\n\n    // Escape - Close modal/menu\n    registerShortcut({\n        key: 'Escape',\n        description: 'Close modal or menu',\n        action: () => {\n            // Close any open modal\n            const modals = document.querySelectorAll<HTMLElement>('.stream-modal[style*=\"display: block\"], .stream-modal:not([style*=\"display: none\"])');\n            for (const modal of modals) {\n                if (modal.style.display !== 'none') {\n                    const closeBtn = modal.querySelector<HTMLButtonElement>('.close-button');\n                    if (closeBtn) {\n                        closeBtn.click();\n                        announce('Dialog closed');\n                        return;\n                    }\n                }\n            }\n\n            // Close menu if open\n            const details = document.querySelector('details[open]') as HTMLDetailsElement | null;\n            if (details) {\n                details.removeAttribute('open');\n                announce('Menu closed');\n            }\n        },\n    });\n\n    // M - Toggle menu\n    registerShortcut({\n        key: 'm',\n        description: 'Toggle menu',\n        action: () => {\n            const details = document.querySelector('header details') as HTMLDetailsElement | null;\n            if (details) {\n                const isOpen = details.hasAttribute('open');\n                if (isOpen) {\n                    details.removeAttribute('open');\n                    announce('Menu closed');\n                } else {\n                    details.setAttribute('open', '');\n                    announce('Menu opened');\n                    // Focus first menu item\n                    const firstButton = details.querySelector<HTMLButtonElement>('#controls button');\n                    if (firstButton) {\n                        firstButton.focus();\n                    }\n                }\n            }\n        },\n    });\n\n    // S - Open settings\n    registerShortcut({\n        key: 's',\n        description: 'Open settings',\n        action: () => {\n            const settingsBtn = document.getElementById('settingsButton');\n            if (settingsBtn) {\n                settingsBtn.click();\n                announce('Settings opened');\n            }\n        },\n    });\n\n    // H - Open workout history\n    registerShortcut({\n        key: 'h',\n        description: 'Open workout history',\n        action: () => {\n            const router = window.router;\n            if (router) {\n                router.navigate('/history');\n                announce('Workout history opened');\n            } else {\n                const historyBtn = document.getElementById('workoutHistoryButton');\n                if (historyBtn) {\n                    historyBtn.click();\n                    announce('Workout history opened');\n                }\n            }\n        },\n    });\n\n    // E - Export data\n    registerShortcut({\n        key: 'e',\n        description: 'Export workout data',\n        action: () => {\n            const exportBtn = document.getElementById('exportData');\n            if (exportBtn) {\n                exportBtn.click();\n            }\n        },\n    });\n\n    // L - Mark lap\n    registerShortcut({\n        key: 'l',\n        description: 'Mark lap',\n        action: () => {\n            const lapBtn = document.getElementById('lapButton');\n            if (lapBtn) {\n                lapBtn.click();\n            }\n        },\n    });\n\n    // Add event listener\n    document.addEventListener('keydown', handleKeydown);\n\n    // Update summary element to indicate keyboard accessibility\n    const summary = document.querySelector('header summary');\n    if (summary) {\n        summary.setAttribute('aria-keyshortcuts', 'M');\n    }\n\n    console.log('Keyboard navigation initialized');\n}\n\n/**\n * Trap focus within a modal dialog\n *\n * @param modal - The modal element\n */\nexport function trapFocus(modal: HTMLElement): void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n\n    if (focusableElements.length === 0) return;\n\n    const firstElement = focusableElements[0];\n    const lastElement = focusableElements[focusableElements.length - 1];\n\n    // Focus first element\n    firstElement.focus();\n\n    modal.addEventListener('keydown', (event) => {\n        if (event.key !== 'Tab') return;\n\n        if (event.shiftKey) {\n            // Shift + Tab\n            if (document.activeElement === firstElement) {\n                event.preventDefault();\n                lastElement.focus();\n            }\n        } else {\n            // Tab\n            if (document.activeElement === lastElement) {\n                event.preventDefault();\n                firstElement.focus();\n            }\n        }\n    });\n}\n\n/**\n * Update workout controls accessibility state\n *\n * @param state - The current workout state: 'idle', 'recording', or 'paused'\n */\nexport function updateWorkoutControlsAccessibility(\n    state: 'idle' | 'recording' | 'paused'\n): void {\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    // Update ARIA labels based on state\n    if (startButton) {\n        startButton.setAttribute('aria-label', 'Start workout');\n    }\n    if (pauseButton) {\n        pauseButton.setAttribute('aria-label', 'Pause workout');\n    }\n    if (resumeButton) {\n        resumeButton.setAttribute('aria-label', 'Resume workout');\n    }\n    if (stopButton) {\n        stopButton.setAttribute('aria-label', 'Stop and save workout');\n    }\n\n    // Update workout controls container with current state\n    const controlsContainer = document.getElementById('workoutControls');\n    if (controlsContainer) {\n        controlsContainer.setAttribute('data-workout-state', state);\n    }\n}\n\n/**\n * Update start/stop button accessibility state\n * @deprecated Use updateWorkoutControlsAccessibility instead\n * @param isRunning - Whether the workout is running\n */\nexport function updateStartStopAccessibility(isRunning: boolean): void {\n    // Backward compatibility - map to new function\n    updateWorkoutControlsAccessibility(isRunning ? 'recording' : 'paused');\n}\n\n/**\n * Announce connection status change\n *\n * @param sensorType - The type of sensor\n * @param isConnected - Whether the sensor is connected\n */\nexport function announceConnectionStatus(\n    sensorType: 'power' | 'cadence' | 'heartrate',\n    isConnected: boolean\n): void {\n    const sensorNames = {\n        power: 'Power meter',\n        cadence: 'Cadence sensor',\n        heartrate: 'Heart rate monitor',\n    };\n\n    const message = isConnected\n        ? `${sensorNames[sensorType]} connected`\n        : `${sensorNames[sensorType]} disconnected`;\n\n    announce(message, 'assertive');\n}\n","/**\n * Modal Component\n *\n * Reusable modal dialog system for confirmations and content display.\n * Fully accessible with keyboard navigation and screen reader support.\n *\n * @module modal\n */\n\nimport { announce } from './accessibility.js';\nimport type { ZoneState, ZoneDistribution } from '../zone-state.js';\n\n/**\n * Modal button configuration\n */\nexport interface ModalButton {\n    text: string;\n    variant: 'primary' | 'secondary' | 'danger';\n    onClick: () => void;\n}\n\n/**\n * Modal configuration options\n */\nexport interface ModalOptions {\n    title: string;\n    content: string | HTMLElement;\n    buttons: ModalButton[];\n    icon?: string;\n    onClose?: () => void;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Create a modal element\n */\nfunction createModalElement(options: ModalOptions): HTMLElement {\n    const modal = document.createElement('div');\n    modal.className = 'custom-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-modal', 'true');\n    modal.setAttribute('aria-labelledby', 'modal-title');\n\n    const titleText = options.icon ? `${options.icon} ${options.title}` : options.title;\n\n    modal.innerHTML = `\n        <div class=\"custom-modal-overlay\"></div>\n        <div class=\"custom-modal-container\">\n            <div class=\"custom-modal-header\">\n                <h2 id=\"modal-title\">${titleText}</h2>\n                <button class=\"modal-close-btn\" aria-label=\"Close dialog\">&times;</button>\n            </div>\n            <div class=\"custom-modal-body\"></div>\n            <div class=\"custom-modal-footer\"></div>\n        </div>\n    `;\n\n    // Add content\n    const body = modal.querySelector('.custom-modal-body') as HTMLElement;\n    if (typeof options.content === 'string') {\n        body.innerHTML = options.content;\n    } else {\n        body.appendChild(options.content);\n    }\n\n    // Add buttons\n    const footer = modal.querySelector('.custom-modal-footer') as HTMLElement;\n    options.buttons.forEach((btn, index) => {\n        const button = document.createElement('button');\n        button.textContent = btn.text;\n        button.className = `modal-btn modal-btn-${btn.variant}`;\n        button.addEventListener('click', btn.onClick);\n\n        // Auto-focus the first primary button, or first button if no primary\n        if (btn.variant === 'primary' || (index === 0 && !options.buttons.some(b => b.variant === 'primary'))) {\n            button.setAttribute('data-autofocus', 'true');\n        }\n\n        footer.appendChild(button);\n    });\n\n    return modal;\n}\n\n/**\n * Focus trap for modal accessibility\n */\nfunction trapFocus(modal: HTMLElement): () => void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    const handleTabKey = (e: KeyboardEvent) => {\n        if (e.key !== 'Tab') return;\n\n        if (e.shiftKey) {\n            if (document.activeElement === firstFocusable) {\n                e.preventDefault();\n                lastFocusable?.focus();\n            }\n        } else {\n            if (document.activeElement === lastFocusable) {\n                e.preventDefault();\n                firstFocusable?.focus();\n            }\n        }\n    };\n\n    modal.addEventListener('keydown', handleTabKey);\n    return () => modal.removeEventListener('keydown', handleTabKey);\n}\n\n/**\n * Show a modal dialog\n *\n * @param options - Modal configuration\n * @returns A function to close the modal\n */\nexport function showModal(options: ModalOptions): () => void {\n    const modal = createModalElement(options);\n    const previousActiveElement = document.activeElement as HTMLElement;\n\n    document.body.appendChild(modal);\n\n    // Force reflow for animation\n    modal.offsetHeight;\n    modal.classList.add('modal-visible');\n\n    // Set up focus trap\n    const removeFocusTrap = trapFocus(modal);\n\n    // Focus the autofocus element or first focusable\n    const autofocusEl = modal.querySelector<HTMLElement>('[data-autofocus]');\n    setTimeout(() => {\n        autofocusEl?.focus();\n    }, 50);\n\n    // Close function\n    const closeModal = () => {\n        modal.classList.remove('modal-visible');\n\n        // Remove after animation\n        setTimeout(() => {\n            modal.remove();\n            removeFocusTrap();\n\n            // Restore focus\n            previousActiveElement?.focus();\n\n            options.onClose?.();\n        }, 200);\n    };\n\n    // Close button\n    const closeBtn = modal.querySelector('.modal-close-btn');\n    closeBtn?.addEventListener('click', closeModal);\n\n    // Overlay click\n    if (options.closeOnOverlay !== false) {\n        const overlay = modal.querySelector('.custom-modal-overlay');\n        overlay?.addEventListener('click', closeModal);\n    }\n\n    // Escape key\n    const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n            e.preventDefault();\n            closeModal();\n        }\n    };\n    document.addEventListener('keydown', handleEscape);\n\n    // Cleanup escape listener when modal closes\n    const originalOnClose = options.onClose;\n    options.onClose = () => {\n        document.removeEventListener('keydown', handleEscape);\n        originalOnClose?.();\n    };\n\n    announce(`${options.title} dialog opened`, 'polite');\n\n    return closeModal;\n}\n\n/**\n * Show a confirmation dialog\n *\n * @param title - Dialog title\n * @param message - Confirmation message\n * @param options - Additional options\n * @returns Promise resolving to true if confirmed, false if cancelled\n */\nexport function showConfirmation(\n    title: string,\n    message: string,\n    options: {\n        confirmText?: string;\n        cancelText?: string;\n        confirmVariant?: 'primary' | 'danger';\n        icon?: string;\n    } = {}\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const {\n            confirmText = 'Confirm',\n            cancelText = 'Cancel',\n            confirmVariant = 'primary',\n            icon,\n        } = options;\n\n        let closeModal: (() => void) | null = null;\n\n        closeModal = showModal({\n            title,\n            content: `<p class=\"modal-message\">${message}</p>`,\n            icon,\n            buttons: [\n                {\n                    text: cancelText,\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(false);\n                    },\n                },\n                {\n                    text: confirmText,\n                    variant: confirmVariant,\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(true);\n                    },\n                },\n            ],\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Workout summary data\n */\nexport interface WorkoutSummary {\n    duration: number;\n    startTime: number;\n    endTime: number;\n    power: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    heartrate: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    cadence: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    powerZoneDistribution?: ZoneDistribution;\n    hrZoneDistribution?: ZoneDistribution;\n    powerCurve?: { duration: number; watts: number }[];\n    trainingLoad?: number;\n    intensityFactor?: number;\n}\n\n/**\n * Calculate workout summary statistics\n */\nexport function calculateWorkoutSummary(\n    startTime: number,\n    endTime: number,\n    measurements: {\n        power: { value: number }[];\n        heartrate: { value: number }[];\n        cadence: { value: number }[];\n    },\n    zoneState?: ZoneState\n): WorkoutSummary {\n    const calcStats = (data: { value: number }[]) => {\n        if (data.length === 0) {\n            return { avg: null, max: null, count: 0 };\n        }\n        const values = data.map((d) => d.value);\n        const sum = values.reduce((a, b) => a + b, 0);\n        return {\n            avg: Math.round(sum / values.length),\n            max: Math.max(...values),\n            count: values.length,\n        };\n    };\n\n    // Calculate Power Curve\n    const powerValues = measurements.power.map(p => p.value);\n    const powerCurve: { duration: number; watts: number }[] = [];\n    const durations = [1, 5, 10, 30, 60, 300, 1200, 3600]; // 1s, 5s, 10s, 30s, 1m, 5m, 20m, 1h\n\n    // Helper for sliding window max\n    const getMaxForDuration = (windowSize: number) => {\n        if (powerValues.length < windowSize) return 0;\n        let sum = 0;\n        for (let i = 0; i < windowSize; i++) sum += powerValues[i];\n        let maxAvg = sum / windowSize;\n\n        for (let i = windowSize; i < powerValues.length; i++) {\n            sum = sum - powerValues[i - windowSize] + powerValues[i];\n            if ((sum / windowSize) > maxAvg) maxAvg = sum / windowSize;\n        }\n        return Math.round(maxAvg);\n    };\n\n    for (const d of durations) {\n        if (powerValues.length >= d) {\n            powerCurve.push({ duration: d, watts: getMaxForDuration(d) });\n        }\n    }\n\n    // Calculate TSS & IF (Assuming FTP = 200 if not set, should ideally come from user profile)\n    // TODO: Fetch user profile FTP properly. Using a fallback for now.\n    // Normalized power approximation: xPower (simple moving average for now or just avg)\n    // Real NP requires 30s rolling avg, raised to 4th power, avg, 4th root.\n\n    let trainingLoad = 0;\n    let intensityFactor = 0;\n\n    // Quick and dirty TSS if we have \"bpt-user-profile\" in localstorage\n    try {\n        const profileStr = localStorage.getItem('bpt-user-profile');\n        if (profileStr && powerValues.length > 0) {\n            const profile = JSON.parse(profileStr);\n            const ftp = profile.ftp || 200;\n\n            // Calculate Normalized Power (Simplified algorithm)\n            // 1. 30s rolling avg\n            const rolling30s: number[] = [];\n            let sum30 = 0;\n            for (let i = 0; i < powerValues.length; i++) {\n                sum30 += powerValues[i];\n                if (i >= 30) sum30 -= powerValues[i - 30];\n                if (i >= 29) rolling30s.push(sum30 / 30);\n            }\n\n            if (rolling30s.length > 0) {\n                // 2. raise to 4th power\n                const pow4 = rolling30s.map(v => Math.pow(v, 4));\n                // 3. average\n                const avgPow4 = pow4.reduce((a, b) => a + b, 0) / pow4.length;\n                // 4. 4th root\n                const np = Math.pow(avgPow4, 0.25);\n\n                intensityFactor = np / ftp;\n                // TSS = (sec x NP x IF) / (FTP x 3600) x 100\n                const durationSec = (endTime - startTime) / 1000;\n                trainingLoad = (durationSec * np * intensityFactor) / (ftp * 3600) * 100;\n            }\n        }\n    } catch (e) {\n        console.warn('Error calculating TSS', e);\n    }\n\n    const summary: WorkoutSummary = {\n        duration: endTime - startTime,\n        startTime,\n        endTime,\n        power: calcStats(measurements.power),\n        heartrate: calcStats(measurements.heartrate),\n        cadence: calcStats(measurements.cadence),\n        powerCurve: powerCurve.length > 0 ? powerCurve : undefined,\n        trainingLoad: trainingLoad > 0 ? Math.round(trainingLoad) : undefined,\n        intensityFactor: intensityFactor > 0 ? parseFloat(intensityFactor.toFixed(2)) : undefined,\n    };\n\n    // Add zone distributions if available\n    if (zoneState) {\n        const powerDist = zoneState.getPowerZoneDistribution();\n        const hrDist = zoneState.getHrZoneDistribution();\n\n        if (powerDist.totalTimeMs > 0) {\n            summary.powerZoneDistribution = powerDist;\n        }\n        if (hrDist.totalTimeMs > 0) {\n            summary.hrZoneDistribution = hrDist;\n        }\n    }\n\n    return summary;\n}\n\n/**\n * Format duration in milliseconds to human readable string\n */\nexport function formatDurationLong(ms: number): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    const parts: string[] = [];\n    if (hours > 0) parts.push(`${hours}h`);\n    if (minutes > 0) parts.push(`${minutes}m`);\n    if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);\n\n    return parts.join(' ');\n}\n\n/**\n * Format seconds to MM:SS format\n */\nfunction formatSecondsShort(seconds: number): string {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n}\n\n/**\n * Zone colors for the histogram\n */\nconst ZONE_COLORS: Record<number, string> = {\n    1: '#3b82f6', // Blue - Recovery\n    2: '#22c55e', // Green - Endurance\n    3: '#eab308', // Yellow - Tempo\n    4: '#f97316', // Orange - Threshold\n    5: '#ef4444', // Red - VO2max/Anaerobic\n    6: '#a855f7', // Purple - Anaerobic (power)\n    7: '#ec4899', // Pink - Neuromuscular (power)\n};\n\n/**\n * Create zone distribution histogram chart\n */\nfunction createZoneHistogram(distribution: ZoneDistribution, title: string): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'zone-distribution';\n\n    // Filter zones with time > 0\n    const activeZones = distribution.zones.filter(z => z.timeInZoneMs > 0);\n\n    if (activeZones.length === 0) {\n        return container; // Return empty if no zone data\n    }\n\n    const maxTime = Math.max(...distribution.zones.map(z => z.timeInZoneMs));\n\n    container.innerHTML = `\n        <h4 class=\"zone-distribution-title\">${title}</h4>\n        <div class=\"zone-chart\">\n            ${distribution.zones.map(zone => {\n        const percent = maxTime > 0 ? (zone.timeInZoneMs / maxTime) * 100 : 0;\n        const timeSeconds = Math.round(zone.timeInZoneMs / 1000);\n        const color = ZONE_COLORS[zone.zone] || '#888';\n        const timeStr = formatSecondsShort(timeSeconds);\n\n        return `\n                    <div class=\"zone-bar-row\" title=\"${zone.name}: ${timeStr}\">\n                        <span class=\"zone-bar-label\">Z${zone.zone}</span>\n                        <div class=\"zone-bar-container\">\n                            <div class=\"zone-bar\" style=\"width: ${Math.max(percent, 2)}%; background-color: ${color};\" aria-valuenow=\"${timeSeconds}\" aria-label=\"${zone.name}\"></div>\n                        </div>\n                        <span class=\"zone-bar-time\">${timeStr}</span>\n                    </div>\n                `;\n    }).join('')}\n        </div>\n    `;\n\n    return container;\n}\n\n/**\n * Create workout summary content HTML element\n */\nexport function createSummaryContent(summary: WorkoutSummary, newRecords: string[] = []): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'workout-summary';\n\n    const formatValue = (value: number | null, unit: string): string => {\n        return value !== null ? `${value}${unit}` : '--';\n    };\n\n    // New Records Section\n    let recordsHtml = '';\n    if (newRecords.length > 0) {\n        recordsHtml = `\n            <div class=\"summary-records\" style=\"background: rgba(255, 215, 0, 0.1); border: 1px solid var(--color-accent); border-radius: 8px; padding: 12px; margin-bottom: 16px;\">\n                <h4 style=\"margin: 0 0 8px 0; color: var(--color-accent); display: flex; align-items: center; gap: 8px;\">\n                     New Personal Records!\n                </h4>\n                <ul style=\"margin: 0; padding-left: 20px; list-style-type: none;\">\n                    ${newRecords.map(r => `<li style=\"margin-bottom: 4px;\"> ${r}</li>`).join('')}\n                </ul>\n            </div>\n        `;\n    }\n\n    container.innerHTML = `\n        ${recordsHtml}\n        <div class=\"summary-duration\">\n            <span class=\"summary-label\">Duration</span>\n            <span class=\"summary-value\">${formatDurationLong(summary.duration)}</span>\n        </div>\n        <div class=\"summary-grid\">\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Power</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.power.avg, 'W')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.power.max, 'W')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Heart Rate</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.heartrate.avg, ' bpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.heartrate.max, ' bpm')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Cadence</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.cadence.avg, ' rpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.cadence.max, ' rpm')}</span>\n                </div>\n            </div>\n        </div>\n        <div class=\"summary-samples\">\n            <span class=\"summary-samples-text\">\n                ${summary.power.count + summary.heartrate.count + summary.cadence.count} data points recorded\n            </span>\n        </div>\n    `;\n\n    // Add zone distribution charts if available\n    if (summary.powerZoneDistribution && summary.powerZoneDistribution.totalTimeMs > 0) {\n        const powerChart = createZoneHistogram(summary.powerZoneDistribution, ' Power Zone Distribution');\n        container.appendChild(powerChart);\n    }\n\n    if (summary.hrZoneDistribution && summary.hrZoneDistribution.totalTimeMs > 0) {\n        const hrChart = createZoneHistogram(summary.hrZoneDistribution, ' Heart Rate Zone Distribution');\n        container.appendChild(hrChart);\n    }\n\n    return container;\n}\n\n/**\n * Show post-workout summary modal\n *\n * @param summary - Workout summary data\n * @param callbacks - Action callbacks\n * @returns Promise resolving to the chosen action\n */\nexport function showWorkoutSummary(\n    summary: WorkoutSummary,\n    callbacks: {\n        onExport: () => void;\n        onDiscard: () => void;\n        onKeepRecording: () => void;\n    },\n    newRecords: string[] = []\n): Promise<'export' | 'discard' | 'keep'> {\n    return new Promise((resolve) => {\n        let closeModal: (() => void) | null = null;\n\n        const content = createSummaryContent(summary, newRecords);\n\n        closeModal = showModal({\n            title: 'Workout Complete',\n            content,\n            icon: '',\n            closeOnOverlay: false,\n            buttons: [\n                {\n                    text: ' Discard',\n                    variant: 'danger',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onDiscard();\n                        resolve('discard');\n                    },\n                },\n                {\n                    text: ' Keep Recording',\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onKeepRecording();\n                        resolve('keep');\n                    },\n                },\n                {\n                    text: ' Save & Finish',\n                    variant: 'primary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onExport();\n                        resolve('export');\n                    },\n                },\n            ],\n            onClose: () => {\n                callbacks.onKeepRecording();\n                resolve('keep');\n            },\n        });\n    });\n}\n","/**\n * Simple SVG Charting Library for Bike Power Tracker\n * \n * Renders lightweight SVG charts for workout analysis.\n * \n * @module ui/charts\n */\n\nexport interface Point {\n    x: number; // Timestamp or relative time\n    y: number; // Value\n}\n\nexport interface ChartOptions {\n    color?: string;\n    height?: number;\n    title?: string;\n    yLabel?: string;\n    xLabel?: string;\n    yMin?: number;\n    yMax?: number;\n}\n\n/**\n * Render a simple line chart into a container\n */\nexport function renderLineChart(container: HTMLElement, data: Point[], options: ChartOptions = {}): void {\n    if (!container) return;\n\n    // Configuration\n    const height = options.height || 200;\n    const color = options.color || 'var(--color-accent)';\n    const padTop = 20;\n    const padBottom = 30;\n    const padLeft = 40;\n    const padRight = 10;\n\n    // Handle empty data\n    if (!data || data.length < 2) {\n        container.innerHTML = `\n            <div style=\"\n                display:flex; \n                justify-content:center; \n                align-items:center; \n                height:${height}px; \n                color: var(--color-text-secondary);\n                background: var(--card-bg);\n                border-radius: 8px;\n            \">\n                No data available\n            </div>\n        `;\n        return;\n    }\n\n    // Downsample if too many points (limit to ~500 points for performance)\n    const processedData = downsample(data, 500);\n\n    // Get value ranges\n    const xValues = processedData.map(p => p.x);\n    const yValues = processedData.map(p => p.y);\n\n    const minX = Math.min(...xValues);\n    const maxX = Math.max(...xValues);\n    let minY = options.yMin ?? Math.min(...yValues);\n    let maxY = options.yMax ?? Math.max(...yValues);\n\n    // Add some headroom to Y axis\n    const yRange = maxY - minY;\n    if (yRange === 0) {\n        maxY += 10;\n        minY -= 10;\n    } else {\n        // If not fixed to 0, add padding. If usually 0-based (like power), kept 0.\n        if (options.yMin === undefined) {\n            // If data is far from 0, don't force 0, but add padding\n            minY -= yRange * 0.1;\n        }\n        maxY += yRange * 0.1;\n    }\n\n    // Get container width\n    const width = container.clientWidth || container.parentElement?.clientWidth || 600;\n\n    // Helper to map values to coordinates\n    const getX = (val: number) => padLeft + ((val - minX) / (maxX - minX)) * (width - padLeft - padRight);\n    const getY = (val: number) => height - padBottom - ((val - minY) / (maxY - minY)) * (height - padTop - padBottom);\n\n    // Generate Path\n    const pathD = `M ${processedData.map(p => `${getX(p.x).toFixed(1)},${getY(p.y).toFixed(1)}`).join(' L ')}`;\n\n    // Generate Area fill (optional, looks nice)\n    const areaD = `${pathD} L ${getX(processedData[processedData.length - 1].x).toFixed(1)},${height - padBottom} L ${getX(processedData[0].x).toFixed(1)},${height - padBottom} Z`;\n\n    // Generate Grid Lines\n    // Y-Axis: 5 lines\n    const gridLines = [];\n    const yStep = (maxY - minY) / 4;\n    for (let i = 0; i <= 4; i++) {\n        const val = minY + (i * yStep);\n        const y = getY(val);\n        gridLines.push(`\n            <line x1=\"${padLeft}\" y1=\"${y}\" x2=\"${width - padRight}\" y2=\"${y}\" stroke=\"var(--color-border)\" stroke-width=\"1\" stroke-dasharray=\"4\" opacity=\"0.5\" />\n            <text x=\"${padLeft - 5}\" y=\"${y + 4}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${Math.round(val)}</text>\n        `);\n    }\n\n    // X-Axis: Time labels (Start, Middle, End)\n    const startTimeStr = formatTime(0); // Relative time 0\n    const midTimeStr = formatTime((maxX - minX) / 2);\n    const endTimeStr = formatTime(maxX - minX);\n\n    // Construct SVG\n    const svg = `\n        <svg width=\"100%\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" style=\"background: var(--card-bg); border-radius: 8px;\">\n            <defs>\n                <linearGradient id=\"chartGradient-${options.title?.replace(/\\s/g, '')}\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\n                    <stop offset=\"0%\" stop-color=\"${color}\" stop-opacity=\"0.2\"/>\n                    <stop offset=\"100%\" stop-color=\"${color}\" stop-opacity=\"0\"/>\n                </linearGradient>\n            </defs>\n\n            <!-- Grid -->\n            ${gridLines.join('')}\n\n            <!-- Axis Labels -->\n            <text x=\"${padLeft}\" y=\"${height - 10}\" text-anchor=\"start\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${startTimeStr}</text>\n            <text x=\"${width / 2}\" y=\"${height - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${midTimeStr}</text>\n            <text x=\"${width - padRight}\" y=\"${height - 10}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${endTimeStr}</text>\n\n            <!-- Data Area -->\n            <path d=\"${areaD}\" fill=\"url(#chartGradient-${options.title?.replace(/\\s/g, '')})\" stroke=\"none\" />\n            \n            <!-- Data Line -->\n            <path d=\"${pathD}\" fill=\"none\" stroke=\"${color}\" stroke-width=\"2\" vector-effect=\"non-scaling-stroke\" />\n\n            <!-- Title -->\n            ${options.title ? `<text x=\"${width / 2}\" y=\"${15}\" text-anchor=\"middle\" font-weight=\"bold\" font-size=\"12\" fill=\"var(--color-text-primary)\">${options.title}</text>` : ''}\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n\n/**\n * Reduce approximate number of points to target using simple N-th sampling\n */\nfunction downsample(data: Point[], target: number): Point[] {\n    if (data.length <= target) return data;\n    const step = Math.ceil(data.length / target);\n    const result = [];\n    for (let i = 0; i < data.length; i += step) {\n        result.push(data[i]);\n    }\n    return result;\n}\n\n/**\n * Format milliseconds to HH:MM:SS or MM:SS\n */\nfunction formatTime(ms: number): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const h = Math.floor(totalSeconds / 3600);\n    const m = Math.floor((totalSeconds % 3600) / 60);\n    const s = totalSeconds % 60;\n\n    if (h > 0) {\n        return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n    }\n    return `${m}:${s.toString().padStart(2, '0')}`;\n}\n\n/**\n * Render a simple bar chart into a container\n */\nexport function renderBarChart(container: HTMLElement, data: Point[], options: ChartOptions = {}): void {\n    if (!container) return;\n\n    // Configuration\n    const height = options.height || 200;\n    const color = options.color || 'var(--color-accent)';\n    const padTop = 30;\n    const padBottom = 30;\n    const padLeft = 40;\n    const padRight = 10;\n    const barGap = 4;\n\n    // Handle empty data\n    if (!data || data.length === 0) {\n        container.innerHTML = `\n            <div style=\"\n                display:flex; \n                justify-content:center; \n                align-items:center; \n                height:${height}px; \n                color: var(--color-text-secondary);\n                background: var(--card-bg);\n                border-radius: 8px;\n            \">\n                No data available\n            </div>\n        `;\n        return;\n    }\n\n    // Process Values\n    const yValues = data.map(p => p.y);\n    let maxY = options.yMax ?? (Math.max(...yValues) * 1.1); // 10% headroom\n    let minY = options.yMin ?? 0;\n\n    if (maxY === minY) maxY += 10;\n\n    // Get container width\n    const width = container.clientWidth || container.parentElement?.clientWidth || 600;\n\n    // Calculate bar dimensions\n    const availableWidth = width - padLeft - padRight;\n    // Ensure minimum bar width of 2px\n    const barWidth = Math.max(2, (availableWidth / data.length) - barGap);\n\n    const getX = (index: number) => padLeft + (index * (barWidth + barGap)) + (barGap / 2); // Center in slot\n    const getY = (val: number) => height - padBottom - ((val - minY) / (maxY - minY)) * (height - padTop - padBottom);\n\n    const bars = data.map((p, i) => {\n        const x = getX(i);\n        const y = getY(p.y);\n        const h = Math.max(0, (height - padBottom) - y); // Prevent negative height\n\n        // Don't render bars with 0 height or weird coordinates\n        if (h <= 0 || isNaN(y) || isNaN(h)) return '';\n\n        return `<rect x=\"${x.toFixed(1)}\" y=\"${y.toFixed(1)}\" width=\"${barWidth.toFixed(1)}\" height=\"${h.toFixed(1)}\" fill=\"${color}\" rx=\"2\" opacity=\"0.8\" />`;\n    });\n\n    // Generate Labels (simplified X axis labels)\n    // Reduce labels if too many\n    const maxLabels = 7;\n    const labelStep = Math.max(1, Math.floor(data.length / maxLabels));\n\n    const xLabels = data.map((p, i) => {\n        if (i % labelStep !== 0) return '';\n        // Date formatting based on X value (timestamp)\n        const date = new Date(p.x);\n        // Short date format DD/MM\n        const label = `${date.getDate()}/${date.getMonth() + 1}`;\n        const x = getX(i) + (barWidth / 2);\n        return `<text x=\"${x.toFixed(1)}\" y=\"${height - 5}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${label}</text>`;\n    });\n\n    // Generate Y Grid and Labels\n    const gridLines = [];\n    const yStep = (maxY - minY) / 4;\n    for (let i = 0; i <= 4; i++) {\n        const val = minY + (i * yStep);\n        const y = getY(val);\n        gridLines.push(`\n            <line x1=\"${padLeft}\" y1=\"${y}\" x2=\"${width - padRight}\" y2=\"${y}\" stroke=\"var(--color-border)\" stroke-width=\"1\" stroke-dasharray=\"4\" opacity=\"0.3\" />\n            <text x=\"${padLeft - 5}\" y=\"${y + 4}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${Math.round(val)}</text>\n        `);\n    }\n\n    const svg = `\n        <svg width=\"100%\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" style=\"background: var(--card-bg); border-radius: 8px;\">\n            ${gridLines.join('')}\n            ${bars.join('')}\n            ${xLabels.join('')}\n            <!-- Axis Lines -->\n            <line x1=\"${padLeft}\" y1=\"${padTop}\" x2=\"${padLeft}\" y2=\"${height - padBottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${padLeft}\" y1=\"${height - padBottom}\" x2=\"${width - padRight}\" y2=\"${height - padBottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <!-- Title -->\n             ${options.title ? `<text x=\"${width / 2}\" y=\"15\" text-anchor=\"middle\" font-size=\"12\" font-weight=\"bold\" fill=\"var(--color-text-primary)\">${options.title}</text>` : ''}\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n","/**\n * Statistics View Component\n * \n * Aggregates and renders workout statistics across different time periods.\n * \n * @module ui/statistics\n */\n\nimport type { Workout } from '../api/workoutClient.js';\nimport type { WorkoutSummary } from '../types/measurements.js';\nimport { formatDuration } from '../api/workoutClient.js';\nimport { renderBarChart, type Point } from './charts.js';\n\ninterface PeriodStats {\n    count: number;\n    distance: number;\n    duration: number;\n    elevation: number;\n    energy: number;\n\n    avgPower: number;\n    avgHr: number;\n    avgCadence: number;\n\n    weightedPowerSum: number; // for calculating avg power across varying durations\n    weightedHrSum: number;\n    weightedCadenceSum: number;\n    totalDurationForAvg: number;\n}\n\nconst emptyStats = (): PeriodStats => ({\n    count: 0,\n    distance: 0,\n    duration: 0,\n    elevation: 0,\n    energy: 0,\n    avgPower: 0,\n    avgHr: 0,\n    avgCadence: 0,\n    weightedPowerSum: 0,\n    weightedHrSum: 0,\n    weightedCadenceSum: 0,\n    totalDurationForAvg: 0\n});\n\nfunction getSummary(workout: Workout): Partial<WorkoutSummary> {\n    if (!workout.summary) return {};\n    if (typeof workout.summary === 'string') {\n        try {\n            return JSON.parse(workout.summary);\n        } catch {\n            return {};\n        }\n    }\n    return workout.summary as unknown as WorkoutSummary;\n}\n\n/**\n * State for the statistics view\n */\nlet currentWorkouts: Workout[] = [];\nlet trendMetric: 'distance' | 'duration' | 'energy' | 'count' = 'distance';\n\n/**\n * Main function to render statistics into a container\n */\nexport function renderPeriodStatistics(containerId: string, workouts: Workout[]): void {\n    const container = document.getElementById(containerId);\n    if (!container) return;\n\n    // Update state\n    currentWorkouts = workouts;\n\n    // Check if we already injected our specific container\n    let statsContainer = document.getElementById('periodStatsContainer');\n    if (!statsContainer) {\n        statsContainer = document.createElement('div');\n        statsContainer.id = 'periodStatsContainer';\n        statsContainer.style.display = 'grid';\n        statsContainer.style.gap = '16px';\n        statsContainer.style.marginBottom = '20px';\n\n        // Insert at the top of the analytics view\n        container.insertBefore(statsContainer, container.firstChild);\n    }\n\n    // 1. Render Summary Table Card\n    renderSummaryTable(statsContainer, workouts);\n\n    // 2. Render Trends Chart Card\n    renderTrendsChart(statsContainer);\n}\n\n/**\n * Render the summary comparison table\n */\nfunction renderSummaryTable(parent: HTMLElement, workouts: Workout[]): void {\n    let card = document.getElementById('statsTableCard');\n    if (!card) {\n        card = document.createElement('div');\n        card.id = 'statsTableCard';\n        card.className = 'card';\n        card.style.background = 'var(--card-bg)';\n        card.style.padding = '16px';\n        card.style.borderRadius = '8px';\n        card.style.border = '1px solid var(--color-border)';\n        parent.appendChild(card);\n    }\n\n    // Constants for periods\n    const now = new Date();\n\n    // Define time ranges\n    // This Week (starts Monday)\n    const startOfWeek = new Date(now);\n    const day = startOfWeek.getDay() || 7; // getDay returns 0 for Sunday\n    if (day !== 1) startOfWeek.setHours(-24 * (day - 1));\n    else startOfWeek.setHours(0, 0, 0, 0);\n    startOfWeek.setHours(0, 0, 0, 0);\n\n    const startOfLastWeek = new Date(startOfWeek);\n    startOfLastWeek.setDate(startOfLastWeek.getDate() - 7);\n    const endOfLastWeek = new Date(startOfWeek);\n\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n    const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59);\n\n    const startOfYear = new Date(now.getFullYear(), 0, 1);\n\n    // Buckets\n    const periods: Record<'thisWeek' | 'lastWeek' | 'thisMonth' | 'lastMonth' | 'thisYear', PeriodStats> = {\n        thisWeek: emptyStats(),\n        lastWeek: emptyStats(),\n        thisMonth: emptyStats(),\n        lastMonth: emptyStats(),\n        thisYear: emptyStats()\n    };\n\n    // Aggregate Data\n    workouts.forEach(w => {\n        const date = new Date(w.startTime);\n        const summary = getSummary(w);\n\n        // Determine which buckets this workout belongs to\n        const buckets: PeriodStats[] = [];\n\n        if (date >= startOfWeek) buckets.push(periods.thisWeek);\n        if (date >= startOfLastWeek && date < endOfLastWeek) buckets.push(periods.lastWeek);\n        if (date >= startOfMonth) buckets.push(periods.thisMonth);\n        if (date >= startOfLastMonth && date <= endOfLastMonth) buckets.push(periods.lastMonth);\n        if (date >= startOfYear) buckets.push(periods.thisYear);\n\n        // Add to buckets\n        buckets.forEach(stat => {\n            stat.count++;\n            stat.duration += (w.duration || 0);\n            stat.distance += (summary.totalDistance || 0);\n            stat.elevation += (summary.totalElevationGain || 0);\n\n            // Energy\n            if (summary.totalEnergy) {\n                stat.energy += summary.totalEnergy;\n            } else if (summary.avgPower && w.duration) {\n                stat.energy += (summary.avgPower * w.duration) / 1000;\n            }\n\n            // Weighted Averages\n            const dur = w.duration || 0;\n            if (dur > 0) {\n                if (summary.avgPower) stat.weightedPowerSum += summary.avgPower * dur;\n                if (summary.avgHeartrate) stat.weightedHrSum += summary.avgHeartrate * dur;\n                if (summary.avgCadence) stat.weightedCadenceSum += summary.avgCadence * dur;\n                stat.totalDurationForAvg += dur;\n            }\n        });\n    });\n\n    // Finalize Averages\n    Object.values(periods).forEach(stat => {\n        if (stat.totalDurationForAvg > 0) {\n            stat.avgPower = Math.round(stat.weightedPowerSum / stat.totalDurationForAvg);\n            stat.avgHr = Math.round(stat.weightedHrSum / stat.totalDurationForAvg);\n            stat.avgCadence = Math.round(stat.weightedCadenceSum / stat.totalDurationForAvg);\n        }\n    });\n\n    // Helpers\n    const renderCell = (val: string) =>\n        `<td style=\"padding: 8px; text-align: right; border-bottom: 1px solid var(--color-border);\">${val}</td>`;\n\n    const formatDist = (m: number) => (m / 1000).toFixed(1) + ' km';\n\n    interface RowDef {\n        label: string;\n        key: keyof PeriodStats;\n        fmt: (v: number) => string;\n    }\n\n    const rows: RowDef[] = [\n        { label: 'Workouts', key: 'count', fmt: (v: number) => v.toString() },\n        { label: 'Distance', key: 'distance', fmt: formatDist },\n        { label: 'Time', key: 'duration', fmt: (v: number) => formatDuration(v) },\n        { label: 'Elevation', key: 'elevation', fmt: (v: number) => v + ' m' },\n        { label: 'Avg Power', key: 'avgPower', fmt: (v: number) => v + ' W' },\n        { label: 'Avg HR', key: 'avgHr', fmt: (v: number) => v + ' bpm' },\n        { label: 'Energy', key: 'energy', fmt: (v: number) => Math.round(v) + ' kJ' },\n    ];\n\n    card.innerHTML = `\n        <h4 style=\"margin: 0 0 12px 0;\"> Period Statistics</h4>\n        <div style=\"overflow-x: auto;\">\n            <table style=\"width: 100%; border-collapse: collapse; font-size: 0.9em;\">\n                <thead>\n                    <tr style=\"background: var(--color-bg-secondary);\">\n                        <th style=\"text-align: left; padding: 8px; border-bottom: 2px solid var(--color-border);\">Metric</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border);\">This Week</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border); color: var(--color-text-secondary);\">Last Week</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border);\">This Month</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border); color: var(--color-text-secondary);\">Last Month</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border);\">This Year</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${rows.map(row => `\n                        <tr>\n                            <td style=\"padding: 8px; font-weight: 500; border-bottom: 1px solid var(--color-border);\">${row.label}</td>\n                            ${renderCell(row.fmt(periods.thisWeek[row.key] as number))}\n                            ${renderCell(row.fmt(periods.lastWeek[row.key] as number))}\n                            ${renderCell(row.fmt(periods.thisMonth[row.key] as number))}\n                            ${renderCell(row.fmt(periods.lastMonth[row.key] as number))}\n                            ${renderCell(row.fmt(periods.thisYear[row.key] as number))}\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Render the weekly trends chart\n */\nfunction renderTrendsChart(parent: HTMLElement): void {\n    let card = document.getElementById('statsChartCard');\n\n    // Create card if not exists\n    if (!card) {\n        card = document.createElement('div');\n        card.id = 'statsChartCard';\n        card.className = 'card';\n        card.style.background = 'var(--card-bg)';\n        card.style.padding = '16px';\n        card.style.borderRadius = '8px';\n        card.style.border = '1px solid var(--color-border)';\n\n        // Initial HTML structure with header and controls\n        card.innerHTML = `\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\n                <h4 style=\"margin: 0;\"> Weekly Trends (Last 12 Weeks)</h4>\n                <select id=\"trendMetricSelect\" style=\"padding: 4px; border-radius: 4px; border: 1px solid var(--color-border);\">\n                    <option value=\"distance\">Distance</option>\n                    <option value=\"duration\">Time</option>\n                    <option value=\"energy\">Energy</option>\n                    <option value=\"count\">Workouts</option>\n                </select>\n            </div>\n            <div id=\"trendChartContainer\" style=\"height: 200px;\"></div>\n        `;\n\n        parent.appendChild(card);\n\n        // Add event listener\n        const select = card.querySelector('#trendMetricSelect') as HTMLSelectElement;\n        select?.addEventListener('change', (e) => {\n            trendMetric = (e.target as HTMLSelectElement).value as typeof trendMetric;\n            updateChart();\n        });\n    }\n\n    updateChart();\n}\n\n/**\n * Update the chart content based on current state\n */\nfunction updateChart(): void {\n    const container = document.getElementById('trendChartContainer');\n    if (!container) return;\n\n    const select = document.getElementById('trendMetricSelect') as HTMLSelectElement | null;\n    if (select) select.value = trendMetric; // Sync UI\n\n    // Aggregate data by week for the last 12 weeks\n    const weeks: Record<string, number> = {};\n    const now = new Date();\n\n    // Initialize 12 weeks with 0\n    for (let i = 11; i >= 0; i--) {\n        const d = new Date(now);\n        d.setDate(d.getDate() - (i * 7));\n        const weekKey = getWeekKey(d);\n        weeks[weekKey] = 0;\n    }\n\n    // Fill data\n    currentWorkouts.forEach(w => {\n        const date = new Date(w.startTime);\n        const weekKey = getWeekKey(date);\n\n        if (weeks.hasOwnProperty(weekKey)) {\n            const summary = getSummary(w);\n\n            switch (trendMetric) {\n                case 'distance':\n                    weeks[weekKey] += (summary.totalDistance || 0) / 1000; // km\n                    break;\n                case 'duration':\n                    weeks[weekKey] += (w.duration || 0); // seconds\n                    break;\n                case 'energy':\n                    if (summary.totalEnergy) {\n                        weeks[weekKey] += summary.totalEnergy;\n                    } else if (summary.avgPower && w.duration) {\n                        weeks[weekKey] += (summary.avgPower * w.duration) / 1000;\n                    }\n                    break;\n                case 'count':\n                    weeks[weekKey] += 1;\n                    break;\n            }\n        }\n    });\n\n    // Convert to points\n    const points: Point[] = Object.entries(weeks)\n        .sort((a, b) => a[0].localeCompare(b[0]))\n        .map(([key, val]) => {\n            // weekKey is \"YYYY-Www\", parse to timestamp for x-axis\n            const [year, week] = key.split('-W').map(Number);\n            // Rough approximation of week start date for chart x-axis\n            const d = getDateFromWeek(year, week);\n            return { x: d.getTime(), y: val };\n        });\n\n    // Chart options\n    let title = '';\n\n    switch (trendMetric) {\n        case 'distance': title = 'Distance (km)'; break;\n        case 'duration': title = 'Time (hours)'; break; // Chart formatter might need update for hours?\n        case 'energy': title = 'Energy (kJ)'; break;\n        case 'count': title = 'Number of Workouts'; break;\n    }\n\n    // Special formatting for duration\n    if (trendMetric === 'duration') {\n        points.forEach(p => p.y = p.y / 3600); // Convert seconds to hours\n    }\n\n    renderBarChart(container, points, {\n        title,\n        height: 200,\n        color: 'var(--color-accent)'\n    });\n}\n\n/**\n * Get ISO week string \"YYYY-Www\"\n */\nfunction getWeekKey(date: Date): string {\n    const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\n    const dayNum = d.getUTCDay() || 7;\n    d.setUTCDate(d.getUTCDate() + 4 - dayNum);\n    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n    const weekNo = Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7);\n    return `${d.getUTCFullYear()}-W${weekNo.toString().padStart(2, '0')}`;\n}\n\n/**\n * Get date object from year and week number\n */\nfunction getDateFromWeek(year: number, week: number): Date {\n    const d = new Date(year, 0, 1 + (week - 1) * 7);\n    const day = d.getDay();\n    const diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday\n    return new Date(d.setDate(diff));\n}","/**\n * Workout Cropping Utility\n * \n * Provides functionality to crop workout data (measurements) based on start and end timestamps.\n * Recalculates summary statistics after cropping.\n * \n * @module utils/cropWorkout\n */\n\nimport type { MeasurementsData, Measurement, GpsPoint, TreadmillMeasurement, LapMarker, WorkoutSummary } from '../types/measurements.js';\nimport { calculateWorkoutSummary, type WorkoutSummary as ModalWorkoutSummary } from '../ui/modal.js';\n\n/**\n * Result of a crop operation\n */\nexport interface CroppedWorkoutData {\n    startTime: number;\n    endTime: number;\n    duration: number;\n    measurements: MeasurementsData;\n    summary: WorkoutSummary;\n}\n\n/**\n * Crops workout measurements to a specific time range.\n * \n * @param measurements Original measurement data\n * @param originalStartTime The original start time of the workout (ms)\n * @param newStartTime New start time (ms) - absolute timestamp, must be >= originalStartTime\n * @param newEndTime New end time (ms) - absolute timestamp, must be <= originalEndTime\n * @returns Cropped measurements and recalculated summary\n */\nexport function cropWorkout(\n    measurements: MeasurementsData,\n    originalStartTime: number,\n    newStartTime: number,\n    newEndTime: number\n): CroppedWorkoutData {\n\n    // Ensure bounds are valid\n    const start = Math.max(originalStartTime, newStartTime);\n    const end = Math.max(start, newEndTime);\n\n    // Filter function for standard Measurement[]\n    const filterMeasurements = (data: Measurement[]) => {\n        return data.filter(m => m.timestamp >= start && m.timestamp <= end);\n    };\n\n    // Filter specific types\n    const croppedMeasurements: MeasurementsData = {\n        heartrate: filterMeasurements(measurements.heartrate || []),\n        power: filterMeasurements(measurements.power || []),\n        cadence: filterMeasurements(measurements.cadence || []),\n        speed: filterMeasurements(measurements.speed || []),\n        distance: filterMeasurements(measurements.distance || []),\n        altitude: filterMeasurements(measurements.altitude || []),\n        gps: (measurements.gps || []).filter((p: GpsPoint) => p.timestamp >= start && p.timestamp <= end),\n        treadmill: (measurements.treadmill || []).filter((t: TreadmillMeasurement) => t.timestamp >= start && t.timestamp <= end),\n        treadmillSpeed: filterMeasurements(measurements.treadmillSpeed || []),\n        laps: (measurements.laps || []).filter((l: LapMarker) => l.timestamp >= start && l.timestamp <= end)\n    };\n\n    // Calculate new duration (seconds)\n    const duration = Math.floor((end - start) / 1000);\n\n    // Recalculate summary using modal's calculator\n    const modalSummary: ModalWorkoutSummary = calculateWorkoutSummary(\n        start,\n        end,\n        {\n            power: croppedMeasurements.power,\n            heartrate: croppedMeasurements.heartrate,\n            cadence: croppedMeasurements.cadence\n        }\n    );\n\n    // Convert to standard flat WorkoutSummary\n    const summary: WorkoutSummary = {\n        startTime: start,\n        endTime: end,\n        totalDuration: duration,\n        avgPower: modalSummary.power.avg ?? undefined,\n        maxPower: modalSummary.power.max ?? undefined,\n        avgHeartrate: modalSummary.heartrate.avg ?? undefined,\n        maxHeartrate: modalSummary.heartrate.max ?? undefined,\n        avgCadence: modalSummary.cadence.avg ?? undefined,\n        maxCadence: modalSummary.cadence.max ?? undefined,\n        // Calculate energy\n        // modalSummary doesn't have energy?\n        // simple calculation: avgPower * duration (seconds) / 1000 = kJ\n        // But better: sum of (watts * delta_time)\n        // For now use avg:\n        // (avgWatts * seconds) / 1000 = kJ\n        // Wait, modalSummary doesn't seem to calculate energy in recent snippet.\n    };\n\n    if (summary.avgPower) {\n        // Estimate energy (kJ)\n        // Power is Watts (J/s). kJ = Watts * seconds / 1000\n        // Approximate using average power\n        // For better accuracy we should integrate, but this matches basic summary often\n        // Check if there is a 'totalEnergy' field in WorkoutSummary (types/measurements.ts doesn't show it but workoutHistory used it)\n        // types/measurements.ts doesn't show totalEnergy.\n        // ui/workoutHistory.ts used summary.totalEnergy.\n        // Let's check ui/workoutHistory.ts getSummary again.\n        // It said \"interface WorkoutSummary { ... totalEnergy?: number ... }\" inside workoutHistory.ts\n        // So the local interface has it.\n        // types/measurements.ts defines WorkoutSummary, does it have totalEnergy?\n        // I read lines 100-127 of types/measurements.ts and it DID NOT have totalEnergy.\n        // But ui/workoutHistory.ts uses it.\n        // So there's a disconnect.\n        // Calculate totalEnergy\n        summary.totalEnergy = Math.round((summary.avgPower * duration) / 1000);\n    }\n\n    // Add distance\n    if (croppedMeasurements.distance.length > 0) {\n        const first = croppedMeasurements.distance[0].value;\n        const last = croppedMeasurements.distance[croppedMeasurements.distance.length - 1].value;\n        summary.totalDistance = Math.max(0, last - first);\n    }\n\n    return {\n        startTime: start,\n        endTime: end,\n        duration,\n        measurements: croppedMeasurements,\n        summary\n    };\n}\n","/**\n * Workout History UI\n * \n * Displays saved workouts and allows viewing details.\n * \n * @module workoutHistory\n */\n\nimport {\n  isDatabaseAvailable,\n  listWorkouts,\n  getWorkout,\n  deleteWorkout,\n  createWorkout,\n  completeWorkout,\n  formatDuration,\n  formatDate,\n  type Workout,\n  type ListWorkoutsResponse,\n  type ListWorkoutsOptions,\n} from '../api/workoutClient.js';\nimport {\n  getCompletedWorkouts,\n  markWorkoutSynced,\n  isIndexedDBSupported,\n  type StoredWorkout\n} from '../storage/workoutStorage.js';\nimport { getFtpHistory, type FtpHistoryEntry } from '../api/userClient.js';\nimport { calculateWorkoutSummary } from './modal.js';\nimport { announce } from './accessibility.js';\nimport { renderLineChart } from './charts.js';\nimport { renderPeriodStatistics } from './statistics.js';\nimport { cropWorkout } from '../utils/cropWorkout.js';\nimport type { MeasurementsData } from '../types/measurements.js';\n\n/** Current pagination page */\nlet currentPage = 1;\n/** Total number of pages */\nlet totalPages = 1;\n/** Database availability flag */\nlet dbAvailable = false;\n\n/* Filter State */\nlet filterType = '';\nlet filterStartDate = '';\nlet filterEndDate = '';\n\n/* View State */\nlet currentView: 'list' | 'calendar' | 'analytics' = 'list';\nlet calendarDate = new Date(); // Points to current month\nlet dataSource: 'cloud' | 'local' = 'cloud';\n\n/**\n * Workout summary data from API\n */\ninterface WorkoutSummary {\n  avgPower?: number;\n  maxPower?: number;\n  normalizedPower?: number;\n  avgCadence?: number;\n  maxCadence?: number;\n  avgHeartrate?: number;\n  maxHeartrate?: number;\n  totalEnergy?: number;\n  totalDistance?: number;\n  sampleCount?: number;\n  powerCurve?: { duration: number; watts: number }[];\n  trainingLoad?: number;\n  intensityFactor?: number;\n}\n\n/**\n * Helper to safely parse summary\n */\nfunction getSummary(workout: Workout): WorkoutSummary {\n  if (!workout.summary) return {};\n  if (typeof workout.summary === 'string') {\n    try {\n      return JSON.parse(workout.summary);\n    } catch {\n      return {};\n    }\n  }\n  return workout.summary as unknown as WorkoutSummary;\n}\n\n/**\n * Initialize the workout history feature logic\n * NOTE: This should be called after the History View is mounted to DOM.\n */\nexport function initHistoryLogic(): void {\n  const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n  const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n  const refreshBtn = document.getElementById('historyRefresh');\n\n  // Filters & Views\n  const typeFilter = document.getElementById('workoutTypeFilter') as HTMLSelectElement | null;\n  const dateStart = document.getElementById('workoutDateStart') as HTMLInputElement | null;\n  const dateEnd = document.getElementById('workoutDateEnd') as HTMLInputElement | null;\n  const viewListBtn = document.getElementById('viewListBtn');\n  const viewCalendarBtn = document.getElementById('viewCalendarBtn');\n  const viewAnalyticsBtn = document.getElementById('viewAnalyticsBtn');\n\n  const listView = document.getElementById('workoutListView');\n  const calendarView = document.getElementById('workoutCalendarView');\n  const analyticsView = document.getElementById('workoutAnalyticsView');\n\n  // Calendar Controls\n  const prevMonthBtn = document.getElementById('calendarPrevMonth');\n  const nextMonthBtn = document.getElementById('calendarNextMonth');\n\n  // Source Toggle\n  const sourceCloudBtn = document.getElementById('sourceCloudBtn');\n  const sourceLocalBtn = document.getElementById('sourceLocalBtn');\n\n  if (sourceCloudBtn && sourceLocalBtn) {\n    sourceCloudBtn.addEventListener('click', () => setSource('cloud'));\n    sourceLocalBtn.addEventListener('click', () => setSource('local'));\n  }\n\n  // Check if database is available on load\n  checkDatabaseAvailability();\n\n  // Toggle Views\n  const setView = (view: 'list' | 'calendar' | 'analytics') => {\n    currentView = view;\n\n    // Buttons\n    if (viewListBtn) {\n      viewListBtn.classList.toggle('active', view === 'list');\n      viewListBtn.setAttribute('aria-pressed', (view === 'list').toString());\n      viewListBtn.style.background = view === 'list' ? 'var(--color-bg-active)' : 'transparent';\n    }\n    if (viewCalendarBtn) {\n      viewCalendarBtn.classList.toggle('active', view === 'calendar');\n      viewCalendarBtn.setAttribute('aria-pressed', (view === 'calendar').toString());\n      viewCalendarBtn.style.background = view === 'calendar' ? 'var(--color-bg-active)' : 'transparent';\n    }\n    if (viewAnalyticsBtn) {\n      viewAnalyticsBtn.classList.toggle('active', view === 'analytics');\n      viewAnalyticsBtn.setAttribute('aria-pressed', (view === 'analytics').toString());\n      viewAnalyticsBtn.style.background = view === 'analytics' ? 'var(--color-bg-active)' : 'transparent';\n    }\n\n    // Panels\n    if (listView) listView.style.display = view === 'list' ? 'block' : 'none';\n    if (calendarView) calendarView.style.display = view === 'calendar' ? 'block' : 'none';\n    if (analyticsView) analyticsView.style.display = view === 'analytics' ? 'block' : 'none';\n\n    // Filters visibility (hide generic filters for analytics maybe? Keeping for now)\n  };\n\n  viewListBtn?.addEventListener('click', () => {\n    setView('list');\n    loadWorkouts();\n  });\n\n  viewCalendarBtn?.addEventListener('click', () => {\n    setView('calendar');\n    loadCalendar();\n  });\n\n  viewAnalyticsBtn?.addEventListener('click', () => {\n    setView('analytics');\n    loadAnalytics();\n  });\n\n  // Filter Change Listeners\n  const handleFilterChange = () => {\n    if (typeFilter) filterType = typeFilter.value;\n    if (dateStart) filterStartDate = dateStart.value;\n    if (dateEnd) filterEndDate = dateEnd.value;\n\n    currentPage = 1;\n\n    if (currentView === 'list') {\n      loadWorkouts();\n    } else if (currentView === 'calendar') {\n      loadCalendar();\n    } else if (currentView === 'analytics') {\n      loadAnalytics();\n    }\n  };\n\n  typeFilter?.addEventListener('change', handleFilterChange);\n  dateStart?.addEventListener('change', handleFilterChange);\n  dateEnd?.addEventListener('change', handleFilterChange);\n\n  // Calendar Navigation\n  prevMonthBtn?.addEventListener('click', () => {\n    calendarDate.setMonth(calendarDate.getMonth() - 1);\n    loadCalendar();\n  });\n\n  nextMonthBtn?.addEventListener('click', () => {\n    calendarDate.setMonth(calendarDate.getMonth() + 1);\n    loadCalendar();\n  });\n\n  // Pagination\n  prevBtn?.addEventListener('click', async () => {\n    if (currentPage > 1) {\n      currentPage--;\n      await loadWorkouts();\n    }\n  });\n\n  nextBtn?.addEventListener('click', async () => {\n    if (currentPage < totalPages) {\n      currentPage++;\n      await loadWorkouts();\n    }\n  });\n\n  // Refresh\n  refreshBtn?.addEventListener('click', async () => {\n    await loadWorkouts();\n  });\n}\n\n/**\n * Check if database features are available\n */\nasync function checkDatabaseAvailability(): Promise<void> {\n  const historyButton = document.getElementById('workoutHistoryButton') as HTMLButtonElement | null;\n  const hasIndexedDB = isIndexedDBSupported();\n\n  try {\n    dbAvailable = await isDatabaseAvailable();\n  } catch {\n    dbAvailable = false;\n  }\n\n  // Default to local if cloud is unavailable\n  if (!dbAvailable && hasIndexedDB) {\n    dataSource = 'local';\n    updateSourceToggle();\n  }\n\n  if (historyButton) {\n    historyButton.disabled = !(dbAvailable || hasIndexedDB);\n    historyButton.title = (dbAvailable || hasIndexedDB)\n      ? 'View workout history'\n      : 'History not available';\n  }\n}\n\n/**\n * Convert locally stored workout to Workout interface\n */\nfunction storedToWorkout(stored: StoredWorkout): Workout & { _synced?: boolean } {\n  const summary = calculateWorkoutSummary(\n    stored.startTime,\n    stored.lastUpdated,\n    stored.measurements\n  );\n\n  return {\n    id: stored.id,\n    title: 'Local Workout',\n    sport: 'cycling',\n    startTime: new Date(stored.startTime).toISOString(),\n    endTime: new Date(stored.lastUpdated).toISOString(),\n    duration: Math.round((stored.lastUpdated - stored.startTime) / 1000),\n    status: 'COMPLETED', // API status enum\n    summary: JSON.stringify(summary),\n    createdAt: new Date(stored.startTime).toISOString(),\n    updatedAt: new Date(stored.lastUpdated).toISOString(),\n    _synced: stored.synced\n  };\n}\n\n/**\n * Load and display workouts\n */\nasync function loadWorkouts(): Promise<void> {\n  const listContainer = document.getElementById('workoutList');\n  const pageInfo = document.getElementById('historyPageInfo');\n  const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n  const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n\n  if (!listContainer) return;\n\n  // Show loading state\n  listContainer.innerHTML = '<div class=\"workout-loading\">Loading workouts...</div>';\n\n  try {\n    let workouts: (Workout & { _synced?: boolean })[] = [];\n\n    if (dataSource === 'local') {\n      const stored = await getCompletedWorkouts();\n      // TODO: Apply filters locally if needed\n      stored.sort((a, b) => b.startTime - a.startTime);\n\n      const total = stored.length;\n      totalPages = Math.ceil(total / 10) || 1;\n      const start = (currentPage - 1) * 10;\n      const pageItems = stored.slice(start, start + 10);\n\n      workouts = pageItems.map(storedToWorkout);\n\n      if (pageInfo) {\n        pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${total} local)`;\n      }\n    } else {\n      const options: ListWorkoutsOptions = {\n        page: currentPage,\n        limit: 10\n      };\n\n      if (filterType) options.sport = filterType;\n      if (filterStartDate) options.startDate = new Date(filterStartDate);\n      if (filterEndDate) options.endDate = new Date(filterEndDate);\n\n      const result: ListWorkoutsResponse = await listWorkouts(options);\n      workouts = result.workouts;\n      const { pagination } = result;\n\n      totalPages = pagination.totalPages;\n\n      // Update pagination info\n      if (pageInfo) {\n        pageInfo.textContent = `Page ${pagination.page} of ${pagination.totalPages} (${pagination.total} total)`;\n      }\n    }\n\n    // Update pagination buttons\n    if (prevBtn) prevBtn.disabled = currentPage <= 1;\n    if (nextBtn) nextBtn.disabled = currentPage >= totalPages;\n\n    // Render workouts\n    if (workouts.length === 0) {\n      listContainer.innerHTML = `\n        <div class=\"workout-empty\">\n          <p>No workouts found</p>\n          <p class=\"workout-empty-hint\">Start a workout to see it here!</p>\n        </div>\n      `;\n      return;\n    }\n\n    listContainer.innerHTML = workouts.map((workout) => renderWorkoutCard(workout)).join('');\n\n    // Add event listeners for workout cards\n    listContainer.querySelectorAll('.workout-card').forEach((card) => {\n      const workoutId = (card as HTMLElement).dataset.workoutId;\n      if (!workoutId) return;\n\n      // View details\n      card.querySelector('.workout-view-btn')?.addEventListener('click', (e: Event) => {\n        e.stopPropagation();\n        viewWorkoutDetails(workoutId);\n      });\n\n      // Delete\n      card.querySelector('.workout-delete-btn')?.addEventListener('click', (e: Event) => {\n        e.stopPropagation();\n        confirmDeleteWorkout(workoutId);\n      });\n\n      // Sync\n      card.querySelector('.workout-sync-btn')?.addEventListener('click', (e: Event) => {\n        e.stopPropagation();\n        syncWorkout(workoutId);\n      });\n    });\n  } catch (error) {\n    console.error('Failed to load workouts:', error);\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    listContainer.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workouts</p>\n        <p class=\"workout-error-detail\">${message}</p>\n      </div>\n    `;\n  }\n}\n\n/**\n * Switch data source and reload\n */\nfunction setSource(s: 'cloud' | 'local'): void {\n  if (dataSource === s) return;\n  dataSource = s;\n  updateSourceToggle();\n  currentPage = 1;\n  loadWorkouts();\n}\n\n/**\n * Update toggle UI\n */\nfunction updateSourceToggle(): void {\n  const cloudBtn = document.getElementById('sourceCloudBtn');\n  const localBtn = document.getElementById('sourceLocalBtn');\n\n  if (cloudBtn && localBtn) {\n    if (dataSource === 'cloud') {\n      cloudBtn.classList.add('active');\n      cloudBtn.setAttribute('aria-pressed', 'true');\n      cloudBtn.style.background = 'var(--color-bg-active)';\n\n      localBtn.classList.remove('active');\n      localBtn.setAttribute('aria-pressed', 'false');\n      localBtn.style.background = 'transparent';\n    } else {\n      localBtn.classList.add('active');\n      localBtn.setAttribute('aria-pressed', 'true');\n      localBtn.style.background = 'var(--color-bg-active)';\n\n      cloudBtn.classList.remove('active');\n      cloudBtn.setAttribute('aria-pressed', 'false');\n      cloudBtn.style.background = 'transparent';\n    }\n  }\n}\n\n/**\n * Sync a local workout to server\n */\nasync function syncWorkout(localId: string): Promise<void> {\n  const workouts = await getCompletedWorkouts();\n  const local = workouts.find(w => w.id === localId);\n  if (!local) return;\n\n  try {\n    announce('Syncing workout...', 'polite');\n\n    // 1. Create Workout on server\n    const createRes = await createWorkout({\n      streamName: `sync-${localId}`,\n      title: `Synced: ${formatDate(new Date(local.startTime))}`,\n      sport: 'cycling'\n    });\n\n    if (createRes.success && createRes.workout) {\n      // 2. Mark as complete (updates status to COMPLETED)\n      const completeRes = await completeWorkout(createRes.workout.id, false);\n\n      if (completeRes.success) {\n        await markWorkoutSynced(localId);\n        announce('Workout synced successfully', 'assertive');\n        await loadWorkouts();\n      } else {\n        throw new Error('Failed to complete workout on server');\n      }\n    }\n  } catch (e) {\n    console.error('Sync failed', e);\n    announce('Sync failed', 'assertive');\n  }\n}\n\n/**\n * Render a workout card\n */\nfunction renderWorkoutCard(workout: Workout & { _synced?: boolean }): string {\n  const statusClass = workout.status.toLowerCase();\n  const summary = getSummary(workout);\n\n  const isUnsynced = workout._synced === false;\n  const syncBtn = isUnsynced\n    ? `<button class=\"workout-sync-btn\" title=\"Upload to server\"> Sync</button>`\n    : (workout._synced === true ? `<span title=\"Synced\" style=\"margin-right:8px;\"></span>` : '');\n\n  return `\n    <div class=\"workout-card\" data-workout-id=\"${workout.id}\">\n      <div class=\"workout-card-header\">\n        <span class=\"workout-title\">${workout.title || 'Untitled Workout'}</span>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n      <div class=\"workout-card-body\">\n        <div class=\"workout-date\">\n           ${formatDate(workout.startTime)}\n        </div>\n        <div class=\"workout-stats\">\n          ${workout.duration ? `<span class=\"workout-stat\"> ${formatDuration(workout.duration)}</span>` : ''}\n          ${summary.avgPower ? `<span class=\"workout-stat\"> ${summary.avgPower}W avg</span>` : ''}\n          ${summary.maxPower ? `<span class=\"workout-stat\"> ${summary.maxPower}W max</span>` : ''}\n          ${summary.avgHeartrate ? `<span class=\"workout-stat\"> ${summary.avgHeartrate} bpm</span>` : ''}\n          ${summary.totalEnergy ? `<span class=\"workout-stat\"> ${summary.totalEnergy} kJ</span>` : ''}\n        </div>\n      </div>\n      <div class=\"workout-card-actions\">\n        ${syncBtn}\n        <button class=\"workout-view-btn\" title=\"View details\"> View</button>\n        <button class=\"workout-delete-btn\" title=\"Delete workout\"></button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * View workout details in a detail panel\n */\nasync function viewWorkoutDetails(workoutId: string): Promise<void> {\n  const detailPanel = document.getElementById('workoutDetailPanel');\n  const listPanel = document.getElementById('workoutListPanel');\n\n  if (!detailPanel || !listPanel) return;\n\n  // Show detail panel\n  listPanel.style.display = 'none';\n  detailPanel.style.display = 'block';\n  detailPanel.innerHTML = '<div class=\"workout-loading\">Loading workout details...</div>';\n\n  try {\n    const workout = await getWorkout(workoutId, true);\n    detailPanel.innerHTML = renderWorkoutDetail(workout);\n\n    // Render Charts if telemetry exists\n    if (workout.telemetry) {\n      // Allow DOM to update first\n      requestAnimationFrame(() => {\n        renderWorkoutCharts(workout.telemetry!, workout.startTime);\n      });\n    }\n\n    // Back button\n    detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n      detailPanel.style.display = 'none';\n      listPanel.style.display = 'block';\n    });\n\n    // Export button\n    detailPanel.querySelector('.workout-export-btn')?.addEventListener('click', () => {\n      exportWorkoutData(workout);\n    });\n\n    // Crop button\n    detailPanel.querySelector('.workout-crop-btn')?.addEventListener('click', () => {\n      startCropTool(workout);\n    });\n  } catch (error) {\n    console.error('Failed to load workout details:', error);\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    detailPanel.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workout</p>\n        <p class=\"workout-error-detail\">${message}</p>\n        <button class=\"workout-back-btn\"> Back to list</button>\n      </div>\n    `;\n    detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n      detailPanel.style.display = 'none';\n      listPanel.style.display = 'block';\n    });\n  }\n}\n\n/**\n * Render workout detail view\n */\nfunction renderWorkoutDetail(workout: Workout): string {\n  const summary = getSummary(workout);\n  const statusClass = workout.status.toLowerCase();\n\n  return `\n    <div class=\"workout-detail\">\n      <div class=\"workout-detail-header\">\n        <button class=\"workout-back-btn\"> Back</button>\n        <h3>${workout.title || 'Untitled Workout'}</h3>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n\n      <div class=\"workout-detail-meta\">\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Sport</span>\n          <span class=\"meta-value\">${workout.sport || 'cycling'}</span>\n        </div>\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Start Time</span>\n          <span class=\"meta-value\">${formatDate(workout.startTime)}</span>\n        </div>\n        ${workout.endTime ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">End Time</span>\n            <span class=\"meta-value\">${formatDate(workout.endTime)}</span>\n          </div>\n        ` : ''}\n        ${workout.duration ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">Duration</span>\n            <span class=\"meta-value\">${formatDuration(workout.duration)}</span>\n          </div>\n        ` : ''}\n      </div>\n\n      ${Object.keys(summary).length > 0 ? `\n        <div class=\"workout-detail-summary\">\n          <h4>Summary</h4>\n          <div class=\"summary-grid\">\n            ${summary.avgPower ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Power</span>\n                <span class=\"summary-value\">${summary.avgPower} W</span>\n              </div>\n            ` : ''}\n            ${summary.maxPower ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Max Power</span>\n                <span class=\"summary-value\">${summary.maxPower} W</span>\n              </div>\n            ` : ''}\n            ${summary.avgCadence ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Cadence</span>\n                <span class=\"summary-value\">${summary.avgCadence} rpm</span>\n              </div>\n            ` : ''}\n            ${summary.avgHeartrate ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Heart Rate</span>\n                <span class=\"summary-value\">${summary.avgHeartrate} bpm</span>\n              </div>\n            ` : ''}\n            ${summary.totalEnergy ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Total Energy</span>\n                <span class=\"summary-value\">${summary.totalEnergy} kJ</span>\n              </div>\n            ` : ''}\n          </div>\n        </div>\n      ` : ''}\n\n      ${workout.telemetry ? `\n        <div class=\"workout-detail-charts\">\n            <h4>Charts</h4>\n            <div id=\"wd-chart-power\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-hr\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-cadence\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-altitude\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n        </div>\n      ` : ''}\n\n      ${workout.description ? `\n        <div class=\"workout-detail-description\">\n          <h4>Notes</h4>\n          <p>${workout.description}</p>\n        </div>\n      ` : ''}\n\n      <div class=\"workout-detail-actions\">\n        ${workout.telemetry ? `\n          <button class=\"workout-action-btn workout-crop-btn\"> Crop</button>\n          <button class=\"workout-export-btn\"> Export Data</button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Export workout data to files\n */\nfunction exportWorkoutData(workout: Workout): void {\n  const timestamp = new Date(workout.startTime).toISOString().replace(/[:.]/g, '-').slice(0, 19);\n  const filename = `workout-${timestamp}`;\n\n  const jsonData = {\n    id: workout.id,\n    title: workout.title,\n    sport: workout.sport,\n    startTime: workout.startTime,\n    endTime: workout.endTime,\n    duration: workout.duration,\n    summary: workout.summary,\n    telemetry: workout.telemetry,\n  };\n\n  const jsonBlob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });\n  const jsonUrl = URL.createObjectURL(jsonBlob);\n  const jsonLink = document.createElement('a');\n  jsonLink.href = jsonUrl;\n  jsonLink.download = `${filename}.json`;\n  jsonLink.click();\n  URL.revokeObjectURL(jsonUrl);\n}\n\n/**\n * Confirm and delete a workout\n */\nasync function confirmDeleteWorkout(workoutId: string): Promise<void> {\n  if (!confirm('Are you sure you want to delete this workout? This cannot be undone.')) {\n    return;\n  }\n\n  try {\n    await deleteWorkout(workoutId);\n    await loadWorkouts();\n  } catch (error) {\n    console.error('Failed to delete workout:', error);\n    const message = error instanceof Error ? error.message : 'Unknown error';\n    alert(`Failed to delete workout: ${message}`);\n  }\n}\n\n/**\n * Check database availability (exported for other modules)\n */\nexport function getDatabaseAvailable(): boolean {\n  return dbAvailable;\n}\n\n/**\n * Load and display calendar view\n */\nasync function loadCalendar(): Promise<void> {\n  const calendarGrid = document.getElementById('workoutCalendarGrid');\n  const monthLabel = document.getElementById('calendarMonthLabel');\n\n  if (!calendarGrid || !monthLabel) return;\n\n  // Set month label\n  const monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n    \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"];\n  monthLabel.textContent = `${monthNames[calendarDate.getMonth()]} ${calendarDate.getFullYear()}`;\n\n  // Show loading\n  calendarGrid.innerHTML = '<div style=\"grid-column: 1 / -1; text-align: center; padding: 20px;\">Loading calendar...</div>';\n\n  // Calculate start and end of month\n  const year = calendarDate.getFullYear();\n  const month = calendarDate.getMonth();\n  const startDate = new Date(year, month, 1);\n  const endDate = new Date(year, month + 1, 0, 23, 59, 59, 999);\n\n  try {\n    const options: ListWorkoutsOptions = {\n      startDate,\n      endDate,\n      limit: 1000 // Get all workouts for the month\n    };\n    if (filterType) options.sport = filterType;\n\n    const result = await listWorkouts(options);\n    const workouts = result.workouts;\n\n    renderCalendar(workouts);\n    renderMonthlyStats(workouts);\n  } catch (error) {\n    console.error('Failed to load calendar:', error);\n    calendarGrid.innerHTML = '<div style=\"grid-column: 1 / -1; text-align: center; color: var(--color-error);\">Failed to load calendar data</div>';\n  }\n}\n\n/**\n * Render the calendar grid\n */\nfunction renderCalendar(workouts: Workout[]): void {\n  const calendarGrid = document.getElementById('workoutCalendarGrid');\n  if (!calendarGrid) return;\n\n  calendarGrid.innerHTML = '';\n\n  // Add day headers\n  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  days.forEach(day => {\n    const d = document.createElement('div');\n    d.textContent = day;\n    d.style.textAlign = 'center';\n    d.style.fontWeight = 'bold';\n    d.style.padding = '4px';\n    d.style.fontSize = '0.9em';\n    d.style.color = 'var(--color-text-secondary)';\n    calendarGrid.appendChild(d);\n  });\n\n  const year = calendarDate.getFullYear();\n  const month = calendarDate.getMonth();\n\n  // First day of the month\n  const firstDay = new Date(year, month, 1).getDay();\n  // Days in month\n  const daysInMonth = new Date(year, month + 1, 0).getDate();\n\n  // Empty cells for days before first of month\n  for (let i = 0; i < firstDay; i++) {\n    const empty = document.createElement('div');\n    calendarGrid.appendChild(empty);\n  }\n\n  // Days\n  for (let day = 1; day <= daysInMonth; day++) {\n    const dayCell = document.createElement('div');\n    dayCell.style.border = '1px solid var(--color-border)';\n    dayCell.style.borderRadius = '4px';\n    dayCell.style.minHeight = '60px';\n    dayCell.style.padding = '4px';\n    dayCell.style.background = 'var(--card-bg)';\n    dayCell.style.position = 'relative';\n\n    const dayNum = document.createElement('div');\n    dayNum.textContent = day.toString();\n    dayNum.style.fontSize = '0.8em';\n    dayNum.style.marginBottom = '4px';\n    dayCell.appendChild(dayNum);\n\n    // Find workouts for this day\n    const dayWorkouts = workouts.filter(w => {\n      const wDate = new Date(w.startTime);\n      return wDate.getDate() === day && wDate.getMonth() === month && wDate.getFullYear() === year;\n    });\n\n    dayWorkouts.forEach(w => {\n      const dot = document.createElement('div');\n      dot.title = `${w.title || 'Workout'} (${formatDuration(w.duration || 0)})`;\n      dot.style.fontSize = '0.7em';\n      dot.style.whiteSpace = 'nowrap';\n      dot.style.overflow = 'hidden';\n      dot.style.textOverflow = 'ellipsis';\n      dot.style.cursor = 'pointer';\n      dot.style.padding = '2px';\n      dot.style.marginTop = '2px';\n      dot.style.borderRadius = '2px';\n      dot.style.background = 'var(--color-bg-active)';\n      dot.style.color = 'var(--color-text-primary)';\n\n      // Icon based on sport\n      const icon = w.sport === 'running' ? '' : '';\n      dot.textContent = `${icon} ${formatDuration(w.duration || 0)}`;\n\n      dot.addEventListener('click', (e) => {\n        e.stopPropagation();\n        viewWorkoutDetails(w.id);\n      });\n\n      dayCell.appendChild(dot);\n    });\n\n    // Highlight today\n    const today = new Date();\n    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {\n      dayCell.style.borderColor = 'var(--color-accent)';\n      dayNum.style.fontWeight = 'bold';\n      dayNum.style.color = 'var(--color-accent)';\n    }\n\n    calendarGrid.appendChild(dayCell);\n  }\n}\n\n/**\n * Render monthly statistics\n */\nfunction renderMonthlyStats(workouts: Workout[]): void {\n  const statsContainer = document.getElementById('monthlyStats');\n  if (!statsContainer) return;\n\n  const totalWorkouts = workouts.length;\n  const totalDuration = workouts.reduce((acc, w) => acc + (w.duration || 0), 0);\n  const totalDistance = workouts.reduce((acc, w) => {\n    const summary = getSummary(w);\n    return acc + (summary.totalDistance || 0);\n  }, 0);\n  const totalEnergy = workouts.reduce((acc, w) => {\n    const summary = getSummary(w);\n    return acc + (summary.totalEnergy || 0);\n  }, 0);\n\n  statsContainer.innerHTML = `\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Workouts</div>\n            <div style=\"font-weight: bold;\">${totalWorkouts}</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Duration</div>\n            <div style=\"font-weight: bold;\">${formatDuration(totalDuration)}</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Distance</div>\n            <div style=\"font-weight: bold;\">${(totalDistance / 1000).toFixed(1)} km</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Energy</div>\n            <div style=\"font-weight: bold;\">${totalEnergy.toFixed(0)} kJ</div>\n        </div>\n    `;\n}\n\n/**\n * Load and display analytics\n */\nasync function loadAnalytics(): Promise<void> {\n  const analyticsView = document.getElementById('workoutAnalyticsView');\n  if (!analyticsView) return;\n\n  // Show loading\n  const prList = document.getElementById('prList');\n  if (prList) prList.innerHTML = '<div style=\"padding: 12px; text-align: center;\">Loading records...</div>';\n\n  try {\n    // Fetch all history (might be heavy, better to have a dedicated endpoint in future)\n    // For now, fetch with large limit but minimal fields? \n    // Unfortunately getWorkoutHistory fetches all summary fields.\n    // We can respect filters though.\n\n    const options: ListWorkoutsOptions = {\n      limit: 1000, // Reasonable cap\n    };\n    if (filterType) options.sport = filterType;\n    if (filterStartDate) options.startDate = new Date(filterStartDate);\n    if (filterEndDate) options.endDate = new Date(filterEndDate);\n\n    const result = await listWorkouts(options);\n    const workouts = result.workouts;\n\n    // Fetch FTP History if we have a user ID\n    let ftpHistory: FtpHistoryEntry[] = [];\n    if (workouts.length > 0 && workouts[0].userId) {\n      try {\n        ftpHistory = await getFtpHistory(workouts[0].userId);\n      } catch (e) {\n        console.warn('Failed to load FTP history', e);\n      }\n    }\n\n    renderAnalytics(workouts, ftpHistory);\n  } catch (error) {\n    console.error('Failed to load analytics:', error);\n    if (prList) prList.innerHTML = '<div style=\"color: var(--color-error); text-align: center;\">Failed to load data</div>';\n  }\n}\n\n/**\n * Render all analytics charts and stats\n */\nfunction renderAnalytics(workouts: Workout[], ftpHistory: FtpHistoryEntry[] = []): void {\n  renderPeriodStatistics('workoutAnalyticsView', workouts);\n  renderPersonalRecords(workouts);\n  renderTrainingLoad(workouts);\n  renderPowerCurve(workouts);\n  renderFitnessTrend(workouts);\n  renderFtpHistory(ftpHistory);\n  renderPrHistory(workouts);\n}\n\n/**\n * Render Personal Records\n */\nfunction renderPersonalRecords(workouts: Workout[]): void {\n  const container = document.getElementById('prList');\n  if (!container) return;\n\n  let maxPower = { val: 0, date: '', id: '' };\n  let maxHr = { val: 0, date: '', id: '' };\n  let longestRide = { val: 0, date: '', id: '' }; // Duration\n  let maxDistance = { val: 0, date: '', id: '' };\n\n  workouts.forEach(w => {\n    const summary = getSummary(w);\n    const dateStr = formatDate(w.startTime);\n\n    if (summary.maxPower && summary.maxPower > maxPower.val) {\n      maxPower = { val: summary.maxPower, date: dateStr, id: w.id };\n    }\n    if (summary.maxHeartrate && summary.maxHeartrate > maxHr.val) {\n      maxHr = { val: summary.maxHeartrate, date: dateStr, id: w.id };\n    }\n    if (w.duration && w.duration > longestRide.val) {\n      longestRide = { val: w.duration, date: dateStr, id: w.id };\n    }\n    if (summary.totalDistance && summary.totalDistance > maxDistance.val) {\n      maxDistance = { val: summary.totalDistance, date: dateStr, id: w.id };\n    }\n  });\n\n  const createRow = (label: string, value: string, date: string, id: string) => `\n        <div class=\"pr-row\" data-id=\"${id}\" style=\"display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--color-border); cursor: pointer;\">\n            <div style=\"font-weight: 500;\">${label}</div>\n            <div style=\"text-align: right;\">\n                <div style=\"font-weight: bold; color: var(--color-accent);\">${value}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">${date}</div>\n            </div>\n        </div>\n    `;\n\n  container.innerHTML = `\n        ${maxPower.val > 0 ? createRow('Max Power (1s)', `${maxPower.val} W`, maxPower.date, maxPower.id) : ''}\n        ${maxHr.val > 0 ? createRow('Max Heart Rate', `${maxHr.val} bpm`, maxHr.date, maxHr.id) : ''}\n        ${longestRide.val > 0 ? createRow('Longest Duration', formatDuration(longestRide.val), longestRide.date, longestRide.id) : ''}\n        ${maxDistance.val > 0 ? createRow('Longest Distance', `${(maxDistance.val / 1000).toFixed(1)} km`, maxDistance.date, maxDistance.id) : ''}\n    `;\n\n  // Re-attach click listeners\n  container.querySelectorAll('.pr-row').forEach(row => {\n    row.addEventListener('click', () => {\n      const id = (row as HTMLElement).dataset.id;\n      if (id) viewWorkoutDetails(id);\n    });\n  });\n}\n\n/**\n * Render Training Load (Weekly TSS)\n */\nfunction renderTrainingLoad(workouts: Workout[]): void {\n  const container = document.getElementById('trainingLoadChart');\n  if (!container) return;\n\n  // Group by week\n  const weeks: Record<string, number> = {};\n  // Generate last 4 weeks keys\n  for (let i = 3; i >= 0; i--) {\n    const d = new Date();\n    d.setDate(d.getDate() - (i * 7));\n    const weekNum = getWeekNumber(d);\n    weeks[`${d.getFullYear()}-W${weekNum}`] = 0;\n  }\n\n  workouts.forEach(w => {\n    const summary = getSummary(w);\n    if (summary.trainingLoad) {\n      const date = new Date(w.startTime);\n      const key = `${date.getFullYear()}-W${getWeekNumber(date)}`;\n      if (weeks[key] !== undefined) {\n        weeks[key] += summary.trainingLoad;\n      }\n    }\n  });\n\n  const maxLoad = Math.max(...Object.values(weeks), 100); // Scale max\n\n  container.innerHTML = Object.entries(weeks).map(([week, load]) => {\n    const height = (load / maxLoad) * 100;\n    return `\n            <div style=\"display: flex; flex-direction: column; align-items: center; width: 20%;\">\n                <div style=\"font-size: 0.8em; font-weight: bold; margin-bottom: 4px;\">${Math.round(load)}</div>\n                <div style=\"width: 100%; height: 100px; display: flex; align-items: flex-end; justify-content: center;\">\n                    <div style=\"width: 80%; background: var(--color-accent); height: ${height}%; border-radius: 4px 4px 0 0; min-height: 4px;\"></div>\n                </div>\n                <div style=\"font-size: 0.7em; color: var(--color-text-secondary); margin-top: 4px;\">${week.split('-')[1]}</div>\n            </div>\n        `;\n  }).join('');\n}\n\nfunction getWeekNumber(d: Date): number {\n  d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));\n  d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / 86400000) + 1) / 7);\n}\n\n/**\n * Render Power Curve (SVG Chart)\n */\nfunction renderPowerCurve(workouts: Workout[]): void {\n  const container = document.getElementById('powerCurveChart');\n  if (!container) return;\n\n  // Aggregate best power for each duration\n  const bests: Record<number, number> = {};\n  const durations = [1, 5, 10, 30, 60, 300, 1200, 3600];\n\n  workouts.forEach(w => {\n    const summary = getSummary(w);\n    if (summary.powerCurve) {\n      summary.powerCurve.forEach(p => {\n        if (!bests[p.duration] || p.watts > bests[p.duration]) {\n          bests[p.duration] = p.watts;\n        }\n      });\n    }\n    // Fallback for older workouts if we have maxPower (1s)\n    if (summary.maxPower && (!bests[1] || summary.maxPower > bests[1])) {\n      bests[1] = summary.maxPower;\n    }\n  });\n\n  if (Object.keys(bests).length === 0) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">No power data available</div>';\n    return;\n  }\n\n  // Chart Dimensions\n  const width = container.clientWidth || 300;\n  const height = 200;\n  const pad = 30;\n\n  // Scales\n  const maxWatts = Math.max(...Object.values(bests)) * 1.1; // 10% overhead\n\n  const points = durations.map((d, i) => {\n    if (!bests[d]) return null;\n    const x = pad + (i * ((width - pad * 2) / (durations.length - 1)));\n    const y = height - pad - ((bests[d] / maxWatts) * (height - pad * 2));\n    return { x, y, val: bests[d], duration: d };\n  }).filter(p => p !== null);\n\n  if (points.length < 2) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">Insufficient data points</div>';\n    return;\n  }\n\n  const pathD = `M ${points.map(p => `${p!.x},${p!.y}`).join(' L ')}`;\n\n  // SVG Content\n  const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad}\" y1=\"${pad}\" x2=\"${pad}\" y2=\"${height - pad}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad}\" y1=\"${height - pad}\" x2=\"${width - pad}\" y2=\"${height - pad}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- Path -->\n            <path d=\"${pathD}\" fill=\"none\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n            \n            <!-- Points -->\n            ${points.map(p => `\n                <circle cx=\"${p!.x}\" cy=\"${p!.y}\" r=\"4\" fill=\"var(--card-bg)\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n                <text x=\"${p!.x}\" y=\"${p!.y - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-primary)\">${p!.val}W</text>\n                <text x=\"${p!.x}\" y=\"${height - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${formatDurationLabel(p!.duration)}</text>\n            `).join('')}\n        </svg>\n    `;\n\n  container.innerHTML = svg;\n}\n\nfunction formatDurationLabel(sec: number): string {\n  if (sec < 60) return `${sec}s`;\n  if (sec < 3600) return `${sec / 60}m`;\n  return `${sec / 3600}h`;\n}\n\n/**\n * Render Fitness Trend (CTL/ATL)\n */\nfunction renderFitnessTrend(workouts: Workout[]): void {\n  const container = document.getElementById('fitnessTrendChart');\n  if (!container) return;\n\n  // Sort workouts by date ascending\n  const sorted = [...workouts].sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n\n  if (sorted.length < 2) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">Not enough data for trend analysis</div>';\n    return;\n  }\n\n  // Daily TSS Map\n  const tssMap = new Map<string, number>();\n  sorted.forEach(w => {\n    const summary = getSummary(w);\n    if (summary.trainingLoad) {\n      const dateStr = new Date(w.startTime).toISOString().split('T')[0];\n      const current = tssMap.get(dateStr) || 0;\n      tssMap.set(dateStr, current + summary.trainingLoad);\n    }\n  });\n\n  // Calculate CTL/ATL day by day\n  const dataPoints: { date: Date, ctl: number, atl: number, tsb: number }[] = [];\n  const startDate = new Date(sorted[0].startTime);\n  const endDate = new Date(); // Today\n\n  // Constants\n  const kCTL = Math.exp(-1 / 42);\n  const kATL = Math.exp(-1 / 7);\n\n  let ctl = 0;\n  let atl = 0;\n\n  // Iterate day by day\n  for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {\n    const dateStr = d.toISOString().split('T')[0];\n    const tss = tssMap.get(dateStr) || 0;\n\n    ctl = ctl * kCTL + tss * (1 - kCTL);\n    atl = atl * kATL + tss * (1 - kATL);\n\n    dataPoints.push({\n      date: new Date(d),\n      ctl,\n      atl,\n      tsb: ctl - atl\n    });\n  }\n\n  // Chart Dimensions\n  const width = container.clientWidth || 600;\n  const height = 250;\n  const pad = { top: 20, right: 30, bottom: 30, left: 40 };\n  const chartW = width - pad.left - pad.right;\n  const chartH = height - pad.top - pad.bottom;\n\n  // Scales\n  const maxVal = Math.max(...dataPoints.map(p => Math.max(p.ctl, p.atl))) * 1.1;\n\n  const timeSpan = endDate.getTime() - startDate.getTime();\n  if (timeSpan === 0) return;\n\n  const getX = (date: Date) => pad.left + ((date.getTime() - startDate.getTime()) / timeSpan) * chartW;\n  const getY = (val: number) => pad.top + chartH - ((val / maxVal) * chartH);\n\n  // Generate Paths\n  const ctlPath = 'M ' + dataPoints.map(p => `${getX(p.date)},${getY(p.ctl)}`).join(' L ');\n  const atlPath = 'M ' + dataPoints.map(p => `${getX(p.date)},${getY(p.atl)}`).join(' L ');\n\n  // SVG Content\n  const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad.left}\" y1=\"${pad.top}\" x2=\"${pad.left}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad.left}\" y1=\"${height - pad.bottom}\" x2=\"${width - pad.right}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- CTL Line (Fitness) - Blue -->\n            <path d=\"${ctlPath}\" fill=\"none\" stroke=\"#3b82f6\" stroke-width=\"2\" />\n            \n            <!-- ATL Line (Fatigue) - Pink/Purple -->\n            <path d=\"${atlPath}\" fill=\"none\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n            \n            <!-- Legend -->\n            <g transform=\"translate(${pad.left + 10}, ${pad.top})\">\n                <rect x=\"0\" y=\"0\" width=\"10\" height=\"10\" fill=\"#3b82f6\" />\n                <text x=\"15\" y=\"10\" font-size=\"12\" fill=\"var(--color-text-secondary)\">Fitness (CTL)</text>\n                \n                <rect x=\"100\" y=\"0\" width=\"10\" height=\"10\" fill=\"none\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n                <text x=\"115\" y=\"10\" font-size=\"12\" fill=\"var(--color-text-secondary)\">Fatigue (ATL)</text>\n            </g>\n\n            <!-- Latest Stats -->\n             <text x=\"${width - pad.right}\" y=\"${pad.top}\" text-anchor=\"end\" font-size=\"12\" fill=\"var(--color-text-primary)\">\n                CTL: ${Math.round(ctl)} | ATL: ${Math.round(atl)} | TSB: ${Math.round(ctl - atl)}\n            </text>\n        </svg>\n    `;\n\n  container.innerHTML = svg;\n}\n\n/**\n * Render FTP History Chart\n */\nfunction renderFtpHistory(history: FtpHistoryEntry[]): void {\n  const container = document.getElementById('ftpHistoryChart');\n  if (!container) return;\n\n  if (history.length === 0) {\n    container.innerHTML = '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">No FTP history available</div>';\n    return;\n  }\n\n  // Sort by date ascending\n  const sorted = [...history].sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n  // Chart Dimensions\n  const width = container.clientWidth || 600;\n  const height = 200;\n  const pad = { top: 20, right: 30, bottom: 30, left: 40 };\n  const chartW = width - pad.left - pad.right;\n  const chartH = height - pad.top - pad.bottom;\n\n  // Scales\n  const maxFtp = Math.max(...sorted.map(h => h.ftp)) * 1.1;\n  const minFtp = Math.max(0, Math.min(...sorted.map(h => h.ftp)) * 0.9);\n  const ftpRange = maxFtp - minFtp || 100; // avoid div by zero\n\n  const startDate = new Date(sorted[0].createdAt);\n  const endDate = new Date();\n  const timeSpan = endDate.getTime() - startDate.getTime();\n\n  const getX = (dateStr: string | Date) => {\n    const d = new Date(dateStr);\n    return pad.left + ((d.getTime() - startDate.getTime()) / timeSpan) * chartW;\n  };\n  const getY = (val: number) => pad.top + chartH - ((val - minFtp) / ftpRange) * chartH;\n\n  // Generate Path\n  let d = '';\n  if (sorted.length > 0) {\n    d = `M ${getX(sorted[0].createdAt)},${getY(sorted[0].ftp)}`;\n    for (let i = 1; i < sorted.length; i++) {\n      const currX = getX(sorted[i].createdAt);\n      const prevY = getY(sorted[i - 1].ftp);\n      const currY = getY(sorted[i].ftp);\n\n      // Step line: Horizontal then Vertical\n      d += ` L ${currX},${prevY} L ${currX},${currY}`;\n    }\n    // Extend to now\n    d += ` L ${width - pad.right},${getY(sorted[sorted.length - 1].ftp)}`;\n  }\n\n  // SVG Content\n  const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad.left}\" y1=\"${pad.top}\" x2=\"${pad.left}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad.left}\" y1=\"${height - pad.bottom}\" x2=\"${width - pad.right}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- FTP Line -->\n            <path d=\"${d}\" fill=\"none\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n            \n            <!-- Points -->\n            ${sorted.map(h => `\n                <circle cx=\"${getX(h.createdAt)}\" cy=\"${getY(h.ftp)}\" r=\"4\" fill=\"var(--card-bg)\" stroke=\"var(--color-accent)\" stroke-width=\"2\">\n                    <title>${h.ftp} W (${formatDate(h.createdAt)})</title>\n                </circle>\n                <text x=\"${getX(h.createdAt)}\" y=\"${getY(h.ftp) - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-primary)\">${h.ftp}</text>\n            `).join('')}\n\n            <!-- Axis Labels (simplified) -->\n            <text x=\"${pad.left}\" y=\"${height - 10}\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${formatDate(startDate)}</text>\n            <text x=\"${width - pad.right}\" y=\"${height - 10}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">Today</text>\n        </svg>\n    `;\n\n  container.innerHTML = svg;\n}\n\n/**\n * Render PR History (Chronological improvements)\n */\nfunction renderPrHistory(workouts: Workout[]): void {\n  const container = document.getElementById('prHistoryList');\n  if (!container) return;\n\n  // Sort strictly chronological\n  const sorted = [...workouts].sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n\n  interface RecordEvent {\n    date: string;\n    metric: string;\n    value: string;\n    improvement: string;\n    workoutId: string;\n  }\n\n  const events: RecordEvent[] = [];\n\n  // State to track maxes\n  let maxPower = 0;\n  let maxHr = 0;\n  const powerCurveBests: Record<number, number> = {};\n\n  sorted.forEach(w => {\n    const summary = getSummary(w);\n    const dateStr = formatDate(w.startTime);\n\n    // Power (1s)\n    if (summary.maxPower && summary.maxPower > maxPower) {\n      if (maxPower > 0) {\n        const diff = summary.maxPower - maxPower;\n        events.push({\n          date: dateStr,\n          metric: 'Max Power',\n          value: `${summary.maxPower} W`,\n          improvement: `+${diff} W`,\n          workoutId: w.id\n        });\n      } else {\n        events.push({ date: dateStr, metric: 'Max Power', value: `${summary.maxPower} W`, improvement: 'New!', workoutId: w.id });\n      }\n      maxPower = summary.maxPower;\n    }\n\n    // HR\n    if (summary.maxHeartrate && summary.maxHeartrate > maxHr) {\n      if (maxHr > 0) {\n        const diff = summary.maxHeartrate - maxHr;\n        events.push({\n          date: dateStr,\n          metric: 'Max Heart Rate',\n          value: `${summary.maxHeartrate} bpm`,\n          improvement: `+${diff} bpm`,\n          workoutId: w.id\n        });\n      } else {\n        events.push({ date: dateStr, metric: 'Max Heart Rate', value: `${summary.maxHeartrate} bpm`, improvement: 'New!', workoutId: w.id });\n      }\n      maxHr = summary.maxHeartrate;\n    }\n\n    // Power Curve - Notable durations (1m, 5m, 20m)\n    if (summary.powerCurve) {\n      const notable = [60, 300, 1200];\n      const labels: Record<number, string> = { 60: '1m Power', 300: '5m Power', 1200: '20m Power' };\n      summary.powerCurve.forEach((p: { duration: number, watts: number }) => {\n        if (notable.includes(p.duration)) {\n          const current = powerCurveBests[p.duration] || 0;\n          if (p.watts > current) {\n            if (current > 0) {\n              events.push({\n                date: dateStr,\n                metric: labels[p.duration],\n                value: `${p.watts} W`,\n                improvement: `+${p.watts - current} W`,\n                workoutId: w.id\n              });\n            } else {\n              events.push({ date: dateStr, metric: labels[p.duration], value: `${p.watts} W`, improvement: 'New!', workoutId: w.id });\n            }\n            powerCurveBests[p.duration] = p.watts;\n          }\n        }\n      });\n    }\n  });\n\n  if (events.length === 0) {\n    container.innerHTML = '<div style=\"text-align: center; color: var(--color-text-secondary); padding: 20px;\">No records found</div>';\n    return;\n  }\n\n  // Sort events reverse chronological (newest first)\n  const reversedEvents = events.reverse();\n\n  container.innerHTML = reversedEvents.map(e => `\n        <div class=\"pr-history-row\" data-id=\"${e.workoutId}\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--color-border); cursor: pointer;\">\n            <div style=\"flex: 1;\">\n                <div style=\"font-weight: 500;\">${e.metric}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">${e.date}</div>\n            </div>\n            <div style=\"text-align: right;\">\n                <div style=\"font-weight: bold; color: var(--color-accent);\">${e.value}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-success);\">${e.improvement}</div>\n            </div>\n        </div>\n    `).join('');\n\n  container.querySelectorAll('.pr-history-row').forEach(row => {\n    row.addEventListener('click', () => {\n      const id = (row as HTMLElement).dataset.id;\n      if (id) viewWorkoutDetails(id);\n    });\n  });\n}\n// Exported helper for the View\nexport async function refreshHistoryView(): Promise<void> {\n  // Reset to today if needed, or just refresh current view\n  if (currentView === 'list') {\n    await loadWorkouts();\n  } else if (currentView === 'calendar') {\n    await loadCalendar();\n  } else if (currentView === 'analytics') {\n    await loadAnalytics();\n  }\n}\n\n/**\n * Parses telemetry and renders charts for workout detail\n */\nfunction renderWorkoutCharts(telemetryJson: string, startTimeIso: string | number): void {\n  try {\n    const data = JSON.parse(telemetryJson) as MeasurementsData;\n    const startTs = typeof startTimeIso === 'string' ? new Date(startTimeIso).getTime() : startTimeIso;\n\n    // Power Chart\n    const powerContainer = document.getElementById('wd-chart-power');\n    if (powerContainer && data.power && data.power.length > 0) {\n      const points = data.power.map(p => ({ x: p.timestamp - startTs, y: p.value }));\n      renderLineChart(powerContainer, points, {\n        title: 'Power',\n        color: '#fbbf24', // Amber 400\n        yLabel: 'Watts',\n        yMin: 0\n      });\n    } else if (powerContainer) {\n      powerContainer.style.display = 'none';\n    }\n\n    // Heart Rate Chart\n    const hrContainer = document.getElementById('wd-chart-hr');\n    if (hrContainer && data.heartrate && data.heartrate.length > 0) {\n      const points = data.heartrate.map(p => ({ x: p.timestamp - startTs, y: p.value }));\n      renderLineChart(hrContainer, points, {\n        title: 'Heart Rate',\n        color: '#f87171', // Red 400\n        yLabel: 'BPM',\n        yMin: 40\n      });\n    } else if (hrContainer) {\n      hrContainer.style.display = 'none';\n    }\n\n    // Cadence Chart\n    const cadContainer = document.getElementById('wd-chart-cadence');\n    if (cadContainer && data.cadence && data.cadence.length > 0) {\n      const points = data.cadence.map(p => ({ x: p.timestamp - startTs, y: p.value }));\n      renderLineChart(cadContainer, points, {\n        title: 'Cadence',\n        color: '#60a5fa', // Blue 400\n        yLabel: 'RPM',\n        yMin: 0\n      });\n    } else if (cadContainer) {\n      cadContainer.style.display = 'none';\n    }\n\n    // Altitude Chart\n    const altContainer = document.getElementById('wd-chart-altitude');\n    if (altContainer && data.altitude && data.altitude.length > 0) {\n      const points = data.altitude.map(p => ({ x: p.timestamp - startTs, y: p.value }));\n      // Filter out zero altitudes if unlikely\n      const validPoints = points.filter(p => p.y !== 0);\n\n      if (validPoints.length > 0) {\n        renderLineChart(altContainer, validPoints, {\n          title: 'Altitude',\n          color: '#34d399', // Emerald 400\n          yLabel: 'Meters'\n        });\n      } else {\n        altContainer.style.display = 'none';\n      }\n    } else if (altContainer) {\n      altContainer.style.display = 'none';\n    }\n\n  } catch (e) {\n    console.error('Failed to parse telemetry for charts', e);\n  }\n}\n\n/**\n * Start the Crop Tool for a workout\n */\nfunction startCropTool(workout: Workout): void {\n  if (!workout.telemetry || !workout.startTime) {\n    alert('No telemetry data available for cropping');\n    return;\n  }\n\n  const detailPanel = document.getElementById('workoutDetailPanel');\n  if (!detailPanel) return;\n\n  let measurements: MeasurementsData | null = null;\n  try {\n    measurements = JSON.parse(workout.telemetry) as MeasurementsData;\n  } catch (e) {\n    console.error('Invalid telemetry', e);\n    alert('Failed to parse workout data');\n    return;\n  }\n\n  if (!measurements) return;\n\n  const originalStart = new Date(workout.startTime).getTime();\n  const originalEnd = workout.endTime ? new Date(workout.endTime).getTime() : originalStart + (workout.duration || 0) * 1000;\n\n  // Initial state\n  let currentStart = originalStart;\n  let currentEnd = originalEnd;\n  const durationMs = originalEnd - originalStart;\n\n  // Render Crop UI\n  detailPanel.innerHTML = `\n    <div class=\"workout-crop-tool\">\n      <div class=\"workout-detail-header\">\n        <button id=\"cancelCropBtn\" class=\"workout-back-btn\">Cancel</button>\n        <h3>Crop Workout</h3>\n        <button id=\"saveCropBtn\" class=\"workout-action-btn workout-status-completed\">Save Changes</button>\n      </div>\n\n      <div class=\"crop-controls\" style=\"margin: 20px 0; padding: 20px; background: var(--color-bg-secondary); border-radius: 8px;\">\n         <div style=\"display: flex; justify-content: space-between; margin-bottom: 20px;\">\n             <div>\n                 <label>Start Time offset</label>\n                 <div class=\"value-display\" id=\"cropStartDisplay\">00:00</div>\n                 <input type=\"range\" id=\"cropStartSlider\" min=\"0\" max=\"${durationMs}\" value=\"0\" style=\"width: 100%\">\n             </div>\n             <div style=\"text-align: right;\">\n                 <label>End Time offset</label>\n                 <div class=\"value-display\" id=\"cropEndDisplay\">${formatDuration(durationMs / 1000)}</div>\n                 <input type=\"range\" id=\"cropEndSlider\" min=\"0\" max=\"${durationMs}\" value=\"${durationMs}\" style=\"width: 100%\">\n             </div>\n         </div>\n         \n         <div style=\"text-align: center; font-weight: bold; margin-bottom: 10px;\">\n            New Duration: <span id=\"cropDurationDisplay\">${formatDuration(durationMs / 1000)}</span>\n         </div>\n         \n         <div id=\"cropPreviewChart\" style=\"height: 150px; background: var(--card-bg); border-radius: 8px;\"></div>\n      </div>\n      \n      <div class=\"crop-info\" style=\"font-size: 0.9em; color: var(--color-text-secondary); margin-top: 10px;\">\n          <p> Saving will overwrite the original workout data. This cannot be undone.</p>\n      </div>\n    </div>\n  `;\n\n  // Init interaction\n  const sliderStart = document.getElementById('cropStartSlider') as HTMLInputElement;\n  const sliderEnd = document.getElementById('cropEndSlider') as HTMLInputElement;\n  const displayStart = document.getElementById('cropStartDisplay');\n  const displayEnd = document.getElementById('cropEndDisplay');\n  const displayDuration = document.getElementById('cropDurationDisplay');\n  const chartContainer = document.getElementById('cropPreviewChart')!;\n\n  // Render preview chart (using Power as reference)\n  const renderPreview = () => {\n    if (measurements && measurements.power) {\n      const cropped = cropWorkout(measurements, originalStart, currentStart, currentEnd);\n      const points = cropped.measurements.power.map(p => ({ x: p.timestamp - currentStart, y: p.value }));\n\n      renderLineChart(chartContainer, points, {\n        title: 'Preview (Power)',\n        color: '#fbbf24',\n        yMin: 0,\n        height: 150\n      });\n    }\n  };\n\n  const updateUI = () => {\n    const startOffset = parseInt(sliderStart.value);\n    const endOffset = parseInt(sliderEnd.value);\n\n    // Enforce constraints\n    if (startOffset >= endOffset) {\n      // Prevent crossing\n      if (document.activeElement === sliderStart) {\n        sliderStart.value = (endOffset - 10000).toString(); // Keep 10s gap\n      } else {\n        sliderEnd.value = (startOffset + 10000).toString();\n      }\n      return;\n    }\n\n    currentStart = originalStart + parseInt(sliderStart.value);\n    currentEnd = originalStart + parseInt(sliderEnd.value);\n\n    if (displayStart) displayStart.textContent = formatDuration(parseInt(sliderStart.value) / 1000);\n    if (displayEnd) displayEnd.textContent = formatDuration(parseInt(sliderEnd.value) / 1000);\n    if (displayDuration) displayDuration.textContent = formatDuration((currentEnd - currentStart) / 1000);\n\n    renderPreview();\n  };\n\n  sliderStart.addEventListener('input', updateUI);\n  sliderEnd.addEventListener('input', updateUI);\n\n  // Initial render\n  setTimeout(renderPreview, 0);\n\n  // Cancel Action\n  document.getElementById('cancelCropBtn')?.addEventListener('click', () => {\n    viewWorkoutDetails(workout.id);\n  });\n\n  // Save Action\n  document.getElementById('saveCropBtn')?.addEventListener('click', async () => {\n    const btn = document.getElementById('saveCropBtn') as HTMLButtonElement;\n    btn.disabled = true;\n    btn.textContent = 'Saving...';\n\n    try {\n      const result = cropWorkout(measurements!, originalStart, currentStart, currentEnd);\n\n      // Construct updated workout object (for future API syncing)\n      // const updatedWorkout = {\n      //     ...workout,\n      //     startTime: new Date(result.startTime).toISOString(),\n      //     endTime: new Date(result.endTime).toISOString(),\n      //     duration: result.duration,\n      //     summary: JSON.stringify(result.summary),\n      //     telemetry: JSON.stringify(result.measurements)\n      // };\n\n      // Save methods\n      if (isIndexedDBSupported()) {\n        // Always update local storage if available\n        const { saveCompletedWorkout } = await import('../storage/workoutStorage.js');\n        await saveCompletedWorkout(\n          result.measurements,\n          result.startTime,\n          result.endTime\n        );\n\n        // If we are renaming/replacing, we might need to delete the old one if the ID depends on start time.\n        // ID is 'workout_' + startTime.\n        // If start time changes, ID changes!\n        if (result.startTime !== originalStart) {\n          // We created a new record. Should we delete the old one?\n          // Yes, to avoid duplicates.\n          // But wait, if it came from API, ID is a UUID usually.\n        }\n      }\n\n      // If pure local (ID starts with workout_), we might need to handle ID change or just update data\n      // If it is an API workout, we need to send update to server\n      // TODO: Implement API update for telemetry. For now, we only update local if possible or alert user.\n      if (dataSource === 'local' || workout.id.startsWith('workout_')) {\n        if (result.startTime !== originalStart) {\n          // const { deleteWorkout: deleteLocal } = await import('../api/workoutClient.js'); \n          // TODO: Implement local cleanup for renamed/moved workouts\n        }\n        alert('Workout cropped and saved locally.');\n      } else {\n        alert('Cropping currently only supported for local workouts (Server update not implemented). Changes are saved to local history.');\n        // We just saved it to local indexedDb as a new workout potentially.\n      }\n\n      // Return to details\n      // If ID changed, we might need to go to list\n      if (result.startTime !== originalStart && workout.id.startsWith('workout_')) {\n        // Go to list\n        const listPanel = document.getElementById('workoutListPanel');\n        if (detailPanel && listPanel) {\n          detailPanel.style.display = 'none';\n          listPanel.style.display = 'block';\n          // Trigger refresh mechanism?\n          document.getElementById('historyRefresh')?.click();\n        }\n      } else {\n        viewWorkoutDetails(workout.id);\n      }\n\n    } catch (e) {\n      console.error('Failed to save crop', e);\n      alert('Error saving cropped workout');\n      btn.disabled = false;\n      btn.textContent = 'Save Changes';\n    }\n  });\n}\n","import { View } from '../router/View.js';\nimport { initHistoryLogic, refreshHistoryView } from '../ui/workoutHistory.js';\n\nexport class HistoryView implements View {\n    public id = 'history';\n    private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('workoutHistoryTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initHistoryLogic();\n                this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('History template not found!');\n            container.innerHTML = '<p>Error loading history view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        if (this.isInitialized) {\n            refreshHistoryView();\n        } else {\n            // Fallback if onEnter is called too fast (shouldn't happen with sync init)\n            // logic is initialized in init(), but data might need loading\n            setTimeout(() => refreshHistoryView(), 50);\n        }\n    }\n\n    public onLeave(): void {\n        // Cleanup if needed\n    }\n}\n","/**\n * Workout Library\n * \n * Pre-built structured workouts.\n */\n\nimport type { StructuredWorkout, WorkoutStep } from './types.js';\n\n// Helper to generate ramp steps\nconst generateRampSteps = (startWatts: number, stepWatts: number, steps: number): WorkoutStep[] => {\n    return Array.from({ length: steps }).map((_, i) => {\n        const watts = startWatts + (i * stepWatts);\n        return {\n            type: 'active',\n            duration: 60,\n            target: { type: 'power', unit: 'watts', value: watts },\n            name: `Step ${i + 1}`,\n            description: `${watts} Watts`\n        };\n    });\n};\n\nconst RAMP_TEST: StructuredWorkout = {\n    id: 'ramp-test',\n    name: 'Ramp Test',\n    description: 'Standard Ramp Test to estimate FTP. Start at 100W, increase by 20W every minute until failure.',\n    tags: ['test', 'ftp'],\n    category: 'Testing',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 300,\n            target: { type: 'open', unit: 'watts', min: 80, max: 120 },\n            description: 'Free warmup'\n        },\n        ...generateRampSteps(100, 20, 25) // Up to 600W\n    ]\n};\n\nconst SWEET_SPOT_3X10: StructuredWorkout = {\n    id: 'sweet-spot-3x10',\n    name: 'Sweet Spot 3x10',\n    description: 'Classic Sweet Spot workout. 3 intervals of 10 minutes at 90% FTP.',\n    tags: ['sweet-spot', 'aerobic'],\n    category: 'Sweet Spot',\n    steps: [\n        { type: 'warmup', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Warmup' },\n        // Interval 1\n        { type: 'active', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 90 }, name: 'Sweet Spot' },\n        { type: 'recovery', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Recovery' },\n        // Interval 2\n        { type: 'active', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 90 }, name: 'Sweet Spot' },\n        { type: 'recovery', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Recovery' },\n        // Interval 3\n        { type: 'active', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 90 }, name: 'Sweet Spot' },\n        { type: 'cooldown', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Cooldown' }\n    ]\n};\n\nconst VO2_MAX_30_30: StructuredWorkout = {\n    id: 'vo2-30-30',\n    name: 'VO2 Max 30/30s',\n    description: 'High intensity intervals. 2 sets of 8x 30s ON / 30s OFF.',\n    tags: ['vo2max', 'hiit'],\n    category: 'VO2 Max',\n    steps: [\n        { type: 'warmup', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Warmup' },\n        { type: 'warmup', duration: 60, target: { type: 'power', unit: 'percent_ftp', value: 100 }, name: 'Opener' },\n        { type: 'rest', duration: 120, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Recover' },\n\n        // Set 1 (8 reps)\n        ...Array.from({ length: 8 }).flatMap((_, i) => [\n            { type: 'active', duration: 30, target: { type: 'power', unit: 'percent_ftp', value: 120 }, name: `Rep ${i + 1}` },\n            { type: 'rest', duration: 30, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Float' }\n        ] as WorkoutStep[]),\n\n        { type: 'rest', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Set Recovery' },\n\n        // Set 2 (8 reps)\n        ...Array.from({ length: 8 }).flatMap((_, i) => [\n            { type: 'active', duration: 30, target: { type: 'power', unit: 'percent_ftp', value: 120 }, name: `Rep ${i + 1}` },\n            { type: 'rest', duration: 30, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Float' }\n        ] as WorkoutStep[]),\n\n        { type: 'cooldown', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 40 }, name: 'Cooldown' }\n    ]\n};\n\nexport const WORKOUT_LIBRARY: StructuredWorkout[] = [\n    RAMP_TEST,\n    SWEET_SPOT_3X10,\n    VO2_MAX_30_30\n];\n\nexport function getWorkoutById(id: string): StructuredWorkout | undefined {\n    return WORKOUT_LIBRARY.find(w => w.id === id);\n}\n\n/**\n * Calculate total duration in seconds\n */\nexport function getWorkoutDuration(workout: StructuredWorkout): number {\n    return workout.steps.reduce((acc, step) => acc + step.duration, 0);\n}\n\n","/**\n * User Profile Storage\n *\n * Manages persistence of user settings (FTP, Weight, Max HR).\n */\n\n/**\n * User profile settings for training zones\n */\nexport interface UserProfile {\n    /** Functional Threshold Power in watts */\n    ftp: number | null;\n    /** Maximum heart rate in bpm */\n    maxHr: number | null;\n    /** Body weight in kg */\n    weight: number | null;\n    /** Whether onboarding has been completed */\n    onboardingComplete: boolean;\n    /** Timestamp of last profile update */\n    lastUpdated: number | null;\n}\n\n/** Storage key for user profile */\nexport const PROFILE_KEY = 'bpt-user-profile';\n\n/** Default profile values */\nexport const defaultProfile: UserProfile = {\n    ftp: null,\n    maxHr: null,\n    weight: null,\n    onboardingComplete: false,\n    lastUpdated: null,\n};\n\n/**\n * Load user profile from localStorage\n */\nexport function loadUserProfile(): UserProfile {\n    try {\n        if (typeof localStorage === 'undefined') {\n            return { ...defaultProfile };\n        }\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return { ...defaultProfile, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ...defaultProfile };\n}\n\n/**\n * Save user profile to localStorage\n */\nexport function saveUserProfile(profile: UserProfile): void {\n    try {\n        if (typeof localStorage === 'undefined') {\n            console.warn('localStorage not available, profile not saved');\n            return;\n        }\n        profile.lastUpdated = Date.now();\n        localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));\n    } catch (e) {\n        console.warn('Failed to save user profile:', e);\n    }\n}\n","/**\n * Audio cues for workouts and notifications\n * Using Web Audio API for synthetic sounds (no assets needed)\n * and SpeechSynthesis for voice announcements.\n */\n\nclass AudioController {\n    private audioCtx: AudioContext | null = null;\n    private gainNode: GainNode | null = null;\n    private isMuted: boolean = false;\n\n    constructor() {\n        // Initialize AudioContext on first user interaction if possible\n        // But for now we just prepare it.\n        // Modern browsers require user gesture to resume AudioContext.\n    }\n\n    public init() {\n        this.ensureContext();\n    }\n\n    private ensureContext() {\n        if (!this.audioCtx) {\n            const Ctx = window.AudioContext || window.webkitAudioContext;\n            if (Ctx) {\n                this.audioCtx = new Ctx();\n                this.gainNode = this.audioCtx.createGain();\n                this.gainNode.connect(this.audioCtx.destination);\n                this.gainNode.gain.value = 0.5; // Default volume\n            }\n        }\n\n        if (this.audioCtx && this.audioCtx.state === 'suspended') {\n            this.audioCtx.resume();\n        }\n    }\n\n    public setMuted(muted: boolean) {\n        this.isMuted = muted;\n    }\n\n    /**\n     * Play a synthesized beep\n     * @param freq Frequency in Hz\n     * @param duration Duration in ms\n     * @param type Oscillator type\n     */\n    public beep(freq: number = 440, duration: number = 200, type: OscillatorType = 'sine') {\n        if (this.isMuted) return;\n        this.ensureContext();\n\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const osc = this.audioCtx.createOscillator();\n        const gain = this.audioCtx.createGain();\n\n        osc.type = type;\n        osc.frequency.setValueAtTime(freq, this.audioCtx.currentTime);\n\n        // Envelope to avoid clicking\n        gain.gain.setValueAtTime(0, this.audioCtx.currentTime);\n        gain.gain.linearRampToValueAtTime(0.5, this.audioCtx.currentTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.001, this.audioCtx.currentTime + (duration / 1000));\n\n        osc.connect(gain);\n        gain.connect(this.gainNode);\n\n        osc.start();\n        osc.stop(this.audioCtx.currentTime + (duration / 1000));\n    }\n\n    /**\n     * Play a sequence of beeps (e.g. countdown)\n     * High pitch: 880Hz, Low pitch: 440Hz\n     */\n    public playCountdown() {\n        this.beep(440, 150); // 3\n    }\n\n    public playStart() {\n        this.beep(880, 400); // GO\n    }\n\n    public playSuccess() {\n        if (this.isMuted) return;\n        this.ensureContext();\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const now = this.audioCtx.currentTime;\n\n        // Arpeggio C E G\n        this.scheduleNote(523.25, now, 0.1);\n        this.scheduleNote(659.25, now + 0.1, 0.1);\n        this.scheduleNote(783.99, now + 0.2, 0.2);\n    }\n\n    private scheduleNote(freq: number, startTime: number, duration: number) {\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const osc = this.audioCtx.createOscillator();\n        const gain = this.audioCtx.createGain();\n\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0, startTime);\n        gain.gain.linearRampToValueAtTime(0.3, startTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);\n\n        osc.connect(gain);\n        gain.connect(this.gainNode);\n\n        osc.start(startTime);\n        osc.stop(startTime + duration);\n    }\n\n    /**\n     * Speak text using SpeechSynthesis\n     */\n    public speak(text: string) {\n        if (this.isMuted || !window.speechSynthesis) return;\n\n        // Cancel current utterance\n        window.speechSynthesis.cancel();\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        utterance.rate = 1.0;\n        utterance.pitch = 1.0;\n        utterance.volume = 1.0;\n\n        window.speechSynthesis.speak(utterance);\n    }\n}\n\nexport const audioManager = new AudioController();\n","/**\n * Workout Runner\n * \n * Manages the execution state of a structured workout.\n */\n\nimport type { StructuredWorkout, ActiveWorkoutState, TargetUnit } from './types.js';\nimport { loadUserProfile } from '../storage/userSettings.js';\nimport { audioManager } from '../ui/audio.js';\n\nexport type StateChangeCallback = (state: ActiveWorkoutState) => void;\n\nexport class WorkoutRunner {\n    private state: ActiveWorkoutState;\n    private timerInterval: ReturnType<typeof setInterval> | null = null;\n    private onStateChange: StateChangeCallback | null = null;\n    private userFtp: number = 200; // Default fallback\n\n    constructor(workout: StructuredWorkout, options?: { userFtp?: number }) {\n        // Load User FTP\n        if (options?.userFtp) {\n            this.userFtp = options.userFtp;\n        } else {\n            try {\n                const profile = loadUserProfile();\n                if (profile.ftp) {\n                    this.userFtp = profile.ftp;\n                }\n            } catch (e) {\n                // Ignore error (e.g. ssr/test environment)\n            }\n        }\n\n        // Initialize State\n        const totalDuration = workout.steps.reduce((acc, step) => acc + step.duration, 0);\n\n        this.state = {\n            workout,\n            isRunning: false,\n            isPaused: true,\n            isFinished: false,\n            currentStepIndex: 0,\n            startTime: null,\n            stepElapsedTime: 0,\n            stepTimeRemaining: workout.steps[0].duration,\n            totalElapsedTime: 0,\n            totalDuration,\n            currentStep: workout.steps[0],\n            nextStep: workout.steps.length > 1 ? workout.steps[1] : null,\n            totalSteps: workout.steps.length,\n            currentAbsoluteTarget: undefined\n        };\n\n        // Initial calculation\n        this.updateCurrentTarget();\n    }\n\n    public getWorkoutName(): string {\n        return this.state.workout.name;\n    }\n\n    /**\n     * Set callback for state updates\n     */\n    public setCallback(cb: StateChangeCallback): void {\n        this.onStateChange = cb;\n        // Emit initial state\n        cb(this.state);\n    }\n\n    /**\n     * Start or Resume the workout\n     */\n    public start(): void {\n        if (this.state.isFinished) return;\n        if (this.state.isRunning && !this.state.isPaused) return;\n\n        if (!this.state.startTime) {\n            this.state.startTime = Date.now();\n        }\n\n        this.state.isRunning = true;\n        this.state.isPaused = false;\n        this.emitState();\n\n        this.timerInterval = setInterval(() => {\n            this.tick();\n        }, 1000);\n    }\n\n    /**\n     * Pause the workout\n     */\n    public pause(): void {\n        this.state.isPaused = true;\n        this.state.isRunning = false;\n        if (this.timerInterval) {\n            clearInterval(this.timerInterval);\n            this.timerInterval = null;\n        }\n        this.emitState();\n    }\n\n    /**\n     * Skip to next step\n     */\n    public nextStep(): void {\n        this.advanceStep();\n    }\n\n    /**\n     * Stop and cleanup\n     */\n    public stop(): void {\n        this.pause();\n        this.onStateChange = null;\n    }\n\n    private tick(): void {\n        if (this.state.isPaused || this.state.isFinished) return;\n\n        this.state.stepElapsedTime++;\n        this.state.totalElapsedTime++;\n        this.state.stepTimeRemaining = Math.max(0, this.state.currentStep.duration - this.state.stepElapsedTime);\n\n        // Update Ramp Targets dynamic calculation\n        this.updateCurrentTarget();\n\n        // Audio Cues (3, 2, 1)\n        if (this.state.stepTimeRemaining <= 3 && this.state.stepTimeRemaining > 0) {\n            this.safePlaySound('countdown');\n        }\n\n        // Check if step is complete\n        if (this.state.stepElapsedTime >= this.state.currentStep.duration) {\n            this.advanceStep();\n        } else {\n            this.emitState();\n        }\n    }\n\n    private advanceStep(): void {\n        const nextIndex = this.state.currentStepIndex + 1;\n\n        if (nextIndex >= this.state.workout.steps.length) {\n            this.finish();\n            return;\n        }\n\n        this.state.currentStepIndex = nextIndex;\n        this.state.currentStep = this.state.workout.steps[nextIndex];\n        this.state.nextStep = nextIndex + 1 < this.state.workout.steps.length\n            ? this.state.workout.steps[nextIndex + 1]\n            : null;\n\n        this.state.stepElapsedTime = 0;\n        this.state.stepTimeRemaining = this.state.currentStep.duration;\n        this.updateCurrentTarget();\n\n        // Play interval start sound\n        this.safePlaySound('start');\n\n        this.emitState();\n    }\n\n    private finish(): void {\n        this.state.isFinished = true;\n        this.state.isRunning = false;\n        this.pause();\n        this.safePlaySound('success');\n        this.emitState();\n    }\n\n    private safePlaySound(type: 'countdown' | 'start' | 'success'): void {\n        try {\n            if (type === 'countdown') audioManager.playCountdown();\n            if (type === 'start') audioManager.playStart();\n            if (type === 'success') audioManager.playSuccess();\n        } catch (e) {\n            // Ignore (test/headless)\n        }\n    }\n\n    private updateCurrentTarget(): void {\n        const step = this.state.currentStep;\n\n        if (step.rampStart && step.rampEnd) {\n            // Ramp Calculation\n            const startVal = this.resolveValue(step.rampStart.value, step.rampStart.unit);\n            const endVal = this.resolveValue(step.rampEnd.value, step.rampEnd.unit);\n\n            if (startVal !== null && endVal !== null) {\n                const progress = this.state.stepElapsedTime / step.duration;\n                const currentVal = startVal + (endVal - startVal) * progress;\n\n                this.state.currentAbsoluteTarget = {\n                    type: step.rampStart.type,\n                    unit: 'watts', // Resolved to watts usually\n                    value: Math.round(currentVal),\n                    min: Math.round(currentVal - 5),\n                    max: Math.round(currentVal + 5)\n                };\n            }\n        } else if (step.target) {\n            // Steady State\n            const val = this.resolveValue(step.target.value, step.target.unit);\n            const min = this.resolveValue(step.target.min, step.target.unit);\n            const max = this.resolveValue(step.target.max, step.target.unit);\n\n            if (val !== null || (min !== null && max !== null)) {\n                this.state.currentAbsoluteTarget = {\n                    type: step.target.type,\n                    unit: 'watts', // Assuming watts for now if resolved\n                    value: val || ((min! + max!) / 2),\n                    min: min || (val ? val - 10 : 0),\n                    max: max || (val ? val + 10 : 999)\n                };\n\n                // Handle HR units\n                if (step.target.type === 'heartrate') {\n                    this.state.currentAbsoluteTarget.unit = 'bpm';\n                }\n            } else {\n                this.state.currentAbsoluteTarget = undefined;\n            }\n        } else {\n            this.state.currentAbsoluteTarget = undefined;\n        }\n    }\n\n    // Resolve %FTP to Watts, etc.\n    private resolveValue(value: number | undefined, unit: TargetUnit): number | null {\n        if (value === undefined) return null;\n\n        if (unit === 'watts' || unit === 'bpm' || unit === 'rpm') {\n            return value;\n        }\n\n        if (unit === 'percent_ftp') {\n            return Math.round(this.userFtp * (value / 100));\n        }\n\n        return value;\n    }\n\n    private emitState(): void {\n        if (this.onStateChange) {\n            this.onStateChange({ ...this.state });\n        }\n    }\n\n    public getState(): ActiveWorkoutState {\n        return { ...this.state };\n    }\n}\n\n","/**\n * Custom Workout Storage\n * \n * Manages saving and loading user-created structured workouts in LocalStorage.\n */\n\nimport type { StructuredWorkout } from '../workouts/types.js';\n\nconst STORAGE_KEY = 'bpt_custom_workouts';\n\n/**\n * Get all custom workouts\n */\nexport function getCustomWorkouts(): StructuredWorkout[] {\n    try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return [];\n        return JSON.parse(raw);\n    } catch (e) {\n        console.error('Failed to load custom workouts', e);\n        return [];\n    }\n}\n\n/**\n * Save a custom workout\n */\nexport function saveCustomWorkout(workout: StructuredWorkout): void {\n    const workouts = getCustomWorkouts();\n\n    // Check if updating existing\n    const index = workouts.findIndex(w => w.id === workout.id);\n    if (index >= 0) {\n        workouts[index] = workout;\n    } else {\n        workouts.push(workout);\n    }\n\n    saveAll(workouts);\n}\n\n/**\n * Delete a custom workout\n */\nexport function deleteCustomWorkout(id: string): void {\n    const workouts = getCustomWorkouts();\n    const filtered = workouts.filter(w => w.id !== id);\n    saveAll(filtered);\n}\n\nfunction saveAll(workouts: StructuredWorkout[]): void {\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(workouts));\n    } catch (e) {\n        console.error('Failed to save custom workouts', e);\n        alert('Failed to save workout. Storage might be full.');\n    }\n}\n","/**\n * Workout UI Manager\n * \n * Handles the Workout Selection Modal and the Active Workout Player Overlay.\n */\n\nimport { WORKOUT_LIBRARY, getWorkoutDuration } from '../workouts/workoutLibrary.js';\nimport type { StructuredWorkout, WorkoutStep, ActiveWorkoutState } from '../workouts/types.js';\nimport { WorkoutRunner } from '../workouts/WorkoutRunner.js';\nimport { formatDuration } from '../api/workoutClient.js';\nimport { announce } from './accessibility.js';\nimport { audioManager } from './audio.js';\nimport { getCustomWorkouts, deleteCustomWorkout, saveCustomWorkout } from '../storage/customWorkouts.js';\n\nlet activeRunner: WorkoutRunner | null = null;\n// let playerVisible = false;\n\n// export function initWorkoutUI(): void {\n//     initSelectionModal();\n//     initPlayerControls();\n//     initImportExport();\n// }\n\n/**\n * Initialize Workout Selection Logic\n * Call this from the Workouts View\n */\nexport function initWorkoutSelectionLogic(): void {\n    initPlayerControls(); // Logic only, assuming container exists\n    initImportExport();\n    refreshWorkoutList();\n}\n\n\n/**\n * Initialize Import/Export controls\n */\nfunction initImportExport(): void {\n    const importBtn = document.getElementById('importWorkoutBtn');\n    const importInput = document.getElementById('importWorkoutInput') as HTMLInputElement;\n\n    if (importBtn && importInput) {\n        importBtn.addEventListener('click', () => {\n            importInput.click();\n        });\n\n        importInput.addEventListener('change', (e) => {\n            const files = (e.target as HTMLInputElement).files;\n            if (files && files.length > 0) {\n                importWorkoutFile(files[0]);\n                // Reset input\n                importInput.value = '';\n            }\n        });\n    }\n}\n\nasync function importWorkoutFile(file: File): Promise<void> {\n    try {\n        const text = await file.text();\n        const workout = JSON.parse(text) as StructuredWorkout;\n\n        // Basic validation\n        if (!workout.name || !Array.isArray(workout.steps)) {\n            throw new Error('Invalid workout format');\n        }\n\n        // Ensure unique ID for imported workout\n        workout.id = crypto.randomUUID();\n        workout.tags = [...(workout.tags || []), 'imported'];\n\n        saveCustomWorkout(workout);\n        refreshWorkoutList();\n        announce(`Imported workout: ${workout.name}`, 'assertive');\n    } catch (err) {\n        console.error('Import failed', err);\n        alert('Failed to import workout: Invalid file format.');\n    }\n}\n\nfunction exportWorkout(workout: StructuredWorkout): void {\n    const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(workout, null, 2));\n    const downloadAnchorNode = document.createElement('a');\n    downloadAnchorNode.setAttribute(\"href\", dataStr);\n    downloadAnchorNode.setAttribute(\"download\", `${workout.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`);\n    document.body.appendChild(downloadAnchorNode); // required for firefox\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n}\n\n// function initSelectionModal(): void {\n//     const btn = document.getElementById('workoutsButton');\n//     const modal = document.getElementById('workoutSelectionModal');\n//     const closeBtn = document.getElementById('closeWorkoutModal');\n//     // const list = document.getElementById('workoutList'); \n\n//     if (!btn || !modal || !closeBtn) return;\n\n//     // Open Modal\n//     btn.addEventListener('click', () => {\n//         modal.style.display = 'flex';\n//         refreshWorkoutList();\n//         announce('Workout selection opened', 'polite');\n//     });\n\n//     // Close Modal\n//     closeBtn.addEventListener('click', () => {\n//         modal.style.display = 'none';\n//     });\n// }\n\n/**\n * Render list of workouts (Exported for Builder to update)\n */\nexport function refreshWorkoutList(): void {\n    const container = document.getElementById('workoutList');\n    if (!container) return;\n\n    container.innerHTML = '';\n\n    const custom = getCustomWorkouts();\n\n    if (custom.length > 0) {\n        const h3 = document.createElement('h3');\n        h3.textContent = 'My Workouts';\n        h3.style.margin = '0 0 8px 0';\n        h3.style.fontSize = '1rem';\n        h3.style.color = 'var(--color-text-secondary)';\n        container.appendChild(h3);\n\n        custom.forEach(w => renderWorkoutItem(w, container, true));\n\n        const hr = document.createElement('hr');\n        hr.style.margin = '16px 0';\n        hr.style.border = '0';\n        hr.style.borderTop = '1px solid var(--color-border)';\n        container.appendChild(hr);\n\n        const h3lib = document.createElement('h3');\n        h3lib.textContent = 'Library';\n        h3lib.style.margin = '0 0 8px 0';\n        h3lib.style.fontSize = '1rem';\n        h3lib.style.color = 'var(--color-text-secondary)';\n        container.appendChild(h3lib);\n    }\n\n    WORKOUT_LIBRARY.forEach(w => renderWorkoutItem(w, container, false));\n}\n\nfunction renderWorkoutItem(w: StructuredWorkout, container: HTMLElement, isCustom: boolean): void {\n    const duration = getWorkoutDuration(w);\n\n    const el = document.createElement('div');\n    el.className = 'workout-item';\n    el.setAttribute('role', 'button');\n    el.setAttribute('tabindex', '0');\n    el.style.position = 'relative'; // For action buttons\n\n    let actionsHtml = '';\n    // Always allow exporting, but deleting only for custom\n    actionsHtml += `<button class=\"export-workout-btn\" aria-label=\"Export ${w.name}\" title=\"Export JSON\" style=\"background: none; border: none; font-size: 1.2rem; cursor: pointer;\"></button>`;\n\n    if (isCustom) {\n        actionsHtml += `<button class=\"delete-workout-btn\" aria-label=\"Delete ${w.name}\" title=\"Delete\" style=\"background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--color-error);\"></button>`;\n    }\n\n    const actionContainerStyle = \"position: absolute; right: 10px; top: 10px; display: flex; gap: 8px; z-index: 2;\";\n\n    el.innerHTML = `\n        <div class=\"workout-item-header\">\n            <span class=\"workout-item-title\">${w.name}</span>\n            <span class=\"workout-item-duration\"> ${formatDuration(duration * 1000)}</span>\n        </div>\n        <div class=\"workout-item-desc\">${w.description}</div>\n        <div class=\"workout-tags\">\n            ${(w.tags || []).map(t => `<span class=\"workout-tag\">${t}</span>`).join('')}\n        </div>\n        <div style=\"${actionContainerStyle}\">\n            ${actionsHtml}\n        </div>\n    `;\n\n    // Handle Export\n    const exportBtn = el.querySelector('.export-workout-btn');\n    exportBtn?.addEventListener('click', (e) => {\n        e.stopPropagation();\n        exportWorkout(w);\n    });\n\n    // Handle Delete\n    if (isCustom) {\n        const delBtn = el.querySelector('.delete-workout-btn');\n        delBtn?.addEventListener('click', (e) => {\n            e.stopPropagation();\n            if (confirm(`Delete workout \"${w.name}\"?`)) {\n                deleteCustomWorkout(w.id);\n                refreshWorkoutList();\n                announce(`Deleted workout: ${w.name}`, 'assertive');\n            }\n        });\n    }\n\n    // Start workout on click (prevent if clicking actions)\n    el.addEventListener('click', (e) => {\n        // Simple check to ensure we didn't click a button\n        if ((e.target as HTMLElement).tagName === 'BUTTON') return;\n\n        startStructuredWorkout(w);\n        const modal = document.getElementById('workoutSelectionModal');\n        if (modal) modal.style.display = 'none';\n    });\n\n    // Keyboard support\n    el.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            startStructuredWorkout(w);\n            const modal = document.getElementById('workoutSelectionModal');\n            if (modal) modal.style.display = 'none';\n        }\n    });\n\n    container.appendChild(el);\n}\n\n/**\n * Select and start a workout\n */\nexport function startStructuredWorkout(workout: StructuredWorkout, onComplete?: () => void): void {\n    if (activeRunner) {\n        if (!confirm('A workout is already active. Stop it and start this one?')) {\n            return;\n        }\n        activeRunner.stop();\n    }\n\n    // Initialize audio on user interaction\n    audioManager.init();\n\n    activeRunner = new WorkoutRunner(workout);\n\n    // Track if we have already called onComplete\n    let completed = false;\n\n    activeRunner.setCallback((state) => {\n        updatePlayerUI(state);\n\n        if (state.isFinished && !completed && onComplete) {\n            completed = true;\n            onComplete();\n        }\n    });\n\n    // Show player\n    const overlay = document.getElementById('workoutPlayerOverlay');\n    if (overlay) {\n        overlay.style.display = 'block';\n        // playerVisible = true;\n    }\n\n    // Announce\n    announce(`Starting workout: ${workout.name}. Ready to start.`, 'assertive');\n}\n\n/**\n * Initialize player controls (Minimize, Close, Skip)\n */\nfunction initPlayerControls(): void {\n    const overlay = document.getElementById('workoutPlayerOverlay');\n    const minimizeBtn = document.getElementById('wpMinimize');\n    const closeBtn = document.getElementById('wpClose');\n    const skipBtn = document.getElementById('wpSkip');\n\n    if (!overlay) return;\n\n    // Close/Stop\n    closeBtn?.addEventListener('click', () => {\n        if (!activeRunner) return;\n        if (confirm('Stop current workout?')) {\n            activeRunner.stop();\n            activeRunner = null;\n            overlay.style.display = 'none';\n            announce('Workout stopped', 'polite');\n        }\n    });\n\n    // Minimize (Toggle visibility of body)\n    minimizeBtn?.addEventListener('click', () => {\n        const body = overlay.querySelector('.workout-player-body') as HTMLElement;\n        if (body) {\n            const isHidden = body.style.display === 'none';\n            body.style.display = isHidden ? 'block' : 'none';\n            minimizeBtn.textContent = isHidden ? '_' : '';\n        }\n    });\n\n    // Skip\n    skipBtn?.addEventListener('click', () => {\n        if (activeRunner) {\n            activeRunner.nextStep();\n            announce('Skipped to next step', 'polite');\n        }\n    });\n}\n\n/**\n * Update the player UI based on state\n */\n/**\n * Update the player UI based on state\n */\nfunction updatePlayerUI(state: ActiveWorkoutState): void {\n    const nameEl = document.getElementById('wpWorkoutName');\n    const descEl = document.getElementById('wpStepDescription');\n    const timeEl = document.getElementById('wpStepTime');\n    const durEl = document.getElementById('wpStepDuration');\n    const targetEl = document.getElementById('wpTargetPower');\n    const nextEl = document.getElementById('wpNextStep');\n    const progressEl = document.getElementById('wpProgress');\n\n    if (nameEl) nameEl.textContent = state.workout.name;\n\n    if (state.currentStep) {\n        if (descEl) descEl.textContent = state.currentStep.description || state.currentStep.name || state.currentStep.type.toUpperCase();\n\n        // Timer\n        const timeRemaining = state.currentStep.duration - state.stepElapsedTime;\n        if (timeEl) timeEl.textContent = formatTime(Math.max(0, timeRemaining));\n        if (durEl) durEl.textContent = formatTime(state.currentStep.duration);\n\n        // Target\n        if (targetEl) {\n            targetEl.textContent = state.currentAbsoluteTarget?.value ? Math.round(state.currentAbsoluteTarget.value).toString() : '--';\n        }\n    }\n\n    // Next Step\n    if (nextEl) {\n        if (state.nextStep) {\n            const nextPwr = calculateNextTarget(state.nextStep);\n            nextEl.textContent = `${state.nextStep.type} (${formatTime(state.nextStep.duration)}${nextPwr})`;\n        } else {\n            nextEl.textContent = 'Finish';\n        }\n    }\n\n    // Progress Bar\n    if (progressEl) {\n        const pct = (state.stepElapsedTime / state.currentStep.duration) * 100;\n        progressEl.style.width = `${Math.min(100, Math.max(0, pct))}%`;\n\n        // Change color based on zone/intensity?\n        // simple: blue for warmup/rest, orange for active\n        if (state.currentStep.type === 'active') {\n            progressEl.style.backgroundColor = '#ff9800'; // Orange\n        } else if (state.currentStep.type === 'rest' || state.currentStep.type === 'warmup') {\n            progressEl.style.backgroundColor = '#2196F3'; // Blue\n        } else {\n            progressEl.style.backgroundColor = '#4CAF50'; // Green\n        }\n    }\n\n    // Finished?\n    if (state.isFinished) {\n        const overlay = document.getElementById('workoutPlayerOverlay');\n        if (overlay) overlay.style.display = 'none';\n        activeRunner = null;\n        alert('Workout Complete!');\n        announce('Workout Complete!', 'assertive');\n    }\n}\n\n/**\n * Basic time formatter (mm:ss)\n */\nfunction formatTime(seconds: number): string {\n    const m = Math.floor(seconds / 60);\n    const s = seconds % 60;\n    return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n}\n\n// Temporary helper until I expose calculation from Runner or pass it in state\nfunction calculateNextTarget(step: WorkoutStep): string {\n    // This logic is duplicated from Runner, improving later\n    const t = step.target;\n    if (!t) return '';\n    return t.value ? ` @ ~${t.value}${t.unit === 'percent_ftp' ? '%' : 'W'}` : '';\n}\n\n/**\n * Hook to link main timer start/pause to workout runner\n * Call this from main.ts or connection logic\n */\nexport function onWorkoutStart(): void {\n    if (activeRunner) {\n        activeRunner.start();\n    }\n}\n\nexport function onWorkoutPause(): void {\n    if (activeRunner) {\n        activeRunner.pause();\n    }\n}\n","/**\n * Workout Builder UI\n * \n * Manages the UI for creating custom structured workouts.\n */\n\nimport type { StructuredWorkout, WorkoutStep, WorkoutTarget, IntervalType, TargetType } from '../workouts/types.js';\nimport { saveCustomWorkout } from '../storage/customWorkouts.js';\nimport { announce } from './accessibility.js';\nimport { refreshWorkoutList } from './workoutPlayer.js';\n\nlet currentSteps: WorkoutStep[] = [];\n\n/**\n * Initialize Builder UI\n */\nexport function initWorkoutBuilder(): void {\n    const createBtn = document.getElementById('createWorkoutBtn');\n    const closeBtn = document.getElementById('closeBuilderModal');\n    const cancelBtn = document.getElementById('wbCancel');\n    const saveBtn = document.getElementById('wbSave');\n    const addStepBtn = document.getElementById('wbAddStepRef');\n\n    if (createBtn) {\n        createBtn.addEventListener('click', openBuilder);\n    }\n\n    if (closeBtn) closeBtn.addEventListener('click', closeBuilder);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeBuilder);\n\n    if (saveBtn) {\n        saveBtn.addEventListener('click', saveWorkout);\n    }\n\n    if (addStepBtn) {\n        addStepBtn.addEventListener('click', addStepFromForm);\n    }\n\n    // Toggle target value visibility based on type\n    const targetTypeSelect = document.getElementById('wbTargetType') as HTMLSelectElement;\n    if (targetTypeSelect) {\n        targetTypeSelect.addEventListener('change', () => {\n            const valInput = document.getElementById('wbTargetValue') as HTMLInputElement;\n            if (valInput) {\n                valInput.parentElement!.style.display = targetTypeSelect.value === 'open' ? 'none' : 'block';\n            }\n        });\n    }\n}\n\nfunction openBuilder(): void {\n    const modal = document.getElementById('workoutBuilderModal');\n    const selectionModal = document.getElementById('workoutSelectionModal');\n\n    if (selectionModal) selectionModal.style.display = 'none';\n    if (modal) {\n        modal.style.display = 'flex';\n        resetForm();\n    }\n}\n\nfunction closeBuilder(): void {\n    const modal = document.getElementById('workoutBuilderModal');\n    if (modal) modal.style.display = 'none';\n}\n\nfunction resetForm(): void {\n    currentSteps = [];\n    (document.getElementById('wbName') as HTMLInputElement).value = '';\n    (document.getElementById('wbDesc') as HTMLTextAreaElement).value = '';\n    renderSteps();\n}\n\nfunction addStepFromForm(): void {\n    const type = (document.getElementById('wbStepType') as HTMLSelectElement).value as IntervalType;\n    const durationStr = (document.getElementById('wbStepDuration') as HTMLInputElement).value;\n    const targetType = (document.getElementById('wbTargetType') as HTMLSelectElement).value as TargetType;\n    const targetValStr = (document.getElementById('wbTargetValue') as HTMLInputElement).value;\n\n    const duration = parseInt(durationStr, 10);\n    // Explicitly treat as string because it can contain unit-mixed values like 'percent_ftp'\n    const targetTypeStr = targetType as unknown as string;\n\n    if (isNaN(duration) || duration <= 0) {\n        alert('Invalid duration');\n        return;\n    }\n\n    let targetValue: number | undefined = undefined;\n    if (targetTypeStr !== 'open') { // Checks against string from DOM\n        targetValue = parseInt(targetValStr, 10);\n        if (isNaN(targetValue)) {\n            alert('Invalid target value');\n            return;\n        }\n    }\n\n    // Adapt to new WorkoutTarget structure\n    const target: WorkoutTarget = {\n        type: targetTypeStr === 'open' ? 'open' : 'power',\n        unit: targetTypeStr === 'percent_ftp' ? 'percent_ftp' : 'watts',\n        value: targetValue\n    };\n\n    const step: WorkoutStep = {\n        type,\n        duration,\n        target,\n        description: `${capitalize(type)} (${formatDuration(duration)})`\n    };\n\n    currentSteps.push(step);\n    renderSteps();\n    announce(`Added step: ${step.description}`, 'polite');\n}\n\nfunction renderSteps(): void {\n    const list = document.getElementById('wbStepsList');\n    if (!list) return;\n\n    if (currentSteps.length === 0) {\n        list.innerHTML = `<div class=\"wb-step-empty\" style=\"text-align: center; color: var(--color-text-secondary); padding: 1rem; border: 1px dashed var(--color-border);\">\n                        No steps added yet.\n                    </div>`;\n        return;\n    }\n\n    list.innerHTML = '';\n\n    currentSteps.forEach((step, index) => {\n        const row = document.createElement('div');\n        row.className = 'wb-step-item';\n        // Add minimal styles inline for now, ideally strictly in CSS\n        row.style.background = 'var(--card-bg-hover)';\n        row.style.padding = '8px';\n        row.style.borderRadius = '4px';\n        row.style.display = 'flex';\n        row.style.justifyContent = 'space-between';\n        row.style.alignItems = 'center';\n        row.style.border = '1px solid var(--color-border)';\n\n        const t = step.target;\n        const desc = !t || t.type === 'open'\n            ? 'Open effort'\n            : `${t.value} ${t.unit === 'percent_ftp' ? '%' : 'W'}`;\n\n        row.innerHTML = `\n            <div>\n                <strong>${index + 1}. ${capitalize(step.type)}</strong> - ${formatDuration(step.duration)}\n                <div style=\"font-size: 0.85em; color: var(--color-text-secondary)\">${desc}</div>\n            </div>\n            <button class=\"remove-step-btn\" data-index=\"${index}\" style=\"color: var(--color-error); background: none; border: none; cursor: pointer;\"></button>\n        `;\n\n        list.appendChild(row);\n    });\n\n    // Add event listeners for remove buttons\n    list.querySelectorAll('.remove-step-btn').forEach(btn => {\n        btn.addEventListener('click', (e) => {\n            const idx = parseInt((e.target as HTMLElement).getAttribute('data-index') || '-1', 10);\n            if (idx >= 0) {\n                currentSteps.splice(idx, 1);\n                renderSteps();\n            }\n        });\n    });\n}\n\nfunction saveWorkout(): void {\n    const name = (document.getElementById('wbName') as HTMLInputElement).value.trim();\n    const desc = (document.getElementById('wbDesc') as HTMLTextAreaElement).value.trim();\n\n    if (!name) {\n        alert('Please enter a workout name');\n        return;\n    }\n\n    if (currentSteps.length === 0) {\n        alert('Please add at least one step');\n        return;\n    }\n\n    const workout: StructuredWorkout = {\n        id: crypto.randomUUID(), // Native UUID\n        name,\n        description: desc,\n        steps: currentSteps,\n        tags: ['custom']\n    };\n\n    saveCustomWorkout(workout);\n    refreshWorkoutList(); // Note: need to export this from workoutPlayer\n    closeBuilder();\n    announce(`Workout saved: ${name}`, 'assertive');\n}\n\nfunction capitalize(s: string): string {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction formatDuration(sec: number): string {\n    const m = Math.floor(sec / 60);\n    const s = sec % 60;\n    if (m > 0) return `${m}m ${s}s`;\n    return `${s}s`;\n}\n","import { View } from '../router/View.js';\nimport { initWorkoutSelectionLogic, refreshWorkoutList } from '../ui/workoutPlayer.js';\nimport { initWorkoutBuilder } from '../ui/workoutBuilder.js';\n\nexport class WorkoutsView implements View {\n    public id = 'workouts';\n    private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('workoutSelectionTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            setTimeout(() => {\n                initWorkoutSelectionLogic();\n                initWorkoutBuilder(); // Initialize builder logic (it still uses a modal, which is fine)\n                this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Workouts template not found!');\n            container.innerHTML = '<p>Error loading workouts view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        if (this.isInitialized) {\n            refreshWorkoutList();\n        } else {\n            setTimeout(() => refreshWorkoutList(), 50);\n        }\n    }\n\n    public onLeave(): void {\n        // Cleanup if needed\n    }\n}\n","/**\n * Notification utilities\n * \n * Displays toast-style notifications to the user.\n * Accessible to screen readers via role=\"alert\".\n * \n * Now uses the bpt-toast Web Component when available,\n * with fallback to inline styles for progressive enhancement.\n * \n * @module notifications\n */\n\nimport { Toast } from '../components/Toast.js';\n\n/**\n * Notification types\n */\nexport type NotificationType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Show a notification to the user\n * \n * Creates an accessible toast notification that:\n * - Is announced to screen readers via role=\"alert\"\n * - Has proper color contrast (WCAG AA compliant)\n * - Respects reduced motion preferences\n * \n * @param message - The message to display\n * @param type - The type of notification (affects styling)\n * @param duration - How long to show the notification (ms)\n */\nexport function showNotification(\n    message: string,\n    type: NotificationType = 'info',\n    duration = 3000\n): void {\n    // Use the Web Component if available\n    if (customElements.get('bpt-toast')) {\n        Toast.show(message, type, { duration });\n        return;\n    }\n\n    // Fallback to inline notification (for cases where components aren't loaded)\n    const notification = document.createElement('div');\n\n    // Use WCAG AA compliant colors\n    const backgroundColor = type === 'error' ? '#b91c1c'\n        : type === 'success' ? '#15803d'\n            : type === 'warning' ? '#a16207'\n                : '#1d4ed8';\n\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    notification.style.cssText = `\n    position: fixed;\n    top: 80px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: ${backgroundColor};\n    color: white;\n    padding: 12px 24px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 1001;\n    font-size: 14px;\n    max-width: 90%;\n    text-align: center;\n    font-weight: 500;\n  `;\n\n    notification.textContent = message;\n    document.body.appendChild(notification);\n\n    setTimeout(() => {\n        // Check for reduced motion preference\n        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n        if (prefersReducedMotion) {\n            notification.remove();\n        } else {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 0.3s ease';\n            setTimeout(() => notification.remove(), 300);\n        }\n    }, duration);\n}\n\n","/**\n * Safely select a DOM element by ID.\n * Throws a specific error if the element is not found,\n * allowing for easier debugging than standard null pointer exceptions.\n * \n * @param id The ID of the element to select\n * @returns The selected element\n * @throws Error if element not found\n */\nexport function selectElement<T extends HTMLElement>(id: string): T {\n    const element = document.getElementById(id);\n    if (!element) {\n        throw new Error(`Critical DOM element missing: #${id}. Ensure index.html is correct.`);\n    }\n    return element as T;\n}\n","/**\n * Onboarding Flow\n *\n * First-run setup wizard for new users.\n * Guides users through:\n * - FTP (Functional Threshold Power) entry\n * - Max Heart Rate entry\n * - Weight entry\n * - Sensor pairing guide\n * - Feature tour\n *\n * @module onboarding\n */\n\nimport { announce, trapFocus } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { selectElement } from '../utils/dom.js';\n\nimport { type UserProfile, loadUserProfile, saveUserProfile } from '../storage/userSettings.js';\n\nexport { loadUserProfile, saveUserProfile };\nexport type { UserProfile };\n\n\n/**\n * Onboarding step configuration\n */\ninterface OnboardingStep {\n    id: string;\n    title: string;\n    icon: string;\n    content: string;\n    inputType?: 'number' | 'none';\n    inputLabel?: string;\n    inputPlaceholder?: string;\n    inputUnit?: string;\n    inputMin?: number;\n    inputMax?: number;\n    profileKey?: keyof UserProfile;\n    helpText?: string;\n}\n\n/**\n * Onboarding steps configuration\n */\nconst onboardingSteps: OnboardingStep[] = [\n    {\n        id: 'welcome',\n        title: 'Welcome to Bike Power Tracker!',\n        icon: '',\n        content: `\n            <p>Let's set up your profile for personalized training zones and better workout analysis.</p>\n            <p>This will only take a minute, and you can update these settings anytime.</p>\n        `,\n    },\n    {\n        id: 'ftp',\n        title: 'Functional Threshold Power (FTP)',\n        icon: '',\n        content: `\n            <p>Your FTP is the highest power you can sustain for about an hour.</p>\n            <p>If you don't know your FTP, you can skip this and do an FTP test later.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your FTP',\n        inputPlaceholder: 'e.g., 200',\n        inputUnit: 'watts',\n        inputMin: 50,\n        inputMax: 500,\n        profileKey: 'ftp',\n        helpText: 'Typical range: 100-400W for recreational to elite cyclists',\n    },\n    {\n        id: 'maxhr',\n        title: 'Maximum Heart Rate',\n        icon: '',\n        content: `\n            <p>Your max HR is used to calculate heart rate training zones.</p>\n            <p>A common estimate is 220 minus your age, but actual max HR varies.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Max HR',\n        inputPlaceholder: 'e.g., 185',\n        inputUnit: 'bpm',\n        inputMin: 100,\n        inputMax: 230,\n        profileKey: 'maxHr',\n        helpText: 'If unsure, use 220 - your age as a starting point',\n    },\n    {\n        id: 'weight',\n        title: 'Body Weight',\n        icon: '',\n        content: `\n            <p>Your weight is used to calculate power-to-weight ratio (W/kg), an important metric for climbing.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Weight',\n        inputPlaceholder: 'e.g., 70',\n        inputUnit: 'kg',\n        inputMin: 30,\n        inputMax: 200,\n        profileKey: 'weight',\n        helpText: 'Used for calculating watts per kilogram (W/kg)',\n    },\n    {\n        id: 'sensors',\n        title: 'Connect Your Sensors',\n        icon: '',\n        content: `\n            <p>Bike Power Tracker works with Bluetooth cycling sensors:</p>\n            <ul style=\"text-align: left; margin: 16px auto; max-width: 280px;\">\n                <li><strong> Power Meter</strong> - Measures your power output in watts</li>\n                <li><strong> Cadence Sensor</strong> - Tracks your pedaling speed (RPM)</li>\n                <li><strong> Heart Rate Monitor</strong> - Monitors your heart rate</li>\n            </ul>\n            <p>Use the menu () to connect your sensors before starting a workout.</p>\n        `,\n    },\n    {\n        id: 'shortcuts',\n        title: 'Keyboard Shortcuts',\n        icon: '',\n        content: `\n            <p>Quick access to common actions:</p>\n            <table style=\"margin: 16px auto; text-align: left; border-collapse: collapse;\">\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Space</kbd></td><td>Start/pause workout</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>L</kbd></td><td>Mark lap</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>M</kbd></td><td>Open menu</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>S</kbd></td><td>Open settings</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>E</kbd></td><td>Export data</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Escape</kbd></td><td>Close modal</td></tr>\n            </table>\n        `,\n    },\n    {\n        id: 'done',\n        title: 'You\\'re All Set!',\n        icon: '',\n        content: `\n            <p>Your profile has been saved. You can update your settings anytime from the menu.</p>\n            <p>Ready to start your first workout? Connect a sensor and press the <strong> Start</strong> button!</p>\n        `,\n    },\n];\n\n/**\n * Create the onboarding modal element\n */\nfunction createOnboardingModal(): HTMLElement {\n    const modal = document.createElement('div');\n    modal.id = 'onboardingModal';\n    modal.className = 'stream-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-labelledby', 'onboardingTitle');\n    modal.setAttribute('aria-modal', 'true');\n    modal.style.display = 'none';\n\n    modal.innerHTML = `\n        <div class=\"stream-modal-content onboarding-modal\" style=\"max-width: 480px;\">\n            <div class=\"stream-modal-header\">\n                <h2 id=\"onboardingTitle\">\n                    <span id=\"onboardingIcon\"></span>\n                    <span id=\"onboardingStepTitle\">Welcome</span>\n                </h2>\n                <button id=\"skipOnboarding\" class=\"close-button\" aria-label=\"Skip onboarding\">&times;</button>\n            </div>\n            <div class=\"stream-modal-body\" style=\"text-align: center; padding: 24px;\">\n                <div id=\"onboardingContent\"></div>\n                <div id=\"onboardingInput\" style=\"margin: 20px 0; display: none;\">\n                    <label for=\"onboardingInputField\" id=\"onboardingInputLabel\" style=\"display: block; margin-bottom: 8px; font-weight: bold;\"></label>\n                    <div style=\"display: flex; align-items: center; justify-content: center; gap: 8px;\">\n                        <input type=\"number\" id=\"onboardingInputField\" \n                            style=\"width: 120px; padding: 12px; font-size: 18px; text-align: center; border: 2px solid #d0d7de; border-radius: 8px;\"\n                            aria-describedby=\"onboardingHelpText\">\n                        <span id=\"onboardingInputUnit\" style=\"font-size: 16px; color: #666;\"></span>\n                    </div>\n                    <p id=\"onboardingHelpText\" style=\"margin-top: 8px; font-size: 12px; color: #666;\"></p>\n                </div>\n                <div class=\"onboarding-progress\" style=\"margin: 24px 0;\">\n                    <div id=\"onboardingProgressDots\" style=\"display: flex; justify-content: center; gap: 8px;\"></div>\n                </div>\n                <div class=\"onboarding-buttons\" style=\"display: flex; justify-content: center; gap: 12px; margin-top: 20px;\">\n                    <button id=\"onboardingPrev\" style=\"padding: 12px 24px; border: 1px solid #d0d7de; background: white; border-radius: 8px; cursor: pointer; font-size: 16px;\">\n                         Back\n                    </button>\n                    <button id=\"onboardingNext\" style=\"padding: 12px 24px; border: none; background: #2196F3; color: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;\">\n                        Next \n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Render progress dots\n */\nfunction renderProgressDots(container: HTMLElement, currentStep: number, totalSteps: number): void {\n    container.innerHTML = '';\n    for (let i = 0; i < totalSteps; i++) {\n        const dot = document.createElement('span');\n        dot.style.cssText = `\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n            background: ${i === currentStep ? '#2196F3' : '#d0d7de'};\n            transition: background 0.3s ease;\n        `;\n        dot.setAttribute('aria-hidden', 'true');\n        container.appendChild(dot);\n    }\n}\n\n/**\n * Render a step in the onboarding flow\n */\nfunction renderStep(\n    step: OnboardingStep,\n    stepIndex: number,\n    profile: UserProfile,\n    elements: {\n        icon: HTMLElement;\n        title: HTMLElement;\n        content: HTMLElement;\n        inputContainer: HTMLElement;\n        inputField: HTMLInputElement;\n        inputLabel: HTMLElement;\n        inputUnit: HTMLElement;\n        helpText: HTMLElement;\n        prevBtn: HTMLButtonElement;\n        nextBtn: HTMLButtonElement;\n        progressDots: HTMLElement;\n    }\n): void {\n    const { icon, title, content, inputContainer, inputField, inputLabel, inputUnit, helpText, prevBtn, nextBtn, progressDots } = elements;\n\n    // Update header\n    icon.textContent = step.icon;\n    title.textContent = step.title;\n\n    // Update content\n    content.innerHTML = step.content;\n\n    // Handle input\n    if (step.inputType === 'number' && step.profileKey) {\n        inputContainer.style.display = 'block';\n        inputLabel.textContent = step.inputLabel || '';\n        inputField.placeholder = step.inputPlaceholder || '';\n        inputField.min = String(step.inputMin || 0);\n        inputField.max = String(step.inputMax || 9999);\n        inputUnit.textContent = step.inputUnit || '';\n        helpText.textContent = step.helpText || '';\n\n        // Load existing value\n        const currentValue = profile[step.profileKey];\n        inputField.value = currentValue ? String(currentValue) : '';\n        inputField.focus();\n    } else {\n        inputContainer.style.display = 'none';\n    }\n\n    // Update buttons\n    prevBtn.style.display = stepIndex === 0 ? 'none' : 'inline-block';\n\n    if (stepIndex === onboardingSteps.length - 1) {\n        nextBtn.textContent = 'Get Started! ';\n    } else if (step.inputType === 'number') {\n        nextBtn.textContent = 'Next ';\n    } else {\n        nextBtn.textContent = 'Next ';\n    }\n\n    // Update progress dots\n    renderProgressDots(progressDots, stepIndex, onboardingSteps.length);\n\n    // Announce for screen readers\n    announce(`Step ${stepIndex + 1} of ${onboardingSteps.length}: ${step.title}`);\n}\n\n/**\n * Show the onboarding flow\n */\nexport function showOnboarding(forceShow = false): Promise<UserProfile> {\n    return new Promise((resolve) => {\n        const profile = loadUserProfile();\n\n        // Check if onboarding should be shown\n        if (!forceShow && profile.onboardingComplete) {\n            resolve(profile);\n            return;\n        }\n\n        // Create modal if it doesn't exist\n        let modal = document.getElementById('onboardingModal');\n        if (!modal) {\n            modal = createOnboardingModal();\n            document.body.appendChild(modal);\n        }\n\n        // Get elements\n        const icon = selectElement('onboardingIcon');\n        const title = selectElement('onboardingStepTitle');\n        const content = selectElement('onboardingContent');\n        const inputContainer = selectElement('onboardingInput');\n        const inputField = selectElement<HTMLInputElement>('onboardingInputField');\n        const inputLabel = selectElement('onboardingInputLabel');\n        const inputUnit = selectElement('onboardingInputUnit');\n        const helpText = selectElement('onboardingHelpText');\n        const prevBtn = selectElement<HTMLButtonElement>('onboardingPrev');\n        const nextBtn = selectElement<HTMLButtonElement>('onboardingNext');\n        const skipBtn = selectElement<HTMLButtonElement>('skipOnboarding');\n        const progressDots = selectElement('onboardingProgressDots');\n\n        const elements = { icon, title, content, inputContainer, inputField, inputLabel, inputUnit, helpText, prevBtn, nextBtn, progressDots };\n\n        let currentStep = 0;\n\n        // Save input value for current step\n        const saveCurrentInput = (): void => {\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number' && step.profileKey) {\n                const value = inputField.value ? parseFloat(inputField.value) : null;\n                if (value !== null && step.profileKey !== 'onboardingComplete' && step.profileKey !== 'lastUpdated') {\n                    profile[step.profileKey] = value;\n                }\n            }\n        };\n\n        // Render current step\n        const render = (): void => {\n            renderStep(onboardingSteps[currentStep], currentStep, profile, elements);\n        };\n\n        // Navigation handlers\n        const goNext = (): void => {\n            // Validate input if it's a number step\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number') {\n                if (!inputField.checkValidity()) {\n                    inputField.reportValidity();\n                    return;\n                }\n            }\n\n            saveCurrentInput();\n\n            if (currentStep < onboardingSteps.length - 1) {\n                currentStep++;\n                render();\n            } else {\n                // Complete onboarding\n                profile.onboardingComplete = true;\n                saveUserProfile(profile);\n                modal!.style.display = 'none';\n                showNotification('Profile saved! Ready to ride ', 'success');\n                announce('Onboarding complete. Profile saved.');\n                resolve(profile);\n            }\n        };\n\n        const goPrev = (): void => {\n            saveCurrentInput();\n            if (currentStep > 0) {\n                currentStep--;\n                render();\n            }\n        };\n\n        const skip = (): void => {\n            profile.onboardingComplete = true;\n            saveUserProfile(profile);\n            modal!.style.display = 'none';\n            announce('Onboarding skipped');\n            resolve(profile);\n        };\n\n        // Event listeners\n        nextBtn.addEventListener('click', goNext);\n        prevBtn.addEventListener('click', goPrev);\n        skipBtn.addEventListener('click', skip);\n\n        // Enter key advances\n        inputField.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                goNext();\n            }\n        });\n\n        // Show modal\n        modal.style.display = 'flex';\n        render();\n        trapFocus(modal.querySelector('.stream-modal-content')!);\n    });\n}\n\n/**\n * Check if user should see onboarding\n */\nexport function shouldShowOnboarding(): boolean {\n    const profile = loadUserProfile();\n    return !profile.onboardingComplete;\n}\n\n/**\n * Initialize onboarding - shows wizard if first run\n */\nexport function initOnboarding(): void {\n    if (shouldShowOnboarding()) {\n        // Small delay to let the app render first\n        setTimeout(() => {\n            showOnboarding();\n        }, 500);\n    }\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nexport function calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.90) },\n        { name: 'Threshold', min: Math.round(ftp * 0.90), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.20) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.20), max: Math.round(ftp * 1.50) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.50), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nexport function calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.50), max: Math.round(maxHr * 0.60) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.60), max: Math.round(maxHr * 0.70) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.70), max: Math.round(maxHr * 0.80) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.80), max: Math.round(maxHr * 0.90) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.90), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nexport function getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nexport function getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n","/**\n * Application Settings Configuration\n * \n * Manages data structure and persistence only. \n * UI logic is in ui/settings.ts.\n */\n\n/**\n * Auto-pause source metric options\n */\nexport type AutoPauseSource = 'speed' | 'power' | 'cadence';\n\n/**\n * Auto-pause settings\n */\nexport interface AutoPauseSettings {\n    /** Whether auto-pause is enabled */\n    enabled: boolean;\n    /** Which metric to monitor for auto-pause */\n    source: AutoPauseSource;\n    /** Threshold value below which to pause (in source units: km/h, watts, rpm) */\n    threshold: number;\n    /** Delay in seconds before pausing (debounce) */\n    delay: number;\n}\n\n/**\n * Workout metadata settings - controls post-workout prompts\n */\nexport interface WorkoutMetadataSettings {\n    /** Whether to prompt for workout title/notes after completion */\n    promptForNotes: boolean;\n    /** Whether to prompt for perceived exertion (RPE) after completion */\n    promptForExertion: boolean;\n}\n\n/**\n * Countdown settings - controls pre-workout countdown\n */\nexport interface CountdownSettings {\n    /** Countdown duration in seconds (0 = disabled, 3, 5, or 10) */\n    duration: 0 | 3 | 5 | 10;\n    /** Whether to play audio beep during countdown */\n    enableBeep: boolean;\n    /** Whether to use voice announcement during countdown */\n    enableVoice: boolean;\n}\n\n/**\n * Auto-lap trigger source\n */\nexport type AutoLapSource = 'distance' | 'time';\n\n/**\n * Auto-lap settings\n */\nexport interface AutoLapSettings {\n    /** Whether auto-lap is enabled */\n    enabled: boolean;\n    /** What triggers auto-lap */\n    source: AutoLapSource;\n    /** Distance interval in km (for distance-based auto-lap) */\n    distanceKm: number;\n    /** Time interval in minutes (for time-based auto-lap) */\n    timeMinutes: number;\n}\n\n/**\n * Metrics to include in voice announcements\n */\nexport interface VoiceAnnouncementMetrics {\n    /** Announce current power */\n    power: boolean;\n    /** Announce heart rate */\n    heartrate: boolean;\n    /** Announce cadence */\n    cadence: boolean;\n    /** Announce current speed */\n    speed: boolean;\n    /** Announce total distance */\n    distance: boolean;\n    /** Announce elapsed time */\n    time: boolean;\n}\n\n/**\n * Enhanced voice announcement settings\n */\nexport interface EnhancedVoiceSettings {\n    /** Time-based announcement interval in minutes (0 = disabled) */\n    timeIntervalMinutes: 0 | 1 | 5 | 10 | 15 | 30;\n    /** Distance-based announcement interval in km (0 = disabled) */\n    distanceIntervalKm: 0 | 1 | 5 | 10;\n    /** Which metrics to announce */\n    metrics: VoiceAnnouncementMetrics;\n    /** Speech rate (0.5 = slow, 1 = normal, 1.5 = fast, 2 = very fast) */\n    speechRate: 0.5 | 0.75 | 1 | 1.25 | 1.5 | 2;\n}\n\n/**\n * Intervals.icu integration settings\n */\nexport interface IntervalsSettings {\n    /** Whether integration is enabled */\n    enabled: boolean;\n    /** API Key (get from intervals.icu settings) */\n    apiKey: string;\n    /** Athlete ID (use 'i' for self) */\n    athleteId: string;\n    /** Whether to upload automatically after workout */\n    autoUpload: boolean;\n}\n\n/**\n * Application settings\n */\nexport interface AppSettings {\n    // Dashboard display settings\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    speed: boolean;\n    distance: boolean;\n    altitude: boolean;\n    treadmillSpeed: boolean;\n    power3s: boolean;\n\n    // Accessibility settings\n    highContrast: boolean;\n    colorblindPatterns: boolean;\n\n    // Voice Feedback settings\n    voiceEnabled: boolean;\n    voiceLaps: boolean;\n    voiceZones: boolean;\n\n    // Export format settings\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n\n    // Auto-pause settings\n    autoPause: AutoPauseSettings;\n\n    // Workout metadata settings\n    workoutMetadata: WorkoutMetadataSettings;\n\n    // Countdown settings\n    countdown: CountdownSettings;\n\n    // Auto-lap settings\n    autoLap: AutoLapSettings;\n\n    // Enhanced voice announcement settings\n    enhancedVoice: EnhancedVoiceSettings;\n\n    // Intervals.icu integration settings\n    intervals: IntervalsSettings;\n\n    // Calorie estimation settings\n    weightKg: number;\n    showCalories: boolean;\n\n    // Debug settings\n    debugMode: boolean;\n}\n\n/** Storage key for settings */\nexport const SETTINGS_KEY = 'bpt-settings';\n\n/** Default auto-pause settings */\nexport const defaultAutoPauseSettings: AutoPauseSettings = {\n    enabled: false,\n    source: 'speed',\n    threshold: 3, // 3 km/h default\n    delay: 3, // 3 seconds delay before pausing\n};\n\n/** Default workout metadata settings */\nexport const defaultWorkoutMetadataSettings: WorkoutMetadataSettings = {\n    promptForNotes: true,\n    promptForExertion: true,\n};\n\n/** Default countdown settings */\nexport const defaultCountdownSettings: CountdownSettings = {\n    duration: 0, // Disabled by default\n    enableBeep: true,\n    enableVoice: false,\n};\n\n/** Default auto-lap settings */\nexport const defaultAutoLapSettings: AutoLapSettings = {\n    enabled: false,\n    source: 'distance',\n    distanceKm: 1, // 1 km default\n    timeMinutes: 5, // 5 minutes default\n};\n\n/** Default voice announcement metrics */\nexport const defaultVoiceMetrics: VoiceAnnouncementMetrics = {\n    power: true,\n    heartrate: true,\n    cadence: false,\n    speed: true,\n    distance: true,\n    time: true,\n};\n\n/** Default enhanced voice settings */\nexport const defaultEnhancedVoiceSettings: EnhancedVoiceSettings = {\n    timeIntervalMinutes: 0, // Disabled by default\n    distanceIntervalKm: 0, // Disabled by default\n    metrics: { ...defaultVoiceMetrics },\n    speechRate: 1,\n};\n\n/** Default Intervals.icu settings */\nexport const defaultIntervalsSettings: IntervalsSettings = {\n    enabled: false,\n    apiKey: '',\n    athleteId: 'i',\n    autoUpload: false,\n};\n\n/** Default settings */\nexport const defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    speed: true,\n    distance: true,\n    altitude: true,\n    treadmillSpeed: false,\n    power3s: false,\n    highContrast: false,\n    colorblindPatterns: false,\n    voiceEnabled: false,\n    voiceLaps: true,\n    voiceZones: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n    autoPause: { ...defaultAutoPauseSettings },\n    workoutMetadata: { ...defaultWorkoutMetadataSettings },\n    countdown: { ...defaultCountdownSettings },\n    autoLap: { ...defaultAutoLapSettings },\n    enhancedVoice: { ...defaultEnhancedVoiceSettings },\n    intervals: { ...defaultIntervalsSettings },\n    weightKg: 75,\n    showCalories: false,\n    debugMode: false,\n};\n\n/**\n * Get current settings from localStorage\n */\nexport function getSettings(): AppSettings {\n    const settingsJson = localStorage.getItem(SETTINGS_KEY);\n    if (settingsJson) {\n        const parsed = JSON.parse(settingsJson);\n        // Ensure all nested settings have all required fields (migration for existing users)\n        return {\n            ...defaultSettings,\n            ...parsed,\n            autoPause: {\n                ...defaultAutoPauseSettings,\n                ...(parsed.autoPause || {}),\n            },\n            workoutMetadata: {\n                ...defaultWorkoutMetadataSettings,\n                ...(parsed.workoutMetadata || {}),\n            },\n            countdown: {\n                ...defaultCountdownSettings,\n                ...(parsed.countdown || {}),\n            },\n            autoLap: {\n                ...defaultAutoLapSettings,\n                ...(parsed.autoLap || {}),\n            },\n            enhancedVoice: {\n                ...defaultEnhancedVoiceSettings,\n                ...(parsed.enhancedVoice || {}),\n                metrics: {\n                    ...defaultVoiceMetrics,\n                    ...(parsed.enhancedVoice?.metrics || {}),\n                },\n            },\n            intervals: {\n                ...defaultIntervalsSettings,\n                ...(parsed.intervals || {}),\n            },\n            weightKg: parsed.weightKg ?? 75,\n            showCalories: parsed.showCalories ?? false,\n        };\n    }\n    return { ...defaultSettings };\n}\n\n/**\n * Save settings to localStorage\n */\nexport function saveSettingsToStorage(settings: AppSettings): void {\n    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n    // Dispatch event so UI can react if needed (though UI usually initiates the save)\n    window.dispatchEvent(new CustomEvent('settings-changed'));\n}\n","/**\n * Bluetooth Debug Service\n * \n * Handles capturing, storing, and exporting raw Bluetooth sensor data\n * for debugging purposes.\n */\n\nimport { saveDebugLog, getDebugLogs, clearDebugLogs } from '../../storage/workoutStorage.js';\nimport { getSettings } from '../../config/settings.js';\n\ntype DebugListener = (sensor: string, hex: string) => void;\n\n/**\n * Service for logging raw Bluetooth data\n */\nexport const BluetoothDebugService = {\n    listeners: new Set<DebugListener>(),\n\n    /**\n     * Check if debug mode is enabled\n     */\n    isEnabled(): boolean {\n        // Try to avoid excessive localStorage reads by checking if we are in a tight loop\n        // But getSettings parses JSON, so maybe we should cache this?\n        // for now, let's just read it.\n        const settings = getSettings();\n        return !!settings.debugMode;\n    },\n\n    /**\n     * Log a raw data packet\n     * @param sensor - The sensor type identifier\n     * @param data - The raw DataView from the Bluetooth characteristic\n     */\n    async log(sensor: string, data: DataView): Promise<void> {\n        // Always notify listeners, even if storage logging is disabled?\n        // Let's assume yes for the debug page to work without persisting.\n        const hex = this.bufferToHex(data.buffer);\n\n        this.listeners.forEach(listener => listener(sensor, hex));\n\n        if (!this.isEnabled()) return;\n\n        try {\n            await saveDebugLog(sensor, hex);\n        } catch (e) {\n            console.warn('Failed to log debug data', e);\n        }\n    },\n\n    /**\n     * Add a listener for real-time debug data\n     */\n    addListener(listener: DebugListener): void {\n        this.listeners.add(listener);\n    },\n\n    /**\n     * Remove a listener\n     */\n    removeListener(listener: DebugListener): void {\n        this.listeners.delete(listener);\n    },\n\n    /**\n     * Convert ArrayBuffer to Hex string\n     */\n    bufferToHex(buffer: ArrayBufferLike): string {\n        return [...new Uint8Array(buffer)]\n            .map(b => b.toString(16).padStart(2, '0'))\n            .join('')\n            .toUpperCase();\n    },\n\n    /**\n     * Export all logs as a JSON file\n     */\n    async exportLogs(): Promise<void> {\n        const logs = await getDebugLogs();\n        const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `bpt-debug-logs-${Date.now()}.json`;\n        document.body.appendChild(a);\n        a.click();\n\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    },\n\n    /**\n     * Clear all debug logs\n     */\n    async clearLogs(): Promise<void> {\n        await clearDebugLogs();\n    },\n\n    /**\n     * Get count of stored logs\n     */\n    async getLogCount(): Promise<number> {\n        const logs = await getDebugLogs();\n        return logs.length;\n    }\n};\n","/**\n * PWA Install Prompt\n * \n * Handles the PWA installation prompt for supported browsers.\n * \n * @module installPrompt\n */\n\n/**\n * Deferred install prompt event\n */\nlet deferredPrompt: BeforeInstallPromptEvent | null = null;\n\n/**\n * Extended event interface for beforeinstallprompt\n */\ninterface BeforeInstallPromptEvent extends Event {\n    prompt(): Promise<void>;\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\n/**\n * Initialize the PWA install prompt handler.\n * \n * Listens for the beforeinstallprompt event and captures it for later use.\n */\nexport const initInstallPrompt = (): void => {\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    // Listen for the beforeinstallprompt event\n    window.addEventListener('beforeinstallprompt', (e: Event) => {\n        // Prevent the mini-infobar from appearing on mobile\n        e.preventDefault();\n\n        // Stash the event so it can be triggered later\n        deferredPrompt = e as BeforeInstallPromptEvent;\n\n        // Update install button visibility in settings\n        updateInstallButtonVisibility();\n    });\n\n    // Listen for the app installed event\n    window.addEventListener('appinstalled', () => {\n        console.log('PWA was installed successfully');\n        deferredPrompt = null;\n        updateInstallButtonVisibility();\n    });\n};\n\n/**\n * Check if the app can be installed.\n * @returns true if install is available\n */\nexport const canInstallPwa = (): boolean => {\n    return deferredPrompt !== null;\n};\n\n/**\n * Trigger the PWA install prompt.\n * @returns Promise that resolves to the user's choice outcome\n */\nexport const triggerInstallPrompt = async (): Promise<'accepted' | 'dismissed' | 'unavailable'> => {\n    if (!deferredPrompt) {\n        return 'unavailable';\n    }\n\n    try {\n        // Show the install prompt\n        await deferredPrompt.prompt();\n\n        // Wait for the user to respond to the prompt\n        const { outcome } = await deferredPrompt.userChoice;\n        console.log(`User response to the install prompt: ${outcome}`);\n\n        // Clear the deferredPrompt\n        deferredPrompt = null;\n        updateInstallButtonVisibility();\n\n        return outcome;\n    } catch (error) {\n        console.error('Error triggering install prompt:', error);\n        return 'unavailable';\n    }\n};\n\n/**\n * Update the visibility of install buttons based on availability.\n */\nconst updateInstallButtonVisibility = (): void => {\n    const installButton = document.getElementById('installPwaButton');\n    const installButtonContainer = document.getElementById('installPwaContainer');\n\n    if (installButton) {\n        installButton.style.display = canInstallPwa() ? 'block' : 'none';\n    }\n\n    if (installButtonContainer) {\n        installButtonContainer.style.display = canInstallPwa() ? 'block' : 'none';\n    }\n};\n","/**\n * Auto-Pause Service\n * \n * Automatically pauses workout recording when the monitored metric\n * (speed, power, or cadence) drops below a configurable threshold.\n * Automatically resumes when the metric exceeds the threshold.\n * \n * @module AutoPauseService\n */\n\nimport { getSettings, type AutoPauseSource } from '../config/settings.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Callbacks for auto-pause/resume actions\n */\nexport interface AutoPauseCallbacks {\n    /** Called when auto-pause triggers */\n    onAutoPause: () => void;\n    /** Called when auto-resume triggers */\n    onAutoResume: () => void;\n}\n\n/**\n * Auto-pause state\n */\ninterface AutoPauseState {\n    /** Whether currently auto-paused */\n    isAutoPaused: boolean;\n    /** Timestamp when metric dropped below threshold */\n    belowThresholdSince: number | null;\n    /** Timer ID for delayed pause */\n    delayTimer: ReturnType<typeof setTimeout> | null;\n}\n\n/**\n * Service that monitors metrics and auto-pauses/resumes workouts\n */\nexport class AutoPauseService {\n    private measurementsState: MeasurementsState;\n    private timeState: TimeState;\n    private callbacks: AutoPauseCallbacks;\n    private state: AutoPauseState;\n    private changeCallback: (() => void) | null = null;\n\n    constructor(\n        measurementsState: MeasurementsState,\n        timeState: TimeState,\n        callbacks: AutoPauseCallbacks\n    ) {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n        this.callbacks = callbacks;\n        this.state = {\n            isAutoPaused: false,\n            belowThresholdSince: null,\n            delayTimer: null,\n        };\n    }\n\n    /**\n     * Start monitoring for auto-pause\n     */\n    start(): void {\n        this.stop(); // Clean up any existing subscription\n\n        const settings = getSettings();\n        if (!settings.autoPause.enabled) {\n            console.log('[AutoPause] Disabled, not starting');\n            return;\n        }\n\n        console.log('[AutoPause] Starting with settings:', settings.autoPause);\n\n        // Subscribe to measurement changes\n        this.changeCallback = () => this.checkMetric();\n        this.measurementsState.onChange(this.changeCallback);\n\n        // Also check periodically in case no measurements come in\n        this.startPeriodicCheck();\n    }\n\n    /**\n     * Stop monitoring\n     */\n    stop(): void {\n        if (this.changeCallback) {\n            this.measurementsState.offChange(this.changeCallback);\n            this.changeCallback = null;\n        }\n        this.clearDelayTimer();\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n        this.state = {\n            isAutoPaused: false,\n            belowThresholdSince: null,\n            delayTimer: null,\n        };\n        console.log('[AutoPause] Stopped');\n    }\n\n    /**\n     * Check if we're currently auto-paused\n     */\n    get isAutoPaused(): boolean {\n        return this.state.isAutoPaused;\n    }\n\n    /**\n     * Get the current metric value based on source setting\n     */\n    private getCurrentValue(source: AutoPauseSource): number | null {\n        const now = Date.now();\n        const lookbackMs = 5000; // Look at last 5 seconds of data\n        const minTimestamp = now - lookbackMs;\n\n        let measurements: { timestamp: number; value: number }[];\n        switch (source) {\n            case 'speed':\n                measurements = this.measurementsState.speed;\n                break;\n            case 'power':\n                measurements = this.measurementsState.power;\n                break;\n            case 'cadence':\n                measurements = this.measurementsState.cadence;\n                break;\n            default:\n                return null;\n        }\n\n        // Get recent measurements\n        const recentMeasurements = measurements.filter(m => m.timestamp >= minTimestamp);\n\n        if (recentMeasurements.length === 0) {\n            return null; // No recent data\n        }\n\n        // Use the most recent value\n        const latest = recentMeasurements[recentMeasurements.length - 1];\n        return latest.value;\n    }\n\n    /**\n     * Check the metric and trigger pause/resume if needed\n     */\n    private checkMetric(): void {\n        const settings = getSettings();\n        if (!settings.autoPause.enabled) {\n            return;\n        }\n\n        // Only check when workout is in a valid state\n        if (!this.timeState.startTime) {\n            return; // Workout not started\n        }\n\n        const { source, threshold, delay } = settings.autoPause;\n        const currentValue = this.getCurrentValue(source);\n\n        // Handle case where no data is available\n        if (currentValue === null) {\n            // If we haven't received any data yet, don't auto-pause\n            // This prevents pausing immediately when starting a workout\n            return;\n        }\n\n        const isAboveThreshold = currentValue >= threshold;\n        const now = Date.now();\n\n        if (isAboveThreshold) {\n            // Metric is above threshold\n            this.clearDelayTimer();\n            this.state.belowThresholdSince = null;\n\n            if (this.state.isAutoPaused && !this.timeState.running) {\n                // Resume the workout\n                console.log(`[AutoPause] Resuming - ${source} at ${currentValue.toFixed(1)} (threshold: ${threshold})`);\n                this.state.isAutoPaused = false;\n                this.callbacks.onAutoResume();\n            }\n        } else {\n            // Metric is below threshold\n            if (!this.state.belowThresholdSince) {\n                this.state.belowThresholdSince = now;\n            }\n\n            const timeBelow = now - this.state.belowThresholdSince;\n            const delayMs = delay * 1000;\n\n            if (!this.state.isAutoPaused && this.timeState.running && timeBelow >= delayMs) {\n                // Pause the workout\n                console.log(`[AutoPause] Pausing - ${source} at ${currentValue.toFixed(1)} (threshold: ${threshold}) for ${(timeBelow / 1000).toFixed(1)}s`);\n                this.state.isAutoPaused = true;\n                this.callbacks.onAutoPause();\n            }\n        }\n    }\n\n    /**\n     * Clear the delay timer\n     */\n    private clearDelayTimer(): void {\n        if (this.state.delayTimer) {\n            clearTimeout(this.state.delayTimer);\n            this.state.delayTimer = null;\n        }\n    }\n\n    /**\n     * Start periodic check (in case no new measurements come in)\n     */\n    private intervalId: ReturnType<typeof setInterval> | null = null;\n\n    private startPeriodicCheck(): void {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n        }\n        // Check every second\n        this.intervalId = setInterval(() => {\n            this.checkMetric();\n        }, 1000);\n    }\n\n    /**\n     * Reset the auto-pause state (call when workout is reset)\n     */\n    reset(): void {\n        this.stop();\n        this.state = {\n            isAutoPaused: false,\n            belowThresholdSince: null,\n            delayTimer: null,\n        };\n    }\n\n    /**\n     * Get status info for debugging/display\n     */\n    getStatus(): {\n        enabled: boolean;\n        isAutoPaused: boolean;\n        source: AutoPauseSource;\n        threshold: number;\n        currentValue: number | null;\n    } {\n        const settings = getSettings();\n        return {\n            enabled: settings.autoPause.enabled,\n            isAutoPaused: this.state.isAutoPaused,\n            source: settings.autoPause.source,\n            threshold: settings.autoPause.threshold,\n            currentValue: this.getCurrentValue(settings.autoPause.source),\n        };\n    }\n}\n\n/**\n * Get unit label for auto-pause source\n */\nexport function getAutoPauseSourceUnit(source: AutoPauseSource): string {\n    switch (source) {\n        case 'speed':\n            return 'km/h';\n        case 'power':\n            return 'W';\n        case 'cadence':\n            return 'rpm';\n        default:\n            return '';\n    }\n}\n\n/**\n * Get label for auto-pause source\n */\nexport function getAutoPauseSourceLabel(source: AutoPauseSource): string {\n    switch (source) {\n        case 'speed':\n            return 'Speed';\n        case 'power':\n            return 'Power';\n        case 'cadence':\n            return 'Cadence';\n        default:\n            return source;\n    }\n}\n","/**\n * Sport Configuration\n * \n * Defines sport types and their specific settings, metrics, and zones.\n * \n * @module config/sport\n */\n\n/**\n * Supported sport types\n */\nexport type SportType = 'cycling' | 'running' | 'walking';\n\n/**\n * Running-specific measurement\n */\nexport interface RunningMeasurement {\n    timestamp: number;\n    /** Running cadence in steps per minute (spm) */\n    cadence: number | null;\n    /** Stride length in meters */\n    strideLength: number | null;\n    /** Ground contact time in milliseconds */\n    groundContactTime: number | null;\n}\n\n/**\n * Sport-specific settings\n */\nexport interface SportSettings {\n    /** Current active sport */\n    activeSport: SportType;\n    /** Running-specific settings */\n    running: {\n        /** Target pace zone (min/km) */\n        targetPaceMin: number;\n        targetPaceMax: number;\n        /** Use running cadence sensor (footpod/watch) */\n        useRunningCadence: boolean;\n        /** Show pace instead of speed */\n        showPace: boolean;\n    };\n    /** Cycling-specific settings (default, kept for completeness) */\n    cycling: {\n        /** Show power metrics */\n        showPower: boolean;\n    };\n}\n\n/**\n * Running pace zones based on threshold pace\n * Uses Jack Daniels' VDOT zones model\n */\nexport interface RunningZone {\n    name: string;\n    /** Min pace in seconds per km */\n    minPaceSecPerKm: number;\n    /** Max pace in seconds per km */\n    maxPaceSecPerKm: number;\n    /** Description */\n    description: string;\n}\n\n/**\n * Calculate running zones based on threshold pace (T pace)\n * @param thresholdPaceSecPerKm Threshold pace in seconds per kilometer\n */\nexport function calculateRunningZones(thresholdPaceSecPerKm: number): RunningZone[] {\n    // Jack Daniels style zones relative to threshold (T) pace\n    // E (Easy) = 59-74% of vVO2max -> ~129-141% of T pace\n    // M (Marathon) = 75-84% -> ~105-111% of T pace\n    // T (Threshold) = 83-88% -> ~100-105% of T pace\n    // I (Interval) = 95-100% -> ~93-98% of T pace\n    // R (Repetition) = 105-120% -> ~85-92% of T pace\n\n    const tPace = thresholdPaceSecPerKm;\n\n    return [\n        {\n            name: 'Recovery',\n            minPaceSecPerKm: Math.round(tPace * 1.41),\n            maxPaceSecPerKm: 9999, // Very slow\n            description: 'Very easy, conversational pace'\n        },\n        {\n            name: 'Easy',\n            minPaceSecPerKm: Math.round(tPace * 1.29),\n            maxPaceSecPerKm: Math.round(tPace * 1.41),\n            description: 'Comfortable aerobic pace'\n        },\n        {\n            name: 'Marathon',\n            minPaceSecPerKm: Math.round(tPace * 1.05),\n            maxPaceSecPerKm: Math.round(tPace * 1.11),\n            description: 'Marathon race pace'\n        },\n        {\n            name: 'Threshold',\n            minPaceSecPerKm: Math.round(tPace * 1.00),\n            maxPaceSecPerKm: Math.round(tPace * 1.05),\n            description: 'Comfortably hard, lactate threshold'\n        },\n        {\n            name: 'Interval',\n            minPaceSecPerKm: Math.round(tPace * 0.93),\n            maxPaceSecPerKm: Math.round(tPace * 0.98),\n            description: 'VO2max training pace'\n        },\n        {\n            name: 'Repetition',\n            minPaceSecPerKm: 0,\n            maxPaceSecPerKm: Math.round(tPace * 0.92),\n            description: 'Speed/form work'\n        }\n    ];\n}\n\n/**\n * Default sport settings\n */\nexport const defaultSportSettings: SportSettings = {\n    activeSport: 'cycling',\n    running: {\n        targetPaceMin: 300, // 5:00 min/km\n        targetPaceMax: 360, // 6:00 min/km\n        useRunningCadence: true,\n        showPace: true\n    },\n    cycling: {\n        showPower: true\n    }\n};\n\n/** Storage key */\nconst SPORT_SETTINGS_KEY = 'bpt-sport-settings';\n\n/**\n * Get sport settings from localStorage\n */\nexport function getSportSettings(): SportSettings {\n    try {\n        const stored = localStorage.getItem(SPORT_SETTINGS_KEY);\n        if (stored) {\n            return { ...defaultSportSettings, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load sport settings:', e);\n    }\n    return { ...defaultSportSettings };\n}\n\n/**\n * Save sport settings to localStorage\n */\nexport function saveSportSettings(settings: SportSettings): void {\n    localStorage.setItem(SPORT_SETTINGS_KEY, JSON.stringify(settings));\n    window.dispatchEvent(new CustomEvent('sport-settings-changed', { detail: settings }));\n}\n\n/**\n * Get active sport\n */\nexport function getActiveSport(): SportType {\n    return getSportSettings().activeSport;\n}\n\n/**\n * Set active sport\n */\nexport function setActiveSport(sport: SportType): void {\n    const settings = getSportSettings();\n    settings.activeSport = sport;\n    saveSportSettings(settings);\n}\n\n/**\n * Convert speed (m/s) to pace (seconds per km)\n */\nexport function speedToPace(speedMs: number): number {\n    if (speedMs <= 0) return 9999;\n    return Math.round(1000 / speedMs);\n}\n\n/**\n * Convert pace (seconds per km) to speed (m/s)\n */\nexport function paceToSpeed(paceSecPerKm: number): number {\n    if (paceSecPerKm <= 0) return 0;\n    return 1000 / paceSecPerKm;\n}\n\n/**\n * Format pace as MM:SS /km\n */\nexport function formatPace(paceSecPerKm: number): string {\n    if (paceSecPerKm >= 9999 || paceSecPerKm <= 0) return '--:--';\n    const minutes = Math.floor(paceSecPerKm / 60);\n    const seconds = Math.round(paceSecPerKm % 60);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Get sport-specific metric labels\n */\nexport function getSportMetricLabels(sport: SportType): Record<string, string> {\n    if (sport === 'running' || sport === 'walking') {\n        return {\n            speed: 'Pace',\n            cadence: 'Cadence (spm)',\n            power: 'Power',\n            heartrate: 'Heart Rate',\n            distance: 'Distance',\n            altitude: 'Elevation'\n        };\n    }\n    // Cycling (default)\n    return {\n        speed: 'Speed',\n        cadence: 'Cadence (rpm)',\n        power: 'Power',\n        heartrate: 'Heart Rate',\n        distance: 'Distance',\n        altitude: 'Elevation'\n    };\n}\n\n/**\n * Get sport icon emoji\n */\nexport function getSportIcon(sport: SportType): string {\n    switch (sport) {\n        case 'running': return '';\n        case 'walking': return '';\n        case 'cycling':\n        default: return '';\n    }\n}\n","/**\n * Settings Modal\n * \n * Manages application settings stored in localStorage.\n * \n * @module settings\n */\n\nimport { loadUserProfile, saveUserProfile } from './onboarding.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { getSettings, saveSettingsToStorage, defaultSettings, defaultAutoPauseSettings, defaultWorkoutMetadataSettings, defaultCountdownSettings, defaultAutoLapSettings, defaultEnhancedVoiceSettings, defaultVoiceMetrics, defaultIntervalsSettings } from '../config/settings.js';\nimport type { AppSettings, AutoPauseSource, AutoLapSource } from '../config/settings.js';\nimport { triggerInstallPrompt } from './installPrompt.js';\nimport { getAutoPauseSourceUnit } from '../services/AutoPauseService.js';\nimport { getSportSettings, saveSportSettings, formatPace } from '../config/sport.js';\nimport type { SportType } from '../config/sport.js';\n\n// Re-export for compatibility if needed (but prefer importing from config)\nexport { getSettings };\n\n\n/**\n * Initialize the Settings UI logic\n */\nexport function initSettingsLogic(): void {\n    const saveSettingsButton = document.getElementById('saveSettings');\n\n    // User Profile settings\n    const settingFtp = document.getElementById('settingFtp') as HTMLInputElement | null;\n    const settingMaxHr = document.getElementById('settingMaxHr') as HTMLInputElement | null;\n    const settingWeight = document.getElementById('settingWeight') as HTMLInputElement | null;\n\n    // Dashboard display settings\n    const settingSpeed = document.getElementById('settingSpeed') as HTMLInputElement | null;\n    const settingDistance = document.getElementById('settingDistance') as HTMLInputElement | null;\n    const settingAltitude = document.getElementById('settingAltitude') as HTMLInputElement | null;\n    const settingShowCalories = document.getElementById('settingShowCalories') as HTMLInputElement | null;\n    const settingPower = document.getElementById('settingPower') as HTMLInputElement | null;\n    const settingCadence = document.getElementById('settingCadence') as HTMLInputElement | null;\n    const settingHeartrate = document.getElementById('settingHeartrate') as HTMLInputElement | null;\n    const settingTreadmillSpeed = document.getElementById('settingTreadmillSpeed') as HTMLInputElement | null;\n    const settingPower3s = document.getElementById('settingPower3s') as HTMLInputElement | null;\n\n    // Accessibility settings\n    const settingHighContrast = document.getElementById('settingHighContrast') as HTMLInputElement | null;\n    const settingColorblindPatterns = document.getElementById('settingColorblindPatterns') as HTMLInputElement | null;\n\n    // Voice Feedback settings\n    const settingVoiceEnabled = document.getElementById('settingVoiceEnabled') as HTMLInputElement | null;\n    const settingVoiceLaps = document.getElementById('settingVoiceLaps') as HTMLInputElement | null;\n    const settingVoiceZones = document.getElementById('settingVoiceZones') as HTMLInputElement | null;\n\n    // Auto-Pause settings\n    const settingAutoPauseEnabled = document.getElementById('settingAutoPauseEnabled') as HTMLInputElement | null;\n    const settingAutoPauseSource = document.getElementById('settingAutoPauseSource') as HTMLSelectElement | null;\n    const settingAutoPauseThreshold = document.getElementById('settingAutoPauseThreshold') as HTMLInputElement | null;\n    const settingAutoPauseDelay = document.getElementById('settingAutoPauseDelay') as HTMLInputElement | null;\n    const autoPauseOptions = document.getElementById('autoPauseOptions');\n    const autoPauseThresholdUnit = document.getElementById('autoPauseThresholdUnit');\n\n    // Export format settings\n    const settingExportTcx = document.getElementById('settingExportTcx') as HTMLInputElement | null;\n    const settingExportCsv = document.getElementById('settingExportCsv') as HTMLInputElement | null;\n    const settingExportJson = document.getElementById('settingExportJson') as HTMLInputElement | null;\n    const settingExportFit = document.getElementById('settingExportFit') as HTMLInputElement | null;\n\n    // Workout metadata settings\n    const settingPromptForNotes = document.getElementById('settingPromptForNotes') as HTMLInputElement | null;\n    const settingPromptForExertion = document.getElementById('settingPromptForExertion') as HTMLInputElement | null;\n\n    // Countdown settings\n    const settingCountdownDuration = document.getElementById('settingCountdownDuration') as HTMLSelectElement | null;\n    const settingCountdownBeep = document.getElementById('settingCountdownBeep') as HTMLInputElement | null;\n    const settingCountdownVoice = document.getElementById('settingCountdownVoice') as HTMLInputElement | null;\n\n    // Auto-Lap settings\n    const settingAutoLapEnabled = document.getElementById('settingAutoLapEnabled') as HTMLInputElement | null;\n    const settingAutoLapSource = document.getElementById('settingAutoLapSource') as HTMLSelectElement | null;\n    const settingAutoLapDistance = document.getElementById('settingAutoLapDistance') as HTMLSelectElement | null;\n    const settingAutoLapTime = document.getElementById('settingAutoLapTime') as HTMLSelectElement | null;\n    const autoLapOptions = document.getElementById('autoLapOptions');\n    const autoLapDistanceOption = document.getElementById('autoLapDistanceOption');\n    const autoLapTimeOption = document.getElementById('autoLapTimeOption');\n\n    // Enhanced Voice settings\n    const settingVoiceTimeInterval = document.getElementById('settingVoiceTimeInterval') as HTMLSelectElement | null;\n    const settingVoiceDistanceInterval = document.getElementById('settingVoiceDistanceInterval') as HTMLSelectElement | null;\n    const settingVoiceSpeechRate = document.getElementById('settingVoiceSpeechRate') as HTMLSelectElement | null;\n    const settingVoiceMetricPower = document.getElementById('settingVoiceMetricPower') as HTMLInputElement | null;\n    const settingVoiceMetricHeartrate = document.getElementById('settingVoiceMetricHeartrate') as HTMLInputElement | null;\n    const settingVoiceMetricCadence = document.getElementById('settingVoiceMetricCadence') as HTMLInputElement | null;\n    const settingVoiceMetricSpeed = document.getElementById('settingVoiceMetricSpeed') as HTMLInputElement | null;\n    const settingVoiceMetricDistance = document.getElementById('settingVoiceMetricDistance') as HTMLInputElement | null;\n    const settingVoiceMetricTime = document.getElementById('settingVoiceMetricTime') as HTMLInputElement | null;\n\n    // Sport Type settings\n    const settingSportType = document.getElementById('settingSportType') as HTMLSelectElement | null;\n    const settingShowPace = document.getElementById('settingShowPace') as HTMLInputElement | null;\n    const settingThresholdPace = document.getElementById('settingThresholdPace') as HTMLInputElement | null;\n    const runningOptions = document.getElementById('runningOptions');\n\n    // Intervals.icu settings\n    const settingIntervalsEnabled = document.getElementById('settingIntervalsEnabled') as HTMLInputElement | null;\n    const settingIntervalsApiKey = document.getElementById('settingIntervalsApiKey') as HTMLInputElement | null;\n    const toggleIntervalsApiKey = document.getElementById('toggleIntervalsApiKey') as HTMLButtonElement | null;\n    const settingIntervalsAthleteId = document.getElementById('settingIntervalsAthleteId') as HTMLInputElement | null;\n    const settingIntervalsAutoUpload = document.getElementById('settingIntervalsAutoUpload') as HTMLInputElement | null;\n    const intervalsOptions = document.getElementById('intervalsOptions');\n\n    // Debug settings\n    const settingDebugMode = document.getElementById('settingDebugMode') as HTMLInputElement | null;\n    const debugControls = document.getElementById('debugControls');\n    const downloadDebugLogs = document.getElementById('downloadDebugLogs');\n    const clearDebugLogs = document.getElementById('clearDebugLogs');\n\n    // PWA Install button\n    const installPwaButton = document.getElementById('installPwaButton');\n\n    /**\n     * Update Intervals UI visibility\n     */\n    const updateIntervalsUI = (): void => {\n        if (intervalsOptions && settingIntervalsEnabled) {\n            intervalsOptions.style.display = settingIntervalsEnabled.checked ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Update sport type UI visibility (show running options when running/walking selected)\n     */\n    const updateSportUI = (): void => {\n        if (runningOptions && settingSportType) {\n            const isRunning = settingSportType.value === 'running' || settingSportType.value === 'walking';\n            runningOptions.style.display = isRunning ? 'block' : 'none';\n        }\n    };\n\n    /**\n     * Parse pace string (MM:SS) to seconds per km\n     */\n    const parsePace = (paceStr: string): number | null => {\n        const match = paceStr.match(/^(\\d{1,2}):([0-5]\\d)$/);\n        if (!match) return null;\n        const minutes = parseInt(match[1], 10);\n        const seconds = parseInt(match[2], 10);\n        return minutes * 60 + seconds;\n    };\n\n    /**\n     * Save sport settings\n     */\n    const saveSportSettingsFromUI = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            sportSettings.activeSport = settingSportType.value as SportType;\n        }\n        if (settingShowPace !== null) {\n            sportSettings.running.showPace = settingShowPace.checked;\n        }\n        if (settingThresholdPace?.value) {\n            const paceSeconds = parsePace(settingThresholdPace.value);\n            if (paceSeconds !== null) {\n                // Store threshold pace as target pace range (30 sec)\n                sportSettings.running.targetPaceMin = paceSeconds - 30;\n                sportSettings.running.targetPaceMax = paceSeconds + 30;\n            }\n        }\n\n        saveSportSettings(sportSettings);\n    };\n\n    /**\n     * Load sport settings into UI\n     */\n    const loadSportSettings = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            settingSportType.value = sportSettings.activeSport;\n        }\n        if (settingShowPace) {\n            settingShowPace.checked = sportSettings.running.showPace;\n        }\n        if (settingThresholdPace) {\n            // Calculate threshold pace from target pace (middle of range)\n            const thresholdPace = Math.round((sportSettings.running.targetPaceMin + sportSettings.running.targetPaceMax) / 2);\n            settingThresholdPace.value = formatPace(thresholdPace);\n        }\n\n        updateSportUI();\n    };\n\n    // Sport type change listener\n    settingSportType?.addEventListener('change', updateSportUI);\n\n    /**\n     * Toggle API Key visibility\n     */\n    toggleIntervalsApiKey?.addEventListener('click', () => {\n        if (settingIntervalsApiKey) {\n            const isPassword = settingIntervalsApiKey.type === 'password';\n            settingIntervalsApiKey.type = isPassword ? 'text' : 'password';\n            if (toggleIntervalsApiKey) {\n                toggleIntervalsApiKey.textContent = isPassword ? '' : '';\n            }\n        }\n    });\n\n    settingIntervalsEnabled?.addEventListener('change', updateIntervalsUI);\n\n    /**\n     * Update auto-pause options visibility and unit label\n     */\n    const updateAutoPauseUI = (): void => {\n        if (autoPauseOptions && settingAutoPauseEnabled) {\n            autoPauseOptions.style.opacity = settingAutoPauseEnabled.checked ? '1' : '0.5';\n            autoPauseOptions.style.pointerEvents = settingAutoPauseEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoPauseThresholdUnit && settingAutoPauseSource) {\n            const unit = getAutoPauseSourceUnit(settingAutoPauseSource.value as AutoPauseSource);\n            autoPauseThresholdUnit.textContent = unit;\n        }\n    };\n\n    // Add event listeners for auto-pause UI updates\n    settingAutoPauseEnabled?.addEventListener('change', updateAutoPauseUI);\n    settingAutoPauseSource?.addEventListener('change', updateAutoPauseUI);\n\n    /**\n     * Update auto-lap options visibility and source options\n     */\n    const updateAutoLapUI = (): void => {\n        if (autoLapOptions && settingAutoLapEnabled) {\n            autoLapOptions.style.opacity = settingAutoLapEnabled.checked ? '1' : '0.5';\n            autoLapOptions.style.pointerEvents = settingAutoLapEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoLapDistanceOption && autoLapTimeOption && settingAutoLapSource) {\n            const isDistance = settingAutoLapSource.value === 'distance';\n            autoLapDistanceOption.style.display = isDistance ? 'flex' : 'none';\n            autoLapTimeOption.style.display = isDistance ? 'none' : 'flex';\n        }\n    };\n\n    // Add event listeners for auto-lap UI updates\n    settingAutoLapEnabled?.addEventListener('change', updateAutoLapUI);\n    settingAutoLapSource?.addEventListener('change', updateAutoLapUI);\n\n    /**\n     * Apply settings to the UI\n     */\n    const applySettings = (settings: AppSettings): void => {\n        // Toggle metric visibility\n        const toggleMetric = (metric: string, isVisible: boolean): void => {\n            const elements = document.querySelectorAll(`.metric-group-${metric}`);\n            elements.forEach((el) => {\n                (el as HTMLElement).style.display = isVisible ? 'flex' : 'none';\n            });\n        };\n\n        toggleMetric('speed', settings.speed);\n        toggleMetric('distance', settings.distance);\n        toggleMetric('altitude', settings.altitude);\n        toggleMetric('energy', settings.showCalories);\n        toggleMetric('power', settings.power);\n        toggleMetric('cadence', settings.cadence);\n        toggleMetric('heartrate', settings.heartrate);\n        toggleMetric('treadmillSpeed', settings.treadmillSpeed);\n\n        // Apply 3-second average power indicator\n        const powerMetrics = document.querySelectorAll('.metric-group-power');\n        powerMetrics.forEach((el) => {\n            if (settings.power3s) {\n                el.setAttribute('data-show-avg', 'true');\n            } else {\n                el.removeAttribute('data-show-avg');\n            }\n        });\n\n        // Apply high contrast mode\n        if (settings.highContrast) {\n            document.documentElement.setAttribute('data-high-contrast', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-high-contrast');\n        }\n\n        // Apply colorblind patterns (enabled when high contrast + colorblind patterns both on)\n        if (settings.colorblindPatterns) {\n            document.documentElement.setAttribute('data-colorblind-patterns', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-colorblind-patterns');\n        }\n\n        // Apply debug mode UI\n        if (debugControls) {\n            debugControls.style.display = settings.debugMode ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Save settings to localStorage\n     */\n    const saveSettings = (): void => {\n        // Save User Profile\n        const currentProfile = loadUserProfile();\n        const updatedProfile = {\n            ...currentProfile,\n            ftp: settingFtp?.value ? Number(settingFtp.value) : null,\n            maxHr: settingMaxHr?.value ? Number(settingMaxHr.value) : null,\n            weight: settingWeight?.value ? Number(settingWeight.value) : null,\n        };\n        saveUserProfile(updatedProfile);\n        window.dispatchEvent(new CustomEvent('user-profile-changed'));\n\n        const settings: AppSettings = {\n            speed: settingSpeed?.checked ?? defaultSettings.speed,\n            distance: settingDistance?.checked ?? defaultSettings.distance,\n            altitude: settingAltitude?.checked ?? defaultSettings.altitude,\n            weightKg: settingWeight?.value ? Number(settingWeight.value) : defaultSettings.weightKg,\n            showCalories: settingShowCalories?.checked ?? defaultSettings.showCalories,\n            power: settingPower?.checked ?? defaultSettings.power,\n            cadence: settingCadence?.checked ?? defaultSettings.cadence,\n            heartrate: settingHeartrate?.checked ?? defaultSettings.heartrate,\n            treadmillSpeed: settingTreadmillSpeed?.checked ?? defaultSettings.treadmillSpeed,\n            power3s: settingPower3s?.checked ?? defaultSettings.power3s,\n            highContrast: settingHighContrast?.checked ?? defaultSettings.highContrast,\n            colorblindPatterns: settingColorblindPatterns?.checked ?? defaultSettings.colorblindPatterns,\n            voiceEnabled: settingVoiceEnabled?.checked ?? defaultSettings.voiceEnabled,\n            voiceLaps: settingVoiceLaps?.checked ?? defaultSettings.voiceLaps,\n            voiceZones: settingVoiceZones?.checked ?? defaultSettings.voiceZones,\n            autoPause: {\n                enabled: settingAutoPauseEnabled?.checked ?? defaultAutoPauseSettings.enabled,\n                source: (settingAutoPauseSource?.value as AutoPauseSource) ?? defaultAutoPauseSettings.source,\n                threshold: settingAutoPauseThreshold?.value ? Number(settingAutoPauseThreshold.value) : defaultAutoPauseSettings.threshold,\n                delay: settingAutoPauseDelay?.value ? Number(settingAutoPauseDelay.value) : defaultAutoPauseSettings.delay,\n            },\n            workoutMetadata: {\n                promptForNotes: settingPromptForNotes?.checked ?? defaultWorkoutMetadataSettings.promptForNotes,\n                promptForExertion: settingPromptForExertion?.checked ?? defaultWorkoutMetadataSettings.promptForExertion,\n            },\n            countdown: {\n                duration: (settingCountdownDuration?.value ? parseInt(settingCountdownDuration.value) : defaultCountdownSettings.duration) as 0 | 3 | 5 | 10,\n                enableBeep: settingCountdownBeep?.checked ?? defaultCountdownSettings.enableBeep,\n                enableVoice: settingCountdownVoice?.checked ?? defaultCountdownSettings.enableVoice,\n            },\n            autoLap: {\n                enabled: settingAutoLapEnabled?.checked ?? defaultAutoLapSettings.enabled,\n                source: (settingAutoLapSource?.value as AutoLapSource) ?? defaultAutoLapSettings.source,\n                distanceKm: settingAutoLapDistance?.value ? Number(settingAutoLapDistance.value) : defaultAutoLapSettings.distanceKm,\n                timeMinutes: settingAutoLapTime?.value ? Number(settingAutoLapTime.value) : defaultAutoLapSettings.timeMinutes,\n            },\n            enhancedVoice: {\n                timeIntervalMinutes: (settingVoiceTimeInterval?.value ? parseInt(settingVoiceTimeInterval.value) : defaultEnhancedVoiceSettings.timeIntervalMinutes) as 0 | 1 | 5 | 10 | 15 | 30,\n                distanceIntervalKm: (settingVoiceDistanceInterval?.value ? parseInt(settingVoiceDistanceInterval.value) : defaultEnhancedVoiceSettings.distanceIntervalKm) as 0 | 1 | 5 | 10,\n                metrics: {\n                    power: settingVoiceMetricPower?.checked ?? defaultVoiceMetrics.power,\n                    heartrate: settingVoiceMetricHeartrate?.checked ?? defaultVoiceMetrics.heartrate,\n                    cadence: settingVoiceMetricCadence?.checked ?? defaultVoiceMetrics.cadence,\n                    speed: settingVoiceMetricSpeed?.checked ?? defaultVoiceMetrics.speed,\n                    distance: settingVoiceMetricDistance?.checked ?? defaultVoiceMetrics.distance,\n                    time: settingVoiceMetricTime?.checked ?? defaultVoiceMetrics.time,\n                },\n                speechRate: (settingVoiceSpeechRate?.value ? parseFloat(settingVoiceSpeechRate.value) : defaultEnhancedVoiceSettings.speechRate) as 0.5 | 0.75 | 1 | 1.25 | 1.5 | 2,\n            },\n            intervals: {\n                enabled: settingIntervalsEnabled?.checked ?? defaultIntervalsSettings.enabled,\n                apiKey: settingIntervalsApiKey?.value ?? defaultIntervalsSettings.apiKey,\n                athleteId: settingIntervalsAthleteId?.value ?? defaultIntervalsSettings.athleteId,\n                autoUpload: settingIntervalsAutoUpload?.checked ?? defaultIntervalsSettings.autoUpload,\n            },\n            exportTcx: settingExportTcx?.checked ?? defaultSettings.exportTcx,\n            exportCsv: settingExportCsv?.checked ?? defaultSettings.exportCsv,\n            exportJson: settingExportJson?.checked ?? defaultSettings.exportJson,\n            exportFit: settingExportFit?.checked ?? defaultSettings.exportFit,\n            debugMode: settingDebugMode?.checked ?? defaultSettings.debugMode,\n        };\n\n        // saveSettingsToStorage dispatches 'settings-changed' internally\n        saveSettingsToStorage(settings);\n\n        // Save sport settings separately\n        saveSportSettingsFromUI();\n\n        applySettings(settings);\n    };\n\n    /**\n     * Load settings from localStorage\n     */\n    const loadSettings = (): void => {\n        const settings = getSettings();\n        const profile = loadUserProfile();\n\n        // User Profile settings\n        if (settingFtp) settingFtp.value = profile.ftp?.toString() ?? '';\n        if (settingMaxHr) settingMaxHr.value = profile.maxHr?.toString() ?? '';\n        if (settingWeight) settingWeight.value = profile.weight?.toString() ?? '';\n\n        // Dashboard display settings\n        if (settingPower) settingPower.checked = settings.power;\n        if (settingCadence) settingCadence.checked = settings.cadence;\n        if (settingHeartrate) settingHeartrate.checked = settings.heartrate;\n        if (settingSpeed) settingSpeed.checked = settings.speed;\n        if (settingDistance) settingDistance.checked = settings.distance;\n        if (settingAltitude) settingAltitude.checked = settings.altitude;\n        if (settingShowCalories) settingShowCalories.checked = settings.showCalories;\n        if (settingTreadmillSpeed) settingTreadmillSpeed.checked = settings.treadmillSpeed;\n        if (settingPower3s) settingPower3s.checked = settings.power3s;\n\n        // Accessibility settings\n        if (settingHighContrast) settingHighContrast.checked = settings.highContrast;\n        if (settingColorblindPatterns) settingColorblindPatterns.checked = settings.colorblindPatterns;\n\n        // Voice Feedback settings\n        if (settingVoiceEnabled) settingVoiceEnabled.checked = settings.voiceEnabled;\n        if (settingVoiceLaps) settingVoiceLaps.checked = settings.voiceLaps;\n        if (settingVoiceZones) settingVoiceZones.checked = settings.voiceZones;\n\n        // Auto-Pause settings\n        if (settingAutoPauseEnabled) settingAutoPauseEnabled.checked = settings.autoPause.enabled;\n        if (settingAutoPauseSource) settingAutoPauseSource.value = settings.autoPause.source;\n        if (settingAutoPauseThreshold) settingAutoPauseThreshold.value = settings.autoPause.threshold.toString();\n        if (settingAutoPauseDelay) settingAutoPauseDelay.value = settings.autoPause.delay.toString();\n        updateAutoPauseUI();\n\n        // Export format settings\n        if (settingExportTcx) settingExportTcx.checked = settings.exportTcx;\n        if (settingExportCsv) settingExportCsv.checked = settings.exportCsv;\n        if (settingExportJson) settingExportJson.checked = settings.exportJson;\n        if (settingExportFit) settingExportFit.checked = settings.exportFit;\n\n        // Workout metadata settings\n        if (settingPromptForNotes) settingPromptForNotes.checked = settings.workoutMetadata.promptForNotes;\n        if (settingPromptForExertion) settingPromptForExertion.checked = settings.workoutMetadata.promptForExertion;\n\n        // Countdown settings\n        if (settingCountdownDuration) settingCountdownDuration.value = settings.countdown.duration.toString();\n        if (settingCountdownBeep) settingCountdownBeep.checked = settings.countdown.enableBeep;\n        if (settingCountdownVoice) settingCountdownVoice.checked = settings.countdown.enableVoice;\n\n        // Auto-Lap settings\n        if (settingAutoLapEnabled) settingAutoLapEnabled.checked = settings.autoLap.enabled;\n        if (settingAutoLapSource) settingAutoLapSource.value = settings.autoLap.source;\n        if (settingAutoLapDistance) settingAutoLapDistance.value = settings.autoLap.distanceKm.toString();\n        if (settingAutoLapTime) settingAutoLapTime.value = settings.autoLap.timeMinutes.toString();\n        updateAutoLapUI();\n\n        // Enhanced Voice settings\n        if (settingVoiceTimeInterval) settingVoiceTimeInterval.value = settings.enhancedVoice.timeIntervalMinutes.toString();\n        if (settingVoiceDistanceInterval) settingVoiceDistanceInterval.value = settings.enhancedVoice.distanceIntervalKm.toString();\n        if (settingVoiceSpeechRate) settingVoiceSpeechRate.value = settings.enhancedVoice.speechRate.toString();\n        if (settingVoiceMetricPower) settingVoiceMetricPower.checked = settings.enhancedVoice.metrics.power;\n        if (settingVoiceMetricHeartrate) settingVoiceMetricHeartrate.checked = settings.enhancedVoice.metrics.heartrate;\n        if (settingVoiceMetricCadence) settingVoiceMetricCadence.checked = settings.enhancedVoice.metrics.cadence;\n        if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = settings.enhancedVoice.metrics.speed;\n        if (settingVoiceMetricDistance) settingVoiceMetricDistance.checked = settings.enhancedVoice.metrics.distance;\n        if (settingVoiceMetricTime) settingVoiceMetricTime.checked = settings.enhancedVoice.metrics.time;\n\n        // Intervals.icu settings\n        if (settingIntervalsEnabled) settingIntervalsEnabled.checked = settings.intervals.enabled;\n        if (settingIntervalsApiKey) settingIntervalsApiKey.value = settings.intervals.apiKey;\n        if (settingIntervalsAthleteId) settingIntervalsAthleteId.value = settings.intervals.athleteId;\n        if (settingIntervalsAutoUpload) settingIntervalsAutoUpload.checked = settings.intervals.autoUpload;\n        updateIntervalsUI();\n\n        // Debug settings\n        if (settingDebugMode) settingDebugMode.checked = settings.debugMode;\n\n        // Sport settings (stored separately)\n        loadSportSettings();\n\n        applySettings(settings);\n    };\n\n    // Event Listeners\n    saveSettingsButton?.addEventListener('click', saveSettings);\n\n    downloadDebugLogs?.addEventListener('click', () => {\n        BluetoothDebugService.exportLogs();\n    });\n\n    clearDebugLogs?.addEventListener('click', async () => {\n        if (confirm('Are you sure you want to clear all debug logs?')) {\n            await BluetoothDebugService.clearLogs();\n            alert('Logs cleared.');\n        }\n    });\n\n    // PWA Install button handler\n    installPwaButton?.addEventListener('click', async () => {\n        const outcome = await triggerInstallPrompt();\n\n        if (outcome === 'accepted') {\n            // App will be installed, button will hide automatically via installPrompt.ts\n            console.log('PWA installation accepted');\n        } else if (outcome === 'dismissed') {\n            console.log('PWA installation dismissed');\n        } else {\n            alert('Installation is not available at this time. The app may already be installed or your browser does not support installation.');\n        }\n    });\n\n    // Initialize\n    loadSettings();\n}\n","/**\n * Data Fields Configuration UI\n * \n * Provides user interface for configuring data field screens and profiles.\n * - Edit existing screens (add/remove/reorder fields)\n * - Switch between activity profiles\n * - Preview screen layouts\n * \n * @module ui/dataFieldsConfig\n */\n\nimport type { ActivityProfile, DataScreen, DataFieldSlot, ScreenLayout } from '../data-fields/types.js';\nimport {\n    loadActiveProfile,\n    saveProfile,\n} from '../data-fields/persistence.js';\nimport { getDataField, getAllCategories, getFieldsByCategory, searchFields } from '../data-fields/registry.js';\nimport { addSlotToScreen, removeSlotFromScreen, updateSlot } from '../data-fields/screens.js';\nimport type { DataFieldCategory, DataFieldDefinition } from '../data-fields/types.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface DataFieldsConfigState {\n    profile: ActivityProfile;\n    selectedScreenIndex: number;\n    isEditing: boolean;\n    searchQuery: string;\n    selectedCategory: DataFieldCategory | 'all';\n}\n\ntype UpdateCallback = () => void;\n\n// ============================================================================\n// State Management\n// ============================================================================\n\nlet state: DataFieldsConfigState = {\n    profile: loadActiveProfile(),\n    selectedScreenIndex: 0,\n    isEditing: false,\n    searchQuery: '',\n    selectedCategory: 'all',\n};\n\nconst updateCallbacks: Set<UpdateCallback> = new Set();\n\n/**\n * Subscribe to state updates\n */\nfunction subscribe(callback: UpdateCallback): () => void {\n    updateCallbacks.add(callback);\n    return () => updateCallbacks.delete(callback);\n}\n\n/**\n * Notify subscribers of state change\n */\nfunction notifyUpdate(): void {\n    updateCallbacks.forEach(cb => cb());\n}\n\n/**\n * Update state and notify\n */\nfunction updateState(updates: Partial<DataFieldsConfigState>): void {\n    state = { ...state, ...updates };\n    notifyUpdate();\n}\n\n// ============================================================================\n// Profile/Screen Management\n// ============================================================================\n\n/**\n * Load and set the active profile\n */\nfunction loadProfile(): void {\n    const profile = loadActiveProfile();\n    updateState({\n        profile,\n        selectedScreenIndex: Math.min(state.selectedScreenIndex, profile.screens.length - 1),\n    });\n}\n\n/**\n * Save the current profile\n */\nfunction saveCurrentProfile(): boolean {\n    const success = saveProfile(state.profile);\n    if (success) {\n        // Dispatch event so carousel updates\n        document.dispatchEvent(new CustomEvent('data-fields-profile-changed', {\n            detail: { profile: state.profile }\n        }));\n    }\n    return success;\n}\n\n/**\n * Get the currently selected screen\n */\nfunction getSelectedScreen(): DataScreen | null {\n    return state.profile.screens[state.selectedScreenIndex] ?? null;\n}\n\n/**\n * Add a field to the current screen\n */\nfunction addFieldToScreen(fieldId: string, size: 'small' | 'medium' | 'large' = 'medium'): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = addSlotToScreen(screen, fieldId, size);\n\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Remove a field from the current screen\n */\nfunction removeFieldFromScreen(slotId: string): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = removeSlotFromScreen(screen, slotId);\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update a slot's properties\n */\nfunction updateFieldSlot(slotId: string, updates: Partial<DataFieldSlot>): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = updateSlot(screen, slotId, updates);\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update screen layout\n */\nfunction updateScreenLayout(layout: ScreenLayout): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = { ...screen, layout };\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update a screen in the profile\n */\nfunction updateScreenInProfile(screen: DataScreen): void {\n    const screens = [...state.profile.screens];\n    screens[state.selectedScreenIndex] = screen;\n\n    updateState({\n        profile: { ...state.profile, screens },\n    });\n}\n\n/**\n * Reorder fields in the current screen\n */\nfunction reorderFields(fromIndex: number, toIndex: number): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const slots = [...screen.slots];\n    const [removed] = slots.splice(fromIndex, 1);\n    slots.splice(toIndex, 0, removed);\n\n    // Update positions\n    const reorderedSlots = slots.map((slot, idx) => ({\n        ...slot,\n        position: idx,\n    }));\n\n    updateScreenInProfile({ ...screen, slots: reorderedSlots });\n}\n\n// ============================================================================\n// Field Search/Filter\n// ============================================================================\n\n/**\n * Get filtered fields based on search and category\n */\nfunction getFilteredFields(): DataFieldDefinition[] {\n    let fields: DataFieldDefinition[];\n\n    if (state.searchQuery.trim()) {\n        fields = searchFields(state.searchQuery);\n    } else if (state.selectedCategory === 'all') {\n        const categories = getAllCategories();\n        fields = Array.from(categories.values()).flat();\n    } else {\n        fields = getFieldsByCategory(state.selectedCategory);\n    }\n\n    return fields;\n}\n\n// ============================================================================\n// UI Rendering\n// ============================================================================\n\n/**\n * Category icons for visual display\n */\nconst CATEGORY_ICONS: Record<DataFieldCategory | 'all', string> = {\n    all: '',\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    elevation: '',\n    time: '',\n    laps: '',\n    energy: '',\n    environment: '',\n    device: '',\n    charts: '',\n    map: '',\n};\n\n/**\n * Create the main configuration UI\n */\nfunction createConfigUI(container: HTMLElement): void {\n    container.innerHTML = `\n        <div class=\"data-fields-config\">\n            <div class=\"dfc-header\">\n                <h3> Data Fields</h3>\n                <p class=\"dfc-help-text\">Configure which metrics appear on your dashboard screens.</p>\n            </div>\n            \n            <div class=\"dfc-screens\">\n                <div class=\"dfc-screens-tabs\" role=\"tablist\"></div>\n            </div>\n            \n            <div class=\"dfc-current-screen\">\n                <div class=\"dfc-screen-header\">\n                    <span class=\"dfc-screen-name\"></span>\n                    <select class=\"dfc-layout-select\" aria-label=\"Screen layout\">\n                        <option value=\"auto\">Auto Layout</option>\n                        <option value=\"grid-2\">2 Columns</option>\n                        <option value=\"grid-3\">3 Columns</option>\n                        <option value=\"grid-4\">4 Columns</option>\n                        <option value=\"list\">List</option>\n                    </select>\n                </div>\n                <div class=\"dfc-fields-list\" role=\"list\" aria-label=\"Current screen fields\"></div>\n                <button class=\"dfc-add-field-btn\" type=\"button\">\n                    <span>+</span> Add Field\n                </button>\n            </div>\n            \n            <div class=\"dfc-field-picker\" style=\"display: none;\">\n                <div class=\"dfc-picker-header\">\n                    <h4>Select a Field</h4>\n                    <button class=\"dfc-picker-close\" type=\"button\" aria-label=\"Close field picker\">&times;</button>\n                </div>\n                <input type=\"search\" class=\"dfc-search\" placeholder=\"Search fields...\" aria-label=\"Search data fields\">\n                <div class=\"dfc-categories\" role=\"tablist\"></div>\n                <div class=\"dfc-available-fields\" role=\"listbox\" aria-label=\"Available fields\"></div>\n            </div>\n            \n            <div class=\"dfc-actions\">\n                <button class=\"dfc-save-btn\" type=\"button\">Save Changes</button>\n                <button class=\"dfc-reset-btn\" type=\"button\">Reset to Defaults</button>\n            </div>\n        </div>\n    `;\n\n    // Set up event listeners\n    setupConfigEventListeners(container);\n\n    // Initial render\n    renderConfigUI(container);\n\n    // Subscribe to state changes\n    subscribe(() => renderConfigUI(container));\n}\n\n/**\n * Render the current state to the UI\n */\nfunction renderConfigUI(container: HTMLElement): void {\n    renderScreenTabs(container);\n    renderCurrentScreen(container);\n    renderFieldPicker(container);\n}\n\n/**\n * Render screen tabs\n */\nfunction renderScreenTabs(container: HTMLElement): void {\n    const tabsContainer = container.querySelector('.dfc-screens-tabs');\n    if (!tabsContainer) return;\n\n    tabsContainer.innerHTML = state.profile.screens\n        .map((screen, idx) => `\n            <button \n                class=\"dfc-screen-tab ${idx === state.selectedScreenIndex ? 'dfc-screen-tab--active' : ''}\"\n                data-screen-index=\"${idx}\"\n                role=\"tab\"\n                aria-selected=\"${idx === state.selectedScreenIndex}\"\n                aria-label=\"${screen.name} screen\"\n            >\n                <span class=\"dfc-tab-icon\">${screen.icon}</span>\n                <span class=\"dfc-tab-name\">${escapeHtml(screen.name)}</span>\n            </button>\n        `)\n        .join('');\n}\n\n/**\n * Render current screen fields\n */\nfunction renderCurrentScreen(container: HTMLElement): void {\n    const screen = getSelectedScreen();\n    const nameEl = container.querySelector('.dfc-screen-name');\n    const layoutSelect = container.querySelector('.dfc-layout-select') as HTMLSelectElement;\n    const fieldsList = container.querySelector('.dfc-fields-list');\n\n    if (!screen || !nameEl || !fieldsList || !layoutSelect) return;\n\n    nameEl.textContent = `${screen.icon} ${screen.name}`;\n    layoutSelect.value = screen.layout;\n\n    if (screen.slots.length === 0) {\n        fieldsList.innerHTML = `\n            <div class=\"dfc-empty-screen\">\n                <p>No fields on this screen</p>\n                <p class=\"dfc-empty-hint\">Click \"Add Field\" to add metrics</p>\n            </div>\n        `;\n        return;\n    }\n\n    fieldsList.innerHTML = screen.slots\n        .sort((a, b) => a.position - b.position)\n        .map((slot) => {\n            const field = getDataField(slot.fieldId);\n            const fieldName = field?.name ?? 'Unknown';\n            const fieldIcon = field?.icon ?? '';\n\n            return `\n                <div class=\"dfc-field-item\" data-slot-id=\"${slot.id}\" role=\"listitem\" draggable=\"true\">\n                    <span class=\"dfc-field-drag\" title=\"Drag to reorder\"></span>\n                    <span class=\"dfc-field-icon\">${fieldIcon}</span>\n                    <div class=\"dfc-field-info\">\n                        <span class=\"dfc-field-name\">${escapeHtml(fieldName)}</span>\n                        <span class=\"dfc-field-id\">${slot.fieldId}</span>\n                    </div>\n                    <select class=\"dfc-field-size\" data-slot-id=\"${slot.id}\" aria-label=\"Field size\">\n                        <option value=\"small\" ${slot.size === 'small' ? 'selected' : ''}>Small</option>\n                        <option value=\"medium\" ${slot.size === 'medium' ? 'selected' : ''}>Medium</option>\n                        <option value=\"large\" ${slot.size === 'large' ? 'selected' : ''}>Large</option>\n                    </select>\n                    <button class=\"dfc-field-remove\" data-slot-id=\"${slot.id}\" aria-label=\"Remove ${fieldName}\" title=\"Remove\">\n                        \n                    </button>\n                </div>\n            `;\n        })\n        .join('');\n}\n\n/**\n * Render field picker\n */\nfunction renderFieldPicker(container: HTMLElement): void {\n    const categoriesContainer = container.querySelector('.dfc-categories');\n    const fieldsContainer = container.querySelector('.dfc-available-fields');\n\n    if (!categoriesContainer || !fieldsContainer) return;\n\n    // Render category tabs\n    const categories: Array<DataFieldCategory | 'all'> = [\n        'all', 'power', 'heartrate', 'cadence', 'speed', 'distance', 'elevation', 'time'\n    ];\n\n    categoriesContainer.innerHTML = categories\n        .map(cat => `\n            <button \n                class=\"dfc-category-btn ${cat === state.selectedCategory ? 'dfc-category-btn--active' : ''}\"\n                data-category=\"${cat}\"\n                role=\"tab\"\n                aria-selected=\"${cat === state.selectedCategory}\"\n            >\n                <span>${CATEGORY_ICONS[cat]}</span>\n                <span>${cat === 'all' ? 'All' : cat.charAt(0).toUpperCase() + cat.slice(1)}</span>\n            </button>\n        `)\n        .join('');\n\n    // Render available fields\n    const fields = getFilteredFields();\n    const currentScreen = getSelectedScreen();\n    const usedFieldIds = new Set(currentScreen?.slots.map(s => s.fieldId) ?? []);\n\n    fieldsContainer.innerHTML = fields\n        .map(field => {\n            const isUsed = usedFieldIds.has(field.id);\n            return `\n                <button \n                    class=\"dfc-available-field ${isUsed ? 'dfc-available-field--used' : ''}\"\n                    data-field-id=\"${field.id}\"\n                    role=\"option\"\n                    aria-selected=\"false\"\n                    ${isUsed ? 'disabled' : ''}\n                >\n                    <span class=\"dfc-af-icon\">${field.icon}</span>\n                    <div class=\"dfc-af-info\">\n                        <span class=\"dfc-af-name\">${escapeHtml(field.name)}</span>\n                        <span class=\"dfc-af-desc\">${escapeHtml(field.description)}</span>\n                    </div>\n                    ${isUsed ? '<span class=\"dfc-af-badge\">Added</span>' : ''}\n                </button>\n            `;\n        })\n        .join('');\n}\n\n/**\n * Setup event listeners for the config UI\n */\nfunction setupConfigEventListeners(container: HTMLElement): void {\n    // Screen tab clicks\n    container.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n\n        // Screen tab\n        const tab = target.closest('.dfc-screen-tab') as HTMLElement;\n        if (tab) {\n            const idx = parseInt(tab.dataset.screenIndex ?? '0', 10);\n            updateState({ selectedScreenIndex: idx });\n            return;\n        }\n\n        // Add field button\n        if (target.closest('.dfc-add-field-btn')) {\n            showFieldPicker(container);\n            return;\n        }\n\n        // Close picker\n        if (target.closest('.dfc-picker-close')) {\n            hideFieldPicker(container);\n            return;\n        }\n\n        // Category button\n        const catBtn = target.closest('.dfc-category-btn') as HTMLElement;\n        if (catBtn) {\n            const category = catBtn.dataset.category as DataFieldCategory | 'all';\n            updateState({ selectedCategory: category });\n            return;\n        }\n\n        // Available field click\n        const fieldBtn = target.closest('.dfc-available-field') as HTMLElement;\n        if (fieldBtn && !fieldBtn.hasAttribute('disabled')) {\n            const fieldId = fieldBtn.dataset.fieldId;\n            if (fieldId) {\n                addFieldToScreen(fieldId);\n                notifyUpdate();\n            }\n            return;\n        }\n\n        // Remove field\n        const removeBtn = target.closest('.dfc-field-remove') as HTMLElement;\n        if (removeBtn) {\n            const slotId = removeBtn.dataset.slotId;\n            if (slotId) {\n                removeFieldFromScreen(slotId);\n            }\n            return;\n        }\n\n        // Save button\n        if (target.closest('.dfc-save-btn')) {\n            if (saveCurrentProfile()) {\n                showNotification('Settings saved!', 'success');\n            } else {\n                showNotification('Failed to save settings', 'error');\n            }\n            return;\n        }\n\n        // Reset button\n        if (target.closest('.dfc-reset-btn')) {\n            if (confirm('Reset data fields to defaults? This cannot be undone.')) {\n                resetToDefaults();\n            }\n            return;\n        }\n    });\n\n    // Layout select change\n    container.addEventListener('change', (e) => {\n        const target = e.target as HTMLSelectElement;\n\n        if (target.classList.contains('dfc-layout-select')) {\n            updateScreenLayout(target.value as ScreenLayout);\n            return;\n        }\n\n        if (target.classList.contains('dfc-field-size')) {\n            const slotId = target.dataset.slotId;\n            if (slotId) {\n                updateFieldSlot(slotId, { size: target.value as 'small' | 'medium' | 'large' });\n            }\n            return;\n        }\n    });\n\n    // Search input\n    const searchInput = container.querySelector('.dfc-search') as HTMLInputElement;\n    if (searchInput) {\n        searchInput.addEventListener('input', (e) => {\n            const target = e.target as HTMLInputElement;\n            updateState({ searchQuery: target.value });\n        });\n    }\n\n    // Drag and drop for reordering\n    setupDragAndDrop(container);\n}\n\n/**\n * Setup drag and drop reordering\n */\nfunction setupDragAndDrop(container: HTMLElement): void {\n    const fieldsList = container.querySelector('.dfc-fields-list');\n    if (!fieldsList) return;\n\n    let draggedEl: HTMLElement | null = null;\n    let draggedIndex: number = -1;\n\n    fieldsList.addEventListener('dragstart', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        draggedEl = target.closest('.dfc-field-item') as HTMLElement;\n        if (draggedEl) {\n            draggedIndex = Array.from(fieldsList.children).indexOf(draggedEl);\n            draggedEl.classList.add('dfc-field-item--dragging');\n        }\n    });\n\n    fieldsList.addEventListener('dragend', () => {\n        if (draggedEl) {\n            draggedEl.classList.remove('dfc-field-item--dragging');\n        }\n        draggedEl = null;\n        draggedIndex = -1;\n    });\n\n    fieldsList.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        const target = (e as DragEvent).target as HTMLElement;\n        const item = target.closest('.dfc-field-item') as HTMLElement;\n        if (item && item !== draggedEl) {\n            const items = Array.from(fieldsList.querySelectorAll('.dfc-field-item:not(.dfc-field-item--dragging)'));\n            const targetIndex = items.indexOf(item);\n            if (targetIndex !== -1) {\n                item.classList.add('dfc-field-item--drag-over');\n            }\n        }\n    });\n\n    fieldsList.addEventListener('dragleave', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        const item = target.closest('.dfc-field-item');\n        if (item) {\n            item.classList.remove('dfc-field-item--drag-over');\n        }\n    });\n\n    fieldsList.addEventListener('drop', (e) => {\n        e.preventDefault();\n        const target = (e as DragEvent).target as HTMLElement;\n        const targetItem = target.closest('.dfc-field-item') as HTMLElement;\n\n        // Clear all drag-over states\n        fieldsList.querySelectorAll('.dfc-field-item--drag-over').forEach(el => {\n            el.classList.remove('dfc-field-item--drag-over');\n        });\n\n        if (targetItem && draggedEl && targetItem !== draggedEl) {\n            const items = Array.from(fieldsList.querySelectorAll('.dfc-field-item'));\n            const toIndex = items.indexOf(targetItem);\n\n            if (draggedIndex !== -1 && toIndex !== -1 && draggedIndex !== toIndex) {\n                reorderFields(draggedIndex, toIndex);\n            }\n        }\n    });\n}\n\n/**\n * Show field picker modal\n */\nfunction showFieldPicker(container: HTMLElement): void {\n    const picker = container.querySelector('.dfc-field-picker') as HTMLElement;\n    if (picker) {\n        picker.style.display = 'block';\n        const searchInput = picker.querySelector('.dfc-search') as HTMLInputElement;\n        if (searchInput) {\n            searchInput.focus();\n        }\n    }\n}\n\n/**\n * Hide field picker modal\n */\nfunction hideFieldPicker(container: HTMLElement): void {\n    const picker = container.querySelector('.dfc-field-picker') as HTMLElement;\n    if (picker) {\n        picker.style.display = 'none';\n        updateState({ searchQuery: '', selectedCategory: 'all' });\n    }\n}\n\n/**\n * Reset to default profiles\n */\nfunction resetToDefaults(): void {\n    // Clear custom profiles and reload defaults\n    localStorage.removeItem('bpt-data-fields');\n    loadProfile();\n    showNotification('Data fields reset to defaults', 'info');\n}\n\n/**\n * Show a notification toast\n */\nfunction showNotification(message: string, type: 'success' | 'error' | 'info'): void {\n    // Use existing notification system if available\n    const event = new CustomEvent('show-notification', {\n        detail: { message, type }\n    });\n    document.dispatchEvent(event);\n\n    // Fallback: console log\n    console.log(`[DataFieldsConfig] ${type}: ${message}`);\n}\n\n/**\n * HTML escape helper\n */\nfunction escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// ============================================================================\n// Initialization\n// ============================================================================\n\n/**\n * Initialize data fields configuration in the settings page\n */\nexport function initDataFieldsConfig(): void {\n    // Find or create container in settings\n    const settingsContent = document.querySelector('#page-settings .page-content');\n    if (!settingsContent) {\n        console.warn('[DataFieldsConfig] Settings page content not found');\n        return;\n    }\n\n    // Check if already initialized\n    if (settingsContent.querySelector('.data-fields-config')) {\n        return;\n    }\n\n    // Create container\n    const container = document.createElement('fieldset');\n    container.className = 'settings-fieldset';\n    container.style.cssText = 'border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;';\n    container.innerHTML = '<legend style=\"font-weight: 600; padding: 0 8px;\"> Data Fields Configuration</legend>';\n\n    // Insert after Voice Feedback section or at the end\n    const voiceFeedback = settingsContent.querySelector('fieldset:nth-child(4)');\n    if (voiceFeedback && voiceFeedback.nextSibling) {\n        settingsContent.insertBefore(container, voiceFeedback.nextSibling);\n    } else {\n        settingsContent.appendChild(container);\n    }\n\n    createConfigUI(container);\n\n    console.log('[DataFieldsConfig] Initialized');\n}\n\n/**\n * Refresh the config UI with current state\n */\nexport function refreshDataFieldsConfig(): void {\n    loadProfile();\n}\n\n// Export state getters for external use\nexport { getSelectedScreen, getFilteredFields };\n","import { View } from '../router/View.js';\nimport { initSettingsLogic } from '../ui/settings.js';\nimport { initDataFieldsConfig } from '../ui/dataFieldsConfig.js';\n\nexport class SettingsView implements View {\n    public id = 'settings';\n    // private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('settingsTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initSettingsLogic();\n                initDataFieldsConfig();\n                // this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Settings template not found!');\n            container.innerHTML = '<p>Error loading settings view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        console.log('Entered Settings View');\n        // If we needed to refresh settings from storage every time we enter, \n        // we might call loadSettings() here. \n        // But initSettingsLogic calls loadSettings internally during init.\n        // If the user changes settings, they are saved. \n        // If we want to ensure UI matches state if state changed elsewhere...\n        // initSettingsLogic sets up listeners. \n        // We might want to re-run loadSettings() if it exposed it.\n        // For now, let's assume one-time init is fine or we can expose refresh.\n\n        // Actually, since we re-clone the template only ONCE in init (if the container is empty?),\n        // Wait, the Router usually doesn't clear the container unless we implement it that way.\n        // My Router implementation:\n        /*\n            if (!this.views.has(viewId)) { ... view.init(container) }\n            this.currentView?.onLeave();\n            currentContainer.style.display = 'none';\n            newContainer.style.display = 'block';\n            view.onEnter();\n        */\n\n        // So init() is called once. The DOM elements persist.\n        // So `initSettingsLogic` is called once. The listeners persist.\n        // This is correct.\n    }\n\n    public onLeave(): void {\n        console.log('Left Settings View');\n    }\n}\n","/**\n * View IDs for application navigation\n */\nexport enum ViewId {\n    Dashboard = 'dashboard',\n    History = 'history',\n    Workouts = 'workouts',\n    Settings = 'settings',\n    Plans = 'plans',\n    Debug = 'debug'\n}\n","import type { TrainingPlan } from '../types.js';\nimport type { StructuredWorkout } from '../../workouts/types.js';\n\n// Helper to create a simple workout for the plan\nconst createIntervalWorkout = (id: string, name: string, description: string): StructuredWorkout => {\n    return {\n        id,\n        name,\n        description,\n        steps: [\n            { type: 'warmup', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 90 } },\n            { type: 'recovery', duration: 180, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 90 } },\n            { type: 'recovery', duration: 180, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 90 } },\n            { type: 'cooldown', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 40 } }\n        ]\n    };\n};\n\nconst createEnduranceWorkout = (id: string, name: string): StructuredWorkout => {\n    return {\n        id,\n        name,\n        description: 'Steady zone 2 effort',\n        steps: [\n            { type: 'warmup', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 1800, target: { type: 'power', unit: 'percent_ftp', value: 65 } }, // 30 min Z2\n            { type: 'cooldown', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 } }\n        ]\n    };\n};\n\nexport const ftpBuilderPlan: TrainingPlan = {\n    id: 'plan-ftp-builder-1',\n    name: '4-Week FTP Booster',\n    description: 'A focused 4-week block designed to raise your functional threshold power through sweet spot and threshold intervals.',\n    difficulty: 'intermediate',\n    created: Date.now(),\n    updated: Date.now(),\n    weeks: [\n        {\n            weekNumber: 1,\n            focus: 'Introduction',\n            days: [\n                { dayOfWeek: 1, isRestDay: true, notes: 'Rest day. Stretch.' },\n                { dayOfWeek: 2, isRestDay: false, workout: createIntervalWorkout('ftp-w1-d2', 'Intro Intervals', 'Basic intervals') },\n                { dayOfWeek: 3, isRestDay: false, workout: createEnduranceWorkout('ftp-w1-d3', 'Aerobic Base') },\n                { dayOfWeek: 4, isRestDay: true },\n                { dayOfWeek: 5, isRestDay: false, workout: createIntervalWorkout('ftp-w1-d5', 'Tempo Work', 'Harder intervals') },\n                { dayOfWeek: 6, isRestDay: true },\n                { dayOfWeek: 7, isRestDay: false, workout: createEnduranceWorkout('ftp-w1-d7', 'Long Ride') },\n            ]\n        },\n        {\n            weekNumber: 2,\n            focus: 'Build',\n            days: [\n                { dayOfWeek: 1, isRestDay: true },\n                { dayOfWeek: 2, isRestDay: false, workout: createIntervalWorkout('ftp-w2-d2', 'Threshold Push', 'Pushing limits') },\n                { dayOfWeek: 3, isRestDay: false, workout: createEnduranceWorkout('ftp-w2-d3', 'Recovery Spin') },\n                { dayOfWeek: 4, isRestDay: true },\n                { dayOfWeek: 5, isRestDay: false, workout: createIntervalWorkout('ftp-w2-d5', 'O/U Intervals', 'Over Unders') },\n                { dayOfWeek: 6, isRestDay: true },\n                { dayOfWeek: 7, isRestDay: false, workout: createEnduranceWorkout('ftp-w2-d7', 'Sunday Long Ride') },\n            ]\n        }\n    ]\n};\n","import type { TrainingPlan } from './types.js';\nimport { ftpBuilderPlan } from './library/ftpBuilder.js';\n\nexport interface PlanProgress {\n    planId: string;\n    startDate: number; // Timestamp\n    completedDays: Record<string, boolean>; // key format: \"week-day\" e.g. \"1-2\" (Week 1, Tuesday)\n}\n\nconst STORAGE_KEY_PLANS = 'bpt-user-plans';\nconst STORAGE_KEY_PROGRESS = 'bpt-plan-progress';\n\nclass PlanRepository {\n    private systemPlans: TrainingPlan[] = [];\n\n    constructor() {\n        this.registerSystemPlan(ftpBuilderPlan);\n    }\n\n    public registerSystemPlan(plan: TrainingPlan) {\n        this.systemPlans.push(plan);\n    }\n\n    public getAllPlans(): TrainingPlan[] {\n        const userPlans = this.getUserPlans();\n        return [...this.systemPlans, ...userPlans];\n    }\n\n    public getPlan(id: string): TrainingPlan | undefined {\n        return this.getAllPlans().find(p => p.id === id);\n    }\n\n    public getUserPlans(): TrainingPlan[] {\n        try {\n            const raw = localStorage.getItem(STORAGE_KEY_PLANS);\n            return raw ? JSON.parse(raw) : [];\n        } catch (e) {\n            console.error('Failed to load user plans', e);\n            return [];\n        }\n    }\n\n    public saveUserPlan(plan: TrainingPlan): void {\n        const plans = this.getUserPlans();\n        const existingIndex = plans.findIndex(p => p.id === plan.id);\n\n        if (existingIndex >= 0) {\n            plans[existingIndex] = plan;\n        } else {\n            plans.push(plan);\n        }\n\n        localStorage.setItem(STORAGE_KEY_PLANS, JSON.stringify(plans));\n    }\n\n    public getActiveProgress(): PlanProgress | null {\n        try {\n            const raw = localStorage.getItem(STORAGE_KEY_PROGRESS);\n            return raw ? JSON.parse(raw) : null;\n        } catch {\n            return null;\n        }\n    }\n\n    public startPlan(planId: string, startDate: number = Date.now()): void {\n        const progress: PlanProgress = {\n            planId,\n            startDate,\n            completedDays: {}\n        };\n        localStorage.setItem(STORAGE_KEY_PROGRESS, JSON.stringify(progress));\n    }\n\n    public markDayComplete(week: number, day: number): void {\n        const progress = this.getActiveProgress();\n        if (!progress) return; // No active plan\n\n        const key = `${week}-${day}`;\n        progress.completedDays[key] = true;\n        localStorage.setItem(STORAGE_KEY_PROGRESS, JSON.stringify(progress));\n    }\n\n    public stopActivePlan(): void {\n        localStorage.removeItem(STORAGE_KEY_PROGRESS);\n    }\n}\n\nexport const planRepository = new PlanRepository();\n","import { View } from '../router/View.js';\nimport { ViewId } from '../router/view-ids.js';\nimport { planRepository, type PlanProgress } from '../plans/planRepository.js';\nimport type { TrainingPlan, PlanWeek, PlanDay } from '../plans/types.js';\nimport { formatDuration } from '../api/workoutClient.js';\nimport { startStructuredWorkout } from '../ui/workoutPlayer.js';\nimport { WORKOUT_LIBRARY } from '../workouts/workoutLibrary.js';\nimport { getCustomWorkouts } from '../storage/customWorkouts.js';\nimport type { StructuredWorkout, WorkoutStep } from '../workouts/types.js';\n\nexport class PlansView implements View {\n    public id = ViewId.Plans;\n    private container: HTMLElement | null = null;\n\n    public init(container: HTMLElement): void {\n        this.container = container;\n        this.render();\n    }\n\n    public onEnter(): void {\n        console.log('Entered Plans View');\n        this.render();\n    }\n\n    public onLeave(): void {\n        console.log('Left Plans View');\n    }\n\n    private render(): void {\n        if (!this.container) return;\n\n        // Simple state checking to see if we are viewing details\n        // For now, simpler to just always render dashboard, and handle details via innerHTML replacement\n        // Ideally we would have sub-routes like /plans/:id\n        this.renderDashboard();\n    }\n\n    private renderDashboard() {\n        if (!this.container) return;\n        const activeProgress = planRepository.getActiveProgress();\n        const plans = planRepository.getAllPlans();\n\n        let html = `\n            <div class=\"page-header\" style=\"padding: 16px; border-bottom: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center;\">\n                <h2> Training Plans</h2>\n            </div>\n            <div class=\"page-content\" style=\"padding: 16px;\">\n        `;\n\n        // Active Plan Section\n        if (activeProgress) {\n            const activePlan = planRepository.getPlan(activeProgress.planId);\n            if (activePlan) {\n                html += this.renderActivePlan(activePlan, activeProgress);\n            }\n        }\n\n        // Available Plans Section\n        html += `\n            <h3>Available Plans</h3>\n            <div class=\"plans-list\" style=\"display: grid; gap: 16px; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\">\n                ${plans.map(plan => this.renderPlanCard(plan, activeProgress?.planId === plan.id)).join('')}\n            </div>\n        </div>`;\n\n        this.container.innerHTML = html;\n        this.attachListeners(this.container);\n    }\n\n    private renderActivePlan(plan: TrainingPlan, progress: PlanProgress): string {\n        const daysSinceStart = Math.floor((Date.now() - progress.startDate) / (1000 * 60 * 60 * 24));\n        const currentWeekNum = Math.floor(daysSinceStart / 7) + 1;\n        const currentDayNum = (daysSinceStart % 7) + 1;\n\n        return `\n            <div class=\"active-plan-card\" style=\"background: var(--card-bg); padding: 16px; border-radius: 8px; margin-bottom: 24px; border: 2px solid var(--color-primary);\">\n                <div style=\"display: flex; justify-content: space-between; margin-bottom: 12px;\">\n                    <h3 style=\"margin: 0;\">Currently Following: ${plan.name}</h3>\n                    <span class=\"status-badge\" style=\"background: var(--color-primary); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;\">Active</span>\n                </div>\n                <p><strong>Week ${currentWeekNum}, Day ${currentDayNum}</strong></p>\n                <div style=\"margin-top: 12px;\">\n                    <button class=\"workout-btn btn-stop-plan\" data-id=\"${plan.id}\" style=\"background: var(--color-error); font-size: 0.9em;\">Stop Plan</button>\n                    <button class=\"workout-btn btn-view-plan\" data-id=\"${plan.id}\" style=\"font-size: 0.9em;\">View Schedule</button>\n                </div>\n            </div>\n        `;\n    }\n\n    private renderPlanCard(plan: TrainingPlan, isActive: boolean): string {\n        return `\n            <div class=\"plan-card\" style=\"background: var(--card-bg); padding: 16px; border-radius: 8px; border: 1px solid var(--color-border); ${isActive ? 'opacity: 0.6;' : ''}\">\n                <h4 style=\"margin: 0 0 8px 0;\">${plan.name}</h4>\n                <div style=\"font-size: 0.9em; color: var(--color-text-secondary); margin-bottom: 12px;\">\n                    ${plan.weeks.length} Weeks  ${plan.difficulty || 'Intermediate'}\n                </div>\n                <p style=\"font-size: 0.9em; margin-bottom: 16px; line-height: 1.4;\">${plan.description}</p>\n                <button class=\"workout-btn btn-view-plan\" data-id=\"${plan.id}\" style=\"width: 100%;\">View Details</button>\n            </div>\n        `;\n    }\n\n    private renderDetails(planId: string) {\n        if (!this.container) return;\n        const plan = planRepository.getPlan(planId);\n        if (!plan) return;\n\n        const progress = planRepository.getActiveProgress();\n        const isActive = progress?.planId === planId;\n\n        let html = `\n            <div class=\"page-header\" style=\"padding: 16px; border-bottom: 1px solid var(--color-border); display: flex; gap: 8px; align-items: center;\">\n                <button class=\"btn-back-plans\" style=\"background: none; border: none; font-size: 1.2em; cursor: pointer;\"></button>\n                <h2 style=\"margin: 0;\">${plan.name}</h2>\n            </div>\n            <div class=\"page-content\" style=\"padding: 16px;\">\n                <p>${plan.description}</p>\n                \n                <div style=\"margin: 16px 0;\">\n                    ${isActive\n                ? `<button class=\"workout-btn btn-stop-plan\" data-id=\"${plan.id}\" style=\"background: var(--color-error);\">Stop Plan</button>`\n                : `<button class=\"workout-btn btn-start-plan\" data-id=\"${plan.id}\" style=\"background: var(--color-success);\">Start Plan</button>`\n            }\n                </div>\n    \n                <div class=\"plan-weeks\">\n                    ${plan.weeks.map(week => this.renderWeek(week, isActive ? progress : null)).join('')}\n                </div>\n            </div>\n        `;\n\n        this.container.innerHTML = html;\n        this.attachListeners(this.container, planId);\n    }\n\n    private renderWeek(week: PlanWeek, progress: PlanProgress | null): string {\n        return `\n            <div class=\"plan-week\" style=\"margin-bottom: 20px;\">\n                <h4 style=\"background: var(--bg-secondary); padding: 8px; border-radius: 4px; margin-bottom: 8px;\">\n                    Week ${week.weekNumber}: ${week.focus || ''}\n                </h4>\n                <div class=\"week-days\" style=\"display: grid; gap: 8px;\">\n                    ${week.days.map(day => this.renderDay(day, week.weekNumber, progress)).join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    private renderDay(day: PlanDay, weekNum: number, progress: PlanProgress | null): string {\n        const isComplete = progress ? progress.completedDays[`${weekNum}-${day.dayOfWeek}`] : false;\n\n        let isToday = false;\n        if (progress) {\n            const daysSinceStart = Math.floor((Date.now() - progress.startDate) / (1000 * 60 * 60 * 24));\n            const currentDayAbsolute = daysSinceStart + 1;\n            const thisDayAbsolute = ((weekNum - 1) * 7) + day.dayOfWeek;\n            if (currentDayAbsolute === thisDayAbsolute) isToday = true;\n        }\n\n        let content = '';\n        if (day.isRestDay) {\n            content = `<em>Rest Day</em> ${day.notes ? `- ${day.notes}` : ''}`;\n        } else if (day.workout) {\n            content = `<strong>${day.workout.name}</strong><br><span style=\"font-size: 0.85em; color: var(--color-text-secondary);\">${formatDuration(this.getTotalDuration(day.workout))}</span>`;\n        } else {\n            content = `Workout ID: ${day.workoutId}`;\n        }\n\n        return `\n            <div class=\"plan-day\" style=\"\n                padding: 12px; \n                border: 1px solid var(--color-border); \n                border-radius: 6px; \n                display: flex; \n                align-items: center; \n                gap: 12px;\n                background: ${isToday ? 'var(--bg-highlight, rgba(33, 150, 243, 0.1))' : 'var(--card-bg)'};\n                ${isToday ? 'border-color: var(--color-primary);' : ''}\n            \">\n                <div style=\"\n                    width: 24px; height: 24px; \n                    border-radius: 50%; \n                    background: ${isComplete ? 'var(--color-success)' : '#ccc'}; \n                    color: white;\n                    display: flex; align-items: center; justify-content: center;\n                    font-size: 0.8em;\n                \">${day.dayOfWeek}</div>\n                \n                <div style=\"flex: 1;\">${content}</div>\n    \n                ${!day.isRestDay && day.workout ? `\n                    <button class=\"workout-btn btn-preview-workout\" style=\"padding: 4px 8px; font-size: 0.8em;\">Preview</button>\n                    ${progress && !isComplete ? `<button class=\"workout-btn btn-do-workout\" data-week=\"${weekNum}\" data-day=\"${day.dayOfWeek}\" style=\"margin-left:8px; padding: 4px 8px; font-size: 0.8em; background: var(--color-primary);\">Start</button>` : ''}\n                ` : ''}\n            </div>\n        `;\n    }\n\n    private getTotalDuration(workout: StructuredWorkout): number {\n        return workout.steps.reduce((sum: number, step: WorkoutStep) => sum + step.duration, 0);\n    }\n\n    private attachListeners(container: HTMLElement, currentDetailId?: string) {\n        container.onclick = (e) => {\n            const target = e.target as HTMLElement;\n\n            if (target.classList.contains('btn-view-plan')) {\n                const id = target.dataset.id;\n                if (id) this.renderDetails(id);\n            }\n\n            if (target.classList.contains('btn-back-plans')) {\n                this.renderDashboard();\n            }\n\n            if (target.classList.contains('btn-start-plan')) {\n                const id = target.dataset.id;\n                if (id && confirm('Start this training plan? This will become your active plan.')) {\n                    planRepository.startPlan(id);\n                    this.renderDetails(id); // Re-render to show stop button\n                }\n            }\n\n            if (target.classList.contains('btn-stop-plan')) {\n                if (confirm('Are you sure you want to stop the current plan? Progress will be lost.')) {\n                    planRepository.stopActivePlan();\n                    if (currentDetailId) {\n                        this.renderDetails(currentDetailId);\n                    } else {\n                        this.renderDashboard();\n                    }\n                }\n            }\n\n            if (target.classList.contains('btn-do-workout')) {\n                const weekNum = parseInt(target.dataset.week || '0');\n                const dayNum = parseInt(target.dataset.day || '0');\n\n                const progress = planRepository.getActiveProgress();\n                if (!progress) return;\n\n                const plan = planRepository.getPlan(progress.planId);\n                if (!plan) return;\n\n                const week = plan.weeks.find(w => w.weekNumber === weekNum);\n                const day = week?.days.find(d => d.dayOfWeek === dayNum);\n\n                if (day) {\n                    let workout: StructuredWorkout | undefined = day.workout;\n\n                    if (!workout && day.workoutId) {\n                        // Resolve ID\n                        workout = WORKOUT_LIBRARY.find(w => w.id === day.workoutId)\n                            || getCustomWorkouts().find(w => w.id === day.workoutId);\n                    }\n\n                    if (workout) {\n                        startStructuredWorkout(workout, () => {\n                            planRepository.markDayComplete(weekNum, dayNum);\n                            // Refresh view to show progress\n                            this.render();\n                        });\n                    } else {\n                        alert('Workout definition not found!');\n                    }\n                }\n            }\n        };\n    }\n}\n","/**\r\n * Android scan mode\r\n */\r\nexport var ScanMode;\r\n(function (ScanMode) {\r\n    /**\r\n     * Perform Bluetooth LE scan in low power mode. This mode is enforced if the scanning application is not in foreground.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_LOW_POWER\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_LOW_POWER\"] = 0] = \"SCAN_MODE_LOW_POWER\";\r\n    /**\r\n     * Perform Bluetooth LE scan in balanced power mode. (default) Scan results are returned at a rate that provides a good trade-off between scan frequency and power consumption.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_BALANCED\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_BALANCED\"] = 1] = \"SCAN_MODE_BALANCED\";\r\n    /**\r\n     * Scan using highest duty cycle. It's recommended to only use this mode when the application is running in the foreground.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_LOW_LATENCY\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_LOW_LATENCY\"] = 2] = \"SCAN_MODE_LOW_LATENCY\";\r\n})(ScanMode || (ScanMode = {}));\r\n/**\r\n * Android connection priority used in `requestConnectionPriority`\r\n */\r\nexport var ConnectionPriority;\r\n(function (ConnectionPriority) {\r\n    /**\r\n     * Use the connection parameters recommended by the Bluetooth SIG. This is the default value if no connection parameter update is requested.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_BALANCED\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_BALANCED\"] = 0] = \"CONNECTION_PRIORITY_BALANCED\";\r\n    /**\r\n     * Request a high priority, low latency connection. An application should only request high priority connection parameters to transfer large amounts of data over LE quickly. Once the transfer is complete, the application should request CONNECTION_PRIORITY_BALANCED connection parameters to reduce energy use.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_HIGH\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_HIGH\"] = 1] = \"CONNECTION_PRIORITY_HIGH\";\r\n    /**\r\n     * Request low power, reduced data rate connection parameters.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_LOW_POWER\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_LOW_POWER\"] = 2] = \"CONNECTION_PRIORITY_LOW_POWER\";\r\n})(ConnectionPriority || (ConnectionPriority = {}));\r\n//# sourceMappingURL=definitions.js.map","/**\r\n * Convert an array of numbers into a DataView.\r\n */\r\nexport function numbersToDataView(value) {\r\n    return new DataView(Uint8Array.from(value).buffer);\r\n}\r\n/**\r\n * Convert a DataView into an array of numbers.\r\n */\r\nexport function dataViewToNumbers(value) {\r\n    return Array.from(new Uint8Array(value.buffer, value.byteOffset, value.byteLength));\r\n}\r\n/**\r\n * Convert a string into a DataView.\r\n */\r\nexport function textToDataView(value) {\r\n    return numbersToDataView(value.split('').map((s) => s.charCodeAt(0)));\r\n}\r\n/**\r\n * Convert a DataView into a string.\r\n */\r\nexport function dataViewToText(value) {\r\n    return String.fromCharCode(...dataViewToNumbers(value));\r\n}\r\n/**\r\n * Convert a 16 bit UUID into a 128 bit UUID string\r\n * @param value number, e.g. 0x180d\r\n * @return string, e.g. '0000180d-0000-1000-8000-00805f9b34fb'\r\n */\r\nexport function numberToUUID(value) {\r\n    return `0000${value.toString(16).padStart(4, '0')}-0000-1000-8000-00805f9b34fb`;\r\n}\r\n/**\r\n * Convert a string of hex into a DataView of raw bytes.\r\n * Note: characters other than [0-9a-fA-F] are ignored\r\n * @param hex string of values, e.g. \"00 01 02\" or \"000102\"\r\n * @return DataView of raw bytes\r\n */\r\nexport function hexStringToDataView(hex) {\r\n    const bin = [];\r\n    let i, c, isEmpty = 1, buffer = 0;\r\n    for (i = 0; i < hex.length; i++) {\r\n        c = hex.charCodeAt(i);\r\n        if ((c > 47 && c < 58) || (c > 64 && c < 71) || (c > 96 && c < 103)) {\r\n            buffer = (buffer << 4) ^ ((c > 64 ? c + 9 : c) & 15);\r\n            if ((isEmpty ^= 1)) {\r\n                bin.push(buffer & 0xff);\r\n            }\r\n        }\r\n    }\r\n    return numbersToDataView(bin);\r\n}\r\nexport function dataViewToHexString(value) {\r\n    return dataViewToNumbers(value)\r\n        .map((n) => {\r\n        let s = n.toString(16);\r\n        if (s.length == 1) {\r\n            s = '0' + s;\r\n        }\r\n        return s;\r\n    })\r\n        .join('');\r\n}\r\nexport function webUUIDToString(uuid) {\r\n    if (typeof uuid === 'string') {\r\n        return uuid;\r\n    }\r\n    else if (typeof uuid === 'number') {\r\n        return numberToUUID(uuid);\r\n    }\r\n    else {\r\n        throw new Error('Invalid UUID');\r\n    }\r\n}\r\nexport function mapToObject(map) {\r\n    const obj = {};\r\n    if (!map) {\r\n        return undefined;\r\n    }\r\n    map.forEach((value, key) => {\r\n        obj[key.toString()] = value;\r\n    });\r\n    return obj;\r\n}\r\n/**\r\n * Convert Data or Uint8Array to Uint8Array.\r\n * @param value DataView, Uint8Array, or undefined\r\n * @return Uint8Array or undefined\r\n */\r\nexport function toUint8Array(value) {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (typeof value === 'string') {\r\n        const dataView = hexStringToDataView(value);\r\n        return new Uint8Array(dataView.buffer, dataView.byteOffset, dataView.byteLength);\r\n    }\r\n    if (value instanceof DataView) {\r\n        return new Uint8Array(value.buffer, value.byteOffset, value.byteLength);\r\n    }\r\n    return value; // Already Uint8Array\r\n}\r\n/**\r\n * Convert Data, Uint8Array, or string to hex string.\r\n * @param value DataView, Uint8Array, or undefined\r\n * @return hex string or undefined\r\n */\r\nexport function toHexString(value) {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (value instanceof DataView) {\r\n        return dataViewToHexString(value);\r\n    }\r\n    // Uint8Array\r\n    return dataViewToHexString(new DataView(value.buffer, value.byteOffset, value.byteLength));\r\n}\r\n//# sourceMappingURL=conversion.js.map","import { registerPlugin } from '@capacitor/core';\r\nexport const BluetoothLe = registerPlugin('BluetoothLe', {\r\n    web: () => import('./web').then((m) => new m.BluetoothLeWeb()),\r\n});\r\n//# sourceMappingURL=plugin.js.map","const makeQueue = () => {\r\n    let currentTask = Promise.resolve();\r\n    // create a new promise so that errors can be bubbled\r\n    // up to the caller without being caught by the queue\r\n    return (fn) => new Promise((resolve, reject) => {\r\n        currentTask = currentTask\r\n            .then(() => fn())\r\n            .then(resolve)\r\n            .catch(reject);\r\n    });\r\n};\r\nexport function getQueue(enabled) {\r\n    if (enabled) {\r\n        return makeQueue();\r\n    }\r\n    return (fn) => fn();\r\n}\r\n//# sourceMappingURL=queue.js.map","export function parseUUID(uuid) {\r\n    if (typeof uuid !== 'string') {\r\n        throw new Error(`Invalid UUID type ${typeof uuid}. Expected string.`);\r\n    }\r\n    uuid = uuid.toLowerCase();\r\n    const is128BitUuid = uuid.search(/^[0-9a-f]{8}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{12}$/) >= 0;\r\n    if (!is128BitUuid) {\r\n        throw new Error(`Invalid UUID format ${uuid}. Expected 128 bit string (e.g. \"0000180d-0000-1000-8000-00805f9b34fb\").`);\r\n    }\r\n    return uuid;\r\n}\r\n//# sourceMappingURL=validators.js.map","import { Capacitor } from '@capacitor/core';\r\nimport { dataViewToHexString, hexStringToDataView, toUint8Array, toHexString } from './conversion';\r\nimport { BluetoothLe } from './plugin';\r\nimport { getQueue } from './queue';\r\nimport { parseUUID } from './validators';\r\nclass BleClientClass {\r\n    constructor() {\r\n        this.scanListener = null;\r\n        this.eventListeners = new Map();\r\n        this.queue = getQueue(true);\r\n    }\r\n    enableQueue() {\r\n        this.queue = getQueue(true);\r\n    }\r\n    disableQueue() {\r\n        this.queue = getQueue(false);\r\n    }\r\n    async initialize(options) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.initialize(options);\r\n        });\r\n    }\r\n    async isEnabled() {\r\n        const enabled = await this.queue(async () => {\r\n            const result = await BluetoothLe.isEnabled();\r\n            return result.value;\r\n        });\r\n        return enabled;\r\n    }\r\n    async requestEnable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.requestEnable();\r\n        });\r\n    }\r\n    async enable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.enable();\r\n        });\r\n    }\r\n    async disable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.disable();\r\n        });\r\n    }\r\n    async startEnabledNotifications(callback) {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `onEnabledChanged`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            const listener = await BluetoothLe.addListener(key, (result) => {\r\n                callback(result.value);\r\n            });\r\n            this.eventListeners.set(key, listener);\r\n            await BluetoothLe.startEnabledNotifications();\r\n        });\r\n    }\r\n    async stopEnabledNotifications() {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `onEnabledChanged`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.eventListeners.delete(key);\r\n            await BluetoothLe.stopEnabledNotifications();\r\n        });\r\n    }\r\n    async isLocationEnabled() {\r\n        const enabled = await this.queue(async () => {\r\n            const result = await BluetoothLe.isLocationEnabled();\r\n            return result.value;\r\n        });\r\n        return enabled;\r\n    }\r\n    async openLocationSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openLocationSettings();\r\n        });\r\n    }\r\n    async openBluetoothSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openBluetoothSettings();\r\n        });\r\n    }\r\n    async openAppSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openAppSettings();\r\n        });\r\n    }\r\n    async setDisplayStrings(displayStrings) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.setDisplayStrings(displayStrings);\r\n        });\r\n    }\r\n    async requestDevice(options) {\r\n        options = options ? this.validateRequestBleDeviceOptions(options) : undefined;\r\n        const result = await this.queue(async () => {\r\n            const device = await BluetoothLe.requestDevice(options);\r\n            return device;\r\n        });\r\n        return result;\r\n    }\r\n    async requestLEScan(options, callback) {\r\n        options = this.validateRequestBleDeviceOptions(options);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            await ((_a = this.scanListener) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.scanListener = await BluetoothLe.addListener('onScanResult', (resultInternal) => {\r\n                const result = Object.assign(Object.assign({}, resultInternal), { manufacturerData: this.convertObject(resultInternal.manufacturerData), serviceData: this.convertObject(resultInternal.serviceData), rawAdvertisement: resultInternal.rawAdvertisement\r\n                        ? this.convertValue(resultInternal.rawAdvertisement)\r\n                        : undefined });\r\n                callback(result);\r\n            });\r\n            await BluetoothLe.requestLEScan(options);\r\n        });\r\n    }\r\n    async stopLEScan() {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            await ((_a = this.scanListener) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.scanListener = null;\r\n            await BluetoothLe.stopLEScan();\r\n        });\r\n    }\r\n    async getDevices(deviceIds) {\r\n        if (!Array.isArray(deviceIds)) {\r\n            throw new Error('deviceIds must be an array');\r\n        }\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getDevices({ deviceIds });\r\n            return result.devices;\r\n        });\r\n    }\r\n    async getConnectedDevices(services) {\r\n        if (!Array.isArray(services)) {\r\n            throw new Error('services must be an array');\r\n        }\r\n        services = services.map(parseUUID);\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getConnectedDevices({ services });\r\n            return result.devices;\r\n        });\r\n    }\r\n    async getBondedDevices() {\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getBondedDevices();\r\n            return result.devices;\r\n        });\r\n    }\r\n    async connect(deviceId, onDisconnect, options) {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            if (onDisconnect) {\r\n                const key = `disconnected|${deviceId}`;\r\n                await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n                const listener = await BluetoothLe.addListener(key, () => {\r\n                    onDisconnect(deviceId);\r\n                });\r\n                this.eventListeners.set(key, listener);\r\n            }\r\n            await BluetoothLe.connect(Object.assign({ deviceId }, options));\r\n        });\r\n    }\r\n    async createBond(deviceId, options) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.createBond(Object.assign({ deviceId }, options));\r\n        });\r\n    }\r\n    async isBonded(deviceId) {\r\n        const isBonded = await this.queue(async () => {\r\n            const result = await BluetoothLe.isBonded({ deviceId });\r\n            return result.value;\r\n        });\r\n        return isBonded;\r\n    }\r\n    async disconnect(deviceId) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.disconnect({ deviceId });\r\n        });\r\n    }\r\n    async getServices(deviceId) {\r\n        const services = await this.queue(async () => {\r\n            const result = await BluetoothLe.getServices({ deviceId });\r\n            return result.services;\r\n        });\r\n        return services;\r\n    }\r\n    async discoverServices(deviceId) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.discoverServices({ deviceId });\r\n        });\r\n    }\r\n    async getMtu(deviceId) {\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.getMtu({ deviceId });\r\n            return result.value;\r\n        });\r\n        return value;\r\n    }\r\n    async requestConnectionPriority(deviceId, connectionPriority) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.requestConnectionPriority({ deviceId, connectionPriority });\r\n        });\r\n    }\r\n    async readRssi(deviceId) {\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.readRssi({ deviceId });\r\n            return parseFloat(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async read(deviceId, service, characteristic, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.read(Object.assign({ deviceId,\r\n                service,\r\n                characteristic }, options));\r\n            return this.convertValue(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async write(deviceId, service, characteristic, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        return this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.write(Object.assign({ deviceId,\r\n                service,\r\n                characteristic, value: writeValue }, options));\r\n        });\r\n    }\r\n    async writeWithoutResponse(deviceId, service, characteristic, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.writeWithoutResponse(Object.assign({ deviceId,\r\n                service,\r\n                characteristic, value: writeValue }, options));\r\n        });\r\n    }\r\n    async readDescriptor(deviceId, service, characteristic, descriptor, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        descriptor = parseUUID(descriptor);\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.readDescriptor(Object.assign({ deviceId,\r\n                service,\r\n                characteristic,\r\n                descriptor }, options));\r\n            return this.convertValue(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async writeDescriptor(deviceId, service, characteristic, descriptor, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        descriptor = parseUUID(descriptor);\r\n        return this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.writeDescriptor(Object.assign({ deviceId,\r\n                service,\r\n                characteristic,\r\n                descriptor, value: writeValue }, options));\r\n        });\r\n    }\r\n    async startNotifications(deviceId, service, characteristic, callback, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `notification|${deviceId}|${service}|${characteristic}`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            const listener = await BluetoothLe.addListener(key, (event) => {\r\n                callback(this.convertValue(event === null || event === void 0 ? void 0 : event.value));\r\n            });\r\n            this.eventListeners.set(key, listener);\r\n            await BluetoothLe.startNotifications(Object.assign({ deviceId,\r\n                service,\r\n                characteristic }, options));\r\n        });\r\n    }\r\n    async stopNotifications(deviceId, service, characteristic) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `notification|${deviceId}|${service}|${characteristic}`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.eventListeners.delete(key);\r\n            await BluetoothLe.stopNotifications({\r\n                deviceId,\r\n                service,\r\n                characteristic,\r\n            });\r\n        });\r\n    }\r\n    validateRequestBleDeviceOptions(options) {\r\n        if (options.services) {\r\n            options.services = options.services.map(parseUUID);\r\n        }\r\n        if (options.optionalServices) {\r\n            options.optionalServices = options.optionalServices.map(parseUUID);\r\n        }\r\n        if (options.serviceData && Capacitor.getPlatform() !== 'web') {\r\n            // Native platforms: convert to hex strings\r\n            options.serviceData = options.serviceData.map((filter) => (Object.assign(Object.assign({}, filter), { serviceUuid: parseUUID(filter.serviceUuid), dataPrefix: toHexString(filter.dataPrefix), mask: toHexString(filter.mask) })));\r\n        }\r\n        if (options.manufacturerData) {\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // Native platforms: convert to hex strings\r\n                options.manufacturerData = options.manufacturerData.map((filter) => (Object.assign(Object.assign({}, filter), { dataPrefix: toHexString(filter.dataPrefix), mask: toHexString(filter.mask) })));\r\n            }\r\n            else {\r\n                // Web platform: convert to Uint8Array for Web Bluetooth API\r\n                options.manufacturerData = options.manufacturerData.map((filter) => (Object.assign(Object.assign({}, filter), { dataPrefix: toUint8Array(filter.dataPrefix), mask: toUint8Array(filter.mask) })));\r\n            }\r\n        }\r\n        return options;\r\n    }\r\n    convertValue(value) {\r\n        if (typeof value === 'string') {\r\n            return hexStringToDataView(value);\r\n        }\r\n        else if (value === undefined) {\r\n            return new DataView(new ArrayBuffer(0));\r\n        }\r\n        return value;\r\n    }\r\n    convertObject(obj) {\r\n        if (obj === undefined) {\r\n            return undefined;\r\n        }\r\n        const result = {};\r\n        for (const key of Object.keys(obj)) {\r\n            result[key] = this.convertValue(obj[key]);\r\n        }\r\n        return result;\r\n    }\r\n}\r\nexport const BleClient = new BleClientClass();\r\n//# sourceMappingURL=bleClient.js.map","/**\n * FTMS (Fitness Machine Service) Parser\n * \n * Handles parsing of Bluetooth LE data from Fitness Machines (Treadmills).\n * \n * Specs: https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/\n */\n\nexport interface FTMSValues {\n    speed?: number;      // km/h\n    averageSpeed?: number; // km/h\n    totalDistance?: number; // meters\n    incline?: number;    // %\n    rampAngle?: number;  // degrees\n}\n\n/**\n * Parses Treadmill Data characteristic (0x2ACD)\n * \n * @param data DataView containing the raw bytes\n * @returns Parsed values object\n */\nexport const parseTreadmillData = (data: DataView): FTMSValues => {\n    // Check flags in first 2 bytes (16-bit LE)\n    const flags = data.getUint16(0, true);\n    let offset = 2;\n    const result: FTMSValues = {};\n\n    // Bit 0: More Data (ignored for now)\n    // Bit 1: Average Speed Present\n    const hasAverageSpeed = (flags & (1 << 1)) !== 0;\n    // Bit 2: Total Distance Present\n    const hasTotalDistance = (flags & (1 << 2)) !== 0;\n    // Bit 3: Inclination and Ramp Angle Present\n    const hasInclination = (flags & (1 << 3)) !== 0;\n\n    // Other bits ignored for now to avoid unused variable warnings\n    /*\n    // Bit 4: Elevation Gain Present\n    const hasElevationGain = (flags & (1 << 4)) !== 0;\n    // Bit 5: Instantaneous Pace Present\n    const hasPace = (flags & (1 << 5)) !== 0;\n    // Bit 6: Average Pace Present\n    const hasAveragePace = (flags & (1 << 6)) !== 0;\n    // Bit 7: Expended Energy Present\n    const hasEnergy = (flags & (1 << 7)) !== 0;\n    // Bit 8: Heart Rate Present\n    const hasHeartRate = (flags & (1 << 8)) !== 0;\n    // Bit 9: Metabolic Equivalent Present\n    const hasMetabolic = (flags & (1 << 9)) !== 0;\n    // Bit 10: Elapsed Time Present\n    const hasElapsedTime = (flags & (1 << 10)) !== 0;\n    // Bit 11: Remaining Time Present\n    const hasRemainingTime = (flags & (1 << 11)) !== 0;\n    // Bit 12: Force on Belt and Power Output Present\n    const hasForcePower = (flags & (1 << 12)) !== 0;\n    */\n\n    // Instantaneous Speed (Always present unless noted otherwise, but spec says \"C1\" - Mandatory)\n    // Unit: 0.01 km/h, uint16\n    // Note: Some legacy devices might interpret flags differently, but standard says first field after flags is Inst. Speed.\n    if (data.byteLength >= offset + 2) {\n        const rawSpeed = data.getUint16(offset, true);\n        result.speed = rawSpeed / 100.0;\n        offset += 2;\n    }\n\n    if (hasAverageSpeed && data.byteLength >= offset + 2) {\n        const rawAvgSpeed = data.getUint16(offset, true);\n        result.averageSpeed = rawAvgSpeed / 100.0;\n        offset += 2;\n    }\n\n    if (hasTotalDistance && data.byteLength >= offset + 3) {\n        // unit24 is tricky. Read 3 bytes.\n        // Little endian: byte[0] + byte[1]<<8 + byte[2]<<16\n        const b0 = data.getUint8(offset);\n        const b1 = data.getUint8(offset + 1);\n        const b2 = data.getUint8(offset + 2);\n        const rawDist = b0 + (b1 << 8) + (b2 << 16);\n\n        result.totalDistance = rawDist;\n        offset += 3;\n    }\n\n    if (hasInclination && data.byteLength >= offset + 4) {\n        // Inclination: sint16, 0.1 %\n        const rawIncline = data.getInt16(offset, true);\n        result.incline = rawIncline / 10.0;\n        offset += 2;\n\n        // Ramp Angle: sint16, 0.1 degree\n        const rawRamp = data.getInt16(offset, true);\n        result.rampAngle = rawRamp / 10.0;\n        offset += 2;\n    }\n\n    // We can parse more if needed (Heart Rate, etc.)\n\n    return result;\n};\n","import { BleClient } from '@capacitor-community/bluetooth-le';\nimport type { SensorConnection, TreadmillConnection, MeasurementListener, TreadmillListener, ConnectionStatusListener, ConnectionStatus } from '../../types/bluetooth.js';\nimport type { Measurement, TreadmillMeasurement } from '../../types/measurements.js';\nimport { parseTreadmillData } from './ftms.js';\nimport { BluetoothDebugService } from '../debug/BluetoothDebugService.js';\n\nconst CYCLING_POWER_SERVICE = '00001818-0000-1000-8000-00805f9b34fb';\nconst CYCLING_POWER_MEASUREMENT = '00002a63-0000-1000-8000-00805f9b34fb';\n\nconst HEART_RATE_SERVICE = '0000180d-0000-1000-8000-00805f9b34fb';\nconst HEART_RATE_MEASUREMENT = '00002a37-0000-1000-8000-00805f9b34fb';\n\nconst CYCLING_SPEED_AND_CADENCE_SERVICE = '00001816-0000-1000-8000-00805f9b34fb';\nconst CSC_MEASUREMENT = '00002a5b-0000-1000-8000-00805f9b34fb';\n\nconst FITNESS_MACHINE_SERVICE = '00001826-0000-1000-8000-00805f9b34fb';\nconst TREADMILL_DATA_CHARACTERISTIC = '00002acd-0000-1000-8000-00805f9b34fb';\n\n/** Maximum reconnection attempts before giving up */\nconst MAX_RECONNECT_ATTEMPTS = 5;\n/** Base delay between reconnection attempts (ms) */\nconst RECONNECT_BASE_DELAY = 1000;\n\n// Track if BleClient has been initialized\nlet isBleInitialized = false;\n\nconst ensureBleInitialized = async () => {\n    if (!isBleInitialized) {\n        try {\n            await BleClient.initialize();\n            isBleInitialized = true;\n        } catch (error) {\n            console.error('Failed to initialize BleClient:', error);\n            // On some versions/platforms, re-initializing might throw but not be fatal if already initialized.\n            // But usually we want to propagate this error if it's the first time.\n            throw error;\n        }\n    }\n};\n\nexport const connectPowerNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [CYCLING_POWER_SERVICE],\n            optionalServices: []\n        });\n    } catch (error) {\n        console.error('Error requesting Power device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Power Sensor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            CYCLING_POWER_SERVICE,\n            CYCLING_POWER_MEASUREMENT,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n                const power = value.getInt16(2, true);\n                const entry: Measurement = { timestamp: Date.now(), value: power };\n                listeners.forEach(listener => listener(entry));\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Power sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Power sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Power sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Power sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Power sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, CYCLING_POWER_SERVICE, CYCLING_POWER_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectHeartRateNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [HEART_RATE_SERVICE],\n            optionalServices: [HEART_RATE_SERVICE]\n        });\n    } catch (error) {\n        console.error('Error requesting Heart Rate device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Heart Rate Monitor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            HEART_RATE_SERVICE,\n            HEART_RATE_MEASUREMENT,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                const flags = value.getUint8(0);\n                let heartRate: number;\n\n                // Check Heart Rate Value Format bit (bit 0)\n                if (flags & 0x01) {\n                    // UINT16\n                    heartRate = value.getUint16(1, true); // little-endian\n                } else {\n                    // UINT8\n                    heartRate = value.getUint8(1);\n                }\n\n                const entry: Measurement = { timestamp: Date.now(), value: heartRate };\n                listeners.forEach(listener => listener(entry));\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Heart Rate sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Heart Rate sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Heart Rate sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Heart Rate sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Heart Rate sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, HEART_RATE_SERVICE, HEART_RATE_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectCadenceNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let lastCrankRevs: number | null = null;\n    let lastCrankTime: number | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [CYCLING_SPEED_AND_CADENCE_SERVICE],\n            optionalServices: [CYCLING_SPEED_AND_CADENCE_SERVICE]\n        });\n    } catch (error) {\n        console.error('Error requesting Cadence device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Cadence Sensor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            CYCLING_SPEED_AND_CADENCE_SERVICE,\n            CSC_MEASUREMENT,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                const flags = value.getUint8(0);\n\n                // Check if crank revolution data is present (bit 1 of flags)\n                if (flags & 0x02) {\n                    let offset = 1; // Start after flags byte\n\n                    // If wheel revolution data is present (bit 0), skip it (6 bytes: 4 for revs + 2 for time)\n                    if (flags & 0x01) {\n                        offset = 7;\n                    }\n\n                    const crankRevs = value.getUint16(offset, true);\n                    const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n                    // Calculate RPM from delta between measurements\n                    if (lastCrankRevs !== null && lastCrankTime !== null) {\n                        let revDelta = crankRevs - lastCrankRevs;\n                        let timeDelta = crankTime - lastCrankTime;\n\n                        // Handle rollover (uint16 max is 65535)\n                        if (revDelta < 0) revDelta += 65536;\n                        if (timeDelta < 0) timeDelta += 65536;\n\n                        // Calculate RPM: (revolutions / time_in_seconds) * 60\n                        // Time is in 1/1024 seconds, so convert to seconds\n                        if (timeDelta > 0) {\n                            const timeInSeconds = timeDelta / 1024;\n                            const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                            // Sanity check for reasonable cadence values\n                            if (rpm >= 0 && rpm < 300) {\n                                const entry: Measurement = { timestamp: Date.now(), value: rpm };\n                                listeners.forEach(listener => listener(entry));\n                            }\n                        }\n                    }\n\n                    lastCrankRevs = crankRevs;\n                    lastCrankTime = crankTime;\n                }\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Cadence sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Cadence sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Cadence sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Cadence sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Cadence sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, CYCLING_SPEED_AND_CADENCE_SERVICE, CSC_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectTreadmillNative = async (): Promise<TreadmillConnection> => {\n    const listeners: TreadmillListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await ensureBleInitialized();\n\n    let device;\n    try {\n        device = await BleClient.requestDevice({\n            services: [FITNESS_MACHINE_SERVICE],\n            optionalServices: [FITNESS_MACHINE_SERVICE]\n        });\n    } catch (error) {\n        console.error('Error requesting Treadmill device:', error);\n        throw error;\n    }\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Treadmill';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Treadmill: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            FITNESS_MACHINE_SERVICE,\n            TREADMILL_DATA_CHARACTERISTIC,\n            (value) => {\n                BluetoothDebugService.log(deviceName, value);\n                try {\n                    const ftmsData = parseTreadmillData(value);\n\n                    if (ftmsData.speed !== undefined || ftmsData.incline !== undefined) {\n                        const entry: TreadmillMeasurement = {\n                            timestamp: Date.now(),\n                            speed: ftmsData.speed ?? null,\n                            incline: ftmsData.incline ?? null\n                        };\n                        listeners.forEach(listener => listener(entry));\n                    }\n                } catch (e) {\n                    console.error('Error parsing treadmill data', e);\n                }\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect) return;\n\n        if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            console.error('Treadmill: Max reconnection attempts reached');\n            notifyStatus('failed');\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Treadmill: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Treadmill: Reconnected successfully');\n        } catch (error) {\n            console.error('Treadmill: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    try {\n        await connect();\n    } catch (error) {\n        if (deviceId) {\n            try {\n                await BleClient.disconnect(deviceId);\n            } catch (e) { /* ignore */ }\n        }\n        throw error;\n    }\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, FITNESS_MACHINE_SERVICE, TREADMILL_DATA_CHARACTERISTIC);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting treadmill', e);\n                }\n            }\n            notifyStatus('disconnected');\n        },\n        addListener: (callback: TreadmillListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n","import type { SensorConnection, TreadmillConnection, RowerConnection, MeasurementListener, TreadmillListener, RowerListener, ConnectionStatusListener, ConnectionStatus } from '../../types/bluetooth.js';\nimport type { Measurement, TreadmillMeasurement, RowerMeasurement } from '../../types/measurements.js';\nimport { parseTreadmillData } from './ftms.js';\nimport { BluetoothDebugService } from '../debug/BluetoothDebugService.js';\n\n/** Maximum reconnection attempts before giving up */\nconst MAX_RECONNECT_ATTEMPTS = 5;\n/** Base delay between reconnection attempts (ms) */\nconst RECONNECT_BASE_DELAY = 1000;\n\nexport const connectPowerWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n\n    // Request Bluetooth device with cycling power service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_power'] }],\n        optionalServices: ['cycling_power'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Power Sensor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n        const power = value.getInt16(2, true);\n        const entry: Measurement = { timestamp: Date.now(), value: power };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('cycling_power');\n        characteristic = await service.getCharacteristic('cycling_power_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Power sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Power sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Power sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Power sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Power sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectHeartRateWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n\n    // Request Bluetooth device with heart rate service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['heart_rate'] }],\n        optionalServices: ['heart_rate'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Heart Rate Monitor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        const flags = value.getUint8(0);\n        let heartRate: number;\n\n        // Check Heart Rate Value Format bit (bit 0)\n        if (flags & 0x01) {\n            // UINT16\n            heartRate = value.getUint16(1, true); // little-endian\n        } else {\n            // UINT8\n            heartRate = value.getUint8(1);\n        }\n\n        const entry: Measurement = { timestamp: Date.now(), value: heartRate };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('heart_rate');\n        characteristic = await service.getCharacteristic('heart_rate_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Heart rate sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Heart rate sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Heart rate sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Heart rate sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Heart rate sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectCadenceWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n    let lastCrankRevs: number | null = null;\n    let lastCrankTime: number | null = null;\n\n    // Request Bluetooth device with cycling speed and cadence service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_speed_and_cadence'] }],\n        optionalServices: ['cycling_speed_and_cadence'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Cadence Sensor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        const flags = value.getUint8(0);\n\n        // Check if crank revolution data is present (bit 1 of flags)\n        if (flags & 0x02) {\n            // Crank revolution data format:\n            // - Cumulative Crank Revolutions (uint16, bytes 1-2 or 5-6 depending on wheel data)\n            // - Last Crank Event Time (uint16, bytes 3-4 or 7-8, units: 1/1024 seconds)\n\n            let offset = 1; // Start after flags byte\n\n            // If wheel revolution data is present (bit 0), skip it (6 bytes: 4 for revs + 2 for time)\n            if (flags & 0x01) {\n                offset = 7;\n            }\n\n            const crankRevs = value.getUint16(offset, true);\n            const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n            // Calculate RPM from delta between measurements\n            if (lastCrankRevs !== null && lastCrankTime !== null) {\n                let revDelta = crankRevs - lastCrankRevs;\n                let timeDelta = crankTime - lastCrankTime;\n\n                // Handle rollover (uint16 max is 65535)\n                if (revDelta < 0) revDelta += 65536;\n                if (timeDelta < 0) timeDelta += 65536;\n\n                // Calculate RPM: (revolutions / time_in_seconds) * 60\n                // Time is in 1/1024 seconds, so convert to seconds\n                if (timeDelta > 0) {\n                    const timeInSeconds = timeDelta / 1024;\n                    const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                    // Sanity check for reasonable cadence values\n                    if (rpm >= 0 && rpm < 300) {\n                        const entry: Measurement = { timestamp: Date.now(), value: rpm };\n                        listeners.forEach(listener => listener(entry));\n                    }\n                }\n            }\n\n            lastCrankRevs = crankRevs;\n            lastCrankTime = crankTime;\n        }\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('cycling_speed_and_cadence');\n        characteristic = await service.getCharacteristic('csc_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Cadence sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Cadence sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Cadence sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Cadence sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Cadence sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectTreadmillWeb = async (): Promise<TreadmillConnection> => {\n    const listeners: TreadmillListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n    let server: BluetoothRemoteGATTServer | undefined;\n\n    // Request Bluetooth device with Fitness Machine Service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['fitness_machine'] }],\n        optionalServices: ['fitness_machine'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Treadmill';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log(deviceName, value);\n\n        try {\n            const ftmsData = parseTreadmillData(value);\n\n            // Only emit if we have relevant data\n            if (ftmsData.speed !== undefined || ftmsData.incline !== undefined) {\n                const entry: TreadmillMeasurement = {\n                    timestamp: Date.now(),\n                    speed: ftmsData.speed ?? null,\n                    incline: ftmsData.incline ?? null\n                };\n                listeners.forEach(listener => listener(entry));\n            }\n        } catch (e) {\n            console.error('Error parsing treadmill data', e);\n        }\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        server = await device.gatt.connect();\n        const service = await server.getPrimaryService('fitness_machine');\n        characteristic = await service.getCharacteristic('treadmill_data');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Treadmill: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Treadmill: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Treadmill: Reconnected successfully');\n        } catch (error) {\n            console.error('Treadmill: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Treadmill: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    try {\n        await connect();\n    } catch (error) {\n        if (server && server.connected) {\n            server.disconnect();\n        }\n        throw error;\n    }\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                try {\n                    characteristic.stopNotifications();\n                    characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                } catch (e) { /* ignore */ }\n            }\n            if (device.gatt?.connected) {\n                device.gatt.disconnect();\n            }\n            notifyStatus('disconnected');\n        },\n        addListener: (callback: TreadmillListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectRowingWeb = async (): Promise<RowerConnection> => {\n    const listeners: RowerListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n    let server: BluetoothRemoteGATTServer | undefined;\n\n    // Request Bluetooth device with Fitness Machine Service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['fitness_machine'] }],\n        optionalServices: ['fitness_machine'],\n    });\n\n    const deviceName = device.name || 'Unknown Rower';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        BluetoothDebugService.log('rower', value);\n\n        // Parsing logic would go here. For now just debug log is the priority.\n        const entry: RowerMeasurement = {\n            timestamp: Date.now(),\n            strokeRate: null,\n            power: null\n        };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        server = await device.gatt.connect();\n        const service = await server.getPrimaryService('fitness_machine');\n        // 0x2AD1 is Rower Data\n        characteristic = await service.getCharacteristic('rower_data');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Rower: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Rower: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Rower: Reconnected successfully');\n        } catch (error) {\n            console.error('Rower: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Rower: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    try {\n        await connect();\n    } catch (error) {\n        if (server && server.connected) {\n            server.disconnect();\n        }\n        throw error;\n    }\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                try {\n                    characteristic.stopNotifications();\n                    characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                } catch (e) { /* ignore */ }\n            }\n            if (device.gatt?.connected) {\n                device.gatt.disconnect();\n            }\n            notifyStatus('disconnected');\n        },\n        addListener: (callback: RowerListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { SensorConnection, TreadmillConnection, RowerConnection } from '../../types/bluetooth.js';\nimport { connectPowerNative, connectHeartRateNative, connectCadenceNative, connectTreadmillNative } from './native-bluetooth.js';\nimport { connectPowerWeb, connectHeartRateWeb, connectCadenceWeb, connectTreadmillWeb, connectRowingWeb } from './web-bluetooth.js';\n\n/**\n * Bluetooth Factory\n * \n * Abstract factory for creating Bluetooth sensor connections.\n * Automatically selects the appropriate implementation (Web Bluetooth or Native)\n * based on the current platform.\n */\nexport const BluetoothFactory = {\n    /**\n     * Connect to a Power Meter\n     * @returns Promise resolving to a SensorConnection\n     */\n    connectPower: async (): Promise<SensorConnection> => {\n        if (typeof window !== 'undefined' && (window as any).useMockSensors) {\n            const { MockPowerSensor } = await import('./mock.js');\n            const sensor = new MockPowerSensor();\n            await sensor.connect();\n            (window as any).mockSensor = sensor;\n            return sensor;\n        }\n        if (Capacitor.isNativePlatform()) {\n            return connectPowerNative();\n        } else {\n            return connectPowerWeb();\n        }\n    },\n\n    /**\n     * Connect to a Heart Rate Monitor\n     * @returns Promise resolving to a SensorConnection\n     */\n    connectHeartRate: async (): Promise<SensorConnection> => {\n        if (typeof window !== 'undefined' && (window as any).useMockSensors) {\n            const { MockHeartrateSensor } = await import('./mock.js');\n            const sensor = new MockHeartrateSensor();\n            await sensor.connect();\n            (window as any).mockSensor = sensor;\n            return sensor;\n        }\n        if (Capacitor.isNativePlatform()) {\n            return connectHeartRateNative();\n        } else {\n            return connectHeartRateWeb();\n        }\n    },\n\n    /**\n     * Connect to a Cadence Sensor\n     * @returns Promise resolving to a SensorConnection\n     */\n    connectCadence: async (): Promise<SensorConnection> => {\n        if (typeof window !== 'undefined' && (window as any).useMockSensors) {\n            const { MockCadenceSensor } = await import('./mock.js');\n            const sensor = new MockCadenceSensor();\n            await sensor.connect();\n            (window as any).mockSensor = sensor;\n            return sensor;\n        }\n        if (Capacitor.isNativePlatform()) {\n            return connectCadenceNative();\n        } else {\n            return connectCadenceWeb();\n        }\n    },\n\n    /**\n     * Connect to a Treadmill\n     * @returns Promise resolving to a TreadmillConnection\n     */\n    connectTreadmill: async (): Promise<TreadmillConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectTreadmillNative();\n        } else {\n            return connectTreadmillWeb();\n        }\n    },\n\n    /**\n     * Connect to a Rowing Machine\n     * @returns Promise resolving to a RowerConnection\n     */\n    connectRowing: async (): Promise<RowerConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            throw new Error('Native rowing connection not implemented');\n        } else {\n            return connectRowingWeb();\n        }\n    }\n};\n","import { View } from '../router/View.js';\nimport { BluetoothFactory } from '../services/bluetooth/factory.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { ViewId } from '../router/view-ids.js';\n\nexport class DebugView implements View {\n    public id = ViewId.Debug;\n    private logArea: HTMLTextAreaElement | null = null;\n    private boundOnLog = this.onLog.bind(this);\n    private logBuffer: Array<{ timestamp: string, sensor: string, data: string }> = [];\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('debugTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n            this.setupEvents(container);\n        } else {\n            console.error('Debug template not found');\n            container.innerHTML = '<p>Error loading debug view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        BluetoothDebugService.addListener(this.boundOnLog);\n    }\n\n    public onLeave(): void {\n        BluetoothDebugService.removeListener(this.boundOnLog);\n    }\n\n    private onLog(sensor: string, hex: string) {\n        const timestamp = new Date().toISOString();\n        this.logBuffer.push({ timestamp, sensor, data: hex });\n\n        if (this.logArea) {\n            const timeDisplay = timestamp.split('T')[1].slice(0, -1);\n            this.logArea.value += `[${timeDisplay}] ${sensor}: ${hex}\\n`;\n            this.logArea.scrollTop = this.logArea.scrollHeight;\n        }\n    }\n\n    private setupEvents(container: HTMLElement): void {\n        this.logArea = container.querySelector('#debugLog');\n\n        const btnTreadmill = container.querySelector('#connectTreadmillDebug');\n        const btnRower = container.querySelector('#connectRowerDebug');\n        const btnDownload = container.querySelector('#downloadLogs');\n\n        btnTreadmill?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Treadmill...');\n                await BluetoothFactory.connectTreadmill();\n                this.log('System', 'Connected to Treadmill');\n            } catch (e) {\n                this.log('System', `Treadmill connection failed: ${e}`);\n            }\n        });\n\n        btnRower?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Rower...');\n                await BluetoothFactory.connectRowing();\n                this.log('System', 'Connected to Rower');\n            } catch (e) {\n                this.log('System', `Rower connection failed: ${e}`);\n            }\n        });\n\n        btnDownload?.addEventListener('click', () => {\n            this.downloadLocalLogs();\n        });\n    }\n\n    private downloadLocalLogs() {\n        const blob = new Blob([JSON.stringify(this.logBuffer, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `bpt-debug-session-${Date.now()}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n\n    private log(source: string, message: string) {\n        if (this.logArea) {\n            const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);\n            this.logArea.value += `[${timestamp}] ${source}: ${message}\\n`;\n            this.logArea.scrollTop = this.logArea.scrollHeight;\n        }\n    }\n}\n","/**\n * Navigation Bar Component\n * \n * Handles the bottom navigation bar.\n */\n\nimport { IRouter } from '../router/types.js';\nimport { ViewId } from '../router/view-ids.js';\n\nexport class NavBar {\n    private container: HTMLElement;\n    private router: IRouter;\n\n    constructor(router: IRouter) {\n        this.router = router;\n        this.container = document.createElement('nav');\n        this.container.id = 'bottom-nav';\n        this.container.className = 'bottom-nav';\n\n        // Mobile-first styles should be in CSS, but injecting basic structure here\n        this.render();\n        document.body.appendChild(this.container);\n\n        // Listen for route changes\n        window.addEventListener('route-changed', (e: Event) => {\n            const detail = (e as CustomEvent).detail;\n            this.setActive(detail.viewId);\n        });\n    }\n\n    private render(): void {\n        this.container.innerHTML = `\n            <button class=\"nav-item active\" data-target=\"${ViewId.Dashboard}\" data-testid=\"nav-dashboard\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Dashboard</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.History}\" data-testid=\"nav-history\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">History</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Workouts}\" data-testid=\"nav-workouts\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Workouts</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Plans}\" data-testid=\"nav-plans\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Plans</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Settings}\" data-testid=\"nav-settings\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Settings</span>\n            </button>\n        `;\n\n        this.container.querySelectorAll('.nav-item').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const target = (btn as HTMLElement).dataset.target;\n                if (target === ViewId.Dashboard) {\n                    this.router.navigate('/');\n                } else if (target) {\n                    this.router.navigate('/' + target);\n                }\n            });\n        });\n    }\n\n    public setActive(viewId: string): void {\n        this.container.querySelectorAll('.nav-item').forEach(btn => {\n            const target = (btn as HTMLElement).dataset.target;\n            if (target === viewId) {\n                btn.classList.add('active');\n                btn.setAttribute('aria-current', 'page');\n            } else {\n                btn.classList.remove('active');\n                btn.removeAttribute('aria-current');\n            }\n        });\n    }\n}\n","import { Router } from '../router/Router.js';\nimport { DashboardView } from '../views/DashboardView.js';\nimport { HistoryView } from '../views/HistoryView.js';\nimport { WorkoutsView } from '../views/WorkoutsView.js';\nimport { SettingsView } from '../views/SettingsView.js';\nimport { PlansView } from '../views/PlansView.js';\nimport { DebugView } from '../views/DebugView.js';\nimport { NavBar } from '../components/NavBar.js';\nimport { ViewId } from '../router/view-ids.js';\nimport { selectElement } from '../utils/dom.js';\n\n/**\n * Initializes the Router, registers Views, and sets up the Navigation Bar.\n */\nexport function setupRouter(): Router {\n    const router = new Router(selectElement('mainContent'));\n\n    const dashboardView = new DashboardView();\n    const historyView = new HistoryView();\n    const workoutsView = new WorkoutsView();\n    const settingsView = new SettingsView();\n    const plansView = new PlansView();\n    const debugView = new DebugView();\n\n    router.registerView(dashboardView);\n    router.registerView(historyView);\n    router.registerView(workoutsView);\n    router.registerView(settingsView);\n    router.registerView(plansView);\n    router.registerView(debugView);\n\n    router.addRoute('/', ViewId.Dashboard);\n    router.addRoute('/history', ViewId.History);\n    router.addRoute('/workouts', ViewId.Workouts);\n    router.addRoute('/plans', ViewId.Plans);\n    router.addRoute('/settings', ViewId.Settings);\n    router.addRoute('/debug', ViewId.Debug);\n\n    // Initialize Navigation Bar\n    new NavBar(router);\n\n    // Wire up Sidebar Settings Button (for mobile/hamburger menu)\n    const settingsButton = document.getElementById('settingsButton');\n    if (settingsButton) {\n        settingsButton.addEventListener('click', () => {\n            router.navigate('/settings');\n            // Close the details menu if open\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar Workouts Button\n    const workoutsButton = document.getElementById('workoutsButton');\n    if (workoutsButton) {\n        workoutsButton.addEventListener('click', () => {\n            router.navigate('/workouts');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar Plans Button\n    const plansButton = document.getElementById('plansButton');\n    if (plansButton) {\n        plansButton.addEventListener('click', () => {\n            router.navigate('/plans');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    return router;\n}\n","/**\n * Time formatting utilities\n * \n * @module getTimestring\n */\n\n/**\n * Converts milliseconds to a formatted time string (HH:MM:SS)\n * \n * @param milliseconds - Time duration in milliseconds\n * @returns Formatted time string in HH:MM:SS format\n * \n * @example\n * getTimestring(3661000) // \"01:01:01\"\n * getTimestring(0)       // \"00:00:00\"\n */\nexport const getTimestring = (milliseconds: number): string => {\n    const totalSeconds = Math.floor(milliseconds / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    return (\n        `${hours.toString().padStart(2, '0')}:` +\n        `${minutes.toString().padStart(2, '0')}:` +\n        `${seconds.toString().padStart(2, '0')}`\n    );\n};\n","import { getSettings } from '../config/settings.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Current workout metrics for announcements\n */\ninterface WorkoutMetrics {\n    power: number | null;\n    heartrate: number | null;\n    cadence: number | null;\n    speedKmh: number | null;\n    distanceKm: number | null;\n    elapsedMs: number;\n}\n\n/**\n * Calculate total distance from GPS points in km\n */\nfunction calculateTotalDistanceKm(gpsPoints: { lat: number; lon: number }[]): number {\n    if (gpsPoints.length < 2) return 0;\n\n    let totalMeters = 0;\n    const R = 6371000; // Earth radius in meters\n\n    for (let i = 1; i < gpsPoints.length; i++) {\n        const prev = gpsPoints[i - 1];\n        const curr = gpsPoints[i];\n\n        // Haversine formula\n        const lat1 = prev.lat * Math.PI / 180;\n        const lat2 = curr.lat * Math.PI / 180;\n        const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n        const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n        const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n            Math.cos(lat1) * Math.cos(lat2) *\n            Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n        totalMeters += R * c;\n    }\n\n    return totalMeters / 1000;\n}\n\nexport class VoiceFeedback {\n    private synth: SpeechSynthesis | null;\n    private voice: SpeechSynthesisVoice | null = null;\n    private measurementsState: MeasurementsState | null = null;\n    private timeState: TimeState | null = null;\n    private lastTimeIntervalMs: number = 0;\n    private lastDistanceIntervalKm: number = 0;\n    private checkInterval: ReturnType<typeof setInterval> | null = null;\n    private isActive: boolean = false;\n\n    constructor() {\n        if (typeof window !== 'undefined') {\n            this.synth = window.speechSynthesis || null;\n        } else {\n            this.synth = null;\n        }\n\n        if (!this.synth) {\n            console.warn('Speech Synthesis not supported on this device');\n            return;\n        }\n\n        // Wait for voices to be loaded\n        if (this.synth.onvoiceschanged !== undefined) {\n            this.synth.onvoiceschanged = () => this.loadVoice();\n        }\n        this.loadVoice();\n    }\n\n    /**\n     * Initialize with state references for enhanced announcements\n     */\n    init(measurementsState: MeasurementsState, timeState: TimeState): void {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Start interval-based announcements\n     */\n    startIntervalAnnouncements(): void {\n        if (this.isActive || !this.measurementsState || !this.timeState) {\n            return;\n        }\n\n        const settings = getSettings();\n        if (settings.enhancedVoice.timeIntervalMinutes === 0 &&\n            settings.enhancedVoice.distanceIntervalKm === 0) {\n            return;\n        }\n\n        this.isActive = true;\n        this.lastTimeIntervalMs = 0;\n        this.lastDistanceIntervalKm = 0;\n\n        // Check every second\n        this.checkInterval = setInterval(() => this.checkIntervalAnnouncements(), 1000);\n\n        console.log('Enhanced voice announcements started');\n    }\n\n    /**\n     * Stop interval-based announcements\n     */\n    stopIntervalAnnouncements(): void {\n        if (this.checkInterval) {\n            clearInterval(this.checkInterval);\n            this.checkInterval = null;\n        }\n        this.isActive = false;\n        this.lastTimeIntervalMs = 0;\n        this.lastDistanceIntervalKm = 0;\n    }\n\n    /**\n     * Reset state\n     */\n    reset(): void {\n        this.stopIntervalAnnouncements();\n    }\n\n    private loadVoice(): void {\n        if (!this.synth) return;\n\n        const voices = this.synth.getVoices();\n        // Prefer English voices\n        this.voice = voices.find(v => v.lang.startsWith('en')) || voices[0] || null;\n    }\n\n    private formatTimeForSpeech(ms: number): string {\n        const totalSeconds = Math.floor(ms / 1000);\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = totalSeconds % 60;\n\n        const parts = [];\n        if (hours > 0) parts.push(`${hours} hour${hours !== 1 ? 's' : ''}`);\n        if (minutes > 0) parts.push(`${minutes} minute${minutes !== 1 ? 's' : ''}`);\n        if (seconds > 0 || parts.length === 0) parts.push(`${seconds} second${seconds !== 1 ? 's' : ''}`);\n\n        return parts.join(' ');\n    }\n\n    private formatTimeShort(ms: number): string {\n        const totalSeconds = Math.floor(ms / 1000);\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n\n        if (hours > 0) {\n            return `${hours} hour${hours !== 1 ? 's' : ''} ${minutes} minute${minutes !== 1 ? 's' : ''}`;\n        }\n        return `${minutes} minute${minutes !== 1 ? 's' : ''}`;\n    }\n\n    public speak(text: string): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceEnabled) return;\n\n        if (this.synth.speaking) {\n            this.synth.cancel();\n        }\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        if (this.voice) {\n            utterance.voice = this.voice;\n        }\n\n        // Apply speech rate\n        utterance.rate = settings.enhancedVoice.speechRate;\n\n        this.synth.speak(utterance);\n    }\n\n    public announceLap(lapNumber: number, timeMs: number, avgPower: number): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceLaps) return;\n\n        const timeStr = this.formatTimeForSpeech(timeMs);\n        const text = `Lap ${lapNumber}. Time ${timeStr}. Average Power ${Math.round(avgPower)} watts.`;\n        this.speak(text);\n    }\n\n    public announceZoneChange(zoneName: string): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceZones) return;\n\n        const text = `Entering ${zoneName} Zone`;\n        this.speak(text);\n    }\n\n    public announceCountdown(count: number): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.countdown.enableVoice) return;\n\n        const text = count === 0 ? 'Go!' : `${count}`;\n        this.speak(text);\n    }\n\n    /**\n     * Check if interval-based announcements should be triggered\n     */\n    private checkIntervalAnnouncements(): void {\n        if (!this.measurementsState || !this.timeState || !this.timeState.running) {\n            return;\n        }\n\n        const settings = getSettings();\n\n        // Check time-based announcements\n        if (settings.enhancedVoice.timeIntervalMinutes > 0) {\n            this.checkTimeAnnouncement(settings.enhancedVoice.timeIntervalMinutes);\n        }\n\n        // Check distance-based announcements\n        if (settings.enhancedVoice.distanceIntervalKm > 0) {\n            this.checkDistanceAnnouncement(settings.enhancedVoice.distanceIntervalKm);\n        }\n    }\n\n    /**\n     * Check for time-based announcements\n     */\n    private checkTimeAnnouncement(intervalMinutes: number): void {\n        if (!this.timeState || !this.timeState.startTime) return;\n\n        const elapsedMs = Date.now() - this.timeState.startTime;\n        const intervalMs = intervalMinutes * 60 * 1000;\n\n        const currentInterval = Math.floor(elapsedMs / intervalMs);\n        const lastInterval = Math.floor(this.lastTimeIntervalMs / intervalMs);\n\n        if (currentInterval > lastInterval && elapsedMs > 0) {\n            this.announceCurrentMetrics('time');\n            this.lastTimeIntervalMs = elapsedMs;\n        }\n    }\n\n    /**\n     * Check for distance-based announcements\n     */\n    private checkDistanceAnnouncement(intervalKm: number): void {\n        if (!this.measurementsState) return;\n\n        const totalKm = calculateTotalDistanceKm(this.measurementsState.gps);\n\n        const currentInterval = Math.floor(totalKm / intervalKm);\n        const lastInterval = Math.floor(this.lastDistanceIntervalKm / intervalKm);\n\n        if (currentInterval > lastInterval && totalKm > 0) {\n            this.announceCurrentMetrics('distance');\n            this.lastDistanceIntervalKm = totalKm;\n        }\n    }\n\n    /**\n     * Get current workout metrics\n     */\n    private getCurrentMetrics(): WorkoutMetrics {\n        const metrics: WorkoutMetrics = {\n            power: null,\n            heartrate: null,\n            cadence: null,\n            speedKmh: null,\n            distanceKm: null,\n            elapsedMs: 0,\n        };\n\n        if (!this.measurementsState || !this.timeState) return metrics;\n\n        // Get latest values (within last 5 seconds)\n        const now = Date.now();\n        const recentThreshold = now - 5000;\n\n        // Power\n        const recentPower = this.measurementsState.power.filter(p => p.timestamp > recentThreshold);\n        if (recentPower.length > 0) {\n            metrics.power = Math.round(recentPower[recentPower.length - 1].value);\n        }\n\n        // Heart rate\n        const recentHr = this.measurementsState.heartrate.filter(h => h.timestamp > recentThreshold);\n        if (recentHr.length > 0) {\n            metrics.heartrate = Math.round(recentHr[recentHr.length - 1].value);\n        }\n\n        // Cadence\n        const recentCadence = this.measurementsState.cadence.filter(c => c.timestamp > recentThreshold);\n        if (recentCadence.length > 0) {\n            metrics.cadence = Math.round(recentCadence[recentCadence.length - 1].value);\n        }\n\n        // Speed\n        const recentSpeed = this.measurementsState.speed.filter(s => s.timestamp > recentThreshold);\n        if (recentSpeed.length > 0) {\n            metrics.speedKmh = Math.round(recentSpeed[recentSpeed.length - 1].value * 10) / 10;\n        }\n\n        // Distance\n        metrics.distanceKm = Math.round(calculateTotalDistanceKm(this.measurementsState.gps) * 100) / 100;\n\n        // Elapsed time\n        if (this.timeState.startTime) {\n            metrics.elapsedMs = now - this.timeState.startTime;\n        }\n\n        return metrics;\n    }\n\n    /**\n     * Announce current metrics based on settings\n     */\n    private announceCurrentMetrics(trigger: 'time' | 'distance'): void {\n        const settings = getSettings();\n        const metricsSettings = settings.enhancedVoice.metrics;\n        const metrics = this.getCurrentMetrics();\n\n        const parts: string[] = [];\n\n        // Start with the trigger announcement\n        if (trigger === 'time' && metricsSettings.time) {\n            parts.push(this.formatTimeShort(metrics.elapsedMs));\n        } else if (trigger === 'distance' && metricsSettings.distance && metrics.distanceKm !== null) {\n            parts.push(`${metrics.distanceKm.toFixed(1)} kilometers`);\n        }\n\n        // Add other metrics based on settings\n        if (metricsSettings.power && metrics.power !== null) {\n            parts.push(`power ${metrics.power} watts`);\n        }\n\n        if (metricsSettings.heartrate && metrics.heartrate !== null) {\n            parts.push(`heart rate ${metrics.heartrate}`);\n        }\n\n        if (metricsSettings.speed && metrics.speedKmh !== null) {\n            parts.push(`speed ${metrics.speedKmh.toFixed(1)} k p h`);\n        }\n\n        if (metricsSettings.cadence && metrics.cadence !== null) {\n            parts.push(`cadence ${metrics.cadence}`);\n        }\n\n        // Include distance if not already the trigger\n        if (trigger === 'time' && metricsSettings.distance && metrics.distanceKm !== null && metrics.distanceKm > 0) {\n            parts.push(`distance ${metrics.distanceKm.toFixed(1)} kilometers`);\n        }\n\n        // Include time if not already the trigger\n        if (trigger === 'distance' && metricsSettings.time) {\n            parts.push(`time ${this.formatTimeShort(metrics.elapsedMs)}`);\n        }\n\n        if (parts.length > 0) {\n            const text = parts.join('. ') + '.';\n            this.speak(text);\n            console.log(`Voice announcement (${trigger}): ${text}`);\n        }\n    }\n}\n\nexport const voiceFeedback = new VoiceFeedback();\n","/**\n * Workout Countdown Overlay\n * \n * Shows a countdown before starting a workout.\n * Supports visual, audio (beep), and voice announcements.\n * \n * @module ui/countdown\n */\n\nimport { getSettings } from '../config/settings.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport { announce } from './accessibility.js';\n\n/**\n * Show countdown overlay and execute callback when complete\n * \n * @param onComplete - Callback to execute after countdown finishes\n * @returns Promise that resolves when countdown is complete or cancelled\n */\nexport async function showCountdown(onComplete: () => void): Promise<void> {\n    const settings = getSettings();\n    const duration = settings.countdown.duration;\n\n    // If countdown is disabled (duration = 0), immediately execute callback\n    if (duration === 0) {\n        onComplete();\n        return;\n    }\n\n    return new Promise((resolve) => {\n        // Create overlay\n        const overlay = createCountdownOverlay();\n        document.body.appendChild(overlay);\n\n        let currentCount = duration;\n        let intervalId: number;\n        let isCancelled = false;\n\n        // Update display\n        const updateDisplay = (count: number) => {\n            const countElement = overlay.querySelector('.countdown__number') as HTMLElement;\n            if (countElement) {\n                countElement.textContent = count === 0 ? 'GO!' : count.toString();\n                countElement.className = 'countdown__number';\n\n                // Add animation class\n                requestAnimationFrame(() => {\n                    countElement.classList.add('countdown__number--pulse');\n                });\n            }\n\n            // Voice announcement\n            if (settings.countdown.enableVoice) {\n                voiceFeedback.announceCountdown(count);\n            }\n\n            // Beep sound\n            if (settings.countdown.enableBeep) {\n                playBeep(count === 0);\n            }\n\n            // Screen reader announcement\n            const text = count === 0 ? 'Go! Workout starting' : `${count}`;\n            announce(text, 'assertive');\n        };\n\n        // Cancel button handler\n        const cancelBtn = overlay.querySelector('.countdown__cancel') as HTMLButtonElement;\n        const handleCancel = () => {\n            isCancelled = true;\n            clearInterval(intervalId);\n            document.body.removeChild(overlay);\n            announce('Countdown cancelled', 'assertive');\n            resolve();\n        };\n        cancelBtn?.addEventListener('click', handleCancel);\n\n        // ESC key to cancel\n        const handleKeydown = (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                handleCancel();\n                document.removeEventListener('keydown', handleKeydown);\n            }\n        };\n        document.addEventListener('keydown', handleKeydown);\n\n        // Start countdown\n        updateDisplay(currentCount);\n\n        intervalId = window.setInterval(() => {\n            currentCount--;\n\n            if (currentCount >= 0) {\n                updateDisplay(currentCount);\n            }\n\n            if (currentCount < 0) {\n                clearInterval(intervalId);\n                document.removeEventListener('keydown', handleKeydown);\n\n                if (!isCancelled) {\n                    // Remove overlay\n                    document.body.removeChild(overlay);\n\n                    // Execute callback\n                    onComplete();\n                }\n\n                resolve();\n            }\n        }, 1000);\n    });\n}\n\n/**\n * Create countdown overlay DOM element\n */\nfunction createCountdownOverlay(): HTMLElement {\n    const overlay = document.createElement('div');\n    overlay.className = 'countdown-overlay';\n    overlay.setAttribute('role', 'alertdialog');\n    overlay.setAttribute('aria-labelledby', 'countdownTitle');\n    overlay.setAttribute('aria-live', 'assertive');\n\n    overlay.innerHTML = `\n        <div class=\"countdown__backdrop\"></div>\n        <div class=\"countdown__content\">\n            <h2 id=\"countdownTitle\" class=\"countdown__title\">Get Ready!</h2>\n            <div class=\"countdown__number\"></div>\n            <button class=\"countdown__cancel\" aria-label=\"Cancel countdown\">\n                Cancel (ESC)\n            </button>\n        </div>\n    `;\n\n    return overlay;\n}\n\n/**\n * Play a beep sound using Web Audio API\n * \n * @param isFinal - If true, plays a higher-pitched \"go\" beep\n */\nfunction playBeep(isFinal: boolean = false): void {\n    try {\n        const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n        const oscillator = audioContext.createOscillator();\n        const gainNode = audioContext.createGain();\n\n        oscillator.connect(gainNode);\n        gainNode.connect(audioContext.destination);\n\n        // Frequency: Higher for final beep\n        oscillator.frequency.value = isFinal ? 880 : 440; // A5 or A4\n        oscillator.type = 'sine';\n\n        // Volume envelope\n        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\n\n        oscillator.start(audioContext.currentTime);\n        oscillator.stop(audioContext.currentTime + 0.1);\n    } catch (error) {\n        console.warn('Failed to play beep:', error);\n    }\n}\n","/**\n * Timer Display Initialization\n *\n * Sets up the workout timer display and Garmin-style workout controls.\n *\n * Workout states:\n * - Idle: Not started, show Start button\n * - Recording: Timer running, show Pause button\n * - Paused: Timer paused, show Resume and Stop buttons\n *\n * @module time\n */\n\nimport { getTimestring } from '../getTimestring.js';\nimport { announce, updateWorkoutControlsAccessibility } from './accessibility.js';\nimport { onWorkoutStart, onWorkoutPause } from './workoutPlayer.js';\nimport { showNotification } from './notifications.js';\nimport { showCountdown } from './countdown.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Workout state enum for clarity\n */\nexport type WorkoutState = 'idle' | 'recording' | 'paused';\n\n/**\n * Get the current workout state from time state\n */\nexport function getWorkoutState(timeState: TimeState): WorkoutState {\n    if (!timeState.startTime) {\n        return 'idle';\n    }\n    if (timeState.running) {\n        return 'recording';\n    }\n    return 'paused';\n}\n\n/**\n * Workout control button elements\n */\ninterface WorkoutControlElements {\n    startButton: HTMLButtonElement;\n    pauseButton: HTMLButtonElement;\n    resumeButton: HTMLButtonElement;\n    stopButton: HTMLButtonElement;\n}\n\n/**\n * Update button visibility based on workout state\n */\nfunction updateButtonVisibility(\n    elements: WorkoutControlElements,\n    state: WorkoutState\n): void {\n    const { startButton, pauseButton, resumeButton, stopButton } = elements;\n\n    // Hide all buttons first\n    startButton.style.display = 'none';\n    pauseButton.style.display = 'none';\n    resumeButton.style.display = 'none';\n    stopButton.style.display = 'none';\n\n    switch (state) {\n        case 'idle':\n            startButton.style.display = 'inline-flex';\n            break;\n        case 'recording':\n            pauseButton.style.display = 'inline-flex';\n            break;\n        case 'paused':\n            resumeButton.style.display = 'inline-flex';\n            stopButton.style.display = 'inline-flex';\n            break;\n    }\n}\n\n/** Module-level reference to control elements for programmatic access */\nlet workoutControlElements: WorkoutControlElements | null = null;\n\n/**\n * Programmatically pause the workout (used by AutoPauseService)\n * @param timeState - The workout time state object\n * @param isAutoPause - Whether this is triggered by auto-pause (shows notification)\n */\nexport function pauseWorkout(timeState: TimeState, isAutoPause = false): void {\n    if (!timeState.running || !timeState.startTime) {\n        return;\n    }\n\n    timeState.running = false;\n    timeState.endTime = Date.now();\n\n    onWorkoutPause();\n\n    if (workoutControlElements) {\n        updateButtonVisibility(workoutControlElements, 'paused');\n    }\n    updateWorkoutControlsAccessibility('paused');\n\n    if (isAutoPause) {\n        showNotification(' Auto-paused', 'info');\n        announce('Auto paused due to low activity', 'polite');\n    } else {\n        announce('Workout paused. Press resume to continue or stop to save.', 'assertive');\n    }\n}\n\n/**\n * Programmatically resume the workout (used by AutoPauseService)\n * @param timeState - The workout time state object\n * @param isAutoResume - Whether this is triggered by auto-resume (shows notification)\n */\nexport function resumeWorkout(timeState: TimeState, isAutoResume = false): void {\n    if (timeState.running || !timeState.startTime) {\n        return;\n    }\n\n    if (timeState.endTime && timeState.startTime) {\n        // Adjust startTime to account for paused duration\n        const pausedDuration = Date.now() - timeState.endTime;\n        timeState.startTime += pausedDuration;\n    }\n    timeState.endTime = null;\n    timeState.running = true;\n\n    onWorkoutStart();\n\n    if (workoutControlElements) {\n        updateButtonVisibility(workoutControlElements, 'recording');\n    }\n    updateWorkoutControlsAccessibility('recording');\n\n    if (isAutoResume) {\n        showNotification(' Auto-resumed', 'info');\n        announce('Auto resumed', 'polite');\n    } else {\n        announce('Workout resumed', 'assertive');\n    }\n}\n\n/**\n * Initialize the timer display and Garmin-style workout controls.\n *\n * Sets up:\n * - Timer display that updates every 100ms\n * - Start button to begin a new workout\n * - Pause button to pause recording\n * - Resume button to continue a paused workout\n * - Stop button to end and save the workout\n * - Visual state changes for workout status\n *\n * @param timeState - The workout time state object\n */\nexport const initTimerDisplay = (timeState: TimeState): void => {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n\n    if (!startButton || !pauseButton || !resumeButton || !stopButton || !timeElement) {\n        console.warn('Workout control elements not found in DOM');\n        return;\n    }\n\n    const elements: WorkoutControlElements = {\n        startButton,\n        pauseButton,\n        resumeButton,\n        stopButton,\n    };\n\n    // Store reference for programmatic access\n    workoutControlElements = elements;\n\n    // Update timer display every 100ms\n    setInterval(() => {\n        let nextText = '00:00:00';\n\n        if (timeState.startTime && timeState.running) {\n            const elapsedMs = Date.now() - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        } else if (timeState.startTime && timeState.endTime) {\n            const elapsedMs = timeState.endTime - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        }\n\n        if (timeElement.textContent !== nextText) {\n            timeElement.textContent = nextText;\n        }\n    }, 100);\n\n    // Initialize button visibility\n    updateButtonVisibility(elements, getWorkoutState(timeState));\n\n    // Helper to add robust touch/click listeners\n    const addListener = (btn: HTMLButtonElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            e.preventDefault();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    // Handle Start button click - begin new workout with countdown\n    addListener(startButton, () => {\n        console.log('[time.ts] Start button clicked');\n\n        // Show countdown overlay (if enabled), then start workout\n        showCountdown(() => {\n            timeState.startTime = Date.now();\n            timeState.endTime = null;\n            timeState.running = true;\n\n            onWorkoutStart();\n\n            updateButtonVisibility(elements, 'recording');\n            updateWorkoutControlsAccessibility('recording');\n            announce('Workout started', 'assertive');\n\n            // Dispatch event so auto-pause service can start monitoring\n            document.dispatchEvent(new CustomEvent('workoutStarted'));\n        });\n    });\n\n    // Handle Pause button click - pause recording\n    addListener(pauseButton, () => {\n        pauseWorkout(timeState, false);\n    });\n\n    // Handle Resume button click - continue paused workout\n    addListener(resumeButton, () => {\n        resumeWorkout(timeState, false);\n    });\n\n    // Handle Stop button click - end and save workout\n    addListener(stopButton, () => {\n        // Keep endTime as is (already set when paused)\n        // Reset to idle state for next workout\n        timeState.running = false;\n\n        onWorkoutPause();\n\n        updateButtonVisibility(elements, 'paused');\n        updateWorkoutControlsAccessibility('paused');\n        announce('Workout stopped and saved. Press resume to continue or export your data.', 'assertive');\n\n        // Dispatch custom event for workout completion\n        const workoutCompleteEvent = new CustomEvent('workoutComplete', {\n            detail: {\n                startTime: timeState.startTime,\n                endTime: timeState.endTime,\n                duration: timeState.endTime && timeState.startTime\n                    ? timeState.endTime - timeState.startTime\n                    : 0,\n            },\n        });\n        document.dispatchEvent(workoutCompleteEvent);\n    });\n};\n\n/**\n * Reset workout to idle state\n *\n * @param timeState - The workout time state object\n */\nexport function resetWorkout(timeState: TimeState): void {\n    timeState.startTime = null;\n    timeState.endTime = null;\n    timeState.running = false;\n\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton && pauseButton && resumeButton && stopButton) {\n        updateButtonVisibility(\n            { startButton, pauseButton, resumeButton, stopButton },\n            'idle'\n        );\n        updateWorkoutControlsAccessibility('idle');\n    }\n\n    announce('Workout reset', 'polite');\n}\n","/**\n * Measurement merging utilities\n * \n * Combines heart rate, cadence, and power measurements into synchronized data points.\n * \n * @module merge-measurements\n */\n\nimport type { Measurement, MeasurementsData } from './types/measurements.js';\n\n/**\n * A merged data point containing all measurement types at a single timestamp\n */\nexport interface MergedDataPoint {\n    timestamp: number;\n    heartrate: number | null;\n    cadence: number | null;\n    power: number | null;\n    speed: number | null;\n    distance: number | null;\n    altitude: number | null;\n    lat: number | null;\n    lon: number | null;\n    energy: number | null;\n}\n\n/**\n * Gets values from a measurement array at specific timestamps.\n * Uses nearest-neighbor interpolation with a 1000ms threshold.\n * \n * @param arr - Array of measurements sorted by timestamp\n * @param timestamps - Array of target timestamps to find values for\n * @returns Array of values (or null if no measurement within threshold)\n */\nexport const getValuesAtTimestamps = (\n    arr: Measurement[],\n    timestamps: number[]\n): (number | null)[] => {\n    const entries: (number | null)[] = [];\n    let index = 0;\n\n    for (const ts of timestamps) {\n        // Find the first measurement at or after the target timestamp\n        while (index < arr.length && arr[index].timestamp < ts) {\n            index++;\n        }\n\n        const prevIndex = index - 1;\n        let suggestedElem: Measurement | undefined = undefined;\n        const isAfterLastPoint = index >= arr.length;\n\n        if (prevIndex < 0) {\n            // Before first measurement - use first if available\n            suggestedElem = arr[index];\n        } else if (isAfterLastPoint) {\n            // After last measurement - use last\n            suggestedElem = arr[prevIndex];\n        } else {\n            // Between measurements - use nearest\n            const prevTime = arr[prevIndex]?.timestamp ?? 0;\n            const nextTime = arr[index]?.timestamp ?? 0;\n            suggestedElem = (ts - prevTime) <= (nextTime - ts) ? arr[prevIndex] : arr[index];\n        }\n\n        if (suggestedElem?.timestamp !== undefined) {\n            const distance = Math.abs(suggestedElem.timestamp - ts);\n            // Values must be strictly less than 1000ms away\n            if (distance < 1000) {\n                entries.push(suggestedElem.value);\n            } else {\n                entries.push(null);\n            }\n        } else {\n            entries.push(null);\n        }\n    }\n\n    return entries;\n};\n\n/**\n * Merges heart rate, cadence, and power measurements into synchronized data points.\n * \n * Creates a timeline with 1-second intervals from the earliest to the latest measurement,\n * then maps each measurement type to the nearest value at each timestamp.\n * \n * @param measurements - Object containing heartrate, cadence, and power measurement arrays\n * @returns Array of merged data points with all measurement types\n * \n * @example\n * const merged = mergeMeasurements({\n *   heartrate: [{ timestamp: 1000, value: 120 }],\n *   cadence: [{ timestamp: 1000, value: 80 }],\n *   power: [{ timestamp: 1000, value: 200 }]\n * });\n * // Returns: [{ timestamp: 1000, heartrate: 120, cadence: 80, power: 200 }]\n */\nexport const mergeMeasurements = (measurements: MeasurementsData): MergedDataPoint[] => {\n    // Convert GPS points to measurements for interpolation\n    const latMeasurements: Measurement[] = measurements.gps.map(p => ({ timestamp: p.timestamp, value: p.lat }));\n    const lonMeasurements: Measurement[] = measurements.gps.map(p => ({ timestamp: p.timestamp, value: p.lon }));\n    const energyData: Measurement[] = measurements.energy || [];\n\n    const sources = [\n        measurements.heartrate,\n        measurements.cadence,\n        measurements.power,\n        measurements.speed,\n        measurements.distance,\n        measurements.altitude,\n        latMeasurements,\n        energyData,\n    ];\n    const hasData = sources.some(data => data.length > 0);\n\n    if (!hasData) {\n        return [];\n    }\n\n    // Find the time range\n    const firstTimestamps = sources.map(data => data.length > 0 ? data[0].timestamp : Infinity);\n    const startTime = Math.min(...firstTimestamps);\n    const endTime = Math.max(\n        ...sources.map(data => data.length > 0 ? data[data.length - 1].timestamp : -Infinity)\n    );\n\n    // Create timestamps at 1-second intervals\n    const timeStep = 1000;\n    const timestamps: number[] = [];\n    let time = startTime;\n\n    while (time <= endTime) {\n        timestamps.push(time);\n        time += timeStep;\n    }\n\n    // Get synchronized values for each measurement type\n    const syncedHR = getValuesAtTimestamps(measurements.heartrate, timestamps);\n    const syncedCadence = getValuesAtTimestamps(measurements.cadence, timestamps);\n    const syncedPower = getValuesAtTimestamps(measurements.power, timestamps);\n    const syncedSpeed = getValuesAtTimestamps(measurements.speed, timestamps);\n    const syncedDistance = getValuesAtTimestamps(measurements.distance, timestamps);\n    const syncedAltitude = getValuesAtTimestamps(measurements.altitude, timestamps);\n    const syncedLat = getValuesAtTimestamps(latMeasurements, timestamps);\n    const syncedLon = getValuesAtTimestamps(lonMeasurements, timestamps);\n    const syncedEnergy = getValuesAtTimestamps(energyData, timestamps);\n\n    // Combine into data points\n    const dataPoints: MergedDataPoint[] = [];\n\n    for (let i = 0; i < timestamps.length; i++) {\n        dataPoints.push({\n            timestamp: timestamps[i],\n            heartrate: syncedHR[i],\n            cadence: syncedCadence[i],\n            power: syncedPower[i],\n            speed: syncedSpeed[i],\n            distance: syncedDistance[i],\n            altitude: syncedAltitude[i],\n            lat: syncedLat[i],\n            lon: syncedLon[i],\n            energy: syncedEnergy[i],\n        });\n    }\n\n    return dataPoints;\n};\n","/**\n * CSV export utilities\n * \n * @module create-csv\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData, LapMarker } from './types/measurements.js';\n\n/**\n * Determines which lap a timestamp belongs to\n */\nfunction getLapNumber(timestamp: number, laps: LapMarker[]): number {\n    if (laps.length === 0) return 1;\n\n    let lapNumber = 1;\n    for (const lap of laps) {\n        if (timestamp >= lap.timestamp) {\n            lapNumber = lap.number + 1;\n        } else {\n            break;\n        }\n    }\n    return lapNumber;\n}\n\n/**\n * Creates a CSV string from workout measurements.\n * \n * Merges all measurement types (heart rate, cadence, power) into synchronized\n * data points and exports them as a CSV file with ISO timestamps.\n * Includes lap number for each data point.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns CSV formatted string with header row\n * \n * @example\n * const csv = getCsvString(measurementsState);\n * // Returns:\n * // \"timestamp,lap,power,cadence,heartrate,speed,distance,altitude,lat,lon\n * //  2024-01-01T00:00:00.000Z,1,200,80,120,25.5,1000,100,52.123456,5.123456\n * //  ...\"\n */\nexport const getCsvString = (measurements: MeasurementsData): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    const laps = measurements.laps || [];\n\n    // CSV header - now includes lap column\n    const header = 'timestamp,lap,power,cadence,heartrate,speed,distance,altitude,lat,lon';\n\n    // Convert each data point to CSV row\n    const rows = dataPoints.map((point: MergedDataPoint) => {\n        const timestamp = new Date(point.timestamp).toISOString();\n        const lap = getLapNumber(point.timestamp, laps);\n        const power = point.power !== null ? Math.round(point.power) : '';\n        const cadence = point.cadence !== null ? Math.round(point.cadence) : '';\n        const heartrate = point.heartrate !== null ? Math.round(point.heartrate) : '';\n        const speed = point.speed !== null ? point.speed.toFixed(1) : '';\n        const distance = point.distance !== null ? Math.round(point.distance) : '';\n        const altitude = point.altitude !== null ? Math.round(point.altitude) : '';\n        const lat = point.lat !== null ? point.lat.toFixed(6) : '';\n        const lon = point.lon !== null ? point.lon.toFixed(6) : '';\n\n        return `${timestamp},${lap},${power},${cadence},${heartrate},${speed},${distance},${altitude},${lat},${lon}`;\n    });\n\n    return [header, ...rows].join('\\n');\n};\n","/**\n * TCX (Training Center XML) export utilities\n * \n * Creates Garmin-compatible TCX files from workout measurements.\n * \n * @module create-tcx\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData, LapMarker } from './types/measurements.js';\nimport type { SportType } from './config/sport.js';\n\n/**\n * Map internal sport type to TCX Sport attribute\n * TCX supports: Running, Biking, Other\n */\nfunction getTcxSport(sport?: SportType): string {\n    switch (sport) {\n        case 'running':\n            return 'Running';\n        case 'walking':\n            return 'Other'; // TCX doesn't have Walking, use Other\n        case 'cycling':\n        default:\n            return 'Biking';\n    }\n}\n\n/**\n * Creates heart rate XML element\n */\nconst hrString = (hr: number | null): string =>\n    hr !== null ? `<HeartRateBpm><Value>${Math.round(hr)}</Value></HeartRateBpm>` : '';\n\n/**\n * Creates cadence XML element\n */\nconst cadenceString = (cadence: number | null): string =>\n    cadence !== null ? `<Cadence>${Math.round(cadence)}</Cadence>` : '';\n\n/**\n * Creates power XML element using Garmin extension format\n */\nconst powerString = (power: number | null): string => {\n    if (power === null) return '';\n    return `<Extensions>\n              <TPX xmlns=\"http://www.garmin.com/xmlschemas/ActivityExtension/v2\">\n                <Watts>${Math.round(power)}</Watts>\n              </TPX>\n            </Extensions>`;\n};\n\n/**\n * Creates a TCX trackpoint element from a merged data point\n * \n * @param point - Merged data point with timestamp and measurements\n * @returns TCX Trackpoint XML string\n */\nconst getTcxTrackpoint = (point: MergedDataPoint): string => {\n    const timestamp = new Date(point.timestamp).toISOString();\n\n    // Order matters in TCX schema: Time, Position, Altitude, Distance, HeartRate, Cadence, Extensions\n\n    let position = '';\n    if (point.lat !== null && point.lon !== null) {\n        position = `\n        <Position>\n            <LatitudeDegrees>${point.lat}</LatitudeDegrees>\n            <LongitudeDegrees>${point.lon}</LongitudeDegrees>\n        </Position>`;\n    }\n\n    let altitude = '';\n    if (point.altitude !== null) {\n        altitude = `<AltitudeMeters>${point.altitude}</AltitudeMeters>`;\n    }\n\n    let distance = '';\n    if (point.distance !== null) {\n        distance = `<DistanceMeters>${point.distance}</DistanceMeters>`;\n    }\n\n    const parts: string[] = [];\n\n    if (point.heartrate !== null) {\n        parts.push(hrString(point.heartrate));\n    }\n\n    if (point.cadence !== null) {\n        parts.push(cadenceString(point.cadence));\n    }\n\n    if (point.power !== null) {\n        parts.push(powerString(point.power));\n    }\n\n    return `\n<Trackpoint>\n    <Time>${timestamp}</Time>\n    ${position}\n    ${altitude}\n    ${distance}\n    ${parts.join('\\n')}\n</Trackpoint>\n    `.trim();\n};\n\n/**\n * Creates a Garmin TCX (Training Center XML) string from workout measurements.\n * \n * TCX is a standard format supported by most fitness platforms including\n * Strava, Garmin Connect, and TrainingPeaks.\n * \n * @param measurements - The measurements data object containing workout data\n * @param sport - Optional sport type for the activity (defaults to cycling)\n * @returns TCX formatted XML string\n * \n * @example\n * const tcx = getTcxString(measurementsState, 'running');\n * // Returns a valid TCX XML document with Running sport type\n */\nexport const getTcxString = (measurements: MeasurementsData, sport?: SportType): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const startDate = new Date(firstTimestamp).toISOString();\n\n    // Build lap boundaries based on lap markers\n    const laps = measurements.laps || [];\n    const lapBoundaries = buildLapBoundaries(firstTimestamp, lastTimestamp, laps);\n\n    // Generate TCX lap elements\n    const lapElements = lapBoundaries.map((boundary, _index) => {\n        const lapDataPoints = dataPoints.filter(\n            p => p.timestamp >= boundary.start && p.timestamp < boundary.end\n        );\n\n        if (lapDataPoints.length === 0) return '';\n\n        const lapStartDate = new Date(boundary.start).toISOString();\n        const totalTimeSeconds = Math.round((boundary.end - boundary.start) / 1000);\n\n        // Calculate lap statistics\n        const avgHr = calculateAverage(lapDataPoints.map(p => p.heartrate));\n        const maxHr = calculateMax(lapDataPoints.map(p => p.heartrate));\n        const avgCadence = calculateAverage(lapDataPoints.map(p => p.cadence));\n        const avgPower = calculateAverage(lapDataPoints.map(p => p.power));\n\n        // Get distance if available\n        const distancePoints = lapDataPoints.filter(p => p.distance !== null);\n        const totalDistance = distancePoints.length > 0\n            ? (distancePoints[distancePoints.length - 1].distance! - (distancePoints[0].distance || 0))\n            : 0;\n\n        const validEnergyValues = lapDataPoints.filter(p => p.energy !== null);\n        const totalCalories = validEnergyValues.length > 0\n            ? (validEnergyValues[validEnergyValues.length - 1].energy! - (validEnergyValues[0].energy || 0))\n            : 0;\n\n        return `\n                <Lap StartTime=\"${lapStartDate}\">\n                    <TotalTimeSeconds>${totalTimeSeconds}</TotalTimeSeconds>\n                    <DistanceMeters>${Math.round(totalDistance)}</DistanceMeters>\n                    <Calories>${Math.round(totalCalories)}</Calories>\n                    ${avgHr !== null ? `<AverageHeartRateBpm><Value>${Math.round(avgHr)}</Value></AverageHeartRateBpm>` : ''}\n                    ${maxHr !== null ? `<MaximumHeartRateBpm><Value>${Math.round(maxHr)}</Value></MaximumHeartRateBpm>` : ''}\n                    <Intensity>Active</Intensity>\n                    <TriggerMethod>${boundary.isManual ? 'Manual' : 'Distance'}</TriggerMethod>\n                    ${avgCadence !== null ? `<Cadence>${Math.round(avgCadence)}</Cadence>` : ''}\n                    <Extensions>\n                        <LX xmlns=\"http://www.garmin.com/xmlschemas/ActivityExtension/v2\">\n                            ${avgPower !== null ? `<AvgWatts>${Math.round(avgPower)}</AvgWatts>` : ''}\n                        </LX>\n                    </Extensions>\n                    <Track>\n${lapDataPoints.map(getTcxTrackpoint).join('\\n')}\n                    </Track>\n                </Lap>`;\n    });\n\n    const tcxSport = getTcxSport(sport);\n    const tcx = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <TrainingCenterDatabase xmlns=\"http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2\">\n        <Activities>\n            <Activity Sport=\"${tcxSport}\">\n                <Id>${startDate}</Id>\n${lapElements.join('\\n')}\n            </Activity>\n        </Activities>\n    </TrainingCenterDatabase>`;\n\n    return tcx;\n};\n\n/**\n * Build lap boundaries from lap markers\n */\ninterface LapBoundary {\n    start: number;\n    end: number;\n    isManual: boolean;\n}\n\nfunction buildLapBoundaries(firstTimestamp: number, lastTimestamp: number, laps: LapMarker[]): LapBoundary[] {\n    if (laps.length === 0) {\n        // No laps, treat entire workout as one lap\n        return [{\n            start: firstTimestamp,\n            end: lastTimestamp + 1, // +1 to include last point\n            isManual: false,\n        }];\n    }\n\n    const boundaries: LapBoundary[] = [];\n    let currentStart = firstTimestamp;\n\n    for (const lap of laps) {\n        boundaries.push({\n            start: currentStart,\n            end: lap.timestamp,\n            isManual: true,\n        });\n        currentStart = lap.timestamp;\n    }\n\n    // Add final lap (from last marker to end)\n    boundaries.push({\n        start: currentStart,\n        end: lastTimestamp + 1,\n        isManual: false,\n    });\n\n    return boundaries;\n}\n\n/**\n * Calculate average of non-null values\n */\nfunction calculateAverage(values: (number | null)[]): number | null {\n    const validValues = values.filter((v): v is number => v !== null);\n    if (validValues.length === 0) return null;\n    return validValues.reduce((sum, v) => sum + v, 0) / validValues.length;\n}\n\n/**\n * Calculate max of non-null values\n */\nfunction calculateMax(values: (number | null)[]): number | null {\n    const validValues = values.filter((v): v is number => v !== null);\n    if (validValues.length === 0) return null;\n    return Math.max(...validValues);\n}\n","/**\n * FIT (Flexible and Interoperable Data Transfer) export utilities\n * \n * Creates Garmin FIT files from workout measurements.\n * FIT is a binary format optimized for storing and sharing fitness data.\n * \n * @module create-fit\n */\n\nimport { mergeMeasurements } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\nimport type { SportType } from './config/sport.js';\n\n// FIT Protocol Constants\nconst FIT_PROTOCOL_VERSION = 0x20; // 2.0\nconst FIT_PROFILE_VERSION = 0x0813; // 20.83\n\n// FIT Message Numbers\nconst FIT_MESG_FILE_ID = 0;\nconst FIT_MESG_FILE_CREATOR = 1;\nconst FIT_MESG_ACTIVITY = 34;\nconst FIT_MESG_SESSION = 18;\nconst FIT_MESG_LAP = 19;\nconst FIT_MESG_RECORD = 20;\nconst FIT_MESG_EVENT = 21;\n\n// FIT Base Types (only used types are uncommented)\nconst FIT_BASE_TYPE_ENUM = 0x00;\n// const FIT_BASE_TYPE_SINT8 = 0x01;\nconst FIT_BASE_TYPE_UINT8 = 0x02;\n// const FIT_BASE_TYPE_SINT16 = 0x83;\nconst FIT_BASE_TYPE_UINT16 = 0x84;\n// const FIT_BASE_TYPE_SINT32 = 0x85;\nconst FIT_BASE_TYPE_UINT32 = 0x86;\n// const FIT_BASE_TYPE_STRING = 0x07;\n\n// FIT Field IDs for File ID message\nconst FILE_ID_TYPE = 0;\nconst FILE_ID_MANUFACTURER = 1;\nconst FILE_ID_PRODUCT = 2;\nconst FILE_ID_SERIAL_NUMBER = 3;\nconst FILE_ID_TIME_CREATED = 4;\n\n// FIT Field IDs for Record message\nconst RECORD_TIMESTAMP = 253;\nconst RECORD_HEART_RATE = 3;\nconst RECORD_CADENCE = 4;\nconst RECORD_POWER = 7;\n\n// FIT Field IDs for Session message\nconst SESSION_TIMESTAMP = 253;\nconst SESSION_START_TIME = 2;\nconst SESSION_TOTAL_ELAPSED_TIME = 7;\nconst SESSION_TOTAL_TIMER_TIME = 8;\nconst SESSION_TOTAL_DISTANCE = 9;\nconst SESSION_TOTAL_CALORIES = 11;\nconst SESSION_SPORT = 5;\nconst SESSION_SUB_SPORT = 6;\nconst SESSION_EVENT = 0;\nconst SESSION_EVENT_TYPE = 1;\n\n// FIT Field IDs for Lap message\nconst LAP_TIMESTAMP = 253;\nconst LAP_START_TIME = 2;\nconst LAP_TOTAL_ELAPSED_TIME = 7;\nconst LAP_TOTAL_TIMER_TIME = 8;\nconst LAP_TOTAL_DISTANCE = 9;\nconst LAP_TOTAL_CALORIES = 11;\nconst LAP_EVENT = 0;\nconst LAP_EVENT_TYPE = 1;\n\n// FIT Field IDs for Event message\nconst EVENT_TIMESTAMP = 253;\nconst EVENT_EVENT = 0;\nconst EVENT_EVENT_TYPE = 1;\n\n// FIT Field IDs for Activity message\nconst ACTIVITY_TIMESTAMP = 253;\nconst ACTIVITY_TOTAL_TIMER_TIME = 0;\nconst ACTIVITY_NUM_SESSIONS = 1;\nconst ACTIVITY_TYPE = 2;\nconst ACTIVITY_EVENT = 3;\nconst ACTIVITY_EVENT_TYPE = 4;\nconst ACTIVITY_LOCAL_TIMESTAMP = 5;\n\n// FIT Type values\nconst FILE_TYPE_ACTIVITY = 4;\nconst MANUFACTURER_DEVELOPMENT = 255;\nconst SPORT_CYCLING = 2;\nconst SPORT_RUNNING = 1;\nconst SPORT_WALKING = 11;\nconst SUB_SPORT_INDOOR_CYCLING = 6;\nconst SUB_SPORT_GENERIC = 0;\nconst EVENT_TIMER = 0;\nconst EVENT_SESSION = 8;\nconst EVENT_LAP = 9;\nconst EVENT_ACTIVITY = 26;\nconst EVENT_TYPE_START = 0;\nconst EVENT_TYPE_STOP = 1;\nconst ACTIVITY_TYPE_MANUAL = 0;\n\n// FIT timestamp epoch (1989-12-31 00:00:00 UTC)\nconst FIT_EPOCH_MS = Date.UTC(1989, 11, 31, 0, 0, 0);\n\n/**\n * Calculate CRC-16 (CCITT) for FIT file\n */\nfunction calculateCrc(buffer: Uint8Array, start: number, end: number): number {\n    const crcTable = [\n        0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401,\n        0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400\n    ];\n\n    let crc = 0;\n    for (let i = start; i < end; i++) {\n        const byte = buffer[i];\n        // Low nibble\n        let tmp = crcTable[crc & 0xF];\n        crc = (crc >> 4) & 0x0FFF;\n        crc = crc ^ tmp ^ crcTable[byte & 0xF];\n        // High nibble\n        tmp = crcTable[crc & 0xF];\n        crc = (crc >> 4) & 0x0FFF;\n        crc = crc ^ tmp ^ crcTable[(byte >> 4) & 0xF];\n    }\n    return crc;\n}\n\n/**\n * Convert JavaScript timestamp to FIT timestamp\n */\nfunction toFitTimestamp(jsTimestamp: number): number {\n    return Math.round((jsTimestamp - FIT_EPOCH_MS) / 1000);\n}\n\n/**\n * FIT file builder class\n */\nclass FitBuilder {\n    private buffer: number[] = [];\n    private definedMessages: Map<number, boolean> = new Map();\n\n    /**\n     * Write header (14 bytes)\n     */\n    writeHeader(): void {\n        // Header size (1 byte)\n        this.buffer.push(14);\n        // Protocol version (1 byte)\n        this.buffer.push(FIT_PROTOCOL_VERSION);\n        // Profile version (2 bytes, little-endian)\n        this.buffer.push(FIT_PROFILE_VERSION & 0xFF);\n        this.buffer.push((FIT_PROFILE_VERSION >> 8) & 0xFF);\n        // Data size placeholder (4 bytes) - will be updated later\n        this.buffer.push(0, 0, 0, 0);\n        // Data type \".FIT\" (4 bytes)\n        this.buffer.push(0x2E, 0x46, 0x49, 0x54); // \".FIT\"\n        // CRC (2 bytes) - will be updated later\n        this.buffer.push(0, 0);\n    }\n\n    /**\n     * Write definition message\n     */\n    writeDefinition(localMsgType: number, globalMsgNum: number, fields: { fieldDefNum: number; size: number; baseType: number }[]): void {\n        // Record header: definition message (bit 6 = 1)\n        this.buffer.push(0x40 | (localMsgType & 0x0F));\n        // Reserved byte\n        this.buffer.push(0);\n        // Architecture (0 = little-endian)\n        this.buffer.push(0);\n        // Global message number (2 bytes, little-endian)\n        this.buffer.push(globalMsgNum & 0xFF);\n        this.buffer.push((globalMsgNum >> 8) & 0xFF);\n        // Number of fields\n        this.buffer.push(fields.length);\n        // Field definitions\n        for (const field of fields) {\n            this.buffer.push(field.fieldDefNum);\n            this.buffer.push(field.size);\n            this.buffer.push(field.baseType);\n        }\n        this.definedMessages.set(localMsgType, true);\n    }\n\n    /**\n     * Write data message\n     */\n    writeData(localMsgType: number, values: (number | null)[]): void {\n        // Record header: data message (bit 6 = 0)\n        this.buffer.push(localMsgType & 0x0F);\n        // Field values\n        for (const value of values) {\n            if (typeof value === 'number') {\n                // Handled by caller based on field size\n            }\n        }\n    }\n\n    /**\n     * Write uint8 value\n     */\n    writeUint8(value: number): void {\n        this.buffer.push(value & 0xFF);\n    }\n\n    /**\n     * Write uint16 value (little-endian)\n     */\n    writeUint16(value: number): void {\n        this.buffer.push(value & 0xFF);\n        this.buffer.push((value >> 8) & 0xFF);\n    }\n\n    /**\n     * Write uint32 value (little-endian)\n     */\n    writeUint32(value: number): void {\n        this.buffer.push(value & 0xFF);\n        this.buffer.push((value >> 8) & 0xFF);\n        this.buffer.push((value >> 16) & 0xFF);\n        this.buffer.push((value >> 24) & 0xFF);\n    }\n\n    /**\n     * Write data message header\n     */\n    writeDataHeader(localMsgType: number): void {\n        this.buffer.push(localMsgType & 0x0F);\n    }\n\n    /**\n     * Finalize the FIT file with CRC\n     */\n    finalize(): Uint8Array {\n        const result = new Uint8Array(this.buffer);\n\n        // Update data size in header (bytes 4-7)\n        const dataSize = this.buffer.length - 14; // Exclude header\n        result[4] = dataSize & 0xFF;\n        result[5] = (dataSize >> 8) & 0xFF;\n        result[6] = (dataSize >> 16) & 0xFF;\n        result[7] = (dataSize >> 24) & 0xFF;\n\n        // Calculate header CRC (bytes 12-13)\n        const headerCrc = calculateCrc(result, 0, 12);\n        result[12] = headerCrc & 0xFF;\n        result[13] = (headerCrc >> 8) & 0xFF;\n\n        // Calculate and append data CRC\n        const dataCrc = calculateCrc(result, 0, result.length);\n        const finalBuffer = new Uint8Array(result.length + 2);\n        finalBuffer.set(result);\n        finalBuffer[result.length] = dataCrc & 0xFF;\n        finalBuffer[result.length + 1] = (dataCrc >> 8) & 0xFF;\n\n        return finalBuffer;\n    }\n\n    /**\n     * Get current buffer as array\n     */\n    getBuffer(): number[] {\n        return this.buffer;\n    }\n}\n\n/**\n * Map internal sport type to FIT sport and sub-sport values\n */\nfunction getFitSportValues(sport?: SportType): { sport: number; subSport: number } {\n    switch (sport) {\n        case 'running':\n            return { sport: SPORT_RUNNING, subSport: SUB_SPORT_GENERIC };\n        case 'walking':\n            return { sport: SPORT_WALKING, subSport: SUB_SPORT_GENERIC };\n        case 'cycling':\n        default:\n            return { sport: SPORT_CYCLING, subSport: SUB_SPORT_INDOOR_CYCLING };\n    }\n}\n\n/**\n * Creates a Garmin FIT binary file from workout measurements.\n * \n * FIT (Flexible and Interoperable Data Transfer) is a binary format\n * used by Garmin devices and supported by most fitness platforms.\n * \n * @param measurements - The measurements data object containing workout data\n * @param sport - Optional sport type for the activity (defaults to cycling)\n * @returns FIT binary data as Uint8Array, or null if no data\n * \n * @example\n * const fitData = getFitData(measurementsState, 'running');\n * if (fitData) {\n *     const blob = new Blob([fitData], { type: 'application/fit' });\n *     // Download or upload the file\n * }\n */\nexport const getFitData = (measurements: MeasurementsData, sport?: SportType): Uint8Array | null => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return null;\n    }\n\n    const fitSportValues = getFitSportValues(sport);\n    const fit = new FitBuilder();\n    fit.writeHeader();\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const fitStartTime = toFitTimestamp(firstTimestamp);\n    const fitEndTime = toFitTimestamp(lastTimestamp);\n    const totalElapsedTime = (lastTimestamp - firstTimestamp) / 1000; // seconds\n    const totalElapsedTimeMs = Math.round(totalElapsedTime * 1000); // milliseconds for FIT\n\n    // Calculate totals\n    const validEnergy = dataPoints.filter(p => p.energy !== null);\n    const totalCalories = validEnergy.length > 0\n        ? Math.round(validEnergy[validEnergy.length - 1].energy! - (validEnergy[0].energy || 0))\n        : 0;\n\n    const validDistance = dataPoints.filter(p => p.distance !== null);\n    const totalDistance = validDistance.length > 0 && validDistance[validDistance.length - 1].distance! > (validDistance[0].distance || 0)\n        ? Math.round(validDistance[validDistance.length - 1].distance! - (validDistance[0].distance || 0))\n        : 0;\n\n    // Local message type assignments\n    const LOCAL_FILE_ID = 0;\n    const LOCAL_FILE_CREATOR = 1;\n    const LOCAL_EVENT = 2;\n    const LOCAL_RECORD = 3;\n    const LOCAL_LAP = 4;\n    const LOCAL_SESSION = 5;\n    const LOCAL_ACTIVITY = 6;\n\n    // === File ID Message ===\n    fit.writeDefinition(LOCAL_FILE_ID, FIT_MESG_FILE_ID, [\n        { fieldDefNum: FILE_ID_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: FILE_ID_MANUFACTURER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_PRODUCT, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_SERIAL_NUMBER, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: FILE_ID_TIME_CREATED, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_ID);\n    fit.writeUint8(FILE_TYPE_ACTIVITY);\n    fit.writeUint16(MANUFACTURER_DEVELOPMENT);\n    fit.writeUint16(1); // Product ID\n    fit.writeUint32(12345678); // Serial number\n    fit.writeUint32(fitStartTime);\n\n    // === File Creator Message ===\n    fit.writeDefinition(LOCAL_FILE_CREATOR, FIT_MESG_FILE_CREATOR, [\n        { fieldDefNum: 0, size: 2, baseType: FIT_BASE_TYPE_UINT16 }, // software_version\n        { fieldDefNum: 1, size: 1, baseType: FIT_BASE_TYPE_UINT8 }, // hardware_version\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_CREATOR);\n    fit.writeUint16(100); // Software version\n    fit.writeUint8(1); // Hardware version\n\n    // === Timer Start Event ===\n    fit.writeDefinition(LOCAL_EVENT, FIT_MESG_EVENT, [\n        { fieldDefNum: EVENT_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: EVENT_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: EVENT_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_START);\n\n    // === Record Messages (one per data point) ===\n    fit.writeDefinition(LOCAL_RECORD, FIT_MESG_RECORD, [\n        { fieldDefNum: RECORD_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: RECORD_HEART_RATE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_CADENCE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_POWER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n    ]);\n\n    for (const point of dataPoints) {\n        const fitTimestamp = toFitTimestamp(point.timestamp);\n        fit.writeDataHeader(LOCAL_RECORD);\n        fit.writeUint32(fitTimestamp);\n        // Heart rate (0xFF = invalid)\n        fit.writeUint8(point.heartrate !== null ? Math.min(255, Math.round(point.heartrate)) : 0xFF);\n        // Cadence (0xFF = invalid)\n        fit.writeUint8(point.cadence !== null ? Math.min(255, Math.round(point.cadence)) : 0xFF);\n        // Power (0xFFFF = invalid)\n        fit.writeUint16(point.power !== null ? Math.round(point.power) : 0xFFFF);\n    }\n\n    // === Timer Stop Event ===\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Lap Message ===\n    fit.writeDefinition(LOCAL_LAP, FIT_MESG_LAP, [\n        { fieldDefNum: LAP_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_DISTANCE, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_CALORIES, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: LAP_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: LAP_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_LAP);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs); // Timer time same as elapsed\n    fit.writeUint32(totalDistance);\n    fit.writeUint16(totalCalories);\n    fit.writeUint8(EVENT_LAP);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Session Message ===\n    fit.writeDefinition(LOCAL_SESSION, FIT_MESG_SESSION, [\n        { fieldDefNum: SESSION_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_DISTANCE, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_CALORIES, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: SESSION_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_SUB_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_SESSION);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalDistance);\n    fit.writeUint16(totalCalories);\n    fit.writeUint8(fitSportValues.sport);\n    fit.writeUint8(fitSportValues.subSport);\n    fit.writeUint8(EVENT_SESSION);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Activity Message ===\n    fit.writeDefinition(LOCAL_ACTIVITY, FIT_MESG_ACTIVITY, [\n        { fieldDefNum: ACTIVITY_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_NUM_SESSIONS, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: ACTIVITY_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_LOCAL_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_ACTIVITY);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint16(1); // Number of sessions\n    fit.writeUint8(ACTIVITY_TYPE_MANUAL);\n    fit.writeUint8(EVENT_ACTIVITY);\n    fit.writeUint8(EVENT_TYPE_STOP);\n    fit.writeUint32(fitEndTime); // Local timestamp\n\n    return fit.finalize();\n};\n","/**\n * Post-Workout Metadata Modal\n *\n * Shows a modal after workout completion to collect:\n * - Workout title (with smart default)\n * - Notes\n * - Perceived exertion (RPE 1-10)\n *\n * Settings control whether notes and/or exertion prompts are shown.\n *\n * @module ui/workoutMetadataModal\n */\n\nimport { showModal } from './modal.js';\nimport { getSettings } from '../config/settings.js';\nimport type { WorkoutMetadata, PerceivedExertion } from '../types/measurements.js';\n\n/**\n * RPE (Rate of Perceived Exertion) scale descriptions\n */\nconst RPE_DESCRIPTIONS: Record<PerceivedExertion, { label: string; description: string; color: string }> = {\n    1: { label: '1 - Very Light', description: 'Barely any effort', color: '#3b82f6' },\n    2: { label: '2 - Light', description: 'Easy breathing', color: '#22c55e' },\n    3: { label: '3 - Light', description: 'Could do this all day', color: '#22c55e' },\n    4: { label: '4 - Moderate', description: 'Comfortable effort', color: '#84cc16' },\n    5: { label: '5 - Moderate', description: 'Starting to breathe harder', color: '#eab308' },\n    6: { label: '6 - Hard', description: 'Can speak in sentences', color: '#eab308' },\n    7: { label: '7 - Hard', description: 'Can only speak in phrases', color: '#f97316' },\n    8: { label: '8 - Very Hard', description: 'Difficult to maintain', color: '#ef4444' },\n    9: { label: '9 - Very Hard', description: 'Almost maximal effort', color: '#dc2626' },\n    10: { label: '10 - Maximum', description: 'All-out effort', color: '#991b1b' },\n};\n\n/**\n * Generate a default workout title based on the date/time\n */\nexport function generateDefaultTitle(startTime?: number): string {\n    const date = startTime ? new Date(startTime) : new Date();\n    const hours = date.getHours();\n\n    let timeOfDay = 'Morning';\n    if (hours >= 12 && hours < 17) {\n        timeOfDay = 'Afternoon';\n    } else if (hours >= 17 && hours < 21) {\n        timeOfDay = 'Evening';\n    } else if (hours >= 21 || hours < 5) {\n        timeOfDay = 'Night';\n    }\n\n    const dateStr = date.toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n    });\n\n    return `${timeOfDay} Ride - ${dateStr}`;\n}\n\n/**\n * Create the RPE selector element\n */\nfunction createRpeSelector(selectedValue?: PerceivedExertion): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'rpe-selector';\n    container.innerHTML = `\n        <label class=\"metadata-label\">Perceived Exertion (RPE)</label>\n        <div class=\"rpe-grid\">\n            ${([1, 2, 3, 4, 5, 6, 7, 8, 9, 10] as PerceivedExertion[]).map(value => {\n        const info = RPE_DESCRIPTIONS[value];\n        const isSelected = selectedValue === value;\n        return `\n                    <button type=\"button\"\n                        class=\"rpe-button ${isSelected ? 'selected' : ''}\"\n                        data-rpe=\"${value}\"\n                        title=\"${info.label}: ${info.description}\"\n                        style=\"--rpe-color: ${info.color};\">\n                        ${value}\n                    </button>\n                `;\n    }).join('')}\n        </div>\n        <div class=\"rpe-description\" id=\"rpeDescription\">\n            ${selectedValue ? `${RPE_DESCRIPTIONS[selectedValue].label}: ${RPE_DESCRIPTIONS[selectedValue].description}` : 'Select how hard the workout felt'}\n        </div>\n    `;\n\n    // Add click handlers for RPE buttons\n    const buttons = container.querySelectorAll('.rpe-button');\n    buttons.forEach(button => {\n        button.addEventListener('click', () => {\n            // Remove selected from all\n            buttons.forEach(b => b.classList.remove('selected'));\n            // Add to clicked\n            button.classList.add('selected');\n\n            // Update description\n            const rpe = parseInt(button.getAttribute('data-rpe') || '5', 10) as PerceivedExertion;\n            const descEl = container.querySelector('#rpeDescription');\n            if (descEl) {\n                descEl.textContent = `${RPE_DESCRIPTIONS[rpe].label}: ${RPE_DESCRIPTIONS[rpe].description}`;\n            }\n        });\n    });\n\n    return container;\n}\n\n/**\n * Create the metadata form content\n */\nfunction createMetadataFormContent(\n    startTime: number | undefined,\n    showNotes: boolean,\n    showExertion: boolean\n): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'workout-metadata-form';\n\n    // Title field (always shown)\n    const titleSection = document.createElement('div');\n    titleSection.className = 'metadata-field';\n    titleSection.innerHTML = `\n        <label class=\"metadata-label\" for=\"workoutTitle\">Workout Title</label>\n        <input type=\"text\"\n            id=\"workoutTitle\"\n            class=\"metadata-input\"\n            value=\"${generateDefaultTitle(startTime)}\"\n            placeholder=\"Enter workout title...\"\n            maxlength=\"100\">\n    `;\n    container.appendChild(titleSection);\n\n    // Notes field (optional based on settings)\n    if (showNotes) {\n        const notesSection = document.createElement('div');\n        notesSection.className = 'metadata-field';\n        notesSection.innerHTML = `\n            <label class=\"metadata-label\" for=\"workoutNotes\">Notes (optional)</label>\n            <textarea\n                id=\"workoutNotes\"\n                class=\"metadata-textarea\"\n                placeholder=\"How did the workout go? Any observations...\"\n                rows=\"3\"\n                maxlength=\"1000\"></textarea>\n        `;\n        container.appendChild(notesSection);\n    }\n\n    // RPE selector (optional based on settings)\n    if (showExertion) {\n        const rpeSection = document.createElement('div');\n        rpeSection.className = 'metadata-field';\n        rpeSection.appendChild(createRpeSelector());\n        container.appendChild(rpeSection);\n    }\n\n    return container;\n}\n\n/**\n * Extract metadata from the form\n */\nfunction getMetadataFromForm(container: HTMLElement): WorkoutMetadata {\n    const titleInput = container.querySelector('#workoutTitle') as HTMLInputElement;\n    const notesInput = container.querySelector('#workoutNotes') as HTMLTextAreaElement;\n    const selectedRpe = container.querySelector('.rpe-button.selected') as HTMLButtonElement;\n\n    const metadata: WorkoutMetadata = {\n        title: titleInput?.value.trim() || generateDefaultTitle(),\n    };\n\n    if (notesInput?.value.trim()) {\n        metadata.notes = notesInput.value.trim();\n    }\n\n    if (selectedRpe) {\n        const rpe = parseInt(selectedRpe.getAttribute('data-rpe') || '0', 10);\n        if (rpe >= 1 && rpe <= 10) {\n            metadata.perceivedExertion = rpe as PerceivedExertion;\n        }\n    }\n\n    return metadata;\n}\n\n/**\n * Show the post-workout metadata collection modal\n *\n * @param startTime - The workout start timestamp for default title generation\n * @returns Promise resolving to the collected metadata, or null if skipped/cancelled\n */\nexport function showWorkoutMetadataModal(startTime?: number): Promise<WorkoutMetadata | null> {\n    const settings = getSettings();\n    const { promptForNotes, promptForExertion } = settings.workoutMetadata;\n\n    // If both prompts are disabled, return default metadata immediately\n    if (!promptForNotes && !promptForExertion) {\n        return Promise.resolve({\n            title: generateDefaultTitle(startTime),\n        });\n    }\n\n    return new Promise((resolve) => {\n        let closeModal: (() => void) | null = null;\n\n        const formContent = createMetadataFormContent(startTime, promptForNotes, promptForExertion);\n\n        closeModal = showModal({\n            title: 'Workout Details',\n            content: formContent,\n            icon: '',\n            closeOnOverlay: false,\n            buttons: [\n                {\n                    text: 'Skip',\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        // Return default metadata even when skipped\n                        resolve({\n                            title: generateDefaultTitle(startTime),\n                        });\n                    },\n                },\n                {\n                    text: 'Save',\n                    variant: 'primary',\n                    onClick: () => {\n                        const metadata = getMetadataFromForm(formContent);\n                        closeModal?.();\n                        resolve(metadata);\n                    },\n                },\n            ],\n            onClose: () => {\n                // Return default if modal is closed via escape/X\n                resolve({\n                    title: generateDefaultTitle(startTime),\n                });\n            },\n        });\n\n        // Focus the title input after modal opens\n        setTimeout(() => {\n            const titleInput = formContent.querySelector('#workoutTitle') as HTMLInputElement;\n            titleInput?.focus();\n            titleInput?.select();\n        }, 100);\n    });\n}\n\n/**\n * Check if metadata modal should be shown based on settings\n */\nexport function shouldShowMetadataModal(): boolean {\n    const settings = getSettings();\n    return settings.workoutMetadata.promptForNotes || settings.workoutMetadata.promptForExertion;\n}\n","/**\n * Undo Notification Module\n * \n * Displays a toast notification with an undo button that allows users\n * to reverse a destructive action within a time limit.\n * \n * @module undoNotification\n */\n\nimport { announce } from './accessibility.js';\n\n/** Default undo timeout in milliseconds */\nconst DEFAULT_UNDO_TIMEOUT = 5000;\n\n/**\n * Undo notification options\n */\nexport interface UndoNotificationOptions {\n    /** The message to display */\n    message: string;\n    /** Callback when undo is clicked */\n    onUndo: () => void;\n    /** Callback when the timeout expires without undo */\n    onExpire?: () => void;\n    /** Time in ms before the notification disappears (default: 5000) */\n    timeout?: number;\n    /** Icon to display (optional) */\n    icon?: string;\n}\n\n/**\n * Show an undo notification toast\n * \n * Displays a notification with a countdown timer and undo button.\n * The notification auto-dismisses after the timeout, executing onExpire.\n * If the user clicks undo, onUndo is called and the notification closes.\n * \n * @param options - Configuration for the undo notification\n * @returns A function to manually dismiss the notification\n */\nexport function showUndoNotification(options: UndoNotificationOptions): () => void {\n    const {\n        message,\n        onUndo,\n        onExpire,\n        timeout = DEFAULT_UNDO_TIMEOUT,\n        icon = '',\n    } = options;\n\n    // Remove any existing undo notifications\n    const existing = document.querySelector('.undo-notification');\n    existing?.remove();\n\n    // Create notification element\n    const notification = document.createElement('div');\n    notification.className = 'undo-notification';\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    // Calculate countdown in seconds\n    const timeoutSeconds = Math.ceil(timeout / 1000);\n    let remainingSeconds = timeoutSeconds;\n\n    // Create content\n    notification.innerHTML = `\n        <div class=\"undo-notification-content\">\n            <span class=\"undo-notification-icon\" aria-hidden=\"true\">${icon}</span>\n            <span class=\"undo-notification-message\">${message}</span>\n        </div>\n        <div class=\"undo-notification-actions\">\n            <button class=\"undo-notification-btn\" type=\"button\">\n                Undo <span class=\"undo-countdown\">(${remainingSeconds}s)</span>\n            </button>\n        </div>\n        <div class=\"undo-progress-bar\">\n            <div class=\"undo-progress-fill\"></div>\n        </div>\n    `;\n\n    document.body.appendChild(notification);\n\n    // Get elements\n    const undoButton = notification.querySelector('.undo-notification-btn') as HTMLButtonElement;\n    const countdownSpan = notification.querySelector('.undo-countdown') as HTMLSpanElement;\n    const progressFill = notification.querySelector('.undo-progress-fill') as HTMLDivElement;\n\n    // Check reduced motion preference\n    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n    // Set up progress bar animation\n    if (!prefersReducedMotion) {\n        progressFill.style.transition = `width ${timeout}ms linear`;\n        // Force reflow before starting animation\n        progressFill.offsetHeight;\n        progressFill.style.width = '0%';\n    } else {\n        progressFill.style.width = '0%';\n    }\n\n    // Animate in\n    requestAnimationFrame(() => {\n        notification.classList.add('undo-notification-visible');\n    });\n\n    let isUndone = false;\n    let countdownInterval: ReturnType<typeof setInterval> | null = null;\n    let dismissTimeout: ReturnType<typeof setTimeout> | null = null;\n\n    /**\n     * Dismiss the notification with cleanup\n     */\n    const dismiss = (executeExpire = false) => {\n        if (countdownInterval) {\n            clearInterval(countdownInterval);\n            countdownInterval = null;\n        }\n        if (dismissTimeout) {\n            clearTimeout(dismissTimeout);\n            dismissTimeout = null;\n        }\n\n        if (prefersReducedMotion) {\n            notification.remove();\n            if (executeExpire && !isUndone && onExpire) {\n                onExpire();\n            }\n        } else {\n            notification.classList.remove('undo-notification-visible');\n            notification.classList.add('undo-notification-hiding');\n            setTimeout(() => {\n                notification.remove();\n                if (executeExpire && !isUndone && onExpire) {\n                    onExpire();\n                }\n            }, 200);\n        }\n    };\n\n    // Start countdown display\n    countdownInterval = setInterval(() => {\n        remainingSeconds--;\n        if (remainingSeconds > 0) {\n            countdownSpan.textContent = `(${remainingSeconds}s)`;\n        } else {\n            if (countdownInterval) {\n                clearInterval(countdownInterval);\n            }\n        }\n    }, 1000);\n\n    // Set up auto-dismiss\n    dismissTimeout = setTimeout(() => {\n        dismiss(true);\n    }, timeout);\n\n    // Handle undo click\n    undoButton.addEventListener('click', () => {\n        isUndone = true;\n        dismiss(false);\n        onUndo();\n        announce('Action undone', 'assertive');\n    });\n\n    // Focus the undo button for accessibility\n    undoButton.focus();\n\n    // Announce to screen readers\n    announce(`${message} Press undo within ${timeoutSeconds} seconds to restore.`, 'assertive');\n\n    return () => dismiss(false);\n}\n\n/**\n * Data backup for undo functionality\n */\nexport interface WorkoutBackup {\n    power: Array<{ timestamp: number; value: number }>;\n    heartrate: Array<{ timestamp: number; value: number }>;\n    cadence: Array<{ timestamp: number; value: number }>;\n    startTime: number | null;\n    endTime: number | null;\n    running: boolean;\n}\n\n/**\n * Create a backup of workout data for undo\n * \n * @param measurementsState - The measurements state to backup\n * @param timeState - The time state to backup\n * @returns A backup object that can be restored\n */\nexport function createWorkoutBackup(\n    measurementsState: { power: Array<{ timestamp: number; value: number }>; heartrate: Array<{ timestamp: number; value: number }>; cadence: Array<{ timestamp: number; value: number }> },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): WorkoutBackup {\n    return {\n        power: [...measurementsState.power],\n        heartrate: [...measurementsState.heartrate],\n        cadence: [...measurementsState.cadence],\n        startTime: timeState.startTime,\n        endTime: timeState.endTime,\n        running: timeState.running,\n    };\n}\n\n/**\n * Restore workout data from a backup\n * \n * @param backup - The backup to restore\n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n */\nexport function restoreWorkoutBackup(\n    backup: WorkoutBackup,\n    measurementsState: { power: Array<{ timestamp: number; value: number }>; heartrate: Array<{ timestamp: number; value: number }>; cadence: Array<{ timestamp: number; value: number }> },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): void {\n    measurementsState.power = [...backup.power];\n    measurementsState.heartrate = [...backup.heartrate];\n    measurementsState.cadence = [...backup.cadence];\n    timeState.startTime = backup.startTime;\n    timeState.endTime = backup.endTime;\n    timeState.running = backup.running;\n}\n","/**\n * Lap Button Functionality\n *\n * Handles lap marking during workouts.\n * Shows lap button during recording and updates lap counter.\n *\n * @module lap\n */\n\nimport { announce } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { getTimestring } from '../getTimestring.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Parameters for lap button initialization\n */\ninterface InitLapButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n}\n\n/**\n * Initialize the lap button functionality.\n *\n * Sets up:\n * - Lap button visibility based on workout state\n * - Lap counter display\n * - Click handler for marking laps\n *\n * @param params - Object containing state objects\n */\nexport function initLapButton({ measurementsState, timeState }: InitLapButtonParams): void {\n    const lapButton = document.getElementById('lapButton') as HTMLButtonElement | null;\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    if (!lapButton || !lapCounter || !lapCountElement) {\n        console.warn('Lap button elements not found in DOM');\n        return;\n    }\n\n    /**\n     * Update lap counter display\n     */\n    const updateLapCounter = (): void => {\n        const count = measurementsState.getLapCount();\n        lapCountElement.textContent = String(count);\n        lapCounter.style.display = count > 0 ? 'block' : 'none';\n    };\n\n    /**\n     * Show/hide lap button based on workout state\n     */\n    const updateLapButtonVisibility = (): void => {\n        const isRecording = timeState.running && timeState.startTime !== null;\n        lapButton.style.display = isRecording ? 'inline-flex' : 'none';\n    };\n\n    /**\n     * Handle lap button click\n     */\n    const handleLapClick = (): void => {\n        if (!timeState.running || !timeState.startTime) {\n            return;\n        }\n\n        // Get previous lap timestamp or start time\n        const laps = measurementsState.laps;\n        const lastLapTime = laps.length > 0 ? laps[laps.length - 1].timestamp : timeState.startTime;\n\n        const lap = measurementsState.addLap(timeState.startTime);\n        updateLapCounter();\n\n        // Calculate stats for the lap that just finished\n        const now = lap.timestamp;\n        const durationMs = now - lastLapTime;\n\n        // Calculate average power\n        const lapPower = measurementsState.power.filter(p => p.timestamp >= lastLapTime && p.timestamp <= now);\n        const avgPower = lapPower.length > 0\n            ? lapPower.reduce((sum, p) => sum + p.value, 0) / lapPower.length\n            : 0;\n\n        // Voice announcement\n        voiceFeedback.announceLap(lap.number, durationMs, avgPower);\n\n        // Format elapsed time for the lap\n        const elapsedStr = lap.elapsedMs ? getTimestring(lap.elapsedMs) : '';\n        const message = `Lap ${lap.number}${elapsedStr ? ` at ${elapsedStr}` : ''}`;\n\n        // Show toast notification\n        showNotification(` ${message}`, 'info');\n\n        // Announce for screen readers\n        announce(message, 'assertive');\n\n        console.log(`Lap marked: ${lap.number} at ${new Date(lap.timestamp).toISOString()}`);\n    };\n\n    // Lap button click handler\n    lapButton.addEventListener('click', handleLapClick);\n\n    // Watch for workout state changes by observing button visibility\n    // This is a simple approach - in a more complex app, use events or state management\n    const observer = new MutationObserver(() => {\n        updateLapButtonVisibility();\n    });\n\n    // Observe the start/pause/resume buttons for visibility changes\n    [startButton, pauseButton, resumeButton, stopButton].forEach(btn => {\n        if (btn) {\n            observer.observe(btn, { attributes: true, attributeFilter: ['style'] });\n        }\n    });\n\n    // Initial state\n    updateLapButtonVisibility();\n    updateLapCounter();\n\n    // Also update when recording starts (observe start button click)\n    startButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    pauseButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    resumeButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    stopButton?.addEventListener('click', () => {\n        setTimeout(() => {\n            updateLapButtonVisibility();\n            // Reset lap counter display after workout stops\n            // (laps are cleared when workout data is discarded)\n        }, 10);\n    });\n\n    console.log('Lap button initialized');\n}\n\n/**\n * Reset lap counter display (called when workout is discarded)\n */\nexport function resetLapCounter(): void {\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n\n    if (lapCounter && lapCountElement) {\n        lapCountElement.textContent = '0';\n        lapCounter.style.display = 'none';\n    }\n}\n","/**\n * Analytics Helper for BPT\n * \n * Shared logic for calculating statistics, parsing summaries, and tracking personal records.\n */\n\nimport type { Workout } from '../api/workoutClient.js';\nimport type { WorkoutSummary } from './modal.js';\n\ninterface PrState {\n    maxPower: number;\n    maxHr: number;\n    longestDuration: number;\n    longestDistance: number;\n    powerCurve: Record<number, number>; // duration -> watts\n}\n\nexport class PersonalRecordTracker {\n    private state: PrState = {\n        maxPower: 0,\n        maxHr: 0,\n        longestDuration: 0,\n        longestDistance: 0,\n        powerCurve: {}\n    };\n\n    /**\n     * Initialize tracker with historical workouts\n     */\n    constructor(workouts: Workout[]) {\n        this.processHistory(workouts);\n    }\n\n    private processHistory(workouts: Workout[]): void {\n        workouts.forEach(w => {\n            const summary = getSummary(w);\n\n            if (summary.power?.max && summary.power.max > this.state.maxPower) {\n                this.state.maxPower = summary.power.max;\n            }\n            if (summary.heartrate?.max && summary.heartrate.max > this.state.maxHr) {\n                this.state.maxHr = summary.heartrate.max;\n            }\n            if (w.duration && w.duration > this.state.longestDuration) {\n                this.state.longestDuration = w.duration;\n            }\n            /*\n            if (summary.totalDistance && summary.totalDistance > this.state.longestDistance) {\n                this.state.longestDistance = summary.totalDistance;\n            }\n            */\n\n            // Power Curve\n            if (summary.powerCurve) {\n                summary.powerCurve.forEach((p: { duration: number; watts: number }) => {\n                    const currentBest = this.state.powerCurve[p.duration] || 0;\n                    if (p.watts > currentBest) {\n                        this.state.powerCurve[p.duration] = p.watts;\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * Check a new workout for records\n     * @returns Array of strings describing any new records\n     */\n    public checkNewRecords(newSummary: WorkoutSummary): string[] {\n        const records: string[] = [];\n\n        if (newSummary.power.max && newSummary.power.max > this.state.maxPower) {\n            records.push(`Max Power: ${newSummary.power.max} W`);\n        }\n\n        if (newSummary.heartrate.max && newSummary.heartrate.max > this.state.maxHr) {\n            records.push(`Max Heart Rate: ${newSummary.heartrate.max} bpm`);\n        }\n\n        // duration is in ms in Workout (DB), but WorkoutSummary.duration might be ms?\n        // Let's verify modal.ts. duration = endTime - startTime (ms).\n        if (newSummary.duration && newSummary.duration > this.state.longestDuration) {\n            // Only report significant duration records (>10% improvement or >1h) to avoid noise?\n            // For now, just simplistic check\n            records.push(`Longest Ride: ${formatDuration(newSummary.duration)}`);\n        }\n\n        // Modal summary doesn't have totalDistance computed yet unfortunately calculateWorkoutSummary doesn't do distance from GPS\n        // We might skip distance for live summary check unless we update calculateWorkoutSummary to include it.\n\n        // Power Curve\n        if (newSummary.powerCurve) {\n            const significantDurations = [1, 5, 60, 300, 1200, 3600]; // 1s, 5s, 1m, 5m, 20m, 1h\n            const labels: Record<number, string> = {\n                1: '1s Power',\n                5: '5s Power',\n                60: '1m Power',\n                300: '5m Power',\n                1200: '20m Power',\n                3600: '1h Power'\n            };\n\n            newSummary.powerCurve.forEach(p => {\n                if (significantDurations.includes(p.duration)) {\n                    const currentBest = this.state.powerCurve[p.duration] || 0;\n                    if (p.watts > currentBest) {\n                        // Avoid duplicates if multiple durations map to \"Max Power\" (like 1s)\n                        if (p.duration === 1 && records.some(r => r.startsWith('Max Power'))) return;\n\n                        records.push(`${labels[p.duration]}: ${p.watts} W`);\n                    }\n                }\n            });\n        }\n\n        return records;\n    }\n}\n\n/**\n * Helper to safely parse summary from DB workout\n * Note: Local WorkoutSummary type has different shape than DB text/json summary.\n * We cast to 'any' for reading flexible fields.\n */\nexport function getSummary(workout: Workout): Partial<WorkoutSummary> {\n    if (!workout.summary) return {};\n    if (typeof workout.summary === 'string') {\n        try {\n            return JSON.parse(workout.summary) as Partial<WorkoutSummary>;\n        } catch {\n            return {};\n        }\n    }\n    return workout.summary as unknown as Partial<WorkoutSummary>;\n}\n\nfunction formatDuration(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const h = Math.floor(seconds / 3600);\n    const m = Math.floor((seconds % 3600) / 60);\n    const s = seconds % 60;\n    if (h > 0) return `${h}h ${m}m`;\n    return `${m}m ${s}s`;\n}\n","import { getSettings } from '../config/settings.js';\nimport type { MeasurementsData } from '../types/measurements.js';\nimport { getFitData } from '../create-fit.js';\nimport { showNotification } from '../ui/notifications.js';\n\n/**\n * Service for integrating with Intervals.icu API\n */\nexport class IntervalsService {\n    private static API_BASE = 'https://intervals.icu/api/v1';\n\n    /**\n     * Upload a workout to Intervals.icu\n     * \n     * @param measurements - The workout measurements data\n     * @param workoutName - Name for the file (e.g. \"BikePowerTracker_2024-01-01.fit\")\n     */\n    static async uploadWorkout(measurements: MeasurementsData, workoutName: string): Promise<void> {\n        const settings = getSettings();\n\n        // Basic check before processing\n        if (!settings.intervals.enabled || !settings.intervals.apiKey) {\n            return;\n        }\n\n        try {\n            const fitData = getFitData(measurements);\n            if (!fitData) {\n                console.warn('[Intervals] No data to upload');\n                return;\n            }\n\n            const blob = new Blob([fitData as unknown as BlobPart], { type: 'application/fit' });\n            const formData = new FormData();\n            // Append the file. 'file' is the key expected by standard multipart uploads, \n            // though Intervals.icu endpoint documentation should be checked. \n            // Most fit upload endpoints accept a 'file' parameter.\n            formData.append('file', blob, workoutName);\n\n            const athleteId = settings.intervals.athleteId || 'i';\n            const url = `${this.API_BASE}/athlete/${athleteId}/activities`;\n\n            // Authorization: Basic <base64(\"API_KEY:\" + api_key)>\n            const auth = btoa(`API_KEY:${settings.intervals.apiKey}`);\n\n            showNotification('Uploading to Intervals.icu...', 'info');\n\n            const response = await fetch(url, {\n                method: 'POST',\n                headers: {\n                    'Authorization': `Basic ${auth}`\n                },\n                body: formData\n            });\n\n            if (response.ok) {\n                const result = await response.json();\n                console.log('[Intervals] Upload success:', result);\n                showNotification('Uploaded to Intervals.icu! ', 'success');\n            } else {\n                const text = await response.text();\n                console.error('[Intervals] Upload failed:', response.status, text);\n                showNotification(`Upload failed: ${response.status}`, 'error');\n            }\n        } catch (error) {\n            console.error('[Intervals] Network error:', error);\n            showNotification('Upload network error', 'error');\n        }\n    }\n}\n","/**\n * Application settings stored in localStorage\n */\nexport interface AppSettings {\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n}\n\n/**\n * Default settings\n */\nexport const defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n};\n","/**\n * Strava Integration Module\n * \n * Handles Strava connectivity and upload options.\n * \n * Current Implementation: \n * - Option 1: Manual Upload (Generates TCX and opens Strava upload page)\n * \n * @module strava\n */\n\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js'; // Prefer FIT if possible\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { WorkoutMetadata } from '../types/measurements.js';\nimport { announce } from '../ui/accessibility.js';\n\n/**\n * Base URL for Strava's manual upload page\n */\nexport const STRAVA_UPLOAD_URL = 'https://www.strava.com/upload/select';\n\n/**\n * Strava Integration Service\n */\nexport class StravaService {\n    private static instance: StravaService;\n\n    // Future expansion: OAuth tokens\n    private accessToken: string | null = null;\n\n    private constructor() { }\n\n    public static getInstance(): StravaService {\n        if (!StravaService.instance) {\n            StravaService.instance = new StravaService();\n        }\n        return StravaService.instance;\n    }\n\n    /**\n     * Check if Strava is \"connected\" (meaning we have tokens)\n     * For now, returns false as we are doing manual upload\n     */\n    public isConnected(): boolean {\n        return !!this.accessToken;\n    }\n\n    /**\n     * Initiate Strava Upload Flow\n     * \n     * If not connected:\n     * 1. Generates workout file (FIT preferred, TCX fallback)\n     * 2. Triggers download\n     * 3. Opens Strava Upload page in new tab\n     */\n    public async handleUpload(\n        measurementsState: MeasurementsState,\n        // @ts-ignore: metadata currently unused until we add real metadata to export\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        metadata?: WorkoutMetadata\n    ): Promise<void> {\n        try {\n            // 1. Generate Data\n            // We use FIT because it's binary, smaller, and preferred by Strava\n            // But we need to check if getFitData works (it might be async in some implementations, though here likely sync)\n\n            let blob: Blob;\n            let filename: string;\n\n            const dateStr = new Date().toISOString().slice(0, 10);\n            const timeStr = new Date().toISOString().slice(11, 16).replace(':', '-');\n            const filePrefix = `bike-power-tracker-${dateStr}-${timeStr}`;\n\n            try {\n                // Try FIT first\n                // IMPORTANT: getFitData expects SportType | undefined, but metadata passes title/notes\n                // We should extract sport type from metadata or valid source.\n                // Assuming metadata doesn't have sport yet, defaulting to undefined (cycling)\n                const fitData = getFitData(measurementsState, undefined);\n                if (fitData) {\n                    blob = new Blob([fitData as unknown as BlobPart], { type: 'application/octet-stream' });\n                    filename = `${filePrefix}.fit`;\n                } else {\n                    throw new Error('No FIT data generated');\n                }\n            } catch (e) {\n                console.warn('FIT generation failed, falling back to TCX', e);\n                const tcxString = getTcxString(measurementsState);\n                blob = new Blob([tcxString], { type: 'application/vnd.garmin.tcx+xml' });\n                filename = `${filePrefix}.tcx`;\n            }\n\n            // 2. Trigger Download\n            this.downloadFile(blob, filename);\n\n            // 3. Open Strava\n            this.openStravaUpload();\n\n            announce('Workout file downloaded. Please upload closely in the new Strava tab.', 'assertive');\n\n        } catch (error) {\n            console.error('Strava upload preparation failed:', error);\n            alert('Failed to prepare Strava upload.');\n        }\n    }\n\n    private downloadFile(blob: Blob, filename: string): void {\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        setTimeout(() => URL.revokeObjectURL(url), 100);\n    }\n\n    private openStravaUpload(): void {\n        window.open(STRAVA_UPLOAD_URL, '_blank');\n    }\n}\n\nexport const stravaService = StravaService.getInstance();\n","/**\n * Menu Controls\n * \n * Initializes menu buttons for export, discard, and settings toggle.\n * \n * @module menu\n */\n\nimport { getCsvString } from '../create-csv.js';\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js';\nimport { showConfirmation, showWorkoutSummary, calculateWorkoutSummary } from './modal.js';\nimport { showWorkoutMetadataModal, shouldShowMetadataModal } from './workoutMetadataModal.js';\nimport { announce } from './accessibility.js';\nimport { showUndoNotification, createWorkoutBackup, restoreWorkoutBackup, type WorkoutBackup } from './undoNotification.js';\nimport { resetLapCounter } from './lap.js';\nimport { PersonalRecordTracker } from './analyticsHelper.js';\nimport { listWorkouts, isDatabaseAvailable } from '../api/workoutClient.js';\nimport { archiveWorkout } from '../storage/workoutStorage.js';\nimport { IntervalsService } from '../services/IntervalsService.js';\nimport { getSettings } from '../config/settings.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { ZoneState } from '../zone-state.js';\nimport type { WorkoutMetadata } from '../types/measurements.js';\nimport { type AppSettings, defaultSettings } from '../types/settings.js';\n\n/**\n * Initialize the metrics visibility toggles.\n * \n * Sets up toggle switches for showing/hiding \"Your Metrics\" and \"Stream Metrics\" sections.\n */\nexport const initMetricsToggle = (): void => {\n    // Your Metrics Toggle\n    const toggleYour = document.getElementById('toggleYourMetrics') as HTMLInputElement | null;\n    const yourMetricsSection = document.getElementById('yourMetrics');\n\n    if (toggleYour && yourMetricsSection) {\n        // Initial state check\n        toggleYour.checked = yourMetricsSection.style.display !== 'none';\n\n        toggleYour.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            yourMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n\n    // Stream Metrics Toggle\n    const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n    const streamMetricsSection = document.getElementById('streamMetrics');\n\n    if (toggleStream && streamMetricsSection) {\n        // Initial state check\n        toggleStream.checked = streamMetricsSection.style.display !== 'none';\n\n        toggleStream.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            streamMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n};\n\n/**\n * Parameters for discard button initialization\n */\ninterface InitDiscardButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/**\n * Initialize the discard button.\n * \n * Shows a custom confirmation dialog before clearing all workout data.\n * After discard, shows an undo notification for 5 seconds allowing\n * the user to restore their data.\n * \n * @param params - Object containing state objects\n */\nexport const initDiscardButton = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitDiscardButtonParams): void => {\n    const discardButton = document.getElementById('discardButton');\n\n    if (!discardButton) {\n        console.warn('Discard button not found in DOM');\n        return;\n    }\n\n    const addListener = (btn: HTMLElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    addListener(discardButton, async () => {\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0 ||\n            timeState.startTime !== null;\n\n        // If no data, just reset silently\n        if (!hasData) {\n            resetWorkoutState(measurementsState, timeState);\n            return;\n        }\n\n        // Count data points for the warning message\n        const totalDataPoints =\n            measurementsState.power.length +\n            measurementsState.heartrate.length +\n            measurementsState.cadence.length;\n\n        const confirmed = await showConfirmation(\n            'Discard Workout',\n            `Are you sure you want to discard this workout? You have ${totalDataPoints} data points that will be deleted. You'll have 5 seconds to undo this action.`,\n            {\n                confirmText: 'Discard',\n                cancelText: 'Keep Data',\n                confirmVariant: 'danger',\n                icon: '',\n            }\n        );\n\n        if (confirmed) {\n            // Create backup before clearing\n            const backup = createWorkoutBackup(measurementsState, timeState);\n\n            // Clear the workout data\n            resetWorkoutState(measurementsState, timeState);\n\n            // Reset zone tracking\n            if (zoneState) {\n                zoneState.reset();\n            }\n\n            // Dispatch event for zone state to reset\n            document.dispatchEvent(new CustomEvent('workout-discarded'));\n\n            // Reset lap counter display\n            resetLapCounter();\n\n            // Show undo notification\n            showUndoNotification({\n                message: 'Workout data discarded',\n                icon: '',\n                timeout: 5000,\n                onUndo: () => {\n                    // Restore the backup\n                    restoreWorkoutBackup(backup, measurementsState, timeState);\n\n                    // Restore UI state based on the backup\n                    restoreWorkoutUI(backup);\n\n                    announce('Workout data restored', 'polite');\n                },\n                onExpire: () => {\n                    // Data is already cleared, nothing more to do\n                    announce('Discard complete', 'polite');\n                },\n            });\n        }\n    });\n};\n\n/**\n * Restore the workout UI based on backed up state\n */\nfunction restoreWorkoutUI(backup: WorkoutBackup): void {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n\n    if (backup.running) {\n        // Was running when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'inline-flex';\n        if (resumeButton) resumeButton.style.display = 'none';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    } else if (backup.startTime !== null) {\n        // Was paused when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'none';\n        if (resumeButton) resumeButton.style.display = 'inline-flex';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    }\n\n    // Restore timer display if there was a start time\n    if (timeElement && backup.startTime !== null) {\n        const elapsed = (backup.endTime || Date.now()) - backup.startTime;\n        const seconds = Math.floor(elapsed / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        timeElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\n    }\n}\n\n/**\n * Reset workout state to initial values\n */\nfunction resetWorkoutState(measurementsState: MeasurementsState, timeState: TimeState): void {\n    // Reset time state\n    timeState.running = false;\n    timeState.startTime = null;\n    timeState.endTime = null;\n\n    // Reset measurements\n    measurementsState.power = [];\n    measurementsState.heartrate = [];\n    measurementsState.cadence = [];\n\n    // Reset workout controls to idle state\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton) startButton.style.display = 'inline-flex';\n    if (pauseButton) pauseButton.style.display = 'none';\n    if (resumeButton) resumeButton.style.display = 'none';\n    if (stopButton) stopButton.style.display = 'none';\n\n    // Reset timer display\n    const timeElement = document.getElementById('time');\n    if (timeElement) timeElement.textContent = '00:00:00';\n}\n\n/**\n * Generate a timestamp string for filenames.\n */\nfunction getExportTimestamp(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;\n}\n\n/**\n * Download a file by creating a temporary link element.\n */\nfunction downloadFile(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n}\n\nimport { showNotification } from './notifications.js';\nimport { stravaService } from '../integrations/strava.js';\n\n/**\n * Initialize the export button.\n * \n * Exports workout data in configured formats (TCX, CSV, JSON).\n * \n * @param measurementsState - The measurements state object\n * @param zoneState - Optional zone state for including zone data in exports\n */\nexport const initExportButton = (measurementsState: MeasurementsState, zoneState?: ZoneState): void => {\n    const exportDataElem = document.getElementById('exportData');\n\n    if (!exportDataElem) {\n        console.warn('Export button not found in DOM');\n        return;\n    }\n\n    const addListener = (btn: HTMLElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    addListener(exportDataElem, () => {\n        try {\n            // Get export format settings\n            const settingsJson = localStorage.getItem('bpt-settings');\n            const settings: AppSettings = settingsJson\n                ? { ...defaultSettings, ...JSON.parse(settingsJson) }\n                : defaultSettings;\n\n            const timestamp = getExportTimestamp();\n            const metadata = getWorkoutMetadata();\n\n            // Create a safe filename from metadata title\n            const safeTitle = metadata?.title\n                ? metadata.title.replace(/[^a-z0-9]+/gi, '-').substring(0, 30).toLowerCase()\n                : 'workout';\n\n            // Show options modal\n            showConfirmation('Export Options', 'Choose an action for your workout data:', {\n                confirmText: 'Download Files',\n                confirmVariant: 'primary',\n                cancelText: 'Upload to Strava',\n                icon: ''\n            }).then(isDownload => {\n                if (isDownload) {\n                    // Download JSON file (includes zone data and metadata)\n                    if (settings.exportJson) {\n                        const exportData: Record<string, unknown> = {\n                            metadata: metadata ? {\n                                title: metadata.title,\n                                notes: metadata.notes || null,\n                                perceivedExertion: metadata.perceivedExertion || null,\n                            } : null,\n                            power: measurementsState.power,\n                            heartrate: measurementsState.heartrate,\n                            cadence: measurementsState.cadence,\n                        };\n                        // ... (zone data logic)\n                        if (zoneState) {\n                            const zoneData = zoneState.toJSON();\n                            if (zoneData.powerZones.some(z => z.timeInZoneMs > 0) ||\n                                zoneData.hrZones.some(z => z.timeInZoneMs > 0)) {\n                                exportData.zoneDistribution = {\n                                    power: zoneData.powerZones.map(z => ({\n                                        zone: z.zone,\n                                        name: z.name,\n                                        timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                                    })),\n                                    hr: zoneData.hrZones.map(z => ({\n                                        zone: z.zone,\n                                        name: z.name,\n                                        timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                                    }))\n                                };\n                            }\n                        }\n\n                        const jsonStr = JSON.stringify(exportData, null, 2);\n                        const blob = new Blob([jsonStr], { type: 'application/json' });\n                        downloadFile(blob, `${safeTitle}-${timestamp}.json`);\n                    }\n\n                    // Download CSV\n                    if (settings.exportCsv) {\n                        const csvString = getCsvString(measurementsState);\n                        const blob = new Blob([csvString], { type: 'text/csv' });\n                        downloadFile(blob, `${safeTitle}-${timestamp}.csv`);\n                    }\n\n                    // Download TCX\n                    if (settings.exportTcx) {\n                        const tcxString = getTcxString(measurementsState);\n                        const blob = new Blob([tcxString], { type: 'application/vnd.garmin.tcx+xml' });\n                        downloadFile(blob, `${safeTitle}-${timestamp}.tcx`);\n                    }\n\n                    // Download FIT (if enabled or default?) - let's add it if settings allow or default\n                    // Assuming FIT is better, let's include it if settings don't explicitly disable it\n                    // For now, adhere to existing logical flow but consider asking settings\n                    try {\n                        // Pass undefined for sport unless we have it in metadata or settings\n                        const fitData = getFitData(measurementsState, undefined);\n                        if (fitData) {\n                            const fitBlob = new Blob([fitData as unknown as BlobPart], { type: 'application/octet-stream' });\n                            downloadFile(fitBlob, `${safeTitle}-${timestamp}.fit`);\n                        }\n                    } catch (e) {\n                        // ignore\n                    }\n\n                    announce('Workout files downloaded', 'assertive');\n                } else {\n                    // Upload to Strava\n                    stravaService.handleUpload(measurementsState, metadata || undefined);\n                }\n            });\n\n        } catch (error) {\n            console.error('Export failed:', error);\n            showNotification('Failed to export data', 'error');\n        }\n    });\n};\n\n\n\n/**\n * Parameters for workout summary initialization\n */\ninterface InitWorkoutSummaryParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/** Module-level storage for collected workout metadata */\nlet collectedMetadata: WorkoutMetadata | null = null;\n\n/**\n * Get the collected workout metadata (for use in exports)\n */\nexport function getWorkoutMetadata(): WorkoutMetadata | null {\n    return collectedMetadata;\n}\n\n/**\n * Clear the collected workout metadata\n */\nexport function clearWorkoutMetadata(): void {\n    collectedMetadata = null;\n}\n\n/**\n * Initialize the post-workout summary modal.\n * \n * Listens for the 'workoutComplete' event and shows a summary modal\n * with workout statistics and export options.\n * \n * @param params - Object containing state objects\n */\nexport const initWorkoutSummaryModal = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitWorkoutSummaryParams): void => {\n    document.addEventListener('workoutComplete', async (event) => {\n        const detail = (event as CustomEvent).detail;\n\n        // Only show summary if we have data\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0;\n\n        if (!hasData && !detail.startTime) {\n            return;\n        }\n\n        const summary = calculateWorkoutSummary(\n            detail.startTime || timeState.startTime || Date.now(),\n            detail.endTime || timeState.endTime || Date.now(),\n            measurementsState,\n            zoneState\n        );\n\n        // Check for Personal Records\n        let newRecords: string[] = [];\n        try {\n            if (await isDatabaseAvailable()) {\n                const history = await listWorkouts({ limit: 1000 }); // Fetch simplified list\n                const tracker = new PersonalRecordTracker(history.workouts);\n                newRecords = tracker.checkNewRecords(summary);\n\n                if (newRecords.length > 0) {\n                    announce(`Congratulations! You set ${newRecords.length} new personal records!`, 'assertive');\n                }\n            }\n        } catch (e) {\n            console.warn('Failed to check for PRs:', e);\n        }\n\n        await showWorkoutSummary(summary, {\n            onExport: async () => {\n                // Collect metadata if settings allow\n                if (shouldShowMetadataModal()) {\n                    collectedMetadata = await showWorkoutMetadataModal(detail.startTime || timeState.startTime);\n                } else {\n                    // Use default metadata if prompts are disabled\n                    const { generateDefaultTitle } = await import('./workoutMetadataModal.js');\n                    collectedMetadata = {\n                        title: generateDefaultTitle(detail.startTime || timeState.startTime),\n                    };\n                }\n\n                try {\n                    // Archive to IndexedDB\n                    await archiveWorkout();\n                    announce('Workout saved to local history', 'polite');\n\n                    // Auto-upload to Intervals.icu\n                    const settings = getSettings();\n                    if (settings.intervals && settings.intervals.enabled && settings.intervals.autoUpload) {\n                        try {\n                            const metadata = getWorkoutMetadata();\n                            const safeTitle = metadata?.title\n                                ? metadata.title.replace(/[^a-z0-9]+/gi, '-').substring(0, 30).toLowerCase()\n                                : 'workout';\n                            const timestamp = getExportTimestamp();\n\n                            // Don't await the upload so we don't block the UI reset?\n                            // Or better: await it so user sees notification before reset?\n                            // But resetWorkoutState clears data. we passed measurementsState to service?\n                            // The service generates fitData immediately.\n                            // Let's await to be safe, or start it before reset.\n                            await IntervalsService.uploadWorkout(measurementsState, `${safeTitle}-${timestamp}.fit`);\n                        } catch (e) {\n                            console.error('Intervals auto-upload failed', e);\n                        }\n                    }\n\n                } catch (err) {\n                    console.error('Failed to save to local history', err);\n                    announce('Failed to save to local history', 'assertive');\n                }\n\n                // Trigger the export button click\n                const exportButton = document.getElementById('exportData');\n                exportButton?.click();\n\n                // Reset state after export\n                resetWorkoutState(measurementsState, timeState);\n                clearWorkoutMetadata();\n            },\n            onDiscard: () => {\n                resetWorkoutState(measurementsState, timeState);\n                clearWorkoutMetadata();\n                announce('Workout discarded', 'polite');\n            },\n            onKeepRecording: () => {\n                // Resume the workout\n                const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n                resumeButton?.click();\n            },\n        }, newRecords);\n    });\n};\n","/**\n * Zone State Management\n * \n * Tracks time spent in each power and heart rate zone during a workout.\n * Integrates with UserProfile for zone thresholds.\n * \n * @module ZoneState\n */\n\n/**\n * User profile for zone calculations\n */\ninterface UserProfile {\n    ftp: number | null;\n    maxHr: number | null;\n}\n\n/** Storage key for user profile */\nconst PROFILE_KEY = 'bpt-user-profile';\n\n/**\n * Load user profile from localStorage\n */\nfunction loadUserProfile(): UserProfile {\n    try {\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return JSON.parse(stored) as UserProfile;\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ftp: null, maxHr: null };\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nfunction calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.90) },\n        { name: 'Threshold', min: Math.round(ftp * 0.90), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.20) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.20), max: Math.round(ftp * 1.50) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.50), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nfunction calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.50), max: Math.round(maxHr * 0.60) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.60), max: Math.round(maxHr * 0.70) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.70), max: Math.round(maxHr * 0.80) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.80), max: Math.round(maxHr * 0.90) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.90), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nfunction getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nfunction getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Zone information with time tracking\n */\nexport interface ZoneInfo {\n    zone: number;\n    name: string;\n    min: number;\n    max: number;\n    timeInZoneMs: number;\n}\n\n/**\n * Current zone status for real-time display\n */\nexport interface CurrentZoneStatus {\n    zone: number;\n    name: string;\n    percentInZone: number; // 0-100, position within zone range\n}\n\n/**\n * Zone distribution data for summary\n */\nexport interface ZoneDistribution {\n    zones: ZoneInfo[];\n    totalTimeMs: number;\n}\n\n/**\n * State change callback type\n */\nexport type ZoneStateChangeCallback = () => void;\n\n/**\n * Zone State class for tracking time in zones\n */\nexport class ZoneState {\n    private _powerZones: ZoneInfo[] = [];\n    private _hrZones: ZoneInfo[] = [];\n    private _lastPowerZone: number | null = null;\n    private _lastHrZone: number | null = null;\n    private _lastUpdateTime: number | null = null;\n    private _ftp: number | null = null;\n    private _maxHr: number | null = null;\n    private _currentPowerZone: CurrentZoneStatus | null = null;\n    private _currentHrZone: CurrentZoneStatus | null = null;\n    private _onChangeCallbacks: ZoneStateChangeCallback[] = [];\n\n    constructor() {\n        this.loadProfile();\n    }\n\n    /**\n     * Load user profile and initialize zones\n     */\n    loadProfile(): void {\n        const profile = loadUserProfile();\n        this._ftp = profile.ftp;\n        this._maxHr = profile.maxHr;\n\n        // Initialize power zones\n        if (this._ftp) {\n            const powerZonesDef = calculatePowerZones(this._ftp);\n            this._powerZones = powerZonesDef.map((z, i) => ({\n                zone: i + 1,\n                name: z.name,\n                min: z.min,\n                max: z.max,\n                timeInZoneMs: 0,\n            }));\n        }\n\n        // Initialize HR zones\n        if (this._maxHr) {\n            const hrZonesDef = calculateHrZones(this._maxHr);\n            this._hrZones = hrZonesDef.map((z, i) => ({\n                zone: i + 1,\n                name: z.name,\n                min: z.min,\n                max: z.max,\n                timeInZoneMs: 0,\n            }));\n        }\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: ZoneStateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: ZoneStateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    /**\n     * Notify listeners of state change\n     */\n    private _notifyChange(): void {\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('Zone state change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Update power value and track zone time\n     */\n    updatePower(power: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._ftp) return null;\n\n        const zoneInfo = getPowerZone(power, this._ftp);\n        if (!zoneInfo) return null;\n\n        const currentZone = zoneInfo.zone;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastPowerZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._powerZones[this._lastPowerZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                // Only count if less than 5 seconds (avoid large gaps)\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastPowerZone = currentZone;\n        this._lastUpdateTime = timestamp;\n\n        // Calculate position within zone\n        const zoneData = this._powerZones[currentZone - 1];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0\n            ? Math.min(100, Math.max(0, ((power - zoneData.min) / range) * 100))\n            : 50;\n\n        this._currentPowerZone = {\n            zone: currentZone,\n            name: zoneInfo.name,\n            percentInZone,\n        };\n\n        this._notifyChange();\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Update heart rate value and track zone time\n     */\n    updateHeartRate(hr: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._maxHr) return null;\n\n        const zoneInfo = getHrZone(hr, this._maxHr);\n        if (!zoneInfo) return null;\n\n        const currentZone = zoneInfo.zone;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastHrZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._hrZones[this._lastHrZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastHrZone = currentZone;\n        // Only update if no power update occurred (prevent double counting)\n        if (this._lastUpdateTime === null || timestamp - this._lastUpdateTime > 50) {\n            this._lastUpdateTime = timestamp;\n        }\n\n        // Calculate position within zone\n        const zoneData = this._hrZones[currentZone - 1];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0\n            ? Math.min(100, Math.max(0, ((hr - zoneData.min) / range) * 100))\n            : 50;\n\n        this._currentHrZone = {\n            zone: currentZone,\n            name: zoneInfo.name,\n            percentInZone,\n        };\n\n        this._notifyChange();\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get current power zone status\n     */\n    getCurrentPowerZone(): CurrentZoneStatus | null {\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Get current HR zone status\n     */\n    getCurrentHrZone(): CurrentZoneStatus | null {\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get power zone distribution for summary\n     */\n    getPowerZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._powerZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._powerZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Get HR zone distribution for summary\n     */\n    getHrZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._hrZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._hrZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Check if power zones are configured\n     */\n    hasPowerZones(): boolean {\n        return this._ftp !== null && this._ftp > 0;\n    }\n\n    /**\n     * Check if HR zones are configured\n     */\n    hasHrZones(): boolean {\n        return this._maxHr !== null && this._maxHr > 0;\n    }\n\n    /**\n     * Get FTP value\n     */\n    getFtp(): number | null {\n        return this._ftp;\n    }\n\n    /**\n     * Get Max HR value\n     */\n    getMaxHr(): number | null {\n        return this._maxHr;\n    }\n\n    /**\n     * Reset all zone tracking data\n     */\n    reset(): void {\n        this._powerZones.forEach(z => z.timeInZoneMs = 0);\n        this._hrZones.forEach(z => z.timeInZoneMs = 0);\n        this._lastPowerZone = null;\n        this._lastHrZone = null;\n        this._lastUpdateTime = null;\n        this._currentPowerZone = null;\n        this._currentHrZone = null;\n        this._notifyChange();\n    }\n\n    /**\n     * Export zone data as JSON (for exports/summary)\n     */\n    toJSON(): {\n        powerZones: ZoneInfo[];\n        hrZones: ZoneInfo[];\n        ftp: number | null;\n        maxHr: number | null;\n    } {\n        return {\n            powerZones: [...this._powerZones],\n            hrZones: [...this._hrZones],\n            ftp: this._ftp,\n            maxHr: this._maxHr,\n        };\n    }\n}\n","/**\n * Metrics Display Initialization\n * \n * Sets up zone tracking and live charts for workout metrics.\n * The actual data field display is handled by DataFieldsManager.\n * \n * @module initMetricsDisplay\n */\n\nimport type { MeasurementsState } from './measurements-state.js';\nimport { ZoneState } from './zone-state.js';\nimport type { LiveChart } from './components/LiveChart.js';\nimport { voiceFeedback } from './services/VoiceFeedback.js';\n\n/**\n * Parameters for metrics display initialization\n */\ninterface InitMetricsDisplayParams {\n    measurementsState: MeasurementsState;\n}\n\n/** Maximum age of measurement data before showing as disconnected (ms) */\nconst DATA_TIMEOUT_MS = 5000;\n\n/** Update interval for display refresh (ms) */\nconst UPDATE_INTERVAL_MS = 100;\n\n/** Zone state instance - exported for use in summary/exports */\nexport let zoneState: ZoneState;\n\n/**\n * Initialize live charts for power and heart rate\n */\nfunction initLiveCharts(): { powerChart: LiveChart | null; hrChart: LiveChart | null } {\n    let powerChart = document.getElementById('powerLiveChart') as LiveChart | null;\n    let hrChart = document.getElementById('hrLiveChart') as LiveChart | null;\n\n    // Create charts container if it doesn't exist\n    let chartsContainer = document.getElementById('liveChartsContainer');\n    if (!chartsContainer) {\n        const metricsSection = document.getElementById('yourMetrics');\n        if (metricsSection) {\n            chartsContainer = document.createElement('div');\n            chartsContainer.id = 'liveChartsContainer';\n            chartsContainer.className = 'live-charts-container';\n            chartsContainer.style.display = 'none'; // Hidden by default\n\n            // Insert after data fields carousel\n            const dataFieldsCarousel = document.getElementById('dataFieldsCarousel');\n            if (dataFieldsCarousel && dataFieldsCarousel.nextSibling) {\n                metricsSection.insertBefore(chartsContainer, dataFieldsCarousel.nextSibling);\n            } else {\n                metricsSection.appendChild(chartsContainer);\n            }\n        }\n    }\n\n    if (chartsContainer) {\n        // Create power chart if it doesn't exist\n        if (!powerChart) {\n            powerChart = document.createElement('bpt-live-chart') as LiveChart;\n            powerChart.id = 'powerLiveChart';\n            powerChart.setAttribute('type', 'power');\n            powerChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(powerChart);\n        }\n\n        // Create HR chart if it doesn't exist\n        if (!hrChart) {\n            hrChart = document.createElement('bpt-live-chart') as LiveChart;\n            hrChart.id = 'hrLiveChart';\n            hrChart.setAttribute('type', 'heartrate');\n            hrChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(hrChart);\n        }\n    }\n\n    return { powerChart, hrChart };\n}\n\n/**\n * Get or create the charts toggle button\n */\nfunction initChartsToggle(chartsVisible: boolean): HTMLButtonElement | null {\n    let toggleBtn = document.getElementById('toggleLiveCharts') as HTMLButtonElement | null;\n\n    if (!toggleBtn) {\n        const topBarControls = document.getElementById('topBarControls');\n        if (topBarControls) {\n            toggleBtn = document.createElement('button');\n            toggleBtn.id = 'toggleLiveCharts';\n            toggleBtn.className = 'workout-btn workout-btn-chart';\n            toggleBtn.setAttribute('aria-label', 'Toggle live charts');\n            toggleBtn.setAttribute('title', 'Toggle Charts');\n            toggleBtn.innerHTML = '';\n            toggleBtn.style.display = 'none'; // Hidden until workout starts\n\n            // Insert before workout controls\n            const workoutControls = document.querySelector('.workout-controls');\n            if (workoutControls) {\n                topBarControls.insertBefore(toggleBtn, workoutControls);\n            } else {\n                topBarControls.appendChild(toggleBtn);\n            }\n        }\n    }\n\n    if (toggleBtn) {\n        toggleBtn.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n    }\n\n    return toggleBtn;\n}\n\n/**\n * Initialize the metrics display update loop.\n * \n * Sets up zone tracking and live charts. The actual data field display\n * is handled by DataFieldsManager.\n * \n * @param params - Object containing state objects\n * @returns The ZoneState instance for external use\n */\nexport const initMetricsDisplay = ({\n    measurementsState,\n}: InitMetricsDisplayParams): ZoneState => {\n    // Initialize zone state\n    zoneState = new ZoneState();\n\n    // Initialize live charts\n    const { powerChart, hrChart } = initLiveCharts();\n    let chartsVisible = localStorage.getItem('bpt-charts-visible') === 'true';\n\n    // Initialize charts toggle button\n    const chartsToggle = initChartsToggle(chartsVisible);\n    const chartsContainer = document.getElementById('liveChartsContainer');\n\n    // Set initial visibility\n    if (chartsContainer) {\n        chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n    }\n\n    // Charts toggle click handler\n    if (chartsToggle) {\n        chartsToggle.addEventListener('click', () => {\n            chartsVisible = !chartsVisible;\n            localStorage.setItem('bpt-charts-visible', chartsVisible ? 'true' : 'false');\n            chartsToggle.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n            if (chartsContainer) {\n                chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n            }\n        });\n    }\n\n    // Track last data index to only push new data points\n    let lastPowerIndex = 0;\n    let lastHrIndex = 0;\n\n    // Track last zones for voice feedback\n    let lastPowerZone: number | null = null;\n    let lastHrZone: number | null = null;\n\n    /**\n     * Update live charts with new data\n     */\n    const updateLiveCharts = (): void => {\n        // Update power chart\n        if (powerChart && measurementsState.power.length > lastPowerIndex) {\n            for (let i = lastPowerIndex; i < measurementsState.power.length; i++) {\n                const point = measurementsState.power[i];\n                powerChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastPowerIndex = measurementsState.power.length;\n        }\n\n        // Update HR chart\n        if (hrChart && measurementsState.heartrate.length > lastHrIndex) {\n            for (let i = lastHrIndex; i < measurementsState.heartrate.length; i++) {\n                const point = measurementsState.heartrate[i];\n                hrChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastHrIndex = measurementsState.heartrate.length;\n        }\n    };\n\n    /**\n     * Update zone tracking and trigger voice announcements\n     */\n    const updateZoneTracking = (): void => {\n        // Update power zones\n        if (measurementsState.power.length > 0) {\n            const latest = measurementsState.power[measurementsState.power.length - 1];\n            if (Date.now() - latest.timestamp < DATA_TIMEOUT_MS) {\n                const zoneInfo = zoneState.updatePower(latest.value, latest.timestamp);\n                const currentZone = zoneInfo?.zone ?? null;\n\n                if (currentZone !== lastPowerZone) {\n                    if (currentZone !== null && lastPowerZone !== null) {\n                        voiceFeedback.announceZoneChange(zoneInfo!.name);\n                    }\n                    lastPowerZone = currentZone;\n                }\n            }\n        }\n\n        // Update HR zones\n        if (measurementsState.heartrate.length > 0) {\n            const latest = measurementsState.heartrate[measurementsState.heartrate.length - 1];\n            if (Date.now() - latest.timestamp < DATA_TIMEOUT_MS) {\n                const zoneInfo = zoneState.updateHeartRate(latest.value, latest.timestamp);\n                const currentZone = zoneInfo?.zone ?? null;\n\n                if (currentZone !== lastHrZone) {\n                    if (currentZone !== null && lastHrZone !== null) {\n                        voiceFeedback.announceZoneChange(zoneInfo!.name);\n                    }\n                    lastHrZone = currentZone;\n                }\n            }\n        }\n    };\n\n    // Start the update loop for charts and zone tracking\n    setInterval(() => {\n        updateZoneTracking();\n        updateLiveCharts();\n    }, UPDATE_INTERVAL_MS);\n\n    // Show/hide charts toggle based on workout state\n    document.addEventListener('workoutStarted', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'inline-flex';\n        }\n    });\n\n    document.addEventListener('workoutStopped', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'none';\n        }\n    });\n\n    // Listen for profile updates to reload zones\n    window.addEventListener('storage', (e) => {\n        if (e.key === 'bpt-user-profile') {\n            zoneState.loadProfile();\n        }\n    });\n\n    // Listen for workout discard to reset zones and charts\n    document.addEventListener('workout-discarded', () => {\n        zoneState.reset();\n        lastPowerIndex = 0;\n        lastHrIndex = 0;\n        if (powerChart) powerChart.clear();\n        if (hrChart) hrChart.clear();\n    });\n\n    return zoneState;\n};\n","/**\n * API client for the BPT streaming service\n * Handles communication with the Redis Streams API\n * \n * @module streamClient\n */\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Stream information\n */\nexport interface StreamInfo {\n    name: string;\n    length: number;\n    firstMessageId: string;\n    lastMessageId: string;\n}\n\n/**\n * Stream creation response\n */\nexport interface CreateStreamResponse {\n    success: boolean;\n    streamName: string;\n    messageId: string;\n}\n\n/**\n * Message response\n */\nexport interface MessageResponse {\n    success: boolean;\n    messageId: string;\n    streamName: string;\n}\n\n/**\n * Messages query options\n */\nexport interface GetMessagesOptions {\n    start?: string;\n    end?: string;\n    count?: number;\n}\n\n/**\n * Stream messages response\n */\nexport interface StreamMessagesResponse {\n    streamName: string;\n    messages: StreamMessageData[];\n}\n\n/**\n * Message data from stream\n */\nexport interface StreamMessageData {\n    id: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE message callback\n */\nexport type SSEMessageCallback = (data: SSEMessageData) => void;\n\n/**\n * SSE connected callback\n */\nexport type SSEConnectedCallback = (data: SSEConnectedData) => void;\n\n/**\n * SSE error callback\n */\nexport type SSEErrorCallback = (error: Error | Event) => void;\n\n/**\n * SSE message data\n */\nexport interface SSEMessageData {\n    type: 'message';\n    id: string;\n    streamName: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE connected data\n */\nexport interface SSEConnectedData {\n    type: 'connected';\n    streamName: string;\n    listenerId: string;\n}\n\n/**\n * Workout data to send\n */\nexport interface WorkoutDataPayload {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    incline?: number | null;\n    timestamp: number;\n    elapsed: string; // usually seconds as string, or mm:ss\n}\n\n/**\n * Delete stream response\n */\nexport interface DeleteStreamResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Create a new stream\n * \n * @param streamName - Unique name for the stream\n * @returns Promise with stream creation result\n */\nexport async function createStream(streamName: string): Promise<CreateStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/create`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create stream');\n    }\n\n    return response.json();\n}\n\n/**\n * List all available streams\n * \n * @returns Promise with list of streams\n */\nexport async function listStreams(): Promise<{ streams: StreamInfo[] }> {\n    const response = await fetch(`${API_BASE_URL}/api/streams`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(error || 'Failed to list streams');\n    }\n\n    return response.json();\n}\n\n/**\n * Add a message to a stream\n * \n * @param streamName - Name of the stream\n * @param message - Message content\n * @param author - Message author\n * @returns Promise with message result\n */\nexport async function addMessage(\n    streamName: string,\n    message: string,\n    author: string = 'anonymous'\n): Promise<MessageResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ message, author }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to add message');\n    }\n\n    return response.json();\n}\n\n/**\n * Get messages from a stream\n * \n * @param streamName - Name of the stream\n * @param options - Query options\n * @returns Promise with stream messages\n */\nexport async function getMessages(\n    streamName: string,\n    options: GetMessagesOptions = {}\n): Promise<StreamMessagesResponse> {\n    const { start = '-', end = '+', count = 100 } = options;\n    const params = new URLSearchParams({ start, end, count: count.toString() });\n\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get messages');\n    }\n\n    return response.json();\n}\n\n/**\n * SSE Connection interface for fetch-based SSE\n * Provides a consistent API similar to EventSource\n */\nexport interface SSEConnection {\n    /** Close the SSE connection */\n    close: () => void;\n    /** Whether the connection is active */\n    readonly active: boolean;\n}\n\n/**\n * Create a fetch-based SSE connection that supports custom headers\n * Unlike EventSource, this allows sending authentication via headers\n * \n * @param url - The SSE endpoint URL\n * @param onMessage - Callback for each SSE message\n * @param onConnected - Callback when connection is established\n * @param onError - Callback for errors\n * @returns SSEConnection object with close() method\n */\nfunction createFetchSSE(\n    url: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const controller = new AbortController();\n    let isActive = true;\n\n    const connection: SSEConnection = {\n        close: () => {\n            isActive = false;\n            controller.abort();\n        },\n        get active() {\n            return isActive;\n        }\n    };\n\n    // Start the fetch in the background\n    (async () => {\n        try {\n            const response = await fetch(url, {\n                method: 'GET',\n                headers: getHeaders({\n                    'Accept': 'text/event-stream',\n                    'Cache-Control': 'no-cache',\n                }),\n                signal: controller.signal,\n            });\n\n            if (!response.ok) {\n                throw new Error(`SSE connection failed: ${response.status} ${response.statusText}`);\n            }\n\n            if (!response.body) {\n                throw new Error('SSE response has no body');\n            }\n\n            const reader = response.body.getReader();\n            const decoder = new TextDecoder();\n            let buffer = '';\n\n            while (isActive) {\n                const { done, value } = await reader.read();\n\n                if (done) {\n                    break;\n                }\n\n                buffer += decoder.decode(value, { stream: true });\n\n                // Process complete SSE messages (separated by double newlines)\n                const messages = buffer.split('\\n\\n');\n                buffer = messages.pop() || ''; // Keep incomplete message in buffer\n\n                for (const message of messages) {\n                    if (!message.trim()) continue;\n\n                    // Parse SSE format: \"data: {...}\\n\"\n                    const dataMatch = message.match(/^data:\\s*(.+)$/m);\n                    if (dataMatch) {\n                        try {\n                            const data = JSON.parse(dataMatch[1]);\n\n                            if (data.type === 'connected' && onConnected) {\n                                onConnected(data);\n                            } else if (data.type === 'message') {\n                                onMessage(data);\n                            }\n                        } catch (parseError) {\n                            console.error('Error parsing SSE data:', parseError);\n                        }\n                    }\n                }\n            }\n        } catch (error) {\n            if ((error as Error).name === 'AbortError') {\n                // Connection was intentionally closed\n                return;\n            }\n            console.error('SSE connection error:', error);\n            if (onError) {\n                onError(error as Error);\n            }\n        } finally {\n            isActive = false;\n        }\n    })();\n\n    return connection;\n}\n\n/**\n * Connect to a stream and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n * \n * @param streamName - Name of the stream to listen to\n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToStream(\n    streamName: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/${streamName}/listen`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Connect to all streams and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n * \n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToAllStreams(\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/listenAll`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Send workout data to a stream\n * \n * @param streamName - Name of the stream\n * @param workoutData - Workout data to send\n * @returns Promise with message result\n */\nexport async function sendWorkoutData(\n    streamName: string,\n    workoutData: WorkoutDataPayload\n): Promise<MessageResponse> {\n    const message = JSON.stringify({\n        power: workoutData.power ?? null,\n        cadence: workoutData.cadence ?? null,\n        heartrate: workoutData.heartrate ?? null,\n        speed: workoutData.speed ?? null,\n        distance: workoutData.distance ?? null,\n        altitude: workoutData.altitude ?? null,\n        incline: workoutData.incline ?? null,\n        timestamp: workoutData.timestamp,\n        elapsed: workoutData.elapsed,\n        dataType: 'workout_metrics',\n    });\n\n    return addMessage(streamName, message, 'bike-power-tracker');\n}\n\n/**\n * Delete a stream\n * \n * @param streamName - Name of the stream to delete\n * @returns Promise with deletion result\n */\nexport async function deleteStream(streamName: string): Promise<DeleteStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete stream');\n    }\n\n    return response.json();\n}\n","/**\n * Stream Viewer UI\n * \n * Displays available streams and allows viewing live workout data.\n * \n * @module streamViewer\n */\n\nimport { listStreams, listenToStream, listenToAllStreams } from '../api/streamClient.js';\nimport type { StreamInfo, SSEMessageData, SSEConnection } from '../api/streamClient.js';\n\n/**\n * Workout metrics data from stream message\n */\ninterface WorkoutMetrics {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    elapsed?: string;\n    dataType?: string;\n}\n\n/**\n * All streams message data\n */\ninterface AllStreamsMessageData {\n    stream: string;\n    data: {\n        message: string;\n    } | WorkoutMetrics;\n}\n\n/**\n * Stream viewer class that manages the stream viewing UI\n */\nexport class StreamViewer {\n    private modal: HTMLDivElement | null = null;\n    private currentConnection: SSEConnection | null = null;\n    private streamMetricsSection: HTMLElement | null = null;\n    private allStreamsMetricsSection: HTMLElement | null = null;\n    private allStreamsConnection: SSEConnection | null = null;\n    private streamCards: Map<string, HTMLElement> = new Map();\n    private streamRows: Map<string, HTMLElement> = new Map();\n    private isCompactView: boolean = false;\n\n    constructor() {\n        this.initModal();\n        this.initInlineViewer();\n        this.initAllStreamsViewer();\n    }\n\n    /**\n     * Initialize the inline stream viewer in main content\n     */\n    private initInlineViewer(): void {\n        this.streamMetricsSection = document.getElementById('streamMetrics');\n        if (!this.streamMetricsSection) {\n            console.warn('Stream metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeStreamView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromStream());\n        }\n    }\n\n    /**\n     * Initialize the all streams viewer\n     */\n    private initAllStreamsViewer(): void {\n        this.allStreamsMetricsSection = document.getElementById('allStreamsMetrics');\n        if (!this.allStreamsMetricsSection) {\n            console.warn('All streams metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeAllStreamsView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromAllStreams());\n        }\n\n        const toggleViewBtn = document.getElementById('toggleViewBtn');\n        if (toggleViewBtn) {\n            toggleViewBtn.addEventListener('click', () => this.toggleAllStreamsView());\n        }\n    }\n\n    /**\n     * Toggle between grid and compact list view\n     */\n    private toggleAllStreamsView(): void {\n        this.isCompactView = !this.isCompactView;\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        const toggleBtn = document.getElementById('toggleViewBtn');\n\n        if (this.isCompactView) {\n            if (grid) grid.style.display = 'none';\n            if (list) list.style.display = 'flex';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle grid view';\n                toggleBtn.classList.add('active');\n            }\n        } else {\n            if (grid) grid.style.display = 'grid';\n            if (list) list.style.display = 'none';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle compact view';\n                toggleBtn.classList.remove('active');\n            }\n        }\n    }\n\n    /**\n     * Initialize the stream viewer modal\n     */\n    private initModal(): void {\n        const modal = document.createElement('div');\n        modal.id = 'streamViewerModal';\n        modal.className = 'stream-modal';\n        modal.innerHTML = `\n      <div class=\"stream-modal-content\">\n        <div class=\"stream-modal-header\">\n          <h2> Live Streams</h2>\n          <button id=\"closeStreamModal\" class=\"close-button\">&times;</button>\n        </div>\n        <div class=\"stream-modal-body\">\n          <div class=\"stream-list-container\">\n            <div class=\"stream-list-controls\" style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n              <button id=\"refreshStreamList\" class=\"refresh-button\"> Refresh List</button>\n              <button id=\"viewAllStreamsBtn\" class=\"connect-button\" style=\"background-color: #4CAF50;\"> View All Streams</button>\n            </div>\n            <div id=\"streamsList\" class=\"streams-list\">\n              <p class=\"loading\">Loading streams...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n        document.body.appendChild(modal);\n        this.modal = modal;\n        this.setupEventListeners();\n    }\n\n    /**\n     * Set up event listeners for modal controls\n     */\n    private setupEventListeners(): void {\n        const closeBtn = document.getElementById('closeStreamModal');\n        const refreshBtn = document.getElementById('refreshStreamList');\n        const viewAllBtn = document.getElementById('viewAllStreamsBtn');\n\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.close());\n        }\n        if (refreshBtn) {\n            refreshBtn.addEventListener('click', () => this.refreshStreamList());\n        }\n        if (viewAllBtn) {\n            viewAllBtn.addEventListener('click', () => this.connectToAllStreams());\n        }\n\n        if (this.modal) {\n            this.modal.addEventListener('click', (e: MouseEvent) => {\n                if (e.target === this.modal) {\n                    this.close();\n                }\n            });\n        }\n    }\n\n    /**\n     * Open the stream viewer modal\n     */\n    async open(): Promise<void> {\n        if (this.modal) {\n            this.modal.style.display = 'flex';\n        }\n        await this.refreshStreamList();\n    }\n\n    /**\n     * Close the stream viewer modal\n     */\n    close(): void {\n        if (this.modal) {\n            this.modal.style.display = 'none';\n        }\n    }\n\n    /**\n     * Refresh the list of available streams\n     */\n    async refreshStreamList(): Promise<void> {\n        const streamsList = document.getElementById('streamsList');\n        if (!streamsList) return;\n\n        streamsList.innerHTML = '<p class=\"loading\">Loading streams...</p>';\n\n        try {\n            const { streams } = await listStreams();\n\n            if (streams.length === 0) {\n                streamsList.innerHTML = '<p class=\"no-streams\">No active streams found</p>';\n                return;\n            }\n\n            streamsList.innerHTML = '';\n            streams.forEach((stream: StreamInfo) => {\n                const streamItem = this.createStreamItem(stream);\n                streamsList.appendChild(streamItem);\n            });\n        } catch (error) {\n            console.error('Failed to load streams:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            streamsList.innerHTML = `<p class=\"error\">Failed to load streams: ${message}</p>`;\n        }\n    }\n\n    /**\n     * Create a stream list item element\n     */\n    private createStreamItem(stream: StreamInfo): HTMLElement {\n        const div = document.createElement('div');\n        div.className = 'stream-item';\n\n        const isWorkoutStream = stream.name.startsWith('workout-');\n        const icon = isWorkoutStream ? '' : '';\n\n        div.innerHTML = `\n      <div class=\"stream-item-info\">\n        <div class=\"stream-item-name\">${icon} ${stream.name}</div>\n        <div class=\"stream-item-meta\">\n          ${stream.length} message${stream.length !== 1 ? 's' : ''}\n        </div>\n      </div>\n      <button class=\"connect-button\" data-stream=\"${stream.name}\">\n         View\n      </button>\n    `;\n\n        const connectBtn = div.querySelector('.connect-button');\n        connectBtn?.addEventListener('click', () => {\n            this.connectToStream(stream.name);\n        });\n\n        return div;\n    }\n\n    /**\n     * Connect to a stream and view live data\n     */\n    connectToStream(streamName: string): void {\n        this.disconnectFromStream();\n\n        if (!this.streamMetricsSection) {\n            console.error('Stream metrics section not available');\n            return;\n        }\n\n        this.streamMetricsSection.style.display = 'flex';\n\n        const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n        if (toggleStream) toggleStream.checked = true;\n\n        const streamTitle = document.getElementById('streamTitle');\n        const statusEl = document.getElementById('streamStatus');\n\n        if (streamTitle) streamTitle.textContent = streamName;\n        if (statusEl) {\n            statusEl.textContent = 'Connecting...';\n            statusEl.className = 'status-badge connecting';\n        }\n\n        this.close();\n\n        this.currentConnection = listenToStream(\n            streamName,\n            (data: SSEMessageData) => this.handleStreamMessage(data),\n            () => this.handleStreamConnected(),\n            (error: Error | Event) => this.handleStreamError(error)\n        );\n    }\n\n    /**\n     * Connect to all streams\n     */\n    connectToAllStreams(): void {\n        this.disconnectFromStream();\n        this.disconnectFromAllStreams();\n\n        if (!this.allStreamsMetricsSection) {\n            console.error('All streams metrics section not available');\n            return;\n        }\n\n        this.allStreamsMetricsSection.style.display = 'flex';\n        this.close();\n\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        if (grid) grid.innerHTML = '';\n        if (list) list.innerHTML = '';\n        this.streamCards.clear();\n        this.streamRows.clear();\n\n        const allStreamsStatus = document.getElementById('allStreamsStatus');\n        if (allStreamsStatus) {\n            allStreamsStatus.textContent = 'Connecting...';\n            allStreamsStatus.className = 'status-badge connecting';\n        }\n\n        this.allStreamsConnection = listenToAllStreams(\n            (data: SSEMessageData) => this.handleAllStreamsMessage(data as unknown as AllStreamsMessageData),\n            () => this.handleAllStreamsConnected(),\n            (error: Error | Event) => this.handleAllStreamsError(error)\n        );\n    }\n\n    /**\n     * Handle all streams connected event\n     */\n    private handleAllStreamsConnected(): void {\n        console.log('Connected to all streams');\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle all streams error\n     */\n    private handleAllStreamsError(error: Error | Event): void {\n        console.error('All streams error:', error);\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (!statusEl) return;\n\n        if (this.allStreamsConnection && this.allStreamsConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Disconnect from all streams\n     */\n    disconnectFromAllStreams(): void {\n        if (this.allStreamsConnection) {\n            this.allStreamsConnection.close();\n            this.allStreamsConnection = null;\n        }\n\n        if (this.allStreamsMetricsSection) {\n            this.allStreamsMetricsSection.style.display = 'none';\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n    }\n\n    /**\n     * Handle incoming message for all streams view\n     */\n    private handleAllStreamsMessage(data: AllStreamsMessageData): void {\n        try {\n            const streamName = data.stream;\n            const messageData = typeof data.data === 'string'\n                ? JSON.parse(data.data)\n                : data.data;\n\n            this.updateStreamCard(streamName, messageData);\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update or create a stream card\n     */\n    private updateStreamCard(streamName: string, data: { message?: string } & WorkoutMetrics): void {\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n\n        let messageData: WorkoutMetrics = {};\n        try {\n            if (data.message) {\n                messageData = JSON.parse(data.message);\n            } else {\n                messageData = data;\n            }\n        } catch {\n            // Ignore parse errors\n        }\n\n        if (grid) {\n            let card = this.streamCards.get(streamName);\n\n            if (!card) {\n                card = document.createElement('div');\n                card.className = 'stream-card';\n                card.innerHTML = `\n          <div class=\"stream-card-name\" title=\"${streamName}\">${streamName}</div>\n          <div class=\"stream-card-power\">--</div>\n          <div class=\"stream-card-secondary\">\n            <div class=\"stream-card-metric\">\n              <span>CAD</span>\n              <span class=\"card-cadence\">--</span>\n            </div>\n            <div class=\"stream-card-metric\">\n              <span>HR</span>\n              <span class=\"card-heartrate\">--</span>\n            </div>\n          </div>\n        `;\n                grid.appendChild(card);\n                this.streamCards.set(streamName, card);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = card.querySelector('.stream-card-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n\n            if (messageData.cadence !== undefined && messageData.cadence !== null) {\n                const cadenceEl = card.querySelector('.card-cadence');\n                if (cadenceEl) cadenceEl.textContent = String(messageData.cadence);\n            }\n\n            if (messageData.heartrate !== undefined && messageData.heartrate !== null) {\n                const hrEl = card.querySelector('.card-heartrate');\n                if (hrEl) hrEl.textContent = String(messageData.heartrate);\n            }\n        }\n\n        if (list) {\n            let row = this.streamRows.get(streamName);\n\n            if (!row) {\n                row = document.createElement('div');\n                row.className = 'stream-row';\n                row.innerHTML = `\n          <span class=\"stream-row-name\" title=\"${streamName}\">${streamName}</span>\n          <span class=\"stream-row-power\">--</span>\n        `;\n                list.appendChild(row);\n                this.streamRows.set(streamName, row);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = row.querySelector('.stream-row-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n        }\n    }\n\n    /**\n     * Disconnect from the current stream\n     */\n    disconnectFromStream(): void {\n        this.disconnectFromAllStreams();\n\n        if (this.currentConnection) {\n            this.currentConnection.close();\n            this.currentConnection = null;\n        }\n\n        if (this.streamMetricsSection) {\n            this.streamMetricsSection.style.display = 'none';\n\n            const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n            if (toggleStream) toggleStream.checked = false;\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n\n        this.resetViewer();\n    }\n\n    /**\n     * Handle stream connected event\n     */\n    private handleStreamConnected(): void {\n        const statusEl = document.getElementById('streamStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle incoming stream message\n     */\n    private handleStreamMessage(data: SSEMessageData): void {\n        try {\n            const messageStr = (data as unknown as { data: { message: string } }).data?.message;\n            const messageData: WorkoutMetrics = typeof messageStr === 'string'\n                ? JSON.parse(messageStr)\n                : (data as unknown as { data: WorkoutMetrics }).data;\n\n            if (\n                messageData.dataType === 'workout_metrics' ||\n                messageData.power !== undefined ||\n                messageData.cadence !== undefined ||\n                messageData.heartrate !== undefined\n            ) {\n                this.updateMetrics(messageData);\n            }\n\n            const lastUpdateEl = document.getElementById('streamLastUpdate');\n            if (lastUpdateEl) {\n                const now = new Date();\n                lastUpdateEl.textContent = `Last update: ${now.toLocaleTimeString()}`;\n            }\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update metrics display with new data\n     */\n    private updateMetrics(data: WorkoutMetrics): void {\n        const powerEl = document.getElementById('streamPower');\n        const cadenceEl = document.getElementById('streamCadence');\n        const heartrateEl = document.getElementById('streamHeartrate');\n        const speedEl = document.getElementById('streamSpeed');\n        const distanceEl = document.getElementById('streamDistance');\n        const altitudeEl = document.getElementById('streamAltitude');\n        const elapsedEl = document.getElementById('streamElapsed');\n\n        if (powerEl && data.power !== null && data.power !== undefined) {\n            powerEl.textContent = String(data.power);\n        }\n        if (cadenceEl && data.cadence !== null && data.cadence !== undefined) {\n            cadenceEl.textContent = String(data.cadence);\n        }\n        if (heartrateEl && data.heartrate !== null && data.heartrate !== undefined) {\n            heartrateEl.textContent = String(data.heartrate);\n        }\n        if (speedEl && data.speed !== null && data.speed !== undefined) {\n            speedEl.textContent = String(data.speed);\n        }\n        if (distanceEl && data.distance !== null && data.distance !== undefined) {\n            distanceEl.textContent = String(data.distance);\n        }\n        if (altitudeEl && data.altitude !== null && data.altitude !== undefined) {\n            altitudeEl.textContent = String(data.altitude);\n        }\n        if (elapsedEl && data.elapsed) {\n            elapsedEl.textContent = data.elapsed;\n        }\n    }\n\n    /**\n     * Handle stream error\n     */\n    private handleStreamError(error: Error | Event): void {\n        console.error('Stream error:', error);\n        const statusEl = document.getElementById('streamStatus');\n        if (!statusEl) return;\n\n        if (this.currentConnection && this.currentConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Reset viewer display\n     */\n    private resetViewer(): void {\n        const elements = [\n            'streamPower',\n            'streamCadence',\n            'streamHeartrate',\n            'streamSpeed',\n            'streamDistance',\n            'streamAltitude',\n            'streamElapsed',\n        ];\n\n        elements.forEach((id) => {\n            const el = document.getElementById(id);\n            if (el) el.textContent = '--';\n        });\n\n        const streamLastUpdate = document.getElementById('streamLastUpdate');\n        if (streamLastUpdate) streamLastUpdate.textContent = 'Waiting for data...';\n    }\n}\n\n/**\n * Initialize stream viewer UI\n */\nexport function initStreamViewer(): StreamViewer {\n    const viewer = new StreamViewer();\n\n    const viewStreamsBtn = document.getElementById('viewStreamsButton');\n    if (viewStreamsBtn) {\n        viewStreamsBtn.addEventListener('click', () => viewer.open());\n    }\n\n    return viewer;\n}\n","/**\n * Streaming Controls Initialization\n * \n * Sets up UI controls for starting, pausing, and stopping workout streaming.\n * \n * @module initStreamingControls\n */\n\nimport { showNotification } from './ui/notifications.js';\nimport type { StreamManager, StreamStatus } from './stream-manager.js';\nimport type { TimeState } from './getInitState.js';\n\n/**\n * Initialize streaming controls.\n * \n * Sets up event handlers for:\n * - Start/stop streaming button\n * - Stream name modal\n * - Toolbar play/pause/stop buttons\n * - Auto-stop when workout ends\n * \n * @param streamManager - The stream manager instance\n * @param timeState - The workout time state\n */\nexport function initStreamingControls(\n    streamManager: StreamManager,\n    timeState: TimeState\n): void {\n    // Main button\n    const startStreamButton = document.getElementById('startStreamButton') as HTMLButtonElement | null;\n\n    // Modal elements\n    const modal = document.getElementById('streamNameModal') as HTMLDivElement | null;\n    const closeBtn = document.getElementById('closeStreamNameModal') as HTMLButtonElement | null;\n    const cancelBtn = document.getElementById('cancelStreamName') as HTMLButtonElement | null;\n    const confirmBtn = document.getElementById('confirmStreamName') as HTMLButtonElement | null;\n    const nameInput = document.getElementById('streamNameInput') as HTMLInputElement | null;\n\n    // Toolbar elements\n    const toolbar = document.getElementById('activeStreamToolbar') as HTMLDivElement | null;\n    const toolbarStreamName = document.getElementById('toolbarStreamName') as HTMLSpanElement | null;\n    const playPauseBtn = document.getElementById('streamPlayPauseBtn') as HTMLButtonElement | null;\n    const stopBtn = document.getElementById('streamStopBtn') as HTMLButtonElement | null;\n    const streamIndicator = document.querySelector('.stream-indicator') as HTMLElement | null;\n\n    /**\n     * Update toolbar visibility and state\n     */\n    const updateToolbar = (status: StreamStatus): void => {\n        if (!toolbar) return;\n\n        if (status.isStreaming) {\n            toolbar.style.display = 'flex';\n            document.body.classList.add('has-stream-toolbar');\n\n            if (toolbarStreamName) {\n                toolbarStreamName.textContent = status.streamName;\n            }\n\n            // Update Play/Pause button\n            if (playPauseBtn) {\n                if (status.isPaused) {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Resume Stream';\n                    streamIndicator?.classList.add('paused');\n                } else {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Pause Stream';\n                    streamIndicator?.classList.remove('paused');\n                }\n            }\n        } else {\n            toolbar.style.display = 'none';\n            document.body.classList.remove('has-stream-toolbar');\n        }\n    };\n\n    if (!startStreamButton) {\n        console.warn('Start stream button not found in DOM');\n        return;\n    }\n\n    /**\n     * Close the stream name modal\n     */\n    const closeModal = (): void => {\n        if (modal) modal.style.display = 'none';\n        if (nameInput) nameInput.value = '';\n    };\n\n    /**\n     * Start streaming with optional custom name\n     */\n    const startStreaming = async (): Promise<void> => {\n        const customName = nameInput?.value.trim() || '';\n\n        try {\n            const streamName = await streamManager.startStreaming(customName || undefined);\n            startStreamButton.textContent = ' Stop Streaming';\n            startStreamButton.classList.add('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification(`Streaming to: ${streamName}`, 'success');\n            closeModal();\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            showNotification('Failed to start streaming: ' + message, 'error');\n        }\n    };\n\n    /**\n     * Stop streaming\n     */\n    const stopStreaming = async (): Promise<void> => {\n        try {\n            await streamManager.stopStreaming();\n            startStreamButton.textContent = ' Start Streaming';\n            startStreamButton.classList.remove('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification('Streaming stopped', 'info');\n        } catch (error) {\n            console.error(error);\n            showNotification('Error stopping stream', 'error');\n        }\n    };\n\n    // Wire up toolbar buttons\n    if (playPauseBtn) {\n        playPauseBtn.addEventListener('click', () => {\n            const status = streamManager.getStatus();\n            if (status.isPaused) {\n                streamManager.resumeStreaming();\n                showNotification('Stream Resumed', 'success');\n            } else {\n                streamManager.pauseStreaming();\n                showNotification('Stream Paused', 'info');\n            }\n            updateToolbar(streamManager.getStatus());\n        });\n    }\n\n    if (stopBtn) {\n        stopBtn.addEventListener('click', async () => {\n            if (confirm('Stop streaming?')) {\n                await stopStreaming();\n            }\n        });\n    }\n\n    // Event listeners for modal\n    if (closeBtn) closeBtn.addEventListener('click', closeModal);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);\n\n    if (confirmBtn) {\n        confirmBtn.addEventListener('click', startStreaming);\n    }\n\n    if (nameInput) {\n        nameInput.addEventListener('keypress', (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n                startStreaming();\n            }\n        });\n    }\n\n    // Close on click outside\n    if (modal) {\n        modal.addEventListener('click', (e: MouseEvent) => {\n            if (e.target === modal) closeModal();\n        });\n    }\n\n    // Main button click handler\n    startStreamButton.addEventListener('click', async () => {\n        if (streamManager.isStreaming) {\n            await stopStreaming();\n        } else {\n            if (modal) {\n                modal.style.display = 'flex';\n                nameInput?.focus();\n            } else {\n                // Fallback if modal missing\n                try {\n                    const streamName = await streamManager.startStreaming();\n                    startStreamButton.textContent = ' Stop Streaming';\n                    startStreamButton.classList.add('streaming');\n                    updateToolbar(streamManager.getStatus());\n                    showNotification(`Streaming to: ${streamName}`, 'success');\n                } catch (error) {\n                    console.error('Failed to start streaming:', error);\n                    const message = error instanceof Error ? error.message : 'Unknown error';\n                    showNotification('Failed to start streaming: ' + message, 'error');\n                }\n            }\n        }\n    });\n\n    // Auto-stop streaming when workout is stopped (Pause or Stop buttons)\n    const pauseButton = document.getElementById('pauseButton');\n    const stopButton = document.getElementById('stopButton');\n\n    const handleWorkoutPause = () => {\n        if (timeState.running === false && streamManager.isStreaming) {\n            // Workout was just paused\n            setTimeout(() => {\n                if (!timeState.running && streamManager.isStreaming) {\n                    streamManager.stopStreaming();\n                    startStreamButton.textContent = ' Start Streaming';\n                    startStreamButton.classList.remove('streaming');\n                    updateToolbar(streamManager.getStatus());\n                }\n            }, 100);\n        }\n    };\n\n    if (pauseButton) {\n        pauseButton.addEventListener('click', handleWorkoutPause);\n    }\n    if (stopButton) {\n        stopButton.addEventListener('click', handleWorkoutPause);\n    }\n}\n","/**\n * Dark Mode Module\n * Handles theme switching and persistence for the app\n */\n\nimport { announce } from './accessibility.js';\n\nconst DARK_MODE_KEY = 'bpt-dark-mode';\n\nexport type ThemePreference = 'light' | 'dark' | 'system';\n\n/**\n * Get the stored theme preference from localStorage\n */\nexport function getStoredThemePreference(): ThemePreference | null {\n    try {\n        const stored = localStorage.getItem(DARK_MODE_KEY);\n        if (stored === 'light' || stored === 'dark' || stored === 'system') {\n            return stored;\n        }\n        return null;\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Save theme preference to localStorage\n */\nexport function saveThemePreference(preference: ThemePreference): void {\n    try {\n        localStorage.setItem(DARK_MODE_KEY, preference);\n    } catch {\n        // localStorage might not be available\n    }\n}\n\n/**\n * Check if the system prefers dark mode\n */\nexport function systemPrefersDark(): boolean {\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n}\n\n/**\n * Apply the theme to the document\n */\nexport function applyTheme(theme: 'light' | 'dark'): void {\n    document.documentElement.setAttribute('data-theme', theme);\n}\n\n/**\n * Get the effective theme based on preference\n */\nexport function getEffectiveTheme(preference: ThemePreference): 'light' | 'dark' {\n    if (preference === 'system') {\n        return systemPrefersDark() ? 'dark' : 'light';\n    }\n    return preference;\n}\n\n/**\n * Check if dark mode is currently active\n */\nexport function isDarkMode(): boolean {\n    return document.documentElement.getAttribute('data-theme') === 'dark';\n}\n\n/**\n * Toggle dark mode on/off\n */\nexport function toggleDarkMode(): boolean {\n    const currentlyDark = isDarkMode();\n    const newTheme = currentlyDark ? 'light' : 'dark';\n    applyTheme(newTheme);\n    saveThemePreference(newTheme);\n    return !currentlyDark;\n}\n\n/**\n * Initialize dark mode based on stored preference or system preference\n */\nexport function initDarkMode(): boolean {\n    const stored = getStoredThemePreference();\n\n    if (stored) {\n        const effectiveTheme = getEffectiveTheme(stored);\n        applyTheme(effectiveTheme);\n        return effectiveTheme === 'dark';\n    }\n\n    // Default to system preference if no stored preference\n    const systemDark = systemPrefersDark();\n    if (systemDark) {\n        applyTheme('dark');\n    }\n    // Note: Don't save preference when using system default\n    return systemDark;\n}\n\n/**\n * Set up the dark mode toggle checkbox\n */\nexport function setupDarkModeToggle(toggleElement: HTMLInputElement): void {\n    // Initialize toggle state\n    const isDark = initDarkMode();\n    toggleElement.checked = isDark;\n\n    // Handle toggle changes\n    toggleElement.addEventListener('change', () => {\n        const newTheme = toggleElement.checked ? 'dark' : 'light';\n        applyTheme(newTheme);\n        saveThemePreference(newTheme);\n        announce(`Dark mode ${toggleElement.checked ? 'enabled' : 'disabled'}`);\n    });\n\n    // Listen for system preference changes (when using system theme)\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    mediaQuery.addEventListener('change', (e) => {\n        // Only auto-switch if user hasn't set a preference\n        const stored = getStoredThemePreference();\n        if (!stored || stored === 'system') {\n            const newTheme = e.matches ? 'dark' : 'light';\n            applyTheme(newTheme);\n            toggleElement.checked = e.matches;\n            announce(`Dark mode ${e.matches ? 'enabled' : 'disabled'}`);\n        }\n    });\n\n    // Listen for storage changes (sync across tabs)\n    window.addEventListener('storage', (e) => {\n        if (e.key === DARK_MODE_KEY) {\n            const newPreference = e.newValue as ThemePreference | null;\n            if (newPreference) {\n                const effectiveTheme = getEffectiveTheme(newPreference);\n                applyTheme(effectiveTheme);\n                toggleElement.checked = effectiveTheme === 'dark';\n            } else {\n                // If cleared, revert to system\n                const systemDark = systemPrefersDark();\n                applyTheme(systemDark ? 'dark' : 'light');\n                toggleElement.checked = systemDark;\n            }\n        }\n    });\n}\n","/**\n * Workout Recovery\n * \n * Handles detection and recovery of interrupted workouts from IndexedDB.\n * Shows a modal to the user when a recoverable workout is found.\n * \n * @module ui/workoutRecovery\n */\n\nimport {\n    loadActiveWorkout,\n    clearActiveWorkout,\n    hasRecoverableWorkout,\n    type ActiveWorkoutRecord\n} from '../storage/workoutStorage.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Format elapsed time as human-readable string\n */\nfunction formatElapsedTime(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n\n    if (hours > 0) {\n        return `${hours}h ${minutes % 60}m`;\n    } else if (minutes > 0) {\n        return `${minutes}m ${seconds % 60}s`;\n    }\n    return `${seconds}s`;\n}\n\n/**\n * Format timestamp as human-readable date/time\n */\nfunction formatTime(timestamp: number): string {\n    return new Date(timestamp).toLocaleString();\n}\n\n/**\n * Create the recovery modal HTML\n */\nfunction createRecoveryModal(workout: ActiveWorkoutRecord): HTMLDialogElement {\n    const modal = document.createElement('dialog');\n    modal.id = 'workout-recovery-modal';\n    modal.className = 'modal';\n    modal.setAttribute('aria-labelledby', 'recovery-modal-title');\n\n    const dataPoints = workout.power.length + workout.heartrate.length + workout.cadence.length;\n    const elapsedTime = workout.lastUpdated - workout.startTime;\n\n    modal.innerHTML = `\n        <div class=\"modal-content\">\n            <h2 id=\"recovery-modal-title\"> Recover Workout?</h2>\n            <p>An interrupted workout was found from your last session.</p>\n            \n            <div class=\"recovery-summary\">\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Started</span>\n                    <span class=\"recovery-stat-value\">${formatTime(workout.startTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Duration</span>\n                    <span class=\"recovery-stat-value\">${formatElapsedTime(elapsedTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Data Points</span>\n                    <span class=\"recovery-stat-value\">${dataPoints.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Power Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.power.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Heart Rate Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.heartrate.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Cadence Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.cadence.length.toLocaleString()}</span>\n                </div>\n                ${workout.laps.length > 0 ? `\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Laps</span>\n                    <span class=\"recovery-stat-value\">${workout.laps.length}</span>\n                </div>\n                ` : ''}\n            </div>\n            \n            <div class=\"modal-actions\">\n                <button type=\"button\" id=\"recovery-restore-btn\" class=\"btn btn-primary\">\n                     Restore Workout\n                </button>\n                <button type=\"button\" id=\"recovery-discard-btn\" class=\"btn btn-secondary\">\n                     Start Fresh\n                </button>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Add styles for the recovery modal\n */\nfunction addRecoveryStyles(): void {\n    if (document.getElementById('recovery-modal-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'recovery-modal-styles';\n    style.textContent = `\n        #workout-recovery-modal {\n            max-width: 400px;\n        }\n        \n        .recovery-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 0.75rem;\n            margin: 1.5rem 0;\n            padding: 1rem;\n            background: var(--surface-2, #2a2a2a);\n            border-radius: 8px;\n        }\n        \n        .recovery-stat {\n            display: flex;\n            flex-direction: column;\n            gap: 0.25rem;\n        }\n        \n        .recovery-stat-label {\n            font-size: 0.75rem;\n            color: var(--text-muted, #888);\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n        }\n        \n        .recovery-stat-value {\n            font-size: 1rem;\n            font-weight: 600;\n            color: var(--text-primary, #fff);\n        }\n        \n        #workout-recovery-modal .modal-actions {\n            display: flex;\n            flex-direction: column;\n            gap: 0.75rem;\n            margin-top: 1.5rem;\n        }\n        \n        #workout-recovery-modal .btn {\n            width: 100%;\n            padding: 0.875rem 1.5rem;\n            font-size: 1rem;\n        }\n    `;\n\n    document.head.appendChild(style);\n}\n\n/**\n * Show the recovery modal and wait for user decision\n */\nasync function showRecoveryModal(workout: ActiveWorkoutRecord): Promise<'restore' | 'discard'> {\n    addRecoveryStyles();\n\n    const modal = createRecoveryModal(workout);\n    document.body.appendChild(modal);\n\n    return new Promise((resolve) => {\n        const restoreBtn = modal.querySelector('#recovery-restore-btn') as HTMLButtonElement;\n        const discardBtn = modal.querySelector('#recovery-discard-btn') as HTMLButtonElement;\n\n        const cleanup = () => {\n            modal.close();\n            modal.remove();\n        };\n\n        restoreBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('restore');\n        });\n\n        discardBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('discard');\n        });\n\n        // Handle escape key\n        modal.addEventListener('cancel', (e) => {\n            e.preventDefault(); // Don't close on escape - force user to choose\n        });\n\n        modal.showModal();\n    });\n}\n\n/**\n * Check for and handle workout recovery\n * \n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n * @returns True if a workout was recovered\n */\nexport async function initWorkoutRecovery(\n    measurementsState: MeasurementsState,\n    timeState: TimeState\n): Promise<boolean> {\n    try {\n        // Check if there's a recoverable workout\n        if (!await hasRecoverableWorkout()) {\n            return false;\n        }\n\n        // Load the workout data\n        const workout = await loadActiveWorkout();\n        if (!workout) {\n            return false;\n        }\n\n        // Show recovery modal and get user choice\n        const choice = await showRecoveryModal(workout);\n\n        if (choice === 'restore') {\n            // Restore the workout data\n            measurementsState.restore(\n                {\n                    heartrate: workout.heartrate,\n                    power: workout.power,\n                    cadence: workout.cadence,\n                    speed: workout.speed,\n                    distance: workout.distance,\n                    altitude: workout.altitude,\n                    laps: workout.laps, gps: workout.gps || [],\n                },\n                workout.startTime\n            );\n\n            // Restore time state\n            timeState.startTime = workout.startTime;\n            timeState.running = false; // Don't auto-resume - let user reconnect sensors\n\n            console.log(`Restored workout with ${workout.power.length} power readings`);\n            return true;\n        } else {\n            // User chose to discard\n            await clearActiveWorkout();\n            console.log('User discarded recovered workout');\n            return false;\n        }\n    } catch (error) {\n        console.error('Error during workout recovery:', error);\n        return false;\n    }\n}\n\n/**\n * Clear any pending workout data (for testing or manual cleanup)\n */\nexport async function clearRecoverableWorkout(): Promise<void> {\n    await clearActiveWorkout();\n}\n","/**\n * About Modal\n * \n * Manages the About modal.\n * \n * @module about\n */\n\n/**\n * Initialize the About modal\n */\nexport function initAboutModal(): void {\n    const aboutButton = document.getElementById('aboutButton');\n    const aboutModal = document.getElementById('aboutModal');\n    const closeAboutModal = document.getElementById('closeAboutModal');\n\n    if (!aboutButton || !aboutModal) {\n        return;\n    }\n\n    /**\n     * Open the about modal\n     */\n    const openModal = (): void => {\n        aboutModal.style.display = 'flex';\n        // Close the main menu details element\n        const details = document.querySelector('header details');\n        if (details) {\n            details.removeAttribute('open');\n        }\n    };\n\n    /**\n     * Close the about modal\n     */\n    const closeModal = (): void => {\n        aboutModal.style.display = 'none';\n    };\n\n    // Event Listeners\n    aboutButton.addEventListener('click', openModal);\n    closeAboutModal?.addEventListener('click', closeModal);\n\n    // Close modal when clicking outside\n    window.addEventListener('click', (event: MouseEvent) => {\n        if (event.target === aboutModal) {\n            closeModal();\n        }\n    });\n}\n","/**\n * Wake Lock Handler\n * \n * Keeps the screen awake during workouts using the Screen Wake Lock API.\n * \n * @module wakeLock\n */\n\n/**\n * Initialize wake lock to keep the screen awake.\n * \n * Requests a screen wake lock when the page is visible,\n * and re-requests it if the page visibility changes.\n */\nexport const handleWakeLock = (): void => {\n    let wakeLock: WakeLockSentinel | null = null;\n\n    /**\n     * Request a screen wake lock\n     */\n    const requestWakeLock = async (): Promise<void> => {\n        try {\n            if ('wakeLock' in navigator) {\n                wakeLock = await navigator.wakeLock.request('screen');\n                console.log('Screen wake lock activated');\n\n                // Re-request wake lock if page becomes visible again\n                wakeLock.addEventListener('release', () => {\n                    console.log('Screen wake lock released');\n                });\n            }\n        } catch (err) {\n            console.error('Wake lock request failed:', err);\n        }\n    };\n\n    // Request wake lock when page loads\n    if (document.visibilityState === 'visible') {\n        requestWakeLock();\n    }\n\n    // Re-request wake lock when page becomes visible\n    document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n            requestWakeLock();\n        }\n    });\n};\n","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","/**\n * Service Worker Registration\n * \n * Handles PWA service worker registration using vite-plugin-pwa.\n * \n * @module serviceWorker\n */\n\nimport { registerSW } from 'virtual:pwa-register';\nimport { Capacitor } from '@capacitor/core';\n\n/**\n * Update callback type\n */\ntype UpdateCallback = (reloadPage?: boolean) => Promise<void>;\n\n/**\n * Register the service worker for PWA functionality.\n * \n * In development mode, service workers are disabled to avoid caching issues.\n * In production, registers the service worker and handles updates.\n */\nexport const registerServiceWorker = (): void => {\n    // Capacitor apps should not use service workers. They can cause hard-to-debug\n    // caching and asset-loading issues in Android WebView.\n    if (Capacitor.isNativePlatform()) {\n        console.log('Service Worker disabled on native platform');\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                }\n            });\n        }\n        return;\n    }\n\n    // Don't register service worker in development to avoid caching issues\n    if (import.meta.env.DEV) {\n        console.log('Service Worker disabled in development mode');\n        // Unregister existing service workers if any to ensure fresh content\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                    console.log('Unregistered existing service worker');\n                }\n            });\n        }\n        return;\n    }\n\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    const updateSW = registerSW({\n        onNeedRefresh() {\n            showUpdateNotification(updateSW);\n        },\n        onOfflineReady() {\n            console.log('App ready to work offline');\n        },\n        onRegistered(registration?: ServiceWorkerRegistration) {\n            console.log('Service Worker registered successfully');\n\n            // Check for updates periodically (every hour)\n            if (registration) {\n                setInterval(() => {\n                    registration.update();\n                }, 60 * 60 * 1000);\n            }\n        },\n        onRegisterError(error: Error) {\n            console.log('Service Worker registration failed:', error);\n        },\n    });\n};\n\n/**\n * Show update notification when a new version is available.\n * \n * @param updateSW - Function to trigger the update\n */\nconst showUpdateNotification = (updateSW: UpdateCallback): void => {\n    const updateContainer = document.getElementById('updateNotification');\n    if (!updateContainer) return;\n\n    updateContainer.style.display = 'block';\n\n    const updateButton = document.getElementById('updateButton');\n    updateButton?.addEventListener(\n        'click',\n        () => {\n            updateSW(true); // Force reload after update\n        },\n        { once: true }\n    );\n\n    const dismissUpdateButton = document.getElementById('dismissUpdate');\n    dismissUpdateButton?.addEventListener(\n        'click',\n        () => {\n            updateContainer.style.display = 'none';\n        },\n        { once: true }\n    );\n};\n","/* @preserve\n * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com\n * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade\n */\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.leaflet = {}));\n})(this, (function (exports) { 'use strict';\n\n  var version = \"1.9.4\";\n\n  /*\r\n   * @namespace Util\r\n   *\r\n   * Various utility functions, used by Leaflet internally.\r\n   */\r\n\r\n  // @function extend(dest: Object, src?: Object): Object\r\n  // Merges the properties of the `src` object (or multiple objects) into `dest` object and returns the latter. Has an `L.extend` shortcut.\r\n  function extend(dest) {\r\n  \tvar i, j, len, src;\r\n\r\n  \tfor (j = 1, len = arguments.length; j < len; j++) {\r\n  \t\tsrc = arguments[j];\r\n  \t\tfor (i in src) {\r\n  \t\t\tdest[i] = src[i];\r\n  \t\t}\r\n  \t}\r\n  \treturn dest;\r\n  }\r\n\r\n  // @function create(proto: Object, properties?: Object): Object\r\n  // Compatibility polyfill for [Object.create](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/create)\r\n  var create$2 = Object.create || (function () {\r\n  \tfunction F() {}\r\n  \treturn function (proto) {\r\n  \t\tF.prototype = proto;\r\n  \t\treturn new F();\r\n  \t};\r\n  })();\r\n\r\n  // @function bind(fn: Function, ): Function\r\n  // Returns a new function bound to the arguments passed, like [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\r\n  // Has a `L.bind()` shortcut.\r\n  function bind(fn, obj) {\r\n  \tvar slice = Array.prototype.slice;\r\n\r\n  \tif (fn.bind) {\r\n  \t\treturn fn.bind.apply(fn, slice.call(arguments, 1));\r\n  \t}\r\n\r\n  \tvar args = slice.call(arguments, 2);\r\n\r\n  \treturn function () {\r\n  \t\treturn fn.apply(obj, args.length ? args.concat(slice.call(arguments)) : arguments);\r\n  \t};\r\n  }\r\n\r\n  // @property lastId: Number\r\n  // Last unique ID used by [`stamp()`](#util-stamp)\r\n  var lastId = 0;\r\n\r\n  // @function stamp(obj: Object): Number\r\n  // Returns the unique ID of an object, assigning it one if it doesn't have it.\r\n  function stamp(obj) {\r\n  \tif (!('_leaflet_id' in obj)) {\r\n  \t\tobj['_leaflet_id'] = ++lastId;\r\n  \t}\r\n  \treturn obj._leaflet_id;\r\n  }\r\n\r\n  // @function throttle(fn: Function, time: Number, context: Object): Function\r\n  // Returns a function which executes function `fn` with the given scope `context`\r\n  // (so that the `this` keyword refers to `context` inside `fn`'s code). The function\r\n  // `fn` will be called no more than one time per given amount of `time`. The arguments\r\n  // received by the bound function will be any arguments passed when binding the\r\n  // function, followed by any arguments passed when invoking the bound function.\r\n  // Has an `L.throttle` shortcut.\r\n  function throttle(fn, time, context) {\r\n  \tvar lock, args, wrapperFn, later;\r\n\r\n  \tlater = function () {\r\n  \t\t// reset lock and call if queued\r\n  \t\tlock = false;\r\n  \t\tif (args) {\r\n  \t\t\twrapperFn.apply(context, args);\r\n  \t\t\targs = false;\r\n  \t\t}\r\n  \t};\r\n\r\n  \twrapperFn = function () {\r\n  \t\tif (lock) {\r\n  \t\t\t// called too soon, queue to call later\r\n  \t\t\targs = arguments;\r\n\r\n  \t\t} else {\r\n  \t\t\t// call and lock until later\r\n  \t\t\tfn.apply(context, arguments);\r\n  \t\t\tsetTimeout(later, time);\r\n  \t\t\tlock = true;\r\n  \t\t}\r\n  \t};\r\n\r\n  \treturn wrapperFn;\r\n  }\r\n\r\n  // @function wrapNum(num: Number, range: Number[], includeMax?: Boolean): Number\r\n  // Returns the number `num` modulo `range` in such a way so it lies within\r\n  // `range[0]` and `range[1]`. The returned value will be always smaller than\r\n  // `range[1]` unless `includeMax` is set to `true`.\r\n  function wrapNum(x, range, includeMax) {\r\n  \tvar max = range[1],\r\n  \t    min = range[0],\r\n  \t    d = max - min;\r\n  \treturn x === max && includeMax ? x : ((x - min) % d + d) % d + min;\r\n  }\r\n\r\n  // @function falseFn(): Function\r\n  // Returns a function which always returns `false`.\r\n  function falseFn() { return false; }\r\n\r\n  // @function formatNum(num: Number, precision?: Number|false): Number\r\n  // Returns the number `num` rounded with specified `precision`.\r\n  // The default `precision` value is 6 decimal places.\r\n  // `false` can be passed to skip any processing (can be useful to avoid round-off errors).\r\n  function formatNum(num, precision) {\r\n  \tif (precision === false) { return num; }\r\n  \tvar pow = Math.pow(10, precision === undefined ? 6 : precision);\r\n  \treturn Math.round(num * pow) / pow;\r\n  }\r\n\r\n  // @function trim(str: String): String\r\n  // Compatibility polyfill for [String.prototype.trim](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String/Trim)\r\n  function trim(str) {\r\n  \treturn str.trim ? str.trim() : str.replace(/^\\s+|\\s+$/g, '');\r\n  }\r\n\r\n  // @function splitWords(str: String): String[]\r\n  // Trims and splits the string on whitespace and returns the array of parts.\r\n  function splitWords(str) {\r\n  \treturn trim(str).split(/\\s+/);\r\n  }\r\n\r\n  // @function setOptions(obj: Object, options: Object): Object\r\n  // Merges the given properties to the `options` of the `obj` object, returning the resulting options. See `Class options`. Has an `L.setOptions` shortcut.\r\n  function setOptions(obj, options) {\r\n  \tif (!Object.prototype.hasOwnProperty.call(obj, 'options')) {\r\n  \t\tobj.options = obj.options ? create$2(obj.options) : {};\r\n  \t}\r\n  \tfor (var i in options) {\r\n  \t\tobj.options[i] = options[i];\r\n  \t}\r\n  \treturn obj.options;\r\n  }\r\n\r\n  // @function getParamString(obj: Object, existingUrl?: String, uppercase?: Boolean): String\r\n  // Converts an object into a parameter URL string, e.g. `{a: \"foo\", b: \"bar\"}`\r\n  // translates to `'?a=foo&b=bar'`. If `existingUrl` is set, the parameters will\r\n  // be appended at the end. If `uppercase` is `true`, the parameter names will\r\n  // be uppercased (e.g. `'?A=foo&B=bar'`)\r\n  function getParamString(obj, existingUrl, uppercase) {\r\n  \tvar params = [];\r\n  \tfor (var i in obj) {\r\n  \t\tparams.push(encodeURIComponent(uppercase ? i.toUpperCase() : i) + '=' + encodeURIComponent(obj[i]));\r\n  \t}\r\n  \treturn ((!existingUrl || existingUrl.indexOf('?') === -1) ? '?' : '&') + params.join('&');\r\n  }\r\n\r\n  var templateRe = /\\{ *([\\w_ -]+) *\\}/g;\r\n\r\n  // @function template(str: String, data: Object): String\r\n  // Simple templating facility, accepts a template string of the form `'Hello {a}, {b}'`\r\n  // and a data object like `{a: 'foo', b: 'bar'}`, returns evaluated string\r\n  // `('Hello foo, bar')`. You can also specify functions instead of strings for\r\n  // data values  they will be evaluated passing `data` as an argument.\r\n  function template(str, data) {\r\n  \treturn str.replace(templateRe, function (str, key) {\r\n  \t\tvar value = data[key];\r\n\r\n  \t\tif (value === undefined) {\r\n  \t\t\tthrow new Error('No value provided for variable ' + str);\r\n\r\n  \t\t} else if (typeof value === 'function') {\r\n  \t\t\tvalue = value(data);\r\n  \t\t}\r\n  \t\treturn value;\r\n  \t});\r\n  }\r\n\r\n  // @function isArray(obj): Boolean\r\n  // Compatibility polyfill for [Array.isArray](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray)\r\n  var isArray = Array.isArray || function (obj) {\r\n  \treturn (Object.prototype.toString.call(obj) === '[object Array]');\r\n  };\r\n\r\n  // @function indexOf(array: Array, el: Object): Number\r\n  // Compatibility polyfill for [Array.prototype.indexOf](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)\r\n  function indexOf(array, el) {\r\n  \tfor (var i = 0; i < array.length; i++) {\r\n  \t\tif (array[i] === el) { return i; }\r\n  \t}\r\n  \treturn -1;\r\n  }\r\n\r\n  // @property emptyImageUrl: String\r\n  // Data URI string containing a base64-encoded empty GIF image.\r\n  // Used as a hack to free memory from unused images on WebKit-powered\r\n  // mobile devices (by setting image `src` to this string).\r\n  var emptyImageUrl = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';\r\n\r\n  // inspired by https://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n\r\n  function getPrefixed(name) {\r\n  \treturn window['webkit' + name] || window['moz' + name] || window['ms' + name];\r\n  }\r\n\r\n  var lastTime = 0;\r\n\r\n  // fallback for IE 7-8\r\n  function timeoutDefer(fn) {\r\n  \tvar time = +new Date(),\r\n  \t    timeToCall = Math.max(0, 16 - (time - lastTime));\r\n\r\n  \tlastTime = time + timeToCall;\r\n  \treturn window.setTimeout(fn, timeToCall);\r\n  }\r\n\r\n  var requestFn = window.requestAnimationFrame || getPrefixed('RequestAnimationFrame') || timeoutDefer;\r\n  var cancelFn = window.cancelAnimationFrame || getPrefixed('CancelAnimationFrame') ||\r\n  \t\tgetPrefixed('CancelRequestAnimationFrame') || function (id) { window.clearTimeout(id); };\r\n\r\n  // @function requestAnimFrame(fn: Function, context?: Object, immediate?: Boolean): Number\r\n  // Schedules `fn` to be executed when the browser repaints. `fn` is bound to\r\n  // `context` if given. When `immediate` is set, `fn` is called immediately if\r\n  // the browser doesn't have native support for\r\n  // [`window.requestAnimationFrame`](https://developer.mozilla.org/docs/Web/API/window/requestAnimationFrame),\r\n  // otherwise it's delayed. Returns a request ID that can be used to cancel the request.\r\n  function requestAnimFrame(fn, context, immediate) {\r\n  \tif (immediate && requestFn === timeoutDefer) {\r\n  \t\tfn.call(context);\r\n  \t} else {\r\n  \t\treturn requestFn.call(window, bind(fn, context));\r\n  \t}\r\n  }\r\n\r\n  // @function cancelAnimFrame(id: Number): undefined\r\n  // Cancels a previous `requestAnimFrame`. See also [window.cancelAnimationFrame](https://developer.mozilla.org/docs/Web/API/window/cancelAnimationFrame).\r\n  function cancelAnimFrame(id) {\r\n  \tif (id) {\r\n  \t\tcancelFn.call(window, id);\r\n  \t}\r\n  }\n\n  var Util = {\n    __proto__: null,\n    extend: extend,\n    create: create$2,\n    bind: bind,\n    get lastId () { return lastId; },\n    stamp: stamp,\n    throttle: throttle,\n    wrapNum: wrapNum,\n    falseFn: falseFn,\n    formatNum: formatNum,\n    trim: trim,\n    splitWords: splitWords,\n    setOptions: setOptions,\n    getParamString: getParamString,\n    template: template,\n    isArray: isArray,\n    indexOf: indexOf,\n    emptyImageUrl: emptyImageUrl,\n    requestFn: requestFn,\n    cancelFn: cancelFn,\n    requestAnimFrame: requestAnimFrame,\n    cancelAnimFrame: cancelAnimFrame\n  };\n\n  // @class Class\r\n  // @aka L.Class\r\n\r\n  // @section\r\n  // @uninheritable\r\n\r\n  // Thanks to John Resig and Dean Edwards for inspiration!\r\n\r\n  function Class() {}\r\n\r\n  Class.extend = function (props) {\r\n\r\n  \t// @function extend(props: Object): Function\r\n  \t// [Extends the current class](#class-inheritance) given the properties to be included.\r\n  \t// Returns a Javascript function that is a class constructor (to be called with `new`).\r\n  \tvar NewClass = function () {\r\n\r\n  \t\tsetOptions(this);\r\n\r\n  \t\t// call the constructor\r\n  \t\tif (this.initialize) {\r\n  \t\t\tthis.initialize.apply(this, arguments);\r\n  \t\t}\r\n\r\n  \t\t// call all constructor hooks\r\n  \t\tthis.callInitHooks();\r\n  \t};\r\n\r\n  \tvar parentProto = NewClass.__super__ = this.prototype;\r\n\r\n  \tvar proto = create$2(parentProto);\r\n  \tproto.constructor = NewClass;\r\n\r\n  \tNewClass.prototype = proto;\r\n\r\n  \t// inherit parent's statics\r\n  \tfor (var i in this) {\r\n  \t\tif (Object.prototype.hasOwnProperty.call(this, i) && i !== 'prototype' && i !== '__super__') {\r\n  \t\t\tNewClass[i] = this[i];\r\n  \t\t}\r\n  \t}\r\n\r\n  \t// mix static properties into the class\r\n  \tif (props.statics) {\r\n  \t\textend(NewClass, props.statics);\r\n  \t}\r\n\r\n  \t// mix includes into the prototype\r\n  \tif (props.includes) {\r\n  \t\tcheckDeprecatedMixinEvents(props.includes);\r\n  \t\textend.apply(null, [proto].concat(props.includes));\r\n  \t}\r\n\r\n  \t// mix given properties into the prototype\r\n  \textend(proto, props);\r\n  \tdelete proto.statics;\r\n  \tdelete proto.includes;\r\n\r\n  \t// merge options\r\n  \tif (proto.options) {\r\n  \t\tproto.options = parentProto.options ? create$2(parentProto.options) : {};\r\n  \t\textend(proto.options, props.options);\r\n  \t}\r\n\r\n  \tproto._initHooks = [];\r\n\r\n  \t// add method for calling all hooks\r\n  \tproto.callInitHooks = function () {\r\n\r\n  \t\tif (this._initHooksCalled) { return; }\r\n\r\n  \t\tif (parentProto.callInitHooks) {\r\n  \t\t\tparentProto.callInitHooks.call(this);\r\n  \t\t}\r\n\r\n  \t\tthis._initHooksCalled = true;\r\n\r\n  \t\tfor (var i = 0, len = proto._initHooks.length; i < len; i++) {\r\n  \t\t\tproto._initHooks[i].call(this);\r\n  \t\t}\r\n  \t};\r\n\r\n  \treturn NewClass;\r\n  };\r\n\r\n\r\n  // @function include(properties: Object): this\r\n  // [Includes a mixin](#class-includes) into the current class.\r\n  Class.include = function (props) {\r\n  \tvar parentOptions = this.prototype.options;\r\n  \textend(this.prototype, props);\r\n  \tif (props.options) {\r\n  \t\tthis.prototype.options = parentOptions;\r\n  \t\tthis.mergeOptions(props.options);\r\n  \t}\r\n  \treturn this;\r\n  };\r\n\r\n  // @function mergeOptions(options: Object): this\r\n  // [Merges `options`](#class-options) into the defaults of the class.\r\n  Class.mergeOptions = function (options) {\r\n  \textend(this.prototype.options, options);\r\n  \treturn this;\r\n  };\r\n\r\n  // @function addInitHook(fn: Function): this\r\n  // Adds a [constructor hook](#class-constructor-hooks) to the class.\r\n  Class.addInitHook = function (fn) { // (Function) || (String, args...)\r\n  \tvar args = Array.prototype.slice.call(arguments, 1);\r\n\r\n  \tvar init = typeof fn === 'function' ? fn : function () {\r\n  \t\tthis[fn].apply(this, args);\r\n  \t};\r\n\r\n  \tthis.prototype._initHooks = this.prototype._initHooks || [];\r\n  \tthis.prototype._initHooks.push(init);\r\n  \treturn this;\r\n  };\r\n\r\n  function checkDeprecatedMixinEvents(includes) {\r\n  \t/* global L: true */\r\n  \tif (typeof L === 'undefined' || !L || !L.Mixin) { return; }\r\n\r\n  \tincludes = isArray(includes) ? includes : [includes];\r\n\r\n  \tfor (var i = 0; i < includes.length; i++) {\r\n  \t\tif (includes[i] === L.Mixin.Events) {\r\n  \t\t\tconsole.warn('Deprecated include of L.Mixin.Events: ' +\r\n  \t\t\t\t'this property will be removed in future releases, ' +\r\n  \t\t\t\t'please inherit from L.Evented instead.', new Error().stack);\r\n  \t\t}\r\n  \t}\r\n  }\n\n  /*\r\n   * @class Evented\r\n   * @aka L.Evented\r\n   * @inherits Class\r\n   *\r\n   * A set of methods shared between event-powered classes (like `Map` and `Marker`). Generally, events allow you to execute some function when something happens with an object (e.g. the user clicks on the map, causing the map to fire `'click'` event).\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * map.on('click', function(e) {\r\n   * \talert(e.latlng);\r\n   * } );\r\n   * ```\r\n   *\r\n   * Leaflet deals with event listeners by reference, so if you want to add a listener and then remove it, define it as a function:\r\n   *\r\n   * ```js\r\n   * function onClick(e) { ... }\r\n   *\r\n   * map.on('click', onClick);\r\n   * map.off('click', onClick);\r\n   * ```\r\n   */\r\n\r\n  var Events = {\r\n  \t/* @method on(type: String, fn: Function, context?: Object): this\r\n  \t * Adds a listener function (`fn`) to a particular event type of the object. You can optionally specify the context of the listener (object the this keyword will point to). You can also pass several space-separated types (e.g. `'click dblclick'`).\r\n  \t *\r\n  \t * @alternative\r\n  \t * @method on(eventMap: Object): this\r\n  \t * Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n  \t */\r\n  \ton: function (types, fn, context) {\r\n\r\n  \t\t// types can be a map of types/handlers\r\n  \t\tif (typeof types === 'object') {\r\n  \t\t\tfor (var type in types) {\r\n  \t\t\t\t// we don't process space-separated events here for performance;\r\n  \t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n  \t\t\t\tthis._on(type, types[type], fn);\r\n  \t\t\t}\r\n\r\n  \t\t} else {\r\n  \t\t\t// types can be a string of space-separated words\r\n  \t\t\ttypes = splitWords(types);\r\n\r\n  \t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n  \t\t\t\tthis._on(types[i], fn, context);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t/* @method off(type: String, fn?: Function, context?: Object): this\r\n  \t * Removes a previously added listener function. If no function is specified, it will remove all the listeners of that particular event from the object. Note that if you passed a custom context to `on`, you must pass the same context to `off` in order to remove the listener.\r\n  \t *\r\n  \t * @alternative\r\n  \t * @method off(eventMap: Object): this\r\n  \t * Removes a set of type/listener pairs.\r\n  \t *\r\n  \t * @alternative\r\n  \t * @method off: this\r\n  \t * Removes all listeners to all events on the object. This includes implicitly attached events.\r\n  \t */\r\n  \toff: function (types, fn, context) {\r\n\r\n  \t\tif (!arguments.length) {\r\n  \t\t\t// clear all listeners if called without arguments\r\n  \t\t\tdelete this._events;\r\n\r\n  \t\t} else if (typeof types === 'object') {\r\n  \t\t\tfor (var type in types) {\r\n  \t\t\t\tthis._off(type, types[type], fn);\r\n  \t\t\t}\r\n\r\n  \t\t} else {\r\n  \t\t\ttypes = splitWords(types);\r\n\r\n  \t\t\tvar removeAll = arguments.length === 1;\r\n  \t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n  \t\t\t\tif (removeAll) {\r\n  \t\t\t\t\tthis._off(types[i]);\r\n  \t\t\t\t} else {\r\n  \t\t\t\t\tthis._off(types[i], fn, context);\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// attach listener (without syntactic sugar now)\r\n  \t_on: function (type, fn, context, _once) {\r\n  \t\tif (typeof fn !== 'function') {\r\n  \t\t\tconsole.warn('wrong listener type: ' + typeof fn);\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\t// check if fn already there\r\n  \t\tif (this._listens(type, fn, context) !== false) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (context === this) {\r\n  \t\t\t// Less memory footprint.\r\n  \t\t\tcontext = undefined;\r\n  \t\t}\r\n\r\n  \t\tvar newListener = {fn: fn, ctx: context};\r\n  \t\tif (_once) {\r\n  \t\t\tnewListener.once = true;\r\n  \t\t}\r\n\r\n  \t\tthis._events = this._events || {};\r\n  \t\tthis._events[type] = this._events[type] || [];\r\n  \t\tthis._events[type].push(newListener);\r\n  \t},\r\n\r\n  \t_off: function (type, fn, context) {\r\n  \t\tvar listeners,\r\n  \t\t    i,\r\n  \t\t    len;\r\n\r\n  \t\tif (!this._events) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tlisteners = this._events[type];\r\n  \t\tif (!listeners) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (arguments.length === 1) { // remove all\r\n  \t\t\tif (this._firingCount) {\r\n  \t\t\t\t// Set all removed listeners to noop\r\n  \t\t\t\t// so they are not called if remove happens in fire\r\n  \t\t\t\tfor (i = 0, len = listeners.length; i < len; i++) {\r\n  \t\t\t\t\tlisteners[i].fn = falseFn;\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t\t// clear all listeners for a type if function isn't specified\r\n  \t\t\tdelete this._events[type];\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (typeof fn !== 'function') {\r\n  \t\t\tconsole.warn('wrong listener type: ' + typeof fn);\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\t// find fn and remove it\r\n  \t\tvar index = this._listens(type, fn, context);\r\n  \t\tif (index !== false) {\r\n  \t\t\tvar listener = listeners[index];\r\n  \t\t\tif (this._firingCount) {\r\n  \t\t\t\t// set the removed listener to noop so that's not called if remove happens in fire\r\n  \t\t\t\tlistener.fn = falseFn;\r\n\r\n  \t\t\t\t/* copy array in case events are being fired */\r\n  \t\t\t\tthis._events[type] = listeners = listeners.slice();\r\n  \t\t\t}\r\n  \t\t\tlisteners.splice(index, 1);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method fire(type: String, data?: Object, propagate?: Boolean): this\r\n  \t// Fires an event of the specified type. You can optionally provide a data\r\n  \t// object  the first argument of the listener function will contain its\r\n  \t// properties. The event can optionally be propagated to event parents.\r\n  \tfire: function (type, data, propagate) {\r\n  \t\tif (!this.listens(type, propagate)) { return this; }\r\n\r\n  \t\tvar event = extend({}, data, {\r\n  \t\t\ttype: type,\r\n  \t\t\ttarget: this,\r\n  \t\t\tsourceTarget: data && data.sourceTarget || this\r\n  \t\t});\r\n\r\n  \t\tif (this._events) {\r\n  \t\t\tvar listeners = this._events[type];\r\n  \t\t\tif (listeners) {\r\n  \t\t\t\tthis._firingCount = (this._firingCount + 1) || 1;\r\n  \t\t\t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n  \t\t\t\t\tvar l = listeners[i];\r\n  \t\t\t\t\t// off overwrites l.fn, so we need to copy fn to a var\r\n  \t\t\t\t\tvar fn = l.fn;\r\n  \t\t\t\t\tif (l.once) {\r\n  \t\t\t\t\t\tthis.off(type, fn, l.ctx);\r\n  \t\t\t\t\t}\r\n  \t\t\t\t\tfn.call(l.ctx || this, event);\r\n  \t\t\t\t}\r\n\r\n  \t\t\t\tthis._firingCount--;\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tif (propagate) {\r\n  \t\t\t// propagate the event to parents (set with addEventParent)\r\n  \t\t\tthis._propagateEvent(event);\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method listens(type: String, propagate?: Boolean): Boolean\r\n  \t// @method listens(type: String, fn: Function, context?: Object, propagate?: Boolean): Boolean\r\n  \t// Returns `true` if a particular event type has any listeners attached to it.\r\n  \t// The verification can optionally be propagated, it will return `true` if parents have the listener attached to it.\r\n  \tlistens: function (type, fn, context, propagate) {\r\n  \t\tif (typeof type !== 'string') {\r\n  \t\t\tconsole.warn('\"string\" type argument expected');\r\n  \t\t}\r\n\r\n  \t\t// we don't overwrite the input `fn` value, because we need to use it for propagation\r\n  \t\tvar _fn = fn;\r\n  \t\tif (typeof fn !== 'function') {\r\n  \t\t\tpropagate = !!fn;\r\n  \t\t\t_fn = undefined;\r\n  \t\t\tcontext = undefined;\r\n  \t\t}\r\n\r\n  \t\tvar listeners = this._events && this._events[type];\r\n  \t\tif (listeners && listeners.length) {\r\n  \t\t\tif (this._listens(type, _fn, context) !== false) {\r\n  \t\t\t\treturn true;\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tif (propagate) {\r\n  \t\t\t// also check parents for listeners if event propagates\r\n  \t\t\tfor (var id in this._eventParents) {\r\n  \t\t\t\tif (this._eventParents[id].listens(type, fn, context, propagate)) { return true; }\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\treturn false;\r\n  \t},\r\n\r\n  \t// returns the index (number) or false\r\n  \t_listens: function (type, fn, context) {\r\n  \t\tif (!this._events) {\r\n  \t\t\treturn false;\r\n  \t\t}\r\n\r\n  \t\tvar listeners = this._events[type] || [];\r\n  \t\tif (!fn) {\r\n  \t\t\treturn !!listeners.length;\r\n  \t\t}\r\n\r\n  \t\tif (context === this) {\r\n  \t\t\t// Less memory footprint.\r\n  \t\t\tcontext = undefined;\r\n  \t\t}\r\n\r\n  \t\tfor (var i = 0, len = listeners.length; i < len; i++) {\r\n  \t\t\tif (listeners[i].fn === fn && listeners[i].ctx === context) {\r\n  \t\t\t\treturn i;\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\treturn false;\r\n\r\n  \t},\r\n\r\n  \t// @method once(): this\r\n  \t// Behaves as [`on()`](#evented-on), except the listener will only get fired once and then removed.\r\n  \tonce: function (types, fn, context) {\r\n\r\n  \t\t// types can be a map of types/handlers\r\n  \t\tif (typeof types === 'object') {\r\n  \t\t\tfor (var type in types) {\r\n  \t\t\t\t// we don't process space-separated events here for performance;\r\n  \t\t\t\t// it's a hot path since Layer uses the on(obj) syntax\r\n  \t\t\t\tthis._on(type, types[type], fn, true);\r\n  \t\t\t}\r\n\r\n  \t\t} else {\r\n  \t\t\t// types can be a string of space-separated words\r\n  \t\t\ttypes = splitWords(types);\r\n\r\n  \t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n  \t\t\t\tthis._on(types[i], fn, context, true);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method addEventParent(obj: Evented): this\r\n  \t// Adds an event parent - an `Evented` that will receive propagated events\r\n  \taddEventParent: function (obj) {\r\n  \t\tthis._eventParents = this._eventParents || {};\r\n  \t\tthis._eventParents[stamp(obj)] = obj;\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method removeEventParent(obj: Evented): this\r\n  \t// Removes an event parent, so it will stop receiving propagated events\r\n  \tremoveEventParent: function (obj) {\r\n  \t\tif (this._eventParents) {\r\n  \t\t\tdelete this._eventParents[stamp(obj)];\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_propagateEvent: function (e) {\r\n  \t\tfor (var id in this._eventParents) {\r\n  \t\t\tthis._eventParents[id].fire(e.type, extend({\r\n  \t\t\t\tlayer: e.target,\r\n  \t\t\t\tpropagatedFrom: e.target\r\n  \t\t\t}, e), true);\r\n  \t\t}\r\n  \t}\r\n  };\r\n\r\n  // aliases; we should ditch those eventually\r\n\r\n  // @method addEventListener(): this\r\n  // Alias to [`on()`](#evented-on)\r\n  Events.addEventListener = Events.on;\r\n\r\n  // @method removeEventListener(): this\r\n  // Alias to [`off()`](#evented-off)\r\n\r\n  // @method clearAllEventListeners(): this\r\n  // Alias to [`off()`](#evented-off)\r\n  Events.removeEventListener = Events.clearAllEventListeners = Events.off;\r\n\r\n  // @method addOneTimeEventListener(): this\r\n  // Alias to [`once()`](#evented-once)\r\n  Events.addOneTimeEventListener = Events.once;\r\n\r\n  // @method fireEvent(): this\r\n  // Alias to [`fire()`](#evented-fire)\r\n  Events.fireEvent = Events.fire;\r\n\r\n  // @method hasEventListeners(): Boolean\r\n  // Alias to [`listens()`](#evented-listens)\r\n  Events.hasEventListeners = Events.listens;\r\n\r\n  var Evented = Class.extend(Events);\n\n  /*\r\n   * @class Point\r\n   * @aka L.Point\r\n   *\r\n   * Represents a point with `x` and `y` coordinates in pixels.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var point = L.point(200, 300);\r\n   * ```\r\n   *\r\n   * All Leaflet methods and options that accept `Point` objects also accept them in a simple Array form (unless noted otherwise), so these lines are equivalent:\r\n   *\r\n   * ```js\r\n   * map.panBy([200, 300]);\r\n   * map.panBy(L.point(200, 300));\r\n   * ```\r\n   *\r\n   * Note that `Point` does not inherit from Leaflet's `Class` object,\r\n   * which means new classes can't inherit from it, and new methods\r\n   * can't be added to it with the `include` function.\r\n   */\r\n\r\n  function Point(x, y, round) {\r\n  \t// @property x: Number; The `x` coordinate of the point\r\n  \tthis.x = (round ? Math.round(x) : x);\r\n  \t// @property y: Number; The `y` coordinate of the point\r\n  \tthis.y = (round ? Math.round(y) : y);\r\n  }\r\n\r\n  var trunc = Math.trunc || function (v) {\r\n  \treturn v > 0 ? Math.floor(v) : Math.ceil(v);\r\n  };\r\n\r\n  Point.prototype = {\r\n\r\n  \t// @method clone(): Point\r\n  \t// Returns a copy of the current point.\r\n  \tclone: function () {\r\n  \t\treturn new Point(this.x, this.y);\r\n  \t},\r\n\r\n  \t// @method add(otherPoint: Point): Point\r\n  \t// Returns the result of addition of the current and the given points.\r\n  \tadd: function (point) {\r\n  \t\t// non-destructive, returns a new point\r\n  \t\treturn this.clone()._add(toPoint(point));\r\n  \t},\r\n\r\n  \t_add: function (point) {\r\n  \t\t// destructive, used directly for performance in situations where it's safe to modify existing point\r\n  \t\tthis.x += point.x;\r\n  \t\tthis.y += point.y;\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method subtract(otherPoint: Point): Point\r\n  \t// Returns the result of subtraction of the given point from the current.\r\n  \tsubtract: function (point) {\r\n  \t\treturn this.clone()._subtract(toPoint(point));\r\n  \t},\r\n\r\n  \t_subtract: function (point) {\r\n  \t\tthis.x -= point.x;\r\n  \t\tthis.y -= point.y;\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method divideBy(num: Number): Point\r\n  \t// Returns the result of division of the current point by the given number.\r\n  \tdivideBy: function (num) {\r\n  \t\treturn this.clone()._divideBy(num);\r\n  \t},\r\n\r\n  \t_divideBy: function (num) {\r\n  \t\tthis.x /= num;\r\n  \t\tthis.y /= num;\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method multiplyBy(num: Number): Point\r\n  \t// Returns the result of multiplication of the current point by the given number.\r\n  \tmultiplyBy: function (num) {\r\n  \t\treturn this.clone()._multiplyBy(num);\r\n  \t},\r\n\r\n  \t_multiplyBy: function (num) {\r\n  \t\tthis.x *= num;\r\n  \t\tthis.y *= num;\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method scaleBy(scale: Point): Point\r\n  \t// Multiply each coordinate of the current point by each coordinate of\r\n  \t// `scale`. In linear algebra terms, multiply the point by the\r\n  \t// [scaling matrix](https://en.wikipedia.org/wiki/Scaling_%28geometry%29#Matrix_representation)\r\n  \t// defined by `scale`.\r\n  \tscaleBy: function (point) {\r\n  \t\treturn new Point(this.x * point.x, this.y * point.y);\r\n  \t},\r\n\r\n  \t// @method unscaleBy(scale: Point): Point\r\n  \t// Inverse of `scaleBy`. Divide each coordinate of the current point by\r\n  \t// each coordinate of `scale`.\r\n  \tunscaleBy: function (point) {\r\n  \t\treturn new Point(this.x / point.x, this.y / point.y);\r\n  \t},\r\n\r\n  \t// @method round(): Point\r\n  \t// Returns a copy of the current point with rounded coordinates.\r\n  \tround: function () {\r\n  \t\treturn this.clone()._round();\r\n  \t},\r\n\r\n  \t_round: function () {\r\n  \t\tthis.x = Math.round(this.x);\r\n  \t\tthis.y = Math.round(this.y);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method floor(): Point\r\n  \t// Returns a copy of the current point with floored coordinates (rounded down).\r\n  \tfloor: function () {\r\n  \t\treturn this.clone()._floor();\r\n  \t},\r\n\r\n  \t_floor: function () {\r\n  \t\tthis.x = Math.floor(this.x);\r\n  \t\tthis.y = Math.floor(this.y);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method ceil(): Point\r\n  \t// Returns a copy of the current point with ceiled coordinates (rounded up).\r\n  \tceil: function () {\r\n  \t\treturn this.clone()._ceil();\r\n  \t},\r\n\r\n  \t_ceil: function () {\r\n  \t\tthis.x = Math.ceil(this.x);\r\n  \t\tthis.y = Math.ceil(this.y);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method trunc(): Point\r\n  \t// Returns a copy of the current point with truncated coordinates (rounded towards zero).\r\n  \ttrunc: function () {\r\n  \t\treturn this.clone()._trunc();\r\n  \t},\r\n\r\n  \t_trunc: function () {\r\n  \t\tthis.x = trunc(this.x);\r\n  \t\tthis.y = trunc(this.y);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method distanceTo(otherPoint: Point): Number\r\n  \t// Returns the cartesian distance between the current and the given points.\r\n  \tdistanceTo: function (point) {\r\n  \t\tpoint = toPoint(point);\r\n\r\n  \t\tvar x = point.x - this.x,\r\n  \t\t    y = point.y - this.y;\r\n\r\n  \t\treturn Math.sqrt(x * x + y * y);\r\n  \t},\r\n\r\n  \t// @method equals(otherPoint: Point): Boolean\r\n  \t// Returns `true` if the given point has the same coordinates.\r\n  \tequals: function (point) {\r\n  \t\tpoint = toPoint(point);\r\n\r\n  \t\treturn point.x === this.x &&\r\n  \t\t       point.y === this.y;\r\n  \t},\r\n\r\n  \t// @method contains(otherPoint: Point): Boolean\r\n  \t// Returns `true` if both coordinates of the given point are less than the corresponding current point coordinates (in absolute values).\r\n  \tcontains: function (point) {\r\n  \t\tpoint = toPoint(point);\r\n\r\n  \t\treturn Math.abs(point.x) <= Math.abs(this.x) &&\r\n  \t\t       Math.abs(point.y) <= Math.abs(this.y);\r\n  \t},\r\n\r\n  \t// @method toString(): String\r\n  \t// Returns a string representation of the point for debugging purposes.\r\n  \ttoString: function () {\r\n  \t\treturn 'Point(' +\r\n  \t\t        formatNum(this.x) + ', ' +\r\n  \t\t        formatNum(this.y) + ')';\r\n  \t}\r\n  };\r\n\r\n  // @factory L.point(x: Number, y: Number, round?: Boolean)\r\n  // Creates a Point object with the given `x` and `y` coordinates. If optional `round` is set to true, rounds the `x` and `y` values.\r\n\r\n  // @alternative\r\n  // @factory L.point(coords: Number[])\r\n  // Expects an array of the form `[x, y]` instead.\r\n\r\n  // @alternative\r\n  // @factory L.point(coords: Object)\r\n  // Expects a plain object of the form `{x: Number, y: Number}` instead.\r\n  function toPoint(x, y, round) {\r\n  \tif (x instanceof Point) {\r\n  \t\treturn x;\r\n  \t}\r\n  \tif (isArray(x)) {\r\n  \t\treturn new Point(x[0], x[1]);\r\n  \t}\r\n  \tif (x === undefined || x === null) {\r\n  \t\treturn x;\r\n  \t}\r\n  \tif (typeof x === 'object' && 'x' in x && 'y' in x) {\r\n  \t\treturn new Point(x.x, x.y);\r\n  \t}\r\n  \treturn new Point(x, y, round);\r\n  }\n\n  /*\r\n   * @class Bounds\r\n   * @aka L.Bounds\r\n   *\r\n   * Represents a rectangular area in pixel coordinates.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var p1 = L.point(10, 10),\r\n   * p2 = L.point(40, 60),\r\n   * bounds = L.bounds(p1, p2);\r\n   * ```\r\n   *\r\n   * All Leaflet methods that accept `Bounds` objects also accept them in a simple Array form (unless noted otherwise), so the bounds example above can be passed like this:\r\n   *\r\n   * ```js\r\n   * otherBounds.intersects([[10, 10], [40, 60]]);\r\n   * ```\r\n   *\r\n   * Note that `Bounds` does not inherit from Leaflet's `Class` object,\r\n   * which means new classes can't inherit from it, and new methods\r\n   * can't be added to it with the `include` function.\r\n   */\r\n\r\n  function Bounds(a, b) {\r\n  \tif (!a) { return; }\r\n\r\n  \tvar points = b ? [a, b] : a;\r\n\r\n  \tfor (var i = 0, len = points.length; i < len; i++) {\r\n  \t\tthis.extend(points[i]);\r\n  \t}\r\n  }\r\n\r\n  Bounds.prototype = {\r\n  \t// @method extend(point: Point): this\r\n  \t// Extends the bounds to contain the given point.\r\n\r\n  \t// @alternative\r\n  \t// @method extend(otherBounds: Bounds): this\r\n  \t// Extend the bounds to contain the given bounds\r\n  \textend: function (obj) {\r\n  \t\tvar min2, max2;\r\n  \t\tif (!obj) { return this; }\r\n\r\n  \t\tif (obj instanceof Point || typeof obj[0] === 'number' || 'x' in obj) {\r\n  \t\t\tmin2 = max2 = toPoint(obj);\r\n  \t\t} else {\r\n  \t\t\tobj = toBounds(obj);\r\n  \t\t\tmin2 = obj.min;\r\n  \t\t\tmax2 = obj.max;\r\n\r\n  \t\t\tif (!min2 || !max2) { return this; }\r\n  \t\t}\r\n\r\n  \t\t// @property min: Point\r\n  \t\t// The top left corner of the rectangle.\r\n  \t\t// @property max: Point\r\n  \t\t// The bottom right corner of the rectangle.\r\n  \t\tif (!this.min && !this.max) {\r\n  \t\t\tthis.min = min2.clone();\r\n  \t\t\tthis.max = max2.clone();\r\n  \t\t} else {\r\n  \t\t\tthis.min.x = Math.min(min2.x, this.min.x);\r\n  \t\t\tthis.max.x = Math.max(max2.x, this.max.x);\r\n  \t\t\tthis.min.y = Math.min(min2.y, this.min.y);\r\n  \t\t\tthis.max.y = Math.max(max2.y, this.max.y);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getCenter(round?: Boolean): Point\r\n  \t// Returns the center point of the bounds.\r\n  \tgetCenter: function (round) {\r\n  \t\treturn toPoint(\r\n  \t\t        (this.min.x + this.max.x) / 2,\r\n  \t\t        (this.min.y + this.max.y) / 2, round);\r\n  \t},\r\n\r\n  \t// @method getBottomLeft(): Point\r\n  \t// Returns the bottom-left point of the bounds.\r\n  \tgetBottomLeft: function () {\r\n  \t\treturn toPoint(this.min.x, this.max.y);\r\n  \t},\r\n\r\n  \t// @method getTopRight(): Point\r\n  \t// Returns the top-right point of the bounds.\r\n  \tgetTopRight: function () { // -> Point\r\n  \t\treturn toPoint(this.max.x, this.min.y);\r\n  \t},\r\n\r\n  \t// @method getTopLeft(): Point\r\n  \t// Returns the top-left point of the bounds (i.e. [`this.min`](#bounds-min)).\r\n  \tgetTopLeft: function () {\r\n  \t\treturn this.min; // left, top\r\n  \t},\r\n\r\n  \t// @method getBottomRight(): Point\r\n  \t// Returns the bottom-right point of the bounds (i.e. [`this.max`](#bounds-max)).\r\n  \tgetBottomRight: function () {\r\n  \t\treturn this.max; // right, bottom\r\n  \t},\r\n\r\n  \t// @method getSize(): Point\r\n  \t// Returns the size of the given bounds\r\n  \tgetSize: function () {\r\n  \t\treturn this.max.subtract(this.min);\r\n  \t},\r\n\r\n  \t// @method contains(otherBounds: Bounds): Boolean\r\n  \t// Returns `true` if the rectangle contains the given one.\r\n  \t// @alternative\r\n  \t// @method contains(point: Point): Boolean\r\n  \t// Returns `true` if the rectangle contains the given point.\r\n  \tcontains: function (obj) {\r\n  \t\tvar min, max;\r\n\r\n  \t\tif (typeof obj[0] === 'number' || obj instanceof Point) {\r\n  \t\t\tobj = toPoint(obj);\r\n  \t\t} else {\r\n  \t\t\tobj = toBounds(obj);\r\n  \t\t}\r\n\r\n  \t\tif (obj instanceof Bounds) {\r\n  \t\t\tmin = obj.min;\r\n  \t\t\tmax = obj.max;\r\n  \t\t} else {\r\n  \t\t\tmin = max = obj;\r\n  \t\t}\r\n\r\n  \t\treturn (min.x >= this.min.x) &&\r\n  \t\t       (max.x <= this.max.x) &&\r\n  \t\t       (min.y >= this.min.y) &&\r\n  \t\t       (max.y <= this.max.y);\r\n  \t},\r\n\r\n  \t// @method intersects(otherBounds: Bounds): Boolean\r\n  \t// Returns `true` if the rectangle intersects the given bounds. Two bounds\r\n  \t// intersect if they have at least one point in common.\r\n  \tintersects: function (bounds) { // (Bounds) -> Boolean\r\n  \t\tbounds = toBounds(bounds);\r\n\r\n  \t\tvar min = this.min,\r\n  \t\t    max = this.max,\r\n  \t\t    min2 = bounds.min,\r\n  \t\t    max2 = bounds.max,\r\n  \t\t    xIntersects = (max2.x >= min.x) && (min2.x <= max.x),\r\n  \t\t    yIntersects = (max2.y >= min.y) && (min2.y <= max.y);\r\n\r\n  \t\treturn xIntersects && yIntersects;\r\n  \t},\r\n\r\n  \t// @method overlaps(otherBounds: Bounds): Boolean\r\n  \t// Returns `true` if the rectangle overlaps the given bounds. Two bounds\r\n  \t// overlap if their intersection is an area.\r\n  \toverlaps: function (bounds) { // (Bounds) -> Boolean\r\n  \t\tbounds = toBounds(bounds);\r\n\r\n  \t\tvar min = this.min,\r\n  \t\t    max = this.max,\r\n  \t\t    min2 = bounds.min,\r\n  \t\t    max2 = bounds.max,\r\n  \t\t    xOverlaps = (max2.x > min.x) && (min2.x < max.x),\r\n  \t\t    yOverlaps = (max2.y > min.y) && (min2.y < max.y);\r\n\r\n  \t\treturn xOverlaps && yOverlaps;\r\n  \t},\r\n\r\n  \t// @method isValid(): Boolean\r\n  \t// Returns `true` if the bounds are properly initialized.\r\n  \tisValid: function () {\r\n  \t\treturn !!(this.min && this.max);\r\n  \t},\r\n\r\n\r\n  \t// @method pad(bufferRatio: Number): Bounds\r\n  \t// Returns bounds created by extending or retracting the current bounds by a given ratio in each direction.\r\n  \t// For example, a ratio of 0.5 extends the bounds by 50% in each direction.\r\n  \t// Negative values will retract the bounds.\r\n  \tpad: function (bufferRatio) {\r\n  \t\tvar min = this.min,\r\n  \t\tmax = this.max,\r\n  \t\theightBuffer = Math.abs(min.x - max.x) * bufferRatio,\r\n  \t\twidthBuffer = Math.abs(min.y - max.y) * bufferRatio;\r\n\r\n\r\n  \t\treturn toBounds(\r\n  \t\t\ttoPoint(min.x - heightBuffer, min.y - widthBuffer),\r\n  \t\t\ttoPoint(max.x + heightBuffer, max.y + widthBuffer));\r\n  \t},\r\n\r\n\r\n  \t// @method equals(otherBounds: Bounds): Boolean\r\n  \t// Returns `true` if the rectangle is equivalent to the given bounds.\r\n  \tequals: function (bounds) {\r\n  \t\tif (!bounds) { return false; }\r\n\r\n  \t\tbounds = toBounds(bounds);\r\n\r\n  \t\treturn this.min.equals(bounds.getTopLeft()) &&\r\n  \t\t\tthis.max.equals(bounds.getBottomRight());\r\n  \t},\r\n  };\r\n\r\n\r\n  // @factory L.bounds(corner1: Point, corner2: Point)\r\n  // Creates a Bounds object from two corners coordinate pairs.\r\n  // @alternative\r\n  // @factory L.bounds(points: Point[])\r\n  // Creates a Bounds object from the given array of points.\r\n  function toBounds(a, b) {\r\n  \tif (!a || a instanceof Bounds) {\r\n  \t\treturn a;\r\n  \t}\r\n  \treturn new Bounds(a, b);\r\n  }\n\n  /*\r\n   * @class LatLngBounds\r\n   * @aka L.LatLngBounds\r\n   *\r\n   * Represents a rectangular geographical area on a map.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var corner1 = L.latLng(40.712, -74.227),\r\n   * corner2 = L.latLng(40.774, -74.125),\r\n   * bounds = L.latLngBounds(corner1, corner2);\r\n   * ```\r\n   *\r\n   * All Leaflet methods that accept LatLngBounds objects also accept them in a simple Array form (unless noted otherwise), so the bounds example above can be passed like this:\r\n   *\r\n   * ```js\r\n   * map.fitBounds([\r\n   * \t[40.712, -74.227],\r\n   * \t[40.774, -74.125]\r\n   * ]);\r\n   * ```\r\n   *\r\n   * Caution: if the area crosses the antimeridian (often confused with the International Date Line), you must specify corners _outside_ the [-180, 180] degrees longitude range.\r\n   *\r\n   * Note that `LatLngBounds` does not inherit from Leaflet's `Class` object,\r\n   * which means new classes can't inherit from it, and new methods\r\n   * can't be added to it with the `include` function.\r\n   */\r\n\r\n  function LatLngBounds(corner1, corner2) { // (LatLng, LatLng) or (LatLng[])\r\n  \tif (!corner1) { return; }\r\n\r\n  \tvar latlngs = corner2 ? [corner1, corner2] : corner1;\r\n\r\n  \tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n  \t\tthis.extend(latlngs[i]);\r\n  \t}\r\n  }\r\n\r\n  LatLngBounds.prototype = {\r\n\r\n  \t// @method extend(latlng: LatLng): this\r\n  \t// Extend the bounds to contain the given point\r\n\r\n  \t// @alternative\r\n  \t// @method extend(otherBounds: LatLngBounds): this\r\n  \t// Extend the bounds to contain the given bounds\r\n  \textend: function (obj) {\r\n  \t\tvar sw = this._southWest,\r\n  \t\t    ne = this._northEast,\r\n  \t\t    sw2, ne2;\r\n\r\n  \t\tif (obj instanceof LatLng) {\r\n  \t\t\tsw2 = obj;\r\n  \t\t\tne2 = obj;\r\n\r\n  \t\t} else if (obj instanceof LatLngBounds) {\r\n  \t\t\tsw2 = obj._southWest;\r\n  \t\t\tne2 = obj._northEast;\r\n\r\n  \t\t\tif (!sw2 || !ne2) { return this; }\r\n\r\n  \t\t} else {\r\n  \t\t\treturn obj ? this.extend(toLatLng(obj) || toLatLngBounds(obj)) : this;\r\n  \t\t}\r\n\r\n  \t\tif (!sw && !ne) {\r\n  \t\t\tthis._southWest = new LatLng(sw2.lat, sw2.lng);\r\n  \t\t\tthis._northEast = new LatLng(ne2.lat, ne2.lng);\r\n  \t\t} else {\r\n  \t\t\tsw.lat = Math.min(sw2.lat, sw.lat);\r\n  \t\t\tsw.lng = Math.min(sw2.lng, sw.lng);\r\n  \t\t\tne.lat = Math.max(ne2.lat, ne.lat);\r\n  \t\t\tne.lng = Math.max(ne2.lng, ne.lng);\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method pad(bufferRatio: Number): LatLngBounds\r\n  \t// Returns bounds created by extending or retracting the current bounds by a given ratio in each direction.\r\n  \t// For example, a ratio of 0.5 extends the bounds by 50% in each direction.\r\n  \t// Negative values will retract the bounds.\r\n  \tpad: function (bufferRatio) {\r\n  \t\tvar sw = this._southWest,\r\n  \t\t    ne = this._northEast,\r\n  \t\t    heightBuffer = Math.abs(sw.lat - ne.lat) * bufferRatio,\r\n  \t\t    widthBuffer = Math.abs(sw.lng - ne.lng) * bufferRatio;\r\n\r\n  \t\treturn new LatLngBounds(\r\n  \t\t        new LatLng(sw.lat - heightBuffer, sw.lng - widthBuffer),\r\n  \t\t        new LatLng(ne.lat + heightBuffer, ne.lng + widthBuffer));\r\n  \t},\r\n\r\n  \t// @method getCenter(): LatLng\r\n  \t// Returns the center point of the bounds.\r\n  \tgetCenter: function () {\r\n  \t\treturn new LatLng(\r\n  \t\t        (this._southWest.lat + this._northEast.lat) / 2,\r\n  \t\t        (this._southWest.lng + this._northEast.lng) / 2);\r\n  \t},\r\n\r\n  \t// @method getSouthWest(): LatLng\r\n  \t// Returns the south-west point of the bounds.\r\n  \tgetSouthWest: function () {\r\n  \t\treturn this._southWest;\r\n  \t},\r\n\r\n  \t// @method getNorthEast(): LatLng\r\n  \t// Returns the north-east point of the bounds.\r\n  \tgetNorthEast: function () {\r\n  \t\treturn this._northEast;\r\n  \t},\r\n\r\n  \t// @method getNorthWest(): LatLng\r\n  \t// Returns the north-west point of the bounds.\r\n  \tgetNorthWest: function () {\r\n  \t\treturn new LatLng(this.getNorth(), this.getWest());\r\n  \t},\r\n\r\n  \t// @method getSouthEast(): LatLng\r\n  \t// Returns the south-east point of the bounds.\r\n  \tgetSouthEast: function () {\r\n  \t\treturn new LatLng(this.getSouth(), this.getEast());\r\n  \t},\r\n\r\n  \t// @method getWest(): Number\r\n  \t// Returns the west longitude of the bounds\r\n  \tgetWest: function () {\r\n  \t\treturn this._southWest.lng;\r\n  \t},\r\n\r\n  \t// @method getSouth(): Number\r\n  \t// Returns the south latitude of the bounds\r\n  \tgetSouth: function () {\r\n  \t\treturn this._southWest.lat;\r\n  \t},\r\n\r\n  \t// @method getEast(): Number\r\n  \t// Returns the east longitude of the bounds\r\n  \tgetEast: function () {\r\n  \t\treturn this._northEast.lng;\r\n  \t},\r\n\r\n  \t// @method getNorth(): Number\r\n  \t// Returns the north latitude of the bounds\r\n  \tgetNorth: function () {\r\n  \t\treturn this._northEast.lat;\r\n  \t},\r\n\r\n  \t// @method contains(otherBounds: LatLngBounds): Boolean\r\n  \t// Returns `true` if the rectangle contains the given one.\r\n\r\n  \t// @alternative\r\n  \t// @method contains (latlng: LatLng): Boolean\r\n  \t// Returns `true` if the rectangle contains the given point.\r\n  \tcontains: function (obj) { // (LatLngBounds) or (LatLng) -> Boolean\r\n  \t\tif (typeof obj[0] === 'number' || obj instanceof LatLng || 'lat' in obj) {\r\n  \t\t\tobj = toLatLng(obj);\r\n  \t\t} else {\r\n  \t\t\tobj = toLatLngBounds(obj);\r\n  \t\t}\r\n\r\n  \t\tvar sw = this._southWest,\r\n  \t\t    ne = this._northEast,\r\n  \t\t    sw2, ne2;\r\n\r\n  \t\tif (obj instanceof LatLngBounds) {\r\n  \t\t\tsw2 = obj.getSouthWest();\r\n  \t\t\tne2 = obj.getNorthEast();\r\n  \t\t} else {\r\n  \t\t\tsw2 = ne2 = obj;\r\n  \t\t}\r\n\r\n  \t\treturn (sw2.lat >= sw.lat) && (ne2.lat <= ne.lat) &&\r\n  \t\t       (sw2.lng >= sw.lng) && (ne2.lng <= ne.lng);\r\n  \t},\r\n\r\n  \t// @method intersects(otherBounds: LatLngBounds): Boolean\r\n  \t// Returns `true` if the rectangle intersects the given bounds. Two bounds intersect if they have at least one point in common.\r\n  \tintersects: function (bounds) {\r\n  \t\tbounds = toLatLngBounds(bounds);\r\n\r\n  \t\tvar sw = this._southWest,\r\n  \t\t    ne = this._northEast,\r\n  \t\t    sw2 = bounds.getSouthWest(),\r\n  \t\t    ne2 = bounds.getNorthEast(),\r\n\r\n  \t\t    latIntersects = (ne2.lat >= sw.lat) && (sw2.lat <= ne.lat),\r\n  \t\t    lngIntersects = (ne2.lng >= sw.lng) && (sw2.lng <= ne.lng);\r\n\r\n  \t\treturn latIntersects && lngIntersects;\r\n  \t},\r\n\r\n  \t// @method overlaps(otherBounds: LatLngBounds): Boolean\r\n  \t// Returns `true` if the rectangle overlaps the given bounds. Two bounds overlap if their intersection is an area.\r\n  \toverlaps: function (bounds) {\r\n  \t\tbounds = toLatLngBounds(bounds);\r\n\r\n  \t\tvar sw = this._southWest,\r\n  \t\t    ne = this._northEast,\r\n  \t\t    sw2 = bounds.getSouthWest(),\r\n  \t\t    ne2 = bounds.getNorthEast(),\r\n\r\n  \t\t    latOverlaps = (ne2.lat > sw.lat) && (sw2.lat < ne.lat),\r\n  \t\t    lngOverlaps = (ne2.lng > sw.lng) && (sw2.lng < ne.lng);\r\n\r\n  \t\treturn latOverlaps && lngOverlaps;\r\n  \t},\r\n\r\n  \t// @method toBBoxString(): String\r\n  \t// Returns a string with bounding box coordinates in a 'southwest_lng,southwest_lat,northeast_lng,northeast_lat' format. Useful for sending requests to web services that return geo data.\r\n  \ttoBBoxString: function () {\r\n  \t\treturn [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join(',');\r\n  \t},\r\n\r\n  \t// @method equals(otherBounds: LatLngBounds, maxMargin?: Number): Boolean\r\n  \t// Returns `true` if the rectangle is equivalent (within a small margin of error) to the given bounds. The margin of error can be overridden by setting `maxMargin` to a small number.\r\n  \tequals: function (bounds, maxMargin) {\r\n  \t\tif (!bounds) { return false; }\r\n\r\n  \t\tbounds = toLatLngBounds(bounds);\r\n\r\n  \t\treturn this._southWest.equals(bounds.getSouthWest(), maxMargin) &&\r\n  \t\t       this._northEast.equals(bounds.getNorthEast(), maxMargin);\r\n  \t},\r\n\r\n  \t// @method isValid(): Boolean\r\n  \t// Returns `true` if the bounds are properly initialized.\r\n  \tisValid: function () {\r\n  \t\treturn !!(this._southWest && this._northEast);\r\n  \t}\r\n  };\r\n\r\n  // TODO International date line?\r\n\r\n  // @factory L.latLngBounds(corner1: LatLng, corner2: LatLng)\r\n  // Creates a `LatLngBounds` object by defining two diagonally opposite corners of the rectangle.\r\n\r\n  // @alternative\r\n  // @factory L.latLngBounds(latlngs: LatLng[])\r\n  // Creates a `LatLngBounds` object defined by the geographical points it contains. Very useful for zooming the map to fit a particular set of locations with [`fitBounds`](#map-fitbounds).\r\n  function toLatLngBounds(a, b) {\r\n  \tif (a instanceof LatLngBounds) {\r\n  \t\treturn a;\r\n  \t}\r\n  \treturn new LatLngBounds(a, b);\r\n  }\n\n  /* @class LatLng\r\n   * @aka L.LatLng\r\n   *\r\n   * Represents a geographical point with a certain latitude and longitude.\r\n   *\r\n   * @example\r\n   *\r\n   * ```\r\n   * var latlng = L.latLng(50.5, 30.5);\r\n   * ```\r\n   *\r\n   * All Leaflet methods that accept LatLng objects also accept them in a simple Array form and simple object form (unless noted otherwise), so these lines are equivalent:\r\n   *\r\n   * ```\r\n   * map.panTo([50, 30]);\r\n   * map.panTo({lon: 30, lat: 50});\r\n   * map.panTo({lat: 50, lng: 30});\r\n   * map.panTo(L.latLng(50, 30));\r\n   * ```\r\n   *\r\n   * Note that `LatLng` does not inherit from Leaflet's `Class` object,\r\n   * which means new classes can't inherit from it, and new methods\r\n   * can't be added to it with the `include` function.\r\n   */\r\n\r\n  function LatLng(lat, lng, alt) {\r\n  \tif (isNaN(lat) || isNaN(lng)) {\r\n  \t\tthrow new Error('Invalid LatLng object: (' + lat + ', ' + lng + ')');\r\n  \t}\r\n\r\n  \t// @property lat: Number\r\n  \t// Latitude in degrees\r\n  \tthis.lat = +lat;\r\n\r\n  \t// @property lng: Number\r\n  \t// Longitude in degrees\r\n  \tthis.lng = +lng;\r\n\r\n  \t// @property alt: Number\r\n  \t// Altitude in meters (optional)\r\n  \tif (alt !== undefined) {\r\n  \t\tthis.alt = +alt;\r\n  \t}\r\n  }\r\n\r\n  LatLng.prototype = {\r\n  \t// @method equals(otherLatLng: LatLng, maxMargin?: Number): Boolean\r\n  \t// Returns `true` if the given `LatLng` point is at the same position (within a small margin of error). The margin of error can be overridden by setting `maxMargin` to a small number.\r\n  \tequals: function (obj, maxMargin) {\r\n  \t\tif (!obj) { return false; }\r\n\r\n  \t\tobj = toLatLng(obj);\r\n\r\n  \t\tvar margin = Math.max(\r\n  \t\t        Math.abs(this.lat - obj.lat),\r\n  \t\t        Math.abs(this.lng - obj.lng));\r\n\r\n  \t\treturn margin <= (maxMargin === undefined ? 1.0E-9 : maxMargin);\r\n  \t},\r\n\r\n  \t// @method toString(): String\r\n  \t// Returns a string representation of the point (for debugging purposes).\r\n  \ttoString: function (precision) {\r\n  \t\treturn 'LatLng(' +\r\n  \t\t        formatNum(this.lat, precision) + ', ' +\r\n  \t\t        formatNum(this.lng, precision) + ')';\r\n  \t},\r\n\r\n  \t// @method distanceTo(otherLatLng: LatLng): Number\r\n  \t// Returns the distance (in meters) to the given `LatLng` calculated using the [Spherical Law of Cosines](https://en.wikipedia.org/wiki/Spherical_law_of_cosines).\r\n  \tdistanceTo: function (other) {\r\n  \t\treturn Earth.distance(this, toLatLng(other));\r\n  \t},\r\n\r\n  \t// @method wrap(): LatLng\r\n  \t// Returns a new `LatLng` object with the longitude wrapped so it's always between -180 and +180 degrees.\r\n  \twrap: function () {\r\n  \t\treturn Earth.wrapLatLng(this);\r\n  \t},\r\n\r\n  \t// @method toBounds(sizeInMeters: Number): LatLngBounds\r\n  \t// Returns a new `LatLngBounds` object in which each boundary is `sizeInMeters/2` meters apart from the `LatLng`.\r\n  \ttoBounds: function (sizeInMeters) {\r\n  \t\tvar latAccuracy = 180 * sizeInMeters / 40075017,\r\n  \t\t    lngAccuracy = latAccuracy / Math.cos((Math.PI / 180) * this.lat);\r\n\r\n  \t\treturn toLatLngBounds(\r\n  \t\t        [this.lat - latAccuracy, this.lng - lngAccuracy],\r\n  \t\t        [this.lat + latAccuracy, this.lng + lngAccuracy]);\r\n  \t},\r\n\r\n  \tclone: function () {\r\n  \t\treturn new LatLng(this.lat, this.lng, this.alt);\r\n  \t}\r\n  };\r\n\r\n\r\n\r\n  // @factory L.latLng(latitude: Number, longitude: Number, altitude?: Number): LatLng\r\n  // Creates an object representing a geographical point with the given latitude and longitude (and optionally altitude).\r\n\r\n  // @alternative\r\n  // @factory L.latLng(coords: Array): LatLng\r\n  // Expects an array of the form `[Number, Number]` or `[Number, Number, Number]` instead.\r\n\r\n  // @alternative\r\n  // @factory L.latLng(coords: Object): LatLng\r\n  // Expects an plain object of the form `{lat: Number, lng: Number}` or `{lat: Number, lng: Number, alt: Number}` instead.\r\n\r\n  function toLatLng(a, b, c) {\r\n  \tif (a instanceof LatLng) {\r\n  \t\treturn a;\r\n  \t}\r\n  \tif (isArray(a) && typeof a[0] !== 'object') {\r\n  \t\tif (a.length === 3) {\r\n  \t\t\treturn new LatLng(a[0], a[1], a[2]);\r\n  \t\t}\r\n  \t\tif (a.length === 2) {\r\n  \t\t\treturn new LatLng(a[0], a[1]);\r\n  \t\t}\r\n  \t\treturn null;\r\n  \t}\r\n  \tif (a === undefined || a === null) {\r\n  \t\treturn a;\r\n  \t}\r\n  \tif (typeof a === 'object' && 'lat' in a) {\r\n  \t\treturn new LatLng(a.lat, 'lng' in a ? a.lng : a.lon, a.alt);\r\n  \t}\r\n  \tif (b === undefined) {\r\n  \t\treturn null;\r\n  \t}\r\n  \treturn new LatLng(a, b, c);\r\n  }\n\n  /*\r\n   * @namespace CRS\r\n   * @crs L.CRS.Base\r\n   * Object that defines coordinate reference systems for projecting\r\n   * geographical points into pixel (screen) coordinates and back (and to\r\n   * coordinates in other units for [WMS](https://en.wikipedia.org/wiki/Web_Map_Service) services). See\r\n   * [spatial reference system](https://en.wikipedia.org/wiki/Spatial_reference_system).\r\n   *\r\n   * Leaflet defines the most usual CRSs by default. If you want to use a\r\n   * CRS not defined by default, take a look at the\r\n   * [Proj4Leaflet](https://github.com/kartena/Proj4Leaflet) plugin.\r\n   *\r\n   * Note that the CRS instances do not inherit from Leaflet's `Class` object,\r\n   * and can't be instantiated. Also, new classes can't inherit from them,\r\n   * and methods can't be added to them with the `include` function.\r\n   */\r\n\r\n  var CRS = {\r\n  \t// @method latLngToPoint(latlng: LatLng, zoom: Number): Point\r\n  \t// Projects geographical coordinates into pixel coordinates for a given zoom.\r\n  \tlatLngToPoint: function (latlng, zoom) {\r\n  \t\tvar projectedPoint = this.projection.project(latlng),\r\n  \t\t    scale = this.scale(zoom);\r\n\r\n  \t\treturn this.transformation._transform(projectedPoint, scale);\r\n  \t},\r\n\r\n  \t// @method pointToLatLng(point: Point, zoom: Number): LatLng\r\n  \t// The inverse of `latLngToPoint`. Projects pixel coordinates on a given\r\n  \t// zoom into geographical coordinates.\r\n  \tpointToLatLng: function (point, zoom) {\r\n  \t\tvar scale = this.scale(zoom),\r\n  \t\t    untransformedPoint = this.transformation.untransform(point, scale);\r\n\r\n  \t\treturn this.projection.unproject(untransformedPoint);\r\n  \t},\r\n\r\n  \t// @method project(latlng: LatLng): Point\r\n  \t// Projects geographical coordinates into coordinates in units accepted for\r\n  \t// this CRS (e.g. meters for EPSG:3857, for passing it to WMS services).\r\n  \tproject: function (latlng) {\r\n  \t\treturn this.projection.project(latlng);\r\n  \t},\r\n\r\n  \t// @method unproject(point: Point): LatLng\r\n  \t// Given a projected coordinate returns the corresponding LatLng.\r\n  \t// The inverse of `project`.\r\n  \tunproject: function (point) {\r\n  \t\treturn this.projection.unproject(point);\r\n  \t},\r\n\r\n  \t// @method scale(zoom: Number): Number\r\n  \t// Returns the scale used when transforming projected coordinates into\r\n  \t// pixel coordinates for a particular zoom. For example, it returns\r\n  \t// `256 * 2^zoom` for Mercator-based CRS.\r\n  \tscale: function (zoom) {\r\n  \t\treturn 256 * Math.pow(2, zoom);\r\n  \t},\r\n\r\n  \t// @method zoom(scale: Number): Number\r\n  \t// Inverse of `scale()`, returns the zoom level corresponding to a scale\r\n  \t// factor of `scale`.\r\n  \tzoom: function (scale) {\r\n  \t\treturn Math.log(scale / 256) / Math.LN2;\r\n  \t},\r\n\r\n  \t// @method getProjectedBounds(zoom: Number): Bounds\r\n  \t// Returns the projection's bounds scaled and transformed for the provided `zoom`.\r\n  \tgetProjectedBounds: function (zoom) {\r\n  \t\tif (this.infinite) { return null; }\r\n\r\n  \t\tvar b = this.projection.bounds,\r\n  \t\t    s = this.scale(zoom),\r\n  \t\t    min = this.transformation.transform(b.min, s),\r\n  \t\t    max = this.transformation.transform(b.max, s);\r\n\r\n  \t\treturn new Bounds(min, max);\r\n  \t},\r\n\r\n  \t// @method distance(latlng1: LatLng, latlng2: LatLng): Number\r\n  \t// Returns the distance between two geographical coordinates.\r\n\r\n  \t// @property code: String\r\n  \t// Standard code name of the CRS passed into WMS services (e.g. `'EPSG:3857'`)\r\n  \t//\r\n  \t// @property wrapLng: Number[]\r\n  \t// An array of two numbers defining whether the longitude (horizontal) coordinate\r\n  \t// axis wraps around a given range and how. Defaults to `[-180, 180]` in most\r\n  \t// geographical CRSs. If `undefined`, the longitude axis does not wrap around.\r\n  \t//\r\n  \t// @property wrapLat: Number[]\r\n  \t// Like `wrapLng`, but for the latitude (vertical) axis.\r\n\r\n  \t// wrapLng: [min, max],\r\n  \t// wrapLat: [min, max],\r\n\r\n  \t// @property infinite: Boolean\r\n  \t// If true, the coordinate space will be unbounded (infinite in both axes)\r\n  \tinfinite: false,\r\n\r\n  \t// @method wrapLatLng(latlng: LatLng): LatLng\r\n  \t// Returns a `LatLng` where lat and lng has been wrapped according to the\r\n  \t// CRS's `wrapLat` and `wrapLng` properties, if they are outside the CRS's bounds.\r\n  \twrapLatLng: function (latlng) {\r\n  \t\tvar lng = this.wrapLng ? wrapNum(latlng.lng, this.wrapLng, true) : latlng.lng,\r\n  \t\t    lat = this.wrapLat ? wrapNum(latlng.lat, this.wrapLat, true) : latlng.lat,\r\n  \t\t    alt = latlng.alt;\r\n\r\n  \t\treturn new LatLng(lat, lng, alt);\r\n  \t},\r\n\r\n  \t// @method wrapLatLngBounds(bounds: LatLngBounds): LatLngBounds\r\n  \t// Returns a `LatLngBounds` with the same size as the given one, ensuring\r\n  \t// that its center is within the CRS's bounds.\r\n  \t// Only accepts actual `L.LatLngBounds` instances, not arrays.\r\n  \twrapLatLngBounds: function (bounds) {\r\n  \t\tvar center = bounds.getCenter(),\r\n  \t\t    newCenter = this.wrapLatLng(center),\r\n  \t\t    latShift = center.lat - newCenter.lat,\r\n  \t\t    lngShift = center.lng - newCenter.lng;\r\n\r\n  \t\tif (latShift === 0 && lngShift === 0) {\r\n  \t\t\treturn bounds;\r\n  \t\t}\r\n\r\n  \t\tvar sw = bounds.getSouthWest(),\r\n  \t\t    ne = bounds.getNorthEast(),\r\n  \t\t    newSw = new LatLng(sw.lat - latShift, sw.lng - lngShift),\r\n  \t\t    newNe = new LatLng(ne.lat - latShift, ne.lng - lngShift);\r\n\r\n  \t\treturn new LatLngBounds(newSw, newNe);\r\n  \t}\r\n  };\n\n  /*\n   * @namespace CRS\n   * @crs L.CRS.Earth\n   *\n   * Serves as the base for CRS that are global such that they cover the earth.\n   * Can only be used as the base for other CRS and cannot be used directly,\n   * since it does not have a `code`, `projection` or `transformation`. `distance()` returns\n   * meters.\n   */\n\n  var Earth = extend({}, CRS, {\n  \twrapLng: [-180, 180],\n\n  \t// Mean Earth Radius, as recommended for use by\n  \t// the International Union of Geodesy and Geophysics,\n  \t// see https://rosettacode.org/wiki/Haversine_formula\n  \tR: 6371000,\n\n  \t// distance between two geographical points using spherical law of cosines approximation\n  \tdistance: function (latlng1, latlng2) {\n  \t\tvar rad = Math.PI / 180,\n  \t\t    lat1 = latlng1.lat * rad,\n  \t\t    lat2 = latlng2.lat * rad,\n  \t\t    sinDLat = Math.sin((latlng2.lat - latlng1.lat) * rad / 2),\n  \t\t    sinDLon = Math.sin((latlng2.lng - latlng1.lng) * rad / 2),\n  \t\t    a = sinDLat * sinDLat + Math.cos(lat1) * Math.cos(lat2) * sinDLon * sinDLon,\n  \t\t    c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  \t\treturn this.R * c;\n  \t}\n  });\n\n  /*\r\n   * @namespace Projection\r\n   * @projection L.Projection.SphericalMercator\r\n   *\r\n   * Spherical Mercator projection  the most common projection for online maps,\r\n   * used by almost all free and commercial tile providers. Assumes that Earth is\r\n   * a sphere. Used by the `EPSG:3857` CRS.\r\n   */\r\n\r\n  var earthRadius = 6378137;\r\n\r\n  var SphericalMercator = {\r\n\r\n  \tR: earthRadius,\r\n  \tMAX_LATITUDE: 85.0511287798,\r\n\r\n  \tproject: function (latlng) {\r\n  \t\tvar d = Math.PI / 180,\r\n  \t\t    max = this.MAX_LATITUDE,\r\n  \t\t    lat = Math.max(Math.min(max, latlng.lat), -max),\r\n  \t\t    sin = Math.sin(lat * d);\r\n\r\n  \t\treturn new Point(\r\n  \t\t\tthis.R * latlng.lng * d,\r\n  \t\t\tthis.R * Math.log((1 + sin) / (1 - sin)) / 2);\r\n  \t},\r\n\r\n  \tunproject: function (point) {\r\n  \t\tvar d = 180 / Math.PI;\r\n\r\n  \t\treturn new LatLng(\r\n  \t\t\t(2 * Math.atan(Math.exp(point.y / this.R)) - (Math.PI / 2)) * d,\r\n  \t\t\tpoint.x * d / this.R);\r\n  \t},\r\n\r\n  \tbounds: (function () {\r\n  \t\tvar d = earthRadius * Math.PI;\r\n  \t\treturn new Bounds([-d, -d], [d, d]);\r\n  \t})()\r\n  };\n\n  /*\r\n   * @class Transformation\r\n   * @aka L.Transformation\r\n   *\r\n   * Represents an affine transformation: a set of coefficients `a`, `b`, `c`, `d`\r\n   * for transforming a point of a form `(x, y)` into `(a*x + b, c*y + d)` and doing\r\n   * the reverse. Used by Leaflet in its projections code.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var transformation = L.transformation(2, 5, -1, 10),\r\n   * \tp = L.point(1, 2),\r\n   * \tp2 = transformation.transform(p), //  L.point(7, 8)\r\n   * \tp3 = transformation.untransform(p2); //  L.point(1, 2)\r\n   * ```\r\n   */\r\n\r\n\r\n  // factory new L.Transformation(a: Number, b: Number, c: Number, d: Number)\r\n  // Creates a `Transformation` object with the given coefficients.\r\n  function Transformation(a, b, c, d) {\r\n  \tif (isArray(a)) {\r\n  \t\t// use array properties\r\n  \t\tthis._a = a[0];\r\n  \t\tthis._b = a[1];\r\n  \t\tthis._c = a[2];\r\n  \t\tthis._d = a[3];\r\n  \t\treturn;\r\n  \t}\r\n  \tthis._a = a;\r\n  \tthis._b = b;\r\n  \tthis._c = c;\r\n  \tthis._d = d;\r\n  }\r\n\r\n  Transformation.prototype = {\r\n  \t// @method transform(point: Point, scale?: Number): Point\r\n  \t// Returns a transformed point, optionally multiplied by the given scale.\r\n  \t// Only accepts actual `L.Point` instances, not arrays.\r\n  \ttransform: function (point, scale) { // (Point, Number) -> Point\r\n  \t\treturn this._transform(point.clone(), scale);\r\n  \t},\r\n\r\n  \t// destructive transform (faster)\r\n  \t_transform: function (point, scale) {\r\n  \t\tscale = scale || 1;\r\n  \t\tpoint.x = scale * (this._a * point.x + this._b);\r\n  \t\tpoint.y = scale * (this._c * point.y + this._d);\r\n  \t\treturn point;\r\n  \t},\r\n\r\n  \t// @method untransform(point: Point, scale?: Number): Point\r\n  \t// Returns the reverse transformation of the given point, optionally divided\r\n  \t// by the given scale. Only accepts actual `L.Point` instances, not arrays.\r\n  \tuntransform: function (point, scale) {\r\n  \t\tscale = scale || 1;\r\n  \t\treturn new Point(\r\n  \t\t        (point.x / scale - this._b) / this._a,\r\n  \t\t        (point.y / scale - this._d) / this._c);\r\n  \t}\r\n  };\r\n\r\n  // factory L.transformation(a: Number, b: Number, c: Number, d: Number)\r\n\r\n  // @factory L.transformation(a: Number, b: Number, c: Number, d: Number)\r\n  // Instantiates a Transformation object with the given coefficients.\r\n\r\n  // @alternative\r\n  // @factory L.transformation(coefficients: Array): Transformation\r\n  // Expects an coefficients array of the form\r\n  // `[a: Number, b: Number, c: Number, d: Number]`.\r\n\r\n  function toTransformation(a, b, c, d) {\r\n  \treturn new Transformation(a, b, c, d);\r\n  }\n\n  /*\r\n   * @namespace CRS\r\n   * @crs L.CRS.EPSG3857\r\n   *\r\n   * The most common CRS for online maps, used by almost all free and commercial\r\n   * tile providers. Uses Spherical Mercator projection. Set in by default in\r\n   * Map's `crs` option.\r\n   */\r\n\r\n  var EPSG3857 = extend({}, Earth, {\r\n  \tcode: 'EPSG:3857',\r\n  \tprojection: SphericalMercator,\r\n\r\n  \ttransformation: (function () {\r\n  \t\tvar scale = 0.5 / (Math.PI * SphericalMercator.R);\r\n  \t\treturn toTransformation(scale, 0.5, -scale, 0.5);\r\n  \t}())\r\n  });\r\n\r\n  var EPSG900913 = extend({}, EPSG3857, {\r\n  \tcode: 'EPSG:900913'\r\n  });\n\n  // @namespace SVG; @section\n  // There are several static functions which can be called without instantiating L.SVG:\n\n  // @function create(name: String): SVGElement\n  // Returns a instance of [SVGElement](https://developer.mozilla.org/docs/Web/API/SVGElement),\n  // corresponding to the class name passed. For example, using 'line' will return\n  // an instance of [SVGLineElement](https://developer.mozilla.org/docs/Web/API/SVGLineElement).\n  function svgCreate(name) {\n  \treturn document.createElementNS('http://www.w3.org/2000/svg', name);\n  }\n\n  // @function pointsToPath(rings: Point[], closed: Boolean): String\n  // Generates a SVG path string for multiple rings, with each ring turning\n  // into \"M..L..L..\" instructions\n  function pointsToPath(rings, closed) {\n  \tvar str = '',\n  \ti, j, len, len2, points, p;\n\n  \tfor (i = 0, len = rings.length; i < len; i++) {\n  \t\tpoints = rings[i];\n\n  \t\tfor (j = 0, len2 = points.length; j < len2; j++) {\n  \t\t\tp = points[j];\n  \t\t\tstr += (j ? 'L' : 'M') + p.x + ' ' + p.y;\n  \t\t}\n\n  \t\t// closes the ring for polygons; \"x\" is VML syntax\n  \t\tstr += closed ? (Browser.svg ? 'z' : 'x') : '';\n  \t}\n\n  \t// SVG complains about empty path strings\n  \treturn str || 'M0 0';\n  }\n\n  /*\r\n   * @namespace Browser\r\n   * @aka L.Browser\r\n   *\r\n   * A namespace with static properties for browser/feature detection used by Leaflet internally.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * if (L.Browser.ielt9) {\r\n   *   alert('Upgrade your browser, dude!');\r\n   * }\r\n   * ```\r\n   */\r\n\r\n  var style = document.documentElement.style;\r\n\r\n  // @property ie: Boolean; `true` for all Internet Explorer versions (not Edge).\r\n  var ie = 'ActiveXObject' in window;\r\n\r\n  // @property ielt9: Boolean; `true` for Internet Explorer versions less than 9.\r\n  var ielt9 = ie && !document.addEventListener;\r\n\r\n  // @property edge: Boolean; `true` for the Edge web browser.\r\n  var edge = 'msLaunchUri' in navigator && !('documentMode' in document);\r\n\r\n  // @property webkit: Boolean;\r\n  // `true` for webkit-based browsers like Chrome and Safari (including mobile versions).\r\n  var webkit = userAgentContains('webkit');\r\n\r\n  // @property android: Boolean\r\n  // **Deprecated.** `true` for any browser running on an Android platform.\r\n  var android = userAgentContains('android');\r\n\r\n  // @property android23: Boolean; **Deprecated.** `true` for browsers running on Android 2 or Android 3.\r\n  var android23 = userAgentContains('android 2') || userAgentContains('android 3');\r\n\r\n  /* See https://stackoverflow.com/a/17961266 for details on detecting stock Android */\r\n  var webkitVer = parseInt(/WebKit\\/([0-9]+)|$/.exec(navigator.userAgent)[1], 10); // also matches AppleWebKit\r\n  // @property androidStock: Boolean; **Deprecated.** `true` for the Android stock browser (i.e. not Chrome)\r\n  var androidStock = android && userAgentContains('Google') && webkitVer < 537 && !('AudioNode' in window);\r\n\r\n  // @property opera: Boolean; `true` for the Opera browser\r\n  var opera = !!window.opera;\r\n\r\n  // @property chrome: Boolean; `true` for the Chrome browser.\r\n  var chrome = !edge && userAgentContains('chrome');\r\n\r\n  // @property gecko: Boolean; `true` for gecko-based browsers like Firefox.\r\n  var gecko = userAgentContains('gecko') && !webkit && !opera && !ie;\r\n\r\n  // @property safari: Boolean; `true` for the Safari browser.\r\n  var safari = !chrome && userAgentContains('safari');\r\n\r\n  var phantom = userAgentContains('phantom');\r\n\r\n  // @property opera12: Boolean\r\n  // `true` for the Opera browser supporting CSS transforms (version 12 or later).\r\n  var opera12 = 'OTransition' in style;\r\n\r\n  // @property win: Boolean; `true` when the browser is running in a Windows platform\r\n  var win = navigator.platform.indexOf('Win') === 0;\r\n\r\n  // @property ie3d: Boolean; `true` for all Internet Explorer versions supporting CSS transforms.\r\n  var ie3d = ie && ('transition' in style);\r\n\r\n  // @property webkit3d: Boolean; `true` for webkit-based browsers supporting CSS transforms.\r\n  var webkit3d = ('WebKitCSSMatrix' in window) && ('m11' in new window.WebKitCSSMatrix()) && !android23;\r\n\r\n  // @property gecko3d: Boolean; `true` for gecko-based browsers supporting CSS transforms.\r\n  var gecko3d = 'MozPerspective' in style;\r\n\r\n  // @property any3d: Boolean\r\n  // `true` for all browsers supporting CSS transforms.\r\n  var any3d = !window.L_DISABLE_3D && (ie3d || webkit3d || gecko3d) && !opera12 && !phantom;\r\n\r\n  // @property mobile: Boolean; `true` for all browsers running in a mobile device.\r\n  var mobile = typeof orientation !== 'undefined' || userAgentContains('mobile');\r\n\r\n  // @property mobileWebkit: Boolean; `true` for all webkit-based browsers in a mobile device.\r\n  var mobileWebkit = mobile && webkit;\r\n\r\n  // @property mobileWebkit3d: Boolean\r\n  // `true` for all webkit-based browsers in a mobile device supporting CSS transforms.\r\n  var mobileWebkit3d = mobile && webkit3d;\r\n\r\n  // @property msPointer: Boolean\r\n  // `true` for browsers implementing the Microsoft touch events model (notably IE10).\r\n  var msPointer = !window.PointerEvent && window.MSPointerEvent;\r\n\r\n  // @property pointer: Boolean\r\n  // `true` for all browsers supporting [pointer events](https://msdn.microsoft.com/en-us/library/dn433244%28v=vs.85%29.aspx).\r\n  var pointer = !!(window.PointerEvent || msPointer);\r\n\r\n  // @property touchNative: Boolean\r\n  // `true` for all browsers supporting [touch events](https://developer.mozilla.org/docs/Web/API/Touch_events).\r\n  // **This does not necessarily mean** that the browser is running in a computer with\r\n  // a touchscreen, it only means that the browser is capable of understanding\r\n  // touch events.\r\n  var touchNative = 'ontouchstart' in window || !!window.TouchEvent;\r\n\r\n  // @property touch: Boolean\r\n  // `true` for all browsers supporting either [touch](#browser-touch) or [pointer](#browser-pointer) events.\r\n  // Note: pointer events will be preferred (if available), and processed for all `touch*` listeners.\r\n  var touch = !window.L_NO_TOUCH && (touchNative || pointer);\r\n\r\n  // @property mobileOpera: Boolean; `true` for the Opera browser in a mobile device.\r\n  var mobileOpera = mobile && opera;\r\n\r\n  // @property mobileGecko: Boolean\r\n  // `true` for gecko-based browsers running in a mobile device.\r\n  var mobileGecko = mobile && gecko;\r\n\r\n  // @property retina: Boolean\r\n  // `true` for browsers on a high-resolution \"retina\" screen or on any screen when browser's display zoom is more than 100%.\r\n  var retina = (window.devicePixelRatio || (window.screen.deviceXDPI / window.screen.logicalXDPI)) > 1;\r\n\r\n  // @property passiveEvents: Boolean\r\n  // `true` for browsers that support passive events.\r\n  var passiveEvents = (function () {\r\n  \tvar supportsPassiveOption = false;\r\n  \ttry {\r\n  \t\tvar opts = Object.defineProperty({}, 'passive', {\r\n  \t\t\tget: function () { // eslint-disable-line getter-return\r\n  \t\t\t\tsupportsPassiveOption = true;\r\n  \t\t\t}\r\n  \t\t});\r\n  \t\twindow.addEventListener('testPassiveEventSupport', falseFn, opts);\r\n  \t\twindow.removeEventListener('testPassiveEventSupport', falseFn, opts);\r\n  \t} catch (e) {\r\n  \t\t// Errors can safely be ignored since this is only a browser support test.\r\n  \t}\r\n  \treturn supportsPassiveOption;\r\n  }());\r\n\r\n  // @property canvas: Boolean\r\n  // `true` when the browser supports [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\r\n  var canvas$1 = (function () {\r\n  \treturn !!document.createElement('canvas').getContext;\r\n  }());\r\n\r\n  // @property svg: Boolean\r\n  // `true` when the browser supports [SVG](https://developer.mozilla.org/docs/Web/SVG).\r\n  var svg$1 = !!(document.createElementNS && svgCreate('svg').createSVGRect);\r\n\r\n  var inlineSvg = !!svg$1 && (function () {\r\n  \tvar div = document.createElement('div');\r\n  \tdiv.innerHTML = '<svg/>';\r\n  \treturn (div.firstChild && div.firstChild.namespaceURI) === 'http://www.w3.org/2000/svg';\r\n  })();\r\n\r\n  // @property vml: Boolean\r\n  // `true` if the browser supports [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language).\r\n  var vml = !svg$1 && (function () {\r\n  \ttry {\r\n  \t\tvar div = document.createElement('div');\r\n  \t\tdiv.innerHTML = '<v:shape adj=\"1\"/>';\r\n\r\n  \t\tvar shape = div.firstChild;\r\n  \t\tshape.style.behavior = 'url(#default#VML)';\r\n\r\n  \t\treturn shape && (typeof shape.adj === 'object');\r\n\r\n  \t} catch (e) {\r\n  \t\treturn false;\r\n  \t}\r\n  }());\r\n\r\n\r\n  // @property mac: Boolean; `true` when the browser is running in a Mac platform\r\n  var mac = navigator.platform.indexOf('Mac') === 0;\r\n\r\n  // @property mac: Boolean; `true` when the browser is running in a Linux platform\r\n  var linux = navigator.platform.indexOf('Linux') === 0;\r\n\r\n  function userAgentContains(str) {\r\n  \treturn navigator.userAgent.toLowerCase().indexOf(str) >= 0;\r\n  }\r\n\r\n\r\n  var Browser = {\r\n  \tie: ie,\r\n  \tielt9: ielt9,\r\n  \tedge: edge,\r\n  \twebkit: webkit,\r\n  \tandroid: android,\r\n  \tandroid23: android23,\r\n  \tandroidStock: androidStock,\r\n  \topera: opera,\r\n  \tchrome: chrome,\r\n  \tgecko: gecko,\r\n  \tsafari: safari,\r\n  \tphantom: phantom,\r\n  \topera12: opera12,\r\n  \twin: win,\r\n  \tie3d: ie3d,\r\n  \twebkit3d: webkit3d,\r\n  \tgecko3d: gecko3d,\r\n  \tany3d: any3d,\r\n  \tmobile: mobile,\r\n  \tmobileWebkit: mobileWebkit,\r\n  \tmobileWebkit3d: mobileWebkit3d,\r\n  \tmsPointer: msPointer,\r\n  \tpointer: pointer,\r\n  \ttouch: touch,\r\n  \ttouchNative: touchNative,\r\n  \tmobileOpera: mobileOpera,\r\n  \tmobileGecko: mobileGecko,\r\n  \tretina: retina,\r\n  \tpassiveEvents: passiveEvents,\r\n  \tcanvas: canvas$1,\r\n  \tsvg: svg$1,\r\n  \tvml: vml,\r\n  \tinlineSvg: inlineSvg,\r\n  \tmac: mac,\r\n  \tlinux: linux\r\n  };\n\n  /*\n   * Extends L.DomEvent to provide touch support for Internet Explorer and Windows-based devices.\n   */\n\n  var POINTER_DOWN =   Browser.msPointer ? 'MSPointerDown'   : 'pointerdown';\n  var POINTER_MOVE =   Browser.msPointer ? 'MSPointerMove'   : 'pointermove';\n  var POINTER_UP =     Browser.msPointer ? 'MSPointerUp'     : 'pointerup';\n  var POINTER_CANCEL = Browser.msPointer ? 'MSPointerCancel' : 'pointercancel';\n  var pEvent = {\n  \ttouchstart  : POINTER_DOWN,\n  \ttouchmove   : POINTER_MOVE,\n  \ttouchend    : POINTER_UP,\n  \ttouchcancel : POINTER_CANCEL\n  };\n  var handle = {\n  \ttouchstart  : _onPointerStart,\n  \ttouchmove   : _handlePointer,\n  \ttouchend    : _handlePointer,\n  \ttouchcancel : _handlePointer\n  };\n  var _pointers = {};\n  var _pointerDocListener = false;\n\n  // Provides a touch events wrapper for (ms)pointer events.\n  // ref https://www.w3.org/TR/pointerevents/ https://www.w3.org/Bugs/Public/show_bug.cgi?id=22890\n\n  function addPointerListener(obj, type, handler) {\n  \tif (type === 'touchstart') {\n  \t\t_addPointerDocListener();\n  \t}\n  \tif (!handle[type]) {\n  \t\tconsole.warn('wrong event specified:', type);\n  \t\treturn falseFn;\n  \t}\n  \thandler = handle[type].bind(this, handler);\n  \tobj.addEventListener(pEvent[type], handler, false);\n  \treturn handler;\n  }\n\n  function removePointerListener(obj, type, handler) {\n  \tif (!pEvent[type]) {\n  \t\tconsole.warn('wrong event specified:', type);\n  \t\treturn;\n  \t}\n  \tobj.removeEventListener(pEvent[type], handler, false);\n  }\n\n  function _globalPointerDown(e) {\n  \t_pointers[e.pointerId] = e;\n  }\n\n  function _globalPointerMove(e) {\n  \tif (_pointers[e.pointerId]) {\n  \t\t_pointers[e.pointerId] = e;\n  \t}\n  }\n\n  function _globalPointerUp(e) {\n  \tdelete _pointers[e.pointerId];\n  }\n\n  function _addPointerDocListener() {\n  \t// need to keep track of what pointers and how many are active to provide e.touches emulation\n  \tif (!_pointerDocListener) {\n  \t\t// we listen document as any drags that end by moving the touch off the screen get fired there\n  \t\tdocument.addEventListener(POINTER_DOWN, _globalPointerDown, true);\n  \t\tdocument.addEventListener(POINTER_MOVE, _globalPointerMove, true);\n  \t\tdocument.addEventListener(POINTER_UP, _globalPointerUp, true);\n  \t\tdocument.addEventListener(POINTER_CANCEL, _globalPointerUp, true);\n\n  \t\t_pointerDocListener = true;\n  \t}\n  }\n\n  function _handlePointer(handler, e) {\n  \tif (e.pointerType === (e.MSPOINTER_TYPE_MOUSE || 'mouse')) { return; }\n\n  \te.touches = [];\n  \tfor (var i in _pointers) {\n  \t\te.touches.push(_pointers[i]);\n  \t}\n  \te.changedTouches = [e];\n\n  \thandler(e);\n  }\n\n  function _onPointerStart(handler, e) {\n  \t// IE10 specific: MsTouch needs preventDefault. See #2000\n  \tif (e.MSPOINTER_TYPE_TOUCH && e.pointerType === e.MSPOINTER_TYPE_TOUCH) {\n  \t\tpreventDefault(e);\n  \t}\n  \t_handlePointer(handler, e);\n  }\n\n  /*\r\n   * Extends the event handling code with double tap support for mobile browsers.\r\n   *\r\n   * Note: currently most browsers fire native dblclick, with only a few exceptions\r\n   * (see https://github.com/Leaflet/Leaflet/issues/7012#issuecomment-595087386)\r\n   */\r\n\r\n  function makeDblclick(event) {\r\n  \t// in modern browsers `type` cannot be just overridden:\r\n  \t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Getter_only\r\n  \tvar newEvent = {},\r\n  \t    prop, i;\r\n  \tfor (i in event) {\r\n  \t\tprop = event[i];\r\n  \t\tnewEvent[i] = prop && prop.bind ? prop.bind(event) : prop;\r\n  \t}\r\n  \tevent = newEvent;\r\n  \tnewEvent.type = 'dblclick';\r\n  \tnewEvent.detail = 2;\r\n  \tnewEvent.isTrusted = false;\r\n  \tnewEvent._simulated = true; // for debug purposes\r\n  \treturn newEvent;\r\n  }\r\n\r\n  var delay = 200;\r\n  function addDoubleTapListener(obj, handler) {\r\n  \t// Most browsers handle double tap natively\r\n  \tobj.addEventListener('dblclick', handler);\r\n\r\n  \t// On some platforms the browser doesn't fire native dblclicks for touch events.\r\n  \t// It seems that in all such cases `detail` property of `click` event is always `1`.\r\n  \t// So here we rely on that fact to avoid excessive 'dblclick' simulation when not needed.\r\n  \tvar last = 0,\r\n  \t    detail;\r\n  \tfunction simDblclick(e) {\r\n  \t\tif (e.detail !== 1) {\r\n  \t\t\tdetail = e.detail; // keep in sync to avoid false dblclick in some cases\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (e.pointerType === 'mouse' ||\r\n  \t\t\t(e.sourceCapabilities && !e.sourceCapabilities.firesTouchEvents)) {\r\n\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\t// When clicking on an <input>, the browser generates a click on its\r\n  \t\t// <label> (and vice versa) triggering two clicks in quick succession.\r\n  \t\t// This ignores clicks on elements which are a label with a 'for'\r\n  \t\t// attribute (or children of such a label), but not children of\r\n  \t\t// a <input>.\r\n  \t\tvar path = getPropagationPath(e);\r\n  \t\tif (path.some(function (el) {\r\n  \t\t\treturn el instanceof HTMLLabelElement && el.attributes.for;\r\n  \t\t}) &&\r\n  \t\t\t!path.some(function (el) {\r\n  \t\t\t\treturn (\r\n  \t\t\t\t\tel instanceof HTMLInputElement ||\r\n  \t\t\t\t\tel instanceof HTMLSelectElement\r\n  \t\t\t\t);\r\n  \t\t\t})\r\n  \t\t) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tvar now = Date.now();\r\n  \t\tif (now - last <= delay) {\r\n  \t\t\tdetail++;\r\n  \t\t\tif (detail === 2) {\r\n  \t\t\t\thandler(makeDblclick(e));\r\n  \t\t\t}\r\n  \t\t} else {\r\n  \t\t\tdetail = 1;\r\n  \t\t}\r\n  \t\tlast = now;\r\n  \t}\r\n\r\n  \tobj.addEventListener('click', simDblclick);\r\n\r\n  \treturn {\r\n  \t\tdblclick: handler,\r\n  \t\tsimDblclick: simDblclick\r\n  \t};\r\n  }\r\n\r\n  function removeDoubleTapListener(obj, handlers) {\r\n  \tobj.removeEventListener('dblclick', handlers.dblclick);\r\n  \tobj.removeEventListener('click', handlers.simDblclick);\r\n  }\n\n  /*\r\n   * @namespace DomUtil\r\n   *\r\n   * Utility functions to work with the [DOM](https://developer.mozilla.org/docs/Web/API/Document_Object_Model)\r\n   * tree, used by Leaflet internally.\r\n   *\r\n   * Most functions expecting or returning a `HTMLElement` also work for\r\n   * SVG elements. The only difference is that classes refer to CSS classes\r\n   * in HTML and SVG classes in SVG.\r\n   */\r\n\r\n\r\n  // @property TRANSFORM: String\r\n  // Vendor-prefixed transform style name (e.g. `'webkitTransform'` for WebKit).\r\n  var TRANSFORM = testProp(\r\n  \t['transform', 'webkitTransform', 'OTransform', 'MozTransform', 'msTransform']);\r\n\r\n  // webkitTransition comes first because some browser versions that drop vendor prefix don't do\r\n  // the same for the transitionend event, in particular the Android 4.1 stock browser\r\n\r\n  // @property TRANSITION: String\r\n  // Vendor-prefixed transition style name.\r\n  var TRANSITION = testProp(\r\n  \t['webkitTransition', 'transition', 'OTransition', 'MozTransition', 'msTransition']);\r\n\r\n  // @property TRANSITION_END: String\r\n  // Vendor-prefixed transitionend event name.\r\n  var TRANSITION_END =\r\n  \tTRANSITION === 'webkitTransition' || TRANSITION === 'OTransition' ? TRANSITION + 'End' : 'transitionend';\r\n\r\n\r\n  // @function get(id: String|HTMLElement): HTMLElement\r\n  // Returns an element given its DOM id, or returns the element itself\r\n  // if it was passed directly.\r\n  function get(id) {\r\n  \treturn typeof id === 'string' ? document.getElementById(id) : id;\r\n  }\r\n\r\n  // @function getStyle(el: HTMLElement, styleAttrib: String): String\r\n  // Returns the value for a certain style attribute on an element,\r\n  // including computed values or values set through CSS.\r\n  function getStyle(el, style) {\r\n  \tvar value = el.style[style] || (el.currentStyle && el.currentStyle[style]);\r\n\r\n  \tif ((!value || value === 'auto') && document.defaultView) {\r\n  \t\tvar css = document.defaultView.getComputedStyle(el, null);\r\n  \t\tvalue = css ? css[style] : null;\r\n  \t}\r\n  \treturn value === 'auto' ? null : value;\r\n  }\r\n\r\n  // @function create(tagName: String, className?: String, container?: HTMLElement): HTMLElement\r\n  // Creates an HTML element with `tagName`, sets its class to `className`, and optionally appends it to `container` element.\r\n  function create$1(tagName, className, container) {\r\n  \tvar el = document.createElement(tagName);\r\n  \tel.className = className || '';\r\n\r\n  \tif (container) {\r\n  \t\tcontainer.appendChild(el);\r\n  \t}\r\n  \treturn el;\r\n  }\r\n\r\n  // @function remove(el: HTMLElement)\r\n  // Removes `el` from its parent element\r\n  function remove(el) {\r\n  \tvar parent = el.parentNode;\r\n  \tif (parent) {\r\n  \t\tparent.removeChild(el);\r\n  \t}\r\n  }\r\n\r\n  // @function empty(el: HTMLElement)\r\n  // Removes all of `el`'s children elements from `el`\r\n  function empty(el) {\r\n  \twhile (el.firstChild) {\r\n  \t\tel.removeChild(el.firstChild);\r\n  \t}\r\n  }\r\n\r\n  // @function toFront(el: HTMLElement)\r\n  // Makes `el` the last child of its parent, so it renders in front of the other children.\r\n  function toFront(el) {\r\n  \tvar parent = el.parentNode;\r\n  \tif (parent && parent.lastChild !== el) {\r\n  \t\tparent.appendChild(el);\r\n  \t}\r\n  }\r\n\r\n  // @function toBack(el: HTMLElement)\r\n  // Makes `el` the first child of its parent, so it renders behind the other children.\r\n  function toBack(el) {\r\n  \tvar parent = el.parentNode;\r\n  \tif (parent && parent.firstChild !== el) {\r\n  \t\tparent.insertBefore(el, parent.firstChild);\r\n  \t}\r\n  }\r\n\r\n  // @function hasClass(el: HTMLElement, name: String): Boolean\r\n  // Returns `true` if the element's class attribute contains `name`.\r\n  function hasClass(el, name) {\r\n  \tif (el.classList !== undefined) {\r\n  \t\treturn el.classList.contains(name);\r\n  \t}\r\n  \tvar className = getClass(el);\r\n  \treturn className.length > 0 && new RegExp('(^|\\\\s)' + name + '(\\\\s|$)').test(className);\r\n  }\r\n\r\n  // @function addClass(el: HTMLElement, name: String)\r\n  // Adds `name` to the element's class attribute.\r\n  function addClass(el, name) {\r\n  \tif (el.classList !== undefined) {\r\n  \t\tvar classes = splitWords(name);\r\n  \t\tfor (var i = 0, len = classes.length; i < len; i++) {\r\n  \t\t\tel.classList.add(classes[i]);\r\n  \t\t}\r\n  \t} else if (!hasClass(el, name)) {\r\n  \t\tvar className = getClass(el);\r\n  \t\tsetClass(el, (className ? className + ' ' : '') + name);\r\n  \t}\r\n  }\r\n\r\n  // @function removeClass(el: HTMLElement, name: String)\r\n  // Removes `name` from the element's class attribute.\r\n  function removeClass(el, name) {\r\n  \tif (el.classList !== undefined) {\r\n  \t\tel.classList.remove(name);\r\n  \t} else {\r\n  \t\tsetClass(el, trim((' ' + getClass(el) + ' ').replace(' ' + name + ' ', ' ')));\r\n  \t}\r\n  }\r\n\r\n  // @function setClass(el: HTMLElement, name: String)\r\n  // Sets the element's class.\r\n  function setClass(el, name) {\r\n  \tif (el.className.baseVal === undefined) {\r\n  \t\tel.className = name;\r\n  \t} else {\r\n  \t\t// in case of SVG element\r\n  \t\tel.className.baseVal = name;\r\n  \t}\r\n  }\r\n\r\n  // @function getClass(el: HTMLElement): String\r\n  // Returns the element's class.\r\n  function getClass(el) {\r\n  \t// Check if the element is an SVGElementInstance and use the correspondingElement instead\r\n  \t// (Required for linked SVG elements in IE11.)\r\n  \tif (el.correspondingElement) {\r\n  \t\tel = el.correspondingElement;\r\n  \t}\r\n  \treturn el.className.baseVal === undefined ? el.className : el.className.baseVal;\r\n  }\r\n\r\n  // @function setOpacity(el: HTMLElement, opacity: Number)\r\n  // Set the opacity of an element (including old IE support).\r\n  // `opacity` must be a number from `0` to `1`.\r\n  function setOpacity(el, value) {\r\n  \tif ('opacity' in el.style) {\r\n  \t\tel.style.opacity = value;\r\n  \t} else if ('filter' in el.style) {\r\n  \t\t_setOpacityIE(el, value);\r\n  \t}\r\n  }\r\n\r\n  function _setOpacityIE(el, value) {\r\n  \tvar filter = false,\r\n  \t    filterName = 'DXImageTransform.Microsoft.Alpha';\r\n\r\n  \t// filters collection throws an error if we try to retrieve a filter that doesn't exist\r\n  \ttry {\r\n  \t\tfilter = el.filters.item(filterName);\r\n  \t} catch (e) {\r\n  \t\t// don't set opacity to 1 if we haven't already set an opacity,\r\n  \t\t// it isn't needed and breaks transparent pngs.\r\n  \t\tif (value === 1) { return; }\r\n  \t}\r\n\r\n  \tvalue = Math.round(value * 100);\r\n\r\n  \tif (filter) {\r\n  \t\tfilter.Enabled = (value !== 100);\r\n  \t\tfilter.Opacity = value;\r\n  \t} else {\r\n  \t\tel.style.filter += ' progid:' + filterName + '(opacity=' + value + ')';\r\n  \t}\r\n  }\r\n\r\n  // @function testProp(props: String[]): String|false\r\n  // Goes through the array of style names and returns the first name\r\n  // that is a valid style name for an element. If no such name is found,\r\n  // it returns false. Useful for vendor-prefixed styles like `transform`.\r\n  function testProp(props) {\r\n  \tvar style = document.documentElement.style;\r\n\r\n  \tfor (var i = 0; i < props.length; i++) {\r\n  \t\tif (props[i] in style) {\r\n  \t\t\treturn props[i];\r\n  \t\t}\r\n  \t}\r\n  \treturn false;\r\n  }\r\n\r\n  // @function setTransform(el: HTMLElement, offset: Point, scale?: Number)\r\n  // Resets the 3D CSS transform of `el` so it is translated by `offset` pixels\r\n  // and optionally scaled by `scale`. Does not have an effect if the\r\n  // browser doesn't support 3D CSS transforms.\r\n  function setTransform(el, offset, scale) {\r\n  \tvar pos = offset || new Point(0, 0);\r\n\r\n  \tel.style[TRANSFORM] =\r\n  \t\t(Browser.ie3d ?\r\n  \t\t\t'translate(' + pos.x + 'px,' + pos.y + 'px)' :\r\n  \t\t\t'translate3d(' + pos.x + 'px,' + pos.y + 'px,0)') +\r\n  \t\t(scale ? ' scale(' + scale + ')' : '');\r\n  }\r\n\r\n  // @function setPosition(el: HTMLElement, position: Point)\r\n  // Sets the position of `el` to coordinates specified by `position`,\r\n  // using CSS translate or top/left positioning depending on the browser\r\n  // (used by Leaflet internally to position its layers).\r\n  function setPosition(el, point) {\r\n\r\n  \t/*eslint-disable */\r\n  \tel._leaflet_pos = point;\r\n  \t/* eslint-enable */\r\n\r\n  \tif (Browser.any3d) {\r\n  \t\tsetTransform(el, point);\r\n  \t} else {\r\n  \t\tel.style.left = point.x + 'px';\r\n  \t\tel.style.top = point.y + 'px';\r\n  \t}\r\n  }\r\n\r\n  // @function getPosition(el: HTMLElement): Point\r\n  // Returns the coordinates of an element previously positioned with setPosition.\r\n  function getPosition(el) {\r\n  \t// this method is only used for elements previously positioned using setPosition,\r\n  \t// so it's safe to cache the position for performance\r\n\r\n  \treturn el._leaflet_pos || new Point(0, 0);\r\n  }\r\n\r\n  // @function disableTextSelection()\r\n  // Prevents the user from generating `selectstart` DOM events, usually generated\r\n  // when the user drags the mouse through a page with text. Used internally\r\n  // by Leaflet to override the behaviour of any click-and-drag interaction on\r\n  // the map. Affects drag interactions on the whole document.\r\n\r\n  // @function enableTextSelection()\r\n  // Cancels the effects of a previous [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection).\r\n  var disableTextSelection;\r\n  var enableTextSelection;\r\n  var _userSelect;\r\n  if ('onselectstart' in document) {\r\n  \tdisableTextSelection = function () {\r\n  \t\ton(window, 'selectstart', preventDefault);\r\n  \t};\r\n  \tenableTextSelection = function () {\r\n  \t\toff(window, 'selectstart', preventDefault);\r\n  \t};\r\n  } else {\r\n  \tvar userSelectProperty = testProp(\r\n  \t\t['userSelect', 'WebkitUserSelect', 'OUserSelect', 'MozUserSelect', 'msUserSelect']);\r\n\r\n  \tdisableTextSelection = function () {\r\n  \t\tif (userSelectProperty) {\r\n  \t\t\tvar style = document.documentElement.style;\r\n  \t\t\t_userSelect = style[userSelectProperty];\r\n  \t\t\tstyle[userSelectProperty] = 'none';\r\n  \t\t}\r\n  \t};\r\n  \tenableTextSelection = function () {\r\n  \t\tif (userSelectProperty) {\r\n  \t\t\tdocument.documentElement.style[userSelectProperty] = _userSelect;\r\n  \t\t\t_userSelect = undefined;\r\n  \t\t}\r\n  \t};\r\n  }\r\n\r\n  // @function disableImageDrag()\r\n  // As [`L.DomUtil.disableTextSelection`](#domutil-disabletextselection), but\r\n  // for `dragstart` DOM events, usually generated when the user drags an image.\r\n  function disableImageDrag() {\r\n  \ton(window, 'dragstart', preventDefault);\r\n  }\r\n\r\n  // @function enableImageDrag()\r\n  // Cancels the effects of a previous [`L.DomUtil.disableImageDrag`](#domutil-disabletextselection).\r\n  function enableImageDrag() {\r\n  \toff(window, 'dragstart', preventDefault);\r\n  }\r\n\r\n  var _outlineElement, _outlineStyle;\r\n  // @function preventOutline(el: HTMLElement)\r\n  // Makes the [outline](https://developer.mozilla.org/docs/Web/CSS/outline)\r\n  // of the element `el` invisible. Used internally by Leaflet to prevent\r\n  // focusable elements from displaying an outline when the user performs a\r\n  // drag interaction on them.\r\n  function preventOutline(element) {\r\n  \twhile (element.tabIndex === -1) {\r\n  \t\telement = element.parentNode;\r\n  \t}\r\n  \tif (!element.style) { return; }\r\n  \trestoreOutline();\r\n  \t_outlineElement = element;\r\n  \t_outlineStyle = element.style.outlineStyle;\r\n  \telement.style.outlineStyle = 'none';\r\n  \ton(window, 'keydown', restoreOutline);\r\n  }\r\n\r\n  // @function restoreOutline()\r\n  // Cancels the effects of a previous [`L.DomUtil.preventOutline`]().\r\n  function restoreOutline() {\r\n  \tif (!_outlineElement) { return; }\r\n  \t_outlineElement.style.outlineStyle = _outlineStyle;\r\n  \t_outlineElement = undefined;\r\n  \t_outlineStyle = undefined;\r\n  \toff(window, 'keydown', restoreOutline);\r\n  }\r\n\r\n  // @function getSizedParentNode(el: HTMLElement): HTMLElement\r\n  // Finds the closest parent node which size (width and height) is not null.\r\n  function getSizedParentNode(element) {\r\n  \tdo {\r\n  \t\telement = element.parentNode;\r\n  \t} while ((!element.offsetWidth || !element.offsetHeight) && element !== document.body);\r\n  \treturn element;\r\n  }\r\n\r\n  // @function getScale(el: HTMLElement): Object\r\n  // Computes the CSS scale currently applied on the element.\r\n  // Returns an object with `x` and `y` members as horizontal and vertical scales respectively,\r\n  // and `boundingClientRect` as the result of [`getBoundingClientRect()`](https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect).\r\n  function getScale(element) {\r\n  \tvar rect = element.getBoundingClientRect(); // Read-only in old browsers.\r\n\r\n  \treturn {\r\n  \t\tx: rect.width / element.offsetWidth || 1,\r\n  \t\ty: rect.height / element.offsetHeight || 1,\r\n  \t\tboundingClientRect: rect\r\n  \t};\r\n  }\n\n  var DomUtil = {\n    __proto__: null,\n    TRANSFORM: TRANSFORM,\n    TRANSITION: TRANSITION,\n    TRANSITION_END: TRANSITION_END,\n    get: get,\n    getStyle: getStyle,\n    create: create$1,\n    remove: remove,\n    empty: empty,\n    toFront: toFront,\n    toBack: toBack,\n    hasClass: hasClass,\n    addClass: addClass,\n    removeClass: removeClass,\n    setClass: setClass,\n    getClass: getClass,\n    setOpacity: setOpacity,\n    testProp: testProp,\n    setTransform: setTransform,\n    setPosition: setPosition,\n    getPosition: getPosition,\n    get disableTextSelection () { return disableTextSelection; },\n    get enableTextSelection () { return enableTextSelection; },\n    disableImageDrag: disableImageDrag,\n    enableImageDrag: enableImageDrag,\n    preventOutline: preventOutline,\n    restoreOutline: restoreOutline,\n    getSizedParentNode: getSizedParentNode,\n    getScale: getScale\n  };\n\n  /*\r\n   * @namespace DomEvent\r\n   * Utility functions to work with the [DOM events](https://developer.mozilla.org/docs/Web/API/Event), used by Leaflet internally.\r\n   */\r\n\r\n  // Inspired by John Resig, Dean Edwards and YUI addEvent implementations.\r\n\r\n  // @function on(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n  // Adds a listener function (`fn`) to a particular DOM event type of the\r\n  // element `el`. You can optionally specify the context of the listener\r\n  // (object the `this` keyword will point to). You can also pass several\r\n  // space-separated types (e.g. `'click dblclick'`).\r\n\r\n  // @alternative\r\n  // @function on(el: HTMLElement, eventMap: Object, context?: Object): this\r\n  // Adds a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n  function on(obj, types, fn, context) {\r\n\r\n  \tif (types && typeof types === 'object') {\r\n  \t\tfor (var type in types) {\r\n  \t\t\taddOne(obj, type, types[type], fn);\r\n  \t\t}\r\n  \t} else {\r\n  \t\ttypes = splitWords(types);\r\n\r\n  \t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n  \t\t\taddOne(obj, types[i], fn, context);\r\n  \t\t}\r\n  \t}\r\n\r\n  \treturn this;\r\n  }\r\n\r\n  var eventsKey = '_leaflet_events';\r\n\r\n  // @function off(el: HTMLElement, types: String, fn: Function, context?: Object): this\r\n  // Removes a previously added listener function.\r\n  // Note that if you passed a custom context to on, you must pass the same\r\n  // context to `off` in order to remove the listener.\r\n\r\n  // @alternative\r\n  // @function off(el: HTMLElement, eventMap: Object, context?: Object): this\r\n  // Removes a set of type/listener pairs, e.g. `{click: onClick, mousemove: onMouseMove}`\r\n\r\n  // @alternative\r\n  // @function off(el: HTMLElement, types: String): this\r\n  // Removes all previously added listeners of given types.\r\n\r\n  // @alternative\r\n  // @function off(el: HTMLElement): this\r\n  // Removes all previously added listeners from given HTMLElement\r\n  function off(obj, types, fn, context) {\r\n\r\n  \tif (arguments.length === 1) {\r\n  \t\tbatchRemove(obj);\r\n  \t\tdelete obj[eventsKey];\r\n\r\n  \t} else if (types && typeof types === 'object') {\r\n  \t\tfor (var type in types) {\r\n  \t\t\tremoveOne(obj, type, types[type], fn);\r\n  \t\t}\r\n\r\n  \t} else {\r\n  \t\ttypes = splitWords(types);\r\n\r\n  \t\tif (arguments.length === 2) {\r\n  \t\t\tbatchRemove(obj, function (type) {\r\n  \t\t\t\treturn indexOf(types, type) !== -1;\r\n  \t\t\t});\r\n  \t\t} else {\r\n  \t\t\tfor (var i = 0, len = types.length; i < len; i++) {\r\n  \t\t\t\tremoveOne(obj, types[i], fn, context);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t}\r\n\r\n  \treturn this;\r\n  }\r\n\r\n  function batchRemove(obj, filterFn) {\r\n  \tfor (var id in obj[eventsKey]) {\r\n  \t\tvar type = id.split(/\\d/)[0];\r\n  \t\tif (!filterFn || filterFn(type)) {\r\n  \t\t\tremoveOne(obj, type, null, null, id);\r\n  \t\t}\r\n  \t}\r\n  }\r\n\r\n  var mouseSubst = {\r\n  \tmouseenter: 'mouseover',\r\n  \tmouseleave: 'mouseout',\r\n  \twheel: !('onwheel' in window) && 'mousewheel'\r\n  };\r\n\r\n  function addOne(obj, type, fn, context) {\r\n  \tvar id = type + stamp(fn) + (context ? '_' + stamp(context) : '');\r\n\r\n  \tif (obj[eventsKey] && obj[eventsKey][id]) { return this; }\r\n\r\n  \tvar handler = function (e) {\r\n  \t\treturn fn.call(context || obj, e || window.event);\r\n  \t};\r\n\r\n  \tvar originalHandler = handler;\r\n\r\n  \tif (!Browser.touchNative && Browser.pointer && type.indexOf('touch') === 0) {\r\n  \t\t// Needs DomEvent.Pointer.js\r\n  \t\thandler = addPointerListener(obj, type, handler);\r\n\r\n  \t} else if (Browser.touch && (type === 'dblclick')) {\r\n  \t\thandler = addDoubleTapListener(obj, handler);\r\n\r\n  \t} else if ('addEventListener' in obj) {\r\n\r\n  \t\tif (type === 'touchstart' || type === 'touchmove' || type === 'wheel' ||  type === 'mousewheel') {\r\n  \t\t\tobj.addEventListener(mouseSubst[type] || type, handler, Browser.passiveEvents ? {passive: false} : false);\r\n\r\n  \t\t} else if (type === 'mouseenter' || type === 'mouseleave') {\r\n  \t\t\thandler = function (e) {\r\n  \t\t\t\te = e || window.event;\r\n  \t\t\t\tif (isExternalTarget(obj, e)) {\r\n  \t\t\t\t\toriginalHandler(e);\r\n  \t\t\t\t}\r\n  \t\t\t};\r\n  \t\t\tobj.addEventListener(mouseSubst[type], handler, false);\r\n\r\n  \t\t} else {\r\n  \t\t\tobj.addEventListener(type, originalHandler, false);\r\n  \t\t}\r\n\r\n  \t} else {\r\n  \t\tobj.attachEvent('on' + type, handler);\r\n  \t}\r\n\r\n  \tobj[eventsKey] = obj[eventsKey] || {};\r\n  \tobj[eventsKey][id] = handler;\r\n  }\r\n\r\n  function removeOne(obj, type, fn, context, id) {\r\n  \tid = id || type + stamp(fn) + (context ? '_' + stamp(context) : '');\r\n  \tvar handler = obj[eventsKey] && obj[eventsKey][id];\r\n\r\n  \tif (!handler) { return this; }\r\n\r\n  \tif (!Browser.touchNative && Browser.pointer && type.indexOf('touch') === 0) {\r\n  \t\tremovePointerListener(obj, type, handler);\r\n\r\n  \t} else if (Browser.touch && (type === 'dblclick')) {\r\n  \t\tremoveDoubleTapListener(obj, handler);\r\n\r\n  \t} else if ('removeEventListener' in obj) {\r\n\r\n  \t\tobj.removeEventListener(mouseSubst[type] || type, handler, false);\r\n\r\n  \t} else {\r\n  \t\tobj.detachEvent('on' + type, handler);\r\n  \t}\r\n\r\n  \tobj[eventsKey][id] = null;\r\n  }\r\n\r\n  // @function stopPropagation(ev: DOMEvent): this\r\n  // Stop the given event from propagation to parent elements. Used inside the listener functions:\r\n  // ```js\r\n  // L.DomEvent.on(div, 'click', function (ev) {\r\n  // \tL.DomEvent.stopPropagation(ev);\r\n  // });\r\n  // ```\r\n  function stopPropagation(e) {\r\n\r\n  \tif (e.stopPropagation) {\r\n  \t\te.stopPropagation();\r\n  \t} else if (e.originalEvent) {  // In case of Leaflet event.\r\n  \t\te.originalEvent._stopped = true;\r\n  \t} else {\r\n  \t\te.cancelBubble = true;\r\n  \t}\r\n\r\n  \treturn this;\r\n  }\r\n\r\n  // @function disableScrollPropagation(el: HTMLElement): this\r\n  // Adds `stopPropagation` to the element's `'wheel'` events (plus browser variants).\r\n  function disableScrollPropagation(el) {\r\n  \taddOne(el, 'wheel', stopPropagation);\r\n  \treturn this;\r\n  }\r\n\r\n  // @function disableClickPropagation(el: HTMLElement): this\r\n  // Adds `stopPropagation` to the element's `'click'`, `'dblclick'`, `'contextmenu'`,\r\n  // `'mousedown'` and `'touchstart'` events (plus browser variants).\r\n  function disableClickPropagation(el) {\r\n  \ton(el, 'mousedown touchstart dblclick contextmenu', stopPropagation);\r\n  \tel['_leaflet_disable_click'] = true;\r\n  \treturn this;\r\n  }\r\n\r\n  // @function preventDefault(ev: DOMEvent): this\r\n  // Prevents the default action of the DOM Event `ev` from happening (such as\r\n  // following a link in the href of the a element, or doing a POST request\r\n  // with page reload when a `<form>` is submitted).\r\n  // Use it inside listener functions.\r\n  function preventDefault(e) {\r\n  \tif (e.preventDefault) {\r\n  \t\te.preventDefault();\r\n  \t} else {\r\n  \t\te.returnValue = false;\r\n  \t}\r\n  \treturn this;\r\n  }\r\n\r\n  // @function stop(ev: DOMEvent): this\r\n  // Does `stopPropagation` and `preventDefault` at the same time.\r\n  function stop(e) {\r\n  \tpreventDefault(e);\r\n  \tstopPropagation(e);\r\n  \treturn this;\r\n  }\r\n\r\n  // @function getPropagationPath(ev: DOMEvent): Array\r\n  // Compatibility polyfill for [`Event.composedPath()`](https://developer.mozilla.org/en-US/docs/Web/API/Event/composedPath).\r\n  // Returns an array containing the `HTMLElement`s that the given DOM event\r\n  // should propagate to (if not stopped).\r\n  function getPropagationPath(ev) {\r\n  \tif (ev.composedPath) {\r\n  \t\treturn ev.composedPath();\r\n  \t}\r\n\r\n  \tvar path = [];\r\n  \tvar el = ev.target;\r\n\r\n  \twhile (el) {\r\n  \t\tpath.push(el);\r\n  \t\tel = el.parentNode;\r\n  \t}\r\n  \treturn path;\r\n  }\r\n\r\n\r\n  // @function getMousePosition(ev: DOMEvent, container?: HTMLElement): Point\r\n  // Gets normalized mouse position from a DOM event relative to the\r\n  // `container` (border excluded) or to the whole page if not specified.\r\n  function getMousePosition(e, container) {\r\n  \tif (!container) {\r\n  \t\treturn new Point(e.clientX, e.clientY);\r\n  \t}\r\n\r\n  \tvar scale = getScale(container),\r\n  \t    offset = scale.boundingClientRect; // left and top  values are in page scale (like the event clientX/Y)\r\n\r\n  \treturn new Point(\r\n  \t\t// offset.left/top values are in page scale (like clientX/Y),\r\n  \t\t// whereas clientLeft/Top (border width) values are the original values (before CSS scale applies).\r\n  \t\t(e.clientX - offset.left) / scale.x - container.clientLeft,\r\n  \t\t(e.clientY - offset.top) / scale.y - container.clientTop\r\n  \t);\r\n  }\r\n\r\n\r\n  //  except , Safari and\r\n  // We need double the scroll pixels (see #7403 and #4538) for all Browsers\r\n  // except OSX (Mac) -> 3x, Chrome running on Linux 1x\r\n\r\n  var wheelPxFactor =\r\n  \t(Browser.linux && Browser.chrome) ? window.devicePixelRatio :\r\n  \tBrowser.mac ? window.devicePixelRatio * 3 :\r\n  \twindow.devicePixelRatio > 0 ? 2 * window.devicePixelRatio : 1;\r\n  // @function getWheelDelta(ev: DOMEvent): Number\r\n  // Gets normalized wheel delta from a wheel DOM event, in vertical\r\n  // pixels scrolled (negative if scrolling down).\r\n  // Events from pointing devices without precise scrolling are mapped to\r\n  // a best guess of 60 pixels.\r\n  function getWheelDelta(e) {\r\n  \treturn (Browser.edge) ? e.wheelDeltaY / 2 : // Don't trust window-geometry-based delta\r\n  \t       (e.deltaY && e.deltaMode === 0) ? -e.deltaY / wheelPxFactor : // Pixels\r\n  \t       (e.deltaY && e.deltaMode === 1) ? -e.deltaY * 20 : // Lines\r\n  \t       (e.deltaY && e.deltaMode === 2) ? -e.deltaY * 60 : // Pages\r\n  \t       (e.deltaX || e.deltaZ) ? 0 :\t// Skip horizontal/depth wheel events\r\n  \t       e.wheelDelta ? (e.wheelDeltaY || e.wheelDelta) / 2 : // Legacy IE pixels\r\n  \t       (e.detail && Math.abs(e.detail) < 32765) ? -e.detail * 20 : // Legacy Moz lines\r\n  \t       e.detail ? e.detail / -32765 * 60 : // Legacy Moz pages\r\n  \t       0;\r\n  }\r\n\r\n  // check if element really left/entered the event target (for mouseenter/mouseleave)\r\n  function isExternalTarget(el, e) {\r\n\r\n  \tvar related = e.relatedTarget;\r\n\r\n  \tif (!related) { return true; }\r\n\r\n  \ttry {\r\n  \t\twhile (related && (related !== el)) {\r\n  \t\t\trelated = related.parentNode;\r\n  \t\t}\r\n  \t} catch (err) {\r\n  \t\treturn false;\r\n  \t}\r\n  \treturn (related !== el);\r\n  }\n\n  var DomEvent = {\n    __proto__: null,\n    on: on,\n    off: off,\n    stopPropagation: stopPropagation,\n    disableScrollPropagation: disableScrollPropagation,\n    disableClickPropagation: disableClickPropagation,\n    preventDefault: preventDefault,\n    stop: stop,\n    getPropagationPath: getPropagationPath,\n    getMousePosition: getMousePosition,\n    getWheelDelta: getWheelDelta,\n    isExternalTarget: isExternalTarget,\n    addListener: on,\n    removeListener: off\n  };\n\n  /*\n   * @class PosAnimation\n   * @aka L.PosAnimation\n   * @inherits Evented\n   * Used internally for panning animations, utilizing CSS3 Transitions for modern browsers and a timer fallback for IE6-9.\n   *\n   * @example\n   * ```js\n   * var myPositionMarker = L.marker([48.864716, 2.294694]).addTo(map);\n   *\n   * myPositionMarker.on(\"click\", function() {\n   * \tvar pos = map.latLngToLayerPoint(myPositionMarker.getLatLng());\n   * \tpos.y -= 25;\n   * \tvar fx = new L.PosAnimation();\n   *\n   * \tfx.once('end',function() {\n   * \t\tpos.y += 25;\n   * \t\tfx.run(myPositionMarker._icon, pos, 0.8);\n   * \t});\n   *\n   * \tfx.run(myPositionMarker._icon, pos, 0.3);\n   * });\n   *\n   * ```\n   *\n   * @constructor L.PosAnimation()\n   * Creates a `PosAnimation` object.\n   *\n   */\n\n  var PosAnimation = Evented.extend({\n\n  \t// @method run(el: HTMLElement, newPos: Point, duration?: Number, easeLinearity?: Number)\n  \t// Run an animation of a given element to a new position, optionally setting\n  \t// duration in seconds (`0.25` by default) and easing linearity factor (3rd\n  \t// argument of the [cubic bezier curve](https://cubic-bezier.com/#0,0,.5,1),\n  \t// `0.5` by default).\n  \trun: function (el, newPos, duration, easeLinearity) {\n  \t\tthis.stop();\n\n  \t\tthis._el = el;\n  \t\tthis._inProgress = true;\n  \t\tthis._duration = duration || 0.25;\n  \t\tthis._easeOutPower = 1 / Math.max(easeLinearity || 0.5, 0.2);\n\n  \t\tthis._startPos = getPosition(el);\n  \t\tthis._offset = newPos.subtract(this._startPos);\n  \t\tthis._startTime = +new Date();\n\n  \t\t// @event start: Event\n  \t\t// Fired when the animation starts\n  \t\tthis.fire('start');\n\n  \t\tthis._animate();\n  \t},\n\n  \t// @method stop()\n  \t// Stops the animation (if currently running).\n  \tstop: function () {\n  \t\tif (!this._inProgress) { return; }\n\n  \t\tthis._step(true);\n  \t\tthis._complete();\n  \t},\n\n  \t_animate: function () {\n  \t\t// animation loop\n  \t\tthis._animId = requestAnimFrame(this._animate, this);\n  \t\tthis._step();\n  \t},\n\n  \t_step: function (round) {\n  \t\tvar elapsed = (+new Date()) - this._startTime,\n  \t\t    duration = this._duration * 1000;\n\n  \t\tif (elapsed < duration) {\n  \t\t\tthis._runFrame(this._easeOut(elapsed / duration), round);\n  \t\t} else {\n  \t\t\tthis._runFrame(1);\n  \t\t\tthis._complete();\n  \t\t}\n  \t},\n\n  \t_runFrame: function (progress, round) {\n  \t\tvar pos = this._startPos.add(this._offset.multiplyBy(progress));\n  \t\tif (round) {\n  \t\t\tpos._round();\n  \t\t}\n  \t\tsetPosition(this._el, pos);\n\n  \t\t// @event step: Event\n  \t\t// Fired continuously during the animation.\n  \t\tthis.fire('step');\n  \t},\n\n  \t_complete: function () {\n  \t\tcancelAnimFrame(this._animId);\n\n  \t\tthis._inProgress = false;\n  \t\t// @event end: Event\n  \t\t// Fired when the animation ends.\n  \t\tthis.fire('end');\n  \t},\n\n  \t_easeOut: function (t) {\n  \t\treturn 1 - Math.pow(1 - t, this._easeOutPower);\n  \t}\n  });\n\n  /*\r\n   * @class Map\r\n   * @aka L.Map\r\n   * @inherits Evented\r\n   *\r\n   * The central class of the API  it is used to create a map on a page and manipulate it.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * // initialize the map on the \"map\" div with a given center and zoom\r\n   * var map = L.map('map', {\r\n   * \tcenter: [51.505, -0.09],\r\n   * \tzoom: 13\r\n   * });\r\n   * ```\r\n   *\r\n   */\r\n\r\n  var Map = Evented.extend({\r\n\r\n  \toptions: {\r\n  \t\t// @section Map State Options\r\n  \t\t// @option crs: CRS = L.CRS.EPSG3857\r\n  \t\t// The [Coordinate Reference System](#crs) to use. Don't change this if you're not\r\n  \t\t// sure what it means.\r\n  \t\tcrs: EPSG3857,\r\n\r\n  \t\t// @option center: LatLng = undefined\r\n  \t\t// Initial geographic center of the map\r\n  \t\tcenter: undefined,\r\n\r\n  \t\t// @option zoom: Number = undefined\r\n  \t\t// Initial map zoom level\r\n  \t\tzoom: undefined,\r\n\r\n  \t\t// @option minZoom: Number = *\r\n  \t\t// Minimum zoom level of the map.\r\n  \t\t// If not specified and at least one `GridLayer` or `TileLayer` is in the map,\r\n  \t\t// the lowest of their `minZoom` options will be used instead.\r\n  \t\tminZoom: undefined,\r\n\r\n  \t\t// @option maxZoom: Number = *\r\n  \t\t// Maximum zoom level of the map.\r\n  \t\t// If not specified and at least one `GridLayer` or `TileLayer` is in the map,\r\n  \t\t// the highest of their `maxZoom` options will be used instead.\r\n  \t\tmaxZoom: undefined,\r\n\r\n  \t\t// @option layers: Layer[] = []\r\n  \t\t// Array of layers that will be added to the map initially\r\n  \t\tlayers: [],\r\n\r\n  \t\t// @option maxBounds: LatLngBounds = null\r\n  \t\t// When this option is set, the map restricts the view to the given\r\n  \t\t// geographical bounds, bouncing the user back if the user tries to pan\r\n  \t\t// outside the view. To set the restriction dynamically, use\r\n  \t\t// [`setMaxBounds`](#map-setmaxbounds) method.\r\n  \t\tmaxBounds: undefined,\r\n\r\n  \t\t// @option renderer: Renderer = *\r\n  \t\t// The default method for drawing vector layers on the map. `L.SVG`\r\n  \t\t// or `L.Canvas` by default depending on browser support.\r\n  \t\trenderer: undefined,\r\n\r\n\r\n  \t\t// @section Animation Options\r\n  \t\t// @option zoomAnimation: Boolean = true\r\n  \t\t// Whether the map zoom animation is enabled. By default it's enabled\r\n  \t\t// in all browsers that support CSS3 Transitions except Android.\r\n  \t\tzoomAnimation: true,\r\n\r\n  \t\t// @option zoomAnimationThreshold: Number = 4\r\n  \t\t// Won't animate zoom if the zoom difference exceeds this value.\r\n  \t\tzoomAnimationThreshold: 4,\r\n\r\n  \t\t// @option fadeAnimation: Boolean = true\r\n  \t\t// Whether the tile fade animation is enabled. By default it's enabled\r\n  \t\t// in all browsers that support CSS3 Transitions except Android.\r\n  \t\tfadeAnimation: true,\r\n\r\n  \t\t// @option markerZoomAnimation: Boolean = true\r\n  \t\t// Whether markers animate their zoom with the zoom animation, if disabled\r\n  \t\t// they will disappear for the length of the animation. By default it's\r\n  \t\t// enabled in all browsers that support CSS3 Transitions except Android.\r\n  \t\tmarkerZoomAnimation: true,\r\n\r\n  \t\t// @option transform3DLimit: Number = 2^23\r\n  \t\t// Defines the maximum size of a CSS translation transform. The default\r\n  \t\t// value should not be changed unless a web browser positions layers in\r\n  \t\t// the wrong place after doing a large `panBy`.\r\n  \t\ttransform3DLimit: 8388608, // Precision limit of a 32-bit float\r\n\r\n  \t\t// @section Interaction Options\r\n  \t\t// @option zoomSnap: Number = 1\r\n  \t\t// Forces the map's zoom level to always be a multiple of this, particularly\r\n  \t\t// right after a [`fitBounds()`](#map-fitbounds) or a pinch-zoom.\r\n  \t\t// By default, the zoom level snaps to the nearest integer; lower values\r\n  \t\t// (e.g. `0.5` or `0.1`) allow for greater granularity. A value of `0`\r\n  \t\t// means the zoom level will not be snapped after `fitBounds` or a pinch-zoom.\r\n  \t\tzoomSnap: 1,\r\n\r\n  \t\t// @option zoomDelta: Number = 1\r\n  \t\t// Controls how much the map's zoom level will change after a\r\n  \t\t// [`zoomIn()`](#map-zoomin), [`zoomOut()`](#map-zoomout), pressing `+`\r\n  \t\t// or `-` on the keyboard, or using the [zoom controls](#control-zoom).\r\n  \t\t// Values smaller than `1` (e.g. `0.5`) allow for greater granularity.\r\n  \t\tzoomDelta: 1,\r\n\r\n  \t\t// @option trackResize: Boolean = true\r\n  \t\t// Whether the map automatically handles browser window resize to update itself.\r\n  \t\ttrackResize: true\r\n  \t},\r\n\r\n  \tinitialize: function (id, options) { // (HTMLElement or String, Object)\r\n  \t\toptions = setOptions(this, options);\r\n\r\n  \t\t// Make sure to assign internal flags at the beginning,\r\n  \t\t// to avoid inconsistent state in some edge cases.\r\n  \t\tthis._handlers = [];\r\n  \t\tthis._layers = {};\r\n  \t\tthis._zoomBoundLayers = {};\r\n  \t\tthis._sizeChanged = true;\r\n\r\n  \t\tthis._initContainer(id);\r\n  \t\tthis._initLayout();\r\n\r\n  \t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\r\n  \t\tthis._onResize = bind(this._onResize, this);\r\n\r\n  \t\tthis._initEvents();\r\n\r\n  \t\tif (options.maxBounds) {\r\n  \t\t\tthis.setMaxBounds(options.maxBounds);\r\n  \t\t}\r\n\r\n  \t\tif (options.zoom !== undefined) {\r\n  \t\t\tthis._zoom = this._limitZoom(options.zoom);\r\n  \t\t}\r\n\r\n  \t\tif (options.center && options.zoom !== undefined) {\r\n  \t\t\tthis.setView(toLatLng(options.center), options.zoom, {reset: true});\r\n  \t\t}\r\n\r\n  \t\tthis.callInitHooks();\r\n\r\n  \t\t// don't animate on browsers without hardware-accelerated transitions or old Android/Opera\r\n  \t\tthis._zoomAnimated = TRANSITION && Browser.any3d && !Browser.mobileOpera &&\r\n  \t\t\t\tthis.options.zoomAnimation;\r\n\r\n  \t\t// zoom transitions run with the same duration for all layers, so if one of transitionend events\r\n  \t\t// happens after starting zoom animation (propagating to the map pane), we know that it ended globally\r\n  \t\tif (this._zoomAnimated) {\r\n  \t\t\tthis._createAnimProxy();\r\n  \t\t\ton(this._proxy, TRANSITION_END, this._catchTransitionEnd, this);\r\n  \t\t}\r\n\r\n  \t\tthis._addLayers(this.options.layers);\r\n  \t},\r\n\r\n\r\n  \t// @section Methods for modifying map state\r\n\r\n  \t// @method setView(center: LatLng, zoom: Number, options?: Zoom/pan options): this\r\n  \t// Sets the view of the map (geographical center and zoom) with the given\r\n  \t// animation options.\r\n  \tsetView: function (center, zoom, options) {\r\n\r\n  \t\tzoom = zoom === undefined ? this._zoom : this._limitZoom(zoom);\r\n  \t\tcenter = this._limitCenter(toLatLng(center), zoom, this.options.maxBounds);\r\n  \t\toptions = options || {};\r\n\r\n  \t\tthis._stop();\r\n\r\n  \t\tif (this._loaded && !options.reset && options !== true) {\r\n\r\n  \t\t\tif (options.animate !== undefined) {\r\n  \t\t\t\toptions.zoom = extend({animate: options.animate}, options.zoom);\r\n  \t\t\t\toptions.pan = extend({animate: options.animate, duration: options.duration}, options.pan);\r\n  \t\t\t}\r\n\r\n  \t\t\t// try animating pan or zoom\r\n  \t\t\tvar moved = (this._zoom !== zoom) ?\r\n  \t\t\t\tthis._tryAnimatedZoom && this._tryAnimatedZoom(center, zoom, options.zoom) :\r\n  \t\t\t\tthis._tryAnimatedPan(center, options.pan);\r\n\r\n  \t\t\tif (moved) {\r\n  \t\t\t\t// prevent resize handler call, the view will refresh after animation anyway\r\n  \t\t\t\tclearTimeout(this._sizeTimer);\r\n  \t\t\t\treturn this;\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\t// animation didn't start, just reset the map view\r\n  \t\tthis._resetView(center, zoom, options.pan && options.pan.noMoveStart);\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method setZoom(zoom: Number, options?: Zoom/pan options): this\r\n  \t// Sets the zoom of the map.\r\n  \tsetZoom: function (zoom, options) {\r\n  \t\tif (!this._loaded) {\r\n  \t\t\tthis._zoom = zoom;\r\n  \t\t\treturn this;\r\n  \t\t}\r\n  \t\treturn this.setView(this.getCenter(), zoom, {zoom: options});\r\n  \t},\r\n\r\n  \t// @method zoomIn(delta?: Number, options?: Zoom options): this\r\n  \t// Increases the zoom of the map by `delta` ([`zoomDelta`](#map-zoomdelta) by default).\r\n  \tzoomIn: function (delta, options) {\r\n  \t\tdelta = delta || (Browser.any3d ? this.options.zoomDelta : 1);\r\n  \t\treturn this.setZoom(this._zoom + delta, options);\r\n  \t},\r\n\r\n  \t// @method zoomOut(delta?: Number, options?: Zoom options): this\r\n  \t// Decreases the zoom of the map by `delta` ([`zoomDelta`](#map-zoomdelta) by default).\r\n  \tzoomOut: function (delta, options) {\r\n  \t\tdelta = delta || (Browser.any3d ? this.options.zoomDelta : 1);\r\n  \t\treturn this.setZoom(this._zoom - delta, options);\r\n  \t},\r\n\r\n  \t// @method setZoomAround(latlng: LatLng, zoom: Number, options: Zoom options): this\r\n  \t// Zooms the map while keeping a specified geographical point on the map\r\n  \t// stationary (e.g. used internally for scroll zoom and double-click zoom).\r\n  \t// @alternative\r\n  \t// @method setZoomAround(offset: Point, zoom: Number, options: Zoom options): this\r\n  \t// Zooms the map while keeping a specified pixel on the map (relative to the top-left corner) stationary.\r\n  \tsetZoomAround: function (latlng, zoom, options) {\r\n  \t\tvar scale = this.getZoomScale(zoom),\r\n  \t\t    viewHalf = this.getSize().divideBy(2),\r\n  \t\t    containerPoint = latlng instanceof Point ? latlng : this.latLngToContainerPoint(latlng),\r\n\r\n  \t\t    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\r\n  \t\t    newCenter = this.containerPointToLatLng(viewHalf.add(centerOffset));\r\n\r\n  \t\treturn this.setView(newCenter, zoom, {zoom: options});\r\n  \t},\r\n\r\n  \t_getBoundsCenterZoom: function (bounds, options) {\r\n\r\n  \t\toptions = options || {};\r\n  \t\tbounds = bounds.getBounds ? bounds.getBounds() : toLatLngBounds(bounds);\r\n\r\n  \t\tvar paddingTL = toPoint(options.paddingTopLeft || options.padding || [0, 0]),\r\n  \t\t    paddingBR = toPoint(options.paddingBottomRight || options.padding || [0, 0]),\r\n\r\n  \t\t    zoom = this.getBoundsZoom(bounds, false, paddingTL.add(paddingBR));\r\n\r\n  \t\tzoom = (typeof options.maxZoom === 'number') ? Math.min(options.maxZoom, zoom) : zoom;\r\n\r\n  \t\tif (zoom === Infinity) {\r\n  \t\t\treturn {\r\n  \t\t\t\tcenter: bounds.getCenter(),\r\n  \t\t\t\tzoom: zoom\r\n  \t\t\t};\r\n  \t\t}\r\n\r\n  \t\tvar paddingOffset = paddingBR.subtract(paddingTL).divideBy(2),\r\n\r\n  \t\t    swPoint = this.project(bounds.getSouthWest(), zoom),\r\n  \t\t    nePoint = this.project(bounds.getNorthEast(), zoom),\r\n  \t\t    center = this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset), zoom);\r\n\r\n  \t\treturn {\r\n  \t\t\tcenter: center,\r\n  \t\t\tzoom: zoom\r\n  \t\t};\r\n  \t},\r\n\r\n  \t// @method fitBounds(bounds: LatLngBounds, options?: fitBounds options): this\r\n  \t// Sets a map view that contains the given geographical bounds with the\r\n  \t// maximum zoom level possible.\r\n  \tfitBounds: function (bounds, options) {\r\n\r\n  \t\tbounds = toLatLngBounds(bounds);\r\n\r\n  \t\tif (!bounds.isValid()) {\r\n  \t\t\tthrow new Error('Bounds are not valid.');\r\n  \t\t}\r\n\r\n  \t\tvar target = this._getBoundsCenterZoom(bounds, options);\r\n  \t\treturn this.setView(target.center, target.zoom, options);\r\n  \t},\r\n\r\n  \t// @method fitWorld(options?: fitBounds options): this\r\n  \t// Sets a map view that mostly contains the whole world with the maximum\r\n  \t// zoom level possible.\r\n  \tfitWorld: function (options) {\r\n  \t\treturn this.fitBounds([[-90, -180], [90, 180]], options);\r\n  \t},\r\n\r\n  \t// @method panTo(latlng: LatLng, options?: Pan options): this\r\n  \t// Pans the map to a given center.\r\n  \tpanTo: function (center, options) { // (LatLng)\r\n  \t\treturn this.setView(center, this._zoom, {pan: options});\r\n  \t},\r\n\r\n  \t// @method panBy(offset: Point, options?: Pan options): this\r\n  \t// Pans the map by a given number of pixels (animated).\r\n  \tpanBy: function (offset, options) {\r\n  \t\toffset = toPoint(offset).round();\r\n  \t\toptions = options || {};\r\n\r\n  \t\tif (!offset.x && !offset.y) {\r\n  \t\t\treturn this.fire('moveend');\r\n  \t\t}\r\n  \t\t// If we pan too far, Chrome gets issues with tiles\r\n  \t\t// and makes them disappear or appear in the wrong place (slightly offset) #2602\r\n  \t\tif (options.animate !== true && !this.getSize().contains(offset)) {\r\n  \t\t\tthis._resetView(this.unproject(this.project(this.getCenter()).add(offset)), this.getZoom());\r\n  \t\t\treturn this;\r\n  \t\t}\r\n\r\n  \t\tif (!this._panAnim) {\r\n  \t\t\tthis._panAnim = new PosAnimation();\r\n\r\n  \t\t\tthis._panAnim.on({\r\n  \t\t\t\t'step': this._onPanTransitionStep,\r\n  \t\t\t\t'end': this._onPanTransitionEnd\r\n  \t\t\t}, this);\r\n  \t\t}\r\n\r\n  \t\t// don't fire movestart if animating inertia\r\n  \t\tif (!options.noMoveStart) {\r\n  \t\t\tthis.fire('movestart');\r\n  \t\t}\r\n\r\n  \t\t// animate pan unless animate: false specified\r\n  \t\tif (options.animate !== false) {\r\n  \t\t\taddClass(this._mapPane, 'leaflet-pan-anim');\r\n\r\n  \t\t\tvar newPos = this._getMapPanePos().subtract(offset).round();\r\n  \t\t\tthis._panAnim.run(this._mapPane, newPos, options.duration || 0.25, options.easeLinearity);\r\n  \t\t} else {\r\n  \t\t\tthis._rawPanBy(offset);\r\n  \t\t\tthis.fire('move').fire('moveend');\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method flyTo(latlng: LatLng, zoom?: Number, options?: Zoom/pan options): this\r\n  \t// Sets the view of the map (geographical center and zoom) performing a smooth\r\n  \t// pan-zoom animation.\r\n  \tflyTo: function (targetCenter, targetZoom, options) {\r\n\r\n  \t\toptions = options || {};\r\n  \t\tif (options.animate === false || !Browser.any3d) {\r\n  \t\t\treturn this.setView(targetCenter, targetZoom, options);\r\n  \t\t}\r\n\r\n  \t\tthis._stop();\r\n\r\n  \t\tvar from = this.project(this.getCenter()),\r\n  \t\t    to = this.project(targetCenter),\r\n  \t\t    size = this.getSize(),\r\n  \t\t    startZoom = this._zoom;\r\n\r\n  \t\ttargetCenter = toLatLng(targetCenter);\r\n  \t\ttargetZoom = targetZoom === undefined ? startZoom : targetZoom;\r\n\r\n  \t\tvar w0 = Math.max(size.x, size.y),\r\n  \t\t    w1 = w0 * this.getZoomScale(startZoom, targetZoom),\r\n  \t\t    u1 = (to.distanceTo(from)) || 1,\r\n  \t\t    rho = 1.42,\r\n  \t\t    rho2 = rho * rho;\r\n\r\n  \t\tfunction r(i) {\r\n  \t\t\tvar s1 = i ? -1 : 1,\r\n  \t\t\t    s2 = i ? w1 : w0,\r\n  \t\t\t    t1 = w1 * w1 - w0 * w0 + s1 * rho2 * rho2 * u1 * u1,\r\n  \t\t\t    b1 = 2 * s2 * rho2 * u1,\r\n  \t\t\t    b = t1 / b1,\r\n  \t\t\t    sq = Math.sqrt(b * b + 1) - b;\r\n\r\n  \t\t\t    // workaround for floating point precision bug when sq = 0, log = -Infinite,\r\n  \t\t\t    // thus triggering an infinite loop in flyTo\r\n  \t\t\t    var log = sq < 0.000000001 ? -18 : Math.log(sq);\r\n\r\n  \t\t\treturn log;\r\n  \t\t}\r\n\r\n  \t\tfunction sinh(n) { return (Math.exp(n) - Math.exp(-n)) / 2; }\r\n  \t\tfunction cosh(n) { return (Math.exp(n) + Math.exp(-n)) / 2; }\r\n  \t\tfunction tanh(n) { return sinh(n) / cosh(n); }\r\n\r\n  \t\tvar r0 = r(0);\r\n\r\n  \t\tfunction w(s) { return w0 * (cosh(r0) / cosh(r0 + rho * s)); }\r\n  \t\tfunction u(s) { return w0 * (cosh(r0) * tanh(r0 + rho * s) - sinh(r0)) / rho2; }\r\n\r\n  \t\tfunction easeOut(t) { return 1 - Math.pow(1 - t, 1.5); }\r\n\r\n  \t\tvar start = Date.now(),\r\n  \t\t    S = (r(1) - r0) / rho,\r\n  \t\t    duration = options.duration ? 1000 * options.duration : 1000 * S * 0.8;\r\n\r\n  \t\tfunction frame() {\r\n  \t\t\tvar t = (Date.now() - start) / duration,\r\n  \t\t\t    s = easeOut(t) * S;\r\n\r\n  \t\t\tif (t <= 1) {\r\n  \t\t\t\tthis._flyToFrame = requestAnimFrame(frame, this);\r\n\r\n  \t\t\t\tthis._move(\r\n  \t\t\t\t\tthis.unproject(from.add(to.subtract(from).multiplyBy(u(s) / u1)), startZoom),\r\n  \t\t\t\t\tthis.getScaleZoom(w0 / w(s), startZoom),\r\n  \t\t\t\t\t{flyTo: true});\r\n\r\n  \t\t\t} else {\r\n  \t\t\t\tthis\r\n  \t\t\t\t\t._move(targetCenter, targetZoom)\r\n  \t\t\t\t\t._moveEnd(true);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tthis._moveStart(true, options.noMoveStart);\r\n\r\n  \t\tframe.call(this);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method flyToBounds(bounds: LatLngBounds, options?: fitBounds options): this\r\n  \t// Sets the view of the map with a smooth animation like [`flyTo`](#map-flyto),\r\n  \t// but takes a bounds parameter like [`fitBounds`](#map-fitbounds).\r\n  \tflyToBounds: function (bounds, options) {\r\n  \t\tvar target = this._getBoundsCenterZoom(bounds, options);\r\n  \t\treturn this.flyTo(target.center, target.zoom, options);\r\n  \t},\r\n\r\n  \t// @method setMaxBounds(bounds: LatLngBounds): this\r\n  \t// Restricts the map view to the given bounds (see the [maxBounds](#map-maxbounds) option).\r\n  \tsetMaxBounds: function (bounds) {\r\n  \t\tbounds = toLatLngBounds(bounds);\r\n\r\n  \t\tif (this.listens('moveend', this._panInsideMaxBounds)) {\r\n  \t\t\tthis.off('moveend', this._panInsideMaxBounds);\r\n  \t\t}\r\n\r\n  \t\tif (!bounds.isValid()) {\r\n  \t\t\tthis.options.maxBounds = null;\r\n  \t\t\treturn this;\r\n  \t\t}\r\n\r\n  \t\tthis.options.maxBounds = bounds;\r\n\r\n  \t\tif (this._loaded) {\r\n  \t\t\tthis._panInsideMaxBounds();\r\n  \t\t}\r\n\r\n  \t\treturn this.on('moveend', this._panInsideMaxBounds);\r\n  \t},\r\n\r\n  \t// @method setMinZoom(zoom: Number): this\r\n  \t// Sets the lower limit for the available zoom levels (see the [minZoom](#map-minzoom) option).\r\n  \tsetMinZoom: function (zoom) {\r\n  \t\tvar oldZoom = this.options.minZoom;\r\n  \t\tthis.options.minZoom = zoom;\r\n\r\n  \t\tif (this._loaded && oldZoom !== zoom) {\r\n  \t\t\tthis.fire('zoomlevelschange');\r\n\r\n  \t\t\tif (this.getZoom() < this.options.minZoom) {\r\n  \t\t\t\treturn this.setZoom(zoom);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method setMaxZoom(zoom: Number): this\r\n  \t// Sets the upper limit for the available zoom levels (see the [maxZoom](#map-maxzoom) option).\r\n  \tsetMaxZoom: function (zoom) {\r\n  \t\tvar oldZoom = this.options.maxZoom;\r\n  \t\tthis.options.maxZoom = zoom;\r\n\r\n  \t\tif (this._loaded && oldZoom !== zoom) {\r\n  \t\t\tthis.fire('zoomlevelschange');\r\n\r\n  \t\t\tif (this.getZoom() > this.options.maxZoom) {\r\n  \t\t\t\treturn this.setZoom(zoom);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method panInsideBounds(bounds: LatLngBounds, options?: Pan options): this\r\n  \t// Pans the map to the closest view that would lie inside the given bounds (if it's not already), controlling the animation using the options specific, if any.\r\n  \tpanInsideBounds: function (bounds, options) {\r\n  \t\tthis._enforcingBounds = true;\r\n  \t\tvar center = this.getCenter(),\r\n  \t\t    newCenter = this._limitCenter(center, this._zoom, toLatLngBounds(bounds));\r\n\r\n  \t\tif (!center.equals(newCenter)) {\r\n  \t\t\tthis.panTo(newCenter, options);\r\n  \t\t}\r\n\r\n  \t\tthis._enforcingBounds = false;\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method panInside(latlng: LatLng, options?: padding options): this\r\n  \t// Pans the map the minimum amount to make the `latlng` visible. Use\r\n  \t// padding options to fit the display to more restricted bounds.\r\n  \t// If `latlng` is already within the (optionally padded) display bounds,\r\n  \t// the map will not be panned.\r\n  \tpanInside: function (latlng, options) {\r\n  \t\toptions = options || {};\r\n\r\n  \t\tvar paddingTL = toPoint(options.paddingTopLeft || options.padding || [0, 0]),\r\n  \t\t    paddingBR = toPoint(options.paddingBottomRight || options.padding || [0, 0]),\r\n  \t\t    pixelCenter = this.project(this.getCenter()),\r\n  \t\t    pixelPoint = this.project(latlng),\r\n  \t\t    pixelBounds = this.getPixelBounds(),\r\n  \t\t    paddedBounds = toBounds([pixelBounds.min.add(paddingTL), pixelBounds.max.subtract(paddingBR)]),\r\n  \t\t    paddedSize = paddedBounds.getSize();\r\n\r\n  \t\tif (!paddedBounds.contains(pixelPoint)) {\r\n  \t\t\tthis._enforcingBounds = true;\r\n  \t\t\tvar centerOffset = pixelPoint.subtract(paddedBounds.getCenter());\r\n  \t\t\tvar offset = paddedBounds.extend(pixelPoint).getSize().subtract(paddedSize);\r\n  \t\t\tpixelCenter.x += centerOffset.x < 0 ? -offset.x : offset.x;\r\n  \t\t\tpixelCenter.y += centerOffset.y < 0 ? -offset.y : offset.y;\r\n  \t\t\tthis.panTo(this.unproject(pixelCenter), options);\r\n  \t\t\tthis._enforcingBounds = false;\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method invalidateSize(options: Zoom/pan options): this\r\n  \t// Checks if the map container size changed and updates the map if so \r\n  \t// call it after you've changed the map size dynamically, also animating\r\n  \t// pan by default. If `options.pan` is `false`, panning will not occur.\r\n  \t// If `options.debounceMoveend` is `true`, it will delay `moveend` event so\r\n  \t// that it doesn't happen often even if the method is called many\r\n  \t// times in a row.\r\n\r\n  \t// @alternative\r\n  \t// @method invalidateSize(animate: Boolean): this\r\n  \t// Checks if the map container size changed and updates the map if so \r\n  \t// call it after you've changed the map size dynamically, also animating\r\n  \t// pan by default.\r\n  \tinvalidateSize: function (options) {\r\n  \t\tif (!this._loaded) { return this; }\r\n\r\n  \t\toptions = extend({\r\n  \t\t\tanimate: false,\r\n  \t\t\tpan: true\r\n  \t\t}, options === true ? {animate: true} : options);\r\n\r\n  \t\tvar oldSize = this.getSize();\r\n  \t\tthis._sizeChanged = true;\r\n  \t\tthis._lastCenter = null;\r\n\r\n  \t\tvar newSize = this.getSize(),\r\n  \t\t    oldCenter = oldSize.divideBy(2).round(),\r\n  \t\t    newCenter = newSize.divideBy(2).round(),\r\n  \t\t    offset = oldCenter.subtract(newCenter);\r\n\r\n  \t\tif (!offset.x && !offset.y) { return this; }\r\n\r\n  \t\tif (options.animate && options.pan) {\r\n  \t\t\tthis.panBy(offset);\r\n\r\n  \t\t} else {\r\n  \t\t\tif (options.pan) {\r\n  \t\t\t\tthis._rawPanBy(offset);\r\n  \t\t\t}\r\n\r\n  \t\t\tthis.fire('move');\r\n\r\n  \t\t\tif (options.debounceMoveend) {\r\n  \t\t\t\tclearTimeout(this._sizeTimer);\r\n  \t\t\t\tthis._sizeTimer = setTimeout(bind(this.fire, this, 'moveend'), 200);\r\n  \t\t\t} else {\r\n  \t\t\t\tthis.fire('moveend');\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\t// @section Map state change events\r\n  \t\t// @event resize: ResizeEvent\r\n  \t\t// Fired when the map is resized.\r\n  \t\treturn this.fire('resize', {\r\n  \t\t\toldSize: oldSize,\r\n  \t\t\tnewSize: newSize\r\n  \t\t});\r\n  \t},\r\n\r\n  \t// @section Methods for modifying map state\r\n  \t// @method stop(): this\r\n  \t// Stops the currently running `panTo` or `flyTo` animation, if any.\r\n  \tstop: function () {\r\n  \t\tthis.setZoom(this._limitZoom(this._zoom));\r\n  \t\tif (!this.options.zoomSnap) {\r\n  \t\t\tthis.fire('viewreset');\r\n  \t\t}\r\n  \t\treturn this._stop();\r\n  \t},\r\n\r\n  \t// @section Geolocation methods\r\n  \t// @method locate(options?: Locate options): this\r\n  \t// Tries to locate the user using the Geolocation API, firing a [`locationfound`](#map-locationfound)\r\n  \t// event with location data on success or a [`locationerror`](#map-locationerror) event on failure,\r\n  \t// and optionally sets the map view to the user's location with respect to\r\n  \t// detection accuracy (or to the world view if geolocation failed).\r\n  \t// Note that, if your page doesn't use HTTPS, this method will fail in\r\n  \t// modern browsers ([Chrome 50 and newer](https://sites.google.com/a/chromium.org/dev/Home/chromium-security/deprecating-powerful-features-on-insecure-origins))\r\n  \t// See `Locate options` for more details.\r\n  \tlocate: function (options) {\r\n\r\n  \t\toptions = this._locateOptions = extend({\r\n  \t\t\ttimeout: 10000,\r\n  \t\t\twatch: false\r\n  \t\t\t// setView: false\r\n  \t\t\t// maxZoom: <Number>\r\n  \t\t\t// maximumAge: 0\r\n  \t\t\t// enableHighAccuracy: false\r\n  \t\t}, options);\r\n\r\n  \t\tif (!('geolocation' in navigator)) {\r\n  \t\t\tthis._handleGeolocationError({\r\n  \t\t\t\tcode: 0,\r\n  \t\t\t\tmessage: 'Geolocation not supported.'\r\n  \t\t\t});\r\n  \t\t\treturn this;\r\n  \t\t}\r\n\r\n  \t\tvar onResponse = bind(this._handleGeolocationResponse, this),\r\n  \t\t    onError = bind(this._handleGeolocationError, this);\r\n\r\n  \t\tif (options.watch) {\r\n  \t\t\tthis._locationWatchId =\r\n  \t\t\t        navigator.geolocation.watchPosition(onResponse, onError, options);\r\n  \t\t} else {\r\n  \t\t\tnavigator.geolocation.getCurrentPosition(onResponse, onError, options);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method stopLocate(): this\r\n  \t// Stops watching location previously initiated by `map.locate({watch: true})`\r\n  \t// and aborts resetting the map view if map.locate was called with\r\n  \t// `{setView: true}`.\r\n  \tstopLocate: function () {\r\n  \t\tif (navigator.geolocation && navigator.geolocation.clearWatch) {\r\n  \t\t\tnavigator.geolocation.clearWatch(this._locationWatchId);\r\n  \t\t}\r\n  \t\tif (this._locateOptions) {\r\n  \t\t\tthis._locateOptions.setView = false;\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_handleGeolocationError: function (error) {\r\n  \t\tif (!this._container._leaflet_id) { return; }\r\n\r\n  \t\tvar c = error.code,\r\n  \t\t    message = error.message ||\r\n  \t\t            (c === 1 ? 'permission denied' :\r\n  \t\t            (c === 2 ? 'position unavailable' : 'timeout'));\r\n\r\n  \t\tif (this._locateOptions.setView && !this._loaded) {\r\n  \t\t\tthis.fitWorld();\r\n  \t\t}\r\n\r\n  \t\t// @section Location events\r\n  \t\t// @event locationerror: ErrorEvent\r\n  \t\t// Fired when geolocation (using the [`locate`](#map-locate) method) failed.\r\n  \t\tthis.fire('locationerror', {\r\n  \t\t\tcode: c,\r\n  \t\t\tmessage: 'Geolocation error: ' + message + '.'\r\n  \t\t});\r\n  \t},\r\n\r\n  \t_handleGeolocationResponse: function (pos) {\r\n  \t\tif (!this._container._leaflet_id) { return; }\r\n\r\n  \t\tvar lat = pos.coords.latitude,\r\n  \t\t    lng = pos.coords.longitude,\r\n  \t\t    latlng = new LatLng(lat, lng),\r\n  \t\t    bounds = latlng.toBounds(pos.coords.accuracy * 2),\r\n  \t\t    options = this._locateOptions;\r\n\r\n  \t\tif (options.setView) {\r\n  \t\t\tvar zoom = this.getBoundsZoom(bounds);\r\n  \t\t\tthis.setView(latlng, options.maxZoom ? Math.min(zoom, options.maxZoom) : zoom);\r\n  \t\t}\r\n\r\n  \t\tvar data = {\r\n  \t\t\tlatlng: latlng,\r\n  \t\t\tbounds: bounds,\r\n  \t\t\ttimestamp: pos.timestamp\r\n  \t\t};\r\n\r\n  \t\tfor (var i in pos.coords) {\r\n  \t\t\tif (typeof pos.coords[i] === 'number') {\r\n  \t\t\t\tdata[i] = pos.coords[i];\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\t// @event locationfound: LocationEvent\r\n  \t\t// Fired when geolocation (using the [`locate`](#map-locate) method)\r\n  \t\t// went successfully.\r\n  \t\tthis.fire('locationfound', data);\r\n  \t},\r\n\r\n  \t// TODO Appropriate docs section?\r\n  \t// @section Other Methods\r\n  \t// @method addHandler(name: String, HandlerClass: Function): this\r\n  \t// Adds a new `Handler` to the map, given its name and constructor function.\r\n  \taddHandler: function (name, HandlerClass) {\r\n  \t\tif (!HandlerClass) { return this; }\r\n\r\n  \t\tvar handler = this[name] = new HandlerClass(this);\r\n\r\n  \t\tthis._handlers.push(handler);\r\n\r\n  \t\tif (this.options[name]) {\r\n  \t\t\thandler.enable();\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method remove(): this\r\n  \t// Destroys the map and clears all related event listeners.\r\n  \tremove: function () {\r\n\r\n  \t\tthis._initEvents(true);\r\n  \t\tif (this.options.maxBounds) { this.off('moveend', this._panInsideMaxBounds); }\r\n\r\n  \t\tif (this._containerId !== this._container._leaflet_id) {\r\n  \t\t\tthrow new Error('Map container is being reused by another instance');\r\n  \t\t}\r\n\r\n  \t\ttry {\r\n  \t\t\t// throws error in IE6-8\r\n  \t\t\tdelete this._container._leaflet_id;\r\n  \t\t\tdelete this._containerId;\r\n  \t\t} catch (e) {\r\n  \t\t\t/*eslint-disable */\r\n  \t\t\tthis._container._leaflet_id = undefined;\r\n  \t\t\t/* eslint-enable */\r\n  \t\t\tthis._containerId = undefined;\r\n  \t\t}\r\n\r\n  \t\tif (this._locationWatchId !== undefined) {\r\n  \t\t\tthis.stopLocate();\r\n  \t\t}\r\n\r\n  \t\tthis._stop();\r\n\r\n  \t\tremove(this._mapPane);\r\n\r\n  \t\tif (this._clearControlPos) {\r\n  \t\t\tthis._clearControlPos();\r\n  \t\t}\r\n  \t\tif (this._resizeRequest) {\r\n  \t\t\tcancelAnimFrame(this._resizeRequest);\r\n  \t\t\tthis._resizeRequest = null;\r\n  \t\t}\r\n\r\n  \t\tthis._clearHandlers();\r\n\r\n  \t\tif (this._loaded) {\r\n  \t\t\t// @section Map state change events\r\n  \t\t\t// @event unload: Event\r\n  \t\t\t// Fired when the map is destroyed with [remove](#map-remove) method.\r\n  \t\t\tthis.fire('unload');\r\n  \t\t}\r\n\r\n  \t\tvar i;\r\n  \t\tfor (i in this._layers) {\r\n  \t\t\tthis._layers[i].remove();\r\n  \t\t}\r\n  \t\tfor (i in this._panes) {\r\n  \t\t\tremove(this._panes[i]);\r\n  \t\t}\r\n\r\n  \t\tthis._layers = [];\r\n  \t\tthis._panes = [];\r\n  \t\tdelete this._mapPane;\r\n  \t\tdelete this._renderer;\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @section Other Methods\r\n  \t// @method createPane(name: String, container?: HTMLElement): HTMLElement\r\n  \t// Creates a new [map pane](#map-pane) with the given name if it doesn't exist already,\r\n  \t// then returns it. The pane is created as a child of `container`, or\r\n  \t// as a child of the main map pane if not set.\r\n  \tcreatePane: function (name, container) {\r\n  \t\tvar className = 'leaflet-pane' + (name ? ' leaflet-' + name.replace('Pane', '') + '-pane' : ''),\r\n  \t\t    pane = create$1('div', className, container || this._mapPane);\r\n\r\n  \t\tif (name) {\r\n  \t\t\tthis._panes[name] = pane;\r\n  \t\t}\r\n  \t\treturn pane;\r\n  \t},\r\n\r\n  \t// @section Methods for Getting Map State\r\n\r\n  \t// @method getCenter(): LatLng\r\n  \t// Returns the geographical center of the map view\r\n  \tgetCenter: function () {\r\n  \t\tthis._checkIfLoaded();\r\n\r\n  \t\tif (this._lastCenter && !this._moved()) {\r\n  \t\t\treturn this._lastCenter.clone();\r\n  \t\t}\r\n  \t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\r\n  \t},\r\n\r\n  \t// @method getZoom(): Number\r\n  \t// Returns the current zoom level of the map view\r\n  \tgetZoom: function () {\r\n  \t\treturn this._zoom;\r\n  \t},\r\n\r\n  \t// @method getBounds(): LatLngBounds\r\n  \t// Returns the geographical bounds visible in the current map view\r\n  \tgetBounds: function () {\r\n  \t\tvar bounds = this.getPixelBounds(),\r\n  \t\t    sw = this.unproject(bounds.getBottomLeft()),\r\n  \t\t    ne = this.unproject(bounds.getTopRight());\r\n\r\n  \t\treturn new LatLngBounds(sw, ne);\r\n  \t},\r\n\r\n  \t// @method getMinZoom(): Number\r\n  \t// Returns the minimum zoom level of the map (if set in the `minZoom` option of the map or of any layers), or `0` by default.\r\n  \tgetMinZoom: function () {\r\n  \t\treturn this.options.minZoom === undefined ? this._layersMinZoom || 0 : this.options.minZoom;\r\n  \t},\r\n\r\n  \t// @method getMaxZoom(): Number\r\n  \t// Returns the maximum zoom level of the map (if set in the `maxZoom` option of the map or of any layers).\r\n  \tgetMaxZoom: function () {\r\n  \t\treturn this.options.maxZoom === undefined ?\r\n  \t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\r\n  \t\t\tthis.options.maxZoom;\r\n  \t},\r\n\r\n  \t// @method getBoundsZoom(bounds: LatLngBounds, inside?: Boolean, padding?: Point): Number\r\n  \t// Returns the maximum zoom level on which the given bounds fit to the map\r\n  \t// view in its entirety. If `inside` (optional) is set to `true`, the method\r\n  \t// instead returns the minimum zoom level on which the map view fits into\r\n  \t// the given bounds in its entirety.\r\n  \tgetBoundsZoom: function (bounds, inside, padding) { // (LatLngBounds[, Boolean, Point]) -> Number\r\n  \t\tbounds = toLatLngBounds(bounds);\r\n  \t\tpadding = toPoint(padding || [0, 0]);\r\n\r\n  \t\tvar zoom = this.getZoom() || 0,\r\n  \t\t    min = this.getMinZoom(),\r\n  \t\t    max = this.getMaxZoom(),\r\n  \t\t    nw = bounds.getNorthWest(),\r\n  \t\t    se = bounds.getSouthEast(),\r\n  \t\t    size = this.getSize().subtract(padding),\r\n  \t\t    boundsSize = toBounds(this.project(se, zoom), this.project(nw, zoom)).getSize(),\r\n  \t\t    snap = Browser.any3d ? this.options.zoomSnap : 1,\r\n  \t\t    scalex = size.x / boundsSize.x,\r\n  \t\t    scaley = size.y / boundsSize.y,\r\n  \t\t    scale = inside ? Math.max(scalex, scaley) : Math.min(scalex, scaley);\r\n\r\n  \t\tzoom = this.getScaleZoom(scale, zoom);\r\n\r\n  \t\tif (snap) {\r\n  \t\t\tzoom = Math.round(zoom / (snap / 100)) * (snap / 100); // don't jump if within 1% of a snap level\r\n  \t\t\tzoom = inside ? Math.ceil(zoom / snap) * snap : Math.floor(zoom / snap) * snap;\r\n  \t\t}\r\n\r\n  \t\treturn Math.max(min, Math.min(max, zoom));\r\n  \t},\r\n\r\n  \t// @method getSize(): Point\r\n  \t// Returns the current size of the map container (in pixels).\r\n  \tgetSize: function () {\r\n  \t\tif (!this._size || this._sizeChanged) {\r\n  \t\t\tthis._size = new Point(\r\n  \t\t\t\tthis._container.clientWidth || 0,\r\n  \t\t\t\tthis._container.clientHeight || 0);\r\n\r\n  \t\t\tthis._sizeChanged = false;\r\n  \t\t}\r\n  \t\treturn this._size.clone();\r\n  \t},\r\n\r\n  \t// @method getPixelBounds(): Bounds\r\n  \t// Returns the bounds of the current map view in projected pixel\r\n  \t// coordinates (sometimes useful in layer and overlay implementations).\r\n  \tgetPixelBounds: function (center, zoom) {\r\n  \t\tvar topLeftPoint = this._getTopLeftPoint(center, zoom);\r\n  \t\treturn new Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\r\n  \t},\r\n\r\n  \t// TODO: Check semantics - isn't the pixel origin the 0,0 coord relative to\r\n  \t// the map pane? \"left point of the map layer\" can be confusing, specially\r\n  \t// since there can be negative offsets.\r\n  \t// @method getPixelOrigin(): Point\r\n  \t// Returns the projected pixel coordinates of the top left point of\r\n  \t// the map layer (useful in custom layer and overlay implementations).\r\n  \tgetPixelOrigin: function () {\r\n  \t\tthis._checkIfLoaded();\r\n  \t\treturn this._pixelOrigin;\r\n  \t},\r\n\r\n  \t// @method getPixelWorldBounds(zoom?: Number): Bounds\r\n  \t// Returns the world's bounds in pixel coordinates for zoom level `zoom`.\r\n  \t// If `zoom` is omitted, the map's current zoom level is used.\r\n  \tgetPixelWorldBounds: function (zoom) {\r\n  \t\treturn this.options.crs.getProjectedBounds(zoom === undefined ? this.getZoom() : zoom);\r\n  \t},\r\n\r\n  \t// @section Other Methods\r\n\r\n  \t// @method getPane(pane: String|HTMLElement): HTMLElement\r\n  \t// Returns a [map pane](#map-pane), given its name or its HTML element (its identity).\r\n  \tgetPane: function (pane) {\r\n  \t\treturn typeof pane === 'string' ? this._panes[pane] : pane;\r\n  \t},\r\n\r\n  \t// @method getPanes(): Object\r\n  \t// Returns a plain object containing the names of all [panes](#map-pane) as keys and\r\n  \t// the panes as values.\r\n  \tgetPanes: function () {\r\n  \t\treturn this._panes;\r\n  \t},\r\n\r\n  \t// @method getContainer: HTMLElement\r\n  \t// Returns the HTML element that contains the map.\r\n  \tgetContainer: function () {\r\n  \t\treturn this._container;\r\n  \t},\r\n\r\n\r\n  \t// @section Conversion Methods\r\n\r\n  \t// @method getZoomScale(toZoom: Number, fromZoom: Number): Number\r\n  \t// Returns the scale factor to be applied to a map transition from zoom level\r\n  \t// `fromZoom` to `toZoom`. Used internally to help with zoom animations.\r\n  \tgetZoomScale: function (toZoom, fromZoom) {\r\n  \t\t// TODO replace with universal implementation after refactoring projections\r\n  \t\tvar crs = this.options.crs;\r\n  \t\tfromZoom = fromZoom === undefined ? this._zoom : fromZoom;\r\n  \t\treturn crs.scale(toZoom) / crs.scale(fromZoom);\r\n  \t},\r\n\r\n  \t// @method getScaleZoom(scale: Number, fromZoom: Number): Number\r\n  \t// Returns the zoom level that the map would end up at, if it is at `fromZoom`\r\n  \t// level and everything is scaled by a factor of `scale`. Inverse of\r\n  \t// [`getZoomScale`](#map-getZoomScale).\r\n  \tgetScaleZoom: function (scale, fromZoom) {\r\n  \t\tvar crs = this.options.crs;\r\n  \t\tfromZoom = fromZoom === undefined ? this._zoom : fromZoom;\r\n  \t\tvar zoom = crs.zoom(scale * crs.scale(fromZoom));\r\n  \t\treturn isNaN(zoom) ? Infinity : zoom;\r\n  \t},\r\n\r\n  \t// @method project(latlng: LatLng, zoom: Number): Point\r\n  \t// Projects a geographical coordinate `LatLng` according to the projection\r\n  \t// of the map's CRS, then scales it according to `zoom` and the CRS's\r\n  \t// `Transformation`. The result is pixel coordinate relative to\r\n  \t// the CRS origin.\r\n  \tproject: function (latlng, zoom) {\r\n  \t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n  \t\treturn this.options.crs.latLngToPoint(toLatLng(latlng), zoom);\r\n  \t},\r\n\r\n  \t// @method unproject(point: Point, zoom: Number): LatLng\r\n  \t// Inverse of [`project`](#map-project).\r\n  \tunproject: function (point, zoom) {\r\n  \t\tzoom = zoom === undefined ? this._zoom : zoom;\r\n  \t\treturn this.options.crs.pointToLatLng(toPoint(point), zoom);\r\n  \t},\r\n\r\n  \t// @method layerPointToLatLng(point: Point): LatLng\r\n  \t// Given a pixel coordinate relative to the [origin pixel](#map-getpixelorigin),\r\n  \t// returns the corresponding geographical coordinate (for the current zoom level).\r\n  \tlayerPointToLatLng: function (point) {\r\n  \t\tvar projectedPoint = toPoint(point).add(this.getPixelOrigin());\r\n  \t\treturn this.unproject(projectedPoint);\r\n  \t},\r\n\r\n  \t// @method latLngToLayerPoint(latlng: LatLng): Point\r\n  \t// Given a geographical coordinate, returns the corresponding pixel coordinate\r\n  \t// relative to the [origin pixel](#map-getpixelorigin).\r\n  \tlatLngToLayerPoint: function (latlng) {\r\n  \t\tvar projectedPoint = this.project(toLatLng(latlng))._round();\r\n  \t\treturn projectedPoint._subtract(this.getPixelOrigin());\r\n  \t},\r\n\r\n  \t// @method wrapLatLng(latlng: LatLng): LatLng\r\n  \t// Returns a `LatLng` where `lat` and `lng` has been wrapped according to the\r\n  \t// map's CRS's `wrapLat` and `wrapLng` properties, if they are outside the\r\n  \t// CRS's bounds.\r\n  \t// By default this means longitude is wrapped around the dateline so its\r\n  \t// value is between -180 and +180 degrees.\r\n  \twrapLatLng: function (latlng) {\r\n  \t\treturn this.options.crs.wrapLatLng(toLatLng(latlng));\r\n  \t},\r\n\r\n  \t// @method wrapLatLngBounds(bounds: LatLngBounds): LatLngBounds\r\n  \t// Returns a `LatLngBounds` with the same size as the given one, ensuring that\r\n  \t// its center is within the CRS's bounds.\r\n  \t// By default this means the center longitude is wrapped around the dateline so its\r\n  \t// value is between -180 and +180 degrees, and the majority of the bounds\r\n  \t// overlaps the CRS's bounds.\r\n  \twrapLatLngBounds: function (latlng) {\r\n  \t\treturn this.options.crs.wrapLatLngBounds(toLatLngBounds(latlng));\r\n  \t},\r\n\r\n  \t// @method distance(latlng1: LatLng, latlng2: LatLng): Number\r\n  \t// Returns the distance between two geographical coordinates according to\r\n  \t// the map's CRS. By default this measures distance in meters.\r\n  \tdistance: function (latlng1, latlng2) {\r\n  \t\treturn this.options.crs.distance(toLatLng(latlng1), toLatLng(latlng2));\r\n  \t},\r\n\r\n  \t// @method containerPointToLayerPoint(point: Point): Point\r\n  \t// Given a pixel coordinate relative to the map container, returns the corresponding\r\n  \t// pixel coordinate relative to the [origin pixel](#map-getpixelorigin).\r\n  \tcontainerPointToLayerPoint: function (point) { // (Point)\r\n  \t\treturn toPoint(point).subtract(this._getMapPanePos());\r\n  \t},\r\n\r\n  \t// @method layerPointToContainerPoint(point: Point): Point\r\n  \t// Given a pixel coordinate relative to the [origin pixel](#map-getpixelorigin),\r\n  \t// returns the corresponding pixel coordinate relative to the map container.\r\n  \tlayerPointToContainerPoint: function (point) { // (Point)\r\n  \t\treturn toPoint(point).add(this._getMapPanePos());\r\n  \t},\r\n\r\n  \t// @method containerPointToLatLng(point: Point): LatLng\r\n  \t// Given a pixel coordinate relative to the map container, returns\r\n  \t// the corresponding geographical coordinate (for the current zoom level).\r\n  \tcontainerPointToLatLng: function (point) {\r\n  \t\tvar layerPoint = this.containerPointToLayerPoint(toPoint(point));\r\n  \t\treturn this.layerPointToLatLng(layerPoint);\r\n  \t},\r\n\r\n  \t// @method latLngToContainerPoint(latlng: LatLng): Point\r\n  \t// Given a geographical coordinate, returns the corresponding pixel coordinate\r\n  \t// relative to the map container.\r\n  \tlatLngToContainerPoint: function (latlng) {\r\n  \t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(toLatLng(latlng)));\r\n  \t},\r\n\r\n  \t// @method mouseEventToContainerPoint(ev: MouseEvent): Point\r\n  \t// Given a MouseEvent object, returns the pixel coordinate relative to the\r\n  \t// map container where the event took place.\r\n  \tmouseEventToContainerPoint: function (e) {\r\n  \t\treturn getMousePosition(e, this._container);\r\n  \t},\r\n\r\n  \t// @method mouseEventToLayerPoint(ev: MouseEvent): Point\r\n  \t// Given a MouseEvent object, returns the pixel coordinate relative to\r\n  \t// the [origin pixel](#map-getpixelorigin) where the event took place.\r\n  \tmouseEventToLayerPoint: function (e) {\r\n  \t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\r\n  \t},\r\n\r\n  \t// @method mouseEventToLatLng(ev: MouseEvent): LatLng\r\n  \t// Given a MouseEvent object, returns geographical coordinate where the\r\n  \t// event took place.\r\n  \tmouseEventToLatLng: function (e) { // (MouseEvent)\r\n  \t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\r\n  \t},\r\n\r\n\r\n  \t// map initialization methods\r\n\r\n  \t_initContainer: function (id) {\r\n  \t\tvar container = this._container = get(id);\r\n\r\n  \t\tif (!container) {\r\n  \t\t\tthrow new Error('Map container not found.');\r\n  \t\t} else if (container._leaflet_id) {\r\n  \t\t\tthrow new Error('Map container is already initialized.');\r\n  \t\t}\r\n\r\n  \t\ton(container, 'scroll', this._onScroll, this);\r\n  \t\tthis._containerId = stamp(container);\r\n  \t},\r\n\r\n  \t_initLayout: function () {\r\n  \t\tvar container = this._container;\r\n\r\n  \t\tthis._fadeAnimated = this.options.fadeAnimation && Browser.any3d;\r\n\r\n  \t\taddClass(container, 'leaflet-container' +\r\n  \t\t\t(Browser.touch ? ' leaflet-touch' : '') +\r\n  \t\t\t(Browser.retina ? ' leaflet-retina' : '') +\r\n  \t\t\t(Browser.ielt9 ? ' leaflet-oldie' : '') +\r\n  \t\t\t(Browser.safari ? ' leaflet-safari' : '') +\r\n  \t\t\t(this._fadeAnimated ? ' leaflet-fade-anim' : ''));\r\n\r\n  \t\tvar position = getStyle(container, 'position');\r\n\r\n  \t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed' && position !== 'sticky') {\r\n  \t\t\tcontainer.style.position = 'relative';\r\n  \t\t}\r\n\r\n  \t\tthis._initPanes();\r\n\r\n  \t\tif (this._initControlPos) {\r\n  \t\t\tthis._initControlPos();\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_initPanes: function () {\r\n  \t\tvar panes = this._panes = {};\r\n  \t\tthis._paneRenderers = {};\r\n\r\n  \t\t// @section\r\n  \t\t//\r\n  \t\t// Panes are DOM elements used to control the ordering of layers on the map. You\r\n  \t\t// can access panes with [`map.getPane`](#map-getpane) or\r\n  \t\t// [`map.getPanes`](#map-getpanes) methods. New panes can be created with the\r\n  \t\t// [`map.createPane`](#map-createpane) method.\r\n  \t\t//\r\n  \t\t// Every map has the following default panes that differ only in zIndex.\r\n  \t\t//\r\n  \t\t// @pane mapPane: HTMLElement = 'auto'\r\n  \t\t// Pane that contains all other map panes\r\n\r\n  \t\tthis._mapPane = this.createPane('mapPane', this._container);\r\n  \t\tsetPosition(this._mapPane, new Point(0, 0));\r\n\r\n  \t\t// @pane tilePane: HTMLElement = 200\r\n  \t\t// Pane for `GridLayer`s and `TileLayer`s\r\n  \t\tthis.createPane('tilePane');\r\n  \t\t// @pane overlayPane: HTMLElement = 400\r\n  \t\t// Pane for vectors (`Path`s, like `Polyline`s and `Polygon`s), `ImageOverlay`s and `VideoOverlay`s\r\n  \t\tthis.createPane('overlayPane');\r\n  \t\t// @pane shadowPane: HTMLElement = 500\r\n  \t\t// Pane for overlay shadows (e.g. `Marker` shadows)\r\n  \t\tthis.createPane('shadowPane');\r\n  \t\t// @pane markerPane: HTMLElement = 600\r\n  \t\t// Pane for `Icon`s of `Marker`s\r\n  \t\tthis.createPane('markerPane');\r\n  \t\t// @pane tooltipPane: HTMLElement = 650\r\n  \t\t// Pane for `Tooltip`s.\r\n  \t\tthis.createPane('tooltipPane');\r\n  \t\t// @pane popupPane: HTMLElement = 700\r\n  \t\t// Pane for `Popup`s.\r\n  \t\tthis.createPane('popupPane');\r\n\r\n  \t\tif (!this.options.markerZoomAnimation) {\r\n  \t\t\taddClass(panes.markerPane, 'leaflet-zoom-hide');\r\n  \t\t\taddClass(panes.shadowPane, 'leaflet-zoom-hide');\r\n  \t\t}\r\n  \t},\r\n\r\n\r\n  \t// private methods that modify map state\r\n\r\n  \t// @section Map state change events\r\n  \t_resetView: function (center, zoom, noMoveStart) {\r\n  \t\tsetPosition(this._mapPane, new Point(0, 0));\r\n\r\n  \t\tvar loading = !this._loaded;\r\n  \t\tthis._loaded = true;\r\n  \t\tzoom = this._limitZoom(zoom);\r\n\r\n  \t\tthis.fire('viewprereset');\r\n\r\n  \t\tvar zoomChanged = this._zoom !== zoom;\r\n  \t\tthis\r\n  \t\t\t._moveStart(zoomChanged, noMoveStart)\r\n  \t\t\t._move(center, zoom)\r\n  \t\t\t._moveEnd(zoomChanged);\r\n\r\n  \t\t// @event viewreset: Event\r\n  \t\t// Fired when the map needs to redraw its content (this usually happens\r\n  \t\t// on map zoom or load). Very useful for creating custom overlays.\r\n  \t\tthis.fire('viewreset');\r\n\r\n  \t\t// @event load: Event\r\n  \t\t// Fired when the map is initialized (when its center and zoom are set\r\n  \t\t// for the first time).\r\n  \t\tif (loading) {\r\n  \t\t\tthis.fire('load');\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_moveStart: function (zoomChanged, noMoveStart) {\r\n  \t\t// @event zoomstart: Event\r\n  \t\t// Fired when the map zoom is about to change (e.g. before zoom animation).\r\n  \t\t// @event movestart: Event\r\n  \t\t// Fired when the view of the map starts changing (e.g. user starts dragging the map).\r\n  \t\tif (zoomChanged) {\r\n  \t\t\tthis.fire('zoomstart');\r\n  \t\t}\r\n  \t\tif (!noMoveStart) {\r\n  \t\t\tthis.fire('movestart');\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_move: function (center, zoom, data, supressEvent) {\r\n  \t\tif (zoom === undefined) {\r\n  \t\t\tzoom = this._zoom;\r\n  \t\t}\r\n  \t\tvar zoomChanged = this._zoom !== zoom;\r\n\r\n  \t\tthis._zoom = zoom;\r\n  \t\tthis._lastCenter = center;\r\n  \t\tthis._pixelOrigin = this._getNewPixelOrigin(center);\r\n\r\n  \t\tif (!supressEvent) {\r\n  \t\t\t// @event zoom: Event\r\n  \t\t\t// Fired repeatedly during any change in zoom level,\r\n  \t\t\t// including zoom and fly animations.\r\n  \t\t\tif (zoomChanged || (data && data.pinch)) {\t// Always fire 'zoom' if pinching because #3530\r\n  \t\t\t\tthis.fire('zoom', data);\r\n  \t\t\t}\r\n\r\n  \t\t\t// @event move: Event\r\n  \t\t\t// Fired repeatedly during any movement of the map,\r\n  \t\t\t// including pan and fly animations.\r\n  \t\t\tthis.fire('move', data);\r\n  \t\t} else if (data && data.pinch) {\t// Always fire 'zoom' if pinching because #3530\r\n  \t\t\tthis.fire('zoom', data);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_moveEnd: function (zoomChanged) {\r\n  \t\t// @event zoomend: Event\r\n  \t\t// Fired when the map zoom changed, after any animations.\r\n  \t\tif (zoomChanged) {\r\n  \t\t\tthis.fire('zoomend');\r\n  \t\t}\r\n\r\n  \t\t// @event moveend: Event\r\n  \t\t// Fired when the center of the map stops changing\r\n  \t\t// (e.g. user stopped dragging the map or after non-centered zoom).\r\n  \t\treturn this.fire('moveend');\r\n  \t},\r\n\r\n  \t_stop: function () {\r\n  \t\tcancelAnimFrame(this._flyToFrame);\r\n  \t\tif (this._panAnim) {\r\n  \t\t\tthis._panAnim.stop();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_rawPanBy: function (offset) {\r\n  \t\tsetPosition(this._mapPane, this._getMapPanePos().subtract(offset));\r\n  \t},\r\n\r\n  \t_getZoomSpan: function () {\r\n  \t\treturn this.getMaxZoom() - this.getMinZoom();\r\n  \t},\r\n\r\n  \t_panInsideMaxBounds: function () {\r\n  \t\tif (!this._enforcingBounds) {\r\n  \t\t\tthis.panInsideBounds(this.options.maxBounds);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_checkIfLoaded: function () {\r\n  \t\tif (!this._loaded) {\r\n  \t\t\tthrow new Error('Set map center and zoom first.');\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// DOM event handling\r\n\r\n  \t// @section Interaction events\r\n  \t_initEvents: function (remove) {\r\n  \t\tthis._targets = {};\r\n  \t\tthis._targets[stamp(this._container)] = this;\r\n\r\n  \t\tvar onOff = remove ? off : on;\r\n\r\n  \t\t// @event click: MouseEvent\r\n  \t\t// Fired when the user clicks (or taps) the map.\r\n  \t\t// @event dblclick: MouseEvent\r\n  \t\t// Fired when the user double-clicks (or double-taps) the map.\r\n  \t\t// @event mousedown: MouseEvent\r\n  \t\t// Fired when the user pushes the mouse button on the map.\r\n  \t\t// @event mouseup: MouseEvent\r\n  \t\t// Fired when the user releases the mouse button on the map.\r\n  \t\t// @event mouseover: MouseEvent\r\n  \t\t// Fired when the mouse enters the map.\r\n  \t\t// @event mouseout: MouseEvent\r\n  \t\t// Fired when the mouse leaves the map.\r\n  \t\t// @event mousemove: MouseEvent\r\n  \t\t// Fired while the mouse moves over the map.\r\n  \t\t// @event contextmenu: MouseEvent\r\n  \t\t// Fired when the user pushes the right mouse button on the map, prevents\r\n  \t\t// default browser context menu from showing if there are listeners on\r\n  \t\t// this event. Also fired on mobile when the user holds a single touch\r\n  \t\t// for a second (also called long press).\r\n  \t\t// @event keypress: KeyboardEvent\r\n  \t\t// Fired when the user presses a key from the keyboard that produces a character value while the map is focused.\r\n  \t\t// @event keydown: KeyboardEvent\r\n  \t\t// Fired when the user presses a key from the keyboard while the map is focused. Unlike the `keypress` event,\r\n  \t\t// the `keydown` event is fired for keys that produce a character value and for keys\r\n  \t\t// that do not produce a character value.\r\n  \t\t// @event keyup: KeyboardEvent\r\n  \t\t// Fired when the user releases a key from the keyboard while the map is focused.\r\n  \t\tonOff(this._container, 'click dblclick mousedown mouseup ' +\r\n  \t\t\t'mouseover mouseout mousemove contextmenu keypress keydown keyup', this._handleDOMEvent, this);\r\n\r\n  \t\tif (this.options.trackResize) {\r\n  \t\t\tonOff(window, 'resize', this._onResize, this);\r\n  \t\t}\r\n\r\n  \t\tif (Browser.any3d && this.options.transform3DLimit) {\r\n  \t\t\t(remove ? this.off : this.on).call(this, 'moveend', this._onMoveEnd);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_onResize: function () {\r\n  \t\tcancelAnimFrame(this._resizeRequest);\r\n  \t\tthis._resizeRequest = requestAnimFrame(\r\n  \t\t        function () { this.invalidateSize({debounceMoveend: true}); }, this);\r\n  \t},\r\n\r\n  \t_onScroll: function () {\r\n  \t\tthis._container.scrollTop  = 0;\r\n  \t\tthis._container.scrollLeft = 0;\r\n  \t},\r\n\r\n  \t_onMoveEnd: function () {\r\n  \t\tvar pos = this._getMapPanePos();\r\n  \t\tif (Math.max(Math.abs(pos.x), Math.abs(pos.y)) >= this.options.transform3DLimit) {\r\n  \t\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=1203873 but Webkit also have\r\n  \t\t\t// a pixel offset on very high values, see: https://jsfiddle.net/dg6r5hhb/\r\n  \t\t\tthis._resetView(this.getCenter(), this.getZoom());\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_findEventTargets: function (e, type) {\r\n  \t\tvar targets = [],\r\n  \t\t    target,\r\n  \t\t    isHover = type === 'mouseout' || type === 'mouseover',\r\n  \t\t    src = e.target || e.srcElement,\r\n  \t\t    dragging = false;\r\n\r\n  \t\twhile (src) {\r\n  \t\t\ttarget = this._targets[stamp(src)];\r\n  \t\t\tif (target && (type === 'click' || type === 'preclick') && this._draggableMoved(target)) {\r\n  \t\t\t\t// Prevent firing click after you just dragged an object.\r\n  \t\t\t\tdragging = true;\r\n  \t\t\t\tbreak;\r\n  \t\t\t}\r\n  \t\t\tif (target && target.listens(type, true)) {\r\n  \t\t\t\tif (isHover && !isExternalTarget(src, e)) { break; }\r\n  \t\t\t\ttargets.push(target);\r\n  \t\t\t\tif (isHover) { break; }\r\n  \t\t\t}\r\n  \t\t\tif (src === this._container) { break; }\r\n  \t\t\tsrc = src.parentNode;\r\n  \t\t}\r\n  \t\tif (!targets.length && !dragging && !isHover && this.listens(type, true)) {\r\n  \t\t\ttargets = [this];\r\n  \t\t}\r\n  \t\treturn targets;\r\n  \t},\r\n\r\n  \t_isClickDisabled: function (el) {\r\n  \t\twhile (el && el !== this._container) {\r\n  \t\t\tif (el['_leaflet_disable_click']) { return true; }\r\n  \t\t\tel = el.parentNode;\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_handleDOMEvent: function (e) {\r\n  \t\tvar el = (e.target || e.srcElement);\r\n  \t\tif (!this._loaded || el['_leaflet_disable_events'] || e.type === 'click' && this._isClickDisabled(el)) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tvar type = e.type;\r\n\r\n  \t\tif (type === 'mousedown') {\r\n  \t\t\t// prevents outline when clicking on keyboard-focusable element\r\n  \t\t\tpreventOutline(el);\r\n  \t\t}\r\n\r\n  \t\tthis._fireDOMEvent(e, type);\r\n  \t},\r\n\r\n  \t_mouseEvents: ['click', 'dblclick', 'mouseover', 'mouseout', 'contextmenu'],\r\n\r\n  \t_fireDOMEvent: function (e, type, canvasTargets) {\r\n\r\n  \t\tif (e.type === 'click') {\r\n  \t\t\t// Fire a synthetic 'preclick' event which propagates up (mainly for closing popups).\r\n  \t\t\t// @event preclick: MouseEvent\r\n  \t\t\t// Fired before mouse click on the map (sometimes useful when you\r\n  \t\t\t// want something to happen on click before any existing click\r\n  \t\t\t// handlers start running).\r\n  \t\t\tvar synth = extend({}, e);\r\n  \t\t\tsynth.type = 'preclick';\r\n  \t\t\tthis._fireDOMEvent(synth, synth.type, canvasTargets);\r\n  \t\t}\r\n\r\n  \t\t// Find the layer the event is propagating from and its parents.\r\n  \t\tvar targets = this._findEventTargets(e, type);\r\n\r\n  \t\tif (canvasTargets) {\r\n  \t\t\tvar filtered = []; // pick only targets with listeners\r\n  \t\t\tfor (var i = 0; i < canvasTargets.length; i++) {\r\n  \t\t\t\tif (canvasTargets[i].listens(type, true)) {\r\n  \t\t\t\t\tfiltered.push(canvasTargets[i]);\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t\ttargets = filtered.concat(targets);\r\n  \t\t}\r\n\r\n  \t\tif (!targets.length) { return; }\r\n\r\n  \t\tif (type === 'contextmenu') {\r\n  \t\t\tpreventDefault(e);\r\n  \t\t}\r\n\r\n  \t\tvar target = targets[0];\r\n  \t\tvar data = {\r\n  \t\t\toriginalEvent: e\r\n  \t\t};\r\n\r\n  \t\tif (e.type !== 'keypress' && e.type !== 'keydown' && e.type !== 'keyup') {\r\n  \t\t\tvar isMarker = target.getLatLng && (!target._radius || target._radius <= 10);\r\n  \t\t\tdata.containerPoint = isMarker ?\r\n  \t\t\t\tthis.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\r\n  \t\t\tdata.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\r\n  \t\t\tdata.latlng = isMarker ? target.getLatLng() : this.layerPointToLatLng(data.layerPoint);\r\n  \t\t}\r\n\r\n  \t\tfor (i = 0; i < targets.length; i++) {\r\n  \t\t\ttargets[i].fire(type, data, true);\r\n  \t\t\tif (data.originalEvent._stopped ||\r\n  \t\t\t\t(targets[i].options.bubblingMouseEvents === false && indexOf(this._mouseEvents, type) !== -1)) { return; }\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_draggableMoved: function (obj) {\r\n  \t\tobj = obj.dragging && obj.dragging.enabled() ? obj : this;\r\n  \t\treturn (obj.dragging && obj.dragging.moved()) || (this.boxZoom && this.boxZoom.moved());\r\n  \t},\r\n\r\n  \t_clearHandlers: function () {\r\n  \t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\r\n  \t\t\tthis._handlers[i].disable();\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @section Other Methods\r\n\r\n  \t// @method whenReady(fn: Function, context?: Object): this\r\n  \t// Runs the given function `fn` when the map gets initialized with\r\n  \t// a view (center and zoom) and at least one layer, or immediately\r\n  \t// if it's already initialized, optionally passing a function context.\r\n  \twhenReady: function (callback, context) {\r\n  \t\tif (this._loaded) {\r\n  \t\t\tcallback.call(context || this, {target: this});\r\n  \t\t} else {\r\n  \t\t\tthis.on('load', callback, context);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n\r\n  \t// private methods for getting map state\r\n\r\n  \t_getMapPanePos: function () {\r\n  \t\treturn getPosition(this._mapPane) || new Point(0, 0);\r\n  \t},\r\n\r\n  \t_moved: function () {\r\n  \t\tvar pos = this._getMapPanePos();\r\n  \t\treturn pos && !pos.equals([0, 0]);\r\n  \t},\r\n\r\n  \t_getTopLeftPoint: function (center, zoom) {\r\n  \t\tvar pixelOrigin = center && zoom !== undefined ?\r\n  \t\t\tthis._getNewPixelOrigin(center, zoom) :\r\n  \t\t\tthis.getPixelOrigin();\r\n  \t\treturn pixelOrigin.subtract(this._getMapPanePos());\r\n  \t},\r\n\r\n  \t_getNewPixelOrigin: function (center, zoom) {\r\n  \t\tvar viewHalf = this.getSize()._divideBy(2);\r\n  \t\treturn this.project(center, zoom)._subtract(viewHalf)._add(this._getMapPanePos())._round();\r\n  \t},\r\n\r\n  \t_latLngToNewLayerPoint: function (latlng, zoom, center) {\r\n  \t\tvar topLeft = this._getNewPixelOrigin(center, zoom);\r\n  \t\treturn this.project(latlng, zoom)._subtract(topLeft);\r\n  \t},\r\n\r\n  \t_latLngBoundsToNewLayerBounds: function (latLngBounds, zoom, center) {\r\n  \t\tvar topLeft = this._getNewPixelOrigin(center, zoom);\r\n  \t\treturn toBounds([\r\n  \t\t\tthis.project(latLngBounds.getSouthWest(), zoom)._subtract(topLeft),\r\n  \t\t\tthis.project(latLngBounds.getNorthWest(), zoom)._subtract(topLeft),\r\n  \t\t\tthis.project(latLngBounds.getSouthEast(), zoom)._subtract(topLeft),\r\n  \t\t\tthis.project(latLngBounds.getNorthEast(), zoom)._subtract(topLeft)\r\n  \t\t]);\r\n  \t},\r\n\r\n  \t// layer point of the current center\r\n  \t_getCenterLayerPoint: function () {\r\n  \t\treturn this.containerPointToLayerPoint(this.getSize()._divideBy(2));\r\n  \t},\r\n\r\n  \t// offset of the specified place to the current center in pixels\r\n  \t_getCenterOffset: function (latlng) {\r\n  \t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\r\n  \t},\r\n\r\n  \t// adjust center for view to get inside bounds\r\n  \t_limitCenter: function (center, zoom, bounds) {\r\n\r\n  \t\tif (!bounds) { return center; }\r\n\r\n  \t\tvar centerPoint = this.project(center, zoom),\r\n  \t\t    viewHalf = this.getSize().divideBy(2),\r\n  \t\t    viewBounds = new Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\r\n  \t\t    offset = this._getBoundsOffset(viewBounds, bounds, zoom);\r\n\r\n  \t\t// If offset is less than a pixel, ignore.\r\n  \t\t// This prevents unstable projections from getting into\r\n  \t\t// an infinite loop of tiny offsets.\r\n  \t\tif (Math.abs(offset.x) <= 1 && Math.abs(offset.y) <= 1) {\r\n  \t\t\treturn center;\r\n  \t\t}\r\n\r\n  \t\treturn this.unproject(centerPoint.add(offset), zoom);\r\n  \t},\r\n\r\n  \t// adjust offset for view to get inside bounds\r\n  \t_limitOffset: function (offset, bounds) {\r\n  \t\tif (!bounds) { return offset; }\r\n\r\n  \t\tvar viewBounds = this.getPixelBounds(),\r\n  \t\t    newBounds = new Bounds(viewBounds.min.add(offset), viewBounds.max.add(offset));\r\n\r\n  \t\treturn offset.add(this._getBoundsOffset(newBounds, bounds));\r\n  \t},\r\n\r\n  \t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\r\n  \t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\r\n  \t\tvar projectedMaxBounds = toBounds(\r\n  \t\t        this.project(maxBounds.getNorthEast(), zoom),\r\n  \t\t        this.project(maxBounds.getSouthWest(), zoom)\r\n  \t\t    ),\r\n  \t\t    minOffset = projectedMaxBounds.min.subtract(pxBounds.min),\r\n  \t\t    maxOffset = projectedMaxBounds.max.subtract(pxBounds.max),\r\n\r\n  \t\t    dx = this._rebound(minOffset.x, -maxOffset.x),\r\n  \t\t    dy = this._rebound(minOffset.y, -maxOffset.y);\r\n\r\n  \t\treturn new Point(dx, dy);\r\n  \t},\r\n\r\n  \t_rebound: function (left, right) {\r\n  \t\treturn left + right > 0 ?\r\n  \t\t\tMath.round(left - right) / 2 :\r\n  \t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\r\n  \t},\r\n\r\n  \t_limitZoom: function (zoom) {\r\n  \t\tvar min = this.getMinZoom(),\r\n  \t\t    max = this.getMaxZoom(),\r\n  \t\t    snap = Browser.any3d ? this.options.zoomSnap : 1;\r\n  \t\tif (snap) {\r\n  \t\t\tzoom = Math.round(zoom / snap) * snap;\r\n  \t\t}\r\n  \t\treturn Math.max(min, Math.min(max, zoom));\r\n  \t},\r\n\r\n  \t_onPanTransitionStep: function () {\r\n  \t\tthis.fire('move');\r\n  \t},\r\n\r\n  \t_onPanTransitionEnd: function () {\r\n  \t\tremoveClass(this._mapPane, 'leaflet-pan-anim');\r\n  \t\tthis.fire('moveend');\r\n  \t},\r\n\r\n  \t_tryAnimatedPan: function (center, options) {\r\n  \t\t// difference between the new and current centers in pixels\r\n  \t\tvar offset = this._getCenterOffset(center)._trunc();\r\n\r\n  \t\t// don't animate too far unless animate: true specified in options\r\n  \t\tif ((options && options.animate) !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n  \t\tthis.panBy(offset, options);\r\n\r\n  \t\treturn true;\r\n  \t},\r\n\r\n  \t_createAnimProxy: function () {\r\n\r\n  \t\tvar proxy = this._proxy = create$1('div', 'leaflet-proxy leaflet-zoom-animated');\r\n  \t\tthis._panes.mapPane.appendChild(proxy);\r\n\r\n  \t\tthis.on('zoomanim', function (e) {\r\n  \t\t\tvar prop = TRANSFORM,\r\n  \t\t\t    transform = this._proxy.style[prop];\r\n\r\n  \t\t\tsetTransform(this._proxy, this.project(e.center, e.zoom), this.getZoomScale(e.zoom, 1));\r\n\r\n  \t\t\t// workaround for case when transform is the same and so transitionend event is not fired\r\n  \t\t\tif (transform === this._proxy.style[prop] && this._animatingZoom) {\r\n  \t\t\t\tthis._onZoomTransitionEnd();\r\n  \t\t\t}\r\n  \t\t}, this);\r\n\r\n  \t\tthis.on('load moveend', this._animMoveEnd, this);\r\n\r\n  \t\tthis._on('unload', this._destroyAnimProxy, this);\r\n  \t},\r\n\r\n  \t_destroyAnimProxy: function () {\r\n  \t\tremove(this._proxy);\r\n  \t\tthis.off('load moveend', this._animMoveEnd, this);\r\n  \t\tdelete this._proxy;\r\n  \t},\r\n\r\n  \t_animMoveEnd: function () {\r\n  \t\tvar c = this.getCenter(),\r\n  \t\t    z = this.getZoom();\r\n  \t\tsetTransform(this._proxy, this.project(c, z), this.getZoomScale(z, 1));\r\n  \t},\r\n\r\n  \t_catchTransitionEnd: function (e) {\r\n  \t\tif (this._animatingZoom && e.propertyName.indexOf('transform') >= 0) {\r\n  \t\t\tthis._onZoomTransitionEnd();\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_nothingToAnimate: function () {\r\n  \t\treturn !this._container.getElementsByClassName('leaflet-zoom-animated').length;\r\n  \t},\r\n\r\n  \t_tryAnimatedZoom: function (center, zoom, options) {\r\n\r\n  \t\tif (this._animatingZoom) { return true; }\r\n\r\n  \t\toptions = options || {};\r\n\r\n  \t\t// don't animate if disabled, not supported or zoom difference is too large\r\n  \t\tif (!this._zoomAnimated || options.animate === false || this._nothingToAnimate() ||\r\n  \t\t        Math.abs(zoom - this._zoom) > this.options.zoomAnimationThreshold) { return false; }\r\n\r\n  \t\t// offset is the pixel coords of the zoom origin relative to the current center\r\n  \t\tvar scale = this.getZoomScale(zoom),\r\n  \t\t    offset = this._getCenterOffset(center)._divideBy(1 - 1 / scale);\r\n\r\n  \t\t// don't animate if the zoom origin isn't within one screen from the current center, unless forced\r\n  \t\tif (options.animate !== true && !this.getSize().contains(offset)) { return false; }\r\n\r\n  \t\trequestAnimFrame(function () {\r\n  \t\t\tthis\r\n  \t\t\t    ._moveStart(true, options.noMoveStart || false)\r\n  \t\t\t    ._animateZoom(center, zoom, true);\r\n  \t\t}, this);\r\n\r\n  \t\treturn true;\r\n  \t},\r\n\r\n  \t_animateZoom: function (center, zoom, startAnim, noUpdate) {\r\n  \t\tif (!this._mapPane) { return; }\r\n\r\n  \t\tif (startAnim) {\r\n  \t\t\tthis._animatingZoom = true;\r\n\r\n  \t\t\t// remember what center/zoom to set after animation\r\n  \t\t\tthis._animateToCenter = center;\r\n  \t\t\tthis._animateToZoom = zoom;\r\n\r\n  \t\t\taddClass(this._mapPane, 'leaflet-zoom-anim');\r\n  \t\t}\r\n\r\n  \t\t// @section Other Events\r\n  \t\t// @event zoomanim: ZoomAnimEvent\r\n  \t\t// Fired at least once per zoom animation. For continuous zoom, like pinch zooming, fired once per frame during zoom.\r\n  \t\tthis.fire('zoomanim', {\r\n  \t\t\tcenter: center,\r\n  \t\t\tzoom: zoom,\r\n  \t\t\tnoUpdate: noUpdate\r\n  \t\t});\r\n\r\n  \t\tif (!this._tempFireZoomEvent) {\r\n  \t\t\tthis._tempFireZoomEvent = this._zoom !== this._animateToZoom;\r\n  \t\t}\r\n\r\n  \t\tthis._move(this._animateToCenter, this._animateToZoom, undefined, true);\r\n\r\n  \t\t// Work around webkit not firing 'transitionend', see https://github.com/Leaflet/Leaflet/issues/3689, 2693\r\n  \t\tsetTimeout(bind(this._onZoomTransitionEnd, this), 250);\r\n  \t},\r\n\r\n  \t_onZoomTransitionEnd: function () {\r\n  \t\tif (!this._animatingZoom) { return; }\r\n\r\n  \t\tif (this._mapPane) {\r\n  \t\t\tremoveClass(this._mapPane, 'leaflet-zoom-anim');\r\n  \t\t}\r\n\r\n  \t\tthis._animatingZoom = false;\r\n\r\n  \t\tthis._move(this._animateToCenter, this._animateToZoom, undefined, true);\r\n\r\n  \t\tif (this._tempFireZoomEvent) {\r\n  \t\t\tthis.fire('zoom');\r\n  \t\t}\r\n  \t\tdelete this._tempFireZoomEvent;\r\n\r\n  \t\tthis.fire('move');\r\n\r\n  \t\tthis._moveEnd(true);\r\n  \t}\r\n  });\r\n\r\n  // @section\r\n\r\n  // @factory L.map(id: String, options?: Map options)\r\n  // Instantiates a map object given the DOM ID of a `<div>` element\r\n  // and optionally an object literal with `Map options`.\r\n  //\r\n  // @alternative\r\n  // @factory L.map(el: HTMLElement, options?: Map options)\r\n  // Instantiates a map object given an instance of a `<div>` HTML element\r\n  // and optionally an object literal with `Map options`.\r\n  function createMap(id, options) {\r\n  \treturn new Map(id, options);\r\n  }\n\n  /*\r\n   * @class Control\r\n   * @aka L.Control\r\n   * @inherits Class\r\n   *\r\n   * L.Control is a base class for implementing map controls. Handles positioning.\r\n   * All other controls extend from this class.\r\n   */\r\n\r\n  var Control = Class.extend({\r\n  \t// @section\r\n  \t// @aka Control Options\r\n  \toptions: {\r\n  \t\t// @option position: String = 'topright'\r\n  \t\t// The position of the control (one of the map corners). Possible values are `'topleft'`,\r\n  \t\t// `'topright'`, `'bottomleft'` or `'bottomright'`\r\n  \t\tposition: 'topright'\r\n  \t},\r\n\r\n  \tinitialize: function (options) {\r\n  \t\tsetOptions(this, options);\r\n  \t},\r\n\r\n  \t/* @section\r\n  \t * Classes extending L.Control will inherit the following methods:\r\n  \t *\r\n  \t * @method getPosition: string\r\n  \t * Returns the position of the control.\r\n  \t */\r\n  \tgetPosition: function () {\r\n  \t\treturn this.options.position;\r\n  \t},\r\n\r\n  \t// @method setPosition(position: string): this\r\n  \t// Sets the position of the control.\r\n  \tsetPosition: function (position) {\r\n  \t\tvar map = this._map;\r\n\r\n  \t\tif (map) {\r\n  \t\t\tmap.removeControl(this);\r\n  \t\t}\r\n\r\n  \t\tthis.options.position = position;\r\n\r\n  \t\tif (map) {\r\n  \t\t\tmap.addControl(this);\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getContainer: HTMLElement\r\n  \t// Returns the HTMLElement that contains the control.\r\n  \tgetContainer: function () {\r\n  \t\treturn this._container;\r\n  \t},\r\n\r\n  \t// @method addTo(map: Map): this\r\n  \t// Adds the control to the given map.\r\n  \taddTo: function (map) {\r\n  \t\tthis.remove();\r\n  \t\tthis._map = map;\r\n\r\n  \t\tvar container = this._container = this.onAdd(map),\r\n  \t\t    pos = this.getPosition(),\r\n  \t\t    corner = map._controlCorners[pos];\r\n\r\n  \t\taddClass(container, 'leaflet-control');\r\n\r\n  \t\tif (pos.indexOf('bottom') !== -1) {\r\n  \t\t\tcorner.insertBefore(container, corner.firstChild);\r\n  \t\t} else {\r\n  \t\t\tcorner.appendChild(container);\r\n  \t\t}\r\n\r\n  \t\tthis._map.on('unload', this.remove, this);\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method remove: this\r\n  \t// Removes the control from the map it is currently active on.\r\n  \tremove: function () {\r\n  \t\tif (!this._map) {\r\n  \t\t\treturn this;\r\n  \t\t}\r\n\r\n  \t\tremove(this._container);\r\n\r\n  \t\tif (this.onRemove) {\r\n  \t\t\tthis.onRemove(this._map);\r\n  \t\t}\r\n\r\n  \t\tthis._map.off('unload', this.remove, this);\r\n  \t\tthis._map = null;\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_refocusOnMap: function (e) {\r\n  \t\t// if map exists and event is not a keyboard event\r\n  \t\tif (this._map && e && e.screenX > 0 && e.screenY > 0) {\r\n  \t\t\tthis._map.getContainer().focus();\r\n  \t\t}\r\n  \t}\r\n  });\r\n\r\n  var control = function (options) {\r\n  \treturn new Control(options);\r\n  };\r\n\r\n  /* @section Extension methods\r\n   * @uninheritable\r\n   *\r\n   * Every control should extend from `L.Control` and (re-)implement the following methods.\r\n   *\r\n   * @method onAdd(map: Map): HTMLElement\r\n   * Should return the container DOM element for the control and add listeners on relevant map events. Called on [`control.addTo(map)`](#control-addTo).\r\n   *\r\n   * @method onRemove(map: Map)\r\n   * Optional method. Should contain all clean up code that removes the listeners previously added in [`onAdd`](#control-onadd). Called on [`control.remove()`](#control-remove).\r\n   */\r\n\r\n  /* @namespace Map\r\n   * @section Methods for Layers and Controls\r\n   */\r\n  Map.include({\r\n  \t// @method addControl(control: Control): this\r\n  \t// Adds the given control to the map\r\n  \taddControl: function (control) {\r\n  \t\tcontrol.addTo(this);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method removeControl(control: Control): this\r\n  \t// Removes the given control from the map\r\n  \tremoveControl: function (control) {\r\n  \t\tcontrol.remove();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_initControlPos: function () {\r\n  \t\tvar corners = this._controlCorners = {},\r\n  \t\t    l = 'leaflet-',\r\n  \t\t    container = this._controlContainer =\r\n  \t\t            create$1('div', l + 'control-container', this._container);\r\n\r\n  \t\tfunction createCorner(vSide, hSide) {\r\n  \t\t\tvar className = l + vSide + ' ' + l + hSide;\r\n\r\n  \t\t\tcorners[vSide + hSide] = create$1('div', className, container);\r\n  \t\t}\r\n\r\n  \t\tcreateCorner('top', 'left');\r\n  \t\tcreateCorner('top', 'right');\r\n  \t\tcreateCorner('bottom', 'left');\r\n  \t\tcreateCorner('bottom', 'right');\r\n  \t},\r\n\r\n  \t_clearControlPos: function () {\r\n  \t\tfor (var i in this._controlCorners) {\r\n  \t\t\tremove(this._controlCorners[i]);\r\n  \t\t}\r\n  \t\tremove(this._controlContainer);\r\n  \t\tdelete this._controlCorners;\r\n  \t\tdelete this._controlContainer;\r\n  \t}\r\n  });\n\n  /*\r\n   * @class Control.Layers\r\n   * @aka L.Control.Layers\r\n   * @inherits Control\r\n   *\r\n   * The layers control gives users the ability to switch between different base layers and switch overlays on/off (check out the [detailed example](https://leafletjs.com/examples/layers-control/)). Extends `Control`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var baseLayers = {\r\n   * \t\"Mapbox\": mapbox,\r\n   * \t\"OpenStreetMap\": osm\r\n   * };\r\n   *\r\n   * var overlays = {\r\n   * \t\"Marker\": marker,\r\n   * \t\"Roads\": roadsLayer\r\n   * };\r\n   *\r\n   * L.control.layers(baseLayers, overlays).addTo(map);\r\n   * ```\r\n   *\r\n   * The `baseLayers` and `overlays` parameters are object literals with layer names as keys and `Layer` objects as values:\r\n   *\r\n   * ```js\r\n   * {\r\n   *     \"<someName1>\": layer1,\r\n   *     \"<someName2>\": layer2\r\n   * }\r\n   * ```\r\n   *\r\n   * The layer names can contain HTML, which allows you to add additional styling to the items:\r\n   *\r\n   * ```js\r\n   * {\"<img src='my-layer-icon' /> <span class='my-layer-item'>My Layer</span>\": myLayer}\r\n   * ```\r\n   */\r\n\r\n  var Layers = Control.extend({\r\n  \t// @section\r\n  \t// @aka Control.Layers options\r\n  \toptions: {\r\n  \t\t// @option collapsed: Boolean = true\r\n  \t\t// If `true`, the control will be collapsed into an icon and expanded on mouse hover, touch, or keyboard activation.\r\n  \t\tcollapsed: true,\r\n  \t\tposition: 'topright',\r\n\r\n  \t\t// @option autoZIndex: Boolean = true\r\n  \t\t// If `true`, the control will assign zIndexes in increasing order to all of its layers so that the order is preserved when switching them on/off.\r\n  \t\tautoZIndex: true,\r\n\r\n  \t\t// @option hideSingleBase: Boolean = false\r\n  \t\t// If `true`, the base layers in the control will be hidden when there is only one.\r\n  \t\thideSingleBase: false,\r\n\r\n  \t\t// @option sortLayers: Boolean = false\r\n  \t\t// Whether to sort the layers. When `false`, layers will keep the order\r\n  \t\t// in which they were added to the control.\r\n  \t\tsortLayers: false,\r\n\r\n  \t\t// @option sortFunction: Function = *\r\n  \t\t// A [compare function](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array/sort)\r\n  \t\t// that will be used for sorting the layers, when `sortLayers` is `true`.\r\n  \t\t// The function receives both the `L.Layer` instances and their names, as in\r\n  \t\t// `sortFunction(layerA, layerB, nameA, nameB)`.\r\n  \t\t// By default, it sorts layers alphabetically by their name.\r\n  \t\tsortFunction: function (layerA, layerB, nameA, nameB) {\r\n  \t\t\treturn nameA < nameB ? -1 : (nameB < nameA ? 1 : 0);\r\n  \t\t}\r\n  \t},\r\n\r\n  \tinitialize: function (baseLayers, overlays, options) {\r\n  \t\tsetOptions(this, options);\r\n\r\n  \t\tthis._layerControlInputs = [];\r\n  \t\tthis._layers = [];\r\n  \t\tthis._lastZIndex = 0;\r\n  \t\tthis._handlingClick = false;\r\n  \t\tthis._preventClick = false;\r\n\r\n  \t\tfor (var i in baseLayers) {\r\n  \t\t\tthis._addLayer(baseLayers[i], i);\r\n  \t\t}\r\n\r\n  \t\tfor (i in overlays) {\r\n  \t\t\tthis._addLayer(overlays[i], i, true);\r\n  \t\t}\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tthis._initLayout();\r\n  \t\tthis._update();\r\n\r\n  \t\tthis._map = map;\r\n  \t\tmap.on('zoomend', this._checkDisabledLayers, this);\r\n\r\n  \t\tfor (var i = 0; i < this._layers.length; i++) {\r\n  \t\t\tthis._layers[i].layer.on('add remove', this._onLayerChange, this);\r\n  \t\t}\r\n\r\n  \t\treturn this._container;\r\n  \t},\r\n\r\n  \taddTo: function (map) {\r\n  \t\tControl.prototype.addTo.call(this, map);\r\n  \t\t// Trigger expand after Layers Control has been inserted into DOM so that is now has an actual height.\r\n  \t\treturn this._expandIfNotCollapsed();\r\n  \t},\r\n\r\n  \tonRemove: function () {\r\n  \t\tthis._map.off('zoomend', this._checkDisabledLayers, this);\r\n\r\n  \t\tfor (var i = 0; i < this._layers.length; i++) {\r\n  \t\t\tthis._layers[i].layer.off('add remove', this._onLayerChange, this);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method addBaseLayer(layer: Layer, name: String): this\r\n  \t// Adds a base layer (radio button entry) with the given name to the control.\r\n  \taddBaseLayer: function (layer, name) {\r\n  \t\tthis._addLayer(layer, name);\r\n  \t\treturn (this._map) ? this._update() : this;\r\n  \t},\r\n\r\n  \t// @method addOverlay(layer: Layer, name: String): this\r\n  \t// Adds an overlay (checkbox entry) with the given name to the control.\r\n  \taddOverlay: function (layer, name) {\r\n  \t\tthis._addLayer(layer, name, true);\r\n  \t\treturn (this._map) ? this._update() : this;\r\n  \t},\r\n\r\n  \t// @method removeLayer(layer: Layer): this\r\n  \t// Remove the given layer from the control.\r\n  \tremoveLayer: function (layer) {\r\n  \t\tlayer.off('add remove', this._onLayerChange, this);\r\n\r\n  \t\tvar obj = this._getLayer(stamp(layer));\r\n  \t\tif (obj) {\r\n  \t\t\tthis._layers.splice(this._layers.indexOf(obj), 1);\r\n  \t\t}\r\n  \t\treturn (this._map) ? this._update() : this;\r\n  \t},\r\n\r\n  \t// @method expand(): this\r\n  \t// Expand the control container if collapsed.\r\n  \texpand: function () {\r\n  \t\taddClass(this._container, 'leaflet-control-layers-expanded');\r\n  \t\tthis._section.style.height = null;\r\n  \t\tvar acceptableHeight = this._map.getSize().y - (this._container.offsetTop + 50);\r\n  \t\tif (acceptableHeight < this._section.clientHeight) {\r\n  \t\t\taddClass(this._section, 'leaflet-control-layers-scrollbar');\r\n  \t\t\tthis._section.style.height = acceptableHeight + 'px';\r\n  \t\t} else {\r\n  \t\t\tremoveClass(this._section, 'leaflet-control-layers-scrollbar');\r\n  \t\t}\r\n  \t\tthis._checkDisabledLayers();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method collapse(): this\r\n  \t// Collapse the control container if expanded.\r\n  \tcollapse: function () {\r\n  \t\tremoveClass(this._container, 'leaflet-control-layers-expanded');\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_initLayout: function () {\r\n  \t\tvar className = 'leaflet-control-layers',\r\n  \t\t    container = this._container = create$1('div', className),\r\n  \t\t    collapsed = this.options.collapsed;\r\n\r\n  \t\t// makes this work on IE touch devices by stopping it from firing a mouseout event when the touch is released\r\n  \t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n  \t\tdisableClickPropagation(container);\r\n  \t\tdisableScrollPropagation(container);\r\n\r\n  \t\tvar section = this._section = create$1('section', className + '-list');\r\n\r\n  \t\tif (collapsed) {\r\n  \t\t\tthis._map.on('click', this.collapse, this);\r\n\r\n  \t\t\ton(container, {\r\n  \t\t\t\tmouseenter: this._expandSafely,\r\n  \t\t\t\tmouseleave: this.collapse\r\n  \t\t\t}, this);\r\n  \t\t}\r\n\r\n  \t\tvar link = this._layersLink = create$1('a', className + '-toggle', container);\r\n  \t\tlink.href = '#';\r\n  \t\tlink.title = 'Layers';\r\n  \t\tlink.setAttribute('role', 'button');\r\n\r\n  \t\ton(link, {\r\n  \t\t\tkeydown: function (e) {\r\n  \t\t\t\tif (e.keyCode === 13) {\r\n  \t\t\t\t\tthis._expandSafely();\r\n  \t\t\t\t}\r\n  \t\t\t},\r\n  \t\t\t// Certain screen readers intercept the key event and instead send a click event\r\n  \t\t\tclick: function (e) {\r\n  \t\t\t\tpreventDefault(e);\r\n  \t\t\t\tthis._expandSafely();\r\n  \t\t\t}\r\n  \t\t}, this);\r\n\r\n  \t\tif (!collapsed) {\r\n  \t\t\tthis.expand();\r\n  \t\t}\r\n\r\n  \t\tthis._baseLayersList = create$1('div', className + '-base', section);\r\n  \t\tthis._separator = create$1('div', className + '-separator', section);\r\n  \t\tthis._overlaysList = create$1('div', className + '-overlays', section);\r\n\r\n  \t\tcontainer.appendChild(section);\r\n  \t},\r\n\r\n  \t_getLayer: function (id) {\r\n  \t\tfor (var i = 0; i < this._layers.length; i++) {\r\n\r\n  \t\t\tif (this._layers[i] && stamp(this._layers[i].layer) === id) {\r\n  \t\t\t\treturn this._layers[i];\r\n  \t\t\t}\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_addLayer: function (layer, name, overlay) {\r\n  \t\tif (this._map) {\r\n  \t\t\tlayer.on('add remove', this._onLayerChange, this);\r\n  \t\t}\r\n\r\n  \t\tthis._layers.push({\r\n  \t\t\tlayer: layer,\r\n  \t\t\tname: name,\r\n  \t\t\toverlay: overlay\r\n  \t\t});\r\n\r\n  \t\tif (this.options.sortLayers) {\r\n  \t\t\tthis._layers.sort(bind(function (a, b) {\r\n  \t\t\t\treturn this.options.sortFunction(a.layer, b.layer, a.name, b.name);\r\n  \t\t\t}, this));\r\n  \t\t}\r\n\r\n  \t\tif (this.options.autoZIndex && layer.setZIndex) {\r\n  \t\t\tthis._lastZIndex++;\r\n  \t\t\tlayer.setZIndex(this._lastZIndex);\r\n  \t\t}\r\n\r\n  \t\tthis._expandIfNotCollapsed();\r\n  \t},\r\n\r\n  \t_update: function () {\r\n  \t\tif (!this._container) { return this; }\r\n\r\n  \t\tempty(this._baseLayersList);\r\n  \t\tempty(this._overlaysList);\r\n\r\n  \t\tthis._layerControlInputs = [];\r\n  \t\tvar baseLayersPresent, overlaysPresent, i, obj, baseLayersCount = 0;\r\n\r\n  \t\tfor (i = 0; i < this._layers.length; i++) {\r\n  \t\t\tobj = this._layers[i];\r\n  \t\t\tthis._addItem(obj);\r\n  \t\t\toverlaysPresent = overlaysPresent || obj.overlay;\r\n  \t\t\tbaseLayersPresent = baseLayersPresent || !obj.overlay;\r\n  \t\t\tbaseLayersCount += !obj.overlay ? 1 : 0;\r\n  \t\t}\r\n\r\n  \t\t// Hide base layers section if there's only one layer.\r\n  \t\tif (this.options.hideSingleBase) {\r\n  \t\t\tbaseLayersPresent = baseLayersPresent && baseLayersCount > 1;\r\n  \t\t\tthis._baseLayersList.style.display = baseLayersPresent ? '' : 'none';\r\n  \t\t}\r\n\r\n  \t\tthis._separator.style.display = overlaysPresent && baseLayersPresent ? '' : 'none';\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_onLayerChange: function (e) {\r\n  \t\tif (!this._handlingClick) {\r\n  \t\t\tthis._update();\r\n  \t\t}\r\n\r\n  \t\tvar obj = this._getLayer(stamp(e.target));\r\n\r\n  \t\t// @namespace Map\r\n  \t\t// @section Layer events\r\n  \t\t// @event baselayerchange: LayersControlEvent\r\n  \t\t// Fired when the base layer is changed through the [layers control](#control-layers).\r\n  \t\t// @event overlayadd: LayersControlEvent\r\n  \t\t// Fired when an overlay is selected through the [layers control](#control-layers).\r\n  \t\t// @event overlayremove: LayersControlEvent\r\n  \t\t// Fired when an overlay is deselected through the [layers control](#control-layers).\r\n  \t\t// @namespace Control.Layers\r\n  \t\tvar type = obj.overlay ?\r\n  \t\t\t(e.type === 'add' ? 'overlayadd' : 'overlayremove') :\r\n  \t\t\t(e.type === 'add' ? 'baselayerchange' : null);\r\n\r\n  \t\tif (type) {\r\n  \t\t\tthis._map.fire(type, obj);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// IE7 bugs out if you create a radio dynamically, so you have to do it this hacky way (see https://stackoverflow.com/a/119079)\r\n  \t_createRadioElement: function (name, checked) {\r\n\r\n  \t\tvar radioHtml = '<input type=\"radio\" class=\"leaflet-control-layers-selector\" name=\"' +\r\n  \t\t\t\tname + '\"' + (checked ? ' checked=\"checked\"' : '') + '/>';\r\n\r\n  \t\tvar radioFragment = document.createElement('div');\r\n  \t\tradioFragment.innerHTML = radioHtml;\r\n\r\n  \t\treturn radioFragment.firstChild;\r\n  \t},\r\n\r\n  \t_addItem: function (obj) {\r\n  \t\tvar label = document.createElement('label'),\r\n  \t\t    checked = this._map.hasLayer(obj.layer),\r\n  \t\t    input;\r\n\r\n  \t\tif (obj.overlay) {\r\n  \t\t\tinput = document.createElement('input');\r\n  \t\t\tinput.type = 'checkbox';\r\n  \t\t\tinput.className = 'leaflet-control-layers-selector';\r\n  \t\t\tinput.defaultChecked = checked;\r\n  \t\t} else {\r\n  \t\t\tinput = this._createRadioElement('leaflet-base-layers_' + stamp(this), checked);\r\n  \t\t}\r\n\r\n  \t\tthis._layerControlInputs.push(input);\r\n  \t\tinput.layerId = stamp(obj.layer);\r\n\r\n  \t\ton(input, 'click', this._onInputClick, this);\r\n\r\n  \t\tvar name = document.createElement('span');\r\n  \t\tname.innerHTML = ' ' + obj.name;\r\n\r\n  \t\t// Helps from preventing layer control flicker when checkboxes are disabled\r\n  \t\t// https://github.com/Leaflet/Leaflet/issues/2771\r\n  \t\tvar holder = document.createElement('span');\r\n\r\n  \t\tlabel.appendChild(holder);\r\n  \t\tholder.appendChild(input);\r\n  \t\tholder.appendChild(name);\r\n\r\n  \t\tvar container = obj.overlay ? this._overlaysList : this._baseLayersList;\r\n  \t\tcontainer.appendChild(label);\r\n\r\n  \t\tthis._checkDisabledLayers();\r\n  \t\treturn label;\r\n  \t},\r\n\r\n  \t_onInputClick: function () {\r\n  \t\t// expanding the control on mobile with a click can cause adding a layer - we don't want this\r\n  \t\tif (this._preventClick) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tvar inputs = this._layerControlInputs,\r\n  \t\t    input, layer;\r\n  \t\tvar addedLayers = [],\r\n  \t\t    removedLayers = [];\r\n\r\n  \t\tthis._handlingClick = true;\r\n\r\n  \t\tfor (var i = inputs.length - 1; i >= 0; i--) {\r\n  \t\t\tinput = inputs[i];\r\n  \t\t\tlayer = this._getLayer(input.layerId).layer;\r\n\r\n  \t\t\tif (input.checked) {\r\n  \t\t\t\taddedLayers.push(layer);\r\n  \t\t\t} else if (!input.checked) {\r\n  \t\t\t\tremovedLayers.push(layer);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\t// Bugfix issue 2318: Should remove all old layers before readding new ones\r\n  \t\tfor (i = 0; i < removedLayers.length; i++) {\r\n  \t\t\tif (this._map.hasLayer(removedLayers[i])) {\r\n  \t\t\t\tthis._map.removeLayer(removedLayers[i]);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\tfor (i = 0; i < addedLayers.length; i++) {\r\n  \t\t\tif (!this._map.hasLayer(addedLayers[i])) {\r\n  \t\t\t\tthis._map.addLayer(addedLayers[i]);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tthis._handlingClick = false;\r\n\r\n  \t\tthis._refocusOnMap();\r\n  \t},\r\n\r\n  \t_checkDisabledLayers: function () {\r\n  \t\tvar inputs = this._layerControlInputs,\r\n  \t\t    input,\r\n  \t\t    layer,\r\n  \t\t    zoom = this._map.getZoom();\r\n\r\n  \t\tfor (var i = inputs.length - 1; i >= 0; i--) {\r\n  \t\t\tinput = inputs[i];\r\n  \t\t\tlayer = this._getLayer(input.layerId).layer;\r\n  \t\t\tinput.disabled = (layer.options.minZoom !== undefined && zoom < layer.options.minZoom) ||\r\n  \t\t\t                 (layer.options.maxZoom !== undefined && zoom > layer.options.maxZoom);\r\n\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_expandIfNotCollapsed: function () {\r\n  \t\tif (this._map && !this.options.collapsed) {\r\n  \t\t\tthis.expand();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_expandSafely: function () {\r\n  \t\tvar section = this._section;\r\n  \t\tthis._preventClick = true;\r\n  \t\ton(section, 'click', preventDefault);\r\n  \t\tthis.expand();\r\n  \t\tvar that = this;\r\n  \t\tsetTimeout(function () {\r\n  \t\t\toff(section, 'click', preventDefault);\r\n  \t\t\tthat._preventClick = false;\r\n  \t\t});\r\n  \t}\r\n\r\n  });\r\n\r\n\r\n  // @factory L.control.layers(baselayers?: Object, overlays?: Object, options?: Control.Layers options)\r\n  // Creates a layers control with the given layers. Base layers will be switched with radio buttons, while overlays will be switched with checkboxes. Note that all base layers should be passed in the base layers object, but only one should be added to the map during map instantiation.\r\n  var layers = function (baseLayers, overlays, options) {\r\n  \treturn new Layers(baseLayers, overlays, options);\r\n  };\n\n  /*\r\n   * @class Control.Zoom\r\n   * @aka L.Control.Zoom\r\n   * @inherits Control\r\n   *\r\n   * A basic zoom control with two buttons (zoom in and zoom out). It is put on the map by default unless you set its [`zoomControl` option](#map-zoomcontrol) to `false`. Extends `Control`.\r\n   */\r\n\r\n  var Zoom = Control.extend({\r\n  \t// @section\r\n  \t// @aka Control.Zoom options\r\n  \toptions: {\r\n  \t\tposition: 'topleft',\r\n\r\n  \t\t// @option zoomInText: String = '<span aria-hidden=\"true\">+</span>'\r\n  \t\t// The text set on the 'zoom in' button.\r\n  \t\tzoomInText: '<span aria-hidden=\"true\">+</span>',\r\n\r\n  \t\t// @option zoomInTitle: String = 'Zoom in'\r\n  \t\t// The title set on the 'zoom in' button.\r\n  \t\tzoomInTitle: 'Zoom in',\r\n\r\n  \t\t// @option zoomOutText: String = '<span aria-hidden=\"true\">&#x2212;</span>'\r\n  \t\t// The text set on the 'zoom out' button.\r\n  \t\tzoomOutText: '<span aria-hidden=\"true\">&#x2212;</span>',\r\n\r\n  \t\t// @option zoomOutTitle: String = 'Zoom out'\r\n  \t\t// The title set on the 'zoom out' button.\r\n  \t\tzoomOutTitle: 'Zoom out'\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tvar zoomName = 'leaflet-control-zoom',\r\n  \t\t    container = create$1('div', zoomName + ' leaflet-bar'),\r\n  \t\t    options = this.options;\r\n\r\n  \t\tthis._zoomInButton  = this._createButton(options.zoomInText, options.zoomInTitle,\r\n  \t\t        zoomName + '-in',  container, this._zoomIn);\r\n  \t\tthis._zoomOutButton = this._createButton(options.zoomOutText, options.zoomOutTitle,\r\n  \t\t        zoomName + '-out', container, this._zoomOut);\r\n\r\n  \t\tthis._updateDisabled();\r\n  \t\tmap.on('zoomend zoomlevelschange', this._updateDisabled, this);\r\n\r\n  \t\treturn container;\r\n  \t},\r\n\r\n  \tonRemove: function (map) {\r\n  \t\tmap.off('zoomend zoomlevelschange', this._updateDisabled, this);\r\n  \t},\r\n\r\n  \tdisable: function () {\r\n  \t\tthis._disabled = true;\r\n  \t\tthis._updateDisabled();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \tenable: function () {\r\n  \t\tthis._disabled = false;\r\n  \t\tthis._updateDisabled();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_zoomIn: function (e) {\r\n  \t\tif (!this._disabled && this._map._zoom < this._map.getMaxZoom()) {\r\n  \t\t\tthis._map.zoomIn(this._map.options.zoomDelta * (e.shiftKey ? 3 : 1));\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_zoomOut: function (e) {\r\n  \t\tif (!this._disabled && this._map._zoom > this._map.getMinZoom()) {\r\n  \t\t\tthis._map.zoomOut(this._map.options.zoomDelta * (e.shiftKey ? 3 : 1));\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_createButton: function (html, title, className, container, fn) {\r\n  \t\tvar link = create$1('a', className, container);\r\n  \t\tlink.innerHTML = html;\r\n  \t\tlink.href = '#';\r\n  \t\tlink.title = title;\r\n\r\n  \t\t/*\r\n  \t\t * Will force screen readers like VoiceOver to read this as \"Zoom in - button\"\r\n  \t\t */\r\n  \t\tlink.setAttribute('role', 'button');\r\n  \t\tlink.setAttribute('aria-label', title);\r\n\r\n  \t\tdisableClickPropagation(link);\r\n  \t\ton(link, 'click', stop);\r\n  \t\ton(link, 'click', fn, this);\r\n  \t\ton(link, 'click', this._refocusOnMap, this);\r\n\r\n  \t\treturn link;\r\n  \t},\r\n\r\n  \t_updateDisabled: function () {\r\n  \t\tvar map = this._map,\r\n  \t\t    className = 'leaflet-disabled';\r\n\r\n  \t\tremoveClass(this._zoomInButton, className);\r\n  \t\tremoveClass(this._zoomOutButton, className);\r\n  \t\tthis._zoomInButton.setAttribute('aria-disabled', 'false');\r\n  \t\tthis._zoomOutButton.setAttribute('aria-disabled', 'false');\r\n\r\n  \t\tif (this._disabled || map._zoom === map.getMinZoom()) {\r\n  \t\t\taddClass(this._zoomOutButton, className);\r\n  \t\t\tthis._zoomOutButton.setAttribute('aria-disabled', 'true');\r\n  \t\t}\r\n  \t\tif (this._disabled || map._zoom === map.getMaxZoom()) {\r\n  \t\t\taddClass(this._zoomInButton, className);\r\n  \t\t\tthis._zoomInButton.setAttribute('aria-disabled', 'true');\r\n  \t\t}\r\n  \t}\r\n  });\r\n\r\n  // @namespace Map\r\n  // @section Control options\r\n  // @option zoomControl: Boolean = true\r\n  // Whether a [zoom control](#control-zoom) is added to the map by default.\r\n  Map.mergeOptions({\r\n  \tzoomControl: true\r\n  });\r\n\r\n  Map.addInitHook(function () {\r\n  \tif (this.options.zoomControl) {\r\n  \t\t// @section Controls\r\n  \t\t// @property zoomControl: Control.Zoom\r\n  \t\t// The default zoom control (only available if the\r\n  \t\t// [`zoomControl` option](#map-zoomcontrol) was `true` when creating the map).\r\n  \t\tthis.zoomControl = new Zoom();\r\n  \t\tthis.addControl(this.zoomControl);\r\n  \t}\r\n  });\r\n\r\n  // @namespace Control.Zoom\r\n  // @factory L.control.zoom(options: Control.Zoom options)\r\n  // Creates a zoom control\r\n  var zoom = function (options) {\r\n  \treturn new Zoom(options);\r\n  };\n\n  /*\n   * @class Control.Scale\n   * @aka L.Control.Scale\n   * @inherits Control\n   *\n   * A simple scale control that shows the scale of the current center of screen in metric (m/km) and imperial (mi/ft) systems. Extends `Control`.\n   *\n   * @example\n   *\n   * ```js\n   * L.control.scale().addTo(map);\n   * ```\n   */\n\n  var Scale = Control.extend({\n  \t// @section\n  \t// @aka Control.Scale options\n  \toptions: {\n  \t\tposition: 'bottomleft',\n\n  \t\t// @option maxWidth: Number = 100\n  \t\t// Maximum width of the control in pixels. The width is set dynamically to show round values (e.g. 100, 200, 500).\n  \t\tmaxWidth: 100,\n\n  \t\t// @option metric: Boolean = True\n  \t\t// Whether to show the metric scale line (m/km).\n  \t\tmetric: true,\n\n  \t\t// @option imperial: Boolean = True\n  \t\t// Whether to show the imperial scale line (mi/ft).\n  \t\timperial: true\n\n  \t\t// @option updateWhenIdle: Boolean = false\n  \t\t// If `true`, the control is updated on [`moveend`](#map-moveend), otherwise it's always up-to-date (updated on [`move`](#map-move)).\n  \t},\n\n  \tonAdd: function (map) {\n  \t\tvar className = 'leaflet-control-scale',\n  \t\t    container = create$1('div', className),\n  \t\t    options = this.options;\n\n  \t\tthis._addScales(options, className + '-line', container);\n\n  \t\tmap.on(options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\n  \t\tmap.whenReady(this._update, this);\n\n  \t\treturn container;\n  \t},\n\n  \tonRemove: function (map) {\n  \t\tmap.off(this.options.updateWhenIdle ? 'moveend' : 'move', this._update, this);\n  \t},\n\n  \t_addScales: function (options, className, container) {\n  \t\tif (options.metric) {\n  \t\t\tthis._mScale = create$1('div', className, container);\n  \t\t}\n  \t\tif (options.imperial) {\n  \t\t\tthis._iScale = create$1('div', className, container);\n  \t\t}\n  \t},\n\n  \t_update: function () {\n  \t\tvar map = this._map,\n  \t\t    y = map.getSize().y / 2;\n\n  \t\tvar maxMeters = map.distance(\n  \t\t\tmap.containerPointToLatLng([0, y]),\n  \t\t\tmap.containerPointToLatLng([this.options.maxWidth, y]));\n\n  \t\tthis._updateScales(maxMeters);\n  \t},\n\n  \t_updateScales: function (maxMeters) {\n  \t\tif (this.options.metric && maxMeters) {\n  \t\t\tthis._updateMetric(maxMeters);\n  \t\t}\n  \t\tif (this.options.imperial && maxMeters) {\n  \t\t\tthis._updateImperial(maxMeters);\n  \t\t}\n  \t},\n\n  \t_updateMetric: function (maxMeters) {\n  \t\tvar meters = this._getRoundNum(maxMeters),\n  \t\t    label = meters < 1000 ? meters + ' m' : (meters / 1000) + ' km';\n\n  \t\tthis._updateScale(this._mScale, label, meters / maxMeters);\n  \t},\n\n  \t_updateImperial: function (maxMeters) {\n  \t\tvar maxFeet = maxMeters * 3.2808399,\n  \t\t    maxMiles, miles, feet;\n\n  \t\tif (maxFeet > 5280) {\n  \t\t\tmaxMiles = maxFeet / 5280;\n  \t\t\tmiles = this._getRoundNum(maxMiles);\n  \t\t\tthis._updateScale(this._iScale, miles + ' mi', miles / maxMiles);\n\n  \t\t} else {\n  \t\t\tfeet = this._getRoundNum(maxFeet);\n  \t\t\tthis._updateScale(this._iScale, feet + ' ft', feet / maxFeet);\n  \t\t}\n  \t},\n\n  \t_updateScale: function (scale, text, ratio) {\n  \t\tscale.style.width = Math.round(this.options.maxWidth * ratio) + 'px';\n  \t\tscale.innerHTML = text;\n  \t},\n\n  \t_getRoundNum: function (num) {\n  \t\tvar pow10 = Math.pow(10, (Math.floor(num) + '').length - 1),\n  \t\t    d = num / pow10;\n\n  \t\td = d >= 10 ? 10 :\n  \t\t    d >= 5 ? 5 :\n  \t\t    d >= 3 ? 3 :\n  \t\t    d >= 2 ? 2 : 1;\n\n  \t\treturn pow10 * d;\n  \t}\n  });\n\n\n  // @factory L.control.scale(options?: Control.Scale options)\n  // Creates an scale control with the given options.\n  var scale = function (options) {\n  \treturn new Scale(options);\n  };\n\n  var ukrainianFlag = '<svg aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"8\" viewBox=\"0 0 12 8\" class=\"leaflet-attribution-flag\"><path fill=\"#4C7BE1\" d=\"M0 0h12v4H0z\"/><path fill=\"#FFD500\" d=\"M0 4h12v3H0z\"/><path fill=\"#E0BC00\" d=\"M0 7h12v1H0z\"/></svg>';\r\n\r\n\r\n  /*\r\n   * @class Control.Attribution\r\n   * @aka L.Control.Attribution\r\n   * @inherits Control\r\n   *\r\n   * The attribution control allows you to display attribution data in a small text box on a map. It is put on the map by default unless you set its [`attributionControl` option](#map-attributioncontrol) to `false`, and it fetches attribution texts from layers with the [`getAttribution` method](#layer-getattribution) automatically. Extends Control.\r\n   */\r\n\r\n  var Attribution = Control.extend({\r\n  \t// @section\r\n  \t// @aka Control.Attribution options\r\n  \toptions: {\r\n  \t\tposition: 'bottomright',\r\n\r\n  \t\t// @option prefix: String|false = 'Leaflet'\r\n  \t\t// The HTML text shown before the attributions. Pass `false` to disable.\r\n  \t\tprefix: '<a href=\"https://leafletjs.com\" title=\"A JavaScript library for interactive maps\">' + (Browser.inlineSvg ? ukrainianFlag + ' ' : '') + 'Leaflet</a>'\r\n  \t},\r\n\r\n  \tinitialize: function (options) {\r\n  \t\tsetOptions(this, options);\r\n\r\n  \t\tthis._attributions = {};\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tmap.attributionControl = this;\r\n  \t\tthis._container = create$1('div', 'leaflet-control-attribution');\r\n  \t\tdisableClickPropagation(this._container);\r\n\r\n  \t\t// TODO ugly, refactor\r\n  \t\tfor (var i in map._layers) {\r\n  \t\t\tif (map._layers[i].getAttribution) {\r\n  \t\t\t\tthis.addAttribution(map._layers[i].getAttribution());\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tthis._update();\r\n\r\n  \t\tmap.on('layeradd', this._addAttribution, this);\r\n\r\n  \t\treturn this._container;\r\n  \t},\r\n\r\n  \tonRemove: function (map) {\r\n  \t\tmap.off('layeradd', this._addAttribution, this);\r\n  \t},\r\n\r\n  \t_addAttribution: function (ev) {\r\n  \t\tif (ev.layer.getAttribution) {\r\n  \t\t\tthis.addAttribution(ev.layer.getAttribution());\r\n  \t\t\tev.layer.once('remove', function () {\r\n  \t\t\t\tthis.removeAttribution(ev.layer.getAttribution());\r\n  \t\t\t}, this);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method setPrefix(prefix: String|false): this\r\n  \t// The HTML text shown before the attributions. Pass `false` to disable.\r\n  \tsetPrefix: function (prefix) {\r\n  \t\tthis.options.prefix = prefix;\r\n  \t\tthis._update();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method addAttribution(text: String): this\r\n  \t// Adds an attribution text (e.g. `'&copy; OpenStreetMap contributors'`).\r\n  \taddAttribution: function (text) {\r\n  \t\tif (!text) { return this; }\r\n\r\n  \t\tif (!this._attributions[text]) {\r\n  \t\t\tthis._attributions[text] = 0;\r\n  \t\t}\r\n  \t\tthis._attributions[text]++;\r\n\r\n  \t\tthis._update();\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method removeAttribution(text: String): this\r\n  \t// Removes an attribution text.\r\n  \tremoveAttribution: function (text) {\r\n  \t\tif (!text) { return this; }\r\n\r\n  \t\tif (this._attributions[text]) {\r\n  \t\t\tthis._attributions[text]--;\r\n  \t\t\tthis._update();\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_update: function () {\r\n  \t\tif (!this._map) { return; }\r\n\r\n  \t\tvar attribs = [];\r\n\r\n  \t\tfor (var i in this._attributions) {\r\n  \t\t\tif (this._attributions[i]) {\r\n  \t\t\t\tattribs.push(i);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tvar prefixAndAttribs = [];\r\n\r\n  \t\tif (this.options.prefix) {\r\n  \t\t\tprefixAndAttribs.push(this.options.prefix);\r\n  \t\t}\r\n  \t\tif (attribs.length) {\r\n  \t\t\tprefixAndAttribs.push(attribs.join(', '));\r\n  \t\t}\r\n\r\n  \t\tthis._container.innerHTML = prefixAndAttribs.join(' <span aria-hidden=\"true\">|</span> ');\r\n  \t}\r\n  });\r\n\r\n  // @namespace Map\r\n  // @section Control options\r\n  // @option attributionControl: Boolean = true\r\n  // Whether a [attribution control](#control-attribution) is added to the map by default.\r\n  Map.mergeOptions({\r\n  \tattributionControl: true\r\n  });\r\n\r\n  Map.addInitHook(function () {\r\n  \tif (this.options.attributionControl) {\r\n  \t\tnew Attribution().addTo(this);\r\n  \t}\r\n  });\r\n\r\n  // @namespace Control.Attribution\r\n  // @factory L.control.attribution(options: Control.Attribution options)\r\n  // Creates an attribution control.\r\n  var attribution = function (options) {\r\n  \treturn new Attribution(options);\r\n  };\n\n  Control.Layers = Layers;\n  Control.Zoom = Zoom;\n  Control.Scale = Scale;\n  Control.Attribution = Attribution;\n\n  control.layers = layers;\n  control.zoom = zoom;\n  control.scale = scale;\n  control.attribution = attribution;\n\n  /*\n  \tL.Handler is a base class for handler classes that are used internally to inject\n  \tinteraction features like dragging to classes like Map and Marker.\n  */\n\n  // @class Handler\n  // @aka L.Handler\n  // Abstract class for map interaction handlers\n\n  var Handler = Class.extend({\n  \tinitialize: function (map) {\n  \t\tthis._map = map;\n  \t},\n\n  \t// @method enable(): this\n  \t// Enables the handler\n  \tenable: function () {\n  \t\tif (this._enabled) { return this; }\n\n  \t\tthis._enabled = true;\n  \t\tthis.addHooks();\n  \t\treturn this;\n  \t},\n\n  \t// @method disable(): this\n  \t// Disables the handler\n  \tdisable: function () {\n  \t\tif (!this._enabled) { return this; }\n\n  \t\tthis._enabled = false;\n  \t\tthis.removeHooks();\n  \t\treturn this;\n  \t},\n\n  \t// @method enabled(): Boolean\n  \t// Returns `true` if the handler is enabled\n  \tenabled: function () {\n  \t\treturn !!this._enabled;\n  \t}\n\n  \t// @section Extension methods\n  \t// Classes inheriting from `Handler` must implement the two following methods:\n  \t// @method addHooks()\n  \t// Called when the handler is enabled, should add event hooks.\n  \t// @method removeHooks()\n  \t// Called when the handler is disabled, should remove the event hooks added previously.\n  });\n\n  // @section There is static function which can be called without instantiating L.Handler:\n  // @function addTo(map: Map, name: String): this\n  // Adds a new Handler to the given map with the given name.\n  Handler.addTo = function (map, name) {\n  \tmap.addHandler(name, this);\n  \treturn this;\n  };\n\n  var Mixin = {Events: Events};\n\n  /*\r\n   * @class Draggable\r\n   * @aka L.Draggable\r\n   * @inherits Evented\r\n   *\r\n   * A class for making DOM elements draggable (including touch support).\r\n   * Used internally for map and marker dragging. Only works for elements\r\n   * that were positioned with [`L.DomUtil.setPosition`](#domutil-setposition).\r\n   *\r\n   * @example\r\n   * ```js\r\n   * var draggable = new L.Draggable(elementToDrag);\r\n   * draggable.enable();\r\n   * ```\r\n   */\r\n\r\n  var START = Browser.touch ? 'touchstart mousedown' : 'mousedown';\r\n\r\n  var Draggable = Evented.extend({\r\n\r\n  \toptions: {\r\n  \t\t// @section\r\n  \t\t// @aka Draggable options\r\n  \t\t// @option clickTolerance: Number = 3\r\n  \t\t// The max number of pixels a user can shift the mouse pointer during a click\r\n  \t\t// for it to be considered a valid click (as opposed to a mouse drag).\r\n  \t\tclickTolerance: 3\r\n  \t},\r\n\r\n  \t// @constructor L.Draggable(el: HTMLElement, dragHandle?: HTMLElement, preventOutline?: Boolean, options?: Draggable options)\r\n  \t// Creates a `Draggable` object for moving `el` when you start dragging the `dragHandle` element (equals `el` itself by default).\r\n  \tinitialize: function (element, dragStartTarget, preventOutline, options) {\r\n  \t\tsetOptions(this, options);\r\n\r\n  \t\tthis._element = element;\r\n  \t\tthis._dragStartTarget = dragStartTarget || element;\r\n  \t\tthis._preventOutline = preventOutline;\r\n  \t},\r\n\r\n  \t// @method enable()\r\n  \t// Enables the dragging ability\r\n  \tenable: function () {\r\n  \t\tif (this._enabled) { return; }\r\n\r\n  \t\ton(this._dragStartTarget, START, this._onDown, this);\r\n\r\n  \t\tthis._enabled = true;\r\n  \t},\r\n\r\n  \t// @method disable()\r\n  \t// Disables the dragging ability\r\n  \tdisable: function () {\r\n  \t\tif (!this._enabled) { return; }\r\n\r\n  \t\t// If we're currently dragging this draggable,\r\n  \t\t// disabling it counts as first ending the drag.\r\n  \t\tif (Draggable._dragging === this) {\r\n  \t\t\tthis.finishDrag(true);\r\n  \t\t}\r\n\r\n  \t\toff(this._dragStartTarget, START, this._onDown, this);\r\n\r\n  \t\tthis._enabled = false;\r\n  \t\tthis._moved = false;\r\n  \t},\r\n\r\n  \t_onDown: function (e) {\r\n  \t\t// Ignore the event if disabled; this happens in IE11\r\n  \t\t// under some circumstances, see #3666.\r\n  \t\tif (!this._enabled) { return; }\r\n\r\n  \t\tthis._moved = false;\r\n\r\n  \t\tif (hasClass(this._element, 'leaflet-zoom-anim')) { return; }\r\n\r\n  \t\tif (e.touches && e.touches.length !== 1) {\r\n  \t\t\t// Finish dragging to avoid conflict with touchZoom\r\n  \t\t\tif (Draggable._dragging === this) {\r\n  \t\t\t\tthis.finishDrag();\r\n  \t\t\t}\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (Draggable._dragging || e.shiftKey || ((e.which !== 1) && (e.button !== 1) && !e.touches)) { return; }\r\n  \t\tDraggable._dragging = this;  // Prevent dragging multiple objects at once.\r\n\r\n  \t\tif (this._preventOutline) {\r\n  \t\t\tpreventOutline(this._element);\r\n  \t\t}\r\n\r\n  \t\tdisableImageDrag();\r\n  \t\tdisableTextSelection();\r\n\r\n  \t\tif (this._moving) { return; }\r\n\r\n  \t\t// @event down: Event\r\n  \t\t// Fired when a drag is about to start.\r\n  \t\tthis.fire('down');\r\n\r\n  \t\tvar first = e.touches ? e.touches[0] : e,\r\n  \t\t    sizedParent = getSizedParentNode(this._element);\r\n\r\n  \t\tthis._startPoint = new Point(first.clientX, first.clientY);\r\n  \t\tthis._startPos = getPosition(this._element);\r\n\r\n  \t\t// Cache the scale, so that we can continuously compensate for it during drag (_onMove).\r\n  \t\tthis._parentScale = getScale(sizedParent);\r\n\r\n  \t\tvar mouseevent = e.type === 'mousedown';\r\n  \t\ton(document, mouseevent ? 'mousemove' : 'touchmove', this._onMove, this);\r\n  \t\ton(document, mouseevent ? 'mouseup' : 'touchend touchcancel', this._onUp, this);\r\n  \t},\r\n\r\n  \t_onMove: function (e) {\r\n  \t\t// Ignore the event if disabled; this happens in IE11\r\n  \t\t// under some circumstances, see #3666.\r\n  \t\tif (!this._enabled) { return; }\r\n\r\n  \t\tif (e.touches && e.touches.length > 1) {\r\n  \t\t\tthis._moved = true;\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tvar first = (e.touches && e.touches.length === 1 ? e.touches[0] : e),\r\n  \t\t    offset = new Point(first.clientX, first.clientY)._subtract(this._startPoint);\r\n\r\n  \t\tif (!offset.x && !offset.y) { return; }\r\n  \t\tif (Math.abs(offset.x) + Math.abs(offset.y) < this.options.clickTolerance) { return; }\r\n\r\n  \t\t// We assume that the parent container's position, border and scale do not change for the duration of the drag.\r\n  \t\t// Therefore there is no need to account for the position and border (they are eliminated by the subtraction)\r\n  \t\t// and we can use the cached value for the scale.\r\n  \t\toffset.x /= this._parentScale.x;\r\n  \t\toffset.y /= this._parentScale.y;\r\n\r\n  \t\tpreventDefault(e);\r\n\r\n  \t\tif (!this._moved) {\r\n  \t\t\t// @event dragstart: Event\r\n  \t\t\t// Fired when a drag starts\r\n  \t\t\tthis.fire('dragstart');\r\n\r\n  \t\t\tthis._moved = true;\r\n\r\n  \t\t\taddClass(document.body, 'leaflet-dragging');\r\n\r\n  \t\t\tthis._lastTarget = e.target || e.srcElement;\r\n  \t\t\t// IE and Edge do not give the <use> element, so fetch it\r\n  \t\t\t// if necessary\r\n  \t\t\tif (window.SVGElementInstance && this._lastTarget instanceof window.SVGElementInstance) {\r\n  \t\t\t\tthis._lastTarget = this._lastTarget.correspondingUseElement;\r\n  \t\t\t}\r\n  \t\t\taddClass(this._lastTarget, 'leaflet-drag-target');\r\n  \t\t}\r\n\r\n  \t\tthis._newPos = this._startPos.add(offset);\r\n  \t\tthis._moving = true;\r\n\r\n  \t\tthis._lastEvent = e;\r\n  \t\tthis._updatePosition();\r\n  \t},\r\n\r\n  \t_updatePosition: function () {\r\n  \t\tvar e = {originalEvent: this._lastEvent};\r\n\r\n  \t\t// @event predrag: Event\r\n  \t\t// Fired continuously during dragging *before* each corresponding\r\n  \t\t// update of the element's position.\r\n  \t\tthis.fire('predrag', e);\r\n  \t\tsetPosition(this._element, this._newPos);\r\n\r\n  \t\t// @event drag: Event\r\n  \t\t// Fired continuously during dragging.\r\n  \t\tthis.fire('drag', e);\r\n  \t},\r\n\r\n  \t_onUp: function () {\r\n  \t\t// Ignore the event if disabled; this happens in IE11\r\n  \t\t// under some circumstances, see #3666.\r\n  \t\tif (!this._enabled) { return; }\r\n  \t\tthis.finishDrag();\r\n  \t},\r\n\r\n  \tfinishDrag: function (noInertia) {\r\n  \t\tremoveClass(document.body, 'leaflet-dragging');\r\n\r\n  \t\tif (this._lastTarget) {\r\n  \t\t\tremoveClass(this._lastTarget, 'leaflet-drag-target');\r\n  \t\t\tthis._lastTarget = null;\r\n  \t\t}\r\n\r\n  \t\toff(document, 'mousemove touchmove', this._onMove, this);\r\n  \t\toff(document, 'mouseup touchend touchcancel', this._onUp, this);\r\n\r\n  \t\tenableImageDrag();\r\n  \t\tenableTextSelection();\r\n\r\n  \t\tvar fireDragend = this._moved && this._moving;\r\n\r\n  \t\tthis._moving = false;\r\n  \t\tDraggable._dragging = false;\r\n\r\n  \t\tif (fireDragend) {\r\n  \t\t\t// @event dragend: DragEndEvent\r\n  \t\t\t// Fired when the drag ends.\r\n  \t\t\tthis.fire('dragend', {\r\n  \t\t\t\tnoInertia: noInertia,\r\n  \t\t\t\tdistance: this._newPos.distanceTo(this._startPos)\r\n  \t\t\t});\r\n  \t\t}\r\n  \t}\r\n\r\n  });\n\n  /*\r\n   * @namespace PolyUtil\r\n   * Various utility functions for polygon geometries.\r\n   */\r\n\r\n  /* @function clipPolygon(points: Point[], bounds: Bounds, round?: Boolean): Point[]\r\n   * Clips the polygon geometry defined by the given `points` by the given bounds (using the [Sutherland-Hodgman algorithm](https://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm)).\r\n   * Used by Leaflet to only show polygon points that are on the screen or near, increasing\r\n   * performance. Note that polygon points needs different algorithm for clipping\r\n   * than polyline, so there's a separate method for it.\r\n   */\r\n  function clipPolygon(points, bounds, round) {\r\n  \tvar clippedPoints,\r\n  \t    edges = [1, 4, 2, 8],\r\n  \t    i, j, k,\r\n  \t    a, b,\r\n  \t    len, edge, p;\r\n\r\n  \tfor (i = 0, len = points.length; i < len; i++) {\r\n  \t\tpoints[i]._code = _getBitCode(points[i], bounds);\r\n  \t}\r\n\r\n  \t// for each edge (left, bottom, right, top)\r\n  \tfor (k = 0; k < 4; k++) {\r\n  \t\tedge = edges[k];\r\n  \t\tclippedPoints = [];\r\n\r\n  \t\tfor (i = 0, len = points.length, j = len - 1; i < len; j = i++) {\r\n  \t\t\ta = points[i];\r\n  \t\t\tb = points[j];\r\n\r\n  \t\t\t// if a is inside the clip window\r\n  \t\t\tif (!(a._code & edge)) {\r\n  \t\t\t\t// if b is outside the clip window (a->b goes out of screen)\r\n  \t\t\t\tif (b._code & edge) {\r\n  \t\t\t\t\tp = _getEdgeIntersection(b, a, edge, bounds, round);\r\n  \t\t\t\t\tp._code = _getBitCode(p, bounds);\r\n  \t\t\t\t\tclippedPoints.push(p);\r\n  \t\t\t\t}\r\n  \t\t\t\tclippedPoints.push(a);\r\n\r\n  \t\t\t// else if b is inside the clip window (a->b enters the screen)\r\n  \t\t\t} else if (!(b._code & edge)) {\r\n  \t\t\t\tp = _getEdgeIntersection(b, a, edge, bounds, round);\r\n  \t\t\t\tp._code = _getBitCode(p, bounds);\r\n  \t\t\t\tclippedPoints.push(p);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\tpoints = clippedPoints;\r\n  \t}\r\n\r\n  \treturn points;\r\n  }\r\n\r\n  /* @function polygonCenter(latlngs: LatLng[], crs: CRS): LatLng\r\n   * Returns the center ([centroid](http://en.wikipedia.org/wiki/Centroid)) of the passed LatLngs (first ring) from a polygon.\r\n   */\r\n  function polygonCenter(latlngs, crs) {\r\n  \tvar i, j, p1, p2, f, area, x, y, center;\r\n\r\n  \tif (!latlngs || latlngs.length === 0) {\r\n  \t\tthrow new Error('latlngs not passed');\r\n  \t}\r\n\r\n  \tif (!isFlat(latlngs)) {\r\n  \t\tconsole.warn('latlngs are not flat! Only the first ring will be used');\r\n  \t\tlatlngs = latlngs[0];\r\n  \t}\r\n\r\n  \tvar centroidLatLng = toLatLng([0, 0]);\r\n\r\n  \tvar bounds = toLatLngBounds(latlngs);\r\n  \tvar areaBounds = bounds.getNorthWest().distanceTo(bounds.getSouthWest()) * bounds.getNorthEast().distanceTo(bounds.getNorthWest());\r\n  \t// tests showed that below 1700 rounding errors are happening\r\n  \tif (areaBounds < 1700) {\r\n  \t\t// getting a inexact center, to move the latlngs near to [0, 0] to prevent rounding errors\r\n  \t\tcentroidLatLng = centroid(latlngs);\r\n  \t}\r\n\r\n  \tvar len = latlngs.length;\r\n  \tvar points = [];\r\n  \tfor (i = 0; i < len; i++) {\r\n  \t\tvar latlng = toLatLng(latlngs[i]);\r\n  \t\tpoints.push(crs.project(toLatLng([latlng.lat - centroidLatLng.lat, latlng.lng - centroidLatLng.lng])));\r\n  \t}\r\n\r\n  \tarea = x = y = 0;\r\n\r\n  \t// polygon centroid algorithm;\r\n  \tfor (i = 0, j = len - 1; i < len; j = i++) {\r\n  \t\tp1 = points[i];\r\n  \t\tp2 = points[j];\r\n\r\n  \t\tf = p1.y * p2.x - p2.y * p1.x;\r\n  \t\tx += (p1.x + p2.x) * f;\r\n  \t\ty += (p1.y + p2.y) * f;\r\n  \t\tarea += f * 3;\r\n  \t}\r\n\r\n  \tif (area === 0) {\r\n  \t\t// Polygon is so small that all points are on same pixel.\r\n  \t\tcenter = points[0];\r\n  \t} else {\r\n  \t\tcenter = [x / area, y / area];\r\n  \t}\r\n\r\n  \tvar latlngCenter = crs.unproject(toPoint(center));\r\n  \treturn toLatLng([latlngCenter.lat + centroidLatLng.lat, latlngCenter.lng + centroidLatLng.lng]);\r\n  }\r\n\r\n  /* @function centroid(latlngs: LatLng[]): LatLng\r\n   * Returns the 'center of mass' of the passed LatLngs.\r\n   */\r\n  function centroid(coords) {\r\n  \tvar latSum = 0;\r\n  \tvar lngSum = 0;\r\n  \tvar len = 0;\r\n  \tfor (var i = 0; i < coords.length; i++) {\r\n  \t\tvar latlng = toLatLng(coords[i]);\r\n  \t\tlatSum += latlng.lat;\r\n  \t\tlngSum += latlng.lng;\r\n  \t\tlen++;\r\n  \t}\r\n  \treturn toLatLng([latSum / len, lngSum / len]);\r\n  }\n\n  var PolyUtil = {\n    __proto__: null,\n    clipPolygon: clipPolygon,\n    polygonCenter: polygonCenter,\n    centroid: centroid\n  };\n\n  /*\r\n   * @namespace LineUtil\r\n   *\r\n   * Various utility functions for polyline points processing, used by Leaflet internally to make polylines lightning-fast.\r\n   */\r\n\r\n  // Simplify polyline with vertex reduction and Douglas-Peucker simplification.\r\n  // Improves rendering performance dramatically by lessening the number of points to draw.\r\n\r\n  // @function simplify(points: Point[], tolerance: Number): Point[]\r\n  // Dramatically reduces the number of points in a polyline while retaining\r\n  // its shape and returns a new array of simplified points, using the\r\n  // [Ramer-Douglas-Peucker algorithm](https://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm).\r\n  // Used for a huge performance boost when processing/displaying Leaflet polylines for\r\n  // each zoom level and also reducing visual noise. tolerance affects the amount of\r\n  // simplification (lesser value means higher quality but slower and with more points).\r\n  // Also released as a separated micro-library [Simplify.js](https://mourner.github.io/simplify-js/).\r\n  function simplify(points, tolerance) {\r\n  \tif (!tolerance || !points.length) {\r\n  \t\treturn points.slice();\r\n  \t}\r\n\r\n  \tvar sqTolerance = tolerance * tolerance;\r\n\r\n  \t    // stage 1: vertex reduction\r\n  \t    points = _reducePoints(points, sqTolerance);\r\n\r\n  \t    // stage 2: Douglas-Peucker simplification\r\n  \t    points = _simplifyDP(points, sqTolerance);\r\n\r\n  \treturn points;\r\n  }\r\n\r\n  // @function pointToSegmentDistance(p: Point, p1: Point, p2: Point): Number\r\n  // Returns the distance between point `p` and segment `p1` to `p2`.\r\n  function pointToSegmentDistance(p, p1, p2) {\r\n  \treturn Math.sqrt(_sqClosestPointOnSegment(p, p1, p2, true));\r\n  }\r\n\r\n  // @function closestPointOnSegment(p: Point, p1: Point, p2: Point): Number\r\n  // Returns the closest point from a point `p` on a segment `p1` to `p2`.\r\n  function closestPointOnSegment(p, p1, p2) {\r\n  \treturn _sqClosestPointOnSegment(p, p1, p2);\r\n  }\r\n\r\n  // Ramer-Douglas-Peucker simplification, see https://en.wikipedia.org/wiki/Ramer-Douglas-Peucker_algorithm\r\n  function _simplifyDP(points, sqTolerance) {\r\n\r\n  \tvar len = points.length,\r\n  \t    ArrayConstructor = typeof Uint8Array !== undefined + '' ? Uint8Array : Array,\r\n  \t    markers = new ArrayConstructor(len);\r\n\r\n  \t    markers[0] = markers[len - 1] = 1;\r\n\r\n  \t_simplifyDPStep(points, markers, sqTolerance, 0, len - 1);\r\n\r\n  \tvar i,\r\n  \t    newPoints = [];\r\n\r\n  \tfor (i = 0; i < len; i++) {\r\n  \t\tif (markers[i]) {\r\n  \t\t\tnewPoints.push(points[i]);\r\n  \t\t}\r\n  \t}\r\n\r\n  \treturn newPoints;\r\n  }\r\n\r\n  function _simplifyDPStep(points, markers, sqTolerance, first, last) {\r\n\r\n  \tvar maxSqDist = 0,\r\n  \tindex, i, sqDist;\r\n\r\n  \tfor (i = first + 1; i <= last - 1; i++) {\r\n  \t\tsqDist = _sqClosestPointOnSegment(points[i], points[first], points[last], true);\r\n\r\n  \t\tif (sqDist > maxSqDist) {\r\n  \t\t\tindex = i;\r\n  \t\t\tmaxSqDist = sqDist;\r\n  \t\t}\r\n  \t}\r\n\r\n  \tif (maxSqDist > sqTolerance) {\r\n  \t\tmarkers[index] = 1;\r\n\r\n  \t\t_simplifyDPStep(points, markers, sqTolerance, first, index);\r\n  \t\t_simplifyDPStep(points, markers, sqTolerance, index, last);\r\n  \t}\r\n  }\r\n\r\n  // reduce points that are too close to each other to a single point\r\n  function _reducePoints(points, sqTolerance) {\r\n  \tvar reducedPoints = [points[0]];\r\n\r\n  \tfor (var i = 1, prev = 0, len = points.length; i < len; i++) {\r\n  \t\tif (_sqDist(points[i], points[prev]) > sqTolerance) {\r\n  \t\t\treducedPoints.push(points[i]);\r\n  \t\t\tprev = i;\r\n  \t\t}\r\n  \t}\r\n  \tif (prev < len - 1) {\r\n  \t\treducedPoints.push(points[len - 1]);\r\n  \t}\r\n  \treturn reducedPoints;\r\n  }\r\n\r\n  var _lastCode;\r\n\r\n  // @function clipSegment(a: Point, b: Point, bounds: Bounds, useLastCode?: Boolean, round?: Boolean): Point[]|Boolean\r\n  // Clips the segment a to b by rectangular bounds with the\r\n  // [Cohen-Sutherland algorithm](https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm)\r\n  // (modifying the segment points directly!). Used by Leaflet to only show polyline\r\n  // points that are on the screen or near, increasing performance.\r\n  function clipSegment(a, b, bounds, useLastCode, round) {\r\n  \tvar codeA = useLastCode ? _lastCode : _getBitCode(a, bounds),\r\n  \t    codeB = _getBitCode(b, bounds),\r\n\r\n  \t    codeOut, p, newCode;\r\n\r\n  \t    // save 2nd code to avoid calculating it on the next segment\r\n  \t    _lastCode = codeB;\r\n\r\n  \twhile (true) {\r\n  \t\t// if a,b is inside the clip window (trivial accept)\r\n  \t\tif (!(codeA | codeB)) {\r\n  \t\t\treturn [a, b];\r\n  \t\t}\r\n\r\n  \t\t// if a,b is outside the clip window (trivial reject)\r\n  \t\tif (codeA & codeB) {\r\n  \t\t\treturn false;\r\n  \t\t}\r\n\r\n  \t\t// other cases\r\n  \t\tcodeOut = codeA || codeB;\r\n  \t\tp = _getEdgeIntersection(a, b, codeOut, bounds, round);\r\n  \t\tnewCode = _getBitCode(p, bounds);\r\n\r\n  \t\tif (codeOut === codeA) {\r\n  \t\t\ta = p;\r\n  \t\t\tcodeA = newCode;\r\n  \t\t} else {\r\n  \t\t\tb = p;\r\n  \t\t\tcodeB = newCode;\r\n  \t\t}\r\n  \t}\r\n  }\r\n\r\n  function _getEdgeIntersection(a, b, code, bounds, round) {\r\n  \tvar dx = b.x - a.x,\r\n  \t    dy = b.y - a.y,\r\n  \t    min = bounds.min,\r\n  \t    max = bounds.max,\r\n  \t    x, y;\r\n\r\n  \tif (code & 8) { // top\r\n  \t\tx = a.x + dx * (max.y - a.y) / dy;\r\n  \t\ty = max.y;\r\n\r\n  \t} else if (code & 4) { // bottom\r\n  \t\tx = a.x + dx * (min.y - a.y) / dy;\r\n  \t\ty = min.y;\r\n\r\n  \t} else if (code & 2) { // right\r\n  \t\tx = max.x;\r\n  \t\ty = a.y + dy * (max.x - a.x) / dx;\r\n\r\n  \t} else if (code & 1) { // left\r\n  \t\tx = min.x;\r\n  \t\ty = a.y + dy * (min.x - a.x) / dx;\r\n  \t}\r\n\r\n  \treturn new Point(x, y, round);\r\n  }\r\n\r\n  function _getBitCode(p, bounds) {\r\n  \tvar code = 0;\r\n\r\n  \tif (p.x < bounds.min.x) { // left\r\n  \t\tcode |= 1;\r\n  \t} else if (p.x > bounds.max.x) { // right\r\n  \t\tcode |= 2;\r\n  \t}\r\n\r\n  \tif (p.y < bounds.min.y) { // bottom\r\n  \t\tcode |= 4;\r\n  \t} else if (p.y > bounds.max.y) { // top\r\n  \t\tcode |= 8;\r\n  \t}\r\n\r\n  \treturn code;\r\n  }\r\n\r\n  // square distance (to avoid unnecessary Math.sqrt calls)\r\n  function _sqDist(p1, p2) {\r\n  \tvar dx = p2.x - p1.x,\r\n  \t    dy = p2.y - p1.y;\r\n  \treturn dx * dx + dy * dy;\r\n  }\r\n\r\n  // return closest point on segment or distance to that point\r\n  function _sqClosestPointOnSegment(p, p1, p2, sqDist) {\r\n  \tvar x = p1.x,\r\n  \t    y = p1.y,\r\n  \t    dx = p2.x - x,\r\n  \t    dy = p2.y - y,\r\n  \t    dot = dx * dx + dy * dy,\r\n  \t    t;\r\n\r\n  \tif (dot > 0) {\r\n  \t\tt = ((p.x - x) * dx + (p.y - y) * dy) / dot;\r\n\r\n  \t\tif (t > 1) {\r\n  \t\t\tx = p2.x;\r\n  \t\t\ty = p2.y;\r\n  \t\t} else if (t > 0) {\r\n  \t\t\tx += dx * t;\r\n  \t\t\ty += dy * t;\r\n  \t\t}\r\n  \t}\r\n\r\n  \tdx = p.x - x;\r\n  \tdy = p.y - y;\r\n\r\n  \treturn sqDist ? dx * dx + dy * dy : new Point(x, y);\r\n  }\r\n\r\n\r\n  // @function isFlat(latlngs: LatLng[]): Boolean\r\n  // Returns true if `latlngs` is a flat array, false is nested.\r\n  function isFlat(latlngs) {\r\n  \treturn !isArray(latlngs[0]) || (typeof latlngs[0][0] !== 'object' && typeof latlngs[0][0] !== 'undefined');\r\n  }\r\n\r\n  function _flat(latlngs) {\r\n  \tconsole.warn('Deprecated use of _flat, please use L.LineUtil.isFlat instead.');\r\n  \treturn isFlat(latlngs);\r\n  }\r\n\r\n  /* @function polylineCenter(latlngs: LatLng[], crs: CRS): LatLng\r\n   * Returns the center ([centroid](http://en.wikipedia.org/wiki/Centroid)) of the passed LatLngs (first ring) from a polyline.\r\n   */\r\n  function polylineCenter(latlngs, crs) {\r\n  \tvar i, halfDist, segDist, dist, p1, p2, ratio, center;\r\n\r\n  \tif (!latlngs || latlngs.length === 0) {\r\n  \t\tthrow new Error('latlngs not passed');\r\n  \t}\r\n\r\n  \tif (!isFlat(latlngs)) {\r\n  \t\tconsole.warn('latlngs are not flat! Only the first ring will be used');\r\n  \t\tlatlngs = latlngs[0];\r\n  \t}\r\n\r\n  \tvar centroidLatLng = toLatLng([0, 0]);\r\n\r\n  \tvar bounds = toLatLngBounds(latlngs);\r\n  \tvar areaBounds = bounds.getNorthWest().distanceTo(bounds.getSouthWest()) * bounds.getNorthEast().distanceTo(bounds.getNorthWest());\r\n  \t// tests showed that below 1700 rounding errors are happening\r\n  \tif (areaBounds < 1700) {\r\n  \t\t// getting a inexact center, to move the latlngs near to [0, 0] to prevent rounding errors\r\n  \t\tcentroidLatLng = centroid(latlngs);\r\n  \t}\r\n\r\n  \tvar len = latlngs.length;\r\n  \tvar points = [];\r\n  \tfor (i = 0; i < len; i++) {\r\n  \t\tvar latlng = toLatLng(latlngs[i]);\r\n  \t\tpoints.push(crs.project(toLatLng([latlng.lat - centroidLatLng.lat, latlng.lng - centroidLatLng.lng])));\r\n  \t}\r\n\r\n  \tfor (i = 0, halfDist = 0; i < len - 1; i++) {\r\n  \t\thalfDist += points[i].distanceTo(points[i + 1]) / 2;\r\n  \t}\r\n\r\n  \t// The line is so small in the current view that all points are on the same pixel.\r\n  \tif (halfDist === 0) {\r\n  \t\tcenter = points[0];\r\n  \t} else {\r\n  \t\tfor (i = 0, dist = 0; i < len - 1; i++) {\r\n  \t\t\tp1 = points[i];\r\n  \t\t\tp2 = points[i + 1];\r\n  \t\t\tsegDist = p1.distanceTo(p2);\r\n  \t\t\tdist += segDist;\r\n\r\n  \t\t\tif (dist > halfDist) {\r\n  \t\t\t\tratio = (dist - halfDist) / segDist;\r\n  \t\t\t\tcenter = [\r\n  \t\t\t\t\tp2.x - ratio * (p2.x - p1.x),\r\n  \t\t\t\t\tp2.y - ratio * (p2.y - p1.y)\r\n  \t\t\t\t];\r\n  \t\t\t\tbreak;\r\n  \t\t\t}\r\n  \t\t}\r\n  \t}\r\n\r\n  \tvar latlngCenter = crs.unproject(toPoint(center));\r\n  \treturn toLatLng([latlngCenter.lat + centroidLatLng.lat, latlngCenter.lng + centroidLatLng.lng]);\r\n  }\n\n  var LineUtil = {\n    __proto__: null,\n    simplify: simplify,\n    pointToSegmentDistance: pointToSegmentDistance,\n    closestPointOnSegment: closestPointOnSegment,\n    clipSegment: clipSegment,\n    _getEdgeIntersection: _getEdgeIntersection,\n    _getBitCode: _getBitCode,\n    _sqClosestPointOnSegment: _sqClosestPointOnSegment,\n    isFlat: isFlat,\n    _flat: _flat,\n    polylineCenter: polylineCenter\n  };\n\n  /*\r\n   * @namespace Projection\r\n   * @section\r\n   * Leaflet comes with a set of already defined Projections out of the box:\r\n   *\r\n   * @projection L.Projection.LonLat\r\n   *\r\n   * Equirectangular, or Plate Carree projection  the most simple projection,\r\n   * mostly used by GIS enthusiasts. Directly maps `x` as longitude, and `y` as\r\n   * latitude. Also suitable for flat worlds, e.g. game maps. Used by the\r\n   * `EPSG:4326` and `Simple` CRS.\r\n   */\r\n\r\n  var LonLat = {\r\n  \tproject: function (latlng) {\r\n  \t\treturn new Point(latlng.lng, latlng.lat);\r\n  \t},\r\n\r\n  \tunproject: function (point) {\r\n  \t\treturn new LatLng(point.y, point.x);\r\n  \t},\r\n\r\n  \tbounds: new Bounds([-180, -90], [180, 90])\r\n  };\n\n  /*\r\n   * @namespace Projection\r\n   * @projection L.Projection.Mercator\r\n   *\r\n   * Elliptical Mercator projection  more complex than Spherical Mercator. Assumes that Earth is an ellipsoid. Used by the EPSG:3395 CRS.\r\n   */\r\n\r\n  var Mercator = {\r\n  \tR: 6378137,\r\n  \tR_MINOR: 6356752.314245179,\r\n\r\n  \tbounds: new Bounds([-20037508.34279, -15496570.73972], [20037508.34279, 18764656.23138]),\r\n\r\n  \tproject: function (latlng) {\r\n  \t\tvar d = Math.PI / 180,\r\n  \t\t    r = this.R,\r\n  \t\t    y = latlng.lat * d,\r\n  \t\t    tmp = this.R_MINOR / r,\r\n  \t\t    e = Math.sqrt(1 - tmp * tmp),\r\n  \t\t    con = e * Math.sin(y);\r\n\r\n  \t\tvar ts = Math.tan(Math.PI / 4 - y / 2) / Math.pow((1 - con) / (1 + con), e / 2);\r\n  \t\ty = -r * Math.log(Math.max(ts, 1E-10));\r\n\r\n  \t\treturn new Point(latlng.lng * d * r, y);\r\n  \t},\r\n\r\n  \tunproject: function (point) {\r\n  \t\tvar d = 180 / Math.PI,\r\n  \t\t    r = this.R,\r\n  \t\t    tmp = this.R_MINOR / r,\r\n  \t\t    e = Math.sqrt(1 - tmp * tmp),\r\n  \t\t    ts = Math.exp(-point.y / r),\r\n  \t\t    phi = Math.PI / 2 - 2 * Math.atan(ts);\r\n\r\n  \t\tfor (var i = 0, dphi = 0.1, con; i < 15 && Math.abs(dphi) > 1e-7; i++) {\r\n  \t\t\tcon = e * Math.sin(phi);\r\n  \t\t\tcon = Math.pow((1 - con) / (1 + con), e / 2);\r\n  \t\t\tdphi = Math.PI / 2 - 2 * Math.atan(ts * con) - phi;\r\n  \t\t\tphi += dphi;\r\n  \t\t}\r\n\r\n  \t\treturn new LatLng(phi * d, point.x * d / r);\r\n  \t}\r\n  };\n\n  /*\n   * @class Projection\n\n   * An object with methods for projecting geographical coordinates of the world onto\n   * a flat surface (and back). See [Map projection](https://en.wikipedia.org/wiki/Map_projection).\n\n   * @property bounds: Bounds\n   * The bounds (specified in CRS units) where the projection is valid\n\n   * @method project(latlng: LatLng): Point\n   * Projects geographical coordinates into a 2D point.\n   * Only accepts actual `L.LatLng` instances, not arrays.\n\n   * @method unproject(point: Point): LatLng\n   * The inverse of `project`. Projects a 2D point into a geographical location.\n   * Only accepts actual `L.Point` instances, not arrays.\n\n   * Note that the projection instances do not inherit from Leaflet's `Class` object,\n   * and can't be instantiated. Also, new classes can't inherit from them,\n   * and methods can't be added to them with the `include` function.\n\n   */\n\n  var index = {\n    __proto__: null,\n    LonLat: LonLat,\n    Mercator: Mercator,\n    SphericalMercator: SphericalMercator\n  };\n\n  /*\r\n   * @namespace CRS\r\n   * @crs L.CRS.EPSG3395\r\n   *\r\n   * Rarely used by some commercial tile providers. Uses Elliptical Mercator projection.\r\n   */\r\n  var EPSG3395 = extend({}, Earth, {\r\n  \tcode: 'EPSG:3395',\r\n  \tprojection: Mercator,\r\n\r\n  \ttransformation: (function () {\r\n  \t\tvar scale = 0.5 / (Math.PI * Mercator.R);\r\n  \t\treturn toTransformation(scale, 0.5, -scale, 0.5);\r\n  \t}())\r\n  });\n\n  /*\r\n   * @namespace CRS\r\n   * @crs L.CRS.EPSG4326\r\n   *\r\n   * A common CRS among GIS enthusiasts. Uses simple Equirectangular projection.\r\n   *\r\n   * Leaflet 1.0.x complies with the [TMS coordinate scheme for EPSG:4326](https://wiki.osgeo.org/wiki/Tile_Map_Service_Specification#global-geodetic),\r\n   * which is a breaking change from 0.7.x behaviour.  If you are using a `TileLayer`\r\n   * with this CRS, ensure that there are two 256x256 pixel tiles covering the\r\n   * whole earth at zoom level zero, and that the tile coordinate origin is (-180,+90),\r\n   * or (-180,-90) for `TileLayer`s with [the `tms` option](#tilelayer-tms) set.\r\n   */\r\n\r\n  var EPSG4326 = extend({}, Earth, {\r\n  \tcode: 'EPSG:4326',\r\n  \tprojection: LonLat,\r\n  \ttransformation: toTransformation(1 / 180, 1, -1 / 180, 0.5)\r\n  });\n\n  /*\n   * @namespace CRS\n   * @crs L.CRS.Simple\n   *\n   * A simple CRS that maps longitude and latitude into `x` and `y` directly.\n   * May be used for maps of flat surfaces (e.g. game maps). Note that the `y`\n   * axis should still be inverted (going from bottom to top). `distance()` returns\n   * simple euclidean distance.\n   */\n\n  var Simple = extend({}, CRS, {\n  \tprojection: LonLat,\n  \ttransformation: toTransformation(1, 0, -1, 0),\n\n  \tscale: function (zoom) {\n  \t\treturn Math.pow(2, zoom);\n  \t},\n\n  \tzoom: function (scale) {\n  \t\treturn Math.log(scale) / Math.LN2;\n  \t},\n\n  \tdistance: function (latlng1, latlng2) {\n  \t\tvar dx = latlng2.lng - latlng1.lng,\n  \t\t    dy = latlng2.lat - latlng1.lat;\n\n  \t\treturn Math.sqrt(dx * dx + dy * dy);\n  \t},\n\n  \tinfinite: true\n  });\n\n  CRS.Earth = Earth;\n  CRS.EPSG3395 = EPSG3395;\n  CRS.EPSG3857 = EPSG3857;\n  CRS.EPSG900913 = EPSG900913;\n  CRS.EPSG4326 = EPSG4326;\n  CRS.Simple = Simple;\n\n  /*\n   * @class Layer\n   * @inherits Evented\n   * @aka L.Layer\n   * @aka ILayer\n   *\n   * A set of methods from the Layer base class that all Leaflet layers use.\n   * Inherits all methods, options and events from `L.Evented`.\n   *\n   * @example\n   *\n   * ```js\n   * var layer = L.marker(latlng).addTo(map);\n   * layer.addTo(map);\n   * layer.remove();\n   * ```\n   *\n   * @event add: Event\n   * Fired after the layer is added to a map\n   *\n   * @event remove: Event\n   * Fired after the layer is removed from a map\n   */\n\n\n  var Layer = Evented.extend({\n\n  \t// Classes extending `L.Layer` will inherit the following options:\n  \toptions: {\n  \t\t// @option pane: String = 'overlayPane'\n  \t\t// By default the layer will be added to the map's [overlay pane](#map-overlaypane). Overriding this option will cause the layer to be placed on another pane by default.\n  \t\tpane: 'overlayPane',\n\n  \t\t// @option attribution: String = null\n  \t\t// String to be shown in the attribution control, e.g. \" OpenStreetMap contributors\". It describes the layer data and is often a legal obligation towards copyright holders and tile providers.\n  \t\tattribution: null,\n\n  \t\tbubblingMouseEvents: true\n  \t},\n\n  \t/* @section\n  \t * Classes extending `L.Layer` will inherit the following methods:\n  \t *\n  \t * @method addTo(map: Map|LayerGroup): this\n  \t * Adds the layer to the given map or layer group.\n  \t */\n  \taddTo: function (map) {\n  \t\tmap.addLayer(this);\n  \t\treturn this;\n  \t},\n\n  \t// @method remove: this\n  \t// Removes the layer from the map it is currently active on.\n  \tremove: function () {\n  \t\treturn this.removeFrom(this._map || this._mapToAdd);\n  \t},\n\n  \t// @method removeFrom(map: Map): this\n  \t// Removes the layer from the given map\n  \t//\n  \t// @alternative\n  \t// @method removeFrom(group: LayerGroup): this\n  \t// Removes the layer from the given `LayerGroup`\n  \tremoveFrom: function (obj) {\n  \t\tif (obj) {\n  \t\t\tobj.removeLayer(this);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method getPane(name? : String): HTMLElement\n  \t// Returns the `HTMLElement` representing the named pane on the map. If `name` is omitted, returns the pane for this layer.\n  \tgetPane: function (name) {\n  \t\treturn this._map.getPane(name ? (this.options[name] || name) : this.options.pane);\n  \t},\n\n  \taddInteractiveTarget: function (targetEl) {\n  \t\tthis._map._targets[stamp(targetEl)] = this;\n  \t\treturn this;\n  \t},\n\n  \tremoveInteractiveTarget: function (targetEl) {\n  \t\tdelete this._map._targets[stamp(targetEl)];\n  \t\treturn this;\n  \t},\n\n  \t// @method getAttribution: String\n  \t// Used by the `attribution control`, returns the [attribution option](#gridlayer-attribution).\n  \tgetAttribution: function () {\n  \t\treturn this.options.attribution;\n  \t},\n\n  \t_layerAdd: function (e) {\n  \t\tvar map = e.target;\n\n  \t\t// check in case layer gets added and then removed before the map is ready\n  \t\tif (!map.hasLayer(this)) { return; }\n\n  \t\tthis._map = map;\n  \t\tthis._zoomAnimated = map._zoomAnimated;\n\n  \t\tif (this.getEvents) {\n  \t\t\tvar events = this.getEvents();\n  \t\t\tmap.on(events, this);\n  \t\t\tthis.once('remove', function () {\n  \t\t\t\tmap.off(events, this);\n  \t\t\t}, this);\n  \t\t}\n\n  \t\tthis.onAdd(map);\n\n  \t\tthis.fire('add');\n  \t\tmap.fire('layeradd', {layer: this});\n  \t}\n  });\n\n  /* @section Extension methods\n   * @uninheritable\n   *\n   * Every layer should extend from `L.Layer` and (re-)implement the following methods.\n   *\n   * @method onAdd(map: Map): this\n   * Should contain code that creates DOM elements for the layer, adds them to `map panes` where they should belong and puts listeners on relevant map events. Called on [`map.addLayer(layer)`](#map-addlayer).\n   *\n   * @method onRemove(map: Map): this\n   * Should contain all clean up code that removes the layer's elements from the DOM and removes listeners previously added in [`onAdd`](#layer-onadd). Called on [`map.removeLayer(layer)`](#map-removelayer).\n   *\n   * @method getEvents(): Object\n   * This optional method should return an object like `{ viewreset: this._reset }` for [`addEventListener`](#evented-addeventlistener). The event handlers in this object will be automatically added and removed from the map with your layer.\n   *\n   * @method getAttribution(): String\n   * This optional method should return a string containing HTML to be shown on the `Attribution control` whenever the layer is visible.\n   *\n   * @method beforeAdd(map: Map): this\n   * Optional method. Called on [`map.addLayer(layer)`](#map-addlayer), before the layer is added to the map, before events are initialized, without waiting until the map is in a usable state. Use for early initialization only.\n   */\n\n\n  /* @namespace Map\n   * @section Layer events\n   *\n   * @event layeradd: LayerEvent\n   * Fired when a new layer is added to the map.\n   *\n   * @event layerremove: LayerEvent\n   * Fired when some layer is removed from the map\n   *\n   * @section Methods for Layers and Controls\n   */\n  Map.include({\n  \t// @method addLayer(layer: Layer): this\n  \t// Adds the given layer to the map\n  \taddLayer: function (layer) {\n  \t\tif (!layer._layerAdd) {\n  \t\t\tthrow new Error('The provided object is not a Layer.');\n  \t\t}\n\n  \t\tvar id = stamp(layer);\n  \t\tif (this._layers[id]) { return this; }\n  \t\tthis._layers[id] = layer;\n\n  \t\tlayer._mapToAdd = this;\n\n  \t\tif (layer.beforeAdd) {\n  \t\t\tlayer.beforeAdd(this);\n  \t\t}\n\n  \t\tthis.whenReady(layer._layerAdd, layer);\n\n  \t\treturn this;\n  \t},\n\n  \t// @method removeLayer(layer: Layer): this\n  \t// Removes the given layer from the map.\n  \tremoveLayer: function (layer) {\n  \t\tvar id = stamp(layer);\n\n  \t\tif (!this._layers[id]) { return this; }\n\n  \t\tif (this._loaded) {\n  \t\t\tlayer.onRemove(this);\n  \t\t}\n\n  \t\tdelete this._layers[id];\n\n  \t\tif (this._loaded) {\n  \t\t\tthis.fire('layerremove', {layer: layer});\n  \t\t\tlayer.fire('remove');\n  \t\t}\n\n  \t\tlayer._map = layer._mapToAdd = null;\n\n  \t\treturn this;\n  \t},\n\n  \t// @method hasLayer(layer: Layer): Boolean\n  \t// Returns `true` if the given layer is currently added to the map\n  \thasLayer: function (layer) {\n  \t\treturn stamp(layer) in this._layers;\n  \t},\n\n  \t/* @method eachLayer(fn: Function, context?: Object): this\n  \t * Iterates over the layers of the map, optionally specifying context of the iterator function.\n  \t * ```\n  \t * map.eachLayer(function(layer){\n  \t *     layer.bindPopup('Hello');\n  \t * });\n  \t * ```\n  \t */\n  \teachLayer: function (method, context) {\n  \t\tfor (var i in this._layers) {\n  \t\t\tmethod.call(context, this._layers[i]);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t_addLayers: function (layers) {\n  \t\tlayers = layers ? (isArray(layers) ? layers : [layers]) : [];\n\n  \t\tfor (var i = 0, len = layers.length; i < len; i++) {\n  \t\t\tthis.addLayer(layers[i]);\n  \t\t}\n  \t},\n\n  \t_addZoomLimit: function (layer) {\n  \t\tif (!isNaN(layer.options.maxZoom) || !isNaN(layer.options.minZoom)) {\n  \t\t\tthis._zoomBoundLayers[stamp(layer)] = layer;\n  \t\t\tthis._updateZoomLevels();\n  \t\t}\n  \t},\n\n  \t_removeZoomLimit: function (layer) {\n  \t\tvar id = stamp(layer);\n\n  \t\tif (this._zoomBoundLayers[id]) {\n  \t\t\tdelete this._zoomBoundLayers[id];\n  \t\t\tthis._updateZoomLevels();\n  \t\t}\n  \t},\n\n  \t_updateZoomLevels: function () {\n  \t\tvar minZoom = Infinity,\n  \t\t    maxZoom = -Infinity,\n  \t\t    oldZoomSpan = this._getZoomSpan();\n\n  \t\tfor (var i in this._zoomBoundLayers) {\n  \t\t\tvar options = this._zoomBoundLayers[i].options;\n\n  \t\t\tminZoom = options.minZoom === undefined ? minZoom : Math.min(minZoom, options.minZoom);\n  \t\t\tmaxZoom = options.maxZoom === undefined ? maxZoom : Math.max(maxZoom, options.maxZoom);\n  \t\t}\n\n  \t\tthis._layersMaxZoom = maxZoom === -Infinity ? undefined : maxZoom;\n  \t\tthis._layersMinZoom = minZoom === Infinity ? undefined : minZoom;\n\n  \t\t// @section Map state change events\n  \t\t// @event zoomlevelschange: Event\n  \t\t// Fired when the number of zoomlevels on the map is changed due\n  \t\t// to adding or removing a layer.\n  \t\tif (oldZoomSpan !== this._getZoomSpan()) {\n  \t\t\tthis.fire('zoomlevelschange');\n  \t\t}\n\n  \t\tif (this.options.maxZoom === undefined && this._layersMaxZoom && this.getZoom() > this._layersMaxZoom) {\n  \t\t\tthis.setZoom(this._layersMaxZoom);\n  \t\t}\n  \t\tif (this.options.minZoom === undefined && this._layersMinZoom && this.getZoom() < this._layersMinZoom) {\n  \t\t\tthis.setZoom(this._layersMinZoom);\n  \t\t}\n  \t}\n  });\n\n  /*\r\n   * @class LayerGroup\r\n   * @aka L.LayerGroup\r\n   * @inherits Interactive layer\r\n   *\r\n   * Used to group several layers and handle them as one. If you add it to the map,\r\n   * any layers added or removed from the group will be added/removed on the map as\r\n   * well. Extends `Layer`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * L.layerGroup([marker1, marker2])\r\n   * \t.addLayer(polyline)\r\n   * \t.addTo(map);\r\n   * ```\r\n   */\r\n\r\n  var LayerGroup = Layer.extend({\r\n\r\n  \tinitialize: function (layers, options) {\r\n  \t\tsetOptions(this, options);\r\n\r\n  \t\tthis._layers = {};\r\n\r\n  \t\tvar i, len;\r\n\r\n  \t\tif (layers) {\r\n  \t\t\tfor (i = 0, len = layers.length; i < len; i++) {\r\n  \t\t\t\tthis.addLayer(layers[i]);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method addLayer(layer: Layer): this\r\n  \t// Adds the given layer to the group.\r\n  \taddLayer: function (layer) {\r\n  \t\tvar id = this.getLayerId(layer);\r\n\r\n  \t\tthis._layers[id] = layer;\r\n\r\n  \t\tif (this._map) {\r\n  \t\t\tthis._map.addLayer(layer);\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method removeLayer(layer: Layer): this\r\n  \t// Removes the given layer from the group.\r\n  \t// @alternative\r\n  \t// @method removeLayer(id: Number): this\r\n  \t// Removes the layer with the given internal ID from the group.\r\n  \tremoveLayer: function (layer) {\r\n  \t\tvar id = layer in this._layers ? layer : this.getLayerId(layer);\r\n\r\n  \t\tif (this._map && this._layers[id]) {\r\n  \t\t\tthis._map.removeLayer(this._layers[id]);\r\n  \t\t}\r\n\r\n  \t\tdelete this._layers[id];\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method hasLayer(layer: Layer): Boolean\r\n  \t// Returns `true` if the given layer is currently added to the group.\r\n  \t// @alternative\r\n  \t// @method hasLayer(id: Number): Boolean\r\n  \t// Returns `true` if the given internal ID is currently added to the group.\r\n  \thasLayer: function (layer) {\r\n  \t\tvar layerId = typeof layer === 'number' ? layer : this.getLayerId(layer);\r\n  \t\treturn layerId in this._layers;\r\n  \t},\r\n\r\n  \t// @method clearLayers(): this\r\n  \t// Removes all the layers from the group.\r\n  \tclearLayers: function () {\r\n  \t\treturn this.eachLayer(this.removeLayer, this);\r\n  \t},\r\n\r\n  \t// @method invoke(methodName: String, ): this\r\n  \t// Calls `methodName` on every layer contained in this group, passing any\r\n  \t// additional parameters. Has no effect if the layers contained do not\r\n  \t// implement `methodName`.\r\n  \tinvoke: function (methodName) {\r\n  \t\tvar args = Array.prototype.slice.call(arguments, 1),\r\n  \t\t    i, layer;\r\n\r\n  \t\tfor (i in this._layers) {\r\n  \t\t\tlayer = this._layers[i];\r\n\r\n  \t\t\tif (layer[methodName]) {\r\n  \t\t\t\tlayer[methodName].apply(layer, args);\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tthis.eachLayer(map.addLayer, map);\r\n  \t},\r\n\r\n  \tonRemove: function (map) {\r\n  \t\tthis.eachLayer(map.removeLayer, map);\r\n  \t},\r\n\r\n  \t// @method eachLayer(fn: Function, context?: Object): this\r\n  \t// Iterates over the layers of the group, optionally specifying context of the iterator function.\r\n  \t// ```js\r\n  \t// group.eachLayer(function (layer) {\r\n  \t// \tlayer.bindPopup('Hello');\r\n  \t// });\r\n  \t// ```\r\n  \teachLayer: function (method, context) {\r\n  \t\tfor (var i in this._layers) {\r\n  \t\t\tmethod.call(context, this._layers[i]);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getLayer(id: Number): Layer\r\n  \t// Returns the layer with the given internal ID.\r\n  \tgetLayer: function (id) {\r\n  \t\treturn this._layers[id];\r\n  \t},\r\n\r\n  \t// @method getLayers(): Layer[]\r\n  \t// Returns an array of all the layers added to the group.\r\n  \tgetLayers: function () {\r\n  \t\tvar layers = [];\r\n  \t\tthis.eachLayer(layers.push, layers);\r\n  \t\treturn layers;\r\n  \t},\r\n\r\n  \t// @method setZIndex(zIndex: Number): this\r\n  \t// Calls `setZIndex` on every layer contained in this group, passing the z-index.\r\n  \tsetZIndex: function (zIndex) {\r\n  \t\treturn this.invoke('setZIndex', zIndex);\r\n  \t},\r\n\r\n  \t// @method getLayerId(layer: Layer): Number\r\n  \t// Returns the internal ID for a layer\r\n  \tgetLayerId: function (layer) {\r\n  \t\treturn stamp(layer);\r\n  \t}\r\n  });\r\n\r\n\r\n  // @factory L.layerGroup(layers?: Layer[], options?: Object)\r\n  // Create a layer group, optionally given an initial set of layers and an `options` object.\r\n  var layerGroup = function (layers, options) {\r\n  \treturn new LayerGroup(layers, options);\r\n  };\n\n  /*\r\n   * @class FeatureGroup\r\n   * @aka L.FeatureGroup\r\n   * @inherits LayerGroup\r\n   *\r\n   * Extended `LayerGroup` that makes it easier to do the same thing to all its member layers:\r\n   *  * [`bindPopup`](#layer-bindpopup) binds a popup to all of the layers at once (likewise with [`bindTooltip`](#layer-bindtooltip))\r\n   *  * Events are propagated to the `FeatureGroup`, so if the group has an event\r\n   * handler, it will handle events from any of the layers. This includes mouse events\r\n   * and custom events.\r\n   *  * Has `layeradd` and `layerremove` events\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * L.featureGroup([marker1, marker2, polyline])\r\n   * \t.bindPopup('Hello world!')\r\n   * \t.on('click', function() { alert('Clicked on a member of the group!'); })\r\n   * \t.addTo(map);\r\n   * ```\r\n   */\r\n\r\n  var FeatureGroup = LayerGroup.extend({\r\n\r\n  \taddLayer: function (layer) {\r\n  \t\tif (this.hasLayer(layer)) {\r\n  \t\t\treturn this;\r\n  \t\t}\r\n\r\n  \t\tlayer.addEventParent(this);\r\n\r\n  \t\tLayerGroup.prototype.addLayer.call(this, layer);\r\n\r\n  \t\t// @event layeradd: LayerEvent\r\n  \t\t// Fired when a layer is added to this `FeatureGroup`\r\n  \t\treturn this.fire('layeradd', {layer: layer});\r\n  \t},\r\n\r\n  \tremoveLayer: function (layer) {\r\n  \t\tif (!this.hasLayer(layer)) {\r\n  \t\t\treturn this;\r\n  \t\t}\r\n  \t\tif (layer in this._layers) {\r\n  \t\t\tlayer = this._layers[layer];\r\n  \t\t}\r\n\r\n  \t\tlayer.removeEventParent(this);\r\n\r\n  \t\tLayerGroup.prototype.removeLayer.call(this, layer);\r\n\r\n  \t\t// @event layerremove: LayerEvent\r\n  \t\t// Fired when a layer is removed from this `FeatureGroup`\r\n  \t\treturn this.fire('layerremove', {layer: layer});\r\n  \t},\r\n\r\n  \t// @method setStyle(style: Path options): this\r\n  \t// Sets the given path options to each layer of the group that has a `setStyle` method.\r\n  \tsetStyle: function (style) {\r\n  \t\treturn this.invoke('setStyle', style);\r\n  \t},\r\n\r\n  \t// @method bringToFront(): this\r\n  \t// Brings the layer group to the top of all other layers\r\n  \tbringToFront: function () {\r\n  \t\treturn this.invoke('bringToFront');\r\n  \t},\r\n\r\n  \t// @method bringToBack(): this\r\n  \t// Brings the layer group to the back of all other layers\r\n  \tbringToBack: function () {\r\n  \t\treturn this.invoke('bringToBack');\r\n  \t},\r\n\r\n  \t// @method getBounds(): LatLngBounds\r\n  \t// Returns the LatLngBounds of the Feature Group (created from bounds and coordinates of its children).\r\n  \tgetBounds: function () {\r\n  \t\tvar bounds = new LatLngBounds();\r\n\r\n  \t\tfor (var id in this._layers) {\r\n  \t\t\tvar layer = this._layers[id];\r\n  \t\t\tbounds.extend(layer.getBounds ? layer.getBounds() : layer.getLatLng());\r\n  \t\t}\r\n  \t\treturn bounds;\r\n  \t}\r\n  });\r\n\r\n  // @factory L.featureGroup(layers?: Layer[], options?: Object)\r\n  // Create a feature group, optionally given an initial set of layers and an `options` object.\r\n  var featureGroup = function (layers, options) {\r\n  \treturn new FeatureGroup(layers, options);\r\n  };\n\n  /*\r\n   * @class Icon\r\n   * @aka L.Icon\r\n   *\r\n   * Represents an icon to provide when creating a marker.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var myIcon = L.icon({\r\n   *     iconUrl: 'my-icon.png',\r\n   *     iconRetinaUrl: 'my-icon@2x.png',\r\n   *     iconSize: [38, 95],\r\n   *     iconAnchor: [22, 94],\r\n   *     popupAnchor: [-3, -76],\r\n   *     shadowUrl: 'my-icon-shadow.png',\r\n   *     shadowRetinaUrl: 'my-icon-shadow@2x.png',\r\n   *     shadowSize: [68, 95],\r\n   *     shadowAnchor: [22, 94]\r\n   * });\r\n   *\r\n   * L.marker([50.505, 30.57], {icon: myIcon}).addTo(map);\r\n   * ```\r\n   *\r\n   * `L.Icon.Default` extends `L.Icon` and is the blue icon Leaflet uses for markers by default.\r\n   *\r\n   */\r\n\r\n  var Icon = Class.extend({\r\n\r\n  \t/* @section\r\n  \t * @aka Icon options\r\n  \t *\r\n  \t * @option iconUrl: String = null\r\n  \t * **(required)** The URL to the icon image (absolute or relative to your script path).\r\n  \t *\r\n  \t * @option iconRetinaUrl: String = null\r\n  \t * The URL to a retina sized version of the icon image (absolute or relative to your\r\n  \t * script path). Used for Retina screen devices.\r\n  \t *\r\n  \t * @option iconSize: Point = null\r\n  \t * Size of the icon image in pixels.\r\n  \t *\r\n  \t * @option iconAnchor: Point = null\r\n  \t * The coordinates of the \"tip\" of the icon (relative to its top left corner). The icon\r\n  \t * will be aligned so that this point is at the marker's geographical location. Centered\r\n  \t * by default if size is specified, also can be set in CSS with negative margins.\r\n  \t *\r\n  \t * @option popupAnchor: Point = [0, 0]\r\n  \t * The coordinates of the point from which popups will \"open\", relative to the icon anchor.\r\n  \t *\r\n  \t * @option tooltipAnchor: Point = [0, 0]\r\n  \t * The coordinates of the point from which tooltips will \"open\", relative to the icon anchor.\r\n  \t *\r\n  \t * @option shadowUrl: String = null\r\n  \t * The URL to the icon shadow image. If not specified, no shadow image will be created.\r\n  \t *\r\n  \t * @option shadowRetinaUrl: String = null\r\n  \t *\r\n  \t * @option shadowSize: Point = null\r\n  \t * Size of the shadow image in pixels.\r\n  \t *\r\n  \t * @option shadowAnchor: Point = null\r\n  \t * The coordinates of the \"tip\" of the shadow (relative to its top left corner) (the same\r\n  \t * as iconAnchor if not specified).\r\n  \t *\r\n  \t * @option className: String = ''\r\n  \t * A custom class name to assign to both icon and shadow images. Empty by default.\r\n  \t */\r\n\r\n  \toptions: {\r\n  \t\tpopupAnchor: [0, 0],\r\n  \t\ttooltipAnchor: [0, 0],\r\n\r\n  \t\t// @option crossOrigin: Boolean|String = false\r\n  \t\t// Whether the crossOrigin attribute will be added to the tiles.\r\n  \t\t// If a String is provided, all tiles will have their crossOrigin attribute set to the String provided. This is needed if you want to access tile pixel data.\r\n  \t\t// Refer to [CORS Settings](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes) for valid String values.\r\n  \t\tcrossOrigin: false\r\n  \t},\r\n\r\n  \tinitialize: function (options) {\r\n  \t\tsetOptions(this, options);\r\n  \t},\r\n\r\n  \t// @method createIcon(oldIcon?: HTMLElement): HTMLElement\r\n  \t// Called internally when the icon has to be shown, returns a `<img>` HTML element\r\n  \t// styled according to the options.\r\n  \tcreateIcon: function (oldIcon) {\r\n  \t\treturn this._createIcon('icon', oldIcon);\r\n  \t},\r\n\r\n  \t// @method createShadow(oldIcon?: HTMLElement): HTMLElement\r\n  \t// As `createIcon`, but for the shadow beneath it.\r\n  \tcreateShadow: function (oldIcon) {\r\n  \t\treturn this._createIcon('shadow', oldIcon);\r\n  \t},\r\n\r\n  \t_createIcon: function (name, oldIcon) {\r\n  \t\tvar src = this._getIconUrl(name);\r\n\r\n  \t\tif (!src) {\r\n  \t\t\tif (name === 'icon') {\r\n  \t\t\t\tthrow new Error('iconUrl not set in Icon options (see the docs).');\r\n  \t\t\t}\r\n  \t\t\treturn null;\r\n  \t\t}\r\n\r\n  \t\tvar img = this._createImg(src, oldIcon && oldIcon.tagName === 'IMG' ? oldIcon : null);\r\n  \t\tthis._setIconStyles(img, name);\r\n\r\n  \t\tif (this.options.crossOrigin || this.options.crossOrigin === '') {\r\n  \t\t\timg.crossOrigin = this.options.crossOrigin === true ? '' : this.options.crossOrigin;\r\n  \t\t}\r\n\r\n  \t\treturn img;\r\n  \t},\r\n\r\n  \t_setIconStyles: function (img, name) {\r\n  \t\tvar options = this.options;\r\n  \t\tvar sizeOption = options[name + 'Size'];\r\n\r\n  \t\tif (typeof sizeOption === 'number') {\r\n  \t\t\tsizeOption = [sizeOption, sizeOption];\r\n  \t\t}\r\n\r\n  \t\tvar size = toPoint(sizeOption),\r\n  \t\t    anchor = toPoint(name === 'shadow' && options.shadowAnchor || options.iconAnchor ||\r\n  \t\t            size && size.divideBy(2, true));\r\n\r\n  \t\timg.className = 'leaflet-marker-' + name + ' ' + (options.className || '');\r\n\r\n  \t\tif (anchor) {\r\n  \t\t\timg.style.marginLeft = (-anchor.x) + 'px';\r\n  \t\t\timg.style.marginTop  = (-anchor.y) + 'px';\r\n  \t\t}\r\n\r\n  \t\tif (size) {\r\n  \t\t\timg.style.width  = size.x + 'px';\r\n  \t\t\timg.style.height = size.y + 'px';\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_createImg: function (src, el) {\r\n  \t\tel = el || document.createElement('img');\r\n  \t\tel.src = src;\r\n  \t\treturn el;\r\n  \t},\r\n\r\n  \t_getIconUrl: function (name) {\r\n  \t\treturn Browser.retina && this.options[name + 'RetinaUrl'] || this.options[name + 'Url'];\r\n  \t}\r\n  });\r\n\r\n\r\n  // @factory L.icon(options: Icon options)\r\n  // Creates an icon instance with the given options.\r\n  function icon(options) {\r\n  \treturn new Icon(options);\r\n  }\n\n  /*\n   * @miniclass Icon.Default (Icon)\n   * @aka L.Icon.Default\n   * @section\n   *\n   * A trivial subclass of `Icon`, represents the icon to use in `Marker`s when\n   * no icon is specified. Points to the blue marker image distributed with Leaflet\n   * releases.\n   *\n   * In order to customize the default icon, just change the properties of `L.Icon.Default.prototype.options`\n   * (which is a set of `Icon options`).\n   *\n   * If you want to _completely_ replace the default icon, override the\n   * `L.Marker.prototype.options.icon` with your own icon instead.\n   */\n\n  var IconDefault = Icon.extend({\n\n  \toptions: {\n  \t\ticonUrl:       'marker-icon.png',\n  \t\ticonRetinaUrl: 'marker-icon-2x.png',\n  \t\tshadowUrl:     'marker-shadow.png',\n  \t\ticonSize:    [25, 41],\n  \t\ticonAnchor:  [12, 41],\n  \t\tpopupAnchor: [1, -34],\n  \t\ttooltipAnchor: [16, -28],\n  \t\tshadowSize:  [41, 41]\n  \t},\n\n  \t_getIconUrl: function (name) {\n  \t\tif (typeof IconDefault.imagePath !== 'string') {\t// Deprecated, backwards-compatibility only\n  \t\t\tIconDefault.imagePath = this._detectIconPath();\n  \t\t}\n\n  \t\t// @option imagePath: String\n  \t\t// `Icon.Default` will try to auto-detect the location of the\n  \t\t// blue icon images. If you are placing these images in a non-standard\n  \t\t// way, set this option to point to the right path.\n  \t\treturn (this.options.imagePath || IconDefault.imagePath) + Icon.prototype._getIconUrl.call(this, name);\n  \t},\n\n  \t_stripUrl: function (path) {\t// separate function to use in tests\n  \t\tvar strip = function (str, re, idx) {\n  \t\t\tvar match = re.exec(str);\n  \t\t\treturn match && match[idx];\n  \t\t};\n  \t\tpath = strip(path, /^url\\((['\"])?(.+)\\1\\)$/, 2);\n  \t\treturn path && strip(path, /^(.*)marker-icon\\.png$/, 1);\n  \t},\n\n  \t_detectIconPath: function () {\n  \t\tvar el = create$1('div',  'leaflet-default-icon-path', document.body);\n  \t\tvar path = getStyle(el, 'background-image') ||\n  \t\t           getStyle(el, 'backgroundImage');\t// IE8\n\n  \t\tdocument.body.removeChild(el);\n  \t\tpath = this._stripUrl(path);\n  \t\tif (path) { return path; }\n  \t\tvar link = document.querySelector('link[href$=\"leaflet.css\"]');\n  \t\tif (!link) { return ''; }\n  \t\treturn link.href.substring(0, link.href.length - 'leaflet.css'.length - 1);\n  \t}\n  });\n\n  /*\n   * L.Handler.MarkerDrag is used internally by L.Marker to make the markers draggable.\n   */\n\n\n  /* @namespace Marker\n   * @section Interaction handlers\n   *\n   * Interaction handlers are properties of a marker instance that allow you to control interaction behavior in runtime, enabling or disabling certain features such as dragging (see `Handler` methods). Example:\n   *\n   * ```js\n   * marker.dragging.disable();\n   * ```\n   *\n   * @property dragging: Handler\n   * Marker dragging handler (by both mouse and touch). Only valid when the marker is on the map (Otherwise set [`marker.options.draggable`](#marker-draggable)).\n   */\n\n  var MarkerDrag = Handler.extend({\n  \tinitialize: function (marker) {\n  \t\tthis._marker = marker;\n  \t},\n\n  \taddHooks: function () {\n  \t\tvar icon = this._marker._icon;\n\n  \t\tif (!this._draggable) {\n  \t\t\tthis._draggable = new Draggable(icon, icon, true);\n  \t\t}\n\n  \t\tthis._draggable.on({\n  \t\t\tdragstart: this._onDragStart,\n  \t\t\tpredrag: this._onPreDrag,\n  \t\t\tdrag: this._onDrag,\n  \t\t\tdragend: this._onDragEnd\n  \t\t}, this).enable();\n\n  \t\taddClass(icon, 'leaflet-marker-draggable');\n  \t},\n\n  \tremoveHooks: function () {\n  \t\tthis._draggable.off({\n  \t\t\tdragstart: this._onDragStart,\n  \t\t\tpredrag: this._onPreDrag,\n  \t\t\tdrag: this._onDrag,\n  \t\t\tdragend: this._onDragEnd\n  \t\t}, this).disable();\n\n  \t\tif (this._marker._icon) {\n  \t\t\tremoveClass(this._marker._icon, 'leaflet-marker-draggable');\n  \t\t}\n  \t},\n\n  \tmoved: function () {\n  \t\treturn this._draggable && this._draggable._moved;\n  \t},\n\n  \t_adjustPan: function (e) {\n  \t\tvar marker = this._marker,\n  \t\t    map = marker._map,\n  \t\t    speed = this._marker.options.autoPanSpeed,\n  \t\t    padding = this._marker.options.autoPanPadding,\n  \t\t    iconPos = getPosition(marker._icon),\n  \t\t    bounds = map.getPixelBounds(),\n  \t\t    origin = map.getPixelOrigin();\n\n  \t\tvar panBounds = toBounds(\n  \t\t\tbounds.min._subtract(origin).add(padding),\n  \t\t\tbounds.max._subtract(origin).subtract(padding)\n  \t\t);\n\n  \t\tif (!panBounds.contains(iconPos)) {\n  \t\t\t// Compute incremental movement\n  \t\t\tvar movement = toPoint(\n  \t\t\t\t(Math.max(panBounds.max.x, iconPos.x) - panBounds.max.x) / (bounds.max.x - panBounds.max.x) -\n  \t\t\t\t(Math.min(panBounds.min.x, iconPos.x) - panBounds.min.x) / (bounds.min.x - panBounds.min.x),\n\n  \t\t\t\t(Math.max(panBounds.max.y, iconPos.y) - panBounds.max.y) / (bounds.max.y - panBounds.max.y) -\n  \t\t\t\t(Math.min(panBounds.min.y, iconPos.y) - panBounds.min.y) / (bounds.min.y - panBounds.min.y)\n  \t\t\t).multiplyBy(speed);\n\n  \t\t\tmap.panBy(movement, {animate: false});\n\n  \t\t\tthis._draggable._newPos._add(movement);\n  \t\t\tthis._draggable._startPos._add(movement);\n\n  \t\t\tsetPosition(marker._icon, this._draggable._newPos);\n  \t\t\tthis._onDrag(e);\n\n  \t\t\tthis._panRequest = requestAnimFrame(this._adjustPan.bind(this, e));\n  \t\t}\n  \t},\n\n  \t_onDragStart: function () {\n  \t\t// @section Dragging events\n  \t\t// @event dragstart: Event\n  \t\t// Fired when the user starts dragging the marker.\n\n  \t\t// @event movestart: Event\n  \t\t// Fired when the marker starts moving (because of dragging).\n\n  \t\tthis._oldLatLng = this._marker.getLatLng();\n\n  \t\t// When using ES6 imports it could not be set when `Popup` was not imported as well\n  \t\tthis._marker.closePopup && this._marker.closePopup();\n\n  \t\tthis._marker\n  \t\t\t.fire('movestart')\n  \t\t\t.fire('dragstart');\n  \t},\n\n  \t_onPreDrag: function (e) {\n  \t\tif (this._marker.options.autoPan) {\n  \t\t\tcancelAnimFrame(this._panRequest);\n  \t\t\tthis._panRequest = requestAnimFrame(this._adjustPan.bind(this, e));\n  \t\t}\n  \t},\n\n  \t_onDrag: function (e) {\n  \t\tvar marker = this._marker,\n  \t\t    shadow = marker._shadow,\n  \t\t    iconPos = getPosition(marker._icon),\n  \t\t    latlng = marker._map.layerPointToLatLng(iconPos);\n\n  \t\t// update shadow position\n  \t\tif (shadow) {\n  \t\t\tsetPosition(shadow, iconPos);\n  \t\t}\n\n  \t\tmarker._latlng = latlng;\n  \t\te.latlng = latlng;\n  \t\te.oldLatLng = this._oldLatLng;\n\n  \t\t// @event drag: Event\n  \t\t// Fired repeatedly while the user drags the marker.\n  \t\tmarker\n  \t\t    .fire('move', e)\n  \t\t    .fire('drag', e);\n  \t},\n\n  \t_onDragEnd: function (e) {\n  \t\t// @event dragend: DragEndEvent\n  \t\t// Fired when the user stops dragging the marker.\n\n  \t\t cancelAnimFrame(this._panRequest);\n\n  \t\t// @event moveend: Event\n  \t\t// Fired when the marker stops moving (because of dragging).\n  \t\tdelete this._oldLatLng;\n  \t\tthis._marker\n  \t\t    .fire('moveend')\n  \t\t    .fire('dragend', e);\n  \t}\n  });\n\n  /*\r\n   * @class Marker\r\n   * @inherits Interactive layer\r\n   * @aka L.Marker\r\n   * L.Marker is used to display clickable/draggable icons on the map. Extends `Layer`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * L.marker([50.5, 30.5]).addTo(map);\r\n   * ```\r\n   */\r\n\r\n  var Marker = Layer.extend({\r\n\r\n  \t// @section\r\n  \t// @aka Marker options\r\n  \toptions: {\r\n  \t\t// @option icon: Icon = *\r\n  \t\t// Icon instance to use for rendering the marker.\r\n  \t\t// See [Icon documentation](#L.Icon) for details on how to customize the marker icon.\r\n  \t\t// If not specified, a common instance of `L.Icon.Default` is used.\r\n  \t\ticon: new IconDefault(),\r\n\r\n  \t\t// Option inherited from \"Interactive layer\" abstract class\r\n  \t\tinteractive: true,\r\n\r\n  \t\t// @option keyboard: Boolean = true\r\n  \t\t// Whether the marker can be tabbed to with a keyboard and clicked by pressing enter.\r\n  \t\tkeyboard: true,\r\n\r\n  \t\t// @option title: String = ''\r\n  \t\t// Text for the browser tooltip that appear on marker hover (no tooltip by default).\r\n  \t\t// [Useful for accessibility](https://leafletjs.com/examples/accessibility/#markers-must-be-labelled).\r\n  \t\ttitle: '',\r\n\r\n  \t\t// @option alt: String = 'Marker'\r\n  \t\t// Text for the `alt` attribute of the icon image.\r\n  \t\t// [Useful for accessibility](https://leafletjs.com/examples/accessibility/#markers-must-be-labelled).\r\n  \t\talt: 'Marker',\r\n\r\n  \t\t// @option zIndexOffset: Number = 0\r\n  \t\t// By default, marker images zIndex is set automatically based on its latitude. Use this option if you want to put the marker on top of all others (or below), specifying a high value like `1000` (or high negative value, respectively).\r\n  \t\tzIndexOffset: 0,\r\n\r\n  \t\t// @option opacity: Number = 1.0\r\n  \t\t// The opacity of the marker.\r\n  \t\topacity: 1,\r\n\r\n  \t\t// @option riseOnHover: Boolean = false\r\n  \t\t// If `true`, the marker will get on top of others when you hover the mouse over it.\r\n  \t\triseOnHover: false,\r\n\r\n  \t\t// @option riseOffset: Number = 250\r\n  \t\t// The z-index offset used for the `riseOnHover` feature.\r\n  \t\triseOffset: 250,\r\n\r\n  \t\t// @option pane: String = 'markerPane'\r\n  \t\t// `Map pane` where the markers icon will be added.\r\n  \t\tpane: 'markerPane',\r\n\r\n  \t\t// @option shadowPane: String = 'shadowPane'\r\n  \t\t// `Map pane` where the markers shadow will be added.\r\n  \t\tshadowPane: 'shadowPane',\r\n\r\n  \t\t// @option bubblingMouseEvents: Boolean = false\r\n  \t\t// When `true`, a mouse event on this marker will trigger the same event on the map\r\n  \t\t// (unless [`L.DomEvent.stopPropagation`](#domevent-stoppropagation) is used).\r\n  \t\tbubblingMouseEvents: false,\r\n\r\n  \t\t// @option autoPanOnFocus: Boolean = true\r\n  \t\t// When `true`, the map will pan whenever the marker is focused (via\r\n  \t\t// e.g. pressing `tab` on the keyboard) to ensure the marker is\r\n  \t\t// visible within the map's bounds\r\n  \t\tautoPanOnFocus: true,\r\n\r\n  \t\t// @section Draggable marker options\r\n  \t\t// @option draggable: Boolean = false\r\n  \t\t// Whether the marker is draggable with mouse/touch or not.\r\n  \t\tdraggable: false,\r\n\r\n  \t\t// @option autoPan: Boolean = false\r\n  \t\t// Whether to pan the map when dragging this marker near its edge or not.\r\n  \t\tautoPan: false,\r\n\r\n  \t\t// @option autoPanPadding: Point = Point(50, 50)\r\n  \t\t// Distance (in pixels to the left/right and to the top/bottom) of the\r\n  \t\t// map edge to start panning the map.\r\n  \t\tautoPanPadding: [50, 50],\r\n\r\n  \t\t// @option autoPanSpeed: Number = 10\r\n  \t\t// Number of pixels the map should pan by.\r\n  \t\tautoPanSpeed: 10\r\n  \t},\r\n\r\n  \t/* @section\r\n  \t *\r\n  \t * In addition to [shared layer methods](#Layer) like `addTo()` and `remove()` and [popup methods](#Popup) like bindPopup() you can also use the following methods:\r\n  \t */\r\n\r\n  \tinitialize: function (latlng, options) {\r\n  \t\tsetOptions(this, options);\r\n  \t\tthis._latlng = toLatLng(latlng);\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tthis._zoomAnimated = this._zoomAnimated && map.options.markerZoomAnimation;\r\n\r\n  \t\tif (this._zoomAnimated) {\r\n  \t\t\tmap.on('zoomanim', this._animateZoom, this);\r\n  \t\t}\r\n\r\n  \t\tthis._initIcon();\r\n  \t\tthis.update();\r\n  \t},\r\n\r\n  \tonRemove: function (map) {\r\n  \t\tif (this.dragging && this.dragging.enabled()) {\r\n  \t\t\tthis.options.draggable = true;\r\n  \t\t\tthis.dragging.removeHooks();\r\n  \t\t}\r\n  \t\tdelete this.dragging;\r\n\r\n  \t\tif (this._zoomAnimated) {\r\n  \t\t\tmap.off('zoomanim', this._animateZoom, this);\r\n  \t\t}\r\n\r\n  \t\tthis._removeIcon();\r\n  \t\tthis._removeShadow();\r\n  \t},\r\n\r\n  \tgetEvents: function () {\r\n  \t\treturn {\r\n  \t\t\tzoom: this.update,\r\n  \t\t\tviewreset: this.update\r\n  \t\t};\r\n  \t},\r\n\r\n  \t// @method getLatLng: LatLng\r\n  \t// Returns the current geographical position of the marker.\r\n  \tgetLatLng: function () {\r\n  \t\treturn this._latlng;\r\n  \t},\r\n\r\n  \t// @method setLatLng(latlng: LatLng): this\r\n  \t// Changes the marker position to the given point.\r\n  \tsetLatLng: function (latlng) {\r\n  \t\tvar oldLatLng = this._latlng;\r\n  \t\tthis._latlng = toLatLng(latlng);\r\n  \t\tthis.update();\r\n\r\n  \t\t// @event move: Event\r\n  \t\t// Fired when the marker is moved via [`setLatLng`](#marker-setlatlng) or by [dragging](#marker-dragging). Old and new coordinates are included in event arguments as `oldLatLng`, `latlng`.\r\n  \t\treturn this.fire('move', {oldLatLng: oldLatLng, latlng: this._latlng});\r\n  \t},\r\n\r\n  \t// @method setZIndexOffset(offset: Number): this\r\n  \t// Changes the [zIndex offset](#marker-zindexoffset) of the marker.\r\n  \tsetZIndexOffset: function (offset) {\r\n  \t\tthis.options.zIndexOffset = offset;\r\n  \t\treturn this.update();\r\n  \t},\r\n\r\n  \t// @method getIcon: Icon\r\n  \t// Returns the current icon used by the marker\r\n  \tgetIcon: function () {\r\n  \t\treturn this.options.icon;\r\n  \t},\r\n\r\n  \t// @method setIcon(icon: Icon): this\r\n  \t// Changes the marker icon.\r\n  \tsetIcon: function (icon) {\r\n\r\n  \t\tthis.options.icon = icon;\r\n\r\n  \t\tif (this._map) {\r\n  \t\t\tthis._initIcon();\r\n  \t\t\tthis.update();\r\n  \t\t}\r\n\r\n  \t\tif (this._popup) {\r\n  \t\t\tthis.bindPopup(this._popup, this._popup.options);\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \tgetElement: function () {\r\n  \t\treturn this._icon;\r\n  \t},\r\n\r\n  \tupdate: function () {\r\n\r\n  \t\tif (this._icon && this._map) {\r\n  \t\t\tvar pos = this._map.latLngToLayerPoint(this._latlng).round();\r\n  \t\t\tthis._setPos(pos);\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_initIcon: function () {\r\n  \t\tvar options = this.options,\r\n  \t\t    classToAdd = 'leaflet-zoom-' + (this._zoomAnimated ? 'animated' : 'hide');\r\n\r\n  \t\tvar icon = options.icon.createIcon(this._icon),\r\n  \t\t    addIcon = false;\r\n\r\n  \t\t// if we're not reusing the icon, remove the old one and init new one\r\n  \t\tif (icon !== this._icon) {\r\n  \t\t\tif (this._icon) {\r\n  \t\t\t\tthis._removeIcon();\r\n  \t\t\t}\r\n  \t\t\taddIcon = true;\r\n\r\n  \t\t\tif (options.title) {\r\n  \t\t\t\ticon.title = options.title;\r\n  \t\t\t}\r\n\r\n  \t\t\tif (icon.tagName === 'IMG') {\r\n  \t\t\t\ticon.alt = options.alt || '';\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\taddClass(icon, classToAdd);\r\n\r\n  \t\tif (options.keyboard) {\r\n  \t\t\ticon.tabIndex = '0';\r\n  \t\t\ticon.setAttribute('role', 'button');\r\n  \t\t}\r\n\r\n  \t\tthis._icon = icon;\r\n\r\n  \t\tif (options.riseOnHover) {\r\n  \t\t\tthis.on({\r\n  \t\t\t\tmouseover: this._bringToFront,\r\n  \t\t\t\tmouseout: this._resetZIndex\r\n  \t\t\t});\r\n  \t\t}\r\n\r\n  \t\tif (this.options.autoPanOnFocus) {\r\n  \t\t\ton(icon, 'focus', this._panOnFocus, this);\r\n  \t\t}\r\n\r\n  \t\tvar newShadow = options.icon.createShadow(this._shadow),\r\n  \t\t    addShadow = false;\r\n\r\n  \t\tif (newShadow !== this._shadow) {\r\n  \t\t\tthis._removeShadow();\r\n  \t\t\taddShadow = true;\r\n  \t\t}\r\n\r\n  \t\tif (newShadow) {\r\n  \t\t\taddClass(newShadow, classToAdd);\r\n  \t\t\tnewShadow.alt = '';\r\n  \t\t}\r\n  \t\tthis._shadow = newShadow;\r\n\r\n\r\n  \t\tif (options.opacity < 1) {\r\n  \t\t\tthis._updateOpacity();\r\n  \t\t}\r\n\r\n\r\n  \t\tif (addIcon) {\r\n  \t\t\tthis.getPane().appendChild(this._icon);\r\n  \t\t}\r\n  \t\tthis._initInteraction();\r\n  \t\tif (newShadow && addShadow) {\r\n  \t\t\tthis.getPane(options.shadowPane).appendChild(this._shadow);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_removeIcon: function () {\r\n  \t\tif (this.options.riseOnHover) {\r\n  \t\t\tthis.off({\r\n  \t\t\t\tmouseover: this._bringToFront,\r\n  \t\t\t\tmouseout: this._resetZIndex\r\n  \t\t\t});\r\n  \t\t}\r\n\r\n  \t\tif (this.options.autoPanOnFocus) {\r\n  \t\t\toff(this._icon, 'focus', this._panOnFocus, this);\r\n  \t\t}\r\n\r\n  \t\tremove(this._icon);\r\n  \t\tthis.removeInteractiveTarget(this._icon);\r\n\r\n  \t\tthis._icon = null;\r\n  \t},\r\n\r\n  \t_removeShadow: function () {\r\n  \t\tif (this._shadow) {\r\n  \t\t\tremove(this._shadow);\r\n  \t\t}\r\n  \t\tthis._shadow = null;\r\n  \t},\r\n\r\n  \t_setPos: function (pos) {\r\n\r\n  \t\tif (this._icon) {\r\n  \t\t\tsetPosition(this._icon, pos);\r\n  \t\t}\r\n\r\n  \t\tif (this._shadow) {\r\n  \t\t\tsetPosition(this._shadow, pos);\r\n  \t\t}\r\n\r\n  \t\tthis._zIndex = pos.y + this.options.zIndexOffset;\r\n\r\n  \t\tthis._resetZIndex();\r\n  \t},\r\n\r\n  \t_updateZIndex: function (offset) {\r\n  \t\tif (this._icon) {\r\n  \t\t\tthis._icon.style.zIndex = this._zIndex + offset;\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_animateZoom: function (opt) {\r\n  \t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, opt.zoom, opt.center).round();\r\n\r\n  \t\tthis._setPos(pos);\r\n  \t},\r\n\r\n  \t_initInteraction: function () {\r\n\r\n  \t\tif (!this.options.interactive) { return; }\r\n\r\n  \t\taddClass(this._icon, 'leaflet-interactive');\r\n\r\n  \t\tthis.addInteractiveTarget(this._icon);\r\n\r\n  \t\tif (MarkerDrag) {\r\n  \t\t\tvar draggable = this.options.draggable;\r\n  \t\t\tif (this.dragging) {\r\n  \t\t\t\tdraggable = this.dragging.enabled();\r\n  \t\t\t\tthis.dragging.disable();\r\n  \t\t\t}\r\n\r\n  \t\t\tthis.dragging = new MarkerDrag(this);\r\n\r\n  \t\t\tif (draggable) {\r\n  \t\t\t\tthis.dragging.enable();\r\n  \t\t\t}\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method setOpacity(opacity: Number): this\r\n  \t// Changes the opacity of the marker.\r\n  \tsetOpacity: function (opacity) {\r\n  \t\tthis.options.opacity = opacity;\r\n  \t\tif (this._map) {\r\n  \t\t\tthis._updateOpacity();\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t_updateOpacity: function () {\r\n  \t\tvar opacity = this.options.opacity;\r\n\r\n  \t\tif (this._icon) {\r\n  \t\t\tsetOpacity(this._icon, opacity);\r\n  \t\t}\r\n\r\n  \t\tif (this._shadow) {\r\n  \t\t\tsetOpacity(this._shadow, opacity);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_bringToFront: function () {\r\n  \t\tthis._updateZIndex(this.options.riseOffset);\r\n  \t},\r\n\r\n  \t_resetZIndex: function () {\r\n  \t\tthis._updateZIndex(0);\r\n  \t},\r\n\r\n  \t_panOnFocus: function () {\r\n  \t\tvar map = this._map;\r\n  \t\tif (!map) { return; }\r\n\r\n  \t\tvar iconOpts = this.options.icon.options;\r\n  \t\tvar size = iconOpts.iconSize ? toPoint(iconOpts.iconSize) : toPoint(0, 0);\r\n  \t\tvar anchor = iconOpts.iconAnchor ? toPoint(iconOpts.iconAnchor) : toPoint(0, 0);\r\n\r\n  \t\tmap.panInside(this._latlng, {\r\n  \t\t\tpaddingTopLeft: anchor,\r\n  \t\t\tpaddingBottomRight: size.subtract(anchor)\r\n  \t\t});\r\n  \t},\r\n\r\n  \t_getPopupAnchor: function () {\r\n  \t\treturn this.options.icon.options.popupAnchor;\r\n  \t},\r\n\r\n  \t_getTooltipAnchor: function () {\r\n  \t\treturn this.options.icon.options.tooltipAnchor;\r\n  \t}\r\n  });\r\n\r\n\r\n  // factory L.marker(latlng: LatLng, options? : Marker options)\r\n\r\n  // @factory L.marker(latlng: LatLng, options? : Marker options)\r\n  // Instantiates a Marker object given a geographical point and optionally an options object.\r\n  function marker(latlng, options) {\r\n  \treturn new Marker(latlng, options);\r\n  }\n\n  /*\n   * @class Path\n   * @aka L.Path\n   * @inherits Interactive layer\n   *\n   * An abstract class that contains options and constants shared between vector\n   * overlays (Polygon, Polyline, Circle). Do not use it directly. Extends `Layer`.\n   */\n\n  var Path = Layer.extend({\n\n  \t// @section\n  \t// @aka Path options\n  \toptions: {\n  \t\t// @option stroke: Boolean = true\n  \t\t// Whether to draw stroke along the path. Set it to `false` to disable borders on polygons or circles.\n  \t\tstroke: true,\n\n  \t\t// @option color: String = '#3388ff'\n  \t\t// Stroke color\n  \t\tcolor: '#3388ff',\n\n  \t\t// @option weight: Number = 3\n  \t\t// Stroke width in pixels\n  \t\tweight: 3,\n\n  \t\t// @option opacity: Number = 1.0\n  \t\t// Stroke opacity\n  \t\topacity: 1,\n\n  \t\t// @option lineCap: String= 'round'\n  \t\t// A string that defines [shape to be used at the end](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-linecap) of the stroke.\n  \t\tlineCap: 'round',\n\n  \t\t// @option lineJoin: String = 'round'\n  \t\t// A string that defines [shape to be used at the corners](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-linejoin) of the stroke.\n  \t\tlineJoin: 'round',\n\n  \t\t// @option dashArray: String = null\n  \t\t// A string that defines the stroke [dash pattern](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-dasharray). Doesn't work on `Canvas`-powered layers in [some old browsers](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/setLineDash#Browser_compatibility).\n  \t\tdashArray: null,\n\n  \t\t// @option dashOffset: String = null\n  \t\t// A string that defines the [distance into the dash pattern to start the dash](https://developer.mozilla.org/docs/Web/SVG/Attribute/stroke-dashoffset). Doesn't work on `Canvas`-powered layers in [some old browsers](https://developer.mozilla.org/docs/Web/API/CanvasRenderingContext2D/setLineDash#Browser_compatibility).\n  \t\tdashOffset: null,\n\n  \t\t// @option fill: Boolean = depends\n  \t\t// Whether to fill the path with color. Set it to `false` to disable filling on polygons or circles.\n  \t\tfill: false,\n\n  \t\t// @option fillColor: String = *\n  \t\t// Fill color. Defaults to the value of the [`color`](#path-color) option\n  \t\tfillColor: null,\n\n  \t\t// @option fillOpacity: Number = 0.2\n  \t\t// Fill opacity.\n  \t\tfillOpacity: 0.2,\n\n  \t\t// @option fillRule: String = 'evenodd'\n  \t\t// A string that defines [how the inside of a shape](https://developer.mozilla.org/docs/Web/SVG/Attribute/fill-rule) is determined.\n  \t\tfillRule: 'evenodd',\n\n  \t\t// className: '',\n\n  \t\t// Option inherited from \"Interactive layer\" abstract class\n  \t\tinteractive: true,\n\n  \t\t// @option bubblingMouseEvents: Boolean = true\n  \t\t// When `true`, a mouse event on this path will trigger the same event on the map\n  \t\t// (unless [`L.DomEvent.stopPropagation`](#domevent-stoppropagation) is used).\n  \t\tbubblingMouseEvents: true\n  \t},\n\n  \tbeforeAdd: function (map) {\n  \t\t// Renderer is set here because we need to call renderer.getEvents\n  \t\t// before this.getEvents.\n  \t\tthis._renderer = map.getRenderer(this);\n  \t},\n\n  \tonAdd: function () {\n  \t\tthis._renderer._initPath(this);\n  \t\tthis._reset();\n  \t\tthis._renderer._addPath(this);\n  \t},\n\n  \tonRemove: function () {\n  \t\tthis._renderer._removePath(this);\n  \t},\n\n  \t// @method redraw(): this\n  \t// Redraws the layer. Sometimes useful after you changed the coordinates that the path uses.\n  \tredraw: function () {\n  \t\tif (this._map) {\n  \t\t\tthis._renderer._updatePath(this);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method setStyle(style: Path options): this\n  \t// Changes the appearance of a Path based on the options in the `Path options` object.\n  \tsetStyle: function (style) {\n  \t\tsetOptions(this, style);\n  \t\tif (this._renderer) {\n  \t\t\tthis._renderer._updateStyle(this);\n  \t\t\tif (this.options.stroke && style && Object.prototype.hasOwnProperty.call(style, 'weight')) {\n  \t\t\t\tthis._updateBounds();\n  \t\t\t}\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method bringToFront(): this\n  \t// Brings the layer to the top of all path layers.\n  \tbringToFront: function () {\n  \t\tif (this._renderer) {\n  \t\t\tthis._renderer._bringToFront(this);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method bringToBack(): this\n  \t// Brings the layer to the bottom of all path layers.\n  \tbringToBack: function () {\n  \t\tif (this._renderer) {\n  \t\t\tthis._renderer._bringToBack(this);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \tgetElement: function () {\n  \t\treturn this._path;\n  \t},\n\n  \t_reset: function () {\n  \t\t// defined in child classes\n  \t\tthis._project();\n  \t\tthis._update();\n  \t},\n\n  \t_clickTolerance: function () {\n  \t\t// used when doing hit detection for Canvas layers\n  \t\treturn (this.options.stroke ? this.options.weight / 2 : 0) +\n  \t\t  (this._renderer.options.tolerance || 0);\n  \t}\n  });\n\n  /*\n   * @class CircleMarker\n   * @aka L.CircleMarker\n   * @inherits Path\n   *\n   * A circle of a fixed size with radius specified in pixels. Extends `Path`.\n   */\n\n  var CircleMarker = Path.extend({\n\n  \t// @section\n  \t// @aka CircleMarker options\n  \toptions: {\n  \t\tfill: true,\n\n  \t\t// @option radius: Number = 10\n  \t\t// Radius of the circle marker, in pixels\n  \t\tradius: 10\n  \t},\n\n  \tinitialize: function (latlng, options) {\n  \t\tsetOptions(this, options);\n  \t\tthis._latlng = toLatLng(latlng);\n  \t\tthis._radius = this.options.radius;\n  \t},\n\n  \t// @method setLatLng(latLng: LatLng): this\n  \t// Sets the position of a circle marker to a new location.\n  \tsetLatLng: function (latlng) {\n  \t\tvar oldLatLng = this._latlng;\n  \t\tthis._latlng = toLatLng(latlng);\n  \t\tthis.redraw();\n\n  \t\t// @event move: Event\n  \t\t// Fired when the marker is moved via [`setLatLng`](#circlemarker-setlatlng). Old and new coordinates are included in event arguments as `oldLatLng`, `latlng`.\n  \t\treturn this.fire('move', {oldLatLng: oldLatLng, latlng: this._latlng});\n  \t},\n\n  \t// @method getLatLng(): LatLng\n  \t// Returns the current geographical position of the circle marker\n  \tgetLatLng: function () {\n  \t\treturn this._latlng;\n  \t},\n\n  \t// @method setRadius(radius: Number): this\n  \t// Sets the radius of a circle marker. Units are in pixels.\n  \tsetRadius: function (radius) {\n  \t\tthis.options.radius = this._radius = radius;\n  \t\treturn this.redraw();\n  \t},\n\n  \t// @method getRadius(): Number\n  \t// Returns the current radius of the circle\n  \tgetRadius: function () {\n  \t\treturn this._radius;\n  \t},\n\n  \tsetStyle : function (options) {\n  \t\tvar radius = options && options.radius || this._radius;\n  \t\tPath.prototype.setStyle.call(this, options);\n  \t\tthis.setRadius(radius);\n  \t\treturn this;\n  \t},\n\n  \t_project: function () {\n  \t\tthis._point = this._map.latLngToLayerPoint(this._latlng);\n  \t\tthis._updateBounds();\n  \t},\n\n  \t_updateBounds: function () {\n  \t\tvar r = this._radius,\n  \t\t    r2 = this._radiusY || r,\n  \t\t    w = this._clickTolerance(),\n  \t\t    p = [r + w, r2 + w];\n  \t\tthis._pxBounds = new Bounds(this._point.subtract(p), this._point.add(p));\n  \t},\n\n  \t_update: function () {\n  \t\tif (this._map) {\n  \t\t\tthis._updatePath();\n  \t\t}\n  \t},\n\n  \t_updatePath: function () {\n  \t\tthis._renderer._updateCircle(this);\n  \t},\n\n  \t_empty: function () {\n  \t\treturn this._radius && !this._renderer._bounds.intersects(this._pxBounds);\n  \t},\n\n  \t// Needed by the `Canvas` renderer for interactivity\n  \t_containsPoint: function (p) {\n  \t\treturn p.distanceTo(this._point) <= this._radius + this._clickTolerance();\n  \t}\n  });\n\n\n  // @factory L.circleMarker(latlng: LatLng, options?: CircleMarker options)\n  // Instantiates a circle marker object given a geographical point, and an optional options object.\n  function circleMarker(latlng, options) {\n  \treturn new CircleMarker(latlng, options);\n  }\n\n  /*\n   * @class Circle\n   * @aka L.Circle\n   * @inherits CircleMarker\n   *\n   * A class for drawing circle overlays on a map. Extends `CircleMarker`.\n   *\n   * It's an approximation and starts to diverge from a real circle closer to poles (due to projection distortion).\n   *\n   * @example\n   *\n   * ```js\n   * L.circle([50.5, 30.5], {radius: 200}).addTo(map);\n   * ```\n   */\n\n  var Circle = CircleMarker.extend({\n\n  \tinitialize: function (latlng, options, legacyOptions) {\n  \t\tif (typeof options === 'number') {\n  \t\t\t// Backwards compatibility with 0.7.x factory (latlng, radius, options?)\n  \t\t\toptions = extend({}, legacyOptions, {radius: options});\n  \t\t}\n  \t\tsetOptions(this, options);\n  \t\tthis._latlng = toLatLng(latlng);\n\n  \t\tif (isNaN(this.options.radius)) { throw new Error('Circle radius cannot be NaN'); }\n\n  \t\t// @section\n  \t\t// @aka Circle options\n  \t\t// @option radius: Number; Radius of the circle, in meters.\n  \t\tthis._mRadius = this.options.radius;\n  \t},\n\n  \t// @method setRadius(radius: Number): this\n  \t// Sets the radius of a circle. Units are in meters.\n  \tsetRadius: function (radius) {\n  \t\tthis._mRadius = radius;\n  \t\treturn this.redraw();\n  \t},\n\n  \t// @method getRadius(): Number\n  \t// Returns the current radius of a circle. Units are in meters.\n  \tgetRadius: function () {\n  \t\treturn this._mRadius;\n  \t},\n\n  \t// @method getBounds(): LatLngBounds\n  \t// Returns the `LatLngBounds` of the path.\n  \tgetBounds: function () {\n  \t\tvar half = [this._radius, this._radiusY || this._radius];\n\n  \t\treturn new LatLngBounds(\n  \t\t\tthis._map.layerPointToLatLng(this._point.subtract(half)),\n  \t\t\tthis._map.layerPointToLatLng(this._point.add(half)));\n  \t},\n\n  \tsetStyle: Path.prototype.setStyle,\n\n  \t_project: function () {\n\n  \t\tvar lng = this._latlng.lng,\n  \t\t    lat = this._latlng.lat,\n  \t\t    map = this._map,\n  \t\t    crs = map.options.crs;\n\n  \t\tif (crs.distance === Earth.distance) {\n  \t\t\tvar d = Math.PI / 180,\n  \t\t\t    latR = (this._mRadius / Earth.R) / d,\n  \t\t\t    top = map.project([lat + latR, lng]),\n  \t\t\t    bottom = map.project([lat - latR, lng]),\n  \t\t\t    p = top.add(bottom).divideBy(2),\n  \t\t\t    lat2 = map.unproject(p).lat,\n  \t\t\t    lngR = Math.acos((Math.cos(latR * d) - Math.sin(lat * d) * Math.sin(lat2 * d)) /\n  \t\t\t            (Math.cos(lat * d) * Math.cos(lat2 * d))) / d;\n\n  \t\t\tif (isNaN(lngR) || lngR === 0) {\n  \t\t\t\tlngR = latR / Math.cos(Math.PI / 180 * lat); // Fallback for edge case, #2425\n  \t\t\t}\n\n  \t\t\tthis._point = p.subtract(map.getPixelOrigin());\n  \t\t\tthis._radius = isNaN(lngR) ? 0 : p.x - map.project([lat2, lng - lngR]).x;\n  \t\t\tthis._radiusY = p.y - top.y;\n\n  \t\t} else {\n  \t\t\tvar latlng2 = crs.unproject(crs.project(this._latlng).subtract([this._mRadius, 0]));\n\n  \t\t\tthis._point = map.latLngToLayerPoint(this._latlng);\n  \t\t\tthis._radius = this._point.x - map.latLngToLayerPoint(latlng2).x;\n  \t\t}\n\n  \t\tthis._updateBounds();\n  \t}\n  });\n\n  // @factory L.circle(latlng: LatLng, options?: Circle options)\n  // Instantiates a circle object given a geographical point, and an options object\n  // which contains the circle radius.\n  // @alternative\n  // @factory L.circle(latlng: LatLng, radius: Number, options?: Circle options)\n  // Obsolete way of instantiating a circle, for compatibility with 0.7.x code.\n  // Do not use in new applications or plugins.\n  function circle(latlng, options, legacyOptions) {\n  \treturn new Circle(latlng, options, legacyOptions);\n  }\n\n  /*\n   * @class Polyline\n   * @aka L.Polyline\n   * @inherits Path\n   *\n   * A class for drawing polyline overlays on a map. Extends `Path`.\n   *\n   * @example\n   *\n   * ```js\n   * // create a red polyline from an array of LatLng points\n   * var latlngs = [\n   * \t[45.51, -122.68],\n   * \t[37.77, -122.43],\n   * \t[34.04, -118.2]\n   * ];\n   *\n   * var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);\n   *\n   * // zoom the map to the polyline\n   * map.fitBounds(polyline.getBounds());\n   * ```\n   *\n   * You can also pass a multi-dimensional array to represent a `MultiPolyline` shape:\n   *\n   * ```js\n   * // create a red polyline from an array of arrays of LatLng points\n   * var latlngs = [\n   * \t[[45.51, -122.68],\n   * \t [37.77, -122.43],\n   * \t [34.04, -118.2]],\n   * \t[[40.78, -73.91],\n   * \t [41.83, -87.62],\n   * \t [32.76, -96.72]]\n   * ];\n   * ```\n   */\n\n\n  var Polyline = Path.extend({\n\n  \t// @section\n  \t// @aka Polyline options\n  \toptions: {\n  \t\t// @option smoothFactor: Number = 1.0\n  \t\t// How much to simplify the polyline on each zoom level. More means\n  \t\t// better performance and smoother look, and less means more accurate representation.\n  \t\tsmoothFactor: 1.0,\n\n  \t\t// @option noClip: Boolean = false\n  \t\t// Disable polyline clipping.\n  \t\tnoClip: false\n  \t},\n\n  \tinitialize: function (latlngs, options) {\n  \t\tsetOptions(this, options);\n  \t\tthis._setLatLngs(latlngs);\n  \t},\n\n  \t// @method getLatLngs(): LatLng[]\n  \t// Returns an array of the points in the path, or nested arrays of points in case of multi-polyline.\n  \tgetLatLngs: function () {\n  \t\treturn this._latlngs;\n  \t},\n\n  \t// @method setLatLngs(latlngs: LatLng[]): this\n  \t// Replaces all the points in the polyline with the given array of geographical points.\n  \tsetLatLngs: function (latlngs) {\n  \t\tthis._setLatLngs(latlngs);\n  \t\treturn this.redraw();\n  \t},\n\n  \t// @method isEmpty(): Boolean\n  \t// Returns `true` if the Polyline has no LatLngs.\n  \tisEmpty: function () {\n  \t\treturn !this._latlngs.length;\n  \t},\n\n  \t// @method closestLayerPoint(p: Point): Point\n  \t// Returns the point closest to `p` on the Polyline.\n  \tclosestLayerPoint: function (p) {\n  \t\tvar minDistance = Infinity,\n  \t\t    minPoint = null,\n  \t\t    closest = _sqClosestPointOnSegment,\n  \t\t    p1, p2;\n\n  \t\tfor (var j = 0, jLen = this._parts.length; j < jLen; j++) {\n  \t\t\tvar points = this._parts[j];\n\n  \t\t\tfor (var i = 1, len = points.length; i < len; i++) {\n  \t\t\t\tp1 = points[i - 1];\n  \t\t\t\tp2 = points[i];\n\n  \t\t\t\tvar sqDist = closest(p, p1, p2, true);\n\n  \t\t\t\tif (sqDist < minDistance) {\n  \t\t\t\t\tminDistance = sqDist;\n  \t\t\t\t\tminPoint = closest(p, p1, p2);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t\tif (minPoint) {\n  \t\t\tminPoint.distance = Math.sqrt(minDistance);\n  \t\t}\n  \t\treturn minPoint;\n  \t},\n\n  \t// @method getCenter(): LatLng\n  \t// Returns the center ([centroid](https://en.wikipedia.org/wiki/Centroid)) of the polyline.\n  \tgetCenter: function () {\n  \t\t// throws error when not yet added to map as this center calculation requires projected coordinates\n  \t\tif (!this._map) {\n  \t\t\tthrow new Error('Must add layer to map before using getCenter()');\n  \t\t}\n  \t\treturn polylineCenter(this._defaultShape(), this._map.options.crs);\n  \t},\n\n  \t// @method getBounds(): LatLngBounds\n  \t// Returns the `LatLngBounds` of the path.\n  \tgetBounds: function () {\n  \t\treturn this._bounds;\n  \t},\n\n  \t// @method addLatLng(latlng: LatLng, latlngs?: LatLng[]): this\n  \t// Adds a given point to the polyline. By default, adds to the first ring of\n  \t// the polyline in case of a multi-polyline, but can be overridden by passing\n  \t// a specific ring as a LatLng array (that you can earlier access with [`getLatLngs`](#polyline-getlatlngs)).\n  \taddLatLng: function (latlng, latlngs) {\n  \t\tlatlngs = latlngs || this._defaultShape();\n  \t\tlatlng = toLatLng(latlng);\n  \t\tlatlngs.push(latlng);\n  \t\tthis._bounds.extend(latlng);\n  \t\treturn this.redraw();\n  \t},\n\n  \t_setLatLngs: function (latlngs) {\n  \t\tthis._bounds = new LatLngBounds();\n  \t\tthis._latlngs = this._convertLatLngs(latlngs);\n  \t},\n\n  \t_defaultShape: function () {\n  \t\treturn isFlat(this._latlngs) ? this._latlngs : this._latlngs[0];\n  \t},\n\n  \t// recursively convert latlngs input into actual LatLng instances; calculate bounds along the way\n  \t_convertLatLngs: function (latlngs) {\n  \t\tvar result = [],\n  \t\t    flat = isFlat(latlngs);\n\n  \t\tfor (var i = 0, len = latlngs.length; i < len; i++) {\n  \t\t\tif (flat) {\n  \t\t\t\tresult[i] = toLatLng(latlngs[i]);\n  \t\t\t\tthis._bounds.extend(result[i]);\n  \t\t\t} else {\n  \t\t\t\tresult[i] = this._convertLatLngs(latlngs[i]);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result;\n  \t},\n\n  \t_project: function () {\n  \t\tvar pxBounds = new Bounds();\n  \t\tthis._rings = [];\n  \t\tthis._projectLatlngs(this._latlngs, this._rings, pxBounds);\n\n  \t\tif (this._bounds.isValid() && pxBounds.isValid()) {\n  \t\t\tthis._rawPxBounds = pxBounds;\n  \t\t\tthis._updateBounds();\n  \t\t}\n  \t},\n\n  \t_updateBounds: function () {\n  \t\tvar w = this._clickTolerance(),\n  \t\t    p = new Point(w, w);\n\n  \t\tif (!this._rawPxBounds) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._pxBounds = new Bounds([\n  \t\t\tthis._rawPxBounds.min.subtract(p),\n  \t\t\tthis._rawPxBounds.max.add(p)\n  \t\t]);\n  \t},\n\n  \t// recursively turns latlngs into a set of rings with projected coordinates\n  \t_projectLatlngs: function (latlngs, result, projectedBounds) {\n  \t\tvar flat = latlngs[0] instanceof LatLng,\n  \t\t    len = latlngs.length,\n  \t\t    i, ring;\n\n  \t\tif (flat) {\n  \t\t\tring = [];\n  \t\t\tfor (i = 0; i < len; i++) {\n  \t\t\t\tring[i] = this._map.latLngToLayerPoint(latlngs[i]);\n  \t\t\t\tprojectedBounds.extend(ring[i]);\n  \t\t\t}\n  \t\t\tresult.push(ring);\n  \t\t} else {\n  \t\t\tfor (i = 0; i < len; i++) {\n  \t\t\t\tthis._projectLatlngs(latlngs[i], result, projectedBounds);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \t// clip polyline by renderer bounds so that we have less to render for performance\n  \t_clipPoints: function () {\n  \t\tvar bounds = this._renderer._bounds;\n\n  \t\tthis._parts = [];\n  \t\tif (!this._pxBounds || !this._pxBounds.intersects(bounds)) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (this.options.noClip) {\n  \t\t\tthis._parts = this._rings;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar parts = this._parts,\n  \t\t    i, j, k, len, len2, segment, points;\n\n  \t\tfor (i = 0, k = 0, len = this._rings.length; i < len; i++) {\n  \t\t\tpoints = this._rings[i];\n\n  \t\t\tfor (j = 0, len2 = points.length; j < len2 - 1; j++) {\n  \t\t\t\tsegment = clipSegment(points[j], points[j + 1], bounds, j, true);\n\n  \t\t\t\tif (!segment) { continue; }\n\n  \t\t\t\tparts[k] = parts[k] || [];\n  \t\t\t\tparts[k].push(segment[0]);\n\n  \t\t\t\t// if segment goes out of screen, or it's the last one, it's the end of the line part\n  \t\t\t\tif ((segment[1] !== points[j + 1]) || (j === len2 - 2)) {\n  \t\t\t\t\tparts[k].push(segment[1]);\n  \t\t\t\t\tk++;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \t// simplify each clipped part of the polyline for performance\n  \t_simplifyPoints: function () {\n  \t\tvar parts = this._parts,\n  \t\t    tolerance = this.options.smoothFactor;\n\n  \t\tfor (var i = 0, len = parts.length; i < len; i++) {\n  \t\t\tparts[i] = simplify(parts[i], tolerance);\n  \t\t}\n  \t},\n\n  \t_update: function () {\n  \t\tif (!this._map) { return; }\n\n  \t\tthis._clipPoints();\n  \t\tthis._simplifyPoints();\n  \t\tthis._updatePath();\n  \t},\n\n  \t_updatePath: function () {\n  \t\tthis._renderer._updatePoly(this);\n  \t},\n\n  \t// Needed by the `Canvas` renderer for interactivity\n  \t_containsPoint: function (p, closed) {\n  \t\tvar i, j, k, len, len2, part,\n  \t\t    w = this._clickTolerance();\n\n  \t\tif (!this._pxBounds || !this._pxBounds.contains(p)) { return false; }\n\n  \t\t// hit detection for polylines\n  \t\tfor (i = 0, len = this._parts.length; i < len; i++) {\n  \t\t\tpart = this._parts[i];\n\n  \t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\n  \t\t\t\tif (!closed && (j === 0)) { continue; }\n\n  \t\t\t\tif (pointToSegmentDistance(p, part[k], part[j]) <= w) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t\treturn false;\n  \t}\n  });\n\n  // @factory L.polyline(latlngs: LatLng[], options?: Polyline options)\n  // Instantiates a polyline object given an array of geographical points and\n  // optionally an options object. You can create a `Polyline` object with\n  // multiple separate lines (`MultiPolyline`) by passing an array of arrays\n  // of geographic points.\n  function polyline(latlngs, options) {\n  \treturn new Polyline(latlngs, options);\n  }\n\n  // Retrocompat. Allow plugins to support Leaflet versions before and after 1.1.\n  Polyline._flat = _flat;\n\n  /*\n   * @class Polygon\n   * @aka L.Polygon\n   * @inherits Polyline\n   *\n   * A class for drawing polygon overlays on a map. Extends `Polyline`.\n   *\n   * Note that points you pass when creating a polygon shouldn't have an additional last point equal to the first one  it's better to filter out such points.\n   *\n   *\n   * @example\n   *\n   * ```js\n   * // create a red polygon from an array of LatLng points\n   * var latlngs = [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]];\n   *\n   * var polygon = L.polygon(latlngs, {color: 'red'}).addTo(map);\n   *\n   * // zoom the map to the polygon\n   * map.fitBounds(polygon.getBounds());\n   * ```\n   *\n   * You can also pass an array of arrays of latlngs, with the first array representing the outer shape and the other arrays representing holes in the outer shape:\n   *\n   * ```js\n   * var latlngs = [\n   *   [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]], // outer ring\n   *   [[37.29, -108.58],[40.71, -108.58],[40.71, -102.50],[37.29, -102.50]] // hole\n   * ];\n   * ```\n   *\n   * Additionally, you can pass a multi-dimensional array to represent a MultiPolygon shape.\n   *\n   * ```js\n   * var latlngs = [\n   *   [ // first polygon\n   *     [[37, -109.05],[41, -109.03],[41, -102.05],[37, -102.04]], // outer ring\n   *     [[37.29, -108.58],[40.71, -108.58],[40.71, -102.50],[37.29, -102.50]] // hole\n   *   ],\n   *   [ // second polygon\n   *     [[41, -111.03],[45, -111.04],[45, -104.05],[41, -104.05]]\n   *   ]\n   * ];\n   * ```\n   */\n\n  var Polygon = Polyline.extend({\n\n  \toptions: {\n  \t\tfill: true\n  \t},\n\n  \tisEmpty: function () {\n  \t\treturn !this._latlngs.length || !this._latlngs[0].length;\n  \t},\n\n  \t// @method getCenter(): LatLng\n  \t// Returns the center ([centroid](http://en.wikipedia.org/wiki/Centroid)) of the Polygon.\n  \tgetCenter: function () {\n  \t\t// throws error when not yet added to map as this center calculation requires projected coordinates\n  \t\tif (!this._map) {\n  \t\t\tthrow new Error('Must add layer to map before using getCenter()');\n  \t\t}\n  \t\treturn polygonCenter(this._defaultShape(), this._map.options.crs);\n  \t},\n\n  \t_convertLatLngs: function (latlngs) {\n  \t\tvar result = Polyline.prototype._convertLatLngs.call(this, latlngs),\n  \t\t    len = result.length;\n\n  \t\t// remove last point if it equals first one\n  \t\tif (len >= 2 && result[0] instanceof LatLng && result[0].equals(result[len - 1])) {\n  \t\t\tresult.pop();\n  \t\t}\n  \t\treturn result;\n  \t},\n\n  \t_setLatLngs: function (latlngs) {\n  \t\tPolyline.prototype._setLatLngs.call(this, latlngs);\n  \t\tif (isFlat(this._latlngs)) {\n  \t\t\tthis._latlngs = [this._latlngs];\n  \t\t}\n  \t},\n\n  \t_defaultShape: function () {\n  \t\treturn isFlat(this._latlngs[0]) ? this._latlngs[0] : this._latlngs[0][0];\n  \t},\n\n  \t_clipPoints: function () {\n  \t\t// polygons need a different clipping algorithm so we redefine that\n\n  \t\tvar bounds = this._renderer._bounds,\n  \t\t    w = this.options.weight,\n  \t\t    p = new Point(w, w);\n\n  \t\t// increase clip padding by stroke width to avoid stroke on clip edges\n  \t\tbounds = new Bounds(bounds.min.subtract(p), bounds.max.add(p));\n\n  \t\tthis._parts = [];\n  \t\tif (!this._pxBounds || !this._pxBounds.intersects(bounds)) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (this.options.noClip) {\n  \t\t\tthis._parts = this._rings;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (var i = 0, len = this._rings.length, clipped; i < len; i++) {\n  \t\t\tclipped = clipPolygon(this._rings[i], bounds, true);\n  \t\t\tif (clipped.length) {\n  \t\t\t\tthis._parts.push(clipped);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \t_updatePath: function () {\n  \t\tthis._renderer._updatePoly(this, true);\n  \t},\n\n  \t// Needed by the `Canvas` renderer for interactivity\n  \t_containsPoint: function (p) {\n  \t\tvar inside = false,\n  \t\t    part, p1, p2, i, j, k, len, len2;\n\n  \t\tif (!this._pxBounds || !this._pxBounds.contains(p)) { return false; }\n\n  \t\t// ray casting algorithm for detecting if point is in polygon\n  \t\tfor (i = 0, len = this._parts.length; i < len; i++) {\n  \t\t\tpart = this._parts[i];\n\n  \t\t\tfor (j = 0, len2 = part.length, k = len2 - 1; j < len2; k = j++) {\n  \t\t\t\tp1 = part[j];\n  \t\t\t\tp2 = part[k];\n\n  \t\t\t\tif (((p1.y > p.y) !== (p2.y > p.y)) && (p.x < (p2.x - p1.x) * (p.y - p1.y) / (p2.y - p1.y) + p1.x)) {\n  \t\t\t\t\tinside = !inside;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// also check if it's on polygon stroke\n  \t\treturn inside || Polyline.prototype._containsPoint.call(this, p, true);\n  \t}\n\n  });\n\n\n  // @factory L.polygon(latlngs: LatLng[], options?: Polyline options)\n  function polygon(latlngs, options) {\n  \treturn new Polygon(latlngs, options);\n  }\n\n  /*\r\n   * @class GeoJSON\r\n   * @aka L.GeoJSON\r\n   * @inherits FeatureGroup\r\n   *\r\n   * Represents a GeoJSON object or an array of GeoJSON objects. Allows you to parse\r\n   * GeoJSON data and display it on the map. Extends `FeatureGroup`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * L.geoJSON(data, {\r\n   * \tstyle: function (feature) {\r\n   * \t\treturn {color: feature.properties.color};\r\n   * \t}\r\n   * }).bindPopup(function (layer) {\r\n   * \treturn layer.feature.properties.description;\r\n   * }).addTo(map);\r\n   * ```\r\n   */\r\n\r\n  var GeoJSON = FeatureGroup.extend({\r\n\r\n  \t/* @section\r\n  \t * @aka GeoJSON options\r\n  \t *\r\n  \t * @option pointToLayer: Function = *\r\n  \t * A `Function` defining how GeoJSON points spawn Leaflet layers. It is internally\r\n  \t * called when data is added, passing the GeoJSON point feature and its `LatLng`.\r\n  \t * The default is to spawn a default `Marker`:\r\n  \t * ```js\r\n  \t * function(geoJsonPoint, latlng) {\r\n  \t * \treturn L.marker(latlng);\r\n  \t * }\r\n  \t * ```\r\n  \t *\r\n  \t * @option style: Function = *\r\n  \t * A `Function` defining the `Path options` for styling GeoJSON lines and polygons,\r\n  \t * called internally when data is added.\r\n  \t * The default value is to not override any defaults:\r\n  \t * ```js\r\n  \t * function (geoJsonFeature) {\r\n  \t * \treturn {}\r\n  \t * }\r\n  \t * ```\r\n  \t *\r\n  \t * @option onEachFeature: Function = *\r\n  \t * A `Function` that will be called once for each created `Feature`, after it has\r\n  \t * been created and styled. Useful for attaching events and popups to features.\r\n  \t * The default is to do nothing with the newly created layers:\r\n  \t * ```js\r\n  \t * function (feature, layer) {}\r\n  \t * ```\r\n  \t *\r\n  \t * @option filter: Function = *\r\n  \t * A `Function` that will be used to decide whether to include a feature or not.\r\n  \t * The default is to include all features:\r\n  \t * ```js\r\n  \t * function (geoJsonFeature) {\r\n  \t * \treturn true;\r\n  \t * }\r\n  \t * ```\r\n  \t * Note: dynamically changing the `filter` option will have effect only on newly\r\n  \t * added data. It will _not_ re-evaluate already included features.\r\n  \t *\r\n  \t * @option coordsToLatLng: Function = *\r\n  \t * A `Function` that will be used for converting GeoJSON coordinates to `LatLng`s.\r\n  \t * The default is the `coordsToLatLng` static method.\r\n  \t *\r\n  \t * @option markersInheritOptions: Boolean = false\r\n  \t * Whether default Markers for \"Point\" type Features inherit from group options.\r\n  \t */\r\n\r\n  \tinitialize: function (geojson, options) {\r\n  \t\tsetOptions(this, options);\r\n\r\n  \t\tthis._layers = {};\r\n\r\n  \t\tif (geojson) {\r\n  \t\t\tthis.addData(geojson);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method addData( <GeoJSON> data ): this\r\n  \t// Adds a GeoJSON object to the layer.\r\n  \taddData: function (geojson) {\r\n  \t\tvar features = isArray(geojson) ? geojson : geojson.features,\r\n  \t\t    i, len, feature;\r\n\r\n  \t\tif (features) {\r\n  \t\t\tfor (i = 0, len = features.length; i < len; i++) {\r\n  \t\t\t\t// only add this if geometry or geometries are set and not null\r\n  \t\t\t\tfeature = features[i];\r\n  \t\t\t\tif (feature.geometries || feature.geometry || feature.features || feature.coordinates) {\r\n  \t\t\t\t\tthis.addData(feature);\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t\treturn this;\r\n  \t\t}\r\n\r\n  \t\tvar options = this.options;\r\n\r\n  \t\tif (options.filter && !options.filter(geojson)) { return this; }\r\n\r\n  \t\tvar layer = geometryToLayer(geojson, options);\r\n  \t\tif (!layer) {\r\n  \t\t\treturn this;\r\n  \t\t}\r\n  \t\tlayer.feature = asFeature(geojson);\r\n\r\n  \t\tlayer.defaultOptions = layer.options;\r\n  \t\tthis.resetStyle(layer);\r\n\r\n  \t\tif (options.onEachFeature) {\r\n  \t\t\toptions.onEachFeature(geojson, layer);\r\n  \t\t}\r\n\r\n  \t\treturn this.addLayer(layer);\r\n  \t},\r\n\r\n  \t// @method resetStyle( <Path> layer? ): this\r\n  \t// Resets the given vector layer's style to the original GeoJSON style, useful for resetting style after hover events.\r\n  \t// If `layer` is omitted, the style of all features in the current layer is reset.\r\n  \tresetStyle: function (layer) {\r\n  \t\tif (layer === undefined) {\r\n  \t\t\treturn this.eachLayer(this.resetStyle, this);\r\n  \t\t}\r\n  \t\t// reset any custom styles\r\n  \t\tlayer.options = extend({}, layer.defaultOptions);\r\n  \t\tthis._setLayerStyle(layer, this.options.style);\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method setStyle( <Function> style ): this\r\n  \t// Changes styles of GeoJSON vector layers with the given style function.\r\n  \tsetStyle: function (style) {\r\n  \t\treturn this.eachLayer(function (layer) {\r\n  \t\t\tthis._setLayerStyle(layer, style);\r\n  \t\t}, this);\r\n  \t},\r\n\r\n  \t_setLayerStyle: function (layer, style) {\r\n  \t\tif (layer.setStyle) {\r\n  \t\t\tif (typeof style === 'function') {\r\n  \t\t\t\tstyle = style(layer.feature);\r\n  \t\t\t}\r\n  \t\t\tlayer.setStyle(style);\r\n  \t\t}\r\n  \t}\r\n  });\r\n\r\n  // @section\r\n  // There are several static functions which can be called without instantiating L.GeoJSON:\r\n\r\n  // @function geometryToLayer(featureData: Object, options?: GeoJSON options): Layer\r\n  // Creates a `Layer` from a given GeoJSON feature. Can use a custom\r\n  // [`pointToLayer`](#geojson-pointtolayer) and/or [`coordsToLatLng`](#geojson-coordstolatlng)\r\n  // functions if provided as options.\r\n  function geometryToLayer(geojson, options) {\r\n\r\n  \tvar geometry = geojson.type === 'Feature' ? geojson.geometry : geojson,\r\n  \t    coords = geometry ? geometry.coordinates : null,\r\n  \t    layers = [],\r\n  \t    pointToLayer = options && options.pointToLayer,\r\n  \t    _coordsToLatLng = options && options.coordsToLatLng || coordsToLatLng,\r\n  \t    latlng, latlngs, i, len;\r\n\r\n  \tif (!coords && !geometry) {\r\n  \t\treturn null;\r\n  \t}\r\n\r\n  \tswitch (geometry.type) {\r\n  \tcase 'Point':\r\n  \t\tlatlng = _coordsToLatLng(coords);\r\n  \t\treturn _pointToLayer(pointToLayer, geojson, latlng, options);\r\n\r\n  \tcase 'MultiPoint':\r\n  \t\tfor (i = 0, len = coords.length; i < len; i++) {\r\n  \t\t\tlatlng = _coordsToLatLng(coords[i]);\r\n  \t\t\tlayers.push(_pointToLayer(pointToLayer, geojson, latlng, options));\r\n  \t\t}\r\n  \t\treturn new FeatureGroup(layers);\r\n\r\n  \tcase 'LineString':\r\n  \tcase 'MultiLineString':\r\n  \t\tlatlngs = coordsToLatLngs(coords, geometry.type === 'LineString' ? 0 : 1, _coordsToLatLng);\r\n  \t\treturn new Polyline(latlngs, options);\r\n\r\n  \tcase 'Polygon':\r\n  \tcase 'MultiPolygon':\r\n  \t\tlatlngs = coordsToLatLngs(coords, geometry.type === 'Polygon' ? 1 : 2, _coordsToLatLng);\r\n  \t\treturn new Polygon(latlngs, options);\r\n\r\n  \tcase 'GeometryCollection':\r\n  \t\tfor (i = 0, len = geometry.geometries.length; i < len; i++) {\r\n  \t\t\tvar geoLayer = geometryToLayer({\r\n  \t\t\t\tgeometry: geometry.geometries[i],\r\n  \t\t\t\ttype: 'Feature',\r\n  \t\t\t\tproperties: geojson.properties\r\n  \t\t\t}, options);\r\n\r\n  \t\t\tif (geoLayer) {\r\n  \t\t\t\tlayers.push(geoLayer);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\treturn new FeatureGroup(layers);\r\n\r\n  \tcase 'FeatureCollection':\r\n  \t\tfor (i = 0, len = geometry.features.length; i < len; i++) {\r\n  \t\t\tvar featureLayer = geometryToLayer(geometry.features[i], options);\r\n\r\n  \t\t\tif (featureLayer) {\r\n  \t\t\t\tlayers.push(featureLayer);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\treturn new FeatureGroup(layers);\r\n\r\n  \tdefault:\r\n  \t\tthrow new Error('Invalid GeoJSON object.');\r\n  \t}\r\n  }\r\n\r\n  function _pointToLayer(pointToLayerFn, geojson, latlng, options) {\r\n  \treturn pointToLayerFn ?\r\n  \t\tpointToLayerFn(geojson, latlng) :\r\n  \t\tnew Marker(latlng, options && options.markersInheritOptions && options);\r\n  }\r\n\r\n  // @function coordsToLatLng(coords: Array): LatLng\r\n  // Creates a `LatLng` object from an array of 2 numbers (longitude, latitude)\r\n  // or 3 numbers (longitude, latitude, altitude) used in GeoJSON for points.\r\n  function coordsToLatLng(coords) {\r\n  \treturn new LatLng(coords[1], coords[0], coords[2]);\r\n  }\r\n\r\n  // @function coordsToLatLngs(coords: Array, levelsDeep?: Number, coordsToLatLng?: Function): Array\r\n  // Creates a multidimensional array of `LatLng`s from a GeoJSON coordinates array.\r\n  // `levelsDeep` specifies the nesting level (0 is for an array of points, 1 for an array of arrays of points, etc., 0 by default).\r\n  // Can use a custom [`coordsToLatLng`](#geojson-coordstolatlng) function.\r\n  function coordsToLatLngs(coords, levelsDeep, _coordsToLatLng) {\r\n  \tvar latlngs = [];\r\n\r\n  \tfor (var i = 0, len = coords.length, latlng; i < len; i++) {\r\n  \t\tlatlng = levelsDeep ?\r\n  \t\t\tcoordsToLatLngs(coords[i], levelsDeep - 1, _coordsToLatLng) :\r\n  \t\t\t(_coordsToLatLng || coordsToLatLng)(coords[i]);\r\n\r\n  \t\tlatlngs.push(latlng);\r\n  \t}\r\n\r\n  \treturn latlngs;\r\n  }\r\n\r\n  // @function latLngToCoords(latlng: LatLng, precision?: Number|false): Array\r\n  // Reverse of [`coordsToLatLng`](#geojson-coordstolatlng)\r\n  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function.\r\n  function latLngToCoords(latlng, precision) {\r\n  \tlatlng = toLatLng(latlng);\r\n  \treturn latlng.alt !== undefined ?\r\n  \t\t[formatNum(latlng.lng, precision), formatNum(latlng.lat, precision), formatNum(latlng.alt, precision)] :\r\n  \t\t[formatNum(latlng.lng, precision), formatNum(latlng.lat, precision)];\r\n  }\r\n\r\n  // @function latLngsToCoords(latlngs: Array, levelsDeep?: Number, closed?: Boolean, precision?: Number|false): Array\r\n  // Reverse of [`coordsToLatLngs`](#geojson-coordstolatlngs)\r\n  // `closed` determines whether the first point should be appended to the end of the array to close the feature, only used when `levelsDeep` is 0. False by default.\r\n  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function.\r\n  function latLngsToCoords(latlngs, levelsDeep, closed, precision) {\r\n  \tvar coords = [];\r\n\r\n  \tfor (var i = 0, len = latlngs.length; i < len; i++) {\r\n  \t\t// Check for flat arrays required to ensure unbalanced arrays are correctly converted in recursion\r\n  \t\tcoords.push(levelsDeep ?\r\n  \t\t\tlatLngsToCoords(latlngs[i], isFlat(latlngs[i]) ? 0 : levelsDeep - 1, closed, precision) :\r\n  \t\t\tlatLngToCoords(latlngs[i], precision));\r\n  \t}\r\n\r\n  \tif (!levelsDeep && closed && coords.length > 0) {\r\n  \t\tcoords.push(coords[0].slice());\r\n  \t}\r\n\r\n  \treturn coords;\r\n  }\r\n\r\n  function getFeature(layer, newGeometry) {\r\n  \treturn layer.feature ?\r\n  \t\textend({}, layer.feature, {geometry: newGeometry}) :\r\n  \t\tasFeature(newGeometry);\r\n  }\r\n\r\n  // @function asFeature(geojson: Object): Object\r\n  // Normalize GeoJSON geometries/features into GeoJSON features.\r\n  function asFeature(geojson) {\r\n  \tif (geojson.type === 'Feature' || geojson.type === 'FeatureCollection') {\r\n  \t\treturn geojson;\r\n  \t}\r\n\r\n  \treturn {\r\n  \t\ttype: 'Feature',\r\n  \t\tproperties: {},\r\n  \t\tgeometry: geojson\r\n  \t};\r\n  }\r\n\r\n  var PointToGeoJSON = {\r\n  \ttoGeoJSON: function (precision) {\r\n  \t\treturn getFeature(this, {\r\n  \t\t\ttype: 'Point',\r\n  \t\t\tcoordinates: latLngToCoords(this.getLatLng(), precision)\r\n  \t\t});\r\n  \t}\r\n  };\r\n\r\n  // @namespace Marker\r\n  // @section Other methods\r\n  // @method toGeoJSON(precision?: Number|false): Object\r\n  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.\r\n  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the marker (as a GeoJSON `Point` Feature).\r\n  Marker.include(PointToGeoJSON);\r\n\r\n  // @namespace CircleMarker\r\n  // @method toGeoJSON(precision?: Number|false): Object\r\n  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.\r\n  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the circle marker (as a GeoJSON `Point` Feature).\r\n  Circle.include(PointToGeoJSON);\r\n  CircleMarker.include(PointToGeoJSON);\r\n\r\n\r\n  // @namespace Polyline\r\n  // @method toGeoJSON(precision?: Number|false): Object\r\n  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.\r\n  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the polyline (as a GeoJSON `LineString` or `MultiLineString` Feature).\r\n  Polyline.include({\r\n  \ttoGeoJSON: function (precision) {\r\n  \t\tvar multi = !isFlat(this._latlngs);\r\n\r\n  \t\tvar coords = latLngsToCoords(this._latlngs, multi ? 1 : 0, false, precision);\r\n\r\n  \t\treturn getFeature(this, {\r\n  \t\t\ttype: (multi ? 'Multi' : '') + 'LineString',\r\n  \t\t\tcoordinates: coords\r\n  \t\t});\r\n  \t}\r\n  });\r\n\r\n  // @namespace Polygon\r\n  // @method toGeoJSON(precision?: Number|false): Object\r\n  // Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.\r\n  // Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the polygon (as a GeoJSON `Polygon` or `MultiPolygon` Feature).\r\n  Polygon.include({\r\n  \ttoGeoJSON: function (precision) {\r\n  \t\tvar holes = !isFlat(this._latlngs),\r\n  \t\t    multi = holes && !isFlat(this._latlngs[0]);\r\n\r\n  \t\tvar coords = latLngsToCoords(this._latlngs, multi ? 2 : holes ? 1 : 0, true, precision);\r\n\r\n  \t\tif (!holes) {\r\n  \t\t\tcoords = [coords];\r\n  \t\t}\r\n\r\n  \t\treturn getFeature(this, {\r\n  \t\t\ttype: (multi ? 'Multi' : '') + 'Polygon',\r\n  \t\t\tcoordinates: coords\r\n  \t\t});\r\n  \t}\r\n  });\r\n\r\n\r\n  // @namespace LayerGroup\r\n  LayerGroup.include({\r\n  \ttoMultiPoint: function (precision) {\r\n  \t\tvar coords = [];\r\n\r\n  \t\tthis.eachLayer(function (layer) {\r\n  \t\t\tcoords.push(layer.toGeoJSON(precision).geometry.coordinates);\r\n  \t\t});\r\n\r\n  \t\treturn getFeature(this, {\r\n  \t\t\ttype: 'MultiPoint',\r\n  \t\t\tcoordinates: coords\r\n  \t\t});\r\n  \t},\r\n\r\n  \t// @method toGeoJSON(precision?: Number|false): Object\r\n  \t// Coordinates values are rounded with [`formatNum`](#util-formatnum) function with given `precision`.\r\n  \t// Returns a [`GeoJSON`](https://en.wikipedia.org/wiki/GeoJSON) representation of the layer group (as a GeoJSON `FeatureCollection`, `GeometryCollection`, or `MultiPoint`).\r\n  \ttoGeoJSON: function (precision) {\r\n\r\n  \t\tvar type = this.feature && this.feature.geometry && this.feature.geometry.type;\r\n\r\n  \t\tif (type === 'MultiPoint') {\r\n  \t\t\treturn this.toMultiPoint(precision);\r\n  \t\t}\r\n\r\n  \t\tvar isGeometryCollection = type === 'GeometryCollection',\r\n  \t\t    jsons = [];\r\n\r\n  \t\tthis.eachLayer(function (layer) {\r\n  \t\t\tif (layer.toGeoJSON) {\r\n  \t\t\t\tvar json = layer.toGeoJSON(precision);\r\n  \t\t\t\tif (isGeometryCollection) {\r\n  \t\t\t\t\tjsons.push(json.geometry);\r\n  \t\t\t\t} else {\r\n  \t\t\t\t\tvar feature = asFeature(json);\r\n  \t\t\t\t\t// Squash nested feature collections\r\n  \t\t\t\t\tif (feature.type === 'FeatureCollection') {\r\n  \t\t\t\t\t\tjsons.push.apply(jsons, feature.features);\r\n  \t\t\t\t\t} else {\r\n  \t\t\t\t\t\tjsons.push(feature);\r\n  \t\t\t\t\t}\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t});\r\n\r\n  \t\tif (isGeometryCollection) {\r\n  \t\t\treturn getFeature(this, {\r\n  \t\t\t\tgeometries: jsons,\r\n  \t\t\t\ttype: 'GeometryCollection'\r\n  \t\t\t});\r\n  \t\t}\r\n\r\n  \t\treturn {\r\n  \t\t\ttype: 'FeatureCollection',\r\n  \t\t\tfeatures: jsons\r\n  \t\t};\r\n  \t}\r\n  });\r\n\r\n  // @namespace GeoJSON\r\n  // @factory L.geoJSON(geojson?: Object, options?: GeoJSON options)\r\n  // Creates a GeoJSON layer. Optionally accepts an object in\r\n  // [GeoJSON format](https://tools.ietf.org/html/rfc7946) to display on the map\r\n  // (you can alternatively add it later with `addData` method) and an `options` object.\r\n  function geoJSON(geojson, options) {\r\n  \treturn new GeoJSON(geojson, options);\r\n  }\r\n\r\n  // Backward compatibility.\r\n  var geoJson = geoJSON;\n\n  /*\r\n   * @class ImageOverlay\r\n   * @aka L.ImageOverlay\r\n   * @inherits Interactive layer\r\n   *\r\n   * Used to load and display a single image over specific bounds of the map. Extends `Layer`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var imageUrl = 'https://maps.lib.utexas.edu/maps/historical/newark_nj_1922.jpg',\r\n   * \timageBounds = [[40.712216, -74.22655], [40.773941, -74.12544]];\r\n   * L.imageOverlay(imageUrl, imageBounds).addTo(map);\r\n   * ```\r\n   */\r\n\r\n  var ImageOverlay = Layer.extend({\r\n\r\n  \t// @section\r\n  \t// @aka ImageOverlay options\r\n  \toptions: {\r\n  \t\t// @option opacity: Number = 1.0\r\n  \t\t// The opacity of the image overlay.\r\n  \t\topacity: 1,\r\n\r\n  \t\t// @option alt: String = ''\r\n  \t\t// Text for the `alt` attribute of the image (useful for accessibility).\r\n  \t\talt: '',\r\n\r\n  \t\t// @option interactive: Boolean = false\r\n  \t\t// If `true`, the image overlay will emit [mouse events](#interactive-layer) when clicked or hovered.\r\n  \t\tinteractive: false,\r\n\r\n  \t\t// @option crossOrigin: Boolean|String = false\r\n  \t\t// Whether the crossOrigin attribute will be added to the image.\r\n  \t\t// If a String is provided, the image will have its crossOrigin attribute set to the String provided. This is needed if you want to access image pixel data.\r\n  \t\t// Refer to [CORS Settings](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes) for valid String values.\r\n  \t\tcrossOrigin: false,\r\n\r\n  \t\t// @option errorOverlayUrl: String = ''\r\n  \t\t// URL to the overlay image to show in place of the overlay that failed to load.\r\n  \t\terrorOverlayUrl: '',\r\n\r\n  \t\t// @option zIndex: Number = 1\r\n  \t\t// The explicit [zIndex](https://developer.mozilla.org/docs/Web/CSS/CSS_Positioning/Understanding_z_index) of the overlay layer.\r\n  \t\tzIndex: 1,\r\n\r\n  \t\t// @option className: String = ''\r\n  \t\t// A custom class name to assign to the image. Empty by default.\r\n  \t\tclassName: ''\r\n  \t},\r\n\r\n  \tinitialize: function (url, bounds, options) { // (String, LatLngBounds, Object)\r\n  \t\tthis._url = url;\r\n  \t\tthis._bounds = toLatLngBounds(bounds);\r\n\r\n  \t\tsetOptions(this, options);\r\n  \t},\r\n\r\n  \tonAdd: function () {\r\n  \t\tif (!this._image) {\r\n  \t\t\tthis._initImage();\r\n\r\n  \t\t\tif (this.options.opacity < 1) {\r\n  \t\t\t\tthis._updateOpacity();\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\tif (this.options.interactive) {\r\n  \t\t\taddClass(this._image, 'leaflet-interactive');\r\n  \t\t\tthis.addInteractiveTarget(this._image);\r\n  \t\t}\r\n\r\n  \t\tthis.getPane().appendChild(this._image);\r\n  \t\tthis._reset();\r\n  \t},\r\n\r\n  \tonRemove: function () {\r\n  \t\tremove(this._image);\r\n  \t\tif (this.options.interactive) {\r\n  \t\t\tthis.removeInteractiveTarget(this._image);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method setOpacity(opacity: Number): this\r\n  \t// Sets the opacity of the overlay.\r\n  \tsetOpacity: function (opacity) {\r\n  \t\tthis.options.opacity = opacity;\r\n\r\n  \t\tif (this._image) {\r\n  \t\t\tthis._updateOpacity();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \tsetStyle: function (styleOpts) {\r\n  \t\tif (styleOpts.opacity) {\r\n  \t\t\tthis.setOpacity(styleOpts.opacity);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method bringToFront(): this\r\n  \t// Brings the layer to the top of all overlays.\r\n  \tbringToFront: function () {\r\n  \t\tif (this._map) {\r\n  \t\t\ttoFront(this._image);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method bringToBack(): this\r\n  \t// Brings the layer to the bottom of all overlays.\r\n  \tbringToBack: function () {\r\n  \t\tif (this._map) {\r\n  \t\t\ttoBack(this._image);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method setUrl(url: String): this\r\n  \t// Changes the URL of the image.\r\n  \tsetUrl: function (url) {\r\n  \t\tthis._url = url;\r\n\r\n  \t\tif (this._image) {\r\n  \t\t\tthis._image.src = url;\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method setBounds(bounds: LatLngBounds): this\r\n  \t// Update the bounds that this ImageOverlay covers\r\n  \tsetBounds: function (bounds) {\r\n  \t\tthis._bounds = toLatLngBounds(bounds);\r\n\r\n  \t\tif (this._map) {\r\n  \t\t\tthis._reset();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \tgetEvents: function () {\r\n  \t\tvar events = {\r\n  \t\t\tzoom: this._reset,\r\n  \t\t\tviewreset: this._reset\r\n  \t\t};\r\n\r\n  \t\tif (this._zoomAnimated) {\r\n  \t\t\tevents.zoomanim = this._animateZoom;\r\n  \t\t}\r\n\r\n  \t\treturn events;\r\n  \t},\r\n\r\n  \t// @method setZIndex(value: Number): this\r\n  \t// Changes the [zIndex](#imageoverlay-zindex) of the image overlay.\r\n  \tsetZIndex: function (value) {\r\n  \t\tthis.options.zIndex = value;\r\n  \t\tthis._updateZIndex();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getBounds(): LatLngBounds\r\n  \t// Get the bounds that this ImageOverlay covers\r\n  \tgetBounds: function () {\r\n  \t\treturn this._bounds;\r\n  \t},\r\n\r\n  \t// @method getElement(): HTMLElement\r\n  \t// Returns the instance of [`HTMLImageElement`](https://developer.mozilla.org/docs/Web/API/HTMLImageElement)\r\n  \t// used by this overlay.\r\n  \tgetElement: function () {\r\n  \t\treturn this._image;\r\n  \t},\r\n\r\n  \t_initImage: function () {\r\n  \t\tvar wasElementSupplied = this._url.tagName === 'IMG';\r\n  \t\tvar img = this._image = wasElementSupplied ? this._url : create$1('img');\r\n\r\n  \t\taddClass(img, 'leaflet-image-layer');\r\n  \t\tif (this._zoomAnimated) { addClass(img, 'leaflet-zoom-animated'); }\r\n  \t\tif (this.options.className) { addClass(img, this.options.className); }\r\n\r\n  \t\timg.onselectstart = falseFn;\r\n  \t\timg.onmousemove = falseFn;\r\n\r\n  \t\t// @event load: Event\r\n  \t\t// Fired when the ImageOverlay layer has loaded its image\r\n  \t\timg.onload = bind(this.fire, this, 'load');\r\n  \t\timg.onerror = bind(this._overlayOnError, this, 'error');\r\n\r\n  \t\tif (this.options.crossOrigin || this.options.crossOrigin === '') {\r\n  \t\t\timg.crossOrigin = this.options.crossOrigin === true ? '' : this.options.crossOrigin;\r\n  \t\t}\r\n\r\n  \t\tif (this.options.zIndex) {\r\n  \t\t\tthis._updateZIndex();\r\n  \t\t}\r\n\r\n  \t\tif (wasElementSupplied) {\r\n  \t\t\tthis._url = img.src;\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\timg.src = this._url;\r\n  \t\timg.alt = this.options.alt;\r\n  \t},\r\n\r\n  \t_animateZoom: function (e) {\r\n  \t\tvar scale = this._map.getZoomScale(e.zoom),\r\n  \t\t    offset = this._map._latLngBoundsToNewLayerBounds(this._bounds, e.zoom, e.center).min;\r\n\r\n  \t\tsetTransform(this._image, offset, scale);\r\n  \t},\r\n\r\n  \t_reset: function () {\r\n  \t\tvar image = this._image,\r\n  \t\t    bounds = new Bounds(\r\n  \t\t        this._map.latLngToLayerPoint(this._bounds.getNorthWest()),\r\n  \t\t        this._map.latLngToLayerPoint(this._bounds.getSouthEast())),\r\n  \t\t    size = bounds.getSize();\r\n\r\n  \t\tsetPosition(image, bounds.min);\r\n\r\n  \t\timage.style.width  = size.x + 'px';\r\n  \t\timage.style.height = size.y + 'px';\r\n  \t},\r\n\r\n  \t_updateOpacity: function () {\r\n  \t\tsetOpacity(this._image, this.options.opacity);\r\n  \t},\r\n\r\n  \t_updateZIndex: function () {\r\n  \t\tif (this._image && this.options.zIndex !== undefined && this.options.zIndex !== null) {\r\n  \t\t\tthis._image.style.zIndex = this.options.zIndex;\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_overlayOnError: function () {\r\n  \t\t// @event error: Event\r\n  \t\t// Fired when the ImageOverlay layer fails to load its image\r\n  \t\tthis.fire('error');\r\n\r\n  \t\tvar errorUrl = this.options.errorOverlayUrl;\r\n  \t\tif (errorUrl && this._url !== errorUrl) {\r\n  \t\t\tthis._url = errorUrl;\r\n  \t\t\tthis._image.src = errorUrl;\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method getCenter(): LatLng\r\n  \t// Returns the center of the ImageOverlay.\r\n  \tgetCenter: function () {\r\n  \t\treturn this._bounds.getCenter();\r\n  \t}\r\n  });\r\n\r\n  // @factory L.imageOverlay(imageUrl: String, bounds: LatLngBounds, options?: ImageOverlay options)\r\n  // Instantiates an image overlay object given the URL of the image and the\r\n  // geographical bounds it is tied to.\r\n  var imageOverlay = function (url, bounds, options) {\r\n  \treturn new ImageOverlay(url, bounds, options);\r\n  };\n\n  /*\r\n   * @class VideoOverlay\r\n   * @aka L.VideoOverlay\r\n   * @inherits ImageOverlay\r\n   *\r\n   * Used to load and display a video player over specific bounds of the map. Extends `ImageOverlay`.\r\n   *\r\n   * A video overlay uses the [`<video>`](https://developer.mozilla.org/docs/Web/HTML/Element/video)\r\n   * HTML5 element.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var videoUrl = 'https://www.mapbox.com/bites/00188/patricia_nasa.webm',\r\n   * \tvideoBounds = [[ 32, -130], [ 13, -100]];\r\n   * L.videoOverlay(videoUrl, videoBounds ).addTo(map);\r\n   * ```\r\n   */\r\n\r\n  var VideoOverlay = ImageOverlay.extend({\r\n\r\n  \t// @section\r\n  \t// @aka VideoOverlay options\r\n  \toptions: {\r\n  \t\t// @option autoplay: Boolean = true\r\n  \t\t// Whether the video starts playing automatically when loaded.\r\n  \t\t// On some browsers autoplay will only work with `muted: true`\r\n  \t\tautoplay: true,\r\n\r\n  \t\t// @option loop: Boolean = true\r\n  \t\t// Whether the video will loop back to the beginning when played.\r\n  \t\tloop: true,\r\n\r\n  \t\t// @option keepAspectRatio: Boolean = true\r\n  \t\t// Whether the video will save aspect ratio after the projection.\r\n  \t\t// Relevant for supported browsers. See [browser compatibility](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit)\r\n  \t\tkeepAspectRatio: true,\r\n\r\n  \t\t// @option muted: Boolean = false\r\n  \t\t// Whether the video starts on mute when loaded.\r\n  \t\tmuted: false,\r\n\r\n  \t\t// @option playsInline: Boolean = true\r\n  \t\t// Mobile browsers will play the video right where it is instead of open it up in fullscreen mode.\r\n  \t\tplaysInline: true\r\n  \t},\r\n\r\n  \t_initImage: function () {\r\n  \t\tvar wasElementSupplied = this._url.tagName === 'VIDEO';\r\n  \t\tvar vid = this._image = wasElementSupplied ? this._url : create$1('video');\r\n\r\n  \t\taddClass(vid, 'leaflet-image-layer');\r\n  \t\tif (this._zoomAnimated) { addClass(vid, 'leaflet-zoom-animated'); }\r\n  \t\tif (this.options.className) { addClass(vid, this.options.className); }\r\n\r\n  \t\tvid.onselectstart = falseFn;\r\n  \t\tvid.onmousemove = falseFn;\r\n\r\n  \t\t// @event load: Event\r\n  \t\t// Fired when the video has finished loading the first frame\r\n  \t\tvid.onloadeddata = bind(this.fire, this, 'load');\r\n\r\n  \t\tif (wasElementSupplied) {\r\n  \t\t\tvar sourceElements = vid.getElementsByTagName('source');\r\n  \t\t\tvar sources = [];\r\n  \t\t\tfor (var j = 0; j < sourceElements.length; j++) {\r\n  \t\t\t\tsources.push(sourceElements[j].src);\r\n  \t\t\t}\r\n\r\n  \t\t\tthis._url = (sourceElements.length > 0) ? sources : [vid.src];\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tif (!isArray(this._url)) { this._url = [this._url]; }\r\n\r\n  \t\tif (!this.options.keepAspectRatio && Object.prototype.hasOwnProperty.call(vid.style, 'objectFit')) {\r\n  \t\t\tvid.style['objectFit'] = 'fill';\r\n  \t\t}\r\n  \t\tvid.autoplay = !!this.options.autoplay;\r\n  \t\tvid.loop = !!this.options.loop;\r\n  \t\tvid.muted = !!this.options.muted;\r\n  \t\tvid.playsInline = !!this.options.playsInline;\r\n  \t\tfor (var i = 0; i < this._url.length; i++) {\r\n  \t\t\tvar source = create$1('source');\r\n  \t\t\tsource.src = this._url[i];\r\n  \t\t\tvid.appendChild(source);\r\n  \t\t}\r\n  \t}\r\n\r\n  \t// @method getElement(): HTMLVideoElement\r\n  \t// Returns the instance of [`HTMLVideoElement`](https://developer.mozilla.org/docs/Web/API/HTMLVideoElement)\r\n  \t// used by this overlay.\r\n  });\r\n\r\n\r\n  // @factory L.videoOverlay(video: String|Array|HTMLVideoElement, bounds: LatLngBounds, options?: VideoOverlay options)\r\n  // Instantiates an image overlay object given the URL of the video (or array of URLs, or even a video element) and the\r\n  // geographical bounds it is tied to.\r\n\r\n  function videoOverlay(video, bounds, options) {\r\n  \treturn new VideoOverlay(video, bounds, options);\r\n  }\n\n  /*\n   * @class SVGOverlay\n   * @aka L.SVGOverlay\n   * @inherits ImageOverlay\n   *\n   * Used to load, display and provide DOM access to an SVG file over specific bounds of the map. Extends `ImageOverlay`.\n   *\n   * An SVG overlay uses the [`<svg>`](https://developer.mozilla.org/docs/Web/SVG/Element/svg) element.\n   *\n   * @example\n   *\n   * ```js\n   * var svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n   * svgElement.setAttribute('xmlns', \"http://www.w3.org/2000/svg\");\n   * svgElement.setAttribute('viewBox', \"0 0 200 200\");\n   * svgElement.innerHTML = '<rect width=\"200\" height=\"200\"/><rect x=\"75\" y=\"23\" width=\"50\" height=\"50\" style=\"fill:red\"/><rect x=\"75\" y=\"123\" width=\"50\" height=\"50\" style=\"fill:#0013ff\"/>';\n   * var svgElementBounds = [ [ 32, -130 ], [ 13, -100 ] ];\n   * L.svgOverlay(svgElement, svgElementBounds).addTo(map);\n   * ```\n   */\n\n  var SVGOverlay = ImageOverlay.extend({\n  \t_initImage: function () {\n  \t\tvar el = this._image = this._url;\n\n  \t\taddClass(el, 'leaflet-image-layer');\n  \t\tif (this._zoomAnimated) { addClass(el, 'leaflet-zoom-animated'); }\n  \t\tif (this.options.className) { addClass(el, this.options.className); }\n\n  \t\tel.onselectstart = falseFn;\n  \t\tel.onmousemove = falseFn;\n  \t}\n\n  \t// @method getElement(): SVGElement\n  \t// Returns the instance of [`SVGElement`](https://developer.mozilla.org/docs/Web/API/SVGElement)\n  \t// used by this overlay.\n  });\n\n\n  // @factory L.svgOverlay(svg: String|SVGElement, bounds: LatLngBounds, options?: SVGOverlay options)\n  // Instantiates an image overlay object given an SVG element and the geographical bounds it is tied to.\n  // A viewBox attribute is required on the SVG element to zoom in and out properly.\n\n  function svgOverlay(el, bounds, options) {\n  \treturn new SVGOverlay(el, bounds, options);\n  }\n\n  /*\r\n   * @class DivOverlay\r\n   * @inherits Interactive layer\r\n   * @aka L.DivOverlay\r\n   * Base model for L.Popup and L.Tooltip. Inherit from it for custom overlays like plugins.\r\n   */\r\n\r\n  // @namespace DivOverlay\r\n  var DivOverlay = Layer.extend({\r\n\r\n  \t// @section\r\n  \t// @aka DivOverlay options\r\n  \toptions: {\r\n  \t\t// @option interactive: Boolean = false\r\n  \t\t// If true, the popup/tooltip will listen to the mouse events.\r\n  \t\tinteractive: false,\r\n\r\n  \t\t// @option offset: Point = Point(0, 0)\r\n  \t\t// The offset of the overlay position.\r\n  \t\toffset: [0, 0],\r\n\r\n  \t\t// @option className: String = ''\r\n  \t\t// A custom CSS class name to assign to the overlay.\r\n  \t\tclassName: '',\r\n\r\n  \t\t// @option pane: String = undefined\r\n  \t\t// `Map pane` where the overlay will be added.\r\n  \t\tpane: undefined,\r\n\r\n  \t\t// @option content: String|HTMLElement|Function = ''\r\n  \t\t// Sets the HTML content of the overlay while initializing. If a function is passed the source layer will be\r\n  \t\t// passed to the function. The function should return a `String` or `HTMLElement` to be used in the overlay.\r\n  \t\tcontent: ''\r\n  \t},\r\n\r\n  \tinitialize: function (options, source) {\r\n  \t\tif (options && (options instanceof LatLng || isArray(options))) {\r\n  \t\t\tthis._latlng = toLatLng(options);\r\n  \t\t\tsetOptions(this, source);\r\n  \t\t} else {\r\n  \t\t\tsetOptions(this, options);\r\n  \t\t\tthis._source = source;\r\n  \t\t}\r\n  \t\tif (this.options.content) {\r\n  \t\t\tthis._content = this.options.content;\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @method openOn(map: Map): this\r\n  \t// Adds the overlay to the map.\r\n  \t// Alternative to `map.openPopup(popup)`/`.openTooltip(tooltip)`.\r\n  \topenOn: function (map) {\r\n  \t\tmap = arguments.length ? map : this._source._map; // experimental, not the part of public api\r\n  \t\tif (!map.hasLayer(this)) {\r\n  \t\t\tmap.addLayer(this);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method close(): this\r\n  \t// Closes the overlay.\r\n  \t// Alternative to `map.closePopup(popup)`/`.closeTooltip(tooltip)`\r\n  \t// and `layer.closePopup()`/`.closeTooltip()`.\r\n  \tclose: function () {\r\n  \t\tif (this._map) {\r\n  \t\t\tthis._map.removeLayer(this);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method toggle(layer?: Layer): this\r\n  \t// Opens or closes the overlay bound to layer depending on its current state.\r\n  \t// Argument may be omitted only for overlay bound to layer.\r\n  \t// Alternative to `layer.togglePopup()`/`.toggleTooltip()`.\r\n  \ttoggle: function (layer) {\r\n  \t\tif (this._map) {\r\n  \t\t\tthis.close();\r\n  \t\t} else {\r\n  \t\t\tif (arguments.length) {\r\n  \t\t\t\tthis._source = layer;\r\n  \t\t\t} else {\r\n  \t\t\t\tlayer = this._source;\r\n  \t\t\t}\r\n  \t\t\tthis._prepareOpen();\r\n\r\n  \t\t\t// open the overlay on the map\r\n  \t\t\tthis.openOn(layer._map);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tthis._zoomAnimated = map._zoomAnimated;\r\n\r\n  \t\tif (!this._container) {\r\n  \t\t\tthis._initLayout();\r\n  \t\t}\r\n\r\n  \t\tif (map._fadeAnimated) {\r\n  \t\t\tsetOpacity(this._container, 0);\r\n  \t\t}\r\n\r\n  \t\tclearTimeout(this._removeTimeout);\r\n  \t\tthis.getPane().appendChild(this._container);\r\n  \t\tthis.update();\r\n\r\n  \t\tif (map._fadeAnimated) {\r\n  \t\t\tsetOpacity(this._container, 1);\r\n  \t\t}\r\n\r\n  \t\tthis.bringToFront();\r\n\r\n  \t\tif (this.options.interactive) {\r\n  \t\t\taddClass(this._container, 'leaflet-interactive');\r\n  \t\t\tthis.addInteractiveTarget(this._container);\r\n  \t\t}\r\n  \t},\r\n\r\n  \tonRemove: function (map) {\r\n  \t\tif (map._fadeAnimated) {\r\n  \t\t\tsetOpacity(this._container, 0);\r\n  \t\t\tthis._removeTimeout = setTimeout(bind(remove, undefined, this._container), 200);\r\n  \t\t} else {\r\n  \t\t\tremove(this._container);\r\n  \t\t}\r\n\r\n  \t\tif (this.options.interactive) {\r\n  \t\t\tremoveClass(this._container, 'leaflet-interactive');\r\n  \t\t\tthis.removeInteractiveTarget(this._container);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t// @namespace DivOverlay\r\n  \t// @method getLatLng: LatLng\r\n  \t// Returns the geographical point of the overlay.\r\n  \tgetLatLng: function () {\r\n  \t\treturn this._latlng;\r\n  \t},\r\n\r\n  \t// @method setLatLng(latlng: LatLng): this\r\n  \t// Sets the geographical point where the overlay will open.\r\n  \tsetLatLng: function (latlng) {\r\n  \t\tthis._latlng = toLatLng(latlng);\r\n  \t\tif (this._map) {\r\n  \t\t\tthis._updatePosition();\r\n  \t\t\tthis._adjustPan();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getContent: String|HTMLElement\r\n  \t// Returns the content of the overlay.\r\n  \tgetContent: function () {\r\n  \t\treturn this._content;\r\n  \t},\r\n\r\n  \t// @method setContent(htmlContent: String|HTMLElement|Function): this\r\n  \t// Sets the HTML content of the overlay. If a function is passed the source layer will be passed to the function.\r\n  \t// The function should return a `String` or `HTMLElement` to be used in the overlay.\r\n  \tsetContent: function (content) {\r\n  \t\tthis._content = content;\r\n  \t\tthis.update();\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getElement: String|HTMLElement\r\n  \t// Returns the HTML container of the overlay.\r\n  \tgetElement: function () {\r\n  \t\treturn this._container;\r\n  \t},\r\n\r\n  \t// @method update: null\r\n  \t// Updates the overlay content, layout and position. Useful for updating the overlay after something inside changed, e.g. image loaded.\r\n  \tupdate: function () {\r\n  \t\tif (!this._map) { return; }\r\n\r\n  \t\tthis._container.style.visibility = 'hidden';\r\n\r\n  \t\tthis._updateContent();\r\n  \t\tthis._updateLayout();\r\n  \t\tthis._updatePosition();\r\n\r\n  \t\tthis._container.style.visibility = '';\r\n\r\n  \t\tthis._adjustPan();\r\n  \t},\r\n\r\n  \tgetEvents: function () {\r\n  \t\tvar events = {\r\n  \t\t\tzoom: this._updatePosition,\r\n  \t\t\tviewreset: this._updatePosition\r\n  \t\t};\r\n\r\n  \t\tif (this._zoomAnimated) {\r\n  \t\t\tevents.zoomanim = this._animateZoom;\r\n  \t\t}\r\n  \t\treturn events;\r\n  \t},\r\n\r\n  \t// @method isOpen: Boolean\r\n  \t// Returns `true` when the overlay is visible on the map.\r\n  \tisOpen: function () {\r\n  \t\treturn !!this._map && this._map.hasLayer(this);\r\n  \t},\r\n\r\n  \t// @method bringToFront: this\r\n  \t// Brings this overlay in front of other overlays (in the same map pane).\r\n  \tbringToFront: function () {\r\n  \t\tif (this._map) {\r\n  \t\t\ttoFront(this._container);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method bringToBack: this\r\n  \t// Brings this overlay to the back of other overlays (in the same map pane).\r\n  \tbringToBack: function () {\r\n  \t\tif (this._map) {\r\n  \t\t\ttoBack(this._container);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// prepare bound overlay to open: update latlng pos / content source (for FeatureGroup)\r\n  \t_prepareOpen: function (latlng) {\r\n  \t\tvar source = this._source;\r\n  \t\tif (!source._map) { return false; }\r\n\r\n  \t\tif (source instanceof FeatureGroup) {\r\n  \t\t\tsource = null;\r\n  \t\t\tvar layers = this._source._layers;\r\n  \t\t\tfor (var id in layers) {\r\n  \t\t\t\tif (layers[id]._map) {\r\n  \t\t\t\t\tsource = layers[id];\r\n  \t\t\t\t\tbreak;\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t\tif (!source) { return false; } // Unable to get source layer.\r\n\r\n  \t\t\t// set overlay source to this layer\r\n  \t\t\tthis._source = source;\r\n  \t\t}\r\n\r\n  \t\tif (!latlng) {\r\n  \t\t\tif (source.getCenter) {\r\n  \t\t\t\tlatlng = source.getCenter();\r\n  \t\t\t} else if (source.getLatLng) {\r\n  \t\t\t\tlatlng = source.getLatLng();\r\n  \t\t\t} else if (source.getBounds) {\r\n  \t\t\t\tlatlng = source.getBounds().getCenter();\r\n  \t\t\t} else {\r\n  \t\t\t\tthrow new Error('Unable to get source layer LatLng.');\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\tthis.setLatLng(latlng);\r\n\r\n  \t\tif (this._map) {\r\n  \t\t\t// update the overlay (content, layout, etc...)\r\n  \t\t\tthis.update();\r\n  \t\t}\r\n\r\n  \t\treturn true;\r\n  \t},\r\n\r\n  \t_updateContent: function () {\r\n  \t\tif (!this._content) { return; }\r\n\r\n  \t\tvar node = this._contentNode;\r\n  \t\tvar content = (typeof this._content === 'function') ? this._content(this._source || this) : this._content;\r\n\r\n  \t\tif (typeof content === 'string') {\r\n  \t\t\tnode.innerHTML = content;\r\n  \t\t} else {\r\n  \t\t\twhile (node.hasChildNodes()) {\r\n  \t\t\t\tnode.removeChild(node.firstChild);\r\n  \t\t\t}\r\n  \t\t\tnode.appendChild(content);\r\n  \t\t}\r\n\r\n  \t\t// @namespace DivOverlay\r\n  \t\t// @section DivOverlay events\r\n  \t\t// @event contentupdate: Event\r\n  \t\t// Fired when the content of the overlay is updated\r\n  \t\tthis.fire('contentupdate');\r\n  \t},\r\n\r\n  \t_updatePosition: function () {\r\n  \t\tif (!this._map) { return; }\r\n\r\n  \t\tvar pos = this._map.latLngToLayerPoint(this._latlng),\r\n  \t\t    offset = toPoint(this.options.offset),\r\n  \t\t    anchor = this._getAnchor();\r\n\r\n  \t\tif (this._zoomAnimated) {\r\n  \t\t\tsetPosition(this._container, pos.add(anchor));\r\n  \t\t} else {\r\n  \t\t\toffset = offset.add(pos).add(anchor);\r\n  \t\t}\r\n\r\n  \t\tvar bottom = this._containerBottom = -offset.y,\r\n  \t\t    left = this._containerLeft = -Math.round(this._containerWidth / 2) + offset.x;\r\n\r\n  \t\t// bottom position the overlay in case the height of the overlay changes (images loading etc)\r\n  \t\tthis._container.style.bottom = bottom + 'px';\r\n  \t\tthis._container.style.left = left + 'px';\r\n  \t},\r\n\r\n  \t_getAnchor: function () {\r\n  \t\treturn [0, 0];\r\n  \t}\r\n\r\n  });\r\n\r\n  Map.include({\r\n  \t_initOverlay: function (OverlayClass, content, latlng, options) {\r\n  \t\tvar overlay = content;\r\n  \t\tif (!(overlay instanceof OverlayClass)) {\r\n  \t\t\toverlay = new OverlayClass(options).setContent(content);\r\n  \t\t}\r\n  \t\tif (latlng) {\r\n  \t\t\toverlay.setLatLng(latlng);\r\n  \t\t}\r\n  \t\treturn overlay;\r\n  \t}\r\n  });\r\n\r\n\r\n  Layer.include({\r\n  \t_initOverlay: function (OverlayClass, old, content, options) {\r\n  \t\tvar overlay = content;\r\n  \t\tif (overlay instanceof OverlayClass) {\r\n  \t\t\tsetOptions(overlay, options);\r\n  \t\t\toverlay._source = this;\r\n  \t\t} else {\r\n  \t\t\toverlay = (old && !options) ? old : new OverlayClass(options, this);\r\n  \t\t\toverlay.setContent(content);\r\n  \t\t}\r\n  \t\treturn overlay;\r\n  \t}\r\n  });\n\n  /*\r\n   * @class Popup\r\n   * @inherits DivOverlay\r\n   * @aka L.Popup\r\n   * Used to open popups in certain places of the map. Use [Map.openPopup](#map-openpopup) to\r\n   * open popups while making sure that only one popup is open at one time\r\n   * (recommended for usability), or use [Map.addLayer](#map-addlayer) to open as many as you want.\r\n   *\r\n   * @example\r\n   *\r\n   * If you want to just bind a popup to marker click and then open it, it's really easy:\r\n   *\r\n   * ```js\r\n   * marker.bindPopup(popupContent).openPopup();\r\n   * ```\r\n   * Path overlays like polylines also have a `bindPopup` method.\r\n   *\r\n   * A popup can be also standalone:\r\n   *\r\n   * ```js\r\n   * var popup = L.popup()\r\n   * \t.setLatLng(latlng)\r\n   * \t.setContent('<p>Hello world!<br />This is a nice popup.</p>')\r\n   * \t.openOn(map);\r\n   * ```\r\n   * or\r\n   * ```js\r\n   * var popup = L.popup(latlng, {content: '<p>Hello world!<br />This is a nice popup.</p>')\r\n   * \t.openOn(map);\r\n   * ```\r\n   */\r\n\r\n\r\n  // @namespace Popup\r\n  var Popup = DivOverlay.extend({\r\n\r\n  \t// @section\r\n  \t// @aka Popup options\r\n  \toptions: {\r\n  \t\t// @option pane: String = 'popupPane'\r\n  \t\t// `Map pane` where the popup will be added.\r\n  \t\tpane: 'popupPane',\r\n\r\n  \t\t// @option offset: Point = Point(0, 7)\r\n  \t\t// The offset of the popup position.\r\n  \t\toffset: [0, 7],\r\n\r\n  \t\t// @option maxWidth: Number = 300\r\n  \t\t// Max width of the popup, in pixels.\r\n  \t\tmaxWidth: 300,\r\n\r\n  \t\t// @option minWidth: Number = 50\r\n  \t\t// Min width of the popup, in pixels.\r\n  \t\tminWidth: 50,\r\n\r\n  \t\t// @option maxHeight: Number = null\r\n  \t\t// If set, creates a scrollable container of the given height\r\n  \t\t// inside a popup if its content exceeds it.\r\n  \t\t// The scrollable container can be styled using the\r\n  \t\t// `leaflet-popup-scrolled` CSS class selector.\r\n  \t\tmaxHeight: null,\r\n\r\n  \t\t// @option autoPan: Boolean = true\r\n  \t\t// Set it to `false` if you don't want the map to do panning animation\r\n  \t\t// to fit the opened popup.\r\n  \t\tautoPan: true,\r\n\r\n  \t\t// @option autoPanPaddingTopLeft: Point = null\r\n  \t\t// The margin between the popup and the top left corner of the map\r\n  \t\t// view after autopanning was performed.\r\n  \t\tautoPanPaddingTopLeft: null,\r\n\r\n  \t\t// @option autoPanPaddingBottomRight: Point = null\r\n  \t\t// The margin between the popup and the bottom right corner of the map\r\n  \t\t// view after autopanning was performed.\r\n  \t\tautoPanPaddingBottomRight: null,\r\n\r\n  \t\t// @option autoPanPadding: Point = Point(5, 5)\r\n  \t\t// Equivalent of setting both top left and bottom right autopan padding to the same value.\r\n  \t\tautoPanPadding: [5, 5],\r\n\r\n  \t\t// @option keepInView: Boolean = false\r\n  \t\t// Set it to `true` if you want to prevent users from panning the popup\r\n  \t\t// off of the screen while it is open.\r\n  \t\tkeepInView: false,\r\n\r\n  \t\t// @option closeButton: Boolean = true\r\n  \t\t// Controls the presence of a close button in the popup.\r\n  \t\tcloseButton: true,\r\n\r\n  \t\t// @option autoClose: Boolean = true\r\n  \t\t// Set it to `false` if you want to override the default behavior of\r\n  \t\t// the popup closing when another popup is opened.\r\n  \t\tautoClose: true,\r\n\r\n  \t\t// @option closeOnEscapeKey: Boolean = true\r\n  \t\t// Set it to `false` if you want to override the default behavior of\r\n  \t\t// the ESC key for closing of the popup.\r\n  \t\tcloseOnEscapeKey: true,\r\n\r\n  \t\t// @option closeOnClick: Boolean = *\r\n  \t\t// Set it if you want to override the default behavior of the popup closing when user clicks\r\n  \t\t// on the map. Defaults to the map's [`closePopupOnClick`](#map-closepopuponclick) option.\r\n\r\n  \t\t// @option className: String = ''\r\n  \t\t// A custom CSS class name to assign to the popup.\r\n  \t\tclassName: ''\r\n  \t},\r\n\r\n  \t// @namespace Popup\r\n  \t// @method openOn(map: Map): this\r\n  \t// Alternative to `map.openPopup(popup)`.\r\n  \t// Adds the popup to the map and closes the previous one.\r\n  \topenOn: function (map) {\r\n  \t\tmap = arguments.length ? map : this._source._map; // experimental, not the part of public api\r\n\r\n  \t\tif (!map.hasLayer(this) && map._popup && map._popup.options.autoClose) {\r\n  \t\t\tmap.removeLayer(map._popup);\r\n  \t\t}\r\n  \t\tmap._popup = this;\r\n\r\n  \t\treturn DivOverlay.prototype.openOn.call(this, map);\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n  \t\tDivOverlay.prototype.onAdd.call(this, map);\r\n\r\n  \t\t// @namespace Map\r\n  \t\t// @section Popup events\r\n  \t\t// @event popupopen: PopupEvent\r\n  \t\t// Fired when a popup is opened in the map\r\n  \t\tmap.fire('popupopen', {popup: this});\r\n\r\n  \t\tif (this._source) {\r\n  \t\t\t// @namespace Layer\r\n  \t\t\t// @section Popup events\r\n  \t\t\t// @event popupopen: PopupEvent\r\n  \t\t\t// Fired when a popup bound to this layer is opened\r\n  \t\t\tthis._source.fire('popupopen', {popup: this}, true);\r\n  \t\t\t// For non-path layers, we toggle the popup when clicking\r\n  \t\t\t// again the layer, so prevent the map to reopen it.\r\n  \t\t\tif (!(this._source instanceof Path)) {\r\n  \t\t\t\tthis._source.on('preclick', stopPropagation);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t},\r\n\r\n  \tonRemove: function (map) {\r\n  \t\tDivOverlay.prototype.onRemove.call(this, map);\r\n\r\n  \t\t// @namespace Map\r\n  \t\t// @section Popup events\r\n  \t\t// @event popupclose: PopupEvent\r\n  \t\t// Fired when a popup in the map is closed\r\n  \t\tmap.fire('popupclose', {popup: this});\r\n\r\n  \t\tif (this._source) {\r\n  \t\t\t// @namespace Layer\r\n  \t\t\t// @section Popup events\r\n  \t\t\t// @event popupclose: PopupEvent\r\n  \t\t\t// Fired when a popup bound to this layer is closed\r\n  \t\t\tthis._source.fire('popupclose', {popup: this}, true);\r\n  \t\t\tif (!(this._source instanceof Path)) {\r\n  \t\t\t\tthis._source.off('preclick', stopPropagation);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t},\r\n\r\n  \tgetEvents: function () {\r\n  \t\tvar events = DivOverlay.prototype.getEvents.call(this);\r\n\r\n  \t\tif (this.options.closeOnClick !== undefined ? this.options.closeOnClick : this._map.options.closePopupOnClick) {\r\n  \t\t\tevents.preclick = this.close;\r\n  \t\t}\r\n\r\n  \t\tif (this.options.keepInView) {\r\n  \t\t\tevents.moveend = this._adjustPan;\r\n  \t\t}\r\n\r\n  \t\treturn events;\r\n  \t},\r\n\r\n  \t_initLayout: function () {\r\n  \t\tvar prefix = 'leaflet-popup',\r\n  \t\t    container = this._container = create$1('div',\r\n  \t\t\tprefix + ' ' + (this.options.className || '') +\r\n  \t\t\t' leaflet-zoom-animated');\r\n\r\n  \t\tvar wrapper = this._wrapper = create$1('div', prefix + '-content-wrapper', container);\r\n  \t\tthis._contentNode = create$1('div', prefix + '-content', wrapper);\r\n\r\n  \t\tdisableClickPropagation(container);\r\n  \t\tdisableScrollPropagation(this._contentNode);\r\n  \t\ton(container, 'contextmenu', stopPropagation);\r\n\r\n  \t\tthis._tipContainer = create$1('div', prefix + '-tip-container', container);\r\n  \t\tthis._tip = create$1('div', prefix + '-tip', this._tipContainer);\r\n\r\n  \t\tif (this.options.closeButton) {\r\n  \t\t\tvar closeButton = this._closeButton = create$1('a', prefix + '-close-button', container);\r\n  \t\t\tcloseButton.setAttribute('role', 'button'); // overrides the implicit role=link of <a> elements #7399\r\n  \t\t\tcloseButton.setAttribute('aria-label', 'Close popup');\r\n  \t\t\tcloseButton.href = '#close';\r\n  \t\t\tcloseButton.innerHTML = '<span aria-hidden=\"true\">&#215;</span>';\r\n\r\n  \t\t\ton(closeButton, 'click', function (ev) {\r\n  \t\t\t\tpreventDefault(ev);\r\n  \t\t\t\tthis.close();\r\n  \t\t\t}, this);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_updateLayout: function () {\r\n  \t\tvar container = this._contentNode,\r\n  \t\t    style = container.style;\r\n\r\n  \t\tstyle.width = '';\r\n  \t\tstyle.whiteSpace = 'nowrap';\r\n\r\n  \t\tvar width = container.offsetWidth;\r\n  \t\twidth = Math.min(width, this.options.maxWidth);\r\n  \t\twidth = Math.max(width, this.options.minWidth);\r\n\r\n  \t\tstyle.width = (width + 1) + 'px';\r\n  \t\tstyle.whiteSpace = '';\r\n\r\n  \t\tstyle.height = '';\r\n\r\n  \t\tvar height = container.offsetHeight,\r\n  \t\t    maxHeight = this.options.maxHeight,\r\n  \t\t    scrolledClass = 'leaflet-popup-scrolled';\r\n\r\n  \t\tif (maxHeight && height > maxHeight) {\r\n  \t\t\tstyle.height = maxHeight + 'px';\r\n  \t\t\taddClass(container, scrolledClass);\r\n  \t\t} else {\r\n  \t\t\tremoveClass(container, scrolledClass);\r\n  \t\t}\r\n\r\n  \t\tthis._containerWidth = this._container.offsetWidth;\r\n  \t},\r\n\r\n  \t_animateZoom: function (e) {\r\n  \t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, e.zoom, e.center),\r\n  \t\t    anchor = this._getAnchor();\r\n  \t\tsetPosition(this._container, pos.add(anchor));\r\n  \t},\r\n\r\n  \t_adjustPan: function () {\r\n  \t\tif (!this.options.autoPan) { return; }\r\n  \t\tif (this._map._panAnim) { this._map._panAnim.stop(); }\r\n\r\n  \t\t// We can endlessly recurse if keepInView is set and the view resets.\r\n  \t\t// Let's guard against that by exiting early if we're responding to our own autopan.\r\n  \t\tif (this._autopanning) {\r\n  \t\t\tthis._autopanning = false;\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\tvar map = this._map,\r\n  \t\t    marginBottom = parseInt(getStyle(this._container, 'marginBottom'), 10) || 0,\r\n  \t\t    containerHeight = this._container.offsetHeight + marginBottom,\r\n  \t\t    containerWidth = this._containerWidth,\r\n  \t\t    layerPos = new Point(this._containerLeft, -containerHeight - this._containerBottom);\r\n\r\n  \t\tlayerPos._add(getPosition(this._container));\r\n\r\n  \t\tvar containerPos = map.layerPointToContainerPoint(layerPos),\r\n  \t\t    padding = toPoint(this.options.autoPanPadding),\r\n  \t\t    paddingTL = toPoint(this.options.autoPanPaddingTopLeft || padding),\r\n  \t\t    paddingBR = toPoint(this.options.autoPanPaddingBottomRight || padding),\r\n  \t\t    size = map.getSize(),\r\n  \t\t    dx = 0,\r\n  \t\t    dy = 0;\r\n\r\n  \t\tif (containerPos.x + containerWidth + paddingBR.x > size.x) { // right\r\n  \t\t\tdx = containerPos.x + containerWidth - size.x + paddingBR.x;\r\n  \t\t}\r\n  \t\tif (containerPos.x - dx - paddingTL.x < 0) { // left\r\n  \t\t\tdx = containerPos.x - paddingTL.x;\r\n  \t\t}\r\n  \t\tif (containerPos.y + containerHeight + paddingBR.y > size.y) { // bottom\r\n  \t\t\tdy = containerPos.y + containerHeight - size.y + paddingBR.y;\r\n  \t\t}\r\n  \t\tif (containerPos.y - dy - paddingTL.y < 0) { // top\r\n  \t\t\tdy = containerPos.y - paddingTL.y;\r\n  \t\t}\r\n\r\n  \t\t// @namespace Map\r\n  \t\t// @section Popup events\r\n  \t\t// @event autopanstart: Event\r\n  \t\t// Fired when the map starts autopanning when opening a popup.\r\n  \t\tif (dx || dy) {\r\n  \t\t\t// Track that we're autopanning, as this function will be re-ran on moveend\r\n  \t\t\tif (this.options.keepInView) {\r\n  \t\t\t\tthis._autopanning = true;\r\n  \t\t\t}\r\n\r\n  \t\t\tmap\r\n  \t\t\t    .fire('autopanstart')\r\n  \t\t\t    .panBy([dx, dy]);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_getAnchor: function () {\r\n  \t\t// Where should we anchor the popup on the source layer?\r\n  \t\treturn toPoint(this._source && this._source._getPopupAnchor ? this._source._getPopupAnchor() : [0, 0]);\r\n  \t}\r\n\r\n  });\r\n\r\n  // @namespace Popup\r\n  // @factory L.popup(options?: Popup options, source?: Layer)\r\n  // Instantiates a `Popup` object given an optional `options` object that describes its appearance and location and an optional `source` object that is used to tag the popup with a reference to the Layer to which it refers.\r\n  // @alternative\r\n  // @factory L.popup(latlng: LatLng, options?: Popup options)\r\n  // Instantiates a `Popup` object given `latlng` where the popup will open and an optional `options` object that describes its appearance and location.\r\n  var popup = function (options, source) {\r\n  \treturn new Popup(options, source);\r\n  };\r\n\r\n\r\n  /* @namespace Map\r\n   * @section Interaction Options\r\n   * @option closePopupOnClick: Boolean = true\r\n   * Set it to `false` if you don't want popups to close when user clicks the map.\r\n   */\r\n  Map.mergeOptions({\r\n  \tclosePopupOnClick: true\r\n  });\r\n\r\n\r\n  // @namespace Map\r\n  // @section Methods for Layers and Controls\r\n  Map.include({\r\n  \t// @method openPopup(popup: Popup): this\r\n  \t// Opens the specified popup while closing the previously opened (to make sure only one is opened at one time for usability).\r\n  \t// @alternative\r\n  \t// @method openPopup(content: String|HTMLElement, latlng: LatLng, options?: Popup options): this\r\n  \t// Creates a popup with the specified content and options and opens it in the given point on a map.\r\n  \topenPopup: function (popup, latlng, options) {\r\n  \t\tthis._initOverlay(Popup, popup, latlng, options)\r\n  \t\t  .openOn(this);\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method closePopup(popup?: Popup): this\r\n  \t// Closes the popup previously opened with [openPopup](#map-openpopup) (or the given one).\r\n  \tclosePopup: function (popup) {\r\n  \t\tpopup = arguments.length ? popup : this._popup;\r\n  \t\tif (popup) {\r\n  \t\t\tpopup.close();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t}\r\n  });\r\n\r\n  /*\r\n   * @namespace Layer\r\n   * @section Popup methods example\r\n   *\r\n   * All layers share a set of methods convenient for binding popups to it.\r\n   *\r\n   * ```js\r\n   * var layer = L.Polygon(latlngs).bindPopup('Hi There!').addTo(map);\r\n   * layer.openPopup();\r\n   * layer.closePopup();\r\n   * ```\r\n   *\r\n   * Popups will also be automatically opened when the layer is clicked on and closed when the layer is removed from the map or another popup is opened.\r\n   */\r\n\r\n  // @section Popup methods\r\n  Layer.include({\r\n\r\n  \t// @method bindPopup(content: String|HTMLElement|Function|Popup, options?: Popup options): this\r\n  \t// Binds a popup to the layer with the passed `content` and sets up the\r\n  \t// necessary event listeners. If a `Function` is passed it will receive\r\n  \t// the layer as the first argument and should return a `String` or `HTMLElement`.\r\n  \tbindPopup: function (content, options) {\r\n  \t\tthis._popup = this._initOverlay(Popup, this._popup, content, options);\r\n  \t\tif (!this._popupHandlersAdded) {\r\n  \t\t\tthis.on({\r\n  \t\t\t\tclick: this._openPopup,\r\n  \t\t\t\tkeypress: this._onKeyPress,\r\n  \t\t\t\tremove: this.closePopup,\r\n  \t\t\t\tmove: this._movePopup\r\n  \t\t\t});\r\n  \t\t\tthis._popupHandlersAdded = true;\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method unbindPopup(): this\r\n  \t// Removes the popup previously bound with `bindPopup`.\r\n  \tunbindPopup: function () {\r\n  \t\tif (this._popup) {\r\n  \t\t\tthis.off({\r\n  \t\t\t\tclick: this._openPopup,\r\n  \t\t\t\tkeypress: this._onKeyPress,\r\n  \t\t\t\tremove: this.closePopup,\r\n  \t\t\t\tmove: this._movePopup\r\n  \t\t\t});\r\n  \t\t\tthis._popupHandlersAdded = false;\r\n  \t\t\tthis._popup = null;\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method openPopup(latlng?: LatLng): this\r\n  \t// Opens the bound popup at the specified `latlng` or at the default popup anchor if no `latlng` is passed.\r\n  \topenPopup: function (latlng) {\r\n  \t\tif (this._popup) {\r\n  \t\t\tif (!(this instanceof FeatureGroup)) {\r\n  \t\t\t\tthis._popup._source = this;\r\n  \t\t\t}\r\n  \t\t\tif (this._popup._prepareOpen(latlng || this._latlng)) {\r\n  \t\t\t\t// open the popup on the map\r\n  \t\t\t\tthis._popup.openOn(this._map);\r\n  \t\t\t}\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method closePopup(): this\r\n  \t// Closes the popup bound to this layer if it is open.\r\n  \tclosePopup: function () {\r\n  \t\tif (this._popup) {\r\n  \t\t\tthis._popup.close();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method togglePopup(): this\r\n  \t// Opens or closes the popup bound to this layer depending on its current state.\r\n  \ttogglePopup: function () {\r\n  \t\tif (this._popup) {\r\n  \t\t\tthis._popup.toggle(this);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method isPopupOpen(): boolean\r\n  \t// Returns `true` if the popup bound to this layer is currently open.\r\n  \tisPopupOpen: function () {\r\n  \t\treturn (this._popup ? this._popup.isOpen() : false);\r\n  \t},\r\n\r\n  \t// @method setPopupContent(content: String|HTMLElement|Popup): this\r\n  \t// Sets the content of the popup bound to this layer.\r\n  \tsetPopupContent: function (content) {\r\n  \t\tif (this._popup) {\r\n  \t\t\tthis._popup.setContent(content);\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method getPopup(): Popup\r\n  \t// Returns the popup bound to this layer.\r\n  \tgetPopup: function () {\r\n  \t\treturn this._popup;\r\n  \t},\r\n\r\n  \t_openPopup: function (e) {\r\n  \t\tif (!this._popup || !this._map) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n  \t\t// prevent map click\r\n  \t\tstop(e);\r\n\r\n  \t\tvar target = e.layer || e.target;\r\n  \t\tif (this._popup._source === target && !(target instanceof Path)) {\r\n  \t\t\t// treat it like a marker and figure out\r\n  \t\t\t// if we should toggle it open/closed\r\n  \t\t\tif (this._map.hasLayer(this._popup)) {\r\n  \t\t\t\tthis.closePopup();\r\n  \t\t\t} else {\r\n  \t\t\t\tthis.openPopup(e.latlng);\r\n  \t\t\t}\r\n  \t\t\treturn;\r\n  \t\t}\r\n  \t\tthis._popup._source = target;\r\n  \t\tthis.openPopup(e.latlng);\r\n  \t},\r\n\r\n  \t_movePopup: function (e) {\r\n  \t\tthis._popup.setLatLng(e.latlng);\r\n  \t},\r\n\r\n  \t_onKeyPress: function (e) {\r\n  \t\tif (e.originalEvent.keyCode === 13) {\r\n  \t\t\tthis._openPopup(e);\r\n  \t\t}\r\n  \t}\r\n  });\n\n  /*\n   * @class Tooltip\n   * @inherits DivOverlay\n   * @aka L.Tooltip\n   * Used to display small texts on top of map layers.\n   *\n   * @example\n   * If you want to just bind a tooltip to marker:\n   *\n   * ```js\n   * marker.bindTooltip(\"my tooltip text\").openTooltip();\n   * ```\n   * Path overlays like polylines also have a `bindTooltip` method.\n   *\n   * A tooltip can be also standalone:\n   *\n   * ```js\n   * var tooltip = L.tooltip()\n   * \t.setLatLng(latlng)\n   * \t.setContent('Hello world!<br />This is a nice tooltip.')\n   * \t.addTo(map);\n   * ```\n   * or\n   * ```js\n   * var tooltip = L.tooltip(latlng, {content: 'Hello world!<br />This is a nice tooltip.'})\n   * \t.addTo(map);\n   * ```\n   *\n   *\n   * Note about tooltip offset. Leaflet takes two options in consideration\n   * for computing tooltip offsetting:\n   * - the `offset` Tooltip option: it defaults to [0, 0], and it's specific to one tooltip.\n   *   Add a positive x offset to move the tooltip to the right, and a positive y offset to\n   *   move it to the bottom. Negatives will move to the left and top.\n   * - the `tooltipAnchor` Icon option: this will only be considered for Marker. You\n   *   should adapt this value if you use a custom icon.\n   */\n\n\n  // @namespace Tooltip\n  var Tooltip = DivOverlay.extend({\n\n  \t// @section\n  \t// @aka Tooltip options\n  \toptions: {\n  \t\t// @option pane: String = 'tooltipPane'\n  \t\t// `Map pane` where the tooltip will be added.\n  \t\tpane: 'tooltipPane',\n\n  \t\t// @option offset: Point = Point(0, 0)\n  \t\t// Optional offset of the tooltip position.\n  \t\toffset: [0, 0],\n\n  \t\t// @option direction: String = 'auto'\n  \t\t// Direction where to open the tooltip. Possible values are: `right`, `left`,\n  \t\t// `top`, `bottom`, `center`, `auto`.\n  \t\t// `auto` will dynamically switch between `right` and `left` according to the tooltip\n  \t\t// position on the map.\n  \t\tdirection: 'auto',\n\n  \t\t// @option permanent: Boolean = false\n  \t\t// Whether to open the tooltip permanently or only on mouseover.\n  \t\tpermanent: false,\n\n  \t\t// @option sticky: Boolean = false\n  \t\t// If true, the tooltip will follow the mouse instead of being fixed at the feature center.\n  \t\tsticky: false,\n\n  \t\t// @option opacity: Number = 0.9\n  \t\t// Tooltip container opacity.\n  \t\topacity: 0.9\n  \t},\n\n  \tonAdd: function (map) {\n  \t\tDivOverlay.prototype.onAdd.call(this, map);\n  \t\tthis.setOpacity(this.options.opacity);\n\n  \t\t// @namespace Map\n  \t\t// @section Tooltip events\n  \t\t// @event tooltipopen: TooltipEvent\n  \t\t// Fired when a tooltip is opened in the map.\n  \t\tmap.fire('tooltipopen', {tooltip: this});\n\n  \t\tif (this._source) {\n  \t\t\tthis.addEventParent(this._source);\n\n  \t\t\t// @namespace Layer\n  \t\t\t// @section Tooltip events\n  \t\t\t// @event tooltipopen: TooltipEvent\n  \t\t\t// Fired when a tooltip bound to this layer is opened.\n  \t\t\tthis._source.fire('tooltipopen', {tooltip: this}, true);\n  \t\t}\n  \t},\n\n  \tonRemove: function (map) {\n  \t\tDivOverlay.prototype.onRemove.call(this, map);\n\n  \t\t// @namespace Map\n  \t\t// @section Tooltip events\n  \t\t// @event tooltipclose: TooltipEvent\n  \t\t// Fired when a tooltip in the map is closed.\n  \t\tmap.fire('tooltipclose', {tooltip: this});\n\n  \t\tif (this._source) {\n  \t\t\tthis.removeEventParent(this._source);\n\n  \t\t\t// @namespace Layer\n  \t\t\t// @section Tooltip events\n  \t\t\t// @event tooltipclose: TooltipEvent\n  \t\t\t// Fired when a tooltip bound to this layer is closed.\n  \t\t\tthis._source.fire('tooltipclose', {tooltip: this}, true);\n  \t\t}\n  \t},\n\n  \tgetEvents: function () {\n  \t\tvar events = DivOverlay.prototype.getEvents.call(this);\n\n  \t\tif (!this.options.permanent) {\n  \t\t\tevents.preclick = this.close;\n  \t\t}\n\n  \t\treturn events;\n  \t},\n\n  \t_initLayout: function () {\n  \t\tvar prefix = 'leaflet-tooltip',\n  \t\t    className = prefix + ' ' + (this.options.className || '') + ' leaflet-zoom-' + (this._zoomAnimated ? 'animated' : 'hide');\n\n  \t\tthis._contentNode = this._container = create$1('div', className);\n\n  \t\tthis._container.setAttribute('role', 'tooltip');\n  \t\tthis._container.setAttribute('id', 'leaflet-tooltip-' + stamp(this));\n  \t},\n\n  \t_updateLayout: function () {},\n\n  \t_adjustPan: function () {},\n\n  \t_setPosition: function (pos) {\n  \t\tvar subX, subY,\n  \t\t    map = this._map,\n  \t\t    container = this._container,\n  \t\t    centerPoint = map.latLngToContainerPoint(map.getCenter()),\n  \t\t    tooltipPoint = map.layerPointToContainerPoint(pos),\n  \t\t    direction = this.options.direction,\n  \t\t    tooltipWidth = container.offsetWidth,\n  \t\t    tooltipHeight = container.offsetHeight,\n  \t\t    offset = toPoint(this.options.offset),\n  \t\t    anchor = this._getAnchor();\n\n  \t\tif (direction === 'top') {\n  \t\t\tsubX = tooltipWidth / 2;\n  \t\t\tsubY = tooltipHeight;\n  \t\t} else if (direction === 'bottom') {\n  \t\t\tsubX = tooltipWidth / 2;\n  \t\t\tsubY = 0;\n  \t\t} else if (direction === 'center') {\n  \t\t\tsubX = tooltipWidth / 2;\n  \t\t\tsubY = tooltipHeight / 2;\n  \t\t} else if (direction === 'right') {\n  \t\t\tsubX = 0;\n  \t\t\tsubY = tooltipHeight / 2;\n  \t\t} else if (direction === 'left') {\n  \t\t\tsubX = tooltipWidth;\n  \t\t\tsubY = tooltipHeight / 2;\n  \t\t} else if (tooltipPoint.x < centerPoint.x) {\n  \t\t\tdirection = 'right';\n  \t\t\tsubX = 0;\n  \t\t\tsubY = tooltipHeight / 2;\n  \t\t} else {\n  \t\t\tdirection = 'left';\n  \t\t\tsubX = tooltipWidth + (offset.x + anchor.x) * 2;\n  \t\t\tsubY = tooltipHeight / 2;\n  \t\t}\n\n  \t\tpos = pos.subtract(toPoint(subX, subY, true)).add(offset).add(anchor);\n\n  \t\tremoveClass(container, 'leaflet-tooltip-right');\n  \t\tremoveClass(container, 'leaflet-tooltip-left');\n  \t\tremoveClass(container, 'leaflet-tooltip-top');\n  \t\tremoveClass(container, 'leaflet-tooltip-bottom');\n  \t\taddClass(container, 'leaflet-tooltip-' + direction);\n  \t\tsetPosition(container, pos);\n  \t},\n\n  \t_updatePosition: function () {\n  \t\tvar pos = this._map.latLngToLayerPoint(this._latlng);\n  \t\tthis._setPosition(pos);\n  \t},\n\n  \tsetOpacity: function (opacity) {\n  \t\tthis.options.opacity = opacity;\n\n  \t\tif (this._container) {\n  \t\t\tsetOpacity(this._container, opacity);\n  \t\t}\n  \t},\n\n  \t_animateZoom: function (e) {\n  \t\tvar pos = this._map._latLngToNewLayerPoint(this._latlng, e.zoom, e.center);\n  \t\tthis._setPosition(pos);\n  \t},\n\n  \t_getAnchor: function () {\n  \t\t// Where should we anchor the tooltip on the source layer?\n  \t\treturn toPoint(this._source && this._source._getTooltipAnchor && !this.options.sticky ? this._source._getTooltipAnchor() : [0, 0]);\n  \t}\n\n  });\n\n  // @namespace Tooltip\n  // @factory L.tooltip(options?: Tooltip options, source?: Layer)\n  // Instantiates a `Tooltip` object given an optional `options` object that describes its appearance and location and an optional `source` object that is used to tag the tooltip with a reference to the Layer to which it refers.\n  // @alternative\n  // @factory L.tooltip(latlng: LatLng, options?: Tooltip options)\n  // Instantiates a `Tooltip` object given `latlng` where the tooltip will open and an optional `options` object that describes its appearance and location.\n  var tooltip = function (options, source) {\n  \treturn new Tooltip(options, source);\n  };\n\n  // @namespace Map\n  // @section Methods for Layers and Controls\n  Map.include({\n\n  \t// @method openTooltip(tooltip: Tooltip): this\n  \t// Opens the specified tooltip.\n  \t// @alternative\n  \t// @method openTooltip(content: String|HTMLElement, latlng: LatLng, options?: Tooltip options): this\n  \t// Creates a tooltip with the specified content and options and open it.\n  \topenTooltip: function (tooltip, latlng, options) {\n  \t\tthis._initOverlay(Tooltip, tooltip, latlng, options)\n  \t\t  .openOn(this);\n\n  \t\treturn this;\n  \t},\n\n  \t// @method closeTooltip(tooltip: Tooltip): this\n  \t// Closes the tooltip given as parameter.\n  \tcloseTooltip: function (tooltip) {\n  \t\ttooltip.close();\n  \t\treturn this;\n  \t}\n\n  });\n\n  /*\n   * @namespace Layer\n   * @section Tooltip methods example\n   *\n   * All layers share a set of methods convenient for binding tooltips to it.\n   *\n   * ```js\n   * var layer = L.Polygon(latlngs).bindTooltip('Hi There!').addTo(map);\n   * layer.openTooltip();\n   * layer.closeTooltip();\n   * ```\n   */\n\n  // @section Tooltip methods\n  Layer.include({\n\n  \t// @method bindTooltip(content: String|HTMLElement|Function|Tooltip, options?: Tooltip options): this\n  \t// Binds a tooltip to the layer with the passed `content` and sets up the\n  \t// necessary event listeners. If a `Function` is passed it will receive\n  \t// the layer as the first argument and should return a `String` or `HTMLElement`.\n  \tbindTooltip: function (content, options) {\n\n  \t\tif (this._tooltip && this.isTooltipOpen()) {\n  \t\t\tthis.unbindTooltip();\n  \t\t}\n\n  \t\tthis._tooltip = this._initOverlay(Tooltip, this._tooltip, content, options);\n  \t\tthis._initTooltipInteractions();\n\n  \t\tif (this._tooltip.options.permanent && this._map && this._map.hasLayer(this)) {\n  \t\t\tthis.openTooltip();\n  \t\t}\n\n  \t\treturn this;\n  \t},\n\n  \t// @method unbindTooltip(): this\n  \t// Removes the tooltip previously bound with `bindTooltip`.\n  \tunbindTooltip: function () {\n  \t\tif (this._tooltip) {\n  \t\t\tthis._initTooltipInteractions(true);\n  \t\t\tthis.closeTooltip();\n  \t\t\tthis._tooltip = null;\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t_initTooltipInteractions: function (remove) {\n  \t\tif (!remove && this._tooltipHandlersAdded) { return; }\n  \t\tvar onOff = remove ? 'off' : 'on',\n  \t\t    events = {\n  \t\t\tremove: this.closeTooltip,\n  \t\t\tmove: this._moveTooltip\n  \t\t    };\n  \t\tif (!this._tooltip.options.permanent) {\n  \t\t\tevents.mouseover = this._openTooltip;\n  \t\t\tevents.mouseout = this.closeTooltip;\n  \t\t\tevents.click = this._openTooltip;\n  \t\t\tif (this._map) {\n  \t\t\t\tthis._addFocusListeners();\n  \t\t\t} else {\n  \t\t\t\tevents.add = this._addFocusListeners;\n  \t\t\t}\n  \t\t} else {\n  \t\t\tevents.add = this._openTooltip;\n  \t\t}\n  \t\tif (this._tooltip.options.sticky) {\n  \t\t\tevents.mousemove = this._moveTooltip;\n  \t\t}\n  \t\tthis[onOff](events);\n  \t\tthis._tooltipHandlersAdded = !remove;\n  \t},\n\n  \t// @method openTooltip(latlng?: LatLng): this\n  \t// Opens the bound tooltip at the specified `latlng` or at the default tooltip anchor if no `latlng` is passed.\n  \topenTooltip: function (latlng) {\n  \t\tif (this._tooltip) {\n  \t\t\tif (!(this instanceof FeatureGroup)) {\n  \t\t\t\tthis._tooltip._source = this;\n  \t\t\t}\n  \t\t\tif (this._tooltip._prepareOpen(latlng)) {\n  \t\t\t\t// open the tooltip on the map\n  \t\t\t\tthis._tooltip.openOn(this._map);\n\n  \t\t\t\tif (this.getElement) {\n  \t\t\t\t\tthis._setAriaDescribedByOnLayer(this);\n  \t\t\t\t} else if (this.eachLayer) {\n  \t\t\t\t\tthis.eachLayer(this._setAriaDescribedByOnLayer, this);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method closeTooltip(): this\n  \t// Closes the tooltip bound to this layer if it is open.\n  \tcloseTooltip: function () {\n  \t\tif (this._tooltip) {\n  \t\t\treturn this._tooltip.close();\n  \t\t}\n  \t},\n\n  \t// @method toggleTooltip(): this\n  \t// Opens or closes the tooltip bound to this layer depending on its current state.\n  \ttoggleTooltip: function () {\n  \t\tif (this._tooltip) {\n  \t\t\tthis._tooltip.toggle(this);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method isTooltipOpen(): boolean\n  \t// Returns `true` if the tooltip bound to this layer is currently open.\n  \tisTooltipOpen: function () {\n  \t\treturn this._tooltip.isOpen();\n  \t},\n\n  \t// @method setTooltipContent(content: String|HTMLElement|Tooltip): this\n  \t// Sets the content of the tooltip bound to this layer.\n  \tsetTooltipContent: function (content) {\n  \t\tif (this._tooltip) {\n  \t\t\tthis._tooltip.setContent(content);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method getTooltip(): Tooltip\n  \t// Returns the tooltip bound to this layer.\n  \tgetTooltip: function () {\n  \t\treturn this._tooltip;\n  \t},\n\n  \t_addFocusListeners: function () {\n  \t\tif (this.getElement) {\n  \t\t\tthis._addFocusListenersOnLayer(this);\n  \t\t} else if (this.eachLayer) {\n  \t\t\tthis.eachLayer(this._addFocusListenersOnLayer, this);\n  \t\t}\n  \t},\n\n  \t_addFocusListenersOnLayer: function (layer) {\n  \t\tvar el = typeof layer.getElement === 'function' && layer.getElement();\n  \t\tif (el) {\n  \t\t\ton(el, 'focus', function () {\n  \t\t\t\tthis._tooltip._source = layer;\n  \t\t\t\tthis.openTooltip();\n  \t\t\t}, this);\n  \t\t\ton(el, 'blur', this.closeTooltip, this);\n  \t\t}\n  \t},\n\n  \t_setAriaDescribedByOnLayer: function (layer) {\n  \t\tvar el = typeof layer.getElement === 'function' && layer.getElement();\n  \t\tif (el) {\n  \t\t\tel.setAttribute('aria-describedby', this._tooltip._container.id);\n  \t\t}\n  \t},\n\n\n  \t_openTooltip: function (e) {\n  \t\tif (!this._tooltip || !this._map) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the map is moving, we will show the tooltip after it's done.\n  \t\tif (this._map.dragging && this._map.dragging.moving() && !this._openOnceFlag) {\n  \t\t\tthis._openOnceFlag = true;\n  \t\t\tvar that = this;\n  \t\t\tthis._map.once('moveend', function () {\n  \t\t\t\tthat._openOnceFlag = false;\n  \t\t\t\tthat._openTooltip(e);\n  \t\t\t});\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._tooltip._source = e.layer || e.target;\n\n  \t\tthis.openTooltip(this._tooltip.options.sticky ? e.latlng : undefined);\n  \t},\n\n  \t_moveTooltip: function (e) {\n  \t\tvar latlng = e.latlng, containerPoint, layerPoint;\n  \t\tif (this._tooltip.options.sticky && e.originalEvent) {\n  \t\t\tcontainerPoint = this._map.mouseEventToContainerPoint(e.originalEvent);\n  \t\t\tlayerPoint = this._map.containerPointToLayerPoint(containerPoint);\n  \t\t\tlatlng = this._map.layerPointToLatLng(layerPoint);\n  \t\t}\n  \t\tthis._tooltip.setLatLng(latlng);\n  \t}\n  });\n\n  /*\n   * @class DivIcon\n   * @aka L.DivIcon\n   * @inherits Icon\n   *\n   * Represents a lightweight icon for markers that uses a simple `<div>`\n   * element instead of an image. Inherits from `Icon` but ignores the `iconUrl` and shadow options.\n   *\n   * @example\n   * ```js\n   * var myIcon = L.divIcon({className: 'my-div-icon'});\n   * // you can set .my-div-icon styles in CSS\n   *\n   * L.marker([50.505, 30.57], {icon: myIcon}).addTo(map);\n   * ```\n   *\n   * By default, it has a 'leaflet-div-icon' CSS class and is styled as a little white square with a shadow.\n   */\n\n  var DivIcon = Icon.extend({\n  \toptions: {\n  \t\t// @section\n  \t\t// @aka DivIcon options\n  \t\ticonSize: [12, 12], // also can be set through CSS\n\n  \t\t// iconAnchor: (Point),\n  \t\t// popupAnchor: (Point),\n\n  \t\t// @option html: String|HTMLElement = ''\n  \t\t// Custom HTML code to put inside the div element, empty by default. Alternatively,\n  \t\t// an instance of `HTMLElement`.\n  \t\thtml: false,\n\n  \t\t// @option bgPos: Point = [0, 0]\n  \t\t// Optional relative position of the background, in pixels\n  \t\tbgPos: null,\n\n  \t\tclassName: 'leaflet-div-icon'\n  \t},\n\n  \tcreateIcon: function (oldIcon) {\n  \t\tvar div = (oldIcon && oldIcon.tagName === 'DIV') ? oldIcon : document.createElement('div'),\n  \t\t    options = this.options;\n\n  \t\tif (options.html instanceof Element) {\n  \t\t\tempty(div);\n  \t\t\tdiv.appendChild(options.html);\n  \t\t} else {\n  \t\t\tdiv.innerHTML = options.html !== false ? options.html : '';\n  \t\t}\n\n  \t\tif (options.bgPos) {\n  \t\t\tvar bgPos = toPoint(options.bgPos);\n  \t\t\tdiv.style.backgroundPosition = (-bgPos.x) + 'px ' + (-bgPos.y) + 'px';\n  \t\t}\n  \t\tthis._setIconStyles(div, 'icon');\n\n  \t\treturn div;\n  \t},\n\n  \tcreateShadow: function () {\n  \t\treturn null;\n  \t}\n  });\n\n  // @factory L.divIcon(options: DivIcon options)\n  // Creates a `DivIcon` instance with the given options.\n  function divIcon(options) {\n  \treturn new DivIcon(options);\n  }\n\n  Icon.Default = IconDefault;\n\n  /*\n   * @class GridLayer\n   * @inherits Layer\n   * @aka L.GridLayer\n   *\n   * Generic class for handling a tiled grid of HTML elements. This is the base class for all tile layers and replaces `TileLayer.Canvas`.\n   * GridLayer can be extended to create a tiled grid of HTML elements like `<canvas>`, `<img>` or `<div>`. GridLayer will handle creating and animating these DOM elements for you.\n   *\n   *\n   * @section Synchronous usage\n   * @example\n   *\n   * To create a custom layer, extend GridLayer and implement the `createTile()` method, which will be passed a `Point` object with the `x`, `y`, and `z` (zoom level) coordinates to draw your tile.\n   *\n   * ```js\n   * var CanvasLayer = L.GridLayer.extend({\n   *     createTile: function(coords){\n   *         // create a <canvas> element for drawing\n   *         var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n   *\n   *         // setup tile width and height according to the options\n   *         var size = this.getTileSize();\n   *         tile.width = size.x;\n   *         tile.height = size.y;\n   *\n   *         // get a canvas context and draw something on it using coords.x, coords.y and coords.z\n   *         var ctx = tile.getContext('2d');\n   *\n   *         // return the tile so it can be rendered on screen\n   *         return tile;\n   *     }\n   * });\n   * ```\n   *\n   * @section Asynchronous usage\n   * @example\n   *\n   * Tile creation can also be asynchronous, this is useful when using a third-party drawing library. Once the tile is finished drawing it can be passed to the `done()` callback.\n   *\n   * ```js\n   * var CanvasLayer = L.GridLayer.extend({\n   *     createTile: function(coords, done){\n   *         var error;\n   *\n   *         // create a <canvas> element for drawing\n   *         var tile = L.DomUtil.create('canvas', 'leaflet-tile');\n   *\n   *         // setup tile width and height according to the options\n   *         var size = this.getTileSize();\n   *         tile.width = size.x;\n   *         tile.height = size.y;\n   *\n   *         // draw something asynchronously and pass the tile to the done() callback\n   *         setTimeout(function() {\n   *             done(error, tile);\n   *         }, 1000);\n   *\n   *         return tile;\n   *     }\n   * });\n   * ```\n   *\n   * @section\n   */\n\n\n  var GridLayer = Layer.extend({\n\n  \t// @section\n  \t// @aka GridLayer options\n  \toptions: {\n  \t\t// @option tileSize: Number|Point = 256\n  \t\t// Width and height of tiles in the grid. Use a number if width and height are equal, or `L.point(width, height)` otherwise.\n  \t\ttileSize: 256,\n\n  \t\t// @option opacity: Number = 1.0\n  \t\t// Opacity of the tiles. Can be used in the `createTile()` function.\n  \t\topacity: 1,\n\n  \t\t// @option updateWhenIdle: Boolean = (depends)\n  \t\t// Load new tiles only when panning ends.\n  \t\t// `true` by default on mobile browsers, in order to avoid too many requests and keep smooth navigation.\n  \t\t// `false` otherwise in order to display new tiles _during_ panning, since it is easy to pan outside the\n  \t\t// [`keepBuffer`](#gridlayer-keepbuffer) option in desktop browsers.\n  \t\tupdateWhenIdle: Browser.mobile,\n\n  \t\t// @option updateWhenZooming: Boolean = true\n  \t\t// By default, a smooth zoom animation (during a [touch zoom](#map-touchzoom) or a [`flyTo()`](#map-flyto)) will update grid layers every integer zoom level. Setting this option to `false` will update the grid layer only when the smooth animation ends.\n  \t\tupdateWhenZooming: true,\n\n  \t\t// @option updateInterval: Number = 200\n  \t\t// Tiles will not update more than once every `updateInterval` milliseconds when panning.\n  \t\tupdateInterval: 200,\n\n  \t\t// @option zIndex: Number = 1\n  \t\t// The explicit zIndex of the tile layer.\n  \t\tzIndex: 1,\n\n  \t\t// @option bounds: LatLngBounds = undefined\n  \t\t// If set, tiles will only be loaded inside the set `LatLngBounds`.\n  \t\tbounds: null,\n\n  \t\t// @option minZoom: Number = 0\n  \t\t// The minimum zoom level down to which this layer will be displayed (inclusive).\n  \t\tminZoom: 0,\n\n  \t\t// @option maxZoom: Number = undefined\n  \t\t// The maximum zoom level up to which this layer will be displayed (inclusive).\n  \t\tmaxZoom: undefined,\n\n  \t\t// @option maxNativeZoom: Number = undefined\n  \t\t// Maximum zoom number the tile source has available. If it is specified,\n  \t\t// the tiles on all zoom levels higher than `maxNativeZoom` will be loaded\n  \t\t// from `maxNativeZoom` level and auto-scaled.\n  \t\tmaxNativeZoom: undefined,\n\n  \t\t// @option minNativeZoom: Number = undefined\n  \t\t// Minimum zoom number the tile source has available. If it is specified,\n  \t\t// the tiles on all zoom levels lower than `minNativeZoom` will be loaded\n  \t\t// from `minNativeZoom` level and auto-scaled.\n  \t\tminNativeZoom: undefined,\n\n  \t\t// @option noWrap: Boolean = false\n  \t\t// Whether the layer is wrapped around the antimeridian. If `true`, the\n  \t\t// GridLayer will only be displayed once at low zoom levels. Has no\n  \t\t// effect when the [map CRS](#map-crs) doesn't wrap around. Can be used\n  \t\t// in combination with [`bounds`](#gridlayer-bounds) to prevent requesting\n  \t\t// tiles outside the CRS limits.\n  \t\tnoWrap: false,\n\n  \t\t// @option pane: String = 'tilePane'\n  \t\t// `Map pane` where the grid layer will be added.\n  \t\tpane: 'tilePane',\n\n  \t\t// @option className: String = ''\n  \t\t// A custom class name to assign to the tile layer. Empty by default.\n  \t\tclassName: '',\n\n  \t\t// @option keepBuffer: Number = 2\n  \t\t// When panning the map, keep this many rows and columns of tiles before unloading them.\n  \t\tkeepBuffer: 2\n  \t},\n\n  \tinitialize: function (options) {\n  \t\tsetOptions(this, options);\n  \t},\n\n  \tonAdd: function () {\n  \t\tthis._initContainer();\n\n  \t\tthis._levels = {};\n  \t\tthis._tiles = {};\n\n  \t\tthis._resetView(); // implicit _update() call\n  \t},\n\n  \tbeforeAdd: function (map) {\n  \t\tmap._addZoomLimit(this);\n  \t},\n\n  \tonRemove: function (map) {\n  \t\tthis._removeAllTiles();\n  \t\tremove(this._container);\n  \t\tmap._removeZoomLimit(this);\n  \t\tthis._container = null;\n  \t\tthis._tileZoom = undefined;\n  \t},\n\n  \t// @method bringToFront: this\n  \t// Brings the tile layer to the top of all tile layers.\n  \tbringToFront: function () {\n  \t\tif (this._map) {\n  \t\t\ttoFront(this._container);\n  \t\t\tthis._setAutoZIndex(Math.max);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method bringToBack: this\n  \t// Brings the tile layer to the bottom of all tile layers.\n  \tbringToBack: function () {\n  \t\tif (this._map) {\n  \t\t\ttoBack(this._container);\n  \t\t\tthis._setAutoZIndex(Math.min);\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \t// @method getContainer: HTMLElement\n  \t// Returns the HTML element that contains the tiles for this layer.\n  \tgetContainer: function () {\n  \t\treturn this._container;\n  \t},\n\n  \t// @method setOpacity(opacity: Number): this\n  \t// Changes the [opacity](#gridlayer-opacity) of the grid layer.\n  \tsetOpacity: function (opacity) {\n  \t\tthis.options.opacity = opacity;\n  \t\tthis._updateOpacity();\n  \t\treturn this;\n  \t},\n\n  \t// @method setZIndex(zIndex: Number): this\n  \t// Changes the [zIndex](#gridlayer-zindex) of the grid layer.\n  \tsetZIndex: function (zIndex) {\n  \t\tthis.options.zIndex = zIndex;\n  \t\tthis._updateZIndex();\n\n  \t\treturn this;\n  \t},\n\n  \t// @method isLoading: Boolean\n  \t// Returns `true` if any tile in the grid layer has not finished loading.\n  \tisLoading: function () {\n  \t\treturn this._loading;\n  \t},\n\n  \t// @method redraw: this\n  \t// Causes the layer to clear all the tiles and request them again.\n  \tredraw: function () {\n  \t\tif (this._map) {\n  \t\t\tthis._removeAllTiles();\n  \t\t\tvar tileZoom = this._clampZoom(this._map.getZoom());\n  \t\t\tif (tileZoom !== this._tileZoom) {\n  \t\t\t\tthis._tileZoom = tileZoom;\n  \t\t\t\tthis._updateLevels();\n  \t\t\t}\n  \t\t\tthis._update();\n  \t\t}\n  \t\treturn this;\n  \t},\n\n  \tgetEvents: function () {\n  \t\tvar events = {\n  \t\t\tviewprereset: this._invalidateAll,\n  \t\t\tviewreset: this._resetView,\n  \t\t\tzoom: this._resetView,\n  \t\t\tmoveend: this._onMoveEnd\n  \t\t};\n\n  \t\tif (!this.options.updateWhenIdle) {\n  \t\t\t// update tiles on move, but not more often than once per given interval\n  \t\t\tif (!this._onMove) {\n  \t\t\t\tthis._onMove = throttle(this._onMoveEnd, this.options.updateInterval, this);\n  \t\t\t}\n\n  \t\t\tevents.move = this._onMove;\n  \t\t}\n\n  \t\tif (this._zoomAnimated) {\n  \t\t\tevents.zoomanim = this._animateZoom;\n  \t\t}\n\n  \t\treturn events;\n  \t},\n\n  \t// @section Extension methods\n  \t// Layers extending `GridLayer` shall reimplement the following method.\n  \t// @method createTile(coords: Object, done?: Function): HTMLElement\n  \t// Called only internally, must be overridden by classes extending `GridLayer`.\n  \t// Returns the `HTMLElement` corresponding to the given `coords`. If the `done` callback\n  \t// is specified, it must be called when the tile has finished loading and drawing.\n  \tcreateTile: function () {\n  \t\treturn document.createElement('div');\n  \t},\n\n  \t// @section\n  \t// @method getTileSize: Point\n  \t// Normalizes the [tileSize option](#gridlayer-tilesize) into a point. Used by the `createTile()` method.\n  \tgetTileSize: function () {\n  \t\tvar s = this.options.tileSize;\n  \t\treturn s instanceof Point ? s : new Point(s, s);\n  \t},\n\n  \t_updateZIndex: function () {\n  \t\tif (this._container && this.options.zIndex !== undefined && this.options.zIndex !== null) {\n  \t\t\tthis._container.style.zIndex = this.options.zIndex;\n  \t\t}\n  \t},\n\n  \t_setAutoZIndex: function (compare) {\n  \t\t// go through all other layers of the same pane, set zIndex to max + 1 (front) or min - 1 (back)\n\n  \t\tvar layers = this.getPane().children,\n  \t\t    edgeZIndex = -compare(-Infinity, Infinity); // -Infinity for max, Infinity for min\n\n  \t\tfor (var i = 0, len = layers.length, zIndex; i < len; i++) {\n\n  \t\t\tzIndex = layers[i].style.zIndex;\n\n  \t\t\tif (layers[i] !== this._container && zIndex) {\n  \t\t\t\tedgeZIndex = compare(edgeZIndex, +zIndex);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (isFinite(edgeZIndex)) {\n  \t\t\tthis.options.zIndex = edgeZIndex + compare(-1, 1);\n  \t\t\tthis._updateZIndex();\n  \t\t}\n  \t},\n\n  \t_updateOpacity: function () {\n  \t\tif (!this._map) { return; }\n\n  \t\t// IE doesn't inherit filter opacity properly, so we're forced to set it on tiles\n  \t\tif (Browser.ielt9) { return; }\n\n  \t\tsetOpacity(this._container, this.options.opacity);\n\n  \t\tvar now = +new Date(),\n  \t\t    nextFrame = false,\n  \t\t    willPrune = false;\n\n  \t\tfor (var key in this._tiles) {\n  \t\t\tvar tile = this._tiles[key];\n  \t\t\tif (!tile.current || !tile.loaded) { continue; }\n\n  \t\t\tvar fade = Math.min(1, (now - tile.loaded) / 200);\n\n  \t\t\tsetOpacity(tile.el, fade);\n  \t\t\tif (fade < 1) {\n  \t\t\t\tnextFrame = true;\n  \t\t\t} else {\n  \t\t\t\tif (tile.active) {\n  \t\t\t\t\twillPrune = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis._onOpaqueTile(tile);\n  \t\t\t\t}\n  \t\t\t\ttile.active = true;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (willPrune && !this._noPrune) { this._pruneTiles(); }\n\n  \t\tif (nextFrame) {\n  \t\t\tcancelAnimFrame(this._fadeFrame);\n  \t\t\tthis._fadeFrame = requestAnimFrame(this._updateOpacity, this);\n  \t\t}\n  \t},\n\n  \t_onOpaqueTile: falseFn,\n\n  \t_initContainer: function () {\n  \t\tif (this._container) { return; }\n\n  \t\tthis._container = create$1('div', 'leaflet-layer ' + (this.options.className || ''));\n  \t\tthis._updateZIndex();\n\n  \t\tif (this.options.opacity < 1) {\n  \t\t\tthis._updateOpacity();\n  \t\t}\n\n  \t\tthis.getPane().appendChild(this._container);\n  \t},\n\n  \t_updateLevels: function () {\n\n  \t\tvar zoom = this._tileZoom,\n  \t\t    maxZoom = this.options.maxZoom;\n\n  \t\tif (zoom === undefined) { return undefined; }\n\n  \t\tfor (var z in this._levels) {\n  \t\t\tz = Number(z);\n  \t\t\tif (this._levels[z].el.children.length || z === zoom) {\n  \t\t\t\tthis._levels[z].el.style.zIndex = maxZoom - Math.abs(zoom - z);\n  \t\t\t\tthis._onUpdateLevel(z);\n  \t\t\t} else {\n  \t\t\t\tremove(this._levels[z].el);\n  \t\t\t\tthis._removeTilesAtZoom(z);\n  \t\t\t\tthis._onRemoveLevel(z);\n  \t\t\t\tdelete this._levels[z];\n  \t\t\t}\n  \t\t}\n\n  \t\tvar level = this._levels[zoom],\n  \t\t    map = this._map;\n\n  \t\tif (!level) {\n  \t\t\tlevel = this._levels[zoom] = {};\n\n  \t\t\tlevel.el = create$1('div', 'leaflet-tile-container leaflet-zoom-animated', this._container);\n  \t\t\tlevel.el.style.zIndex = maxZoom;\n\n  \t\t\tlevel.origin = map.project(map.unproject(map.getPixelOrigin()), zoom).round();\n  \t\t\tlevel.zoom = zoom;\n\n  \t\t\tthis._setZoomTransform(level, map.getCenter(), map.getZoom());\n\n  \t\t\t// force the browser to consider the newly added element for transition\n  \t\t\tfalseFn(level.el.offsetWidth);\n\n  \t\t\tthis._onCreateLevel(level);\n  \t\t}\n\n  \t\tthis._level = level;\n\n  \t\treturn level;\n  \t},\n\n  \t_onUpdateLevel: falseFn,\n\n  \t_onRemoveLevel: falseFn,\n\n  \t_onCreateLevel: falseFn,\n\n  \t_pruneTiles: function () {\n  \t\tif (!this._map) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar key, tile;\n\n  \t\tvar zoom = this._map.getZoom();\n  \t\tif (zoom > this.options.maxZoom ||\n  \t\t\tzoom < this.options.minZoom) {\n  \t\t\tthis._removeAllTiles();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (key in this._tiles) {\n  \t\t\ttile = this._tiles[key];\n  \t\t\ttile.retain = tile.current;\n  \t\t}\n\n  \t\tfor (key in this._tiles) {\n  \t\t\ttile = this._tiles[key];\n  \t\t\tif (tile.current && !tile.active) {\n  \t\t\t\tvar coords = tile.coords;\n  \t\t\t\tif (!this._retainParent(coords.x, coords.y, coords.z, coords.z - 5)) {\n  \t\t\t\t\tthis._retainChildren(coords.x, coords.y, coords.z, coords.z + 2);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (key in this._tiles) {\n  \t\t\tif (!this._tiles[key].retain) {\n  \t\t\t\tthis._removeTile(key);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \t_removeTilesAtZoom: function (zoom) {\n  \t\tfor (var key in this._tiles) {\n  \t\t\tif (this._tiles[key].coords.z !== zoom) {\n  \t\t\t\tcontinue;\n  \t\t\t}\n  \t\t\tthis._removeTile(key);\n  \t\t}\n  \t},\n\n  \t_removeAllTiles: function () {\n  \t\tfor (var key in this._tiles) {\n  \t\t\tthis._removeTile(key);\n  \t\t}\n  \t},\n\n  \t_invalidateAll: function () {\n  \t\tfor (var z in this._levels) {\n  \t\t\tremove(this._levels[z].el);\n  \t\t\tthis._onRemoveLevel(Number(z));\n  \t\t\tdelete this._levels[z];\n  \t\t}\n  \t\tthis._removeAllTiles();\n\n  \t\tthis._tileZoom = undefined;\n  \t},\n\n  \t_retainParent: function (x, y, z, minZoom) {\n  \t\tvar x2 = Math.floor(x / 2),\n  \t\t    y2 = Math.floor(y / 2),\n  \t\t    z2 = z - 1,\n  \t\t    coords2 = new Point(+x2, +y2);\n  \t\tcoords2.z = +z2;\n\n  \t\tvar key = this._tileCoordsToKey(coords2),\n  \t\t    tile = this._tiles[key];\n\n  \t\tif (tile && tile.active) {\n  \t\t\ttile.retain = true;\n  \t\t\treturn true;\n\n  \t\t} else if (tile && tile.loaded) {\n  \t\t\ttile.retain = true;\n  \t\t}\n\n  \t\tif (z2 > minZoom) {\n  \t\t\treturn this._retainParent(x2, y2, z2, minZoom);\n  \t\t}\n\n  \t\treturn false;\n  \t},\n\n  \t_retainChildren: function (x, y, z, maxZoom) {\n\n  \t\tfor (var i = 2 * x; i < 2 * x + 2; i++) {\n  \t\t\tfor (var j = 2 * y; j < 2 * y + 2; j++) {\n\n  \t\t\t\tvar coords = new Point(i, j);\n  \t\t\t\tcoords.z = z + 1;\n\n  \t\t\t\tvar key = this._tileCoordsToKey(coords),\n  \t\t\t\t    tile = this._tiles[key];\n\n  \t\t\t\tif (tile && tile.active) {\n  \t\t\t\t\ttile.retain = true;\n  \t\t\t\t\tcontinue;\n\n  \t\t\t\t} else if (tile && tile.loaded) {\n  \t\t\t\t\ttile.retain = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (z + 1 < maxZoom) {\n  \t\t\t\t\tthis._retainChildren(i, j, z + 1, maxZoom);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \t_resetView: function (e) {\n  \t\tvar animating = e && (e.pinch || e.flyTo);\n  \t\tthis._setView(this._map.getCenter(), this._map.getZoom(), animating, animating);\n  \t},\n\n  \t_animateZoom: function (e) {\n  \t\tthis._setView(e.center, e.zoom, true, e.noUpdate);\n  \t},\n\n  \t_clampZoom: function (zoom) {\n  \t\tvar options = this.options;\n\n  \t\tif (undefined !== options.minNativeZoom && zoom < options.minNativeZoom) {\n  \t\t\treturn options.minNativeZoom;\n  \t\t}\n\n  \t\tif (undefined !== options.maxNativeZoom && options.maxNativeZoom < zoom) {\n  \t\t\treturn options.maxNativeZoom;\n  \t\t}\n\n  \t\treturn zoom;\n  \t},\n\n  \t_setView: function (center, zoom, noPrune, noUpdate) {\n  \t\tvar tileZoom = Math.round(zoom);\n  \t\tif ((this.options.maxZoom !== undefined && tileZoom > this.options.maxZoom) ||\n  \t\t    (this.options.minZoom !== undefined && tileZoom < this.options.minZoom)) {\n  \t\t\ttileZoom = undefined;\n  \t\t} else {\n  \t\t\ttileZoom = this._clampZoom(tileZoom);\n  \t\t}\n\n  \t\tvar tileZoomChanged = this.options.updateWhenZooming && (tileZoom !== this._tileZoom);\n\n  \t\tif (!noUpdate || tileZoomChanged) {\n\n  \t\t\tthis._tileZoom = tileZoom;\n\n  \t\t\tif (this._abortLoading) {\n  \t\t\t\tthis._abortLoading();\n  \t\t\t}\n\n  \t\t\tthis._updateLevels();\n  \t\t\tthis._resetGrid();\n\n  \t\t\tif (tileZoom !== undefined) {\n  \t\t\t\tthis._update(center);\n  \t\t\t}\n\n  \t\t\tif (!noPrune) {\n  \t\t\t\tthis._pruneTiles();\n  \t\t\t}\n\n  \t\t\t// Flag to prevent _updateOpacity from pruning tiles during\n  \t\t\t// a zoom anim or a pinch gesture\n  \t\t\tthis._noPrune = !!noPrune;\n  \t\t}\n\n  \t\tthis._setZoomTransforms(center, zoom);\n  \t},\n\n  \t_setZoomTransforms: function (center, zoom) {\n  \t\tfor (var i in this._levels) {\n  \t\t\tthis._setZoomTransform(this._levels[i], center, zoom);\n  \t\t}\n  \t},\n\n  \t_setZoomTransform: function (level, center, zoom) {\n  \t\tvar scale = this._map.getZoomScale(zoom, level.zoom),\n  \t\t    translate = level.origin.multiplyBy(scale)\n  \t\t        .subtract(this._map._getNewPixelOrigin(center, zoom)).round();\n\n  \t\tif (Browser.any3d) {\n  \t\t\tsetTransform(level.el, translate, scale);\n  \t\t} else {\n  \t\t\tsetPosition(level.el, translate);\n  \t\t}\n  \t},\n\n  \t_resetGrid: function () {\n  \t\tvar map = this._map,\n  \t\t    crs = map.options.crs,\n  \t\t    tileSize = this._tileSize = this.getTileSize(),\n  \t\t    tileZoom = this._tileZoom;\n\n  \t\tvar bounds = this._map.getPixelWorldBounds(this._tileZoom);\n  \t\tif (bounds) {\n  \t\t\tthis._globalTileRange = this._pxBoundsToTileRange(bounds);\n  \t\t}\n\n  \t\tthis._wrapX = crs.wrapLng && !this.options.noWrap && [\n  \t\t\tMath.floor(map.project([0, crs.wrapLng[0]], tileZoom).x / tileSize.x),\n  \t\t\tMath.ceil(map.project([0, crs.wrapLng[1]], tileZoom).x / tileSize.y)\n  \t\t];\n  \t\tthis._wrapY = crs.wrapLat && !this.options.noWrap && [\n  \t\t\tMath.floor(map.project([crs.wrapLat[0], 0], tileZoom).y / tileSize.x),\n  \t\t\tMath.ceil(map.project([crs.wrapLat[1], 0], tileZoom).y / tileSize.y)\n  \t\t];\n  \t},\n\n  \t_onMoveEnd: function () {\n  \t\tif (!this._map || this._map._animatingZoom) { return; }\n\n  \t\tthis._update();\n  \t},\n\n  \t_getTiledPixelBounds: function (center) {\n  \t\tvar map = this._map,\n  \t\t    mapZoom = map._animatingZoom ? Math.max(map._animateToZoom, map.getZoom()) : map.getZoom(),\n  \t\t    scale = map.getZoomScale(mapZoom, this._tileZoom),\n  \t\t    pixelCenter = map.project(center, this._tileZoom).floor(),\n  \t\t    halfSize = map.getSize().divideBy(scale * 2);\n\n  \t\treturn new Bounds(pixelCenter.subtract(halfSize), pixelCenter.add(halfSize));\n  \t},\n\n  \t// Private method to load tiles in the grid's active zoom level according to map bounds\n  \t_update: function (center) {\n  \t\tvar map = this._map;\n  \t\tif (!map) { return; }\n  \t\tvar zoom = this._clampZoom(map.getZoom());\n\n  \t\tif (center === undefined) { center = map.getCenter(); }\n  \t\tif (this._tileZoom === undefined) { return; }\t// if out of minzoom/maxzoom\n\n  \t\tvar pixelBounds = this._getTiledPixelBounds(center),\n  \t\t    tileRange = this._pxBoundsToTileRange(pixelBounds),\n  \t\t    tileCenter = tileRange.getCenter(),\n  \t\t    queue = [],\n  \t\t    margin = this.options.keepBuffer,\n  \t\t    noPruneRange = new Bounds(tileRange.getBottomLeft().subtract([margin, -margin]),\n  \t\t                              tileRange.getTopRight().add([margin, -margin]));\n\n  \t\t// Sanity check: panic if the tile range contains Infinity somewhere.\n  \t\tif (!(isFinite(tileRange.min.x) &&\n  \t\t      isFinite(tileRange.min.y) &&\n  \t\t      isFinite(tileRange.max.x) &&\n  \t\t      isFinite(tileRange.max.y))) { throw new Error('Attempted to load an infinite number of tiles'); }\n\n  \t\tfor (var key in this._tiles) {\n  \t\t\tvar c = this._tiles[key].coords;\n  \t\t\tif (c.z !== this._tileZoom || !noPruneRange.contains(new Point(c.x, c.y))) {\n  \t\t\t\tthis._tiles[key].current = false;\n  \t\t\t}\n  \t\t}\n\n  \t\t// _update just loads more tiles. If the tile zoom level differs too much\n  \t\t// from the map's, let _setView reset levels and prune old tiles.\n  \t\tif (Math.abs(zoom - this._tileZoom) > 1) { this._setView(center, zoom); return; }\n\n  \t\t// create a queue of coordinates to load tiles from\n  \t\tfor (var j = tileRange.min.y; j <= tileRange.max.y; j++) {\n  \t\t\tfor (var i = tileRange.min.x; i <= tileRange.max.x; i++) {\n  \t\t\t\tvar coords = new Point(i, j);\n  \t\t\t\tcoords.z = this._tileZoom;\n\n  \t\t\t\tif (!this._isValidTile(coords)) { continue; }\n\n  \t\t\t\tvar tile = this._tiles[this._tileCoordsToKey(coords)];\n  \t\t\t\tif (tile) {\n  \t\t\t\t\ttile.current = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tqueue.push(coords);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// sort tile queue to load tiles in order of their distance to center\n  \t\tqueue.sort(function (a, b) {\n  \t\t\treturn a.distanceTo(tileCenter) - b.distanceTo(tileCenter);\n  \t\t});\n\n  \t\tif (queue.length !== 0) {\n  \t\t\t// if it's the first batch of tiles to load\n  \t\t\tif (!this._loading) {\n  \t\t\t\tthis._loading = true;\n  \t\t\t\t// @event loading: Event\n  \t\t\t\t// Fired when the grid layer starts loading tiles.\n  \t\t\t\tthis.fire('loading');\n  \t\t\t}\n\n  \t\t\t// create DOM fragment to append tiles in one batch\n  \t\t\tvar fragment = document.createDocumentFragment();\n\n  \t\t\tfor (i = 0; i < queue.length; i++) {\n  \t\t\t\tthis._addTile(queue[i], fragment);\n  \t\t\t}\n\n  \t\t\tthis._level.el.appendChild(fragment);\n  \t\t}\n  \t},\n\n  \t_isValidTile: function (coords) {\n  \t\tvar crs = this._map.options.crs;\n\n  \t\tif (!crs.infinite) {\n  \t\t\t// don't load tile if it's out of bounds and not wrapped\n  \t\t\tvar bounds = this._globalTileRange;\n  \t\t\tif ((!crs.wrapLng && (coords.x < bounds.min.x || coords.x > bounds.max.x)) ||\n  \t\t\t    (!crs.wrapLat && (coords.y < bounds.min.y || coords.y > bounds.max.y))) { return false; }\n  \t\t}\n\n  \t\tif (!this.options.bounds) { return true; }\n\n  \t\t// don't load tile if it doesn't intersect the bounds in options\n  \t\tvar tileBounds = this._tileCoordsToBounds(coords);\n  \t\treturn toLatLngBounds(this.options.bounds).overlaps(tileBounds);\n  \t},\n\n  \t_keyToBounds: function (key) {\n  \t\treturn this._tileCoordsToBounds(this._keyToTileCoords(key));\n  \t},\n\n  \t_tileCoordsToNwSe: function (coords) {\n  \t\tvar map = this._map,\n  \t\t    tileSize = this.getTileSize(),\n  \t\t    nwPoint = coords.scaleBy(tileSize),\n  \t\t    sePoint = nwPoint.add(tileSize),\n  \t\t    nw = map.unproject(nwPoint, coords.z),\n  \t\t    se = map.unproject(sePoint, coords.z);\n  \t\treturn [nw, se];\n  \t},\n\n  \t// converts tile coordinates to its geographical bounds\n  \t_tileCoordsToBounds: function (coords) {\n  \t\tvar bp = this._tileCoordsToNwSe(coords),\n  \t\t    bounds = new LatLngBounds(bp[0], bp[1]);\n\n  \t\tif (!this.options.noWrap) {\n  \t\t\tbounds = this._map.wrapLatLngBounds(bounds);\n  \t\t}\n  \t\treturn bounds;\n  \t},\n  \t// converts tile coordinates to key for the tile cache\n  \t_tileCoordsToKey: function (coords) {\n  \t\treturn coords.x + ':' + coords.y + ':' + coords.z;\n  \t},\n\n  \t// converts tile cache key to coordinates\n  \t_keyToTileCoords: function (key) {\n  \t\tvar k = key.split(':'),\n  \t\t    coords = new Point(+k[0], +k[1]);\n  \t\tcoords.z = +k[2];\n  \t\treturn coords;\n  \t},\n\n  \t_removeTile: function (key) {\n  \t\tvar tile = this._tiles[key];\n  \t\tif (!tile) { return; }\n\n  \t\tremove(tile.el);\n\n  \t\tdelete this._tiles[key];\n\n  \t\t// @event tileunload: TileEvent\n  \t\t// Fired when a tile is removed (e.g. when a tile goes off the screen).\n  \t\tthis.fire('tileunload', {\n  \t\t\ttile: tile.el,\n  \t\t\tcoords: this._keyToTileCoords(key)\n  \t\t});\n  \t},\n\n  \t_initTile: function (tile) {\n  \t\taddClass(tile, 'leaflet-tile');\n\n  \t\tvar tileSize = this.getTileSize();\n  \t\ttile.style.width = tileSize.x + 'px';\n  \t\ttile.style.height = tileSize.y + 'px';\n\n  \t\ttile.onselectstart = falseFn;\n  \t\ttile.onmousemove = falseFn;\n\n  \t\t// update opacity on tiles in IE7-8 because of filter inheritance problems\n  \t\tif (Browser.ielt9 && this.options.opacity < 1) {\n  \t\t\tsetOpacity(tile, this.options.opacity);\n  \t\t}\n  \t},\n\n  \t_addTile: function (coords, container) {\n  \t\tvar tilePos = this._getTilePos(coords),\n  \t\t    key = this._tileCoordsToKey(coords);\n\n  \t\tvar tile = this.createTile(this._wrapCoords(coords), bind(this._tileReady, this, coords));\n\n  \t\tthis._initTile(tile);\n\n  \t\t// if createTile is defined with a second argument (\"done\" callback),\n  \t\t// we know that tile is async and will be ready later; otherwise\n  \t\tif (this.createTile.length < 2) {\n  \t\t\t// mark tile as ready, but delay one frame for opacity animation to happen\n  \t\t\trequestAnimFrame(bind(this._tileReady, this, coords, null, tile));\n  \t\t}\n\n  \t\tsetPosition(tile, tilePos);\n\n  \t\t// save tile in cache\n  \t\tthis._tiles[key] = {\n  \t\t\tel: tile,\n  \t\t\tcoords: coords,\n  \t\t\tcurrent: true\n  \t\t};\n\n  \t\tcontainer.appendChild(tile);\n  \t\t// @event tileloadstart: TileEvent\n  \t\t// Fired when a tile is requested and starts loading.\n  \t\tthis.fire('tileloadstart', {\n  \t\t\ttile: tile,\n  \t\t\tcoords: coords\n  \t\t});\n  \t},\n\n  \t_tileReady: function (coords, err, tile) {\n  \t\tif (err) {\n  \t\t\t// @event tileerror: TileErrorEvent\n  \t\t\t// Fired when there is an error loading a tile.\n  \t\t\tthis.fire('tileerror', {\n  \t\t\t\terror: err,\n  \t\t\t\ttile: tile,\n  \t\t\t\tcoords: coords\n  \t\t\t});\n  \t\t}\n\n  \t\tvar key = this._tileCoordsToKey(coords);\n\n  \t\ttile = this._tiles[key];\n  \t\tif (!tile) { return; }\n\n  \t\ttile.loaded = +new Date();\n  \t\tif (this._map._fadeAnimated) {\n  \t\t\tsetOpacity(tile.el, 0);\n  \t\t\tcancelAnimFrame(this._fadeFrame);\n  \t\t\tthis._fadeFrame = requestAnimFrame(this._updateOpacity, this);\n  \t\t} else {\n  \t\t\ttile.active = true;\n  \t\t\tthis._pruneTiles();\n  \t\t}\n\n  \t\tif (!err) {\n  \t\t\taddClass(tile.el, 'leaflet-tile-loaded');\n\n  \t\t\t// @event tileload: TileEvent\n  \t\t\t// Fired when a tile loads.\n  \t\t\tthis.fire('tileload', {\n  \t\t\t\ttile: tile.el,\n  \t\t\t\tcoords: coords\n  \t\t\t});\n  \t\t}\n\n  \t\tif (this._noTilesToLoad()) {\n  \t\t\tthis._loading = false;\n  \t\t\t// @event load: Event\n  \t\t\t// Fired when the grid layer loaded all visible tiles.\n  \t\t\tthis.fire('load');\n\n  \t\t\tif (Browser.ielt9 || !this._map._fadeAnimated) {\n  \t\t\t\trequestAnimFrame(this._pruneTiles, this);\n  \t\t\t} else {\n  \t\t\t\t// Wait a bit more than 0.2 secs (the duration of the tile fade-in)\n  \t\t\t\t// to trigger a pruning.\n  \t\t\t\tsetTimeout(bind(this._pruneTiles, this), 250);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \t_getTilePos: function (coords) {\n  \t\treturn coords.scaleBy(this.getTileSize()).subtract(this._level.origin);\n  \t},\n\n  \t_wrapCoords: function (coords) {\n  \t\tvar newCoords = new Point(\n  \t\t\tthis._wrapX ? wrapNum(coords.x, this._wrapX) : coords.x,\n  \t\t\tthis._wrapY ? wrapNum(coords.y, this._wrapY) : coords.y);\n  \t\tnewCoords.z = coords.z;\n  \t\treturn newCoords;\n  \t},\n\n  \t_pxBoundsToTileRange: function (bounds) {\n  \t\tvar tileSize = this.getTileSize();\n  \t\treturn new Bounds(\n  \t\t\tbounds.min.unscaleBy(tileSize).floor(),\n  \t\t\tbounds.max.unscaleBy(tileSize).ceil().subtract([1, 1]));\n  \t},\n\n  \t_noTilesToLoad: function () {\n  \t\tfor (var key in this._tiles) {\n  \t\t\tif (!this._tiles[key].loaded) { return false; }\n  \t\t}\n  \t\treturn true;\n  \t}\n  });\n\n  // @factory L.gridLayer(options?: GridLayer options)\n  // Creates a new instance of GridLayer with the supplied options.\n  function gridLayer(options) {\n  \treturn new GridLayer(options);\n  }\n\n  /*\r\n   * @class TileLayer\r\n   * @inherits GridLayer\r\n   * @aka L.TileLayer\r\n   * Used to load and display tile layers on the map. Note that most tile servers require attribution, which you can set under `Layer`. Extends `GridLayer`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png?{foo}', {foo: 'bar', attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'}).addTo(map);\n   * ```\r\n   *\r\n   * @section URL template\r\n   * @example\r\n   *\r\n   * A string of the following form:\r\n   *\r\n   * ```\r\n   * 'https://{s}.somedomain.com/blabla/{z}/{x}/{y}{r}.png'\r\n   * ```\r\n   *\r\n   * `{s}` means one of the available subdomains (used sequentially to help with browser parallel requests per domain limitation; subdomain values are specified in options; `a`, `b` or `c` by default, can be omitted), `{z}`  zoom level, `{x}` and `{y}`  tile coordinates. `{r}` can be used to add \"&commat;2x\" to the URL to load retina tiles.\r\n   *\r\n   * You can use custom keys in the template, which will be [evaluated](#util-template) from TileLayer options, like this:\r\n   *\r\n   * ```\r\n   * L.tileLayer('https://{s}.somedomain.com/{foo}/{z}/{x}/{y}.png', {foo: 'bar'});\r\n   * ```\r\n   */\r\n\r\n\r\n  var TileLayer = GridLayer.extend({\r\n\r\n  \t// @section\r\n  \t// @aka TileLayer options\r\n  \toptions: {\r\n  \t\t// @option minZoom: Number = 0\r\n  \t\t// The minimum zoom level down to which this layer will be displayed (inclusive).\r\n  \t\tminZoom: 0,\r\n\r\n  \t\t// @option maxZoom: Number = 18\r\n  \t\t// The maximum zoom level up to which this layer will be displayed (inclusive).\r\n  \t\tmaxZoom: 18,\r\n\r\n  \t\t// @option subdomains: String|String[] = 'abc'\r\n  \t\t// Subdomains of the tile service. Can be passed in the form of one string (where each letter is a subdomain name) or an array of strings.\r\n  \t\tsubdomains: 'abc',\r\n\r\n  \t\t// @option errorTileUrl: String = ''\r\n  \t\t// URL to the tile image to show in place of the tile that failed to load.\r\n  \t\terrorTileUrl: '',\r\n\r\n  \t\t// @option zoomOffset: Number = 0\r\n  \t\t// The zoom number used in tile URLs will be offset with this value.\r\n  \t\tzoomOffset: 0,\r\n\r\n  \t\t// @option tms: Boolean = false\r\n  \t\t// If `true`, inverses Y axis numbering for tiles (turn this on for [TMS](https://en.wikipedia.org/wiki/Tile_Map_Service) services).\r\n  \t\ttms: false,\r\n\r\n  \t\t// @option zoomReverse: Boolean = false\r\n  \t\t// If set to true, the zoom number used in tile URLs will be reversed (`maxZoom - zoom` instead of `zoom`)\r\n  \t\tzoomReverse: false,\r\n\r\n  \t\t// @option detectRetina: Boolean = false\r\n  \t\t// If `true` and user is on a retina display, it will request four tiles of half the specified size and a bigger zoom level in place of one to utilize the high resolution.\r\n  \t\tdetectRetina: false,\r\n\r\n  \t\t// @option crossOrigin: Boolean|String = false\r\n  \t\t// Whether the crossOrigin attribute will be added to the tiles.\r\n  \t\t// If a String is provided, all tiles will have their crossOrigin attribute set to the String provided. This is needed if you want to access tile pixel data.\r\n  \t\t// Refer to [CORS Settings](https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_settings_attributes) for valid String values.\r\n  \t\tcrossOrigin: false,\r\n\r\n  \t\t// @option referrerPolicy: Boolean|String = false\r\n  \t\t// Whether the referrerPolicy attribute will be added to the tiles.\r\n  \t\t// If a String is provided, all tiles will have their referrerPolicy attribute set to the String provided.\r\n  \t\t// This may be needed if your map's rendering context has a strict default but your tile provider expects a valid referrer\r\n  \t\t// (e.g. to validate an API token).\r\n  \t\t// Refer to [HTMLImageElement.referrerPolicy](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/referrerPolicy) for valid String values.\r\n  \t\treferrerPolicy: false\r\n  \t},\r\n\r\n  \tinitialize: function (url, options) {\r\n\r\n  \t\tthis._url = url;\r\n\r\n  \t\toptions = setOptions(this, options);\r\n\r\n  \t\t// detecting retina displays, adjusting tileSize and zoom levels\r\n  \t\tif (options.detectRetina && Browser.retina && options.maxZoom > 0) {\r\n\r\n  \t\t\toptions.tileSize = Math.floor(options.tileSize / 2);\r\n\r\n  \t\t\tif (!options.zoomReverse) {\r\n  \t\t\t\toptions.zoomOffset++;\r\n  \t\t\t\toptions.maxZoom = Math.max(options.minZoom, options.maxZoom - 1);\r\n  \t\t\t} else {\r\n  \t\t\t\toptions.zoomOffset--;\r\n  \t\t\t\toptions.minZoom = Math.min(options.maxZoom, options.minZoom + 1);\r\n  \t\t\t}\r\n\r\n  \t\t\toptions.minZoom = Math.max(0, options.minZoom);\r\n  \t\t} else if (!options.zoomReverse) {\r\n  \t\t\t// make sure maxZoom is gte minZoom\r\n  \t\t\toptions.maxZoom = Math.max(options.minZoom, options.maxZoom);\r\n  \t\t} else {\r\n  \t\t\t// make sure minZoom is lte maxZoom\r\n  \t\t\toptions.minZoom = Math.min(options.maxZoom, options.minZoom);\r\n  \t\t}\r\n\r\n  \t\tif (typeof options.subdomains === 'string') {\r\n  \t\t\toptions.subdomains = options.subdomains.split('');\r\n  \t\t}\r\n\r\n  \t\tthis.on('tileunload', this._onTileRemove);\r\n  \t},\r\n\r\n  \t// @method setUrl(url: String, noRedraw?: Boolean): this\r\n  \t// Updates the layer's URL template and redraws it (unless `noRedraw` is set to `true`).\r\n  \t// If the URL does not change, the layer will not be redrawn unless\r\n  \t// the noRedraw parameter is set to false.\r\n  \tsetUrl: function (url, noRedraw) {\r\n  \t\tif (this._url === url && noRedraw === undefined) {\r\n  \t\t\tnoRedraw = true;\r\n  \t\t}\r\n\r\n  \t\tthis._url = url;\r\n\r\n  \t\tif (!noRedraw) {\r\n  \t\t\tthis.redraw();\r\n  \t\t}\r\n  \t\treturn this;\r\n  \t},\r\n\r\n  \t// @method createTile(coords: Object, done?: Function): HTMLElement\r\n  \t// Called only internally, overrides GridLayer's [`createTile()`](#gridlayer-createtile)\r\n  \t// to return an `<img>` HTML element with the appropriate image URL given `coords`. The `done`\r\n  \t// callback is called when the tile has been loaded.\r\n  \tcreateTile: function (coords, done) {\r\n  \t\tvar tile = document.createElement('img');\r\n\r\n  \t\ton(tile, 'load', bind(this._tileOnLoad, this, done, tile));\r\n  \t\ton(tile, 'error', bind(this._tileOnError, this, done, tile));\r\n\r\n  \t\tif (this.options.crossOrigin || this.options.crossOrigin === '') {\r\n  \t\t\ttile.crossOrigin = this.options.crossOrigin === true ? '' : this.options.crossOrigin;\r\n  \t\t}\r\n\r\n  \t\t// for this new option we follow the documented behavior\r\n  \t\t// more closely by only setting the property when string\r\n  \t\tif (typeof this.options.referrerPolicy === 'string') {\r\n  \t\t\ttile.referrerPolicy = this.options.referrerPolicy;\r\n  \t\t}\r\n\r\n  \t\t// The alt attribute is set to the empty string,\r\n  \t\t// allowing screen readers to ignore the decorative image tiles.\r\n  \t\t// https://www.w3.org/WAI/tutorials/images/decorative/\r\n  \t\t// https://www.w3.org/TR/html-aria/#el-img-empty-alt\r\n  \t\ttile.alt = '';\r\n\r\n  \t\ttile.src = this.getTileUrl(coords);\r\n\r\n  \t\treturn tile;\r\n  \t},\r\n\r\n  \t// @section Extension methods\r\n  \t// @uninheritable\r\n  \t// Layers extending `TileLayer` might reimplement the following method.\r\n  \t// @method getTileUrl(coords: Object): String\r\n  \t// Called only internally, returns the URL for a tile given its coordinates.\r\n  \t// Classes extending `TileLayer` can override this function to provide custom tile URL naming schemes.\r\n  \tgetTileUrl: function (coords) {\r\n  \t\tvar data = {\r\n  \t\t\tr: Browser.retina ? '@2x' : '',\r\n  \t\t\ts: this._getSubdomain(coords),\r\n  \t\t\tx: coords.x,\r\n  \t\t\ty: coords.y,\r\n  \t\t\tz: this._getZoomForUrl()\r\n  \t\t};\r\n  \t\tif (this._map && !this._map.options.crs.infinite) {\r\n  \t\t\tvar invertedY = this._globalTileRange.max.y - coords.y;\r\n  \t\t\tif (this.options.tms) {\r\n  \t\t\t\tdata['y'] = invertedY;\r\n  \t\t\t}\r\n  \t\t\tdata['-y'] = invertedY;\r\n  \t\t}\r\n\r\n  \t\treturn template(this._url, extend(data, this.options));\r\n  \t},\r\n\r\n  \t_tileOnLoad: function (done, tile) {\r\n  \t\t// For https://github.com/Leaflet/Leaflet/issues/3332\r\n  \t\tif (Browser.ielt9) {\r\n  \t\t\tsetTimeout(bind(done, this, null, tile), 0);\r\n  \t\t} else {\r\n  \t\t\tdone(null, tile);\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_tileOnError: function (done, tile, e) {\r\n  \t\tvar errorUrl = this.options.errorTileUrl;\r\n  \t\tif (errorUrl && tile.getAttribute('src') !== errorUrl) {\r\n  \t\t\ttile.src = errorUrl;\r\n  \t\t}\r\n  \t\tdone(e, tile);\r\n  \t},\r\n\r\n  \t_onTileRemove: function (e) {\r\n  \t\te.tile.onload = null;\r\n  \t},\r\n\r\n  \t_getZoomForUrl: function () {\r\n  \t\tvar zoom = this._tileZoom,\r\n  \t\tmaxZoom = this.options.maxZoom,\r\n  \t\tzoomReverse = this.options.zoomReverse,\r\n  \t\tzoomOffset = this.options.zoomOffset;\r\n\r\n  \t\tif (zoomReverse) {\r\n  \t\t\tzoom = maxZoom - zoom;\r\n  \t\t}\r\n\r\n  \t\treturn zoom + zoomOffset;\r\n  \t},\r\n\r\n  \t_getSubdomain: function (tilePoint) {\r\n  \t\tvar index = Math.abs(tilePoint.x + tilePoint.y) % this.options.subdomains.length;\r\n  \t\treturn this.options.subdomains[index];\r\n  \t},\r\n\r\n  \t// stops loading all tiles in the background layer\r\n  \t_abortLoading: function () {\r\n  \t\tvar i, tile;\r\n  \t\tfor (i in this._tiles) {\r\n  \t\t\tif (this._tiles[i].coords.z !== this._tileZoom) {\r\n  \t\t\t\ttile = this._tiles[i].el;\r\n\r\n  \t\t\t\ttile.onload = falseFn;\r\n  \t\t\t\ttile.onerror = falseFn;\r\n\r\n  \t\t\t\tif (!tile.complete) {\r\n  \t\t\t\t\ttile.src = emptyImageUrl;\r\n  \t\t\t\t\tvar coords = this._tiles[i].coords;\r\n  \t\t\t\t\tremove(tile);\r\n  \t\t\t\t\tdelete this._tiles[i];\r\n  \t\t\t\t\t// @event tileabort: TileEvent\r\n  \t\t\t\t\t// Fired when a tile was loading but is now not wanted.\r\n  \t\t\t\t\tthis.fire('tileabort', {\r\n  \t\t\t\t\t\ttile: tile,\r\n  \t\t\t\t\t\tcoords: coords\r\n  \t\t\t\t\t});\r\n  \t\t\t\t}\r\n  \t\t\t}\r\n  \t\t}\r\n  \t},\r\n\r\n  \t_removeTile: function (key) {\r\n  \t\tvar tile = this._tiles[key];\r\n  \t\tif (!tile) { return; }\r\n\r\n  \t\t// Cancels any pending http requests associated with the tile\r\n  \t\ttile.el.setAttribute('src', emptyImageUrl);\r\n\r\n  \t\treturn GridLayer.prototype._removeTile.call(this, key);\r\n  \t},\r\n\r\n  \t_tileReady: function (coords, err, tile) {\r\n  \t\tif (!this._map || (tile && tile.getAttribute('src') === emptyImageUrl)) {\r\n  \t\t\treturn;\r\n  \t\t}\r\n\r\n  \t\treturn GridLayer.prototype._tileReady.call(this, coords, err, tile);\r\n  \t}\r\n  });\r\n\r\n\r\n  // @factory L.tilelayer(urlTemplate: String, options?: TileLayer options)\r\n  // Instantiates a tile layer object given a `URL template` and optionally an options object.\r\n\r\n  function tileLayer(url, options) {\r\n  \treturn new TileLayer(url, options);\r\n  }\n\n  /*\r\n   * @class TileLayer.WMS\r\n   * @inherits TileLayer\r\n   * @aka L.TileLayer.WMS\r\n   * Used to display [WMS](https://en.wikipedia.org/wiki/Web_Map_Service) services as tile layers on the map. Extends `TileLayer`.\r\n   *\r\n   * @example\r\n   *\r\n   * ```js\r\n   * var nexrad = L.tileLayer.wms(\"http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi\", {\r\n   * \tlayers: 'nexrad-n0r-900913',\r\n   * \tformat: 'image/png',\r\n   * \ttransparent: true,\r\n   * \tattribution: \"Weather data  2012 IEM Nexrad\"\r\n   * });\r\n   * ```\r\n   */\r\n\r\n  var TileLayerWMS = TileLayer.extend({\r\n\r\n  \t// @section\r\n  \t// @aka TileLayer.WMS options\r\n  \t// If any custom options not documented here are used, they will be sent to the\r\n  \t// WMS server as extra parameters in each request URL. This can be useful for\r\n  \t// [non-standard vendor WMS parameters](https://docs.geoserver.org/stable/en/user/services/wms/vendor.html).\r\n  \tdefaultWmsParams: {\r\n  \t\tservice: 'WMS',\r\n  \t\trequest: 'GetMap',\r\n\r\n  \t\t// @option layers: String = ''\r\n  \t\t// **(required)** Comma-separated list of WMS layers to show.\r\n  \t\tlayers: '',\r\n\r\n  \t\t// @option styles: String = ''\r\n  \t\t// Comma-separated list of WMS styles.\r\n  \t\tstyles: '',\r\n\r\n  \t\t// @option format: String = 'image/jpeg'\r\n  \t\t// WMS image format (use `'image/png'` for layers with transparency).\r\n  \t\tformat: 'image/jpeg',\r\n\r\n  \t\t// @option transparent: Boolean = false\r\n  \t\t// If `true`, the WMS service will return images with transparency.\r\n  \t\ttransparent: false,\r\n\r\n  \t\t// @option version: String = '1.1.1'\r\n  \t\t// Version of the WMS service to use\r\n  \t\tversion: '1.1.1'\r\n  \t},\r\n\r\n  \toptions: {\r\n  \t\t// @option crs: CRS = null\r\n  \t\t// Coordinate Reference System to use for the WMS requests, defaults to\r\n  \t\t// map CRS. Don't change this if you're not sure what it means.\r\n  \t\tcrs: null,\r\n\r\n  \t\t// @option uppercase: Boolean = false\r\n  \t\t// If `true`, WMS request parameter keys will be uppercase.\r\n  \t\tuppercase: false\r\n  \t},\r\n\r\n  \tinitialize: function (url, options) {\r\n\r\n  \t\tthis._url = url;\r\n\r\n  \t\tvar wmsParams = extend({}, this.defaultWmsParams);\r\n\r\n  \t\t// all keys that are not TileLayer options go to WMS params\r\n  \t\tfor (var i in options) {\r\n  \t\t\tif (!(i in this.options)) {\r\n  \t\t\t\twmsParams[i] = options[i];\r\n  \t\t\t}\r\n  \t\t}\r\n\r\n  \t\toptions = setOptions(this, options);\r\n\r\n  \t\tvar realRetina = options.detectRetina && Browser.retina ? 2 : 1;\r\n  \t\tvar tileSize = this.getTileSize();\r\n  \t\twmsParams.width = tileSize.x * realRetina;\r\n  \t\twmsParams.height = tileSize.y * realRetina;\r\n\r\n  \t\tthis.wmsParams = wmsParams;\r\n  \t},\r\n\r\n  \tonAdd: function (map) {\r\n\r\n  \t\tthis._crs = this.options.crs || map.options.crs;\r\n  \t\tthis._wmsVersion = parseFloat(this.wmsParams.version);\r\n\r\n  \t\tvar projectionKey = this._wmsVersion >= 1.3 ? 'crs' : 'srs';\r\n  \t\tthis.wmsParams[projectionKey] = this._crs.code;\r\n\r\n  \t\tTileLayer.prototype.onAdd.call(this, map);\r\n  \t},\r\n\r\n  \tgetTileUrl: function (coords) {\r\n\r\n  \t\tvar tileBounds = this._tileCoordsToNwSe(coords),\r\n  \t\t    crs = this._crs,\r\n  \t\t    bounds = toBounds(crs.project(tileBounds[0]), crs.project(tileBounds[1])),\r\n  \t\t    min = bounds.min,\r\n  \t\t    max = bounds.max,\r\n  \t\t    bbox = (this._wmsVersion >= 1.3 && this._crs === EPSG4326 ?\r\n  \t\t    [min.y, min.x, max.y, max.x] :\r\n  \t\t    [min.x, min.y, max.x, max.y]).join(','),\r\n  \t\t    url = TileLayer.prototype.getTileUrl.call(this, coords);\r\n  \t\treturn url +\r\n  \t\t\tgetParamString(this.wmsParams, url, this.options.uppercase) +\r\n  \t\t\t(this.options.uppercase ? '&BBOX=' : '&bbox=') + bbox;\r\n  \t},\r\n\r\n  \t// @method setParams(params: Object, noRedraw?: Boolean): this\r\n  \t// Merges an object with the new parameters and re-requests tiles on the current screen (unless `noRedraw` was set to true).\r\n  \tsetParams: function (params, noRedraw) {\r\n\r\n  \t\textend(this.wmsParams, params);\r\n\r\n  \t\tif (!noRedraw) {\r\n  \t\t\tthis.redraw();\r\n  \t\t}\r\n\r\n  \t\treturn this;\r\n  \t}\r\n  });\r\n\r\n\r\n  // @factory L.tileLayer.wms(baseUrl: String, options: TileLayer.WMS options)\r\n  // Instantiates a WMS tile layer object given a base URL of the WMS service and a WMS parameters/options object.\r\n  function tileLayerWMS(url, options) {\r\n  \treturn new TileLayerWMS(url, options);\r\n  }\n\n  TileLayer.WMS = TileLayerWMS;\n  tileLayer.wms = tileLayerWMS;\n\n  /*\n   * @class Renderer\n   * @inherits Layer\n   * @aka L.Renderer\n   *\n   * Base class for vector renderer implementations (`SVG`, `Canvas`). Handles the\n   * DOM container of the renderer, its bounds, and its zoom animation.\n   *\n   * A `Renderer` works as an implicit layer group for all `Path`s - the renderer\n   * itself can be added or removed to the map. All paths use a renderer, which can\n   * be implicit (the map will decide the type of renderer and use it automatically)\n   * or explicit (using the [`renderer`](#path-renderer) option of the path).\n   *\n   * Do not use this class directly, use `SVG` and `Canvas` instead.\n   *\n   * @event update: Event\n   * Fired when the renderer updates its bounds, center and zoom, for example when\n   * its map has moved\n   */\n\n  var Renderer = Layer.extend({\n\n  \t// @section\n  \t// @aka Renderer options\n  \toptions: {\n  \t\t// @option padding: Number = 0.1\n  \t\t// How much to extend the clip area around the map view (relative to its size)\n  \t\t// e.g. 0.1 would be 10% of map view in each direction\n  \t\tpadding: 0.1\n  \t},\n\n  \tinitialize: function (options) {\n  \t\tsetOptions(this, options);\n  \t\tstamp(this);\n  \t\tthis._layers = this._layers || {};\n  \t},\n\n  \tonAdd: function () {\n  \t\tif (!this._container) {\n  \t\t\tthis._initContainer(); // defined by renderer implementations\n\n  \t\t\t// always keep transform-origin as 0 0\n  \t\t\taddClass(this._container, 'leaflet-zoom-animated');\n  \t\t}\n\n  \t\tthis.getPane().appendChild(this._container);\n  \t\tthis._update();\n  \t\tthis.on('update', this._updatePaths, this);\n  \t},\n\n  \tonRemove: function () {\n  \t\tthis.off('update', this._updatePaths, this);\n  \t\tthis._destroyContainer();\n  \t},\n\n  \tgetEvents: function () {\n  \t\tvar events = {\n  \t\t\tviewreset: this._reset,\n  \t\t\tzoom: this._onZoom,\n  \t\t\tmoveend: this._update,\n  \t\t\tzoomend: this._onZoomEnd\n  \t\t};\n  \t\tif (this._zoomAnimated) {\n  \t\t\tevents.zoomanim = this._onAnimZoom;\n  \t\t}\n  \t\treturn events;\n  \t},\n\n  \t_onAnimZoom: function (ev) {\n  \t\tthis._updateTransform(ev.center, ev.zoom);\n  \t},\n\n  \t_onZoom: function () {\n  \t\tthis._updateTransform(this._map.getCenter(), this._map.getZoom());\n  \t},\n\n  \t_updateTransform: function (center, zoom) {\n  \t\tvar scale = this._map.getZoomScale(zoom, this._zoom),\n  \t\t    viewHalf = this._map.getSize().multiplyBy(0.5 + this.options.padding),\n  \t\t    currentCenterPoint = this._map.project(this._center, zoom),\n\n  \t\t    topLeftOffset = viewHalf.multiplyBy(-scale).add(currentCenterPoint)\n  \t\t\t\t  .subtract(this._map._getNewPixelOrigin(center, zoom));\n\n  \t\tif (Browser.any3d) {\n  \t\t\tsetTransform(this._container, topLeftOffset, scale);\n  \t\t} else {\n  \t\t\tsetPosition(this._container, topLeftOffset);\n  \t\t}\n  \t},\n\n  \t_reset: function () {\n  \t\tthis._update();\n  \t\tthis._updateTransform(this._center, this._zoom);\n\n  \t\tfor (var id in this._layers) {\n  \t\t\tthis._layers[id]._reset();\n  \t\t}\n  \t},\n\n  \t_onZoomEnd: function () {\n  \t\tfor (var id in this._layers) {\n  \t\t\tthis._layers[id]._project();\n  \t\t}\n  \t},\n\n  \t_updatePaths: function () {\n  \t\tfor (var id in this._layers) {\n  \t\t\tthis._layers[id]._update();\n  \t\t}\n  \t},\n\n  \t_update: function () {\n  \t\t// Update pixel bounds of renderer container (for positioning/sizing/clipping later)\n  \t\t// Subclasses are responsible of firing the 'update' event.\n  \t\tvar p = this.options.padding,\n  \t\t    size = this._map.getSize(),\n  \t\t    min = this._map.containerPointToLayerPoint(size.multiplyBy(-p)).round();\n\n  \t\tthis._bounds = new Bounds(min, min.add(size.multiplyBy(1 + p * 2)).round());\n\n  \t\tthis._center = this._map.getCenter();\n  \t\tthis._zoom = this._map.getZoom();\n  \t}\n  });\n\n  /*\n   * @class Canvas\n   * @inherits Renderer\n   * @aka L.Canvas\n   *\n   * Allows vector layers to be displayed with [`<canvas>`](https://developer.mozilla.org/docs/Web/API/Canvas_API).\n   * Inherits `Renderer`.\n   *\n   * Due to [technical limitations](https://caniuse.com/canvas), Canvas is not\n   * available in all web browsers, notably IE8, and overlapping geometries might\n   * not display properly in some edge cases.\n   *\n   * @example\n   *\n   * Use Canvas by default for all paths in the map:\n   *\n   * ```js\n   * var map = L.map('map', {\n   * \trenderer: L.canvas()\n   * });\n   * ```\n   *\n   * Use a Canvas renderer with extra padding for specific vector geometries:\n   *\n   * ```js\n   * var map = L.map('map');\n   * var myRenderer = L.canvas({ padding: 0.5 });\n   * var line = L.polyline( coordinates, { renderer: myRenderer } );\n   * var circle = L.circle( center, { renderer: myRenderer } );\n   * ```\n   */\n\n  var Canvas = Renderer.extend({\n\n  \t// @section\n  \t// @aka Canvas options\n  \toptions: {\n  \t\t// @option tolerance: Number = 0\n  \t\t// How much to extend the click tolerance around a path/object on the map.\n  \t\ttolerance: 0\n  \t},\n\n  \tgetEvents: function () {\n  \t\tvar events = Renderer.prototype.getEvents.call(this);\n  \t\tevents.viewprereset = this._onViewPreReset;\n  \t\treturn events;\n  \t},\n\n  \t_onViewPreReset: function () {\n  \t\t// Set a flag so that a viewprereset+moveend+viewreset only updates&redraws once\n  \t\tthis._postponeUpdatePaths = true;\n  \t},\n\n  \tonAdd: function () {\n  \t\tRenderer.prototype.onAdd.call(this);\n\n  \t\t// Redraw vectors since canvas is cleared upon removal,\n  \t\t// in case of removing the renderer itself from the map.\n  \t\tthis._draw();\n  \t},\n\n  \t_initContainer: function () {\n  \t\tvar container = this._container = document.createElement('canvas');\n\n  \t\ton(container, 'mousemove', this._onMouseMove, this);\n  \t\ton(container, 'click dblclick mousedown mouseup contextmenu', this._onClick, this);\n  \t\ton(container, 'mouseout', this._handleMouseOut, this);\n  \t\tcontainer['_leaflet_disable_events'] = true;\n\n  \t\tthis._ctx = container.getContext('2d');\n  \t},\n\n  \t_destroyContainer: function () {\n  \t\tcancelAnimFrame(this._redrawRequest);\n  \t\tdelete this._ctx;\n  \t\tremove(this._container);\n  \t\toff(this._container);\n  \t\tdelete this._container;\n  \t},\n\n  \t_updatePaths: function () {\n  \t\tif (this._postponeUpdatePaths) { return; }\n\n  \t\tvar layer;\n  \t\tthis._redrawBounds = null;\n  \t\tfor (var id in this._layers) {\n  \t\t\tlayer = this._layers[id];\n  \t\t\tlayer._update();\n  \t\t}\n  \t\tthis._redraw();\n  \t},\n\n  \t_update: function () {\n  \t\tif (this._map._animatingZoom && this._bounds) { return; }\n\n  \t\tRenderer.prototype._update.call(this);\n\n  \t\tvar b = this._bounds,\n  \t\t    container = this._container,\n  \t\t    size = b.getSize(),\n  \t\t    m = Browser.retina ? 2 : 1;\n\n  \t\tsetPosition(container, b.min);\n\n  \t\t// set canvas size (also clearing it); use double size on retina\n  \t\tcontainer.width = m * size.x;\n  \t\tcontainer.height = m * size.y;\n  \t\tcontainer.style.width = size.x + 'px';\n  \t\tcontainer.style.height = size.y + 'px';\n\n  \t\tif (Browser.retina) {\n  \t\t\tthis._ctx.scale(2, 2);\n  \t\t}\n\n  \t\t// translate so we use the same path coordinates after canvas element moves\n  \t\tthis._ctx.translate(-b.min.x, -b.min.y);\n\n  \t\t// Tell paths to redraw themselves\n  \t\tthis.fire('update');\n  \t},\n\n  \t_reset: function () {\n  \t\tRenderer.prototype._reset.call(this);\n\n  \t\tif (this._postponeUpdatePaths) {\n  \t\t\tthis._postponeUpdatePaths = false;\n  \t\t\tthis._updatePaths();\n  \t\t}\n  \t},\n\n  \t_initPath: function (layer) {\n  \t\tthis._updateDashArray(layer);\n  \t\tthis._layers[stamp(layer)] = layer;\n\n  \t\tvar order = layer._order = {\n  \t\t\tlayer: layer,\n  \t\t\tprev: this._drawLast,\n  \t\t\tnext: null\n  \t\t};\n  \t\tif (this._drawLast) { this._drawLast.next = order; }\n  \t\tthis._drawLast = order;\n  \t\tthis._drawFirst = this._drawFirst || this._drawLast;\n  \t},\n\n  \t_addPath: function (layer) {\n  \t\tthis._requestRedraw(layer);\n  \t},\n\n  \t_removePath: function (layer) {\n  \t\tvar order = layer._order;\n  \t\tvar next = order.next;\n  \t\tvar prev = order.prev;\n\n  \t\tif (next) {\n  \t\t\tnext.prev = prev;\n  \t\t} else {\n  \t\t\tthis._drawLast = prev;\n  \t\t}\n  \t\tif (prev) {\n  \t\t\tprev.next = next;\n  \t\t} else {\n  \t\t\tthis._drawFirst = next;\n  \t\t}\n\n  \t\tdelete layer._order;\n\n  \t\tdelete this._layers[stamp(layer)];\n\n  \t\tthis._requestRedraw(layer);\n  \t},\n\n  \t_updatePath: function (layer) {\n  \t\t// Redraw the union of the layer's old pixel\n  \t\t// bounds and the new pixel bounds.\n  \t\tthis._extendRedrawBounds(layer);\n  \t\tlayer._project();\n  \t\tlayer._update();\n  \t\t// The redraw will extend the redraw bounds\n  \t\t// with the new pixel bounds.\n  \t\tthis._requestRedraw(layer);\n  \t},\n\n  \t_updateStyle: function (layer) {\n  \t\tthis._updateDashArray(layer);\n  \t\tthis._requestRedraw(layer);\n  \t},\n\n  \t_updateDashArray: function (layer) {\n  \t\tif (typeof layer.options.dashArray === 'string') {\n  \t\t\tvar parts = layer.options.dashArray.split(/[, ]+/),\n  \t\t\t    dashArray = [],\n  \t\t\t    dashValue,\n  \t\t\t    i;\n  \t\t\tfor (i = 0; i < parts.length; i++) {\n  \t\t\t\tdashValue = Number(parts[i]);\n  \t\t\t\t// Ignore dash array containing invalid lengths\n  \t\t\t\tif (isNaN(dashValue)) { return; }\n  \t\t\t\tdashArray.push(dashValue);\n  \t\t\t}\n  \t\t\tlayer.options._dashArray = dashArray;\n  \t\t} else {\n  \t\t\tlayer.options._dashArray = layer.options.dashArray;\n  \t\t}\n  \t},\n\n  \t_requestRedraw: function (layer) {\n  \t\tif (!this._map) { return; }\n\n  \t\tthis._extendRedrawBounds(layer);\n  \t\tthis._redrawRequest = this._redrawRequest || requestAnimFrame(this._redraw, this);\n  \t},\n\n  \t_extendRedrawBounds: function (layer) {\n  \t\tif (layer._pxBounds) {\n  \t\t\tvar padding = (layer.options.weight || 0) + 1;\n  \t\t\tthis._redrawBounds = this._redrawBounds || new Bounds();\n  \t\t\tthis._redrawBounds.extend(layer._pxBounds.min.subtract([padding, padding]));\n  \t\t\tthis._redrawBounds.extend(layer._pxBounds.max.add([padding, padding]));\n  \t\t}\n  \t},\n\n  \t_redraw: function () {\n  \t\tthis._redrawRequest = null;\n\n  \t\tif (this._redrawBounds) {\n  \t\t\tthis._redrawBounds.min._floor();\n  \t\t\tthis._redrawBounds.max._ceil();\n  \t\t}\n\n  \t\tthis._clear(); // clear layers in redraw bounds\n  \t\tthis._draw(); // draw layers\n\n  \t\tthis._redrawBounds = null;\n  \t},\n\n  \t_clear: function () {\n  \t\tvar bounds = this._redrawBounds;\n  \t\tif (bounds) {\n  \t\t\tvar size = bounds.getSize();\n  \t\t\tthis._ctx.clearRect(bounds.min.x, bounds.min.y, size.x, size.y);\n  \t\t} else {\n  \t\t\tthis._ctx.save();\n  \t\t\tthis._ctx.setTransform(1, 0, 0, 1, 0, 0);\n  \t\t\tthis._ctx.clearRect(0, 0, this._container.width, this._container.height);\n  \t\t\tthis._ctx.restore();\n  \t\t}\n  \t},\n\n  \t_draw: function () {\n  \t\tvar layer, bounds = this._redrawBounds;\n  \t\tthis._ctx.save();\n  \t\tif (bounds) {\n  \t\t\tvar size = bounds.getSize();\n  \t\t\tthis._ctx.beginPath();\n  \t\t\tthis._ctx.rect(bounds.min.x, bounds.min.y, size.x, size.y);\n  \t\t\tthis._ctx.clip();\n  \t\t}\n\n  \t\tthis._drawing = true;\n\n  \t\tfor (var order = this._drawFirst; order; order = order.next) {\n  \t\t\tlayer = order.layer;\n  \t\t\tif (!bounds || (layer._pxBounds && layer._pxBounds.intersects(bounds))) {\n  \t\t\t\tlayer._updatePath();\n  \t\t\t}\n  \t\t}\n\n  \t\tthis._drawing = false;\n\n  \t\tthis._ctx.restore();  // Restore state before clipping.\n  \t},\n\n  \t_updatePoly: function (layer, closed) {\n  \t\tif (!this._drawing) { return; }\n\n  \t\tvar i, j, len2, p,\n  \t\t    parts = layer._parts,\n  \t\t    len = parts.length,\n  \t\t    ctx = this._ctx;\n\n  \t\tif (!len) { return; }\n\n  \t\tctx.beginPath();\n\n  \t\tfor (i = 0; i < len; i++) {\n  \t\t\tfor (j = 0, len2 = parts[i].length; j < len2; j++) {\n  \t\t\t\tp = parts[i][j];\n  \t\t\t\tctx[j ? 'lineTo' : 'moveTo'](p.x, p.y);\n  \t\t\t}\n  \t\t\tif (closed) {\n  \t\t\t\tctx.closePath();\n  \t\t\t}\n  \t\t}\n\n  \t\tthis._fillStroke(ctx, layer);\n\n  \t\t// TODO optimization: 1 fill/stroke for all features with equal style instead of 1 for each feature\n  \t},\n\n  \t_updateCircle: function (layer) {\n\n  \t\tif (!this._drawing || layer._empty()) { return; }\n\n  \t\tvar p = layer._point,\n  \t\t    ctx = this._ctx,\n  \t\t    r = Math.max(Math.round(layer._radius), 1),\n  \t\t    s = (Math.max(Math.round(layer._radiusY), 1) || r) / r;\n\n  \t\tif (s !== 1) {\n  \t\t\tctx.save();\n  \t\t\tctx.scale(1, s);\n  \t\t}\n\n  \t\tctx.beginPath();\n  \t\tctx.arc(p.x, p.y / s, r, 0, Math.PI * 2, false);\n\n  \t\tif (s !== 1) {\n  \t\t\tctx.restore();\n  \t\t}\n\n  \t\tthis._fillStroke(ctx, layer);\n  \t},\n\n  \t_fillStroke: function (ctx, layer) {\n  \t\tvar options = layer.options;\n\n  \t\tif (options.fill) {\n  \t\t\tctx.globalAlpha = options.fillOpacity;\n  \t\t\tctx.fillStyle = options.fillColor || options.color;\n  \t\t\tctx.fill(options.fillRule || 'evenodd');\n  \t\t}\n\n  \t\tif (options.stroke && options.weight !== 0) {\n  \t\t\tif (ctx.setLineDash) {\n  \t\t\t\tctx.setLineDash(layer.options && layer.options._dashArray || []);\n  \t\t\t}\n  \t\t\tctx.globalAlpha = options.opacity;\n  \t\t\tctx.lineWidth = options.weight;\n  \t\t\tctx.strokeStyle = options.color;\n  \t\t\tctx.lineCap = options.lineCap;\n  \t\t\tctx.lineJoin = options.lineJoin;\n  \t\t\tctx.stroke();\n  \t\t}\n  \t},\n\n  \t// Canvas obviously doesn't have mouse events for individual drawn objects,\n  \t// so we emulate that by calculating what's under the mouse on mousemove/click manually\n\n  \t_onClick: function (e) {\n  \t\tvar point = this._map.mouseEventToLayerPoint(e), layer, clickedLayer;\n\n  \t\tfor (var order = this._drawFirst; order; order = order.next) {\n  \t\t\tlayer = order.layer;\n  \t\t\tif (layer.options.interactive && layer._containsPoint(point)) {\n  \t\t\t\tif (!(e.type === 'click' || e.type === 'preclick') || !this._map._draggableMoved(layer)) {\n  \t\t\t\t\tclickedLayer = layer;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t\tthis._fireEvent(clickedLayer ? [clickedLayer] : false, e);\n  \t},\n\n  \t_onMouseMove: function (e) {\n  \t\tif (!this._map || this._map.dragging.moving() || this._map._animatingZoom) { return; }\n\n  \t\tvar point = this._map.mouseEventToLayerPoint(e);\n  \t\tthis._handleMouseHover(e, point);\n  \t},\n\n\n  \t_handleMouseOut: function (e) {\n  \t\tvar layer = this._hoveredLayer;\n  \t\tif (layer) {\n  \t\t\t// if we're leaving the layer, fire mouseout\n  \t\t\tremoveClass(this._container, 'leaflet-interactive');\n  \t\t\tthis._fireEvent([layer], e, 'mouseout');\n  \t\t\tthis._hoveredLayer = null;\n  \t\t\tthis._mouseHoverThrottled = false;\n  \t\t}\n  \t},\n\n  \t_handleMouseHover: function (e, point) {\n  \t\tif (this._mouseHoverThrottled) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar layer, candidateHoveredLayer;\n\n  \t\tfor (var order = this._drawFirst; order; order = order.next) {\n  \t\t\tlayer = order.layer;\n  \t\t\tif (layer.options.interactive && layer._containsPoint(point)) {\n  \t\t\t\tcandidateHoveredLayer = layer;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (candidateHoveredLayer !== this._hoveredLayer) {\n  \t\t\tthis._handleMouseOut(e);\n\n  \t\t\tif (candidateHoveredLayer) {\n  \t\t\t\taddClass(this._container, 'leaflet-interactive'); // change cursor\n  \t\t\t\tthis._fireEvent([candidateHoveredLayer], e, 'mouseover');\n  \t\t\t\tthis._hoveredLayer = candidateHoveredLayer;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis._fireEvent(this._hoveredLayer ? [this._hoveredLayer] : false, e);\n\n  \t\tthis._mouseHoverThrottled = true;\n  \t\tsetTimeout(bind(function () {\n  \t\t\tthis._mouseHoverThrottled = false;\n  \t\t}, this), 32);\n  \t},\n\n  \t_fireEvent: function (layers, e, type) {\n  \t\tthis._map._fireDOMEvent(e, type || e.type, layers);\n  \t},\n\n  \t_bringToFront: function (layer) {\n  \t\tvar order = layer._order;\n\n  \t\tif (!order) { return; }\n\n  \t\tvar next = order.next;\n  \t\tvar prev = order.prev;\n\n  \t\tif (next) {\n  \t\t\tnext.prev = prev;\n  \t\t} else {\n  \t\t\t// Already last\n  \t\t\treturn;\n  \t\t}\n  \t\tif (prev) {\n  \t\t\tprev.next = next;\n  \t\t} else if (next) {\n  \t\t\t// Update first entry unless this is the\n  \t\t\t// single entry\n  \t\t\tthis._drawFirst = next;\n  \t\t}\n\n  \t\torder.prev = this._drawLast;\n  \t\tthis._drawLast.next = order;\n\n  \t\torder.next = null;\n  \t\tthis._drawLast = order;\n\n  \t\tthis._requestRedraw(layer);\n  \t},\n\n  \t_bringToBack: function (layer) {\n  \t\tvar order = layer._order;\n\n  \t\tif (!order) { return; }\n\n  \t\tvar next = order.next;\n  \t\tvar prev = order.prev;\n\n  \t\tif (prev) {\n  \t\t\tprev.next = next;\n  \t\t} else {\n  \t\t\t// Already first\n  \t\t\treturn;\n  \t\t}\n  \t\tif (next) {\n  \t\t\tnext.prev = prev;\n  \t\t} else if (prev) {\n  \t\t\t// Update last entry unless this is the\n  \t\t\t// single entry\n  \t\t\tthis._drawLast = prev;\n  \t\t}\n\n  \t\torder.prev = null;\n\n  \t\torder.next = this._drawFirst;\n  \t\tthis._drawFirst.prev = order;\n  \t\tthis._drawFirst = order;\n\n  \t\tthis._requestRedraw(layer);\n  \t}\n  });\n\n  // @factory L.canvas(options?: Renderer options)\n  // Creates a Canvas renderer with the given options.\n  function canvas(options) {\n  \treturn Browser.canvas ? new Canvas(options) : null;\n  }\n\n  /*\n   * Thanks to Dmitry Baranovsky and his Raphael library for inspiration!\n   */\n\n\n  var vmlCreate = (function () {\n  \ttry {\n  \t\tdocument.namespaces.add('lvml', 'urn:schemas-microsoft-com:vml');\n  \t\treturn function (name) {\n  \t\t\treturn document.createElement('<lvml:' + name + ' class=\"lvml\">');\n  \t\t};\n  \t} catch (e) {\n  \t\t// Do not return fn from catch block so `e` can be garbage collected\n  \t\t// See https://github.com/Leaflet/Leaflet/pull/7279\n  \t}\n  \treturn function (name) {\n  \t\treturn document.createElement('<' + name + ' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"lvml\">');\n  \t};\n  })();\n\n\n  /*\n   * @class SVG\n   *\n   *\n   * VML was deprecated in 2012, which means VML functionality exists only for backwards compatibility\n   * with old versions of Internet Explorer.\n   */\n\n  // mixin to redefine some SVG methods to handle VML syntax which is similar but with some differences\n  var vmlMixin = {\n\n  \t_initContainer: function () {\n  \t\tthis._container = create$1('div', 'leaflet-vml-container');\n  \t},\n\n  \t_update: function () {\n  \t\tif (this._map._animatingZoom) { return; }\n  \t\tRenderer.prototype._update.call(this);\n  \t\tthis.fire('update');\n  \t},\n\n  \t_initPath: function (layer) {\n  \t\tvar container = layer._container = vmlCreate('shape');\n\n  \t\taddClass(container, 'leaflet-vml-shape ' + (this.options.className || ''));\n\n  \t\tcontainer.coordsize = '1 1';\n\n  \t\tlayer._path = vmlCreate('path');\n  \t\tcontainer.appendChild(layer._path);\n\n  \t\tthis._updateStyle(layer);\n  \t\tthis._layers[stamp(layer)] = layer;\n  \t},\n\n  \t_addPath: function (layer) {\n  \t\tvar container = layer._container;\n  \t\tthis._container.appendChild(container);\n\n  \t\tif (layer.options.interactive) {\n  \t\t\tlayer.addInteractiveTarget(container);\n  \t\t}\n  \t},\n\n  \t_removePath: function (layer) {\n  \t\tvar container = layer._container;\n  \t\tremove(container);\n  \t\tlayer.removeInteractiveTarget(container);\n  \t\tdelete this._layers[stamp(layer)];\n  \t},\n\n  \t_updateStyle: function (layer) {\n  \t\tvar stroke = layer._stroke,\n  \t\t    fill = layer._fill,\n  \t\t    options = layer.options,\n  \t\t    container = layer._container;\n\n  \t\tcontainer.stroked = !!options.stroke;\n  \t\tcontainer.filled = !!options.fill;\n\n  \t\tif (options.stroke) {\n  \t\t\tif (!stroke) {\n  \t\t\t\tstroke = layer._stroke = vmlCreate('stroke');\n  \t\t\t}\n  \t\t\tcontainer.appendChild(stroke);\n  \t\t\tstroke.weight = options.weight + 'px';\n  \t\t\tstroke.color = options.color;\n  \t\t\tstroke.opacity = options.opacity;\n\n  \t\t\tif (options.dashArray) {\n  \t\t\t\tstroke.dashStyle = isArray(options.dashArray) ?\n  \t\t\t\t    options.dashArray.join(' ') :\n  \t\t\t\t    options.dashArray.replace(/( *, *)/g, ' ');\n  \t\t\t} else {\n  \t\t\t\tstroke.dashStyle = '';\n  \t\t\t}\n  \t\t\tstroke.endcap = options.lineCap.replace('butt', 'flat');\n  \t\t\tstroke.joinstyle = options.lineJoin;\n\n  \t\t} else if (stroke) {\n  \t\t\tcontainer.removeChild(stroke);\n  \t\t\tlayer._stroke = null;\n  \t\t}\n\n  \t\tif (options.fill) {\n  \t\t\tif (!fill) {\n  \t\t\t\tfill = layer._fill = vmlCreate('fill');\n  \t\t\t}\n  \t\t\tcontainer.appendChild(fill);\n  \t\t\tfill.color = options.fillColor || options.color;\n  \t\t\tfill.opacity = options.fillOpacity;\n\n  \t\t} else if (fill) {\n  \t\t\tcontainer.removeChild(fill);\n  \t\t\tlayer._fill = null;\n  \t\t}\n  \t},\n\n  \t_updateCircle: function (layer) {\n  \t\tvar p = layer._point.round(),\n  \t\t    r = Math.round(layer._radius),\n  \t\t    r2 = Math.round(layer._radiusY || r);\n\n  \t\tthis._setPath(layer, layer._empty() ? 'M0 0' :\n  \t\t\t'AL ' + p.x + ',' + p.y + ' ' + r + ',' + r2 + ' 0,' + (65535 * 360));\n  \t},\n\n  \t_setPath: function (layer, path) {\n  \t\tlayer._path.v = path;\n  \t},\n\n  \t_bringToFront: function (layer) {\n  \t\ttoFront(layer._container);\n  \t},\n\n  \t_bringToBack: function (layer) {\n  \t\ttoBack(layer._container);\n  \t}\n  };\n\n  var create = Browser.vml ? vmlCreate : svgCreate;\n\n  /*\n   * @class SVG\n   * @inherits Renderer\n   * @aka L.SVG\n   *\n   * Allows vector layers to be displayed with [SVG](https://developer.mozilla.org/docs/Web/SVG).\n   * Inherits `Renderer`.\n   *\n   * Due to [technical limitations](https://caniuse.com/svg), SVG is not\n   * available in all web browsers, notably Android 2.x and 3.x.\n   *\n   * Although SVG is not available on IE7 and IE8, these browsers support\n   * [VML](https://en.wikipedia.org/wiki/Vector_Markup_Language)\n   * (a now deprecated technology), and the SVG renderer will fall back to VML in\n   * this case.\n   *\n   * @example\n   *\n   * Use SVG by default for all paths in the map:\n   *\n   * ```js\n   * var map = L.map('map', {\n   * \trenderer: L.svg()\n   * });\n   * ```\n   *\n   * Use a SVG renderer with extra padding for specific vector geometries:\n   *\n   * ```js\n   * var map = L.map('map');\n   * var myRenderer = L.svg({ padding: 0.5 });\n   * var line = L.polyline( coordinates, { renderer: myRenderer } );\n   * var circle = L.circle( center, { renderer: myRenderer } );\n   * ```\n   */\n\n  var SVG = Renderer.extend({\n\n  \t_initContainer: function () {\n  \t\tthis._container = create('svg');\n\n  \t\t// makes it possible to click through svg root; we'll reset it back in individual paths\n  \t\tthis._container.setAttribute('pointer-events', 'none');\n\n  \t\tthis._rootGroup = create('g');\n  \t\tthis._container.appendChild(this._rootGroup);\n  \t},\n\n  \t_destroyContainer: function () {\n  \t\tremove(this._container);\n  \t\toff(this._container);\n  \t\tdelete this._container;\n  \t\tdelete this._rootGroup;\n  \t\tdelete this._svgSize;\n  \t},\n\n  \t_update: function () {\n  \t\tif (this._map._animatingZoom && this._bounds) { return; }\n\n  \t\tRenderer.prototype._update.call(this);\n\n  \t\tvar b = this._bounds,\n  \t\t    size = b.getSize(),\n  \t\t    container = this._container;\n\n  \t\t// set size of svg-container if changed\n  \t\tif (!this._svgSize || !this._svgSize.equals(size)) {\n  \t\t\tthis._svgSize = size;\n  \t\t\tcontainer.setAttribute('width', size.x);\n  \t\t\tcontainer.setAttribute('height', size.y);\n  \t\t}\n\n  \t\t// movement: update container viewBox so that we don't have to change coordinates of individual layers\n  \t\tsetPosition(container, b.min);\n  \t\tcontainer.setAttribute('viewBox', [b.min.x, b.min.y, size.x, size.y].join(' '));\n\n  \t\tthis.fire('update');\n  \t},\n\n  \t// methods below are called by vector layers implementations\n\n  \t_initPath: function (layer) {\n  \t\tvar path = layer._path = create('path');\n\n  \t\t// @namespace Path\n  \t\t// @option className: String = null\n  \t\t// Custom class name set on an element. Only for SVG renderer.\n  \t\tif (layer.options.className) {\n  \t\t\taddClass(path, layer.options.className);\n  \t\t}\n\n  \t\tif (layer.options.interactive) {\n  \t\t\taddClass(path, 'leaflet-interactive');\n  \t\t}\n\n  \t\tthis._updateStyle(layer);\n  \t\tthis._layers[stamp(layer)] = layer;\n  \t},\n\n  \t_addPath: function (layer) {\n  \t\tif (!this._rootGroup) { this._initContainer(); }\n  \t\tthis._rootGroup.appendChild(layer._path);\n  \t\tlayer.addInteractiveTarget(layer._path);\n  \t},\n\n  \t_removePath: function (layer) {\n  \t\tremove(layer._path);\n  \t\tlayer.removeInteractiveTarget(layer._path);\n  \t\tdelete this._layers[stamp(layer)];\n  \t},\n\n  \t_updatePath: function (layer) {\n  \t\tlayer._project();\n  \t\tlayer._update();\n  \t},\n\n  \t_updateStyle: function (layer) {\n  \t\tvar path = layer._path,\n  \t\t    options = layer.options;\n\n  \t\tif (!path) { return; }\n\n  \t\tif (options.stroke) {\n  \t\t\tpath.setAttribute('stroke', options.color);\n  \t\t\tpath.setAttribute('stroke-opacity', options.opacity);\n  \t\t\tpath.setAttribute('stroke-width', options.weight);\n  \t\t\tpath.setAttribute('stroke-linecap', options.lineCap);\n  \t\t\tpath.setAttribute('stroke-linejoin', options.lineJoin);\n\n  \t\t\tif (options.dashArray) {\n  \t\t\t\tpath.setAttribute('stroke-dasharray', options.dashArray);\n  \t\t\t} else {\n  \t\t\t\tpath.removeAttribute('stroke-dasharray');\n  \t\t\t}\n\n  \t\t\tif (options.dashOffset) {\n  \t\t\t\tpath.setAttribute('stroke-dashoffset', options.dashOffset);\n  \t\t\t} else {\n  \t\t\t\tpath.removeAttribute('stroke-dashoffset');\n  \t\t\t}\n  \t\t} else {\n  \t\t\tpath.setAttribute('stroke', 'none');\n  \t\t}\n\n  \t\tif (options.fill) {\n  \t\t\tpath.setAttribute('fill', options.fillColor || options.color);\n  \t\t\tpath.setAttribute('fill-opacity', options.fillOpacity);\n  \t\t\tpath.setAttribute('fill-rule', options.fillRule || 'evenodd');\n  \t\t} else {\n  \t\t\tpath.setAttribute('fill', 'none');\n  \t\t}\n  \t},\n\n  \t_updatePoly: function (layer, closed) {\n  \t\tthis._setPath(layer, pointsToPath(layer._parts, closed));\n  \t},\n\n  \t_updateCircle: function (layer) {\n  \t\tvar p = layer._point,\n  \t\t    r = Math.max(Math.round(layer._radius), 1),\n  \t\t    r2 = Math.max(Math.round(layer._radiusY), 1) || r,\n  \t\t    arc = 'a' + r + ',' + r2 + ' 0 1,0 ';\n\n  \t\t// drawing a circle with two half-arcs\n  \t\tvar d = layer._empty() ? 'M0 0' :\n  \t\t\t'M' + (p.x - r) + ',' + p.y +\n  \t\t\tarc + (r * 2) + ',0 ' +\n  \t\t\tarc + (-r * 2) + ',0 ';\n\n  \t\tthis._setPath(layer, d);\n  \t},\n\n  \t_setPath: function (layer, path) {\n  \t\tlayer._path.setAttribute('d', path);\n  \t},\n\n  \t// SVG does not have the concept of zIndex so we resort to changing the DOM order of elements\n  \t_bringToFront: function (layer) {\n  \t\ttoFront(layer._path);\n  \t},\n\n  \t_bringToBack: function (layer) {\n  \t\ttoBack(layer._path);\n  \t}\n  });\n\n  if (Browser.vml) {\n  \tSVG.include(vmlMixin);\n  }\n\n  // @namespace SVG\n  // @factory L.svg(options?: Renderer options)\n  // Creates a SVG renderer with the given options.\n  function svg(options) {\n  \treturn Browser.svg || Browser.vml ? new SVG(options) : null;\n  }\n\n  Map.include({\n  \t// @namespace Map; @method getRenderer(layer: Path): Renderer\n  \t// Returns the instance of `Renderer` that should be used to render the given\n  \t// `Path`. It will ensure that the `renderer` options of the map and paths\n  \t// are respected, and that the renderers do exist on the map.\n  \tgetRenderer: function (layer) {\n  \t\t// @namespace Path; @option renderer: Renderer\n  \t\t// Use this specific instance of `Renderer` for this path. Takes\n  \t\t// precedence over the map's [default renderer](#map-renderer).\n  \t\tvar renderer = layer.options.renderer || this._getPaneRenderer(layer.options.pane) || this.options.renderer || this._renderer;\n\n  \t\tif (!renderer) {\n  \t\t\trenderer = this._renderer = this._createRenderer();\n  \t\t}\n\n  \t\tif (!this.hasLayer(renderer)) {\n  \t\t\tthis.addLayer(renderer);\n  \t\t}\n  \t\treturn renderer;\n  \t},\n\n  \t_getPaneRenderer: function (name) {\n  \t\tif (name === 'overlayPane' || name === undefined) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar renderer = this._paneRenderers[name];\n  \t\tif (renderer === undefined) {\n  \t\t\trenderer = this._createRenderer({pane: name});\n  \t\t\tthis._paneRenderers[name] = renderer;\n  \t\t}\n  \t\treturn renderer;\n  \t},\n\n  \t_createRenderer: function (options) {\n  \t\t// @namespace Map; @option preferCanvas: Boolean = false\n  \t\t// Whether `Path`s should be rendered on a `Canvas` renderer.\n  \t\t// By default, all `Path`s are rendered in a `SVG` renderer.\n  \t\treturn (this.options.preferCanvas && canvas(options)) || svg(options);\n  \t}\n  });\n\n  /*\n   * L.Rectangle extends Polygon and creates a rectangle when passed a LatLngBounds object.\n   */\n\n  /*\n   * @class Rectangle\n   * @aka L.Rectangle\n   * @inherits Polygon\n   *\n   * A class for drawing rectangle overlays on a map. Extends `Polygon`.\n   *\n   * @example\n   *\n   * ```js\n   * // define rectangle geographical bounds\n   * var bounds = [[54.559322, -5.767822], [56.1210604, -3.021240]];\n   *\n   * // create an orange rectangle\n   * L.rectangle(bounds, {color: \"#ff7800\", weight: 1}).addTo(map);\n   *\n   * // zoom the map to the rectangle bounds\n   * map.fitBounds(bounds);\n   * ```\n   *\n   */\n\n\n  var Rectangle = Polygon.extend({\n  \tinitialize: function (latLngBounds, options) {\n  \t\tPolygon.prototype.initialize.call(this, this._boundsToLatLngs(latLngBounds), options);\n  \t},\n\n  \t// @method setBounds(latLngBounds: LatLngBounds): this\n  \t// Redraws the rectangle with the passed bounds.\n  \tsetBounds: function (latLngBounds) {\n  \t\treturn this.setLatLngs(this._boundsToLatLngs(latLngBounds));\n  \t},\n\n  \t_boundsToLatLngs: function (latLngBounds) {\n  \t\tlatLngBounds = toLatLngBounds(latLngBounds);\n  \t\treturn [\n  \t\t\tlatLngBounds.getSouthWest(),\n  \t\t\tlatLngBounds.getNorthWest(),\n  \t\t\tlatLngBounds.getNorthEast(),\n  \t\t\tlatLngBounds.getSouthEast()\n  \t\t];\n  \t}\n  });\n\n\n  // @factory L.rectangle(latLngBounds: LatLngBounds, options?: Polyline options)\n  function rectangle(latLngBounds, options) {\n  \treturn new Rectangle(latLngBounds, options);\n  }\n\n  SVG.create = create;\n  SVG.pointsToPath = pointsToPath;\n\n  GeoJSON.geometryToLayer = geometryToLayer;\n  GeoJSON.coordsToLatLng = coordsToLatLng;\n  GeoJSON.coordsToLatLngs = coordsToLatLngs;\n  GeoJSON.latLngToCoords = latLngToCoords;\n  GeoJSON.latLngsToCoords = latLngsToCoords;\n  GeoJSON.getFeature = getFeature;\n  GeoJSON.asFeature = asFeature;\n\n  /*\n   * L.Handler.BoxZoom is used to add shift-drag zoom interaction to the map\n   * (zoom to a selected bounding box), enabled by default.\n   */\n\n  // @namespace Map\n  // @section Interaction Options\n  Map.mergeOptions({\n  \t// @option boxZoom: Boolean = true\n  \t// Whether the map can be zoomed to a rectangular area specified by\n  \t// dragging the mouse while pressing the shift key.\n  \tboxZoom: true\n  });\n\n  var BoxZoom = Handler.extend({\n  \tinitialize: function (map) {\n  \t\tthis._map = map;\n  \t\tthis._container = map._container;\n  \t\tthis._pane = map._panes.overlayPane;\n  \t\tthis._resetStateTimeout = 0;\n  \t\tmap.on('unload', this._destroy, this);\n  \t},\n\n  \taddHooks: function () {\n  \t\ton(this._container, 'mousedown', this._onMouseDown, this);\n  \t},\n\n  \tremoveHooks: function () {\n  \t\toff(this._container, 'mousedown', this._onMouseDown, this);\n  \t},\n\n  \tmoved: function () {\n  \t\treturn this._moved;\n  \t},\n\n  \t_destroy: function () {\n  \t\tremove(this._pane);\n  \t\tdelete this._pane;\n  \t},\n\n  \t_resetState: function () {\n  \t\tthis._resetStateTimeout = 0;\n  \t\tthis._moved = false;\n  \t},\n\n  \t_clearDeferredResetState: function () {\n  \t\tif (this._resetStateTimeout !== 0) {\n  \t\t\tclearTimeout(this._resetStateTimeout);\n  \t\t\tthis._resetStateTimeout = 0;\n  \t\t}\n  \t},\n\n  \t_onMouseDown: function (e) {\n  \t\tif (!e.shiftKey || ((e.which !== 1) && (e.button !== 1))) { return false; }\n\n  \t\t// Clear the deferred resetState if it hasn't executed yet, otherwise it\n  \t\t// will interrupt the interaction and orphan a box element in the container.\n  \t\tthis._clearDeferredResetState();\n  \t\tthis._resetState();\n\n  \t\tdisableTextSelection();\n  \t\tdisableImageDrag();\n\n  \t\tthis._startPoint = this._map.mouseEventToContainerPoint(e);\n\n  \t\ton(document, {\n  \t\t\tcontextmenu: stop,\n  \t\t\tmousemove: this._onMouseMove,\n  \t\t\tmouseup: this._onMouseUp,\n  \t\t\tkeydown: this._onKeyDown\n  \t\t}, this);\n  \t},\n\n  \t_onMouseMove: function (e) {\n  \t\tif (!this._moved) {\n  \t\t\tthis._moved = true;\n\n  \t\t\tthis._box = create$1('div', 'leaflet-zoom-box', this._container);\n  \t\t\taddClass(this._container, 'leaflet-crosshair');\n\n  \t\t\tthis._map.fire('boxzoomstart');\n  \t\t}\n\n  \t\tthis._point = this._map.mouseEventToContainerPoint(e);\n\n  \t\tvar bounds = new Bounds(this._point, this._startPoint),\n  \t\t    size = bounds.getSize();\n\n  \t\tsetPosition(this._box, bounds.min);\n\n  \t\tthis._box.style.width  = size.x + 'px';\n  \t\tthis._box.style.height = size.y + 'px';\n  \t},\n\n  \t_finish: function () {\n  \t\tif (this._moved) {\n  \t\t\tremove(this._box);\n  \t\t\tremoveClass(this._container, 'leaflet-crosshair');\n  \t\t}\n\n  \t\tenableTextSelection();\n  \t\tenableImageDrag();\n\n  \t\toff(document, {\n  \t\t\tcontextmenu: stop,\n  \t\t\tmousemove: this._onMouseMove,\n  \t\t\tmouseup: this._onMouseUp,\n  \t\t\tkeydown: this._onKeyDown\n  \t\t}, this);\n  \t},\n\n  \t_onMouseUp: function (e) {\n  \t\tif ((e.which !== 1) && (e.button !== 1)) { return; }\n\n  \t\tthis._finish();\n\n  \t\tif (!this._moved) { return; }\n  \t\t// Postpone to next JS tick so internal click event handling\n  \t\t// still see it as \"moved\".\n  \t\tthis._clearDeferredResetState();\n  \t\tthis._resetStateTimeout = setTimeout(bind(this._resetState, this), 0);\n\n  \t\tvar bounds = new LatLngBounds(\n  \t\t        this._map.containerPointToLatLng(this._startPoint),\n  \t\t        this._map.containerPointToLatLng(this._point));\n\n  \t\tthis._map\n  \t\t\t.fitBounds(bounds)\n  \t\t\t.fire('boxzoomend', {boxZoomBounds: bounds});\n  \t},\n\n  \t_onKeyDown: function (e) {\n  \t\tif (e.keyCode === 27) {\n  \t\t\tthis._finish();\n  \t\t\tthis._clearDeferredResetState();\n  \t\t\tthis._resetState();\n  \t\t}\n  \t}\n  });\n\n  // @section Handlers\n  // @property boxZoom: Handler\n  // Box (shift-drag with mouse) zoom handler.\n  Map.addInitHook('addHandler', 'boxZoom', BoxZoom);\n\n  /*\n   * L.Handler.DoubleClickZoom is used to handle double-click zoom on the map, enabled by default.\n   */\n\n  // @namespace Map\n  // @section Interaction Options\n\n  Map.mergeOptions({\n  \t// @option doubleClickZoom: Boolean|String = true\n  \t// Whether the map can be zoomed in by double clicking on it and\n  \t// zoomed out by double clicking while holding shift. If passed\n  \t// `'center'`, double-click zoom will zoom to the center of the\n  \t//  view regardless of where the mouse was.\n  \tdoubleClickZoom: true\n  });\n\n  var DoubleClickZoom = Handler.extend({\n  \taddHooks: function () {\n  \t\tthis._map.on('dblclick', this._onDoubleClick, this);\n  \t},\n\n  \tremoveHooks: function () {\n  \t\tthis._map.off('dblclick', this._onDoubleClick, this);\n  \t},\n\n  \t_onDoubleClick: function (e) {\n  \t\tvar map = this._map,\n  \t\t    oldZoom = map.getZoom(),\n  \t\t    delta = map.options.zoomDelta,\n  \t\t    zoom = e.originalEvent.shiftKey ? oldZoom - delta : oldZoom + delta;\n\n  \t\tif (map.options.doubleClickZoom === 'center') {\n  \t\t\tmap.setZoom(zoom);\n  \t\t} else {\n  \t\t\tmap.setZoomAround(e.containerPoint, zoom);\n  \t\t}\n  \t}\n  });\n\n  // @section Handlers\n  //\n  // Map properties include interaction handlers that allow you to control\n  // interaction behavior in runtime, enabling or disabling certain features such\n  // as dragging or touch zoom (see `Handler` methods). For example:\n  //\n  // ```js\n  // map.doubleClickZoom.disable();\n  // ```\n  //\n  // @property doubleClickZoom: Handler\n  // Double click zoom handler.\n  Map.addInitHook('addHandler', 'doubleClickZoom', DoubleClickZoom);\n\n  /*\n   * L.Handler.MapDrag is used to make the map draggable (with panning inertia), enabled by default.\n   */\n\n  // @namespace Map\n  // @section Interaction Options\n  Map.mergeOptions({\n  \t// @option dragging: Boolean = true\n  \t// Whether the map is draggable with mouse/touch or not.\n  \tdragging: true,\n\n  \t// @section Panning Inertia Options\n  \t// @option inertia: Boolean = *\n  \t// If enabled, panning of the map will have an inertia effect where\n  \t// the map builds momentum while dragging and continues moving in\n  \t// the same direction for some time. Feels especially nice on touch\n  \t// devices. Enabled by default.\n  \tinertia: true,\n\n  \t// @option inertiaDeceleration: Number = 3000\n  \t// The rate with which the inertial movement slows down, in pixels/second.\n  \tinertiaDeceleration: 3400, // px/s^2\n\n  \t// @option inertiaMaxSpeed: Number = Infinity\n  \t// Max speed of the inertial movement, in pixels/second.\n  \tinertiaMaxSpeed: Infinity, // px/s\n\n  \t// @option easeLinearity: Number = 0.2\n  \teaseLinearity: 0.2,\n\n  \t// TODO refactor, move to CRS\n  \t// @option worldCopyJump: Boolean = false\n  \t// With this option enabled, the map tracks when you pan to another \"copy\"\n  \t// of the world and seamlessly jumps to the original one so that all overlays\n  \t// like markers and vector layers are still visible.\n  \tworldCopyJump: false,\n\n  \t// @option maxBoundsViscosity: Number = 0.0\n  \t// If `maxBounds` is set, this option will control how solid the bounds\n  \t// are when dragging the map around. The default value of `0.0` allows the\n  \t// user to drag outside the bounds at normal speed, higher values will\n  \t// slow down map dragging outside bounds, and `1.0` makes the bounds fully\n  \t// solid, preventing the user from dragging outside the bounds.\n  \tmaxBoundsViscosity: 0.0\n  });\n\n  var Drag = Handler.extend({\n  \taddHooks: function () {\n  \t\tif (!this._draggable) {\n  \t\t\tvar map = this._map;\n\n  \t\t\tthis._draggable = new Draggable(map._mapPane, map._container);\n\n  \t\t\tthis._draggable.on({\n  \t\t\t\tdragstart: this._onDragStart,\n  \t\t\t\tdrag: this._onDrag,\n  \t\t\t\tdragend: this._onDragEnd\n  \t\t\t}, this);\n\n  \t\t\tthis._draggable.on('predrag', this._onPreDragLimit, this);\n  \t\t\tif (map.options.worldCopyJump) {\n  \t\t\t\tthis._draggable.on('predrag', this._onPreDragWrap, this);\n  \t\t\t\tmap.on('zoomend', this._onZoomEnd, this);\n\n  \t\t\t\tmap.whenReady(this._onZoomEnd, this);\n  \t\t\t}\n  \t\t}\n  \t\taddClass(this._map._container, 'leaflet-grab leaflet-touch-drag');\n  \t\tthis._draggable.enable();\n  \t\tthis._positions = [];\n  \t\tthis._times = [];\n  \t},\n\n  \tremoveHooks: function () {\n  \t\tremoveClass(this._map._container, 'leaflet-grab');\n  \t\tremoveClass(this._map._container, 'leaflet-touch-drag');\n  \t\tthis._draggable.disable();\n  \t},\n\n  \tmoved: function () {\n  \t\treturn this._draggable && this._draggable._moved;\n  \t},\n\n  \tmoving: function () {\n  \t\treturn this._draggable && this._draggable._moving;\n  \t},\n\n  \t_onDragStart: function () {\n  \t\tvar map = this._map;\n\n  \t\tmap._stop();\n  \t\tif (this._map.options.maxBounds && this._map.options.maxBoundsViscosity) {\n  \t\t\tvar bounds = toLatLngBounds(this._map.options.maxBounds);\n\n  \t\t\tthis._offsetLimit = toBounds(\n  \t\t\t\tthis._map.latLngToContainerPoint(bounds.getNorthWest()).multiplyBy(-1),\n  \t\t\t\tthis._map.latLngToContainerPoint(bounds.getSouthEast()).multiplyBy(-1)\n  \t\t\t\t\t.add(this._map.getSize()));\n\n  \t\t\tthis._viscosity = Math.min(1.0, Math.max(0.0, this._map.options.maxBoundsViscosity));\n  \t\t} else {\n  \t\t\tthis._offsetLimit = null;\n  \t\t}\n\n  \t\tmap\n  \t\t    .fire('movestart')\n  \t\t    .fire('dragstart');\n\n  \t\tif (map.options.inertia) {\n  \t\t\tthis._positions = [];\n  \t\t\tthis._times = [];\n  \t\t}\n  \t},\n\n  \t_onDrag: function (e) {\n  \t\tif (this._map.options.inertia) {\n  \t\t\tvar time = this._lastTime = +new Date(),\n  \t\t\t    pos = this._lastPos = this._draggable._absPos || this._draggable._newPos;\n\n  \t\t\tthis._positions.push(pos);\n  \t\t\tthis._times.push(time);\n\n  \t\t\tthis._prunePositions(time);\n  \t\t}\n\n  \t\tthis._map\n  \t\t    .fire('move', e)\n  \t\t    .fire('drag', e);\n  \t},\n\n  \t_prunePositions: function (time) {\n  \t\twhile (this._positions.length > 1 && time - this._times[0] > 50) {\n  \t\t\tthis._positions.shift();\n  \t\t\tthis._times.shift();\n  \t\t}\n  \t},\n\n  \t_onZoomEnd: function () {\n  \t\tvar pxCenter = this._map.getSize().divideBy(2),\n  \t\t    pxWorldCenter = this._map.latLngToLayerPoint([0, 0]);\n\n  \t\tthis._initialWorldOffset = pxWorldCenter.subtract(pxCenter).x;\n  \t\tthis._worldWidth = this._map.getPixelWorldBounds().getSize().x;\n  \t},\n\n  \t_viscousLimit: function (value, threshold) {\n  \t\treturn value - (value - threshold) * this._viscosity;\n  \t},\n\n  \t_onPreDragLimit: function () {\n  \t\tif (!this._viscosity || !this._offsetLimit) { return; }\n\n  \t\tvar offset = this._draggable._newPos.subtract(this._draggable._startPos);\n\n  \t\tvar limit = this._offsetLimit;\n  \t\tif (offset.x < limit.min.x) { offset.x = this._viscousLimit(offset.x, limit.min.x); }\n  \t\tif (offset.y < limit.min.y) { offset.y = this._viscousLimit(offset.y, limit.min.y); }\n  \t\tif (offset.x > limit.max.x) { offset.x = this._viscousLimit(offset.x, limit.max.x); }\n  \t\tif (offset.y > limit.max.y) { offset.y = this._viscousLimit(offset.y, limit.max.y); }\n\n  \t\tthis._draggable._newPos = this._draggable._startPos.add(offset);\n  \t},\n\n  \t_onPreDragWrap: function () {\n  \t\t// TODO refactor to be able to adjust map pane position after zoom\n  \t\tvar worldWidth = this._worldWidth,\n  \t\t    halfWidth = Math.round(worldWidth / 2),\n  \t\t    dx = this._initialWorldOffset,\n  \t\t    x = this._draggable._newPos.x,\n  \t\t    newX1 = (x - halfWidth + dx) % worldWidth + halfWidth - dx,\n  \t\t    newX2 = (x + halfWidth + dx) % worldWidth - halfWidth - dx,\n  \t\t    newX = Math.abs(newX1 + dx) < Math.abs(newX2 + dx) ? newX1 : newX2;\n\n  \t\tthis._draggable._absPos = this._draggable._newPos.clone();\n  \t\tthis._draggable._newPos.x = newX;\n  \t},\n\n  \t_onDragEnd: function (e) {\n  \t\tvar map = this._map,\n  \t\t    options = map.options,\n\n  \t\t    noInertia = !options.inertia || e.noInertia || this._times.length < 2;\n\n  \t\tmap.fire('dragend', e);\n\n  \t\tif (noInertia) {\n  \t\t\tmap.fire('moveend');\n\n  \t\t} else {\n  \t\t\tthis._prunePositions(+new Date());\n\n  \t\t\tvar direction = this._lastPos.subtract(this._positions[0]),\n  \t\t\t    duration = (this._lastTime - this._times[0]) / 1000,\n  \t\t\t    ease = options.easeLinearity,\n\n  \t\t\t    speedVector = direction.multiplyBy(ease / duration),\n  \t\t\t    speed = speedVector.distanceTo([0, 0]),\n\n  \t\t\t    limitedSpeed = Math.min(options.inertiaMaxSpeed, speed),\n  \t\t\t    limitedSpeedVector = speedVector.multiplyBy(limitedSpeed / speed),\n\n  \t\t\t    decelerationDuration = limitedSpeed / (options.inertiaDeceleration * ease),\n  \t\t\t    offset = limitedSpeedVector.multiplyBy(-decelerationDuration / 2).round();\n\n  \t\t\tif (!offset.x && !offset.y) {\n  \t\t\t\tmap.fire('moveend');\n\n  \t\t\t} else {\n  \t\t\t\toffset = map._limitOffset(offset, map.options.maxBounds);\n\n  \t\t\t\trequestAnimFrame(function () {\n  \t\t\t\t\tmap.panBy(offset, {\n  \t\t\t\t\t\tduration: decelerationDuration,\n  \t\t\t\t\t\teaseLinearity: ease,\n  \t\t\t\t\t\tnoMoveStart: true,\n  \t\t\t\t\t\tanimate: true\n  \t\t\t\t\t});\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  });\n\n  // @section Handlers\n  // @property dragging: Handler\n  // Map dragging handler (by both mouse and touch).\n  Map.addInitHook('addHandler', 'dragging', Drag);\n\n  /*\n   * L.Map.Keyboard is handling keyboard interaction with the map, enabled by default.\n   */\n\n  // @namespace Map\n  // @section Keyboard Navigation Options\n  Map.mergeOptions({\n  \t// @option keyboard: Boolean = true\n  \t// Makes the map focusable and allows users to navigate the map with keyboard\n  \t// arrows and `+`/`-` keys.\n  \tkeyboard: true,\n\n  \t// @option keyboardPanDelta: Number = 80\n  \t// Amount of pixels to pan when pressing an arrow key.\n  \tkeyboardPanDelta: 80\n  });\n\n  var Keyboard = Handler.extend({\n\n  \tkeyCodes: {\n  \t\tleft:    [37],\n  \t\tright:   [39],\n  \t\tdown:    [40],\n  \t\tup:      [38],\n  \t\tzoomIn:  [187, 107, 61, 171],\n  \t\tzoomOut: [189, 109, 54, 173]\n  \t},\n\n  \tinitialize: function (map) {\n  \t\tthis._map = map;\n\n  \t\tthis._setPanDelta(map.options.keyboardPanDelta);\n  \t\tthis._setZoomDelta(map.options.zoomDelta);\n  \t},\n\n  \taddHooks: function () {\n  \t\tvar container = this._map._container;\n\n  \t\t// make the container focusable by tabbing\n  \t\tif (container.tabIndex <= 0) {\n  \t\t\tcontainer.tabIndex = '0';\n  \t\t}\n\n  \t\ton(container, {\n  \t\t\tfocus: this._onFocus,\n  \t\t\tblur: this._onBlur,\n  \t\t\tmousedown: this._onMouseDown\n  \t\t}, this);\n\n  \t\tthis._map.on({\n  \t\t\tfocus: this._addHooks,\n  \t\t\tblur: this._removeHooks\n  \t\t}, this);\n  \t},\n\n  \tremoveHooks: function () {\n  \t\tthis._removeHooks();\n\n  \t\toff(this._map._container, {\n  \t\t\tfocus: this._onFocus,\n  \t\t\tblur: this._onBlur,\n  \t\t\tmousedown: this._onMouseDown\n  \t\t}, this);\n\n  \t\tthis._map.off({\n  \t\t\tfocus: this._addHooks,\n  \t\t\tblur: this._removeHooks\n  \t\t}, this);\n  \t},\n\n  \t_onMouseDown: function () {\n  \t\tif (this._focused) { return; }\n\n  \t\tvar body = document.body,\n  \t\t    docEl = document.documentElement,\n  \t\t    top = body.scrollTop || docEl.scrollTop,\n  \t\t    left = body.scrollLeft || docEl.scrollLeft;\n\n  \t\tthis._map._container.focus();\n\n  \t\twindow.scrollTo(left, top);\n  \t},\n\n  \t_onFocus: function () {\n  \t\tthis._focused = true;\n  \t\tthis._map.fire('focus');\n  \t},\n\n  \t_onBlur: function () {\n  \t\tthis._focused = false;\n  \t\tthis._map.fire('blur');\n  \t},\n\n  \t_setPanDelta: function (panDelta) {\n  \t\tvar keys = this._panKeys = {},\n  \t\t    codes = this.keyCodes,\n  \t\t    i, len;\n\n  \t\tfor (i = 0, len = codes.left.length; i < len; i++) {\n  \t\t\tkeys[codes.left[i]] = [-1 * panDelta, 0];\n  \t\t}\n  \t\tfor (i = 0, len = codes.right.length; i < len; i++) {\n  \t\t\tkeys[codes.right[i]] = [panDelta, 0];\n  \t\t}\n  \t\tfor (i = 0, len = codes.down.length; i < len; i++) {\n  \t\t\tkeys[codes.down[i]] = [0, panDelta];\n  \t\t}\n  \t\tfor (i = 0, len = codes.up.length; i < len; i++) {\n  \t\t\tkeys[codes.up[i]] = [0, -1 * panDelta];\n  \t\t}\n  \t},\n\n  \t_setZoomDelta: function (zoomDelta) {\n  \t\tvar keys = this._zoomKeys = {},\n  \t\t    codes = this.keyCodes,\n  \t\t    i, len;\n\n  \t\tfor (i = 0, len = codes.zoomIn.length; i < len; i++) {\n  \t\t\tkeys[codes.zoomIn[i]] = zoomDelta;\n  \t\t}\n  \t\tfor (i = 0, len = codes.zoomOut.length; i < len; i++) {\n  \t\t\tkeys[codes.zoomOut[i]] = -zoomDelta;\n  \t\t}\n  \t},\n\n  \t_addHooks: function () {\n  \t\ton(document, 'keydown', this._onKeyDown, this);\n  \t},\n\n  \t_removeHooks: function () {\n  \t\toff(document, 'keydown', this._onKeyDown, this);\n  \t},\n\n  \t_onKeyDown: function (e) {\n  \t\tif (e.altKey || e.ctrlKey || e.metaKey) { return; }\n\n  \t\tvar key = e.keyCode,\n  \t\t    map = this._map,\n  \t\t    offset;\n\n  \t\tif (key in this._panKeys) {\n  \t\t\tif (!map._panAnim || !map._panAnim._inProgress) {\n  \t\t\t\toffset = this._panKeys[key];\n  \t\t\t\tif (e.shiftKey) {\n  \t\t\t\t\toffset = toPoint(offset).multiplyBy(3);\n  \t\t\t\t}\n\n  \t\t\t\tif (map.options.maxBounds) {\n  \t\t\t\t\toffset = map._limitOffset(toPoint(offset), map.options.maxBounds);\n  \t\t\t\t}\n\n  \t\t\t\tif (map.options.worldCopyJump) {\n  \t\t\t\t\tvar newLatLng = map.wrapLatLng(map.unproject(map.project(map.getCenter()).add(offset)));\n  \t\t\t\t\tmap.panTo(newLatLng);\n  \t\t\t\t} else {\n  \t\t\t\t\tmap.panBy(offset);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (key in this._zoomKeys) {\n  \t\t\tmap.setZoom(map.getZoom() + (e.shiftKey ? 3 : 1) * this._zoomKeys[key]);\n\n  \t\t} else if (key === 27 && map._popup && map._popup.options.closeOnEscapeKey) {\n  \t\t\tmap.closePopup();\n\n  \t\t} else {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tstop(e);\n  \t}\n  });\n\n  // @section Handlers\n  // @section Handlers\n  // @property keyboard: Handler\n  // Keyboard navigation handler.\n  Map.addInitHook('addHandler', 'keyboard', Keyboard);\n\n  /*\n   * L.Handler.ScrollWheelZoom is used by L.Map to enable mouse scroll wheel zoom on the map.\n   */\n\n  // @namespace Map\n  // @section Interaction Options\n  Map.mergeOptions({\n  \t// @section Mouse wheel options\n  \t// @option scrollWheelZoom: Boolean|String = true\n  \t// Whether the map can be zoomed by using the mouse wheel. If passed `'center'`,\n  \t// it will zoom to the center of the view regardless of where the mouse was.\n  \tscrollWheelZoom: true,\n\n  \t// @option wheelDebounceTime: Number = 40\n  \t// Limits the rate at which a wheel can fire (in milliseconds). By default\n  \t// user can't zoom via wheel more often than once per 40 ms.\n  \twheelDebounceTime: 40,\n\n  \t// @option wheelPxPerZoomLevel: Number = 60\n  \t// How many scroll pixels (as reported by [L.DomEvent.getWheelDelta](#domevent-getwheeldelta))\n  \t// mean a change of one full zoom level. Smaller values will make wheel-zooming\n  \t// faster (and vice versa).\n  \twheelPxPerZoomLevel: 60\n  });\n\n  var ScrollWheelZoom = Handler.extend({\n  \taddHooks: function () {\n  \t\ton(this._map._container, 'wheel', this._onWheelScroll, this);\n\n  \t\tthis._delta = 0;\n  \t},\n\n  \tremoveHooks: function () {\n  \t\toff(this._map._container, 'wheel', this._onWheelScroll, this);\n  \t},\n\n  \t_onWheelScroll: function (e) {\n  \t\tvar delta = getWheelDelta(e);\n\n  \t\tvar debounce = this._map.options.wheelDebounceTime;\n\n  \t\tthis._delta += delta;\n  \t\tthis._lastMousePos = this._map.mouseEventToContainerPoint(e);\n\n  \t\tif (!this._startTime) {\n  \t\t\tthis._startTime = +new Date();\n  \t\t}\n\n  \t\tvar left = Math.max(debounce - (+new Date() - this._startTime), 0);\n\n  \t\tclearTimeout(this._timer);\n  \t\tthis._timer = setTimeout(bind(this._performZoom, this), left);\n\n  \t\tstop(e);\n  \t},\n\n  \t_performZoom: function () {\n  \t\tvar map = this._map,\n  \t\t    zoom = map.getZoom(),\n  \t\t    snap = this._map.options.zoomSnap || 0;\n\n  \t\tmap._stop(); // stop panning and fly animations if any\n\n  \t\t// map the delta with a sigmoid function to -4..4 range leaning on -1..1\n  \t\tvar d2 = this._delta / (this._map.options.wheelPxPerZoomLevel * 4),\n  \t\t    d3 = 4 * Math.log(2 / (1 + Math.exp(-Math.abs(d2)))) / Math.LN2,\n  \t\t    d4 = snap ? Math.ceil(d3 / snap) * snap : d3,\n  \t\t    delta = map._limitZoom(zoom + (this._delta > 0 ? d4 : -d4)) - zoom;\n\n  \t\tthis._delta = 0;\n  \t\tthis._startTime = null;\n\n  \t\tif (!delta) { return; }\n\n  \t\tif (map.options.scrollWheelZoom === 'center') {\n  \t\t\tmap.setZoom(zoom + delta);\n  \t\t} else {\n  \t\t\tmap.setZoomAround(this._lastMousePos, zoom + delta);\n  \t\t}\n  \t}\n  });\n\n  // @section Handlers\n  // @property scrollWheelZoom: Handler\n  // Scroll wheel zoom handler.\n  Map.addInitHook('addHandler', 'scrollWheelZoom', ScrollWheelZoom);\n\n  /*\n   * L.Map.TapHold is used to simulate `contextmenu` event on long hold,\n   * which otherwise is not fired by mobile Safari.\n   */\n\n  var tapHoldDelay = 600;\n\n  // @namespace Map\n  // @section Interaction Options\n  Map.mergeOptions({\n  \t// @section Touch interaction options\n  \t// @option tapHold: Boolean\n  \t// Enables simulation of `contextmenu` event, default is `true` for mobile Safari.\n  \ttapHold: Browser.touchNative && Browser.safari && Browser.mobile,\n\n  \t// @option tapTolerance: Number = 15\n  \t// The max number of pixels a user can shift his finger during touch\n  \t// for it to be considered a valid tap.\n  \ttapTolerance: 15\n  });\n\n  var TapHold = Handler.extend({\n  \taddHooks: function () {\n  \t\ton(this._map._container, 'touchstart', this._onDown, this);\n  \t},\n\n  \tremoveHooks: function () {\n  \t\toff(this._map._container, 'touchstart', this._onDown, this);\n  \t},\n\n  \t_onDown: function (e) {\n  \t\tclearTimeout(this._holdTimeout);\n  \t\tif (e.touches.length !== 1) { return; }\n\n  \t\tvar first = e.touches[0];\n  \t\tthis._startPos = this._newPos = new Point(first.clientX, first.clientY);\n\n  \t\tthis._holdTimeout = setTimeout(bind(function () {\n  \t\t\tthis._cancel();\n  \t\t\tif (!this._isTapValid()) { return; }\n\n  \t\t\t// prevent simulated mouse events https://w3c.github.io/touch-events/#mouse-events\n  \t\t\ton(document, 'touchend', preventDefault);\n  \t\t\ton(document, 'touchend touchcancel', this._cancelClickPrevent);\n  \t\t\tthis._simulateEvent('contextmenu', first);\n  \t\t}, this), tapHoldDelay);\n\n  \t\ton(document, 'touchend touchcancel contextmenu', this._cancel, this);\n  \t\ton(document, 'touchmove', this._onMove, this);\n  \t},\n\n  \t_cancelClickPrevent: function cancelClickPrevent() {\n  \t\toff(document, 'touchend', preventDefault);\n  \t\toff(document, 'touchend touchcancel', cancelClickPrevent);\n  \t},\n\n  \t_cancel: function () {\n  \t\tclearTimeout(this._holdTimeout);\n  \t\toff(document, 'touchend touchcancel contextmenu', this._cancel, this);\n  \t\toff(document, 'touchmove', this._onMove, this);\n  \t},\n\n  \t_onMove: function (e) {\n  \t\tvar first = e.touches[0];\n  \t\tthis._newPos = new Point(first.clientX, first.clientY);\n  \t},\n\n  \t_isTapValid: function () {\n  \t\treturn this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance;\n  \t},\n\n  \t_simulateEvent: function (type, e) {\n  \t\tvar simulatedEvent = new MouseEvent(type, {\n  \t\t\tbubbles: true,\n  \t\t\tcancelable: true,\n  \t\t\tview: window,\n  \t\t\t// detail: 1,\n  \t\t\tscreenX: e.screenX,\n  \t\t\tscreenY: e.screenY,\n  \t\t\tclientX: e.clientX,\n  \t\t\tclientY: e.clientY,\n  \t\t\t// button: 2,\n  \t\t\t// buttons: 2\n  \t\t});\n\n  \t\tsimulatedEvent._simulated = true;\n\n  \t\te.target.dispatchEvent(simulatedEvent);\n  \t}\n  });\n\n  // @section Handlers\n  // @property tapHold: Handler\n  // Long tap handler to simulate `contextmenu` event (useful in mobile Safari).\n  Map.addInitHook('addHandler', 'tapHold', TapHold);\n\n  /*\n   * L.Handler.TouchZoom is used by L.Map to add pinch zoom on supported mobile browsers.\n   */\n\n  // @namespace Map\n  // @section Interaction Options\n  Map.mergeOptions({\n  \t// @section Touch interaction options\n  \t// @option touchZoom: Boolean|String = *\n  \t// Whether the map can be zoomed by touch-dragging with two fingers. If\n  \t// passed `'center'`, it will zoom to the center of the view regardless of\n  \t// where the touch events (fingers) were. Enabled for touch-capable web\n  \t// browsers.\n  \ttouchZoom: Browser.touch,\n\n  \t// @option bounceAtZoomLimits: Boolean = true\n  \t// Set it to false if you don't want the map to zoom beyond min/max zoom\n  \t// and then bounce back when pinch-zooming.\n  \tbounceAtZoomLimits: true\n  });\n\n  var TouchZoom = Handler.extend({\n  \taddHooks: function () {\n  \t\taddClass(this._map._container, 'leaflet-touch-zoom');\n  \t\ton(this._map._container, 'touchstart', this._onTouchStart, this);\n  \t},\n\n  \tremoveHooks: function () {\n  \t\tremoveClass(this._map._container, 'leaflet-touch-zoom');\n  \t\toff(this._map._container, 'touchstart', this._onTouchStart, this);\n  \t},\n\n  \t_onTouchStart: function (e) {\n  \t\tvar map = this._map;\n  \t\tif (!e.touches || e.touches.length !== 2 || map._animatingZoom || this._zooming) { return; }\n\n  \t\tvar p1 = map.mouseEventToContainerPoint(e.touches[0]),\n  \t\t    p2 = map.mouseEventToContainerPoint(e.touches[1]);\n\n  \t\tthis._centerPoint = map.getSize()._divideBy(2);\n  \t\tthis._startLatLng = map.containerPointToLatLng(this._centerPoint);\n  \t\tif (map.options.touchZoom !== 'center') {\n  \t\t\tthis._pinchStartLatLng = map.containerPointToLatLng(p1.add(p2)._divideBy(2));\n  \t\t}\n\n  \t\tthis._startDist = p1.distanceTo(p2);\n  \t\tthis._startZoom = map.getZoom();\n\n  \t\tthis._moved = false;\n  \t\tthis._zooming = true;\n\n  \t\tmap._stop();\n\n  \t\ton(document, 'touchmove', this._onTouchMove, this);\n  \t\ton(document, 'touchend touchcancel', this._onTouchEnd, this);\n\n  \t\tpreventDefault(e);\n  \t},\n\n  \t_onTouchMove: function (e) {\n  \t\tif (!e.touches || e.touches.length !== 2 || !this._zooming) { return; }\n\n  \t\tvar map = this._map,\n  \t\t    p1 = map.mouseEventToContainerPoint(e.touches[0]),\n  \t\t    p2 = map.mouseEventToContainerPoint(e.touches[1]),\n  \t\t    scale = p1.distanceTo(p2) / this._startDist;\n\n  \t\tthis._zoom = map.getScaleZoom(scale, this._startZoom);\n\n  \t\tif (!map.options.bounceAtZoomLimits && (\n  \t\t\t(this._zoom < map.getMinZoom() && scale < 1) ||\n  \t\t\t(this._zoom > map.getMaxZoom() && scale > 1))) {\n  \t\t\tthis._zoom = map._limitZoom(this._zoom);\n  \t\t}\n\n  \t\tif (map.options.touchZoom === 'center') {\n  \t\t\tthis._center = this._startLatLng;\n  \t\t\tif (scale === 1) { return; }\n  \t\t} else {\n  \t\t\t// Get delta from pinch to center, so centerLatLng is delta applied to initial pinchLatLng\n  \t\t\tvar delta = p1._add(p2)._divideBy(2)._subtract(this._centerPoint);\n  \t\t\tif (scale === 1 && delta.x === 0 && delta.y === 0) { return; }\n  \t\t\tthis._center = map.unproject(map.project(this._pinchStartLatLng, this._zoom).subtract(delta), this._zoom);\n  \t\t}\n\n  \t\tif (!this._moved) {\n  \t\t\tmap._moveStart(true, false);\n  \t\t\tthis._moved = true;\n  \t\t}\n\n  \t\tcancelAnimFrame(this._animRequest);\n\n  \t\tvar moveFn = bind(map._move, map, this._center, this._zoom, {pinch: true, round: false}, undefined);\n  \t\tthis._animRequest = requestAnimFrame(moveFn, this, true);\n\n  \t\tpreventDefault(e);\n  \t},\n\n  \t_onTouchEnd: function () {\n  \t\tif (!this._moved || !this._zooming) {\n  \t\t\tthis._zooming = false;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._zooming = false;\n  \t\tcancelAnimFrame(this._animRequest);\n\n  \t\toff(document, 'touchmove', this._onTouchMove, this);\n  \t\toff(document, 'touchend touchcancel', this._onTouchEnd, this);\n\n  \t\t// Pinch updates GridLayers' levels only when zoomSnap is off, so zoomSnap becomes noUpdate.\n  \t\tif (this._map.options.zoomAnimation) {\n  \t\t\tthis._map._animateZoom(this._center, this._map._limitZoom(this._zoom), true, this._map.options.zoomSnap);\n  \t\t} else {\n  \t\t\tthis._map._resetView(this._center, this._map._limitZoom(this._zoom));\n  \t\t}\n  \t}\n  });\n\n  // @section Handlers\n  // @property touchZoom: Handler\n  // Touch zoom handler.\n  Map.addInitHook('addHandler', 'touchZoom', TouchZoom);\n\n  Map.BoxZoom = BoxZoom;\n  Map.DoubleClickZoom = DoubleClickZoom;\n  Map.Drag = Drag;\n  Map.Keyboard = Keyboard;\n  Map.ScrollWheelZoom = ScrollWheelZoom;\n  Map.TapHold = TapHold;\n  Map.TouchZoom = TouchZoom;\n\n  exports.Bounds = Bounds;\n  exports.Browser = Browser;\n  exports.CRS = CRS;\n  exports.Canvas = Canvas;\n  exports.Circle = Circle;\n  exports.CircleMarker = CircleMarker;\n  exports.Class = Class;\n  exports.Control = Control;\n  exports.DivIcon = DivIcon;\n  exports.DivOverlay = DivOverlay;\n  exports.DomEvent = DomEvent;\n  exports.DomUtil = DomUtil;\n  exports.Draggable = Draggable;\n  exports.Evented = Evented;\n  exports.FeatureGroup = FeatureGroup;\n  exports.GeoJSON = GeoJSON;\n  exports.GridLayer = GridLayer;\n  exports.Handler = Handler;\n  exports.Icon = Icon;\n  exports.ImageOverlay = ImageOverlay;\n  exports.LatLng = LatLng;\n  exports.LatLngBounds = LatLngBounds;\n  exports.Layer = Layer;\n  exports.LayerGroup = LayerGroup;\n  exports.LineUtil = LineUtil;\n  exports.Map = Map;\n  exports.Marker = Marker;\n  exports.Mixin = Mixin;\n  exports.Path = Path;\n  exports.Point = Point;\n  exports.PolyUtil = PolyUtil;\n  exports.Polygon = Polygon;\n  exports.Polyline = Polyline;\n  exports.Popup = Popup;\n  exports.PosAnimation = PosAnimation;\n  exports.Projection = index;\n  exports.Rectangle = Rectangle;\n  exports.Renderer = Renderer;\n  exports.SVG = SVG;\n  exports.SVGOverlay = SVGOverlay;\n  exports.TileLayer = TileLayer;\n  exports.Tooltip = Tooltip;\n  exports.Transformation = Transformation;\n  exports.Util = Util;\n  exports.VideoOverlay = VideoOverlay;\n  exports.bind = bind;\n  exports.bounds = toBounds;\n  exports.canvas = canvas;\n  exports.circle = circle;\n  exports.circleMarker = circleMarker;\n  exports.control = control;\n  exports.divIcon = divIcon;\n  exports.extend = extend;\n  exports.featureGroup = featureGroup;\n  exports.geoJSON = geoJSON;\n  exports.geoJson = geoJson;\n  exports.gridLayer = gridLayer;\n  exports.icon = icon;\n  exports.imageOverlay = imageOverlay;\n  exports.latLng = toLatLng;\n  exports.latLngBounds = toLatLngBounds;\n  exports.layerGroup = layerGroup;\n  exports.map = createMap;\n  exports.marker = marker;\n  exports.point = toPoint;\n  exports.polygon = polygon;\n  exports.polyline = polyline;\n  exports.popup = popup;\n  exports.rectangle = rectangle;\n  exports.setOptions = setOptions;\n  exports.stamp = stamp;\n  exports.svg = svg;\n  exports.svgOverlay = svgOverlay;\n  exports.tileLayer = tileLayer;\n  exports.tooltip = tooltip;\n  exports.transformation = toTransformation;\n  exports.version = version;\n  exports.videoOverlay = videoOverlay;\n\n  var oldL = window.L;\n  exports.noConflict = function() {\n  \twindow.L = oldL;\n  \treturn this;\n  }\n  // Always export us to window global (see #2364)\n  window.L = exports;\n\n}));\n//# sourceMappingURL=leaflet-src.js.map\n","import L from 'leaflet';\nimport type { MeasurementsState } from '../measurements-state.js';\n\nexport class MapComponent {\n    private state: MeasurementsState;\n    private map: L.Map | null = null;\n    private routeLine: L.Polyline | null = null;\n    private currentPosMarker: L.CircleMarker | null = null;\n    private mounted: boolean = false;\n    private animationFrameId: number | null = null;\n    private lastGpsCount: number = 0;\n\n    // Configuration\n    private readonly defaultZoom = 15;\n    private readonly followUser = true;\n\n    constructor(state: MeasurementsState) {\n        this.state = state;\n    }\n\n    public mount(elementId: string): void {\n        const element = document.getElementById(elementId);\n        if (!element) {\n            console.warn(`MapComponent: Element with ID \"${elementId}\" not found.`);\n            return;\n        }\n\n        // Initialize Leaflet map\n        // Start with a world view, will center on GPS update\n        this.map = L.map(elementId);\n\n        // If we have GPS data, use the last point, otherwise 0,0\n        const hasData = this.state.gps.length > 0;\n        const initialLat = hasData ? this.state.gps[this.state.gps.length - 1].lat : 0;\n        const initialLon = hasData ? this.state.gps[this.state.gps.length - 1].lon : 0;\n        const initialZoom = hasData ? this.defaultZoom : 2;\n\n        this.map.setView([initialLat, initialLon], initialZoom);\n\n        // Add OpenStreetMap tile layer\n        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n        }).addTo(this.map);\n\n        // Create route polyline\n        this.routeLine = L.polyline([], {\n            color: 'var(--color-primary, #007bff)', // Use CSS var if available\n            weight: 5,\n            opacity: 0.7\n        }).addTo(this.map);\n\n        // Create current position marker (using CircleMarker to avoid icon issues)\n        this.currentPosMarker = L.circleMarker([initialLat, initialLon], {\n            radius: 8,\n            fillColor: 'var(--color-accent, #28a745)',\n            color: '#ffffff',\n            weight: 2,\n            opacity: 1,\n            fillOpacity: 0.8\n        });\n\n        // Only add marker if we actually have data\n        if (hasData) {\n            this.currentPosMarker.addTo(this.map);\n        }\n\n        this.mounted = true;\n        this.lastGpsCount = 0;\n\n        // Start update loop\n        this.startLoop();\n\n        // Force an immediate update to draw existing path\n        this.update();\n\n        // Handle Map Resize issues\n        setTimeout(() => {\n            this.map?.invalidateSize();\n        }, 100);\n    }\n\n    public unmount(): void {\n        this.mounted = false;\n        if (this.animationFrameId !== null) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n\n        if (this.map) {\n            this.map.remove();\n            this.map = null;\n        }\n        this.routeLine = null;\n        this.currentPosMarker = null;\n    }\n\n    public update(): void {\n        if (!this.mounted || !this.map || !this.routeLine || !this.currentPosMarker) {\n            return;\n        }\n\n        const gpsData = this.state.gps;\n\n        // Optimization: only update if data changed or we haven't drawn fully\n        if (gpsData.length === this.lastGpsCount) {\n            return;\n        }\n\n        const points = gpsData.map(p => [p.lat, p.lon] as [number, number]);\n\n        // Update polyline\n        this.routeLine.setLatLngs(points);\n\n        if (gpsData.length > 0) {\n            const lastPoint = gpsData[gpsData.length - 1];\n            const latLng: [number, number] = [lastPoint.lat, lastPoint.lon];\n\n            // Update marker\n            this.currentPosMarker.setLatLng(latLng);\n\n            // Ensure marker is on map\n            if (!this.map.hasLayer(this.currentPosMarker)) {\n                this.currentPosMarker.addTo(this.map);\n            }\n\n            // Follow user logic\n            if (this.followUser) {\n                // Only pan if we are reasonably far from center to avoid jitter\n                // Or just use setView if it's the first few points\n                if (this.lastGpsCount === 0) {\n                    this.map.setView(latLng, this.defaultZoom);\n                } else {\n                    // Maybe check distance before panning?\n                    // For now, keep it simple and just pan to keep user in view\n                    // But avoid blocking UI if it updates too fast.\n                    // Since update() is in Raf this should be ok.\n                    this.map.panTo(latLng, { animate: true });\n                }\n            }\n        }\n\n        this.lastGpsCount = gpsData.length;\n    }\n\n    private startLoop(): void {\n        const loop = () => {\n            if (!this.mounted) return;\n            this.update();\n            this.animationFrameId = requestAnimationFrame(loop);\n        };\n        this.animationFrameId = requestAnimationFrame(loop);\n    }\n\n    /**\n     * Call this when container is resized\n     */\n    public resize(): void {\n        this.map?.invalidateSize();\n    }\n}\n","import { MapComponent } from '../ui/map-component.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { ConnectionsState } from '../types/connections.js';\n\n/**\n * Initialize the GPS Map component and toggle controls\n */\nexport function initMap(measurementsState: MeasurementsState, connectionsState: ConnectionsState) {\n    const mapContainerId = 'gpsMap';\n    const toggleBtnId = 'toggleMapBtn';\n    const carouselId = 'dataFieldsCarousel';\n\n    const toggleBtn = document.getElementById(toggleBtnId);\n    const mapContainer = document.getElementById(mapContainerId);\n    const carousel = document.getElementById(carouselId);\n\n    if (!toggleBtn || !mapContainer || !carousel) {\n        console.warn('Map initialization failed: Missing elements');\n        return;\n    }\n\n    const mapComponent = new MapComponent(measurementsState);\n    let isMapVisible = false;\n\n    // Initially hidden\n    toggleBtn.style.display = 'none';\n\n    // Toggle logic\n    toggleBtn.addEventListener('click', () => {\n        isMapVisible = !isMapVisible;\n\n        if (isMapVisible) {\n            // Show Map\n            carousel.style.display = 'none';\n            mapContainer.style.display = 'block';\n            toggleBtn.classList.add('active');\n            toggleBtn.style.background = '#ccc'; // Visual feedback\n\n            // Mount if first time, or just update visibility logic handled internally\n            // Note: MapComponent.mount checks if already mounted\n            mapComponent.mount(mapContainerId);\n\n            // Force resize calculation since it was hidden\n            setTimeout(() => {\n                mapComponent.resize();\n            }, 100);\n\n        } else {\n            // Show Metrics\n            mapContainer.style.display = 'none';\n            carousel.style.display = 'block';\n            toggleBtn.classList.remove('active');\n            toggleBtn.style.background = ''; // Reset\n\n            // mapComponent.unmount(); // Optional: keep state\n        }\n    });\n\n    // Monitor GPS status to enable the button\n    // Simple polling since ConnectionState doesn't emit events directly in this architecture (yet)\n    setInterval(() => {\n        const hasGpsData = measurementsState.gps.length > 0;\n        const isConnected = connectionsState.gps?.isConnected;\n\n        if (isConnected || hasGpsData) {\n            if (toggleBtn.style.display === 'none') {\n                toggleBtn.style.display = 'inline-block';\n            }\n        }\n    }, 2000);\n}\n","/**\n * Auto-Lap Service\n * \n * Automatically marks laps based on distance or time intervals.\n * Integrates with VoiceFeedback for lap announcements.\n * \n * @module AutoLapService\n */\n\nimport { getSettings } from '../config/settings.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport { voiceFeedback } from './VoiceFeedback.js';\n\n/**\n * Calculate total distance from GPS points in meters\n */\nfunction calculateTotalDistanceMeters(gpsPoints: { lat: number; lon: number }[]): number {\n    if (gpsPoints.length < 2) return 0;\n\n    let totalMeters = 0;\n    const R = 6371000; // Earth radius in meters\n\n    for (let i = 1; i < gpsPoints.length; i++) {\n        const prev = gpsPoints[i - 1];\n        const curr = gpsPoints[i];\n\n        // Haversine formula\n        const lat1 = prev.lat * Math.PI / 180;\n        const lat2 = curr.lat * Math.PI / 180;\n        const deltaLat = (curr.lat - prev.lat) * Math.PI / 180;\n        const deltaLon = (curr.lon - prev.lon) * Math.PI / 180;\n\n        const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n            Math.cos(lat1) * Math.cos(lat2) *\n            Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n        totalMeters += R * c;\n    }\n\n    return totalMeters;\n}\n\n/**\n * AutoLapService class for automatic lap marking\n */\nexport class AutoLapService {\n    private measurementsState: MeasurementsState | null = null;\n    private timeState: TimeState | null = null;\n    private lastLapDistanceKm: number = 0;\n    private lastLapTimeMs: number = 0;\n    private checkInterval: ReturnType<typeof setInterval> | null = null;\n    private isActive: boolean = false;\n    private onLapCallback: ((lapNumber: number) => void) | null = null;\n\n    /**\n     * Initialize the service with state references\n     */\n    init(measurementsState: MeasurementsState, timeState: TimeState): void {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Set callback for when a lap is automatically marked\n     */\n    onLap(callback: (lapNumber: number) => void): void {\n        this.onLapCallback = callback;\n    }\n\n    /**\n     * Start monitoring for auto-lap triggers\n     */\n    start(): void {\n        if (this.isActive || !this.measurementsState || !this.timeState) {\n            return;\n        }\n\n        const settings = getSettings();\n        if (!settings.autoLap.enabled) {\n            return;\n        }\n\n        this.isActive = true;\n        this.lastLapDistanceKm = 0;\n        this.lastLapTimeMs = 0;\n\n        // Check every second\n        this.checkInterval = setInterval(() => this.checkAutoLap(), 1000);\n\n        console.log(`AutoLap started: ${settings.autoLap.source} mode`);\n    }\n\n    /**\n     * Stop monitoring for auto-lap triggers\n     */\n    stop(): void {\n        if (this.checkInterval) {\n            clearInterval(this.checkInterval);\n            this.checkInterval = null;\n        }\n        this.isActive = false;\n        this.lastLapDistanceKm = 0;\n        this.lastLapTimeMs = 0;\n    }\n\n    /**\n     * Reset state (called when workout is discarded)\n     */\n    reset(): void {\n        this.stop();\n    }\n\n    /**\n     * Check if an auto-lap should be triggered\n     */\n    private checkAutoLap(): void {\n        if (!this.measurementsState || !this.timeState || !this.timeState.running) {\n            return;\n        }\n\n        const settings = getSettings();\n        if (!settings.autoLap.enabled) {\n            this.stop();\n            return;\n        }\n\n        if (settings.autoLap.source === 'distance') {\n            this.checkDistanceAutoLap(settings.autoLap.distanceKm);\n        } else if (settings.autoLap.source === 'time') {\n            this.checkTimeAutoLap(settings.autoLap.timeMinutes);\n        }\n    }\n\n    /**\n     * Check for distance-based auto-lap\n     */\n    private checkDistanceAutoLap(intervalKm: number): void {\n        if (!this.measurementsState) return;\n\n        const totalMeters = calculateTotalDistanceMeters(this.measurementsState.gps);\n        const totalKm = totalMeters / 1000;\n\n        // Calculate which km mark we're at\n        const currentInterval = Math.floor(totalKm / intervalKm);\n        const lastInterval = Math.floor(this.lastLapDistanceKm / intervalKm);\n\n        if (currentInterval > lastInterval && totalKm > 0) {\n            this.triggerAutoLap();\n            this.lastLapDistanceKm = totalKm;\n        }\n    }\n\n    /**\n     * Check for time-based auto-lap\n     */\n    private checkTimeAutoLap(intervalMinutes: number): void {\n        if (!this.timeState || !this.timeState.startTime) return;\n\n        const elapsedMs = Date.now() - this.timeState.startTime;\n        const intervalMs = intervalMinutes * 60 * 1000;\n\n        // Calculate which time interval we're at\n        const currentInterval = Math.floor(elapsedMs / intervalMs);\n        const lastInterval = Math.floor(this.lastLapTimeMs / intervalMs);\n\n        if (currentInterval > lastInterval && elapsedMs > 0) {\n            this.triggerAutoLap();\n            this.lastLapTimeMs = elapsedMs;\n        }\n    }\n\n    /**\n     * Trigger an automatic lap\n     */\n    private triggerAutoLap(): void {\n        if (!this.measurementsState || !this.timeState) return;\n\n        // Get previous lap timestamp or start time\n        const laps = this.measurementsState.laps;\n        const lastLapTime = laps.length > 0\n            ? laps[laps.length - 1].timestamp\n            : (this.timeState.startTime || Date.now());\n\n        // Add the lap\n        const lap = this.measurementsState.addLap(this.timeState.startTime);\n\n        // Calculate lap duration\n        const now = lap.timestamp;\n        const durationMs = now - lastLapTime;\n\n        // Calculate average power for the lap\n        const lapPower = this.measurementsState.power.filter(\n            p => p.timestamp >= lastLapTime && p.timestamp <= now\n        );\n        const avgPower = lapPower.length > 0\n            ? lapPower.reduce((sum, p) => sum + p.value, 0) / lapPower.length\n            : 0;\n\n        // Voice announcement\n        voiceFeedback.announceLap(lap.number, durationMs, avgPower);\n\n        console.log(`Auto-lap marked: ${lap.number} at ${new Date(lap.timestamp).toISOString()}`);\n\n        // Notify callback\n        if (this.onLapCallback) {\n            this.onLapCallback(lap.number);\n        }\n    }\n\n    /**\n     * Get whether auto-lap is currently active\n     */\n    isAutoLapActive(): boolean {\n        return this.isActive;\n    }\n}\n\n/** Singleton instance */\nexport const autoLapService = new AutoLapService();\n","import { initTimerDisplay, pauseWorkout, resumeWorkout } from '../ui/time.js';\nimport { initDiscardButton, initExportButton, initMetricsToggle, initWorkoutSummaryModal } from '../ui/menu.js';\nimport { showNotification } from '../ui/notifications.js';\nimport { announce } from '../ui/accessibility.js';\nimport { getTimestring } from '../getTimestring.js';\nimport { initMetricsDisplay } from '../initMetricsDisplay.js';\nimport { initStreamViewer } from '../ui/streamViewer.js';\nimport { initStreamingControls } from '../initStreamingControls.js';\nimport { initWorkoutBuilder } from '../ui/workoutBuilder.js';\nimport { initKeyboardNavigation } from '../ui/accessibility.js';\nimport { setupDarkModeToggle } from '../ui/darkMode.js';\nimport { initOnboarding } from '../ui/onboarding.js';\nimport { initLapButton } from '../ui/lap.js';\nimport { initWorkoutRecovery } from '../ui/workoutRecovery.js';\nimport { initInstallPrompt } from '../ui/installPrompt.js';\nimport { initAboutModal } from '../ui/about.js';\nimport { handleWakeLock } from '../ui/wakeLock.js';\nimport { registerServiceWorker } from '../ui/serviceWorker.js';\nimport { initMap } from './map.js';\nimport { AutoPauseService } from '../services/AutoPauseService.js';\nimport { autoLapService } from '../services/AutoLapService.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState, ConnectionsState } from '../getInitState.js';\nimport type { ZoneState } from '../zone-state.js';\nimport type { StreamManager } from '../stream-manager.js';\nimport { createDataFieldsManager } from '../data-fields/DataFieldsManager.js';\nimport { loadActiveProfile, saveActiveScreenIndex } from '../data-fields/persistence.js';\nimport type { ActivityProfile } from '../data-fields/types.js';\nimport type { ScreenCarouselComponent } from '../components/data-fields/ScreenCarouselComponent.js';\n\n/**\n * Parameters for UI initialization\n */\ninterface UiInitParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    connectionsState: ConnectionsState;\n    streamManager: StreamManager;\n}\n\n/**\n * Initialize all User Interface components\n * \n * Sets up:\n * - Metrics displays (Power, HR, Cadence)\n * - Navigation and Menus\n * - Streaming controls and viewer\n * - Workout builder\n * - System features (Wake lock, PWA install, Service Worker)\n * - Accessibility features\n * \n * @param params - State objects and dependencies\n * @returns The initialized ZoneState for zone distribution tracking\n */\nexport function initUi({ measurementsState, timeState, connectionsState, streamManager }: UiInitParams): ZoneState {\n    // Initialize UI components\n    initTimerDisplay(timeState);\n    const zoneState = initMetricsDisplay({ measurementsState });\n\n    // Initialize Map\n    initMap(measurementsState, connectionsState);\n\n    // Initialize Data Fields System\n    const dataFieldsCarousel = document.getElementById('dataFieldsCarousel') as HTMLElement | null;\n    let dataFieldsManager: ReturnType<typeof createDataFieldsManager> | null = null;\n\n    if (dataFieldsCarousel) {\n        try {\n            const activeProfile = loadActiveProfile();\n            dataFieldsManager = createDataFieldsManager({\n                measurementsState,\n                connectionsState,\n                timeState,\n                initialProfile: activeProfile,\n            });\n            dataFieldsManager.attachToCarousel(dataFieldsCarousel as ScreenCarouselComponent);\n            dataFieldsManager.start();\n            console.log('[DataFields] Manager initialized with profile:', activeProfile.name);\n\n            // Listen for profile changes from settings\n            document.addEventListener('data-fields-profile-changed', (e: Event) => {\n                const customEvent = e as CustomEvent<{ profile: ActivityProfile }>;\n                if (dataFieldsManager && customEvent.detail?.profile) {\n                    dataFieldsManager.setProfile(customEvent.detail.profile);\n                    console.log('[DataFields] Profile updated from settings');\n                }\n            });\n\n            // Listen for screen changes to persist active screen index\n            dataFieldsCarousel.addEventListener('screen-change', (e: Event) => {\n                const customEvent = e as CustomEvent<{ screenIndex: number }>;\n                if (customEvent.detail && activeProfile) {\n                    saveActiveScreenIndex(activeProfile.id, customEvent.detail.screenIndex);\n                }\n            });\n        } catch (error) {\n            console.error('[DataFields] Failed to initialize:', error);\n        }\n    }\n\n    // PWA & System features\n    handleWakeLock();\n    registerServiceWorker();\n    initInstallPrompt();\n\n    // UI Modules\n    initAboutModal();\n    initStreamViewer();\n    initStreamingControls(streamManager, timeState);\n    initWorkoutBuilder();\n    initKeyboardNavigation();\n\n    const darkModeToggle = document.getElementById('toggleDarkMode') as HTMLInputElement | null;\n    if (darkModeToggle) {\n        setupDarkModeToggle(darkModeToggle);\n    }\n\n    initOnboarding();\n    initLapButton({ measurementsState, timeState });\n\n    // Initialize Auto-Pause Service\n    const autoPauseService = new AutoPauseService(\n        measurementsState,\n        timeState,\n        {\n            onAutoPause: () => pauseWorkout(timeState, true),\n            onAutoResume: () => resumeWorkout(timeState, true),\n        }\n    );\n\n    // Initialize Auto-Lap Service\n    autoLapService.init(measurementsState, timeState);\n    autoLapService.onLap((lapNumber) => {\n        const laps = measurementsState.laps;\n        const lap = laps.find(l => l.number === lapNumber);\n\n        if (lap) {\n            const elapsedStr = lap.elapsedMs ? getTimestring(lap.elapsedMs) : '';\n            const message = `Auto Lap ${lap.number}${elapsedStr ? ` at ${elapsedStr}` : ''}`;\n\n            showNotification(` ${message}`, 'info');\n            announce(message, 'assertive');\n        }\n    });\n\n    // Initialize Enhanced Voice Feedback\n    voiceFeedback.init(measurementsState, timeState);\n\n    // Start auto-pause monitoring when workout starts\n    document.addEventListener('workoutStarted', () => {\n        autoPauseService.start();\n        autoLapService.start();\n        voiceFeedback.startIntervalAnnouncements();\n    });\n\n    // Stop auto-pause monitoring when workout is discarded\n    document.addEventListener('workoutDiscarded', () => {\n        autoPauseService.reset();\n        autoLapService.reset();\n        voiceFeedback.reset();\n    });\n\n    // Re-initialize auto-pause when settings change\n    window.addEventListener('settings-changed', () => {\n        if (timeState.running) {\n            autoPauseService.stop();\n            autoPauseService.start();\n            autoLapService.stop();\n            autoLapService.start();\n            voiceFeedback.stopIntervalAnnouncements();\n            voiceFeedback.startIntervalAnnouncements();\n        }\n    });\n\n    initWorkoutRecovery(measurementsState, timeState).then((recovered) => {\n        if (recovered) {\n            console.log('Workout recovered from previous session');\n            // Update UI to reflect recovered data\n            document.dispatchEvent(new CustomEvent('workout-recovered'));\n        }\n    });\n\n    // Initialize menu controls \n    // Note: Some of these were at the bottom of main.ts before\n    initDiscardButton({ measurementsState, timeState, zoneState });\n    initExportButton(measurementsState, zoneState);\n    initMetricsToggle();\n    initWorkoutSummaryModal({ measurementsState, timeState, zoneState });\n\n    return zoneState;\n}\n","/**\n * Cadence Sensor Connection Module\n * \n * Connects to Bluetooth cadence sensors supporting the Cycling Speed and Cadence Service.\n * \n * @module connect-cadence\n */\n\nimport type { SensorConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Connect to a cadence sensor.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectCadence = async (): Promise<SensorConnection> => {\n    return BluetoothFactory.connectCadence();\n};\n","/**\n * Heart Rate Sensor Connection Module\n * \n * Connects to Bluetooth heart rate monitors supporting the Heart Rate Service.\n * \n * @module connect-heartrate\n */\n\nimport type { SensorConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Connect to a heart rate sensor.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectHeartRate = async (): Promise<SensorConnection> => {\n    return BluetoothFactory.connectHeartRate();\n};\n","/**\n * Power Sensor Connection Module\n * \n * Connects to Bluetooth cycling power meters supporting the Cycling Power Service.\n * \n * @module connect-power\n */\n\nimport type { SensorConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Connect to a power sensor.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectPower = async (): Promise<SensorConnection> => {\n    return BluetoothFactory.connectPower();\n};\n","import type { TreadmillConnection } from './types/bluetooth.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\nexport const connectTreadmill = async (): Promise<TreadmillConnection> => {\n    return BluetoothFactory.connectTreadmill();\n};\n","import { registerPlugin } from '@capacitor/core';\nimport type { BackgroundGeolocationPlugin, Location, CallbackError } from '@capacitor-community/background-geolocation';\nimport type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nconst BackgroundGeolocation = registerPlugin<BackgroundGeolocationPlugin>('BackgroundGeolocation');\n\nexport const createNativeGpsService = (): GpsService => {\n    let watcherId: string | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            try {\n                watcherId = await BackgroundGeolocation.addWatcher(\n                    {\n                        backgroundMessage: \"Tracking your ride.\",\n                        backgroundTitle: \"Bike Power Tracker\",\n                        requestPermissions: true,\n                        stale: false,\n                        distanceFilter: 10\n                    },\n                    (location: Location | null | undefined, error?: CallbackError | null) => {\n                        if (error) {\n                            if (error.code === \"NOT_AUTHORIZED\") {\n                                if (window.confirm(\n                                    \"This app needs your location, \" +\n                                    \"but does not have permission.\\n\\n\" +\n                                    \"Open settings now?\"\n                                )) {\n                                    BackgroundGeolocation.openSettings();\n                                }\n                            }\n                            return console.error(error);\n                        }\n\n                        if (location) {\n                            const point: GpsPoint = {\n                                timestamp: location.time || Date.now(),\n                                lat: location.latitude,\n                                lon: location.longitude,\n                                accuracy: location.accuracy,\n                                altitude: location.altitude,\n                                speed: location.speed,\n                                heading: location.bearing\n                            };\n                            listener(point);\n                        }\n                    }\n                );\n            } catch (e) {\n                console.error('Error starting native GPS:', e);\n            }\n        },\n        stop: async () => {\n            if (watcherId) {\n                await BackgroundGeolocation.removeWatcher({\n                    id: watcherId\n                });\n                watcherId = null;\n            }\n        }\n    };\n};\n","import type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nexport const createWebGpsService = (): GpsService => {\n    let watchId: number | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            if (!('geolocation' in navigator)) {\n                console.warn('Geolocation is not supported by this browser.');\n                return;\n            }\n\n            watchId = navigator.geolocation.watchPosition(\n                (position) => {\n                    const point: GpsPoint = {\n                        timestamp: position.timestamp,\n                        lat: position.coords.latitude,\n                        lon: position.coords.longitude,\n                        accuracy: position.coords.accuracy,\n                        altitude: position.coords.altitude,\n                        speed: position.coords.speed,\n                        heading: position.coords.heading\n                    };\n                    listener(point);\n                },\n                (error) => {\n                    console.error('Error watching position:', error);\n                },\n                {\n                    enableHighAccuracy: true,\n                    timeout: 5000,\n                    maximumAge: 0\n                }\n            );\n        },\n        stop: async () => {\n            if (watchId !== null) {\n                navigator.geolocation.clearWatch(watchId);\n                watchId = null;\n            }\n        }\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { GpsService } from './types.js';\nimport { createNativeGpsService } from './native-gps.js';\nimport { createWebGpsService } from './web-gps.js';\n\nexport const GpsFactory = {\n    create: (): GpsService => {\n        if (Capacitor.isNativePlatform()) {\n            return createNativeGpsService();\n        } else {\n            return createWebGpsService();\n        }\n    }\n};\n","import type { GpsPoint } from './types/measurements.js';\nimport { GpsFactory } from './services/gps/factory.js';\nimport type { GpsListener } from './services/gps/types.js';\nimport { Capacitor } from '@capacitor/core';\n\nexport interface GpsConnection {\n    stop: () => Promise<void>;\n    deviceName?: string;\n}\n\nexport const connectGpsMock = async (listener: GpsListener): Promise<GpsConnection> => {\n    const interval = setInterval(() => {\n        const point: GpsPoint = {\n            timestamp: Date.now(),\n            lat: 52.5200 + (Math.random() - 0.5) * 0.01,\n            lon: 13.4050 + (Math.random() - 0.5) * 0.01,\n            accuracy: 5,\n            speed: (25 + (Math.random() - 0.5) * 5) / 3.6, // ~25 km/h in m/s\n            altitude: 50,\n            heading: 0\n        };\n        listener(point);\n    }, 1000);\n\n    return {\n        stop: async () => clearInterval(interval),\n        deviceName: 'Mock GPS',\n    };\n};\n\nexport const connectGps = async (listener: GpsListener): Promise<GpsConnection> => {\n    // Use mock GPS only in development/test mode AND when not on native platform\n    // Native platforms should always use real GPS regardless of build mode\n    const useMock = (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') &&\n        !Capacitor.isNativePlatform();\n\n    if (useMock) {\n        return connectGpsMock(listener);\n    }\n\n    const service = GpsFactory.create();\n    await service.start(listener);\n\n    return {\n        stop: async () => service.stop(),\n        deviceName: 'GPS Sensor'\n    };\n};\n","/**\n * DOM Element References\n * \n * Centralized access to DOM elements used throughout the application.\n * \n * @module elements\n */\n\nimport type { SensorType } from './types/connections.js';\n\n/**\n * Sensor element configuration\n */\nexport interface SensorElements {\n    display: HTMLElement | null;\n    connect: HTMLElement | null;\n}\n\n/**\n * All sensor elements by type\n */\nexport type SensorElementsMap = Record<SensorType, SensorElements>;\n\n/**\n * Get DOM element by ID with null check\n * \n * @param id - Element ID\n * @returns The element or null if not found\n */\nfunction getElement<T extends HTMLElement = HTMLElement>(id: string): T | null {\n    const el = document.getElementById(id) as T | null;\n    if (!el) {\n        // console.warn(`Element with ID \"${id}\" not found`);\n    }\n    return el;\n}\n\n/**\n * Grouped elements by sensor type.\n * Uses getters to lazily retrieve elements from the DOM, ensuring they are found\n * even if this module is imported before the DOM is fully constructed.\n */\nexport const elements: SensorElementsMap = {\n    get power() { return { display: getElement('power'), connect: getElement('connectPower') }; },\n    get heartrate() { return { display: getElement('heartrate'), connect: getElement('connectHeartrate') }; },\n    get cadence() { return { display: getElement('cadence'), connect: getElement('connectCadence') }; },\n    get gps() { return { display: null, connect: getElement('connectGps') }; },\n    get speed() { return { display: getElement('speed'), connect: null }; },\n    get distance() { return { display: getElement('distance'), connect: null }; },\n    get altitude() { return { display: getElement('altitude'), connect: null }; },\n    get treadmill() { return { display: getElement('value-incline'), connect: getElement('connectTreadmill') }; },\n    get treadmillSpeed() { return { display: getElement('treadmillSpeed'), connect: null }; },\n};\n\n/**\n * Get element by ID (type-safe helper)\n */\nexport { getElement };\n","/**\n * Connection Error UI Module\n * \n * Displays user-friendly error messages for Bluetooth connection failures\n * with troubleshooting suggestions and retry functionality.\n * \n * @module connectionError\n */\n\nimport { showModal } from './modal.js';\nimport { announce } from './accessibility.js';\nimport type { MeasurementType } from '../types/measurements.js';\n\n/**\n * Bluetooth error codes and their user-friendly messages\n */\ninterface ErrorInfo {\n    title: string;\n    message: string;\n    suggestions: string[];\n    canRetry: boolean;\n}\n\n/**\n * Sensor type display names\n */\nconst sensorLabels: Record<MeasurementType | 'treadmill', string> = {\n    power: 'Power Meter',\n    heartrate: 'Heart Rate Monitor',\n    cadence: 'Cadence Sensor',\n    speed: 'Speed Sensor',\n    distance: 'Distance Sensor',\n    altitude: 'Altimeter',\n    gps: 'GPS',\n    treadmill: 'Treadmill',\n    treadmillSpeed: 'Treadmill Speed',\n    energy: 'Energy',\n};\n\n/**\n * Sensor type icons\n */\nconst sensorIcons: Record<MeasurementType | 'treadmill', string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n    treadmill: '',\n    treadmillSpeed: '',\n    energy: ''\n};\n\n/**\n * Parse a Bluetooth error and return user-friendly information\n */\nfunction parseBluetoothError(error: unknown, sensorType: MeasurementType | 'treadmill'): ErrorInfo {\n    const sensorLabel = sensorLabels[sensorType];\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorName = error instanceof Error ? error.name : '';\n\n    // User cancelled the device selection\n    if (errorMessage.includes('User cancelled') || errorMessage.includes('cancelled the requestDevice')) {\n        return {\n            title: 'Connection Cancelled',\n            message: `${sensorLabel} pairing was cancelled.`,\n            suggestions: [\n                'Click the connect button to try again',\n                'Make sure your sensor is powered on and in range',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Bluetooth not available\n    if (errorMessage.includes('Bluetooth adapter not available') ||\n        errorMessage.includes('Web Bluetooth API is not available') ||\n        errorName === 'NotFoundError' && errorMessage.includes('Bluetooth')) {\n        return {\n            title: 'Bluetooth Unavailable',\n            message: 'Bluetooth is not available on this device or browser.',\n            suggestions: [\n                'Check that Bluetooth is enabled in your device settings',\n                'Try using Chrome, Edge, or another browser that supports Web Bluetooth',\n                'On macOS, ensure Bluetooth permissions are granted in System Preferences',\n                'On Windows, check that your Bluetooth adapter is working',\n            ],\n            canRetry: false,\n        };\n    }\n\n    // No devices found\n    if (errorMessage.includes('No Bluetooth devices') ||\n        errorMessage.includes('No devices found') ||\n        (errorName === 'NotFoundError' && !errorMessage.includes('Bluetooth'))) {\n        return {\n            title: 'No Sensors Found',\n            message: `No compatible ${sensorLabel.toLowerCase()} was found nearby.`,\n            suggestions: [\n                'Make sure your sensor is powered on',\n                'Wake up the sensor by spinning the pedals or moving',\n                'Bring the sensor closer to your device',\n                'Check that the sensor battery is not depleted',\n                'Ensure the sensor is not connected to another device',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // GATT connection failed\n    if (errorMessage.includes('GATT') ||\n        errorMessage.includes('Connection failed') ||\n        errorMessage.includes('connect') && errorMessage.includes('fail')) {\n        return {\n            title: 'Connection Failed',\n            message: `Could not connect to the ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Try moving closer to the sensor',\n                'Power cycle the sensor (turn off and on again)',\n                'Check that no other device is connected to this sensor',\n                'Restart Bluetooth on your device',\n                'If using a phone, try closing other Bluetooth apps',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Security/permission error\n    if (errorMessage.includes('SecurityError') ||\n        errorMessage.includes('permission') ||\n        errorName === 'SecurityError') {\n        return {\n            title: 'Permission Denied',\n            message: 'Bluetooth permission was denied.',\n            suggestions: [\n                'Check your browser settings to allow Bluetooth access',\n                'If prompted, click \"Allow\" to grant Bluetooth permission',\n                'Try refreshing the page and connecting again',\n                'On some browsers, you may need to access this site over HTTPS',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Network/timeout error\n    if (errorMessage.includes('NetworkError') ||\n        errorMessage.includes('timeout') ||\n        errorName === 'NetworkError') {\n        return {\n            title: 'Connection Timed Out',\n            message: `The connection to your ${sensorLabel.toLowerCase()} timed out.`,\n            suggestions: [\n                'Make sure the sensor is in range and powered on',\n                'Try moving closer to the sensor',\n                'Power cycle the sensor and try again',\n                'Check for interference from other wireless devices',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Service not found\n    if (errorMessage.includes('Service') && errorMessage.includes('not found')) {\n        return {\n            title: 'Incompatible Sensor',\n            message: `This device doesn't appear to be a compatible ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Make sure you selected the correct sensor type',\n                'Check that your sensor supports standard Bluetooth protocols',\n                'Some sensors may require a firmware update',\n                'Consult your sensor\\'s documentation for compatibility',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Generic/unknown error\n    return {\n        title: 'Connection Error',\n        message: `Failed to connect to ${sensorLabel.toLowerCase()}.`,\n        suggestions: [\n            'Make sure the sensor is powered on and nearby',\n            'Try power cycling the sensor',\n            'Restart Bluetooth on your device',\n            'Refresh the page and try again',\n        ],\n        canRetry: true,\n    };\n}\n\n/**\n * Create the error content HTML element\n */\nfunction createErrorContent(errorInfo: ErrorInfo): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'connection-error-content';\n\n    // Error message\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = errorInfo.message;\n    container.appendChild(messageEl);\n\n    // Troubleshooting section\n    if (errorInfo.suggestions.length > 0) {\n        const troubleshootingEl = document.createElement('div');\n        troubleshootingEl.className = 'connection-error-troubleshooting';\n\n        const titleEl = document.createElement('h3');\n        titleEl.textContent = ' Troubleshooting Tips';\n        troubleshootingEl.appendChild(titleEl);\n\n        const listEl = document.createElement('ul');\n        listEl.setAttribute('role', 'list');\n        errorInfo.suggestions.forEach(suggestion => {\n            const itemEl = document.createElement('li');\n            itemEl.textContent = suggestion;\n            listEl.appendChild(itemEl);\n        });\n        troubleshootingEl.appendChild(listEl);\n\n        container.appendChild(troubleshootingEl);\n    }\n\n    return container;\n}\n\n/**\n * Show a connection error dialog with troubleshooting suggestions\n * \n * @param error - The error that occurred\n * @param sensorType - The type of sensor that failed to connect\n * @param onRetry - Optional callback for retry button\n * @returns Promise resolving to true if user wants to retry, false otherwise\n */\nexport function showConnectionError(\n    error: unknown,\n    sensorType: MeasurementType | 'treadmill',\n    onRetry?: () => void\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const errorInfo = parseBluetoothError(error, sensorType);\n        const sensorIcon = sensorIcons[sensorType];\n        const content = createErrorContent(errorInfo);\n\n        // Log the actual error for debugging\n        console.error(`[${sensorType}] Connection error:`, error);\n\n        // Announce to screen readers\n        announce(`${errorInfo.title}. ${errorInfo.message}`, 'assertive');\n\n        let closeModal: (() => void) | null = null;\n\n        const buttons = [];\n\n        // Always add a dismiss button\n        buttons.push({\n            text: 'Dismiss',\n            variant: 'secondary' as const,\n            onClick: () => {\n                closeModal?.();\n                resolve(false);\n            },\n        });\n\n        // Add retry button if applicable\n        if (errorInfo.canRetry) {\n            buttons.push({\n                text: 'Try Again',\n                variant: 'primary' as const,\n                onClick: () => {\n                    closeModal?.();\n                    if (onRetry) {\n                        onRetry();\n                    }\n                    resolve(true);\n                },\n            });\n        }\n\n        closeModal = showModal({\n            title: errorInfo.title,\n            icon: sensorIcon,\n            content,\n            buttons,\n            closeOnOverlay: true,\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Show a reconnection failure notification\n * \n * Called when auto-reconnect has exhausted all attempts.\n * \n * @param sensorType - The type of sensor that failed to reconnect\n * @param onRetry - Optional callback to manually retry connection\n */\nexport function showReconnectionFailed(\n    sensorType: MeasurementType | 'treadmill',\n    onRetry?: () => void\n): void {\n    const sensorLabel = sensorLabels[sensorType];\n    const sensorIcon = sensorIcons[sensorType];\n\n    const content = document.createElement('div');\n    content.className = 'connection-error-content';\n\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = `Lost connection to your ${sensorLabel.toLowerCase()} and automatic reconnection failed.`;\n    content.appendChild(messageEl);\n\n    const tipsEl = document.createElement('div');\n    tipsEl.className = 'connection-error-troubleshooting';\n\n    const titleEl = document.createElement('h3');\n    titleEl.textContent = ' To reconnect:';\n    tipsEl.appendChild(titleEl);\n\n    const listEl = document.createElement('ul');\n    listEl.setAttribute('role', 'list');\n    [\n        'Make sure the sensor is still powered on',\n        'Move closer to the sensor',\n        'Click \"Try Again\" to reconnect manually',\n    ].forEach(tip => {\n        const itemEl = document.createElement('li');\n        itemEl.textContent = tip;\n        listEl.appendChild(itemEl);\n    });\n    tipsEl.appendChild(listEl);\n    content.appendChild(tipsEl);\n\n    announce(`${sensorLabel} connection lost. Automatic reconnection failed.`, 'assertive');\n\n    let closeModal: (() => void) | null = null;\n\n    closeModal = showModal({\n        title: 'Connection Lost',\n        icon: sensorIcon,\n        content,\n        buttons: [\n            {\n                text: 'Dismiss',\n                variant: 'secondary',\n                onClick: () => {\n                    closeModal?.();\n                },\n            },\n            {\n                text: 'Try Again',\n                variant: 'primary',\n                onClick: () => {\n                    closeModal?.();\n                    onRetry?.();\n                },\n            },\n        ],\n        closeOnOverlay: true,\n    });\n}\n","/**\n * Connection Button Initialization\n * \n * Sets up Bluetooth sensor connection buttons with connect/disconnect functionality.\n * \n * @module initConnectionButtons\n */\n\nimport { connectCadence } from './connect-cadence.js';\nimport { connectHeartRate } from './connect-heartrate.js';\nimport { connectPower } from './connect-power.js';\nimport { connectTreadmill } from './connect-treadmill.js';\nimport { connectGps, type GpsConnection } from './connect-gps.js';\nimport { elements } from './elements.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { Measurement, TreadmillMeasurement } from './types/measurements.js';\nimport type { ConnectionsState } from './getInitState.js';\nimport type { SensorType } from './types/connections.js';\nimport type { ConnectionStatus, SensorConnection, TreadmillConnection } from './types/bluetooth.js';\nimport { showNotification } from './ui/notifications.js';\nimport { showConnectionError, showReconnectionFailed } from './ui/connectionError.js';\n\n/**\n * Parameters for connection button initialization\n */\ninterface InitConnectionButtonsParams {\n    connectionsState: ConnectionsState;\n    measurementsState: MeasurementsState;\n}\n\n/**\n * Emoji icons for each sensor type\n */\nconst emojis: Record<SensorType, string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n    treadmill: '',\n    treadmillSpeed: ''\n};\n\n/**\n * Get formatted sensor type label\n */\nconst getSensorLabel = (key: SensorType): string => {\n    return key.charAt(0).toUpperCase() + key.slice(1);\n};\n\n/**\n * Initialize connection buttons for all sensor types.\n * \n * Sets up click handlers for connect/disconnect buttons that:\n * - Connect to Bluetooth sensors\n * - Update connection state\n * - Register measurement listeners\n * - Update UI to reflect connection status\n * - Display device name when connected\n * - Handle auto-reconnect status updates\n * \n * @param params - Object containing state objects\n */\nexport const initConnectionButtons = ({\n    connectionsState,\n    measurementsState,\n}: InitConnectionButtonsParams): void => {\n\n    /**\n     * Update button text based on connection status\n     */\n    const updateButtonText = (\n        key: SensorType,\n        status: 'connected' | 'disconnected' | 'reconnecting',\n        deviceName?: string\n    ): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const label = getSensorLabel(key);\n        const emoji = emojis[key];\n\n        switch (status) {\n            case 'connected':\n                if (deviceName) {\n                    connectElem.textContent = `${emoji} Disconnect ${label} (${deviceName})`;\n                } else {\n                    connectElem.textContent = `${emoji} Disconnect ${label}`;\n                }\n                break;\n            case 'reconnecting':\n                connectElem.textContent = `${emoji} Reconnecting ${label}...`;\n                break;\n            case 'disconnected':\n                connectElem.textContent = `${emoji} Connect ${label}`;\n                break;\n        }\n    };\n\n    /**\n     * Disconnect from a sensor\n     */\n    const disconnectFn = (key: SensorType): void => {\n        const connectionState = connectionsState[key];\n        if (!connectionState) return;\n\n        if (typeof connectionState.disconnect === 'function') {\n            connectionState.disconnect();\n            connectionState.disconnect = null;\n            connectionState.isConnected = false;\n\n            updateButtonText(key, 'disconnected');\n\n            const displayElem = elements[key]?.display;\n            if (displayElem) {\n                displayElem.textContent = '--';\n            }\n        }\n    };\n\n    /**\n     * Handle connection status changes from auto-reconnect\n     */\n    const handleStatusChange = (key: SensorType, deviceName: string) => (status: ConnectionStatus): void => {\n        const label = getSensorLabel(key);\n\n        switch (status) {\n            case 'connected':\n                updateButtonText(key, 'connected', deviceName);\n                showNotification(`${label} sensor reconnected`, 'success');\n                break;\n            case 'reconnecting':\n                updateButtonText(key, 'reconnecting');\n                break;\n            case 'failed':\n                if (connectionsState[key]) {\n                    connectionsState[key]!.isConnected = false;\n                    connectionsState[key]!.disconnect = null;\n                }\n                updateButtonText(key, 'disconnected');\n                // Show reconnection failed dialog with retry option\n                showReconnectionFailed(key, () => connectFn(key));\n                break;\n            case 'disconnected':\n                // Initial disconnect event, wait for reconnect attempt\n                break;\n        }\n    };\n\n    /**\n     * Connect to a sensor\n     */\n    const connectFn = async (key: SensorType): Promise<void> => {\n        try {\n            updateButtonText(key, 'reconnecting'); // Show loading state\n\n            let connection: SensorConnection | TreadmillConnection | GpsConnection;\n\n            if (key === 'gps') {\n                // GPS has a different interface - uses listener callback instead of addListener\n                const gpsConnection = await connectGps((point) => {\n                    measurementsState.addGps(point);\n                });\n\n                // Adapt GpsConnection to match expected interface\n                const state = connectionsState[key];\n                if (state) {\n                    state.disconnect = async () => {\n                        await gpsConnection.stop();\n                    };\n                    state.isConnected = true;\n                }\n\n                // Update UI\n                updateButtonText(key, 'connected', gpsConnection.deviceName);\n                showNotification(`Connected to ${getSensorLabel(key)}`, 'success');\n                return; // GPS doesn't have onStatusChange, early return\n            } else if (key === 'treadmill') {\n                connection = await connectTreadmill();\n                connection.addListener((entry: TreadmillMeasurement) => {\n                    measurementsState.addTreadmillData(entry);\n                });\n            } else if (key === 'power') {\n                connection = await connectPower();\n                connection.addListener((entry: Measurement) => {\n                    measurementsState.addPower(entry);\n                });\n            } else if (key === 'heartrate') {\n                connection = await connectHeartRate();\n                connection.addListener((entry: Measurement) => {\n                    measurementsState.addHeartrate(entry);\n                });\n            } else if (key === 'cadence') {\n                connection = await connectCadence();\n                connection.addListener((entry: Measurement) => {\n                    measurementsState.addCadence(entry);\n                });\n            } else {\n                return; // Unsupported type for connection\n            }\n\n            const { disconnect, deviceName, onStatusChange } = connection;\n\n            // Update state\n            const state = connectionsState[key];\n            if (state) {\n                state.disconnect = disconnect;\n                state.isConnected = true;\n            }\n\n            // Update UI\n            updateButtonText(key, 'connected', deviceName);\n            showNotification(`Connected to ${getSensorLabel(key)}`, 'success');\n\n            // Subscribe to status changes for auto-reconnect feedback\n            if (onStatusChange) {\n                onStatusChange(handleStatusChange(key, deviceName || 'Sensor'));\n            }\n\n        } catch (error) {\n            updateButtonText(key, 'disconnected');\n\n            // Check if user wants to retry\n            const shouldRetry = await showConnectionError(error, key, () => connectFn(key));\n            if (!shouldRetry) {\n                // Reset state just in case\n                if (connectionsState[key]) {\n                    connectionsState[key]!.isConnected = false;\n                }\n            }\n        }\n    };\n\n    /**\n     * Add click listener to a button\n     */\n    const addListener = (key: SensorType): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const handler = (e: Event) => {\n            // Prevent propagation\n            e.stopPropagation();\n\n            const isConnected = connectionsState[key]?.isConnected;\n            if (isConnected) {\n                disconnectFn(key);\n            } else {\n                connectFn(key);\n            }\n        };\n\n        // Add click listener\n        connectElem.addEventListener('click', handler);\n    };\n\n    // Initialize all supported buttons\n    const supportedTypes: (SensorType)[] = ['power', 'heartrate', 'cadence', 'gps', 'treadmill'];\n    supportedTypes.forEach(addListener);\n};\n","/**\n * Stream Manager\n * Handles streaming workout data to the backend service.\n * Used for live sharing of workout metrics.\n * \n * @module StreamManager\n */\n\nimport { createStream, sendWorkoutData, type CreateStreamResponse } from './api/streamClient.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { TimeState } from './getInitState.js';\nimport type { MeasurementType } from './types/measurements.js';\n\nexport interface StreamStatus {\n    isStreaming: boolean;\n    isPaused: boolean;\n    streamName: string | null;\n}\n\nexport class StreamManager {\n    // Made public readonly to support access from UI checks (temporary fix for existing code)\n    // In a future refactor, prefer getStatus()\n    public isStreaming = false;\n    private isPaused = false;\n    private streamName: string | null = null;\n    private streamInterval: ReturnType<typeof setInterval> | null = null;\n    private measurementsState: MeasurementsState;\n    private timeState: TimeState;\n\n    constructor(measurementsState: MeasurementsState, timeState: TimeState) {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Start streaming workout data\n     * @param streamName - Optional custom stream name\n     * @returns Promise resolving to the stream name\n     */\n    async startStreaming(name?: string): Promise<string> {\n        if (this.isStreaming) {\n            return this.streamName!;\n        }\n\n        try {\n            const safeName = name || `workout-${Date.now()}`;\n            const response: CreateStreamResponse = await createStream(safeName);\n\n            if (!response.success) {\n                throw new Error('Failed to create stream');\n            }\n\n            this.streamName = response.streamName;\n            this.isStreaming = true;\n            this.isPaused = false;\n\n            this._startStreamingLoop();\n\n            return this.streamName;\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            this.streamName = null;\n            throw error;\n        }\n    }\n\n    /**\n     * Pause the stream (stop sending data but keep stream alive)\n     */\n    pauseStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = true;\n        }\n    }\n\n    /**\n     * Resume the stream\n     */\n    resumeStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = false;\n        }\n    }\n\n    /**\n     * Stop streaming workout data\n     */\n    async stopStreaming(): Promise<void> {\n        if (!this.isStreaming) {\n            return;\n        }\n\n        this.isStreaming = false;\n        this.isPaused = false;\n\n        if (this.streamInterval) {\n            clearInterval(this.streamInterval);\n            this.streamInterval = null;\n        }\n\n        // We don't delete the stream here so that data persists for a while (handled by server cleanup)\n        this.streamName = null;\n    }\n\n    /**\n     * Get current streaming status\n     */\n    getStatus(): StreamStatus {\n        return {\n            isStreaming: this.isStreaming,\n            isPaused: this.isPaused,\n            streamName: this.streamName,\n        };\n    }\n\n    /**\n     * Start the streaming loop\n     * @private\n     */\n    private _startStreamingLoop(): void {\n        // Send data every 1 second\n        this.streamInterval = setInterval(async () => {\n            if (!this.isStreaming || this.isPaused || !this.timeState.running) {\n                return;\n            }\n\n            try {\n                await this._sendCurrentData();\n            } catch (error) {\n                console.error('Error sending workout data:', error);\n            }\n        }, 1000);\n    }\n\n    /**\n     * Send current workout data\n     * @private\n     */\n    private async _sendCurrentData(): Promise<void> {\n        if (!this.streamName) return;\n\n        const power = this._getLatestValue('power');\n        const cadence = this._getLatestValue('cadence');\n        const heartrate = this._getLatestValue('heartrate');\n        const speed = this._getLatestValue('speed');\n        const distance = this._getLatestValue('distance');\n        const altitude = this._getLatestValue('altitude');\n        const incline = this._getLatestTreadmillIncline();\n\n        // Only send if we have at least one measurement\n        if (power === null && cadence === null && heartrate === null && speed === null && distance === null && altitude === null && incline === null) {\n            return;\n        }\n\n        const elapsedMs = this.timeState.running && this.timeState.startTime\n            ? Date.now() - this.timeState.startTime\n            : (this.timeState.endTime && this.timeState.startTime)\n                ? this.timeState.endTime - this.timeState.startTime\n                : 0;\n\n        await sendWorkoutData(this.streamName, {\n            timestamp: Date.now(),\n            elapsed: Math.floor(elapsedMs / 1000).toString(),\n            power,\n            cadence,\n            heartrate,\n            speed,\n            distance,\n            altitude,\n            incline\n        });\n    }\n\n    /**\n     * Get latest value for a measurement type\n     * @private\n     */\n    private _getLatestValue(type: Exclude<MeasurementType, 'gps'>): number | null {\n        // @ts-ignore - dynamic access\n        const array = this.measurementsState[type];\n        if (!Array.isArray(array) || array.length === 0) {\n            return null;\n        }\n\n        // Only send data newer than 5 seconds\n        const latest = array[array.length - 1];\n        if (Date.now() - latest.timestamp > 5000) {\n            return null;\n        }\n\n        return latest.value;\n    }\n\n    /**\n     * Get latest treadmill incline value\n     * @private\n     */\n    private _getLatestTreadmillIncline(): number | null {\n        const array = this.measurementsState.treadmill;\n        if (!Array.isArray(array) || array.length === 0) {\n            return null;\n        }\n\n        // Only send data newer than 5 seconds\n        const latest = array[array.length - 1];\n        if (Date.now() - latest.timestamp > 5000) {\n            return null;\n        }\n\n        return latest.incline;\n    }\n}\n","import { initConnectionButtons } from '../initConnectionButtons.js';\nimport { StreamManager } from '../stream-manager.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState, ConnectionsState } from '../getInitState.js';\n\ninterface HardwareInitParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n}\n\nexport function initHardware({ measurementsState, connectionsState, timeState }: HardwareInitParams) {\n    // Initialize Bluetooth connection buttons\n    initConnectionButtons({ connectionsState, measurementsState });\n\n    // Stream manager for live workout streaming\n    const streamManager = new StreamManager(measurementsState, timeState);\n\n    return { streamManager };\n}\n","/**\n * BPT Client - Main Entry Point\n *\n * Progressive Web App for tracking cycling workouts with Bluetooth sensors.\n *\n * This module initializes all application features:\n * - Bluetooth sensor connections (power, cadence, heart rate)\n * - Real-time metrics display\n * - Workout timer\n * - Data export (JSON, TCX, CSV)\n * - Live streaming\n * - PWA features (service worker, install prompt)\n *\n * @module main\n *\n * @description\n * The app uses a state-based architecture with three main state objects:\n * - measurementsState: Tracks workout data (power, cadence, HR measurements)\n * - connectionsState: Tracks Bluetooth connection status\n * - timeState: Tracks recording state and elapsed time\n *\n * @example\n * // State is initialized automatically on app load\n * // Access exposed state in tests:\n * window.measurementsState\n * window.connectionsState\n */\n\nimport './styles/main.css';\n\n// Register Web Components (must be imported before they're used in DOM)\nimport './components/index.js';\nimport { registerDataFieldComponents } from './components/data-fields/index.js';\n\nimport { getInitState } from './getInitState.js';\nimport { exposeVariablesDuringTest } from './exposeVariablesDuringTest.js';\nimport { setupRouter } from './init/router.js';\nimport { initUi } from './init/ui.js';\nimport { initHardware } from './init/hardware.js';\nimport './ui/navbar.css';\nimport './ui/map.css';\n\nconst initApp = (): void => {\n    try {\n        // Register data field Web Components\n        registerDataFieldComponents();\n\n        /**\n         * Initialize application state\n         */\n        const { measurementsState, connectionsState, timeState } = getInitState();\n\n        // Expose state for E2E testing\n        exposeVariablesDuringTest({ measurementsState, connectionsState });\n\n        // Initialize Hardware (Sensors & Streaming)\n        const { streamManager } = initHardware({ measurementsState, connectionsState, timeState });\n\n        // Initialize UI\n        initUi({ measurementsState, timeState, connectionsState, streamManager });\n\n        // Initialize Navigation Logic\n        const router = setupRouter();\n        router.start();\n\n        // Expose router to window for global access (navigation)\n        // Using explicit type compatible with window expansion\n        (window as unknown as { router: typeof router }).router = router;\n    } catch (error: unknown) {\n        console.error('Failed to initialize app:', error);\n    }\n};\n\n// Initialize app when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp, { once: true });\n} else {\n    initApp();\n}\n\nconsole.log('Bike Power Tracker initialized');\n"],"file":"index-DT6pmaf_.js"}