{"version":3,"mappings":"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","names":["BaseComponent","name","oldValue","newValue","_name","_oldValue","_newValue","eventName","detail","selector","ZONE_COLORS","MetricDisplay","label","value","unit","icon","zoneName","showAvg","connected","zone","colors","POWER_ZONES","PowerGauge","size","ftp","max","showZones","radius","circumference","arcLength","ftpPercent","zoneColor","progress","dashOffset","currentFtpPercent","index","startPercent","endPercent","zoneArcLength","offset","targetValue","duration","startValue","startTime","animate","currentTime","elapsed","eased","currentValue","ZoneGauge","percent","fill","container","CHART_CONFIG","LiveChart","config","timestamp","cutoffTime","time","visibleData","d","noDataMsg","width","height","points","areaPoints","point","x","y","linePath","firstX","lastX","areaPath","avg","sum","p","WorkoutTimer","showMs","timeString","totalSeconds","hours","minutes","seconds","pad","n","result","ms","state","TYPE_STYLES","Toast","message","type","dismissible","styles","dismissBtn","options","toast","Modal","title","e","action","focusableElements","first","last","resolve","modal","content","footer","cancelBtn","confirmBtn","okBtn","getTimestring","milliseconds","announce","priority","announcer","shortcuts","registerShortcut","shortcut","handleKeydown","event","target","keyMatch","ctrlMatch","shiftMatch","altMatch","initKeyboardNavigation","startButton","pauseButton","resumeButton","modals","closeBtn","details","firstButton","settingsBtn","historyBtn","exportBtn","lapBtn","summary","trapFocus","firstElement","lastElement","updateWorkoutControlsAccessibility","stopButton","controlsContainer","getWorkoutState","timeState","updateButtonVisibility","elements","initTimerDisplay","timeElement","metricsTable","nextText","currentState","elapsedMs","pausedDuration","workoutCompleteEvent","getValuesAtTimestamps","arr","timestamps","entries","ts","prevIndex","suggestedElem","isAfterLastPoint","prevTime","nextTime","mergeMeasurements","measurements","latMeasurements","lonMeasurements","sources","data","firstTimestamps","endTime","timeStep","syncedHR","syncedCadence","syncedPower","syncedSpeed","syncedDistance","syncedAltitude","syncedLat","syncedLon","dataPoints","i","getCsvString","header","rows","power","cadence","heartrate","speed","distance","altitude","lat","lon","hrString","hr","cadenceString","powerString","getTcxTrackpoint","position","parts","getTcxString","firstTimestamp","lastTimestamp","totalTimeSeconds","startDate","FIT_PROTOCOL_VERSION","FIT_PROFILE_VERSION","FIT_MESG_FILE_ID","FIT_MESG_FILE_CREATOR","FIT_MESG_ACTIVITY","FIT_MESG_SESSION","FIT_MESG_LAP","FIT_MESG_RECORD","FIT_MESG_EVENT","FIT_BASE_TYPE_ENUM","FIT_BASE_TYPE_UINT8","FIT_BASE_TYPE_UINT16","FIT_BASE_TYPE_UINT32","FILE_ID_TYPE","FILE_ID_MANUFACTURER","FILE_ID_PRODUCT","FILE_ID_SERIAL_NUMBER","FILE_ID_TIME_CREATED","RECORD_TIMESTAMP","RECORD_HEART_RATE","RECORD_CADENCE","RECORD_POWER","SESSION_TIMESTAMP","SESSION_START_TIME","SESSION_TOTAL_ELAPSED_TIME","SESSION_TOTAL_TIMER_TIME","SESSION_SPORT","SESSION_SUB_SPORT","SESSION_EVENT","SESSION_EVENT_TYPE","LAP_TIMESTAMP","LAP_START_TIME","LAP_TOTAL_ELAPSED_TIME","LAP_TOTAL_TIMER_TIME","LAP_EVENT","LAP_EVENT_TYPE","EVENT_TIMESTAMP","EVENT_EVENT","EVENT_EVENT_TYPE","ACTIVITY_TIMESTAMP","ACTIVITY_TOTAL_TIMER_TIME","ACTIVITY_NUM_SESSIONS","ACTIVITY_TYPE","ACTIVITY_EVENT","ACTIVITY_EVENT_TYPE","ACTIVITY_LOCAL_TIMESTAMP","FILE_TYPE_ACTIVITY","MANUFACTURER_DEVELOPMENT","SPORT_CYCLING","SUB_SPORT_INDOOR_CYCLING","EVENT_TIMER","EVENT_SESSION","EVENT_LAP","EVENT_ACTIVITY","EVENT_TYPE_START","EVENT_TYPE_STOP","ACTIVITY_TYPE_MANUAL","FIT_EPOCH_MS","calculateCrc","buffer","start","end","crcTable","crc","byte","tmp","toFitTimestamp","jsTimestamp","FitBuilder","localMsgType","globalMsgNum","fields","field","values","dataSize","headerCrc","dataCrc","finalBuffer","getFitData","fit","fitStartTime","fitEndTime","totalElapsedTime","totalElapsedTimeMs","LOCAL_FILE_ID","LOCAL_FILE_CREATOR","LOCAL_EVENT","LOCAL_RECORD","LOCAL_LAP","LOCAL_SESSION","LOCAL_ACTIVITY","fitTimestamp","createModalElement","titleText","body","btn","button","b","firstFocusable","lastFocusable","handleTabKey","showModal","previousActiveElement","removeFocusTrap","autofocusEl","closeModal","handleEscape","originalOnClose","showConfirmation","confirmText","cancelText","confirmVariant","calculateWorkoutSummary","zoneState","calcStats","a","powerDist","hrDist","formatDurationLong","formatSecondsShort","mins","secs","createZoneHistogram","distribution","z","maxTime","timeSeconds","color","timeStr","createSummaryContent","formatValue","powerChart","hrChart","showWorkoutSummary","callbacks","DEFAULT_UNDO_TIMEOUT","showUndoNotification","onUndo","onExpire","timeout","notification","timeoutSeconds","remainingSeconds","undoButton","countdownSpan","progressFill","prefersReducedMotion","isUndone","countdownInterval","dismissTimeout","dismiss","executeExpire","createWorkoutBackup","measurementsState","restoreWorkoutBackup","backup","showNotification","backgroundColor","SETTINGS_KEY","defaultSettings","getSettings","settingsJson","initSettings","settingsButton","settingsModal","closeSettingsModal","saveSettingsButton","settingPower","settingCadence","settingHeartrate","settingPower3s","settingHighContrast","settingColorblindPatterns","settingVoiceEnabled","settingVoiceLaps","settingVoiceZones","settingExportTcx","settingExportCsv","settingExportJson","settingExportFit","loadSettings","settings","applySettings","saveSettings","toggleMetric","metric","isVisible","el","openModal","VoiceFeedback","voices","v","text","utterance","lapNumber","timeMs","avgPower","voiceFeedback","initLapButton","lapButton","lapCounter","lapCountElement","updateLapCounter","count","updateLapButtonVisibility","isRecording","handleLapClick","laps","lastLapTime","lap","now","durationMs","lapPower","elapsedStr","observer","resetLapCounter","initMetricsToggle","toggleYour","yourMetricsSection","toggleStream","streamMetricsSection","initDiscardButton","discardButton","resetWorkoutState","totalDataPoints","restoreWorkoutUI","getExportTimestamp","downloadFile","blob","filename","url","link","initExportButton","exportDataElem","exportData","zoneData","jsonString","jsonBlob","tcxString","tcxBlob","csvString","csvBlob","fitData","fitBlob","error","initWorkoutSummaryModal","getElement","id","element","connectPowerElem","connectHeartrateElem","connectCadenceElem","connectGpsElem","powerElement","heartrateElement","cadenceElement","speedElement","distanceElement","altitudeElement","PROFILE_KEY","loadUserProfile","stored","calculatePowerZones","calculateHrZones","maxHr","getPowerZone","zones","getHrZone","ZoneState","profile","powerZonesDef","hrZonesDef","callback","zoneInfo","currentZone","timeDelta","range","percentInZone","totalTimeMs","DATA_TIMEOUT_MS","UPDATE_INTERVAL_MS","initZoneGauges","powerGauge","hrGauge","powerMetricGroup","hrMetricGroup","initLiveCharts","chartsContainer","metricsSection","initChartsToggle","chartsVisible","toggleBtn","topBarControls","workoutControls","updateZoneDisplays","powerZone","hrZone","applyZoneColorToMetric","_type","parent","zoneColors","initMetricsDisplay","connectionsState","chartsToggle","lastPowerIndex","lastHrIndex","lastPowerZone","lastHrZone","updateLiveCharts","updateMetricDisplay","key","connectionState","latestMeasurement","metricTypes","ExceptionCode","CapacitorException","code","getPlatformId","win","_a","_b","createCapacitor","capCustomPlatform","cap","Plugins","getPlatform","isNativePlatform","isPluginAvailable","pluginName","plugin","registeredPlugins","getPluginHeader","h","handleError","err","registerPlugin","jsImplementations","registeredPlugin","platform","pluginHeader","jsImplementation","loadPluginImplementation","createPluginMethod","impl","prop","methodHeader","m","createPluginMethodWrapper","remove","wrapper","args","fn","addListener","removeListener","addListenerNative","call","callbackId","proxy","_","filePath","initCapacitorGlobal","Capacitor","WebPlugin","listenerFunc","firstListener","windowListener","listener","retainUntilConsumed","listeners","windowEventName","pluginEventName","msg","handle","arg","encode","str","decode","CapacitorCookiesPluginWeb","cookies","cookieMap","cookie","encodedKey","encodedValue","expires","path","domain","readBlobAsBase64","reject","reader","base64String","normalizeHttpHeaders","headers","originalKeys","k","acc","buildUrlParams","params","shouldEncode","accumulator","entry","item","buildRequestInit","extra","output","form","CapacitorHttpPluginWeb","requestInit","urlParams","response","contentType","responseType","SystemBarsStyle","SystemBarType","SystemBarsPluginWeb","ScanMode","ConnectionPriority","numbersToDataView","dataViewToNumbers","numberToUUID","hexStringToDataView","hex","bin","c","isEmpty","dataViewToHexString","s","webUUIDToString","uuid","mapToObject","map","obj","toUint8Array","dataView","toHexString","BluetoothLe","__vitePreload","makeQueue","currentTask","getQueue","enabled","parseUUID","BleClientClass","displayStrings","resultInternal","deviceIds","services","deviceId","onDisconnect","connectionPriority","service","characteristic","writeValue","descriptor","filter","BleClient","CYCLING_POWER_SERVICE","CYCLING_POWER_MEASUREMENT","HEART_RATE_SERVICE","HEART_RATE_MEASUREMENT","CYCLING_SPEED_AND_CADENCE_SERVICE","CSC_MEASUREMENT","MAX_RECONNECT_ATTEMPTS","RECONNECT_BASE_DELAY","connectPowerNative","statusListeners","isManualDisconnect","reconnectAttempts","device","deviceName","notifyStatus","status","connect","attemptReconnect","delay","disconnectedDeviceId","connectHeartRateNative","flags","heartRate","connectCadenceNative","lastCrankRevs","lastCrankTime","crankRevs","crankTime","revDelta","timeInSeconds","rpm","connectPowerWeb","handleCharacteristicChange","connectHeartRateWeb","connectCadenceWeb","BluetoothFactory","connectCadence","connectHeartRate","connectPower","BackgroundGeolocation","createNativeGpsService","watcherId","location","createWebGpsService","watchId","GpsFactory","connectGps","sensorLabels","sensorIcons","parseBluetoothError","sensorType","sensorLabel","errorMessage","errorName","createErrorContent","errorInfo","messageEl","troubleshootingEl","titleEl","listEl","suggestion","itemEl","showConnectionError","onRetry","sensorIcon","buttons","showReconnectionFailed","tipsEl","tip","emojis","getSensorLabel","initConnectionButtons","connectFns","updateButtonText","connectElem","emoji","disconnectFn","displayElem","handleStatusChange","connectFn","connection","disconnect","onStatusChange","DB_NAME","DB_VERSION","STORE_NAME","COMPLETED_STORE","db","openDatabase","request","database","saveActiveWorkout","record","loadActiveWorkout","clearActiveWorkout","hasRecoverableWorkout","workout","hasData","isRecent","saveTimeout","pendingSave","throttledSave","flushPendingSave","isIndexedDBSupported","VALIDATION_LIMITS","calculateDistance","lat1","lon1","lat2","lon2","1","2","","","MeasurementsState","enablePersistence","min","lastPoint","dist","currentTotalDistance","clearPersisted","getInitState","handleWakeLock","wakeLock","requestWakeLock","registerSW","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","Workbox","r","registerServiceWorker","updateSW","showUpdateNotification","registration","updateContainer","deferredPrompt","initInstallPrompt","showInstallButton","hideInstallButton","installContainer","outcome","initAboutModal","aboutButton","aboutModal","closeAboutModal","exposeVariablesDuringTest","API_BASE_URL","API_KEY","getHeaders","extraHeaders","createStream","streamName","listStreams","addMessage","author","createFetchSSE","onMessage","onConnected","onError","controller","isActive","decoder","done","messages","dataMatch","parseError","listenToStream","listenToAllStreams","sendWorkoutData","workoutData","StreamManager","customStreamName","lastIndex","year","month","day","StreamViewer","toggleViewBtn","grid","list","refreshBtn","viewAllBtn","streamsList","streams","stream","streamItem","div","streamTitle","statusEl","allStreamsStatus","messageData","card","powerEl","cadenceEl","hrEl","row","messageStr","lastUpdateEl","heartrateEl","speedEl","distanceEl","altitudeEl","elapsedEl","streamLastUpdate","initStreamViewer","viewer","viewStreamsBtn","initStreamingControls","streamManager","startStreamButton","nameInput","toolbar","toolbarStreamName","playPauseBtn","stopBtn","streamIndicator","updateToolbar","startStreaming","customName","stopStreaming","handleWorkoutPause","isDatabaseAvailable","listWorkouts","page","limit","userId","getWorkout","workoutId","includeTelemetry","deleteWorkout","formatDuration","formatDate","date","currentPage","totalPages","dbAvailable","initWorkoutHistory","historyButton","prevBtn","nextBtn","checkDatabaseAvailability","loadWorkouts","listContainer","pageInfo","workouts","pagination","renderWorkoutCard","viewWorkoutDetails","confirmDeleteWorkout","statusClass","detailPanel","listPanel","renderWorkoutDetail","exportWorkoutData","jsonData","jsonUrl","jsonLink","DARK_MODE_KEY","getStoredThemePreference","saveThemePreference","preference","systemPrefersDark","applyTheme","theme","getEffectiveTheme","initDarkMode","effectiveTheme","systemDark","setupDarkModeToggle","toggleElement","isDark","newTheme","newPreference","defaultProfile","saveUserProfile","onboardingSteps","createOnboardingModal","renderProgressDots","currentStep","totalSteps","dot","renderStep","step","stepIndex","inputContainer","inputField","inputLabel","inputUnit","helpText","progressDots","showOnboarding","forceShow","skipBtn","saveCurrentInput","render","goNext","goPrev","skip","shouldShowOnboarding","initOnboarding","formatElapsedTime","formatTime","createRecoveryModal","elapsedTime","addRecoveryStyles","style","showRecoveryModal","restoreBtn","discardBtn","cleanup","initWorkoutRecovery","darkModeToggle","recovered"],"ignoreList":[25,26,27,28,29,30,31],"sources":["../../src/components/base/BaseComponent.ts","../../src/components/MetricDisplay.ts","../../src/components/PowerGauge.ts","../../src/components/ZoneGauge.ts","../../src/components/LiveChart.ts","../../src/components/WorkoutTimer.ts","../../src/components/Toast.ts","../../src/components/Modal.ts","../../src/getTimestring.ts","../../src/ui/accessibility.ts","../../src/ui/time.ts","../../src/merge-measurements.ts","../../src/create-csv.ts","../../src/create-tcx.ts","../../src/create-fit.ts","../../src/ui/modal.ts","../../src/ui/undoNotification.ts","../../src/ui/notifications.ts","../../src/ui/settings.ts","../../src/services/VoiceFeedback.ts","../../src/ui/lap.ts","../../src/ui/menu.ts","../../src/elements.ts","../../src/ZoneState.ts","../../src/initMetricsDisplay.ts","../../node_modules/@capacitor/core/dist/index.js","../../node_modules/@capacitor-community/bluetooth-le/dist/esm/definitions.js","../../node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js","../../node_modules/@capacitor-community/bluetooth-le/dist/esm/plugin.js","../../node_modules/@capacitor-community/bluetooth-le/dist/esm/queue.js","../../node_modules/@capacitor-community/bluetooth-le/dist/esm/validators.js","../../node_modules/@capacitor-community/bluetooth-le/dist/esm/bleClient.js","../../src/services/bluetooth/native-bluetooth.ts","../../src/services/bluetooth/web-bluetooth.ts","../../src/services/bluetooth/factory.ts","../../src/connect-cadence.ts","../../src/connect-heartrate.ts","../../src/connect-power.ts","../../src/services/gps/native-gps.ts","../../src/services/gps/web-gps.ts","../../src/services/gps/factory.ts","../../src/connect-gps.ts","../../src/ui/connectionError.ts","../../src/initConnectionButtons.ts","../../src/storage/workoutStorage.ts","../../src/MeasurementsState.ts","../../src/getInitState.ts","../../src/ui/wakeLock.ts","../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/ui/serviceWorker.ts","../../src/ui/installPrompt.ts","../../src/ui/about.ts","../../src/exposeVariablesDuringTest.ts","../../src/api/streamClient.ts","../../src/streamManager.ts","../../src/ui/streamViewer.ts","../../src/initStreamingControls.ts","../../src/api/workoutClient.ts","../../src/ui/workoutHistory.ts","../../src/ui/darkMode.ts","../../src/ui/onboarding.ts","../../src/ui/workoutRecovery.ts","../../src/main.ts"],"sourcesContent":["/**\n * Base Component\n * \n * Abstract base class for all Web Components in the application.\n * Provides common functionality like shadow DOM, theming, and lifecycle hooks.\n * \n * @module BaseComponent\n */\n\n/**\n * Base class for all custom elements\n */\nexport abstract class BaseComponent extends HTMLElement {\n    protected shadow: ShadowRoot;\n    private _initialized = false;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    /**\n     * Called when the element is added to the DOM\n     */\n    connectedCallback(): void {\n        if (!this._initialized) {\n            this.render();\n            this.setupEventListeners();\n            this._initialized = true;\n        }\n        this.onConnected();\n    }\n\n    /**\n     * Called when the element is removed from the DOM\n     */\n    disconnectedCallback(): void {\n        this.onDisconnected();\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue !== newValue && this._initialized) {\n            this.onAttributeChanged(name, oldValue, newValue);\n        }\n    }\n\n    /**\n     * Get base styles that apply to all components\n     */\n    protected getBaseStyles(): string {\n        return `\n            :host {\n                display: block;\n                box-sizing: border-box;\n            }\n            \n            :host([hidden]) {\n                display: none;\n            }\n            \n            *,\n            *::before,\n            *::after {\n                box-sizing: inherit;\n            }\n            \n            /* Respect reduced motion preferences */\n            @media (prefers-reduced-motion: reduce) {\n                *,\n                *::before,\n                *::after {\n                    animation-duration: 0.01ms !important;\n                    animation-iteration-count: 1 !important;\n                    transition-duration: 0.01ms !important;\n                }\n            }\n        `;\n    }\n\n    /**\n     * Get the component's styles - override in subclasses\n     */\n    protected abstract getStyles(): string;\n\n    /**\n     * Get the component's template - override in subclasses\n     */\n    protected abstract getTemplate(): string;\n\n    /**\n     * Render the component\n     */\n    protected render(): void {\n        this.shadow.innerHTML = `\n            <style>\n                ${this.getBaseStyles()}\n                ${this.getStyles()}\n            </style>\n            ${this.getTemplate()}\n        `;\n    }\n\n    /**\n     * Set up event listeners - override in subclasses\n     */\n    protected setupEventListeners(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called after the component is connected to the DOM\n     */\n    protected onConnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when the component is disconnected from the DOM\n     */\n    protected onDisconnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Emit a custom event\n     */\n    protected emit<T>(eventName: string, detail?: T): void {\n        this.dispatchEvent(new CustomEvent(eventName, {\n            detail,\n            bubbles: true,\n            composed: true, // Allows event to cross shadow DOM boundary\n        }));\n    }\n\n    /**\n     * Query an element in the shadow DOM\n     */\n    protected query<T extends Element>(selector: string): T | null {\n        return this.shadow.querySelector<T>(selector);\n    }\n\n    /**\n     * Query all elements in the shadow DOM\n     */\n    protected queryAll<T extends Element>(selector: string): NodeListOf<T> {\n        return this.shadow.querySelectorAll<T>(selector);\n    }\n}\n","/**\n * Metric Display Component\n * \n * A Web Component for displaying a single workout metric (power, heart rate, cadence).\n * Supports theming, zones, and real-time updates.\n * \n * @example\n * ```html\n * <bpt-metric-display\n *   label=\"Power\"\n *   value=\"250\"\n *   unit=\"W\"\n *   icon=\"\"\n *   zone=\"4\"\n *   zone-name=\"Threshold\">\n * </bpt-metric-display>\n * ```\n * \n * @module MetricDisplay\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Zone color mapping for power/HR zones\n */\nconst ZONE_COLORS: Record<string, { bg: string; text: string; border: string }> = {\n    '1': { bg: 'rgba(74, 144, 226, 0.15)', text: '#2563eb', border: '#3b82f6' },\n    '2': { bg: 'rgba(34, 197, 94, 0.15)', text: '#16a34a', border: '#22c55e' },\n    '3': { bg: 'rgba(234, 179, 8, 0.15)', text: '#ca8a04', border: '#eab308' },\n    '4': { bg: 'rgba(249, 115, 22, 0.15)', text: '#ea580c', border: '#f97316' },\n    '5': { bg: 'rgba(239, 68, 68, 0.15)', text: '#dc2626', border: '#ef4444' },\n    '6': { bg: 'rgba(168, 85, 247, 0.15)', text: '#9333ea', border: '#a855f7' },\n    '7': { bg: 'rgba(236, 72, 153, 0.15)', text: '#db2777', border: '#ec4899' },\n};\n\n/**\n * Metric Display Web Component\n */\nexport class MetricDisplay extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['label', 'value', 'unit', 'icon', 'zone', 'zone-name', 'connected', 'show-avg'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: 8px;\n                transition: background-color 0.3s ease, border-color 0.3s ease;\n                border-radius: 8px;\n                min-width: 100px;\n            }\n            \n            :host([zone]) {\n                border-left: 4px solid var(--zone-border-color, transparent);\n            }\n            \n            .label {\n                font-size: clamp(12px, 3cqh, 16px);\n                color: var(--color-text-secondary, #656d76);\n                margin-bottom: 4px;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            \n            .icon {\n                font-size: 1.1em;\n            }\n            \n            .value-container {\n                display: flex;\n                align-items: baseline;\n                gap: 4px;\n            }\n            \n            .value {\n                font-size: clamp(32px, 16cqh, 72px);\n                font-weight: bold;\n                color: var(--zone-text-color, var(--color-text-primary, #1f2328));\n                line-height: 1;\n                transition: color 0.3s ease;\n            }\n            \n            .value.disconnected {\n                color: var(--color-text-muted, #8b949e);\n            }\n            \n            .unit {\n                font-size: clamp(12px, 4cqh, 18px);\n                color: var(--color-text-secondary, #656d76);\n            }\n            \n            .avg-indicator {\n                font-size: clamp(8px, 2cqh, 12px);\n                color: var(--color-text-muted, #8b949e);\n                vertical-align: super;\n            }\n            \n            .zone-badge {\n                font-size: clamp(10px, 2.5cqh, 14px);\n                padding: 2px 8px;\n                border-radius: 12px;\n                margin-top: 4px;\n                background-color: var(--zone-bg-color, transparent);\n                color: var(--zone-text-color, var(--color-text-secondary, #656d76));\n                font-weight: 500;\n                opacity: 0;\n                transform: translateY(-4px);\n                transition: opacity 0.2s ease, transform 0.2s ease;\n            }\n            \n            :host([zone]) .zone-badge {\n                opacity: 1;\n                transform: translateY(0);\n            }\n            \n            /* High contrast mode support */\n            :host-context([data-high-contrast=\"true\"]) .value {\n                text-decoration: underline;\n                text-decoration-style: dotted;\n                text-underline-offset: 4px;\n            }\n            \n            :host-context([data-high-contrast=\"true\"]) {\n                border-width: 3px;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const label = this.getAttribute('label') || '';\n        const value = this.getAttribute('value') || '--';\n        const unit = this.getAttribute('unit') || '';\n        const icon = this.getAttribute('icon') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const showAvg = this.hasAttribute('show-avg');\n        const connected = this.getAttribute('connected') !== 'false';\n\n        return `\n            <div class=\"label\">\n                ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                <span>${label}</span>\n            </div>\n            <div class=\"value-container\">\n                <span class=\"value ${!connected ? 'disconnected' : ''}\" \n                      aria-live=\"polite\" \n                      aria-label=\"${label}: ${value} ${unit}\">\n                    ${value}${showAvg ? '<span class=\"avg-indicator\">(3s)</span>' : ''}\n                </span>\n                ${unit ? `<span class=\"unit\">${unit}</span>` : ''}\n            </div>\n            <div class=\"zone-badge\" aria-live=\"polite\">\n                ${zoneName ? `Zone: ${zoneName}` : ''}\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'zone') {\n            this.updateZoneStyles(newValue);\n        }\n        // Re-render on any attribute change\n        this.render();\n    }\n\n    /**\n     * Update zone-specific styles\n     */\n    private updateZoneStyles(zone: string | null): void {\n        if (zone && ZONE_COLORS[zone]) {\n            const colors = ZONE_COLORS[zone];\n            this.style.setProperty('--zone-bg-color', colors.bg);\n            this.style.setProperty('--zone-text-color', colors.text);\n            this.style.setProperty('--zone-border-color', colors.border);\n            this.style.backgroundColor = colors.bg;\n        } else {\n            this.style.removeProperty('--zone-bg-color');\n            this.style.removeProperty('--zone-text-color');\n            this.style.removeProperty('--zone-border-color');\n            this.style.backgroundColor = '';\n        }\n    }\n\n    /**\n     * Update the displayed value\n     */\n    public setValue(value: number | string): void {\n        this.setAttribute('value', String(value));\n    }\n\n    /**\n     * Update the zone\n     */\n    public setZone(zone: number | null, zoneName?: string): void {\n        if (zone !== null) {\n            this.setAttribute('zone', String(zone));\n            if (zoneName) {\n                this.setAttribute('zone-name', zoneName);\n            }\n        } else {\n            this.removeAttribute('zone');\n            this.removeAttribute('zone-name');\n        }\n    }\n\n    /**\n     * Set connected state\n     */\n    public setConnected(connected: boolean): void {\n        this.setAttribute('connected', String(connected));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-metric-display', MetricDisplay);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-metric-display': MetricDisplay;\n    }\n}\n","/**\n * Power Gauge Component\n * \n * A circular gauge Web Component for displaying power output with zone visualization.\n * Shows current power, target zone, and provides visual feedback.\n * \n * @example\n * ```html\n * <bpt-power-gauge\n *   value=\"250\"\n *   ftp=\"280\"\n *   max=\"500\"\n *   show-zones=\"true\">\n * </bpt-power-gauge>\n * ```\n * \n * @module PowerGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Power zone definitions (Coggan 7-zone model)\n */\nconst POWER_ZONES = [\n    { name: 'Recovery', min: 0, max: 0.55, color: '#4a90d9' },\n    { name: 'Endurance', min: 0.55, max: 0.75, color: '#22c55e' },\n    { name: 'Tempo', min: 0.75, max: 0.90, color: '#eab308' },\n    { name: 'Threshold', min: 0.90, max: 1.05, color: '#f97316' },\n    { name: 'VO2max', min: 1.05, max: 1.20, color: '#ef4444' },\n    { name: 'Anaerobic', min: 1.20, max: 1.50, color: '#a855f7' },\n    { name: 'Neuromuscular', min: 1.50, max: 2.0, color: '#ec4899' },\n];\n\n/**\n * Power Gauge Web Component\n */\nexport class PowerGauge extends BaseComponent {\n    private animationFrame: number | null = null;\n    private currentDisplayValue = 0;\n\n    static get observedAttributes(): string[] {\n        return ['value', 'ftp', 'max', 'show-zones', 'size'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                --gauge-size: 200px;\n            }\n            \n            .gauge-container {\n                position: relative;\n                width: var(--gauge-size);\n                height: var(--gauge-size);\n            }\n            \n            .gauge-svg {\n                width: 100%;\n                height: 100%;\n                transform: rotate(-135deg);\n            }\n            \n            .gauge-background {\n                fill: none;\n                stroke: var(--color-bg-tertiary, #f0f0f0);\n                stroke-width: 12;\n                stroke-linecap: round;\n            }\n            \n            .gauge-zone {\n                fill: none;\n                stroke-width: 12;\n                stroke-linecap: round;\n                opacity: 0.3;\n                transition: opacity 0.3s ease;\n            }\n            \n            .gauge-zone.active {\n                opacity: 1;\n            }\n            \n            .gauge-value-arc {\n                fill: none;\n                stroke: var(--gauge-color, #2196F3);\n                stroke-width: 14;\n                stroke-linecap: round;\n                transition: stroke 0.3s ease;\n            }\n            \n            .gauge-center {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                text-align: center;\n            }\n            \n            .gauge-value {\n                font-size: calc(var(--gauge-size) * 0.2);\n                font-weight: bold;\n                color: var(--gauge-color, var(--color-text-primary, #1f2328));\n                line-height: 1;\n                transition: color 0.3s ease;\n            }\n            \n            .gauge-unit {\n                font-size: calc(var(--gauge-size) * 0.08);\n                color: var(--color-text-secondary, #656d76);\n            }\n            \n            .gauge-zone-label {\n                font-size: calc(var(--gauge-size) * 0.07);\n                color: var(--gauge-color, var(--color-text-secondary, #656d76));\n                margin-top: 4px;\n                font-weight: 500;\n                transition: color 0.3s ease;\n            }\n            \n            .gauge-ftp {\n                font-size: calc(var(--gauge-size) * 0.06);\n                color: var(--color-text-muted, #8b949e);\n                margin-top: 2px;\n            }\n            \n            /* Animation */\n            @keyframes pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.7; }\n            }\n            \n            .gauge-value-arc.high-power {\n                animation: pulse 0.5s ease-in-out infinite;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const size = parseInt(this.getAttribute('size') || '200', 10);\n        this.style.setProperty('--gauge-size', `${size}px`);\n\n        const value = parseInt(this.getAttribute('value') || '0', 10);\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n        const showZones = this.getAttribute('show-zones') !== 'false';\n\n        const radius = 80;\n        const circumference = 2 * Math.PI * radius;\n        const arcLength = circumference * 0.75; // 270 degrees\n\n        // Calculate the current zone and color\n        const ftpPercent = ftp > 0 ? value / ftp : 0;\n        const zone = this.getZone(ftpPercent);\n        const zoneColor = zone ? zone.color : '#2196F3';\n\n        // Calculate arc progress\n        const progress = Math.min(value / max, 1);\n        const dashOffset = arcLength * (1 - progress);\n\n        return `\n            <div class=\"gauge-container\">\n                <svg class=\"gauge-svg\" viewBox=\"0 0 200 200\">\n                    <!-- Background arc -->\n                    <circle \n                        class=\"gauge-background\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                    />\n                    \n                    ${showZones ? this.renderZoneArcs(radius, arcLength, circumference, ftpPercent) : ''}\n                    \n                    <!-- Value arc -->\n                    <circle \n                        class=\"gauge-value-arc ${ftpPercent > 1.2 ? 'high-power' : ''}\"\n                        cx=\"100\" cy=\"100\" r=\"${radius}\"\n                        stroke-dasharray=\"${arcLength} ${circumference}\"\n                        stroke-dashoffset=\"${dashOffset}\"\n                        style=\"stroke: ${zoneColor}\"\n                    />\n                </svg>\n                \n                <div class=\"gauge-center\">\n                    <div class=\"gauge-value\" style=\"color: ${zoneColor}\">${value}</div>\n                    <div class=\"gauge-unit\">watts</div>\n                    ${zone ? `<div class=\"gauge-zone-label\" style=\"color: ${zoneColor}\">${zone.name}</div>` : ''}\n                    ${ftp > 0 ? `<div class=\"gauge-ftp\">FTP: ${ftp}W</div>` : ''}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Render zone arcs on the gauge\n     */\n    private renderZoneArcs(radius: number, arcLength: number, circumference: number, currentFtpPercent: number): string {\n        const ftp = parseInt(this.getAttribute('ftp') || '200', 10);\n        const max = parseInt(this.getAttribute('max') || '500', 10);\n\n        if (ftp <= 0) return '';\n\n        return POWER_ZONES.map((zone, index) => {\n            const startPercent = (zone.min * ftp) / max;\n            const endPercent = Math.min((zone.max * ftp) / max, 1);\n            const zoneArcLength = (endPercent - startPercent) * arcLength;\n            const offset = arcLength * (1 - endPercent);\n\n            const isActive = currentFtpPercent >= zone.min && currentFtpPercent < zone.max;\n\n            return `\n                <circle \n                    class=\"gauge-zone ${isActive ? 'active' : ''}\"\n                    cx=\"100\" cy=\"100\" r=\"${radius}\"\n                    stroke=\"${zone.color}\"\n                    stroke-dasharray=\"${zoneArcLength} ${circumference}\"\n                    stroke-dashoffset=\"${offset}\"\n                    data-zone=\"${index + 1}\"\n                />\n            `;\n        }).join('');\n    }\n\n    /**\n     * Get the current zone based on FTP percentage\n     */\n    private getZone(ftpPercent: number): typeof POWER_ZONES[0] | null {\n        for (const zone of POWER_ZONES) {\n            if (ftpPercent >= zone.min && ftpPercent < zone.max) {\n                return zone;\n            }\n        }\n        // Above all zones\n        if (ftpPercent >= POWER_ZONES[POWER_ZONES.length - 1].max) {\n            return POWER_ZONES[POWER_ZONES.length - 1];\n        }\n        return null;\n    }\n\n    protected onAttributeChanged(): void {\n        this.render();\n    }\n\n    protected onDisconnected(): void {\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n    }\n\n    /**\n     * Animate value change\n     */\n    public animateToValue(targetValue: number, duration = 300): void {\n        const startValue = this.currentDisplayValue;\n        const startTime = performance.now();\n\n        const animate = (currentTime: number) => {\n            const elapsed = currentTime - startTime;\n            const progress = Math.min(elapsed / duration, 1);\n\n            // Ease out cubic\n            const eased = 1 - Math.pow(1 - progress, 3);\n            const currentValue = Math.round(startValue + (targetValue - startValue) * eased);\n\n            this.currentDisplayValue = currentValue;\n            this.setAttribute('value', String(currentValue));\n\n            if (progress < 1) {\n                this.animationFrame = requestAnimationFrame(animate);\n            }\n        };\n\n        if (this.animationFrame) {\n            cancelAnimationFrame(this.animationFrame);\n        }\n        this.animationFrame = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Set the current power value\n     */\n    public setValue(value: number, animate = false): void {\n        if (animate) {\n            this.animateToValue(value);\n        } else {\n            this.currentDisplayValue = value;\n            this.setAttribute('value', String(value));\n        }\n    }\n\n    /**\n     * Set FTP for zone calculations\n     */\n    public setFTP(ftp: number): void {\n        this.setAttribute('ftp', String(ftp));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-power-gauge', PowerGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-power-gauge': PowerGauge;\n    }\n}\n","/**\n * Zone Gauge Component\n * \n * A Web Component for displaying a zone progress bar/gauge.\n * Shows position within current zone with color coding.\n * \n * @example\n * ```html\n * <bpt-zone-gauge\n *   zone=\"4\"\n *   zone-name=\"Threshold\"\n *   percent=\"65\"\n *   type=\"power\">\n * </bpt-zone-gauge>\n * ```\n * \n * @module ZoneGauge\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Zone color mapping (matches MetricDisplay)\n */\nconst ZONE_COLORS: Record<string, { bg: string; fill: string; text: string }> = {\n    '1': { bg: 'rgba(74, 144, 226, 0.15)', fill: '#3b82f6', text: '#2563eb' },\n    '2': { bg: 'rgba(34, 197, 94, 0.15)', fill: '#22c55e', text: '#16a34a' },\n    '3': { bg: 'rgba(234, 179, 8, 0.15)', fill: '#eab308', text: '#ca8a04' },\n    '4': { bg: 'rgba(249, 115, 22, 0.15)', fill: '#f97316', text: '#ea580c' },\n    '5': { bg: 'rgba(239, 68, 68, 0.15)', fill: '#ef4444', text: '#dc2626' },\n    '6': { bg: 'rgba(168, 85, 247, 0.15)', fill: '#a855f7', text: '#9333ea' },\n    '7': { bg: 'rgba(236, 72, 153, 0.15)', fill: '#ec4899', text: '#db2777' },\n};\n\n/**\n * Zone Gauge Web Component\n */\nexport class ZoneGauge extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['zone', 'zone-name', 'percent', 'type', 'compact'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                padding: 8px;\n                border-radius: 8px;\n                background: var(--zone-bg-color, var(--color-bg-secondary, #f6f8fa));\n                transition: background-color 0.3s ease;\n                min-width: 80px;\n            }\n\n            :host([compact]) {\n                padding: 4px 8px;\n                min-width: 60px;\n            }\n\n            .zone-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n            }\n\n            .zone-number {\n                font-size: 12px;\n                font-weight: 700;\n                color: var(--zone-text-color, var(--color-text-primary, #1f2328));\n                background: var(--zone-fill-color, #d0d7de);\n                padding: 2px 8px;\n                border-radius: 10px;\n                white-space: nowrap;\n            }\n\n            :host([compact]) .zone-number {\n                font-size: 10px;\n                padding: 1px 6px;\n            }\n\n            .zone-name {\n                font-size: 11px;\n                color: var(--zone-text-color, var(--color-text-secondary, #656d76));\n                font-weight: 500;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n\n            :host([compact]) .zone-name {\n                display: none;\n            }\n\n            .gauge-container {\n                height: 8px;\n                background: var(--color-bg-tertiary, #e1e4e8);\n                border-radius: 4px;\n                overflow: hidden;\n                position: relative;\n            }\n\n            :host([compact]) .gauge-container {\n                height: 6px;\n            }\n\n            .gauge-fill {\n                height: 100%;\n                background: var(--zone-fill-color, #3b82f6);\n                border-radius: 4px;\n                transition: width 0.3s ease, background-color 0.3s ease;\n                min-width: 4px;\n            }\n\n            .gauge-markers {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                display: flex;\n                justify-content: space-between;\n                padding: 0 2px;\n                pointer-events: none;\n            }\n\n            .gauge-marker {\n                width: 1px;\n                height: 100%;\n                background: rgba(255, 255, 255, 0.3);\n            }\n\n            /* High contrast mode */\n            :host-context([data-high-contrast=\"true\"]) .gauge-fill {\n                background-image: repeating-linear-gradient(\n                    45deg,\n                    transparent,\n                    transparent 2px,\n                    rgba(255,255,255,0.2) 2px,\n                    rgba(255,255,255,0.2) 4px\n                );\n            }\n\n            /* Hidden state */\n            :host([hidden]) {\n                display: none;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const zone = this.getAttribute('zone') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const percent = parseFloat(this.getAttribute('percent') || '0');\n\n        return `\n            <div class=\"zone-header\">\n                <span class=\"zone-number\" aria-label=\"Zone ${zone}\">Z${zone}</span>\n                <span class=\"zone-name\">${zoneName}</span>\n            </div>\n            <div class=\"gauge-container\" role=\"progressbar\" aria-valuenow=\"${percent}\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-label=\"${zoneName} zone progress\">\n                <div class=\"gauge-fill\" style=\"width: ${Math.max(4, percent)}%\"></div>\n                <div class=\"gauge-markers\">\n                    <span class=\"gauge-marker\"></span>\n                    <span class=\"gauge-marker\"></span>\n                    <span class=\"gauge-marker\"></span>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'zone') {\n            this.updateZoneStyles(newValue);\n        }\n        if (name === 'percent') {\n            this.updateGaugeFill(parseFloat(newValue || '0'));\n        }\n        // Re-render on zone or zone-name change\n        if (name === 'zone' || name === 'zone-name') {\n            this.render();\n        }\n    }\n\n    /**\n     * Update zone-specific styles\n     */\n    private updateZoneStyles(zone: string | null): void {\n        if (zone && ZONE_COLORS[zone]) {\n            const colors = ZONE_COLORS[zone];\n            this.style.setProperty('--zone-bg-color', colors.bg);\n            this.style.setProperty('--zone-fill-color', colors.fill);\n            this.style.setProperty('--zone-text-color', colors.text);\n        } else {\n            this.style.removeProperty('--zone-bg-color');\n            this.style.removeProperty('--zone-fill-color');\n            this.style.removeProperty('--zone-text-color');\n        }\n    }\n\n    /**\n     * Update gauge fill without full re-render\n     */\n    private updateGaugeFill(percent: number): void {\n        const fill = this.shadow.querySelector('.gauge-fill') as HTMLElement;\n        const container = this.shadow.querySelector('.gauge-container') as HTMLElement;\n        if (fill) {\n            fill.style.width = `${Math.max(4, percent)}%`;\n        }\n        if (container) {\n            container.setAttribute('aria-valuenow', String(percent));\n        }\n    }\n\n    /**\n     * Set zone information\n     */\n    public setZone(zone: number, name: string, percent: number): void {\n        this.setAttribute('zone', String(zone));\n        this.setAttribute('zone-name', name);\n        this.setAttribute('percent', String(Math.round(percent)));\n        this.updateZoneStyles(String(zone));\n    }\n\n    /**\n     * Clear/hide the gauge\n     */\n    public clear(): void {\n        this.removeAttribute('zone');\n        this.removeAttribute('zone-name');\n        this.setAttribute('percent', '0');\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-zone-gauge', ZoneGauge);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-zone-gauge': ZoneGauge;\n    }\n}\n","/**\n * Live Chart Component\n *\n * A Web Component for displaying real-time rolling charts of workout metrics.\n * Uses SVG for rendering and requestAnimationFrame for smooth 60fps updates.\n * Optimized for mobile performance with minimal DOM operations.\n *\n * @example\n * ```html\n * <bpt-live-chart\n *   type=\"power\"\n *   duration=\"60\"\n *   max-value=\"400\">\n * </bpt-live-chart>\n * ```\n *\n * @module LiveChart\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Data point for the chart\n */\ninterface DataPoint {\n    timestamp: number;\n    value: number;\n}\n\n/**\n * Chart configuration by type\n */\nconst CHART_CONFIG: Record<\n    string,\n    { color: string; gradientStart: string; gradientEnd: string; label: string; unit: string; defaultMax: number }\n> = {\n    power: {\n        color: '#f97316',\n        gradientStart: 'rgba(249, 115, 22, 0.4)',\n        gradientEnd: 'rgba(249, 115, 22, 0.05)',\n        label: 'Power',\n        unit: 'W',\n        defaultMax: 400,\n    },\n    heartrate: {\n        color: '#ef4444',\n        gradientStart: 'rgba(239, 68, 68, 0.4)',\n        gradientEnd: 'rgba(239, 68, 68, 0.05)',\n        label: 'Heart Rate',\n        unit: 'bpm',\n        defaultMax: 200,\n    },\n};\n\n/**\n * Live Chart Web Component\n */\nexport class LiveChart extends BaseComponent {\n    private _data: DataPoint[] = [];\n    private _animationId: number | null = null;\n    private _lastRenderTime = 0;\n    private _isVisible = true;\n    private _duration = 60; // seconds\n    private _maxValue: number;\n    private _type: string;\n    private _svgPath: SVGPathElement | null = null;\n    private _svgArea: SVGPathElement | null = null;\n    private _currentValueEl: HTMLElement | null = null;\n    private _avgValueEl: HTMLElement | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['type', 'duration', 'max-value', 'hidden'];\n    }\n\n    constructor() {\n        super();\n        this._type = 'power';\n        this._maxValue = CHART_CONFIG.power.defaultMax;\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                background: var(--color-bg-secondary, #f6f8fa);\n                border-radius: 8px;\n                overflow: hidden;\n                contain: layout style paint;\n            }\n\n            :host([hidden]) {\n                display: none;\n            }\n\n            .chart-container {\n                position: relative;\n                width: 100%;\n                height: 120px;\n                padding: 8px;\n            }\n\n            .chart-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 0 4px 4px 4px;\n                font-size: 11px;\n                color: var(--color-text-secondary, #656d76);\n            }\n\n            .chart-label {\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .chart-values {\n                display: flex;\n                gap: 12px;\n            }\n\n            .chart-value {\n                display: flex;\n                align-items: baseline;\n                gap: 2px;\n            }\n\n            .chart-value-number {\n                font-size: 14px;\n                font-weight: 700;\n                color: var(--chart-color, #f97316);\n            }\n\n            .chart-value-label {\n                font-size: 10px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            .chart-svg-container {\n                position: relative;\n                width: 100%;\n                height: 80px;\n            }\n\n            svg {\n                width: 100%;\n                height: 100%;\n                display: block;\n            }\n\n            .chart-line {\n                fill: none;\n                stroke: var(--chart-color, #f97316);\n                stroke-width: 2;\n                stroke-linecap: round;\n                stroke-linejoin: round;\n                vector-effect: non-scaling-stroke;\n            }\n\n            .chart-area {\n                fill: url(#chartGradient);\n                opacity: 0.8;\n            }\n\n            .chart-grid-line {\n                stroke: var(--color-border, #d0d7de);\n                stroke-width: 1;\n                stroke-dasharray: 4 4;\n                opacity: 0.5;\n            }\n\n            .chart-axis-label {\n                font-size: 9px;\n                fill: var(--color-text-muted, #8b949e);\n            }\n\n            .no-data-message {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 12px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .chart-line,\n                .chart-area {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n\n        return `\n            <div class=\"chart-container\">\n                <div class=\"chart-header\">\n                    <span class=\"chart-label\">\n                        <span>${config.label}</span>\n                        <span style=\"font-weight: normal; font-size: 10px;\">(${this._duration}s)</span>\n                    </span>\n                    <div class=\"chart-values\">\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"currentValue\">--</span>\n                            <span class=\"chart-value-label\">${config.unit}</span>\n                        </div>\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"avgValue\" style=\"opacity: 0.7;\">--</span>\n                            <span class=\"chart-value-label\">avg</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chart-svg-container\">\n                    <svg viewBox=\"0 0 300 80\" preserveAspectRatio=\"none\" aria-hidden=\"true\">\n                        <defs>\n                            <linearGradient id=\"chartGradient-${this._type}\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" stop-color=\"${config.gradientStart}\" />\n                                <stop offset=\"100%\" stop-color=\"${config.gradientEnd}\" />\n                            </linearGradient>\n                        </defs>\n                        <!-- Grid lines -->\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"20\" x2=\"300\" y2=\"20\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"40\" x2=\"300\" y2=\"40\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"60\" x2=\"300\" y2=\"60\" />\n                        <!-- Axis labels -->\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"18\">${this._maxValue}</text>\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"78\">0</text>\n                        <!-- Chart paths -->\n                        <path class=\"chart-area\" id=\"chartArea\" d=\"M0,80 L300,80\" style=\"fill: url(#chartGradient-${this._type});\" />\n                        <path class=\"chart-line\" id=\"chartLine\" d=\"\" style=\"stroke: ${config.color};\" />\n                    </svg>\n                    <div class=\"no-data-message\" id=\"noDataMessage\">Waiting for data...</div>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onConnected(): void {\n        // Cache DOM references\n        this._svgPath = this.shadow.getElementById('chartLine') as SVGPathElement | null;\n        this._svgArea = this.shadow.getElementById('chartArea') as SVGPathElement | null;\n        this._currentValueEl = this.shadow.getElementById('currentValue');\n        this._avgValueEl = this.shadow.getElementById('avgValue');\n\n        // Set CSS variable for chart color\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n        this.style.setProperty('--chart-color', config.color);\n\n        // Start animation loop\n        this.startAnimation();\n\n        // Listen for visibility changes to save battery\n        document.addEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onDisconnected(): void {\n        this.stopAnimation();\n        document.removeEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        switch (name) {\n            case 'type':\n                this._type = newValue || 'power';\n                this._maxValue = CHART_CONFIG[this._type]?.defaultMax || 400;\n                this.render();\n                this.onConnected(); // Re-cache DOM refs\n                break;\n            case 'duration':\n                this._duration = parseInt(newValue || '60', 10);\n                this.render();\n                break;\n            case 'max-value':\n                this._maxValue = parseInt(newValue || '400', 10);\n                this.render();\n                break;\n            case 'hidden':\n                this._isVisible = newValue === null;\n                if (this._isVisible) {\n                    this.startAnimation();\n                } else {\n                    this.stopAnimation();\n                }\n                break;\n        }\n    }\n\n    private handleVisibilityChange = (): void => {\n        if (document.hidden) {\n            this.stopAnimation();\n        } else if (this._isVisible) {\n            this.startAnimation();\n        }\n    };\n\n    /**\n     * Add a data point to the chart\n     */\n    public addDataPoint(value: number, timestamp: number = Date.now()): void {\n        this._data.push({ timestamp, value });\n\n        // Remove old data points (keep duration + 5s buffer)\n        const cutoffTime = timestamp - (this._duration + 5) * 1000;\n        while (this._data.length > 0 && this._data[0].timestamp < cutoffTime) {\n            this._data.shift();\n        }\n\n        // Auto-adjust max value if needed\n        if (value > this._maxValue * 0.9) {\n            this._maxValue = Math.ceil(value * 1.2 / 50) * 50; // Round to nearest 50\n        }\n    }\n\n    /**\n     * Clear all data points\n     */\n    public clear(): void {\n        this._data = [];\n        this.renderChart();\n    }\n\n    /**\n     * Start the animation loop\n     */\n    private startAnimation(): void {\n        if (this._animationId !== null) return;\n\n        const animate = (time: number): void => {\n            // Throttle to ~30fps for better performance\n            if (time - this._lastRenderTime >= 33) {\n                this.renderChart();\n                this._lastRenderTime = time;\n            }\n            this._animationId = requestAnimationFrame(animate);\n        };\n\n        this._animationId = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Stop the animation loop\n     */\n    private stopAnimation(): void {\n        if (this._animationId !== null) {\n            cancelAnimationFrame(this._animationId);\n            this._animationId = null;\n        }\n    }\n\n    /**\n     * Render the chart paths\n     */\n    private renderChart(): void {\n        if (!this._svgPath || !this._svgArea) return;\n\n        const now = Date.now();\n        const startTime = now - this._duration * 1000;\n\n        // Filter data to visible range\n        const visibleData = this._data.filter((d) => d.timestamp >= startTime);\n\n        // Update no-data message\n        const noDataMsg = this.shadow.getElementById('noDataMessage');\n        if (noDataMsg) {\n            noDataMsg.style.display = visibleData.length === 0 ? 'block' : 'none';\n        }\n\n        if (visibleData.length === 0) {\n            this._svgPath.setAttribute('d', '');\n            this._svgArea.setAttribute('d', 'M0,80 L300,80');\n            return;\n        }\n\n        // Calculate path\n        const width = 300;\n        const height = 80;\n        const points: string[] = [];\n        const areaPoints: string[] = [];\n\n        visibleData.forEach((point) => {\n            const x = ((point.timestamp - startTime) / (this._duration * 1000)) * width;\n            const y = height - (Math.min(point.value, this._maxValue) / this._maxValue) * height;\n            points.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n            areaPoints.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n        });\n\n        // Build path strings\n        if (points.length > 0) {\n            const linePath = 'M' + points.join(' L');\n            this._svgPath.setAttribute('d', linePath);\n\n            // Area path: line + close to bottom\n            const firstX = ((visibleData[0].timestamp - startTime) / (this._duration * 1000)) * width;\n            const lastX =\n                ((visibleData[visibleData.length - 1].timestamp - startTime) / (this._duration * 1000)) * width;\n            const areaPath = `M${firstX.toFixed(1)},${height} L` + areaPoints.join(' L') + ` L${lastX.toFixed(1)},${height} Z`;\n            this._svgArea.setAttribute('d', areaPath);\n        }\n\n        // Update current and average values\n        if (this._currentValueEl && visibleData.length > 0) {\n            const currentValue = visibleData[visibleData.length - 1].value;\n            this._currentValueEl.textContent = Math.round(currentValue).toString();\n        }\n\n        if (this._avgValueEl && visibleData.length > 0) {\n            const avg = visibleData.reduce((sum, p) => sum + p.value, 0) / visibleData.length;\n            this._avgValueEl.textContent = Math.round(avg).toString();\n        }\n    }\n\n    /**\n     * Get current data for debugging/testing\n     */\n    public getData(): DataPoint[] {\n        return [...this._data];\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-live-chart', LiveChart);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-live-chart': LiveChart;\n    }\n}\n","/**\n * Workout Timer Component\n * \n * A Web Component for displaying workout elapsed time.\n * Supports different states: idle, recording, paused.\n * \n * @example\n * ```html\n * <bpt-workout-timer\n *   elapsed=\"3661\"\n *   state=\"recording\">\n * </bpt-workout-timer>\n * ```\n * \n * @module WorkoutTimer\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Workout state enum\n */\nexport type WorkoutTimerState = 'idle' | 'recording' | 'paused';\n\n/**\n * Workout Timer Web Component\n */\nexport class WorkoutTimer extends BaseComponent {\n    private intervalId: number | null = null;\n    private startTimestamp = 0;\n    private pausedElapsed = 0;\n\n    static get observedAttributes(): string[] {\n        return ['elapsed', 'state', 'show-milliseconds'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;\n            }\n            \n            .timer {\n                font-size: clamp(20px, 5vw, 32px);\n                font-weight: 600;\n                color: var(--color-text-primary, #1f2328);\n                letter-spacing: 0.5px;\n                transition: color 0.3s ease;\n            }\n            \n            :host([state=\"recording\"]) .timer {\n                color: var(--color-success, #15803d);\n            }\n            \n            :host([state=\"paused\"]) .timer {\n                color: var(--color-warning, #a16207);\n                animation: blink 1s ease-in-out infinite;\n            }\n            \n            :host([state=\"idle\"]) .timer {\n                color: var(--color-text-muted, #8b949e);\n            }\n            \n            .milliseconds {\n                font-size: 0.5em;\n                opacity: 0.7;\n            }\n            \n            @keyframes blink {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.5; }\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host([state=\"paused\"]) .timer {\n                    animation: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const elapsed = parseInt(this.getAttribute('elapsed') || '0', 10);\n        const showMs = this.hasAttribute('show-milliseconds');\n        const timeString = this.formatTime(elapsed, showMs);\n\n        return `\n            <time class=\"timer\" datetime=\"PT${elapsed}S\" aria-live=\"off\">\n                ${timeString}\n            </time>\n        `;\n    }\n\n    /**\n     * Format elapsed seconds to HH:MM:SS or HH:MM:SS.ms\n     */\n    private formatTime(totalSeconds: number, showMs = false): string {\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = Math.floor(totalSeconds % 60);\n\n        const pad = (n: number) => n.toString().padStart(2, '0');\n        let result = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;\n\n        if (showMs) {\n            const ms = Math.floor((totalSeconds % 1) * 100);\n            result += `<span class=\"milliseconds\">.${pad(ms)}</span>`;\n        }\n\n        return result;\n    }\n\n    protected onAttributeChanged(name: string): void {\n        if (name === 'state') {\n            this.handleStateChange();\n        }\n        this.render();\n    }\n\n    /**\n     * Handle state changes\n     */\n    private handleStateChange(): void {\n        const state = this.getAttribute('state') as WorkoutTimerState;\n\n        if (state === 'recording' && !this.intervalId) {\n            this.startTicking();\n        } else if (state !== 'recording' && this.intervalId) {\n            this.stopTicking();\n        }\n    }\n\n    /**\n     * Start the internal tick\n     */\n    private startTicking(): void {\n        this.startTimestamp = Date.now() - (this.pausedElapsed * 1000);\n        this.intervalId = window.setInterval(() => {\n            const elapsed = (Date.now() - this.startTimestamp) / 1000;\n            this.setAttribute('elapsed', String(elapsed));\n        }, 100);\n    }\n\n    /**\n     * Stop the internal tick\n     */\n    private stopTicking(): void {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n        this.pausedElapsed = parseFloat(this.getAttribute('elapsed') || '0');\n    }\n\n    protected onDisconnected(): void {\n        this.stopTicking();\n    }\n\n    /**\n     * Start the timer\n     */\n    public start(): void {\n        this.setAttribute('state', 'recording');\n        this.emit('timer-start');\n    }\n\n    /**\n     * Pause the timer\n     */\n    public pause(): void {\n        this.setAttribute('state', 'paused');\n        this.emit('timer-pause');\n    }\n\n    /**\n     * Resume the timer\n     */\n    public resume(): void {\n        this.setAttribute('state', 'recording');\n        this.emit('timer-resume');\n    }\n\n    /**\n     * Stop and reset the timer\n     */\n    public stop(): void {\n        this.setAttribute('state', 'idle');\n        this.pausedElapsed = 0;\n        this.emit('timer-stop', { elapsed: parseFloat(this.getAttribute('elapsed') || '0') });\n    }\n\n    /**\n     * Reset the timer to zero\n     */\n    public reset(): void {\n        this.pausedElapsed = 0;\n        this.startTimestamp = Date.now();\n        this.setAttribute('elapsed', '0');\n        this.emit('timer-reset');\n    }\n\n    /**\n     * Get the current elapsed time in seconds\n     */\n    public getElapsed(): number {\n        return parseFloat(this.getAttribute('elapsed') || '0');\n    }\n\n    /**\n     * Get the current state\n     */\n    public getState(): WorkoutTimerState {\n        return (this.getAttribute('state') as WorkoutTimerState) || 'idle';\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-workout-timer', WorkoutTimer);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-workout-timer': WorkoutTimer;\n    }\n}\n","/**\n * Notification Toast Component\n * \n * A Web Component for displaying toast-style notifications.\n * Accessible, auto-dismissing, and supports different notification types.\n * \n * @example\n * ```html\n * <bpt-toast\n *   message=\"Workout saved!\"\n *   type=\"success\"\n *   duration=\"3000\">\n * </bpt-toast>\n * ```\n * \n * Or programmatically:\n * ```typescript\n * Toast.show('Workout saved!', 'success');\n * ```\n * \n * @module Toast\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Notification type determines styling\n */\nexport type ToastType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Toast configuration options\n */\nexport interface ToastOptions {\n    message: string;\n    type?: ToastType;\n    duration?: number;\n    dismissible?: boolean;\n}\n\n/**\n * Type-specific colors (WCAG AA compliant)\n */\nconst TYPE_STYLES: Record<ToastType, { bg: string; icon: string }> = {\n    info: { bg: '#1d4ed8', icon: '' },\n    success: { bg: '#15803d', icon: '' },\n    error: { bg: '#b91c1c', icon: '' },\n    warning: { bg: '#a16207', icon: '' },\n};\n\n/**\n * Toast Notification Web Component\n */\nexport class Toast extends BaseComponent {\n    private timeoutId: number | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['message', 'type', 'duration', 'dismissible'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 80px;\n                left: 50%;\n                transform: translateX(-50%) translateY(-20px);\n                z-index: 10001;\n                opacity: 0;\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                pointer-events: none;\n            }\n            \n            :host(.visible) {\n                transform: translateX(-50%) translateY(0);\n                opacity: 1;\n                pointer-events: auto;\n            }\n            \n            :host(.hiding) {\n                transform: translateX(-50%) translateY(-20px);\n                opacity: 0;\n            }\n            \n            .toast {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 12px 20px;\n                border-radius: 8px;\n                background-color: var(--toast-bg, #1d4ed8);\n                color: white;\n                font-size: 14px;\n                font-weight: 500;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                max-width: 90vw;\n            }\n            \n            .icon {\n                font-size: 18px;\n                flex-shrink: 0;\n            }\n            \n            .message {\n                flex: 1;\n            }\n            \n            .dismiss-btn {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 18px;\n                cursor: pointer;\n                padding: 0 4px;\n                opacity: 0.8;\n                transition: opacity 0.2s ease;\n                flex-shrink: 0;\n            }\n            \n            .dismiss-btn:hover {\n                opacity: 1;\n            }\n            \n            .dismiss-btn:focus-visible {\n                outline: 2px solid white;\n                outline-offset: 2px;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const message = this.getAttribute('message') || '';\n        const type = (this.getAttribute('type') || 'info') as ToastType;\n        const dismissible = this.getAttribute('dismissible') !== 'false';\n        const styles = TYPE_STYLES[type] || TYPE_STYLES.info;\n\n        this.style.setProperty('--toast-bg', styles.bg);\n\n        return `\n            <div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n                <span class=\"icon\" aria-hidden=\"true\">${styles.icon}</span>\n                <span class=\"message\">${message}</span>\n                ${dismissible ? `\n                    <button class=\"dismiss-btn\" aria-label=\"Dismiss notification\">&times;</button>\n                ` : ''}\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        const dismissBtn = this.query('.dismiss-btn');\n        if (dismissBtn) {\n            dismissBtn.addEventListener('click', () => this.dismiss());\n        }\n    }\n\n    protected onConnected(): void {\n        // Trigger show animation\n        requestAnimationFrame(() => {\n            requestAnimationFrame(() => {\n                this.classList.add('visible');\n            });\n        });\n\n        // Auto-dismiss after duration\n        const duration = parseInt(this.getAttribute('duration') || '3000', 10);\n        if (duration > 0) {\n            this.timeoutId = window.setTimeout(() => this.dismiss(), duration);\n        }\n    }\n\n    protected onDisconnected(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n    }\n\n    /**\n     * Dismiss the toast\n     */\n    public dismiss(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n\n        this.classList.remove('visible');\n        this.classList.add('hiding');\n\n        // Remove after animation\n        setTimeout(() => {\n            this.remove();\n        }, 300);\n    }\n\n    /**\n     * Static method to show a toast notification\n     */\n    static show(message: string, type: ToastType = 'info', options: Partial<ToastOptions> = {}): Toast {\n        const toast = document.createElement('bpt-toast') as Toast;\n        toast.setAttribute('message', message);\n        toast.setAttribute('type', type);\n\n        if (options.duration !== undefined) {\n            toast.setAttribute('duration', String(options.duration));\n        }\n        if (options.dismissible !== undefined) {\n            toast.setAttribute('dismissible', String(options.dismissible));\n        }\n\n        document.body.appendChild(toast);\n        return toast;\n    }\n\n    /**\n     * Convenience methods for different types\n     */\n    static info(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'info', options);\n    }\n\n    static success(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'success', options);\n    }\n\n    static error(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'error', options);\n    }\n\n    static warning(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'warning', options);\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-toast', Toast);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-toast': Toast;\n    }\n}\n","/**\n * Modal Dialog Component\n * \n * A Web Component for displaying modal dialogs.\n * Fully accessible with keyboard navigation, focus trapping, and screen reader support.\n * \n * @example\n * ```html\n * <bpt-modal title=\"Confirm\" icon=\"\" open>\n *   <p>Are you sure you want to delete this workout?</p>\n *   <div slot=\"footer\">\n *     <button data-action=\"cancel\">Cancel</button>\n *     <button data-action=\"confirm\">Delete</button>\n *   </div>\n * </bpt-modal>\n * ```\n * \n * Or programmatically:\n * ```typescript\n * const result = await Modal.confirm({\n *   title: 'Delete Workout',\n *   message: 'Are you sure?',\n *   confirmText: 'Delete',\n *   variant: 'danger'\n * });\n * ```\n * \n * @module Modal\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Button variant determines styling\n */\nexport type ButtonVariant = 'primary' | 'secondary' | 'danger';\n\n/**\n * Modal configuration for programmatic usage\n */\nexport interface ModalConfig {\n    title: string;\n    message: string | HTMLElement;\n    icon?: string;\n    confirmText?: string;\n    cancelText?: string;\n    variant?: ButtonVariant;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Modal Dialog Web Component\n */\nexport class Modal extends BaseComponent {\n    private previousActiveElement: HTMLElement | null = null;\n    private focusTrapHandler: ((e: KeyboardEvent) => void) | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['title', 'icon', 'open', 'close-on-overlay'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 1000;\n                display: none;\n                align-items: center;\n                justify-content: center;\n            }\n            \n            :host([open]) {\n                display: flex;\n            }\n            \n            .overlay {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-color: rgba(0, 0, 0, 0.5);\n                opacity: 0;\n                transition: opacity 0.2s ease;\n            }\n            \n            :host([open]) .overlay {\n                opacity: 1;\n            }\n            \n            .modal {\n                position: relative;\n                background: var(--modal-bg, white);\n                border-radius: 12px;\n                max-width: 90%;\n                max-height: 85vh;\n                min-width: 300px;\n                display: flex;\n                flex-direction: column;\n                box-shadow: 0 8px 24px var(--color-shadow, rgba(0, 0, 0, 0.15));\n                transform: scale(0.95) translateY(20px);\n                opacity: 0;\n                transition: transform 0.2s ease, opacity 0.2s ease;\n            }\n            \n            :host([open]) .modal {\n                transform: scale(1) translateY(0);\n                opacity: 1;\n            }\n            \n            .header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 20px 24px;\n                border-bottom: 1px solid var(--color-border, #d0d7de);\n            }\n            \n            .title {\n                font-size: 20px;\n                font-weight: 600;\n                color: var(--color-text-primary, #1f2328);\n                margin: 0;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            \n            .icon {\n                font-size: 24px;\n            }\n            \n            .close-btn {\n                background: none;\n                border: none;\n                font-size: 24px;\n                color: var(--color-text-secondary, #656d76);\n                cursor: pointer;\n                padding: 4px;\n                border-radius: 4px;\n                transition: background-color 0.15s ease;\n                line-height: 1;\n            }\n            \n            .close-btn:hover {\n                background-color: var(--color-bg-hover, rgba(0, 0, 0, 0.05));\n            }\n            \n            .close-btn:focus-visible {\n                outline: 2px solid var(--color-accent, #2196F3);\n                outline-offset: 2px;\n            }\n            \n            .body {\n                padding: 20px 24px;\n                overflow-y: auto;\n                flex: 1;\n                color: var(--color-text-primary, #1f2328);\n            }\n            \n            .footer {\n                padding: 16px 24px;\n                border-top: 1px solid var(--color-border, #d0d7de);\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n            }\n            \n            ::slotted([slot=\"footer\"]) {\n                display: flex;\n                gap: 8px;\n            }\n            \n            /* Default button styles for slotted buttons */\n            .btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 14px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: background-color 0.15s ease;\n            }\n            \n            .btn-secondary {\n                background: white;\n                border: 1px solid var(--color-border, #d0d7de);\n                color: var(--color-text-primary, #1f2328);\n            }\n            \n            .btn-secondary:hover {\n                background: var(--color-bg-secondary, #f6f8fa);\n            }\n            \n            .btn-primary {\n                background: var(--color-accent, #2196F3);\n                border: none;\n                color: white;\n            }\n            \n            .btn-primary:hover {\n                background: var(--color-accent-hover, #1976d2);\n            }\n            \n            .btn-danger {\n                background: var(--color-error, #cf222e);\n                border: none;\n                color: white;\n            }\n            \n            .btn-danger:hover {\n                background: #a40e26;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .overlay,\n                .modal {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const title = this.getAttribute('title') || '';\n        const icon = this.getAttribute('icon') || '';\n\n        return `\n            <div class=\"overlay\" part=\"overlay\"></div>\n            <div class=\"modal\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"modal-title\">\n                <div class=\"header\">\n                    <h2 class=\"title\" id=\"modal-title\">\n                        ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                        ${title}\n                    </h2>\n                    <button class=\"close-btn\" aria-label=\"Close dialog\">&times;</button>\n                </div>\n                <div class=\"body\">\n                    <slot></slot>\n                </div>\n                <div class=\"footer\">\n                    <slot name=\"footer\"></slot>\n                </div>\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        // Close button\n        const closeBtn = this.query('.close-btn');\n        closeBtn?.addEventListener('click', () => this.close());\n\n        // Overlay click\n        const overlay = this.query('.overlay');\n        overlay?.addEventListener('click', () => {\n            if (this.getAttribute('close-on-overlay') !== 'false') {\n                this.close();\n            }\n        });\n\n        // Escape key\n        this.addEventListener('keydown', (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                this.close();\n            }\n        });\n\n        // Button actions in footer\n        this.addEventListener('click', (e: Event) => {\n            const target = e.target as HTMLElement;\n            const action = target.dataset?.action;\n            if (action) {\n                this.emit('modal-action', { action });\n                if (action === 'cancel' || action === 'confirm') {\n                    this.close();\n                }\n            }\n        });\n    }\n\n    protected onConnected(): void {\n        if (this.hasAttribute('open')) {\n            this.onOpen();\n        }\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        if (name === 'open') {\n            if (newValue !== null) {\n                this.onOpen();\n            } else {\n                this.onClose();\n            }\n        }\n    }\n\n    /**\n     * Called when modal opens\n     */\n    private onOpen(): void {\n        this.previousActiveElement = document.activeElement as HTMLElement;\n        this.setupFocusTrap();\n\n        // Focus first focusable element\n        requestAnimationFrame(() => {\n            const firstFocusable = this.shadow.querySelector<HTMLElement>(\n                'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n            );\n            firstFocusable?.focus();\n        });\n\n        this.emit('modal-open');\n    }\n\n    /**\n     * Called when modal closes\n     */\n    private onClose(): void {\n        this.removeFocusTrap();\n        this.previousActiveElement?.focus();\n        this.emit('modal-close');\n    }\n\n    /**\n     * Set up focus trap\n     */\n    private setupFocusTrap(): void {\n        this.focusTrapHandler = (e: KeyboardEvent) => {\n            if (e.key !== 'Tab') return;\n\n            const focusableElements = this.shadow.querySelectorAll<HTMLElement>(\n                'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n            );\n            const first = focusableElements[0];\n            const last = focusableElements[focusableElements.length - 1];\n\n            if (e.shiftKey && document.activeElement === first) {\n                e.preventDefault();\n                last?.focus();\n            } else if (!e.shiftKey && document.activeElement === last) {\n                e.preventDefault();\n                first?.focus();\n            }\n        };\n\n        this.addEventListener('keydown', this.focusTrapHandler);\n    }\n\n    /**\n     * Remove focus trap\n     */\n    private removeFocusTrap(): void {\n        if (this.focusTrapHandler) {\n            this.removeEventListener('keydown', this.focusTrapHandler);\n            this.focusTrapHandler = null;\n        }\n    }\n\n    /**\n     * Open the modal\n     */\n    public open(): void {\n        this.setAttribute('open', '');\n    }\n\n    /**\n     * Close the modal\n     */\n    public close(): void {\n        this.removeAttribute('open');\n    }\n\n    /**\n     * Toggle modal visibility\n     */\n    public toggle(): void {\n        if (this.hasAttribute('open')) {\n            this.close();\n        } else {\n            this.open();\n        }\n    }\n\n    /**\n     * Static method to show a confirmation dialog\n     */\n    static confirm(config: ModalConfig): Promise<boolean> {\n        return new Promise((resolve) => {\n            const modal = document.createElement('bpt-modal') as Modal;\n            modal.setAttribute('title', config.title);\n            if (config.icon) {\n                modal.setAttribute('icon', config.icon);\n            }\n\n            // Set content\n            const content = document.createElement('div');\n            if (typeof config.message === 'string') {\n                content.innerHTML = `<p>${config.message}</p>`;\n            } else {\n                content.appendChild(config.message);\n            }\n            modal.appendChild(content);\n\n            // Create footer with buttons\n            const footer = document.createElement('div');\n            footer.setAttribute('slot', 'footer');\n\n            const cancelBtn = document.createElement('button');\n            cancelBtn.className = 'btn btn-secondary';\n            cancelBtn.textContent = config.cancelText || 'Cancel';\n            cancelBtn.dataset.action = 'cancel';\n\n            const confirmBtn = document.createElement('button');\n            confirmBtn.className = `btn btn-${config.variant || 'primary'}`;\n            confirmBtn.textContent = config.confirmText || 'Confirm';\n            confirmBtn.dataset.action = 'confirm';\n\n            footer.appendChild(cancelBtn);\n            footer.appendChild(confirmBtn);\n            modal.appendChild(footer);\n\n            // Handle actions\n            modal.addEventListener('modal-action', ((e: CustomEvent) => {\n                resolve(e.detail.action === 'confirm');\n                modal.remove();\n            }) as EventListener);\n\n            modal.addEventListener('modal-close', () => {\n                resolve(false);\n                modal.remove();\n            });\n\n            document.body.appendChild(modal);\n            modal.open();\n        });\n    }\n\n    /**\n     * Static method to show an alert dialog\n     */\n    static alert(title: string, message: string, icon?: string): Promise<void> {\n        return new Promise((resolve) => {\n            const modal = document.createElement('bpt-modal') as Modal;\n            modal.setAttribute('title', title);\n            if (icon) {\n                modal.setAttribute('icon', icon);\n            }\n\n            const content = document.createElement('p');\n            content.textContent = message;\n            modal.appendChild(content);\n\n            const footer = document.createElement('div');\n            footer.setAttribute('slot', 'footer');\n\n            const okBtn = document.createElement('button');\n            okBtn.className = 'btn btn-primary';\n            okBtn.textContent = 'OK';\n            okBtn.dataset.action = 'confirm';\n            footer.appendChild(okBtn);\n            modal.appendChild(footer);\n\n            modal.addEventListener('modal-close', () => {\n                resolve();\n                modal.remove();\n            });\n\n            document.body.appendChild(modal);\n            modal.open();\n        });\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-modal', Modal);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-modal': Modal;\n    }\n}\n","/**\n * Time formatting utilities\n * \n * @module getTimestring\n */\n\n/**\n * Converts milliseconds to a formatted time string (HH:MM:SS)\n * \n * @param milliseconds - Time duration in milliseconds\n * @returns Formatted time string in HH:MM:SS format\n * \n * @example\n * getTimestring(3661000) // \"01:01:01\"\n * getTimestring(0)       // \"00:00:00\"\n */\nexport const getTimestring = (milliseconds: number): string => {\n    const totalSeconds = Math.floor(milliseconds / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    return (\n        `${hours.toString().padStart(2, '0')}:` +\n        `${minutes.toString().padStart(2, '0')}:` +\n        `${seconds.toString().padStart(2, '0')}`\n    );\n};\n","/**\n * Accessibility utilities and keyboard navigation\n *\n * Implements keyboard shortcuts and screen reader announcements.\n *\n * @module accessibility\n */\n\n/**\n * Announce a message to screen readers\n *\n * Uses an aria-live region to announce status changes.\n *\n * @param message - The message to announce\n * @param priority - 'polite' for non-urgent, 'assertive' for urgent\n */\nexport function announce(\n    message: string,\n    priority: 'polite' | 'assertive' = 'polite'\n): void {\n    const announcer = document.getElementById('srAnnouncements');\n    if (announcer) {\n        announcer.setAttribute('aria-live', priority);\n        announcer.textContent = message;\n\n        // Clear after announcement to allow repeated messages\n        setTimeout(() => {\n            announcer.textContent = '';\n        }, 1000);\n    }\n}\n\n/**\n * Keyboard shortcut definitions\n */\ninterface KeyboardShortcut {\n    key: string;\n    description: string;\n    action: () => void;\n    ctrl?: boolean;\n    shift?: boolean;\n    alt?: boolean;\n}\n\nconst shortcuts: KeyboardShortcut[] = [];\n\n/**\n * Register a keyboard shortcut\n *\n * @param shortcut - The shortcut definition\n */\nexport function registerShortcut(shortcut: KeyboardShortcut): void {\n    shortcuts.push(shortcut);\n}\n\n/**\n * Handle keyboard events for shortcuts\n */\nfunction handleKeydown(event: KeyboardEvent): void {\n    // Don't trigger shortcuts when typing in inputs\n    const target = event.target as HTMLElement;\n    if (\n        target.tagName === 'INPUT' ||\n        target.tagName === 'TEXTAREA' ||\n        target.isContentEditable\n    ) {\n        // Allow Escape in inputs to blur\n        if (event.key === 'Escape') {\n            target.blur();\n        }\n        return;\n    }\n\n    for (const shortcut of shortcuts) {\n        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();\n        const ctrlMatch = shortcut.ctrl ? event.ctrlKey || event.metaKey : !event.ctrlKey && !event.metaKey;\n        const shiftMatch = shortcut.shift ? event.shiftKey : !event.shiftKey;\n        const altMatch = shortcut.alt ? event.altKey : !event.altKey;\n\n        if (keyMatch && ctrlMatch && shiftMatch && altMatch) {\n            event.preventDefault();\n            shortcut.action();\n            return;\n        }\n    }\n}\n\n/**\n * Initialize keyboard navigation\n *\n * Sets up global keyboard shortcuts:\n * - Space: Start/pause/resume recording (context-aware)\n * - Escape: Close modal/menu\n * - M: Toggle menu\n * - S: Open settings\n * - H: Open workout history\n * - L: Mark lap\n * - ?: Show keyboard shortcuts\n */\nexport function initKeyboardNavigation(): void {\n    // Space - Context-aware workout control\n    registerShortcut({\n        key: ' ',\n        description: 'Start/pause/resume workout (context-aware)',\n        action: () => {\n            // Garmin-style: Space toggles between recording and paused\n            const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n            const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n            const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n\n            // Click whichever button is currently visible\n            if (startButton && startButton.style.display !== 'none') {\n                startButton.click();\n            } else if (pauseButton && pauseButton.style.display !== 'none') {\n                pauseButton.click();\n            } else if (resumeButton && resumeButton.style.display !== 'none') {\n                resumeButton.click();\n            }\n        },\n    });\n\n    // Escape - Close modal/menu\n    registerShortcut({\n        key: 'Escape',\n        description: 'Close modal or menu',\n        action: () => {\n            // Close any open modal\n            const modals = document.querySelectorAll<HTMLElement>('.stream-modal[style*=\"display: block\"], .stream-modal:not([style*=\"display: none\"])');\n            for (const modal of modals) {\n                if (modal.style.display !== 'none') {\n                    const closeBtn = modal.querySelector<HTMLButtonElement>('.close-button');\n                    if (closeBtn) {\n                        closeBtn.click();\n                        announce('Dialog closed');\n                        return;\n                    }\n                }\n            }\n\n            // Close menu if open\n            const details = document.querySelector('details[open]') as HTMLDetailsElement | null;\n            if (details) {\n                details.removeAttribute('open');\n                announce('Menu closed');\n            }\n        },\n    });\n\n    // M - Toggle menu\n    registerShortcut({\n        key: 'm',\n        description: 'Toggle menu',\n        action: () => {\n            const details = document.querySelector('header details') as HTMLDetailsElement | null;\n            if (details) {\n                const isOpen = details.hasAttribute('open');\n                if (isOpen) {\n                    details.removeAttribute('open');\n                    announce('Menu closed');\n                } else {\n                    details.setAttribute('open', '');\n                    announce('Menu opened');\n                    // Focus first menu item\n                    const firstButton = details.querySelector<HTMLButtonElement>('#controls button');\n                    if (firstButton) {\n                        firstButton.focus();\n                    }\n                }\n            }\n        },\n    });\n\n    // S - Open settings\n    registerShortcut({\n        key: 's',\n        description: 'Open settings',\n        action: () => {\n            const settingsBtn = document.getElementById('settingsButton');\n            if (settingsBtn) {\n                settingsBtn.click();\n                announce('Settings opened');\n            }\n        },\n    });\n\n    // H - Open workout history\n    registerShortcut({\n        key: 'h',\n        description: 'Open workout history',\n        action: () => {\n            const historyBtn = document.getElementById('workoutHistoryButton');\n            if (historyBtn) {\n                historyBtn.click();\n                announce('Workout history opened');\n            }\n        },\n    });\n\n    // E - Export data\n    registerShortcut({\n        key: 'e',\n        description: 'Export workout data',\n        action: () => {\n            const exportBtn = document.getElementById('exportData');\n            if (exportBtn) {\n                exportBtn.click();\n            }\n        },\n    });\n\n    // L - Mark lap\n    registerShortcut({\n        key: 'l',\n        description: 'Mark lap',\n        action: () => {\n            const lapBtn = document.getElementById('lapButton');\n            if (lapBtn) {\n                lapBtn.click();\n            }\n        },\n    });\n\n    // Add event listener\n    document.addEventListener('keydown', handleKeydown);\n\n    // Update summary element to indicate keyboard accessibility\n    const summary = document.querySelector('header summary');\n    if (summary) {\n        summary.setAttribute('aria-keyshortcuts', 'M');\n    }\n\n    console.log('Keyboard navigation initialized');\n}\n\n/**\n * Trap focus within a modal dialog\n *\n * @param modal - The modal element\n */\nexport function trapFocus(modal: HTMLElement): void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n\n    if (focusableElements.length === 0) return;\n\n    const firstElement = focusableElements[0];\n    const lastElement = focusableElements[focusableElements.length - 1];\n\n    // Focus first element\n    firstElement.focus();\n\n    modal.addEventListener('keydown', (event) => {\n        if (event.key !== 'Tab') return;\n\n        if (event.shiftKey) {\n            // Shift + Tab\n            if (document.activeElement === firstElement) {\n                event.preventDefault();\n                lastElement.focus();\n            }\n        } else {\n            // Tab\n            if (document.activeElement === lastElement) {\n                event.preventDefault();\n                firstElement.focus();\n            }\n        }\n    });\n}\n\n/**\n * Update workout controls accessibility state\n *\n * @param state - The current workout state: 'idle', 'recording', or 'paused'\n */\nexport function updateWorkoutControlsAccessibility(\n    state: 'idle' | 'recording' | 'paused'\n): void {\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    // Update ARIA labels based on state\n    if (startButton) {\n        startButton.setAttribute('aria-label', 'Start workout');\n    }\n    if (pauseButton) {\n        pauseButton.setAttribute('aria-label', 'Pause workout');\n    }\n    if (resumeButton) {\n        resumeButton.setAttribute('aria-label', 'Resume workout');\n    }\n    if (stopButton) {\n        stopButton.setAttribute('aria-label', 'Stop and save workout');\n    }\n\n    // Update workout controls container with current state\n    const controlsContainer = document.getElementById('workoutControls');\n    if (controlsContainer) {\n        controlsContainer.setAttribute('data-workout-state', state);\n    }\n}\n\n/**\n * Update start/stop button accessibility state\n * @deprecated Use updateWorkoutControlsAccessibility instead\n * @param isRunning - Whether the workout is running\n */\nexport function updateStartStopAccessibility(isRunning: boolean): void {\n    // Backward compatibility - map to new function\n    updateWorkoutControlsAccessibility(isRunning ? 'recording' : 'paused');\n}\n\n/**\n * Announce connection status change\n *\n * @param sensorType - The type of sensor\n * @param isConnected - Whether the sensor is connected\n */\nexport function announceConnectionStatus(\n    sensorType: 'power' | 'cadence' | 'heartrate',\n    isConnected: boolean\n): void {\n    const sensorNames = {\n        power: 'Power meter',\n        cadence: 'Cadence sensor',\n        heartrate: 'Heart rate monitor',\n    };\n\n    const message = isConnected\n        ? `${sensorNames[sensorType]} connected`\n        : `${sensorNames[sensorType]} disconnected`;\n\n    announce(message, 'assertive');\n}\n","/**\n * Timer Display Initialization\n *\n * Sets up the workout timer display and Garmin-style workout controls.\n *\n * Workout states:\n * - Idle: Not started, show Start button\n * - Recording: Timer running, show Pause button\n * - Paused: Timer paused, show Resume and Stop buttons\n *\n * @module time\n */\n\nimport { getTimestring } from '../getTimestring.js';\nimport { announce, updateWorkoutControlsAccessibility } from './accessibility.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Workout state enum for clarity\n */\nexport type WorkoutState = 'idle' | 'recording' | 'paused';\n\n/**\n * Get the current workout state from time state\n */\nexport function getWorkoutState(timeState: TimeState): WorkoutState {\n    if (!timeState.startTime) {\n        return 'idle';\n    }\n    if (timeState.running) {\n        return 'recording';\n    }\n    return 'paused';\n}\n\n/**\n * Workout control button elements\n */\ninterface WorkoutControlElements {\n    startButton: HTMLButtonElement;\n    pauseButton: HTMLButtonElement;\n    resumeButton: HTMLButtonElement;\n    stopButton: HTMLButtonElement;\n}\n\n/**\n * Update button visibility based on workout state\n */\nfunction updateButtonVisibility(\n    elements: WorkoutControlElements,\n    state: WorkoutState\n): void {\n    const { startButton, pauseButton, resumeButton, stopButton } = elements;\n\n    // Hide all buttons first\n    startButton.style.display = 'none';\n    pauseButton.style.display = 'none';\n    resumeButton.style.display = 'none';\n    stopButton.style.display = 'none';\n\n    switch (state) {\n        case 'idle':\n            startButton.style.display = 'inline-flex';\n            break;\n        case 'recording':\n            pauseButton.style.display = 'inline-flex';\n            break;\n        case 'paused':\n            resumeButton.style.display = 'inline-flex';\n            stopButton.style.display = 'inline-flex';\n            break;\n    }\n}\n\n/**\n * Initialize the timer display and Garmin-style workout controls.\n *\n * Sets up:\n * - Timer display that updates every 100ms\n * - Start button to begin a new workout\n * - Pause button to pause recording\n * - Resume button to continue a paused workout\n * - Stop button to end and save the workout\n * - Visual state changes for workout status\n *\n * @param timeState - The workout time state object\n */\nexport const initTimerDisplay = (timeState: TimeState): void => {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n    const metricsTable = document.getElementById('metricsTable');\n\n    if (!startButton || !pauseButton || !resumeButton || !stopButton || !timeElement || !metricsTable) {\n        console.warn('Workout control elements not found in DOM');\n        return;\n    }\n\n    const elements: WorkoutControlElements = {\n        startButton,\n        pauseButton,\n        resumeButton,\n        stopButton,\n    };\n\n    // Update timer display every 100ms\n    setInterval(() => {\n        let nextText = '00:00:00';\n        const currentState = getWorkoutState(timeState);\n\n        if (timeState.startTime && timeState.running) {\n            const elapsedMs = Date.now() - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        } else if (timeState.startTime && timeState.endTime) {\n            const elapsedMs = timeState.endTime - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        }\n\n        if (timeElement.textContent !== nextText) {\n            timeElement.textContent = nextText;\n        }\n\n        // Update metrics table styling based on state\n        metricsTable.classList.remove('recording', 'paused');\n        if (currentState === 'recording') {\n            metricsTable.classList.add('recording');\n        } else if (currentState === 'paused') {\n            metricsTable.classList.add('paused');\n        }\n    }, 100);\n\n    // Initialize button visibility\n    updateButtonVisibility(elements, getWorkoutState(timeState));\n\n    // Handle Start button click - begin new workout\n    startButton.addEventListener('click', () => {\n        timeState.startTime = Date.now();\n        timeState.endTime = null;\n        timeState.running = true;\n\n        updateButtonVisibility(elements, 'recording');\n        updateWorkoutControlsAccessibility('recording');\n        announce('Workout started', 'assertive');\n    });\n\n    // Handle Pause button click - pause recording\n    pauseButton.addEventListener('click', () => {\n        timeState.running = false;\n        timeState.endTime = Date.now();\n\n        updateButtonVisibility(elements, 'paused');\n        updateWorkoutControlsAccessibility('paused');\n        announce('Workout paused. Press resume to continue or stop to save.', 'assertive');\n    });\n\n    // Handle Resume button click - continue paused workout\n    resumeButton.addEventListener('click', () => {\n        if (timeState.endTime && timeState.startTime) {\n            // Adjust startTime to account for paused duration\n            const pausedDuration = Date.now() - timeState.endTime;\n            timeState.startTime += pausedDuration;\n        }\n        timeState.endTime = null;\n        timeState.running = true;\n\n        updateButtonVisibility(elements, 'recording');\n        updateWorkoutControlsAccessibility('recording');\n        announce('Workout resumed', 'assertive');\n    });\n\n    // Handle Stop button click - end and save workout\n    stopButton.addEventListener('click', () => {\n        // Keep endTime as is (already set when paused)\n        // Reset to idle state for next workout\n        timeState.running = false;\n\n        updateButtonVisibility(elements, 'paused');\n        updateWorkoutControlsAccessibility('paused');\n        announce('Workout stopped and saved. Press resume to continue or export your data.', 'assertive');\n\n        // Dispatch custom event for workout completion\n        const workoutCompleteEvent = new CustomEvent('workoutComplete', {\n            detail: {\n                startTime: timeState.startTime,\n                endTime: timeState.endTime,\n                duration: timeState.endTime && timeState.startTime\n                    ? timeState.endTime - timeState.startTime\n                    : 0,\n            },\n        });\n        document.dispatchEvent(workoutCompleteEvent);\n    });\n};\n\n/**\n * Reset workout to idle state\n *\n * @param timeState - The workout time state object\n */\nexport function resetWorkout(timeState: TimeState): void {\n    timeState.startTime = null;\n    timeState.endTime = null;\n    timeState.running = false;\n\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton && pauseButton && resumeButton && stopButton) {\n        updateButtonVisibility(\n            { startButton, pauseButton, resumeButton, stopButton },\n            'idle'\n        );\n        updateWorkoutControlsAccessibility('idle');\n    }\n\n    announce('Workout reset', 'polite');\n}\n","/**\n * Measurement merging utilities\n * \n * Combines heart rate, cadence, and power measurements into synchronized data points.\n * \n * @module merge-measurements\n */\n\nimport type { Measurement, MeasurementsData } from './types/measurements.js';\n\n/**\n * A merged data point containing all measurement types at a single timestamp\n */\nexport interface MergedDataPoint {\n    timestamp: number;\n    heartrate: number | null;\n    cadence: number | null;\n    power: number | null;\n    speed: number | null;\n    distance: number | null;\n    altitude: number | null;\n    lat: number | null;\n    lon: number | null;\n}\n\n/**\n * Gets values from a measurement array at specific timestamps.\n * Uses nearest-neighbor interpolation with a 1000ms threshold.\n * \n * @param arr - Array of measurements sorted by timestamp\n * @param timestamps - Array of target timestamps to find values for\n * @returns Array of values (or null if no measurement within threshold)\n */\nexport const getValuesAtTimestamps = (\n    arr: Measurement[],\n    timestamps: number[]\n): (number | null)[] => {\n    const entries: (number | null)[] = [];\n    let index = 0;\n\n    for (const ts of timestamps) {\n        // Find the first measurement at or after the target timestamp\n        while (index < arr.length && arr[index].timestamp < ts) {\n            index++;\n        }\n\n        const prevIndex = index - 1;\n        let suggestedElem: Measurement | undefined = undefined;\n        const isAfterLastPoint = index >= arr.length;\n\n        if (prevIndex < 0) {\n            // Before first measurement - use first if available\n            suggestedElem = arr[index];\n        } else if (isAfterLastPoint) {\n            // After last measurement - use last\n            suggestedElem = arr[prevIndex];\n        } else {\n            // Between measurements - use nearest\n            const prevTime = arr[prevIndex]?.timestamp ?? 0;\n            const nextTime = arr[index]?.timestamp ?? 0;\n            suggestedElem = (ts - prevTime) <= (nextTime - ts) ? arr[prevIndex] : arr[index];\n        }\n\n        if (suggestedElem?.timestamp !== undefined) {\n            const distance = Math.abs(suggestedElem.timestamp - ts);\n            // Values must be strictly less than 1000ms away\n            if (distance < 1000) {\n                entries.push(suggestedElem.value);\n            } else {\n                entries.push(null);\n            }\n        } else {\n            entries.push(null);\n        }\n    }\n\n    return entries;\n};\n\n/**\n * Merges heart rate, cadence, and power measurements into synchronized data points.\n * \n * Creates a timeline with 1-second intervals from the earliest to the latest measurement,\n * then maps each measurement type to the nearest value at each timestamp.\n * \n * @param measurements - Object containing heartrate, cadence, and power measurement arrays\n * @returns Array of merged data points with all measurement types\n * \n * @example\n * const merged = mergeMeasurements({\n *   heartrate: [{ timestamp: 1000, value: 120 }],\n *   cadence: [{ timestamp: 1000, value: 80 }],\n *   power: [{ timestamp: 1000, value: 200 }]\n * });\n * // Returns: [{ timestamp: 1000, heartrate: 120, cadence: 80, power: 200 }]\n */\nexport const mergeMeasurements = (measurements: MeasurementsData): MergedDataPoint[] => {\n    // Convert GPS points to measurements for interpolation\n    const latMeasurements: Measurement[] = measurements.gps.map(p => ({ timestamp: p.timestamp, value: p.lat }));\n    const lonMeasurements: Measurement[] = measurements.gps.map(p => ({ timestamp: p.timestamp, value: p.lon }));\n\n    const sources = [\n        measurements.heartrate,\n        measurements.cadence,\n        measurements.power,\n        measurements.speed,\n        measurements.distance,\n        measurements.altitude,\n        latMeasurements\n    ];\n    const hasData = sources.some(data => data.length > 0);\n\n    if (!hasData) {\n        return [];\n    }\n\n    // Find the time range\n    const firstTimestamps = sources.map(data => data.length > 0 ? data[0].timestamp : Infinity);\n    const startTime = Math.min(...firstTimestamps);\n    const endTime = Math.max(\n        ...sources.map(data => data.length > 0 ? data[data.length - 1].timestamp : -Infinity)\n    );\n\n    // Create timestamps at 1-second intervals\n    const timeStep = 1000;\n    const timestamps: number[] = [];\n    let time = startTime;\n\n    while (time <= endTime) {\n        timestamps.push(time);\n        time += timeStep;\n    }\n\n    // Get synchronized values for each measurement type\n    const syncedHR = getValuesAtTimestamps(measurements.heartrate, timestamps);\n    const syncedCadence = getValuesAtTimestamps(measurements.cadence, timestamps);\n    const syncedPower = getValuesAtTimestamps(measurements.power, timestamps);\n    const syncedSpeed = getValuesAtTimestamps(measurements.speed, timestamps);\n    const syncedDistance = getValuesAtTimestamps(measurements.distance, timestamps);\n    const syncedAltitude = getValuesAtTimestamps(measurements.altitude, timestamps);\n    const syncedLat = getValuesAtTimestamps(latMeasurements, timestamps);\n    const syncedLon = getValuesAtTimestamps(lonMeasurements, timestamps);\n\n    // Combine into data points\n    const dataPoints: MergedDataPoint[] = [];\n\n    for (let i = 0; i < timestamps.length; i++) {\n        dataPoints.push({\n            timestamp: timestamps[i],\n            heartrate: syncedHR[i],\n            cadence: syncedCadence[i],\n            power: syncedPower[i],\n            speed: syncedSpeed[i],\n            distance: syncedDistance[i],\n            altitude: syncedAltitude[i],\n            lat: syncedLat[i],\n            lon: syncedLon[i],\n        });\n    }\n\n    return dataPoints;\n};\n","/**\n * CSV export utilities\n * \n * @module create-csv\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\n\n/**\n * Creates a CSV string from workout measurements.\n * \n * Merges all measurement types (heart rate, cadence, power) into synchronized\n * data points and exports them as a CSV file with ISO timestamps.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns CSV formatted string with header row\n * \n * @example\n * const csv = getCsvString(measurementsState);\n * // Returns:\n * // \"timestamp,power,cadence,heartrate\n * //  2024-01-01T00:00:00.000Z,200,80,120\n * //  ...\"\n */\nexport const getCsvString = (measurements: MeasurementsData): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    // CSV header\n    const header = 'timestamp,power,cadence,heartrate,speed,distance,altitude,lat,lon';\n\n    // Convert each data point to CSV row\n    const rows = dataPoints.map((point: MergedDataPoint) => {\n        const timestamp = new Date(point.timestamp).toISOString();\n        const power = point.power !== null ? Math.round(point.power) : '';\n        const cadence = point.cadence !== null ? Math.round(point.cadence) : '';\n        const heartrate = point.heartrate !== null ? Math.round(point.heartrate) : '';\n        const speed = point.speed !== null ? point.speed.toFixed(1) : '';\n        const distance = point.distance !== null ? Math.round(point.distance) : '';\n        const altitude = point.altitude !== null ? Math.round(point.altitude) : '';\n        const lat = point.lat !== null ? point.lat.toFixed(6) : '';\n        const lon = point.lon !== null ? point.lon.toFixed(6) : '';\n\n        return `${timestamp},${power},${cadence},${heartrate},${speed},${distance},${altitude},${lat},${lon}`;\n    });\n\n    return [header, ...rows].join('\\n');\n};\n","/**\n * TCX (Training Center XML) export utilities\n * \n * Creates Garmin-compatible TCX files from workout measurements.\n * \n * @module create-tcx\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\n\n/**\n * Creates heart rate XML element\n */\nconst hrString = (hr: number | null): string =>\n    hr !== null ? `<HeartRateBpm><Value>${Math.round(hr)}</Value></HeartRateBpm>` : '';\n\n/**\n * Creates cadence XML element\n */\nconst cadenceString = (cadence: number | null): string =>\n    cadence !== null ? `<Cadence>${Math.round(cadence)}</Cadence>` : '';\n\n/**\n * Creates power XML element using Garmin extension format\n */\nconst powerString = (power: number | null): string => {\n    if (power === null) return '';\n    return `<Extensions>\n              <TPX xmlns=\"http://www.garmin.com/xmlschemas/ActivityExtension/v2\">\n                <Watts>${Math.round(power)}</Watts>\n              </TPX>\n            </Extensions>`;\n};\n\n/**\n * Creates a TCX trackpoint element from a merged data point\n * \n * @param point - Merged data point with timestamp and measurements\n * @returns TCX Trackpoint XML string\n */\nconst getTcxTrackpoint = (point: MergedDataPoint): string => {\n    const timestamp = new Date(point.timestamp).toISOString();\n\n    // Order matters in TCX schema: Time, Position, Altitude, Distance, HeartRate, Cadence, Extensions\n\n    let position = '';\n    if (point.lat !== null && point.lon !== null) {\n        position = `\n        <Position>\n            <LatitudeDegrees>${point.lat}</LatitudeDegrees>\n            <LongitudeDegrees>${point.lon}</LongitudeDegrees>\n        </Position>`;\n    }\n\n    let altitude = '';\n    if (point.altitude !== null) {\n        altitude = `<AltitudeMeters>${point.altitude}</AltitudeMeters>`;\n    }\n\n    let distance = '';\n    if (point.distance !== null) {\n        distance = `<DistanceMeters>${point.distance}</DistanceMeters>`;\n    }\n\n    const parts: string[] = [];\n\n    if (point.heartrate !== null) {\n        parts.push(hrString(point.heartrate));\n    }\n\n    if (point.cadence !== null) {\n        parts.push(cadenceString(point.cadence));\n    }\n\n    if (point.power !== null) {\n        parts.push(powerString(point.power));\n    }\n\n    return `\n<Trackpoint>\n    <Time>${timestamp}</Time>\n    ${position}\n    ${altitude}\n    ${distance}\n    ${parts.join('\\n')}\n</Trackpoint>\n    `.trim();\n};\n\n/**\n * Creates a Garmin TCX (Training Center XML) string from workout measurements.\n * \n * TCX is a standard format supported by most fitness platforms including\n * Strava, Garmin Connect, and TrainingPeaks.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns TCX formatted XML string\n * \n * @example\n * const tcx = getTcxString(measurementsState);\n * // Returns a valid TCX XML document\n */\nexport const getTcxString = (measurements: MeasurementsData): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const totalTimeSeconds = Math.round((lastTimestamp - firstTimestamp) / 1000);\n    const startDate = new Date(firstTimestamp).toISOString();\n\n    const tcx = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <TrainingCenterDatabase xmlns=\"http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2\">\n        <Activities>\n            <Activity Sport=\"Biking\">\n                <Id>${startDate}</Id>\n                <Lap StartTime=\"${startDate}\">\n                    <TotalTimeSeconds>${totalTimeSeconds}</TotalTimeSeconds>\n                    <Calories>0</Calories>\n                    <Intensity>Active</Intensity>\n                    <TriggerMethod>Manual</TriggerMethod>\n                    <Track>\n${dataPoints.map(getTcxTrackpoint).join('\\n')}\n                    </Track>\n                </Lap>\n            </Activity>\n        </Activities>\n    </TrainingCenterDatabase>`;\n\n    return tcx;\n};\n","/**\n * FIT (Flexible and Interoperable Data Transfer) export utilities\n * \n * Creates Garmin FIT files from workout measurements.\n * FIT is a binary format optimized for storing and sharing fitness data.\n * \n * @module create-fit\n */\n\nimport { mergeMeasurements } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\n\n// FIT Protocol Constants\nconst FIT_PROTOCOL_VERSION = 0x20; // 2.0\nconst FIT_PROFILE_VERSION = 0x0813; // 20.83\n\n// FIT Message Numbers\nconst FIT_MESG_FILE_ID = 0;\nconst FIT_MESG_FILE_CREATOR = 1;\nconst FIT_MESG_ACTIVITY = 34;\nconst FIT_MESG_SESSION = 18;\nconst FIT_MESG_LAP = 19;\nconst FIT_MESG_RECORD = 20;\nconst FIT_MESG_EVENT = 21;\n\n// FIT Base Types (only used types are uncommented)\nconst FIT_BASE_TYPE_ENUM = 0x00;\n// const FIT_BASE_TYPE_SINT8 = 0x01;\nconst FIT_BASE_TYPE_UINT8 = 0x02;\n// const FIT_BASE_TYPE_SINT16 = 0x83;\nconst FIT_BASE_TYPE_UINT16 = 0x84;\n// const FIT_BASE_TYPE_SINT32 = 0x85;\nconst FIT_BASE_TYPE_UINT32 = 0x86;\n// const FIT_BASE_TYPE_STRING = 0x07;\n\n// FIT Field IDs for File ID message\nconst FILE_ID_TYPE = 0;\nconst FILE_ID_MANUFACTURER = 1;\nconst FILE_ID_PRODUCT = 2;\nconst FILE_ID_SERIAL_NUMBER = 3;\nconst FILE_ID_TIME_CREATED = 4;\n\n// FIT Field IDs for Record message\nconst RECORD_TIMESTAMP = 253;\nconst RECORD_HEART_RATE = 3;\nconst RECORD_CADENCE = 4;\nconst RECORD_POWER = 7;\n\n// FIT Field IDs for Session message\nconst SESSION_TIMESTAMP = 253;\nconst SESSION_START_TIME = 2;\nconst SESSION_TOTAL_ELAPSED_TIME = 7;\nconst SESSION_TOTAL_TIMER_TIME = 8;\nconst SESSION_SPORT = 5;\nconst SESSION_SUB_SPORT = 6;\nconst SESSION_EVENT = 0;\nconst SESSION_EVENT_TYPE = 1;\n\n// FIT Field IDs for Lap message\nconst LAP_TIMESTAMP = 253;\nconst LAP_START_TIME = 2;\nconst LAP_TOTAL_ELAPSED_TIME = 7;\nconst LAP_TOTAL_TIMER_TIME = 8;\nconst LAP_EVENT = 0;\nconst LAP_EVENT_TYPE = 1;\n\n// FIT Field IDs for Event message\nconst EVENT_TIMESTAMP = 253;\nconst EVENT_EVENT = 0;\nconst EVENT_EVENT_TYPE = 1;\n\n// FIT Field IDs for Activity message\nconst ACTIVITY_TIMESTAMP = 253;\nconst ACTIVITY_TOTAL_TIMER_TIME = 0;\nconst ACTIVITY_NUM_SESSIONS = 1;\nconst ACTIVITY_TYPE = 2;\nconst ACTIVITY_EVENT = 3;\nconst ACTIVITY_EVENT_TYPE = 4;\nconst ACTIVITY_LOCAL_TIMESTAMP = 5;\n\n// FIT Type values\nconst FILE_TYPE_ACTIVITY = 4;\nconst MANUFACTURER_DEVELOPMENT = 255;\nconst SPORT_CYCLING = 2;\nconst SUB_SPORT_INDOOR_CYCLING = 6;\nconst EVENT_TIMER = 0;\nconst EVENT_SESSION = 8;\nconst EVENT_LAP = 9;\nconst EVENT_ACTIVITY = 26;\nconst EVENT_TYPE_START = 0;\nconst EVENT_TYPE_STOP = 1;\nconst ACTIVITY_TYPE_MANUAL = 0;\n\n// FIT timestamp epoch (1989-12-31 00:00:00 UTC)\nconst FIT_EPOCH_MS = Date.UTC(1989, 11, 31, 0, 0, 0);\n\n/**\n * Calculate CRC-16 (CCITT) for FIT file\n */\nfunction calculateCrc(buffer: Uint8Array, start: number, end: number): number {\n    const crcTable = [\n        0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401,\n        0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400\n    ];\n\n    let crc = 0;\n    for (let i = start; i < end; i++) {\n        const byte = buffer[i];\n        // Low nibble\n        let tmp = crcTable[crc & 0xF];\n        crc = (crc >> 4) & 0x0FFF;\n        crc = crc ^ tmp ^ crcTable[byte & 0xF];\n        // High nibble\n        tmp = crcTable[crc & 0xF];\n        crc = (crc >> 4) & 0x0FFF;\n        crc = crc ^ tmp ^ crcTable[(byte >> 4) & 0xF];\n    }\n    return crc;\n}\n\n/**\n * Convert JavaScript timestamp to FIT timestamp\n */\nfunction toFitTimestamp(jsTimestamp: number): number {\n    return Math.round((jsTimestamp - FIT_EPOCH_MS) / 1000);\n}\n\n/**\n * FIT file builder class\n */\nclass FitBuilder {\n    private buffer: number[] = [];\n    private definedMessages: Map<number, boolean> = new Map();\n\n    /**\n     * Write header (14 bytes)\n     */\n    writeHeader(): void {\n        // Header size (1 byte)\n        this.buffer.push(14);\n        // Protocol version (1 byte)\n        this.buffer.push(FIT_PROTOCOL_VERSION);\n        // Profile version (2 bytes, little-endian)\n        this.buffer.push(FIT_PROFILE_VERSION & 0xFF);\n        this.buffer.push((FIT_PROFILE_VERSION >> 8) & 0xFF);\n        // Data size placeholder (4 bytes) - will be updated later\n        this.buffer.push(0, 0, 0, 0);\n        // Data type \".FIT\" (4 bytes)\n        this.buffer.push(0x2E, 0x46, 0x49, 0x54); // \".FIT\"\n        // CRC (2 bytes) - will be updated later\n        this.buffer.push(0, 0);\n    }\n\n    /**\n     * Write definition message\n     */\n    writeDefinition(localMsgType: number, globalMsgNum: number, fields: { fieldDefNum: number; size: number; baseType: number }[]): void {\n        // Record header: definition message (bit 6 = 1)\n        this.buffer.push(0x40 | (localMsgType & 0x0F));\n        // Reserved byte\n        this.buffer.push(0);\n        // Architecture (0 = little-endian)\n        this.buffer.push(0);\n        // Global message number (2 bytes, little-endian)\n        this.buffer.push(globalMsgNum & 0xFF);\n        this.buffer.push((globalMsgNum >> 8) & 0xFF);\n        // Number of fields\n        this.buffer.push(fields.length);\n        // Field definitions\n        for (const field of fields) {\n            this.buffer.push(field.fieldDefNum);\n            this.buffer.push(field.size);\n            this.buffer.push(field.baseType);\n        }\n        this.definedMessages.set(localMsgType, true);\n    }\n\n    /**\n     * Write data message\n     */\n    writeData(localMsgType: number, values: (number | null)[]): void {\n        // Record header: data message (bit 6 = 0)\n        this.buffer.push(localMsgType & 0x0F);\n        // Field values\n        for (const value of values) {\n            if (typeof value === 'number') {\n                // Handled by caller based on field size\n            }\n        }\n    }\n\n    /**\n     * Write uint8 value\n     */\n    writeUint8(value: number): void {\n        this.buffer.push(value & 0xFF);\n    }\n\n    /**\n     * Write uint16 value (little-endian)\n     */\n    writeUint16(value: number): void {\n        this.buffer.push(value & 0xFF);\n        this.buffer.push((value >> 8) & 0xFF);\n    }\n\n    /**\n     * Write uint32 value (little-endian)\n     */\n    writeUint32(value: number): void {\n        this.buffer.push(value & 0xFF);\n        this.buffer.push((value >> 8) & 0xFF);\n        this.buffer.push((value >> 16) & 0xFF);\n        this.buffer.push((value >> 24) & 0xFF);\n    }\n\n    /**\n     * Write data message header\n     */\n    writeDataHeader(localMsgType: number): void {\n        this.buffer.push(localMsgType & 0x0F);\n    }\n\n    /**\n     * Finalize the FIT file with CRC\n     */\n    finalize(): Uint8Array {\n        const result = new Uint8Array(this.buffer);\n\n        // Update data size in header (bytes 4-7)\n        const dataSize = this.buffer.length - 14; // Exclude header\n        result[4] = dataSize & 0xFF;\n        result[5] = (dataSize >> 8) & 0xFF;\n        result[6] = (dataSize >> 16) & 0xFF;\n        result[7] = (dataSize >> 24) & 0xFF;\n\n        // Calculate header CRC (bytes 12-13)\n        const headerCrc = calculateCrc(result, 0, 12);\n        result[12] = headerCrc & 0xFF;\n        result[13] = (headerCrc >> 8) & 0xFF;\n\n        // Calculate and append data CRC\n        const dataCrc = calculateCrc(result, 0, result.length);\n        const finalBuffer = new Uint8Array(result.length + 2);\n        finalBuffer.set(result);\n        finalBuffer[result.length] = dataCrc & 0xFF;\n        finalBuffer[result.length + 1] = (dataCrc >> 8) & 0xFF;\n\n        return finalBuffer;\n    }\n\n    /**\n     * Get current buffer as array\n     */\n    getBuffer(): number[] {\n        return this.buffer;\n    }\n}\n\n/**\n * Creates a Garmin FIT binary file from workout measurements.\n * \n * FIT (Flexible and Interoperable Data Transfer) is a binary format\n * used by Garmin devices and supported by most fitness platforms.\n * \n * @param measurements - The measurements data object containing workout data\n * @returns FIT binary data as Uint8Array, or null if no data\n * \n * @example\n * const fitData = getFitData(measurementsState);\n * if (fitData) {\n *     const blob = new Blob([fitData], { type: 'application/fit' });\n *     // Download or upload the file\n * }\n */\nexport const getFitData = (measurements: MeasurementsData): Uint8Array | null => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return null;\n    }\n\n    const fit = new FitBuilder();\n    fit.writeHeader();\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const fitStartTime = toFitTimestamp(firstTimestamp);\n    const fitEndTime = toFitTimestamp(lastTimestamp);\n    const totalElapsedTime = (lastTimestamp - firstTimestamp) / 1000; // seconds\n    const totalElapsedTimeMs = Math.round(totalElapsedTime * 1000); // milliseconds for FIT\n\n    // Local message type assignments\n    const LOCAL_FILE_ID = 0;\n    const LOCAL_FILE_CREATOR = 1;\n    const LOCAL_EVENT = 2;\n    const LOCAL_RECORD = 3;\n    const LOCAL_LAP = 4;\n    const LOCAL_SESSION = 5;\n    const LOCAL_ACTIVITY = 6;\n\n    // === File ID Message ===\n    fit.writeDefinition(LOCAL_FILE_ID, FIT_MESG_FILE_ID, [\n        { fieldDefNum: FILE_ID_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: FILE_ID_MANUFACTURER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_PRODUCT, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_SERIAL_NUMBER, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: FILE_ID_TIME_CREATED, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_ID);\n    fit.writeUint8(FILE_TYPE_ACTIVITY);\n    fit.writeUint16(MANUFACTURER_DEVELOPMENT);\n    fit.writeUint16(1); // Product ID\n    fit.writeUint32(12345678); // Serial number\n    fit.writeUint32(fitStartTime);\n\n    // === File Creator Message ===\n    fit.writeDefinition(LOCAL_FILE_CREATOR, FIT_MESG_FILE_CREATOR, [\n        { fieldDefNum: 0, size: 2, baseType: FIT_BASE_TYPE_UINT16 }, // software_version\n        { fieldDefNum: 1, size: 1, baseType: FIT_BASE_TYPE_UINT8 }, // hardware_version\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_CREATOR);\n    fit.writeUint16(100); // Software version\n    fit.writeUint8(1); // Hardware version\n\n    // === Timer Start Event ===\n    fit.writeDefinition(LOCAL_EVENT, FIT_MESG_EVENT, [\n        { fieldDefNum: EVENT_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: EVENT_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: EVENT_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_START);\n\n    // === Record Messages (one per data point) ===\n    fit.writeDefinition(LOCAL_RECORD, FIT_MESG_RECORD, [\n        { fieldDefNum: RECORD_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: RECORD_HEART_RATE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_CADENCE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_POWER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n    ]);\n\n    for (const point of dataPoints) {\n        const fitTimestamp = toFitTimestamp(point.timestamp);\n        fit.writeDataHeader(LOCAL_RECORD);\n        fit.writeUint32(fitTimestamp);\n        // Heart rate (0xFF = invalid)\n        fit.writeUint8(point.heartrate !== null ? Math.min(255, Math.round(point.heartrate)) : 0xFF);\n        // Cadence (0xFF = invalid)\n        fit.writeUint8(point.cadence !== null ? Math.min(255, Math.round(point.cadence)) : 0xFF);\n        // Power (0xFFFF = invalid)\n        fit.writeUint16(point.power !== null ? Math.round(point.power) : 0xFFFF);\n    }\n\n    // === Timer Stop Event ===\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Lap Message ===\n    fit.writeDefinition(LOCAL_LAP, FIT_MESG_LAP, [\n        { fieldDefNum: LAP_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: LAP_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_LAP);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint8(EVENT_LAP);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Session Message ===\n    fit.writeDefinition(LOCAL_SESSION, FIT_MESG_SESSION, [\n        { fieldDefNum: SESSION_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_SUB_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_SESSION);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint8(SPORT_CYCLING);\n    fit.writeUint8(SUB_SPORT_INDOOR_CYCLING);\n    fit.writeUint8(EVENT_SESSION);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Activity Message ===\n    fit.writeDefinition(LOCAL_ACTIVITY, FIT_MESG_ACTIVITY, [\n        { fieldDefNum: ACTIVITY_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_NUM_SESSIONS, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: ACTIVITY_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_LOCAL_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_ACTIVITY);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint16(1); // Number of sessions\n    fit.writeUint8(ACTIVITY_TYPE_MANUAL);\n    fit.writeUint8(EVENT_ACTIVITY);\n    fit.writeUint8(EVENT_TYPE_STOP);\n    fit.writeUint32(fitEndTime); // Local timestamp\n\n    return fit.finalize();\n};\n","/**\n * Modal Component\n *\n * Reusable modal dialog system for confirmations and content display.\n * Fully accessible with keyboard navigation and screen reader support.\n *\n * @module modal\n */\n\nimport { announce } from './accessibility.js';\nimport type { ZoneState, ZoneDistribution } from '../ZoneState.js';\n\n/**\n * Modal button configuration\n */\nexport interface ModalButton {\n    text: string;\n    variant: 'primary' | 'secondary' | 'danger';\n    onClick: () => void;\n}\n\n/**\n * Modal configuration options\n */\nexport interface ModalOptions {\n    title: string;\n    content: string | HTMLElement;\n    buttons: ModalButton[];\n    icon?: string;\n    onClose?: () => void;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Create a modal element\n */\nfunction createModalElement(options: ModalOptions): HTMLElement {\n    const modal = document.createElement('div');\n    modal.className = 'custom-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-modal', 'true');\n    modal.setAttribute('aria-labelledby', 'modal-title');\n\n    const titleText = options.icon ? `${options.icon} ${options.title}` : options.title;\n\n    modal.innerHTML = `\n        <div class=\"custom-modal-overlay\"></div>\n        <div class=\"custom-modal-container\">\n            <div class=\"custom-modal-header\">\n                <h2 id=\"modal-title\">${titleText}</h2>\n                <button class=\"modal-close-btn\" aria-label=\"Close dialog\">&times;</button>\n            </div>\n            <div class=\"custom-modal-body\"></div>\n            <div class=\"custom-modal-footer\"></div>\n        </div>\n    `;\n\n    // Add content\n    const body = modal.querySelector('.custom-modal-body') as HTMLElement;\n    if (typeof options.content === 'string') {\n        body.innerHTML = options.content;\n    } else {\n        body.appendChild(options.content);\n    }\n\n    // Add buttons\n    const footer = modal.querySelector('.custom-modal-footer') as HTMLElement;\n    options.buttons.forEach((btn, index) => {\n        const button = document.createElement('button');\n        button.textContent = btn.text;\n        button.className = `modal-btn modal-btn-${btn.variant}`;\n        button.addEventListener('click', btn.onClick);\n\n        // Auto-focus the first primary button, or first button if no primary\n        if (btn.variant === 'primary' || (index === 0 && !options.buttons.some(b => b.variant === 'primary'))) {\n            button.setAttribute('data-autofocus', 'true');\n        }\n\n        footer.appendChild(button);\n    });\n\n    return modal;\n}\n\n/**\n * Focus trap for modal accessibility\n */\nfunction trapFocus(modal: HTMLElement): () => void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    const handleTabKey = (e: KeyboardEvent) => {\n        if (e.key !== 'Tab') return;\n\n        if (e.shiftKey) {\n            if (document.activeElement === firstFocusable) {\n                e.preventDefault();\n                lastFocusable?.focus();\n            }\n        } else {\n            if (document.activeElement === lastFocusable) {\n                e.preventDefault();\n                firstFocusable?.focus();\n            }\n        }\n    };\n\n    modal.addEventListener('keydown', handleTabKey);\n    return () => modal.removeEventListener('keydown', handleTabKey);\n}\n\n/**\n * Show a modal dialog\n *\n * @param options - Modal configuration\n * @returns A function to close the modal\n */\nexport function showModal(options: ModalOptions): () => void {\n    const modal = createModalElement(options);\n    const previousActiveElement = document.activeElement as HTMLElement;\n\n    document.body.appendChild(modal);\n\n    // Force reflow for animation\n    modal.offsetHeight;\n    modal.classList.add('modal-visible');\n\n    // Set up focus trap\n    const removeFocusTrap = trapFocus(modal);\n\n    // Focus the autofocus element or first focusable\n    const autofocusEl = modal.querySelector<HTMLElement>('[data-autofocus]');\n    setTimeout(() => {\n        autofocusEl?.focus();\n    }, 50);\n\n    // Close function\n    const closeModal = () => {\n        modal.classList.remove('modal-visible');\n\n        // Remove after animation\n        setTimeout(() => {\n            modal.remove();\n            removeFocusTrap();\n\n            // Restore focus\n            previousActiveElement?.focus();\n\n            options.onClose?.();\n        }, 200);\n    };\n\n    // Close button\n    const closeBtn = modal.querySelector('.modal-close-btn');\n    closeBtn?.addEventListener('click', closeModal);\n\n    // Overlay click\n    if (options.closeOnOverlay !== false) {\n        const overlay = modal.querySelector('.custom-modal-overlay');\n        overlay?.addEventListener('click', closeModal);\n    }\n\n    // Escape key\n    const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n            e.preventDefault();\n            closeModal();\n        }\n    };\n    document.addEventListener('keydown', handleEscape);\n\n    // Cleanup escape listener when modal closes\n    const originalOnClose = options.onClose;\n    options.onClose = () => {\n        document.removeEventListener('keydown', handleEscape);\n        originalOnClose?.();\n    };\n\n    announce(`${options.title} dialog opened`, 'polite');\n\n    return closeModal;\n}\n\n/**\n * Show a confirmation dialog\n *\n * @param title - Dialog title\n * @param message - Confirmation message\n * @param options - Additional options\n * @returns Promise resolving to true if confirmed, false if cancelled\n */\nexport function showConfirmation(\n    title: string,\n    message: string,\n    options: {\n        confirmText?: string;\n        cancelText?: string;\n        confirmVariant?: 'primary' | 'danger';\n        icon?: string;\n    } = {}\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const {\n            confirmText = 'Confirm',\n            cancelText = 'Cancel',\n            confirmVariant = 'primary',\n            icon,\n        } = options;\n\n        let closeModal: (() => void) | null = null;\n\n        closeModal = showModal({\n            title,\n            content: `<p class=\"modal-message\">${message}</p>`,\n            icon,\n            buttons: [\n                {\n                    text: cancelText,\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(false);\n                    },\n                },\n                {\n                    text: confirmText,\n                    variant: confirmVariant,\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(true);\n                    },\n                },\n            ],\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Workout summary data\n */\nexport interface WorkoutSummary {\n    duration: number;\n    startTime: number;\n    endTime: number;\n    power: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    heartrate: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    cadence: {\n        avg: number | null;\n        max: number | null;\n        count: number;\n    };\n    powerZoneDistribution?: ZoneDistribution;\n    hrZoneDistribution?: ZoneDistribution;\n}\n\n/**\n * Calculate workout summary statistics\n */\nexport function calculateWorkoutSummary(\n    startTime: number,\n    endTime: number,\n    measurements: {\n        power: { value: number }[];\n        heartrate: { value: number }[];\n        cadence: { value: number }[];\n    },\n    zoneState?: ZoneState\n): WorkoutSummary {\n    const calcStats = (data: { value: number }[]) => {\n        if (data.length === 0) {\n            return { avg: null, max: null, count: 0 };\n        }\n        const values = data.map((d) => d.value);\n        const sum = values.reduce((a, b) => a + b, 0);\n        return {\n            avg: Math.round(sum / values.length),\n            max: Math.max(...values),\n            count: values.length,\n        };\n    };\n\n    const summary: WorkoutSummary = {\n        duration: endTime - startTime,\n        startTime,\n        endTime,\n        power: calcStats(measurements.power),\n        heartrate: calcStats(measurements.heartrate),\n        cadence: calcStats(measurements.cadence),\n    };\n\n    // Add zone distributions if available\n    if (zoneState) {\n        const powerDist = zoneState.getPowerZoneDistribution();\n        const hrDist = zoneState.getHrZoneDistribution();\n\n        if (powerDist.totalTimeMs > 0) {\n            summary.powerZoneDistribution = powerDist;\n        }\n        if (hrDist.totalTimeMs > 0) {\n            summary.hrZoneDistribution = hrDist;\n        }\n    }\n\n    return summary;\n}\n\n/**\n * Format duration in milliseconds to human readable string\n */\nexport function formatDurationLong(ms: number): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    const parts: string[] = [];\n    if (hours > 0) parts.push(`${hours}h`);\n    if (minutes > 0) parts.push(`${minutes}m`);\n    if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);\n\n    return parts.join(' ');\n}\n\n/**\n * Format seconds to MM:SS format\n */\nfunction formatSecondsShort(seconds: number): string {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n}\n\n/**\n * Zone colors for the histogram\n */\nconst ZONE_COLORS: Record<number, string> = {\n    1: '#3b82f6', // Blue - Recovery\n    2: '#22c55e', // Green - Endurance\n    3: '#eab308', // Yellow - Tempo\n    4: '#f97316', // Orange - Threshold\n    5: '#ef4444', // Red - VO2max/Anaerobic\n    6: '#a855f7', // Purple - Anaerobic (power)\n    7: '#ec4899', // Pink - Neuromuscular (power)\n};\n\n/**\n * Create zone distribution histogram chart\n */\nfunction createZoneHistogram(distribution: ZoneDistribution, title: string): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'zone-distribution';\n\n    // Filter zones with time > 0\n    const activeZones = distribution.zones.filter(z => z.timeInZoneMs > 0);\n\n    if (activeZones.length === 0) {\n        return container; // Return empty if no zone data\n    }\n\n    const maxTime = Math.max(...distribution.zones.map(z => z.timeInZoneMs));\n\n    container.innerHTML = `\n        <h4 class=\"zone-distribution-title\">${title}</h4>\n        <div class=\"zone-chart\">\n            ${distribution.zones.map(zone => {\n        const percent = maxTime > 0 ? (zone.timeInZoneMs / maxTime) * 100 : 0;\n        const timeSeconds = Math.round(zone.timeInZoneMs / 1000);\n        const color = ZONE_COLORS[zone.zone] || '#888';\n        const timeStr = formatSecondsShort(timeSeconds);\n\n        return `\n                    <div class=\"zone-bar-row\" title=\"${zone.name}: ${timeStr}\">\n                        <span class=\"zone-bar-label\">Z${zone.zone}</span>\n                        <div class=\"zone-bar-container\">\n                            <div class=\"zone-bar\" style=\"width: ${Math.max(percent, 2)}%; background-color: ${color};\" aria-valuenow=\"${timeSeconds}\" aria-label=\"${zone.name}\"></div>\n                        </div>\n                        <span class=\"zone-bar-time\">${timeStr}</span>\n                    </div>\n                `;\n    }).join('')}\n        </div>\n    `;\n\n    return container;\n}\n\n/**\n * Create workout summary content HTML element\n */\nexport function createSummaryContent(summary: WorkoutSummary): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'workout-summary';\n\n    const formatValue = (value: number | null, unit: string): string => {\n        return value !== null ? `${value}${unit}` : '--';\n    };\n\n    container.innerHTML = `\n        <div class=\"summary-duration\">\n            <span class=\"summary-label\">Duration</span>\n            <span class=\"summary-value\">${formatDurationLong(summary.duration)}</span>\n        </div>\n        <div class=\"summary-grid\">\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Power</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.power.avg, 'W')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.power.max, 'W')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Heart Rate</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.heartrate.avg, ' bpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.heartrate.max, ' bpm')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Cadence</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.cadence.avg, ' rpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.cadence.max, ' rpm')}</span>\n                </div>\n            </div>\n        </div>\n        <div class=\"summary-samples\">\n            <span class=\"summary-samples-text\">\n                ${summary.power.count + summary.heartrate.count + summary.cadence.count} data points recorded\n            </span>\n        </div>\n    `;\n\n    // Add zone distribution charts if available\n    if (summary.powerZoneDistribution && summary.powerZoneDistribution.totalTimeMs > 0) {\n        const powerChart = createZoneHistogram(summary.powerZoneDistribution, ' Power Zone Distribution');\n        container.appendChild(powerChart);\n    }\n\n    if (summary.hrZoneDistribution && summary.hrZoneDistribution.totalTimeMs > 0) {\n        const hrChart = createZoneHistogram(summary.hrZoneDistribution, ' Heart Rate Zone Distribution');\n        container.appendChild(hrChart);\n    }\n\n    return container;\n}\n\n/**\n * Show post-workout summary modal\n *\n * @param summary - Workout summary data\n * @param callbacks - Action callbacks\n * @returns Promise resolving to the chosen action\n */\nexport function showWorkoutSummary(\n    summary: WorkoutSummary,\n    callbacks: {\n        onExport: () => void;\n        onDiscard: () => void;\n        onKeepRecording: () => void;\n    }\n): Promise<'export' | 'discard' | 'keep'> {\n    return new Promise((resolve) => {\n        let closeModal: (() => void) | null = null;\n\n        const content = createSummaryContent(summary);\n\n        closeModal = showModal({\n            title: 'Workout Complete',\n            content,\n            icon: '',\n            closeOnOverlay: false,\n            buttons: [\n                {\n                    text: ' Discard',\n                    variant: 'danger',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onDiscard();\n                        resolve('discard');\n                    },\n                },\n                {\n                    text: ' Keep Recording',\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onKeepRecording();\n                        resolve('keep');\n                    },\n                },\n                {\n                    text: ' Export',\n                    variant: 'primary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onExport();\n                        resolve('export');\n                    },\n                },\n            ],\n            onClose: () => {\n                callbacks.onKeepRecording();\n                resolve('keep');\n            },\n        });\n    });\n}\n","/**\n * Undo Notification Module\n * \n * Displays a toast notification with an undo button that allows users\n * to reverse a destructive action within a time limit.\n * \n * @module undoNotification\n */\n\nimport { announce } from './accessibility.js';\n\n/** Default undo timeout in milliseconds */\nconst DEFAULT_UNDO_TIMEOUT = 5000;\n\n/**\n * Undo notification options\n */\nexport interface UndoNotificationOptions {\n    /** The message to display */\n    message: string;\n    /** Callback when undo is clicked */\n    onUndo: () => void;\n    /** Callback when the timeout expires without undo */\n    onExpire?: () => void;\n    /** Time in ms before the notification disappears (default: 5000) */\n    timeout?: number;\n    /** Icon to display (optional) */\n    icon?: string;\n}\n\n/**\n * Show an undo notification toast\n * \n * Displays a notification with a countdown timer and undo button.\n * The notification auto-dismisses after the timeout, executing onExpire.\n * If the user clicks undo, onUndo is called and the notification closes.\n * \n * @param options - Configuration for the undo notification\n * @returns A function to manually dismiss the notification\n */\nexport function showUndoNotification(options: UndoNotificationOptions): () => void {\n    const {\n        message,\n        onUndo,\n        onExpire,\n        timeout = DEFAULT_UNDO_TIMEOUT,\n        icon = '',\n    } = options;\n\n    // Remove any existing undo notifications\n    const existing = document.querySelector('.undo-notification');\n    existing?.remove();\n\n    // Create notification element\n    const notification = document.createElement('div');\n    notification.className = 'undo-notification';\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    // Calculate countdown in seconds\n    const timeoutSeconds = Math.ceil(timeout / 1000);\n    let remainingSeconds = timeoutSeconds;\n\n    // Create content\n    notification.innerHTML = `\n        <div class=\"undo-notification-content\">\n            <span class=\"undo-notification-icon\" aria-hidden=\"true\">${icon}</span>\n            <span class=\"undo-notification-message\">${message}</span>\n        </div>\n        <div class=\"undo-notification-actions\">\n            <button class=\"undo-notification-btn\" type=\"button\">\n                Undo <span class=\"undo-countdown\">(${remainingSeconds}s)</span>\n            </button>\n        </div>\n        <div class=\"undo-progress-bar\">\n            <div class=\"undo-progress-fill\"></div>\n        </div>\n    `;\n\n    document.body.appendChild(notification);\n\n    // Get elements\n    const undoButton = notification.querySelector('.undo-notification-btn') as HTMLButtonElement;\n    const countdownSpan = notification.querySelector('.undo-countdown') as HTMLSpanElement;\n    const progressFill = notification.querySelector('.undo-progress-fill') as HTMLDivElement;\n\n    // Check reduced motion preference\n    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n    // Set up progress bar animation\n    if (!prefersReducedMotion) {\n        progressFill.style.transition = `width ${timeout}ms linear`;\n        // Force reflow before starting animation\n        progressFill.offsetHeight;\n        progressFill.style.width = '0%';\n    } else {\n        progressFill.style.width = '0%';\n    }\n\n    // Animate in\n    requestAnimationFrame(() => {\n        notification.classList.add('undo-notification-visible');\n    });\n\n    let isUndone = false;\n    let countdownInterval: ReturnType<typeof setInterval> | null = null;\n    let dismissTimeout: ReturnType<typeof setTimeout> | null = null;\n\n    /**\n     * Dismiss the notification with cleanup\n     */\n    const dismiss = (executeExpire = false) => {\n        if (countdownInterval) {\n            clearInterval(countdownInterval);\n            countdownInterval = null;\n        }\n        if (dismissTimeout) {\n            clearTimeout(dismissTimeout);\n            dismissTimeout = null;\n        }\n\n        if (prefersReducedMotion) {\n            notification.remove();\n            if (executeExpire && !isUndone && onExpire) {\n                onExpire();\n            }\n        } else {\n            notification.classList.remove('undo-notification-visible');\n            notification.classList.add('undo-notification-hiding');\n            setTimeout(() => {\n                notification.remove();\n                if (executeExpire && !isUndone && onExpire) {\n                    onExpire();\n                }\n            }, 200);\n        }\n    };\n\n    // Start countdown display\n    countdownInterval = setInterval(() => {\n        remainingSeconds--;\n        if (remainingSeconds > 0) {\n            countdownSpan.textContent = `(${remainingSeconds}s)`;\n        } else {\n            if (countdownInterval) {\n                clearInterval(countdownInterval);\n            }\n        }\n    }, 1000);\n\n    // Set up auto-dismiss\n    dismissTimeout = setTimeout(() => {\n        dismiss(true);\n    }, timeout);\n\n    // Handle undo click\n    undoButton.addEventListener('click', () => {\n        isUndone = true;\n        dismiss(false);\n        onUndo();\n        announce('Action undone', 'assertive');\n    });\n\n    // Focus the undo button for accessibility\n    undoButton.focus();\n\n    // Announce to screen readers\n    announce(`${message} Press undo within ${timeoutSeconds} seconds to restore.`, 'assertive');\n\n    return () => dismiss(false);\n}\n\n/**\n * Data backup for undo functionality\n */\nexport interface WorkoutBackup {\n    power: Array<{ timestamp: number; value: number }>;\n    heartrate: Array<{ timestamp: number; value: number }>;\n    cadence: Array<{ timestamp: number; value: number }>;\n    startTime: number | null;\n    endTime: number | null;\n    running: boolean;\n}\n\n/**\n * Create a backup of workout data for undo\n * \n * @param measurementsState - The measurements state to backup\n * @param timeState - The time state to backup\n * @returns A backup object that can be restored\n */\nexport function createWorkoutBackup(\n    measurementsState: { power: Array<{ timestamp: number; value: number }>; heartrate: Array<{ timestamp: number; value: number }>; cadence: Array<{ timestamp: number; value: number }> },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): WorkoutBackup {\n    return {\n        power: [...measurementsState.power],\n        heartrate: [...measurementsState.heartrate],\n        cadence: [...measurementsState.cadence],\n        startTime: timeState.startTime,\n        endTime: timeState.endTime,\n        running: timeState.running,\n    };\n}\n\n/**\n * Restore workout data from a backup\n * \n * @param backup - The backup to restore\n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n */\nexport function restoreWorkoutBackup(\n    backup: WorkoutBackup,\n    measurementsState: { power: Array<{ timestamp: number; value: number }>; heartrate: Array<{ timestamp: number; value: number }>; cadence: Array<{ timestamp: number; value: number }> },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): void {\n    measurementsState.power = [...backup.power];\n    measurementsState.heartrate = [...backup.heartrate];\n    measurementsState.cadence = [...backup.cadence];\n    timeState.startTime = backup.startTime;\n    timeState.endTime = backup.endTime;\n    timeState.running = backup.running;\n}\n","/**\n * Notification utilities\n * \n * Displays toast-style notifications to the user.\n * Accessible to screen readers via role=\"alert\".\n * \n * Now uses the bpt-toast Web Component when available,\n * with fallback to inline styles for progressive enhancement.\n * \n * @module notifications\n */\n\nimport { Toast } from '../components/Toast.js';\n\n/**\n * Notification types\n */\nexport type NotificationType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Show a notification to the user\n * \n * Creates an accessible toast notification that:\n * - Is announced to screen readers via role=\"alert\"\n * - Has proper color contrast (WCAG AA compliant)\n * - Respects reduced motion preferences\n * \n * @param message - The message to display\n * @param type - The type of notification (affects styling)\n * @param duration - How long to show the notification (ms)\n */\nexport function showNotification(\n    message: string,\n    type: NotificationType = 'info',\n    duration = 3000\n): void {\n    // Use the Web Component if available\n    if (customElements.get('bpt-toast')) {\n        Toast.show(message, type, { duration });\n        return;\n    }\n\n    // Fallback to inline notification (for cases where components aren't loaded)\n    const notification = document.createElement('div');\n\n    // Use WCAG AA compliant colors\n    const backgroundColor = type === 'error' ? '#b91c1c'\n        : type === 'success' ? '#15803d'\n            : type === 'warning' ? '#a16207'\n                : '#1d4ed8';\n\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    notification.style.cssText = `\n    position: fixed;\n    top: 80px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: ${backgroundColor};\n    color: white;\n    padding: 12px 24px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 1001;\n    font-size: 14px;\n    max-width: 90%;\n    text-align: center;\n    font-weight: 500;\n  `;\n\n    notification.textContent = message;\n    document.body.appendChild(notification);\n\n    setTimeout(() => {\n        // Check for reduced motion preference\n        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n        if (prefersReducedMotion) {\n            notification.remove();\n        } else {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 0.3s ease';\n            setTimeout(() => notification.remove(), 300);\n        }\n    }, duration);\n}\n\n","/**\n * Settings Modal\n * \n * Manages application settings stored in localStorage.\n * \n * @module settings\n */\n\n/**\n * Application settings\n */\nexport interface AppSettings {\n    // Dashboard display settings\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    power3s: boolean;\n\n    // Accessibility settings\n    highContrast: boolean;\n    colorblindPatterns: boolean;\n\n    // Voice Feedback settings\n    voiceEnabled: boolean;\n    voiceLaps: boolean;\n    voiceZones: boolean;\n\n    // Export format settings\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n}\n\n/** Storage key for settings */\nconst SETTINGS_KEY = 'bpt-settings';\n\n/** Default settings */\nconst defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    power3s: false,\n    highContrast: false,\n    colorblindPatterns: false,\n    voiceEnabled: false,\n    voiceLaps: true,\n    voiceZones: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n};\n\n/**\n * Get current settings from localStorage\n */\nexport function getSettings(): AppSettings {\n    const settingsJson = localStorage.getItem(SETTINGS_KEY);\n    return settingsJson\n        ? { ...defaultSettings, ...JSON.parse(settingsJson) }\n        : { ...defaultSettings };\n}\n\n/**\n * Initialize the settings modal and controls.\n * \n * Sets up:\n * - Settings button to open modal\n * - Settings checkboxes for metrics visibility\n * - Settings checkboxes for accessibility options\n * - Settings checkboxes for export formats\n * - Save and close functionality\n */\nexport function initSettings(): void {\n    const settingsButton = document.getElementById('settingsButton');\n    const settingsModal = document.getElementById('settingsModal');\n    const closeSettingsModal = document.getElementById('closeSettingsModal');\n    const saveSettingsButton = document.getElementById('saveSettings');\n\n    // Dashboard display settings\n    const settingPower = document.getElementById('settingPower') as HTMLInputElement | null;\n    const settingCadence = document.getElementById('settingCadence') as HTMLInputElement | null;\n    const settingHeartrate = document.getElementById('settingHeartrate') as HTMLInputElement | null;\n    const settingPower3s = document.getElementById('settingPower3s') as HTMLInputElement | null;\n\n    // Accessibility settings\n    const settingHighContrast = document.getElementById('settingHighContrast') as HTMLInputElement | null;\n    const settingColorblindPatterns = document.getElementById('settingColorblindPatterns') as HTMLInputElement | null;\n\n    // Voice Feedback settings\n    const settingVoiceEnabled = document.getElementById('settingVoiceEnabled') as HTMLInputElement | null;\n    const settingVoiceLaps = document.getElementById('settingVoiceLaps') as HTMLInputElement | null;\n    const settingVoiceZones = document.getElementById('settingVoiceZones') as HTMLInputElement | null;\n\n    // Export format settings\n    const settingExportTcx = document.getElementById('settingExportTcx') as HTMLInputElement | null;\n    const settingExportCsv = document.getElementById('settingExportCsv') as HTMLInputElement | null;\n    const settingExportJson = document.getElementById('settingExportJson') as HTMLInputElement | null;\n    const settingExportFit = document.getElementById('settingExportFit') as HTMLInputElement | null;\n\n    if (!settingsButton || !settingsModal) {\n        console.warn('Settings elements not found in DOM');\n        return;\n    }\n\n    /**\n     * Load settings from localStorage\n     */\n    const loadSettings = (): void => {\n        const settings = getSettings();\n\n        // Dashboard display settings\n        if (settingPower) settingPower.checked = settings.power;\n        if (settingCadence) settingCadence.checked = settings.cadence;\n        if (settingHeartrate) settingHeartrate.checked = settings.heartrate;\n        if (settingPower3s) settingPower3s.checked = settings.power3s;\n\n        // Accessibility settings\n        if (settingHighContrast) settingHighContrast.checked = settings.highContrast;\n        if (settingColorblindPatterns) settingColorblindPatterns.checked = settings.colorblindPatterns;\n\n        // Voice Feedback settings\n        if (settingVoiceEnabled) settingVoiceEnabled.checked = settings.voiceEnabled;\n        if (settingVoiceLaps) settingVoiceLaps.checked = settings.voiceLaps;\n        if (settingVoiceZones) settingVoiceZones.checked = settings.voiceZones;\n\n        // Export format settings\n        if (settingExportTcx) settingExportTcx.checked = settings.exportTcx;\n        if (settingExportCsv) settingExportCsv.checked = settings.exportCsv;\n        if (settingExportJson) settingExportJson.checked = settings.exportJson;\n        if (settingExportFit) settingExportFit.checked = settings.exportFit;\n\n        applySettings(settings);\n    };\n\n    /**\n     * Save settings to localStorage\n     */\n    const saveSettings = (): void => {\n        const settings: AppSettings = {\n            power: settingPower?.checked ?? defaultSettings.power,\n            cadence: settingCadence?.checked ?? defaultSettings.cadence,\n            heartrate: settingHeartrate?.checked ?? defaultSettings.heartrate,\n            power3s: settingPower3s?.checked ?? defaultSettings.power3s,\n            highContrast: settingHighContrast?.checked ?? defaultSettings.highContrast,\n            colorblindPatterns: settingColorblindPatterns?.checked ?? defaultSettings.colorblindPatterns,\n            voiceEnabled: settingVoiceEnabled?.checked ?? defaultSettings.voiceEnabled,\n            voiceLaps: settingVoiceLaps?.checked ?? defaultSettings.voiceLaps,\n            voiceZones: settingVoiceZones?.checked ?? defaultSettings.voiceZones,\n            exportTcx: settingExportTcx?.checked ?? defaultSettings.exportTcx,\n            exportCsv: settingExportCsv?.checked ?? defaultSettings.exportCsv,\n            exportJson: settingExportJson?.checked ?? defaultSettings.exportJson,\n            exportFit: settingExportFit?.checked ?? defaultSettings.exportFit,\n        };\n\n        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));\n        applySettings(settings);\n        closeModal();\n    };\n\n    /**\n     * Apply settings to the UI\n     */\n    const applySettings = (settings: AppSettings): void => {\n        // Toggle metric visibility\n        const toggleMetric = (metric: string, isVisible: boolean): void => {\n            const elements = document.querySelectorAll(`.metric-group-${metric}`);\n            elements.forEach((el) => {\n                (el as HTMLElement).style.display = isVisible ? 'flex' : 'none';\n            });\n        };\n\n        toggleMetric('power', settings.power);\n        toggleMetric('cadence', settings.cadence);\n        toggleMetric('heartrate', settings.heartrate);\n\n        // Apply 3-second average power indicator\n        const powerMetrics = document.querySelectorAll('.metric-group-power');\n        powerMetrics.forEach((el) => {\n            if (settings.power3s) {\n                el.setAttribute('data-show-avg', 'true');\n            } else {\n                el.removeAttribute('data-show-avg');\n            }\n        });\n\n        // Apply high contrast mode\n        if (settings.highContrast) {\n            document.documentElement.setAttribute('data-high-contrast', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-high-contrast');\n        }\n\n        // Apply colorblind patterns (enabled when high contrast + colorblind patterns both on)\n        if (settings.colorblindPatterns) {\n            document.documentElement.setAttribute('data-colorblind-patterns', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-colorblind-patterns');\n        }\n    };\n\n    /**\n     * Open the settings modal\n     */\n    const openModal = (): void => {\n        settingsModal.style.display = 'flex';\n        // Close the main menu details element\n        const details = document.querySelector('header details');\n        if (details) {\n            details.removeAttribute('open');\n        }\n    };\n\n    /**\n     * Close the settings modal\n     */\n    const closeModal = (): void => {\n        settingsModal.style.display = 'none';\n    };\n\n    // Event Listeners\n    settingsButton.addEventListener('click', openModal);\n    closeSettingsModal?.addEventListener('click', closeModal);\n    saveSettingsButton?.addEventListener('click', saveSettings);\n\n    // Close modal when clicking outside\n    window.addEventListener('click', (event: MouseEvent) => {\n        if (event.target === settingsModal) {\n            closeModal();\n        }\n    });\n\n    // Initialize\n    loadSettings();\n}\n","import { getSettings } from '../ui/settings.js';\n\nexport class VoiceFeedback {\n    private synth: SpeechSynthesis;\n    private voice: SpeechSynthesisVoice | null = null;\n\n    constructor() {\n        this.synth = window.speechSynthesis;\n        // Wait for voices to be loaded\n        if (this.synth.onvoiceschanged !== undefined) {\n            this.synth.onvoiceschanged = () => this.loadVoice();\n        }\n        this.loadVoice();\n    }\n\n    private loadVoice() {\n        const voices = this.synth.getVoices();\n        // Prefer English voices\n        this.voice = voices.find(v => v.lang.startsWith('en')) || voices[0] || null;\n    }\n\n    private formatTimeForSpeech(ms: number): string {\n        const totalSeconds = Math.floor(ms / 1000);\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = totalSeconds % 60;\n\n        const parts = [];\n        if (hours > 0) parts.push(`${hours} hours`);\n        if (minutes > 0) parts.push(`${minutes} minutes`);\n        if (seconds > 0 || parts.length === 0) parts.push(`${seconds} seconds`);\n\n        return parts.join(' ');\n    }\n\n    public speak(text: string) {\n        const settings = getSettings();\n        if (!settings.voiceEnabled) return;\n\n        if (this.synth.speaking) {\n            this.synth.cancel();\n        }\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        if (this.voice) {\n            utterance.voice = this.voice;\n        }\n        this.synth.speak(utterance);\n    }\n\n    public announceLap(lapNumber: number, timeMs: number, avgPower: number) {\n        const settings = getSettings();\n        if (!settings.voiceLaps) return;\n\n        const timeStr = this.formatTimeForSpeech(timeMs);\n        const text = `Lap ${lapNumber}. Time ${timeStr}. Average Power ${Math.round(avgPower)} watts.`;\n        this.speak(text);\n    }\n\n    public announceZoneChange(zoneName: string) {\n        const settings = getSettings();\n        if (!settings.voiceZones) return;\n\n        const text = `Entering ${zoneName} Zone`;\n        this.speak(text);\n    }\n}\n\nexport const voiceFeedback = new VoiceFeedback();\n","/**\n * Lap Button Functionality\n *\n * Handles lap marking during workouts.\n * Shows lap button during recording and updates lap counter.\n *\n * @module lap\n */\n\nimport { announce } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { getTimestring } from '../getTimestring.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport type { MeasurementsState } from '../MeasurementsState.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Parameters for lap button initialization\n */\ninterface InitLapButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n}\n\n/**\n * Initialize the lap button functionality.\n *\n * Sets up:\n * - Lap button visibility based on workout state\n * - Lap counter display\n * - Click handler for marking laps\n *\n * @param params - Object containing state objects\n */\nexport function initLapButton({ measurementsState, timeState }: InitLapButtonParams): void {\n    const lapButton = document.getElementById('lapButton') as HTMLButtonElement | null;\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    if (!lapButton || !lapCounter || !lapCountElement) {\n        console.warn('Lap button elements not found in DOM');\n        return;\n    }\n\n    /**\n     * Update lap counter display\n     */\n    const updateLapCounter = (): void => {\n        const count = measurementsState.getLapCount();\n        lapCountElement.textContent = String(count);\n        lapCounter.style.display = count > 0 ? 'block' : 'none';\n    };\n\n    /**\n     * Show/hide lap button based on workout state\n     */\n    const updateLapButtonVisibility = (): void => {\n        const isRecording = timeState.running && timeState.startTime !== null;\n        lapButton.style.display = isRecording ? 'inline-flex' : 'none';\n    };\n\n    /**\n     * Handle lap button click\n     */\n    const handleLapClick = (): void => {\n        if (!timeState.running || !timeState.startTime) {\n            return;\n        }\n\n        // Get previous lap timestamp or start time\n        const laps = measurementsState.laps;\n        const lastLapTime = laps.length > 0 ? laps[laps.length - 1].timestamp : timeState.startTime;\n\n        const lap = measurementsState.addLap(timeState.startTime);\n        updateLapCounter();\n\n        // Calculate stats for the lap that just finished\n        const now = lap.timestamp;\n        const durationMs = now - lastLapTime;\n\n        // Calculate average power\n        const lapPower = measurementsState.power.filter(p => p.timestamp >= lastLapTime && p.timestamp <= now);\n        const avgPower = lapPower.length > 0\n            ? lapPower.reduce((sum, p) => sum + p.value, 0) / lapPower.length\n            : 0;\n\n        // Voice announcement\n        voiceFeedback.announceLap(lap.number, durationMs, avgPower);\n\n        // Format elapsed time for the lap\n        const elapsedStr = lap.elapsedMs ? getTimestring(lap.elapsedMs) : '';\n        const message = `Lap ${lap.number}${elapsedStr ? ` at ${elapsedStr}` : ''}`;\n\n        // Show toast notification\n        showNotification(` ${message}`, 'info');\n\n        // Announce for screen readers\n        announce(message, 'assertive');\n\n        console.log(`Lap marked: ${lap.number} at ${new Date(lap.timestamp).toISOString()}`);\n    };\n\n    // Lap button click handler\n    lapButton.addEventListener('click', handleLapClick);\n\n    // Watch for workout state changes by observing button visibility\n    // This is a simple approach - in a more complex app, use events or state management\n    const observer = new MutationObserver(() => {\n        updateLapButtonVisibility();\n    });\n\n    // Observe the start/pause/resume buttons for visibility changes\n    [startButton, pauseButton, resumeButton, stopButton].forEach(btn => {\n        if (btn) {\n            observer.observe(btn, { attributes: true, attributeFilter: ['style'] });\n        }\n    });\n\n    // Initial state\n    updateLapButtonVisibility();\n    updateLapCounter();\n\n    // Also update when recording starts (observe start button click)\n    startButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    pauseButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    resumeButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    stopButton?.addEventListener('click', () => {\n        setTimeout(() => {\n            updateLapButtonVisibility();\n            // Reset lap counter display after workout stops\n            // (laps are cleared when workout data is discarded)\n        }, 10);\n    });\n\n    console.log('Lap button initialized');\n}\n\n/**\n * Reset lap counter display (called when workout is discarded)\n */\nexport function resetLapCounter(): void {\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n\n    if (lapCounter && lapCountElement) {\n        lapCountElement.textContent = '0';\n        lapCounter.style.display = 'none';\n    }\n}\n","/**\n * Menu Controls\n * \n * Initializes menu buttons for export, discard, and settings toggle.\n * \n * @module menu\n */\n\nimport { getCsvString } from '../create-csv.js';\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js';\nimport { showConfirmation, showWorkoutSummary, calculateWorkoutSummary } from './modal.js';\nimport { announce } from './accessibility.js';\nimport { showUndoNotification, createWorkoutBackup, restoreWorkoutBackup, type WorkoutBackup } from './undoNotification.js';\nimport { resetLapCounter } from './lap.js';\nimport type { MeasurementsState } from '../MeasurementsState.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { ZoneState } from '../ZoneState.js';\n\n/**\n * Application settings stored in localStorage\n */\ninterface AppSettings {\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n}\n\n/**\n * Default settings\n */\nconst defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n};\n\n/**\n * Initialize the metrics visibility toggles.\n * \n * Sets up toggle switches for showing/hiding \"Your Metrics\" and \"Stream Metrics\" sections.\n */\nexport const initMetricsToggle = (): void => {\n    // Your Metrics Toggle\n    const toggleYour = document.getElementById('toggleYourMetrics') as HTMLInputElement | null;\n    const yourMetricsSection = document.getElementById('yourMetrics');\n\n    if (toggleYour && yourMetricsSection) {\n        // Initial state check\n        toggleYour.checked = yourMetricsSection.style.display !== 'none';\n\n        toggleYour.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            yourMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n\n    // Stream Metrics Toggle\n    const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n    const streamMetricsSection = document.getElementById('streamMetrics');\n\n    if (toggleStream && streamMetricsSection) {\n        // Initial state check\n        toggleStream.checked = streamMetricsSection.style.display !== 'none';\n\n        toggleStream.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            streamMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n};\n\n/**\n * Parameters for discard button initialization\n */\ninterface InitDiscardButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/**\n * Initialize the discard button.\n * \n * Shows a custom confirmation dialog before clearing all workout data.\n * After discard, shows an undo notification for 5 seconds allowing\n * the user to restore their data.\n * \n * @param params - Object containing state objects\n */\nexport const initDiscardButton = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitDiscardButtonParams): void => {\n    const discardButton = document.getElementById('discardButton');\n\n    if (!discardButton) {\n        console.warn('Discard button not found in DOM');\n        return;\n    }\n\n    discardButton.addEventListener('click', async () => {\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0 ||\n            timeState.startTime !== null;\n\n        // If no data, just reset silently\n        if (!hasData) {\n            resetWorkoutState(measurementsState, timeState);\n            return;\n        }\n\n        // Count data points for the warning message\n        const totalDataPoints =\n            measurementsState.power.length +\n            measurementsState.heartrate.length +\n            measurementsState.cadence.length;\n\n        const confirmed = await showConfirmation(\n            'Discard Workout',\n            `Are you sure you want to discard this workout? You have ${totalDataPoints} data points that will be deleted. You'll have 5 seconds to undo this action.`,\n            {\n                confirmText: 'Discard',\n                cancelText: 'Keep Data',\n                confirmVariant: 'danger',\n                icon: '',\n            }\n        );\n\n        if (confirmed) {\n            // Create backup before clearing\n            const backup = createWorkoutBackup(measurementsState, timeState);\n\n            // Clear the workout data\n            resetWorkoutState(measurementsState, timeState);\n\n            // Reset zone tracking\n            if (zoneState) {\n                zoneState.reset();\n            }\n\n            // Dispatch event for zone state to reset\n            document.dispatchEvent(new CustomEvent('workout-discarded'));\n\n            // Reset lap counter display\n            resetLapCounter();\n\n            // Show undo notification\n            showUndoNotification({\n                message: 'Workout data discarded',\n                icon: '',\n                timeout: 5000,\n                onUndo: () => {\n                    // Restore the backup\n                    restoreWorkoutBackup(backup, measurementsState, timeState);\n\n                    // Restore UI state based on the backup\n                    restoreWorkoutUI(backup);\n\n                    announce('Workout data restored', 'polite');\n                },\n                onExpire: () => {\n                    // Data is already cleared, nothing more to do\n                    announce('Discard complete', 'polite');\n                },\n            });\n        }\n    });\n};\n\n/**\n * Restore the workout UI based on backed up state\n */\nfunction restoreWorkoutUI(backup: WorkoutBackup): void {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n\n    if (backup.running) {\n        // Was running when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'inline-flex';\n        if (resumeButton) resumeButton.style.display = 'none';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    } else if (backup.startTime !== null) {\n        // Was paused when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'none';\n        if (resumeButton) resumeButton.style.display = 'inline-flex';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    }\n\n    // Restore timer display if there was a start time\n    if (timeElement && backup.startTime !== null) {\n        const elapsed = (backup.endTime || Date.now()) - backup.startTime;\n        const seconds = Math.floor(elapsed / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        timeElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\n    }\n}\n\n/**\n * Reset workout state to initial values\n */\nfunction resetWorkoutState(measurementsState: MeasurementsState, timeState: TimeState): void {\n    // Reset time state\n    timeState.running = false;\n    timeState.startTime = null;\n    timeState.endTime = null;\n\n    // Reset measurements\n    measurementsState.power = [];\n    measurementsState.heartrate = [];\n    measurementsState.cadence = [];\n\n    // Reset workout controls to idle state\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton) startButton.style.display = 'inline-flex';\n    if (pauseButton) pauseButton.style.display = 'none';\n    if (resumeButton) resumeButton.style.display = 'none';\n    if (stopButton) stopButton.style.display = 'none';\n\n    // Reset timer display\n    const timeElement = document.getElementById('time');\n    if (timeElement) timeElement.textContent = '00:00:00';\n}\n\n/**\n * Generate a timestamp string for filenames.\n */\nfunction getExportTimestamp(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;\n}\n\n/**\n * Download a file by creating a temporary link element.\n */\nfunction downloadFile(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n}\n\n/**\n * Initialize the export button.\n * \n * Exports workout data in configured formats (TCX, CSV, JSON).\n * \n * @param measurementsState - The measurements state object\n * @param zoneState - Optional zone state for including zone data in exports\n */\nexport const initExportButton = (measurementsState: MeasurementsState, zoneState?: ZoneState): void => {\n    const exportDataElem = document.getElementById('exportData');\n\n    if (!exportDataElem) {\n        console.warn('Export button not found in DOM');\n        return;\n    }\n\n    exportDataElem.addEventListener('click', () => {\n        try {\n            // Get export format settings\n            const settingsJson = localStorage.getItem('bpt-settings');\n            const settings: AppSettings = settingsJson\n                ? { ...defaultSettings, ...JSON.parse(settingsJson) }\n                : defaultSettings;\n\n            const timestamp = getExportTimestamp();\n\n            // Download JSON file (includes zone data)\n            if (settings.exportJson) {\n                const exportData: Record<string, unknown> = {\n                    power: measurementsState.power,\n                    heartrate: measurementsState.heartrate,\n                    cadence: measurementsState.cadence,\n                };\n\n                // Include zone distribution data if available\n                if (zoneState) {\n                    const zoneData = zoneState.toJSON();\n                    if (zoneData.powerZones.some(z => z.timeInZoneMs > 0) ||\n                        zoneData.hrZones.some(z => z.timeInZoneMs > 0)) {\n                        exportData.zoneDistribution = {\n                            power: zoneData.powerZones.map(z => ({\n                                zone: z.zone,\n                                name: z.name,\n                                timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                            })),\n                            heartrate: zoneData.hrZones.map(z => ({\n                                zone: z.zone,\n                                name: z.name,\n                                timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                            })),\n                            ftp: zoneData.ftp,\n                            maxHr: zoneData.maxHr,\n                        };\n                    }\n                }\n\n                const jsonString = JSON.stringify(exportData, null, 2);\n                const jsonBlob = new Blob([jsonString], { type: 'application/json' });\n                downloadFile(jsonBlob, `bike-measurements-${timestamp}.json`);\n            }\n\n            // Download TCX file\n            if (settings.exportTcx) {\n                const tcxString = getTcxString(measurementsState);\n                if (tcxString) {\n                    const tcxBlob = new Blob([tcxString], { type: 'application/xml' });\n                    downloadFile(tcxBlob, `bike-workout-${timestamp}.tcx`);\n                }\n            }\n\n            // Download CSV file\n            if (settings.exportCsv) {\n                const csvString = getCsvString(measurementsState);\n                if (csvString) {\n                    const csvBlob = new Blob([csvString], { type: 'text/csv' });\n                    downloadFile(csvBlob, `bike-workout-${timestamp}.csv`);\n                }\n            }\n\n            // Download FIT file\n            if (settings.exportFit) {\n                const fitData = getFitData(measurementsState);\n                if (fitData) {\n                    const fitBlob = new Blob([new Uint8Array(fitData)], { type: 'application/fit' });\n                    downloadFile(fitBlob, `bike-workout-${timestamp}.fit`);\n                }\n            }\n        } catch (error) {\n            console.error('Error exporting data:', error);\n        }\n    });\n};\n\n/**\n * Parameters for workout summary initialization\n */\ninterface InitWorkoutSummaryParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/**\n * Initialize the post-workout summary modal.\n * \n * Listens for the 'workoutComplete' event and shows a summary modal\n * with workout statistics and export options.\n * \n * @param params - Object containing state objects\n */\nexport const initWorkoutSummaryModal = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitWorkoutSummaryParams): void => {\n    document.addEventListener('workoutComplete', async (event) => {\n        const detail = (event as CustomEvent).detail;\n\n        // Only show summary if we have data\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0;\n\n        if (!hasData && !detail.startTime) {\n            return;\n        }\n\n        const summary = calculateWorkoutSummary(\n            detail.startTime || timeState.startTime || Date.now(),\n            detail.endTime || timeState.endTime || Date.now(),\n            measurementsState,\n            zoneState\n        );\n\n        await showWorkoutSummary(summary, {\n            onExport: () => {\n                // Trigger the export button click\n                const exportButton = document.getElementById('exportData');\n                exportButton?.click();\n\n                // Reset state after export\n                resetWorkoutState(measurementsState, timeState);\n            },\n            onDiscard: () => {\n                resetWorkoutState(measurementsState, timeState);\n                announce('Workout discarded', 'polite');\n            },\n            onKeepRecording: () => {\n                // Resume the workout\n                const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n                resumeButton?.click();\n            },\n        });\n    });\n};\n","/**\n * DOM Element References\n * \n * Centralized access to DOM elements used throughout the application.\n * \n * @module elements\n */\n\nimport type { SensorType } from './types/connections.js';\n\n/**\n * Sensor element configuration\n */\nexport interface SensorElements {\n    display: HTMLElement | null;\n    connect: HTMLElement | null;\n}\n\n/**\n * All sensor elements by type\n */\nexport type SensorElementsMap = Record<SensorType, SensorElements>;\n\n/**\n * Get DOM element by ID with null check\n * \n * @param id - Element ID\n * @returns The element or null if not found\n */\nfunction getElement<T extends HTMLElement = HTMLElement>(id: string): T | null {\n    const element = document.getElementById(id) as T | null;\n    if (!element) {\n        console.warn(`Element with ID \"${id}\" not found in DOM`);\n    }\n    return element;\n}\n\n// Individual element exports for backward compatibility\nexport const connectPowerElem = getElement<HTMLButtonElement>('connectPower');\nexport const connectHeartrateElem = getElement<HTMLButtonElement>('connectHeartrate');\nexport const connectCadenceElem = getElement<HTMLButtonElement>('connectCadence');\nexport const connectGpsElem = getElement<HTMLButtonElement>('connectGps');\n\nexport const powerElement = getElement('power');\nexport const heartrateElement = getElement('heartrate');\nexport const cadenceElement = getElement('cadence');\nexport const speedElement = getElement('speed');\nexport const distanceElement = getElement('distance');\nexport const altitudeElement = getElement('altitude');\n\n/**\n * Grouped elements by sensor type\n */\nexport const elements: SensorElementsMap = {\n    power: { display: powerElement, connect: connectPowerElem },\n    heartrate: { display: heartrateElement, connect: connectHeartrateElem },\n    cadence: { display: cadenceElement, connect: connectCadenceElem },\n    gps: { display: null, connect: connectGpsElem },\n    speed: { display: speedElement, connect: null },\n    distance: { display: distanceElement, connect: null },\n    altitude: { display: altitudeElement, connect: null },\n};\n\n/**\n * Get element by ID (type-safe helper)\n */\nexport { getElement };\n","/**\n * Zone State Management\n * \n * Tracks time spent in each power and heart rate zone during a workout.\n * Integrates with UserProfile for zone thresholds.\n * \n * @module ZoneState\n */\n\n/**\n * User profile for zone calculations\n */\ninterface UserProfile {\n    ftp: number | null;\n    maxHr: number | null;\n}\n\n/** Storage key for user profile */\nconst PROFILE_KEY = 'bpt-user-profile';\n\n/**\n * Load user profile from localStorage\n */\nfunction loadUserProfile(): UserProfile {\n    try {\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return JSON.parse(stored);\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ftp: null, maxHr: null };\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nfunction calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.90) },\n        { name: 'Threshold', min: Math.round(ftp * 0.90), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.20) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.20), max: Math.round(ftp * 1.50) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.50), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nfunction calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.50), max: Math.round(maxHr * 0.60) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.60), max: Math.round(maxHr * 0.70) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.70), max: Math.round(maxHr * 0.80) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.80), max: Math.round(maxHr * 0.90) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.90), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nfunction getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nfunction getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Zone information with time tracking\n */\nexport interface ZoneInfo {\n    zone: number;\n    name: string;\n    min: number;\n    max: number;\n    timeInZoneMs: number;\n}\n\n/**\n * Current zone status for real-time display\n */\nexport interface CurrentZoneStatus {\n    zone: number;\n    name: string;\n    percentInZone: number; // 0-100, position within zone range\n}\n\n/**\n * Zone distribution data for summary\n */\nexport interface ZoneDistribution {\n    zones: ZoneInfo[];\n    totalTimeMs: number;\n}\n\n/**\n * State change callback type\n */\nexport type ZoneStateChangeCallback = () => void;\n\n/**\n * Zone State class for tracking time in zones\n */\nexport class ZoneState {\n    private _powerZones: ZoneInfo[] = [];\n    private _hrZones: ZoneInfo[] = [];\n    private _lastPowerZone: number | null = null;\n    private _lastHrZone: number | null = null;\n    private _lastUpdateTime: number | null = null;\n    private _ftp: number | null = null;\n    private _maxHr: number | null = null;\n    private _currentPowerZone: CurrentZoneStatus | null = null;\n    private _currentHrZone: CurrentZoneStatus | null = null;\n    private _onChangeCallbacks: ZoneStateChangeCallback[] = [];\n\n    constructor() {\n        this.loadProfile();\n    }\n\n    /**\n     * Load user profile and initialize zones\n     */\n    loadProfile(): void {\n        const profile = loadUserProfile();\n        this._ftp = profile.ftp;\n        this._maxHr = profile.maxHr;\n\n        // Initialize power zones\n        if (this._ftp) {\n            const powerZonesDef = calculatePowerZones(this._ftp);\n            this._powerZones = powerZonesDef.map((z, i) => ({\n                zone: i + 1,\n                name: z.name,\n                min: z.min,\n                max: z.max,\n                timeInZoneMs: 0,\n            }));\n        }\n\n        // Initialize HR zones\n        if (this._maxHr) {\n            const hrZonesDef = calculateHrZones(this._maxHr);\n            this._hrZones = hrZonesDef.map((z, i) => ({\n                zone: i + 1,\n                name: z.name,\n                min: z.min,\n                max: z.max,\n                timeInZoneMs: 0,\n            }));\n        }\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: ZoneStateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: ZoneStateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    /**\n     * Notify listeners of state change\n     */\n    private _notifyChange(): void {\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('Zone state change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Update power value and track zone time\n     */\n    updatePower(power: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._ftp) return null;\n\n        const zoneInfo = getPowerZone(power, this._ftp);\n        if (!zoneInfo) return null;\n\n        const currentZone = zoneInfo.zone;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastPowerZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._powerZones[this._lastPowerZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                // Only count if less than 5 seconds (avoid large gaps)\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastPowerZone = currentZone;\n        this._lastUpdateTime = timestamp;\n\n        // Calculate position within zone\n        const zoneData = this._powerZones[currentZone - 1];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0\n            ? Math.min(100, Math.max(0, ((power - zoneData.min) / range) * 100))\n            : 50;\n\n        this._currentPowerZone = {\n            zone: currentZone,\n            name: zoneInfo.name,\n            percentInZone,\n        };\n\n        this._notifyChange();\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Update heart rate value and track zone time\n     */\n    updateHeartRate(hr: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._maxHr) return null;\n\n        const zoneInfo = getHrZone(hr, this._maxHr);\n        if (!zoneInfo) return null;\n\n        const currentZone = zoneInfo.zone;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastHrZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._hrZones[this._lastHrZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastHrZone = currentZone;\n        // Only update if no power update occurred (prevent double counting)\n        if (this._lastUpdateTime === null || timestamp - this._lastUpdateTime > 50) {\n            this._lastUpdateTime = timestamp;\n        }\n\n        // Calculate position within zone\n        const zoneData = this._hrZones[currentZone - 1];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0\n            ? Math.min(100, Math.max(0, ((hr - zoneData.min) / range) * 100))\n            : 50;\n\n        this._currentHrZone = {\n            zone: currentZone,\n            name: zoneInfo.name,\n            percentInZone,\n        };\n\n        this._notifyChange();\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get current power zone status\n     */\n    getCurrentPowerZone(): CurrentZoneStatus | null {\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Get current HR zone status\n     */\n    getCurrentHrZone(): CurrentZoneStatus | null {\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get power zone distribution for summary\n     */\n    getPowerZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._powerZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._powerZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Get HR zone distribution for summary\n     */\n    getHrZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._hrZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._hrZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Check if power zones are configured\n     */\n    hasPowerZones(): boolean {\n        return this._ftp !== null && this._ftp > 0;\n    }\n\n    /**\n     * Check if HR zones are configured\n     */\n    hasHrZones(): boolean {\n        return this._maxHr !== null && this._maxHr > 0;\n    }\n\n    /**\n     * Get FTP value\n     */\n    getFtp(): number | null {\n        return this._ftp;\n    }\n\n    /**\n     * Get Max HR value\n     */\n    getMaxHr(): number | null {\n        return this._maxHr;\n    }\n\n    /**\n     * Reset all zone tracking data\n     */\n    reset(): void {\n        this._powerZones.forEach(z => z.timeInZoneMs = 0);\n        this._hrZones.forEach(z => z.timeInZoneMs = 0);\n        this._lastPowerZone = null;\n        this._lastHrZone = null;\n        this._lastUpdateTime = null;\n        this._currentPowerZone = null;\n        this._currentHrZone = null;\n        this._notifyChange();\n    }\n\n    /**\n     * Export zone data as JSON (for exports/summary)\n     */\n    toJSON(): {\n        powerZones: ZoneInfo[];\n        hrZones: ZoneInfo[];\n        ftp: number | null;\n        maxHr: number | null;\n    } {\n        return {\n            powerZones: [...this._powerZones],\n            hrZones: [...this._hrZones],\n            ftp: this._ftp,\n            maxHr: this._maxHr,\n        };\n    }\n}\n","/**\n * Metrics Display Initialization\n * \n * Sets up real-time display updates for workout metrics.\n * Includes zone tracking and visual zone indicators.\n * \n * @module initMetricsDisplay\n */\n\nimport { elements } from './elements.js';\nimport type { MeasurementsState } from './MeasurementsState.js';\nimport type { MeasurementType } from './types/measurements.js';\nimport type { ConnectionsState } from './getInitState.js';\nimport { ZoneState } from './ZoneState.js';\nimport type { ZoneGauge } from './components/ZoneGauge.js';\nimport type { LiveChart } from './components/LiveChart.js';\nimport { voiceFeedback } from './services/VoiceFeedback.js';\n\n/**\n * Parameters for metrics display initialization\n */\ninterface InitMetricsDisplayParams {\n    connectionsState: ConnectionsState;\n    measurementsState: MeasurementsState;\n}\n\n/** Maximum age of measurement data before showing as disconnected (ms) */\nconst DATA_TIMEOUT_MS = 5000;\n\n/** Update interval for display refresh (ms) */\nconst UPDATE_INTERVAL_MS = 100;\n\n/** Zone state instance - exported for use in summary/exports */\nexport let zoneState: ZoneState;\n\n/**\n * Initialize zone gauges in the DOM\n */\nfunction initZoneGauges(): { powerGauge: ZoneGauge | null; hrGauge: ZoneGauge | null } {\n    // Look for existing zone gauges or create them\n    let powerGauge = document.getElementById('powerZoneGauge') as ZoneGauge | null;\n    let hrGauge = document.getElementById('hrZoneGauge') as ZoneGauge | null;\n\n    // Create power zone gauge if it doesn't exist\n    if (!powerGauge) {\n        const powerMetricGroup = document.querySelector('.metric-group-power');\n        if (powerMetricGroup) {\n            powerGauge = document.createElement('bpt-zone-gauge') as ZoneGauge;\n            powerGauge.id = 'powerZoneGauge';\n            powerGauge.setAttribute('type', 'power');\n            powerGauge.setAttribute('compact', '');\n            powerGauge.style.display = 'none'; // Hidden until zones are active\n            powerMetricGroup.appendChild(powerGauge);\n        }\n    }\n\n    // Create HR zone gauge if it doesn't exist\n    if (!hrGauge) {\n        const hrMetricGroup = document.querySelector('.metric-group-heartrate');\n        if (hrMetricGroup) {\n            hrGauge = document.createElement('bpt-zone-gauge') as ZoneGauge;\n            hrGauge.id = 'hrZoneGauge';\n            hrGauge.setAttribute('type', 'heartrate');\n            hrGauge.setAttribute('compact', '');\n            hrGauge.style.display = 'none'; // Hidden until zones are active\n            hrMetricGroup.appendChild(hrGauge);\n        }\n    }\n\n    return { powerGauge, hrGauge };\n}\n\n/**\n * Initialize live charts for power and heart rate\n */\nfunction initLiveCharts(): { powerChart: LiveChart | null; hrChart: LiveChart | null } {\n    let powerChart = document.getElementById('powerLiveChart') as LiveChart | null;\n    let hrChart = document.getElementById('hrLiveChart') as LiveChart | null;\n\n    // Create charts container if it doesn't exist\n    let chartsContainer = document.getElementById('liveChartsContainer');\n    if (!chartsContainer) {\n        const metricsSection = document.getElementById('yourMetrics');\n        if (metricsSection) {\n            chartsContainer = document.createElement('div');\n            chartsContainer.id = 'liveChartsContainer';\n            chartsContainer.className = 'live-charts-container';\n            chartsContainer.style.display = 'none'; // Hidden by default\n\n            // Insert after metricsTable\n            const metricsTable = document.getElementById('metricsTable');\n            if (metricsTable && metricsTable.nextSibling) {\n                metricsSection.insertBefore(chartsContainer, metricsTable.nextSibling);\n            } else {\n                metricsSection.appendChild(chartsContainer);\n            }\n        }\n    }\n\n    if (chartsContainer) {\n        // Create power chart if it doesn't exist\n        if (!powerChart) {\n            powerChart = document.createElement('bpt-live-chart') as LiveChart;\n            powerChart.id = 'powerLiveChart';\n            powerChart.setAttribute('type', 'power');\n            powerChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(powerChart);\n        }\n\n        // Create HR chart if it doesn't exist\n        if (!hrChart) {\n            hrChart = document.createElement('bpt-live-chart') as LiveChart;\n            hrChart.id = 'hrLiveChart';\n            hrChart.setAttribute('type', 'heartrate');\n            hrChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(hrChart);\n        }\n    }\n\n    return { powerChart, hrChart };\n}\n\n/**\n * Get or create the charts toggle button\n */\nfunction initChartsToggle(chartsVisible: boolean): HTMLButtonElement | null {\n    let toggleBtn = document.getElementById('toggleLiveCharts') as HTMLButtonElement | null;\n\n    if (!toggleBtn) {\n        const topBarControls = document.getElementById('topBarControls');\n        if (topBarControls) {\n            toggleBtn = document.createElement('button');\n            toggleBtn.id = 'toggleLiveCharts';\n            toggleBtn.className = 'workout-btn workout-btn-chart';\n            toggleBtn.setAttribute('aria-label', 'Toggle live charts');\n            toggleBtn.setAttribute('title', 'Toggle Charts');\n            toggleBtn.innerHTML = '';\n            toggleBtn.style.display = 'none'; // Hidden until workout starts\n\n            // Insert before workout controls\n            const workoutControls = document.querySelector('.workout-controls');\n            if (workoutControls) {\n                topBarControls.insertBefore(toggleBtn, workoutControls);\n            } else {\n                topBarControls.appendChild(toggleBtn);\n            }\n        }\n    }\n\n    if (toggleBtn) {\n        toggleBtn.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n    }\n\n    return toggleBtn;\n}\n\n/**\n * Update the zone display elements\n */\nfunction updateZoneDisplays(\n    powerGauge: ZoneGauge | null,\n    hrGauge: ZoneGauge | null,\n    zoneState: ZoneState\n): void {\n    // Update power zone gauge\n    if (powerGauge) {\n        const powerZone = zoneState.getCurrentPowerZone();\n        if (powerZone && zoneState.hasPowerZones()) {\n            powerGauge.style.display = '';\n            powerGauge.setZone(powerZone.zone, powerZone.name, powerZone.percentInZone);\n        } else if (!zoneState.hasPowerZones()) {\n            powerGauge.style.display = 'none';\n        }\n    }\n\n    // Update HR zone gauge\n    if (hrGauge) {\n        const hrZone = zoneState.getCurrentHrZone();\n        if (hrZone && zoneState.hasHrZones()) {\n            hrGauge.style.display = '';\n            hrGauge.setZone(hrZone.zone, hrZone.name, hrZone.percentInZone);\n        } else if (!zoneState.hasHrZones()) {\n            hrGauge.style.display = 'none';\n        }\n    }\n}\n\n/**\n * Apply zone color to metric display element\n */\nfunction applyZoneColorToMetric(element: HTMLElement, zone: number | null, _type: 'power' | 'heartrate'): void {\n    const parent = element.closest('.metric-group');\n    if (!parent) return;\n\n    // Zone colors for power (7 zones) and HR (5 zones)\n    const zoneColors: Record<number, string> = {\n        1: '#3b82f6', // Blue - Recovery/Active Recovery\n        2: '#22c55e', // Green - Endurance/Aerobic\n        3: '#eab308', // Yellow - Tempo\n        4: '#f97316', // Orange - Threshold\n        5: '#ef4444', // Red - VO2max/Anaerobic\n        6: '#a855f7', // Purple - Anaerobic (power only)\n        7: '#ec4899', // Pink - Neuromuscular (power only)\n    };\n\n    if (zone !== null && zone >= 1 && zone <= 7) {\n        const color = zoneColors[zone];\n        element.style.color = color;\n        (parent as HTMLElement).style.borderLeftColor = color;\n        (parent as HTMLElement).style.borderLeftWidth = '4px';\n        (parent as HTMLElement).style.borderLeftStyle = 'solid';\n    } else {\n        element.style.color = '';\n        (parent as HTMLElement).style.borderLeftColor = '';\n        (parent as HTMLElement).style.borderLeftWidth = '';\n        (parent as HTMLElement).style.borderLeftStyle = '';\n    }\n}\n\n/**\n * Initialize the metrics display update loop.\n * \n * Creates an interval that updates the display elements with the latest\n * measurements from connected sensors. Shows '--' for disconnected sensors\n * or stale data (older than 5 seconds).\n * \n * @param params - Object containing state objects\n * @returns The ZoneState instance for external use\n */\nexport const initMetricsDisplay = ({\n    connectionsState,\n    measurementsState,\n}: InitMetricsDisplayParams): ZoneState => {\n    const emptyValue = '--';\n\n    // Initialize zone state\n    zoneState = new ZoneState();\n\n    // Initialize zone gauges\n    const { powerGauge, hrGauge } = initZoneGauges();\n\n    // Initialize live charts\n    const { powerChart, hrChart } = initLiveCharts();\n    let chartsVisible = localStorage.getItem('bpt-charts-visible') === 'true';\n\n    // Initialize charts toggle button\n    const chartsToggle = initChartsToggle(chartsVisible);\n    const chartsContainer = document.getElementById('liveChartsContainer');\n\n    // Set initial visibility\n    if (chartsContainer) {\n        chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n    }\n\n    // Charts toggle click handler\n    if (chartsToggle) {\n        chartsToggle.addEventListener('click', () => {\n            chartsVisible = !chartsVisible;\n            localStorage.setItem('bpt-charts-visible', chartsVisible ? 'true' : 'false');\n            chartsToggle.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n            if (chartsContainer) {\n                chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n            }\n        });\n    }\n\n    // Track last data index to only push new data points\n    let lastPowerIndex = 0;\n    let lastHrIndex = 0;\n\n    // Track last zones for voice feedback\n    let lastPowerZone: number | null = null;\n    let lastHrZone: number | null = null;\n\n    /**\n     * Update live charts with new data\n     */\n    const updateLiveCharts = (): void => {\n        // Update power chart\n        if (powerChart && measurementsState.power.length > lastPowerIndex) {\n            for (let i = lastPowerIndex; i < measurementsState.power.length; i++) {\n                const point = measurementsState.power[i];\n                powerChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastPowerIndex = measurementsState.power.length;\n        }\n\n        // Update HR chart\n        if (hrChart && measurementsState.heartrate.length > lastHrIndex) {\n            for (let i = lastHrIndex; i < measurementsState.heartrate.length; i++) {\n                const point = measurementsState.heartrate[i];\n                hrChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastHrIndex = measurementsState.heartrate.length;\n        }\n    };\n\n    /**\n     * Update the display for a single metric type\n     */\n    const updateMetricDisplay = (key: MeasurementType): void => {\n        if (key === 'gps') return;\n\n        const element = elements[key]?.display;\n        const connectionState = connectionsState[key];\n\n        if (!element || !connectionState) {\n            return;\n        }\n\n        // Show empty value if not connected\n        if (!connectionState.isConnected) {\n            element.textContent = emptyValue;\n            // Clear zone color when disconnected\n            if (key === 'power' || key === 'heartrate') {\n                applyZoneColorToMetric(element, null, key);\n            }\n            return;\n        }\n\n        const arr = measurementsState[key];\n\n        // Show empty value if no measurements\n        if (!Array.isArray(arr) || arr.length === 0) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        const latestMeasurement = arr[arr.length - 1];\n\n        // Validate measurement data\n        if (\n            !latestMeasurement ||\n            typeof latestMeasurement.value !== 'number' ||\n            typeof latestMeasurement.timestamp !== 'number'\n        ) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        // Check if data is stale\n        const timeDiff = Date.now() - latestMeasurement.timestamp;\n        if (timeDiff > DATA_TIMEOUT_MS) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        // Display the current value\n        element.textContent = String(latestMeasurement.value);\n\n        // Update zone tracking and apply zone colors\n        if (key === 'power') {\n            const zoneInfo = zoneState.updatePower(latestMeasurement.value, latestMeasurement.timestamp);\n            const currentZone = zoneInfo?.zone ?? null;\n\n            if (currentZone !== lastPowerZone) {\n                if (currentZone !== null && lastPowerZone !== null) {\n                    voiceFeedback.announceZoneChange(zoneInfo!.name);\n                }\n                lastPowerZone = currentZone;\n            }\n\n            applyZoneColorToMetric(element, currentZone, 'power');\n        } else if (key === 'heartrate') {\n            const zoneInfo = zoneState.updateHeartRate(latestMeasurement.value, latestMeasurement.timestamp);\n            const currentZone = zoneInfo?.zone ?? null;\n\n            if (currentZone !== lastHrZone) {\n                if (currentZone !== null && lastHrZone !== null) {\n                    voiceFeedback.announceZoneChange(zoneInfo!.name);\n                }\n                lastHrZone = currentZone;\n            }\n\n            applyZoneColorToMetric(element, currentZone, 'heartrate');\n        }\n    };\n\n    const metricTypes: MeasurementType[] = ['power', 'heartrate', 'cadence', 'speed', 'distance', 'altitude'];\n\n    // Start the update loop\n    setInterval(() => {\n        metricTypes.forEach(updateMetricDisplay);\n        updateZoneDisplays(powerGauge, hrGauge, zoneState);\n        updateLiveCharts();\n    }, UPDATE_INTERVAL_MS);\n\n    // Show/hide charts toggle based on workout state\n    document.addEventListener('workoutStarted', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'inline-flex';\n        }\n    });\n\n    document.addEventListener('workoutStopped', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'none';\n        }\n    });\n\n    // Listen for profile updates to reload zones\n    window.addEventListener('storage', (e) => {\n        if (e.key === 'bpt-user-profile') {\n            zoneState.loadProfile();\n        }\n    });\n\n    // Listen for workout discard to reset zones and charts\n    document.addEventListener('workout-discarded', () => {\n        zoneState.reset();\n        lastPowerIndex = 0;\n        lastHrIndex = 0;\n        if (powerChart) powerChart.clear();\n        if (hrChart) hrChart.clear();\n    });\n\n    return zoneState;\n};\n","/*! Capacitor: https://capacitorjs.com/ - MIT License */\nvar ExceptionCode;\n(function (ExceptionCode) {\n    /**\n     * API is not implemented.\n     *\n     * This usually means the API can't be used because it is not implemented for\n     * the current platform.\n     */\n    ExceptionCode[\"Unimplemented\"] = \"UNIMPLEMENTED\";\n    /**\n     * API is not available.\n     *\n     * This means the API can't be used right now because:\n     *   - it is currently missing a prerequisite, such as network connectivity\n     *   - it requires a particular platform or browser version\n     */\n    ExceptionCode[\"Unavailable\"] = \"UNAVAILABLE\";\n})(ExceptionCode || (ExceptionCode = {}));\nclass CapacitorException extends Error {\n    constructor(message, code, data) {\n        super(message);\n        this.message = message;\n        this.code = code;\n        this.data = data;\n    }\n}\nconst getPlatformId = (win) => {\n    var _a, _b;\n    if (win === null || win === void 0 ? void 0 : win.androidBridge) {\n        return 'android';\n    }\n    else if ((_b = (_a = win === null || win === void 0 ? void 0 : win.webkit) === null || _a === void 0 ? void 0 : _a.messageHandlers) === null || _b === void 0 ? void 0 : _b.bridge) {\n        return 'ios';\n    }\n    else {\n        return 'web';\n    }\n};\n\nconst createCapacitor = (win) => {\n    const capCustomPlatform = win.CapacitorCustomPlatform || null;\n    const cap = win.Capacitor || {};\n    const Plugins = (cap.Plugins = cap.Plugins || {});\n    const getPlatform = () => {\n        return capCustomPlatform !== null ? capCustomPlatform.name : getPlatformId(win);\n    };\n    const isNativePlatform = () => getPlatform() !== 'web';\n    const isPluginAvailable = (pluginName) => {\n        const plugin = registeredPlugins.get(pluginName);\n        if (plugin === null || plugin === void 0 ? void 0 : plugin.platforms.has(getPlatform())) {\n            // JS implementation available for the current platform.\n            return true;\n        }\n        if (getPluginHeader(pluginName)) {\n            // Native implementation available.\n            return true;\n        }\n        return false;\n    };\n    const getPluginHeader = (pluginName) => { var _a; return (_a = cap.PluginHeaders) === null || _a === void 0 ? void 0 : _a.find((h) => h.name === pluginName); };\n    const handleError = (err) => win.console.error(err);\n    const registeredPlugins = new Map();\n    const registerPlugin = (pluginName, jsImplementations = {}) => {\n        const registeredPlugin = registeredPlugins.get(pluginName);\n        if (registeredPlugin) {\n            console.warn(`Capacitor plugin \"${pluginName}\" already registered. Cannot register plugins twice.`);\n            return registeredPlugin.proxy;\n        }\n        const platform = getPlatform();\n        const pluginHeader = getPluginHeader(pluginName);\n        let jsImplementation;\n        const loadPluginImplementation = async () => {\n            if (!jsImplementation && platform in jsImplementations) {\n                jsImplementation =\n                    typeof jsImplementations[platform] === 'function'\n                        ? (jsImplementation = await jsImplementations[platform]())\n                        : (jsImplementation = jsImplementations[platform]);\n            }\n            else if (capCustomPlatform !== null && !jsImplementation && 'web' in jsImplementations) {\n                jsImplementation =\n                    typeof jsImplementations['web'] === 'function'\n                        ? (jsImplementation = await jsImplementations['web']())\n                        : (jsImplementation = jsImplementations['web']);\n            }\n            return jsImplementation;\n        };\n        const createPluginMethod = (impl, prop) => {\n            var _a, _b;\n            if (pluginHeader) {\n                const methodHeader = pluginHeader === null || pluginHeader === void 0 ? void 0 : pluginHeader.methods.find((m) => prop === m.name);\n                if (methodHeader) {\n                    if (methodHeader.rtype === 'promise') {\n                        return (options) => cap.nativePromise(pluginName, prop.toString(), options);\n                    }\n                    else {\n                        return (options, callback) => cap.nativeCallback(pluginName, prop.toString(), options, callback);\n                    }\n                }\n                else if (impl) {\n                    return (_a = impl[prop]) === null || _a === void 0 ? void 0 : _a.bind(impl);\n                }\n            }\n            else if (impl) {\n                return (_b = impl[prop]) === null || _b === void 0 ? void 0 : _b.bind(impl);\n            }\n            else {\n                throw new CapacitorException(`\"${pluginName}\" plugin is not implemented on ${platform}`, ExceptionCode.Unimplemented);\n            }\n        };\n        const createPluginMethodWrapper = (prop) => {\n            let remove;\n            const wrapper = (...args) => {\n                const p = loadPluginImplementation().then((impl) => {\n                    const fn = createPluginMethod(impl, prop);\n                    if (fn) {\n                        const p = fn(...args);\n                        remove = p === null || p === void 0 ? void 0 : p.remove;\n                        return p;\n                    }\n                    else {\n                        throw new CapacitorException(`\"${pluginName}.${prop}()\" is not implemented on ${platform}`, ExceptionCode.Unimplemented);\n                    }\n                });\n                if (prop === 'addListener') {\n                    p.remove = async () => remove();\n                }\n                return p;\n            };\n            // Some flair \n            wrapper.toString = () => `${prop.toString()}() { [capacitor code] }`;\n            Object.defineProperty(wrapper, 'name', {\n                value: prop,\n                writable: false,\n                configurable: false,\n            });\n            return wrapper;\n        };\n        const addListener = createPluginMethodWrapper('addListener');\n        const removeListener = createPluginMethodWrapper('removeListener');\n        const addListenerNative = (eventName, callback) => {\n            const call = addListener({ eventName }, callback);\n            const remove = async () => {\n                const callbackId = await call;\n                removeListener({\n                    eventName,\n                    callbackId,\n                }, callback);\n            };\n            const p = new Promise((resolve) => call.then(() => resolve({ remove })));\n            p.remove = async () => {\n                console.warn(`Using addListener() without 'await' is deprecated.`);\n                await remove();\n            };\n            return p;\n        };\n        const proxy = new Proxy({}, {\n            get(_, prop) {\n                switch (prop) {\n                    // https://github.com/facebook/react/issues/20030\n                    case '$$typeof':\n                        return undefined;\n                    case 'toJSON':\n                        return () => ({});\n                    case 'addListener':\n                        return pluginHeader ? addListenerNative : addListener;\n                    case 'removeListener':\n                        return removeListener;\n                    default:\n                        return createPluginMethodWrapper(prop);\n                }\n            },\n        });\n        Plugins[pluginName] = proxy;\n        registeredPlugins.set(pluginName, {\n            name: pluginName,\n            proxy,\n            platforms: new Set([...Object.keys(jsImplementations), ...(pluginHeader ? [platform] : [])]),\n        });\n        return proxy;\n    };\n    // Add in convertFileSrc for web, it will already be available in native context\n    if (!cap.convertFileSrc) {\n        cap.convertFileSrc = (filePath) => filePath;\n    }\n    cap.getPlatform = getPlatform;\n    cap.handleError = handleError;\n    cap.isNativePlatform = isNativePlatform;\n    cap.isPluginAvailable = isPluginAvailable;\n    cap.registerPlugin = registerPlugin;\n    cap.Exception = CapacitorException;\n    cap.DEBUG = !!cap.DEBUG;\n    cap.isLoggingEnabled = !!cap.isLoggingEnabled;\n    return cap;\n};\nconst initCapacitorGlobal = (win) => (win.Capacitor = createCapacitor(win));\n\nconst Capacitor = /*#__PURE__*/ initCapacitorGlobal(typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof self !== 'undefined'\n        ? self\n        : typeof window !== 'undefined'\n            ? window\n            : typeof global !== 'undefined'\n                ? global\n                : {});\nconst registerPlugin = Capacitor.registerPlugin;\n\n/**\n * Base class web plugins should extend.\n */\nclass WebPlugin {\n    constructor() {\n        this.listeners = {};\n        this.retainedEventArguments = {};\n        this.windowListeners = {};\n    }\n    addListener(eventName, listenerFunc) {\n        let firstListener = false;\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            this.listeners[eventName] = [];\n            firstListener = true;\n        }\n        this.listeners[eventName].push(listenerFunc);\n        // If we haven't added a window listener for this event and it requires one,\n        // go ahead and add it\n        const windowListener = this.windowListeners[eventName];\n        if (windowListener && !windowListener.registered) {\n            this.addWindowListener(windowListener);\n        }\n        if (firstListener) {\n            this.sendRetainedArgumentsForEvent(eventName);\n        }\n        const remove = async () => this.removeListener(eventName, listenerFunc);\n        const p = Promise.resolve({ remove });\n        return p;\n    }\n    async removeAllListeners() {\n        this.listeners = {};\n        for (const listener in this.windowListeners) {\n            this.removeWindowListener(this.windowListeners[listener]);\n        }\n        this.windowListeners = {};\n    }\n    notifyListeners(eventName, data, retainUntilConsumed) {\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            if (retainUntilConsumed) {\n                let args = this.retainedEventArguments[eventName];\n                if (!args) {\n                    args = [];\n                }\n                args.push(data);\n                this.retainedEventArguments[eventName] = args;\n            }\n            return;\n        }\n        listeners.forEach((listener) => listener(data));\n    }\n    hasListeners(eventName) {\n        var _a;\n        return !!((_a = this.listeners[eventName]) === null || _a === void 0 ? void 0 : _a.length);\n    }\n    registerWindowListener(windowEventName, pluginEventName) {\n        this.windowListeners[pluginEventName] = {\n            registered: false,\n            windowEventName,\n            pluginEventName,\n            handler: (event) => {\n                this.notifyListeners(pluginEventName, event);\n            },\n        };\n    }\n    unimplemented(msg = 'not implemented') {\n        return new Capacitor.Exception(msg, ExceptionCode.Unimplemented);\n    }\n    unavailable(msg = 'not available') {\n        return new Capacitor.Exception(msg, ExceptionCode.Unavailable);\n    }\n    async removeListener(eventName, listenerFunc) {\n        const listeners = this.listeners[eventName];\n        if (!listeners) {\n            return;\n        }\n        const index = listeners.indexOf(listenerFunc);\n        this.listeners[eventName].splice(index, 1);\n        // If there are no more listeners for this type of event,\n        // remove the window listener\n        if (!this.listeners[eventName].length) {\n            this.removeWindowListener(this.windowListeners[eventName]);\n        }\n    }\n    addWindowListener(handle) {\n        window.addEventListener(handle.windowEventName, handle.handler);\n        handle.registered = true;\n    }\n    removeWindowListener(handle) {\n        if (!handle) {\n            return;\n        }\n        window.removeEventListener(handle.windowEventName, handle.handler);\n        handle.registered = false;\n    }\n    sendRetainedArgumentsForEvent(eventName) {\n        const args = this.retainedEventArguments[eventName];\n        if (!args) {\n            return;\n        }\n        delete this.retainedEventArguments[eventName];\n        args.forEach((arg) => {\n            this.notifyListeners(eventName, arg);\n        });\n    }\n}\n\nconst WebView = /*#__PURE__*/ registerPlugin('WebView');\n/******** END WEB VIEW PLUGIN ********/\n/******** COOKIES PLUGIN ********/\n/**\n * Safely web encode a string value (inspired by js-cookie)\n * @param str The string value to encode\n */\nconst encode = (str) => encodeURIComponent(str)\n    .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n    .replace(/[()]/g, escape);\n/**\n * Safely web decode a string value (inspired by js-cookie)\n * @param str The string value to decode\n */\nconst decode = (str) => str.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent);\nclass CapacitorCookiesPluginWeb extends WebPlugin {\n    async getCookies() {\n        const cookies = document.cookie;\n        const cookieMap = {};\n        cookies.split(';').forEach((cookie) => {\n            if (cookie.length <= 0)\n                return;\n            // Replace first \"=\" with CAP_COOKIE to prevent splitting on additional \"=\"\n            let [key, value] = cookie.replace(/=/, 'CAP_COOKIE').split('CAP_COOKIE');\n            key = decode(key).trim();\n            value = decode(value).trim();\n            cookieMap[key] = value;\n        });\n        return cookieMap;\n    }\n    async setCookie(options) {\n        try {\n            // Safely Encoded Key/Value\n            const encodedKey = encode(options.key);\n            const encodedValue = encode(options.value);\n            // Clean & sanitize options\n            const expires = `; expires=${(options.expires || '').replace('expires=', '')}`; // Default is \"; expires=\"\n            const path = (options.path || '/').replace('path=', ''); // Default is \"path=/\"\n            const domain = options.url != null && options.url.length > 0 ? `domain=${options.url}` : '';\n            document.cookie = `${encodedKey}=${encodedValue || ''}${expires}; path=${path}; ${domain};`;\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async deleteCookie(options) {\n        try {\n            document.cookie = `${options.key}=; Max-Age=0`;\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async clearCookies() {\n        try {\n            const cookies = document.cookie.split(';') || [];\n            for (const cookie of cookies) {\n                document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date().toUTCString()};path=/`);\n            }\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n    async clearAllCookies() {\n        try {\n            await this.clearCookies();\n        }\n        catch (error) {\n            return Promise.reject(error);\n        }\n    }\n}\nconst CapacitorCookies = registerPlugin('CapacitorCookies', {\n    web: () => new CapacitorCookiesPluginWeb(),\n});\n// UTILITY FUNCTIONS\n/**\n * Read in a Blob value and return it as a base64 string\n * @param blob The blob value to convert to a base64 string\n */\nconst readBlobAsBase64 = async (blob) => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n        const base64String = reader.result;\n        // remove prefix \"data:application/pdf;base64,\"\n        resolve(base64String.indexOf(',') >= 0 ? base64String.split(',')[1] : base64String);\n    };\n    reader.onerror = (error) => reject(error);\n    reader.readAsDataURL(blob);\n});\n/**\n * Normalize an HttpHeaders map by lowercasing all of the values\n * @param headers The HttpHeaders object to normalize\n */\nconst normalizeHttpHeaders = (headers = {}) => {\n    const originalKeys = Object.keys(headers);\n    const loweredKeys = Object.keys(headers).map((k) => k.toLocaleLowerCase());\n    const normalized = loweredKeys.reduce((acc, key, index) => {\n        acc[key] = headers[originalKeys[index]];\n        return acc;\n    }, {});\n    return normalized;\n};\n/**\n * Builds a string of url parameters that\n * @param params A map of url parameters\n * @param shouldEncode true if you should encodeURIComponent() the values (true by default)\n */\nconst buildUrlParams = (params, shouldEncode = true) => {\n    if (!params)\n        return null;\n    const output = Object.entries(params).reduce((accumulator, entry) => {\n        const [key, value] = entry;\n        let encodedValue;\n        let item;\n        if (Array.isArray(value)) {\n            item = '';\n            value.forEach((str) => {\n                encodedValue = shouldEncode ? encodeURIComponent(str) : str;\n                item += `${key}=${encodedValue}&`;\n            });\n            // last character will always be \"&\" so slice it off\n            item.slice(0, -1);\n        }\n        else {\n            encodedValue = shouldEncode ? encodeURIComponent(value) : value;\n            item = `${key}=${encodedValue}`;\n        }\n        return `${accumulator}&${item}`;\n    }, '');\n    // Remove initial \"&\" from the reduce\n    return output.substr(1);\n};\n/**\n * Build the RequestInit object based on the options passed into the initial request\n * @param options The Http plugin options\n * @param extra Any extra RequestInit values\n */\nconst buildRequestInit = (options, extra = {}) => {\n    const output = Object.assign({ method: options.method || 'GET', headers: options.headers }, extra);\n    // Get the content-type\n    const headers = normalizeHttpHeaders(options.headers);\n    const type = headers['content-type'] || '';\n    // If body is already a string, then pass it through as-is.\n    if (typeof options.data === 'string') {\n        output.body = options.data;\n    }\n    // Build request initializers based off of content-type\n    else if (type.includes('application/x-www-form-urlencoded')) {\n        const params = new URLSearchParams();\n        for (const [key, value] of Object.entries(options.data || {})) {\n            params.set(key, value);\n        }\n        output.body = params.toString();\n    }\n    else if (type.includes('multipart/form-data') || options.data instanceof FormData) {\n        const form = new FormData();\n        if (options.data instanceof FormData) {\n            options.data.forEach((value, key) => {\n                form.append(key, value);\n            });\n        }\n        else {\n            for (const key of Object.keys(options.data)) {\n                form.append(key, options.data[key]);\n            }\n        }\n        output.body = form;\n        const headers = new Headers(output.headers);\n        headers.delete('content-type'); // content-type will be set by `window.fetch` to includy boundary\n        output.headers = headers;\n    }\n    else if (type.includes('application/json') || typeof options.data === 'object') {\n        output.body = JSON.stringify(options.data);\n    }\n    return output;\n};\n// WEB IMPLEMENTATION\nclass CapacitorHttpPluginWeb extends WebPlugin {\n    /**\n     * Perform an Http request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async request(options) {\n        const requestInit = buildRequestInit(options, options.webFetchExtra);\n        const urlParams = buildUrlParams(options.params, options.shouldEncodeUrlParams);\n        const url = urlParams ? `${options.url}?${urlParams}` : options.url;\n        const response = await fetch(url, requestInit);\n        const contentType = response.headers.get('content-type') || '';\n        // Default to 'text' responseType so no parsing happens\n        let { responseType = 'text' } = response.ok ? options : {};\n        // If the response content-type is json, force the response to be json\n        if (contentType.includes('application/json')) {\n            responseType = 'json';\n        }\n        let data;\n        let blob;\n        switch (responseType) {\n            case 'arraybuffer':\n            case 'blob':\n                blob = await response.blob();\n                data = await readBlobAsBase64(blob);\n                break;\n            case 'json':\n                data = await response.json();\n                break;\n            case 'document':\n            case 'text':\n            default:\n                data = await response.text();\n        }\n        // Convert fetch headers to Capacitor HttpHeaders\n        const headers = {};\n        response.headers.forEach((value, key) => {\n            headers[key] = value;\n        });\n        return {\n            data,\n            headers,\n            status: response.status,\n            url: response.url,\n        };\n    }\n    /**\n     * Perform an Http GET request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async get(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'GET' }));\n    }\n    /**\n     * Perform an Http POST request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async post(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'POST' }));\n    }\n    /**\n     * Perform an Http PUT request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async put(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'PUT' }));\n    }\n    /**\n     * Perform an Http PATCH request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async patch(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'PATCH' }));\n    }\n    /**\n     * Perform an Http DELETE request given a set of options\n     * @param options Options to build the HTTP request\n     */\n    async delete(options) {\n        return this.request(Object.assign(Object.assign({}, options), { method: 'DELETE' }));\n    }\n}\nconst CapacitorHttp = registerPlugin('CapacitorHttp', {\n    web: () => new CapacitorHttpPluginWeb(),\n});\n/******** END HTTP PLUGIN ********/\n/******** SYSTEM BARS PLUGIN ********/\n/**\n * Available status bar styles.\n */\nvar SystemBarsStyle;\n(function (SystemBarsStyle) {\n    /**\n     * Light system bar content on a dark background.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Dark\"] = \"DARK\";\n    /**\n     * For dark system bar content on a light background.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Light\"] = \"LIGHT\";\n    /**\n     * The style is based on the device appearance or the underlying content.\n     * If the device is using Dark mode, the system bars content will be light.\n     * If the device is using Light mode, the system bars content will be dark.\n     *\n     * @since 8.0.0\n     */\n    SystemBarsStyle[\"Default\"] = \"DEFAULT\";\n})(SystemBarsStyle || (SystemBarsStyle = {}));\n/**\n * Available system bar types.\n */\nvar SystemBarType;\n(function (SystemBarType) {\n    /**\n     * The top status bar on both Android and iOS.\n     *\n     * @since 8.0.0\n     */\n    SystemBarType[\"StatusBar\"] = \"StatusBar\";\n    /**\n     * The navigation bar (or gesture bar on iOS) on both Android and iOS.\n     *\n     * @since 8.0.0\n     */\n    SystemBarType[\"NavigationBar\"] = \"NavigationBar\";\n})(SystemBarType || (SystemBarType = {}));\nclass SystemBarsPluginWeb extends WebPlugin {\n    async setStyle() {\n        this.unavailable('not available for web');\n    }\n    async setAnimation() {\n        this.unavailable('not available for web');\n    }\n    async show() {\n        this.unavailable('not available for web');\n    }\n    async hide() {\n        this.unavailable('not available for web');\n    }\n}\nconst SystemBars = registerPlugin('SystemBars', {\n    web: () => new SystemBarsPluginWeb(),\n});\n/******** END SYSTEM BARS PLUGIN ********/\n\nexport { Capacitor, CapacitorCookies, CapacitorException, CapacitorHttp, ExceptionCode, SystemBarType, SystemBars, SystemBarsStyle, WebPlugin, WebView, buildRequestInit, registerPlugin };\n//# sourceMappingURL=index.js.map\n","/**\r\n * Android scan mode\r\n */\r\nexport var ScanMode;\r\n(function (ScanMode) {\r\n    /**\r\n     * Perform Bluetooth LE scan in low power mode. This mode is enforced if the scanning application is not in foreground.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_LOW_POWER\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_LOW_POWER\"] = 0] = \"SCAN_MODE_LOW_POWER\";\r\n    /**\r\n     * Perform Bluetooth LE scan in balanced power mode. (default) Scan results are returned at a rate that provides a good trade-off between scan frequency and power consumption.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_BALANCED\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_BALANCED\"] = 1] = \"SCAN_MODE_BALANCED\";\r\n    /**\r\n     * Scan using highest duty cycle. It's recommended to only use this mode when the application is running in the foreground.\r\n     * https://developer.android.com/reference/android/bluetooth/le/ScanSettings#SCAN_MODE_LOW_LATENCY\r\n     */\r\n    ScanMode[ScanMode[\"SCAN_MODE_LOW_LATENCY\"] = 2] = \"SCAN_MODE_LOW_LATENCY\";\r\n})(ScanMode || (ScanMode = {}));\r\n/**\r\n * Android connection priority used in `requestConnectionPriority`\r\n */\r\nexport var ConnectionPriority;\r\n(function (ConnectionPriority) {\r\n    /**\r\n     * Use the connection parameters recommended by the Bluetooth SIG. This is the default value if no connection parameter update is requested.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_BALANCED\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_BALANCED\"] = 0] = \"CONNECTION_PRIORITY_BALANCED\";\r\n    /**\r\n     * Request a high priority, low latency connection. An application should only request high priority connection parameters to transfer large amounts of data over LE quickly. Once the transfer is complete, the application should request CONNECTION_PRIORITY_BALANCED connection parameters to reduce energy use.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_HIGH\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_HIGH\"] = 1] = \"CONNECTION_PRIORITY_HIGH\";\r\n    /**\r\n     * Request low power, reduced data rate connection parameters.\r\n     * https://developer.android.com/reference/android/bluetooth/BluetoothGatt#CONNECTION_PRIORITY_LOW_POWER\r\n     */\r\n    ConnectionPriority[ConnectionPriority[\"CONNECTION_PRIORITY_LOW_POWER\"] = 2] = \"CONNECTION_PRIORITY_LOW_POWER\";\r\n})(ConnectionPriority || (ConnectionPriority = {}));\r\n//# sourceMappingURL=definitions.js.map","/**\r\n * Convert an array of numbers into a DataView.\r\n */\r\nexport function numbersToDataView(value) {\r\n    return new DataView(Uint8Array.from(value).buffer);\r\n}\r\n/**\r\n * Convert a DataView into an array of numbers.\r\n */\r\nexport function dataViewToNumbers(value) {\r\n    return Array.from(new Uint8Array(value.buffer, value.byteOffset, value.byteLength));\r\n}\r\n/**\r\n * Convert a string into a DataView.\r\n */\r\nexport function textToDataView(value) {\r\n    return numbersToDataView(value.split('').map((s) => s.charCodeAt(0)));\r\n}\r\n/**\r\n * Convert a DataView into a string.\r\n */\r\nexport function dataViewToText(value) {\r\n    return String.fromCharCode(...dataViewToNumbers(value));\r\n}\r\n/**\r\n * Convert a 16 bit UUID into a 128 bit UUID string\r\n * @param value number, e.g. 0x180d\r\n * @return string, e.g. '0000180d-0000-1000-8000-00805f9b34fb'\r\n */\r\nexport function numberToUUID(value) {\r\n    return `0000${value.toString(16).padStart(4, '0')}-0000-1000-8000-00805f9b34fb`;\r\n}\r\n/**\r\n * Convert a string of hex into a DataView of raw bytes.\r\n * Note: characters other than [0-9a-fA-F] are ignored\r\n * @param hex string of values, e.g. \"00 01 02\" or \"000102\"\r\n * @return DataView of raw bytes\r\n */\r\nexport function hexStringToDataView(hex) {\r\n    const bin = [];\r\n    let i, c, isEmpty = 1, buffer = 0;\r\n    for (i = 0; i < hex.length; i++) {\r\n        c = hex.charCodeAt(i);\r\n        if ((c > 47 && c < 58) || (c > 64 && c < 71) || (c > 96 && c < 103)) {\r\n            buffer = (buffer << 4) ^ ((c > 64 ? c + 9 : c) & 15);\r\n            if ((isEmpty ^= 1)) {\r\n                bin.push(buffer & 0xff);\r\n            }\r\n        }\r\n    }\r\n    return numbersToDataView(bin);\r\n}\r\nexport function dataViewToHexString(value) {\r\n    return dataViewToNumbers(value)\r\n        .map((n) => {\r\n        let s = n.toString(16);\r\n        if (s.length == 1) {\r\n            s = '0' + s;\r\n        }\r\n        return s;\r\n    })\r\n        .join('');\r\n}\r\nexport function webUUIDToString(uuid) {\r\n    if (typeof uuid === 'string') {\r\n        return uuid;\r\n    }\r\n    else if (typeof uuid === 'number') {\r\n        return numberToUUID(uuid);\r\n    }\r\n    else {\r\n        throw new Error('Invalid UUID');\r\n    }\r\n}\r\nexport function mapToObject(map) {\r\n    const obj = {};\r\n    if (!map) {\r\n        return undefined;\r\n    }\r\n    map.forEach((value, key) => {\r\n        obj[key.toString()] = value;\r\n    });\r\n    return obj;\r\n}\r\n/**\r\n * Convert Data or Uint8Array to Uint8Array.\r\n * @param value DataView, Uint8Array, or undefined\r\n * @return Uint8Array or undefined\r\n */\r\nexport function toUint8Array(value) {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (typeof value === 'string') {\r\n        const dataView = hexStringToDataView(value);\r\n        return new Uint8Array(dataView.buffer, dataView.byteOffset, dataView.byteLength);\r\n    }\r\n    if (value instanceof DataView) {\r\n        return new Uint8Array(value.buffer, value.byteOffset, value.byteLength);\r\n    }\r\n    return value; // Already Uint8Array\r\n}\r\n/**\r\n * Convert Data, Uint8Array, or string to hex string.\r\n * @param value DataView, Uint8Array, or undefined\r\n * @return hex string or undefined\r\n */\r\nexport function toHexString(value) {\r\n    if (value === undefined) {\r\n        return undefined;\r\n    }\r\n    if (value instanceof DataView) {\r\n        return dataViewToHexString(value);\r\n    }\r\n    // Uint8Array\r\n    return dataViewToHexString(new DataView(value.buffer, value.byteOffset, value.byteLength));\r\n}\r\n//# sourceMappingURL=conversion.js.map","import { registerPlugin } from '@capacitor/core';\r\nexport const BluetoothLe = registerPlugin('BluetoothLe', {\r\n    web: () => import('./web').then((m) => new m.BluetoothLeWeb()),\r\n});\r\n//# sourceMappingURL=plugin.js.map","const makeQueue = () => {\r\n    let currentTask = Promise.resolve();\r\n    // create a new promise so that errors can be bubbled\r\n    // up to the caller without being caught by the queue\r\n    return (fn) => new Promise((resolve, reject) => {\r\n        currentTask = currentTask\r\n            .then(() => fn())\r\n            .then(resolve)\r\n            .catch(reject);\r\n    });\r\n};\r\nexport function getQueue(enabled) {\r\n    if (enabled) {\r\n        return makeQueue();\r\n    }\r\n    return (fn) => fn();\r\n}\r\n//# sourceMappingURL=queue.js.map","export function parseUUID(uuid) {\r\n    if (typeof uuid !== 'string') {\r\n        throw new Error(`Invalid UUID type ${typeof uuid}. Expected string.`);\r\n    }\r\n    uuid = uuid.toLowerCase();\r\n    const is128BitUuid = uuid.search(/^[0-9a-f]{8}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{12}$/) >= 0;\r\n    if (!is128BitUuid) {\r\n        throw new Error(`Invalid UUID format ${uuid}. Expected 128 bit string (e.g. \"0000180d-0000-1000-8000-00805f9b34fb\").`);\r\n    }\r\n    return uuid;\r\n}\r\n//# sourceMappingURL=validators.js.map","import { Capacitor } from '@capacitor/core';\r\nimport { dataViewToHexString, hexStringToDataView, toUint8Array, toHexString } from './conversion';\r\nimport { BluetoothLe } from './plugin';\r\nimport { getQueue } from './queue';\r\nimport { parseUUID } from './validators';\r\nclass BleClientClass {\r\n    constructor() {\r\n        this.scanListener = null;\r\n        this.eventListeners = new Map();\r\n        this.queue = getQueue(true);\r\n    }\r\n    enableQueue() {\r\n        this.queue = getQueue(true);\r\n    }\r\n    disableQueue() {\r\n        this.queue = getQueue(false);\r\n    }\r\n    async initialize(options) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.initialize(options);\r\n        });\r\n    }\r\n    async isEnabled() {\r\n        const enabled = await this.queue(async () => {\r\n            const result = await BluetoothLe.isEnabled();\r\n            return result.value;\r\n        });\r\n        return enabled;\r\n    }\r\n    async requestEnable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.requestEnable();\r\n        });\r\n    }\r\n    async enable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.enable();\r\n        });\r\n    }\r\n    async disable() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.disable();\r\n        });\r\n    }\r\n    async startEnabledNotifications(callback) {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `onEnabledChanged`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            const listener = await BluetoothLe.addListener(key, (result) => {\r\n                callback(result.value);\r\n            });\r\n            this.eventListeners.set(key, listener);\r\n            await BluetoothLe.startEnabledNotifications();\r\n        });\r\n    }\r\n    async stopEnabledNotifications() {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `onEnabledChanged`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.eventListeners.delete(key);\r\n            await BluetoothLe.stopEnabledNotifications();\r\n        });\r\n    }\r\n    async isLocationEnabled() {\r\n        const enabled = await this.queue(async () => {\r\n            const result = await BluetoothLe.isLocationEnabled();\r\n            return result.value;\r\n        });\r\n        return enabled;\r\n    }\r\n    async openLocationSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openLocationSettings();\r\n        });\r\n    }\r\n    async openBluetoothSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openBluetoothSettings();\r\n        });\r\n    }\r\n    async openAppSettings() {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.openAppSettings();\r\n        });\r\n    }\r\n    async setDisplayStrings(displayStrings) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.setDisplayStrings(displayStrings);\r\n        });\r\n    }\r\n    async requestDevice(options) {\r\n        options = options ? this.validateRequestBleDeviceOptions(options) : undefined;\r\n        const result = await this.queue(async () => {\r\n            const device = await BluetoothLe.requestDevice(options);\r\n            return device;\r\n        });\r\n        return result;\r\n    }\r\n    async requestLEScan(options, callback) {\r\n        options = this.validateRequestBleDeviceOptions(options);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            await ((_a = this.scanListener) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.scanListener = await BluetoothLe.addListener('onScanResult', (resultInternal) => {\r\n                const result = Object.assign(Object.assign({}, resultInternal), { manufacturerData: this.convertObject(resultInternal.manufacturerData), serviceData: this.convertObject(resultInternal.serviceData), rawAdvertisement: resultInternal.rawAdvertisement\r\n                        ? this.convertValue(resultInternal.rawAdvertisement)\r\n                        : undefined });\r\n                callback(result);\r\n            });\r\n            await BluetoothLe.requestLEScan(options);\r\n        });\r\n    }\r\n    async stopLEScan() {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            await ((_a = this.scanListener) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.scanListener = null;\r\n            await BluetoothLe.stopLEScan();\r\n        });\r\n    }\r\n    async getDevices(deviceIds) {\r\n        if (!Array.isArray(deviceIds)) {\r\n            throw new Error('deviceIds must be an array');\r\n        }\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getDevices({ deviceIds });\r\n            return result.devices;\r\n        });\r\n    }\r\n    async getConnectedDevices(services) {\r\n        if (!Array.isArray(services)) {\r\n            throw new Error('services must be an array');\r\n        }\r\n        services = services.map(parseUUID);\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getConnectedDevices({ services });\r\n            return result.devices;\r\n        });\r\n    }\r\n    async getBondedDevices() {\r\n        return this.queue(async () => {\r\n            const result = await BluetoothLe.getBondedDevices();\r\n            return result.devices;\r\n        });\r\n    }\r\n    async connect(deviceId, onDisconnect, options) {\r\n        await this.queue(async () => {\r\n            var _a;\r\n            if (onDisconnect) {\r\n                const key = `disconnected|${deviceId}`;\r\n                await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n                const listener = await BluetoothLe.addListener(key, () => {\r\n                    onDisconnect(deviceId);\r\n                });\r\n                this.eventListeners.set(key, listener);\r\n            }\r\n            await BluetoothLe.connect(Object.assign({ deviceId }, options));\r\n        });\r\n    }\r\n    async createBond(deviceId, options) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.createBond(Object.assign({ deviceId }, options));\r\n        });\r\n    }\r\n    async isBonded(deviceId) {\r\n        const isBonded = await this.queue(async () => {\r\n            const result = await BluetoothLe.isBonded({ deviceId });\r\n            return result.value;\r\n        });\r\n        return isBonded;\r\n    }\r\n    async disconnect(deviceId) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.disconnect({ deviceId });\r\n        });\r\n    }\r\n    async getServices(deviceId) {\r\n        const services = await this.queue(async () => {\r\n            const result = await BluetoothLe.getServices({ deviceId });\r\n            return result.services;\r\n        });\r\n        return services;\r\n    }\r\n    async discoverServices(deviceId) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.discoverServices({ deviceId });\r\n        });\r\n    }\r\n    async getMtu(deviceId) {\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.getMtu({ deviceId });\r\n            return result.value;\r\n        });\r\n        return value;\r\n    }\r\n    async requestConnectionPriority(deviceId, connectionPriority) {\r\n        await this.queue(async () => {\r\n            await BluetoothLe.requestConnectionPriority({ deviceId, connectionPriority });\r\n        });\r\n    }\r\n    async readRssi(deviceId) {\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.readRssi({ deviceId });\r\n            return parseFloat(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async read(deviceId, service, characteristic, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.read(Object.assign({ deviceId,\r\n                service,\r\n                characteristic }, options));\r\n            return this.convertValue(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async write(deviceId, service, characteristic, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        return this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.write(Object.assign({ deviceId,\r\n                service,\r\n                characteristic, value: writeValue }, options));\r\n        });\r\n    }\r\n    async writeWithoutResponse(deviceId, service, characteristic, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.writeWithoutResponse(Object.assign({ deviceId,\r\n                service,\r\n                characteristic, value: writeValue }, options));\r\n        });\r\n    }\r\n    async readDescriptor(deviceId, service, characteristic, descriptor, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        descriptor = parseUUID(descriptor);\r\n        const value = await this.queue(async () => {\r\n            const result = await BluetoothLe.readDescriptor(Object.assign({ deviceId,\r\n                service,\r\n                characteristic,\r\n                descriptor }, options));\r\n            return this.convertValue(result.value);\r\n        });\r\n        return value;\r\n    }\r\n    async writeDescriptor(deviceId, service, characteristic, descriptor, value, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        descriptor = parseUUID(descriptor);\r\n        return this.queue(async () => {\r\n            if (!(value === null || value === void 0 ? void 0 : value.buffer)) {\r\n                throw new Error('Invalid data.');\r\n            }\r\n            let writeValue = value;\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // on native we can only write strings\r\n                writeValue = dataViewToHexString(value);\r\n            }\r\n            await BluetoothLe.writeDescriptor(Object.assign({ deviceId,\r\n                service,\r\n                characteristic,\r\n                descriptor, value: writeValue }, options));\r\n        });\r\n    }\r\n    async startNotifications(deviceId, service, characteristic, callback, options) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `notification|${deviceId}|${service}|${characteristic}`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            const listener = await BluetoothLe.addListener(key, (event) => {\r\n                callback(this.convertValue(event === null || event === void 0 ? void 0 : event.value));\r\n            });\r\n            this.eventListeners.set(key, listener);\r\n            await BluetoothLe.startNotifications(Object.assign({ deviceId,\r\n                service,\r\n                characteristic }, options));\r\n        });\r\n    }\r\n    async stopNotifications(deviceId, service, characteristic) {\r\n        service = parseUUID(service);\r\n        characteristic = parseUUID(characteristic);\r\n        await this.queue(async () => {\r\n            var _a;\r\n            const key = `notification|${deviceId}|${service}|${characteristic}`;\r\n            await ((_a = this.eventListeners.get(key)) === null || _a === void 0 ? void 0 : _a.remove());\r\n            this.eventListeners.delete(key);\r\n            await BluetoothLe.stopNotifications({\r\n                deviceId,\r\n                service,\r\n                characteristic,\r\n            });\r\n        });\r\n    }\r\n    validateRequestBleDeviceOptions(options) {\r\n        if (options.services) {\r\n            options.services = options.services.map(parseUUID);\r\n        }\r\n        if (options.optionalServices) {\r\n            options.optionalServices = options.optionalServices.map(parseUUID);\r\n        }\r\n        if (options.serviceData && Capacitor.getPlatform() !== 'web') {\r\n            // Native platforms: convert to hex strings\r\n            options.serviceData = options.serviceData.map((filter) => (Object.assign(Object.assign({}, filter), { serviceUuid: parseUUID(filter.serviceUuid), dataPrefix: toHexString(filter.dataPrefix), mask: toHexString(filter.mask) })));\r\n        }\r\n        if (options.manufacturerData) {\r\n            if (Capacitor.getPlatform() !== 'web') {\r\n                // Native platforms: convert to hex strings\r\n                options.manufacturerData = options.manufacturerData.map((filter) => (Object.assign(Object.assign({}, filter), { dataPrefix: toHexString(filter.dataPrefix), mask: toHexString(filter.mask) })));\r\n            }\r\n            else {\r\n                // Web platform: convert to Uint8Array for Web Bluetooth API\r\n                options.manufacturerData = options.manufacturerData.map((filter) => (Object.assign(Object.assign({}, filter), { dataPrefix: toUint8Array(filter.dataPrefix), mask: toUint8Array(filter.mask) })));\r\n            }\r\n        }\r\n        return options;\r\n    }\r\n    convertValue(value) {\r\n        if (typeof value === 'string') {\r\n            return hexStringToDataView(value);\r\n        }\r\n        else if (value === undefined) {\r\n            return new DataView(new ArrayBuffer(0));\r\n        }\r\n        return value;\r\n    }\r\n    convertObject(obj) {\r\n        if (obj === undefined) {\r\n            return undefined;\r\n        }\r\n        const result = {};\r\n        for (const key of Object.keys(obj)) {\r\n            result[key] = this.convertValue(obj[key]);\r\n        }\r\n        return result;\r\n    }\r\n}\r\nexport const BleClient = new BleClientClass();\r\n//# sourceMappingURL=bleClient.js.map","import { BleClient } from '@capacitor-community/bluetooth-le';\nimport type { SensorConnection, MeasurementListener, ConnectionStatusListener, ConnectionStatus } from '../../types/bluetooth.js';\nimport type { Measurement } from '../../types/measurements.js';\n\nconst CYCLING_POWER_SERVICE = '00001818-0000-1000-8000-00805f9b34fb';\nconst CYCLING_POWER_MEASUREMENT = '00002a63-0000-1000-8000-00805f9b34fb';\n\nconst HEART_RATE_SERVICE = '0000180d-0000-1000-8000-00805f9b34fb';\nconst HEART_RATE_MEASUREMENT = '00002a37-0000-1000-8000-00805f9b34fb';\n\nconst CYCLING_SPEED_AND_CADENCE_SERVICE = '00001816-0000-1000-8000-00805f9b34fb';\nconst CSC_MEASUREMENT = '00002a5b-0000-1000-8000-00805f9b34fb';\n\n/** Maximum reconnection attempts before giving up */\nconst MAX_RECONNECT_ATTEMPTS = 5;\n/** Base delay between reconnection attempts (ms) */\nconst RECONNECT_BASE_DELAY = 1000;\n\nexport const connectPowerNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await BleClient.initialize();\n\n    const device = await BleClient.requestDevice({\n        services: [CYCLING_POWER_SERVICE],\n        optionalServices: [CYCLING_POWER_SERVICE]\n    });\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Power Sensor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            CYCLING_POWER_SERVICE,\n            CYCLING_POWER_MEASUREMENT,\n            (value) => {\n                // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n                const power = value.getInt16(2, true);\n                const entry: Measurement = { timestamp: Date.now(), value: power };\n                listeners.forEach(listener => listener(entry));\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Power sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Power sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Power sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Power sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Power sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, CYCLING_POWER_SERVICE, CYCLING_POWER_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectHeartRateNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await BleClient.initialize();\n\n    const device = await BleClient.requestDevice({\n        services: [HEART_RATE_SERVICE],\n        optionalServices: [HEART_RATE_SERVICE]\n    });\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Heart Rate Monitor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            HEART_RATE_SERVICE,\n            HEART_RATE_MEASUREMENT,\n            (value) => {\n                const flags = value.getUint8(0);\n                let heartRate: number;\n\n                // Check Heart Rate Value Format bit (bit 0)\n                if (flags & 0x01) {\n                    // UINT16\n                    heartRate = value.getUint16(1, true); // little-endian\n                } else {\n                    // UINT8\n                    heartRate = value.getUint8(1);\n                }\n\n                const entry: Measurement = { timestamp: Date.now(), value: heartRate };\n                listeners.forEach(listener => listener(entry));\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Heart Rate sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Heart Rate sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Heart Rate sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Heart Rate sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Heart Rate sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, HEART_RATE_SERVICE, HEART_RATE_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n\nexport const connectCadenceNative = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let deviceId: string | null = null;\n    let lastCrankRevs: number | null = null;\n    let lastCrankTime: number | null = null;\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n\n    await BleClient.initialize();\n\n    const device = await BleClient.requestDevice({\n        services: [CYCLING_SPEED_AND_CADENCE_SERVICE],\n        optionalServices: [CYCLING_SPEED_AND_CADENCE_SERVICE]\n    });\n\n    deviceId = device.deviceId;\n    const deviceName = device.name || 'Cadence Sensor';\n\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    const connect = async (): Promise<void> => {\n        if (!deviceId) return;\n        await BleClient.connect(deviceId, onDisconnect);\n        notifyStatus('connected');\n\n        await BleClient.startNotifications(\n            deviceId,\n            CYCLING_SPEED_AND_CADENCE_SERVICE,\n            CSC_MEASUREMENT,\n            (value) => {\n                const flags = value.getUint8(0);\n\n                // Check if crank revolution data is present (bit 1 of flags)\n                if (flags & 0x02) {\n                    let offset = 1; // Start after flags byte\n\n                    // If wheel revolution data is present (bit 0), skip it (6 bytes: 4 for revs + 2 for time)\n                    if (flags & 0x01) {\n                        offset = 7;\n                    }\n\n                    const crankRevs = value.getUint16(offset, true);\n                    const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n                    // Calculate RPM from delta between measurements\n                    if (lastCrankRevs !== null && lastCrankTime !== null) {\n                        let revDelta = crankRevs - lastCrankRevs;\n                        let timeDelta = crankTime - lastCrankTime;\n\n                        // Handle rollover (uint16 max is 65535)\n                        if (revDelta < 0) revDelta += 65536;\n                        if (timeDelta < 0) timeDelta += 65536;\n\n                        // Calculate RPM: (revolutions / time_in_seconds) * 60\n                        // Time is in 1/1024 seconds, so convert to seconds\n                        if (timeDelta > 0) {\n                            const timeInSeconds = timeDelta / 1024;\n                            const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                            // Sanity check for reasonable cadence values\n                            if (rpm >= 0 && rpm < 300) {\n                                const entry: Measurement = { timestamp: Date.now(), value: rpm };\n                                listeners.forEach(listener => listener(entry));\n                            }\n                        }\n                    }\n\n                    lastCrankRevs = crankRevs;\n                    lastCrankTime = crankTime;\n                }\n            }\n        );\n        reconnectAttempts = 0;\n    };\n\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Native Cadence sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Native Cadence sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Native Cadence sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Native Cadence sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    const onDisconnect = (disconnectedDeviceId: string) => {\n        if (disconnectedDeviceId === deviceId && !isManualDisconnect) {\n            console.log('Native Cadence sensor: Disconnected');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    };\n\n    await connect();\n\n    return {\n        disconnect: async () => {\n            isManualDisconnect = true;\n            if (deviceId) {\n                try {\n                    await BleClient.stopNotifications(deviceId, CYCLING_SPEED_AND_CADENCE_SERVICE, CSC_MEASUREMENT);\n                    await BleClient.disconnect(deviceId);\n                } catch (e) {\n                    console.error('Error disconnecting native bluetooth:', e);\n                }\n            }\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        }\n    };\n};\n","import type { SensorConnection, MeasurementListener, ConnectionStatusListener, ConnectionStatus } from '../../types/bluetooth.js';\nimport type { Measurement } from '../../types/measurements.js';\n\n/** Maximum reconnection attempts before giving up */\nconst MAX_RECONNECT_ATTEMPTS = 5;\n/** Base delay between reconnection attempts (ms) */\nconst RECONNECT_BASE_DELAY = 1000;\n\nexport const connectPowerWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n\n    // Request Bluetooth device with cycling power service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_power'] }],\n        optionalServices: ['cycling_power'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Power Sensor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n        const power = value.getInt16(2, true);\n        const entry: Measurement = { timestamp: Date.now(), value: power };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('cycling_power');\n        characteristic = await service.getCharacteristic('cycling_power_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Power sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Power sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Power sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Power sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Power sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectHeartRateWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n\n    // Request Bluetooth device with heart rate service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['heart_rate'] }],\n        optionalServices: ['heart_rate'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Heart Rate Monitor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        const flags = value.getUint8(0);\n        let heartRate: number;\n\n        // Check Heart Rate Value Format bit (bit 0)\n        if (flags & 0x01) {\n            // UINT16\n            heartRate = value.getUint16(1, true); // little-endian\n        } else {\n            // UINT8\n            heartRate = value.getUint8(1);\n        }\n\n        const entry: Measurement = { timestamp: Date.now(), value: heartRate };\n        listeners.forEach(listener => listener(entry));\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('heart_rate');\n        characteristic = await service.getCharacteristic('heart_rate_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Heart rate sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Heart rate sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Heart rate sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Heart rate sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Heart rate sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n\nexport const connectCadenceWeb = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n    const statusListeners: ConnectionStatusListener[] = [];\n    let isManualDisconnect = false;\n    let reconnectAttempts = 0;\n    let characteristic: BluetoothRemoteGATTCharacteristic | null = null;\n    let lastCrankRevs: number | null = null;\n    let lastCrankTime: number | null = null;\n\n    // Request Bluetooth device with cycling speed and cadence service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_speed_and_cadence'] }],\n        optionalServices: ['cycling_speed_and_cadence'],\n    });\n\n    if (!device.gatt) {\n        throw new Error('GATT server not available');\n    }\n\n    const deviceName = device.name || 'Cadence Sensor';\n\n    /**\n     * Notify status listeners of connection status change\n     */\n    const notifyStatus = (status: ConnectionStatus) => {\n        statusListeners.forEach(listener => listener(status));\n    };\n\n    /**\n     * Handle characteristic value changes\n     */\n    const handleCharacteristicChange = (event: Event) => {\n        const target = event.target as BluetoothRemoteGATTCharacteristic;\n        const value = target.value;\n        if (!value) return;\n\n        const flags = value.getUint8(0);\n\n        // Check if crank revolution data is present (bit 1 of flags)\n        if (flags & 0x02) {\n            // Crank revolution data format:\n            // - Cumulative Crank Revolutions (uint16, bytes 1-2 or 5-6 depending on wheel data)\n            // - Last Crank Event Time (uint16, bytes 3-4 or 7-8, units: 1/1024 seconds)\n\n            let offset = 1; // Start after flags byte\n\n            // If wheel revolution data is present (bit 0), skip it (6 bytes: 4 for revs + 2 for time)\n            if (flags & 0x01) {\n                offset = 7;\n            }\n\n            const crankRevs = value.getUint16(offset, true);\n            const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n            // Calculate RPM from delta between measurements\n            if (lastCrankRevs !== null && lastCrankTime !== null) {\n                let revDelta = crankRevs - lastCrankRevs;\n                let timeDelta = crankTime - lastCrankTime;\n\n                // Handle rollover (uint16 max is 65535)\n                if (revDelta < 0) revDelta += 65536;\n                if (timeDelta < 0) timeDelta += 65536;\n\n                // Calculate RPM: (revolutions / time_in_seconds) * 60\n                // Time is in 1/1024 seconds, so convert to seconds\n                if (timeDelta > 0) {\n                    const timeInSeconds = timeDelta / 1024;\n                    const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                    // Sanity check for reasonable cadence values\n                    if (rpm >= 0 && rpm < 300) {\n                        const entry: Measurement = { timestamp: Date.now(), value: rpm };\n                        listeners.forEach(listener => listener(entry));\n                    }\n                }\n            }\n\n            lastCrankRevs = crankRevs;\n            lastCrankTime = crankTime;\n        }\n    };\n\n    /**\n     * Connect to the device and set up notifications\n     */\n    const connect = async (): Promise<void> => {\n        if (!device.gatt) return;\n\n        const server = await device.gatt.connect();\n        const service = await server.getPrimaryService('cycling_speed_and_cadence');\n        characteristic = await service.getCharacteristic('csc_measurement');\n\n        await characteristic.startNotifications();\n        characteristic.addEventListener('characteristicvaluechanged', handleCharacteristicChange);\n\n        reconnectAttempts = 0;\n        notifyStatus('connected');\n    };\n\n    /**\n     * Attempt to reconnect with exponential backoff\n     */\n    const attemptReconnect = async (): Promise<void> => {\n        if (isManualDisconnect || reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n            if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n                console.error('Cadence sensor: Max reconnection attempts reached');\n                notifyStatus('failed');\n            }\n            return;\n        }\n\n        reconnectAttempts++;\n        const delay = RECONNECT_BASE_DELAY * Math.pow(2, reconnectAttempts - 1);\n        console.log(`Cadence sensor: Reconnection attempt ${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS} in ${delay}ms`);\n        notifyStatus('reconnecting');\n\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        try {\n            await connect();\n            console.log('Cadence sensor: Reconnected successfully');\n        } catch (error) {\n            console.error('Cadence sensor: Reconnection failed:', error);\n            attemptReconnect();\n        }\n    };\n\n    // Handle disconnection events\n    device.addEventListener('gattserverdisconnected', () => {\n        if (!isManualDisconnect) {\n            console.log('Cadence sensor: Connection lost, attempting to reconnect...');\n            notifyStatus('disconnected');\n            attemptReconnect();\n        }\n    });\n\n    // Initial connection\n    await connect();\n\n    return {\n        disconnect: () => {\n            isManualDisconnect = true;\n            if (characteristic) {\n                characteristic.removeEventListener('characteristicvaluechanged', handleCharacteristicChange);\n                characteristic.stopNotifications().catch(() => { });\n            }\n            device.gatt?.disconnect();\n        },\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName,\n        onStatusChange: (callback: ConnectionStatusListener) => {\n            statusListeners.push(callback);\n        },\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { SensorConnection } from '../../types/bluetooth.js';\nimport { connectPowerNative, connectHeartRateNative, connectCadenceNative } from './native-bluetooth.js';\nimport { connectPowerWeb, connectHeartRateWeb, connectCadenceWeb } from './web-bluetooth.js';\n\nexport const BluetoothFactory = {\n    connectPower: async (): Promise<SensorConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectPowerNative();\n        } else {\n            return connectPowerWeb();\n        }\n    },\n    connectHeartRate: async (): Promise<SensorConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectHeartRateNative();\n        } else {\n            return connectHeartRateWeb();\n        }\n    },\n    connectCadence: async (): Promise<SensorConnection> => {\n        if (Capacitor.isNativePlatform()) {\n            return connectCadenceNative();\n        } else {\n            return connectCadenceWeb();\n        }\n    }\n};\n","/**\n * Cadence Sensor Connection Module\n * \n * Connects to Bluetooth cadence sensors supporting the Cycling Speed and Cadence Service.\n * \n * @module connect-cadence\n */\n\nimport type { SensorConnection, MeasurementListener } from './types/bluetooth.js';\nimport type { Measurement } from './types/measurements.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Creates a mock cadence connection for development/testing.\n * Generates random cadence values between 70-110 rpm every second.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectCadenceMock = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n\n    const cadenceInterval = setInterval(() => {\n        const randomCadence = Math.floor(Math.random() * 40) + 70; // 70-110 rpm\n        const entry: Measurement = { timestamp: Date.now(), value: randomCadence };\n        listeners.forEach(listener => listener(entry));\n    }, 1000);\n\n    return {\n        disconnect: () => clearInterval(cadenceInterval),\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName: 'Mock Cadence Sensor',\n    };\n};\n\n/**\n * Connect to a cadence sensor.\n * \n * In development/test mode, uses a mock connection.\n * In production, uses Bluetooth via the Factory (Web or Native).\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectCadence = async (): Promise<SensorConnection> => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectCadenceMock();\n    }\n    return BluetoothFactory.connectCadence();\n};\n","/**\n * Heart Rate Sensor Connection Module\n * \n * Connects to Bluetooth heart rate monitors supporting the Heart Rate Service.\n * \n * @module connect-heartrate\n */\n\nimport type { SensorConnection, MeasurementListener } from './types/bluetooth.js';\nimport type { Measurement } from './types/measurements.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Creates a mock heart rate connection for development/testing.\n * Generates random heart rate values between 120-200 bpm every second.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectHeartRateMock = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n\n    const heartRateInterval = setInterval(() => {\n        const randomHeartRate = Math.floor(Math.random() * 80) + 120; // 120-200 bpm\n        const entry: Measurement = { timestamp: Date.now(), value: randomHeartRate };\n        listeners.forEach(listener => listener(entry));\n    }, 1000);\n\n    return {\n        disconnect: () => clearInterval(heartRateInterval),\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName: 'Mock HR Sensor',\n    };\n};\n\n/**\n * Connect to a heart rate sensor.\n * \n * In development/test mode, uses a mock connection.\n * In production, uses Bluetooth via the Factory (Web or Native).\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectHeartRate = async (): Promise<SensorConnection> => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectHeartRateMock();\n    }\n    return BluetoothFactory.connectHeartRate();\n};\n","/**\n * Power Sensor Connection Module\n * \n * Connects to Bluetooth cycling power meters supporting the Cycling Power Service.\n * \n * @module connect-power\n */\n\nimport type { SensorConnection, MeasurementListener } from './types/bluetooth.js';\nimport type { Measurement } from './types/measurements.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\n\n/**\n * Creates a mock power connection for development/testing.\n * Generates random power values between 100-400W every second.\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectPowerMock = async (): Promise<SensorConnection> => {\n    const listeners: MeasurementListener[] = [];\n\n    const powerInterval = setInterval(() => {\n        const randomPower = Math.floor(Math.random() * 300) + 100; // 100-400W\n        const entry: Measurement = { timestamp: Date.now(), value: randomPower };\n        listeners.forEach(listener => listener(entry));\n    }, 1000);\n\n    return {\n        disconnect: () => clearInterval(powerInterval),\n        addListener: (callback: MeasurementListener) => {\n            listeners.push(callback);\n        },\n        deviceName: 'Mock Power Sensor',\n    };\n};\n\n/**\n * Connect to a power sensor.\n * \n * In development/test mode, uses a mock connection.\n * In production, uses Bluetooth via the Factory (Web or Native).\n * \n * @returns Promise resolving to a sensor connection\n */\nexport const connectPower = async (): Promise<SensorConnection> => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectPowerMock();\n    }\n    return BluetoothFactory.connectPower();\n};\n","import { registerPlugin } from '@capacitor/core';\nimport type { BackgroundGeolocationPlugin, Location, CallbackError } from '@capacitor-community/background-geolocation';\nimport type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nconst BackgroundGeolocation = registerPlugin<BackgroundGeolocationPlugin>('BackgroundGeolocation');\n\nexport const createNativeGpsService = (): GpsService => {\n    let watcherId: string | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            try {\n                watcherId = await BackgroundGeolocation.addWatcher(\n                    {\n                        backgroundMessage: \"Tracking your ride.\",\n                        backgroundTitle: \"Bike Power Tracker\",\n                        requestPermissions: true,\n                        stale: false,\n                        distanceFilter: 10\n                    },\n                    (location: Location | null | undefined, error?: CallbackError | null) => {\n                        if (error) {\n                            if (error.code === \"NOT_AUTHORIZED\") {\n                                if (window.confirm(\n                                    \"This app needs your location, \" +\n                                    \"but does not have permission.\\n\\n\" +\n                                    \"Open settings now?\"\n                                )) {\n                                    BackgroundGeolocation.openSettings();\n                                }\n                            }\n                            return console.error(error);\n                        }\n\n                        if (location) {\n                            const point: GpsPoint = {\n                                timestamp: location.time || Date.now(),\n                                lat: location.latitude,\n                                lon: location.longitude,\n                                accuracy: location.accuracy,\n                                altitude: location.altitude,\n                                speed: location.speed,\n                                heading: location.bearing\n                            };\n                            listener(point);\n                        }\n                    }\n                );\n            } catch (e) {\n                console.error('Error starting native GPS:', e);\n            }\n        },\n        stop: async () => {\n            if (watcherId) {\n                await BackgroundGeolocation.removeWatcher({\n                    id: watcherId\n                });\n                watcherId = null;\n            }\n        }\n    };\n};\n","import type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nexport const createWebGpsService = (): GpsService => {\n    let watchId: number | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            if (!('geolocation' in navigator)) {\n                console.warn('Geolocation is not supported by this browser.');\n                return;\n            }\n\n            watchId = navigator.geolocation.watchPosition(\n                (position) => {\n                    const point: GpsPoint = {\n                        timestamp: position.timestamp,\n                        lat: position.coords.latitude,\n                        lon: position.coords.longitude,\n                        accuracy: position.coords.accuracy,\n                        altitude: position.coords.altitude,\n                        speed: position.coords.speed,\n                        heading: position.coords.heading\n                    };\n                    listener(point);\n                },\n                (error) => {\n                    console.error('Error watching position:', error);\n                },\n                {\n                    enableHighAccuracy: true,\n                    timeout: 5000,\n                    maximumAge: 0\n                }\n            );\n        },\n        stop: async () => {\n            if (watchId !== null) {\n                navigator.geolocation.clearWatch(watchId);\n                watchId = null;\n            }\n        }\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { GpsService } from './types.js';\nimport { createNativeGpsService } from './native-gps.js';\nimport { createWebGpsService } from './web-gps.js';\n\nexport const GpsFactory = {\n    create: (): GpsService => {\n        if (Capacitor.isNativePlatform()) {\n            return createNativeGpsService();\n        } else {\n            return createWebGpsService();\n        }\n    }\n};\n","import type { GpsPoint } from './types/measurements.js';\nimport { GpsFactory } from './services/gps/factory.js';\nimport type { GpsListener } from './services/gps/types.js';\n\nexport interface GpsConnection {\n    stop: () => Promise<void>;\n    deviceName?: string;\n}\n\nexport const connectGpsMock = async (listener: GpsListener): Promise<GpsConnection> => {\n    const interval = setInterval(() => {\n        const point: GpsPoint = {\n            timestamp: Date.now(),\n            lat: 52.5200 + (Math.random() - 0.5) * 0.01,\n            lon: 13.4050 + (Math.random() - 0.5) * 0.01,\n            accuracy: 5,\n            speed: (25 + (Math.random() - 0.5) * 5) / 3.6, // ~25 km/h in m/s\n            altitude: 50,\n            heading: 0\n        };\n        listener(point);\n    }, 1000);\n\n    return {\n        stop: async () => clearInterval(interval),\n        deviceName: 'Mock GPS',\n    };\n};\n\nexport const connectGps = async (listener: GpsListener): Promise<GpsConnection> => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectGpsMock(listener);\n    }\n\n    const service = GpsFactory.create();\n    await service.start(listener);\n\n    return {\n        stop: async () => service.stop(),\n        deviceName: 'GPS Sensor'\n    };\n};\n","/**\n * Connection Error UI Module\n * \n * Displays user-friendly error messages for Bluetooth connection failures\n * with troubleshooting suggestions and retry functionality.\n * \n * @module connectionError\n */\n\nimport { showModal } from './modal.js';\nimport { announce } from './accessibility.js';\nimport type { MeasurementType } from '../types/measurements.js';\n\n/**\n * Bluetooth error codes and their user-friendly messages\n */\ninterface ErrorInfo {\n    title: string;\n    message: string;\n    suggestions: string[];\n    canRetry: boolean;\n}\n\n/**\n * Sensor type display names\n */\nconst sensorLabels: Record<MeasurementType, string> = {\n    power: 'Power Meter',\n    heartrate: 'Heart Rate Monitor',\n    cadence: 'Cadence Sensor',\n    speed: 'Speed Sensor',\n    distance: 'Distance',\n    altitude: 'Altitude',\n    gps: 'GPS',\n};\n\n/**\n * Sensor type icons\n */\nconst sensorIcons: Record<MeasurementType, string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n};\n\n/**\n * Parse a Bluetooth error and return user-friendly information\n */\nfunction parseBluetoothError(error: unknown, sensorType: MeasurementType): ErrorInfo {\n    const sensorLabel = sensorLabels[sensorType];\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorName = error instanceof Error ? error.name : '';\n\n    // User cancelled the device selection\n    if (errorMessage.includes('User cancelled') || errorMessage.includes('cancelled the requestDevice')) {\n        return {\n            title: 'Connection Cancelled',\n            message: `${sensorLabel} pairing was cancelled.`,\n            suggestions: [\n                'Click the connect button to try again',\n                'Make sure your sensor is powered on and in range',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Bluetooth not available\n    if (errorMessage.includes('Bluetooth adapter not available') ||\n        errorMessage.includes('Web Bluetooth API is not available') ||\n        errorName === 'NotFoundError' && errorMessage.includes('Bluetooth')) {\n        return {\n            title: 'Bluetooth Unavailable',\n            message: 'Bluetooth is not available on this device or browser.',\n            suggestions: [\n                'Check that Bluetooth is enabled in your device settings',\n                'Try using Chrome, Edge, or another browser that supports Web Bluetooth',\n                'On macOS, ensure Bluetooth permissions are granted in System Preferences',\n                'On Windows, check that your Bluetooth adapter is working',\n            ],\n            canRetry: false,\n        };\n    }\n\n    // No devices found\n    if (errorMessage.includes('No Bluetooth devices') ||\n        errorMessage.includes('No devices found') ||\n        (errorName === 'NotFoundError' && !errorMessage.includes('Bluetooth'))) {\n        return {\n            title: 'No Sensors Found',\n            message: `No compatible ${sensorLabel.toLowerCase()} was found nearby.`,\n            suggestions: [\n                'Make sure your sensor is powered on',\n                'Wake up the sensor by spinning the pedals or moving',\n                'Bring the sensor closer to your device',\n                'Check that the sensor battery is not depleted',\n                'Ensure the sensor is not connected to another device',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // GATT connection failed\n    if (errorMessage.includes('GATT') ||\n        errorMessage.includes('Connection failed') ||\n        errorMessage.includes('connect') && errorMessage.includes('fail')) {\n        return {\n            title: 'Connection Failed',\n            message: `Could not connect to the ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Try moving closer to the sensor',\n                'Power cycle the sensor (turn off and on again)',\n                'Check that no other device is connected to this sensor',\n                'Restart Bluetooth on your device',\n                'If using a phone, try closing other Bluetooth apps',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Security/permission error\n    if (errorMessage.includes('SecurityError') ||\n        errorMessage.includes('permission') ||\n        errorName === 'SecurityError') {\n        return {\n            title: 'Permission Denied',\n            message: 'Bluetooth permission was denied.',\n            suggestions: [\n                'Check your browser settings to allow Bluetooth access',\n                'If prompted, click \"Allow\" to grant Bluetooth permission',\n                'Try refreshing the page and connecting again',\n                'On some browsers, you may need to access this site over HTTPS',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Network/timeout error\n    if (errorMessage.includes('NetworkError') ||\n        errorMessage.includes('timeout') ||\n        errorName === 'NetworkError') {\n        return {\n            title: 'Connection Timed Out',\n            message: `The connection to your ${sensorLabel.toLowerCase()} timed out.`,\n            suggestions: [\n                'Make sure the sensor is in range and powered on',\n                'Try moving closer to the sensor',\n                'Power cycle the sensor and try again',\n                'Check for interference from other wireless devices',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Service not found\n    if (errorMessage.includes('Service') && errorMessage.includes('not found')) {\n        return {\n            title: 'Incompatible Sensor',\n            message: `This device doesn't appear to be a compatible ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Make sure you selected the correct sensor type',\n                'Check that your sensor supports standard Bluetooth protocols',\n                'Some sensors may require a firmware update',\n                'Consult your sensor\\'s documentation for compatibility',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Generic/unknown error\n    return {\n        title: 'Connection Error',\n        message: `Failed to connect to ${sensorLabel.toLowerCase()}.`,\n        suggestions: [\n            'Make sure the sensor is powered on and nearby',\n            'Try power cycling the sensor',\n            'Restart Bluetooth on your device',\n            'Refresh the page and try again',\n        ],\n        canRetry: true,\n    };\n}\n\n/**\n * Create the error content HTML element\n */\nfunction createErrorContent(errorInfo: ErrorInfo): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'connection-error-content';\n\n    // Error message\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = errorInfo.message;\n    container.appendChild(messageEl);\n\n    // Troubleshooting section\n    if (errorInfo.suggestions.length > 0) {\n        const troubleshootingEl = document.createElement('div');\n        troubleshootingEl.className = 'connection-error-troubleshooting';\n\n        const titleEl = document.createElement('h3');\n        titleEl.textContent = ' Troubleshooting Tips';\n        troubleshootingEl.appendChild(titleEl);\n\n        const listEl = document.createElement('ul');\n        listEl.setAttribute('role', 'list');\n        errorInfo.suggestions.forEach(suggestion => {\n            const itemEl = document.createElement('li');\n            itemEl.textContent = suggestion;\n            listEl.appendChild(itemEl);\n        });\n        troubleshootingEl.appendChild(listEl);\n\n        container.appendChild(troubleshootingEl);\n    }\n\n    return container;\n}\n\n/**\n * Show a connection error dialog with troubleshooting suggestions\n * \n * @param error - The error that occurred\n * @param sensorType - The type of sensor that failed to connect\n * @param onRetry - Optional callback for retry button\n * @returns Promise resolving to true if user wants to retry, false otherwise\n */\nexport function showConnectionError(\n    error: unknown,\n    sensorType: MeasurementType,\n    onRetry?: () => void\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const errorInfo = parseBluetoothError(error, sensorType);\n        const sensorIcon = sensorIcons[sensorType];\n        const content = createErrorContent(errorInfo);\n\n        // Log the actual error for debugging\n        console.error(`[${sensorType}] Connection error:`, error);\n\n        // Announce to screen readers\n        announce(`${errorInfo.title}. ${errorInfo.message}`, 'assertive');\n\n        let closeModal: (() => void) | null = null;\n\n        const buttons = [];\n\n        // Always add a dismiss button\n        buttons.push({\n            text: 'Dismiss',\n            variant: 'secondary' as const,\n            onClick: () => {\n                closeModal?.();\n                resolve(false);\n            },\n        });\n\n        // Add retry button if applicable\n        if (errorInfo.canRetry) {\n            buttons.push({\n                text: 'Try Again',\n                variant: 'primary' as const,\n                onClick: () => {\n                    closeModal?.();\n                    if (onRetry) {\n                        onRetry();\n                    }\n                    resolve(true);\n                },\n            });\n        }\n\n        closeModal = showModal({\n            title: errorInfo.title,\n            icon: sensorIcon,\n            content,\n            buttons,\n            closeOnOverlay: true,\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Show a reconnection failure notification\n * \n * Called when auto-reconnect has exhausted all attempts.\n * \n * @param sensorType - The type of sensor that failed to reconnect\n * @param onRetry - Optional callback to manually retry connection\n */\nexport function showReconnectionFailed(\n    sensorType: MeasurementType,\n    onRetry?: () => void\n): void {\n    const sensorLabel = sensorLabels[sensorType];\n    const sensorIcon = sensorIcons[sensorType];\n\n    const content = document.createElement('div');\n    content.className = 'connection-error-content';\n\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = `Lost connection to your ${sensorLabel.toLowerCase()} and automatic reconnection failed.`;\n    content.appendChild(messageEl);\n\n    const tipsEl = document.createElement('div');\n    tipsEl.className = 'connection-error-troubleshooting';\n\n    const titleEl = document.createElement('h3');\n    titleEl.textContent = ' To reconnect:';\n    tipsEl.appendChild(titleEl);\n\n    const listEl = document.createElement('ul');\n    listEl.setAttribute('role', 'list');\n    [\n        'Make sure the sensor is still powered on',\n        'Move closer to the sensor',\n        'Click \"Try Again\" to reconnect manually',\n    ].forEach(tip => {\n        const itemEl = document.createElement('li');\n        itemEl.textContent = tip;\n        listEl.appendChild(itemEl);\n    });\n    tipsEl.appendChild(listEl);\n    content.appendChild(tipsEl);\n\n    announce(`${sensorLabel} connection lost. Automatic reconnection failed.`, 'assertive');\n\n    let closeModal: (() => void) | null = null;\n\n    closeModal = showModal({\n        title: 'Connection Lost',\n        icon: sensorIcon,\n        content,\n        buttons: [\n            {\n                text: 'Dismiss',\n                variant: 'secondary',\n                onClick: () => {\n                    closeModal?.();\n                },\n            },\n            {\n                text: 'Try Again',\n                variant: 'primary',\n                onClick: () => {\n                    closeModal?.();\n                    onRetry?.();\n                },\n            },\n        ],\n        closeOnOverlay: true,\n    });\n}\n","/**\n * Connection Button Initialization\n * \n * Sets up Bluetooth sensor connection buttons with connect/disconnect functionality.\n * \n * @module initConnectionButtons\n */\n\nimport { connectCadence } from './connect-cadence.js';\nimport { connectHeartRate } from './connect-heartrate.js';\nimport { connectPower } from './connect-power.js';\nimport { connectGps } from './connect-gps.js';\nimport { elements } from './elements.js';\nimport type { MeasurementsState } from './MeasurementsState.js';\nimport type { MeasurementType, Measurement, GpsPoint } from './types/measurements.js';\nimport type { ConnectionsState } from './getInitState.js';\nimport type { SensorConnection, ConnectionStatus } from './types/bluetooth.js';\nimport { showNotification } from './ui/notifications.js';\nimport { showConnectionError, showReconnectionFailed } from './ui/connectionError.js';\n\n/**\n * Sensor type to connect function mapping\n */\ntype ConnectFunctions = {\n    power: () => Promise<SensorConnection>;\n    heartrate: () => Promise<SensorConnection>;\n    cadence: () => Promise<SensorConnection>;\n};\n\n/**\n * Parameters for connection button initialization\n */\ninterface InitConnectionButtonsParams {\n    connectionsState: ConnectionsState;\n    measurementsState: MeasurementsState;\n}\n\n/**\n * Emoji icons for each sensor type\n */\nconst emojis: Record<MeasurementType, string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n};\n\n/**\n * Get formatted sensor type label\n */\nconst getSensorLabel = (key: MeasurementType): string => {\n    return key.charAt(0).toUpperCase() + key.slice(1);\n};\n\n/**\n * Initialize connection buttons for all sensor types.\n * \n * Sets up click handlers for connect/disconnect buttons that:\n * - Connect to Bluetooth sensors\n * - Update connection state\n * - Register measurement listeners\n * - Update UI to reflect connection status\n * - Display device name when connected\n * - Handle auto-reconnect status updates\n * \n * @param params - Object containing state objects\n */\nexport const initConnectionButtons = ({\n    connectionsState,\n    measurementsState,\n}: InitConnectionButtonsParams): void => {\n    const metricTypes: MeasurementType[] = ['power', 'heartrate', 'cadence'];\n\n    const connectFns: ConnectFunctions = {\n        power: connectPower,\n        heartrate: connectHeartRate,\n        cadence: connectCadence,\n    };\n\n    /**\n     * Update button text based on connection status\n     */\n    const updateButtonText = (\n        key: MeasurementType,\n        status: 'connected' | 'disconnected' | 'reconnecting',\n        deviceName?: string\n    ): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const label = getSensorLabel(key);\n        const emoji = emojis[key];\n\n        switch (status) {\n            case 'connected':\n                if (deviceName) {\n                    connectElem.textContent = `${emoji} Disconnect ${label} (${deviceName})`;\n                } else {\n                    connectElem.textContent = `${emoji} Disconnect ${label}`;\n                }\n                break;\n            case 'reconnecting':\n                connectElem.textContent = `${emoji} Reconnecting ${label}...`;\n                break;\n            case 'disconnected':\n                connectElem.textContent = `${emoji} Connect ${label}`;\n                break;\n        }\n    };\n\n    /**\n     * Disconnect from a sensor\n     */\n    const disconnectFn = (key: MeasurementType): void => {\n        const connectionState = connectionsState[key];\n        if (!connectionState) return;\n\n        if (typeof connectionState.disconnect === 'function') {\n            connectionState.disconnect();\n            connectionState.disconnect = null;\n            connectionState.isConnected = false;\n\n            updateButtonText(key, 'disconnected');\n\n            const displayElem = elements[key]?.display;\n            if (displayElem) {\n                displayElem.textContent = '--';\n            }\n        }\n    };\n\n    /**\n     * Handle connection status changes from auto-reconnect\n     */\n    const handleStatusChange = (key: MeasurementType, deviceName: string) => (status: ConnectionStatus): void => {\n        const label = getSensorLabel(key);\n\n        switch (status) {\n            case 'connected':\n                updateButtonText(key, 'connected', deviceName);\n                showNotification(`${label} sensor reconnected`, 'success');\n                break;\n            case 'reconnecting':\n                updateButtonText(key, 'reconnecting');\n                break;\n            case 'failed':\n                if (connectionsState[key]) {\n                    connectionsState[key]!.isConnected = false;\n                    connectionsState[key]!.disconnect = null;\n                }\n                updateButtonText(key, 'disconnected');\n                // Show reconnection failed dialog with retry option\n                showReconnectionFailed(key, () => connectFn(key));\n                break;\n            case 'disconnected':\n                // Initial disconnect event, wait for reconnect attempt\n                break;\n        }\n    };\n\n    /**\n     * Connect to a sensor\n     */\n    const connectFn = async (key: MeasurementType): Promise<void> => {\n        try {\n            if (!(key in connectFns)) return;\n\n            const connection = await connectFns[key as keyof ConnectFunctions]();\n            const { disconnect, addListener, deviceName, onStatusChange } = connection;\n\n            const state = connectionsState[key as keyof ConnectionsState];\n            if (state) {\n                state.disconnect = disconnect;\n                state.isConnected = true;\n            }\n\n            addListener((entry: Measurement) => {\n                measurementsState.add(key, entry);\n            });\n\n            // Subscribe to status changes for auto-reconnect feedback\n            if (onStatusChange) {\n                onStatusChange(handleStatusChange(key, deviceName || getSensorLabel(key)));\n            }\n\n            updateButtonText(key, 'connected', deviceName);\n\n            if (deviceName) {\n                showNotification(`Connected to ${deviceName}`, 'success');\n            }\n        } catch (error) {\n            // Show user-friendly error dialog with troubleshooting tips\n            const shouldRetry = await showConnectionError(error, key, () => connectFn(key));\n            // If user clicked \"Try Again\" in the dialog, the retry callback is already called\n            // so we don't need to do anything here based on shouldRetry\n            if (!shouldRetry) {\n                console.log(`User dismissed ${key} connection error dialog`);\n            }\n        }\n    };\n\n    // Set up click handlers for each sensor type\n    metricTypes.forEach((key) => {\n        const connectElem = elements[key]?.connect;\n\n        if (connectElem) {\n            connectElem.addEventListener('click', async () => {\n                const state = connectionsState[key];\n                if (state && state.isConnected) {\n                    disconnectFn(key);\n                } else {\n                    await connectFn(key);\n                }\n            });\n        }\n    });\n\n    // GPS Handling\n    const connectGpsElem = elements.gps?.connect;\n    if (connectGpsElem) {\n        connectGpsElem.addEventListener('click', async () => {\n            const state = connectionsState.gps;\n            if (state && state.isConnected) {\n                // Disconnect\n                if (typeof state.disconnect === 'function') {\n                    state.disconnect();\n                    state.disconnect = null;\n                    state.isConnected = false;\n                    updateButtonText('gps', 'disconnected');\n\n                    // Reset display\n                    if (elements.speed.display) elements.speed.display.textContent = '--';\n                    if (elements.distance.display) elements.distance.display.textContent = '--';\n                    if (elements.altitude.display) elements.altitude.display.textContent = '--';\n\n                    if (connectionsState.speed) connectionsState.speed.isConnected = false;\n                    if (connectionsState.distance) connectionsState.distance.isConnected = false;\n                    if (connectionsState.altitude) connectionsState.altitude.isConnected = false;\n                }\n            } else {\n                // Connect\n                try {\n                    updateButtonText('gps', 'reconnecting'); // Show connecting state\n\n                    const connection = await connectGps((point: GpsPoint) => {\n                        measurementsState.addGps(point);\n\n                        // Also update speed, distance, altitude if available\n                        if (point.speed !== null) {\n                            measurementsState.addSpeed({ timestamp: point.timestamp, value: point.speed * 3.6 }); // m/s to km/h\n                        }\n                        if (point.altitude !== null) {\n                            measurementsState.addAltitude({ timestamp: point.timestamp, value: point.altitude });\n                        }\n                    });\n\n                    if (connectionsState.gps) {\n                        connectionsState.gps.disconnect = connection.stop;\n                        connectionsState.gps.isConnected = true;\n                    }\n\n                    // Also mark speed, distance, altitude as connected\n                    if (connectionsState.speed) connectionsState.speed.isConnected = true;\n                    if (connectionsState.distance) connectionsState.distance.isConnected = true;\n                    if (connectionsState.altitude) connectionsState.altitude.isConnected = true;\n\n                    updateButtonText('gps', 'connected', connection.deviceName);\n                    showNotification(`Connected to ${connection.deviceName || 'GPS'}`, 'success');\n\n                } catch (error) {\n                    console.error('GPS Connection failed', error);\n                    showNotification('Failed to connect to GPS', 'error');\n                    updateButtonText('gps', 'disconnected');\n                }\n            }\n        });\n    }\n};\n","/**\n * IndexedDB Storage for Workout Data\n * \n * Provides persistent storage for workout recordings using IndexedDB.\n * This ensures workout data survives page refreshes, crashes, and accidental closures.\n * \n * @module storage/workoutStorage\n */\n\nimport type { MeasurementsData, Measurement, LapMarker, GpsPoint } from '../types/measurements.js';\n\nconst DB_NAME = 'BikeTrackerDB';\nconst DB_VERSION = 1;\nconst STORE_NAME = 'activeWorkout';\nconst COMPLETED_STORE = 'completedWorkouts';\n\n/**\n * Stored workout data with metadata\n */\nexport interface StoredWorkout {\n    id: string;\n    startTime: number;\n    lastUpdated: number;\n    measurements: MeasurementsData;\n    isCompleted: boolean;\n}\n\n/**\n * Active workout record for recovery\n */\nexport interface ActiveWorkoutRecord {\n    id: 'current';\n    startTime: number;\n    lastUpdated: number;\n    heartrate: Measurement[];\n    power: Measurement[];\n    cadence: Measurement[];\n    speed: Measurement[];\n    distance: Measurement[];\n    altitude: Measurement[];\n    gps: GpsPoint[];\n    laps: LapMarker[];\n}\n\nlet db: IDBDatabase | null = null;\n\n/**\n * Opens the IndexedDB database, creating stores if needed\n */\nexport async function openDatabase(): Promise<IDBDatabase> {\n    if (db) return db;\n\n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n        request.onerror = () => {\n            console.error('Failed to open IndexedDB:', request.error);\n            reject(request.error);\n        };\n\n        request.onsuccess = () => {\n            db = request.result;\n            resolve(db);\n        };\n\n        request.onupgradeneeded = (event) => {\n            const database = (event.target as IDBOpenDBRequest).result;\n\n            // Store for the currently active workout (single record)\n            if (!database.objectStoreNames.contains(STORE_NAME)) {\n                database.createObjectStore(STORE_NAME, { keyPath: 'id' });\n            }\n\n            // Store for completed workouts (backup/history)\n            if (!database.objectStoreNames.contains(COMPLETED_STORE)) {\n                const completedStore = database.createObjectStore(COMPLETED_STORE, { keyPath: 'id' });\n                completedStore.createIndex('startTime', 'startTime', { unique: false });\n            }\n        };\n    });\n}\n\n/**\n * Saves the current workout state to IndexedDB\n */\nexport async function saveActiveWorkout(\n    measurements: MeasurementsData,\n    startTime: number | null\n): Promise<void> {\n    try {\n        const database = await openDatabase();\n\n        const record: ActiveWorkoutRecord = {\n            id: 'current',\n            startTime: startTime ?? Date.now(),\n            lastUpdated: Date.now(),\n            heartrate: measurements.heartrate,\n            power: measurements.power,\n            cadence: measurements.cadence,\n            speed: measurements.speed,\n            distance: measurements.distance,\n            altitude: measurements.altitude,\n            gps: measurements.gps,\n            laps: measurements.laps ?? [],\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction(STORE_NAME, 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.put(record);\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => {\n                console.error('Failed to save workout:', request.error);\n                reject(request.error);\n            };\n        });\n    } catch (error) {\n        console.error('Error saving active workout:', error);\n        throw error;\n    }\n}\n\n/**\n * Loads the active workout from IndexedDB (for recovery)\n */\nexport async function loadActiveWorkout(): Promise<ActiveWorkoutRecord | null> {\n    try {\n        const database = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction(STORE_NAME, 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.get('current');\n\n            request.onsuccess = () => {\n                resolve(request.result ?? null);\n            };\n            request.onerror = () => {\n                console.error('Failed to load workout:', request.error);\n                reject(request.error);\n            };\n        });\n    } catch (error) {\n        console.error('Error loading active workout:', error);\n        return null;\n    }\n}\n\n/**\n * Clears the active workout from IndexedDB\n */\nexport async function clearActiveWorkout(): Promise<void> {\n    try {\n        const database = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction(STORE_NAME, 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.delete('current');\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => {\n                console.error('Failed to clear workout:', request.error);\n                reject(request.error);\n            };\n        });\n    } catch (error) {\n        console.error('Error clearing active workout:', error);\n        throw error;\n    }\n}\n\n/**\n * Archives the current workout to completed workouts store\n */\nexport async function archiveWorkout(\n    measurements: MeasurementsData,\n    startTime: number,\n    endTime: number\n): Promise<string> {\n    try {\n        const database = await openDatabase();\n        const workoutId = `workout-${startTime}`;\n\n        const record: StoredWorkout = {\n            id: workoutId,\n            startTime,\n            lastUpdated: endTime,\n            measurements,\n            isCompleted: true,\n        };\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction([COMPLETED_STORE, STORE_NAME], 'readwrite');\n\n            // Save to completed store\n            const completedStore = transaction.objectStore(COMPLETED_STORE);\n            completedStore.put(record);\n\n            // Clear active workout\n            const activeStore = transaction.objectStore(STORE_NAME);\n            activeStore.delete('current');\n\n            transaction.oncomplete = () => resolve(workoutId);\n            transaction.onerror = () => {\n                console.error('Failed to archive workout:', transaction.error);\n                reject(transaction.error);\n            };\n        });\n    } catch (error) {\n        console.error('Error archiving workout:', error);\n        throw error;\n    }\n}\n\n/**\n * Gets all completed workouts\n */\nexport async function getCompletedWorkouts(): Promise<StoredWorkout[]> {\n    try {\n        const database = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction(COMPLETED_STORE, 'readonly');\n            const store = transaction.objectStore(COMPLETED_STORE);\n            const request = store.getAll();\n\n            request.onsuccess = () => {\n                resolve(request.result ?? []);\n            };\n            request.onerror = () => {\n                console.error('Failed to get completed workouts:', request.error);\n                reject(request.error);\n            };\n        });\n    } catch (error) {\n        console.error('Error getting completed workouts:', error);\n        return [];\n    }\n}\n\n/**\n * Deletes a completed workout by ID\n */\nexport async function deleteCompletedWorkout(workoutId: string): Promise<void> {\n    try {\n        const database = await openDatabase();\n\n        return new Promise((resolve, reject) => {\n            const transaction = database.transaction(COMPLETED_STORE, 'readwrite');\n            const store = transaction.objectStore(COMPLETED_STORE);\n            const request = store.delete(workoutId);\n\n            request.onsuccess = () => resolve();\n            request.onerror = () => {\n                console.error('Failed to delete workout:', request.error);\n                reject(request.error);\n            };\n        });\n    } catch (error) {\n        console.error('Error deleting workout:', error);\n        throw error;\n    }\n}\n\n/**\n * Checks if there's an active workout that can be recovered\n */\nexport async function hasRecoverableWorkout(): Promise<boolean> {\n    const workout = await loadActiveWorkout();\n    if (!workout) return false;\n\n    // Consider it recoverable if it has any data and is less than 24 hours old\n    const hasData =\n        workout.heartrate.length > 0 ||\n        workout.power.length > 0 ||\n        workout.cadence.length > 0;\n\n    const isRecent = Date.now() - workout.lastUpdated < 24 * 60 * 60 * 1000; // 24 hours\n\n    return hasData && isRecent;\n}\n\n/**\n * Throttled save function to avoid too frequent IndexedDB writes\n */\nlet saveTimeout: ReturnType<typeof setTimeout> | null = null;\nlet pendingSave: { measurements: MeasurementsData; startTime: number | null } | null = null;\n\nexport function throttledSave(\n    measurements: MeasurementsData,\n    startTime: number | null,\n    delay: number = 1000\n): void {\n    pendingSave = { measurements, startTime };\n\n    if (saveTimeout) return; // Already scheduled\n\n    saveTimeout = setTimeout(async () => {\n        if (pendingSave) {\n            await saveActiveWorkout(pendingSave.measurements, pendingSave.startTime);\n            pendingSave = null;\n        }\n        saveTimeout = null;\n    }, delay);\n}\n\n/**\n * Force immediate save (e.g., before page unload)\n */\nexport async function flushPendingSave(): Promise<void> {\n    if (saveTimeout) {\n        clearTimeout(saveTimeout);\n        saveTimeout = null;\n    }\n    if (pendingSave) {\n        await saveActiveWorkout(pendingSave.measurements, pendingSave.startTime);\n        pendingSave = null;\n    }\n}\n\n/**\n * Check if IndexedDB is supported\n */\nexport function isIndexedDBSupported(): boolean {\n    try {\n        return 'indexedDB' in window && indexedDB !== null;\n    } catch {\n        return false;\n    }\n}\n","/**\n * Measurements State Management\n * \n * Central state container for all workout measurement data.\n * Integrates with IndexedDB for persistent storage and crash recovery.\n * \n * @module MeasurementsState\n */\n\nimport type { Measurement, MeasurementsData, MeasurementType, LapMarker, GpsPoint } from './types/measurements.js';\nimport {\n    throttledSave,\n    flushPendingSave,\n    clearActiveWorkout,\n    isIndexedDBSupported\n} from './storage/workoutStorage.js';\n\n/**\n * Validation limits for measurement values\n */\nconst VALIDATION_LIMITS = {\n    heartrate: { min: 0, max: 300 },\n    power: { min: 0, max: 3000 },\n    cadence: { min: 0, max: 300 },\n    speed: { min: 0, max: 150 }, // km/h\n    distance: { min: 0, max: 1000000 }, // meters\n    altitude: { min: -500, max: 9000 }, // meters\n} as const;\n\n/**\n * Calculate distance between two coordinates in meters (Haversine formula)\n */\nfunction calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371e3; // metres\n    const 1 = lat1 * Math.PI / 180;\n    const 2 = lat2 * Math.PI / 180;\n    const  = (lat2 - lat1) * Math.PI / 180;\n    const  = (lon2 - lon1) * Math.PI / 180;\n\n    const a = Math.sin( / 2) * Math.sin( / 2) +\n        Math.cos(1) * Math.cos(2) *\n        Math.sin( / 2) * Math.sin( / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n    return R * c;\n}\n\n/**\n * Callback type for state change notifications\n */\nexport type StateChangeCallback = () => void;\n\n/**\n * State container for workout measurements.\n * \n * Stores heart rate, power, and cadence measurements with timestamps.\n * Includes validation to reject invalid values.\n * Automatically persists to IndexedDB for crash recovery.\n * \n * @example\n * const state = new MeasurementsState();\n * state.addPower({ timestamp: Date.now(), value: 200 });\n * console.log(state.power); // [{ timestamp: ..., value: 200 }]\n */\nexport class MeasurementsState implements MeasurementsData {\n    heartrate: Measurement[] = [];\n    power: Measurement[] = [];\n    cadence: Measurement[] = [];\n    speed: Measurement[] = [];\n    distance: Measurement[] = [];\n    altitude: Measurement[] = [];\n    gps: GpsPoint[] = [];\n    laps: LapMarker[] = [];\n\n    private _persistenceEnabled: boolean;\n    private _startTime: number | null = null;\n    private _onChangeCallbacks: StateChangeCallback[] = [];\n\n    constructor(enablePersistence: boolean = true) {\n        this._persistenceEnabled = enablePersistence && isIndexedDBSupported();\n\n        // Set up page unload handler to save any pending changes\n        if (this._persistenceEnabled && typeof window !== 'undefined') {\n            window.addEventListener('beforeunload', () => {\n                flushPendingSave();\n            });\n\n            // Also save on visibility change (mobile browsers)\n            document.addEventListener('visibilitychange', () => {\n                if (document.hidden) {\n                    flushPendingSave();\n                }\n            });\n        }\n    }\n\n    /**\n     * Set the workout start time (used for persistence)\n     */\n    setStartTime(time: number | null): void {\n        this._startTime = time;\n    }\n\n    /**\n     * Get the workout start time\n     */\n    getStartTime(): number | null {\n        return this._startTime;\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: StateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: StateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    /**\n     * Notify listeners and persist state\n     */\n    private _notifyChange(): void {\n        // Notify listeners\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n\n        // Persist to IndexedDB\n        if (this._persistenceEnabled) {\n            throttledSave(this.toJSON(), this._startTime);\n        }\n    }\n\n    /**\n     * Add a heart rate measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 bpm)\n     */\n    addHeartrate(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.heartrate;\n        if (entry.value <= min || entry.value >= max) {\n            console.warn(`Invalid heartrate value: ${entry.value}`);\n            return;\n        }\n        this.heartrate.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    /**\n     * Add a power measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-3000 watts)\n     */\n    addPower(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.power;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid power value: ${entry.value}`);\n            return;\n        }\n        this.power.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    /**\n     * Add a cadence measurement\n     * \n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 rpm)\n     */\n    addCadence(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.cadence;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid cadence value: ${entry.value}`);\n            return;\n        }\n        this.cadence.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addSpeed(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid speed value: ${entry.value}`);\n            return;\n        }\n        this.speed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addDistance(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.distance;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid distance value: ${entry.value}`);\n            return;\n        }\n        this.distance.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addAltitude(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.altitude;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid altitude value: ${entry.value}`);\n            return;\n        }\n        this.altitude.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addGps(point: GpsPoint): void {\n        // Calculate distance if we have a previous point\n        if (this.gps.length > 0) {\n            const lastPoint = this.gps[this.gps.length - 1];\n            const dist = calculateDistance(lastPoint.lat, lastPoint.lon, point.lat, point.lon);\n\n            let currentTotalDistance = 0;\n            if (this.distance.length > 0) {\n                currentTotalDistance = this.distance[this.distance.length - 1].value;\n            }\n\n            this.addDistance({\n                timestamp: point.timestamp,\n                value: currentTotalDistance + dist\n            });\n        } else if (this.distance.length === 0) {\n            this.addDistance({\n                timestamp: point.timestamp,\n                value: 0\n            });\n        }\n\n        this.gps.push(point);\n        this._notifyChange();\n    }\n\n    /**\n     * Add a measurement of any type\n     * \n     * @param type - The measurement type\n     * @param entry - Measurement with timestamp and value\n     * @throws Error if type is unknown\n     */\n    add(type: MeasurementType, entry: Measurement): void {\n        switch (type) {\n            case 'heartrate':\n                this.addHeartrate(entry);\n                break;\n            case 'power':\n                this.addPower(entry);\n                break;\n            case 'cadence':\n                this.addCadence(entry);\n                break;\n            case 'speed':\n                this.addSpeed(entry);\n                break;\n            case 'distance':\n                this.addDistance(entry);\n                break;\n            case 'altitude':\n                this.addAltitude(entry);\n                break;\n            default:\n                throw new Error(`Unknown measurement type: ${type}`);\n        }\n    }\n\n    /**\n     * Clear all measurements\n     * @param clearPersisted - Also clear persisted data from IndexedDB\n     */\n    async clear(clearPersisted: boolean = true): Promise<void> {\n        this.heartrate = [];\n        this.power = [];\n        this.cadence = [];\n        this.speed = [];\n        this.distance = [];\n        this.altitude = [];\n        this.laps = [];\n        this._startTime = null;\n\n        if (clearPersisted && this._persistenceEnabled) {\n            await clearActiveWorkout();\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a lap marker\n     * \n     * @param startTime - The workout start time for calculating elapsed time\n     * @returns The new lap marker\n     */\n    addLap(startTime: number | null): LapMarker {\n        const timestamp = Date.now();\n        const lapNumber = this.laps.length + 1;\n        const lap: LapMarker = {\n            timestamp,\n            number: lapNumber,\n            elapsedMs: startTime ? timestamp - startTime : undefined,\n        };\n        this.laps.push(lap);\n        this._notifyChange();\n        return lap;\n    }\n\n    /**\n     * Get the current lap count\n     */\n    getLapCount(): number {\n        return this.laps.length;\n    }\n\n    /**\n     * Get all measurements as a plain object\n     */\n    toJSON(): MeasurementsData {\n        return {\n            heartrate: [...this.heartrate],\n            power: [...this.power],\n            cadence: [...this.cadence],\n            speed: [...this.speed],\n            distance: [...this.distance],\n            altitude: [...this.altitude],\n            gps: [...this.gps],\n            laps: [...this.laps],\n        };\n    }\n\n    /**\n     * Restore state from persisted data\n     * @param data - The measurement data to restore\n     * @param startTime - The workout start time\n     */\n    restore(data: MeasurementsData, startTime: number | null): void {\n        this.heartrate = [...(data.heartrate || [])];\n        this.power = [...(data.power || [])];\n        this.cadence = [...(data.cadence || [])];\n        this.speed = [...(data.speed || [])];\n        this.distance = [...(data.distance || [])];\n        this.altitude = [...(data.altitude || [])];\n        this.laps = [...(data.laps || [])];\n        this._startTime = startTime;\n\n        // Don't persist on restore - data is already persisted\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Enable or disable persistence\n     */\n    setPersistenceEnabled(enabled: boolean): void {\n        this._persistenceEnabled = enabled && isIndexedDBSupported();\n    }\n\n    /**\n     * Check if any measurements have been recorded\n     */\n    hasData(): boolean {\n        return this.heartrate.length > 0 || this.power.length > 0 || this.cadence.length > 0;\n    }\n\n    /**\n     * Get the count of measurements for each type\n     */\n    getCounts(): Record<MeasurementType, number> {\n        return {\n            heartrate: this.heartrate.length,\n            power: this.power.length,\n            cadence: this.cadence.length,\n            speed: this.speed.length,\n            distance: this.distance.length,\n            altitude: this.altitude.length,\n            gps: this.gps.length,\n        };\n    }\n}\n","/**\n * Application State Initialization\n * \n * Creates and returns the initial application state objects.\n * \n * @module getInitState\n */\n\nimport { MeasurementsState } from './MeasurementsState.js';\nimport type { ConnectionsState, SensorConnectionState } from './types/connections.js';\n\n// Re-export types for convenience\nexport type { SensorConnectionState };\nexport type { ConnectionsState };\n\n/**\n * Workout time state\n */\nexport interface TimeState {\n    running: boolean;\n    startTime: number | null;\n    endTime: number | null;\n}\n\n/**\n * Complete application state\n */\nexport interface AppState {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n}\n\n/**\n * Creates the initial application state.\n * \n * @returns Object containing all state objects\n * \n * @example\n * const { measurementsState, connectionsState, timeState } = getInitState();\n */\nexport const getInitState = (): AppState => {\n    return {\n        measurementsState: new MeasurementsState(),\n        connectionsState: {\n            power: {\n                isConnected: false,\n                disconnect: null,\n            },\n            heartrate: {\n                isConnected: false,\n                disconnect: null,\n            },\n            cadence: {\n                isConnected: false,\n                disconnect: null,\n            },\n            speed: {\n                isConnected: false,\n                disconnect: null,\n            },\n            distance: {\n                isConnected: false,\n                disconnect: null,\n            },\n            altitude: {\n                isConnected: false,\n                disconnect: null,\n            },\n        },\n        timeState: {\n            running: false,\n            startTime: null,\n            endTime: null,\n        },\n    };\n};\n","/**\n * Wake Lock Handler\n * \n * Keeps the screen awake during workouts using the Screen Wake Lock API.\n * \n * @module wakeLock\n */\n\n/**\n * Initialize wake lock to keep the screen awake.\n * \n * Requests a screen wake lock when the page is visible,\n * and re-requests it if the page visibility changes.\n */\nexport const handleWakeLock = (): void => {\n    let wakeLock: WakeLockSentinel | null = null;\n\n    /**\n     * Request a screen wake lock\n     */\n    const requestWakeLock = async (): Promise<void> => {\n        try {\n            if ('wakeLock' in navigator) {\n                wakeLock = await navigator.wakeLock.request('screen');\n                console.log('Screen wake lock activated');\n\n                // Re-request wake lock if page becomes visible again\n                wakeLock.addEventListener('release', () => {\n                    console.log('Screen wake lock released');\n                });\n            }\n        } catch (err) {\n            console.error('Wake lock request failed:', err);\n        }\n    };\n\n    // Request wake lock when page loads\n    if (document.visibilityState === 'visible') {\n        requestWakeLock();\n    }\n\n    // Re-request wake lock when page becomes visible\n    document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n            requestWakeLock();\n        }\n    });\n};\n","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"./sw.js\", { scope: \"./\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"./sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","/**\n * Service Worker Registration\n * \n * Handles PWA service worker registration using vite-plugin-pwa.\n * \n * @module serviceWorker\n */\n\nimport { registerSW } from 'virtual:pwa-register';\n\n/**\n * Update callback type\n */\ntype UpdateCallback = (reloadPage?: boolean) => Promise<void>;\n\n/**\n * Register the service worker for PWA functionality.\n * \n * In development mode, service workers are disabled to avoid caching issues.\n * In production, registers the service worker and handles updates.\n */\nexport const registerServiceWorker = (): void => {\n    // Don't register service worker in development to avoid caching issues\n    if (import.meta.env.DEV) {\n        console.log('Service Worker disabled in development mode');\n        // Unregister existing service workers if any to ensure fresh content\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                    console.log('Unregistered existing service worker');\n                }\n            });\n        }\n        return;\n    }\n\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    const updateSW = registerSW({\n        onNeedRefresh() {\n            showUpdateNotification(updateSW);\n        },\n        onOfflineReady() {\n            console.log('App ready to work offline');\n        },\n        onRegistered(registration?: ServiceWorkerRegistration) {\n            console.log('Service Worker registered successfully');\n\n            // Check for updates periodically (every hour)\n            if (registration) {\n                setInterval(() => {\n                    registration.update();\n                }, 60 * 60 * 1000);\n            }\n        },\n        onRegisterError(error: Error) {\n            console.log('Service Worker registration failed:', error);\n        },\n    });\n};\n\n/**\n * Show update notification when a new version is available.\n * \n * @param updateSW - Function to trigger the update\n */\nconst showUpdateNotification = (updateSW: UpdateCallback): void => {\n    const updateContainer = document.getElementById('updateNotification');\n    if (!updateContainer) return;\n\n    updateContainer.style.display = 'block';\n\n    const updateButton = document.getElementById('updateButton');\n    updateButton?.addEventListener(\n        'click',\n        () => {\n            updateSW(true); // Force reload after update\n        },\n        { once: true }\n    );\n\n    const dismissUpdateButton = document.getElementById('dismissUpdate');\n    dismissUpdateButton?.addEventListener(\n        'click',\n        () => {\n            updateContainer.style.display = 'none';\n        },\n        { once: true }\n    );\n};\n","/**\n * PWA Install Prompt\n * \n * Handles the PWA installation prompt for supported browsers.\n * \n * @module installPrompt\n */\n\n/**\n * Deferred install prompt event\n */\nlet deferredPrompt: BeforeInstallPromptEvent | null = null;\n\n/**\n * Extended event interface for beforeinstallprompt\n */\ninterface BeforeInstallPromptEvent extends Event {\n    prompt(): Promise<void>;\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\n/**\n * Initialize the PWA install prompt handler.\n * \n * Listens for the beforeinstallprompt event and shows a custom\n * install button when the app can be installed.\n */\nexport const initInstallPrompt = (): void => {\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    // Listen for the beforeinstallprompt event\n    window.addEventListener('beforeinstallprompt', (e: Event) => {\n        // Prevent the mini-infobar from appearing on mobile\n        e.preventDefault();\n\n        // Stash the event so it can be triggered later\n        deferredPrompt = e as BeforeInstallPromptEvent;\n\n        // Show the install button\n        showInstallButton();\n    });\n\n    // Listen for the app installed event\n    window.addEventListener('appinstalled', () => {\n        console.log('PWA was installed successfully');\n        deferredPrompt = null;\n        hideInstallButton();\n    });\n};\n\n/**\n * Show the install button and set up click handlers.\n */\nconst showInstallButton = (): void => {\n    const installContainer = document.getElementById('installPrompt');\n    if (!installContainer) return;\n\n    installContainer.style.display = 'block';\n\n    const installButton = document.getElementById('installButton');\n    installButton?.addEventListener('click', async () => {\n        if (!deferredPrompt) {\n            return;\n        }\n\n        // Show the install prompt\n        await deferredPrompt.prompt();\n\n        // Wait for the user to respond to the prompt\n        const { outcome } = await deferredPrompt.userChoice;\n        console.log(`User response to the install prompt: ${outcome}`);\n\n        // Clear the deferredPrompt\n        deferredPrompt = null;\n        hideInstallButton();\n    });\n\n    const dismissButton = document.getElementById('dismissInstall');\n    dismissButton?.addEventListener('click', () => {\n        hideInstallButton();\n    });\n};\n\n/**\n * Hide the install button.\n */\nconst hideInstallButton = (): void => {\n    const installContainer = document.getElementById('installPrompt');\n    if (installContainer) {\n        installContainer.style.display = 'none';\n    }\n};\n","/**\n * About Modal\n * \n * Manages the About modal.\n * \n * @module about\n */\n\n/**\n * Initialize the About modal\n */\nexport function initAboutModal(): void {\n    const aboutButton = document.getElementById('aboutButton');\n    const aboutModal = document.getElementById('aboutModal');\n    const closeAboutModal = document.getElementById('closeAboutModal');\n\n    if (!aboutButton || !aboutModal) {\n        return;\n    }\n\n    /**\n     * Open the about modal\n     */\n    const openModal = (): void => {\n        aboutModal.style.display = 'flex';\n        // Close the main menu details element\n        const details = document.querySelector('header details');\n        if (details) {\n            details.removeAttribute('open');\n        }\n    };\n\n    /**\n     * Close the about modal\n     */\n    const closeModal = (): void => {\n        aboutModal.style.display = 'none';\n    };\n\n    // Event Listeners\n    aboutButton.addEventListener('click', openModal);\n    closeAboutModal?.addEventListener('click', closeModal);\n\n    // Close modal when clicking outside\n    window.addEventListener('click', (event: MouseEvent) => {\n        if (event.target === aboutModal) {\n            closeModal();\n        }\n    });\n}\n","/**\n * Test exposure utilities\n * \n * Exposes application state for end-to-end testing.\n * \n * @module exposeVariablesDuringTest\n */\n\nimport type { MeasurementsState } from './MeasurementsState.js';\nimport type { ConnectionsState } from './types/connections.js';\n\n/**\n * Extended window interface for test variables\n */\ndeclare global {\n    interface Window {\n        bike?: MeasurementsState;\n        connectionsState?: ConnectionsState;\n    }\n}\n\n/**\n * Parameters for test exposure\n */\ninterface ExposeTestVariablesParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n}\n\n/**\n * Exposes application state variables on the window object for E2E testing.\n * \n * This allows Playwright and other testing frameworks to access and verify\n * application state during tests.\n * \n * @param params - Object containing state objects to expose\n * \n * @example\n * // In test:\n * const state = await page.evaluate(() => window.bike);\n */\nexport function exposeVariablesDuringTest({\n    measurementsState,\n    connectionsState,\n}: ExposeTestVariablesParams): void {\n    // Always expose in non-production builds for testing purposes\n    if (typeof window !== 'undefined') {\n        window.bike = measurementsState;\n        window.connectionsState = connectionsState;\n    }\n}\n","/**\n * API client for the BPT streaming service\n * Handles communication with the Redis Streams API\n * \n * @module streamClient\n */\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Stream information\n */\nexport interface StreamInfo {\n    name: string;\n    length: number;\n    firstMessageId: string;\n    lastMessageId: string;\n}\n\n/**\n * Stream creation response\n */\nexport interface CreateStreamResponse {\n    success: boolean;\n    streamName: string;\n    messageId: string;\n}\n\n/**\n * Message response\n */\nexport interface MessageResponse {\n    success: boolean;\n    messageId: string;\n    streamName: string;\n}\n\n/**\n * Messages query options\n */\nexport interface GetMessagesOptions {\n    start?: string;\n    end?: string;\n    count?: number;\n}\n\n/**\n * Stream messages response\n */\nexport interface StreamMessagesResponse {\n    streamName: string;\n    messages: StreamMessageData[];\n}\n\n/**\n * Message data from stream\n */\nexport interface StreamMessageData {\n    id: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE message callback\n */\nexport type SSEMessageCallback = (data: SSEMessageData) => void;\n\n/**\n * SSE connected callback\n */\nexport type SSEConnectedCallback = (data: SSEConnectedData) => void;\n\n/**\n * SSE error callback\n */\nexport type SSEErrorCallback = (error: Error | Event) => void;\n\n/**\n * SSE message data\n */\nexport interface SSEMessageData {\n    type: 'message';\n    id: string;\n    streamName: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE connected data\n */\nexport interface SSEConnectedData {\n    type: 'connected';\n    streamName: string;\n    listenerId: string;\n}\n\n/**\n * Workout data to send\n */\nexport interface WorkoutDataPayload {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    timestamp: number;\n    elapsed: string;\n}\n\n/**\n * Delete stream response\n */\nexport interface DeleteStreamResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Create a new stream\n * \n * @param streamName - Unique name for the stream\n * @returns Promise with stream creation result\n */\nexport async function createStream(streamName: string): Promise<CreateStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/create`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create stream');\n    }\n\n    return response.json();\n}\n\n/**\n * List all available streams\n * \n * @returns Promise with list of streams\n */\nexport async function listStreams(): Promise<{ streams: StreamInfo[] }> {\n    const response = await fetch(`${API_BASE_URL}/api/streams`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(error || 'Failed to list streams');\n    }\n\n    return response.json();\n}\n\n/**\n * Add a message to a stream\n * \n * @param streamName - Name of the stream\n * @param message - Message content\n * @param author - Message author\n * @returns Promise with message result\n */\nexport async function addMessage(\n    streamName: string,\n    message: string,\n    author: string = 'anonymous'\n): Promise<MessageResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ message, author }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to add message');\n    }\n\n    return response.json();\n}\n\n/**\n * Get messages from a stream\n * \n * @param streamName - Name of the stream\n * @param options - Query options\n * @returns Promise with stream messages\n */\nexport async function getMessages(\n    streamName: string,\n    options: GetMessagesOptions = {}\n): Promise<StreamMessagesResponse> {\n    const { start = '-', end = '+', count = 100 } = options;\n    const params = new URLSearchParams({ start, end, count: count.toString() });\n\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get messages');\n    }\n\n    return response.json();\n}\n\n/**\n * SSE Connection interface for fetch-based SSE\n * Provides a consistent API similar to EventSource\n */\nexport interface SSEConnection {\n    /** Close the SSE connection */\n    close: () => void;\n    /** Whether the connection is active */\n    readonly active: boolean;\n}\n\n/**\n * Create a fetch-based SSE connection that supports custom headers\n * Unlike EventSource, this allows sending authentication via headers\n * \n * @param url - The SSE endpoint URL\n * @param onMessage - Callback for each SSE message\n * @param onConnected - Callback when connection is established\n * @param onError - Callback for errors\n * @returns SSEConnection object with close() method\n */\nfunction createFetchSSE(\n    url: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const controller = new AbortController();\n    let isActive = true;\n\n    const connection: SSEConnection = {\n        close: () => {\n            isActive = false;\n            controller.abort();\n        },\n        get active() {\n            return isActive;\n        }\n    };\n\n    // Start the fetch in the background\n    (async () => {\n        try {\n            const response = await fetch(url, {\n                method: 'GET',\n                headers: getHeaders({\n                    'Accept': 'text/event-stream',\n                    'Cache-Control': 'no-cache',\n                }),\n                signal: controller.signal,\n            });\n\n            if (!response.ok) {\n                throw new Error(`SSE connection failed: ${response.status} ${response.statusText}`);\n            }\n\n            if (!response.body) {\n                throw new Error('SSE response has no body');\n            }\n\n            const reader = response.body.getReader();\n            const decoder = new TextDecoder();\n            let buffer = '';\n\n            while (isActive) {\n                const { done, value } = await reader.read();\n\n                if (done) {\n                    break;\n                }\n\n                buffer += decoder.decode(value, { stream: true });\n\n                // Process complete SSE messages (separated by double newlines)\n                const messages = buffer.split('\\n\\n');\n                buffer = messages.pop() || ''; // Keep incomplete message in buffer\n\n                for (const message of messages) {\n                    if (!message.trim()) continue;\n\n                    // Parse SSE format: \"data: {...}\\n\"\n                    const dataMatch = message.match(/^data:\\s*(.+)$/m);\n                    if (dataMatch) {\n                        try {\n                            const data = JSON.parse(dataMatch[1]);\n\n                            if (data.type === 'connected' && onConnected) {\n                                onConnected(data);\n                            } else if (data.type === 'message') {\n                                onMessage(data);\n                            }\n                        } catch (parseError) {\n                            console.error('Error parsing SSE data:', parseError);\n                        }\n                    }\n                }\n            }\n        } catch (error) {\n            if ((error as Error).name === 'AbortError') {\n                // Connection was intentionally closed\n                return;\n            }\n            console.error('SSE connection error:', error);\n            if (onError) {\n                onError(error as Error);\n            }\n        } finally {\n            isActive = false;\n        }\n    })();\n\n    return connection;\n}\n\n/**\n * Connect to a stream and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n * \n * @param streamName - Name of the stream to listen to\n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToStream(\n    streamName: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/${streamName}/listen`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Connect to all streams and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n * \n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToAllStreams(\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/listenAll`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Send workout data to a stream\n * \n * @param streamName - Name of the stream\n * @param workoutData - Workout data to send\n * @returns Promise with message result\n */\nexport async function sendWorkoutData(\n    streamName: string,\n    workoutData: WorkoutDataPayload\n): Promise<MessageResponse> {\n    const message = JSON.stringify({\n        power: workoutData.power ?? null,\n        cadence: workoutData.cadence ?? null,\n        heartrate: workoutData.heartrate ?? null,\n        timestamp: workoutData.timestamp,\n        elapsed: workoutData.elapsed,\n        dataType: 'workout_metrics',\n    });\n\n    return addMessage(streamName, message, 'bike-power-tracker');\n}\n\n/**\n * Delete a stream\n * \n * @param streamName - Name of the stream to delete\n * @returns Promise with deletion result\n */\nexport async function deleteStream(streamName: string): Promise<DeleteStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete stream');\n    }\n\n    return response.json();\n}\n","/**\n * Stream Manager\n * \n * Manages streaming workout data to the server in real-time.\n * \n * @module StreamManager\n */\n\nimport { createStream, sendWorkoutData } from './api/streamClient.js';\nimport { getTimestring } from './getTimestring.js';\nimport type { MeasurementsState } from './MeasurementsState.js';\nimport type { MeasurementType } from './types/measurements.js';\n\n/**\n * Time state interface for workout timing\n */\nexport interface WorkoutTimeState {\n    running: boolean;\n    startTime: number | null;\n    endTime: number | null;\n}\n\n/**\n * Stream status information\n */\nexport interface StreamStatus {\n    isStreaming: boolean;\n    isPaused: boolean;\n    streamName: string | null;\n}\n\n/**\n * Index tracking for sent measurements\n */\ninterface SentIndex {\n    power: number;\n    cadence: number;\n    heartrate: number;\n    speed: number;\n    distance: number;\n    altitude: number;\n}\n\n/**\n * Manages streaming workout data to the server.\n * \n * Creates a stream on the server and sends workout metrics\n * (power, cadence, heart rate) at regular intervals.\n * \n * @example\n * const streamManager = new StreamManager(measurementsState, timeState);\n * await streamManager.startStreaming('my-workout');\n * // ... workout in progress ...\n * await streamManager.stopStreaming();\n */\nexport class StreamManager {\n    private measurementsState: MeasurementsState;\n    private timeState: WorkoutTimeState;\n\n    public isStreaming: boolean = false;\n    public isPaused: boolean = false;\n    public streamName: string | null = null;\n\n    private streamInterval: ReturnType<typeof setInterval> | null = null;\n    private lastSentIndex: SentIndex = {\n        power: 0,\n        cadence: 0,\n        heartrate: 0,\n        speed: 0,\n        distance: 0,\n        altitude: 0,\n    };\n\n    constructor(measurementsState: MeasurementsState, timeState: WorkoutTimeState) {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Start streaming workout data\n     * \n     * @param customStreamName - Optional custom stream name\n     * @returns The stream name\n     * @throws Error if already streaming or stream creation fails\n     */\n    async startStreaming(customStreamName?: string): Promise<string> {\n        if (this.isStreaming) {\n            throw new Error('Already streaming');\n        }\n\n        // Generate stream name: workout-YYYYMMDD-HHMMSS or use custom name\n        this.streamName = customStreamName || `workout-${this._getTimestamp()}`;\n\n        try {\n            // Create the stream on the server\n            await createStream(this.streamName);\n\n            this.isStreaming = true;\n            this.isPaused = false;\n            this._startStreamingLoop();\n\n            return this.streamName;\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            this.streamName = null;\n            throw error;\n        }\n    }\n\n    /**\n     * Pause the stream (stop sending data but keep stream alive)\n     */\n    pauseStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = true;\n        }\n    }\n\n    /**\n     * Resume the stream\n     */\n    resumeStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = false;\n        }\n    }\n\n    /**\n     * Stop streaming workout data\n     */\n    async stopStreaming(): Promise<void> {\n        if (!this.isStreaming) {\n            return;\n        }\n\n        this.isStreaming = false;\n        this.isPaused = false;\n\n        if (this.streamInterval) {\n            clearInterval(this.streamInterval);\n            this.streamInterval = null;\n        }\n\n        // We don't delete the stream here so that data persists for a while (handled by server cleanup)\n        this.streamName = null;\n        this.lastSentIndex = { power: 0, cadence: 0, heartrate: 0, speed: 0, distance: 0, altitude: 0 };\n    }\n\n    /**\n     * Get current streaming status\n     */\n    getStatus(): StreamStatus {\n        return {\n            isStreaming: this.isStreaming,\n            isPaused: this.isPaused,\n            streamName: this.streamName,\n        };\n    }\n\n    /**\n     * Start the streaming loop\n     * @private\n     */\n    private _startStreamingLoop(): void {\n        // Send data every 1 second\n        this.streamInterval = setInterval(async () => {\n            if (!this.isStreaming || this.isPaused || !this.timeState.running) {\n                return;\n            }\n\n            try {\n                await this._sendCurrentData();\n            } catch (error) {\n                console.error('Error sending workout data:', error);\n            }\n        }, 1000);\n    }\n\n    /**\n     * Send current workout data\n     * @private\n     */\n    private async _sendCurrentData(): Promise<void> {\n        if (!this.streamName) return;\n\n        const power = this._getLatestValue('power');\n        const cadence = this._getLatestValue('cadence');\n        const heartrate = this._getLatestValue('heartrate');\n        const speed = this._getLatestValue('speed');\n        const distance = this._getLatestValue('distance');\n        const altitude = this._getLatestValue('altitude');\n\n        // Only send if we have at least one measurement\n        if (power === null && cadence === null && heartrate === null && speed === null && distance === null && altitude === null) {\n            return;\n        }\n\n        const elapsedMs = this.timeState.running && this.timeState.startTime\n            ? Date.now() - this.timeState.startTime\n            : (this.timeState.endTime && this.timeState.startTime)\n                ? this.timeState.endTime - this.timeState.startTime\n                : 0;\n\n        const workoutData = {\n            power,\n            cadence,\n            heartrate,\n            speed,\n            distance,\n            altitude,\n            timestamp: Date.now(),\n            elapsed: getTimestring(elapsedMs),\n        };\n\n        await sendWorkoutData(this.streamName, workoutData);\n    }\n\n    /**\n     * Get the latest value for a measurement type\n     * @private\n     */\n    private _getLatestValue(type: Exclude<MeasurementType, 'gps'>): number | null {\n        const measurements = this.measurementsState[type];\n        if (!measurements || measurements.length === 0) {\n            return null;\n        }\n\n        const lastIndex = measurements.length - 1;\n        if (lastIndex >= this.lastSentIndex[type]) {\n            this.lastSentIndex[type] = lastIndex;\n            return measurements[lastIndex].value;\n        }\n\n        return measurements[lastIndex].value;\n    }\n\n    /**\n     * Generate timestamp string for stream name\n     * @private\n     */\n    private _getTimestamp(): string {\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hours = String(now.getHours()).padStart(2, '0');\n        const minutes = String(now.getMinutes()).padStart(2, '0');\n        const seconds = String(now.getSeconds()).padStart(2, '0');\n        return `${year}${month}${day}-${hours}${minutes}${seconds}`;\n    }\n}\n","/**\n * Stream Viewer UI\n * \n * Displays available streams and allows viewing live workout data.\n * \n * @module streamViewer\n */\n\nimport { listStreams, listenToStream, listenToAllStreams } from '../api/streamClient.js';\nimport type { StreamInfo, SSEMessageData, SSEConnection } from '../api/streamClient.js';\n\n/**\n * Workout metrics data from stream message\n */\ninterface WorkoutMetrics {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    elapsed?: string;\n    dataType?: string;\n}\n\n/**\n * All streams message data\n */\ninterface AllStreamsMessageData {\n    stream: string;\n    data: {\n        message: string;\n    } | WorkoutMetrics;\n}\n\n/**\n * Stream viewer class that manages the stream viewing UI\n */\nexport class StreamViewer {\n    private modal: HTMLDivElement | null = null;\n    private currentConnection: SSEConnection | null = null;\n    private streamMetricsSection: HTMLElement | null = null;\n    private allStreamsMetricsSection: HTMLElement | null = null;\n    private allStreamsConnection: SSEConnection | null = null;\n    private streamCards: Map<string, HTMLElement> = new Map();\n    private streamRows: Map<string, HTMLElement> = new Map();\n    private isCompactView: boolean = false;\n\n    constructor() {\n        this.initModal();\n        this.initInlineViewer();\n        this.initAllStreamsViewer();\n    }\n\n    /**\n     * Initialize the inline stream viewer in main content\n     */\n    private initInlineViewer(): void {\n        this.streamMetricsSection = document.getElementById('streamMetrics');\n        if (!this.streamMetricsSection) {\n            console.warn('Stream metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeStreamView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromStream());\n        }\n    }\n\n    /**\n     * Initialize the all streams viewer\n     */\n    private initAllStreamsViewer(): void {\n        this.allStreamsMetricsSection = document.getElementById('allStreamsMetrics');\n        if (!this.allStreamsMetricsSection) {\n            console.warn('All streams metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeAllStreamsView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromAllStreams());\n        }\n\n        const toggleViewBtn = document.getElementById('toggleViewBtn');\n        if (toggleViewBtn) {\n            toggleViewBtn.addEventListener('click', () => this.toggleAllStreamsView());\n        }\n    }\n\n    /**\n     * Toggle between grid and compact list view\n     */\n    private toggleAllStreamsView(): void {\n        this.isCompactView = !this.isCompactView;\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        const toggleBtn = document.getElementById('toggleViewBtn');\n\n        if (this.isCompactView) {\n            if (grid) grid.style.display = 'none';\n            if (list) list.style.display = 'flex';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle grid view';\n                toggleBtn.classList.add('active');\n            }\n        } else {\n            if (grid) grid.style.display = 'grid';\n            if (list) list.style.display = 'none';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle compact view';\n                toggleBtn.classList.remove('active');\n            }\n        }\n    }\n\n    /**\n     * Initialize the stream viewer modal\n     */\n    private initModal(): void {\n        const modal = document.createElement('div');\n        modal.id = 'streamViewerModal';\n        modal.className = 'stream-modal';\n        modal.innerHTML = `\n      <div class=\"stream-modal-content\">\n        <div class=\"stream-modal-header\">\n          <h2> Live Streams</h2>\n          <button id=\"closeStreamModal\" class=\"close-button\">&times;</button>\n        </div>\n        <div class=\"stream-modal-body\">\n          <div class=\"stream-list-container\">\n            <div class=\"stream-list-controls\" style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n              <button id=\"refreshStreamList\" class=\"refresh-button\"> Refresh List</button>\n              <button id=\"viewAllStreamsBtn\" class=\"connect-button\" style=\"background-color: #4CAF50;\"> View All Streams</button>\n            </div>\n            <div id=\"streamsList\" class=\"streams-list\">\n              <p class=\"loading\">Loading streams...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n        document.body.appendChild(modal);\n        this.modal = modal;\n        this.setupEventListeners();\n    }\n\n    /**\n     * Set up event listeners for modal controls\n     */\n    private setupEventListeners(): void {\n        const closeBtn = document.getElementById('closeStreamModal');\n        const refreshBtn = document.getElementById('refreshStreamList');\n        const viewAllBtn = document.getElementById('viewAllStreamsBtn');\n\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.close());\n        }\n        if (refreshBtn) {\n            refreshBtn.addEventListener('click', () => this.refreshStreamList());\n        }\n        if (viewAllBtn) {\n            viewAllBtn.addEventListener('click', () => this.connectToAllStreams());\n        }\n\n        if (this.modal) {\n            this.modal.addEventListener('click', (e: MouseEvent) => {\n                if (e.target === this.modal) {\n                    this.close();\n                }\n            });\n        }\n    }\n\n    /**\n     * Open the stream viewer modal\n     */\n    async open(): Promise<void> {\n        if (this.modal) {\n            this.modal.style.display = 'flex';\n        }\n        await this.refreshStreamList();\n    }\n\n    /**\n     * Close the stream viewer modal\n     */\n    close(): void {\n        if (this.modal) {\n            this.modal.style.display = 'none';\n        }\n    }\n\n    /**\n     * Refresh the list of available streams\n     */\n    async refreshStreamList(): Promise<void> {\n        const streamsList = document.getElementById('streamsList');\n        if (!streamsList) return;\n\n        streamsList.innerHTML = '<p class=\"loading\">Loading streams...</p>';\n\n        try {\n            const { streams } = await listStreams();\n\n            if (streams.length === 0) {\n                streamsList.innerHTML = '<p class=\"no-streams\">No active streams found</p>';\n                return;\n            }\n\n            streamsList.innerHTML = '';\n            streams.forEach((stream: StreamInfo) => {\n                const streamItem = this.createStreamItem(stream);\n                streamsList.appendChild(streamItem);\n            });\n        } catch (error) {\n            console.error('Failed to load streams:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            streamsList.innerHTML = `<p class=\"error\">Failed to load streams: ${message}</p>`;\n        }\n    }\n\n    /**\n     * Create a stream list item element\n     */\n    private createStreamItem(stream: StreamInfo): HTMLElement {\n        const div = document.createElement('div');\n        div.className = 'stream-item';\n\n        const isWorkoutStream = stream.name.startsWith('workout-');\n        const icon = isWorkoutStream ? '' : '';\n\n        div.innerHTML = `\n      <div class=\"stream-item-info\">\n        <div class=\"stream-item-name\">${icon} ${stream.name}</div>\n        <div class=\"stream-item-meta\">\n          ${stream.length} message${stream.length !== 1 ? 's' : ''}\n        </div>\n      </div>\n      <button class=\"connect-button\" data-stream=\"${stream.name}\">\n         View\n      </button>\n    `;\n\n        const connectBtn = div.querySelector('.connect-button');\n        connectBtn?.addEventListener('click', () => {\n            this.connectToStream(stream.name);\n        });\n\n        return div;\n    }\n\n    /**\n     * Connect to a stream and view live data\n     */\n    connectToStream(streamName: string): void {\n        this.disconnectFromStream();\n\n        if (!this.streamMetricsSection) {\n            console.error('Stream metrics section not available');\n            return;\n        }\n\n        this.streamMetricsSection.style.display = 'flex';\n\n        const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n        if (toggleStream) toggleStream.checked = true;\n\n        const streamTitle = document.getElementById('streamTitle');\n        const statusEl = document.getElementById('streamStatus');\n\n        if (streamTitle) streamTitle.textContent = streamName;\n        if (statusEl) {\n            statusEl.textContent = 'Connecting...';\n            statusEl.className = 'status-badge connecting';\n        }\n\n        this.close();\n\n        this.currentConnection = listenToStream(\n            streamName,\n            (data: SSEMessageData) => this.handleStreamMessage(data),\n            () => this.handleStreamConnected(),\n            (error: Error | Event) => this.handleStreamError(error)\n        );\n    }\n\n    /**\n     * Connect to all streams\n     */\n    connectToAllStreams(): void {\n        this.disconnectFromStream();\n        this.disconnectFromAllStreams();\n\n        if (!this.allStreamsMetricsSection) {\n            console.error('All streams metrics section not available');\n            return;\n        }\n\n        this.allStreamsMetricsSection.style.display = 'flex';\n        this.close();\n\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        if (grid) grid.innerHTML = '';\n        if (list) list.innerHTML = '';\n        this.streamCards.clear();\n        this.streamRows.clear();\n\n        const allStreamsStatus = document.getElementById('allStreamsStatus');\n        if (allStreamsStatus) {\n            allStreamsStatus.textContent = 'Connecting...';\n            allStreamsStatus.className = 'status-badge connecting';\n        }\n\n        this.allStreamsConnection = listenToAllStreams(\n            (data: SSEMessageData) => this.handleAllStreamsMessage(data as unknown as AllStreamsMessageData),\n            () => this.handleAllStreamsConnected(),\n            (error: Error | Event) => this.handleAllStreamsError(error)\n        );\n    }\n\n    /**\n     * Handle all streams connected event\n     */\n    private handleAllStreamsConnected(): void {\n        console.log('Connected to all streams');\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle all streams error\n     */\n    private handleAllStreamsError(error: Error | Event): void {\n        console.error('All streams error:', error);\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (!statusEl) return;\n\n        if (this.allStreamsConnection && this.allStreamsConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Disconnect from all streams\n     */\n    disconnectFromAllStreams(): void {\n        if (this.allStreamsConnection) {\n            this.allStreamsConnection.close();\n            this.allStreamsConnection = null;\n        }\n\n        if (this.allStreamsMetricsSection) {\n            this.allStreamsMetricsSection.style.display = 'none';\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n    }\n\n    /**\n     * Handle incoming message for all streams view\n     */\n    private handleAllStreamsMessage(data: AllStreamsMessageData): void {\n        try {\n            const streamName = data.stream;\n            const messageData = typeof data.data === 'string'\n                ? JSON.parse(data.data)\n                : data.data;\n\n            this.updateStreamCard(streamName, messageData);\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update or create a stream card\n     */\n    private updateStreamCard(streamName: string, data: { message?: string } & WorkoutMetrics): void {\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n\n        let messageData: WorkoutMetrics = {};\n        try {\n            if (data.message) {\n                messageData = JSON.parse(data.message);\n            } else {\n                messageData = data;\n            }\n        } catch {\n            // Ignore parse errors\n        }\n\n        if (grid) {\n            let card = this.streamCards.get(streamName);\n\n            if (!card) {\n                card = document.createElement('div');\n                card.className = 'stream-card';\n                card.innerHTML = `\n          <div class=\"stream-card-name\" title=\"${streamName}\">${streamName}</div>\n          <div class=\"stream-card-power\">--</div>\n          <div class=\"stream-card-secondary\">\n            <div class=\"stream-card-metric\">\n              <span>CAD</span>\n              <span class=\"card-cadence\">--</span>\n            </div>\n            <div class=\"stream-card-metric\">\n              <span>HR</span>\n              <span class=\"card-heartrate\">--</span>\n            </div>\n          </div>\n        `;\n                grid.appendChild(card);\n                this.streamCards.set(streamName, card);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = card.querySelector('.stream-card-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n\n            if (messageData.cadence !== undefined && messageData.cadence !== null) {\n                const cadenceEl = card.querySelector('.card-cadence');\n                if (cadenceEl) cadenceEl.textContent = String(messageData.cadence);\n            }\n\n            if (messageData.heartrate !== undefined && messageData.heartrate !== null) {\n                const hrEl = card.querySelector('.card-heartrate');\n                if (hrEl) hrEl.textContent = String(messageData.heartrate);\n            }\n        }\n\n        if (list) {\n            let row = this.streamRows.get(streamName);\n\n            if (!row) {\n                row = document.createElement('div');\n                row.className = 'stream-row';\n                row.innerHTML = `\n          <span class=\"stream-row-name\" title=\"${streamName}\">${streamName}</span>\n          <span class=\"stream-row-power\">--</span>\n        `;\n                list.appendChild(row);\n                this.streamRows.set(streamName, row);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = row.querySelector('.stream-row-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n        }\n    }\n\n    /**\n     * Disconnect from the current stream\n     */\n    disconnectFromStream(): void {\n        this.disconnectFromAllStreams();\n\n        if (this.currentConnection) {\n            this.currentConnection.close();\n            this.currentConnection = null;\n        }\n\n        if (this.streamMetricsSection) {\n            this.streamMetricsSection.style.display = 'none';\n\n            const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n            if (toggleStream) toggleStream.checked = false;\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n\n        this.resetViewer();\n    }\n\n    /**\n     * Handle stream connected event\n     */\n    private handleStreamConnected(): void {\n        const statusEl = document.getElementById('streamStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle incoming stream message\n     */\n    private handleStreamMessage(data: SSEMessageData): void {\n        try {\n            const messageStr = (data as unknown as { data: { message: string } }).data?.message;\n            const messageData: WorkoutMetrics = typeof messageStr === 'string'\n                ? JSON.parse(messageStr)\n                : (data as unknown as { data: WorkoutMetrics }).data;\n\n            if (\n                messageData.dataType === 'workout_metrics' ||\n                messageData.power !== undefined ||\n                messageData.cadence !== undefined ||\n                messageData.heartrate !== undefined\n            ) {\n                this.updateMetrics(messageData);\n            }\n\n            const lastUpdateEl = document.getElementById('streamLastUpdate');\n            if (lastUpdateEl) {\n                const now = new Date();\n                lastUpdateEl.textContent = `Last update: ${now.toLocaleTimeString()}`;\n            }\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update metrics display with new data\n     */\n    private updateMetrics(data: WorkoutMetrics): void {\n        const powerEl = document.getElementById('streamPower');\n        const cadenceEl = document.getElementById('streamCadence');\n        const heartrateEl = document.getElementById('streamHeartrate');\n        const speedEl = document.getElementById('streamSpeed');\n        const distanceEl = document.getElementById('streamDistance');\n        const altitudeEl = document.getElementById('streamAltitude');\n        const elapsedEl = document.getElementById('streamElapsed');\n\n        if (powerEl && data.power !== null && data.power !== undefined) {\n            powerEl.textContent = String(data.power);\n        }\n        if (cadenceEl && data.cadence !== null && data.cadence !== undefined) {\n            cadenceEl.textContent = String(data.cadence);\n        }\n        if (heartrateEl && data.heartrate !== null && data.heartrate !== undefined) {\n            heartrateEl.textContent = String(data.heartrate);\n        }\n        if (speedEl && data.speed !== null && data.speed !== undefined) {\n            speedEl.textContent = String(data.speed);\n        }\n        if (distanceEl && data.distance !== null && data.distance !== undefined) {\n            distanceEl.textContent = String(data.distance);\n        }\n        if (altitudeEl && data.altitude !== null && data.altitude !== undefined) {\n            altitudeEl.textContent = String(data.altitude);\n        }\n        if (elapsedEl && data.elapsed) {\n            elapsedEl.textContent = data.elapsed;\n        }\n    }\n\n    /**\n     * Handle stream error\n     */\n    private handleStreamError(error: Error | Event): void {\n        console.error('Stream error:', error);\n        const statusEl = document.getElementById('streamStatus');\n        if (!statusEl) return;\n\n        if (this.currentConnection && this.currentConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Reset viewer display\n     */\n    private resetViewer(): void {\n        const elements = [\n            'streamPower',\n            'streamCadence',\n            'streamHeartrate',\n            'streamSpeed',\n            'streamDistance',\n            'streamAltitude',\n            'streamElapsed',\n        ];\n\n        elements.forEach((id) => {\n            const el = document.getElementById(id);\n            if (el) el.textContent = '--';\n        });\n\n        const streamLastUpdate = document.getElementById('streamLastUpdate');\n        if (streamLastUpdate) streamLastUpdate.textContent = 'Waiting for data...';\n    }\n}\n\n/**\n * Initialize stream viewer UI\n */\nexport function initStreamViewer(): StreamViewer {\n    const viewer = new StreamViewer();\n\n    const viewStreamsBtn = document.getElementById('viewStreamsButton');\n    if (viewStreamsBtn) {\n        viewStreamsBtn.addEventListener('click', () => viewer.open());\n    }\n\n    return viewer;\n}\n","/**\n * Streaming Controls Initialization\n * \n * Sets up UI controls for starting, pausing, and stopping workout streaming.\n * \n * @module initStreamingControls\n */\n\nimport { showNotification } from './ui/notifications.js';\nimport type { StreamManager, StreamStatus, WorkoutTimeState } from './streamManager.js';\n\n/**\n * Initialize streaming controls.\n * \n * Sets up event handlers for:\n * - Start/stop streaming button\n * - Stream name modal\n * - Toolbar play/pause/stop buttons\n * - Auto-stop when workout ends\n * \n * @param streamManager - The stream manager instance\n * @param timeState - The workout time state\n */\nexport function initStreamingControls(\n    streamManager: StreamManager,\n    timeState: WorkoutTimeState\n): void {\n    // Main button\n    const startStreamButton = document.getElementById('startStreamButton') as HTMLButtonElement | null;\n\n    // Modal elements\n    const modal = document.getElementById('streamNameModal') as HTMLDivElement | null;\n    const closeBtn = document.getElementById('closeStreamNameModal') as HTMLButtonElement | null;\n    const cancelBtn = document.getElementById('cancelStreamName') as HTMLButtonElement | null;\n    const confirmBtn = document.getElementById('confirmStreamName') as HTMLButtonElement | null;\n    const nameInput = document.getElementById('streamNameInput') as HTMLInputElement | null;\n\n    // Toolbar elements\n    const toolbar = document.getElementById('activeStreamToolbar') as HTMLDivElement | null;\n    const toolbarStreamName = document.getElementById('toolbarStreamName') as HTMLSpanElement | null;\n    const playPauseBtn = document.getElementById('streamPlayPauseBtn') as HTMLButtonElement | null;\n    const stopBtn = document.getElementById('streamStopBtn') as HTMLButtonElement | null;\n    const streamIndicator = document.querySelector('.stream-indicator') as HTMLElement | null;\n\n    /**\n     * Update toolbar visibility and state\n     */\n    const updateToolbar = (status: StreamStatus): void => {\n        if (!toolbar) return;\n\n        if (status.isStreaming) {\n            toolbar.style.display = 'flex';\n            document.body.classList.add('has-stream-toolbar');\n\n            if (toolbarStreamName) {\n                toolbarStreamName.textContent = status.streamName;\n            }\n\n            // Update Play/Pause button\n            if (playPauseBtn) {\n                if (status.isPaused) {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Resume Stream';\n                    streamIndicator?.classList.add('paused');\n                } else {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Pause Stream';\n                    streamIndicator?.classList.remove('paused');\n                }\n            }\n        } else {\n            toolbar.style.display = 'none';\n            document.body.classList.remove('has-stream-toolbar');\n        }\n    };\n\n    if (!startStreamButton) {\n        console.warn('Start stream button not found in DOM');\n        return;\n    }\n\n    /**\n     * Close the stream name modal\n     */\n    const closeModal = (): void => {\n        if (modal) modal.style.display = 'none';\n        if (nameInput) nameInput.value = '';\n    };\n\n    /**\n     * Start streaming with optional custom name\n     */\n    const startStreaming = async (): Promise<void> => {\n        const customName = nameInput?.value.trim() || '';\n\n        try {\n            const streamName = await streamManager.startStreaming(customName || undefined);\n            startStreamButton.textContent = ' Stop Streaming';\n            startStreamButton.classList.add('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification(`Streaming to: ${streamName}`, 'success');\n            closeModal();\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            showNotification('Failed to start streaming: ' + message, 'error');\n        }\n    };\n\n    /**\n     * Stop streaming\n     */\n    const stopStreaming = async (): Promise<void> => {\n        try {\n            await streamManager.stopStreaming();\n            startStreamButton.textContent = ' Start Streaming';\n            startStreamButton.classList.remove('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification('Streaming stopped', 'info');\n        } catch (error) {\n            console.error(error);\n            showNotification('Error stopping stream', 'error');\n        }\n    };\n\n    // Wire up toolbar buttons\n    if (playPauseBtn) {\n        playPauseBtn.addEventListener('click', () => {\n            const status = streamManager.getStatus();\n            if (status.isPaused) {\n                streamManager.resumeStreaming();\n                showNotification('Stream Resumed', 'success');\n            } else {\n                streamManager.pauseStreaming();\n                showNotification('Stream Paused', 'info');\n            }\n            updateToolbar(streamManager.getStatus());\n        });\n    }\n\n    if (stopBtn) {\n        stopBtn.addEventListener('click', async () => {\n            if (confirm('Stop streaming?')) {\n                await stopStreaming();\n            }\n        });\n    }\n\n    // Event listeners for modal\n    if (closeBtn) closeBtn.addEventListener('click', closeModal);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);\n\n    if (confirmBtn) {\n        confirmBtn.addEventListener('click', startStreaming);\n    }\n\n    if (nameInput) {\n        nameInput.addEventListener('keypress', (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n                startStreaming();\n            }\n        });\n    }\n\n    // Close on click outside\n    if (modal) {\n        modal.addEventListener('click', (e: MouseEvent) => {\n            if (e.target === modal) closeModal();\n        });\n    }\n\n    // Main button click handler\n    startStreamButton.addEventListener('click', async () => {\n        if (streamManager.isStreaming) {\n            await stopStreaming();\n        } else {\n            if (modal) {\n                modal.style.display = 'flex';\n                nameInput?.focus();\n            } else {\n                // Fallback if modal missing\n                try {\n                    const streamName = await streamManager.startStreaming();\n                    startStreamButton.textContent = ' Stop Streaming';\n                    startStreamButton.classList.add('streaming');\n                    updateToolbar(streamManager.getStatus());\n                    showNotification(`Streaming to: ${streamName}`, 'success');\n                } catch (error) {\n                    console.error('Failed to start streaming:', error);\n                    const message = error instanceof Error ? error.message : 'Unknown error';\n                    showNotification('Failed to start streaming: ' + message, 'error');\n                }\n            }\n        }\n    });\n\n    // Auto-stop streaming when workout is stopped (Pause or Stop buttons)\n    const pauseButton = document.getElementById('pauseButton');\n    const stopButton = document.getElementById('stopButton');\n\n    const handleWorkoutPause = () => {\n        if (timeState.running === false && streamManager.isStreaming) {\n            // Workout was just paused\n            setTimeout(() => {\n                if (!timeState.running && streamManager.isStreaming) {\n                    streamManager.stopStreaming();\n                    startStreamButton.textContent = ' Start Streaming';\n                    startStreamButton.classList.remove('streaming');\n                    updateToolbar(streamManager.getStatus());\n                }\n            }, 100);\n        }\n    };\n\n    if (pauseButton) {\n        pauseButton.addEventListener('click', handleWorkoutPause);\n    }\n    if (stopButton) {\n        stopButton.addEventListener('click', handleWorkoutPause);\n    }\n}\n","/**\n * API client for workout database operations\n * Handles communication with the workout history API\n * \n * @module workoutClient\n */\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Workout data from API\n */\nexport interface Workout {\n    id: string;\n    userId?: string;\n    streamName?: string;\n    title?: string;\n    description?: string;\n    sport: string;\n    startTime: string;\n    endTime?: string;\n    duration?: number;\n    status: 'ACTIVE' | 'PAUSED' | 'COMPLETED' | 'ARCHIVED' | 'DELETED';\n    summary?: string;\n    telemetry?: string;\n    createdAt: string;\n    updatedAt: string;\n}\n\n/**\n * Pagination info\n */\nexport interface PaginationInfo {\n    page: number;\n    limit: number;\n    total: number;\n    totalPages: number;\n}\n\n/**\n * List workouts response\n */\nexport interface ListWorkoutsResponse {\n    workouts: Workout[];\n    pagination: PaginationInfo;\n}\n\n/**\n * List workouts options\n */\nexport interface ListWorkoutsOptions {\n    page?: number;\n    limit?: number;\n    status?: string;\n    userId?: string;\n}\n\n/**\n * Create workout params\n */\nexport interface CreateWorkoutParams {\n    streamName: string;\n    title?: string;\n    sport?: string;\n    userId?: string;\n}\n\n/**\n * Create workout response\n */\nexport interface CreateWorkoutResponse {\n    success: boolean;\n    workout: Workout;\n}\n\n/**\n * Update workout params\n */\nexport interface UpdateWorkoutParams {\n    title?: string;\n    description?: string;\n    sport?: string;\n}\n\n/**\n * Complete workout response\n */\nexport interface CompleteWorkoutResponse {\n    success: boolean;\n    workout: Workout;\n    archivedMessages: number;\n}\n\n/**\n * Delete workout response\n */\nexport interface DeleteWorkoutResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * User statistics\n */\nexport interface UserStats {\n    totalWorkouts: number;\n    totalDuration: number;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Check if database features are available\n * \n * @returns Promise resolving to true if database is connected\n */\nexport async function isDatabaseAvailable(): Promise<boolean> {\n    try {\n        const response = await fetch(`${API_BASE_URL}/health`, {\n            headers: getHeaders(),\n        });\n        if (!response.ok) return false;\n        const health = await response.json();\n        return health.database === 'connected';\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Create a new workout\n * \n * @param params - Workout parameters\n * @returns Promise with created workout\n */\nexport async function createWorkout({\n    streamName,\n    title,\n    sport = 'cycling',\n    userId,\n}: CreateWorkoutParams): Promise<CreateWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName, title, sport, userId }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create workout');\n    }\n\n    return response.json();\n}\n\n/**\n * List workouts with pagination\n * \n * @param options - Query options\n * @returns Promise with workouts and pagination info\n */\nexport async function listWorkouts({\n    page = 1,\n    limit = 20,\n    status,\n    userId,\n}: ListWorkoutsOptions = {}): Promise<ListWorkoutsResponse> {\n    const params = new URLSearchParams();\n    params.set('page', page.toString());\n    params.set('limit', limit.toString());\n    if (status) params.set('status', status);\n    if (userId) params.set('userId', userId);\n\n    const response = await fetch(`${API_BASE_URL}/api/workouts?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to list workouts');\n    }\n\n    return response.json();\n}\n\n/**\n * Get a single workout by ID\n * \n * @param workoutId - Workout ID\n * @param includeTelemetry - Include full telemetry data\n * @returns Promise with workout data\n */\nexport async function getWorkout(\n    workoutId: string,\n    includeTelemetry: boolean = false\n): Promise<Workout> {\n    const params = new URLSearchParams();\n    if (includeTelemetry) params.set('includeTelemetry', 'true');\n\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Update workout metadata\n * \n * @param workoutId - Workout ID\n * @param data - Fields to update\n * @returns Promise with updated workout\n */\nexport async function updateWorkout(\n    workoutId: string,\n    { title, description, sport }: UpdateWorkoutParams\n): Promise<CreateWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}`, {\n        method: 'PATCH',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ title, description, sport }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to update workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Complete a workout (archive from Redis to database)\n * \n * @param workoutId - Workout ID\n * @param archiveTelemetry - Archive telemetry data\n * @returns Promise with completion result\n */\nexport async function completeWorkout(\n    workoutId: string,\n    archiveTelemetry: boolean = true\n): Promise<CompleteWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}/complete`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ archiveTelemetry }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to complete workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Delete a workout\n * \n * @param workoutId - Workout ID\n * @returns Promise with deletion result\n */\nexport async function deleteWorkout(workoutId: string): Promise<DeleteWorkoutResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/workouts/${workoutId}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete workout');\n    }\n\n    return response.json();\n}\n\n/**\n * Get active workout by stream name\n * \n * @param streamName - Stream name\n * @returns Promise with workout or null if not found\n */\nexport async function getWorkoutByStream(streamName: string): Promise<Workout | null> {\n    try {\n        const response = await fetch(\n            `${API_BASE_URL}/api/workouts/by-stream/${encodeURIComponent(streamName)}`,\n            {\n                headers: getHeaders(),\n            }\n        );\n\n        if (response.status === 404) {\n            return null;\n        }\n\n        if (!response.ok) {\n            const error = await response.json();\n            throw new Error(error.error || 'Failed to get workout');\n        }\n\n        return response.json();\n    } catch (error) {\n        if (error instanceof Error && error.message.includes('not found')) {\n            return null;\n        }\n        throw error;\n    }\n}\n\n/**\n * Get user statistics\n * \n * @param userId - User ID\n * @returns Promise with user stats\n */\nexport async function getUserStats(userId: string): Promise<UserStats> {\n    const response = await fetch(`${API_BASE_URL}/api/users/${userId}/stats`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get user stats');\n    }\n\n    return response.json();\n}\n\n/**\n * Format duration in seconds to human-readable string\n * \n * @param seconds - Duration in seconds\n * @returns Formatted duration string\n */\nexport function formatDuration(seconds: number | undefined | null): string {\n    if (!seconds) return '--';\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n\n    if (hours > 0) {\n        return `${hours}h ${minutes}m`;\n    }\n    if (minutes > 0) {\n        return `${minutes}m ${secs}s`;\n    }\n    return `${secs}s`;\n}\n\n/**\n * Format date to locale string\n * \n * @param date - Date to format\n * @returns Formatted date string\n */\nexport function formatDate(date: string | Date | undefined | null): string {\n    if (!date) return '--';\n    return new Date(date).toLocaleDateString(undefined, {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n    });\n}\n","/**\n * Workout History UI\n * \n * Displays saved workouts and allows viewing details.\n * \n * @module workoutHistory\n */\n\nimport {\n    isDatabaseAvailable,\n    listWorkouts,\n    getWorkout,\n    deleteWorkout,\n    formatDuration,\n    formatDate,\n    type Workout,\n    type ListWorkoutsResponse,\n} from '../api/workoutClient.js';\n\n/** Current pagination page */\nlet currentPage = 1;\n/** Total number of pages */\nlet totalPages = 1;\n/** Database availability flag */\nlet dbAvailable = false;\n\n/**\n * Workout summary data from API\n */\ninterface WorkoutSummary {\n    avgPower?: number;\n    maxPower?: number;\n    normalizedPower?: number;\n    avgCadence?: number;\n    maxCadence?: number;\n    avgHeartrate?: number;\n    maxHeartrate?: number;\n    totalEnergy?: number;\n    sampleCount?: number;\n}\n\n/**\n * Initialize the workout history feature\n */\nexport function initWorkoutHistory(): void {\n    const historyButton = document.getElementById('workoutHistoryButton') as HTMLButtonElement | null;\n    const modal = document.getElementById('workoutHistoryModal') as HTMLDivElement | null;\n    const closeBtn = document.getElementById('closeWorkoutHistoryModal');\n    const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n    const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n    const refreshBtn = document.getElementById('historyRefresh');\n\n    if (!historyButton || !modal) {\n        console.warn('Workout history elements not found');\n        return;\n    }\n\n    // Check if database is available on load\n    checkDatabaseAvailability();\n\n    // Open modal\n    historyButton.addEventListener('click', async () => {\n        modal.style.display = 'flex';\n        currentPage = 1;\n        await loadWorkouts();\n    });\n\n    // Close modal\n    closeBtn?.addEventListener('click', () => {\n        modal.style.display = 'none';\n    });\n\n    // Close on outside click\n    modal.addEventListener('click', (e: MouseEvent) => {\n        if (e.target === modal) {\n            modal.style.display = 'none';\n        }\n    });\n\n    // Pagination\n    prevBtn?.addEventListener('click', async () => {\n        if (currentPage > 1) {\n            currentPage--;\n            await loadWorkouts();\n        }\n    });\n\n    nextBtn?.addEventListener('click', async () => {\n        if (currentPage < totalPages) {\n            currentPage++;\n            await loadWorkouts();\n        }\n    });\n\n    // Refresh\n    refreshBtn?.addEventListener('click', async () => {\n        await loadWorkouts();\n    });\n\n    // Close on Escape key\n    document.addEventListener('keydown', (e: KeyboardEvent) => {\n        if (e.key === 'Escape' && modal.style.display === 'flex') {\n            modal.style.display = 'none';\n        }\n    });\n}\n\n/**\n * Check if database features are available\n */\nasync function checkDatabaseAvailability(): Promise<void> {\n    const historyButton = document.getElementById('workoutHistoryButton') as HTMLButtonElement | null;\n\n    try {\n        dbAvailable = await isDatabaseAvailable();\n        if (historyButton) {\n            historyButton.disabled = !dbAvailable;\n            historyButton.title = dbAvailable\n                ? 'View workout history'\n                : 'Database not configured';\n        }\n    } catch {\n        dbAvailable = false;\n        if (historyButton) {\n            historyButton.disabled = true;\n            historyButton.title = 'Database not available';\n        }\n    }\n}\n\n/**\n * Load and display workouts\n */\nasync function loadWorkouts(): Promise<void> {\n    const listContainer = document.getElementById('workoutList');\n    const pageInfo = document.getElementById('historyPageInfo');\n    const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n    const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n\n    if (!listContainer) return;\n\n    // Show loading state\n    listContainer.innerHTML = '<div class=\"workout-loading\">Loading workouts...</div>';\n\n    try {\n        const result: ListWorkoutsResponse = await listWorkouts({ page: currentPage, limit: 10 });\n        const { workouts, pagination } = result;\n\n        totalPages = pagination.totalPages;\n\n        // Update pagination info\n        if (pageInfo) {\n            pageInfo.textContent = `Page ${pagination.page} of ${pagination.totalPages} (${pagination.total} total)`;\n        }\n\n        // Update pagination buttons\n        if (prevBtn) prevBtn.disabled = currentPage <= 1;\n        if (nextBtn) nextBtn.disabled = currentPage >= totalPages;\n\n        // Render workouts\n        if (workouts.length === 0) {\n            listContainer.innerHTML = `\n        <div class=\"workout-empty\">\n          <p>No workouts found</p>\n          <p class=\"workout-empty-hint\">Start a workout to see it here!</p>\n        </div>\n      `;\n            return;\n        }\n\n        listContainer.innerHTML = workouts.map((workout) => renderWorkoutCard(workout)).join('');\n\n        // Add event listeners for workout cards\n        listContainer.querySelectorAll('.workout-card').forEach((card) => {\n            const workoutId = (card as HTMLElement).dataset.workoutId;\n            if (!workoutId) return;\n\n            // View details\n            card.querySelector('.workout-view-btn')?.addEventListener('click', (e: Event) => {\n                e.stopPropagation();\n                viewWorkoutDetails(workoutId);\n            });\n\n            // Delete\n            card.querySelector('.workout-delete-btn')?.addEventListener('click', (e: Event) => {\n                e.stopPropagation();\n                confirmDeleteWorkout(workoutId);\n            });\n        });\n    } catch (error) {\n        console.error('Failed to load workouts:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        listContainer.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workouts</p>\n        <p class=\"workout-error-detail\">${message}</p>\n      </div>\n    `;\n    }\n}\n\n/**\n * Render a workout card\n */\nfunction renderWorkoutCard(workout: Workout): string {\n    const statusClass = workout.status.toLowerCase();\n    const summary: WorkoutSummary = workout.summary ? JSON.parse(workout.summary) : {};\n\n    return `\n    <div class=\"workout-card\" data-workout-id=\"${workout.id}\">\n      <div class=\"workout-card-header\">\n        <span class=\"workout-title\">${workout.title || 'Untitled Workout'}</span>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n      <div class=\"workout-card-body\">\n        <div class=\"workout-date\">\n           ${formatDate(workout.startTime)}\n        </div>\n        <div class=\"workout-stats\">\n          ${workout.duration ? `<span class=\"workout-stat\"> ${formatDuration(workout.duration)}</span>` : ''}\n          ${summary.avgPower ? `<span class=\"workout-stat\"> ${summary.avgPower}W avg</span>` : ''}\n          ${summary.maxPower ? `<span class=\"workout-stat\"> ${summary.maxPower}W max</span>` : ''}\n          ${summary.avgHeartrate ? `<span class=\"workout-stat\"> ${summary.avgHeartrate} bpm</span>` : ''}\n          ${summary.totalEnergy ? `<span class=\"workout-stat\"> ${summary.totalEnergy} kJ</span>` : ''}\n        </div>\n      </div>\n      <div class=\"workout-card-actions\">\n        <button class=\"workout-view-btn\" title=\"View details\"> View</button>\n        <button class=\"workout-delete-btn\" title=\"Delete workout\"></button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * View workout details in a detail panel\n */\nasync function viewWorkoutDetails(workoutId: string): Promise<void> {\n    const detailPanel = document.getElementById('workoutDetailPanel');\n    const listPanel = document.getElementById('workoutListPanel');\n\n    if (!detailPanel || !listPanel) return;\n\n    // Show detail panel\n    listPanel.style.display = 'none';\n    detailPanel.style.display = 'block';\n    detailPanel.innerHTML = '<div class=\"workout-loading\">Loading workout details...</div>';\n\n    try {\n        const workout = await getWorkout(workoutId, true);\n        detailPanel.innerHTML = renderWorkoutDetail(workout);\n\n        // Back button\n        detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n            detailPanel.style.display = 'none';\n            listPanel.style.display = 'block';\n        });\n\n        // Export button\n        detailPanel.querySelector('.workout-export-btn')?.addEventListener('click', () => {\n            exportWorkoutData(workout);\n        });\n    } catch (error) {\n        console.error('Failed to load workout details:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        detailPanel.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workout</p>\n        <p class=\"workout-error-detail\">${message}</p>\n        <button class=\"workout-back-btn\"> Back to list</button>\n      </div>\n    `;\n        detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n            detailPanel.style.display = 'none';\n            listPanel.style.display = 'block';\n        });\n    }\n}\n\n/**\n * Render workout detail view\n */\nfunction renderWorkoutDetail(workout: Workout): string {\n    const summary: WorkoutSummary = workout.summary ? JSON.parse(workout.summary) : {};\n    const statusClass = workout.status.toLowerCase();\n\n    return `\n    <div class=\"workout-detail\">\n      <div class=\"workout-detail-header\">\n        <button class=\"workout-back-btn\"> Back</button>\n        <h3>${workout.title || 'Untitled Workout'}</h3>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n\n      <div class=\"workout-detail-meta\">\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Sport</span>\n          <span class=\"meta-value\">${workout.sport || 'cycling'}</span>\n        </div>\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Start Time</span>\n          <span class=\"meta-value\">${formatDate(workout.startTime)}</span>\n        </div>\n        ${workout.endTime ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">End Time</span>\n            <span class=\"meta-value\">${formatDate(workout.endTime)}</span>\n          </div>\n        ` : ''}\n        ${workout.duration ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">Duration</span>\n            <span class=\"meta-value\">${formatDuration(workout.duration)}</span>\n          </div>\n        ` : ''}\n      </div>\n\n      ${Object.keys(summary).length > 0 ? `\n        <div class=\"workout-detail-summary\">\n          <h4>Summary</h4>\n          <div class=\"summary-grid\">\n            ${summary.avgPower ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Power</span>\n                <span class=\"summary-value\">${summary.avgPower} W</span>\n              </div>\n            ` : ''}\n            ${summary.maxPower ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Max Power</span>\n                <span class=\"summary-value\">${summary.maxPower} W</span>\n              </div>\n            ` : ''}\n            ${summary.avgCadence ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Cadence</span>\n                <span class=\"summary-value\">${summary.avgCadence} rpm</span>\n              </div>\n            ` : ''}\n            ${summary.avgHeartrate ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Heart Rate</span>\n                <span class=\"summary-value\">${summary.avgHeartrate} bpm</span>\n              </div>\n            ` : ''}\n            ${summary.totalEnergy ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Total Energy</span>\n                <span class=\"summary-value\">${summary.totalEnergy} kJ</span>\n              </div>\n            ` : ''}\n          </div>\n        </div>\n      ` : ''}\n\n      ${workout.description ? `\n        <div class=\"workout-detail-description\">\n          <h4>Notes</h4>\n          <p>${workout.description}</p>\n        </div>\n      ` : ''}\n\n      <div class=\"workout-detail-actions\">\n        ${workout.telemetry ? `\n          <button class=\"workout-export-btn\"> Export Data</button>\n        ` : ''}\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Export workout data to files\n */\nfunction exportWorkoutData(workout: Workout): void {\n    const timestamp = new Date(workout.startTime).toISOString().replace(/[:.]/g, '-').slice(0, 19);\n    const filename = `workout-${timestamp}`;\n\n    const jsonData = {\n        id: workout.id,\n        title: workout.title,\n        sport: workout.sport,\n        startTime: workout.startTime,\n        endTime: workout.endTime,\n        duration: workout.duration,\n        summary: workout.summary,\n        telemetry: workout.telemetry,\n    };\n\n    const jsonBlob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });\n    const jsonUrl = URL.createObjectURL(jsonBlob);\n    const jsonLink = document.createElement('a');\n    jsonLink.href = jsonUrl;\n    jsonLink.download = `${filename}.json`;\n    jsonLink.click();\n    URL.revokeObjectURL(jsonUrl);\n}\n\n/**\n * Confirm and delete a workout\n */\nasync function confirmDeleteWorkout(workoutId: string): Promise<void> {\n    if (!confirm('Are you sure you want to delete this workout? This cannot be undone.')) {\n        return;\n    }\n\n    try {\n        await deleteWorkout(workoutId);\n        await loadWorkouts();\n    } catch (error) {\n        console.error('Failed to delete workout:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        alert(`Failed to delete workout: ${message}`);\n    }\n}\n\n/**\n * Check database availability (exported for other modules)\n */\nexport function getDatabaseAvailable(): boolean {\n    return dbAvailable;\n}\n","/**\n * Dark Mode Module\n * Handles theme switching and persistence for the app\n */\n\nimport { announce } from './accessibility.js';\n\nconst DARK_MODE_KEY = 'bpt-dark-mode';\n\nexport type ThemePreference = 'light' | 'dark' | 'system';\n\n/**\n * Get the stored theme preference from localStorage\n */\nexport function getStoredThemePreference(): ThemePreference | null {\n    try {\n        const stored = localStorage.getItem(DARK_MODE_KEY);\n        if (stored === 'light' || stored === 'dark' || stored === 'system') {\n            return stored;\n        }\n        return null;\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Save theme preference to localStorage\n */\nexport function saveThemePreference(preference: ThemePreference): void {\n    try {\n        localStorage.setItem(DARK_MODE_KEY, preference);\n    } catch {\n        // localStorage might not be available\n    }\n}\n\n/**\n * Check if the system prefers dark mode\n */\nexport function systemPrefersDark(): boolean {\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n}\n\n/**\n * Apply the theme to the document\n */\nexport function applyTheme(theme: 'light' | 'dark'): void {\n    document.documentElement.setAttribute('data-theme', theme);\n}\n\n/**\n * Get the effective theme based on preference\n */\nexport function getEffectiveTheme(preference: ThemePreference): 'light' | 'dark' {\n    if (preference === 'system') {\n        return systemPrefersDark() ? 'dark' : 'light';\n    }\n    return preference;\n}\n\n/**\n * Check if dark mode is currently active\n */\nexport function isDarkMode(): boolean {\n    return document.documentElement.getAttribute('data-theme') === 'dark';\n}\n\n/**\n * Toggle dark mode on/off\n */\nexport function toggleDarkMode(): boolean {\n    const currentlyDark = isDarkMode();\n    const newTheme = currentlyDark ? 'light' : 'dark';\n    applyTheme(newTheme);\n    saveThemePreference(newTheme);\n    return !currentlyDark;\n}\n\n/**\n * Initialize dark mode based on stored preference or system preference\n */\nexport function initDarkMode(): boolean {\n    const stored = getStoredThemePreference();\n\n    if (stored) {\n        const effectiveTheme = getEffectiveTheme(stored);\n        applyTheme(effectiveTheme);\n        return effectiveTheme === 'dark';\n    }\n\n    // Default to system preference if no stored preference\n    const systemDark = systemPrefersDark();\n    if (systemDark) {\n        applyTheme('dark');\n    }\n    // Note: Don't save preference when using system default\n    return systemDark;\n}\n\n/**\n * Set up the dark mode toggle checkbox\n */\nexport function setupDarkModeToggle(toggleElement: HTMLInputElement): void {\n    // Initialize toggle state\n    const isDark = initDarkMode();\n    toggleElement.checked = isDark;\n\n    // Handle toggle changes\n    toggleElement.addEventListener('change', () => {\n        const newTheme = toggleElement.checked ? 'dark' : 'light';\n        applyTheme(newTheme);\n        saveThemePreference(newTheme);\n        announce(`Dark mode ${toggleElement.checked ? 'enabled' : 'disabled'}`);\n    });\n\n    // Listen for system preference changes (when using system theme)\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    mediaQuery.addEventListener('change', (e) => {\n        // Only auto-switch if user hasn't set a preference\n        const stored = getStoredThemePreference();\n        if (!stored || stored === 'system') {\n            const newTheme = e.matches ? 'dark' : 'light';\n            applyTheme(newTheme);\n            toggleElement.checked = e.matches;\n            announce(`Dark mode ${e.matches ? 'enabled' : 'disabled'}`);\n        }\n    });\n\n    // Listen for storage changes (sync across tabs)\n    window.addEventListener('storage', (e) => {\n        if (e.key === DARK_MODE_KEY) {\n            const newPreference = e.newValue as ThemePreference | null;\n            if (newPreference) {\n                const effectiveTheme = getEffectiveTheme(newPreference);\n                applyTheme(effectiveTheme);\n                toggleElement.checked = effectiveTheme === 'dark';\n            } else {\n                // If cleared, revert to system\n                const systemDark = systemPrefersDark();\n                applyTheme(systemDark ? 'dark' : 'light');\n                toggleElement.checked = systemDark;\n            }\n        }\n    });\n}\n","/**\n * Onboarding Flow\n *\n * First-run setup wizard for new users.\n * Guides users through:\n * - FTP (Functional Threshold Power) entry\n * - Max Heart Rate entry\n * - Weight entry\n * - Sensor pairing guide\n * - Feature tour\n *\n * @module onboarding\n */\n\nimport { announce, trapFocus } from './accessibility.js';\nimport { showNotification } from './notifications.js';\n\n/**\n * User profile settings for training zones\n */\nexport interface UserProfile {\n    /** Functional Threshold Power in watts */\n    ftp: number | null;\n    /** Maximum heart rate in bpm */\n    maxHr: number | null;\n    /** Body weight in kg */\n    weight: number | null;\n    /** Whether onboarding has been completed */\n    onboardingComplete: boolean;\n    /** Timestamp of last profile update */\n    lastUpdated: number | null;\n}\n\n/** Storage key for user profile */\nconst PROFILE_KEY = 'bpt-user-profile';\n\n/** Default profile values */\nconst defaultProfile: UserProfile = {\n    ftp: null,\n    maxHr: null,\n    weight: null,\n    onboardingComplete: false,\n    lastUpdated: null,\n};\n\n/**\n * Load user profile from localStorage\n */\nexport function loadUserProfile(): UserProfile {\n    try {\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return { ...defaultProfile, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ...defaultProfile };\n}\n\n/**\n * Save user profile to localStorage\n */\nexport function saveUserProfile(profile: UserProfile): void {\n    try {\n        profile.lastUpdated = Date.now();\n        localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));\n    } catch (e) {\n        console.warn('Failed to save user profile:', e);\n    }\n}\n\n/**\n * Onboarding step configuration\n */\ninterface OnboardingStep {\n    id: string;\n    title: string;\n    icon: string;\n    content: string;\n    inputType?: 'number' | 'none';\n    inputLabel?: string;\n    inputPlaceholder?: string;\n    inputUnit?: string;\n    inputMin?: number;\n    inputMax?: number;\n    profileKey?: keyof UserProfile;\n    helpText?: string;\n}\n\n/**\n * Onboarding steps configuration\n */\nconst onboardingSteps: OnboardingStep[] = [\n    {\n        id: 'welcome',\n        title: 'Welcome to Bike Power Tracker!',\n        icon: '',\n        content: `\n            <p>Let's set up your profile for personalized training zones and better workout analysis.</p>\n            <p>This will only take a minute, and you can update these settings anytime.</p>\n        `,\n    },\n    {\n        id: 'ftp',\n        title: 'Functional Threshold Power (FTP)',\n        icon: '',\n        content: `\n            <p>Your FTP is the highest power you can sustain for about an hour.</p>\n            <p>If you don't know your FTP, you can skip this and do an FTP test later.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your FTP',\n        inputPlaceholder: 'e.g., 200',\n        inputUnit: 'watts',\n        inputMin: 50,\n        inputMax: 500,\n        profileKey: 'ftp',\n        helpText: 'Typical range: 100-400W for recreational to elite cyclists',\n    },\n    {\n        id: 'maxhr',\n        title: 'Maximum Heart Rate',\n        icon: '',\n        content: `\n            <p>Your max HR is used to calculate heart rate training zones.</p>\n            <p>A common estimate is 220 minus your age, but actual max HR varies.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Max HR',\n        inputPlaceholder: 'e.g., 185',\n        inputUnit: 'bpm',\n        inputMin: 100,\n        inputMax: 230,\n        profileKey: 'maxHr',\n        helpText: 'If unsure, use 220 - your age as a starting point',\n    },\n    {\n        id: 'weight',\n        title: 'Body Weight',\n        icon: '',\n        content: `\n            <p>Your weight is used to calculate power-to-weight ratio (W/kg), an important metric for climbing.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Weight',\n        inputPlaceholder: 'e.g., 70',\n        inputUnit: 'kg',\n        inputMin: 30,\n        inputMax: 200,\n        profileKey: 'weight',\n        helpText: 'Used for calculating watts per kilogram (W/kg)',\n    },\n    {\n        id: 'sensors',\n        title: 'Connect Your Sensors',\n        icon: '',\n        content: `\n            <p>Bike Power Tracker works with Bluetooth cycling sensors:</p>\n            <ul style=\"text-align: left; margin: 16px auto; max-width: 280px;\">\n                <li><strong> Power Meter</strong> - Measures your power output in watts</li>\n                <li><strong> Cadence Sensor</strong> - Tracks your pedaling speed (RPM)</li>\n                <li><strong> Heart Rate Monitor</strong> - Monitors your heart rate</li>\n            </ul>\n            <p>Use the menu () to connect your sensors before starting a workout.</p>\n        `,\n    },\n    {\n        id: 'shortcuts',\n        title: 'Keyboard Shortcuts',\n        icon: '',\n        content: `\n            <p>Quick access to common actions:</p>\n            <table style=\"margin: 16px auto; text-align: left; border-collapse: collapse;\">\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Space</kbd></td><td>Start/pause workout</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>L</kbd></td><td>Mark lap</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>M</kbd></td><td>Open menu</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>S</kbd></td><td>Open settings</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>E</kbd></td><td>Export data</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Escape</kbd></td><td>Close modal</td></tr>\n            </table>\n        `,\n    },\n    {\n        id: 'done',\n        title: 'You\\'re All Set!',\n        icon: '',\n        content: `\n            <p>Your profile has been saved. You can update your settings anytime from the menu.</p>\n            <p>Ready to start your first workout? Connect a sensor and press the <strong> Start</strong> button!</p>\n        `,\n    },\n];\n\n/**\n * Create the onboarding modal element\n */\nfunction createOnboardingModal(): HTMLElement {\n    const modal = document.createElement('div');\n    modal.id = 'onboardingModal';\n    modal.className = 'stream-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-labelledby', 'onboardingTitle');\n    modal.setAttribute('aria-modal', 'true');\n    modal.style.display = 'none';\n\n    modal.innerHTML = `\n        <div class=\"stream-modal-content onboarding-modal\" style=\"max-width: 480px;\">\n            <div class=\"stream-modal-header\">\n                <h2 id=\"onboardingTitle\">\n                    <span id=\"onboardingIcon\"></span>\n                    <span id=\"onboardingStepTitle\">Welcome</span>\n                </h2>\n                <button id=\"skipOnboarding\" class=\"close-button\" aria-label=\"Skip onboarding\">&times;</button>\n            </div>\n            <div class=\"stream-modal-body\" style=\"text-align: center; padding: 24px;\">\n                <div id=\"onboardingContent\"></div>\n                <div id=\"onboardingInput\" style=\"margin: 20px 0; display: none;\">\n                    <label for=\"onboardingInputField\" id=\"onboardingInputLabel\" style=\"display: block; margin-bottom: 8px; font-weight: bold;\"></label>\n                    <div style=\"display: flex; align-items: center; justify-content: center; gap: 8px;\">\n                        <input type=\"number\" id=\"onboardingInputField\" \n                            style=\"width: 120px; padding: 12px; font-size: 18px; text-align: center; border: 2px solid #d0d7de; border-radius: 8px;\"\n                            aria-describedby=\"onboardingHelpText\">\n                        <span id=\"onboardingInputUnit\" style=\"font-size: 16px; color: #666;\"></span>\n                    </div>\n                    <p id=\"onboardingHelpText\" style=\"margin-top: 8px; font-size: 12px; color: #666;\"></p>\n                </div>\n                <div class=\"onboarding-progress\" style=\"margin: 24px 0;\">\n                    <div id=\"onboardingProgressDots\" style=\"display: flex; justify-content: center; gap: 8px;\"></div>\n                </div>\n                <div class=\"onboarding-buttons\" style=\"display: flex; justify-content: center; gap: 12px; margin-top: 20px;\">\n                    <button id=\"onboardingPrev\" style=\"padding: 12px 24px; border: 1px solid #d0d7de; background: white; border-radius: 8px; cursor: pointer; font-size: 16px;\">\n                         Back\n                    </button>\n                    <button id=\"onboardingNext\" style=\"padding: 12px 24px; border: none; background: #2196F3; color: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;\">\n                        Next \n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Render progress dots\n */\nfunction renderProgressDots(container: HTMLElement, currentStep: number, totalSteps: number): void {\n    container.innerHTML = '';\n    for (let i = 0; i < totalSteps; i++) {\n        const dot = document.createElement('span');\n        dot.style.cssText = `\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n            background: ${i === currentStep ? '#2196F3' : '#d0d7de'};\n            transition: background 0.3s ease;\n        `;\n        dot.setAttribute('aria-hidden', 'true');\n        container.appendChild(dot);\n    }\n}\n\n/**\n * Render a step in the onboarding flow\n */\nfunction renderStep(\n    step: OnboardingStep,\n    stepIndex: number,\n    profile: UserProfile,\n    elements: {\n        icon: HTMLElement;\n        title: HTMLElement;\n        content: HTMLElement;\n        inputContainer: HTMLElement;\n        inputField: HTMLInputElement;\n        inputLabel: HTMLElement;\n        inputUnit: HTMLElement;\n        helpText: HTMLElement;\n        prevBtn: HTMLButtonElement;\n        nextBtn: HTMLButtonElement;\n        progressDots: HTMLElement;\n    }\n): void {\n    const { icon, title, content, inputContainer, inputField, inputLabel, inputUnit, helpText, prevBtn, nextBtn, progressDots } = elements;\n\n    // Update header\n    icon.textContent = step.icon;\n    title.textContent = step.title;\n\n    // Update content\n    content.innerHTML = step.content;\n\n    // Handle input\n    if (step.inputType === 'number' && step.profileKey) {\n        inputContainer.style.display = 'block';\n        inputLabel.textContent = step.inputLabel || '';\n        inputField.placeholder = step.inputPlaceholder || '';\n        inputField.min = String(step.inputMin || 0);\n        inputField.max = String(step.inputMax || 9999);\n        inputUnit.textContent = step.inputUnit || '';\n        helpText.textContent = step.helpText || '';\n\n        // Load existing value\n        const currentValue = profile[step.profileKey];\n        inputField.value = currentValue ? String(currentValue) : '';\n        inputField.focus();\n    } else {\n        inputContainer.style.display = 'none';\n    }\n\n    // Update buttons\n    prevBtn.style.display = stepIndex === 0 ? 'none' : 'inline-block';\n\n    if (stepIndex === onboardingSteps.length - 1) {\n        nextBtn.textContent = 'Get Started! ';\n    } else if (step.inputType === 'number') {\n        nextBtn.textContent = 'Next ';\n    } else {\n        nextBtn.textContent = 'Next ';\n    }\n\n    // Update progress dots\n    renderProgressDots(progressDots, stepIndex, onboardingSteps.length);\n\n    // Announce for screen readers\n    announce(`Step ${stepIndex + 1} of ${onboardingSteps.length}: ${step.title}`);\n}\n\n/**\n * Show the onboarding flow\n */\nexport function showOnboarding(forceShow = false): Promise<UserProfile> {\n    return new Promise((resolve) => {\n        const profile = loadUserProfile();\n\n        // Check if onboarding should be shown\n        if (!forceShow && profile.onboardingComplete) {\n            resolve(profile);\n            return;\n        }\n\n        // Create modal if it doesn't exist\n        let modal = document.getElementById('onboardingModal');\n        if (!modal) {\n            modal = createOnboardingModal();\n            document.body.appendChild(modal);\n        }\n\n        // Get elements\n        const icon = document.getElementById('onboardingIcon')!;\n        const title = document.getElementById('onboardingStepTitle')!;\n        const content = document.getElementById('onboardingContent')!;\n        const inputContainer = document.getElementById('onboardingInput')!;\n        const inputField = document.getElementById('onboardingInputField') as HTMLInputElement;\n        const inputLabel = document.getElementById('onboardingInputLabel')!;\n        const inputUnit = document.getElementById('onboardingInputUnit')!;\n        const helpText = document.getElementById('onboardingHelpText')!;\n        const prevBtn = document.getElementById('onboardingPrev') as HTMLButtonElement;\n        const nextBtn = document.getElementById('onboardingNext') as HTMLButtonElement;\n        const skipBtn = document.getElementById('skipOnboarding') as HTMLButtonElement;\n        const progressDots = document.getElementById('onboardingProgressDots')!;\n\n        const elements = { icon, title, content, inputContainer, inputField, inputLabel, inputUnit, helpText, prevBtn, nextBtn, progressDots };\n\n        let currentStep = 0;\n\n        // Save input value for current step\n        const saveCurrentInput = (): void => {\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number' && step.profileKey) {\n                const value = inputField.value ? parseFloat(inputField.value) : null;\n                if (value !== null && step.profileKey !== 'onboardingComplete' && step.profileKey !== 'lastUpdated') {\n                    profile[step.profileKey] = value;\n                }\n            }\n        };\n\n        // Render current step\n        const render = (): void => {\n            renderStep(onboardingSteps[currentStep], currentStep, profile, elements);\n        };\n\n        // Navigation handlers\n        const goNext = (): void => {\n            // Validate input if it's a number step\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number') {\n                if (!inputField.checkValidity()) {\n                    inputField.reportValidity();\n                    return;\n                }\n            }\n\n            saveCurrentInput();\n\n            if (currentStep < onboardingSteps.length - 1) {\n                currentStep++;\n                render();\n            } else {\n                // Complete onboarding\n                profile.onboardingComplete = true;\n                saveUserProfile(profile);\n                modal!.style.display = 'none';\n                showNotification('Profile saved! Ready to ride ', 'success');\n                announce('Onboarding complete. Profile saved.');\n                resolve(profile);\n            }\n        };\n\n        const goPrev = (): void => {\n            saveCurrentInput();\n            if (currentStep > 0) {\n                currentStep--;\n                render();\n            }\n        };\n\n        const skip = (): void => {\n            profile.onboardingComplete = true;\n            saveUserProfile(profile);\n            modal!.style.display = 'none';\n            announce('Onboarding skipped');\n            resolve(profile);\n        };\n\n        // Event listeners\n        nextBtn.addEventListener('click', goNext);\n        prevBtn.addEventListener('click', goPrev);\n        skipBtn.addEventListener('click', skip);\n\n        // Enter key advances\n        inputField.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                goNext();\n            }\n        });\n\n        // Show modal\n        modal.style.display = 'flex';\n        render();\n        trapFocus(modal.querySelector('.stream-modal-content')!);\n    });\n}\n\n/**\n * Check if user should see onboarding\n */\nexport function shouldShowOnboarding(): boolean {\n    const profile = loadUserProfile();\n    return !profile.onboardingComplete;\n}\n\n/**\n * Initialize onboarding - shows wizard if first run\n */\nexport function initOnboarding(): void {\n    if (shouldShowOnboarding()) {\n        // Small delay to let the app render first\n        setTimeout(() => {\n            showOnboarding();\n        }, 500);\n    }\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nexport function calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.90) },\n        { name: 'Threshold', min: Math.round(ftp * 0.90), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.20) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.20), max: Math.round(ftp * 1.50) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.50), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nexport function calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.50), max: Math.round(maxHr * 0.60) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.60), max: Math.round(maxHr * 0.70) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.70), max: Math.round(maxHr * 0.80) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.80), max: Math.round(maxHr * 0.90) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.90), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nexport function getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nexport function getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n","/**\n * Workout Recovery\n * \n * Handles detection and recovery of interrupted workouts from IndexedDB.\n * Shows a modal to the user when a recoverable workout is found.\n * \n * @module ui/workoutRecovery\n */\n\nimport {\n    loadActiveWorkout,\n    clearActiveWorkout,\n    hasRecoverableWorkout,\n    type ActiveWorkoutRecord\n} from '../storage/workoutStorage.js';\nimport type { MeasurementsState } from '../MeasurementsState.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Format elapsed time as human-readable string\n */\nfunction formatElapsedTime(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n\n    if (hours > 0) {\n        return `${hours}h ${minutes % 60}m`;\n    } else if (minutes > 0) {\n        return `${minutes}m ${seconds % 60}s`;\n    }\n    return `${seconds}s`;\n}\n\n/**\n * Format timestamp as human-readable date/time\n */\nfunction formatTime(timestamp: number): string {\n    return new Date(timestamp).toLocaleString();\n}\n\n/**\n * Create the recovery modal HTML\n */\nfunction createRecoveryModal(workout: ActiveWorkoutRecord): HTMLDialogElement {\n    const modal = document.createElement('dialog');\n    modal.id = 'workout-recovery-modal';\n    modal.className = 'modal';\n    modal.setAttribute('aria-labelledby', 'recovery-modal-title');\n\n    const dataPoints = workout.power.length + workout.heartrate.length + workout.cadence.length;\n    const elapsedTime = workout.lastUpdated - workout.startTime;\n\n    modal.innerHTML = `\n        <div class=\"modal-content\">\n            <h2 id=\"recovery-modal-title\"> Recover Workout?</h2>\n            <p>An interrupted workout was found from your last session.</p>\n            \n            <div class=\"recovery-summary\">\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Started</span>\n                    <span class=\"recovery-stat-value\">${formatTime(workout.startTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Duration</span>\n                    <span class=\"recovery-stat-value\">${formatElapsedTime(elapsedTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Data Points</span>\n                    <span class=\"recovery-stat-value\">${dataPoints.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Power Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.power.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Heart Rate Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.heartrate.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Cadence Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.cadence.length.toLocaleString()}</span>\n                </div>\n                ${workout.laps.length > 0 ? `\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Laps</span>\n                    <span class=\"recovery-stat-value\">${workout.laps.length}</span>\n                </div>\n                ` : ''}\n            </div>\n            \n            <div class=\"modal-actions\">\n                <button type=\"button\" id=\"recovery-restore-btn\" class=\"btn btn-primary\">\n                     Restore Workout\n                </button>\n                <button type=\"button\" id=\"recovery-discard-btn\" class=\"btn btn-secondary\">\n                     Start Fresh\n                </button>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Add styles for the recovery modal\n */\nfunction addRecoveryStyles(): void {\n    if (document.getElementById('recovery-modal-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'recovery-modal-styles';\n    style.textContent = `\n        #workout-recovery-modal {\n            max-width: 400px;\n        }\n        \n        .recovery-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 0.75rem;\n            margin: 1.5rem 0;\n            padding: 1rem;\n            background: var(--surface-2, #2a2a2a);\n            border-radius: 8px;\n        }\n        \n        .recovery-stat {\n            display: flex;\n            flex-direction: column;\n            gap: 0.25rem;\n        }\n        \n        .recovery-stat-label {\n            font-size: 0.75rem;\n            color: var(--text-muted, #888);\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n        }\n        \n        .recovery-stat-value {\n            font-size: 1rem;\n            font-weight: 600;\n            color: var(--text-primary, #fff);\n        }\n        \n        #workout-recovery-modal .modal-actions {\n            display: flex;\n            flex-direction: column;\n            gap: 0.75rem;\n            margin-top: 1.5rem;\n        }\n        \n        #workout-recovery-modal .btn {\n            width: 100%;\n            padding: 0.875rem 1.5rem;\n            font-size: 1rem;\n        }\n    `;\n\n    document.head.appendChild(style);\n}\n\n/**\n * Show the recovery modal and wait for user decision\n */\nasync function showRecoveryModal(workout: ActiveWorkoutRecord): Promise<'restore' | 'discard'> {\n    addRecoveryStyles();\n\n    const modal = createRecoveryModal(workout);\n    document.body.appendChild(modal);\n\n    return new Promise((resolve) => {\n        const restoreBtn = modal.querySelector('#recovery-restore-btn') as HTMLButtonElement;\n        const discardBtn = modal.querySelector('#recovery-discard-btn') as HTMLButtonElement;\n\n        const cleanup = () => {\n            modal.close();\n            modal.remove();\n        };\n\n        restoreBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('restore');\n        });\n\n        discardBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('discard');\n        });\n\n        // Handle escape key\n        modal.addEventListener('cancel', (e) => {\n            e.preventDefault(); // Don't close on escape - force user to choose\n        });\n\n        modal.showModal();\n    });\n}\n\n/**\n * Check for and handle workout recovery\n * \n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n * @returns True if a workout was recovered\n */\nexport async function initWorkoutRecovery(\n    measurementsState: MeasurementsState,\n    timeState: TimeState\n): Promise<boolean> {\n    try {\n        // Check if there's a recoverable workout\n        if (!await hasRecoverableWorkout()) {\n            return false;\n        }\n\n        // Load the workout data\n        const workout = await loadActiveWorkout();\n        if (!workout) {\n            return false;\n        }\n\n        // Show recovery modal and get user choice\n        const choice = await showRecoveryModal(workout);\n\n        if (choice === 'restore') {\n            // Restore the workout data\n            measurementsState.restore(\n                {\n                    heartrate: workout.heartrate,\n                    power: workout.power,\n                    cadence: workout.cadence,\n                    speed: workout.speed,\n                    distance: workout.distance,\n                    altitude: workout.altitude,\n                    laps: workout.laps, gps: workout.gps || [],\n                },\n                workout.startTime\n            );\n\n            // Restore time state\n            timeState.startTime = workout.startTime;\n            timeState.running = false; // Don't auto-resume - let user reconnect sensors\n\n            console.log(`Restored workout with ${workout.power.length} power readings`);\n            return true;\n        } else {\n            // User chose to discard\n            await clearActiveWorkout();\n            console.log('User discarded recovered workout');\n            return false;\n        }\n    } catch (error) {\n        console.error('Error during workout recovery:', error);\n        return false;\n    }\n}\n\n/**\n * Clear any pending workout data (for testing or manual cleanup)\n */\nexport async function clearRecoverableWorkout(): Promise<void> {\n    await clearActiveWorkout();\n}\n","/**\n * BPT Client - Main Entry Point\n *\n * Progressive Web App for tracking cycling workouts with Bluetooth sensors.\n *\n * This module initializes all application features:\n * - Bluetooth sensor connections (power, cadence, heart rate)\n * - Real-time metrics display\n * - Workout timer\n * - Data export (JSON, TCX, CSV)\n * - Live streaming\n * - PWA features (service worker, install prompt)\n *\n * @module main\n *\n * @description\n * The app uses a state-based architecture with three main state objects:\n * - measurementsState: Tracks workout data (power, cadence, HR measurements)\n * - connectionsState: Tracks Bluetooth connection status\n * - timeState: Tracks recording state and elapsed time\n *\n * @example\n * // State is initialized automatically on app load\n * // Access exposed state in tests:\n * window.measurementsState\n * window.connectionsState\n */\n\nimport './main.css';\n\n// Register Web Components (must be imported before they're used in DOM)\nimport './components/index.js';\n\nimport { initTimerDisplay } from './ui/time.js';\nimport { initDiscardButton, initExportButton, initMetricsToggle, initWorkoutSummaryModal } from './ui/menu.js';\nimport { initMetricsDisplay } from './initMetricsDisplay.js';\nimport { initConnectionButtons } from './initConnectionButtons.js';\nimport { getInitState } from './getInitState.js';\nimport { handleWakeLock } from './ui/wakeLock.js';\nimport { registerServiceWorker } from './ui/serviceWorker.js';\nimport { initInstallPrompt } from './ui/installPrompt.js';\nimport { initSettings } from './ui/settings.js';\nimport { initAboutModal } from './ui/about.js';\nimport { exposeVariablesDuringTest } from './exposeVariablesDuringTest.js';\nimport { StreamManager } from './streamManager.js';\nimport { initStreamViewer } from './ui/streamViewer.js';\nimport { initStreamingControls } from './initStreamingControls.js';\nimport { initWorkoutHistory } from './ui/workoutHistory.js';\nimport { initKeyboardNavigation } from './ui/accessibility.js';\nimport { setupDarkModeToggle } from './ui/darkMode.js';\nimport { initOnboarding } from './ui/onboarding.js';\nimport { initLapButton } from './ui/lap.js';\nimport { initWorkoutRecovery } from './ui/workoutRecovery.js';\n\n/**\n * Initialize application state\n */\nconst { measurementsState, connectionsState, timeState } = getInitState();\n\n// Expose state for E2E testing\nexposeVariablesDuringTest({ measurementsState, connectionsState });\n\n/**\n * Stream manager for live workout streaming\n */\nconst streamManager = new StreamManager(measurementsState, timeState);\n\n// Initialize UI components\ninitTimerDisplay(timeState);\nconst zoneState = initMetricsDisplay({ connectionsState, measurementsState });\n\n// Initialize Bluetooth connection buttons\ninitConnectionButtons({ connectionsState, measurementsState });\n\n// Initialize menu controls\ninitDiscardButton({ measurementsState, timeState, zoneState });\ninitExportButton(measurementsState, zoneState);\ninitMetricsToggle();\ninitWorkoutSummaryModal({ measurementsState, timeState, zoneState });\n\n// Initialize streaming features\ninitStreamingControls(streamManager, timeState);\ninitStreamViewer();\n\n// Initialize workout history\ninitWorkoutHistory();\n\n// Initialize PWA features\nhandleWakeLock();\n\n// Initialize settings\ninitSettings();\n\n// Initialize about modal\ninitAboutModal();\n\n// Register service worker\nregisterServiceWorker();\n\n// Initialize install prompt\ninitInstallPrompt();\n\n// Initialize keyboard navigation for accessibility\ninitKeyboardNavigation();\n\n// Initialize dark mode toggle\nconst darkModeToggle = document.getElementById('toggleDarkMode') as HTMLInputElement | null;\nif (darkModeToggle) {\n    setupDarkModeToggle(darkModeToggle);\n}\n\n// Initialize lap button\ninitLapButton({ measurementsState, timeState });\n\n// Initialize onboarding (shows wizard for first-time users)\ninitOnboarding();\n\n// Initialize workout recovery (check for interrupted workouts)\ninitWorkoutRecovery(measurementsState, timeState).then((recovered) => {\n    if (recovered) {\n        console.log('Workout recovered from previous session');\n        // Update UI to reflect recovered data\n        document.dispatchEvent(new CustomEvent('workout-recovered'));\n    }\n});\n\n// Log initialization\nconsole.log('Bike Power Tracker initialized');\n"],"file":"index-Dachufbl.js"}