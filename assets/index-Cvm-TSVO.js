(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const L=e=>{const t=Math.floor(e/1e3),o=Math.floor(t/3600),i=Math.floor(t%3600/60),s=t%60;return`${o.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},D=e=>{const t=document.getElementById("startStop"),o=document.getElementById("time"),i=document.getElementById("metricsTable");setInterval(()=>{let s="00:00:00";if(e.startTime&&e.running){const n=Date.now()-e.startTime;s=L(n)}else if(e.startTime&&e.endTime){const n=e.endTime-e.startTime;s=L(n)}o.textContent!==s&&(o.textContent=s);const r=e.running?"â¹ï¸":"â–¶ï¸";t.textContent!==r&&(t.textContent=r),e.running?i.classList.remove("paused"):i.classList.add("paused")},100),t.addEventListener("click",()=>{if(e.running)e.running=!1,e.endTime=Date.now(),t.textContent="â–¶ï¸";else{if(e.endTime){const s=Date.now()-e.endTime;e.startTime+=s,e.endTime=null}else e.startTime=Date.now();e.running=!0,t.textContent="â¹ï¸"}})},E=(e,t)=>{const o=[];let i=0;for(const s of t){for(;i<e.length&&e[i].timestamp<s;)i++;const r=i-1;let n;const c=i>=e.length;if(r<0)n=e?.[i];else if(c)n=e?.[r];else{const a=e?.[r]?.timestamp??0,m=e?.[i]?.timestamp??0;n=s-a<=m-s?e?.[r]:e?.[i]}n?.timestamp&&Math.abs(n.timestamp-s)<1e3?o.push(n.value):o.push(null)}return o},b=e=>{const t=[e.heartrate,e.cadence,e.power];if(!t.some(d=>d.length>0))return[];const i=t.map(d=>d.length>0?d[0].timestamp:1/0),s=Math.min(...i),r=Math.max(...t.map(d=>d.length>0?d[d.length-1].timestamp:-1/0)),n=1e3,c=[];let a=s;for(;a<=r;)c.push(a),a+=n;const m=E(e.heartrate,c),u=E(e.cadence,c),l=E(e.power,c),p=[];for(let d=0;d<c.length;d++){const f={timestamp:c[d],heartrate:m[d]??null,cadence:u[d]??null,power:l[d]??null};p.push(f)}return p},I=e=>{const t=b(e);if(!t||t.length===0)return"";const o="timestamp,power,cadence,heartrate",i=t.map(s=>{const r=new Date(s.timestamp).toISOString(),n=s.power!==null?Math.round(s.power):"",c=s.cadence!==null?Math.round(s.cadence):"",a=s.heartrate!==null?Math.round(s.heartrate):"";return`${r},${n},${c},${a}`});return[o,...i].join(`
`)};class ${constructor(){this.heartrate=[],this.power=[],this.cadence=[]}addHeartrate({timestamp:t,value:o}){if(o<=0||o>=300)throw new Error("Heartrate must be between 1 and 299");this.heartrate.push({timestamp:t,value:o})}addPower({timestamp:t,value:o}){if(o<=0||o>=3e3)throw new Error("Power must be between 1 and 2999");this.power.push({timestamp:t,value:o})}addCadence({timestamp:t,value:o}){if(o<=0||o>=300)throw new Error("Cadence must be between 1 and 299");this.cadence.push({timestamp:t,value:o})}add(t,o){if(t==="heartrate")this.addHeartrate(o);else if(t==="power")this.addPower(o);else if(t==="cadence")this.addCadence(o);else throw new Error(`Unknown measurement type: ${t}`)}}const P=e=>e!==null?`<HeartRateBpm><Value>${Math.round(e)}</Value></HeartRateBpm>`:"",R=e=>e!==null?`<Cadence>${Math.round(e)}</Cadence>`:"",U=e=>e===null?"":`<Extensions>
              <TPX xmlns="http://www.garmin.com/xmlschemas/ActivityExtension/v2">
                <Watts>${Math.round(e)}</Watts>
              </TPX>
            </Extensions>`,M=e=>{const t=new Date(e.timestamp).toISOString(),i=Object.entries({heartrate:P,cadence:R,power:U}).map(([r,n])=>{const c=e[r];return c!==null?n(c):""}).filter(r=>r!=="");return`
<Trackpoint>
    <Time>${t}</Time>
    ${i.join(`
`)}
</Trackpoint>
    `.trim()},_=e=>{const t=b(e);if(!t||t.length===0)return"";const o=t[0].timestamp,i=t[t.length-1].timestamp,s=Math.round((i-o)/1e3),r=new Date(o).toISOString();return`<?xml version="1.0" encoding="UTF-8"?>
    <TrainingCenterDatabase xmlns="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2">
        <Activities>
            <Activity Sport="Biking">
                <Id>${r}</Id>
                <Lap StartTime="${r}">
                    <TotalTimeSeconds>${s}</TotalTimeSeconds>
                    <Calories>0</Calories>
                    <Intensity>Active</Intensity>
                    <TriggerMethod>Manual</TriggerMethod>
                    <Track>
${t.map(M).join(`
`)}
                    </Track>
                </Lap>
            </Activity>
        </Activities>
    </TrainingCenterDatabase>`},j=({measurementsState:e,timeState:t})=>{document.getElementById("discardButton").addEventListener("click",()=>{confirm("Are you sure you want to discard this workout?")&&(t.running=!1,t.startTime=null,t.endTime=null,e.power=[],e.heartrate=[],e.cadence=[])})},O=e=>{document.getElementById("exportData").addEventListener("click",()=>{try{const o=new Date,i=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}-${String(o.getHours()).padStart(2,"0")}-${String(o.getMinutes()).padStart(2,"0")}-${String(o.getSeconds()).padStart(2,"0")}`,s={power:e.power,heartrate:e.heartrate,cadence:e.cadence},r=JSON.stringify(s,null,2),n=new Blob([r],{type:"application/json"}),c=URL.createObjectURL(n),a=document.createElement("a");a.href=c,a.download=`bike-measurements-${i}.json`,a.click(),URL.revokeObjectURL(c);const m=_(e),u=new Blob([m],{type:"application/xml"}),l=URL.createObjectURL(u),p=document.createElement("a");p.href=l,p.download=`bike-workout-${i}.tcx`,p.click(),URL.revokeObjectURL(l);const d=I(e),f=new Blob([d],{type:"text/csv"}),g=URL.createObjectURL(f),h=document.createElement("a");h.href=g,h.download=`bike-workout-${i}.csv`,h.click(),URL.revokeObjectURL(g)}catch(o){console.error("Error exporting data:",o)}})},A=document.getElementById("connectPower"),N=document.getElementById("connectHeartrate"),W=document.getElementById("connectCadence"),H=document.getElementById("power"),q=document.getElementById("heartrate"),F=document.getElementById("cadence"),v={power:{display:H,connect:A},heartrate:{display:q,connect:N},cadence:{display:F,connect:W}},V=({connectionsState:e,measurementsState:t})=>{const o=s=>{const r=v?.[s]?.display;if(!r||!e?.[s])return;const n="--";if(!e?.[s]?.isConnected){r.textContent=n;return}const c=t[s];if(!Array.isArray(c)||c.length===0){r.textContent=n;return}const a=c[c.length-1];if(!a||typeof a.value!="number"||typeof a.timestamp!="number"){r.textContent=n;return}if(Date.now()-a.timestamp>5e3){r.textContent=n;return}r.textContent=a.value},i=["power","heartrate","cadence"];setInterval(()=>{i.forEach(o)},100)},X=async()=>{const e=[];let t=null,o=null;const i=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_speed_and_cadence"]}],optionalServices:["cycling_speed_and_cadence"]}),n=await(await(await i.gatt.connect()).getPrimaryService("cycling_speed_and_cadence")).getCharacteristic("csc_measurement");return await n.startNotifications(),n.addEventListener("characteristicvaluechanged",c=>{const a=c.target.value,m=a.getUint8(0);if(m&2){let u=1;m&1&&(u=5);const l=a.getUint16(u,!0),p=a.getUint16(u+2,!0);if(t!==null&&o!==null){let d=l-t,f=p-o;if(d<0&&(d+=65536),f<0&&(f+=65536),f>0){const g=f/1024,h=Math.round(d/g*60);if(h>0&&h<300){const S={timestamp:Date.now(),value:h};e.forEach(k=>k(S))}}}t=l,o=p}}),{disconnect:()=>{n.stopNotifications(),i.gatt.disconnect()},addListener:c=>{e.push(c)}}},J=async()=>X(),K=async()=>{const e=[],t=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["heart_rate"]}),s=await(await(await t.gatt.connect()).getPrimaryService("heart_rate")).getCharacteristic("heart_rate_measurement");return await s.startNotifications(),s.addEventListener("characteristicvaluechanged",r=>{const c=r.target.value.getUint8(1),a={timestamp:Date.now(),value:c};e.forEach(m=>m(a))}),{disconnect:()=>{s.stopNotifications(),t.gatt.disconnect()},addListener:r=>{e.push(r)}}},Y=async()=>K(),z=async()=>{const e=[],t=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_power"]}],optionalServices:["cycling_power"]}),s=await(await(await t.gatt.connect()).getPrimaryService("cycling_power")).getCharacteristic("cycling_power_measurement");return await s.startNotifications(),s.addEventListener("characteristicvaluechanged",r=>{const c=r.target.value.getUint16(2,!0),a={timestamp:Date.now(),value:c};e.forEach(m=>m(a))}),{disconnect:()=>{s.stopNotifications(),t.gatt.disconnect()},addListener:r=>{e.push(r)}}},G=async()=>z(),Q=({connectionsState:e,measurementsState:t})=>{const o=["power","heartrate","cadence"],i={power:"âš¡",heartrate:"â¤ï¸",cadence:"ðŸš´"},s=n=>{if(typeof e[n].disconnect=="function"){e[n].disconnect(),e[n].disconnect=null,e[n].isConnected=!1;const c=v[n]?.connect;c?.textContent&&(c.textContent=`${i[n]} Connect ${n.charAt(0).toUpperCase()+n.slice(1)}`);const a=v?.[n]?.display;a?.textContent&&(a.textContent="--")}},r=async n=>{const c={power:G,heartrate:Y,cadence:J};try{const{disconnect:a,addListener:m}=await c[n]();e[n].disconnect=a,e[n].isConnected=!0,m(l=>{t.add(n,l)});const u=v[n]?.connect;u?.textContent&&(u.textContent=`${i[n]} Disconnect ${n.charAt(0).toUpperCase()+n.slice(1)}`)}catch(a){console.error(`Error connecting ${n}:`,a)}};o.forEach(n=>{const c=v[n]?.connect;c&&c.addEventListener("click",async()=>{e[n].isConnected?s(n):r(n)})})},Z=()=>({measurementsState:new $,connectionsState:{power:{isConnected:!1,disconnect:null},heartrate:{isConnected:!1,disconnect:null},cadence:{isConnected:!1,disconnect:null}},timeState:{running:!1,startTime:null,endTime:null}}),ee=()=>{let e=null;const t=async()=>{try{"wakeLock"in navigator&&(e=await navigator.wakeLock.request("screen"),console.log("Screen wake lock activated"),e.addEventListener("release",()=>{console.log("Screen wake lock released")}))}catch(o){console.error("Wake lock request failed:",o)}};document.visibilityState==="visible"&&t(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&t()})},te="modulepreload",ne=function(e,t){return new URL(e,t).href},x={},oe=function(t,o,i){let s=Promise.resolve();if(o&&o.length>0){let m=function(u){return Promise.all(u.map(l=>Promise.resolve(l).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};const n=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),a=c?.nonce||c?.getAttribute("nonce");s=m(o.map(u=>{if(u=ne(u,i),u in x)return;x[u]=!0;const l=u.endsWith(".css"),p=l?'[rel="stylesheet"]':"";if(i)for(let f=n.length-1;f>=0;f--){const g=n[f];if(g.href===u&&(!l||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${p}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":te,l||(d.as="script"),d.crossOrigin="",d.href=u,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((f,g)=>{d.addEventListener("load",f),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function r(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return s.then(n=>{for(const c of n||[])c.status==="rejected"&&r(c.reason);return t().catch(r)})};function se(e={}){const{immediate:t=!1,onNeedRefresh:o,onOfflineReady:i,onRegistered:s,onRegisteredSW:r,onRegisterError:n}=e;let c,a;const m=async(l=!0)=>{await a};async function u(){if("serviceWorker"in navigator){if(c=await oe(async()=>{const{Workbox:l}=await import("./workbox-window.prod.es5-CwtvwXb3.js");return{Workbox:l}},[],import.meta.url).then(({Workbox:l})=>new l("./sw.js",{scope:"./",type:"classic"})).catch(l=>{n?.(l)}),!c)return;c.addEventListener("activated",l=>{(l.isUpdate||l.isExternal)&&window.location.reload()}),c.addEventListener("installed",l=>{l.isUpdate||i?.()}),c.register({immediate:t}).then(l=>{r?r("./sw.js",l):s?.(l)}).catch(l=>{n?.(l)})}}return a=u(),m}const re=()=>{const e=se({onNeedRefresh(){ce(e)},onOfflineReady(){console.log("App ready to work offline")},onRegisteredSW(t,o){console.log("Service Worker registered successfully:",t),o&&setInterval(()=>{o.update()},36e5)},onRegisterError(t){console.log("Service Worker registration failed:",t)}})},ce=e=>{const t=document.getElementById("updateNotification");t&&(t.style.display="block",document.getElementById("updateButton").addEventListener("click",()=>{e(!0)},{once:!0}),document.getElementById("dismissUpdate").addEventListener("click",()=>{t.style.display="none"},{once:!0}))};let w=null;const ie=()=>{window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),w=e,ae()}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed successfully"),w=null,T()})},ae=()=>{const e=document.getElementById("installPrompt");e&&(e.style.display="block",document.getElementById("installButton").addEventListener("click",async()=>{if(!w)return;w.prompt();const{outcome:i}=await w.userChoice;console.log(`User response to the install prompt: ${i}`),w=null,T()}),document.getElementById("dismissInstall").addEventListener("click",()=>{T()}))},T=()=>{const e=document.getElementById("installPrompt");e&&(e.style.display="none")};function le({measurementsState:e,connectionsState:t}){typeof window<"u"&&(window.bike=e,window.connectionsState=t)}const{measurementsState:y,connectionsState:C,timeState:B}=Z();le({measurementsState:y,connectionsState:C});D(B);V({connectionsState:C,measurementsState:y});Q({connectionsState:C,measurementsState:y});j({measurementsState:y,timeState:B});O(y);ee();re();ie();
//# sourceMappingURL=index-Cvm-TSVO.js.map
