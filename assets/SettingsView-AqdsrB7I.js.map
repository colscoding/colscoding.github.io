{"version":3,"file":"SettingsView-AqdsrB7I.js","sources":["../../src/config/sport.ts","../../src/ui/settings.ts","../../src/ui/dataFieldsConfig.ts","../../src/views/SettingsView.ts"],"sourcesContent":["/**\n * Sport Configuration\n *\n * Defines sport types and their specific settings, metrics, and zones.\n *\n * @module config/sport\n */\n\n/**\n * Supported sport types\n */\nexport type SportType = 'cycling' | 'running' | 'walking';\n\n/**\n * Running-specific measurement\n */\nexport interface RunningMeasurement {\n    timestamp: number;\n    /** Running cadence in steps per minute (spm) */\n    cadence: number | null;\n    /** Stride length in meters */\n    strideLength: number | null;\n    /** Ground contact time in milliseconds */\n    groundContactTime: number | null;\n}\n\n/**\n * Sport-specific settings\n */\nexport interface SportSettings {\n    /** Current active sport */\n    activeSport: SportType;\n    /** Running-specific settings */\n    running: {\n        /** Target pace zone (min/km) */\n        targetPaceMin: number;\n        targetPaceMax: number;\n        /** Use running cadence sensor (footpod/watch) */\n        useRunningCadence: boolean;\n        /** Show pace instead of speed */\n        showPace: boolean;\n    };\n    /** Cycling-specific settings (default, kept for completeness) */\n    cycling: {\n        /** Show power metrics */\n        showPower: boolean;\n    };\n}\n\n/**\n * Running pace zones based on threshold pace\n * Uses Jack Daniels' VDOT zones model\n */\nexport interface RunningZone {\n    name: string;\n    /** Min pace in seconds per km */\n    minPaceSecPerKm: number;\n    /** Max pace in seconds per km */\n    maxPaceSecPerKm: number;\n    /** Description */\n    description: string;\n}\n\n/**\n * Calculate running zones based on threshold pace (T pace)\n * @param thresholdPaceSecPerKm Threshold pace in seconds per kilometer\n */\nexport function calculateRunningZones(thresholdPaceSecPerKm: number): RunningZone[] {\n    // Jack Daniels style zones relative to threshold (T) pace\n    // E (Easy) = 59-74% of vVO2max -> ~129-141% of T pace\n    // M (Marathon) = 75-84% -> ~105-111% of T pace\n    // T (Threshold) = 83-88% -> ~100-105% of T pace\n    // I (Interval) = 95-100% -> ~93-98% of T pace\n    // R (Repetition) = 105-120% -> ~85-92% of T pace\n\n    const tPace = thresholdPaceSecPerKm;\n\n    return [\n        {\n            name: 'Recovery',\n            minPaceSecPerKm: Math.round(tPace * 1.41),\n            maxPaceSecPerKm: 9999, // Very slow\n            description: 'Very easy, conversational pace',\n        },\n        {\n            name: 'Easy',\n            minPaceSecPerKm: Math.round(tPace * 1.29),\n            maxPaceSecPerKm: Math.round(tPace * 1.41),\n            description: 'Comfortable aerobic pace',\n        },\n        {\n            name: 'Marathon',\n            minPaceSecPerKm: Math.round(tPace * 1.05),\n            maxPaceSecPerKm: Math.round(tPace * 1.11),\n            description: 'Marathon race pace',\n        },\n        {\n            name: 'Threshold',\n            minPaceSecPerKm: Math.round(tPace * 1.0),\n            maxPaceSecPerKm: Math.round(tPace * 1.05),\n            description: 'Comfortably hard, lactate threshold',\n        },\n        {\n            name: 'Interval',\n            minPaceSecPerKm: Math.round(tPace * 0.93),\n            maxPaceSecPerKm: Math.round(tPace * 0.98),\n            description: 'VO2max training pace',\n        },\n        {\n            name: 'Repetition',\n            minPaceSecPerKm: 0,\n            maxPaceSecPerKm: Math.round(tPace * 0.92),\n            description: 'Speed/form work',\n        },\n    ];\n}\n\n/**\n * Default sport settings\n */\nexport const defaultSportSettings: SportSettings = {\n    activeSport: 'cycling',\n    running: {\n        targetPaceMin: 300, // 5:00 min/km\n        targetPaceMax: 360, // 6:00 min/km\n        useRunningCadence: true,\n        showPace: true,\n    },\n    cycling: {\n        showPower: true,\n    },\n};\n\n/** Storage key */\nconst SPORT_SETTINGS_KEY = 'bpt-sport-settings';\n\n/**\n * Get sport settings from localStorage\n */\nexport function getSportSettings(): SportSettings {\n    try {\n        const stored = localStorage.getItem(SPORT_SETTINGS_KEY);\n        if (stored) {\n            return { ...defaultSportSettings, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load sport settings:', e);\n    }\n    return { ...defaultSportSettings };\n}\n\n/**\n * Save sport settings to localStorage\n */\nexport function saveSportSettings(settings: SportSettings): void {\n    localStorage.setItem(SPORT_SETTINGS_KEY, JSON.stringify(settings));\n    window.dispatchEvent(new CustomEvent('sport-settings-changed', { detail: settings }));\n}\n\n/**\n * Get active sport\n */\nexport function getActiveSport(): SportType {\n    return getSportSettings().activeSport;\n}\n\n/**\n * Set active sport\n */\nexport function setActiveSport(sport: SportType): void {\n    const settings = getSportSettings();\n    settings.activeSport = sport;\n    saveSportSettings(settings);\n}\n\n/**\n * Convert speed (m/s) to pace (seconds per km)\n */\nexport function speedToPace(speedMs: number): number {\n    if (speedMs <= 0) return 9999;\n    return Math.round(1000 / speedMs);\n}\n\n/**\n * Convert pace (seconds per km) to speed (m/s)\n */\nexport function paceToSpeed(paceSecPerKm: number): number {\n    if (paceSecPerKm <= 0) return 0;\n    return 1000 / paceSecPerKm;\n}\n\n/**\n * Format pace as MM:SS /km\n */\nexport function formatPace(paceSecPerKm: number): string {\n    if (paceSecPerKm >= 9999 || paceSecPerKm <= 0) return '--:--';\n    const minutes = Math.floor(paceSecPerKm / 60);\n    const seconds = Math.round(paceSecPerKm % 60);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Get sport-specific metric labels\n */\nexport function getSportMetricLabels(sport: SportType): Record<string, string> {\n    if (sport === 'running' || sport === 'walking') {\n        return {\n            speed: 'Pace',\n            cadence: 'Cadence (spm)',\n            power: 'Power',\n            heartrate: 'Heart Rate',\n            distance: 'Distance',\n            altitude: 'Elevation',\n        };\n    }\n    // Cycling (default)\n    return {\n        speed: 'Speed',\n        cadence: 'Cadence (rpm)',\n        power: 'Power',\n        heartrate: 'Heart Rate',\n        distance: 'Distance',\n        altitude: 'Elevation',\n    };\n}\n\n/**\n * Get sport icon emoji\n */\nexport function getSportIcon(sport: SportType): string {\n    switch (sport) {\n        case 'running':\n            return 'üèÉ';\n        case 'walking':\n            return 'üö∂';\n        case 'cycling':\n        default:\n            return 'üö¥';\n    }\n}\n","/**\n * Settings Modal\n *\n * Manages application settings stored in localStorage.\n *\n * @module settings\n */\n\nimport { loadUserProfile, saveUserProfile } from './onboarding.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport {\n    getSettings,\n    saveSettingsToStorage,\n    defaultSettings,\n    defaultAutoPauseSettings,\n    defaultWorkoutMetadataSettings,\n    defaultCountdownSettings,\n    defaultAutoLapSettings,\n    defaultEnhancedVoiceSettings,\n    defaultVoiceMetrics,\n    defaultIntervalsSettings,\n} from '../config/settings.js';\nimport type { AppSettings, AutoPauseSource, AutoLapSource } from '../config/settings.js';\nimport { triggerInstallPrompt } from './installPrompt.js';\nimport { getAutoPauseSourceUnit } from '../services/AutoPauseService.js';\nimport { getSportSettings, saveSportSettings, formatPace } from '../config/sport.js';\nimport type { SportType } from '../config/sport.js';\n\n// Re-export for compatibility if needed (but prefer importing from config)\nexport { getSettings };\n\n/**\n * Initialize the Settings UI logic\n */\nexport function initSettingsLogic(): void {\n    const saveSettingsButton = document.getElementById('saveSettings');\n\n    // User Profile settings\n    const settingFtp = document.getElementById('settingFtp') as HTMLInputElement | null;\n    const settingMaxHr = document.getElementById('settingMaxHr') as HTMLInputElement | null;\n    const settingWeight = document.getElementById('settingWeight') as HTMLInputElement | null;\n\n    // Dashboard display settings\n    const settingSpeed = document.getElementById('settingSpeed') as HTMLInputElement | null;\n    const settingDistance = document.getElementById('settingDistance') as HTMLInputElement | null;\n    const settingAltitude = document.getElementById('settingAltitude') as HTMLInputElement | null;\n    const settingShowCalories = document.getElementById('settingShowCalories') as HTMLInputElement | null;\n    const settingPower = document.getElementById('settingPower') as HTMLInputElement | null;\n    const settingCadence = document.getElementById('settingCadence') as HTMLInputElement | null;\n    const settingHeartrate = document.getElementById('settingHeartrate') as HTMLInputElement | null;\n    const settingTreadmillSpeed = document.getElementById('settingTreadmillSpeed') as HTMLInputElement | null;\n    const settingPower3s = document.getElementById('settingPower3s') as HTMLInputElement | null;\n\n    // Accessibility settings\n    const settingHighContrast = document.getElementById('settingHighContrast') as HTMLInputElement | null;\n    const settingColorblindPatterns = document.getElementById('settingColorblindPatterns') as HTMLInputElement | null;\n\n    // Voice Feedback settings\n    const settingVoiceEnabled = document.getElementById('settingVoiceEnabled') as HTMLInputElement | null;\n    const settingVoiceLaps = document.getElementById('settingVoiceLaps') as HTMLInputElement | null;\n    const settingVoiceZones = document.getElementById('settingVoiceZones') as HTMLInputElement | null;\n\n    // Auto-Pause settings\n    const settingAutoPauseEnabled = document.getElementById('settingAutoPauseEnabled') as HTMLInputElement | null;\n    const settingAutoPauseSource = document.getElementById('settingAutoPauseSource') as HTMLSelectElement | null;\n    const settingAutoPauseThreshold = document.getElementById('settingAutoPauseThreshold') as HTMLInputElement | null;\n    const settingAutoPauseDelay = document.getElementById('settingAutoPauseDelay') as HTMLInputElement | null;\n    const autoPauseOptions = document.getElementById('autoPauseOptions');\n    const autoPauseThresholdUnit = document.getElementById('autoPauseThresholdUnit');\n\n    // Export format settings\n    const settingExportTcx = document.getElementById('settingExportTcx') as HTMLInputElement | null;\n    const settingExportCsv = document.getElementById('settingExportCsv') as HTMLInputElement | null;\n    const settingExportJson = document.getElementById('settingExportJson') as HTMLInputElement | null;\n    const settingExportFit = document.getElementById('settingExportFit') as HTMLInputElement | null;\n\n    // Workout metadata settings\n    const settingPromptForNotes = document.getElementById('settingPromptForNotes') as HTMLInputElement | null;\n    const settingPromptForExertion = document.getElementById('settingPromptForExertion') as HTMLInputElement | null;\n\n    // Countdown settings\n    const settingCountdownDuration = document.getElementById('settingCountdownDuration') as HTMLSelectElement | null;\n    const settingCountdownBeep = document.getElementById('settingCountdownBeep') as HTMLInputElement | null;\n    const settingCountdownVoice = document.getElementById('settingCountdownVoice') as HTMLInputElement | null;\n\n    // Auto-Lap settings\n    const settingAutoLapEnabled = document.getElementById('settingAutoLapEnabled') as HTMLInputElement | null;\n    const settingAutoLapSource = document.getElementById('settingAutoLapSource') as HTMLSelectElement | null;\n    const settingAutoLapDistance = document.getElementById('settingAutoLapDistance') as HTMLSelectElement | null;\n    const settingAutoLapTime = document.getElementById('settingAutoLapTime') as HTMLSelectElement | null;\n    const autoLapOptions = document.getElementById('autoLapOptions');\n    const autoLapDistanceOption = document.getElementById('autoLapDistanceOption');\n    const autoLapTimeOption = document.getElementById('autoLapTimeOption');\n\n    // Enhanced Voice settings\n    const settingVoiceTimeInterval = document.getElementById('settingVoiceTimeInterval') as HTMLSelectElement | null;\n    const settingVoiceDistanceInterval = document.getElementById(\n        'settingVoiceDistanceInterval'\n    ) as HTMLSelectElement | null;\n    const settingVoiceSpeechRate = document.getElementById('settingVoiceSpeechRate') as HTMLSelectElement | null;\n    const settingVoiceMetricPower = document.getElementById('settingVoiceMetricPower') as HTMLInputElement | null;\n    const settingVoiceMetricHeartrate = document.getElementById(\n        'settingVoiceMetricHeartrate'\n    ) as HTMLInputElement | null;\n    const settingVoiceMetricCadence = document.getElementById('settingVoiceMetricCadence') as HTMLInputElement | null;\n    const settingVoiceMetricSpeed = document.getElementById('settingVoiceMetricSpeed') as HTMLInputElement | null;\n    const settingVoiceMetricDistance = document.getElementById('settingVoiceMetricDistance') as HTMLInputElement | null;\n    const settingVoiceMetricTime = document.getElementById('settingVoiceMetricTime') as HTMLInputElement | null;\n\n    // Sport Type settings\n    const settingSportType = document.getElementById('settingSportType') as HTMLSelectElement | null;\n    const settingShowPace = document.getElementById('settingShowPace') as HTMLInputElement | null;\n    const settingThresholdPace = document.getElementById('settingThresholdPace') as HTMLInputElement | null;\n    const runningOptions = document.getElementById('runningOptions');\n\n    // Intervals.icu settings\n    const settingIntervalsEnabled = document.getElementById('settingIntervalsEnabled') as HTMLInputElement | null;\n    const settingIntervalsApiKey = document.getElementById('settingIntervalsApiKey') as HTMLInputElement | null;\n    const toggleIntervalsApiKey = document.getElementById('toggleIntervalsApiKey') as HTMLButtonElement | null;\n    const settingIntervalsAthleteId = document.getElementById('settingIntervalsAthleteId') as HTMLInputElement | null;\n    const settingIntervalsAutoUpload = document.getElementById('settingIntervalsAutoUpload') as HTMLInputElement | null;\n    const intervalsOptions = document.getElementById('intervalsOptions');\n\n    // Debug settings\n    const settingDebugMode = document.getElementById('settingDebugMode') as HTMLInputElement | null;\n    const debugControls = document.getElementById('debugControls');\n    const downloadDebugLogs = document.getElementById('downloadDebugLogs');\n    const clearDebugLogs = document.getElementById('clearDebugLogs');\n\n    // PWA Install button\n    const installPwaButton = document.getElementById('installPwaButton');\n\n    /**\n     * Update Intervals UI visibility\n     */\n    const updateIntervalsUI = (): void => {\n        if (intervalsOptions && settingIntervalsEnabled) {\n            intervalsOptions.style.display = settingIntervalsEnabled.checked ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Update sport type UI visibility (show running options when running/walking selected)\n     */\n    const updateSportUI = (): void => {\n        if (runningOptions && settingSportType) {\n            const isRunning = settingSportType.value === 'running' || settingSportType.value === 'walking';\n            runningOptions.style.display = isRunning ? 'block' : 'none';\n        }\n    };\n\n    /**\n     * Parse pace string (MM:SS) to seconds per km\n     */\n    const parsePace = (paceStr: string): number | null => {\n        const match = paceStr.match(/^(\\d{1,2}):([0-5]\\d)$/);\n        if (!match) return null;\n        const minutes = parseInt(match[1], 10);\n        const seconds = parseInt(match[2], 10);\n        return minutes * 60 + seconds;\n    };\n\n    /**\n     * Save sport settings\n     */\n    const saveSportSettingsFromUI = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            sportSettings.activeSport = settingSportType.value as SportType;\n        }\n        if (settingShowPace !== null) {\n            sportSettings.running.showPace = settingShowPace.checked;\n        }\n        if (settingThresholdPace?.value) {\n            const paceSeconds = parsePace(settingThresholdPace.value);\n            if (paceSeconds !== null) {\n                // Store threshold pace as target pace range (¬±30 sec)\n                sportSettings.running.targetPaceMin = paceSeconds - 30;\n                sportSettings.running.targetPaceMax = paceSeconds + 30;\n            }\n        }\n\n        saveSportSettings(sportSettings);\n    };\n\n    /**\n     * Load sport settings into UI\n     */\n    const loadSportSettings = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            settingSportType.value = sportSettings.activeSport;\n        }\n        if (settingShowPace) {\n            settingShowPace.checked = sportSettings.running.showPace;\n        }\n        if (settingThresholdPace) {\n            // Calculate threshold pace from target pace (middle of range)\n            const thresholdPace = Math.round(\n                (sportSettings.running.targetPaceMin + sportSettings.running.targetPaceMax) / 2\n            );\n            settingThresholdPace.value = formatPace(thresholdPace);\n        }\n\n        updateSportUI();\n    };\n\n    // Sport type change listener\n    settingSportType?.addEventListener('change', updateSportUI);\n\n    /**\n     * Toggle API Key visibility\n     */\n    toggleIntervalsApiKey?.addEventListener('click', () => {\n        if (settingIntervalsApiKey) {\n            const isPassword = settingIntervalsApiKey.type === 'password';\n            settingIntervalsApiKey.type = isPassword ? 'text' : 'password';\n            if (toggleIntervalsApiKey) {\n                toggleIntervalsApiKey.textContent = isPassword ? 'üôà' : 'üëÅÔ∏è';\n            }\n        }\n    });\n\n    settingIntervalsEnabled?.addEventListener('change', updateIntervalsUI);\n\n    /**\n     * Update auto-pause options visibility and unit label\n     */\n    const updateAutoPauseUI = (): void => {\n        if (autoPauseOptions && settingAutoPauseEnabled) {\n            autoPauseOptions.style.opacity = settingAutoPauseEnabled.checked ? '1' : '0.5';\n            autoPauseOptions.style.pointerEvents = settingAutoPauseEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoPauseThresholdUnit && settingAutoPauseSource) {\n            const unit = getAutoPauseSourceUnit(settingAutoPauseSource.value as AutoPauseSource);\n            autoPauseThresholdUnit.textContent = unit;\n        }\n    };\n\n    // Add event listeners for auto-pause UI updates\n    settingAutoPauseEnabled?.addEventListener('change', updateAutoPauseUI);\n    settingAutoPauseSource?.addEventListener('change', updateAutoPauseUI);\n\n    /**\n     * Update auto-lap options visibility and source options\n     */\n    const updateAutoLapUI = (): void => {\n        if (autoLapOptions && settingAutoLapEnabled) {\n            autoLapOptions.style.opacity = settingAutoLapEnabled.checked ? '1' : '0.5';\n            autoLapOptions.style.pointerEvents = settingAutoLapEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoLapDistanceOption && autoLapTimeOption && settingAutoLapSource) {\n            const isDistance = settingAutoLapSource.value === 'distance';\n            autoLapDistanceOption.style.display = isDistance ? 'flex' : 'none';\n            autoLapTimeOption.style.display = isDistance ? 'none' : 'flex';\n        }\n    };\n\n    // Add event listeners for auto-lap UI updates\n    settingAutoLapEnabled?.addEventListener('change', updateAutoLapUI);\n    settingAutoLapSource?.addEventListener('change', updateAutoLapUI);\n\n    /**\n     * Apply settings to the UI\n     */\n    const applySettings = (settings: AppSettings): void => {\n        // Toggle metric visibility\n        const toggleMetric = (metric: string, isVisible: boolean): void => {\n            const elements = document.querySelectorAll(`.metric-group-${metric}`);\n            elements.forEach((el) => {\n                (el as HTMLElement).style.display = isVisible ? 'flex' : 'none';\n            });\n        };\n\n        toggleMetric('speed', settings.speed);\n        toggleMetric('distance', settings.distance);\n        toggleMetric('altitude', settings.altitude);\n        toggleMetric('energy', settings.showCalories);\n        toggleMetric('power', settings.power);\n        toggleMetric('cadence', settings.cadence);\n        toggleMetric('heartrate', settings.heartrate);\n        toggleMetric('treadmillSpeed', settings.treadmillSpeed);\n\n        // Apply 3-second average power indicator\n        const powerMetrics = document.querySelectorAll('.metric-group-power');\n        powerMetrics.forEach((el) => {\n            if (settings.power3s) {\n                el.setAttribute('data-show-avg', 'true');\n            } else {\n                el.removeAttribute('data-show-avg');\n            }\n        });\n\n        // Apply high contrast mode\n        if (settings.highContrast) {\n            document.documentElement.setAttribute('data-high-contrast', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-high-contrast');\n        }\n\n        // Apply colorblind patterns (enabled when high contrast + colorblind patterns both on)\n        if (settings.colorblindPatterns) {\n            document.documentElement.setAttribute('data-colorblind-patterns', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-colorblind-patterns');\n        }\n\n        // Apply debug mode UI\n        if (debugControls) {\n            debugControls.style.display = settings.debugMode ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Save settings to localStorage\n     */\n    const saveSettings = (): void => {\n        // Save User Profile\n        const currentProfile = loadUserProfile();\n        const updatedProfile = {\n            ...currentProfile,\n            ftp: settingFtp?.value ? Number(settingFtp.value) : null,\n            maxHr: settingMaxHr?.value ? Number(settingMaxHr.value) : null,\n            weight: settingWeight?.value ? Number(settingWeight.value) : null,\n        };\n        saveUserProfile(updatedProfile);\n        window.dispatchEvent(new CustomEvent('user-profile-changed'));\n\n        const settings: AppSettings = {\n            speed: settingSpeed?.checked ?? defaultSettings.speed,\n            distance: settingDistance?.checked ?? defaultSettings.distance,\n            altitude: settingAltitude?.checked ?? defaultSettings.altitude,\n            weightKg: settingWeight?.value ? Number(settingWeight.value) : defaultSettings.weightKg,\n            showCalories: settingShowCalories?.checked ?? defaultSettings.showCalories,\n            power: settingPower?.checked ?? defaultSettings.power,\n            cadence: settingCadence?.checked ?? defaultSettings.cadence,\n            heartrate: settingHeartrate?.checked ?? defaultSettings.heartrate,\n            treadmillSpeed: settingTreadmillSpeed?.checked ?? defaultSettings.treadmillSpeed,\n            power3s: settingPower3s?.checked ?? defaultSettings.power3s,\n            highContrast: settingHighContrast?.checked ?? defaultSettings.highContrast,\n            colorblindPatterns: settingColorblindPatterns?.checked ?? defaultSettings.colorblindPatterns,\n            voiceEnabled: settingVoiceEnabled?.checked ?? defaultSettings.voiceEnabled,\n            voiceLaps: settingVoiceLaps?.checked ?? defaultSettings.voiceLaps,\n            voiceZones: settingVoiceZones?.checked ?? defaultSettings.voiceZones,\n            autoPause: {\n                enabled: settingAutoPauseEnabled?.checked ?? defaultAutoPauseSettings.enabled,\n                source: (settingAutoPauseSource?.value as AutoPauseSource) ?? defaultAutoPauseSettings.source,\n                threshold: settingAutoPauseThreshold?.value\n                    ? Number(settingAutoPauseThreshold.value)\n                    : defaultAutoPauseSettings.threshold,\n                delay: settingAutoPauseDelay?.value\n                    ? Number(settingAutoPauseDelay.value)\n                    : defaultAutoPauseSettings.delay,\n            },\n            workoutMetadata: {\n                promptForNotes: settingPromptForNotes?.checked ?? defaultWorkoutMetadataSettings.promptForNotes,\n                promptForExertion:\n                    settingPromptForExertion?.checked ?? defaultWorkoutMetadataSettings.promptForExertion,\n            },\n            countdown: {\n                duration: (settingCountdownDuration?.value\n                    ? parseInt(settingCountdownDuration.value)\n                    : defaultCountdownSettings.duration) as 0 | 3 | 5 | 10,\n                enableBeep: settingCountdownBeep?.checked ?? defaultCountdownSettings.enableBeep,\n                enableVoice: settingCountdownVoice?.checked ?? defaultCountdownSettings.enableVoice,\n            },\n            autoLap: {\n                enabled: settingAutoLapEnabled?.checked ?? defaultAutoLapSettings.enabled,\n                source: (settingAutoLapSource?.value as AutoLapSource) ?? defaultAutoLapSettings.source,\n                distanceKm: settingAutoLapDistance?.value\n                    ? Number(settingAutoLapDistance.value)\n                    : defaultAutoLapSettings.distanceKm,\n                timeMinutes: settingAutoLapTime?.value\n                    ? Number(settingAutoLapTime.value)\n                    : defaultAutoLapSettings.timeMinutes,\n            },\n            enhancedVoice: {\n                timeIntervalMinutes: (settingVoiceTimeInterval?.value\n                    ? parseInt(settingVoiceTimeInterval.value)\n                    : defaultEnhancedVoiceSettings.timeIntervalMinutes) as 0 | 1 | 5 | 10 | 15 | 30,\n                distanceIntervalKm: (settingVoiceDistanceInterval?.value\n                    ? parseInt(settingVoiceDistanceInterval.value)\n                    : defaultEnhancedVoiceSettings.distanceIntervalKm) as 0 | 1 | 5 | 10,\n                metrics: {\n                    power: settingVoiceMetricPower?.checked ?? defaultVoiceMetrics.power,\n                    heartrate: settingVoiceMetricHeartrate?.checked ?? defaultVoiceMetrics.heartrate,\n                    cadence: settingVoiceMetricCadence?.checked ?? defaultVoiceMetrics.cadence,\n                    speed: settingVoiceMetricSpeed?.checked ?? defaultVoiceMetrics.speed,\n                    distance: settingVoiceMetricDistance?.checked ?? defaultVoiceMetrics.distance,\n                    time: settingVoiceMetricTime?.checked ?? defaultVoiceMetrics.time,\n                },\n                speechRate: (settingVoiceSpeechRate?.value\n                    ? parseFloat(settingVoiceSpeechRate.value)\n                    : defaultEnhancedVoiceSettings.speechRate) as 0.5 | 0.75 | 1 | 1.25 | 1.5 | 2,\n            },\n            intervals: {\n                enabled: settingIntervalsEnabled?.checked ?? defaultIntervalsSettings.enabled,\n                apiKey: settingIntervalsApiKey?.value ?? defaultIntervalsSettings.apiKey,\n                athleteId: settingIntervalsAthleteId?.value ?? defaultIntervalsSettings.athleteId,\n                autoUpload: settingIntervalsAutoUpload?.checked ?? defaultIntervalsSettings.autoUpload,\n            },\n            exportTcx: settingExportTcx?.checked ?? defaultSettings.exportTcx,\n            exportCsv: settingExportCsv?.checked ?? defaultSettings.exportCsv,\n            exportJson: settingExportJson?.checked ?? defaultSettings.exportJson,\n            exportFit: settingExportFit?.checked ?? defaultSettings.exportFit,\n            debugMode: settingDebugMode?.checked ?? defaultSettings.debugMode,\n        };\n\n        // saveSettingsToStorage dispatches 'settings-changed' internally\n        saveSettingsToStorage(settings);\n\n        // Save sport settings separately\n        saveSportSettingsFromUI();\n\n        applySettings(settings);\n    };\n\n    /**\n     * Load settings from localStorage\n     */\n    const loadSettings = (): void => {\n        const settings = getSettings();\n        const profile = loadUserProfile();\n\n        // User Profile settings\n        if (settingFtp) settingFtp.value = profile.ftp?.toString() ?? '';\n        if (settingMaxHr) settingMaxHr.value = profile.maxHr?.toString() ?? '';\n        if (settingWeight) settingWeight.value = profile.weight?.toString() ?? '';\n\n        // Dashboard display settings\n        if (settingPower) settingPower.checked = settings.power;\n        if (settingCadence) settingCadence.checked = settings.cadence;\n        if (settingHeartrate) settingHeartrate.checked = settings.heartrate;\n        if (settingSpeed) settingSpeed.checked = settings.speed;\n        if (settingDistance) settingDistance.checked = settings.distance;\n        if (settingAltitude) settingAltitude.checked = settings.altitude;\n        if (settingShowCalories) settingShowCalories.checked = settings.showCalories;\n        if (settingTreadmillSpeed) settingTreadmillSpeed.checked = settings.treadmillSpeed;\n        if (settingPower3s) settingPower3s.checked = settings.power3s;\n\n        // Accessibility settings\n        if (settingHighContrast) settingHighContrast.checked = settings.highContrast;\n        if (settingColorblindPatterns) settingColorblindPatterns.checked = settings.colorblindPatterns;\n\n        // Voice Feedback settings\n        if (settingVoiceEnabled) settingVoiceEnabled.checked = settings.voiceEnabled;\n        if (settingVoiceLaps) settingVoiceLaps.checked = settings.voiceLaps;\n        if (settingVoiceZones) settingVoiceZones.checked = settings.voiceZones;\n\n        // Auto-Pause settings\n        if (settingAutoPauseEnabled) settingAutoPauseEnabled.checked = settings.autoPause.enabled;\n        if (settingAutoPauseSource) settingAutoPauseSource.value = settings.autoPause.source;\n        if (settingAutoPauseThreshold) settingAutoPauseThreshold.value = settings.autoPause.threshold.toString();\n        if (settingAutoPauseDelay) settingAutoPauseDelay.value = settings.autoPause.delay.toString();\n        updateAutoPauseUI();\n\n        // Export format settings\n        if (settingExportTcx) settingExportTcx.checked = settings.exportTcx;\n        if (settingExportCsv) settingExportCsv.checked = settings.exportCsv;\n        if (settingExportJson) settingExportJson.checked = settings.exportJson;\n        if (settingExportFit) settingExportFit.checked = settings.exportFit;\n\n        // Workout metadata settings\n        if (settingPromptForNotes) settingPromptForNotes.checked = settings.workoutMetadata.promptForNotes;\n        if (settingPromptForExertion) settingPromptForExertion.checked = settings.workoutMetadata.promptForExertion;\n\n        // Countdown settings\n        if (settingCountdownDuration) settingCountdownDuration.value = settings.countdown.duration.toString();\n        if (settingCountdownBeep) settingCountdownBeep.checked = settings.countdown.enableBeep;\n        if (settingCountdownVoice) settingCountdownVoice.checked = settings.countdown.enableVoice;\n\n        // Auto-Lap settings\n        if (settingAutoLapEnabled) settingAutoLapEnabled.checked = settings.autoLap.enabled;\n        if (settingAutoLapSource) settingAutoLapSource.value = settings.autoLap.source;\n        if (settingAutoLapDistance) settingAutoLapDistance.value = settings.autoLap.distanceKm.toString();\n        if (settingAutoLapTime) settingAutoLapTime.value = settings.autoLap.timeMinutes.toString();\n        updateAutoLapUI();\n\n        // Enhanced Voice settings\n        if (settingVoiceTimeInterval)\n            settingVoiceTimeInterval.value = settings.enhancedVoice.timeIntervalMinutes.toString();\n        if (settingVoiceDistanceInterval)\n            settingVoiceDistanceInterval.value = settings.enhancedVoice.distanceIntervalKm.toString();\n        if (settingVoiceSpeechRate) settingVoiceSpeechRate.value = settings.enhancedVoice.speechRate.toString();\n        if (settingVoiceMetricPower) settingVoiceMetricPower.checked = settings.enhancedVoice.metrics.power;\n        if (settingVoiceMetricHeartrate) settingVoiceMetricHeartrate.checked = settings.enhancedVoice.metrics.heartrate;\n        if (settingVoiceMetricCadence) settingVoiceMetricCadence.checked = settings.enhancedVoice.metrics.cadence;\n        if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = settings.enhancedVoice.metrics.speed;\n        if (settingVoiceMetricDistance) settingVoiceMetricDistance.checked = settings.enhancedVoice.metrics.distance;\n        if (settingVoiceMetricTime) settingVoiceMetricTime.checked = settings.enhancedVoice.metrics.time;\n\n        // Intervals.icu settings\n        if (settingIntervalsEnabled) settingIntervalsEnabled.checked = settings.intervals.enabled;\n        if (settingIntervalsApiKey) settingIntervalsApiKey.value = settings.intervals.apiKey;\n        if (settingIntervalsAthleteId) settingIntervalsAthleteId.value = settings.intervals.athleteId;\n        if (settingIntervalsAutoUpload) settingIntervalsAutoUpload.checked = settings.intervals.autoUpload;\n        updateIntervalsUI();\n\n        // Debug settings\n        if (settingDebugMode) settingDebugMode.checked = settings.debugMode;\n\n        // Sport settings (stored separately)\n        loadSportSettings();\n\n        applySettings(settings);\n    };\n\n    // Event Listeners\n    saveSettingsButton?.addEventListener('click', saveSettings);\n\n    downloadDebugLogs?.addEventListener('click', () => {\n        BluetoothDebugService.exportLogs();\n    });\n\n    clearDebugLogs?.addEventListener('click', async () => {\n        if (confirm('Are you sure you want to clear all debug logs?')) {\n            await BluetoothDebugService.clearLogs();\n            alert('Logs cleared.');\n        }\n    });\n\n    // PWA Install button handler\n    installPwaButton?.addEventListener('click', async () => {\n        const outcome = await triggerInstallPrompt();\n\n        if (outcome === 'accepted') {\n            // App will be installed, button will hide automatically via installPrompt.ts\n            console.log('PWA installation accepted');\n        } else if (outcome === 'dismissed') {\n            console.log('PWA installation dismissed');\n        } else {\n            alert(\n                'Installation is not available at this time. The app may already be installed or your browser does not support installation.'\n            );\n        }\n    });\n\n    // Initialize\n    loadSettings();\n}\n","/**\n * Data Fields Configuration UI\n *\n * Provides user interface for configuring data field screens and profiles.\n * - Edit existing screens (add/remove/reorder fields)\n * - Switch between activity profiles\n * - Preview screen layouts\n *\n * @module ui/dataFieldsConfig\n */\n\nimport type { ActivityProfile, DataScreen, DataFieldSlot, ScreenLayout } from '../data-fields/types.js';\nimport { loadActiveProfile, saveProfile } from '../data-fields/persistence.js';\nimport { getDataField, getAllCategories, getFieldsByCategory, searchFields } from '../data-fields/registry.js';\nimport { addSlotToScreen, removeSlotFromScreen, updateSlot } from '../data-fields/screens.js';\nimport type { DataFieldCategory, DataFieldDefinition } from '../data-fields/types.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface DataFieldsConfigState {\n    profile: ActivityProfile;\n    selectedScreenIndex: number;\n    isEditing: boolean;\n    searchQuery: string;\n    selectedCategory: DataFieldCategory | 'all';\n}\n\ntype UpdateCallback = () => void;\n\n// ============================================================================\n// State Management\n// ============================================================================\n\nlet state: DataFieldsConfigState = {\n    profile: loadActiveProfile(),\n    selectedScreenIndex: 0,\n    isEditing: false,\n    searchQuery: '',\n    selectedCategory: 'all',\n};\n\nconst updateCallbacks: Set<UpdateCallback> = new Set();\n\n/**\n * Subscribe to state updates\n */\nfunction subscribe(callback: UpdateCallback): () => void {\n    updateCallbacks.add(callback);\n    return () => updateCallbacks.delete(callback);\n}\n\n/**\n * Notify subscribers of state change\n */\nfunction notifyUpdate(): void {\n    updateCallbacks.forEach((cb) => cb());\n}\n\n/**\n * Update state and notify\n */\nfunction updateState(updates: Partial<DataFieldsConfigState>): void {\n    state = { ...state, ...updates };\n    notifyUpdate();\n}\n\n// ============================================================================\n// Profile/Screen Management\n// ============================================================================\n\n/**\n * Load and set the active profile\n */\nfunction loadProfile(): void {\n    const profile = loadActiveProfile();\n    updateState({\n        profile,\n        selectedScreenIndex: Math.min(state.selectedScreenIndex, profile.screens.length - 1),\n    });\n}\n\n/**\n * Save the current profile\n */\nfunction saveCurrentProfile(): boolean {\n    const success = saveProfile(state.profile);\n    if (success) {\n        // Dispatch event so carousel updates\n        document.dispatchEvent(\n            new CustomEvent('data-fields-profile-changed', {\n                detail: { profile: state.profile },\n            })\n        );\n    }\n    return success;\n}\n\n/**\n * Get the currently selected screen\n */\nfunction getSelectedScreen(): DataScreen | null {\n    return state.profile.screens[state.selectedScreenIndex] ?? null;\n}\n\n/**\n * Add a field to the current screen\n */\nfunction addFieldToScreen(fieldId: string, size: 'small' | 'medium' | 'large' = 'medium'): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = addSlotToScreen(screen, fieldId, size);\n\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Remove a field from the current screen\n */\nfunction removeFieldFromScreen(slotId: string): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = removeSlotFromScreen(screen, slotId);\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update a slot's properties\n */\nfunction updateFieldSlot(slotId: string, updates: Partial<DataFieldSlot>): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = updateSlot(screen, slotId, updates);\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update screen layout\n */\nfunction updateScreenLayout(layout: ScreenLayout): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = { ...screen, layout };\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update a screen in the profile\n */\nfunction updateScreenInProfile(screen: DataScreen): void {\n    const screens = [...state.profile.screens];\n    screens[state.selectedScreenIndex] = screen;\n\n    updateState({\n        profile: { ...state.profile, screens },\n    });\n}\n\n/**\n * Reorder fields in the current screen\n */\nfunction reorderFields(fromIndex: number, toIndex: number): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const slots = [...screen.slots];\n    const [removed] = slots.splice(fromIndex, 1);\n    slots.splice(toIndex, 0, removed);\n\n    // Update positions\n    const reorderedSlots = slots.map((slot, idx) => ({\n        ...slot,\n        position: idx,\n    }));\n\n    updateScreenInProfile({ ...screen, slots: reorderedSlots });\n}\n\n// ============================================================================\n// Field Search/Filter\n// ============================================================================\n\n/**\n * Get filtered fields based on search and category\n */\nfunction getFilteredFields(): DataFieldDefinition[] {\n    let fields: DataFieldDefinition[];\n\n    if (state.searchQuery.trim()) {\n        fields = searchFields(state.searchQuery);\n    } else if (state.selectedCategory === 'all') {\n        const categories = getAllCategories();\n        fields = Array.from(categories.values()).flat();\n    } else {\n        fields = getFieldsByCategory(state.selectedCategory);\n    }\n\n    return fields;\n}\n\n// ============================================================================\n// UI Rendering\n// ============================================================================\n\n/**\n * Category icons for visual display\n */\nconst CATEGORY_ICONS: Record<DataFieldCategory | 'all', string> = {\n    all: 'üìä',\n    power: '‚ö°',\n    heartrate: '‚ù§Ô∏è',\n    cadence: 'üîÑ',\n    speed: 'üö¥',\n    distance: 'üìç',\n    elevation: '‚õ∞Ô∏è',\n    time: '‚è±Ô∏è',\n    laps: 'üèÅ',\n    energy: 'üî•',\n    environment: 'üå°Ô∏è',\n    device: 'üîã',\n    charts: 'üìà',\n    map: 'üó∫Ô∏è',\n};\n\n/**\n * Create the main configuration UI\n */\nfunction createConfigUI(container: HTMLElement): void {\n    container.innerHTML = `\n        <div class=\"data-fields-config\">\n            <div class=\"dfc-header\">\n                <h3>üìä Data Fields</h3>\n                <p class=\"dfc-help-text\">Configure which metrics appear on your dashboard screens.</p>\n            </div>\n            \n            <div class=\"dfc-screens\">\n                <div class=\"dfc-screens-tabs\" role=\"tablist\"></div>\n            </div>\n            \n            <div class=\"dfc-current-screen\">\n                <div class=\"dfc-screen-header\">\n                    <span class=\"dfc-screen-name\"></span>\n                    <select class=\"dfc-layout-select\" aria-label=\"Screen layout\">\n                        <option value=\"auto\">Auto Layout</option>\n                        <option value=\"grid-2\">2 Columns</option>\n                        <option value=\"grid-3\">3 Columns</option>\n                        <option value=\"grid-4\">4 Columns</option>\n                        <option value=\"list\">List</option>\n                    </select>\n                </div>\n                <div class=\"dfc-fields-list\" role=\"list\" aria-label=\"Current screen fields\"></div>\n                <button class=\"dfc-add-field-btn\" type=\"button\">\n                    <span>+</span> Add Field\n                </button>\n            </div>\n            \n            <div class=\"dfc-field-picker\" style=\"display: none;\">\n                <div class=\"dfc-picker-header\">\n                    <h4>Select a Field</h4>\n                    <button class=\"dfc-picker-close\" type=\"button\" aria-label=\"Close field picker\">&times;</button>\n                </div>\n                <input type=\"search\" class=\"dfc-search\" placeholder=\"Search fields...\" aria-label=\"Search data fields\">\n                <div class=\"dfc-categories\" role=\"tablist\"></div>\n                <div class=\"dfc-available-fields\" role=\"listbox\" aria-label=\"Available fields\"></div>\n            </div>\n            \n            <div class=\"dfc-actions\">\n                <button class=\"dfc-save-btn\" type=\"button\">Save Changes</button>\n                <button class=\"dfc-reset-btn\" type=\"button\">Reset to Defaults</button>\n            </div>\n        </div>\n    `;\n\n    // Set up event listeners\n    setupConfigEventListeners(container);\n\n    // Initial render\n    renderConfigUI(container);\n\n    // Subscribe to state changes\n    subscribe(() => renderConfigUI(container));\n}\n\n/**\n * Render the current state to the UI\n */\nfunction renderConfigUI(container: HTMLElement): void {\n    renderScreenTabs(container);\n    renderCurrentScreen(container);\n    renderFieldPicker(container);\n}\n\n/**\n * Render screen tabs\n */\nfunction renderScreenTabs(container: HTMLElement): void {\n    const tabsContainer = container.querySelector('.dfc-screens-tabs');\n    if (!tabsContainer) return;\n\n    tabsContainer.innerHTML = state.profile.screens\n        .map(\n            (screen, idx) => `\n            <button \n                class=\"dfc-screen-tab ${idx === state.selectedScreenIndex ? 'dfc-screen-tab--active' : ''}\"\n                data-screen-index=\"${idx}\"\n                role=\"tab\"\n                aria-selected=\"${idx === state.selectedScreenIndex}\"\n                aria-label=\"${screen.name} screen\"\n            >\n                <span class=\"dfc-tab-icon\">${screen.icon}</span>\n                <span class=\"dfc-tab-name\">${escapeHtml(screen.name)}</span>\n            </button>\n        `\n        )\n        .join('');\n}\n\n/**\n * Render current screen fields\n */\nfunction renderCurrentScreen(container: HTMLElement): void {\n    const screen = getSelectedScreen();\n    const nameEl = container.querySelector('.dfc-screen-name');\n    const layoutSelect = container.querySelector('.dfc-layout-select') as HTMLSelectElement;\n    const fieldsList = container.querySelector('.dfc-fields-list');\n\n    if (!screen || !nameEl || !fieldsList || !layoutSelect) return;\n\n    nameEl.textContent = `${screen.icon} ${screen.name}`;\n    layoutSelect.value = screen.layout;\n\n    if (screen.slots.length === 0) {\n        fieldsList.innerHTML = `\n            <div class=\"dfc-empty-screen\">\n                <p>No fields on this screen</p>\n                <p class=\"dfc-empty-hint\">Click \"Add Field\" to add metrics</p>\n            </div>\n        `;\n        return;\n    }\n\n    fieldsList.innerHTML = screen.slots\n        .sort((a, b) => a.position - b.position)\n        .map((slot) => {\n            const field = getDataField(slot.fieldId);\n            const fieldName = field?.name ?? 'Unknown';\n            const fieldIcon = field?.icon ?? '‚ùì';\n\n            return `\n                <div class=\"dfc-field-item\" data-slot-id=\"${slot.id}\" role=\"listitem\" draggable=\"true\">\n                    <span class=\"dfc-field-drag\" title=\"Drag to reorder\">‚ãÆ‚ãÆ</span>\n                    <span class=\"dfc-field-icon\">${fieldIcon}</span>\n                    <div class=\"dfc-field-info\">\n                        <span class=\"dfc-field-name\">${escapeHtml(fieldName)}</span>\n                        <span class=\"dfc-field-id\">${slot.fieldId}</span>\n                    </div>\n                    <select class=\"dfc-field-size\" data-slot-id=\"${slot.id}\" aria-label=\"Field size\">\n                        <option value=\"small\" ${slot.size === 'small' ? 'selected' : ''}>Small</option>\n                        <option value=\"medium\" ${slot.size === 'medium' ? 'selected' : ''}>Medium</option>\n                        <option value=\"large\" ${slot.size === 'large' ? 'selected' : ''}>Large</option>\n                    </select>\n                    <button class=\"dfc-field-remove\" data-slot-id=\"${slot.id}\" aria-label=\"Remove ${fieldName}\" title=\"Remove\">\n                        üóëÔ∏è\n                    </button>\n                </div>\n            `;\n        })\n        .join('');\n}\n\n/**\n * Render field picker\n */\nfunction renderFieldPicker(container: HTMLElement): void {\n    const categoriesContainer = container.querySelector('.dfc-categories');\n    const fieldsContainer = container.querySelector('.dfc-available-fields');\n\n    if (!categoriesContainer || !fieldsContainer) return;\n\n    // Render category tabs\n    const categories: Array<DataFieldCategory | 'all'> = [\n        'all',\n        'power',\n        'heartrate',\n        'cadence',\n        'speed',\n        'distance',\n        'elevation',\n        'time',\n    ];\n\n    categoriesContainer.innerHTML = categories\n        .map(\n            (cat) => `\n            <button \n                class=\"dfc-category-btn ${cat === state.selectedCategory ? 'dfc-category-btn--active' : ''}\"\n                data-category=\"${cat}\"\n                role=\"tab\"\n                aria-selected=\"${cat === state.selectedCategory}\"\n            >\n                <span>${CATEGORY_ICONS[cat]}</span>\n                <span>${cat === 'all' ? 'All' : cat.charAt(0).toUpperCase() + cat.slice(1)}</span>\n            </button>\n        `\n        )\n        .join('');\n\n    // Render available fields\n    const fields = getFilteredFields();\n    const currentScreen = getSelectedScreen();\n    const usedFieldIds = new Set(currentScreen?.slots.map((s) => s.fieldId) ?? []);\n\n    fieldsContainer.innerHTML = fields\n        .map((field) => {\n            const isUsed = usedFieldIds.has(field.id);\n            return `\n                <button \n                    class=\"dfc-available-field ${isUsed ? 'dfc-available-field--used' : ''}\"\n                    data-field-id=\"${field.id}\"\n                    role=\"option\"\n                    aria-selected=\"false\"\n                    ${isUsed ? 'disabled' : ''}\n                >\n                    <span class=\"dfc-af-icon\">${field.icon}</span>\n                    <div class=\"dfc-af-info\">\n                        <span class=\"dfc-af-name\">${escapeHtml(field.name)}</span>\n                        <span class=\"dfc-af-desc\">${escapeHtml(field.description)}</span>\n                    </div>\n                    ${isUsed ? '<span class=\"dfc-af-badge\">Added</span>' : ''}\n                </button>\n            `;\n        })\n        .join('');\n}\n\n/**\n * Setup event listeners for the config UI\n */\nfunction setupConfigEventListeners(container: HTMLElement): void {\n    // Screen tab clicks\n    container.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n\n        // Screen tab\n        const tab = target.closest('.dfc-screen-tab') as HTMLElement;\n        if (tab) {\n            const idx = parseInt(tab.dataset.screenIndex ?? '0', 10);\n            updateState({ selectedScreenIndex: idx });\n            return;\n        }\n\n        // Add field button\n        if (target.closest('.dfc-add-field-btn')) {\n            showFieldPicker(container);\n            return;\n        }\n\n        // Close picker\n        if (target.closest('.dfc-picker-close')) {\n            hideFieldPicker(container);\n            return;\n        }\n\n        // Category button\n        const catBtn = target.closest('.dfc-category-btn') as HTMLElement;\n        if (catBtn) {\n            const category = catBtn.dataset.category as DataFieldCategory | 'all';\n            updateState({ selectedCategory: category });\n            return;\n        }\n\n        // Available field click\n        const fieldBtn = target.closest('.dfc-available-field') as HTMLElement;\n        if (fieldBtn && !fieldBtn.hasAttribute('disabled')) {\n            const fieldId = fieldBtn.dataset.fieldId;\n            if (fieldId) {\n                addFieldToScreen(fieldId);\n                notifyUpdate();\n            }\n            return;\n        }\n\n        // Remove field\n        const removeBtn = target.closest('.dfc-field-remove') as HTMLElement;\n        if (removeBtn) {\n            const slotId = removeBtn.dataset.slotId;\n            if (slotId) {\n                removeFieldFromScreen(slotId);\n            }\n            return;\n        }\n\n        // Save button\n        if (target.closest('.dfc-save-btn')) {\n            if (saveCurrentProfile()) {\n                showNotification('Settings saved!', 'success');\n            } else {\n                showNotification('Failed to save settings', 'error');\n            }\n            return;\n        }\n\n        // Reset button\n        if (target.closest('.dfc-reset-btn')) {\n            if (confirm('Reset data fields to defaults? This cannot be undone.')) {\n                resetToDefaults();\n            }\n            return;\n        }\n    });\n\n    // Layout select change\n    container.addEventListener('change', (e) => {\n        const target = e.target as HTMLSelectElement;\n\n        if (target.classList.contains('dfc-layout-select')) {\n            updateScreenLayout(target.value as ScreenLayout);\n            return;\n        }\n\n        if (target.classList.contains('dfc-field-size')) {\n            const slotId = target.dataset.slotId;\n            if (slotId) {\n                updateFieldSlot(slotId, { size: target.value as 'small' | 'medium' | 'large' });\n            }\n            return;\n        }\n    });\n\n    // Search input\n    const searchInput = container.querySelector('.dfc-search') as HTMLInputElement;\n    if (searchInput) {\n        searchInput.addEventListener('input', (e) => {\n            const target = e.target as HTMLInputElement;\n            updateState({ searchQuery: target.value });\n        });\n    }\n\n    // Drag and drop for reordering\n    setupDragAndDrop(container);\n}\n\n/**\n * Setup drag and drop reordering\n */\nfunction setupDragAndDrop(container: HTMLElement): void {\n    const fieldsList = container.querySelector('.dfc-fields-list');\n    if (!fieldsList) return;\n\n    let draggedEl: HTMLElement | null = null;\n    let draggedIndex: number = -1;\n\n    fieldsList.addEventListener('dragstart', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        draggedEl = target.closest('.dfc-field-item') as HTMLElement;\n        if (draggedEl) {\n            draggedIndex = Array.from(fieldsList.children).indexOf(draggedEl);\n            draggedEl.classList.add('dfc-field-item--dragging');\n        }\n    });\n\n    fieldsList.addEventListener('dragend', () => {\n        if (draggedEl) {\n            draggedEl.classList.remove('dfc-field-item--dragging');\n        }\n        draggedEl = null;\n        draggedIndex = -1;\n    });\n\n    fieldsList.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        const target = (e as DragEvent).target as HTMLElement;\n        const item = target.closest('.dfc-field-item') as HTMLElement;\n        if (item && item !== draggedEl) {\n            const items = Array.from(fieldsList.querySelectorAll('.dfc-field-item:not(.dfc-field-item--dragging)'));\n            const targetIndex = items.indexOf(item);\n            if (targetIndex !== -1) {\n                item.classList.add('dfc-field-item--drag-over');\n            }\n        }\n    });\n\n    fieldsList.addEventListener('dragleave', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        const item = target.closest('.dfc-field-item');\n        if (item) {\n            item.classList.remove('dfc-field-item--drag-over');\n        }\n    });\n\n    fieldsList.addEventListener('drop', (e) => {\n        e.preventDefault();\n        const target = (e as DragEvent).target as HTMLElement;\n        const targetItem = target.closest('.dfc-field-item') as HTMLElement;\n\n        // Clear all drag-over states\n        fieldsList.querySelectorAll('.dfc-field-item--drag-over').forEach((el) => {\n            el.classList.remove('dfc-field-item--drag-over');\n        });\n\n        if (targetItem && draggedEl && targetItem !== draggedEl) {\n            const items = Array.from(fieldsList.querySelectorAll('.dfc-field-item'));\n            const toIndex = items.indexOf(targetItem);\n\n            if (draggedIndex !== -1 && toIndex !== -1 && draggedIndex !== toIndex) {\n                reorderFields(draggedIndex, toIndex);\n            }\n        }\n    });\n}\n\n/**\n * Show field picker modal\n */\nfunction showFieldPicker(container: HTMLElement): void {\n    const picker = container.querySelector('.dfc-field-picker') as HTMLElement;\n    if (picker) {\n        picker.style.display = 'block';\n        const searchInput = picker.querySelector('.dfc-search') as HTMLInputElement;\n        if (searchInput) {\n            searchInput.focus();\n        }\n    }\n}\n\n/**\n * Hide field picker modal\n */\nfunction hideFieldPicker(container: HTMLElement): void {\n    const picker = container.querySelector('.dfc-field-picker') as HTMLElement;\n    if (picker) {\n        picker.style.display = 'none';\n        updateState({ searchQuery: '', selectedCategory: 'all' });\n    }\n}\n\n/**\n * Reset to default profiles\n */\nfunction resetToDefaults(): void {\n    // Clear custom profiles and reload defaults\n    localStorage.removeItem('bpt-data-fields');\n    loadProfile();\n    showNotification('Data fields reset to defaults', 'info');\n}\n\n/**\n * Show a notification toast\n */\nfunction showNotification(message: string, type: 'success' | 'error' | 'info'): void {\n    // Use existing notification system if available\n    const event = new CustomEvent('show-notification', {\n        detail: { message, type },\n    });\n    document.dispatchEvent(event);\n\n    // Fallback: console log\n    console.log(`[DataFieldsConfig] ${type}: ${message}`);\n}\n\n/**\n * HTML escape helper\n */\nfunction escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// ============================================================================\n// Initialization\n// ============================================================================\n\n/**\n * Initialize data fields configuration in the settings page\n */\nexport function initDataFieldsConfig(): void {\n    // Find or create container in settings\n    const settingsContent = document.querySelector('#page-settings .page-content');\n    if (!settingsContent) {\n        console.warn('[DataFieldsConfig] Settings page content not found');\n        return;\n    }\n\n    // Check if already initialized\n    if (settingsContent.querySelector('.data-fields-config')) {\n        return;\n    }\n\n    // Create container\n    const container = document.createElement('fieldset');\n    container.className = 'settings-fieldset';\n    container.style.cssText = 'border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;';\n    container.innerHTML = '<legend style=\"font-weight: 600; padding: 0 8px;\">üìä Data Fields Configuration</legend>';\n\n    // Insert after Voice Feedback section or at the end\n    const voiceFeedback = settingsContent.querySelector('fieldset:nth-child(4)');\n    if (voiceFeedback && voiceFeedback.nextSibling) {\n        settingsContent.insertBefore(container, voiceFeedback.nextSibling);\n    } else {\n        settingsContent.appendChild(container);\n    }\n\n    createConfigUI(container);\n\n    console.log('[DataFieldsConfig] Initialized');\n}\n\n/**\n * Refresh the config UI with current state\n */\nexport function refreshDataFieldsConfig(): void {\n    loadProfile();\n}\n\n// Export state getters for external use\nexport { getSelectedScreen, getFilteredFields };\n","import { View } from '../router/View.js';\nimport { initSettingsLogic } from '../ui/settings.js';\nimport { initDataFieldsConfig } from '../ui/dataFieldsConfig.js';\n\nexport class SettingsView implements View {\n    public id = 'settings';\n    // private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('settingsTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initSettingsLogic();\n                initDataFieldsConfig();\n                // this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Settings template not found!');\n            container.innerHTML = '<p>Error loading settings view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        console.log('Entered Settings View');\n        // If we needed to refresh settings from storage every time we enter,\n        // we might call loadSettings() here.\n        // But initSettingsLogic calls loadSettings internally during init.\n        // If the user changes settings, they are saved.\n        // If we want to ensure UI matches state if state changed elsewhere...\n        // initSettingsLogic sets up listeners.\n        // We might want to re-run loadSettings() if it exposed it.\n        // For now, let's assume one-time init is fine or we can expose refresh.\n\n        // Actually, since we re-clone the template only ONCE in init (if the container is empty?),\n        // Wait, the Router usually doesn't clear the container unless we implement it that way.\n        // My Router implementation:\n        /*\n            if (!this.views.has(viewId)) { ... view.init(container) }\n            this.currentView?.onLeave();\n            currentContainer.style.display = 'none';\n            newContainer.style.display = 'block';\n            view.onEnter();\n        */\n\n        // So init() is called once. The DOM elements persist.\n        // So `initSettingsLogic` is called once. The listeners persist.\n        // This is correct.\n    }\n\n    public onLeave(): void {\n        console.log('Left Settings View');\n    }\n}\n"],"names":["defaultSportSettings","SPORT_SETTINGS_KEY","getSportSettings","stored","saveSportSettings","settings","formatPace","paceSecPerKm","minutes","seconds","initSettingsLogic","saveSettingsButton","settingFtp","settingMaxHr","settingWeight","settingSpeed","settingDistance","settingAltitude","settingShowCalories","settingPower","settingCadence","settingHeartrate","settingTreadmillSpeed","settingPower3s","settingHighContrast","settingColorblindPatterns","settingVoiceEnabled","settingVoiceLaps","settingVoiceZones","settingAutoPauseEnabled","settingAutoPauseSource","settingAutoPauseThreshold","settingAutoPauseDelay","autoPauseOptions","autoPauseThresholdUnit","settingExportTcx","settingExportCsv","settingExportJson","settingExportFit","settingPromptForNotes","settingPromptForExertion","settingCountdownDuration","settingCountdownBeep","settingCountdownVoice","settingAutoLapEnabled","settingAutoLapSource","settingAutoLapDistance","settingAutoLapTime","autoLapOptions","autoLapDistanceOption","autoLapTimeOption","settingVoiceTimeInterval","settingVoiceDistanceInterval","settingVoiceSpeechRate","settingVoiceMetricPower","settingVoiceMetricHeartrate","settingVoiceMetricCadence","settingVoiceMetricSpeed","settingVoiceMetricDistance","settingVoiceMetricTime","settingSportType","settingShowPace","settingThresholdPace","runningOptions","settingIntervalsEnabled","settingIntervalsApiKey","toggleIntervalsApiKey","settingIntervalsAthleteId","settingIntervalsAutoUpload","intervalsOptions","settingDebugMode","debugControls","downloadDebugLogs","clearDebugLogs","installPwaButton","updateIntervalsUI","updateSportUI","isRunning","parsePace","paceStr","match","saveSportSettingsFromUI","sportSettings","paceSeconds","loadSportSettings","thresholdPace","isPassword","updateAutoPauseUI","unit","getAutoPauseSourceUnit","updateAutoLapUI","isDistance","applySettings","toggleMetric","metric","isVisible","el","saveSettings","updatedProfile","loadUserProfile","saveUserProfile","defaultSettings","defaultAutoPauseSettings","defaultWorkoutMetadataSettings","defaultCountdownSettings","defaultAutoLapSettings","defaultEnhancedVoiceSettings","defaultVoiceMetrics","defaultIntervalsSettings","saveSettingsToStorage","loadSettings","getSettings","profile","BluetoothDebugService","outcome","triggerInstallPrompt","state","loadActiveProfile","updateCallbacks","subscribe","callback","notifyUpdate","cb","updateState","updates","loadProfile","saveCurrentProfile","success","saveProfile","getSelectedScreen","addFieldToScreen","fieldId","size","screen","updatedScreen","addSlotToScreen","updateScreenInProfile","removeFieldFromScreen","slotId","removeSlotFromScreen","updateFieldSlot","updateSlot","updateScreenLayout","layout","screens","reorderFields","fromIndex","toIndex","slots","removed","reorderedSlots","slot","idx","getFilteredFields","fields","searchFields","categories","getAllCategories","getFieldsByCategory","CATEGORY_ICONS","createConfigUI","container","setupConfigEventListeners","renderConfigUI","renderScreenTabs","renderCurrentScreen","renderFieldPicker","tabsContainer","escapeHtml","nameEl","layoutSelect","fieldsList","a","b","field","getDataField","fieldName","fieldIcon","categoriesContainer","fieldsContainer","cat","currentScreen","usedFieldIds","s","isUsed","e","target","tab","showFieldPicker","hideFieldPicker","catBtn","category","fieldBtn","removeBtn","showNotification","resetToDefaults","searchInput","setupDragAndDrop","draggedEl","draggedIndex","item","targetItem","picker","message","type","event","text","div","initDataFieldsConfig","settingsContent","voiceFeedback","SettingsView","template","content"],"mappings":"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"}