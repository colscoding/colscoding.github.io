import{t as gt,u as mt,v as Je,w as ft,x as Ae,b as tt,y as pt,g as ht,d as vt,e as yt,f as St}from"./index-DiG7OM9t.js";import{o as M,p as B,q as Qe,s as We,g as _e,u as g,v as Se,w as be,x as Te,y as je,z as Ie,A as bt}from"./feature-bluetooth-DIdcc21I.js";import{a as It,b as Et,u as kt}from"./screens-D6jiR1Sk.js";import"./vendor-core-Dob3nYDb.js";import"./feature-export-7zlEGvkQ.js";import"./vendor-leaflet-3-yx3GaH.js";const Ge={activeSport:"cycling",running:{targetPaceMin:300,targetPaceMax:360,useRunningCadence:!0,showPace:!0},cycling:{showPower:!0}},nt="bpt-sport-settings";function Ye(){try{const e=localStorage.getItem(nt);if(e)return{...Ge,...JSON.parse(e)}}catch(e){console.warn("Failed to load sport settings:",e)}return{...Ge}}function wt(e){localStorage.setItem(nt,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("sport-settings-changed",{detail:e}))}function xt(e){if(e>=9999||e<=0)return"--:--";const n=Math.floor(e/60),o=Math.round(e%60);return`${n}:${o.toString().padStart(2,"0")}`}function Mt(e,n){let o=null;return(...c)=>{o&&clearTimeout(o),o=setTimeout(()=>{e(...c)},n)}}function Xe(e){return[{name:"Active Recovery",min:0,max:Math.round(e*.55),color:"#808080"},{name:"Endurance",min:Math.round(e*.55),max:Math.round(e*.75),color:"#2196f3"},{name:"Tempo",min:Math.round(e*.75),max:Math.round(e*.9),color:"#4caf50"},{name:"Threshold",min:Math.round(e*.9),max:Math.round(e*1.05),color:"#ffeb3b"},{name:"VO2max",min:Math.round(e*1.05),max:Math.round(e*1.2),color:"#ff9800"},{name:"Anaerobic",min:Math.round(e*1.2),max:Math.round(e*1.5),color:"#f44336"},{name:"Neuromuscular",min:Math.round(e*1.5),max:9999,color:"#9c27b0"}]}function Bt(e){return[{name:"Recovery",min:0,max:Math.round(e*.6),color:"#808080"},{name:"Endurance",min:Math.round(e*.6),max:Math.round(e*.8),color:"#2196f3"},{name:"Tempo",min:Math.round(e*.8),max:Math.round(e*.95),color:"#4caf50"},{name:"Threshold",min:Math.round(e*.95),max:Math.round(e*1.05),color:"#ff9800"},{name:"VO2max",min:Math.round(e*1.05),max:9999,color:"#f44336"}]}function Ct(e){return[{name:"Endurance",min:0,max:Math.round(e*.75),color:"#2196f3"},{name:"Threshold",min:Math.round(e*.75),max:Math.round(e*1.05),color:"#ff9800"},{name:"High Intensity",min:Math.round(e*1.05),max:9999,color:"#f44336"}]}function Lt(e,n){switch(n){case"3":return Ct(e);case"5":return Bt(e);case"7":return Xe(e);default:return Xe(e)}}function Pt(){const e=document.getElementById("saveSettings"),n=document.getElementById("settingFtp"),o=document.getElementById("settingPowerZoneModel"),c=document.getElementById("settingMaxHr"),a=document.getElementById("settingWeight"),l=document.getElementById("settingSpeed"),r=document.getElementById("settingDistance"),i=document.getElementById("settingAltitude"),u=document.getElementById("settingShowCalories"),K=document.getElementById("settingPower"),z=document.getElementById("settingCadence"),J=document.getElementById("settingHeartrate"),Q=document.getElementById("settingTreadmillSpeed"),W=document.getElementById("settingPower3s"),_=document.getElementById("settingHighContrast"),j=document.getElementById("settingColorblindPatterns"),G=document.getElementById("settingVoiceEnabled"),Y=document.getElementById("settingVoiceLaps"),X=document.getElementById("settingVoiceZones"),v=document.getElementById("settingAutoPauseEnabled"),I=document.getElementById("settingAutoPauseSource"),T=document.getElementById("settingAutoPauseThreshold"),V=document.getElementById("settingAutoPauseDelay"),ke=document.getElementById("autoPauseOptions"),De=document.getElementById("autoPauseThresholdUnit"),ee=document.getElementById("settingExportTcx"),te=document.getElementById("settingExportCsv"),ne=document.getElementById("settingExportJson"),oe=document.getElementById("settingExportFit"),ce=document.getElementById("settingPromptForNotes"),se=document.getElementById("settingPromptForExertion"),F=document.getElementById("settingCountdownDuration"),ie=document.getElementById("settingCountdownBeep"),ae=document.getElementById("settingCountdownVoice"),y=document.getElementById("settingAutoLapEnabled"),E=document.getElementById("settingAutoLapSource"),D=document.getElementById("settingAutoLapDistance"),$=document.getElementById("settingAutoLapTime"),we=document.getElementById("autoLapOptions"),$e=document.getElementById("autoLapDistanceOption"),Ue=document.getElementById("autoLapTimeOption"),k=document.getElementById("settingVoiceSelection"),U=document.getElementById("settingVoiceTimeInterval"),N=document.getElementById("settingVoiceDistanceInterval"),H=document.getElementById("settingVoiceSpeechRate"),de=document.getElementById("settingVoiceMetricPower"),re=document.getElementById("settingVoiceMetricHeartrate"),le=document.getElementById("settingVoiceMetricCadence"),S=document.getElementById("settingVoiceMetricSpeed"),ue=document.getElementById("settingVoiceMetricDistance"),ge=document.getElementById("settingVoiceMetricTime"),b=document.getElementById("settingVoiceMetricPace"),L=document.getElementById("settingVoiceTargetFeedback"),me=document.getElementById("settingVoiceTemplate"),xe=document.getElementById("settingSmartAnnouncements"),p=document.getElementById("settingSportType"),O=document.getElementById("settingShowPace"),R=document.getElementById("settingThresholdPace"),Ne=document.getElementById("runningOptions"),w=document.getElementById("settingIntervalsEnabled"),x=document.getElementById("settingIntervalsApiKey"),Me=document.getElementById("toggleIntervalsApiKey"),fe=document.getElementById("settingIntervalsAthleteId"),pe=document.getElementById("settingIntervalsAutoUpload"),He=document.getElementById("intervalsOptions"),he=document.getElementById("settingDebugMode"),Oe=document.getElementById("debugControls"),ct=document.getElementById("downloadDebugLogs"),st=document.getElementById("clearDebugLogs"),ve=document.getElementById("settingMockSensors"),it=document.getElementById("installPwaButton"),Re=()=>{He&&w&&(He.style.display=w.checked?"flex":"none")},qe=()=>{if(Ne&&p){const t=p.value==="running"||p.value==="walking";Ne.style.display=t?"block":"none"}},at=t=>{const d=t.match(/^(\d{1,2}):([0-5]\d)$/);if(!d)return null;const h=parseInt(d[1],10),f=parseInt(d[2],10);return h*60+f},dt=()=>{const t=Ye();if(p&&(t.activeSport=p.value),O!==null&&(t.running.showPace=O.checked),R?.value){const d=at(R.value);d!==null&&(t.running.targetPaceMin=d-30,t.running.targetPaceMax=d+30)}wt(t)};let Be="cycling";const rt=()=>{const t=Ye();if(p&&(p.value=t.activeSport,Be=t.activeSport),O&&(O.checked=t.running.showPace),R){const d=Math.round((t.running.targetPaceMin+t.running.targetPaceMax)/2);R.value=xt(d)}qe()};p?.addEventListener("change",qe),Me?.addEventListener("click",()=>{if(x){const t=x.type==="password";x.type=t?"text":"password",Me&&(Me.textContent=t?"üôà":"üëÅÔ∏è")}}),w?.addEventListener("change",Re);const Ce=()=>{if(ke&&v&&(ke.style.opacity=v.checked?"1":"0.5",ke.style.pointerEvents=v.checked?"auto":"none"),De&&I){const t=mt(I.value);De.textContent=t}};v?.addEventListener("change",Ce),I?.addEventListener("change",Ce);const Le=()=>{if(we&&y&&(we.style.opacity=y.checked?"1":"0.5",we.style.pointerEvents=y.checked?"auto":"none"),$e&&Ue&&E){const t=E.value==="distance";$e.style.display=t?"flex":"none",Ue.style.display=t?"none":"flex"}};y?.addEventListener("change",Le),E?.addEventListener("change",Le);const Ze=t=>{Ae.reloadVoice();const d=(f,P)=>{document.querySelectorAll(`.metric-group-${f}`).forEach(q=>{q.style.display=P?"flex":"none"})};d("speed",t.speed),d("distance",t.distance),d("altitude",t.altitude),d("energy",t.showCalories),d("power",t.power),d("cadence",t.cadence),d("heartrate",t.heartrate),d("treadmillSpeed",t.treadmillSpeed),document.querySelectorAll(".metric-group-power").forEach(f=>{t.power3s?f.setAttribute("data-show-avg","true"):f.removeAttribute("data-show-avg")}),t.highContrast?document.documentElement.setAttribute("data-high-contrast","true"):document.documentElement.removeAttribute("data-high-contrast"),t.colorblindPatterns?document.documentElement.setAttribute("data-colorblind-patterns","true"):document.documentElement.removeAttribute("data-colorblind-patterns"),Oe&&(Oe.style.display=t.debugMode?"flex":"none")},Ke=()=>({timeIntervalMinutes:U?.value?parseInt(U.value):M.timeIntervalMinutes,distanceIntervalKm:N?.value?parseInt(N.value):M.distanceIntervalKm,metrics:{power:de?.checked??B.power,heartrate:re?.checked??B.heartrate,cadence:le?.checked??B.cadence,speed:S?.checked??B.speed,distance:ue?.checked??B.distance,time:ge?.checked??B.time,pace:b?.checked??B.pace},speechRate:H?.value?parseFloat(H.value):M.speechRate,voiceURI:k?.value||M.voiceURI,workoutTargetFeedback:L?.checked??M.workoutTargetFeedback,smartAnnouncements:xe?.checked??M.smartAnnouncements,announcementTemplate:me?.value||M.announcementTemplate}),ze=t=>{U&&(U.value=t.timeIntervalMinutes.toString()),N&&(N.value=t.distanceIntervalKm.toString()),H&&(H.value=t.speechRate.toString()),de&&(de.checked=t.metrics.power),re&&(re.checked=t.metrics.heartrate),le&&(le.checked=t.metrics.cadence),S&&(S.checked=t.metrics.speed),ue&&(ue.checked=t.metrics.distance),ge&&(ge.checked=t.metrics.time),b&&(b.checked=t.metrics.pace),k&&t.voiceURI&&(k.value=t.voiceURI),L&&(L.checked=t.workoutTargetFeedback),xe&&(xe.checked=t.smartAnnouncements),me&&(me.value=t.announcementTemplate||"")},Pe=()=>{const d={...Je(),ftp:n?.value?Number(n.value):null,maxHr:c?.value?Number(c.value):null,weight:a?.value?Number(a.value):null};ft(d),window.dispatchEvent(new CustomEvent("user-profile-changed"));const h=o?.value||"7";We.setMultiple({ftp:d.ftp??200,maxHeartrate:d.maxHr??190,weight:d.weight??75,powerZoneModel:h,powerZones:Lt(100,h)});const f={speed:l?.checked??g.speed,distance:r?.checked??g.distance,altitude:i?.checked??g.altitude,weightKg:a?.value?Number(a.value):g.weightKg,showCalories:u?.checked??g.showCalories,power:K?.checked??g.power,cadence:z?.checked??g.cadence,heartrate:J?.checked??g.heartrate,treadmillSpeed:Q?.checked??g.treadmillSpeed,power3s:W?.checked??g.power3s,highContrast:_?.checked??g.highContrast,colorblindPatterns:j?.checked??g.colorblindPatterns,voiceEnabled:G?.checked??g.voiceEnabled,voiceLaps:Y?.checked??g.voiceLaps,voiceZones:X?.checked??g.voiceZones,autoPause:{enabled:v?.checked??Ie.enabled,source:I?.value??Ie.source,threshold:T?.value?Number(T.value):Ie.threshold,delay:V?.value?Number(V.value):Ie.delay},workoutMetadata:{promptForNotes:ce?.checked??je.promptForNotes,promptForExertion:se?.checked??je.promptForExertion},countdown:{duration:F?.value?parseInt(F.value):Te.duration,enableBeep:ie?.checked??Te.enableBeep,enableVoice:ae?.checked??Te.enableVoice},autoLap:{enabled:y?.checked??be.enabled,source:E?.value??be.source,distanceKm:D?.value?Number(D.value):be.distanceKm,timeMinutes:$?.value?Number($.value):be.timeMinutes},enhancedVoice:Ke(),intervals:{enabled:w?.checked??Se.enabled,apiKey:x?.value??Se.apiKey,athleteId:fe?.value??Se.athleteId,autoUpload:pe?.checked??Se.autoUpload},exportTcx:ee?.checked??g.exportTcx,exportCsv:te?.checked??g.exportCsv,exportJson:ne?.checked??g.exportJson,exportFit:oe?.checked??g.exportFit,debugMode:he?.checked??g.debugMode,mockSensors:ve?.checked??g.mockSensors,wheelCircumferenceMm:_e().wheelCircumferenceMm};window.useMockSensors=f.mockSensors,bt(f),dt(),Ze(f)},lt=()=>{const t=_e(),d=Je();n&&(n.value=d.ftp?.toString()??""),c&&(c.value=d.maxHr?.toString()??""),a&&(a.value=d.weight?.toString()??"");const h=We.getAll();if(o&&(o.value=h.powerZoneModel||"7"),K&&(K.checked=t.power),z&&(z.checked=t.cadence),J&&(J.checked=t.heartrate),l&&(l.checked=t.speed),r&&(r.checked=t.distance),i&&(i.checked=t.altitude),u&&(u.checked=t.showCalories),Q&&(Q.checked=t.treadmillSpeed),W&&(W.checked=t.power3s),_&&(_.checked=t.highContrast),j&&(j.checked=t.colorblindPatterns),G&&(G.checked=t.voiceEnabled),Y&&(Y.checked=t.voiceLaps),X&&(X.checked=t.voiceZones),k){const f=()=>{const P=Ae.getAvailableVoices();k.innerHTML='<option value="">Default System Voice</option>',P.forEach(ye=>{const q=document.createElement("option");q.value=ye.voiceURI,q.textContent=`${ye.name} (${ye.lang})`,k.appendChild(q)}),t.enhancedVoice.voiceURI&&(k.value=t.enhancedVoice.voiceURI)};f(),Ae.getAvailableVoices().length===0&&(setTimeout(f,500),setTimeout(f,2e3))}v&&(v.checked=t.autoPause.enabled),I&&(I.value=t.autoPause.source),T&&(T.value=t.autoPause.threshold.toString()),V&&(V.value=t.autoPause.delay.toString()),Ce(),ee&&(ee.checked=t.exportTcx),te&&(te.checked=t.exportCsv),ne&&(ne.checked=t.exportJson),oe&&(oe.checked=t.exportFit),ce&&(ce.checked=t.workoutMetadata.promptForNotes),se&&(se.checked=t.workoutMetadata.promptForExertion),F&&(F.value=t.countdown.duration.toString()),ie&&(ie.checked=t.countdown.enableBeep),ae&&(ae.checked=t.countdown.enableVoice),y&&(y.checked=t.autoLap.enabled),E&&(E.value=t.autoLap.source),D&&(D.value=t.autoLap.distanceKm.toString()),$&&($.value=t.autoLap.timeMinutes.toString()),Le(),ze(t.enhancedVoice),w&&(w.checked=t.intervals.enabled),x&&(x.value=t.intervals.apiKey),fe&&(fe.value=t.intervals.athleteId),pe&&(pe.checked=t.intervals.autoUpload),Re(),he&&(he.checked=t.debugMode),ve&&(ve.checked=t.mockSensors),window.useMockSensors=t.mockSensors,rt(),Ze(t)},ut=Mt(()=>Pe(),500),s=(t,d="change")=>{t&&(d==="input"?t.addEventListener("input",ut):t.addEventListener("change",()=>Pe()))};s(n,"input"),s(o),s(c,"input"),s(a,"input"),[l,r,i,u,K,z,J,Q,W].forEach(t=>s(t)),s(_),s(j),s(G),s(Y),s(X),s(v),s(I),s(T,"input"),s(V,"input"),[ee,te,ne,oe].forEach(t=>s(t)),s(ce),s(se),s(F),s(ie),s(ae),s(y),s(E),s(D),s($),s(U),s(N),s(H),[de,re,le,S,ue,ge,b,L].forEach(t=>s(t)),s(me,"input"),p&&p.addEventListener("change",()=>{const t=p.value,d=Ke(),h=localStorage.getItem("voice_presets"),f=h?JSON.parse(h):{};f[Be]=d,localStorage.setItem("voice_presets",JSON.stringify(f));const P=f[t];P?ze(P):(t==="running"||t==="walking"?(b&&(b.checked=!0),S&&(S.checked=!1)):(b&&(b.checked=!1),S&&(S.checked=!0)),L&&(L.checked=!1)),Be=t,Pe()}),s(O),s(R,"input"),s(w),s(x,"input"),s(fe,"input"),s(pe),s(he),s(ve),e&&(e.textContent="Close Settings",e.className="close-settings-btn",e.style.background="#6c757d",e.addEventListener("click",()=>{window.router?window.router.navigate("/"):window.history.back()})),ct?.addEventListener("click",()=>{Qe.exportLogs()}),st?.addEventListener("click",async()=>{confirm("Are you sure you want to clear all debug logs?")&&(await Qe.clearLogs(),alert("Logs cleared."))}),it?.addEventListener("click",async()=>{const t=await gt();t==="accepted"?console.log("PWA installation accepted"):t==="dismissed"?console.log("PWA installation dismissed"):alert("Installation is not available at this time. The app may already be installed or your browser does not support installation.")}),lt()}let m={profile:tt(),selectedScreenIndex:0,isEditing:!1,searchQuery:"",selectedCategory:"all"};const Ve=new Set;function At(e){return Ve.add(e),()=>Ve.delete(e)}function ot(){Ve.forEach(e=>e())}function A(e){m={...m,...e},ot()}function Tt(){const e=tt();A({profile:e,selectedScreenIndex:Math.min(m.selectedScreenIndex,e.screens.length-1)})}function Vt(){const e=pt(m.profile);return e&&document.dispatchEvent(new CustomEvent("data-fields-profile-changed",{detail:{profile:m.profile}})),e}function C(){return m.profile.screens[m.selectedScreenIndex]??null}function Ft(e,n="medium"){const o=C();if(!o)return;const c=It(o,e,n);Z(c)}function Dt(e){const n=C();if(!n)return;const o=Et(n,e);Z(o)}function $t(e,n){const o=C();if(!o)return;const c=kt(o,e,n);Z(c)}function Ut(e){const n=C();if(!n)return;const o={...n,layout:e};Z(o)}function Z(e){const n=[...m.profile.screens];n[m.selectedScreenIndex]=e,A({profile:{...m.profile,screens:n}})}function Nt(e,n){const o=C();if(!o)return;const c=[...o.slots],[a]=c.splice(e,1);c.splice(n,0,a);const l=c.map((r,i)=>({...r,position:i}));Z({...o,slots:l})}function Ht(){let e;if(m.searchQuery.trim())e=vt(m.searchQuery);else if(m.selectedCategory==="all"){const n=yt();e=Array.from(n.values()).flat()}else e=St(m.selectedCategory);return e}const Ot={all:"üìä",power:"‚ö°",heartrate:"‚ù§Ô∏è",cadence:"üîÑ",speed:"üö¥",distance:"üìç",elevation:"‚õ∞Ô∏è",time:"‚è±Ô∏è",laps:"üèÅ",energy:"üî•",environment:"üå°Ô∏è",device:"üîã",charts:"üìà",map:"üó∫Ô∏è"};function Rt(e){e.innerHTML=`
        <div class="data-fields-config">
            <div class="dfc-header">
                <h3>üìä Data Fields</h3>
                <p class="dfc-help-text">Configure which metrics appear on your dashboard screens.</p>
            </div>
            
            <div class="dfc-screens">
                <div class="dfc-screens-tabs" role="tablist"></div>
            </div>
            
            <div class="dfc-current-screen">
                <div class="dfc-screen-header">
                    <span class="dfc-screen-name"></span>
                    <select class="dfc-layout-select" aria-label="Screen layout">
                        <option value="auto">Auto Layout</option>
                        <option value="grid-2">2 Columns</option>
                        <option value="grid-3">3 Columns</option>
                        <option value="grid-4">4 Columns</option>
                        <option value="list">List</option>
                    </select>
                </div>
                <div class="dfc-fields-list" role="list" aria-label="Current screen fields"></div>
                <button class="dfc-add-field-btn" type="button">
                    <span>+</span> Add Field
                </button>
            </div>
            
            <div class="dfc-field-picker" style="display: none;">
                <div class="dfc-picker-header">
                    <h4>Select a Field</h4>
                    <button class="dfc-picker-close" type="button" aria-label="Close field picker">&times;</button>
                </div>
                <input type="search" class="dfc-search" placeholder="Search fields..." aria-label="Search data fields">
                <div class="dfc-categories" role="tablist"></div>
                <div class="dfc-available-fields" role="listbox" aria-label="Available fields"></div>
            </div>
            
            <div class="dfc-actions">
                <button class="dfc-save-btn" type="button">Save Changes</button>
                <button class="dfc-reset-btn" type="button">Reset to Defaults</button>
            </div>
        </div>
    `,zt(e),et(e),At(()=>et(e))}function et(e){qt(e),Zt(e),Kt(e)}function qt(e){const n=e.querySelector(".dfc-screens-tabs");n&&(n.innerHTML=m.profile.screens.map((o,c)=>`
            <button 
                class="dfc-screen-tab ${c===m.selectedScreenIndex?"dfc-screen-tab--active":""}"
                data-screen-index="${c}"
                role="tab"
                aria-selected="${c===m.selectedScreenIndex}"
                aria-label="${o.name} screen"
            >
                <span class="dfc-tab-icon">${o.icon}</span>
                <span class="dfc-tab-name">${Ee(o.name)}</span>
            </button>
        `).join(""))}function Zt(e){const n=C(),o=e.querySelector(".dfc-screen-name"),c=e.querySelector(".dfc-layout-select"),a=e.querySelector(".dfc-fields-list");if(!(!n||!o||!a||!c)){if(o.textContent=`${n.icon} ${n.name}`,c.value=n.layout,n.slots.length===0){a.innerHTML=`
            <div class="dfc-empty-screen">
                <p>No fields on this screen</p>
                <p class="dfc-empty-hint">Click "Add Field" to add metrics</p>
            </div>
        `;return}a.innerHTML=n.slots.sort((l,r)=>l.position-r.position).map(l=>{const r=ht(l.fieldId),i=r?.name??"Unknown",u=r?.icon??"‚ùì";return`
                <div class="dfc-field-item" data-slot-id="${l.id}" role="listitem" draggable="true">
                    <span class="dfc-field-drag" title="Drag to reorder">‚ãÆ‚ãÆ</span>
                    <span class="dfc-field-icon">${u}</span>
                    <div class="dfc-field-info">
                        <span class="dfc-field-name">${Ee(i)}</span>
                        <span class="dfc-field-id">${l.fieldId}</span>
                    </div>
                    <select class="dfc-field-size" data-slot-id="${l.id}" aria-label="Field size">
                        <option value="small" ${l.size==="small"?"selected":""}>Small</option>
                        <option value="medium" ${l.size==="medium"?"selected":""}>Medium</option>
                        <option value="large" ${l.size==="large"?"selected":""}>Large</option>
                    </select>
                    <button class="dfc-field-remove" data-slot-id="${l.id}" aria-label="Remove ${i}" title="Remove">
                        üóëÔ∏è
                    </button>
                </div>
            `}).join("")}}function Kt(e){const n=e.querySelector(".dfc-categories"),o=e.querySelector(".dfc-available-fields");if(!n||!o)return;const c=["all","power","heartrate","cadence","speed","distance","elevation","time"];n.innerHTML=c.map(i=>`
            <button 
                class="dfc-category-btn ${i===m.selectedCategory?"dfc-category-btn--active":""}"
                data-category="${i}"
                role="tab"
                aria-selected="${i===m.selectedCategory}"
            >
                <span>${Ot[i]}</span>
                <span>${i==="all"?"All":i.charAt(0).toUpperCase()+i.slice(1)}</span>
            </button>
        `).join("");const a=Ht(),l=C(),r=new Set(l?.slots.map(i=>i.fieldId)??[]);o.innerHTML=a.map(i=>{const u=r.has(i.id);return`
                <button 
                    class="dfc-available-field ${u?"dfc-available-field--used":""}"
                    data-field-id="${i.id}"
                    role="option"
                    aria-selected="false"
                    ${u?"disabled":""}
                >
                    <span class="dfc-af-icon">${i.icon}</span>
                    <div class="dfc-af-info">
                        <span class="dfc-af-name">${Ee(i.name)}</span>
                        <span class="dfc-af-desc">${Ee(i.description)}</span>
                    </div>
                    ${u?'<span class="dfc-af-badge">Added</span>':""}
                </button>
            `}).join("")}function zt(e){e.addEventListener("click",o=>{const c=o.target,a=c.closest(".dfc-screen-tab");if(a){const u=parseInt(a.dataset.screenIndex??"0",10);A({selectedScreenIndex:u});return}if(c.closest(".dfc-add-field-btn")){Qt(e);return}if(c.closest(".dfc-picker-close")){Wt(e);return}const l=c.closest(".dfc-category-btn");if(l){const u=l.dataset.category;A({selectedCategory:u});return}const r=c.closest(".dfc-available-field");if(r&&!r.hasAttribute("disabled")){const u=r.dataset.fieldId;u&&(Ft(u),ot());return}const i=c.closest(".dfc-field-remove");if(i){const u=i.dataset.slotId;u&&Dt(u);return}if(c.closest(".dfc-save-btn")){Vt()?Fe("Settings saved!","success"):Fe("Failed to save settings","error");return}if(c.closest(".dfc-reset-btn")){confirm("Reset data fields to defaults? This cannot be undone.")&&_t();return}}),e.addEventListener("change",o=>{const c=o.target;if(c.classList.contains("dfc-layout-select")){Ut(c.value);return}if(c.classList.contains("dfc-field-size")){const a=c.dataset.slotId;a&&$t(a,{size:c.value});return}});const n=e.querySelector(".dfc-search");n&&n.addEventListener("input",o=>{const c=o.target;A({searchQuery:c.value})}),Jt(e)}function Jt(e){const n=e.querySelector(".dfc-fields-list");if(!n)return;let o=null,c=-1;n.addEventListener("dragstart",a=>{o=a.target.closest(".dfc-field-item"),o&&(c=Array.from(n.children).indexOf(o),o.classList.add("dfc-field-item--dragging"))}),n.addEventListener("dragend",()=>{o&&o.classList.remove("dfc-field-item--dragging"),o=null,c=-1}),n.addEventListener("dragover",a=>{a.preventDefault();const r=a.target.closest(".dfc-field-item");r&&r!==o&&Array.from(n.querySelectorAll(".dfc-field-item:not(.dfc-field-item--dragging)")).indexOf(r)!==-1&&r.classList.add("dfc-field-item--drag-over")}),n.addEventListener("dragleave",a=>{const r=a.target.closest(".dfc-field-item");r&&r.classList.remove("dfc-field-item--drag-over")}),n.addEventListener("drop",a=>{a.preventDefault();const r=a.target.closest(".dfc-field-item");if(n.querySelectorAll(".dfc-field-item--drag-over").forEach(i=>{i.classList.remove("dfc-field-item--drag-over")}),r&&o&&r!==o){const u=Array.from(n.querySelectorAll(".dfc-field-item")).indexOf(r);c!==-1&&u!==-1&&c!==u&&Nt(c,u)}})}function Qt(e){const n=e.querySelector(".dfc-field-picker");if(n){n.style.display="block";const o=n.querySelector(".dfc-search");o&&o.focus()}}function Wt(e){const n=e.querySelector(".dfc-field-picker");n&&(n.style.display="none",A({searchQuery:"",selectedCategory:"all"}))}function _t(){localStorage.removeItem("bpt-data-fields"),Tt(),Fe("Data fields reset to defaults","info")}function Fe(e,n){const o=new CustomEvent("show-notification",{detail:{message:e,type:n}});document.dispatchEvent(o),console.log(`[DataFieldsConfig] ${n}: ${e}`)}function Ee(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}function jt(){const e=document.querySelector("#page-settings .page-content");if(!e){console.warn("[DataFieldsConfig] Settings page content not found");return}if(e.querySelector(".data-fields-config"))return;const n=document.createElement("fieldset");n.className="settings-fieldset",n.style.cssText="border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;",n.innerHTML='<legend style="font-weight: 600; padding: 0 8px;">üìä Data Fields Configuration</legend>';const o=e.querySelector("fieldset:nth-child(4)");o&&o.nextSibling?e.insertBefore(n,o.nextSibling):e.appendChild(n),Rt(n),console.log("[DataFieldsConfig] Initialized")}class on{id="settings";init(n){const o=document.getElementById("settingsTemplate");if(o){const c=o.content.cloneNode(!0);n.appendChild(c),setTimeout(()=>{Pt(),jt()},0)}else console.error("Settings template not found!"),n.innerHTML="<p>Error loading settings view</p>"}onEnter(){console.log("Entered Settings View")}onLeave(){console.log("Left Settings View")}}export{on as SettingsView};
//# sourceMappingURL=SettingsView-BA0jFgbO.js.map
