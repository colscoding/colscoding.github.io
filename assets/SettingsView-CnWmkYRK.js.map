{"version":3,"file":"SettingsView-CnWmkYRK.js","sources":["../../src/utils/debounce.ts","../../src/utils/zone-utils.ts","../../src/ui/settings.ts","../../src/ui/dataFieldsConfig.ts","../../src/views/SettingsView.ts"],"sourcesContent":["/**\n * Creates a debounced function that delays invoking func until after wait milliseconds have elapsed\n * since the last time the debounced function was invoked.\n *\n * @param func The function to debounce\n * @param wait The number of milliseconds to delay\n * @returns Debounced function\n */\nexport function debounce<T extends (...args: any[]) => void>(func: T, wait: number): (...args: Parameters<T>) => void {\n    let timeout: ReturnType<typeof setTimeout> | null = null;\n    return (...args: Parameters<T>) => {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n        timeout = setTimeout(() => {\n            func(...args);\n        }, wait);\n    };\n}\n","import { ZoneDefinition, PowerZoneModel } from '../types/zones.js';\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nexport function calculatePowerZones7(ftp: number): ZoneDefinition[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55), color: '#808080' },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75), color: '#2196f3' },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.9), color: '#4caf50' },\n        { name: 'Threshold', min: Math.round(ftp * 0.9), max: Math.round(ftp * 1.05), color: '#ffeb3b' },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.2), color: '#ff9800' },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.2), max: Math.round(ftp * 1.5), color: '#f44336' },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.5), max: 9999, color: '#9c27b0' },\n    ];\n}\n\n/**\n * Calculate power zones based on FTP (5-zone model)\n * Typical Z1-Z5 model\n */\nexport function calculatePowerZones5(ftp: number): ZoneDefinition[] {\n    return [\n        { name: 'Recovery', min: 0, max: Math.round(ftp * 0.6), color: '#808080' },\n        { name: 'Endurance', min: Math.round(ftp * 0.6), max: Math.round(ftp * 0.8), color: '#2196f3' },\n        { name: 'Tempo', min: Math.round(ftp * 0.8), max: Math.round(ftp * 0.95), color: '#4caf50' },\n        { name: 'Threshold', min: Math.round(ftp * 0.95), max: Math.round(ftp * 1.05), color: '#ff9800' },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: 9999, color: '#f44336' },\n    ];\n}\n\n/**\n * Calculate power zones based on FTP (3-zone model)\n * Polarized (Zone 1, 2, 3)\n */\nexport function calculatePowerZones3(ftp: number): ZoneDefinition[] {\n    return [\n        { name: 'Endurance', min: 0, max: Math.round(ftp * 0.75), color: '#2196f3' }, // < AeT approx\n        { name: 'Threshold', min: Math.round(ftp * 0.75), max: Math.round(ftp * 1.05), color: '#ff9800' }, // Sweet spot / Threshold\n        { name: 'High Intensity', min: Math.round(ftp * 1.05), max: 9999, color: '#f44336' }, // > FTP\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nexport function calculateHrZones(maxHr: number): ZoneDefinition[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.5), max: Math.round(maxHr * 0.6), color: '#808080' },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.6), max: Math.round(maxHr * 0.7), color: '#2196f3' },\n        { name: 'Tempo', min: Math.round(maxHr * 0.7), max: Math.round(maxHr * 0.8), color: '#4caf50' },\n        { name: 'Threshold', min: Math.round(maxHr * 0.8), max: Math.round(maxHr * 0.9), color: '#ff9800' },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.9), max: maxHr, color: '#f44336' },\n    ];\n}\n\nexport function generatePowerZones(ftp: number, model: PowerZoneModel): ZoneDefinition[] {\n    switch (model) {\n        case '3':\n            return calculatePowerZones3(ftp);\n        case '5':\n            return calculatePowerZones5(ftp);\n        case '7':\n            return calculatePowerZones7(ftp);\n        default:\n            return calculatePowerZones7(ftp);\n    }\n}\n","/**\n * Settings Modal\n *\n * Manages application settings stored in localStorage.\n *\n * @module settings\n */\n\nimport { loadUserProfile, saveUserProfile } from './onboarding.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport {\n    getSettings,\n    saveSettingsToStorage,\n    defaultSettings,\n    defaultAutoPauseSettings,\n    defaultWorkoutMetadataSettings,\n    defaultCountdownSettings,\n    defaultAutoLapSettings,\n    defaultEnhancedVoiceSettings,\n    defaultVoiceMetrics,\n    defaultIntervalsSettings,\n    defaultMusicSettings,\n} from '../config/settings.js';\nimport type { AppSettings, AutoPauseSource, AutoLapSource, EnhancedVoiceSettings } from '../config/settings.js';\nimport { triggerInstallPrompt } from './installPrompt.js';\nimport { getAutoPauseSourceUnit } from '../services/AutoPauseService.js';\nimport { getSportSettings, saveSportSettings, formatPace } from '../config/sport.js';\nimport type { SportType } from '../config/sport.js';\nimport { debounce } from '../utils/debounce.js';\nimport { settingsStore } from '../state/SettingsStore.js';\nimport { generatePowerZones } from '../utils/zone-utils.js';\nimport type { PowerZoneModel } from '../types/zones.js';\nimport { featureFlagService } from '../services/FeatureFlagService.js';\n\n// Re-export for compatibility if needed (but prefer importing from config)\nexport { getSettings };\n\n/**\n * Initialize the Settings UI logic\n */\nexport function initSettingsLogic(): void {\n    const saveSettingsButton = document.getElementById('saveSettings');\n\n    // User Profile settings\n    const settingFtp = document.getElementById('settingFtp') as HTMLInputElement | null;\n    const settingPowerZoneModel = document.getElementById('settingPowerZoneModel') as HTMLSelectElement | null;\n    const settingMaxHr = document.getElementById('settingMaxHr') as HTMLInputElement | null;\n    const settingWeight = document.getElementById('settingWeight') as HTMLInputElement | null;\n\n    /**\n     * Validate numeric input and provide visual feedback\n     */\n    const validateNumericInput = (input: HTMLInputElement, min: number, max: number): boolean => {\n        const value = Number(input.value);\n        if (!input.value || isNaN(value) || value < min || value > max) {\n            input.style.borderColor = '#dc3545';\n            input.setAttribute('aria-invalid', 'true');\n            return false;\n        }\n        input.style.borderColor = '#28a745';\n        input.setAttribute('aria-invalid', 'false');\n        return true;\n    };\n\n    /**\n     * Clear validation styling\n     */\n    const clearValidation = (input: HTMLInputElement): void => {\n        input.style.borderColor = '';\n        input.removeAttribute('aria-invalid');\n    };\n\n    // Dashboard display settings\n    const settingSpeed = document.getElementById('settingSpeed') as HTMLInputElement | null;\n    const settingDistance = document.getElementById('settingDistance') as HTMLInputElement | null;\n    const settingAltitude = document.getElementById('settingAltitude') as HTMLInputElement | null;\n    const settingShowCalories = document.getElementById('settingShowCalories') as HTMLInputElement | null;\n    const settingPower = document.getElementById('settingPower') as HTMLInputElement | null;\n    const settingCadence = document.getElementById('settingCadence') as HTMLInputElement | null;\n    const settingHeartrate = document.getElementById('settingHeartrate') as HTMLInputElement | null;\n    const settingTreadmillSpeed = document.getElementById('settingTreadmillSpeed') as HTMLInputElement | null;\n    const settingPower3s = document.getElementById('settingPower3s') as HTMLInputElement | null;\n\n    // Accessibility settings\n    const settingHighContrast = document.getElementById('settingHighContrast') as HTMLInputElement | null;\n    const settingColorblindPatterns = document.getElementById('settingColorblindPatterns') as HTMLInputElement | null;\n\n    // Voice Feedback settings\n    const settingVoiceEnabled = document.getElementById('settingVoiceEnabled') as HTMLInputElement | null;\n    const settingVoiceLaps = document.getElementById('settingVoiceLaps') as HTMLInputElement | null;\n    const settingVoiceZones = document.getElementById('settingVoiceZones') as HTMLInputElement | null;\n\n    // Auto-Pause settings\n    const settingAutoPauseEnabled = document.getElementById('settingAutoPauseEnabled') as HTMLInputElement | null;\n    const settingAutoPauseSource = document.getElementById('settingAutoPauseSource') as HTMLSelectElement | null;\n    const settingAutoPauseThreshold = document.getElementById('settingAutoPauseThreshold') as HTMLInputElement | null;\n    const settingAutoPauseDelay = document.getElementById('settingAutoPauseDelay') as HTMLInputElement | null;\n    const autoPauseOptions = document.getElementById('autoPauseOptions');\n    const autoPauseThresholdUnit = document.getElementById('autoPauseThresholdUnit');\n\n    // Export format settings\n    const settingExportTcx = document.getElementById('settingExportTcx') as HTMLInputElement | null;\n    const settingExportCsv = document.getElementById('settingExportCsv') as HTMLInputElement | null;\n    const settingExportJson = document.getElementById('settingExportJson') as HTMLInputElement | null;\n    const settingExportFit = document.getElementById('settingExportFit') as HTMLInputElement | null;\n\n    // Workout metadata settings\n    const settingPromptForNotes = document.getElementById('settingPromptForNotes') as HTMLInputElement | null;\n    const settingPromptForExertion = document.getElementById('settingPromptForExertion') as HTMLInputElement | null;\n\n    // Countdown settings\n    const settingCountdownDuration = document.getElementById('settingCountdownDuration') as HTMLSelectElement | null;\n    const settingCountdownBeep = document.getElementById('settingCountdownBeep') as HTMLInputElement | null;\n    const settingCountdownVoice = document.getElementById('settingCountdownVoice') as HTMLInputElement | null;\n\n    // Auto-Lap settings\n    const settingAutoLapEnabled = document.getElementById('settingAutoLapEnabled') as HTMLInputElement | null;\n    const settingAutoLapSource = document.getElementById('settingAutoLapSource') as HTMLSelectElement | null;\n    const settingAutoLapDistance = document.getElementById('settingAutoLapDistance') as HTMLSelectElement | null;\n    const settingAutoLapTime = document.getElementById('settingAutoLapTime') as HTMLSelectElement | null;\n    const autoLapOptions = document.getElementById('autoLapOptions');\n    const autoLapDistanceOption = document.getElementById('autoLapDistanceOption');\n    const autoLapTimeOption = document.getElementById('autoLapTimeOption');\n\n    // Enhanced Voice settings\n    const settingVoiceSelection = document.getElementById('settingVoiceSelection') as HTMLSelectElement | null;\n    const settingVoiceTimeInterval = document.getElementById('settingVoiceTimeInterval') as HTMLSelectElement | null;\n    const settingVoiceDistanceInterval = document.getElementById(\n        'settingVoiceDistanceInterval'\n    ) as HTMLSelectElement | null;\n    const settingVoiceSpeechRate = document.getElementById('settingVoiceSpeechRate') as HTMLSelectElement | null;\n    const settingVoiceMetricPower = document.getElementById('settingVoiceMetricPower') as HTMLInputElement | null;\n    const settingVoiceMetricHeartrate = document.getElementById(\n        'settingVoiceMetricHeartrate'\n    ) as HTMLInputElement | null;\n    const settingVoiceMetricCadence = document.getElementById('settingVoiceMetricCadence') as HTMLInputElement | null;\n    const settingVoiceMetricSpeed = document.getElementById('settingVoiceMetricSpeed') as HTMLInputElement | null;\n    const settingVoiceMetricDistance = document.getElementById('settingVoiceMetricDistance') as HTMLInputElement | null;\n    const settingVoiceMetricTime = document.getElementById('settingVoiceMetricTime') as HTMLInputElement | null;\n    const settingVoiceMetricPace = document.getElementById('settingVoiceMetricPace') as HTMLInputElement | null;\n    const settingVoiceTargetFeedback = document.getElementById('settingVoiceTargetFeedback') as HTMLInputElement | null;\n    const settingVoiceTemplate = document.getElementById('settingVoiceTemplate') as HTMLTextAreaElement | null;\n    const settingSmartAnnouncements = document.getElementById('settingSmartAnnouncements') as HTMLInputElement | null;\n\n    // Sport Type settings\n    const settingSportType = document.getElementById('settingSportType') as HTMLSelectElement | null;\n    const settingShowPace = document.getElementById('settingShowPace') as HTMLInputElement | null;\n    const settingThresholdPace = document.getElementById('settingThresholdPace') as HTMLInputElement | null;\n    const runningOptions = document.getElementById('runningOptions');\n\n    // Intervals.icu settings\n    const settingIntervalsEnabled = document.getElementById('settingIntervalsEnabled') as HTMLInputElement | null;\n    const settingIntervalsApiKey = document.getElementById('settingIntervalsApiKey') as HTMLInputElement | null;\n    const toggleIntervalsApiKey = document.getElementById('toggleIntervalsApiKey') as HTMLButtonElement | null;\n    const settingIntervalsAthleteId = document.getElementById('settingIntervalsAthleteId') as HTMLInputElement | null;\n    const settingIntervalsAutoUpload = document.getElementById('settingIntervalsAutoUpload') as HTMLInputElement | null;\n    const intervalsOptions = document.getElementById('intervalsOptions');\n\n    // Music Generation settings\n    const settingMusicEnabled = document.getElementById('settingMusicEnabled') as HTMLInputElement | null;\n    const settingMusicVolume = document.getElementById('settingMusicVolume') as HTMLInputElement | null;\n    const musicVolumeValue = document.getElementById('musicVolumeValue');\n    const settingMusicStyle = document.getElementById('settingMusicStyle') as HTMLSelectElement | null;\n    const settingMusicTempoSync = document.getElementById('settingMusicTempoSync') as HTMLSelectElement | null;\n    const settingMusicFixedBPM = document.getElementById('settingMusicFixedBPM') as HTMLInputElement | null;\n    const settingMusicIntensityMapping = document.getElementById('settingMusicIntensityMapping') as HTMLSelectElement | null;\n    const settingMusicTransitionSpeed = document.getElementById('settingMusicTransitionSpeed') as HTMLSelectElement | null;\n    const settingMusicDucking = document.getElementById('settingMusicDucking') as HTMLInputElement | null;\n    const settingMusicDuckingLevel = document.getElementById('settingMusicDuckingLevel') as HTMLInputElement | null;\n    const musicDuckingLevelValue = document.getElementById('musicDuckingLevelValue');\n    const musicOptions = document.getElementById('musicOptions');\n    const fixedBpmOption = document.getElementById('fixedBpmOption');\n    const duckingLevelOption = document.getElementById('duckingLevelOption');\n\n    // Debug settings\n    const settingDebugMode = document.getElementById('settingDebugMode') as HTMLInputElement | null;\n    const debugControls = document.getElementById('debugControls');\n    const downloadDebugLogs = document.getElementById('downloadDebugLogs');\n    const clearDebugLogs = document.getElementById('clearDebugLogs');\n\n    // Mock sensors setting\n    const settingMockSensors = document.getElementById('settingMockSensors') as HTMLInputElement | null;\n\n    // PWA Install button\n    const installPwaButton = document.getElementById('installPwaButton');\n\n    /**\n     * Update Intervals UI visibility\n     */\n    const updateIntervalsUI = (): void => {\n        if (intervalsOptions && settingIntervalsEnabled) {\n            intervalsOptions.style.display = settingIntervalsEnabled.checked ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Update Music UI visibility\n     */\n    const updateMusicUI = (): void => {\n        if (musicOptions && settingMusicEnabled) {\n            musicOptions.style.display = settingMusicEnabled.checked ? 'flex' : 'none';\n        }\n        if (fixedBpmOption && settingMusicTempoSync) {\n            fixedBpmOption.style.display = settingMusicTempoSync.value === 'fixed' ? 'flex' : 'none';\n        }\n        if (duckingLevelOption && settingMusicDucking) {\n            duckingLevelOption.style.display = settingMusicDucking.checked ? 'flex' : 'none';\n        }\n    };\n\n    /**\n     * Update music volume display\n     */\n    const updateMusicVolumeDisplay = (): void => {\n        if (musicVolumeValue && settingMusicVolume) {\n            musicVolumeValue.textContent = `${settingMusicVolume.value}%`;\n        }\n    };\n\n    /**\n     * Update music ducking level display\n     */\n    const updateMusicDuckingLevelDisplay = (): void => {\n        if (musicDuckingLevelValue && settingMusicDuckingLevel) {\n            musicDuckingLevelValue.textContent = `${settingMusicDuckingLevel.value}%`;\n        }\n    };\n\n    /**\n     * Update sport type UI visibility (show running options when running/walking selected)\n     */\n    const updateSportUI = (): void => {\n        if (runningOptions && settingSportType) {\n            const isRunning = settingSportType.value === 'running' || settingSportType.value === 'walking';\n            runningOptions.style.display = isRunning ? 'block' : 'none';\n        }\n    };\n\n    /**\n     * Parse pace string (MM:SS) to seconds per km\n     */\n    const parsePace = (paceStr: string): number | null => {\n        const match = paceStr.match(/^(\\d{1,2}):([0-5]\\d)$/);\n        if (!match) return null;\n        const minutes = parseInt(match[1], 10);\n        const seconds = parseInt(match[2], 10);\n        return minutes * 60 + seconds;\n    };\n\n    /**\n     * Save sport settings\n     */\n    const saveSportSettingsFromUI = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            sportSettings.activeSport = settingSportType.value as SportType;\n        }\n        if (settingShowPace !== null) {\n            sportSettings.running.showPace = settingShowPace.checked;\n        }\n        if (settingThresholdPace?.value) {\n            const paceSeconds = parsePace(settingThresholdPace.value);\n            if (paceSeconds !== null) {\n                // Store threshold pace as target pace range (Â±30 sec)\n                sportSettings.running.targetPaceMin = paceSeconds - 30;\n                sportSettings.running.targetPaceMax = paceSeconds + 30;\n            }\n        }\n\n        saveSportSettings(sportSettings);\n    };\n\n    let lastActiveSport = 'cycling';\n\n    /**\n     * Load sport settings into UI\n     */\n    const loadSportSettings = (): void => {\n        const sportSettings = getSportSettings();\n\n        if (settingSportType) {\n            settingSportType.value = sportSettings.activeSport;\n            lastActiveSport = sportSettings.activeSport;\n        }\n        if (settingShowPace) {\n            settingShowPace.checked = sportSettings.running.showPace;\n        }\n        if (settingThresholdPace) {\n            // Calculate threshold pace from target pace (middle of range)\n            const thresholdPace = Math.round(\n                (sportSettings.running.targetPaceMin + sportSettings.running.targetPaceMax) / 2\n            );\n            settingThresholdPace.value = formatPace(thresholdPace);\n        }\n\n        updateSportUI();\n    };\n\n    /**\n     * Handle Sport Type Change\n     */\n    settingSportType?.addEventListener('change', () => {\n        updateSportUI();\n        const newSport = settingSportType?.value;\n\n        // Auto-configure Auto Lap defaults based on sport\n        if (settingAutoLapDistance) {\n            if (newSport === 'running' || newSport === 'walking') {\n                // Suggest 1km for running if it was set to something else (e.g. 5km)\n                // But valid options are strings in UI, ensure we select \"1\"\n                if (settingAutoLapDistance.value === '5' || settingAutoLapDistance.value === '10') {\n                    settingAutoLapDistance.value = '1';\n                    // We should verify if we want to also ENABLE it if it was disabled?\n                    // For now just switching the distance preference is safer.\n                }\n            } else if (newSport === 'cycling') {\n                // Return to 5km for cycling if it was 1km?\n                // Or leave user preference. \"Default 1km for running\" implies changing TO running sets it to 1.\n                if (settingAutoLapDistance.value === '1' || settingAutoLapDistance.value === '0.4') {\n                    settingAutoLapDistance.value = '5';\n                }\n            }\n        }\n    });\n\n    /**\n     * Toggle API Key visibility\n     */\n    toggleIntervalsApiKey?.addEventListener('click', () => {\n        if (settingIntervalsApiKey) {\n            const isPassword = settingIntervalsApiKey.type === 'password';\n            settingIntervalsApiKey.type = isPassword ? 'text' : 'password';\n            if (toggleIntervalsApiKey) {\n                toggleIntervalsApiKey.textContent = isPassword ? 'ðŸ™ˆ' : 'ðŸ‘ï¸';\n            }\n        }\n    });\n\n    settingIntervalsEnabled?.addEventListener('change', updateIntervalsUI);\n\n    /**\n     * Update auto-pause options visibility and unit label\n     */\n    const updateAutoPauseUI = (): void => {\n        if (autoPauseOptions && settingAutoPauseEnabled) {\n            autoPauseOptions.style.opacity = settingAutoPauseEnabled.checked ? '1' : '0.5';\n            autoPauseOptions.style.pointerEvents = settingAutoPauseEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoPauseThresholdUnit && settingAutoPauseSource) {\n            const unit = getAutoPauseSourceUnit(settingAutoPauseSource.value as AutoPauseSource);\n            autoPauseThresholdUnit.textContent = unit;\n        }\n    };\n\n    // Add event listeners for auto-pause UI updates\n    settingAutoPauseEnabled?.addEventListener('change', updateAutoPauseUI);\n    settingAutoPauseSource?.addEventListener('change', updateAutoPauseUI);\n\n    /**\n     * Update auto-lap options visibility and source options\n     */\n    const updateAutoLapUI = (): void => {\n        if (autoLapOptions && settingAutoLapEnabled) {\n            autoLapOptions.style.opacity = settingAutoLapEnabled.checked ? '1' : '0.5';\n            autoLapOptions.style.pointerEvents = settingAutoLapEnabled.checked ? 'auto' : 'none';\n        }\n        if (autoLapDistanceOption && autoLapTimeOption && settingAutoLapSource) {\n            const isDistance = settingAutoLapSource.value === 'distance';\n            autoLapDistanceOption.style.display = isDistance ? 'flex' : 'none';\n            autoLapTimeOption.style.display = isDistance ? 'none' : 'flex';\n        }\n    };\n\n    // Add event listeners for auto-lap UI updates\n    settingAutoLapEnabled?.addEventListener('change', updateAutoLapUI);\n    settingAutoLapSource?.addEventListener('change', updateAutoLapUI);\n\n    /**\n     * Apply settings to the UI\n     */\n    const applySettings = (settings: AppSettings): void => {\n        // Reload voice settings\n        voiceFeedback.reloadVoice();\n\n        // Toggle metric visibility\n        const toggleMetric = (metric: string, isVisible: boolean): void => {\n            const elements = document.querySelectorAll(`.metric-group-${metric}`);\n            elements.forEach((el) => {\n                (el as HTMLElement).style.display = isVisible ? 'flex' : 'none';\n            });\n        };\n\n        toggleMetric('speed', settings.speed);\n        toggleMetric('distance', settings.distance);\n        toggleMetric('altitude', settings.altitude);\n        toggleMetric('energy', settings.showCalories);\n        toggleMetric('power', settings.power);\n        toggleMetric('cadence', settings.cadence);\n        toggleMetric('heartrate', settings.heartrate);\n        toggleMetric('treadmillSpeed', settings.treadmillSpeed);\n\n        // Apply 3-second average power indicator\n        const powerMetrics = document.querySelectorAll('.metric-group-power');\n        powerMetrics.forEach((el) => {\n            if (settings.power3s) {\n                el.setAttribute('data-show-avg', 'true');\n            } else {\n                el.removeAttribute('data-show-avg');\n            }\n        });\n\n        // Apply high contrast mode\n        if (settings.highContrast) {\n            document.documentElement.setAttribute('data-high-contrast', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-high-contrast');\n        }\n\n        // Apply colorblind patterns (enabled when high contrast + colorblind patterns both on)\n        if (settings.colorblindPatterns) {\n            document.documentElement.setAttribute('data-colorblind-patterns', 'true');\n        } else {\n            document.documentElement.removeAttribute('data-colorblind-patterns');\n        }\n\n        // Apply debug mode UI\n        if (debugControls) {\n            debugControls.style.display = settings.debugMode ? 'flex' : 'none';\n        }\n    };\n\n    const readVoiceSettingsFromUI = (): EnhancedVoiceSettings => ({\n        timeIntervalMinutes: (settingVoiceTimeInterval?.value\n            ? parseInt(settingVoiceTimeInterval.value)\n            : defaultEnhancedVoiceSettings.timeIntervalMinutes) as 0 | 1 | 5 | 10 | 15 | 30,\n        distanceIntervalKm: (settingVoiceDistanceInterval?.value\n            ? parseInt(settingVoiceDistanceInterval.value)\n            : defaultEnhancedVoiceSettings.distanceIntervalKm) as 0 | 1 | 5 | 10,\n        metrics: {\n            power: settingVoiceMetricPower?.checked ?? defaultVoiceMetrics.power,\n            heartrate: settingVoiceMetricHeartrate?.checked ?? defaultVoiceMetrics.heartrate,\n            cadence: settingVoiceMetricCadence?.checked ?? defaultVoiceMetrics.cadence,\n            speed: settingVoiceMetricSpeed?.checked ?? defaultVoiceMetrics.speed,\n            distance: settingVoiceMetricDistance?.checked ?? defaultVoiceMetrics.distance,\n            time: settingVoiceMetricTime?.checked ?? defaultVoiceMetrics.time,\n            pace: settingVoiceMetricPace?.checked ?? defaultVoiceMetrics.pace,\n        },\n        speechRate: (settingVoiceSpeechRate?.value\n            ? parseFloat(settingVoiceSpeechRate.value)\n            : defaultEnhancedVoiceSettings.speechRate) as 0.5 | 0.75 | 1 | 1.25 | 1.5 | 2,\n        voiceURI: settingVoiceSelection?.value || defaultEnhancedVoiceSettings.voiceURI,\n        workoutTargetFeedback:\n            settingVoiceTargetFeedback?.checked ?? defaultEnhancedVoiceSettings.workoutTargetFeedback,\n        smartAnnouncements: settingSmartAnnouncements?.checked ?? defaultEnhancedVoiceSettings.smartAnnouncements,\n        announcementTemplate: settingVoiceTemplate?.value || defaultEnhancedVoiceSettings.announcementTemplate,\n    });\n\n    const loadVoiceSettingsToUI = (settings: EnhancedVoiceSettings): void => {\n        if (settingVoiceTimeInterval) settingVoiceTimeInterval.value = settings.timeIntervalMinutes.toString();\n        if (settingVoiceDistanceInterval) settingVoiceDistanceInterval.value = settings.distanceIntervalKm.toString();\n        if (settingVoiceSpeechRate) settingVoiceSpeechRate.value = settings.speechRate.toString();\n\n        if (settingVoiceMetricPower) settingVoiceMetricPower.checked = settings.metrics.power;\n        if (settingVoiceMetricHeartrate) settingVoiceMetricHeartrate.checked = settings.metrics.heartrate;\n        if (settingVoiceMetricCadence) settingVoiceMetricCadence.checked = settings.metrics.cadence;\n        if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = settings.metrics.speed;\n        if (settingVoiceMetricDistance) settingVoiceMetricDistance.checked = settings.metrics.distance;\n        if (settingVoiceMetricTime) settingVoiceMetricTime.checked = settings.metrics.time;\n        if (settingVoiceMetricPace) settingVoiceMetricPace.checked = settings.metrics.pace;\n\n        if (settingVoiceSelection && settings.voiceURI) settingVoiceSelection.value = settings.voiceURI;\n        if (settingVoiceTargetFeedback) settingVoiceTargetFeedback.checked = settings.workoutTargetFeedback;\n        if (settingSmartAnnouncements) settingSmartAnnouncements.checked = settings.smartAnnouncements;\n        if (settingVoiceTemplate) settingVoiceTemplate.value = settings.announcementTemplate || '';\n    };\n\n    /**\n     * Save settings to localStorage\n     */\n    const saveSettings = (): void => {\n        // Save User Profile\n        const currentProfile = loadUserProfile();\n        const updatedProfile = {\n            ...currentProfile,\n            ftp: settingFtp?.value ? Number(settingFtp.value) : null,\n            maxHr: settingMaxHr?.value ? Number(settingMaxHr.value) : null,\n            weight: settingWeight?.value ? Number(settingWeight.value) : null,\n        };\n        saveUserProfile(updatedProfile);\n        window.dispatchEvent(new CustomEvent('user-profile-changed'));\n\n        // Update SettingsStore (for Zones)\n        const currentZoneModel = (settingPowerZoneModel?.value as PowerZoneModel) || '7';\n        settingsStore.setMultiple({\n            ftp: updatedProfile.ftp ?? 200,\n            maxHeartrate: updatedProfile.maxHr ?? 190,\n            weight: updatedProfile.weight ?? 75,\n            powerZoneModel: currentZoneModel,\n            powerZones: generatePowerZones(100, currentZoneModel), // Percentages\n        });\n\n        const settings: AppSettings = {\n            speed: settingSpeed?.checked ?? defaultSettings.speed,\n            distance: settingDistance?.checked ?? defaultSettings.distance,\n            altitude: settingAltitude?.checked ?? defaultSettings.altitude,\n            weightKg: settingWeight?.value ? Number(settingWeight.value) : defaultSettings.weightKg,\n            showCalories: settingShowCalories?.checked ?? defaultSettings.showCalories,\n            power: settingPower?.checked ?? defaultSettings.power,\n            cadence: settingCadence?.checked ?? defaultSettings.cadence,\n            heartrate: settingHeartrate?.checked ?? defaultSettings.heartrate,\n            treadmillSpeed: settingTreadmillSpeed?.checked ?? defaultSettings.treadmillSpeed,\n            power3s: settingPower3s?.checked ?? defaultSettings.power3s,\n            highContrast: settingHighContrast?.checked ?? defaultSettings.highContrast,\n            colorblindPatterns: settingColorblindPatterns?.checked ?? defaultSettings.colorblindPatterns,\n            voiceEnabled: settingVoiceEnabled?.checked ?? defaultSettings.voiceEnabled,\n            voiceLaps: settingVoiceLaps?.checked ?? defaultSettings.voiceLaps,\n            voiceZones: settingVoiceZones?.checked ?? defaultSettings.voiceZones,\n            autoPause: {\n                enabled: settingAutoPauseEnabled?.checked ?? defaultAutoPauseSettings.enabled,\n                source: (settingAutoPauseSource?.value as AutoPauseSource) ?? defaultAutoPauseSettings.source,\n                threshold: settingAutoPauseThreshold?.value\n                    ? Number(settingAutoPauseThreshold.value)\n                    : defaultAutoPauseSettings.threshold,\n                delay: settingAutoPauseDelay?.value\n                    ? Number(settingAutoPauseDelay.value)\n                    : defaultAutoPauseSettings.delay,\n            },\n            workoutMetadata: {\n                promptForNotes: settingPromptForNotes?.checked ?? defaultWorkoutMetadataSettings.promptForNotes,\n                promptForExertion:\n                    settingPromptForExertion?.checked ?? defaultWorkoutMetadataSettings.promptForExertion,\n            },\n            countdown: {\n                duration: (settingCountdownDuration?.value\n                    ? parseInt(settingCountdownDuration.value)\n                    : defaultCountdownSettings.duration) as 0 | 3 | 5 | 10,\n                enableBeep: settingCountdownBeep?.checked ?? defaultCountdownSettings.enableBeep,\n                enableVoice: settingCountdownVoice?.checked ?? defaultCountdownSettings.enableVoice,\n            },\n            autoLap: {\n                enabled: settingAutoLapEnabled?.checked ?? defaultAutoLapSettings.enabled,\n                source: (settingAutoLapSource?.value as AutoLapSource) ?? defaultAutoLapSettings.source,\n                distanceKm: settingAutoLapDistance?.value\n                    ? Number(settingAutoLapDistance.value)\n                    : defaultAutoLapSettings.distanceKm,\n                timeMinutes: settingAutoLapTime?.value\n                    ? Number(settingAutoLapTime.value)\n                    : defaultAutoLapSettings.timeMinutes,\n            },\n            enhancedVoice: readVoiceSettingsFromUI(),\n            intervals: {\n                enabled: settingIntervalsEnabled?.checked ?? defaultIntervalsSettings.enabled,\n                apiKey: settingIntervalsApiKey?.value ?? defaultIntervalsSettings.apiKey,\n                athleteId: settingIntervalsAthleteId?.value ?? defaultIntervalsSettings.athleteId,\n                autoUpload: settingIntervalsAutoUpload?.checked ?? defaultIntervalsSettings.autoUpload,\n            },\n            music: {\n                enabled: settingMusicEnabled?.checked ?? defaultMusicSettings.enabled,\n                volume: settingMusicVolume?.value ? Number(settingMusicVolume.value) / 100 : defaultMusicSettings.volume,\n                style: (settingMusicStyle?.value as any) ?? defaultMusicSettings.style,\n                tempoSync: (settingMusicTempoSync?.value as any) ?? defaultMusicSettings.tempoSync,\n                fixedBPM: settingMusicFixedBPM?.value ? Number(settingMusicFixedBPM.value) : defaultMusicSettings.fixedBPM,\n                intensityMapping: (settingMusicIntensityMapping?.value as any) ?? defaultMusicSettings.intensityMapping,\n                transitionSpeed: (settingMusicTransitionSpeed?.value as any) ?? defaultMusicSettings.transitionSpeed,\n                duckingEnabled: settingMusicDucking?.checked ?? defaultMusicSettings.duckingEnabled,\n                duckingLevel: settingMusicDuckingLevel?.value ? Number(settingMusicDuckingLevel.value) / 100 : defaultMusicSettings.duckingLevel,\n            },\n            exportTcx: settingExportTcx?.checked ?? defaultSettings.exportTcx,\n            exportCsv: settingExportCsv?.checked ?? defaultSettings.exportCsv,\n            exportJson: settingExportJson?.checked ?? defaultSettings.exportJson,\n            exportFit: settingExportFit?.checked ?? defaultSettings.exportFit,\n            debugMode: settingDebugMode?.checked ?? defaultSettings.debugMode,\n            mockSensors: settingMockSensors?.checked ?? defaultSettings.mockSensors,\n            wheelCircumferenceMm: getSettings().wheelCircumferenceMm, // Preserve existing value\n        };\n\n        // Sync mock sensors setting with window flag for bluetooth factory\n        (window as any).useMockSensors = settings.mockSensors;\n\n        // saveSettingsToStorage dispatches 'settings-changed' internally\n        saveSettingsToStorage(settings);\n\n        // Save sport settings separately\n        saveSportSettingsFromUI();\n\n        applySettings(settings);\n    };\n\n    /**\n     * Load settings from localStorage\n     */\n    const loadSettings = (): void => {\n        const settings = getSettings();\n        const profile = loadUserProfile();\n\n        // User Profile settings\n        if (settingFtp) settingFtp.value = profile.ftp?.toString() ?? '';\n        if (settingMaxHr) settingMaxHr.value = profile.maxHr?.toString() ?? '';\n        if (settingWeight) settingWeight.value = profile.weight?.toString() ?? '';\n\n        // Zone Settings from Store\n        const zoneSettings = settingsStore.getAll();\n        if (settingPowerZoneModel) settingPowerZoneModel.value = zoneSettings.powerZoneModel || '7';\n\n        // Dashboard display settings\n        if (settingPower) settingPower.checked = settings.power;\n        if (settingCadence) settingCadence.checked = settings.cadence;\n        if (settingHeartrate) settingHeartrate.checked = settings.heartrate;\n        if (settingSpeed) settingSpeed.checked = settings.speed;\n        if (settingDistance) settingDistance.checked = settings.distance;\n        if (settingAltitude) settingAltitude.checked = settings.altitude;\n        if (settingShowCalories) settingShowCalories.checked = settings.showCalories;\n        if (settingTreadmillSpeed) settingTreadmillSpeed.checked = settings.treadmillSpeed;\n        if (settingPower3s) settingPower3s.checked = settings.power3s;\n\n        // Accessibility settings\n        if (settingHighContrast) settingHighContrast.checked = settings.highContrast;\n        if (settingColorblindPatterns) settingColorblindPatterns.checked = settings.colorblindPatterns;\n\n        // Voice Feedback settings\n        if (settingVoiceEnabled) settingVoiceEnabled.checked = settings.voiceEnabled;\n        if (settingVoiceLaps) settingVoiceLaps.checked = settings.voiceLaps;\n        if (settingVoiceZones) settingVoiceZones.checked = settings.voiceZones;\n\n        if (settingVoiceSelection) {\n            const populateVoices = () => {\n                const voices = voiceFeedback.getAvailableVoices();\n\n                // Keep the default option\n                settingVoiceSelection.innerHTML = '<option value=\"\">Default System Voice</option>';\n\n                voices.forEach((voice) => {\n                    const option = document.createElement('option');\n                    option.value = voice.voiceURI;\n                    option.textContent = `${voice.name} (${voice.lang})`;\n                    settingVoiceSelection.appendChild(option);\n                });\n\n                if (settings.enhancedVoice.voiceURI) {\n                    settingVoiceSelection.value = settings.enhancedVoice.voiceURI;\n                }\n            };\n\n            populateVoices();\n\n            // Try again after a delay if voices are empty (browser timing issue)\n            if (voiceFeedback.getAvailableVoices().length === 0) {\n                setTimeout(populateVoices, 500);\n                setTimeout(populateVoices, 2000);\n            }\n        }\n\n        // Auto-Pause settings\n        if (settingAutoPauseEnabled) settingAutoPauseEnabled.checked = settings.autoPause.enabled;\n        if (settingAutoPauseSource) settingAutoPauseSource.value = settings.autoPause.source;\n        if (settingAutoPauseThreshold) settingAutoPauseThreshold.value = settings.autoPause.threshold.toString();\n        if (settingAutoPauseDelay) settingAutoPauseDelay.value = settings.autoPause.delay.toString();\n        updateAutoPauseUI();\n\n        // Export format settings\n        if (settingExportTcx) settingExportTcx.checked = settings.exportTcx;\n        if (settingExportCsv) settingExportCsv.checked = settings.exportCsv;\n        if (settingExportJson) settingExportJson.checked = settings.exportJson;\n        if (settingExportFit) settingExportFit.checked = settings.exportFit;\n\n        // Workout metadata settings\n        if (settingPromptForNotes) settingPromptForNotes.checked = settings.workoutMetadata.promptForNotes;\n        if (settingPromptForExertion) settingPromptForExertion.checked = settings.workoutMetadata.promptForExertion;\n\n        // Countdown settings\n        if (settingCountdownDuration) settingCountdownDuration.value = settings.countdown.duration.toString();\n        if (settingCountdownBeep) settingCountdownBeep.checked = settings.countdown.enableBeep;\n        if (settingCountdownVoice) settingCountdownVoice.checked = settings.countdown.enableVoice;\n\n        // Auto-Lap settings\n        if (settingAutoLapEnabled) settingAutoLapEnabled.checked = settings.autoLap.enabled;\n        if (settingAutoLapSource) settingAutoLapSource.value = settings.autoLap.source;\n        if (settingAutoLapDistance) settingAutoLapDistance.value = settings.autoLap.distanceKm.toString();\n        if (settingAutoLapTime) settingAutoLapTime.value = settings.autoLap.timeMinutes.toString();\n        updateAutoLapUI();\n\n        // Enhanced Voice settings\n        loadVoiceSettingsToUI(settings.enhancedVoice);\n\n        // Intervals.icu settings\n        if (settingIntervalsEnabled) settingIntervalsEnabled.checked = settings.intervals.enabled;\n        if (settingIntervalsApiKey) settingIntervalsApiKey.value = settings.intervals.apiKey;\n        if (settingIntervalsAthleteId) settingIntervalsAthleteId.value = settings.intervals.athleteId;\n        if (settingIntervalsAutoUpload) settingIntervalsAutoUpload.checked = settings.intervals.autoUpload;\n        updateIntervalsUI();\n\n        // Music Generation settings\n        if (settingMusicEnabled) settingMusicEnabled.checked = settings.music.enabled;\n        if (settingMusicVolume) settingMusicVolume.value = (settings.music.volume * 100).toString();\n        updateMusicVolumeDisplay();\n        if (settingMusicStyle) settingMusicStyle.value = settings.music.style;\n        if (settingMusicTempoSync) settingMusicTempoSync.value = settings.music.tempoSync;\n        if (settingMusicFixedBPM) settingMusicFixedBPM.value = settings.music.fixedBPM.toString();\n        if (settingMusicIntensityMapping) settingMusicIntensityMapping.value = settings.music.intensityMapping;\n        if (settingMusicTransitionSpeed) settingMusicTransitionSpeed.value = settings.music.transitionSpeed;\n        if (settingMusicDucking) settingMusicDucking.checked = settings.music.duckingEnabled;\n        if (settingMusicDuckingLevel) settingMusicDuckingLevel.value = (settings.music.duckingLevel * 100).toString();\n        updateMusicDuckingLevelDisplay();\n        updateMusicUI();\n\n        // Debug settings\n        if (settingDebugMode) settingDebugMode.checked = settings.debugMode;\n\n        // Mock sensors setting\n        if (settingMockSensors) settingMockSensors.checked = settings.mockSensors;\n        // Sync with window flag on load\n        (window as any).useMockSensors = settings.mockSensors;\n\n        // Sport settings (stored separately)\n        loadSportSettings();\n\n        applySettings(settings);\n    };\n\n    // Event Listeners\n\n    // Auto-save setup\n    const saveSettingsDebounced = debounce(() => saveSettings(), 500);\n    const attachAutoSave = (element: HTMLElement | null, type: 'change' | 'input' = 'change') => {\n        if (!element) return;\n        if (type === 'input') {\n            element.addEventListener('input', saveSettingsDebounced);\n        } else {\n            element.addEventListener('change', () => saveSettings());\n        }\n    };\n\n    // Attach to inputs\n    // User Profile\n    attachAutoSave(settingFtp, 'input');\n    attachAutoSave(settingPowerZoneModel);\n    attachAutoSave(settingMaxHr, 'input');\n    attachAutoSave(settingWeight, 'input');\n\n    // Add validation for numeric inputs\n    settingFtp?.addEventListener('blur', () => {\n        if (settingFtp.value) {\n            validateNumericInput(settingFtp, 50, 600);\n        } else {\n            clearValidation(settingFtp);\n        }\n    });\n    settingFtp?.addEventListener('focus', () => clearValidation(settingFtp));\n\n    settingMaxHr?.addEventListener('blur', () => {\n        if (settingMaxHr.value) {\n            validateNumericInput(settingMaxHr, 100, 250);\n        } else {\n            clearValidation(settingMaxHr);\n        }\n    });\n    settingMaxHr?.addEventListener('focus', () => clearValidation(settingMaxHr));\n\n    settingWeight?.addEventListener('blur', () => {\n        if (settingWeight.value) {\n            validateNumericInput(settingWeight, 30, 300);\n        } else {\n            clearValidation(settingWeight);\n        }\n    });\n    settingWeight?.addEventListener('focus', () => clearValidation(settingWeight));\n\n    // Dashboard\n    [\n        settingSpeed,\n        settingDistance,\n        settingAltitude,\n        settingShowCalories,\n        settingPower,\n        settingCadence,\n        settingHeartrate,\n        settingTreadmillSpeed,\n        settingPower3s,\n    ].forEach((el) => attachAutoSave(el));\n\n    // Accessibility\n    attachAutoSave(settingHighContrast);\n    attachAutoSave(settingColorblindPatterns);\n\n    // Voice\n    attachAutoSave(settingVoiceEnabled);\n    attachAutoSave(settingVoiceLaps);\n    attachAutoSave(settingVoiceZones);\n\n    // Auto-Pause\n    attachAutoSave(settingAutoPauseEnabled);\n    attachAutoSave(settingAutoPauseSource);\n    attachAutoSave(settingAutoPauseThreshold, 'input');\n    attachAutoSave(settingAutoPauseDelay, 'input');\n\n    // Export\n    [settingExportTcx, settingExportCsv, settingExportJson, settingExportFit].forEach((el) => attachAutoSave(el));\n\n    // Metadata\n    attachAutoSave(settingPromptForNotes);\n    attachAutoSave(settingPromptForExertion);\n\n    // Countdown\n    attachAutoSave(settingCountdownDuration);\n    attachAutoSave(settingCountdownBeep);\n    attachAutoSave(settingCountdownVoice);\n\n    // Auto-Lap\n    attachAutoSave(settingAutoLapEnabled);\n    attachAutoSave(settingAutoLapSource);\n    attachAutoSave(settingAutoLapDistance);\n    attachAutoSave(settingAutoLapTime);\n\n    // Enhanced Voice\n    attachAutoSave(settingVoiceTimeInterval);\n    attachAutoSave(settingVoiceDistanceInterval);\n    attachAutoSave(settingVoiceSpeechRate);\n    [\n        settingVoiceMetricPower,\n        settingVoiceMetricHeartrate,\n        settingVoiceMetricCadence,\n        settingVoiceMetricSpeed,\n        settingVoiceMetricDistance,\n        settingVoiceMetricTime,\n        settingVoiceMetricPace,\n        settingVoiceTargetFeedback,\n    ].forEach((el) => attachAutoSave(el));\n    attachAutoSave(settingVoiceTemplate, 'input');\n\n    // Sport\n    if (settingSportType) {\n        settingSportType.addEventListener('change', () => {\n            const newSport = settingSportType.value;\n            // Save CURRENT voice settings to PREVIOUS sport preset\n            const currentVoice = readVoiceSettingsFromUI();\n            const presetsStr = localStorage.getItem('voice_presets');\n            const presets = presetsStr ? JSON.parse(presetsStr) : {};\n            presets[lastActiveSport] = currentVoice;\n            localStorage.setItem('voice_presets', JSON.stringify(presets));\n\n            // Load NEW sport preset\n            const saved = presets[newSport];\n            if (saved) {\n                loadVoiceSettingsToUI(saved);\n            } else {\n                // Apply intelligent defaults if no preset exists\n                if (newSport === 'running' || newSport === 'walking') {\n                    if (settingVoiceMetricPace) settingVoiceMetricPace.checked = true;\n                    if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = false;\n                } else {\n                    if (settingVoiceMetricPace) settingVoiceMetricPace.checked = false;\n                    if (settingVoiceMetricSpeed) settingVoiceMetricSpeed.checked = true;\n                }\n                // Reset feedback for new sport (if no preset/new profile)\n                if (settingVoiceTargetFeedback) settingVoiceTargetFeedback.checked = false;\n            }\n\n            lastActiveSport = newSport;\n            saveSettings();\n        });\n    }\n    attachAutoSave(settingShowPace);\n    attachAutoSave(settingThresholdPace, 'input');\n\n    // Intervals\n    attachAutoSave(settingIntervalsEnabled);\n    attachAutoSave(settingIntervalsApiKey, 'input');\n    attachAutoSave(settingIntervalsAthleteId, 'input');\n    attachAutoSave(settingIntervalsAutoUpload);\n\n    // Music Generation\n    attachAutoSave(settingMusicEnabled);\n    attachAutoSave(settingMusicVolume, 'input');\n    attachAutoSave(settingMusicStyle);\n    attachAutoSave(settingMusicTempoSync);\n    attachAutoSave(settingMusicFixedBPM, 'input');\n    attachAutoSave(settingMusicIntensityMapping);\n    attachAutoSave(settingMusicTransitionSpeed);\n    attachAutoSave(settingMusicDucking);\n    attachAutoSave(settingMusicDuckingLevel, 'input');\n\n    // Update volume display on input\n    settingMusicVolume?.addEventListener('input', updateMusicVolumeDisplay);\n    settingMusicDuckingLevel?.addEventListener('input', updateMusicDuckingLevelDisplay);\n\n    // Update UI visibility when music enabled/disabled\n    settingMusicEnabled?.addEventListener('change', updateMusicUI);\n    settingMusicTempoSync?.addEventListener('change', updateMusicUI);\n    settingMusicDucking?.addEventListener('change', updateMusicUI);\n\n    // Debug\n    attachAutoSave(settingDebugMode);\n    attachAutoSave(settingMockSensors);\n\n    // Update Save button to Close button\n    if (saveSettingsButton) {\n        saveSettingsButton.textContent = 'Close Settings';\n        saveSettingsButton.className = 'close-settings-btn'; // Give it a specific class if we want to restyle\n        // Keep existing styles inline for now or move to CSS.\n        // The inline style in HTML is: background: #2196f3; ...\n        // We might want to change color to gray or neutral since it's just 'Close'.\n        saveSettingsButton.style.background = '#6c757d'; // Neutral gray\n\n        saveSettingsButton.addEventListener('click', () => {\n            if ((window as any).router) {\n                // Navigate back if possible, or home\n                // Ideally router.back() if tracking history\n                // Falling back to home for safety\n                (window as any).router.navigate('/');\n            } else {\n                window.history.back();\n            }\n        });\n    }\n\n    downloadDebugLogs?.addEventListener('click', () => {\n        BluetoothDebugService.exportLogs();\n    });\n\n    clearDebugLogs?.addEventListener('click', async () => {\n        if (confirm('Are you sure you want to clear all debug logs?')) {\n            await BluetoothDebugService.clearLogs();\n            alert('Logs cleared.');\n        }\n    });\n\n    // PWA Install button handler\n    installPwaButton?.addEventListener('click', async () => {\n        const outcome = await triggerInstallPrompt();\n\n        if (outcome === 'accepted') {\n            // App will be installed, button will hide automatically via installPrompt.ts\n            console.log('PWA installation accepted');\n        } else if (outcome === 'dismissed') {\n            console.log('PWA installation dismissed');\n        } else {\n            alert(\n                'Installation is not available at this time. The app may already be installed or your browser does not support installation.'\n            );\n        }\n    });\n\n    // Initialize\n    loadSettings();\n\n    // Initialize Feature Flags UI\n    initFeatureFlags();\n}\n\n/**\n * Initialize the Feature Flags UI\n */\nfunction initFeatureFlags(): void {\n    const container = document.getElementById('featureFlagsList');\n    const resetButton = document.getElementById('resetFeatureFlags');\n\n    if (!container) return;\n\n    const renderFlags = (): void => {\n        const flags = featureFlagService.getAllFlags();\n        container.innerHTML = '';\n\n        Object.values(flags).forEach((flag) => {\n            // Skip debug flags in production\n            if (flag.category === 'debug' && !import.meta.env.DEV) {\n                return;\n            }\n\n            const categoryBadge = getCategoryBadge(flag.category);\n\n            const wrapper = document.createElement('label');\n            wrapper.className = 'settings-option';\n            wrapper.style.cssText = 'display: flex; align-items: flex-start; gap: 10px; cursor: pointer;';\n\n            const checkbox = document.createElement('input');\n            checkbox.type = 'checkbox';\n            checkbox.id = `flag-${flag.key}`;\n            checkbox.checked = flag.enabled;\n            checkbox.style.cssText = 'width: 20px; height: 20px; margin-top: 2px;';\n\n            checkbox.addEventListener('change', () => {\n                if (checkbox.checked) {\n                    featureFlagService.enable(flag.key);\n                } else {\n                    featureFlagService.disable(flag.key);\n                }\n                showRefreshNotice();\n            });\n\n            const textWrapper = document.createElement('div');\n            textWrapper.style.cssText = 'flex: 1;';\n            textWrapper.innerHTML = `\n                <span style=\"font-size: 16px; display: flex; align-items: center; gap: 8px;\">\n                    ${flag.name}\n                    <span style=\"font-size: 11px; padding: 2px 6px; border-radius: 4px; ${categoryBadge}\">${flag.category}</span>\n                </span>\n                <p style=\"font-size: 12px; color: #666; margin: 2px 0 0 0;\">${flag.description}</p>\n            `;\n\n            wrapper.appendChild(checkbox);\n            wrapper.appendChild(textWrapper);\n            container.appendChild(wrapper);\n        });\n    };\n\n    const getCategoryBadge = (category: string): string => {\n        switch (category) {\n            case 'core':\n                return 'background: #e3f2fd; color: #1976d2;';\n            case 'experimental':\n                return 'background: #fff3e0; color: #f57c00;';\n            case 'premium':\n                return 'background: #f3e5f5; color: #7b1fa2;';\n            case 'debug':\n                return 'background: #fce4ec; color: #c2185b;';\n            default:\n                return 'background: #f5f5f5; color: #666;';\n        }\n    };\n\n    const showRefreshNotice = (): void => {\n        // Show a non-blocking notice that changes require refresh\n        const existingNotice = document.getElementById('feature-flag-notice');\n        if (existingNotice) return;\n\n        const notice = document.createElement('div');\n        notice.id = 'feature-flag-notice';\n        notice.style.cssText = `\n            position: fixed;\n            bottom: 80px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: #323232;\n            color: white;\n            padding: 12px 24px;\n            border-radius: 8px;\n            font-size: 14px;\n            z-index: 1000;\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        `;\n        notice.innerHTML = `\n            <span>Refresh page to apply changes</span>\n            <button id=\"refreshNowBtn\" style=\"\n                background: #2196f3;\n                color: white;\n                border: none;\n                padding: 6px 12px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 14px;\n            \">Refresh Now</button>\n        `;\n        document.body.appendChild(notice);\n\n        const refreshBtn = document.getElementById('refreshNowBtn');\n        refreshBtn?.addEventListener('click', () => {\n            window.location.reload();\n        });\n\n        // Auto-dismiss after 10 seconds\n        setTimeout(() => {\n            notice.remove();\n        }, 10000);\n    };\n\n    resetButton?.addEventListener('click', () => {\n        if (confirm('Reset all feature flags to their default values?')) {\n            featureFlagService.resetToDefaults();\n            renderFlags();\n            showRefreshNotice();\n        }\n    });\n\n    renderFlags();\n}\n","/**\n * Data Fields Configuration UI\n *\n * Provides user interface for configuring data field screens and profiles.\n * - Edit existing screens (add/remove/reorder fields)\n * - Switch between activity profiles\n * - Preview screen layouts\n *\n * @module ui/dataFieldsConfig\n */\n\nimport type { ActivityProfile, DataScreen, DataFieldSlot, ScreenLayout, DataFieldSize } from '../data-fields/types.js';\nimport { loadActiveProfile, saveProfile } from '../data-fields/persistence.js';\nimport { getDataField, getAllCategories, getFieldsByCategory, searchFields } from '../data-fields/registry.js';\nimport { addSlotToScreen, removeSlotFromScreen, updateSlot } from '../data-fields/screens.js';\nimport type { DataFieldCategory, DataFieldDefinition } from '../data-fields/types.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface DataFieldsConfigState {\n    profile: ActivityProfile;\n    selectedScreenIndex: number;\n    isEditing: boolean;\n    searchQuery: string;\n    selectedCategory: DataFieldCategory | 'all';\n}\n\ntype UpdateCallback = () => void;\n\n// ============================================================================\n// State Management\n// ============================================================================\n\nlet state: DataFieldsConfigState = {\n    profile: loadActiveProfile(),\n    selectedScreenIndex: 0,\n    isEditing: false,\n    searchQuery: '',\n    selectedCategory: 'all',\n};\n\nconst updateCallbacks: Set<UpdateCallback> = new Set();\n\n/**\n * Subscribe to state updates\n */\nfunction subscribe(callback: UpdateCallback): () => void {\n    updateCallbacks.add(callback);\n    return () => updateCallbacks.delete(callback);\n}\n\n/**\n * Notify subscribers of state change\n */\nfunction notifyUpdate(): void {\n    updateCallbacks.forEach((cb) => cb());\n}\n\n/**\n * Update state and notify\n */\nfunction updateState(updates: Partial<DataFieldsConfigState>): void {\n    state = { ...state, ...updates };\n    notifyUpdate();\n}\n\n// ============================================================================\n// Profile/Screen Management\n// ============================================================================\n\n/**\n * Load and set the active profile\n */\nfunction loadProfile(): void {\n    const profile = loadActiveProfile();\n    updateState({\n        profile,\n        selectedScreenIndex: Math.min(state.selectedScreenIndex, profile.screens.length - 1),\n    });\n}\n\n/**\n * Save the current profile\n */\nfunction saveCurrentProfile(): boolean {\n    const success = saveProfile(state.profile);\n    if (success) {\n        // Dispatch event so carousel updates\n        document.dispatchEvent(\n            new CustomEvent('data-fields-profile-changed', {\n                detail: { profile: state.profile },\n            })\n        );\n    }\n    return success;\n}\n\n/**\n * Get the currently selected screen\n */\nfunction getSelectedScreen(): DataScreen | null {\n    return state.profile.screens[state.selectedScreenIndex] ?? null;\n}\n\n/**\n * Add a field to the current screen\n */\nfunction addFieldToScreen(fieldId: string, size: 'small' | 'medium' | 'large' = 'medium'): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = addSlotToScreen(screen, fieldId, size);\n\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Remove a field from the current screen\n */\nfunction removeFieldFromScreen(slotId: string): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = removeSlotFromScreen(screen, slotId);\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update a slot's properties\n */\nfunction updateFieldSlot(slotId: string, updates: Partial<DataFieldSlot>): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = updateSlot(screen, slotId, updates);\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update screen layout\n */\nfunction updateScreenLayout(layout: ScreenLayout): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const updatedScreen = { ...screen, layout };\n    updateScreenInProfile(updatedScreen);\n}\n\n/**\n * Update a screen in the profile\n */\nfunction updateScreenInProfile(screen: DataScreen): void {\n    const screens = [...state.profile.screens];\n    screens[state.selectedScreenIndex] = screen;\n\n    updateState({\n        profile: { ...state.profile, screens },\n    });\n}\n\n/**\n * Reorder fields in the current screen\n */\nfunction reorderFields(fromIndex: number, toIndex: number): void {\n    const screen = getSelectedScreen();\n    if (!screen) return;\n\n    const slots = [...screen.slots];\n    const [removed] = slots.splice(fromIndex, 1);\n    slots.splice(toIndex, 0, removed);\n\n    // Update positions\n    const reorderedSlots = slots.map((slot, idx) => ({\n        ...slot,\n        position: idx,\n    }));\n\n    updateScreenInProfile({ ...screen, slots: reorderedSlots });\n}\n\n// ============================================================================\n// Field Search/Filter\n// ============================================================================\n\n/**\n * Get filtered fields based on search and category\n */\nfunction getFilteredFields(): DataFieldDefinition[] {\n    let fields: DataFieldDefinition[];\n\n    if (state.searchQuery.trim()) {\n        fields = searchFields(state.searchQuery);\n    } else if (state.selectedCategory === 'all') {\n        const categories = getAllCategories();\n        fields = Array.from(categories.values()).flat();\n    } else {\n        fields = getFieldsByCategory(state.selectedCategory);\n    }\n\n    return fields;\n}\n\n// ============================================================================\n// UI Rendering\n// ============================================================================\n\n/**\n * Category icons for visual display\n */\nconst CATEGORY_ICONS: Record<DataFieldCategory | 'all', string> = {\n    all: 'ðŸ“Š',\n    power: 'âš¡',\n    heartrate: 'â¤ï¸',\n    cadence: 'ðŸ”„',\n    speed: 'ðŸš´',\n    distance: 'ðŸ“',\n    elevation: 'â›°ï¸',\n    time: 'â±ï¸',\n    laps: 'ðŸ',\n    energy: 'ðŸ”¥',\n    environment: 'ðŸŒ¡ï¸',\n    device: 'ðŸ”‹',\n    charts: 'ðŸ“ˆ',\n    map: 'ðŸ—ºï¸',\n};\n\n/**\n * Create the main configuration UI\n */\nfunction createConfigUI(container: HTMLElement): void {\n    container.innerHTML = `\n        <div class=\"data-fields-config\">\n            <div class=\"dfc-header\">\n                <h3>ðŸ“Š Data Fields</h3>\n                <p class=\"dfc-help-text\">Configure which metrics appear on your dashboard screens.</p>\n            </div>\n            \n            <div class=\"dfc-screens\">\n                <div class=\"dfc-screens-tabs\" role=\"tablist\"></div>\n            </div>\n            \n            <div class=\"dfc-current-screen\">\n                <div class=\"dfc-screen-header\">\n                    <span class=\"dfc-screen-name\"></span>\n                    <select class=\"dfc-layout-select\" aria-label=\"Screen layout\">\n                        <option value=\"auto\">Auto Layout</option>\n                        <option value=\"grid-2\">2 Columns</option>\n                        <option value=\"grid-3\">3 Columns</option>\n                        <option value=\"grid-4\">4 Columns</option>\n                        <option value=\"list\">List</option>\n                    </select>\n                </div>\n                <div class=\"dfc-fields-list\" role=\"list\" aria-label=\"Current screen fields\"></div>\n                <button class=\"dfc-add-field-btn\" type=\"button\">\n                    <span>+</span> Add Field\n                </button>\n            </div>\n            \n            <div class=\"dfc-field-picker\" style=\"display: none;\">\n                <div class=\"dfc-picker-header\">\n                    <h4>Select a Field</h4>\n                    <button class=\"dfc-picker-close\" type=\"button\" aria-label=\"Close field picker\">&times;</button>\n                </div>\n                <input type=\"search\" class=\"dfc-search\" placeholder=\"Search fields...\" aria-label=\"Search data fields\">\n                <div class=\"dfc-categories\" role=\"tablist\"></div>\n                <div class=\"dfc-available-fields\" role=\"listbox\" aria-label=\"Available fields\"></div>\n            </div>\n            \n            <div class=\"dfc-actions\">\n                <button class=\"dfc-save-btn\" type=\"button\">Save Changes</button>\n                <button class=\"dfc-reset-btn\" type=\"button\">Reset to Defaults</button>\n            </div>\n        </div>\n    `;\n\n    // Set up event listeners\n    setupConfigEventListeners(container);\n\n    // Initial render\n    renderConfigUI(container);\n\n    // Subscribe to state changes\n    subscribe(() => renderConfigUI(container));\n}\n\n/**\n * Render the current state to the UI\n */\nfunction renderConfigUI(container: HTMLElement): void {\n    renderScreenTabs(container);\n    renderCurrentScreen(container);\n    renderFieldPicker(container);\n}\n\n/**\n * Render screen tabs\n */\nfunction renderScreenTabs(container: HTMLElement): void {\n    const tabsContainer = container.querySelector('.dfc-screens-tabs');\n    if (!tabsContainer) return;\n\n    tabsContainer.innerHTML = state.profile.screens\n        .map(\n            (screen, idx) => `\n            <button \n                class=\"dfc-screen-tab ${idx === state.selectedScreenIndex ? 'dfc-screen-tab--active' : ''}\"\n                data-screen-index=\"${idx}\"\n                role=\"tab\"\n                aria-selected=\"${idx === state.selectedScreenIndex}\"\n                aria-label=\"${screen.name} screen\"\n            >\n                <span class=\"dfc-tab-icon\">${screen.icon}</span>\n                <span class=\"dfc-tab-name\">${escapeHtml(screen.name)}</span>\n            </button>\n        `\n        )\n        .join('');\n}\n\n/**\n * Render current screen fields\n */\nfunction renderCurrentScreen(container: HTMLElement): void {\n    const screen = getSelectedScreen();\n    const nameEl = container.querySelector('.dfc-screen-name');\n    const layoutSelect = container.querySelector('.dfc-layout-select') as HTMLSelectElement;\n    const fieldsList = container.querySelector('.dfc-fields-list');\n\n    if (!screen || !nameEl || !fieldsList || !layoutSelect) return;\n\n    nameEl.textContent = `${screen.icon} ${screen.name}`;\n    layoutSelect.value = screen.layout;\n\n    if (screen.slots.length === 0) {\n        fieldsList.innerHTML = `\n            <div class=\"dfc-empty-screen\">\n                <p>No fields on this screen</p>\n                <p class=\"dfc-empty-hint\">Click \"Add Field\" to add metrics</p>\n            </div>\n        `;\n        return;\n    }\n\n    fieldsList.innerHTML = screen.slots\n        .sort((a, b) => a.position - b.position)\n        .map((slot) => {\n            const field = getDataField(slot.fieldId);\n            const fieldName = field?.name ?? 'Unknown';\n            const fieldIcon = field?.icon ?? 'â“';\n\n            return `\n                <div class=\"dfc-field-item\" data-slot-id=\"${slot.id}\" role=\"listitem\" draggable=\"true\">\n                    <span class=\"dfc-field-drag\" title=\"Drag to reorder\">â‹®â‹®</span>\n                    <span class=\"dfc-field-icon\">${fieldIcon}</span>\n                    <div class=\"dfc-field-info\">\n                        <span class=\"dfc-field-name\">${escapeHtml(fieldName)}</span>\n                        <span class=\"dfc-field-id\">${slot.fieldId}</span>\n                    </div>\n                    <select class=\"dfc-field-size\" data-slot-id=\"${slot.id}\" aria-label=\"Field size\">\n                        <option value=\"small\" ${slot.size === 'small' ? 'selected' : ''}>Small</option>\n                        <option value=\"medium\" ${slot.size === 'medium' ? 'selected' : ''}>Medium</option>\n                        <option value=\"large\" ${slot.size === 'large' ? 'selected' : ''}>Large</option>\n                        <option value=\"wide\" ${slot.size === 'wide' ? 'selected' : ''}>Wide</option>\n                        <option value=\"tall\" ${slot.size === 'tall' ? 'selected' : ''}>Tall</option>\n                        <option value=\"full\" ${slot.size === 'full' ? 'selected' : ''}>Full</option>\n                        <option value=\"xlarge\" ${slot.size === 'xlarge' ? 'selected' : ''}>Extra Large</option>\n                        <option value=\"xxlarge\" ${slot.size === 'xxlarge' ? 'selected' : ''}>XX-Large</option>\n                        <option value=\"jumbo\" ${slot.size === 'jumbo' ? 'selected' : ''}>Jumbo</option>\n                    </select>\n                    <button class=\"dfc-field-remove\" data-slot-id=\"${slot.id}\" aria-label=\"Remove ${fieldName}\" title=\"Remove\">\n                        ðŸ—‘ï¸\n                    </button>\n                </div>\n            `;\n        })\n        .join('');\n}\n\n/**\n * Render field picker\n */\nfunction renderFieldPicker(container: HTMLElement): void {\n    const categoriesContainer = container.querySelector('.dfc-categories');\n    const fieldsContainer = container.querySelector('.dfc-available-fields');\n\n    if (!categoriesContainer || !fieldsContainer) return;\n\n    // Render category tabs\n    const categories: Array<DataFieldCategory | 'all'> = [\n        'all',\n        'power',\n        'heartrate',\n        'cadence',\n        'speed',\n        'distance',\n        'elevation',\n        'time',\n    ];\n\n    categoriesContainer.innerHTML = categories\n        .map(\n            (cat) => `\n            <button \n                class=\"dfc-category-btn ${cat === state.selectedCategory ? 'dfc-category-btn--active' : ''}\"\n                data-category=\"${cat}\"\n                role=\"tab\"\n                aria-selected=\"${cat === state.selectedCategory}\"\n            >\n                <span>${CATEGORY_ICONS[cat]}</span>\n                <span>${cat === 'all' ? 'All' : cat.charAt(0).toUpperCase() + cat.slice(1)}</span>\n            </button>\n        `\n        )\n        .join('');\n\n    // Render available fields\n    const fields = getFilteredFields();\n    const currentScreen = getSelectedScreen();\n    const usedFieldIds = new Set(currentScreen?.slots.map((s) => s.fieldId) ?? []);\n\n    fieldsContainer.innerHTML = fields\n        .map((field) => {\n            const isUsed = usedFieldIds.has(field.id);\n            return `\n                <button \n                    class=\"dfc-available-field ${isUsed ? 'dfc-available-field--used' : ''}\"\n                    data-field-id=\"${field.id}\"\n                    role=\"option\"\n                    aria-selected=\"false\"\n                    ${isUsed ? 'disabled' : ''}\n                >\n                    <span class=\"dfc-af-icon\">${field.icon}</span>\n                    <div class=\"dfc-af-info\">\n                        <span class=\"dfc-af-name\">${escapeHtml(field.name)}</span>\n                        <span class=\"dfc-af-desc\">${escapeHtml(field.description)}</span>\n                    </div>\n                    ${isUsed ? '<span class=\"dfc-af-badge\">Added</span>' : ''}\n                </button>\n            `;\n        })\n        .join('');\n}\n\n/**\n * Setup event listeners for the config UI\n */\nfunction setupConfigEventListeners(container: HTMLElement): void {\n    // Screen tab clicks\n    container.addEventListener('click', (e) => {\n        const target = e.target as HTMLElement;\n\n        // Screen tab\n        const tab = target.closest('.dfc-screen-tab') as HTMLElement;\n        if (tab) {\n            const idx = parseInt(tab.dataset.screenIndex ?? '0', 10);\n            updateState({ selectedScreenIndex: idx });\n            return;\n        }\n\n        // Add field button\n        if (target.closest('.dfc-add-field-btn')) {\n            showFieldPicker(container);\n            return;\n        }\n\n        // Close picker\n        if (target.closest('.dfc-picker-close')) {\n            hideFieldPicker(container);\n            return;\n        }\n\n        // Category button\n        const catBtn = target.closest('.dfc-category-btn') as HTMLElement;\n        if (catBtn) {\n            const category = catBtn.dataset.category as DataFieldCategory | 'all';\n            updateState({ selectedCategory: category });\n            return;\n        }\n\n        // Available field click\n        const fieldBtn = target.closest('.dfc-available-field') as HTMLElement;\n        if (fieldBtn && !fieldBtn.hasAttribute('disabled')) {\n            const fieldId = fieldBtn.dataset.fieldId;\n            if (fieldId) {\n                addFieldToScreen(fieldId);\n                notifyUpdate();\n            }\n            return;\n        }\n\n        // Remove field\n        const removeBtn = target.closest('.dfc-field-remove') as HTMLElement;\n        if (removeBtn) {\n            const slotId = removeBtn.dataset.slotId;\n            if (slotId) {\n                removeFieldFromScreen(slotId);\n            }\n            return;\n        }\n\n        // Save button\n        if (target.closest('.dfc-save-btn')) {\n            if (saveCurrentProfile()) {\n                showNotification('Settings saved!', 'success');\n            } else {\n                showNotification('Failed to save settings', 'error');\n            }\n            return;\n        }\n\n        // Reset button\n        if (target.closest('.dfc-reset-btn')) {\n            if (confirm('Reset data fields to defaults? This cannot be undone.')) {\n                resetToDefaults();\n            }\n            return;\n        }\n    });\n\n    // Layout select change\n    container.addEventListener('change', (e) => {\n        const target = e.target as HTMLSelectElement;\n\n        if (target.classList.contains('dfc-layout-select')) {\n            updateScreenLayout(target.value as ScreenLayout);\n            return;\n        }\n\n        if (target.classList.contains('dfc-field-size')) {\n            const slotId = target.dataset.slotId;\n            if (slotId) {\n                updateFieldSlot(slotId, { size: target.value as DataFieldSize });\n            }\n            return;\n        }\n    });\n\n    // Search input\n    const searchInput = container.querySelector('.dfc-search') as HTMLInputElement;\n    if (searchInput) {\n        searchInput.addEventListener('input', (e) => {\n            const target = e.target as HTMLInputElement;\n            updateState({ searchQuery: target.value });\n        });\n    }\n\n    // Drag and drop for reordering\n    setupDragAndDrop(container);\n}\n\n/**\n * Setup drag and drop reordering\n */\nfunction setupDragAndDrop(container: HTMLElement): void {\n    const fieldsList = container.querySelector('.dfc-fields-list');\n    if (!fieldsList) return;\n\n    let draggedEl: HTMLElement | null = null;\n    let draggedIndex: number = -1;\n\n    fieldsList.addEventListener('dragstart', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        draggedEl = target.closest('.dfc-field-item') as HTMLElement;\n        if (draggedEl) {\n            draggedIndex = Array.from(fieldsList.children).indexOf(draggedEl);\n            draggedEl.classList.add('dfc-field-item--dragging');\n        }\n    });\n\n    fieldsList.addEventListener('dragend', () => {\n        if (draggedEl) {\n            draggedEl.classList.remove('dfc-field-item--dragging');\n        }\n        draggedEl = null;\n        draggedIndex = -1;\n    });\n\n    fieldsList.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        const target = (e as DragEvent).target as HTMLElement;\n        const item = target.closest('.dfc-field-item') as HTMLElement;\n        if (item && item !== draggedEl) {\n            const items = Array.from(fieldsList.querySelectorAll('.dfc-field-item:not(.dfc-field-item--dragging)'));\n            const targetIndex = items.indexOf(item);\n            if (targetIndex !== -1) {\n                item.classList.add('dfc-field-item--drag-over');\n            }\n        }\n    });\n\n    fieldsList.addEventListener('dragleave', (e) => {\n        const target = (e as DragEvent).target as HTMLElement;\n        const item = target.closest('.dfc-field-item');\n        if (item) {\n            item.classList.remove('dfc-field-item--drag-over');\n        }\n    });\n\n    fieldsList.addEventListener('drop', (e) => {\n        e.preventDefault();\n        const target = (e as DragEvent).target as HTMLElement;\n        const targetItem = target.closest('.dfc-field-item') as HTMLElement;\n\n        // Clear all drag-over states\n        fieldsList.querySelectorAll('.dfc-field-item--drag-over').forEach((el) => {\n            el.classList.remove('dfc-field-item--drag-over');\n        });\n\n        if (targetItem && draggedEl && targetItem !== draggedEl) {\n            const items = Array.from(fieldsList.querySelectorAll('.dfc-field-item'));\n            const toIndex = items.indexOf(targetItem);\n\n            if (draggedIndex !== -1 && toIndex !== -1 && draggedIndex !== toIndex) {\n                reorderFields(draggedIndex, toIndex);\n            }\n        }\n    });\n}\n\n/**\n * Show field picker modal\n */\nfunction showFieldPicker(container: HTMLElement): void {\n    const picker = container.querySelector('.dfc-field-picker') as HTMLElement;\n    if (picker) {\n        picker.style.display = 'block';\n        const searchInput = picker.querySelector('.dfc-search') as HTMLInputElement;\n        if (searchInput) {\n            searchInput.focus();\n        }\n    }\n}\n\n/**\n * Hide field picker modal\n */\nfunction hideFieldPicker(container: HTMLElement): void {\n    const picker = container.querySelector('.dfc-field-picker') as HTMLElement;\n    if (picker) {\n        picker.style.display = 'none';\n        updateState({ searchQuery: '', selectedCategory: 'all' });\n    }\n}\n\n/**\n * Reset to default profiles\n */\nfunction resetToDefaults(): void {\n    // Clear custom profiles and reload defaults\n    localStorage.removeItem('bpt-data-fields');\n    loadProfile();\n    showNotification('Data fields reset to defaults', 'info');\n}\n\n/**\n * Show a notification toast\n */\nfunction showNotification(message: string, type: 'success' | 'error' | 'info'): void {\n    // Use existing notification system if available\n    const event = new CustomEvent('show-notification', {\n        detail: { message, type },\n    });\n    document.dispatchEvent(event);\n\n    // Fallback: console log\n    console.log(`[DataFieldsConfig] ${type}: ${message}`);\n}\n\n/**\n * HTML escape helper\n */\nfunction escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}\n\n// ============================================================================\n// Initialization\n// ============================================================================\n\n/**\n * Initialize data fields configuration in the settings page\n */\nexport function initDataFieldsConfig(): void {\n    // Find or create container in settings\n    const settingsContent = document.querySelector('#page-settings .page-content');\n    if (!settingsContent) {\n        console.warn('[DataFieldsConfig] Settings page content not found');\n        return;\n    }\n\n    // Check if already initialized\n    if (settingsContent.querySelector('.data-fields-config')) {\n        return;\n    }\n\n    // Create container\n    const container = document.createElement('fieldset');\n    container.className = 'settings-fieldset';\n    container.style.cssText = 'border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;';\n    container.innerHTML = '<legend style=\"font-weight: 600; padding: 0 8px;\">ðŸ“Š Data Fields Configuration</legend>';\n\n    // Insert after Voice Feedback section or at the end\n    const voiceFeedback = settingsContent.querySelector('fieldset:nth-child(4)');\n    if (voiceFeedback && voiceFeedback.nextSibling) {\n        settingsContent.insertBefore(container, voiceFeedback.nextSibling);\n    } else {\n        settingsContent.appendChild(container);\n    }\n\n    createConfigUI(container);\n\n    console.log('[DataFieldsConfig] Initialized');\n}\n\n/**\n * Refresh the config UI with current state\n */\nexport function refreshDataFieldsConfig(): void {\n    loadProfile();\n}\n\n// Export state getters for external use\nexport { getSelectedScreen, getFilteredFields };\n","import { View } from '../router/View.js';\nimport { initSettingsLogic } from '../ui/settings.js';\nimport { initDataFieldsConfig } from '../ui/dataFieldsConfig.js';\n\nexport class SettingsView implements View {\n    public id = 'settings';\n    // private isInitialized = false;\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('settingsTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n\n            // Initialize the logic now that elements are in the DOM\n            // We use setTimeout to ensure the DOM update is processed\n            setTimeout(() => {\n                initSettingsLogic();\n                initDataFieldsConfig();\n                // this.isInitialized = true;\n            }, 0);\n        } else {\n            console.error('Settings template not found!');\n            container.innerHTML = '<p>Error loading settings view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        // If we needed to refresh settings from storage every time we enter,\n        // we might call loadSettings() here.\n        // But initSettingsLogic calls loadSettings internally during init.\n        // If the user changes settings, they are saved.\n        // If we want to ensure UI matches state if state changed elsewhere...\n        // initSettingsLogic sets up listeners.\n        // We might want to re-run loadSettings() if it exposed it.\n        // For now, let's assume one-time init is fine or we can expose refresh.\n\n        // Actually, since we re-clone the template only ONCE in init (if the container is empty?),\n        // Wait, the Router usually doesn't clear the container unless we implement it that way.\n        // My Router implementation:\n        /*\n            if (!this.views.has(viewId)) { ... view.init(container) }\n            this.currentView?.onLeave();\n            currentContainer.style.display = 'none';\n            newContainer.style.display = 'block';\n            view.onEnter();\n        */\n\n        // So init() is called once. The DOM elements persist.\n        // So `initSettingsLogic` is called once. The listeners persist.\n        // This is correct.\n    }\n\n    public onLeave(): void {\n        console.log('Left Settings View');\n    }\n}\n"],"names":["debounce","func","wait","timeout","args","calculatePowerZones7","ftp","calculatePowerZones5","calculatePowerZones3","generatePowerZones","model","initSettingsLogic","saveSettingsButton","settingFtp","settingPowerZoneModel","settingMaxHr","settingWeight","validateNumericInput","input","min","max","value","clearValidation","settingSpeed","settingDistance","settingAltitude","settingShowCalories","settingPower","settingCadence","settingHeartrate","settingTreadmillSpeed","settingPower3s","settingHighContrast","settingColorblindPatterns","settingVoiceEnabled","settingVoiceLaps","settingVoiceZones","settingAutoPauseEnabled","settingAutoPauseSource","settingAutoPauseThreshold","settingAutoPauseDelay","autoPauseOptions","autoPauseThresholdUnit","settingExportTcx","settingExportCsv","settingExportJson","settingExportFit","settingPromptForNotes","settingPromptForExertion","settingCountdownDuration","settingCountdownBeep","settingCountdownVoice","settingAutoLapEnabled","settingAutoLapSource","settingAutoLapDistance","settingAutoLapTime","autoLapOptions","autoLapDistanceOption","autoLapTimeOption","settingVoiceSelection","settingVoiceTimeInterval","settingVoiceDistanceInterval","settingVoiceSpeechRate","settingVoiceMetricPower","settingVoiceMetricHeartrate","settingVoiceMetricCadence","settingVoiceMetricSpeed","settingVoiceMetricDistance","settingVoiceMetricTime","settingVoiceMetricPace","settingVoiceTargetFeedback","settingVoiceTemplate","settingSmartAnnouncements","settingSportType","settingShowPace","settingThresholdPace","runningOptions","settingIntervalsEnabled","settingIntervalsApiKey","toggleIntervalsApiKey","settingIntervalsAthleteId","settingIntervalsAutoUpload","intervalsOptions","settingMusicEnabled","settingMusicVolume","musicVolumeValue","settingMusicStyle","settingMusicTempoSync","settingMusicFixedBPM","settingMusicIntensityMapping","settingMusicTransitionSpeed","settingMusicDucking","settingMusicDuckingLevel","musicDuckingLevelValue","musicOptions","fixedBpmOption","duckingLevelOption","settingDebugMode","debugControls","downloadDebugLogs","clearDebugLogs","settingMockSensors","installPwaButton","updateIntervalsUI","updateMusicUI","updateMusicVolumeDisplay","updateMusicDuckingLevelDisplay","updateSportUI","isRunning","parsePace","paceStr","match","minutes","seconds","saveSportSettingsFromUI","sportSettings","getSportSettings","paceSeconds","saveSportSettings","lastActiveSport","loadSportSettings","thresholdPace","formatPace","newSport","isPassword","updateAutoPauseUI","unit","getAutoPauseSourceUnit","updateAutoLapUI","isDistance","applySettings","settings","voiceFeedback","toggleMetric","metric","isVisible","el","readVoiceSettingsFromUI","defaultEnhancedVoiceSettings","defaultVoiceMetrics","loadVoiceSettingsToUI","saveSettings","updatedProfile","loadUserProfile","saveUserProfile","currentZoneModel","settingsStore","defaultSettings","defaultAutoPauseSettings","defaultWorkoutMetadataSettings","defaultCountdownSettings","defaultAutoLapSettings","defaultIntervalsSettings","defaultMusicSettings","getSettings","saveSettingsToStorage","loadSettings","profile","zoneSettings","populateVoices","voices","voice","option","saveSettingsDebounced","attachAutoSave","element","type","currentVoice","presetsStr","presets","saved","BluetoothDebugService","outcome","triggerInstallPrompt","initFeatureFlags","container","resetButton","renderFlags","flags","featureFlagService","flag","categoryBadge","getCategoryBadge","wrapper","checkbox","showRefreshNotice","textWrapper","category","notice","state","loadActiveProfile","updateCallbacks","subscribe","callback","notifyUpdate","cb","updateState","updates","loadProfile","saveCurrentProfile","success","saveProfile","getSelectedScreen","addFieldToScreen","fieldId","size","screen","updatedScreen","addSlotToScreen","updateScreenInProfile","removeFieldFromScreen","slotId","removeSlotFromScreen","updateFieldSlot","updateSlot","updateScreenLayout","layout","screens","reorderFields","fromIndex","toIndex","slots","removed","reorderedSlots","slot","idx","getFilteredFields","fields","searchFields","categories","getAllCategories","getFieldsByCategory","CATEGORY_ICONS","createConfigUI","setupConfigEventListeners","renderConfigUI","renderScreenTabs","renderCurrentScreen","renderFieldPicker","tabsContainer","escapeHtml","nameEl","layoutSelect","fieldsList","a","b","field","getDataField","fieldName","fieldIcon","categoriesContainer","fieldsContainer","cat","currentScreen","usedFieldIds","s","isUsed","e","target","tab","showFieldPicker","hideFieldPicker","catBtn","fieldBtn","removeBtn","showNotification","resetToDefaults","searchInput","setupDragAndDrop","draggedEl","draggedIndex","item","targetItem","picker","message","event","text","div","initDataFieldsConfig","settingsContent","SettingsView","template","content"],"mappings":"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"}