{"version":3,"file":"WorkoutProfile-CTL-5Kjf.js","sources":["../../src/components/WorkoutProfile.ts"],"sourcesContent":["import { BaseComponent } from './base/BaseComponent.js';\nimport { sharedStyles } from './styles/shared.js';\nimport type { StructuredWorkout } from '../workouts/types.js';\n\nexport class WorkoutProfile extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['current-time', 'duration'];\n    }\n\n    private _workout: StructuredWorkout | null = null;\n    private canvas: HTMLCanvasElement | null = null;\n\n    set workout(w: StructuredWorkout | null) {\n        this._workout = w;\n        this.renderCanvas();\n    }\n\n    protected getTemplate(): string {\n        return `\n            <div class=\"profile-container\">\n                <canvas></canvas>\n            </div>\n        `;\n    }\n\n    protected getStyles(): string {\n        return `\n            ${sharedStyles}\n            :host {\n                display: block;\n                width: 100%;\n                height: 100px;\n                margin: 1rem 0;\n            }\n            .profile-container {\n                width: 100%;\n                height: 100%;\n                position: relative;\n            }\n            canvas {\n                width: 100%;\n                height: 100%;\n                display: block;\n            }\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string, _newValue: string): void {\n        if (name === 'current-time') {\n            this.renderCanvas();\n        }\n    }\n\n    connectedCallback() {\n        super.connectedCallback();\n        this.canvas = this.shadowRoot!.querySelector('canvas');\n\n        // Handle resize\n        const resizeObserver = new ResizeObserver(() => {\n            this.renderCanvas();\n        });\n        resizeObserver.observe(this);\n    }\n\n    private renderCanvas() {\n        if (!this.canvas || !this._workout) return;\n\n        const rect = this.getBoundingClientRect();\n        this.canvas.width = rect.width * window.devicePixelRatio;\n        this.canvas.height = rect.height * window.devicePixelRatio;\n\n        const ctx = this.canvas.getContext('2d');\n        if (!ctx) return;\n\n        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);\n        const width = rect.width;\n        const height = rect.height;\n\n        ctx.clearRect(0, 0, width, height);\n\n        const totalDuration = this._workout.steps.reduce((acc, step) => acc + step.duration, 0);\n        const maxPower = this.getMaxPower();\n\n        // Draw steps\n        let currentX = 0;\n        const steps = this._workout.steps;\n        const currentTime = parseFloat(this.getAttribute('current-time') || '0');\n\n        steps.forEach((step) => {\n            const stepWidth = (step.duration / totalDuration) * width;\n\n            // Allow override if we computed a max\n            let val = 0;\n            if (step.target?.unit === 'percent_ftp') val = step.target.value || 0;\n            else if (step.target?.unit === 'watts')\n                val = ((step.target.value || 0) / 300) * 100; // rough convert\n            else val = 50;\n\n            const normalizedHeight = (val / maxPower) * height * 0.9;\n\n            // Determine color\n            let color = '#2196F3'; // Blue\n            if (val < 60)\n                color = '#999'; // Gray\n            else if (val < 76)\n                color = '#2196F3'; // Blue (Z2)\n            else if (val < 90)\n                color = '#4CAF50'; // Green (Z3)\n            else if (val < 105)\n                color = '#FFC107'; // Yellow (Z4)\n            else if (val < 120)\n                color = '#FF9800'; // Orange (Z5)\n            else color = '#F44336'; // Red (Z6+)\n\n            // Past/Current/Future styling\n            const stepEndTime = (currentX / width) * totalDuration + step.duration;\n            const stepStartTime = (currentX / width) * totalDuration;\n\n            // Dim past intervals\n            if (stepEndTime < currentTime) {\n                ctx.globalAlpha = 0.3;\n            } else if (stepStartTime <= currentTime && stepEndTime >= currentTime) {\n                // Current Interval\n                ctx.globalAlpha = 1.0;\n                // Highlight border?\n            } else {\n                ctx.globalAlpha = 0.6;\n            }\n\n            ctx.fillStyle = color;\n            ctx.fillRect(currentX, height - normalizedHeight, stepWidth, normalizedHeight);\n\n            // Border\n            ctx.strokeStyle = '#fff';\n            ctx.lineWidth = 1;\n            ctx.strokeRect(currentX, height - normalizedHeight, stepWidth, normalizedHeight);\n\n            currentX += stepWidth;\n        });\n\n        // Draw progress line\n        const progressX = (currentTime / totalDuration) * width;\n        ctx.globalAlpha = 1.0;\n        ctx.beginPath();\n        ctx.moveTo(progressX, 0);\n        ctx.lineTo(progressX, height);\n        ctx.strokeStyle = '#fff';\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 3]);\n        ctx.stroke();\n    }\n\n    private getMaxPower(): number {\n        if (!this._workout) return 100;\n        let max = 0;\n        this._workout.steps.forEach((step) => {\n            let val = 0;\n            if (step.target?.unit === 'percent_ftp') val = step.target.value || 0;\n            else if (step.target?.unit === 'watts')\n                val = (step.target.value || 0) / 3; // rough scale\n            else val = 100;\n            if (val > max) max = val;\n        });\n        return Math.max(max, 120); // At least 120%\n    }\n}\n"],"names":["WorkoutProfile","BaseComponent","w","sharedStyles","name","_oldValue","_newValue","rect","ctx","width","height","totalDuration","acc","step","maxPower","currentX","steps","currentTime","stepWidth","val","normalizedHeight","color","stepEndTime","stepStartTime","progressX","max"],"mappings":"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"}