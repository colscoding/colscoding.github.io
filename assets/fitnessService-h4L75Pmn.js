import{E as p,e as y,F as m,G as f}from"./feature-bluetooth-VMdsGD3M.js";import"./vendor-core-Dob3nYDb.js";async function b(){const c=await y();if(c.length===0)return;const i=new Map;if(c.forEach(a=>{const s=new Date(a.startTime).toISOString().split("T")[0];let e=0;const r=a;r.summary&&r.summary.trainingLoad?e=r.summary.trainingLoad:r.trainingLoad&&(e=r.trainingLoad),e>0&&i.set(s,(i.get(s)||0)+e)}),i.size===0)return;const d=Array.from(i.keys()).sort(),t=new Date(d[0]),u=new Date;t.setUTCHours(0,0,0,0),u.setUTCHours(0,0,0,0);const w=[];let l=0,n=0;const o=new Date(t);for(;o<=u;){const a=o.toISOString().split("T")[0],s=i.get(a)||0,{ctl:e,atl:r,tsb:g}=m(l,n,s);w.push({date:a,tss:s,ctl:Number(e.toFixed(2)),atl:Number(r.toFixed(2)),tsb:Number(g.toFixed(2))}),l=e,n=r,o.setUTCDate(o.getUTCDate()+1)}await f(w)}async function U(c,i){if(i<=0)return;const d=c.toISOString().split("T")[0];let t=await p();if(t.length===0&&(await b(),t=await p(),t.length===0)){const{ctl:n,atl:o,tsb:a}=m(0,0,i);await f([{date:d,tss:i,ctl:Number(n.toFixed(2)),atl:Number(o.toFixed(2)),tsb:Number(a.toFixed(2))}]);return}const u=t.findIndex(n=>n.date===d);let w=!1,l=0;if(u!==-1)t[u].tss+=i,l=u;else{const n=t[t.length-1],o=new Date(n.date),a=new Date(d);if(a>o)w=!0,l=t.length;else if(a<new Date(t[0].date)){await b();return}else{await b();return}}if(w){const n=t[t.length-1];let o=n.ctl,a=n.atl;const s=new Date(n.date);s.setUTCDate(s.getUTCDate()+1);const e=new Date(d),r=new Date;r.setUTCHours(0,0,0,0);const g=e>r?e:r,D=[];for(;s<=g;){const C=s.toISOString().split("T")[0],x=C===d?i:0,{ctl:T,atl:h,tsb:S}=m(o,a,x);D.push({date:C,tss:x,ctl:Number(T.toFixed(2)),atl:Number(h.toFixed(2)),tsb:Number(S.toFixed(2))}),o=T,a=h,s.setUTCDate(s.getUTCDate()+1)}await f(D)}else{let n=l>0?t[l-1].ctl:0,o=l>0?t[l-1].atl:0;const a=[];for(let s=l;s<t.length;s++){const e=t[s],{ctl:r,atl:g,tsb:D}=m(n,o,e.tss);e.ctl=Number(r.toFixed(2)),e.atl=Number(g.toFixed(2)),e.tsb=Number(D.toFixed(2)),a.push(e),n=e.ctl,o=e.atl}await f(a)}}async function v(){let c=await p();return c.length===0&&(await b(),c=await p()),c}export{U as addWorkoutToPMC,v as getClientPMCData,b as recalculatePMC};
//# sourceMappingURL=fitnessService-h4L75Pmn.js.map
