(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const C=e=>{const t=Math.floor(e/1e3),n=Math.floor(t/3600),i=Math.floor(t%3600/60),o=t%60;return`${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},$=e=>{const t=document.getElementById("startStop"),n=document.getElementById("time"),i=document.getElementById("metricsTable");setInterval(()=>{let o="00:00:00";if(e.startTime&&e.running){const s=Date.now()-e.startTime;o=C(s)}else if(e.startTime&&e.endTime){const s=e.endTime-e.startTime;o=C(s)}n.textContent!==o&&(n.textContent=o);const c=e.running?"â¹ï¸":"â–¶ï¸";t.textContent!==c&&(t.textContent=c),e.running?i.classList.remove("paused"):i.classList.add("paused")},100),t.addEventListener("click",()=>{if(e.running)e.running=!1,e.endTime=Date.now(),t.textContent="â–¶ï¸";else{if(e.endTime){const o=Date.now()-e.endTime;e.startTime+=o,e.endTime=null}else e.startTime=Date.now();e.running=!0,t.textContent="â¹ï¸"}}),n.addEventListener("click",()=>{t.click()})},T=(e,t)=>{const n=[];let i=0;for(const o of t){for(;i<e.length&&e[i].timestamp<o;)i++;const c=i-1;let s;const r=i>=e.length;if(c<0)s=e?.[i];else if(r)s=e?.[c];else{const a=e?.[c]?.timestamp??0,p=e?.[i]?.timestamp??0;s=o-a<=p-o?e?.[c]:e?.[i]}s?.timestamp&&Math.abs(s.timestamp-o)<1e3?n.push(s.value):n.push(null)}return n},k=e=>{const t=[e.heartrate,e.cadence,e.power];if(!t.some(d=>d.length>0))return[];const i=t.map(d=>d.length>0?d[0].timestamp:1/0),o=Math.min(...i),c=Math.max(...t.map(d=>d.length>0?d[d.length-1].timestamp:-1/0)),s=1e3,r=[];let a=o;for(;a<=c;)r.push(a),a+=s;const p=T(e.heartrate,r),m=T(e.cadence,r),l=T(e.power,r),u=[];for(let d=0;d<r.length;d++){const g={timestamp:r[d],heartrate:p[d]??null,cadence:m[d]??null,power:l[d]??null};u.push(g)}return u},D=e=>{const t=k(e);if(!t||t.length===0)return"";const n="timestamp,power,cadence,heartrate",i=t.map(o=>{const c=new Date(o.timestamp).toISOString(),s=o.power!==null?Math.round(o.power):"",r=o.cadence!==null?Math.round(o.cadence):"",a=o.heartrate!==null?Math.round(o.heartrate):"";return`${c},${s},${r},${a}`});return[n,...i].join(`
`)},P=e=>e!==null?`<HeartRateBpm><Value>${Math.round(e)}</Value></HeartRateBpm>`:"",M=e=>e!==null?`<Cadence>${Math.round(e)}</Cadence>`:"",U=e=>e===null?"":`<Extensions>
              <TPX xmlns="http://www.garmin.com/xmlschemas/ActivityExtension/v2">
                <Watts>${Math.round(e)}</Watts>
              </TPX>
            </Extensions>`,R=e=>{const t=new Date(e.timestamp).toISOString(),n=[];return e.heartrate!==null&&n.push(P(e.heartrate)),e.cadence!==null&&n.push(M(e.cadence)),e.power!==null&&n.push(U(e.power)),`
<Trackpoint>
    <Time>${t}</Time>
    ${n.join(`
`)}
</Trackpoint>
    `.trim()},_=e=>{const t=k(e);if(!t||t.length===0)return"";const n=t[0].timestamp,i=t[t.length-1].timestamp,o=Math.round((i-n)/1e3),c=new Date(n).toISOString();return`<?xml version="1.0" encoding="UTF-8"?>
    <TrainingCenterDatabase xmlns="http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2">
        <Activities>
            <Activity Sport="Biking">
                <Id>${c}</Id>
                <Lap StartTime="${c}">
                    <TotalTimeSeconds>${o}</TotalTimeSeconds>
                    <Calories>0</Calories>
                    <Intensity>Active</Intensity>
                    <TriggerMethod>Manual</TriggerMethod>
                    <Track>
${t.map(R).join(`
`)}
                    </Track>
                </Lap>
            </Activity>
        </Activities>
    </TrainingCenterDatabase>`},O=({measurementsState:e,timeState:t})=>{document.getElementById("discardButton").addEventListener("click",()=>{confirm("Are you sure you want to discard this workout?")&&(t.running=!1,t.startTime=null,t.endTime=null,e.power=[],e.heartrate=[],e.cadence=[])})},A=e=>{document.getElementById("exportData").addEventListener("click",()=>{try{const n=new Date,i=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}-${String(n.getHours()).padStart(2,"0")}-${String(n.getMinutes()).padStart(2,"0")}-${String(n.getSeconds()).padStart(2,"0")}`,o={power:e.power,heartrate:e.heartrate,cadence:e.cadence},c=JSON.stringify(o,null,2),s=new Blob([c],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`bike-measurements-${i}.json`,a.click(),URL.revokeObjectURL(r);const p=_(e),m=new Blob([p],{type:"application/xml"}),l=URL.createObjectURL(m),u=document.createElement("a");u.href=l,u.download=`bike-workout-${i}.tcx`,u.click(),URL.revokeObjectURL(l);const d=D(e),g=new Blob([d],{type:"text/csv"}),f=URL.createObjectURL(g),h=document.createElement("a");h.href=f,h.download=`bike-workout-${i}.csv`,h.click(),URL.revokeObjectURL(f)}catch(n){console.error("Error exporting data:",n)}})};function v(e){const t=document.getElementById(e);return t||console.warn(`Element with ID "${e}" not found in DOM`),t}const j=v("connectPower"),N=v("connectHeartrate"),W=v("connectCadence"),H=v("power"),q=v("heartrate"),F=v("cadence"),y={power:{display:H,connect:j},heartrate:{display:q,connect:N},cadence:{display:F,connect:W}},V=({connectionsState:e,measurementsState:t})=>{const n=o=>{const c=y?.[o]?.display;if(!c||!e?.[o])return;const s="--";if(!e?.[o]?.isConnected){c.textContent=s;return}const r=t[o];if(!Array.isArray(r)||r.length===0){c.textContent=s;return}const a=r[r.length-1];if(!a||typeof a.value!="number"||typeof a.timestamp!="number"){c.textContent=s;return}if(Date.now()-a.timestamp>5e3){c.textContent=s;return}c.textContent=a.value},i=["power","heartrate","cadence"];setInterval(()=>{i.forEach(n)},100)},J=async()=>{const e=[];let t=null,n=null;const i=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_speed_and_cadence"]}],optionalServices:["cycling_speed_and_cadence"]}),s=await(await(await i.gatt.connect()).getPrimaryService("cycling_speed_and_cadence")).getCharacteristic("csc_measurement");return await s.startNotifications(),s.addEventListener("characteristicvaluechanged",r=>{const a=r.target.value,p=a.getUint8(0);if(p&2){let m=1;p&1&&(m=7);const l=a.getUint16(m,!0),u=a.getUint16(m+2,!0);if(t!==null&&n!==null){let d=l-t,g=u-n;if(d<0&&(d+=65536),g<0&&(g+=65536),g>0){const f=g/1024,h=Math.round(d/f*60);if(h>=0&&h<300){const L={timestamp:Date.now(),value:h};e.forEach(I=>I(L))}}}t=l,n=u}}),{disconnect:()=>{s.stopNotifications(),i.gatt.disconnect()},addListener:r=>{e.push(r)}}},X=async()=>J(),K=async()=>{const e=[],t=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["heart_rate"]}),o=await(await(await t.gatt.connect()).getPrimaryService("heart_rate")).getCharacteristic("heart_rate_measurement");return await o.startNotifications(),o.addEventListener("characteristicvaluechanged",c=>{const s=c.target.value,r=s.getUint8(0);let a;r&1?a=s.getUint16(1,!0):a=s.getUint8(1);const p={timestamp:Date.now(),value:a};e.forEach(m=>m(p))}),{disconnect:()=>{o.stopNotifications(),t.gatt.disconnect()},addListener:c=>{e.push(c)}}},Y=async()=>K(),z=async()=>{const e=[],t=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_power"]}],optionalServices:["cycling_power"]}),o=await(await(await t.gatt.connect()).getPrimaryService("cycling_power")).getCharacteristic("cycling_power_measurement");return await o.startNotifications(),o.addEventListener("characteristicvaluechanged",c=>{const r=c.target.value.getInt16(2,!0),a={timestamp:Date.now(),value:r};e.forEach(p=>p(a))}),{disconnect:()=>{o.stopNotifications(),t.gatt.disconnect()},addListener:c=>{e.push(c)}}},G=async()=>z(),Q=({connectionsState:e,measurementsState:t})=>{const n=["power","heartrate","cadence"],i={power:"âš¡",heartrate:"â¤ï¸",cadence:"ðŸš´"},o=s=>{if(typeof e[s].disconnect=="function"){e[s].disconnect(),e[s].disconnect=null,e[s].isConnected=!1;const r=y[s]?.connect;r?.textContent&&(r.textContent=`${i[s]} Connect ${s.charAt(0).toUpperCase()+s.slice(1)}`);const a=y?.[s]?.display;a?.textContent&&(a.textContent="--")}},c=async s=>{const r={power:G,heartrate:Y,cadence:X};try{const{disconnect:a,addListener:p}=await r[s]();e[s].disconnect=a,e[s].isConnected=!0,p(l=>{t.add(s,l)});const m=y[s]?.connect;m?.textContent&&(m.textContent=`${i[s]} Disconnect ${s.charAt(0).toUpperCase()+s.slice(1)}`)}catch(a){console.error(`Error connecting ${s}:`,a)}};n.forEach(s=>{const r=y[s]?.connect;r&&r.addEventListener("click",async()=>{e[s].isConnected?o(s):c(s)})})};class Z{constructor(){this.heartrate=[],this.power=[],this.cadence=[]}addHeartrate({timestamp:t,value:n}){if(n<=0||n>=300){console.warn(`Invalid heartrate value: ${n}`);return}this.heartrate.push({timestamp:t,value:n})}addPower({timestamp:t,value:n}){if(n<0||n>=3e3){console.warn(`Invalid power value: ${n}`);return}this.power.push({timestamp:t,value:n})}addCadence({timestamp:t,value:n}){if(n<0||n>=300){console.warn(`Invalid cadence value: ${n}`);return}this.cadence.push({timestamp:t,value:n})}add(t,n){if(t==="heartrate")this.addHeartrate(n);else if(t==="power")this.addPower(n);else if(t==="cadence")this.addCadence(n);else throw new Error(`Unknown measurement type: ${t}`)}}const ee=()=>({measurementsState:new Z,connectionsState:{power:{isConnected:!1,disconnect:null},heartrate:{isConnected:!1,disconnect:null},cadence:{isConnected:!1,disconnect:null}},timeState:{running:!1,startTime:null,endTime:null}}),te=()=>{let e=null;const t=async()=>{try{"wakeLock"in navigator&&(e=await navigator.wakeLock.request("screen"),console.log("Screen wake lock activated"),e.addEventListener("release",()=>{console.log("Screen wake lock released")}))}catch(n){console.error("Wake lock request failed:",n)}};document.visibilityState==="visible"&&t(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&t()})},ne="modulepreload",se=function(e,t){return new URL(e,t).href},B={},oe=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){let p=function(m){return Promise.all(m.map(l=>Promise.resolve(l).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};const s=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");o=p(n.map(m=>{if(m=se(m,i),m in B)return;B[m]=!0;const l=m.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(i)for(let g=s.length-1;g>=0;g--){const f=s[g];if(f.href===m&&(!l||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${m}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":ne,l||(d.as="script"),d.crossOrigin="",d.href=m,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((g,f)=>{d.addEventListener("load",g),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${m}`)))})}))}function c(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return o.then(s=>{for(const r of s||[])r.status==="rejected"&&c(r.reason);return t().catch(c)})};function ce(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:i,onRegistered:o,onRegisteredSW:c,onRegisterError:s}=e;let r,a;const p=async(l=!0)=>{await a};async function m(){if("serviceWorker"in navigator){if(r=await oe(async()=>{const{Workbox:l}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:l}},[],import.meta.url).then(({Workbox:l})=>new l("./sw.js",{scope:"./",type:"classic"})).catch(l=>{s?.(l)}),!r)return;r.addEventListener("activated",l=>{(l.isUpdate||l.isExternal)&&window.location.reload()}),r.addEventListener("installed",l=>{l.isUpdate||i?.()}),r.register({immediate:t}).then(l=>{c?c("./sw.js",l):o?.(l)}).catch(l=>{s?.(l)})}}return a=m(),p}const re=()=>{const e=ce({onNeedRefresh(){ie(e)},onOfflineReady(){console.log("App ready to work offline")},onRegisteredSW(t,n){console.log("Service Worker registered successfully:",t),n&&setInterval(()=>{n.update()},36e5)},onRegisterError(t){console.log("Service Worker registration failed:",t)}})},ie=e=>{const t=document.getElementById("updateNotification");t&&(t.style.display="block",document.getElementById("updateButton").addEventListener("click",()=>{e(!0)},{once:!0}),document.getElementById("dismissUpdate").addEventListener("click",()=>{t.style.display="none"},{once:!0}))};let w=null;const ae=()=>{window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),w=e,le()}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed successfully"),w=null,S()})},le=()=>{const e=document.getElementById("installPrompt");e&&(e.style.display="block",document.getElementById("installButton").addEventListener("click",async()=>{if(!w)return;w.prompt();const{outcome:i}=await w.userChoice;console.log(`User response to the install prompt: ${i}`),w=null,S()}),document.getElementById("dismissInstall").addEventListener("click",()=>{S()}))},S=()=>{const e=document.getElementById("installPrompt");e&&(e.style.display="none")};function de(){const e=document.getElementById("settingsButton"),t=document.getElementById("settingsModal"),n=document.getElementById("closeSettingsModal"),i=document.getElementById("saveSettings"),o=document.getElementById("settingPower"),c=document.getElementById("settingCadence"),s=document.getElementById("settingHeartrate"),r=()=>{const u=JSON.parse(localStorage.getItem("bpt-settings"))||{power:!0,cadence:!0,heartrate:!0};o.checked=u.power,c.checked=u.cadence,s.checked=u.heartrate,p(u)},a=()=>{const u={power:o.checked,cadence:c.checked,heartrate:s.checked};localStorage.setItem("bpt-settings",JSON.stringify(u)),p(u),l()},p=u=>{const d=(g,f)=>{document.querySelectorAll(`.metric-group-${g}`).forEach(L=>{L.style.display=f?"flex":"none"})};d("power",u.power),d("cadence",u.cadence),d("heartrate",u.heartrate)},m=()=>{t.style.display="flex";const u=document.querySelector("header details");u&&u.removeAttribute("open")},l=()=>{t.style.display="none"};e.addEventListener("click",m),n.addEventListener("click",l),i.addEventListener("click",a),window.addEventListener("click",u=>{u.target===t&&l()}),r()}function ue({measurementsState:e,connectionsState:t}){typeof window<"u"&&(window.bike=e,window.connectionsState=t)}const{measurementsState:E,connectionsState:x,timeState:b}=ee();ue({measurementsState:E,connectionsState:x});$(b);V({connectionsState:x,measurementsState:E});Q({connectionsState:x,measurementsState:E});O({measurementsState:E,timeState:b});A(E);te();re();ae();de();
//# sourceMappingURL=index-COHqODR7.js.map
