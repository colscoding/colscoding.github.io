const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fitnessService-CjA3sBbD.js","assets/vendor-core-Dob3nYDb.js","assets/web-DfIFv0v1.js"])))=>i.map(i=>d[i]);
import{o as Ue}from"./vendor-core-Dob3nYDb.js";const Qe="modulepreload",Xe=function(n){return"/"+n},ve={},J=function(t,e,s){let a=Promise.resolve();if(e&&e.length>0){let d=function(f){return Promise.all(f.map(m=>Promise.resolve(m).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");a=d(e.map(f=>{if(f=Xe(f),f in ve)return;ve[f]=!0;const m=f.endsWith(".css"),c=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${c}`))return;const o=document.createElement("link");if(o.rel=m?"stylesheet":Qe,m||(o.as="script"),o.crossOrigin="",o.href=f,l&&o.setAttribute("nonce",l),document.head.appendChild(o),m)return new Promise((u,h)=>{o.addEventListener("load",u),o.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${f}`)))})}))}function r(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})};class et{db=null;initialized=!1;async initialize(){if(!this.initialized)try{this.db=await Ue("bpt-ftp-history",1,{upgrade(t){t.objectStoreNames.contains("history")||t.createObjectStore("history",{keyPath:"date"}).createIndex("date","date")}}),this.initialized=!0}catch(t){console.error("Failed to initialize FTP history DB",t)}}async addEntry(t){if(this.db||await this.initialize(),!!this.db)try{await this.db.put("history",t)}catch(e){console.error("Failed to add FTP history entry",e)}}async getHistory(){if(this.db||await this.initialize(),!this.db)return[];try{return(await this.db.getAllFromIndex("history","date")).sort((e,s)=>s.date-e.date)}catch(t){return console.error("Failed to get FTP history",t),[]}}async getLatestEntry(){if(this.db||await this.initialize(),!!this.db)try{return(await this.db.transaction("history").store.index("date").openCursor(null,"prev"))?.value}catch{return}}}const oe=new et,ie={weight:75,height:175,age:30,gender:"other",ftp:200,maxHeartrate:190,restingHeartrate:60,units:"metric",dateFormat:"ISO",clockFormat:"24h",energyMethod:"combined",gapThreshold:20,stalenessThreshold:5,powerZoneModel:"7",powerZones:[{name:"Recovery",min:0,max:55,color:"#808080"},{name:"Endurance",min:55,max:75,color:"#2196f3"},{name:"Tempo",min:75,max:90,color:"#4caf50"},{name:"Threshold",min:90,max:105,color:"#ffeb3b"},{name:"VO2max",min:105,max:120,color:"#ff9800"},{name:"Anaerobic",min:120,max:150,color:"#f44336"},{name:"Neuromuscular",min:150,max:1e3,color:"#9c27b0"}],heartrateZones:[{name:"Recovery",min:0,max:60,color:"#808080"},{name:"Endurance",min:60,max:70,color:"#2196f3"},{name:"Tempo",min:70,max:80,color:"#4caf50"},{name:"Threshold",min:80,max:90,color:"#ff9800"},{name:"VO2max",min:90,max:100,color:"#f44336"}]};class tt{settings={...ie};listeners=[];db=null;initialized=!1;async initialize(){if(!this.initialized){try{this.db=await Ue("bpt-settings",1,{upgrade(e){e.createObjectStore("settings")}});const t=await this.db.get("settings","user");if(t)this.settings={...ie,...t};else try{const e=localStorage.getItem("bpt-user-profile");if(e){const s=JSON.parse(e);s.ftp&&(this.settings.ftp=Number(s.ftp)),s.maxHr&&(this.settings.maxHeartrate=Number(s.maxHr)),s.weight&&(this.settings.weight=Number(s.weight))}}catch(e){console.warn("Failed to migrate legacy settings:",e)}}catch(t){console.warn("Settings storage unavailable, using defaults/in-memory:",t)}this.initialized=!0,this.notifyListeners()}}get(t){return this.settings[t]}getAll(){return{...this.settings}}async set(t,e){t==="ftp"&&e!==this.settings.ftp&&oe.addEntry({date:Date.now(),ftp:e,source:"manual"}),this.settings[t]=e,await this.persist(),this.notifyListeners()}async setMultiple(t){t.ftp&&t.ftp!==this.settings.ftp&&oe.addEntry({date:Date.now(),ftp:t.ftp,source:"manual"}),this.settings={...this.settings,...t},await this.persist(),this.notifyListeners()}async updateFtp(t,e="manual"){t!==this.settings.ftp&&(await this.set("ftp",t),oe.addEntry({date:Date.now(),ftp:t,source:e}))}async reset(){this.settings={...ie},await this.persist(),this.notifyListeners()}onChange(t){return this.listeners.push(t),()=>{const e=this.listeners.indexOf(t);e!==-1&&this.listeners.splice(e,1)}}async persist(){if(this.db)try{await this.db.put("settings",this.settings,"user")}catch(t){console.error("Failed to save settings:",t)}}notifyListeners(){const t=this.getAll();for(const e of this.listeners)try{e(t)}catch(s){console.error("Settings listener error:",s)}}}const nt=new tt;function st(n){if(!n||n.length<30)return null;const t=30;let e=0;for(let i=0;i<t;i++)e+=n[i];let s=0,a=0;for(let i=t-1;i<n.length;i++){i>=t&&(e=e-n[i-t]+n[i]);const l=e/t;s+=Math.pow(l,4),a++}if(a===0)return null;const r=s/a;return Math.round(Math.pow(r,.25))}function rt(n,t){return!t||t===0?0:Number((n/t).toFixed(2))}function at(n,t){return!t||t===0?1:Number((n/t).toFixed(2))}function ot(n){const t=n.reduce((e,s)=>e+s,0);return Math.round(t/1e3)}function it(n,t){return!t||t===0?0:Number((n/t).toFixed(2))}function ct(n,t,e,s){if(!s||s===0)return 0;const a=n*t*e/(s*3600)*100;return Math.round(a)}function an(n,t,e){const r=n+(e-n)/42,i=t+(e-t)/7,l=r-i;return{ctl:r,atl:i,tsb:l}}function lt(n,t,e,s,a){if(!n||n<=0||!t||t<=0||!e||e<=100||!a||a<=0)return null;const r=s;if(t<=r+10||t>=e)return null;const i=n*10.8+a*7,l=e-r;let f=(t-r)/l;if(f>1&&(f=1),f<.5)return null;const c=i/f/a;return Math.round(c)}class ut{static calculateLaps(t){if(!t.laps||t.laps.length===0)return[];const e=[],s=[...t.power].sort((c,o)=>c.timestamp-o.timestamp),a=[...t.heartrate].sort((c,o)=>c.timestamp-o.timestamp),r=[...t.cadence].sort((c,o)=>c.timestamp-o.timestamp),i=[...t.speed].sort((c,o)=>c.timestamp-o.timestamp),l=[...t.distance].sort((c,o)=>c.timestamp-o.timestamp),d=Math.min(s[0]?.timestamp||1/0,a[0]?.timestamp||1/0,r[0]?.timestamp||1/0);if(d===1/0)return[];let f=d;t.laps.forEach(c=>{const o=c.timestamp,u=s.filter(b=>b.timestamp>=f&&b.timestamp<=o),h=a.filter(b=>b.timestamp>=f&&b.timestamp<=o),w=r.filter(b=>b.timestamp>=f&&b.timestamp<=o),g=i.filter(b=>b.timestamp>=f&&b.timestamp<=o),p=l.filter(b=>b.timestamp<f),v=l.filter(b=>b.timestamp>=f&&b.timestamp<=o);let E=0;if(v.length>0){const b=p.length>0?p[p.length-1].value:0;E=v[v.length-1].value-b}e.push({number:c.number,startTime:f,endTime:o,duration:o-f,avgPower:this.average(u),maxPower:this.max(u),avgHeartRate:this.average(h),maxHeartRate:this.max(h),avgCadence:this.average(w),avgSpeed:this.average(g),distance:E}),f=o});const m=Math.max(s[s.length-1]?.timestamp||0,a[a.length-1]?.timestamp||0);if(m>f+1e3){const c=s.filter(v=>v.timestamp>=f),o=a.filter(v=>v.timestamp>=f),u=r.filter(v=>v.timestamp>=f),h=i.filter(v=>v.timestamp>=f),w=l.filter(v=>v.timestamp<f),g=l.filter(v=>v.timestamp>=f);let p=0;if(g.length>0){const v=w.length>0?w[w.length-1].value:0;p=g[g.length-1].value-v}e.push({number:e.length+1,startTime:f,endTime:m,duration:m-f,avgPower:this.average(c),maxPower:this.max(c),avgHeartRate:this.average(o),maxHeartRate:this.max(o),avgCadence:this.average(u),avgSpeed:this.average(h),distance:p})}return e}static average(t){if(t.length===0)return 0;const e=t.reduce((s,a)=>s+a.value,0);return Math.round(e/t.length)}static max(t){return t.length===0?0:Math.max(...t.map(e=>e.value))}}function dt(n,t,e,s,a){const r=y=>Array.isArray(y.laps);let i=[];r(e)?i=ut.calculateLaps(e):i=[];const l=y=>{if(y.length===0)return{avg:null,max:null,count:0};const S=y.map(R=>R.value),U=S.reduce((R,V)=>R+V,0);return{avg:Math.round(U/S.length),max:Math.max(...S),count:S.length}},d=l(e.power),f=l(e.heartrate),m=l(e.cadence),c=e.power.map(y=>y.value),o=[],u=[1,5,10,30,60,300,1200,3600],h=y=>{if(c.length<y)return 0;let S=0;for(let R=0;R<y;R++)S+=c[R];let U=S/y;for(let R=y;R<c.length;R++)S=S-c[R-y]+c[R],S/y>U&&(U=S/y);return Math.round(U)};for(const y of u)c.length>=y&&o.push({duration:y,watts:h(y)});let w=0,g=0,p=0,v=0,E=0;c.length>0&&(E=ot(c));let b=200,D=190,I=60,T=a;s&&(s.getFtp()&&(b=s.getFtp()),s.getMaxHr()&&(D=s.getMaxHr()));try{if(typeof localStorage<"u"){const y=localStorage.getItem("bpt-user-profile");if(y){const S=JSON.parse(y);!s?.getFtp()&&S.ftp&&(b=S.ftp),!s?.getMaxHr()&&S.maxHr&&(D=S.maxHr),!T&&S.weight&&(T=S.weight)}}}catch(y){console.warn("Error reading profile",y)}let C=null;if(d.avg&&f.avg&&T&&(C=lt(d.avg,f.avg,D,I,T)),c.length>0){const y=st(c);if(y){p=y,g=rt(y,b);const S=(t-n)/1e3;w=ct(S,y,g,b),d.avg&&(v=at(y,d.avg))}}const _={duration:t-n,startTime:n,endTime:t,vo2MaxEstimation:C,power:{...d,wattsPerKg:T&&T>0&&d.avg?it(d.avg,T):void 0},heartrate:f,cadence:m,powerCurve:o.length>0?o:void 0,trainingLoad:w>0?Math.round(w):void 0,intensityFactor:g>0?parseFloat(g.toFixed(2)):void 0,normalizedPower:p>0?p:void 0,variabilityIndex:v>0?v:void 0,work:E>0?E:void 0,laps:i};if(s){const y=s.getPowerZoneDistribution(),S=s.getHrZoneDistribution();y.totalTimeMs>0&&(_.powerZoneDistribution=y),S.totalTimeMs>0&&(_.hrZoneDistribution=S)}return _}const ft="BikeTrackerDB",ht=5,B="activeWorkout",$="completedWorkouts",H="rawDebugData",F="pmcStats";let Z=null;async function x(){return Z||new Promise((n,t)=>{const e=indexedDB.open(ft,ht);e.onerror=()=>{console.error("Failed to open IndexedDB:",e.error),t(e.error)},e.onsuccess=()=>{Z=e.result,n(Z)},e.onupgradeneeded=s=>{const a=s.target.result;if(a.objectStoreNames.contains(B)||a.createObjectStore(B,{keyPath:"id"}),a.objectStoreNames.contains($)||a.createObjectStore($,{keyPath:"id"}).createIndex("startTime","startTime",{unique:!1}),!a.objectStoreNames.contains(H)){const r=a.createObjectStore(H,{keyPath:"id",autoIncrement:!0});r.createIndex("timestamp","timestamp",{unique:!1}),r.createIndex("sensor","sensor",{unique:!1})}a.objectStoreNames.contains(F)||a.createObjectStore(F,{keyPath:"date"})}})}async function gt(){const n=await x();return new Promise((t,e)=>{const r=n.transaction([F],"readonly").objectStore(F).getAll();r.onsuccess=()=>t(r.result||[]),r.onerror=()=>e(r.error)})}async function wt(){const n=await x();return new Promise((t,e)=>{const r=n.transaction([F],"readwrite").objectStore(F).clear();r.onsuccess=()=>t(),r.onerror=()=>e(r.error)})}async function mt(n){const t=await x();return new Promise((e,s)=>{const a=t.transaction([F],"readwrite"),r=a.objectStore(F);let i=0,l=0;if(n.length===0){e();return}n.forEach(d=>{const f=r.put(d);f.onsuccess=()=>{i++,i+l===n.length&&(l>0?s(new Error("Some entries failed to save")):e())},f.onerror=()=>{l++,i+l===n.length&&s(new Error("Entries failed to save"))}}),a.oncomplete=()=>{e()},a.onerror=()=>s(a.error)})}async function Ie(n,t){try{const e=await x(),s={timestamp:Date.now(),sensor:n,data:t};return new Promise((a,r)=>{const d=e.transaction([H],"readwrite").objectStore(H).add(s);d.onsuccess=()=>a(),d.onerror=()=>r(d.error)})}catch(e){console.warn("Could not save debug log:",e)}}async function he(){try{const n=await x();return new Promise((t,e)=>{const i=n.transaction([H],"readonly").objectStore(H).index("timestamp").getAll();i.onsuccess=()=>t(i.result||[]),i.onerror=()=>e(i.error)})}catch(n){return console.warn("Could not load debug logs:",n),[]}}async function ke(){try{const n=await x();return new Promise((t,e)=>{const r=n.transaction([H],"readwrite").objectStore(H).clear();r.onsuccess=()=>t(),r.onerror=()=>e(r.error)})}catch(n){console.warn("Could not clear debug logs:",n)}}async function ge(n,t){try{const e=await x(),s={id:"current",startTime:t??Date.now(),lastUpdated:Date.now(),heartrate:n.heartrate,power:n.power,cadence:n.cadence,speed:n.speed,distance:n.distance,altitude:n.altitude,gps:n.gps,treadmill:n.treadmill||[],laps:n.laps||[]};return new Promise((a,r)=>{const d=e.transaction([B],"readwrite").objectStore(B).put(s);d.onsuccess=()=>a(),d.onerror=()=>r(d.error)})}catch(e){console.warn("Could not save active workout:",e)}}async function xe(){try{const n=await x();return new Promise((t,e)=>{const r=n.transaction([B],"readwrite").objectStore(B).delete("current");r.onsuccess=()=>t(),r.onerror=()=>e(r.error)})}catch(n){console.warn("Could not clear active workout:",n)}}async function we(){try{const n=await x();return new Promise((t,e)=>{const r=n.transaction([B],"readonly").objectStore(B).get("current");r.onsuccess=()=>{if(r.result){const i=r.result;i.treadmill||(i.treadmill=[]),i.laps||(i.laps=[]),t(i)}else t(null)},r.onerror=()=>e(r.error)})}catch(n){return console.warn("Could not load active workout:",n),null}}async function Oe(){if(navigator.storage&&navigator.storage.estimate)try{const n=await navigator.storage.estimate();if(n.quota&&n.usage){const t=n.usage/n.quota*100;t>80&&alert(`⚠️ Storage Warning: You have used ${t.toFixed(1)}% of available storage. Please export and delete old workouts.`)}}catch(n){console.warn("Storage estimate failed",n)}}async function qe(n,t,e,s){await Oe();const a=`workout_${t}`;try{const r=await x(),i={id:a,startTime:t,lastUpdated:e,isCompleted:!0,measurements:{...n},synced:!1,summary:s};return new Promise((l,d)=>{const c=r.transaction([$],"readwrite").objectStore($).put(i);c.onsuccess=()=>l(a),c.onerror=()=>d(c.error)})}catch(r){throw console.error("Failed to save completed workout:",r),r}}async function $e(){try{const n=await x();return new Promise((t,e)=>{const i=n.transaction([$],"readonly").objectStore($).index("startTime").getAll();i.onsuccess=()=>{t((i.result||[]).reverse())},i.onerror=()=>e(i.error)})}catch(n){return console.warn("Could not load workout history:",n),[]}}let G=null,j=null;const vt=(n,t,e)=>{j={measurements:n,startTime:t},G||(G=setTimeout(async()=>{j&&(await ge(j.measurements,j.startTime),j=null),G=null},2e3))},je=async()=>{G&&(clearTimeout(G),G=null),j&&(await ge(j.measurements,j.startTime),j=null)},pt=()=>typeof window<"u"&&"indexedDB"in window,yt=async()=>{await je();const n=await we();if(!n)return null;const t=a=>(a||[]).map(r=>typeof r=="number"?{value:r}:{value:r.value});let e;const s=nt.getAll();if(e=dt(n.startTime,n.lastUpdated,{power:t(n.power),heartrate:t(n.heartrate),cadence:t(n.cadence)},void 0,s.weight),await qe({heartrate:n.heartrate,power:n.power,cadence:n.cadence,speed:n.speed,distance:n.distance,altitude:n.altitude,gps:n.gps,treadmill:n.treadmill,laps:n.laps},n.startTime,n.lastUpdated,e),e.trainingLoad>0)try{const{addWorkoutToPMC:a}=await J(async()=>{const{addWorkoutToPMC:r}=await import("./fitnessService-CjA3sBbD.js");return{addWorkoutToPMC:r}},__vite__mapDeps([0,1]));await a(new Date(n.startTime),e.trainingLoad)}catch(a){console.error("Failed to update PMC:",a)}return await xe(),`workout_${n.startTime}`},bt=async()=>!!await we(),Et=$e;async function St(n){try{const t=await x();return new Promise((e,s)=>{const i=t.transaction([$],"readonly").objectStore($).get(n);i.onsuccess=()=>e(i.result),i.onerror=()=>s(i.error)})}catch(t){console.warn("Could not load workout:",t);return}}async function Lt(n){try{const t=await x();return new Promise((e,s)=>{const i=t.transaction([$],"readwrite").objectStore($).delete(n);i.onsuccess=()=>e(),i.onerror=()=>s(i.error)})}catch(t){throw console.warn("Could not delete workout:",t),t}}const on=Object.freeze(Object.defineProperty({__proto__:null,archiveWorkout:yt,checkStorageQuota:Oe,clearActiveWorkout:xe,clearDebugLogs:ke,clearPMCData:wt,deleteCompletedWorkout:Lt,flushPendingSave:je,getCompletedWorkout:St,getCompletedWorkouts:Et,getDebugLogs:he,getPMCData:gt,getWorkoutHistory:$e,hasRecoverableWorkout:bt,isIndexedDBSupported:pt,loadActiveWorkout:we,openDatabase:x,saveActiveWorkout:ge,saveCompletedWorkout:qe,saveDebugLog:Ie,savePMCData:mt,throttledSave:vt},Symbol.toStringTag,{value:"Module"}));var Y;(function(n){n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE"})(Y||(Y={}));class ce extends Error{constructor(t,e,s){super(t),this.message=t,this.code=e,this.data=s}}const Ct=n=>{var t,e;return n?.androidBridge?"android":!((e=(t=n?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||e===void 0)&&e.bridge?"ios":"web"},Pt=n=>{const t=n.CapacitorCustomPlatform||null,e=n.Capacitor||{},s=e.Plugins=e.Plugins||{},a=()=>t!==null?t.name:Ct(n),r=()=>a()!=="web",i=c=>{const o=f.get(c);return!!(o?.platforms.has(a())||l(c))},l=c=>{var o;return(o=e.PluginHeaders)===null||o===void 0?void 0:o.find(u=>u.name===c)},d=c=>n.console.error(c),f=new Map,m=(c,o={})=>{const u=f.get(c);if(u)return console.warn(`Capacitor plugin "${c}" already registered. Cannot register plugins twice.`),u.proxy;const h=a(),w=l(c);let g;const p=async()=>(!g&&h in o?g=typeof o[h]=="function"?g=await o[h]():g=o[h]:t!==null&&!g&&"web"in o&&(g=typeof o.web=="function"?g=await o.web():g=o.web),g),v=(C,_)=>{var y,S;if(w){const U=w?.methods.find(R=>_===R.name);if(U)return U.rtype==="promise"?R=>e.nativePromise(c,_.toString(),R):(R,V)=>e.nativeCallback(c,_.toString(),R,V);if(C)return(y=C[_])===null||y===void 0?void 0:y.bind(C)}else{if(C)return(S=C[_])===null||S===void 0?void 0:S.bind(C);throw new ce(`"${c}" plugin is not implemented on ${h}`,Y.Unimplemented)}},E=C=>{let _;const y=(...S)=>{const U=p().then(R=>{const V=v(R,C);if(V){const z=V(...S);return _=z?.remove,z}else throw new ce(`"${c}.${C}()" is not implemented on ${h}`,Y.Unimplemented)});return C==="addListener"&&(U.remove=async()=>_()),U};return y.toString=()=>`${C.toString()}() { [capacitor code] }`,Object.defineProperty(y,"name",{value:C,writable:!1,configurable:!1}),y},b=E("addListener"),D=E("removeListener"),I=(C,_)=>{const y=b({eventName:C},_),S=async()=>{const R=await y;D({eventName:C,callbackId:R},_)},U=new Promise(R=>y.then(()=>R({remove:S})));return U.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await S()},U},T=new Proxy({},{get(C,_){switch(_){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return w?I:b;case"removeListener":return D;default:return E(_)}}});return s[c]=T,f.set(c,{name:c,proxy:T,platforms:new Set([...Object.keys(o),...w?[h]:[]])}),T};return e.convertFileSrc||(e.convertFileSrc=c=>c),e.getPlatform=a,e.handleError=d,e.isNativePlatform=r,e.isPluginAvailable=i,e.registerPlugin=m,e.Exception=ce,e.DEBUG=!!e.DEBUG,e.isLoggingEnabled=!!e.isLoggingEnabled,e},Dt=n=>n.Capacitor=Pt(n),N=Dt(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),se=N.registerPlugin;class me{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,e){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(e);const r=this.windowListeners[t];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(t);const i=async()=>this.removeListener(t,e);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,e,s){const a=this.listeners[t];if(!a){if(s){let r=this.retainedEventArguments[t];r||(r=[]),r.push(e),this.retainedEventArguments[t]=r}return}a.forEach(r=>r(e))}hasListeners(t){var e;return!!(!((e=this.listeners[t])===null||e===void 0)&&e.length)}registerWindowListener(t,e){this.windowListeners[e]={registered:!1,windowEventName:t,pluginEventName:e,handler:s=>{this.notifyListeners(e,s)}}}unimplemented(t="not implemented"){return new N.Exception(t,Y.Unimplemented)}unavailable(t="not available"){return new N.Exception(t,Y.Unavailable)}async removeListener(t,e){const s=this.listeners[t];if(!s)return;const a=s.indexOf(e);this.listeners[t].splice(a,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const e=this.retainedEventArguments[t];e&&(delete this.retainedEventArguments[t],e.forEach(s=>{this.notifyListeners(t,s)}))}}const pe=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),ye=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Rt extends me{async getCookies(){const t=document.cookie,e={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[a,r]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=ye(a).trim(),r=ye(r).trim(),e[a]=r}),e}async setCookie(t){try{const e=pe(t.key),s=pe(t.value),a=`; expires=${(t.expires||"").replace("expires=","")}`,r=(t.path||"/").replace("path=",""),i=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${e}=${s||""}${a}; path=${r}; ${i};`}catch(e){return Promise.reject(e)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(e){return Promise.reject(e)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const e of t)document.cookie=e.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}se("CapacitorCookies",{web:()=>new Rt});const Tt=async n=>new Promise((t,e)=>{const s=new FileReader;s.onload=()=>{const a=s.result;t(a.indexOf(",")>=0?a.split(",")[1]:a)},s.onerror=a=>e(a),s.readAsDataURL(n)}),_t=(n={})=>{const t=Object.keys(n);return Object.keys(n).map(a=>a.toLocaleLowerCase()).reduce((a,r,i)=>(a[r]=n[t[i]],a),{})},Nt=(n,t=!0)=>n?Object.entries(n).reduce((s,a)=>{const[r,i]=a;let l,d;return Array.isArray(i)?(d="",i.forEach(f=>{l=t?encodeURIComponent(f):f,d+=`${r}=${l}&`}),d.slice(0,-1)):(l=t?encodeURIComponent(i):i,d=`${r}=${l}`),`${s}&${d}`},"").substr(1):null,At=(n,t={})=>{const e=Object.assign({method:n.method||"GET",headers:n.headers},t),a=_t(n.headers)["content-type"]||"";if(typeof n.data=="string")e.body=n.data;else if(a.includes("application/x-www-form-urlencoded")){const r=new URLSearchParams;for(const[i,l]of Object.entries(n.data||{}))r.set(i,l);e.body=r.toString()}else if(a.includes("multipart/form-data")||n.data instanceof FormData){const r=new FormData;if(n.data instanceof FormData)n.data.forEach((l,d)=>{r.append(d,l)});else for(const l of Object.keys(n.data))r.append(l,n.data[l]);e.body=r;const i=new Headers(e.headers);i.delete("content-type"),e.headers=i}else(a.includes("application/json")||typeof n.data=="object")&&(e.body=JSON.stringify(n.data));return e};class Mt extends me{async request(t){const e=At(t,t.webFetchExtra),s=Nt(t.params,t.shouldEncodeUrlParams),a=s?`${t.url}?${s}`:t.url,r=await fetch(a,e),i=r.headers.get("content-type")||"";let{responseType:l="text"}=r.ok?t:{};i.includes("application/json")&&(l="json");let d,f;switch(l){case"arraybuffer":case"blob":f=await r.blob(),d=await Tt(f);break;case"json":d=await r.json();break;default:d=await r.text()}const m={};return r.headers.forEach((c,o)=>{m[o]=c}),{data:d,headers:m,status:r.status,url:r.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}se("CapacitorHttp",{web:()=>new Mt});var be;(function(n){n.Dark="DARK",n.Light="LIGHT",n.Default="DEFAULT"})(be||(be={}));var Ee;(function(n){n.StatusBar="StatusBar",n.NavigationBar="NavigationBar"})(Ee||(Ee={}));class Ut extends me{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}se("SystemBars",{web:()=>new Ut});const Be="bpt-settings",He={enabled:!1,source:"speed",threshold:3,delay:3},Fe={promptForNotes:!0,promptForExertion:!0},We={duration:0,enableBeep:!0,enableVoice:!1},Ve={enabled:!1,source:"distance",distanceKm:1,timeMinutes:5},Ge={power:!0,heartrate:!0,cadence:!1,speed:!0,distance:!0,time:!0,pace:!1},Ye={timeIntervalMinutes:0,distanceIntervalKm:0,metrics:{...Ge},speechRate:1,voiceURI:null,workoutTargetFeedback:!1,announcementTemplate:null,smartAnnouncements:!1},Je={enabled:!1,apiKey:"",athleteId:"i",autoUpload:!1},Se={power:!0,cadence:!0,heartrate:!0,speed:!0,distance:!0,altitude:!0,treadmillSpeed:!1,power3s:!1,highContrast:!1,colorblindPatterns:!1,voiceEnabled:!1,voiceLaps:!0,voiceZones:!0,exportTcx:!0,exportCsv:!0,exportJson:!1,exportFit:!1,autoPause:{...He},workoutMetadata:{...Fe},countdown:{...We},autoLap:{...Ve},enhancedVoice:{...Ye},intervals:{...Je},weightKg:75,showCalories:!1,debugMode:!1,mockSensors:!1,wheelCircumferenceMm:2096};function Ke(){const n=localStorage.getItem(Be);if(n){const t=JSON.parse(n);return{...Se,...t,autoPause:{...He,...t.autoPause||{}},workoutMetadata:{...Fe,...t.workoutMetadata||{}},countdown:{...We,...t.countdown||{}},autoLap:{...Ve,...t.autoLap||{}},enhancedVoice:{...Ye,...t.enhancedVoice||{},metrics:{...Ge,...t.enhancedVoice?.metrics||{}}},intervals:{...Je,...t.intervals||{}},weightKg:t.weightKg??75,showCalories:t.showCalories??!1}}return{...Se}}function cn(n){localStorage.setItem(Be,JSON.stringify(n)),window.dispatchEvent(new CustomEvent("settings-changed"))}var Le;(function(n){n[n.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",n[n.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",n[n.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"})(Le||(Le={}));var Ce;(function(n){n[n.CONNECTION_PRIORITY_BALANCED=0]="CONNECTION_PRIORITY_BALANCED",n[n.CONNECTION_PRIORITY_HIGH=1]="CONNECTION_PRIORITY_HIGH",n[n.CONNECTION_PRIORITY_LOW_POWER=2]="CONNECTION_PRIORITY_LOW_POWER"})(Ce||(Ce={}));function It(n){return new DataView(Uint8Array.from(n).buffer)}function kt(n){return Array.from(new Uint8Array(n.buffer,n.byteOffset,n.byteLength))}function xt(n){return`0000${n.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function ze(n){const t=[];let e,s,a=1,r=0;for(e=0;e<n.length;e++)s=n.charCodeAt(e),(s>47&&s<58||s>64&&s<71||s>96&&s<103)&&(r=r<<4^(s>64?s+9:s)&15,(a^=1)&&t.push(r&255));return It(t)}function K(n){return kt(n).map(t=>{let e=t.toString(16);return e.length==1&&(e="0"+e),e}).join("")}function ln(n){if(typeof n=="string")return n;if(typeof n=="number")return xt(n);throw new Error("Invalid UUID")}function un(n){const t={};if(n)return n.forEach((e,s)=>{t[s.toString()]=e}),t}function Pe(n){if(n!==void 0){if(typeof n=="string"){const t=ze(n);return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}return n instanceof DataView?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}}function Q(n){if(n!==void 0)return n instanceof DataView?K(n):K(new DataView(n.buffer,n.byteOffset,n.byteLength))}const L=se("BluetoothLe",{web:()=>J(()=>import("./web-DfIFv0v1.js"),__vite__mapDeps([2,1])).then(n=>new n.BluetoothLeWeb)}),Ot=()=>{let n=Promise.resolve();return t=>new Promise((e,s)=>{n=n.then(()=>t()).then(e).catch(s)})};function le(n){return n?Ot():t=>t()}function M(n){if(typeof n!="string")throw new Error(`Invalid UUID type ${typeof n}. Expected string.`);if(n=n.toLowerCase(),!(n.search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${n}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return n}class qt{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=le(!0)}enableQueue(){this.queue=le(!0)}disableQueue(){this.queue=le(!1)}async initialize(t){await this.queue(async()=>{await L.initialize(t)})}async isEnabled(){return await this.queue(async()=>(await L.isEnabled()).value)}async requestEnable(){await this.queue(async()=>{await L.requestEnable()})}async enable(){await this.queue(async()=>{await L.enable()})}async disable(){await this.queue(async()=>{await L.disable()})}async startEnabledNotifications(t){await this.queue(async()=>{var e;const s="onEnabledChanged";await((e=this.eventListeners.get(s))===null||e===void 0?void 0:e.remove());const a=await L.addListener(s,r=>{t(r.value)});this.eventListeners.set(s,a),await L.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var t;const e="onEnabledChanged";await((t=this.eventListeners.get(e))===null||t===void 0?void 0:t.remove()),this.eventListeners.delete(e),await L.stopEnabledNotifications()})}async isLocationEnabled(){return await this.queue(async()=>(await L.isLocationEnabled()).value)}async openLocationSettings(){await this.queue(async()=>{await L.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await L.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await L.openAppSettings()})}async setDisplayStrings(t){await this.queue(async()=>{await L.setDisplayStrings(t)})}async requestDevice(t){return t=t?this.validateRequestBleDeviceOptions(t):void 0,await this.queue(async()=>await L.requestDevice(t))}async requestLEScan(t,e){t=this.validateRequestBleDeviceOptions(t),await this.queue(async()=>{var s;await((s=this.scanListener)===null||s===void 0?void 0:s.remove()),this.scanListener=await L.addListener("onScanResult",a=>{const r=Object.assign(Object.assign({},a),{manufacturerData:this.convertObject(a.manufacturerData),serviceData:this.convertObject(a.serviceData),rawAdvertisement:a.rawAdvertisement?this.convertValue(a.rawAdvertisement):void 0});e(r)}),await L.requestLEScan(t)})}async stopLEScan(){await this.queue(async()=>{var t;await((t=this.scanListener)===null||t===void 0?void 0:t.remove()),this.scanListener=null,await L.stopLEScan()})}async getDevices(t){if(!Array.isArray(t))throw new Error("deviceIds must be an array");return this.queue(async()=>(await L.getDevices({deviceIds:t})).devices)}async getConnectedDevices(t){if(!Array.isArray(t))throw new Error("services must be an array");return t=t.map(M),this.queue(async()=>(await L.getConnectedDevices({services:t})).devices)}async getBondedDevices(){return this.queue(async()=>(await L.getBondedDevices()).devices)}async connect(t,e,s){await this.queue(async()=>{var a;if(e){const r=`disconnected|${t}`;await((a=this.eventListeners.get(r))===null||a===void 0?void 0:a.remove());const i=await L.addListener(r,()=>{e(t)});this.eventListeners.set(r,i)}await L.connect(Object.assign({deviceId:t},s))})}async createBond(t,e){await this.queue(async()=>{await L.createBond(Object.assign({deviceId:t},e))})}async isBonded(t){return await this.queue(async()=>(await L.isBonded({deviceId:t})).value)}async disconnect(t){await this.queue(async()=>{await L.disconnect({deviceId:t})})}async getServices(t){return await this.queue(async()=>(await L.getServices({deviceId:t})).services)}async discoverServices(t){await this.queue(async()=>{await L.discoverServices({deviceId:t})})}async getMtu(t){return await this.queue(async()=>(await L.getMtu({deviceId:t})).value)}async requestConnectionPriority(t,e){await this.queue(async()=>{await L.requestConnectionPriority({deviceId:t,connectionPriority:e})})}async readRssi(t){return await this.queue(async()=>{const s=await L.readRssi({deviceId:t});return parseFloat(s.value)})}async read(t,e,s,a){return e=M(e),s=M(s),await this.queue(async()=>{const i=await L.read(Object.assign({deviceId:t,service:e,characteristic:s},a));return this.convertValue(i.value)})}async write(t,e,s,a,r){return e=M(e),s=M(s),this.queue(async()=>{if(!a?.buffer)throw new Error("Invalid data.");let i=a;N.getPlatform()!=="web"&&(i=K(a)),await L.write(Object.assign({deviceId:t,service:e,characteristic:s,value:i},r))})}async writeWithoutResponse(t,e,s,a,r){e=M(e),s=M(s),await this.queue(async()=>{if(!a?.buffer)throw new Error("Invalid data.");let i=a;N.getPlatform()!=="web"&&(i=K(a)),await L.writeWithoutResponse(Object.assign({deviceId:t,service:e,characteristic:s,value:i},r))})}async readDescriptor(t,e,s,a,r){return e=M(e),s=M(s),a=M(a),await this.queue(async()=>{const l=await L.readDescriptor(Object.assign({deviceId:t,service:e,characteristic:s,descriptor:a},r));return this.convertValue(l.value)})}async writeDescriptor(t,e,s,a,r,i){return e=M(e),s=M(s),a=M(a),this.queue(async()=>{if(!r?.buffer)throw new Error("Invalid data.");let l=r;N.getPlatform()!=="web"&&(l=K(r)),await L.writeDescriptor(Object.assign({deviceId:t,service:e,characteristic:s,descriptor:a,value:l},i))})}async startNotifications(t,e,s,a,r){e=M(e),s=M(s),await this.queue(async()=>{var i;const l=`notification|${t}|${e}|${s}`;await((i=this.eventListeners.get(l))===null||i===void 0?void 0:i.remove());const d=await L.addListener(l,f=>{a(this.convertValue(f?.value))});this.eventListeners.set(l,d),await L.startNotifications(Object.assign({deviceId:t,service:e,characteristic:s},r))})}async stopNotifications(t,e,s){e=M(e),s=M(s),await this.queue(async()=>{var a;const r=`notification|${t}|${e}|${s}`;await((a=this.eventListeners.get(r))===null||a===void 0?void 0:a.remove()),this.eventListeners.delete(r),await L.stopNotifications({deviceId:t,service:e,characteristic:s})})}validateRequestBleDeviceOptions(t){return t.services&&(t.services=t.services.map(M)),t.optionalServices&&(t.optionalServices=t.optionalServices.map(M)),t.serviceData&&N.getPlatform()!=="web"&&(t.serviceData=t.serviceData.map(e=>Object.assign(Object.assign({},e),{serviceUuid:M(e.serviceUuid),dataPrefix:Q(e.dataPrefix),mask:Q(e.mask)}))),t.manufacturerData&&(N.getPlatform()!=="web"?t.manufacturerData=t.manufacturerData.map(e=>Object.assign(Object.assign({},e),{dataPrefix:Q(e.dataPrefix),mask:Q(e.mask)})):t.manufacturerData=t.manufacturerData.map(e=>Object.assign(Object.assign({},e),{dataPrefix:Pe(e.dataPrefix),mask:Pe(e.mask)}))),t}convertValue(t){return typeof t=="string"?ze(t):t===void 0?new DataView(new ArrayBuffer(0)):t}convertObject(t){if(t===void 0)return;const e={};for(const s of Object.keys(t))e[s]=this.convertValue(t[s]);return e}}const A=new qt,ue="bpt_last_device_ids",de="bpt_last_device_names",W={getIds(){try{const n=localStorage.getItem(ue);return n?JSON.parse(n):{}}catch(n){return console.warn("Failed to read connection storage",n),{}}},saveId(n,t){const e=this.getIds();e[n]=t;try{localStorage.setItem(ue,JSON.stringify(e))}catch(s){console.warn("Failed to save connection storage",s)}},clearId(n){const t=this.getIds();delete t[n];try{localStorage.setItem(ue,JSON.stringify(t))}catch(e){console.warn("Failed to save connection storage",e)}},getId(n){return this.getIds()[n]},getDeviceNames(){try{const n=localStorage.getItem(de);return n?JSON.parse(n):{}}catch(n){return console.warn("Failed to read device names storage",n),{}}},saveDeviceName(n,t){const e=this.getDeviceNames();e[n]=t;try{localStorage.setItem(de,JSON.stringify(e))}catch(s){console.warn("Failed to save device name",s)}},clearDeviceName(n){const t=this.getDeviceNames();delete t[n];try{localStorage.setItem(de,JSON.stringify(t))}catch(e){console.warn("Failed to clear device name",e)}},getDeviceName(n){return this.getDeviceNames()[n]}},Ze=n=>{const t=n.getUint16(0,!0);let e=2;const s={},a=(t&2)!==0,r=(t&4)!==0,i=(t&8)!==0;if(n.byteLength>=e+2){const l=n.getUint16(e,!0);s.speed=l/100,e+=2}if(a&&n.byteLength>=e+2){const l=n.getUint16(e,!0);s.averageSpeed=l/100,e+=2}if(r&&n.byteLength>=e+3){const l=n.getUint8(e),d=n.getUint8(e+1),f=n.getUint8(e+2),m=l+(d<<8)+(f<<16);s.totalDistance=m,e+=3}if(i&&n.byteLength>=e+4){const l=n.getInt16(e,!0);s.incline=l/10,e+=2;const d=n.getInt16(e,!0);s.rampAngle=d/10,e+=2}return s},ne=(n,t)=>{const e=n.getUint8(t),s=n.getUint8(t+1),a=n.getUint8(t+2);return e+(s<<8)+(a<<16)},$t=n=>{const t=n.getUint16(0,!0);let e=2;const s={},a=(t&2)!==0,r=(t&4)!==0,i=(t&8)!==0,l=(t&16)!==0,d=(t&32)!==0,f=(t&64)!==0,m=(t&256)!==0,c=(t&512)!==0,o=(t&2048)!==0;return n.byteLength>=e+1&&(s.strokeRate=n.getUint8(e)*.5,e+=1),n.byteLength>=e+2&&(s.strokeCount=n.getUint16(e,!0),e+=2),a&&n.byteLength>=e+1&&(s.averageStrokeRate=n.getUint8(e)*.5,e+=1),r&&n.byteLength>=e+3&&(s.totalDistance=ne(n,e),e+=3),i&&n.byteLength>=e+2&&(s.instantaneousPace=n.getUint16(e,!0),e+=2),l&&n.byteLength>=e+2&&(s.averagePace=n.getUint16(e,!0),e+=2),d&&n.byteLength>=e+2&&(s.instantaneousPower=n.getInt16(e,!0),e+=2),f&&n.byteLength>=e+2&&(s.averagePower=n.getInt16(e,!0),e+=2),(t&128)!==0&&n.byteLength>=e+2&&(e+=2),m&&n.byteLength>=e+5&&(s.totalEnergy=n.getUint16(e,!0),e+=5),c&&n.byteLength>=e+1&&(s.heartRate=n.getUint8(e),e+=1),(t&1024)!==0&&n.byteLength>=e+1&&(e+=1),o&&n.byteLength>=e+2&&(s.elapsedTime=n.getUint16(e,!0),e+=2),s},jt=n=>{const t=ne(n,0);let e=3;const s={},a=(t&2)!==0,r=(t&4)!==0,i=(t&8)!==0,l=(t&16)!==0,d=(t&32)!==0,f=(t&64)!==0,m=(t&128)!==0,c=(t&256)!==0,o=(t&512)!==0,u=(t&1024)!==0,h=(t&2048)!==0,w=(t&8192)!==0;return n.byteLength>=e+2&&(s.speed=n.getUint16(e,!0)/100,e+=2),a&&n.byteLength>=e+2&&(s.averageSpeed=n.getUint16(e,!0)/100,e+=2),r&&n.byteLength>=e+3&&(s.totalDistance=ne(n,e),e+=3),i&&n.byteLength>=e+4&&(s.stepPerMinute=n.getUint16(e,!0),e+=2,s.averageStepRate=n.getUint16(e,!0),e+=2),l&&n.byteLength>=e+2&&(s.strideCount=n.getUint16(e,!0),e+=2),d&&n.byteLength>=e+4&&(s.positiveElevationGain=n.getUint16(e,!0),e+=2,s.negativeElevationGain=n.getUint16(e,!0),e+=2),f&&n.byteLength>=e+4&&(s.incline=n.getInt16(e,!0)/10,e+=2,s.rampAngle=n.getInt16(e,!0)/10,e+=2),m&&n.byteLength>=e+2&&(s.resistanceLevel=n.getInt16(e,!0),e+=2),c&&n.byteLength>=e+2&&(s.instantaneousPower=n.getInt16(e,!0),e+=2),o&&n.byteLength>=e+2&&(s.averagePower=n.getInt16(e,!0),e+=2),u&&n.byteLength>=e+5&&(s.totalEnergy=n.getUint16(e,!0),e+=5),h&&n.byteLength>=e+1&&(s.heartRate=n.getUint8(e),e+=1),(t&4096)!==0&&n.byteLength>=e+1&&(e+=1),w&&n.byteLength>=e+2&&(s.elapsedTime=n.getUint16(e,!0),e+=2),s},Bt=n=>{const t=n.getUint16(0,!0);let e=2;const s={},a=(t&2)!==0,r=(t&4)!==0,i=(t&8)!==0,l=(t&16)!==0,d=(t&32)!==0,f=(t&64)!==0,m=(t&128)!==0,c=(t&256)!==0,o=(t&512)!==0,u=(t&2048)!==0;return n.byteLength>=e+2&&(s.speed=n.getUint16(e,!0)/100,e+=2),a&&n.byteLength>=e+2&&(s.averageSpeed=n.getUint16(e,!0)/100,e+=2),r&&n.byteLength>=e+2&&(s.cadence=n.getUint16(e,!0)/2,e+=2),i&&n.byteLength>=e+2&&(s.averageCadence=n.getUint16(e,!0)/2,e+=2),l&&n.byteLength>=e+3&&(s.totalDistance=ne(n,e),e+=3),d&&n.byteLength>=e+2&&(s.resistanceLevel=n.getInt16(e,!0),e+=2),f&&n.byteLength>=e+2&&(s.instantaneousPower=n.getInt16(e,!0),e+=2),m&&n.byteLength>=e+2&&(s.averagePower=n.getInt16(e,!0),e+=2),c&&n.byteLength>=e+5&&(s.totalEnergy=n.getUint16(e,!0),e+=5),o&&n.byteLength>=e+1&&(s.heartRate=n.getUint8(e),e+=1),(t&1024)!==0&&n.byteLength>=e+1&&(e+=1),u&&n.byteLength>=e+2&&(s.elapsedTime=n.getUint16(e,!0),e+=2),s},Ht=n=>{const t=n.getUint16(0,!0);let e=2;const s={},a=(t&2)!==0,r=(t&4)!==0,i=(t&8)!==0,l=(t&16)!==0,d=(t&32)!==0,f=(t&64)!==0,m=(t&128)!==0,c=(t&256)!==0,o=(t&512)!==0,u=(t&1024)!==0,h=(t&2048)!==0;return a&&n.byteLength>=e+2&&(s.floors=n.getUint16(e,!0),e+=2),r&&n.byteLength>=e+2&&(s.stepCount=n.getUint16(e,!0),e+=2),i&&n.byteLength>=e+2&&(s.stepRate=n.getUint16(e,!0),e+=2),l&&n.byteLength>=e+2&&(s.averageStepRate=n.getUint16(e,!0),e+=2),d&&n.byteLength>=e+2&&(s.positiveElevationGain=n.getUint16(e,!0),e+=2),f&&n.byteLength>=e+2&&(s.instantaneousPower=n.getInt16(e,!0),e+=2),m&&n.byteLength>=e+2&&(s.averagePower=n.getInt16(e,!0),e+=2),c&&n.byteLength>=e+5&&(s.totalEnergy=n.getUint16(e,!0),e+=5),o&&n.byteLength>=e+1&&(s.heartRate=n.getUint8(e),e+=1),u&&n.byteLength>=e+1&&(e+=1),h&&n.byteLength>=e+2&&(s.elapsedTime=n.getUint16(e,!0),e+=2),s},Ft=n=>{const t=n.getUint8(0);let e=1;const a=n.getUint16(e,!0)/256*3.6;e+=2;const r=n.getUint8(e);e+=1;const i={speed:a,cadence:r},l=(t&1)!==0,d=(t&2)!==0;if(l&&n.byteLength>=e+2){const f=n.getUint16(e,!0);i.strideLength=f/100,e+=2}if(d&&n.byteLength>=e+4){const f=n.getUint32(e,!0);i.totalDistance=f/10,e+=4}return i},k={listeners:new Set,isEnabled(){return!!Ke().debugMode},async log(n,t){const e=this.bufferToHex(t.buffer);if(this.listeners.forEach(s=>s(n,e)),!!this.isEnabled())try{await Ie(n,e)}catch(s){console.warn("Failed to log debug data",s)}},addListener(n){this.listeners.add(n)},removeListener(n){this.listeners.delete(n)},bufferToHex(n){return[...new Uint8Array(n)].map(t=>t.toString(16).padStart(2,"0")).join("").toUpperCase()},async exportLogs(){const n=await he(),t=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=`bpt-debug-logs-${Date.now()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e)},async clearLogs(){await ke()},async getLogCount(){return(await he()).length}},fe="00001818-0000-1000-8000-00805f9b34fb",De="00002a63-0000-1000-8000-00805f9b34fb",X="0000180d-0000-1000-8000-00805f9b34fb",Re="00002a37-0000-1000-8000-00805f9b34fb",ee="00001816-0000-1000-8000-00805f9b34fb",Te="00002a5b-0000-1000-8000-00805f9b34fb",te="00001826-0000-1000-8000-00805f9b34fb",_e="00002acd-0000-1000-8000-00805f9b34fb",q=5,re=1e3;let Ne=!1;const ae=async()=>{if(!Ne)try{await A.initialize(),Ne=!0}catch(n){throw console.error("Failed to initialize BleClient:",n),n}},Wt=async n=>{const t=[],e=[];let s=n||null,a=!1,r=0,i="Power Sensor";if(await ae(),s)i="Restored Power Sensor";else try{const c=await A.requestDevice({services:[fe],optionalServices:[]});s=c.deviceId,i=c.name||"Power Sensor"}catch(c){throw console.error("Error requesting Power device:",c),c}const l=c=>{e.forEach(o=>o(c))},d=async()=>{s&&(await A.connect(s,m),W.saveId("power",s),l("connected"),await A.startNotifications(s,fe,De,c=>{k.log(i,c);const o=c.getInt16(2,!0),u={timestamp:Date.now(),value:o};t.forEach(h=>h(u))}),r=0)},f=async()=>{if(a||r>=q){r>=q&&(console.error("Native Power sensor: Max reconnection attempts reached"),l("failed"));return}r++;const c=re*Math.pow(2,r-1);console.log(`Native Power sensor: Reconnection attempt ${r}/${q} in ${c}ms`),l("reconnecting"),await new Promise(o=>setTimeout(o,c));try{await d(),console.log("Native Power sensor: Reconnected successfully")}catch(o){console.error("Native Power sensor: Reconnection failed:",o),f()}},m=c=>{c===s&&!a&&(console.log("Native Power sensor: Disconnected"),l("disconnected"),f())};return await d(),{disconnect:async()=>{if(a=!0,s)try{await A.stopNotifications(s,fe,De),await A.disconnect(s)}catch(c){console.error("Error disconnecting native bluetooth:",c)}},addListener:c=>{t.push(c)},deviceName:i,onStatusChange:c=>{e.push(c)}}},Vt=async n=>{const t=[],e=[];let s=n||null,a=!1,r=0,i="Heart Rate Monitor";if(await ae(),s)i="Restored HR Monitor";else try{const c=await A.requestDevice({services:[X],optionalServices:[X]});s=c.deviceId,i=c.name||"Heart Rate Monitor"}catch(c){throw console.error("Error requesting Heart Rate device:",c),c}const l=c=>{e.forEach(o=>o(c))},d=async()=>{s&&(await A.connect(s,m),W.saveId("heartrate",s),l("connected"),await A.startNotifications(s,X,Re,c=>{k.log(i,c);const o=c.getUint8(0);let u;o&1?u=c.getUint16(1,!0):u=c.getUint8(1);const h={timestamp:Date.now(),value:u};t.forEach(w=>w(h))}),r=0)},f=async()=>{if(a||r>=q){r>=q&&(console.error("Native Heart Rate sensor: Max reconnection attempts reached"),l("failed"));return}r++;const c=re*Math.pow(2,r-1);console.log(`Native Heart Rate sensor: Reconnection attempt ${r}/${q} in ${c}ms`),l("reconnecting"),await new Promise(o=>setTimeout(o,c));try{await d(),console.log("Native Heart Rate sensor: Reconnected successfully")}catch(o){console.error("Native Heart Rate sensor: Reconnection failed:",o),f()}},m=c=>{c===s&&!a&&(console.log("Native Heart Rate sensor: Disconnected"),l("disconnected"),f())};return await d(),{disconnect:async()=>{if(a=!0,s)try{await A.stopNotifications(s,X,Re),await A.disconnect(s)}catch(c){console.error("Error disconnecting native bluetooth:",c)}},addListener:c=>{t.push(c)},deviceName:i,onStatusChange:c=>{e.push(c)}}},Gt=async n=>{const t=[],e=[];let s=n||null,a=null,r=null,i=!1,l=0,d="Cadence Sensor";if(await ae(),s)d="Restored Cadence Sensor";else try{const u=await A.requestDevice({services:[ee],optionalServices:[ee]});s=u.deviceId,d=u.name||"Cadence Sensor"}catch(u){throw console.error("Error requesting Cadence device:",u),u}const f=u=>{e.forEach(h=>h(u))},m=async()=>{s&&(await A.connect(s,o),W.saveId("cadence",s),f("connected"),await A.startNotifications(s,ee,Te,u=>{k.log(d,u);const h=u.getUint8(0);if(h&2){let w=1;h&1&&(w=7);const g=u.getUint16(w,!0),p=u.getUint16(w+2,!0);if(a!==null&&r!==null){let v=g-a,E=p-r;if(v<0&&(v+=65536),E<0&&(E+=65536),E>0){const b=E/1024,D=Math.round(v/b*60);if(D>=0&&D<300){const I={timestamp:Date.now(),value:D};t.forEach(T=>T(I))}}}a=g,r=p}}),l=0)},c=async()=>{if(i||l>=q){l>=q&&(console.error("Native Cadence sensor: Max reconnection attempts reached"),f("failed"));return}l++;const u=re*Math.pow(2,l-1);console.log(`Native Cadence sensor: Reconnection attempt ${l}/${q} in ${u}ms`),f("reconnecting"),await new Promise(h=>setTimeout(h,u));try{await m(),console.log("Native Cadence sensor: Reconnected successfully")}catch(h){console.error("Native Cadence sensor: Reconnection failed:",h),c()}},o=u=>{u===s&&!i&&(console.log("Native Cadence sensor: Disconnected"),f("disconnected"),c())};return await m(),{disconnect:async()=>{if(i=!0,s)try{await A.stopNotifications(s,ee,Te),await A.disconnect(s)}catch(u){console.error("Error disconnecting native bluetooth:",u)}},addListener:u=>{t.push(u)},deviceName:d,onStatusChange:u=>{e.push(u)}}},Yt=async n=>{const t=[],e=[];let s=n||null,a=!1,r=0,i="Treadmill";if(await ae(),s)i="Restored Treadmill";else try{const c=await A.requestDevice({services:[te],optionalServices:[te]});s=c.deviceId,i=c.name||"Treadmill"}catch(c){throw console.error("Error requesting Treadmill device:",c),c}const l=c=>{e.forEach(o=>o(c))},d=c=>{c===s&&!a&&(console.log("Treadmill: Connection lost, attempting to reconnect..."),l("disconnected"),m())},f=async()=>{s&&(await A.connect(s,d),W.saveId("treadmill",s),l("connected"),await A.startNotifications(s,te,_e,c=>{k.log(i,c);try{const o=Ze(c);if(o.speed!==void 0||o.incline!==void 0){const u={timestamp:Date.now(),speed:o.speed??null,incline:o.incline??null};t.forEach(h=>h(u))}}catch(o){console.error("Error parsing treadmill data",o)}}),r=0)},m=async()=>{if(a)return;if(r>=q){console.error("Treadmill: Max reconnection attempts reached"),l("failed");return}r++;const c=re*Math.pow(2,r-1);console.log(`Treadmill: Reconnection attempt ${r}/${q} in ${c}ms`),l("reconnecting"),await new Promise(o=>setTimeout(o,c));try{await f(),console.log("Treadmill: Reconnected successfully")}catch(o){console.error("Treadmill: Reconnection failed:",o),m()}};try{await f()}catch(c){if(s)try{await A.disconnect(s)}catch{}throw c}return{disconnect:async()=>{if(a=!0,s)try{await A.stopNotifications(s,te,_e),await A.disconnect(s)}catch(c){console.error("Error disconnecting treadmill",c)}l("disconnected")},addListener:c=>{t.push(c)},deviceName:i,onStatusChange:c=>{e.push(c)}}},P=5,O=1e3,Jt=async n=>{const t=[],e=[];let s=!1,a=0,r=null,i;if(n&&typeof navigator.bluetooth.getDevices=="function")try{i=(await navigator.bluetooth.getDevices()).find(u=>u.id===n)}catch(o){console.warn("Failed to get permitted devices",o)}if(!i){if(n)throw new Error("Device not found in permitted list");i=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_power"]}],optionalServices:["cycling_power"]})}if(!i.gatt)throw new Error("GATT server not available");i.id&&W.saveId("power",i.id);const l=i.name||"Power Sensor",d=o=>{e.forEach(u=>u(o))},f=o=>{const h=o.target.value;if(!h)return;k.log(l,h);const w=h.getInt16(2,!0),g={timestamp:Date.now(),value:w};t.forEach(p=>p(g))},m=async()=>{if(!i.gatt)return;r=await(await(await i.gatt.connect()).getPrimaryService("cycling_power")).getCharacteristic("cycling_power_measurement"),await r.startNotifications(),r.addEventListener("characteristicvaluechanged",f),a=0,d("connected")},c=async()=>{if(s||a>=P){a>=P&&(console.error("Power sensor: Max reconnection attempts reached"),d("failed"));return}a++;const o=O*Math.pow(2,a-1);console.log(`Power sensor: Reconnection attempt ${a}/${P} in ${o}ms`),d("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m(),console.log("Power sensor: Reconnected successfully")}catch(u){console.error("Power sensor: Reconnection failed:",u),c()}};return i.addEventListener("gattserverdisconnected",()=>{s||(console.log("Power sensor: Connection lost, attempting to reconnect..."),d("disconnected"),c())}),await m(),{disconnect:()=>{s=!0,r&&(r.removeEventListener("characteristicvaluechanged",f),r.stopNotifications().catch(()=>{})),i.gatt?.disconnect()},addListener:o=>{t.push(o)},deviceName:l,onStatusChange:o=>{e.push(o)}}},Kt=async n=>{const t=[],e=[];let s=!1,a=0,r=null,i;if(n&&typeof navigator.bluetooth.getDevices=="function")try{i=(await navigator.bluetooth.getDevices()).find(u=>u.id===n)}catch(o){console.warn("Failed to get permitted devices",o)}if(!i){if(n)throw new Error("Device not found in permitted list");i=await navigator.bluetooth.requestDevice({filters:[{services:["heart_rate"]}],optionalServices:["heart_rate"]})}if(!i.gatt)throw new Error("GATT server not available");i.id&&W.saveId("heartrate",i.id);const l=i.name||"Heart Rate Monitor",d=o=>{e.forEach(u=>u(o))},f=o=>{const h=o.target.value;if(!h)return;k.log(l,h);const w=h.getUint8(0);let g;w&1?g=h.getUint16(1,!0):g=h.getUint8(1);const p={timestamp:Date.now(),value:g};t.forEach(v=>v(p))},m=async()=>{if(!i.gatt)return;r=await(await(await i.gatt.connect()).getPrimaryService("heart_rate")).getCharacteristic("heart_rate_measurement"),await r.startNotifications(),r.addEventListener("characteristicvaluechanged",f),a=0,d("connected")},c=async()=>{if(s||a>=P){a>=P&&(console.error("Heart rate sensor: Max reconnection attempts reached"),d("failed"));return}a++;const o=O*Math.pow(2,a-1);console.log(`Heart rate sensor: Reconnection attempt ${a}/${P} in ${o}ms`),d("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m(),console.log("Heart rate sensor: Reconnected successfully")}catch(u){console.error("Heart rate sensor: Reconnection failed:",u),c()}};return i.addEventListener("gattserverdisconnected",()=>{s||(console.log("Heart rate sensor: Connection lost, attempting to reconnect..."),d("disconnected"),c())}),await m(),{disconnect:()=>{s=!0,r&&(r.removeEventListener("characteristicvaluechanged",f),r.stopNotifications().catch(()=>{})),i.gatt?.disconnect()},addListener:o=>{t.push(o)},deviceName:l,onStatusChange:o=>{e.push(o)}}},zt=async n=>{const t=[],e=[];let s=!1,a=0,r=null,i=null,l=null,d;if(n&&typeof navigator.bluetooth.getDevices=="function")try{d=(await navigator.bluetooth.getDevices()).find(w=>w.id===n)}catch(h){console.warn("Failed to get permitted devices",h)}if(!d){if(n)throw new Error("Device not found in permitted list");d=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_speed_and_cadence"]}],optionalServices:["cycling_speed_and_cadence"]})}if(!d.gatt)throw new Error("GATT server not available");d.id&&W.saveId("cadence",d.id);const f=d.name||"Cadence Sensor",m=h=>{e.forEach(w=>w(h))},c=h=>{const g=h.target.value;if(!g)return;k.log(f,g);const p=g.getUint8(0);if(p&2){let v=1;p&1&&(v=7);const E=g.getUint16(v,!0),b=g.getUint16(v+2,!0);if(i!==null&&l!==null){let D=E-i,I=b-l;if(D<0&&(D+=65536),I<0&&(I+=65536),I>0){const T=I/1024,C=Math.round(D/T*60);if(C>=0&&C<300){const _={timestamp:Date.now(),value:C};t.forEach(y=>y(_))}}}i=E,l=b}},o=async()=>{if(!d.gatt)return;r=await(await(await d.gatt.connect()).getPrimaryService("cycling_speed_and_cadence")).getCharacteristic("csc_measurement"),await r.startNotifications(),r.addEventListener("characteristicvaluechanged",c),a=0,m("connected")},u=async()=>{if(s||a>=P){a>=P&&(console.error("Cadence sensor: Max reconnection attempts reached"),m("failed"));return}a++;const h=O*Math.pow(2,a-1);console.log(`Cadence sensor: Reconnection attempt ${a}/${P} in ${h}ms`),m("reconnecting"),await new Promise(w=>setTimeout(w,h));try{await o(),console.log("Cadence sensor: Reconnected successfully")}catch(w){console.error("Cadence sensor: Reconnection failed:",w),u()}};return d.addEventListener("gattserverdisconnected",()=>{s||(console.log("Cadence sensor: Connection lost, attempting to reconnect..."),m("disconnected"),u())}),await o(),{disconnect:()=>{s=!0,r&&(r.removeEventListener("characteristicvaluechanged",c),r.stopNotifications().catch(()=>{})),d.gatt?.disconnect()},addListener:h=>{t.push(h)},deviceName:f,onStatusChange:h=>{e.push(h)}}},Zt=async n=>{const t=[],e=[];let s=!1,a=0,r=null,i,l;if(n&&typeof navigator.bluetooth.getDevices=="function")try{l=(await navigator.bluetooth.getDevices()).find(h=>h.id===n)}catch(u){console.warn("Failed to get permitted devices",u)}if(!l){if(n)throw new Error("Device not found in permitted list");l=await navigator.bluetooth.requestDevice({filters:[{services:["fitness_machine"]}],optionalServices:["fitness_machine"]})}if(!l.gatt)throw new Error("GATT server not available");l.id&&W.saveId("treadmill",l.id);const d=l.name||"Treadmill",f=u=>{e.forEach(h=>h(u))},m=u=>{const w=u.target.value;if(w){k.log(d,w);try{const g=Ze(w);if(g.speed!==void 0||g.incline!==void 0){const p={timestamp:Date.now(),speed:g.speed??null,incline:g.incline??null};t.forEach(v=>v(p))}}catch(g){console.error("Error parsing treadmill data",g)}}},c=async()=>{if(!l.gatt)return;i=await l.gatt.connect(),r=await(await i.getPrimaryService("fitness_machine")).getCharacteristic("treadmill_data"),await r.startNotifications(),r.addEventListener("characteristicvaluechanged",m),a=0,f("connected")},o=async()=>{if(s||a>=P){a>=P&&(console.error("Treadmill: Max reconnection attempts reached"),f("failed"));return}a++;const u=O*Math.pow(2,a-1);console.log(`Treadmill: Reconnection attempt ${a}/${P} in ${u}ms`),f("reconnecting"),await new Promise(h=>setTimeout(h,u));try{await c(),console.log("Treadmill: Reconnected successfully")}catch(h){console.error("Treadmill: Reconnection failed:",h),o()}};l.addEventListener("gattserverdisconnected",()=>{s||(console.log("Treadmill: Connection lost, attempting to reconnect..."),f("disconnected"),o())});try{await c()}catch(u){throw i&&i.connected&&i.disconnect(),u}return{disconnect:()=>{if(s=!0,r)try{r.stopNotifications(),r.removeEventListener("characteristicvaluechanged",m)}catch{}l.gatt?.connected&&l.gatt.disconnect(),f("disconnected")},addListener:u=>{t.push(u)},deviceName:d,onStatusChange:u=>{e.push(u)}}},Qt=async()=>{const n=[],t=[];let e=!1,s=0,a=null,r;const i=await navigator.bluetooth.requestDevice({filters:[{services:["fitness_machine"]}],optionalServices:["fitness_machine"]}),l=i.name||"Unknown Rower",d=o=>{t.forEach(u=>u(o))},f=o=>{const h=o.target.value;if(h){k.log("rower",h);try{const w=$t(h),g={timestamp:Date.now(),strokeRate:w.strokeRate??null,power:w.instantaneousPower??null};n.forEach(p=>p(g))}catch(w){console.error("Error parsing rower data",w)}}},m=async()=>{if(!i.gatt)return;r=await i.gatt.connect(),a=await(await r.getPrimaryService("fitness_machine")).getCharacteristic("rower_data"),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",f),s=0,d("connected")},c=async()=>{if(e||s>=P){s>=P&&(console.error("Rower: Max reconnection attempts reached"),d("failed"));return}s++;const o=O*Math.pow(2,s-1);console.log(`Rower: Reconnection attempt ${s}/${P} in ${o}ms`),d("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m(),console.log("Rower: Reconnected successfully")}catch(u){console.error("Rower: Reconnection failed:",u),c()}};i.addEventListener("gattserverdisconnected",()=>{e||(console.log("Rower: Connection lost, attempting to reconnect..."),d("disconnected"),c())});try{await m()}catch(o){throw r&&r.connected&&r.disconnect(),o}return{disconnect:()=>{if(e=!0,a)try{a.stopNotifications(),a.removeEventListener("characteristicvaluechanged",f)}catch{}i.gatt?.connected&&i.gatt.disconnect(),d("disconnected")},addListener:o=>{n.push(o)},deviceName:l,onStatusChange:o=>{t.push(o)}}},Ae=async()=>{const n=[],t=[];let e=!1,s=0,a=null,r;const l=await navigator.bluetooth.requestDevice({filters:[{namePrefix:"PM5"}],optionalServices:["ce060030-43e5-11e4-916c-0800200c9a66"]}),d=l.name||"Unknown concept2 Rower",f=u=>{t.forEach(h=>h(u))},m=u=>{const w=u.target.value;if(!w)return;k.log("concept2",w);const g={timestamp:Date.now(),strokeRate:null,power:null};n.forEach(p=>p(g))},c=async()=>{if(!l.gatt)return;r=await l.gatt.connect(),a=await(await r.getPrimaryService("fitness_machine")).getCharacteristic("rower_data"),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",m),s=0,f("connected")},o=async()=>{if(e||s>=P){s>=P&&(console.error("Rower: Max reconnection attempts reached"),f("failed"));return}s++;const u=O*Math.pow(2,s-1);console.log(`Rower: Reconnection attempt ${s}/${P} in ${u}ms`),f("reconnecting"),await new Promise(h=>setTimeout(h,u));try{await c(),console.log("Rower: Reconnected successfully")}catch(h){console.error("Rower: Reconnection failed:",h),o()}};l.addEventListener("gattserverdisconnected",()=>{e||(console.log("Rower: Connection lost, attempting to reconnect..."),f("disconnected"),o())});try{await c()}catch(u){throw r&&r.connected&&r.disconnect(),u}return{disconnect:()=>{if(e=!0,a)try{a.stopNotifications(),a.removeEventListener("characteristicvaluechanged",m)}catch{}l.gatt?.connected&&l.gatt.disconnect(),f("disconnected")},addListener:u=>{n.push(u)},deviceName:d,onStatusChange:u=>{t.push(u)}}},Me=async()=>{const n=[],t=[],e=[];let s=!1,a=0,r=null,i=null,l=null,d=null,f=null;const m=await navigator.bluetooth.requestDevice({filters:[{services:["cycling_speed_and_cadence"]}],optionalServices:["cycling_speed_and_cadence"]});if(!m.gatt)throw new Error("GATT server not available");const c=m.name||"Speed/Cadence Sensor",o=g=>{e.forEach(p=>p(g))},u=g=>{const v=g.target.value;if(!v)return;k.log(c,v);const E=v.getUint8(0);let b=1;if(E&1){const D=v.getUint32(b,!0);b+=4;const I=v.getUint16(b,!0);if(b+=2,d!==null&&f!==null){let T=D-d,C=I-f;if(T<0&&(T+=4294967296),C<0&&(C+=65536),C>0&&T>0){const _=C/1024,y=Ke().wheelCircumferenceMm,S=T*y/1e6/_*3600;if(S>=0&&S<150){const U={timestamp:Date.now(),value:Math.round(S*10)/10};t.forEach(R=>R(U))}}}d=D,f=I}if(E&2){const D=v.getUint16(b,!0);b+=2;const I=v.getUint16(b,!0);if(i!==null&&l!==null){let T=D-i,C=I-l;if(T<0&&(T+=65536),C<0&&(C+=65536),C>0){const _=C/1024,y=Math.round(T/_*60);if(y>=0&&y<300){const S={timestamp:Date.now(),value:y};n.forEach(U=>U(S))}}}i=D,l=I}},h=async()=>{if(!m.gatt)return;r=await(await(await m.gatt.connect()).getPrimaryService("cycling_speed_and_cadence")).getCharacteristic("csc_measurement"),await r.startNotifications(),r.addEventListener("characteristicvaluechanged",u),a=0,o("connected")},w=async()=>{if(s||a>=P){a>=P&&o("failed");return}a++;const g=O*Math.pow(2,a-1);o("reconnecting"),await new Promise(p=>setTimeout(p,g));try{await h()}catch{w()}};return m.addEventListener("gattserverdisconnected",()=>{s||(o("disconnected"),w())}),await h(),{disconnect:()=>{s=!0,r&&(r.removeEventListener("characteristicvaluechanged",u),r.stopNotifications().catch(()=>{})),m.gatt?.disconnect()},addCadenceListener:g=>{n.push(g)},addSpeedListener:g=>{t.push(g)},deviceName:c,onStatusChange:g=>{e.push(g)}}},Xt=async()=>{const n=[],t=[];let e=!1,s=0,a=null,r;const i=await navigator.bluetooth.requestDevice({filters:[{services:["fitness_machine"]}],optionalServices:["fitness_machine"]});if(!i.gatt)throw new Error("GATT server not available");const l=i.name||"Cross Trainer",d=o=>{t.forEach(u=>u(o))},f=o=>{const h=o.target.value;if(h){k.log(l,h);try{const w=jt(h),g={timestamp:Date.now(),speed:w.speed??null,stepRate:w.stepPerMinute??null,totalSteps:w.strideCount??null,resistanceLevel:w.resistanceLevel??null,incline:w.incline??null,power:w.instantaneousPower??null};n.forEach(p=>p(g))}catch(w){console.error("Error parsing cross trainer data",w)}}},m=async()=>{if(!i.gatt)return;r=await i.gatt.connect(),a=await(await r.getPrimaryService("fitness_machine")).getCharacteristic(10958),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",f),s=0,d("connected")},c=async()=>{if(e||s>=P){s>=P&&d("failed");return}s++;const o=O*Math.pow(2,s-1);d("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m()}catch{c()}};i.addEventListener("gattserverdisconnected",()=>{e||(d("disconnected"),c())});try{await m()}catch(o){throw r&&r.connected&&r.disconnect(),o}return{disconnect:()=>{if(e=!0,a)try{a.stopNotifications(),a.removeEventListener("characteristicvaluechanged",f)}catch{}i.gatt?.connected&&i.gatt.disconnect(),d("disconnected")},addListener:o=>{n.push(o)},deviceName:l,onStatusChange:o=>{t.push(o)}}},en=async()=>{const n=[],t=[];let e=!1,s=0,a=null,r=null,i,l=!1;const d=await navigator.bluetooth.requestDevice({filters:[{services:["fitness_machine"]}],optionalServices:["fitness_machine"]});if(!d.gatt)throw new Error("GATT server not available");const f=d.name||"Indoor Bike",m=g=>{t.forEach(p=>p(g))},c=g=>{const v=g.target.value;if(v){k.log(f,v);try{const E=Bt(v),b={timestamp:Date.now(),speed:E.speed??null,cadence:E.cadence??null,resistanceLevel:E.resistanceLevel??null,power:E.instantaneousPower??null};n.forEach(D=>D(b))}catch(E){console.error("Error parsing indoor bike data",E)}}},o=async(g,p)=>{if(!r)throw new Error("Control point not available");const v=new ArrayBuffer(3),E=new DataView(v);E.setUint8(0,g),E.setInt16(1,p,!0),await r.writeValue(v)},u=async(g,p,v,E)=>{if(!r)throw new Error("Control point not available");const b=new ArrayBuffer(7),D=new DataView(b);D.setUint8(0,17),D.setInt16(1,Math.round(g*1e3),!0),D.setInt16(3,Math.round(p*100),!0),D.setUint8(5,Math.round(v*1e4)),D.setUint8(6,Math.round(E*100)),await r.writeValue(b)},h=async()=>{if(!d.gatt)return;i=await d.gatt.connect();const g=await i.getPrimaryService("fitness_machine");a=await g.getCharacteristic(10962),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",c);try{const E=(await(await g.getCharacteristic(10956)).readValue()).getUint32(0,!0);l=(E&8192)!==0,console.log(`Indoor Bike Features: ${E.toString(16)}, Sim Supported: ${l}`)}catch(p){console.warn("Failed to read fitness machine features",p)}try{r=await g.getCharacteristic(10969),await r.startNotifications()}catch{console.log("Indoor bike: Control point not available (ERG mode disabled)"),r=null}s=0,m("connected")},w=async()=>{if(e||s>=P){s>=P&&m("failed");return}s++;const g=O*Math.pow(2,s-1);m("reconnecting"),await new Promise(p=>setTimeout(p,g));try{await h()}catch{w()}};d.addEventListener("gattserverdisconnected",()=>{e||(m("disconnected"),w())});try{await h()}catch(g){throw i&&i.connected&&i.disconnect(),g}return{disconnect:()=>{if(e=!0,a)try{a.stopNotifications(),a.removeEventListener("characteristicvaluechanged",c)}catch{}if(r)try{r.stopNotifications()}catch{}d.gatt?.connected&&d.gatt.disconnect(),m("disconnected")},addListener:g=>{n.push(g)},deviceName:f,onStatusChange:g=>{t.push(g)},setTargetPower:r?async g=>{await o(5,g)}:void 0,setResistance:r?async g=>{await o(4,g*10)}:void 0,setSimulationParameters:r?async(g,p,v,E)=>{l||console.warn("Indoor bike does not support simulation parameters"),await u(g,p,v,E)}:void 0}},tn=async()=>{const n=[],t=[];let e=!1,s=0,a=null;const r=await navigator.bluetooth.requestDevice({filters:[{services:[6171]},{services:[6173]}],optionalServices:[6171,6173]});if(!r.gatt)throw new Error("GATT server not available");const i=r.name||"Weight Scale",l=o=>{t.forEach(u=>u(o))},d=o=>{const u=o.getUint8(0);let h=1;const w=(u&1)!==0,g=(u&2)!==0,p=(u&4)!==0,v=(u&8)!==0;let E=o.getUint16(h,!0);h+=2,w?E=E*.01*.453592:E=E*.005,g&&(h+=7),p&&(h+=1);let b;return v&&o.byteLength>=h+4&&(b=o.getUint16(h,!0)*.1),{timestamp:Date.now(),weight:Math.round(E*100)/100,bmi:b}},f=o=>{const h=o.target.value;if(h){k.log(i,h);try{const w=d(h);w&&w.weight>0&&n.forEach(g=>g(w))}catch(w){console.error("Error parsing weight data",w)}}},m=async()=>{if(!r.gatt)return;const o=await r.gatt.connect();try{a=await(await o.getPrimaryService(6171)).getCharacteristic(10908)}catch{a=await(await o.getPrimaryService(6173)).getCharacteristic(10909)}await a.startNotifications(),a.addEventListener("characteristicvaluechanged",f),s=0,l("connected")},c=async()=>{if(e||s>=P){s>=P&&l("failed");return}s++;const o=O*Math.pow(2,s-1);l("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m()}catch{c()}};return r.addEventListener("gattserverdisconnected",()=>{e||(l("disconnected"),c())}),await m(),{disconnect:()=>{e=!0,a&&(a.removeEventListener("characteristicvaluechanged",f),a.stopNotifications().catch(()=>{})),r.gatt?.disconnect()},addListener:o=>{n.push(o)},deviceName:i,onStatusChange:o=>{t.push(o)}}},nn=async()=>{const n=[],t=[];let e=!1,s=0,a=null,r;const i=await navigator.bluetooth.requestDevice({filters:[{services:["fitness_machine"]}],optionalServices:["fitness_machine"]});if(!i.gatt)throw new Error("GATT server not available");const l=i.name||"Step Climber",d=o=>{t.forEach(u=>u(o))},f=o=>{const h=o.target.value;if(h){k.log(l,h);try{const w=Ht(h),g={timestamp:Date.now(),...w,power:w.instantaneousPower??null,stepCount:w.stepCount??null,floors:w.floors??null,stepRate:w.stepRate??null};n.forEach(p=>p(g))}catch(w){console.error("Error parsing step climber data",w)}}},m=async()=>{if(!i.gatt)return;r=await i.gatt.connect(),a=await(await r.getPrimaryService("fitness_machine")).getCharacteristic(10959),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",f),s=0,d("connected")},c=async()=>{if(e||s>=P){s>=P&&d("failed");return}s++;const o=O*Math.pow(2,s-1);d("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m()}catch{c()}};i.addEventListener("gattserverdisconnected",()=>{e||(d("disconnected"),c())});try{await m()}catch(o){throw r&&r.connected&&r.disconnect(),o}return{disconnect:()=>{if(e=!0,a)try{a.stopNotifications(),a.removeEventListener("characteristicvaluechanged",f)}catch{}i.gatt?.connected&&i.gatt.disconnect(),d("disconnected")},addListener:o=>{n.push(o)},deviceName:l,onStatusChange:o=>{t.push(o)}}},sn=async()=>{const n=[],t=[];let e=!1,s=0,a=null,r;const i=await navigator.bluetooth.requestDevice({filters:[{services:["running_speed_and_cadence"]}],optionalServices:["running_speed_and_cadence"]});if(!i.gatt)throw new Error("GATT server not available");const l=i.name||"RSC Sensor",d=o=>{t.forEach(u=>u(o))},f=o=>{const h=o.target.value;if(h){k.log(l,h);try{const w=Ft(h),g={timestamp:Date.now(),...w};n.forEach(p=>p(g))}catch(w){console.error("Error parsing RSC data",w)}}},m=async()=>{if(!i.gatt)return;r=await i.gatt.connect(),a=await(await r.getPrimaryService("running_speed_and_cadence")).getCharacteristic(10835),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",f),s=0,d("connected")},c=async()=>{if(e||s>=P){s>=P&&d("failed");return}s++;const o=O*Math.pow(2,s-1);d("reconnecting"),await new Promise(u=>setTimeout(u,o));try{await m()}catch{c()}};i.addEventListener("gattserverdisconnected",()=>{e||(d("disconnected"),c())});try{await m()}catch(o){throw r&&r.connected&&r.disconnect(),o}return{disconnect:()=>{if(e=!0,a)try{a.stopNotifications(),a.removeEventListener("characteristicvaluechanged",f)}catch{}i.gatt?.connected&&i.gatt.disconnect(),d("disconnected")},addListener:o=>{n.push(o)},deviceName:l,onStatusChange:o=>{t.push(o)}}},dn={connectPower:async n=>{if(typeof window<"u"&&window.useMockSensors){const{MockPowerSensor:t}=await J(async()=>{const{MockPowerSensor:s}=await import("./mock-DGG0-SkM.js");return{MockPowerSensor:s}},[]),e=new t;return await e.connect(),window.mockSensor=e,e}return N.isNativePlatform()?Wt(n):Jt(n)},connectHeartRate:async n=>{if(typeof window<"u"&&window.useMockSensors){const{MockHeartrateSensor:t}=await J(async()=>{const{MockHeartrateSensor:s}=await import("./mock-DGG0-SkM.js");return{MockHeartrateSensor:s}},[]),e=new t;return await e.connect(),window.mockSensor=e,e}return N.isNativePlatform()?Vt(n):Kt(n)},connectCadence:async n=>{if(typeof window<"u"&&window.useMockSensors){const{MockCadenceSensor:t}=await J(async()=>{const{MockCadenceSensor:s}=await import("./mock-DGG0-SkM.js");return{MockCadenceSensor:s}},[]),e=new t;return await e.connect(),window.mockSensor=e,e}return N.isNativePlatform()?Gt(n):zt(n)},connectSpeed:async()=>{if(N.isNativePlatform())throw new Error("Native speed connection not implemented");return Me()},connectTreadmill:async n=>N.isNativePlatform()?Yt(n):Zt(n),connectRowing:async()=>{if(N.isNativePlatform())throw new Error("Native rowing connection not implemented");return Qt()},connectConcept2:async()=>{if(N.isNativePlatform())throw new Error("Native rowing connection not implemented");return Ae()},connectSkiErg:async()=>{if(N.isNativePlatform())throw new Error("Native ski erg connection not implemented");return Ae()},connectCsc:async()=>{if(N.isNativePlatform())throw new Error("Native CSC connection not implemented");return Me()},connectRunningSensor:async()=>{if(N.isNativePlatform())throw new Error("Native RSC connection not implemented");return sn()},connectCrossTrainer:async()=>{if(N.isNativePlatform())throw new Error("Native cross trainer connection not implemented");return Xt()},connectIndoorBike:async()=>{if(N.isNativePlatform())throw new Error("Native indoor bike connection not implemented");return en()},connectWeightScale:async()=>{if(N.isNativePlatform())throw new Error("Native weight scale connection not implemented");return tn()},connectStepClimber:async()=>{if(N.isNativePlatform())throw new Error("Native step climber connection not implemented");return nn()}};export{He as A,dn as B,N as C,cn as D,gt as E,wt as F,an as G,mt as H,ln as I,un as J,ze as K,on as L,me as W,J as _,dt as a,qe as b,xe as c,$e as d,Et as e,je as f,Ke as g,St as h,pt as i,oe as j,Lt as k,yt as l,bt as m,we as n,W as o,Ye as p,Ge as q,se as r,nt as s,vt as t,k as u,Se as v,Je as w,Ve as x,We as y,Fe as z};
//# sourceMappingURL=feature-bluetooth-CV0r-lfI.js.map
