{"version":3,"file":"DataScreenComponent-DaHdqZjz.js","sources":["../../src/components/data-fields/DataScreenComponent.ts"],"sourcesContent":["/**\n * Data Screen Web Component\n *\n * Renders a complete data screen with multiple data fields arranged in a grid.\n * Supports different layout modes and responsive sizing.\n *\n * @example\n * ```html\n * <bpt-data-screen screen-id=\"cycling-main\"></bpt-data-screen>\n * ```\n *\n * @module components/data-fields/DataScreenComponent\n */\n\nimport type { DataScreen, DataFieldSlot, ScreenLayout } from '../../data-fields/types.js';\nimport type { UserSettings } from '../../data-fields/types.js';\nimport { DataFieldComponent } from './DataFieldComponent.js';\n\n// Ensure DataFieldComponent is registered\nimport './DataFieldComponent.js';\n\n// ============================================================================\n// Component Definition\n// ============================================================================\n\n/**\n * Custom element for displaying a complete data screen\n */\nexport class DataScreenComponent extends HTMLElement {\n    static get observedAttributes(): string[] {\n        return ['layout'];\n    }\n\n    private screen: DataScreen | null = null;\n    private fieldElements: Map<string, DataFieldComponent> = new Map();\n    private settings: UserSettings | null = null;\n    private shadow: ShadowRoot;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    // ========================================================================\n    // Lifecycle\n    // ========================================================================\n\n    connectedCallback(): void {\n        this.render();\n    }\n\n    disconnectedCallback(): void {\n        this.cleanup();\n    }\n\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue === newValue) return;\n\n        if (name === 'layout' && this.screen) {\n            this.screen = { ...this.screen, layout: newValue as ScreenLayout };\n            this.updateLayout();\n        }\n    }\n\n    // ========================================================================\n    // Public API\n    // ========================================================================\n\n    /**\n     * Set the screen configuration to display\n     */\n    public setScreen(screen: DataScreen): void {\n        this.screen = screen;\n        this.render();\n    }\n\n    /**\n     * Get the current screen configuration\n     */\n    public getScreen(): DataScreen | null {\n        return this.screen;\n    }\n\n    /**\n     * Set user settings for all fields\n     */\n    public setSettings(settings: UserSettings): void {\n        this.settings = settings;\n        for (const fieldEl of this.fieldElements.values()) {\n            fieldEl.setSettings(settings);\n        }\n    }\n\n    /**\n     * Update a specific field's value\n     */\n    public updateFieldValue(slotId: string, value: number | null): void {\n        const fieldEl = this.fieldElements.get(slotId);\n        if (fieldEl) {\n            fieldEl.setValue(value);\n        }\n    }\n\n    /**\n     * Update multiple field values at once\n     */\n    public updateFieldValues(updates: Map<string, number | null>): void {\n        for (const [slotId, value] of updates) {\n            this.updateFieldValue(slotId, value);\n        }\n    }\n\n    /**\n     * Update field value by field ID (not slot ID)\n     */\n    public updateFieldByFieldId(fieldId: string, value: number | null): void {\n        for (const [_slotId, fieldEl] of this.fieldElements) {\n            if (fieldEl.getFieldId() === fieldId) {\n                fieldEl.setValue(value);\n            }\n        }\n    }\n\n    /**\n     * Get a field element by slot ID\n     */\n    public getFieldElement(slotId: string): DataFieldComponent | undefined {\n        return this.fieldElements.get(slotId);\n    }\n\n    /**\n     * Get all field elements\n     */\n    public getAllFieldElements(): Map<string, DataFieldComponent> {\n        return new Map(this.fieldElements);\n    }\n\n    /**\n     * Set connection state for a specific sensor type\n     */\n    public setSensorConnected(sensorType: string, connected: boolean): void {\n        for (const fieldEl of this.fieldElements.values()) {\n            const definition = fieldEl.getFieldDefinition();\n            if (definition?.requiresSensor?.includes(sensorType)) {\n                fieldEl.setAttribute('connected', String(connected));\n            }\n        }\n    }\n\n    /**\n     * Highlight a specific field temporarily\n     */\n    public highlightField(slotId: string, duration: number = 1000): void {\n        const fieldEl = this.fieldElements.get(slotId);\n        if (fieldEl) {\n            fieldEl.setAttribute('highlight', 'true');\n            setTimeout(() => {\n                fieldEl.removeAttribute('highlight');\n            }, duration);\n        }\n    }\n\n    // ========================================================================\n    // Rendering\n    // ========================================================================\n\n    private render(): void {\n        this.cleanup();\n\n        if (!this.screen) {\n            this.shadow.innerHTML = `\n                <style>${this.getStyles()}</style>\n                <div class=\"data-screen data-screen--empty\">\n                    <p>No screen configured</p>\n                </div>\n            `;\n            return;\n        }\n\n        this.shadow.innerHTML = `\n            <style>${this.getStyles()}</style>\n            <div class=\"data-screen data-screen--${this.screen.layout}\" \n                 data-slot-count=\"${this.screen.slots.length}\">\n                ${this.renderSlots()}\n            </div>\n        `;\n\n        this.setupFieldElements();\n    }\n\n    private renderSlots(): string {\n        if (!this.screen) return '';\n\n        return this.screen.slots\n            .sort((a, b) => a.position - b.position)\n            .map((slot) => this.renderSlot(slot))\n            .join('');\n    }\n\n    private renderSlot(slot: DataFieldSlot): string {\n        return `\n            <div class=\"data-screen__slot data-screen__slot--${slot.size}\"\n                 data-slot-id=\"${slot.id}\"\n                 style=\"order: ${slot.position}\">\n                <bpt-data-field \n                    field-id=\"${slot.fieldId}\" \n                    size=\"${slot.size}\"\n                    data-slot-id=\"${slot.id}\">\n                </bpt-data-field>\n            </div>\n        `;\n    }\n\n    private setupFieldElements(): void {\n        const fieldEls = this.shadow.querySelectorAll('bpt-data-field');\n        fieldEls.forEach((el) => {\n            const fieldEl = el as DataFieldComponent;\n            const slotId = fieldEl.getAttribute('data-slot-id');\n            if (slotId) {\n                this.fieldElements.set(slotId, fieldEl);\n                if (this.settings) {\n                    fieldEl.setSettings(this.settings);\n                }\n            }\n        });\n    }\n\n    private updateLayout(): void {\n        const screenEl = this.shadow.querySelector('.data-screen');\n        if (!screenEl || !this.screen) return;\n\n        // Remove existing layout classes\n        screenEl.className = 'data-screen';\n        screenEl.classList.add(`data-screen--${this.screen.layout}`);\n    }\n\n    private cleanup(): void {\n        this.fieldElements.clear();\n    }\n\n    // ========================================================================\n    // Styles\n    // ========================================================================\n\n    private getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                height: 100%;\n            }\n\n            .data-screen {\n                display: grid;\n                gap: var(--screen-gap, 8px);\n                padding: var(--screen-padding, 8px);\n                height: 100%;\n                box-sizing: border-box;\n                align-content: start;\n            }\n\n            .data-screen--empty {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--text-muted, #888);\n            }\n\n            /* Auto layout - responsive grid */\n            .data-screen--auto {\n                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));\n            }\n\n            /* Fixed column layouts */\n            .data-screen--grid-2 {\n                grid-template-columns: repeat(2, 1fr);\n            }\n\n            .data-screen--grid-3 {\n                grid-template-columns: repeat(3, 1fr);\n            }\n\n            .data-screen--grid-4 {\n                grid-template-columns: repeat(4, 1fr);\n            }\n\n            /* List layout - single column */\n            .data-screen--list {\n                grid-template-columns: 1fr;\n            }\n\n            /* Custom layout - explicit positioning */\n            .data-screen--custom {\n                grid-template-columns: repeat(4, 1fr);\n                grid-auto-rows: minmax(80px, auto);\n            }\n\n            /* Slot container */\n            .data-screen__slot {\n                display: flex;\n                min-height: 60px;\n            }\n\n            .data-screen__slot > * {\n                flex: 1;\n            }\n\n            /* Size-based grid spanning */\n            .data-screen__slot--large,\n            .data-screen__slot--wide {\n                grid-column: span 2;\n            }\n\n            .data-screen__slot--tall {\n                grid-row: span 2;\n            }\n\n            .data-screen__slot--full,\n            .data-screen__slot--xlarge {\n                grid-column: span 2;\n                grid-row: span 2;\n            }\n\n            .data-screen__slot--xxlarge {\n                grid-column: span 4;\n                grid-row: span 2;\n            }\n\n            .data-screen__slot--jumbo {\n                grid-column: span 4;\n                grid-row: span 3;\n            }\n\n            /* Responsive adjustments */\n            @media (max-width: 400px) {\n                .data-screen--auto {\n                    grid-template-columns: repeat(2, 1fr);\n                }\n\n                .data-screen--grid-3,\n                .data-screen--grid-4 {\n                    grid-template-columns: repeat(2, 1fr);\n                }\n\n                .data-screen__slot--large,\n                .data-screen__slot--wide {\n                    grid-column: span 2;\n                }\n            }\n\n            @media (min-width: 600px) {\n                .data-screen--auto {\n                    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n                }\n            }\n\n            @media (min-width: 900px) {\n                .data-screen--auto {\n                    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n                }\n\n                .data-screen {\n                    gap: var(--screen-gap, 12px);\n                    padding: var(--screen-padding, 12px);\n                }\n            }\n\n            /* Animation for slot changes */\n            .data-screen__slot {\n                transition: transform 0.2s ease, opacity 0.2s ease;\n            }\n\n            .data-screen__slot:empty {\n                opacity: 0.3;\n                border: 2px dashed var(--border-color, #444);\n                border-radius: 8px;\n            }\n        `;\n    }\n}\n\n// ============================================================================\n// Register Custom Element\n// ============================================================================\n\nif (!customElements.get('bpt-data-screen')) {\n    customElements.define('bpt-data-screen', DataScreenComponent);\n}\n\nexport default DataScreenComponent;\n"],"names":["DataScreenComponent","name","oldValue","newValue","screen","settings","fieldEl","slotId","value","updates","fieldId","_slotId","sensorType","connected","duration","a","b","slot","el","screenEl"],"mappings":"yNA4BO,MAAMA,UAA4B,WAAY,CACjD,WAAW,oBAA+B,CACtC,MAAO,CAAC,QAAQ,CACpB,CAEQ,OAA4B,KAC5B,kBAAqD,IACrD,SAAgC,KAChC,OAER,aAAc,CACV,MAAA,EACA,KAAK,OAAS,KAAK,aAAa,CAAE,KAAM,OAAQ,CACpD,CAMA,mBAA0B,CACtB,KAAK,OAAA,CACT,CAEA,sBAA6B,CACzB,KAAK,QAAA,CACT,CAEA,yBAAyBC,EAAcC,EAAyBC,EAA+B,CACvFD,IAAaC,GAEbF,IAAS,UAAY,KAAK,SAC1B,KAAK,OAAS,CAAE,GAAG,KAAK,OAAQ,OAAQE,CAAA,EACxC,KAAK,aAAA,EAEb,CASO,UAAUC,EAA0B,CACvC,KAAK,OAASA,EACd,KAAK,OAAA,CACT,CAKO,WAA+B,CAClC,OAAO,KAAK,MAChB,CAKO,YAAYC,EAA8B,CAC7C,KAAK,SAAWA,EAChB,UAAWC,KAAW,KAAK,cAAc,OAAA,EACrCA,EAAQ,YAAYD,CAAQ,CAEpC,CAKO,iBAAiBE,EAAgBC,EAA4B,CAChE,MAAMF,EAAU,KAAK,cAAc,IAAIC,CAAM,EACzCD,GACAA,EAAQ,SAASE,CAAK,CAE9B,CAKO,kBAAkBC,EAA2C,CAChE,SAAW,CAACF,EAAQC,CAAK,IAAKC,EAC1B,KAAK,iBAAiBF,EAAQC,CAAK,CAE3C,CAKO,qBAAqBE,EAAiBF,EAA4B,CACrE,SAAW,CAACG,EAASL,CAAO,IAAK,KAAK,cAC9BA,EAAQ,WAAA,IAAiBI,GACzBJ,EAAQ,SAASE,CAAK,CAGlC,CAKO,gBAAgBD,EAAgD,CACnE,OAAO,KAAK,cAAc,IAAIA,CAAM,CACxC,CAKO,qBAAuD,CAC1D,OAAO,IAAI,IAAI,KAAK,aAAa,CACrC,CAKO,mBAAmBK,EAAoBC,EAA0B,CACpE,UAAWP,KAAW,KAAK,cAAc,OAAA,EAClBA,EAAQ,mBAAA,GACX,gBAAgB,SAASM,CAAU,GAC/CN,EAAQ,aAAa,YAAa,OAAOO,CAAS,CAAC,CAG/D,CAKO,eAAeN,EAAgBO,EAAmB,IAAY,CACjE,MAAMR,EAAU,KAAK,cAAc,IAAIC,CAAM,EACzCD,IACAA,EAAQ,aAAa,YAAa,MAAM,EACxC,WAAW,IAAM,CACbA,EAAQ,gBAAgB,WAAW,CACvC,EAAGQ,CAAQ,EAEnB,CAMQ,QAAe,CAGnB,GAFA,KAAK,QAAA,EAED,CAAC,KAAK,OAAQ,CACd,KAAK,OAAO,UAAY;AAAA,yBACX,KAAK,WAAW;AAAA;AAAA;AAAA;AAAA,cAK7B,MACJ,CAEA,KAAK,OAAO,UAAY;AAAA,qBACX,KAAK,WAAW;AAAA,mDACc,KAAK,OAAO,MAAM;AAAA,oCACjC,KAAK,OAAO,MAAM,MAAM;AAAA,kBAC1C,KAAK,aAAa;AAAA;AAAA,UAI5B,KAAK,mBAAA,CACT,CAEQ,aAAsB,CAC1B,OAAK,KAAK,OAEH,KAAK,OAAO,MACd,KAAK,CAACC,EAAGC,IAAMD,EAAE,SAAWC,EAAE,QAAQ,EACtC,IAAKC,GAAS,KAAK,WAAWA,CAAI,CAAC,EACnC,KAAK,EAAE,EALa,EAM7B,CAEQ,WAAWA,EAA6B,CAC5C,MAAO;AAAA,+DACgDA,EAAK,IAAI;AAAA,iCACvCA,EAAK,EAAE;AAAA,iCACPA,EAAK,QAAQ;AAAA;AAAA,gCAEdA,EAAK,OAAO;AAAA,4BAChBA,EAAK,IAAI;AAAA,oCACDA,EAAK,EAAE;AAAA;AAAA;AAAA,SAIvC,CAEQ,oBAA2B,CACd,KAAK,OAAO,iBAAiB,gBAAgB,EACrD,QAASC,GAAO,CACrB,MAAMZ,EAAUY,EACVX,EAASD,EAAQ,aAAa,cAAc,EAC9CC,IACA,KAAK,cAAc,IAAIA,EAAQD,CAAO,EAClC,KAAK,UACLA,EAAQ,YAAY,KAAK,QAAQ,EAG7C,CAAC,CACL,CAEQ,cAAqB,CACzB,MAAMa,EAAW,KAAK,OAAO,cAAc,cAAc,EACrD,CAACA,GAAY,CAAC,KAAK,SAGvBA,EAAS,UAAY,cACrBA,EAAS,UAAU,IAAI,gBAAgB,KAAK,OAAO,MAAM,EAAE,EAC/D,CAEQ,SAAgB,CACpB,KAAK,cAAc,MAAA,CACvB,CAMQ,WAAoB,CACxB,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAqIX,CACJ,CAMK,eAAe,IAAI,iBAAiB,GACrC,eAAe,OAAO,kBAAmBnB,CAAmB"}