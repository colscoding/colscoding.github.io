const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CmfhMaTA.js","assets/feature-bluetooth-BY8rQx0J.js","assets/vendor-core-Dob3nYDb.js","assets/feature-export-7zlEGvkQ.js","assets/vendor-leaflet-3-yx3GaH.js","assets/index-BmzgHFUM.css"])))=>i.map(i=>d[i]);
import{g as Oe,p as it,_ as Et,q as F,u as N,v as st,s as kt,w as c,x as h,y as we,z as xe,A as Re,D as at,E as Me}from"./feature-bluetooth-BY8rQx0J.js";import{t as It,m as bt,n as dt,o as St,v as He,q as Le,u as lt,w as Bt,x as wt}from"./index-CmfhMaTA.js";import"./vendor-core-Dob3nYDb.js";import"./feature-export-7zlEGvkQ.js";import"./vendor-leaflet-3-yx3GaH.js";function xt(r,s){let o=null;return(...f)=>{o&&clearTimeout(o),o=setTimeout(()=>{r(...f)},s)}}function Mt(){const r=document.getElementById("saveSettings"),s=document.getElementById("settingMaxHr"),o=document.getElementById("settingWeight"),f=(e,n,a)=>{const d=Number(e.value);return!e.value||isNaN(d)||d<n||d>a?(e.style.borderColor="#dc3545",e.setAttribute("aria-invalid","true"),!1):(e.style.borderColor="#28a745",e.setAttribute("aria-invalid","false"),!0)},w=e=>{e.style.borderColor="",e.removeAttribute("aria-invalid")},v=document.getElementById("settingSpeed"),i=document.getElementById("settingDistance"),x=document.getElementById("settingAltitude"),m=document.getElementById("settingShowCalories"),u=document.getElementById("settingPower"),y=document.getElementById("settingCadence"),j=document.getElementById("settingHeartrate"),X=document.getElementById("settingTreadmillSpeed"),G=document.getElementById("settingPower3s"),Q=document.getElementById("settingHighContrast"),Y=document.getElementById("settingColorblindPatterns"),ee=document.getElementById("settingVoiceEnabled"),te=document.getElementById("settingVoiceLaps"),ne=document.getElementById("settingVoiceZones"),E=document.getElementById("settingAutoPauseEnabled"),M=document.getElementById("settingAutoPauseSource"),R=document.getElementById("settingAutoPauseThreshold"),H=document.getElementById("settingAutoPauseDelay"),Pe=document.getElementById("autoPauseOptions"),Ke=document.getElementById("autoPauseThresholdUnit"),oe=document.getElementById("settingExportTcx"),ce=document.getElementById("settingExportCsv"),ie=document.getElementById("settingExportJson"),se=document.getElementById("settingExportFit"),ae=document.getElementById("settingPromptForNotes"),de=document.getElementById("settingPromptForExertion"),K=document.getElementById("settingCountdownDuration"),le=document.getElementById("settingCountdownBeep"),re=document.getElementById("settingCountdownVoice"),k=document.getElementById("settingAutoLapEnabled"),L=document.getElementById("settingAutoLapSource"),g=document.getElementById("settingAutoLapDistance"),$=document.getElementById("settingAutoLapTime"),Ve=document.getElementById("autoLapOptions"),$e=document.getElementById("autoLapDistanceOption"),_e=document.getElementById("autoLapTimeOption"),P=document.getElementById("settingVoiceSelection"),_=document.getElementById("settingVoiceTimeInterval"),z=document.getElementById("settingVoiceDistanceInterval"),J=document.getElementById("settingVoiceSpeechRate"),ue=document.getElementById("settingVoiceMetricPower"),ge=document.getElementById("settingVoiceMetricHeartrate"),me=document.getElementById("settingVoiceMetricCadence"),I=document.getElementById("settingVoiceMetricSpeed"),pe=document.getElementById("settingVoiceMetricDistance"),ve=document.getElementById("settingVoiceMetricTime"),b=document.getElementById("settingVoiceMetricPace"),U=document.getElementById("settingVoiceTargetFeedback"),he=document.getElementById("settingVoiceTemplate"),Te=document.getElementById("settingSmartAnnouncements"),l=document.getElementById("settingSportType"),W=document.getElementById("settingShowPace"),Z=document.getElementById("settingThresholdPace"),ze=document.getElementById("runningOptions"),V=document.getElementById("settingIntervalsEnabled"),T=document.getElementById("settingIntervalsApiKey"),Ae=document.getElementById("toggleIntervalsApiKey"),fe=document.getElementById("settingIntervalsAthleteId"),ye=document.getElementById("settingIntervalsAutoUpload"),Je=document.getElementById("intervalsOptions"),A=document.getElementById("settingMusicEnabled"),S=document.getElementById("settingMusicVolume"),We=document.getElementById("musicVolumeValue"),Ee=document.getElementById("settingMusicStyle"),C=document.getElementById("settingMusicTempoSync"),q=document.getElementById("settingMusicFixedBPM"),ke=document.getElementById("settingMusicIntensityMapping"),Ie=document.getElementById("settingMusicTransitionSpeed"),D=document.getElementById("settingMusicDucking"),B=document.getElementById("settingMusicDuckingLevel"),Ze=document.getElementById("musicDuckingLevelValue"),qe=document.getElementById("musicOptions"),je=document.getElementById("fixedBpmOption"),Xe=document.getElementById("duckingLevelOption"),be=document.getElementById("settingDebugMode"),Ge=document.getElementById("debugControls"),rt=document.getElementById("downloadDebugLogs"),ut=document.getElementById("clearDebugLogs"),Se=document.getElementById("settingMockSensors"),gt=document.getElementById("installPwaButton"),Qe=()=>{Je&&V&&(Je.style.display=V.checked?"flex":"none")},Be=()=>{qe&&A&&(qe.style.display=A.checked?"flex":"none"),je&&C&&(je.style.display=C.value==="fixed"?"flex":"none"),Xe&&D&&(Xe.style.display=D.checked?"flex":"none")},Ye=()=>{We&&S&&(We.textContent=`${S.value}%`)},et=()=>{Ze&&B&&(Ze.textContent=`${B.value}%`)},tt=()=>{if(ze&&l){const e=l.value==="running"||l.value==="walking";ze.style.display=e?"block":"none"}},mt=e=>{const n=e.match(/^(\d{1,2}):([0-5]\d)$/);if(!n)return null;const a=parseInt(n[1],10),d=parseInt(n[2],10);return a*60+d},pt=()=>{const e=lt();if(l&&(e.activeSport=l.value),W!==null&&(e.running.showPace=W.checked),Z?.value){const n=mt(Z.value);n!==null&&(e.running.targetPaceMin=n-30,e.running.targetPaceMax=n+30)}Bt(e)};let Ce="cycling";const vt=()=>{const e=lt();if(l&&(l.value=e.activeSport,Ce=e.activeSport),W&&(W.checked=e.running.showPace),Z){const n=Math.round((e.running.targetPaceMin+e.running.targetPaceMax)/2);Z.value=wt(n)}tt()};l?.addEventListener("change",async()=>{tt();const e=l?.value;if(e){const n=Oe();n.sportType=e,it(n);const a=e,{loadActivityScreens:d}=await Et(async()=>{const{loadActivityScreens:Ue}=await import("./index-CmfhMaTA.js").then(yt=>yt.L);return{loadActivityScreens:Ue}},__vite__mapDeps([0,1,2,3,4,5])),p=d(a),O=new CustomEvent("data-fields-activity-changed",{detail:{activityType:a,config:p}});document.dispatchEvent(O)}g&&(e==="running"||e==="walking"?(g.value==="5"||g.value==="10")&&(g.value="1"):e==="cycling"&&(g.value==="1"||g.value==="0.4")&&(g.value="5"))}),Ae?.addEventListener("click",()=>{if(T){const e=T.type==="password";T.type=e?"text":"password",Ae&&(Ae.textContent=e?"ðŸ™ˆ":"ðŸ‘ï¸")}}),V?.addEventListener("change",Qe);const De=()=>{if(Pe&&E&&(Pe.style.opacity=E.checked?"1":"0.5",Pe.style.pointerEvents=E.checked?"auto":"none"),Ke&&M){const e=bt(M.value);Ke.textContent=e}};E?.addEventListener("change",De),M?.addEventListener("change",De);const Fe=()=>{if(Ve&&k&&(Ve.style.opacity=k.checked?"1":"0.5",Ve.style.pointerEvents=k.checked?"auto":"none"),$e&&_e&&L){const e=L.value==="distance";$e.style.display=e?"flex":"none",_e.style.display=e?"none":"flex"}};k?.addEventListener("change",Fe),L?.addEventListener("change",Fe);const nt=e=>{He.reloadVoice();const n=(d,p)=>{document.querySelectorAll(`.metric-group-${d}`).forEach(Ue=>{Ue.style.display=p?"flex":"none"})};n("speed",e.speed),n("distance",e.distance),n("altitude",e.altitude),n("energy",e.showCalories),n("power",e.power),n("cadence",e.cadence),n("heartrate",e.heartrate),n("treadmillSpeed",e.treadmillSpeed),document.querySelectorAll(".metric-group-power").forEach(d=>{e.power3s?d.setAttribute("data-show-avg","true"):d.removeAttribute("data-show-avg")}),e.highContrast?document.documentElement.setAttribute("data-high-contrast","true"):document.documentElement.removeAttribute("data-high-contrast"),e.colorblindPatterns?document.documentElement.setAttribute("data-colorblind-patterns","true"):document.documentElement.removeAttribute("data-colorblind-patterns"),Ge&&(Ge.style.display=e.debugMode?"flex":"none")},ot=()=>({timeIntervalMinutes:_?.value?parseInt(_.value):F.timeIntervalMinutes,distanceIntervalKm:z?.value?parseInt(z.value):F.distanceIntervalKm,metrics:{power:ue?.checked??N.power,heartrate:ge?.checked??N.heartrate,cadence:me?.checked??N.cadence,speed:I?.checked??N.speed,distance:pe?.checked??N.distance,time:ve?.checked??N.time,pace:b?.checked??N.pace},speechRate:J?.value?parseFloat(J.value):F.speechRate,voiceURI:P?.value||F.voiceURI,workoutTargetFeedback:U?.checked??F.workoutTargetFeedback,smartAnnouncements:Te?.checked??F.smartAnnouncements,announcementTemplate:he?.value||F.announcementTemplate}),ct=e=>{_&&(_.value=e.timeIntervalMinutes.toString()),z&&(z.value=e.distanceIntervalKm.toString()),J&&(J.value=e.speechRate.toString()),ue&&(ue.checked=e.metrics.power),ge&&(ge.checked=e.metrics.heartrate),me&&(me.checked=e.metrics.cadence),I&&(I.checked=e.metrics.speed),pe&&(pe.checked=e.metrics.distance),ve&&(ve.checked=e.metrics.time),b&&(b.checked=e.metrics.pace),P&&e.voiceURI&&(P.value=e.voiceURI),U&&(U.checked=e.workoutTargetFeedback),Te&&(Te.checked=e.smartAnnouncements),he&&(he.value=e.announcementTemplate||"")},Ne=()=>{const n={...dt(),maxHr:s?.value?Number(s.value):null,weight:o?.value?Number(o.value):null};St(n),window.dispatchEvent(new CustomEvent("user-profile-changed")),kt.setMultiple({maxHeartrate:n.maxHr??190,weight:n.weight??75});const a={sportType:l?.value??c.sportType,speed:v?.checked??c.speed,distance:i?.checked??c.distance,altitude:x?.checked??c.altitude,weightKg:o?.value?Number(o.value):c.weightKg,showCalories:m?.checked??c.showCalories,power:u?.checked??c.power,cadence:y?.checked??c.cadence,heartrate:j?.checked??c.heartrate,treadmillSpeed:X?.checked??c.treadmillSpeed,power3s:G?.checked??c.power3s,highContrast:Q?.checked??c.highContrast,colorblindPatterns:Y?.checked??c.colorblindPatterns,voiceEnabled:ee?.checked??c.voiceEnabled,voiceLaps:te?.checked??c.voiceLaps,voiceZones:ne?.checked??c.voiceZones,autoPause:{enabled:E?.checked??Me.enabled,source:M?.value??Me.source,threshold:R?.value?Number(R.value):Me.threshold,delay:H?.value?Number(H.value):Me.delay},workoutMetadata:{promptForNotes:ae?.checked??at.promptForNotes,promptForExertion:de?.checked??at.promptForExertion},countdown:{duration:K?.value?parseInt(K.value):Re.duration,enableBeep:le?.checked??Re.enableBeep,enableVoice:re?.checked??Re.enableVoice},autoLap:{enabled:k?.checked??xe.enabled,source:L?.value??xe.source,distanceKm:g?.value?Number(g.value):xe.distanceKm,timeMinutes:$?.value?Number($.value):xe.timeMinutes},enhancedVoice:ot(),intervals:{enabled:V?.checked??we.enabled,apiKey:T?.value??we.apiKey,athleteId:fe?.value??we.athleteId,autoUpload:ye?.checked??we.autoUpload},music:{enabled:A?.checked??h.enabled,volume:S?.value?Number(S.value)/100:h.volume,style:Ee?.value??h.style,tempoSync:C?.value??h.tempoSync,fixedBPM:q?.value?Number(q.value):h.fixedBPM,intensityMapping:ke?.value??h.intensityMapping,transitionSpeed:Ie?.value??h.transitionSpeed,duckingEnabled:D?.checked??h.duckingEnabled,duckingLevel:B?.value?Number(B.value)/100:h.duckingLevel},exportTcx:oe?.checked??c.exportTcx,exportCsv:ce?.checked??c.exportCsv,exportJson:ie?.checked??c.exportJson,exportFit:se?.checked??c.exportFit,debugMode:be?.checked??c.debugMode,mockSensors:Se?.checked??c.mockSensors,wheelCircumferenceMm:Oe().wheelCircumferenceMm};window.useMockSensors=a.mockSensors,it(a),pt(),nt(a)},ht=()=>{const e=Oe(),n=dt();if(s&&(s.value=n.maxHr?.toString()??""),o&&(o.value=n.weight?.toString()??""),u&&(u.checked=e.power),y&&(y.checked=e.cadence),j&&(j.checked=e.heartrate),v&&(v.checked=e.speed),i&&(i.checked=e.distance),x&&(x.checked=e.altitude),m&&(m.checked=e.showCalories),X&&(X.checked=e.treadmillSpeed),G&&(G.checked=e.power3s),Q&&(Q.checked=e.highContrast),Y&&(Y.checked=e.colorblindPatterns),ee&&(ee.checked=e.voiceEnabled),te&&(te.checked=e.voiceLaps),ne&&(ne.checked=e.voiceZones),P){const a=()=>{const d=He.getAvailableVoices();P.innerHTML='<option value="">Default System Voice</option>',d.forEach(p=>{const O=document.createElement("option");O.value=p.voiceURI,O.textContent=`${p.name} (${p.lang})`,P.appendChild(O)}),e.enhancedVoice.voiceURI&&(P.value=e.enhancedVoice.voiceURI)};a(),He.getAvailableVoices().length===0&&(setTimeout(a,500),setTimeout(a,2e3))}E&&(E.checked=e.autoPause.enabled),M&&(M.value=e.autoPause.source),R&&(R.value=e.autoPause.threshold.toString()),H&&(H.value=e.autoPause.delay.toString()),De(),oe&&(oe.checked=e.exportTcx),ce&&(ce.checked=e.exportCsv),ie&&(ie.checked=e.exportJson),se&&(se.checked=e.exportFit),ae&&(ae.checked=e.workoutMetadata.promptForNotes),de&&(de.checked=e.workoutMetadata.promptForExertion),K&&(K.value=e.countdown.duration.toString()),le&&(le.checked=e.countdown.enableBeep),re&&(re.checked=e.countdown.enableVoice),k&&(k.checked=e.autoLap.enabled),L&&(L.value=e.autoLap.source),g&&(g.value=e.autoLap.distanceKm.toString()),$&&($.value=e.autoLap.timeMinutes.toString()),Fe(),ct(e.enhancedVoice),V&&(V.checked=e.intervals.enabled),T&&(T.value=e.intervals.apiKey),fe&&(fe.value=e.intervals.athleteId),ye&&(ye.checked=e.intervals.autoUpload),Qe(),A&&(A.checked=e.music.enabled),S&&(S.value=(e.music.volume*100).toString()),Ye(),Ee&&(Ee.value=e.music.style),C&&(C.value=e.music.tempoSync),q&&(q.value=e.music.fixedBPM.toString()),ke&&(ke.value=e.music.intensityMapping),Ie&&(Ie.value=e.music.transitionSpeed),D&&(D.checked=e.music.duckingEnabled),B&&(B.value=(e.music.duckingLevel*100).toString()),et(),Be(),be&&(be.checked=e.debugMode),Se&&(Se.checked=e.mockSensors),window.useMockSensors=e.mockSensors,vt(),nt(e)},ft=xt(()=>Ne(),500),t=(e,n="change")=>{e&&(n==="input"?e.addEventListener("input",ft):e.addEventListener("change",()=>Ne()))};t(s,"input"),t(o,"input"),s?.addEventListener("blur",()=>{s.value?f(s,100,250):w(s)}),s?.addEventListener("focus",()=>w(s)),o?.addEventListener("blur",()=>{o.value?f(o,30,300):w(o)}),o?.addEventListener("focus",()=>w(o)),[v,i,x,m,u,y,j,X,G].forEach(e=>t(e)),t(Q),t(Y),t(ee),t(te),t(ne),t(E),t(M),t(R,"input"),t(H,"input"),[oe,ce,ie,se].forEach(e=>t(e)),t(ae),t(de),t(K),t(le),t(re),t(k),t(L),t(g),t($),t(_),t(z),t(J),[ue,ge,me,I,pe,ve,b,U].forEach(e=>t(e)),t(he,"input"),l&&l.addEventListener("change",()=>{const e=l.value,n=ot(),a=localStorage.getItem("voice_presets"),d=a?JSON.parse(a):{};d[Ce]=n,localStorage.setItem("voice_presets",JSON.stringify(d));const p=d[e];p?ct(p):(e==="running"||e==="walking"?(b&&(b.checked=!0),I&&(I.checked=!1)):(b&&(b.checked=!1),I&&(I.checked=!0)),U&&(U.checked=!1)),Ce=e,Ne()}),t(W),t(Z,"input"),t(V),t(T,"input"),t(fe,"input"),t(ye),t(A),t(S,"input"),t(Ee),t(C),t(q,"input"),t(ke),t(Ie),t(D),t(B,"input"),S?.addEventListener("input",Ye),B?.addEventListener("input",et),A?.addEventListener("change",Be),C?.addEventListener("change",Be),D?.addEventListener("change",Be),t(be),t(Se),r&&(r.textContent="Close Settings",r.className="close-settings-btn",r.style.background="#6c757d",r.addEventListener("click",()=>{window.router?window.router.navigate("/"):window.history.back()})),rt?.addEventListener("click",()=>{st.exportLogs()}),ut?.addEventListener("click",async()=>{confirm("Are you sure you want to clear all debug logs?")&&(await st.clearLogs(),alert("Logs cleared."))}),gt?.addEventListener("click",async()=>{const e=await It();e==="accepted"?console.log("PWA installation accepted"):e==="dismissed"?console.log("PWA installation dismissed"):alert("Installation is not available at this time. The app may already be installed or your browser does not support installation.")}),ht(),Lt()}function Lt(){const r=document.getElementById("featureFlagsList"),s=document.getElementById("resetFeatureFlags");if(!r)return;const o=()=>{const v=Le.getAllFlags();r.innerHTML="",Object.values(v).forEach(i=>{if(i.category==="debug")return;const x=f(i.category),m=document.createElement("label");m.className="settings-option",m.style.cssText="display: flex; align-items: flex-start; gap: 10px; cursor: pointer;";const u=document.createElement("input");u.type="checkbox",u.id=`flag-${i.key}`,u.checked=i.enabled,u.style.cssText="width: 20px; height: 20px; margin-top: 2px;",u.addEventListener("change",()=>{u.checked?Le.enable(i.key):Le.disable(i.key),w()});const y=document.createElement("div");y.style.cssText="flex: 1;",y.innerHTML=`
                <span style="font-size: 16px; display: flex; align-items: center; gap: 8px;">
                    ${i.name}
                    <span style="font-size: 11px; padding: 2px 6px; border-radius: 4px; ${x}">${i.category}</span>
                </span>
                <p style="font-size: 12px; color: #666; margin: 2px 0 0 0;">${i.description}</p>
            `,m.appendChild(u),m.appendChild(y),r.appendChild(m)})},f=v=>{switch(v){case"core":return"background: #e3f2fd; color: #1976d2;";case"experimental":return"background: #fff3e0; color: #f57c00;";case"premium":return"background: #f3e5f5; color: #7b1fa2;";case"debug":return"background: #fce4ec; color: #c2185b;";default:return"background: #f5f5f5; color: #666;"}},w=()=>{if(document.getElementById("feature-flag-notice"))return;const i=document.createElement("div");i.id="feature-flag-notice",i.style.cssText=`
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,i.innerHTML=`
            <span>Refresh page to apply changes</span>
            <button id="refreshNowBtn" style="
                background: #2196f3;
                color: white;
                border: none;
                padding: 6px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            ">Refresh Now</button>
        `,document.body.appendChild(i),document.getElementById("refreshNowBtn")?.addEventListener("click",()=>{window.location.reload()}),setTimeout(()=>{i.remove()},1e4)};s?.addEventListener("click",()=>{confirm("Reset all feature flags to their default values?")&&(Le.resetToDefaults(),o(),w())}),o()}class Dt{id="settings";init(s){const o=document.getElementById("settingsTemplate");if(o){const f=o.content.cloneNode(!0);s.appendChild(f),setTimeout(()=>{Mt()},0)}else console.error("Settings template not found!"),s.innerHTML="<p>Error loading settings view</p>"}onEnter(){}onLeave(){console.log("Left Settings View")}}export{Dt as SettingsView};
//# sourceMappingURL=SettingsView-DOkIHdv6.js.map
