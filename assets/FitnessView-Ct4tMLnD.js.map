{"version":3,"file":"FitnessView-Ct4tMLnD.js","sources":["../../src/views/FitnessView.ts"],"sourcesContent":["import { View } from '../router/View.js';\nimport { Chart, registerables, ScriptableContext } from 'chart.js';\nimport { getClientPMCData } from '../services/fitnessService.js';\nimport { DailyPMC } from '../storage/workoutStorage.js';\n\nChart.register(...registerables);\n\nexport class FitnessView implements View {\n    public id = 'fitness';\n    private container: HTMLElement | null = null;\n    private chart: Chart | null = null;\n\n    public init(container: HTMLElement): void {\n        this.container = container;\n        this.container.innerHTML = `\n            <div class=\"view-header\">\n                <h2>Fitness & Freshness</h2>\n            </div>\n            <div class=\"fitness-content\" style=\"padding: 1rem;\">\n                <div class=\"chart-container\" style=\"position: relative; height: 400px; width: 100%;\">\n                    <canvas id=\"pmcChart\"></canvas>\n                </div>\n                <div id=\"fitness-status\" class=\"status-message\" style=\"margin-top: 1rem; text-align: center; color: var(--text-muted);\">Loading data...</div>\n            </div>\n        `;\n    }\n\n    public async onEnter(): Promise<void> {\n        // Load data on enter\n        await this.loadData();\n    }\n\n    public onLeave(): void {\n        if (this.chart) {\n            this.chart.destroy();\n            this.chart = null;\n        }\n    }\n\n    private async loadData(): Promise<void> {\n        try {\n            const data = await getClientPMCData();\n            if (data.length === 0) {\n                const status = this.container?.querySelector('#fitness-status');\n                if (status)\n                    status.textContent =\n                        'No fitness data available yet. Complete a workout with power data to see your stats!';\n            }\n            this.renderChart(data);\n            const status = this.container?.querySelector('#fitness-status');\n            if (status) status.textContent = '';\n        } catch (error) {\n            console.error(error);\n            const status = this.container?.querySelector('#fitness-status');\n            if (status) status.textContent = 'Error loading fitness data.';\n        }\n    }\n\n    private renderChart(data: DailyPMC[]): void {\n        const ctx = (this.container?.querySelector('#pmcChart') as HTMLCanvasElement)?.getContext('2d');\n        if (!ctx) return;\n\n        if (this.chart) {\n            this.chart.destroy();\n        }\n\n        // Get computed style for colors if possible, else use defaults\n        const textColor = getComputedStyle(document.body).getPropertyValue('--text-main').trim() || '#ffffff';\n        const gridColor =\n            getComputedStyle(document.body).getPropertyValue('--border-color').trim() || 'rgba(255, 255, 255, 0.1)';\n\n        this.chart = new Chart(ctx, {\n            type: 'line',\n            data: {\n                labels: data.map((d) => d.date),\n                datasets: [\n                    {\n                        label: 'Fitness (CTL)',\n                        data: data.map((d) => d.ctl),\n                        borderColor: 'rgb(75, 192, 192)',\n                        backgroundColor: 'rgba(75, 192, 192, 0.2)',\n                        yAxisID: 'y',\n                        fill: true,\n                        tension: 0.1,\n                    },\n                    {\n                        label: 'Fatigue (ATL)',\n                        data: data.map((d) => d.atl),\n                        borderColor: 'rgb(255, 99, 132)',\n                        backgroundColor: 'rgba(255, 99, 132, 0.2)',\n                        yAxisID: 'y',\n                        fill: false,\n                        tension: 0.1,\n                    },\n                    {\n                        label: 'Form (TSB)',\n                        data: data.map((d) => d.tsb),\n                        borderColor: 'rgb(255, 205, 86)',\n                        backgroundColor: (context: ScriptableContext<'bar'>) => {\n                            const value = context.raw as number;\n                            return value < 0 ? 'rgba(255, 99, 132, 0.5)' : 'rgba(75, 192, 192, 0.5)';\n                        },\n                        yAxisID: 'y1',\n                        type: 'bar',\n                        barThickness: 'flex',\n                        maxBarThickness: 10,\n                    },\n                ],\n            },\n            options: {\n                responsive: true,\n                maintainAspectRatio: false,\n                interaction: {\n                    mode: 'index',\n                    intersect: false,\n                },\n                plugins: {\n                    legend: {\n                        labels: { color: textColor },\n                    },\n                },\n                scales: {\n                    x: {\n                        ticks: { color: textColor },\n                        grid: { color: gridColor },\n                    },\n                    y: {\n                        type: 'linear',\n                        display: true,\n                        position: 'left',\n                        title: { display: true, text: 'Load (TSS/day)', color: textColor },\n                        ticks: { color: textColor },\n                        grid: { color: gridColor },\n                    },\n                    y1: {\n                        type: 'linear',\n                        display: true,\n                        position: 'right',\n                        title: { display: true, text: 'Form', color: textColor },\n                        grid: { drawOnChartArea: false },\n                        ticks: { color: textColor },\n                    },\n                },\n            },\n        });\n    }\n}\n"],"names":["Chart","registerables","FitnessView","container","data","getClientPMCData","status","error","ctx","textColor","gridColor","d","context"],"mappings":"mQAKAA,EAAM,SAAS,GAAGC,CAAa,EAExB,MAAMC,CAA4B,CAC9B,GAAK,UACJ,UAAgC,KAChC,MAAsB,KAEvB,KAAKC,EAA8B,CACtC,KAAK,UAAYA,EACjB,KAAK,UAAU,UAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAW/B,CAEA,MAAa,SAAyB,CAElC,MAAM,KAAK,SAAA,CACf,CAEO,SAAgB,CACf,KAAK,QACL,KAAK,MAAM,QAAA,EACX,KAAK,MAAQ,KAErB,CAEA,MAAc,UAA0B,CACpC,GAAI,CACA,MAAMC,EAAO,MAAMC,EAAA,EACnB,GAAID,EAAK,SAAW,EAAG,CACnB,MAAME,EAAS,KAAK,WAAW,cAAc,iBAAiB,EAC1DA,IACAA,EAAO,YACH,uFACZ,CACA,KAAK,YAAYF,CAAI,EACrB,MAAME,EAAS,KAAK,WAAW,cAAc,iBAAiB,EAC1DA,MAAe,YAAc,GACrC,OAASC,EAAO,CACZ,QAAQ,MAAMA,CAAK,EACnB,MAAMD,EAAS,KAAK,WAAW,cAAc,iBAAiB,EAC1DA,MAAe,YAAc,8BACrC,CACJ,CAEQ,YAAYF,EAAwB,CACxC,MAAMI,EAAO,KAAK,WAAW,cAAc,WAAW,GAAyB,WAAW,IAAI,EAC9F,GAAI,CAACA,EAAK,OAEN,KAAK,OACL,KAAK,MAAM,QAAA,EAIf,MAAMC,EAAY,iBAAiB,SAAS,IAAI,EAAE,iBAAiB,aAAa,EAAE,KAAA,GAAU,UACtFC,EACF,iBAAiB,SAAS,IAAI,EAAE,iBAAiB,gBAAgB,EAAE,KAAA,GAAU,2BAEjF,KAAK,MAAQ,IAAIV,EAAMQ,EAAK,CACxB,KAAM,OACN,KAAM,CACF,OAAQJ,EAAK,IAAKO,GAAMA,EAAE,IAAI,EAC9B,SAAU,CACN,CACI,MAAO,gBACP,KAAMP,EAAK,IAAKO,GAAMA,EAAE,GAAG,EAC3B,YAAa,oBACb,gBAAiB,0BACjB,QAAS,IACT,KAAM,GACN,QAAS,EAAA,EAEb,CACI,MAAO,gBACP,KAAMP,EAAK,IAAKO,GAAMA,EAAE,GAAG,EAC3B,YAAa,oBACb,gBAAiB,0BACjB,QAAS,IACT,KAAM,GACN,QAAS,EAAA,EAEb,CACI,MAAO,aACP,KAAMP,EAAK,IAAKO,GAAMA,EAAE,GAAG,EAC3B,YAAa,oBACb,gBAAkBC,GACAA,EAAQ,IACP,EAAI,0BAA4B,0BAEnD,QAAS,KACT,KAAM,MACN,aAAc,OACd,gBAAiB,EAAA,CACrB,CACJ,EAEJ,QAAS,CACL,WAAY,GACZ,oBAAqB,GACrB,YAAa,CACT,KAAM,QACN,UAAW,EAAA,EAEf,QAAS,CACL,OAAQ,CACJ,OAAQ,CAAE,MAAOH,CAAA,CAAU,CAC/B,EAEJ,OAAQ,CACJ,EAAG,CACC,MAAO,CAAE,MAAOA,CAAA,EAChB,KAAM,CAAE,MAAOC,CAAA,CAAU,EAE7B,EAAG,CACC,KAAM,SACN,QAAS,GACT,SAAU,OACV,MAAO,CAAE,QAAS,GAAM,KAAM,iBAAkB,MAAOD,CAAA,EACvD,MAAO,CAAE,MAAOA,CAAA,EAChB,KAAM,CAAE,MAAOC,CAAA,CAAU,EAE7B,GAAI,CACA,KAAM,SACN,QAAS,GACT,SAAU,QACV,MAAO,CAAE,QAAS,GAAM,KAAM,OAAQ,MAAOD,CAAA,EAC7C,KAAM,CAAE,gBAAiB,EAAA,EACzB,MAAO,CAAE,MAAOA,CAAA,CAAU,CAC9B,CACJ,CACJ,CACH,CACL,CACJ"}