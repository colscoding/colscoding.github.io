{"version":3,"file":"MetricDisplay-DOEwhpjQ.js","sources":["../../src/components/MetricDisplay.ts"],"sourcesContent":["/**\n * Metric Display Component\n *\n * A Web Component for displaying a single workout metric (power, heart rate, cadence).\n * Supports theming, zones, and real-time updates.\n *\n * @example\n * ```html\n * <bpt-metric-display\n *   label=\"Power\"\n *   value=\"250\"\n *   unit=\"W\"\n *   icon=\"âš¡\"\n *   zone=\"4\"\n *   zone-name=\"Threshold\">\n * </bpt-metric-display>\n * ```\n *\n * @module MetricDisplay\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\nimport { sharedStyles } from './styles/shared.js';\nimport { elementCache } from '../utils/elementCache.js';\n\n/**\n * Metric Display Web Component\n */\nexport class MetricDisplay extends BaseComponent {\n    static get observedAttributes(): string[] {\n        return ['label', 'value', 'unit', 'icon', 'zone', 'zone-name', 'connected', 'show-avg'];\n    }\n\n    protected getStyles(): string {\n        return `\n            ${sharedStyles}\n\n            :host {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: var(--space-2);\n                transition: background-color var(--transition-normal), border-color var(--transition-normal);\n                border-radius: var(--radius-md);\n                min-width: 100px;\n                background-color: var(--zone-bg, var(--bg-secondary));\n                color: var(--text-primary);\n            }\n            \n            /* Zone bindings */\n            :host([zone=\"1\"]) { --zone-color: var(--zone-1-color); --zone-bg: var(--zone-1-color-bg); }\n            :host([zone=\"2\"]) { --zone-color: var(--zone-2-color); --zone-bg: var(--zone-2-color-bg); }\n            :host([zone=\"3\"]) { --zone-color: var(--zone-3-color); --zone-bg: var(--zone-3-color-bg); }\n            :host([zone=\"4\"]) { --zone-color: var(--zone-4-color); --zone-bg: var(--zone-4-color-bg); }\n            :host([zone=\"5\"]) { --zone-color: var(--zone-5-color); --zone-bg: var(--zone-5-color-bg); }\n            :host([zone=\"6\"]) { --zone-color: var(--zone-6-color); --zone-bg: var(--zone-6-color-bg); }\n            :host([zone=\"7\"]) { --zone-color: var(--zone-7-color); --zone-bg: var(--zone-7-color-bg); }\n\n            :host([zone]) {\n                border-left: 4px solid var(--zone-color, transparent);\n            }\n            \n            .label {\n                font-size: var(--font-size-metric-label);\n                color: var(--text-secondary);\n                margin-bottom: var(--space-1);\n                display: flex;\n                align-items: center;\n                gap: var(--space-1);\n            }\n            \n            .icon {\n                font-size: 1.1em;\n            }\n            \n            .value-container {\n                display: flex;\n                align-items: baseline;\n                gap: var(--space-1);\n            }\n            \n            .value {\n                font-size: var(--font-size-metric-value);\n                font-weight: var(--font-weight-bold);\n                color: var(--zone-color, var(--text-primary));\n                line-height: 1;\n                transition: color var(--transition-normal);\n            }\n            \n            .value.disconnected {\n                color: var(--text-tertiary);\n            }\n            \n            .unit {\n                font-size: var(--font-size-metric-unit);\n                color: var(--text-secondary);\n            }\n            \n            .avg-indicator {\n                font-size: var(--font-size-xs);\n                color: var(--text-tertiary);\n                vertical-align: super;\n            }\n            \n            .zone-badge {\n                font-size: var(--font-size-sm);\n                padding: 2px 8px;\n                border-radius: 12px;\n                margin-top: var(--space-1);\n                background-color: var(--zone-bg, transparent);\n                color: var(--zone-color, var(--text-secondary));\n                font-weight: var(--font-weight-medium);\n                opacity: 0;\n                transform: translateY(-4px);\n                transition: opacity var(--transition-fast), transform var(--transition-fast);\n            }\n            \n            :host([zone]) .zone-badge {\n                opacity: 1;\n                transform: translateY(0);\n            }\n            \n            /* High contrast mode support */\n            :host-context([data-high-contrast=\"true\"]) .value {\n                text-decoration: underline;\n                text-decoration-style: dotted;\n                text-underline-offset: 4px;\n            }\n            \n            :host-context([data-high-contrast=\"true\"]) {\n                border-width: 3px;\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const label = this.getAttribute('label') || '';\n        const value = this.getAttribute('value') || '--';\n        const unit = this.getAttribute('unit') || '';\n        const icon = this.getAttribute('icon') || '';\n        const zoneName = this.getAttribute('zone-name') || '';\n        const showAvg = this.hasAttribute('show-avg');\n        const connected = this.getAttribute('connected') !== 'false';\n\n        return `\n            <div class=\"label\">\n                ${icon ? `<span class=\"icon\" aria-hidden=\"true\">${icon}</span>` : ''}\n                <span>${label}</span>\n            </div>\n            <div class=\"value-container\">\n                <span class=\"value ${!connected ? 'disconnected' : ''}\" \n                      aria-live=\"polite\" \n                      aria-label=\"${label}: ${value} ${unit}\">\n                    ${value}${showAvg ? '<span class=\"avg-indicator\">(3s)</span>' : ''}\n                </span>\n                ${unit ? `<span class=\"unit\">${unit}</span>` : ''}\n            </div>\n            <div class=\"zone-badge\" aria-live=\"polite\">\n                ${zoneName ? `Zone: ${zoneName}` : ''}\n            </div>\n        `;\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        // Fast path for value updates (most frequent)\n        if (name === 'value' && this.shadow.childElementCount > 0) {\n            const valueEl = elementCache.getShadow<HTMLElement>(this, '.value');\n            if (valueEl) {\n                // Update text content directly\n                // We target the first child because there might be a span for avg\n                if (valueEl.firstChild?.nodeType === Node.TEXT_NODE) {\n                    valueEl.firstChild.textContent = newValue || '--';\n\n                    // Update aria-label\n                    const label = this.getAttribute('label') || '';\n                    const unit = this.getAttribute('unit') || '';\n                    valueEl.setAttribute('aria-label', `${label}: ${newValue} ${unit}`);\n                    return;\n                } else if (!valueEl.firstChild) {\n                    valueEl.textContent = newValue || '--';\n                    return;\n                }\n            }\n        }\n\n        // Fast path for Zone Name updates\n        if (name === 'zone-name' && this.shadow.childElementCount > 0) {\n            const badgeEl = elementCache.getShadow<HTMLElement>(this, '.zone-badge');\n            if (badgeEl) {\n                badgeEl.textContent = newValue ? `Zone: ${newValue}` : '';\n                return;\n            }\n        }\n\n        // Fast path for Zone ID updates (affects CSS only)\n        if (name === 'zone' && this.shadow.childElementCount > 0) {\n            // CSS handles the visual change based on the host attribute\n            return;\n        }\n\n        // Re-render on any attribute change\n        this.render();\n    }\n\n    /**\n     * Update the displayed value\n     */\n    public setValue(value: number | string): void {\n        this.setAttribute('value', String(value));\n    }\n\n    /**\n     * Update the zone\n     */\n    public setZone(zone: number | null, zoneName?: string): void {\n        if (zone !== null) {\n            this.setAttribute('zone', String(zone));\n            if (zoneName) {\n                this.setAttribute('zone-name', zoneName);\n            }\n        } else {\n            this.removeAttribute('zone');\n            this.removeAttribute('zone-name');\n        }\n    }\n\n    /**\n     * Set connected state\n     */\n    public setConnected(connected: boolean): void {\n        this.setAttribute('connected', String(connected));\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-metric-display', MetricDisplay);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-metric-display': MetricDisplay;\n    }\n}\n"],"names":["MetricDisplay","BaseComponent","sharedStyles","label","value","unit","icon","zoneName","showAvg","connected","name","_oldValue","newValue","valueEl","elementCache","badgeEl","zone"],"mappings":"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"}