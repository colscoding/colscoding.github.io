{"version":3,"file":"DebugView-BxwLL5YX.js","sources":["../../src/utils/mockDataGenerator.ts","../../src/views/DebugView.ts"],"sourcesContent":["import { saveCompletedWorkout, type StoredWorkout } from '../storage/workoutStorage.js';\nimport type { MeasurementsData, Measurement } from '../types/measurements.js';\n\n/**\n * Generates and saves mock workouts for testing History and Fitness pages.\n */\nexport async function generateMockHistory(daysBack = 90, workoutsPerWeek = 4): Promise<void> {\n    const workouts: StoredWorkout[] = [];\n    const now = new Date();\n    const ftp = 250;\n\n    for (let i = daysBack; i >= 0; i--) {\n        const date = new Date(now);\n        date.setDate(date.getDate() - i);\n\n        // Random chance to skip day (to match workoutsPerWeek roughly)\n        if (Math.random() > workoutsPerWeek / 7) continue;\n\n        const durationMinutes = 30 + Math.floor(Math.random() * 60); // 30-90 mins\n        const durationSeconds = durationMinutes * 60;\n\n        // Generate Power Data\n        const powerPoints: Measurement[] = [];\n        const hrPoints: Measurement[] = [];\n        const startTime = date.getTime();\n\n        let avgPower = 150 + Math.floor(Math.random() * 100); // 150-250W avg\n        const variability = 20;\n\n        for (let t = 0; t < durationSeconds; t++) {\n            const timestamp = startTime + t * 1000;\n\n            // Random walk power\n            const noise = (Math.random() - 0.5) * variability;\n            const currentPower = Math.max(0, avgPower + noise + Math.sin(t / 600) * 50);\n\n            // Simple HR model: 40 + (Power / 3) + lag/drift\n            const currentHr = 60 + currentPower * 0.4 + Math.random() * 5;\n\n            powerPoints.push({ timestamp, value: Math.round(currentPower) });\n            hrPoints.push({ timestamp, value: Math.round(currentHr) });\n        }\n\n        // Calculate Stats\n        const totalPower = powerPoints.reduce((sum, p) => sum + p.value, 0);\n        const actualAvgPower = totalPower / powerPoints.length;\n\n        // Rough NP (approximate as Avg * 1.05 for variability)\n        const np = actualAvgPower * 1.05;\n        const if_factor = np / ftp;\n        const tss = ((durationSeconds * np * if_factor) / (ftp * 3600)) * 100;\n\n        const measurements: MeasurementsData = {\n            heartrate: hrPoints,\n            power: powerPoints,\n            cadence: [],\n            speed: [],\n            distance: [],\n            altitude: [],\n            gps: [],\n            treadmill: [],\n        };\n\n        const summary = {\n            avgPower: Math.round(actualAvgPower),\n            maxPower: Math.round(actualAvgPower * 1.5),\n            normalizedPower: Math.round(np),\n            avgHeartrate: Math.round(hrPoints.reduce((s, p) => s + p.value, 0) / hrPoints.length),\n            maxHeartrate: 190,\n            trainingLoad: Math.round(tss),\n            intensityFactor: Number(if_factor.toFixed(2)),\n            totalTimeMs: durationSeconds * 1000,\n            sampleCount: durationSeconds,\n        };\n\n        const workout: StoredWorkout = {\n            id: crypto.randomUUID(),\n            startTime,\n            lastUpdated: startTime + durationSeconds * 1000,\n            measurements: measurements,\n            isCompleted: true,\n            summary: summary,\n        };\n\n        workouts.push(workout);\n    }\n\n    console.log(`Generating ${workouts.length} mock workouts...`);\n\n    for (const w of workouts) {\n        // saveCompletedWorkout(measurements, startTime, endTime, summary)\n        await saveCompletedWorkout(w.measurements, w.startTime, w.lastUpdated, w.summary);\n        // Note: checking generated ID against one created inside function might mismatch but we don't care for mock\n    }\n\n    console.log('Mock history generation complete.');\n    alert(`Generated ${workouts.length} workouts. Please refresh the page.`);\n}\n","import { View } from '../router/View.js';\nimport { BluetoothFactory } from '../services/bluetooth/factory.js';\nimport { BluetoothDebugService } from '../services/debug/BluetoothDebugService.js';\nimport { ViewId } from '../router/view-ids.js';\nimport { generateMockHistory } from '../utils/mockDataGenerator.js';\n\nexport class DebugView implements View {\n    public id = ViewId.Debug;\n    private logArea: HTMLTextAreaElement | null = null;\n    private boundOnLog = this.onLog.bind(this);\n    private logBuffer: Array<{ timestamp: string; sensor: string; data: string }> = [];\n\n    public init(container: HTMLElement): void {\n        const template = document.getElementById('debugTemplate') as HTMLTemplateElement;\n\n        if (template) {\n            const content = template.content.cloneNode(true);\n            container.appendChild(content);\n            this.setupEvents(container);\n        } else {\n            console.error('Debug template not found');\n            container.innerHTML = '<p>Error loading debug view</p>';\n        }\n    }\n\n    public onEnter(): void {\n        BluetoothDebugService.addListener(this.boundOnLog);\n    }\n\n    public onLeave(): void {\n        BluetoothDebugService.removeListener(this.boundOnLog);\n    }\n\n    private onLog(sensor: string, hex: string) {\n        const timestamp = new Date().toISOString();\n        this.logBuffer.push({ timestamp, sensor, data: hex });\n\n        if (this.logArea) {\n            const timeDisplay = timestamp.split('T')[1].slice(0, -1);\n            this.logArea.value += `[${timeDisplay}] ${sensor}: ${hex}\\n`;\n            this.logArea.scrollTop = this.logArea.scrollHeight;\n        }\n    }\n\n    private setupEvents(container: HTMLElement): void {\n        this.logArea = container.querySelector('#debugLog');\n\n        const btnTreadmill = container.querySelector('#connectTreadmillDebug');\n        const btnRower = container.querySelector('#connectRowerDebug');\n        const btnConcept2 = container.querySelector('#connectConcept2Debug');\n        const btnSkiErg = container.querySelector('#connectSkiErgDebug');\n        const btnDownload = container.querySelector('#downloadLogs');\n        const btnMock = container.querySelector('#generateMockHistoryBtn');\n\n        btnMock?.addEventListener('click', async () => {\n            if (confirm('This will add random workout data to your history. Continue?')) {\n                this.log('System', 'Generating mock history...');\n                try {\n                    await generateMockHistory();\n                    this.log('System', 'Mock history generated.');\n                } catch (e) {\n                    this.log('Error', `Failed to generate mock history: ${e}`);\n                }\n            }\n        });\n\n        btnTreadmill?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Treadmill...');\n                await BluetoothFactory.connectTreadmill();\n                this.log('System', 'Connected to Treadmill');\n            } catch (e) {\n                this.log('System', `Treadmill connection failed: ${e}`);\n            }\n        });\n\n        btnRower?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Rower...');\n                await BluetoothFactory.connectRowing();\n                this.log('System', 'Connected to Rower');\n            } catch (e) {\n                this.log('System', `Rower connection failed: ${e}`);\n            }\n        });\n\n        btnConcept2?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Concept2...');\n                await BluetoothFactory.connectConcept2();\n                this.log('System', 'Connected to Concept2');\n            } catch (e) {\n                this.log('System', `Concept2 connection failed: ${e}`);\n            }\n        });\n\n        btnSkiErg?.addEventListener('click', async () => {\n            try {\n                this.log('System', 'Connecting to Ski Erg...');\n                await BluetoothFactory.connectSkiErg();\n                this.log('System', 'Connected to Ski Erg');\n            } catch (e) {\n                this.log('System', `Ski Erg connection failed: ${e}`);\n            }\n        });\n\n        // Note: Weight Scale button is handled by initConnectionButtons.ts\n        // since it uses the same connection infrastructure as other sensors\n\n        btnDownload?.addEventListener('click', () => {\n            this.downloadLocalLogs();\n        });\n    }\n\n    private downloadLocalLogs() {\n        const blob = new Blob([JSON.stringify(this.logBuffer, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `bpt-debug-session-${Date.now()}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n\n    private log(source: string, message: string) {\n        if (this.logArea) {\n            const timestamp = new Date().toISOString().split('T')[1].slice(0, -1);\n            this.logArea.value += `[${timestamp}] ${source}: ${message}\\n`;\n            this.logArea.scrollTop = this.logArea.scrollHeight;\n        }\n    }\n}\n"],"names":["generateMockHistory","daysBack","workoutsPerWeek","workouts","now","ftp","i","date","durationSeconds","powerPoints","hrPoints","startTime","avgPower","variability","t","timestamp","noise","currentPower","currentHr","actualAvgPower","sum","p","np","if_factor","tss","measurements","summary","s","workout","w","saveCompletedWorkout","DebugView","ViewId","container","template","content","BluetoothDebugService","sensor","hex","timeDisplay","btnTreadmill","btnRower","btnConcept2","btnSkiErg","btnDownload","e","BluetoothFactory","blob","url","a","source","message"],"mappings":"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"}