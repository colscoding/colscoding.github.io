{"version":3,"file":"elementCache-Cg-Rl8c9.js","sources":["../../src/utils/elementCache.ts"],"sourcesContent":["/**\n * Cache for frequently queried elements\n */\nexport class ElementCache {\n    private cache: Map<string, WeakRef<Element>> = new Map();\n    private shadowCache: Map<Element, Map<string, WeakRef<Element>>> = new Map();\n\n    /**\n     * Get element by selector, caching the result\n     */\n    get<T extends Element>(selector: string, parent: ParentNode = document): T | null {\n        const cached = this.cache.get(selector);\n        if (cached) {\n            const element = cached.deref();\n            if (element && element.isConnected) {\n                return element as T;\n            }\n            // Element was garbage collected or disconnected\n            this.cache.delete(selector);\n        }\n\n        const element = parent.querySelector<T>(selector);\n        if (element) {\n            this.cache.set(selector, new WeakRef(element));\n        }\n        return element;\n    }\n\n    /**\n     * Get element from shadow root, with caching\n     */\n    getShadow<T extends Element>(host: Element, selector: string): T | null {\n        const shadow = (host as HTMLElement).shadowRoot;\n        if (!shadow) return null;\n\n        let hostCache = this.shadowCache.get(host);\n        if (!hostCache) {\n            hostCache = new Map();\n            this.shadowCache.set(host, hostCache);\n        }\n\n        const cached = hostCache.get(selector);\n        if (cached) {\n            const element = cached.deref();\n            if (element && element.isConnected) {\n                return element as T;\n            }\n            hostCache.delete(selector);\n        }\n\n        const element = shadow.querySelector<T>(selector);\n        if (element) {\n            hostCache.set(selector, new WeakRef(element));\n        }\n        return element;\n    }\n\n    /**\n     * Clear cache for a specific selector or all\n     */\n    clear(selector?: string): void {\n        if (selector) {\n            this.cache.delete(selector);\n        } else {\n            this.cache.clear();\n            this.shadowCache.clear();\n        }\n    }\n\n    /**\n     * Invalidate cache when DOM changes\n     */\n    invalidate(): void {\n        // Remove entries for disconnected elements\n        for (const [selector, ref] of this.cache) {\n            const element = ref.deref();\n            if (!element || !element.isConnected) {\n                this.cache.delete(selector);\n            }\n        }\n\n        for (const [host, hostCache] of this.shadowCache) {\n            if (!host.isConnected) {\n                this.shadowCache.delete(host);\n                continue;\n            }\n\n            for (const [selector, ref] of hostCache) {\n                const element = ref.deref();\n                if (!element || !element.isConnected) {\n                    hostCache.delete(selector);\n                }\n            }\n        }\n    }\n}\n\nexport const elementCache = new ElementCache();\n\n// Invalidate cache on major DOM changes\nif (typeof document !== 'undefined' && typeof MutationObserver !== 'undefined') {\n    const observer = new MutationObserver(() => {\n        // requestIdleCallback is not available in all environments/Node\n        if ('requestIdleCallback' in window) {\n            (window as any).requestIdleCallback(() => elementCache.invalidate());\n        } else {\n            setTimeout(() => elementCache.invalidate(), 1000);\n        }\n    });\n\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true,\n    });\n}\n"],"names":["ElementCache","selector","parent","cached","element","host","shadow","hostCache","ref","elementCache"],"mappings":"AAGO,MAAMA,CAAa,CACd,UAA2C,IAC3C,gBAA+D,IAKvE,IAAuBC,EAAkBC,EAAqB,SAAoB,CAC9E,MAAMC,EAAS,KAAK,MAAM,IAAIF,CAAQ,EACtC,GAAIE,EAAQ,CACR,MAAMC,EAAUD,EAAO,MAAA,EACvB,GAAIC,GAAWA,EAAQ,YACnB,OAAOA,EAGX,KAAK,MAAM,OAAOH,CAAQ,CAC9B,CAEA,MAAMG,EAAUF,EAAO,cAAiBD,CAAQ,EAChD,OAAIG,GACA,KAAK,MAAM,IAAIH,EAAU,IAAI,QAAQG,CAAO,CAAC,EAE1CA,CACX,CAKA,UAA6BC,EAAeJ,EAA4B,CACpE,MAAMK,EAAUD,EAAqB,WACrC,GAAI,CAACC,EAAQ,OAAO,KAEpB,IAAIC,EAAY,KAAK,YAAY,IAAIF,CAAI,EACpCE,IACDA,MAAgB,IAChB,KAAK,YAAY,IAAIF,EAAME,CAAS,GAGxC,MAAMJ,EAASI,EAAU,IAAIN,CAAQ,EACrC,GAAIE,EAAQ,CACR,MAAMC,EAAUD,EAAO,MAAA,EACvB,GAAIC,GAAWA,EAAQ,YACnB,OAAOA,EAEXG,EAAU,OAAON,CAAQ,CAC7B,CAEA,MAAMG,EAAUE,EAAO,cAAiBL,CAAQ,EAChD,OAAIG,GACAG,EAAU,IAAIN,EAAU,IAAI,QAAQG,CAAO,CAAC,EAEzCA,CACX,CAKA,MAAMH,EAAyB,CACvBA,EACA,KAAK,MAAM,OAAOA,CAAQ,GAE1B,KAAK,MAAM,MAAA,EACX,KAAK,YAAY,MAAA,EAEzB,CAKA,YAAmB,CAEf,SAAW,CAACA,EAAUO,CAAG,IAAK,KAAK,MAAO,CACtC,MAAMJ,EAAUI,EAAI,MAAA,GAChB,CAACJ,GAAW,CAACA,EAAQ,cACrB,KAAK,MAAM,OAAOH,CAAQ,CAElC,CAEA,SAAW,CAACI,EAAME,CAAS,IAAK,KAAK,YAAa,CAC9C,GAAI,CAACF,EAAK,YAAa,CACnB,KAAK,YAAY,OAAOA,CAAI,EAC5B,QACJ,CAEA,SAAW,CAACJ,EAAUO,CAAG,IAAKD,EAAW,CACrC,MAAMH,EAAUI,EAAI,MAAA,GAChB,CAACJ,GAAW,CAACA,EAAQ,cACrBG,EAAU,OAAON,CAAQ,CAEjC,CACJ,CACJ,CACJ,CAEO,MAAMQ,EAAe,IAAIT,EAG5B,OAAO,SAAa,KAAe,OAAO,iBAAqB,KAC9C,IAAI,iBAAiB,IAAM,CAEpC,wBAAyB,OACxB,OAAe,oBAAoB,IAAMS,EAAa,YAAY,EAEnE,WAAW,IAAMA,EAAa,WAAA,EAAc,GAAI,CAExD,CAAC,EAEQ,QAAQ,SAAS,KAAM,CAC5B,UAAW,GACX,QAAS,EAAA,CACZ"}