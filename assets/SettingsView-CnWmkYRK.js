import{t as At,m as Tt,n as mt,o as Vt,v as Ze,q as Te,u as ft,w as Ft,x as Dt,b as It,y as $t,g as Nt,d as Ut,e as Ot,f as Ht}from"./index-CWIKcEoG.js";import{p as D,q as $,u as pt,s as vt,g as ht,v as m,w as b,x as Ve,y as Fe,z as Je,A as yt,D as De,E as Rt}from"./feature-bluetooth-MdnGXiet.js";import{a as zt,b as qt,u as Kt}from"./screens-D6jiR1Sk.js";import"./vendor-core-Dob3nYDb.js";import"./feature-export-7zlEGvkQ.js";import"./vendor-leaflet-3-yx3GaH.js";function Zt(t,n){let o=null;return(...i)=>{o&&clearTimeout(o),o=setTimeout(()=>{t(...i)},n)}}function bt(t){return[{name:"Active Recovery",min:0,max:Math.round(t*.55),color:"#808080"},{name:"Endurance",min:Math.round(t*.55),max:Math.round(t*.75),color:"#2196f3"},{name:"Tempo",min:Math.round(t*.75),max:Math.round(t*.9),color:"#4caf50"},{name:"Threshold",min:Math.round(t*.9),max:Math.round(t*1.05),color:"#ffeb3b"},{name:"VO2max",min:Math.round(t*1.05),max:Math.round(t*1.2),color:"#ff9800"},{name:"Anaerobic",min:Math.round(t*1.2),max:Math.round(t*1.5),color:"#f44336"},{name:"Neuromuscular",min:Math.round(t*1.5),max:9999,color:"#9c27b0"}]}function Jt(t){return[{name:"Recovery",min:0,max:Math.round(t*.6),color:"#808080"},{name:"Endurance",min:Math.round(t*.6),max:Math.round(t*.8),color:"#2196f3"},{name:"Tempo",min:Math.round(t*.8),max:Math.round(t*.95),color:"#4caf50"},{name:"Threshold",min:Math.round(t*.95),max:Math.round(t*1.05),color:"#ff9800"},{name:"VO2max",min:Math.round(t*1.05),max:9999,color:"#f44336"}]}function jt(t){return[{name:"Endurance",min:0,max:Math.round(t*.75),color:"#2196f3"},{name:"Threshold",min:Math.round(t*.75),max:Math.round(t*1.05),color:"#ff9800"},{name:"High Intensity",min:Math.round(t*1.05),max:9999,color:"#f44336"}]}function Wt(t,n){switch(n){case"3":return jt(t);case"5":return Jt(t);case"7":return bt(t);default:return bt(t)}}function Qt(){const t=document.getElementById("saveSettings"),n=document.getElementById("settingFtp"),o=document.getElementById("settingPowerZoneModel"),i=document.getElementById("settingMaxHr"),a=document.getElementById("settingWeight"),d=(e,l,y)=>{const g=Number(e.value);return!e.value||isNaN(g)||g<l||g>y?(e.style.borderColor="#dc3545",e.setAttribute("aria-invalid","true"),!1):(e.style.borderColor="#28a745",e.setAttribute("aria-invalid","false"),!0)},s=e=>{e.style.borderColor="",e.removeAttribute("aria-invalid")},r=document.getElementById("settingSpeed"),u=document.getElementById("settingDistance"),p=document.getElementById("settingAltitude"),E=document.getElementById("settingShowCalories"),Y=document.getElementById("settingPower"),ee=document.getElementById("settingCadence"),te=document.getElementById("settingHeartrate"),ne=document.getElementById("settingTreadmillSpeed"),oe=document.getElementById("settingPower3s"),ie=document.getElementById("settingHighContrast"),se=document.getElementById("settingColorblindPatterns"),ce=document.getElementById("settingVoiceEnabled"),ae=document.getElementById("settingVoiceLaps"),de=document.getElementById("settingVoiceZones"),I=document.getElementById("settingAutoPauseEnabled"),B=document.getElementById("settingAutoPauseSource"),R=document.getElementById("settingAutoPauseThreshold"),z=document.getElementById("settingAutoPauseDelay"),Ne=document.getElementById("autoPauseOptions"),Qe=document.getElementById("autoPauseThresholdUnit"),re=document.getElementById("settingExportTcx"),le=document.getElementById("settingExportCsv"),ue=document.getElementById("settingExportJson"),ge=document.getElementById("settingExportFit"),me=document.getElementById("settingPromptForNotes"),fe=document.getElementById("settingPromptForExertion"),q=document.getElementById("settingCountdownDuration"),pe=document.getElementById("settingCountdownBeep"),ve=document.getElementById("settingCountdownVoice"),S=document.getElementById("settingAutoLapEnabled"),L=document.getElementById("settingAutoLapSource"),v=document.getElementById("settingAutoLapDistance"),K=document.getElementById("settingAutoLapTime"),Ue=document.getElementById("autoLapOptions"),Xe=document.getElementById("autoLapDistanceOption"),_e=document.getElementById("autoLapTimeOption"),C=document.getElementById("settingVoiceSelection"),Z=document.getElementById("settingVoiceTimeInterval"),J=document.getElementById("settingVoiceDistanceInterval"),j=document.getElementById("settingVoiceSpeechRate"),he=document.getElementById("settingVoiceMetricPower"),ye=document.getElementById("settingVoiceMetricHeartrate"),be=document.getElementById("settingVoiceMetricCadence"),k=document.getElementById("settingVoiceMetricSpeed"),Ee=document.getElementById("settingVoiceMetricDistance"),Ie=document.getElementById("settingVoiceMetricTime"),x=document.getElementById("settingVoiceMetricPace"),U=document.getElementById("settingVoiceTargetFeedback"),Se=document.getElementById("settingVoiceTemplate"),Oe=document.getElementById("settingSmartAnnouncements"),h=document.getElementById("settingSportType"),W=document.getElementById("settingShowPace"),Q=document.getElementById("settingThresholdPace"),Ge=document.getElementById("runningOptions"),P=document.getElementById("settingIntervalsEnabled"),A=document.getElementById("settingIntervalsApiKey"),He=document.getElementById("toggleIntervalsApiKey"),ke=document.getElementById("settingIntervalsAthleteId"),xe=document.getElementById("settingIntervalsAutoUpload"),Ye=document.getElementById("intervalsOptions"),T=document.getElementById("settingMusicEnabled"),w=document.getElementById("settingMusicVolume"),et=document.getElementById("musicVolumeValue"),we=document.getElementById("settingMusicStyle"),V=document.getElementById("settingMusicTempoSync"),X=document.getElementById("settingMusicFixedBPM"),Me=document.getElementById("settingMusicIntensityMapping"),Be=document.getElementById("settingMusicTransitionSpeed"),F=document.getElementById("settingMusicDucking"),M=document.getElementById("settingMusicDuckingLevel"),tt=document.getElementById("musicDuckingLevelValue"),nt=document.getElementById("musicOptions"),ot=document.getElementById("fixedBpmOption"),it=document.getElementById("duckingLevelOption"),Le=document.getElementById("settingDebugMode"),st=document.getElementById("debugControls"),kt=document.getElementById("downloadDebugLogs"),xt=document.getElementById("clearDebugLogs"),Ce=document.getElementById("settingMockSensors"),wt=document.getElementById("installPwaButton"),ct=()=>{Ye&&P&&(Ye.style.display=P.checked?"flex":"none")},Pe=()=>{nt&&T&&(nt.style.display=T.checked?"flex":"none"),ot&&V&&(ot.style.display=V.value==="fixed"?"flex":"none"),it&&F&&(it.style.display=F.checked?"flex":"none")},at=()=>{et&&w&&(et.textContent=`${w.value}%`)},dt=()=>{tt&&M&&(tt.textContent=`${M.value}%`)},rt=()=>{if(Ge&&h){const e=h.value==="running"||h.value==="walking";Ge.style.display=e?"block":"none"}},Mt=e=>{const l=e.match(/^(\d{1,2}):([0-5]\d)$/);if(!l)return null;const y=parseInt(l[1],10),g=parseInt(l[2],10);return y*60+g},Bt=()=>{const e=ft();if(h&&(e.activeSport=h.value),W!==null&&(e.running.showPace=W.checked),Q?.value){const l=Mt(Q.value);l!==null&&(e.running.targetPaceMin=l-30,e.running.targetPaceMax=l+30)}Ft(e)};let Re="cycling";const Lt=()=>{const e=ft();if(h&&(h.value=e.activeSport,Re=e.activeSport),W&&(W.checked=e.running.showPace),Q){const l=Math.round((e.running.targetPaceMin+e.running.targetPaceMax)/2);Q.value=Dt(l)}rt()};h?.addEventListener("change",()=>{rt();const e=h?.value;v&&(e==="running"||e==="walking"?(v.value==="5"||v.value==="10")&&(v.value="1"):e==="cycling"&&(v.value==="1"||v.value==="0.4")&&(v.value="5"))}),He?.addEventListener("click",()=>{if(A){const e=A.type==="password";A.type=e?"text":"password",He&&(He.textContent=e?"üôà":"üëÅÔ∏è")}}),P?.addEventListener("change",ct);const ze=()=>{if(Ne&&I&&(Ne.style.opacity=I.checked?"1":"0.5",Ne.style.pointerEvents=I.checked?"auto":"none"),Qe&&B){const e=Tt(B.value);Qe.textContent=e}};I?.addEventListener("change",ze),B?.addEventListener("change",ze);const qe=()=>{if(Ue&&S&&(Ue.style.opacity=S.checked?"1":"0.5",Ue.style.pointerEvents=S.checked?"auto":"none"),Xe&&_e&&L){const e=L.value==="distance";Xe.style.display=e?"flex":"none",_e.style.display=e?"none":"flex"}};S?.addEventListener("change",qe),L?.addEventListener("change",qe);const lt=e=>{Ze.reloadVoice();const l=(g,O)=>{document.querySelectorAll(`.metric-group-${g}`).forEach(_=>{_.style.display=O?"flex":"none"})};l("speed",e.speed),l("distance",e.distance),l("altitude",e.altitude),l("energy",e.showCalories),l("power",e.power),l("cadence",e.cadence),l("heartrate",e.heartrate),l("treadmillSpeed",e.treadmillSpeed),document.querySelectorAll(".metric-group-power").forEach(g=>{e.power3s?g.setAttribute("data-show-avg","true"):g.removeAttribute("data-show-avg")}),e.highContrast?document.documentElement.setAttribute("data-high-contrast","true"):document.documentElement.removeAttribute("data-high-contrast"),e.colorblindPatterns?document.documentElement.setAttribute("data-colorblind-patterns","true"):document.documentElement.removeAttribute("data-colorblind-patterns"),st&&(st.style.display=e.debugMode?"flex":"none")},ut=()=>({timeIntervalMinutes:Z?.value?parseInt(Z.value):D.timeIntervalMinutes,distanceIntervalKm:J?.value?parseInt(J.value):D.distanceIntervalKm,metrics:{power:he?.checked??$.power,heartrate:ye?.checked??$.heartrate,cadence:be?.checked??$.cadence,speed:k?.checked??$.speed,distance:Ee?.checked??$.distance,time:Ie?.checked??$.time,pace:x?.checked??$.pace},speechRate:j?.value?parseFloat(j.value):D.speechRate,voiceURI:C?.value||D.voiceURI,workoutTargetFeedback:U?.checked??D.workoutTargetFeedback,smartAnnouncements:Oe?.checked??D.smartAnnouncements,announcementTemplate:Se?.value||D.announcementTemplate}),gt=e=>{Z&&(Z.value=e.timeIntervalMinutes.toString()),J&&(J.value=e.distanceIntervalKm.toString()),j&&(j.value=e.speechRate.toString()),he&&(he.checked=e.metrics.power),ye&&(ye.checked=e.metrics.heartrate),be&&(be.checked=e.metrics.cadence),k&&(k.checked=e.metrics.speed),Ee&&(Ee.checked=e.metrics.distance),Ie&&(Ie.checked=e.metrics.time),x&&(x.checked=e.metrics.pace),C&&e.voiceURI&&(C.value=e.voiceURI),U&&(U.checked=e.workoutTargetFeedback),Oe&&(Oe.checked=e.smartAnnouncements),Se&&(Se.value=e.announcementTemplate||"")},Ke=()=>{const l={...mt(),ftp:n?.value?Number(n.value):null,maxHr:i?.value?Number(i.value):null,weight:a?.value?Number(a.value):null};Vt(l),window.dispatchEvent(new CustomEvent("user-profile-changed"));const y=o?.value||"7";vt.setMultiple({ftp:l.ftp??200,maxHeartrate:l.maxHr??190,weight:l.weight??75,powerZoneModel:y,powerZones:Wt(100,y)});const g={speed:r?.checked??m.speed,distance:u?.checked??m.distance,altitude:p?.checked??m.altitude,weightKg:a?.value?Number(a.value):m.weightKg,showCalories:E?.checked??m.showCalories,power:Y?.checked??m.power,cadence:ee?.checked??m.cadence,heartrate:te?.checked??m.heartrate,treadmillSpeed:ne?.checked??m.treadmillSpeed,power3s:oe?.checked??m.power3s,highContrast:ie?.checked??m.highContrast,colorblindPatterns:se?.checked??m.colorblindPatterns,voiceEnabled:ce?.checked??m.voiceEnabled,voiceLaps:ae?.checked??m.voiceLaps,voiceZones:de?.checked??m.voiceZones,autoPause:{enabled:I?.checked??De.enabled,source:B?.value??De.source,threshold:R?.value?Number(R.value):De.threshold,delay:z?.value?Number(z.value):De.delay},workoutMetadata:{promptForNotes:me?.checked??yt.promptForNotes,promptForExertion:fe?.checked??yt.promptForExertion},countdown:{duration:q?.value?parseInt(q.value):Je.duration,enableBeep:pe?.checked??Je.enableBeep,enableVoice:ve?.checked??Je.enableVoice},autoLap:{enabled:S?.checked??Fe.enabled,source:L?.value??Fe.source,distanceKm:v?.value?Number(v.value):Fe.distanceKm,timeMinutes:K?.value?Number(K.value):Fe.timeMinutes},enhancedVoice:ut(),intervals:{enabled:P?.checked??Ve.enabled,apiKey:A?.value??Ve.apiKey,athleteId:ke?.value??Ve.athleteId,autoUpload:xe?.checked??Ve.autoUpload},music:{enabled:T?.checked??b.enabled,volume:w?.value?Number(w.value)/100:b.volume,style:we?.value??b.style,tempoSync:V?.value??b.tempoSync,fixedBPM:X?.value?Number(X.value):b.fixedBPM,intensityMapping:Me?.value??b.intensityMapping,transitionSpeed:Be?.value??b.transitionSpeed,duckingEnabled:F?.checked??b.duckingEnabled,duckingLevel:M?.value?Number(M.value)/100:b.duckingLevel},exportTcx:re?.checked??m.exportTcx,exportCsv:le?.checked??m.exportCsv,exportJson:ue?.checked??m.exportJson,exportFit:ge?.checked??m.exportFit,debugMode:Le?.checked??m.debugMode,mockSensors:Ce?.checked??m.mockSensors,wheelCircumferenceMm:ht().wheelCircumferenceMm};window.useMockSensors=g.mockSensors,Rt(g),Bt(),lt(g)},Ct=()=>{const e=ht(),l=mt();n&&(n.value=l.ftp?.toString()??""),i&&(i.value=l.maxHr?.toString()??""),a&&(a.value=l.weight?.toString()??"");const y=vt.getAll();if(o&&(o.value=y.powerZoneModel||"7"),Y&&(Y.checked=e.power),ee&&(ee.checked=e.cadence),te&&(te.checked=e.heartrate),r&&(r.checked=e.speed),u&&(u.checked=e.distance),p&&(p.checked=e.altitude),E&&(E.checked=e.showCalories),ne&&(ne.checked=e.treadmillSpeed),oe&&(oe.checked=e.power3s),ie&&(ie.checked=e.highContrast),se&&(se.checked=e.colorblindPatterns),ce&&(ce.checked=e.voiceEnabled),ae&&(ae.checked=e.voiceLaps),de&&(de.checked=e.voiceZones),C){const g=()=>{const O=Ze.getAvailableVoices();C.innerHTML='<option value="">Default System Voice</option>',O.forEach(Ae=>{const _=document.createElement("option");_.value=Ae.voiceURI,_.textContent=`${Ae.name} (${Ae.lang})`,C.appendChild(_)}),e.enhancedVoice.voiceURI&&(C.value=e.enhancedVoice.voiceURI)};g(),Ze.getAvailableVoices().length===0&&(setTimeout(g,500),setTimeout(g,2e3))}I&&(I.checked=e.autoPause.enabled),B&&(B.value=e.autoPause.source),R&&(R.value=e.autoPause.threshold.toString()),z&&(z.value=e.autoPause.delay.toString()),ze(),re&&(re.checked=e.exportTcx),le&&(le.checked=e.exportCsv),ue&&(ue.checked=e.exportJson),ge&&(ge.checked=e.exportFit),me&&(me.checked=e.workoutMetadata.promptForNotes),fe&&(fe.checked=e.workoutMetadata.promptForExertion),q&&(q.value=e.countdown.duration.toString()),pe&&(pe.checked=e.countdown.enableBeep),ve&&(ve.checked=e.countdown.enableVoice),S&&(S.checked=e.autoLap.enabled),L&&(L.value=e.autoLap.source),v&&(v.value=e.autoLap.distanceKm.toString()),K&&(K.value=e.autoLap.timeMinutes.toString()),qe(),gt(e.enhancedVoice),P&&(P.checked=e.intervals.enabled),A&&(A.value=e.intervals.apiKey),ke&&(ke.value=e.intervals.athleteId),xe&&(xe.checked=e.intervals.autoUpload),ct(),T&&(T.checked=e.music.enabled),w&&(w.value=(e.music.volume*100).toString()),at(),we&&(we.value=e.music.style),V&&(V.value=e.music.tempoSync),X&&(X.value=e.music.fixedBPM.toString()),Me&&(Me.value=e.music.intensityMapping),Be&&(Be.value=e.music.transitionSpeed),F&&(F.checked=e.music.duckingEnabled),M&&(M.value=(e.music.duckingLevel*100).toString()),dt(),Pe(),Le&&(Le.checked=e.debugMode),Ce&&(Ce.checked=e.mockSensors),window.useMockSensors=e.mockSensors,Lt(),lt(e)},Pt=Zt(()=>Ke(),500),c=(e,l="change")=>{e&&(l==="input"?e.addEventListener("input",Pt):e.addEventListener("change",()=>Ke()))};c(n,"input"),c(o),c(i,"input"),c(a,"input"),n?.addEventListener("blur",()=>{n.value?d(n,50,600):s(n)}),n?.addEventListener("focus",()=>s(n)),i?.addEventListener("blur",()=>{i.value?d(i,100,250):s(i)}),i?.addEventListener("focus",()=>s(i)),a?.addEventListener("blur",()=>{a.value?d(a,30,300):s(a)}),a?.addEventListener("focus",()=>s(a)),[r,u,p,E,Y,ee,te,ne,oe].forEach(e=>c(e)),c(ie),c(se),c(ce),c(ae),c(de),c(I),c(B),c(R,"input"),c(z,"input"),[re,le,ue,ge].forEach(e=>c(e)),c(me),c(fe),c(q),c(pe),c(ve),c(S),c(L),c(v),c(K),c(Z),c(J),c(j),[he,ye,be,k,Ee,Ie,x,U].forEach(e=>c(e)),c(Se,"input"),h&&h.addEventListener("change",()=>{const e=h.value,l=ut(),y=localStorage.getItem("voice_presets"),g=y?JSON.parse(y):{};g[Re]=l,localStorage.setItem("voice_presets",JSON.stringify(g));const O=g[e];O?gt(O):(e==="running"||e==="walking"?(x&&(x.checked=!0),k&&(k.checked=!1)):(x&&(x.checked=!1),k&&(k.checked=!0)),U&&(U.checked=!1)),Re=e,Ke()}),c(W),c(Q,"input"),c(P),c(A,"input"),c(ke,"input"),c(xe),c(T),c(w,"input"),c(we),c(V),c(X,"input"),c(Me),c(Be),c(F),c(M,"input"),w?.addEventListener("input",at),M?.addEventListener("input",dt),T?.addEventListener("change",Pe),V?.addEventListener("change",Pe),F?.addEventListener("change",Pe),c(Le),c(Ce),t&&(t.textContent="Close Settings",t.className="close-settings-btn",t.style.background="#6c757d",t.addEventListener("click",()=>{window.router?window.router.navigate("/"):window.history.back()})),kt?.addEventListener("click",()=>{pt.exportLogs()}),xt?.addEventListener("click",async()=>{confirm("Are you sure you want to clear all debug logs?")&&(await pt.clearLogs(),alert("Logs cleared."))}),wt?.addEventListener("click",async()=>{const e=await At();e==="accepted"?console.log("PWA installation accepted"):e==="dismissed"?console.log("PWA installation dismissed"):alert("Installation is not available at this time. The app may already be installed or your browser does not support installation.")}),Ct(),Xt()}function Xt(){const t=document.getElementById("featureFlagsList"),n=document.getElementById("resetFeatureFlags");if(!t)return;const o=()=>{const d=Te.getAllFlags();t.innerHTML="",Object.values(d).forEach(s=>{if(s.category==="debug")return;const r=i(s.category),u=document.createElement("label");u.className="settings-option",u.style.cssText="display: flex; align-items: flex-start; gap: 10px; cursor: pointer;";const p=document.createElement("input");p.type="checkbox",p.id=`flag-${s.key}`,p.checked=s.enabled,p.style.cssText="width: 20px; height: 20px; margin-top: 2px;",p.addEventListener("change",()=>{p.checked?Te.enable(s.key):Te.disable(s.key),a()});const E=document.createElement("div");E.style.cssText="flex: 1;",E.innerHTML=`
                <span style="font-size: 16px; display: flex; align-items: center; gap: 8px;">
                    ${s.name}
                    <span style="font-size: 11px; padding: 2px 6px; border-radius: 4px; ${r}">${s.category}</span>
                </span>
                <p style="font-size: 12px; color: #666; margin: 2px 0 0 0;">${s.description}</p>
            `,u.appendChild(p),u.appendChild(E),t.appendChild(u)})},i=d=>{switch(d){case"core":return"background: #e3f2fd; color: #1976d2;";case"experimental":return"background: #fff3e0; color: #f57c00;";case"premium":return"background: #f3e5f5; color: #7b1fa2;";case"debug":return"background: #fce4ec; color: #c2185b;";default:return"background: #f5f5f5; color: #666;"}},a=()=>{if(document.getElementById("feature-flag-notice"))return;const s=document.createElement("div");s.id="feature-flag-notice",s.style.cssText=`
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,s.innerHTML=`
            <span>Refresh page to apply changes</span>
            <button id="refreshNowBtn" style="
                background: #2196f3;
                color: white;
                border: none;
                padding: 6px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            ">Refresh Now</button>
        `,document.body.appendChild(s),document.getElementById("refreshNowBtn")?.addEventListener("click",()=>{window.location.reload()}),setTimeout(()=>{s.remove()},1e4)};n?.addEventListener("click",()=>{confirm("Reset all feature flags to their default values?")&&(Te.resetToDefaults(),o(),a())}),o()}let f={profile:It(),selectedScreenIndex:0,isEditing:!1,searchQuery:"",selectedCategory:"all"};const je=new Set;function _t(t){return je.add(t),()=>je.delete(t)}function St(){je.forEach(t=>t())}function H(t){f={...f,...t},St()}function Gt(){const t=It();H({profile:t,selectedScreenIndex:Math.min(f.selectedScreenIndex,t.screens.length-1)})}function Yt(){const t=$t(f.profile);return t&&document.dispatchEvent(new CustomEvent("data-fields-profile-changed",{detail:{profile:f.profile}})),t}function N(){return f.profile.screens[f.selectedScreenIndex]??null}function en(t,n="medium"){const o=N();if(!o)return;const i=zt(o,t,n);G(i)}function tn(t){const n=N();if(!n)return;const o=qt(n,t);G(o)}function nn(t,n){const o=N();if(!o)return;const i=Kt(o,t,n);G(i)}function on(t){const n=N();if(!n)return;const o={...n,layout:t};G(o)}function G(t){const n=[...f.profile.screens];n[f.selectedScreenIndex]=t,H({profile:{...f.profile,screens:n}})}function sn(t,n){const o=N();if(!o)return;const i=[...o.slots],[a]=i.splice(t,1);i.splice(n,0,a);const d=i.map((s,r)=>({...s,position:r}));G({...o,slots:d})}function cn(){let t;if(f.searchQuery.trim())t=Ut(f.searchQuery);else if(f.selectedCategory==="all"){const n=Ot();t=Array.from(n.values()).flat()}else t=Ht(f.selectedCategory);return t}const an={all:"üìä",power:"‚ö°",heartrate:"‚ù§Ô∏è",cadence:"üîÑ",speed:"üö¥",distance:"üìç",elevation:"‚õ∞Ô∏è",time:"‚è±Ô∏è",laps:"üèÅ",energy:"üî•",environment:"üå°Ô∏è",device:"üîã",charts:"üìà",map:"üó∫Ô∏è"};function dn(t){t.innerHTML=`
        <div class="data-fields-config">
            <div class="dfc-header">
                <h3>üìä Data Fields</h3>
                <p class="dfc-help-text">Configure which metrics appear on your dashboard screens.</p>
            </div>
            
            <div class="dfc-screens">
                <div class="dfc-screens-tabs" role="tablist"></div>
            </div>
            
            <div class="dfc-current-screen">
                <div class="dfc-screen-header">
                    <span class="dfc-screen-name"></span>
                    <select class="dfc-layout-select" aria-label="Screen layout">
                        <option value="auto">Auto Layout</option>
                        <option value="grid-2">2 Columns</option>
                        <option value="grid-3">3 Columns</option>
                        <option value="grid-4">4 Columns</option>
                        <option value="list">List</option>
                    </select>
                </div>
                <div class="dfc-fields-list" role="list" aria-label="Current screen fields"></div>
                <button class="dfc-add-field-btn" type="button">
                    <span>+</span> Add Field
                </button>
            </div>
            
            <div class="dfc-field-picker" style="display: none;">
                <div class="dfc-picker-header">
                    <h4>Select a Field</h4>
                    <button class="dfc-picker-close" type="button" aria-label="Close field picker">&times;</button>
                </div>
                <input type="search" class="dfc-search" placeholder="Search fields..." aria-label="Search data fields">
                <div class="dfc-categories" role="tablist"></div>
                <div class="dfc-available-fields" role="listbox" aria-label="Available fields"></div>
            </div>
            
            <div class="dfc-actions">
                <button class="dfc-save-btn" type="button">Save Changes</button>
                <button class="dfc-reset-btn" type="button">Reset to Defaults</button>
            </div>
        </div>
    `,gn(t),Et(t),_t(()=>Et(t))}function Et(t){rn(t),ln(t),un(t)}function rn(t){const n=t.querySelector(".dfc-screens-tabs");n&&(n.innerHTML=f.profile.screens.map((o,i)=>`
            <button 
                class="dfc-screen-tab ${i===f.selectedScreenIndex?"dfc-screen-tab--active":""}"
                data-screen-index="${i}"
                role="tab"
                aria-selected="${i===f.selectedScreenIndex}"
                aria-label="${o.name} screen"
            >
                <span class="dfc-tab-icon">${o.icon}</span>
                <span class="dfc-tab-name">${$e(o.name)}</span>
            </button>
        `).join(""))}function ln(t){const n=N(),o=t.querySelector(".dfc-screen-name"),i=t.querySelector(".dfc-layout-select"),a=t.querySelector(".dfc-fields-list");if(!(!n||!o||!a||!i)){if(o.textContent=`${n.icon} ${n.name}`,i.value=n.layout,n.slots.length===0){a.innerHTML=`
            <div class="dfc-empty-screen">
                <p>No fields on this screen</p>
                <p class="dfc-empty-hint">Click "Add Field" to add metrics</p>
            </div>
        `;return}a.innerHTML=n.slots.sort((d,s)=>d.position-s.position).map(d=>{const s=Nt(d.fieldId),r=s?.name??"Unknown",u=s?.icon??"‚ùì";return`
                <div class="dfc-field-item" data-slot-id="${d.id}" role="listitem" draggable="true">
                    <span class="dfc-field-drag" title="Drag to reorder">‚ãÆ‚ãÆ</span>
                    <span class="dfc-field-icon">${u}</span>
                    <div class="dfc-field-info">
                        <span class="dfc-field-name">${$e(r)}</span>
                        <span class="dfc-field-id">${d.fieldId}</span>
                    </div>
                    <select class="dfc-field-size" data-slot-id="${d.id}" aria-label="Field size">
                        <option value="small" ${d.size==="small"?"selected":""}>Small</option>
                        <option value="medium" ${d.size==="medium"?"selected":""}>Medium</option>
                        <option value="large" ${d.size==="large"?"selected":""}>Large</option>
                        <option value="wide" ${d.size==="wide"?"selected":""}>Wide</option>
                        <option value="tall" ${d.size==="tall"?"selected":""}>Tall</option>
                        <option value="full" ${d.size==="full"?"selected":""}>Full</option>
                        <option value="xlarge" ${d.size==="xlarge"?"selected":""}>Extra Large</option>
                        <option value="xxlarge" ${d.size==="xxlarge"?"selected":""}>XX-Large</option>
                        <option value="jumbo" ${d.size==="jumbo"?"selected":""}>Jumbo</option>
                    </select>
                    <button class="dfc-field-remove" data-slot-id="${d.id}" aria-label="Remove ${r}" title="Remove">
                        üóëÔ∏è
                    </button>
                </div>
            `}).join("")}}function un(t){const n=t.querySelector(".dfc-categories"),o=t.querySelector(".dfc-available-fields");if(!n||!o)return;const i=["all","power","heartrate","cadence","speed","distance","elevation","time"];n.innerHTML=i.map(r=>`
            <button 
                class="dfc-category-btn ${r===f.selectedCategory?"dfc-category-btn--active":""}"
                data-category="${r}"
                role="tab"
                aria-selected="${r===f.selectedCategory}"
            >
                <span>${an[r]}</span>
                <span>${r==="all"?"All":r.charAt(0).toUpperCase()+r.slice(1)}</span>
            </button>
        `).join("");const a=cn(),d=N(),s=new Set(d?.slots.map(r=>r.fieldId)??[]);o.innerHTML=a.map(r=>{const u=s.has(r.id);return`
                <button 
                    class="dfc-available-field ${u?"dfc-available-field--used":""}"
                    data-field-id="${r.id}"
                    role="option"
                    aria-selected="false"
                    ${u?"disabled":""}
                >
                    <span class="dfc-af-icon">${r.icon}</span>
                    <div class="dfc-af-info">
                        <span class="dfc-af-name">${$e(r.name)}</span>
                        <span class="dfc-af-desc">${$e(r.description)}</span>
                    </div>
                    ${u?'<span class="dfc-af-badge">Added</span>':""}
                </button>
            `}).join("")}function gn(t){t.addEventListener("click",o=>{const i=o.target,a=i.closest(".dfc-screen-tab");if(a){const u=parseInt(a.dataset.screenIndex??"0",10);H({selectedScreenIndex:u});return}if(i.closest(".dfc-add-field-btn")){fn(t);return}if(i.closest(".dfc-picker-close")){pn(t);return}const d=i.closest(".dfc-category-btn");if(d){const u=d.dataset.category;H({selectedCategory:u});return}const s=i.closest(".dfc-available-field");if(s&&!s.hasAttribute("disabled")){const u=s.dataset.fieldId;u&&(en(u),St());return}const r=i.closest(".dfc-field-remove");if(r){const u=r.dataset.slotId;u&&tn(u);return}if(i.closest(".dfc-save-btn")){Yt()?We("Settings saved!","success"):We("Failed to save settings","error");return}if(i.closest(".dfc-reset-btn")){confirm("Reset data fields to defaults? This cannot be undone.")&&vn();return}}),t.addEventListener("change",o=>{const i=o.target;if(i.classList.contains("dfc-layout-select")){on(i.value);return}if(i.classList.contains("dfc-field-size")){const a=i.dataset.slotId;a&&nn(a,{size:i.value});return}});const n=t.querySelector(".dfc-search");n&&n.addEventListener("input",o=>{const i=o.target;H({searchQuery:i.value})}),mn(t)}function mn(t){const n=t.querySelector(".dfc-fields-list");if(!n)return;let o=null,i=-1;n.addEventListener("dragstart",a=>{o=a.target.closest(".dfc-field-item"),o&&(i=Array.from(n.children).indexOf(o),o.classList.add("dfc-field-item--dragging"))}),n.addEventListener("dragend",()=>{o&&o.classList.remove("dfc-field-item--dragging"),o=null,i=-1}),n.addEventListener("dragover",a=>{a.preventDefault();const s=a.target.closest(".dfc-field-item");s&&s!==o&&Array.from(n.querySelectorAll(".dfc-field-item:not(.dfc-field-item--dragging)")).indexOf(s)!==-1&&s.classList.add("dfc-field-item--drag-over")}),n.addEventListener("dragleave",a=>{const s=a.target.closest(".dfc-field-item");s&&s.classList.remove("dfc-field-item--drag-over")}),n.addEventListener("drop",a=>{a.preventDefault();const s=a.target.closest(".dfc-field-item");if(n.querySelectorAll(".dfc-field-item--drag-over").forEach(r=>{r.classList.remove("dfc-field-item--drag-over")}),s&&o&&s!==o){const u=Array.from(n.querySelectorAll(".dfc-field-item")).indexOf(s);i!==-1&&u!==-1&&i!==u&&sn(i,u)}})}function fn(t){const n=t.querySelector(".dfc-field-picker");if(n){n.style.display="block";const o=n.querySelector(".dfc-search");o&&o.focus()}}function pn(t){const n=t.querySelector(".dfc-field-picker");n&&(n.style.display="none",H({searchQuery:"",selectedCategory:"all"}))}function vn(){localStorage.removeItem("bpt-data-fields"),Gt(),We("Data fields reset to defaults","info")}function We(t,n){const o=new CustomEvent("show-notification",{detail:{message:t,type:n}});document.dispatchEvent(o),console.log(`[DataFieldsConfig] ${n}: ${t}`)}function $e(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function hn(){const t=document.querySelector("#page-settings .page-content");if(!t){console.warn("[DataFieldsConfig] Settings page content not found");return}if(t.querySelector(".data-fields-config"))return;const n=document.createElement("fieldset");n.className="settings-fieldset",n.style.cssText="border: 1px solid #d0d7de; border-radius: 8px; padding: 16px; margin-bottom: 20px;",n.innerHTML='<legend style="font-weight: 600; padding: 0 8px;">üìä Data Fields Configuration</legend>';const o=t.querySelector("fieldset:nth-child(4)");o&&o.nextSibling?t.insertBefore(n,o.nextSibling):t.appendChild(n),dn(n),console.log("[DataFieldsConfig] Initialized")}class xn{id="settings";init(n){const o=document.getElementById("settingsTemplate");if(o){const i=o.content.cloneNode(!0);n.appendChild(i),setTimeout(()=>{Qt(),hn()},0)}else console.error("Settings template not found!"),n.innerHTML="<p>Error loading settings view</p>"}onEnter(){}onLeave(){console.log("Left Settings View")}}export{xn as SettingsView};
//# sourceMappingURL=SettingsView-CnWmkYRK.js.map
