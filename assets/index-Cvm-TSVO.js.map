{"version":3,"mappings":"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","names":["getTimestring","milliseconds","totalSeconds","hours","minutes","seconds","initTimerDisplay","timeState","startStopButton","timeElement","metricsTable","nextText","elapsedMs","nextStartButtonText","stoppedDuration","getValuesAtTimestamps","arr","timestamps","entries","index","ts","prevIndex","suggestedElem","isAfterLastPoint","prevTime","nextTime","mergeMeasurements","measurements","sources","data","firstTimestamps","startTime","endTime","timeStep","time","syncedHR","syncedCadence","syncedPower","dataPoints","i","point","getCsvString","header","rows","timestamp","power","cadence","heartrate","MeasurementsState","value","type","entry","hrString","hr","cadenceString","powerString","getTcxTrackpoint","parts","key","toStringFn","part","getTcxString","firstTimestamp","lastTimestamp","totalTimeSeconds","startDate","initDiscardButton","measurementsState","initExportButton","now","exportData","jsonString","jsonBlob","jsonUrl","jsonLink","tcxString","tcxBlob","tcxUrl","tcxLink","csvString","csvBlob","csvUrl","csvLink","error","connectPowerElem","connectHeartrateElem","connectCadenceElem","powerElement","heartrateElement","cadenceElement","elements","initMetricsDisplay","connectionsState","updateMetricDisplay","element","emptyValue","latestMeasurement","metricTypes","connectCadenceBluetooth","listeners","lastCrankRevs","lastCrankTime","device","characteristic","event","flags","offset","crankRevs","crankTime","revDelta","timeDelta","timeInSeconds","rpm","listener","callback","connectCadence","connectHeartRateBluetooth","heartRate","connectHeartRate","connectPowerBluetooth","connectPower","initConnectionButtons","emojis","disconnectFn","connectElem","displayElem","connectFn","connectFns","disconnect","addListener","getInitState","handleWakeLock","wakeLock","requestWakeLock","err","registerSW","options","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","__vitePreload","Workbox","e","r","registerServiceWorker","updateSW","showUpdateNotification","swUrl","registration","updateContainer","deferredPrompt","initInstallPrompt","showInstallButton","hideInstallButton","installContainer","outcome","exposeVariablesDuringTest"],"ignoreList":[],"sources":["../../src/getTimestring.js","../../src/ui/time.js","../../src/merge-measurements.js","../../src/create-csv.js","../../src/MeasurementsState.js","../../src/create-tcx.js","../../src/ui/menu.js","../../src/elements.js","../../src/initMetricsDisplay.js","../../src/connect-cadence.js","../../src/connect-heartrate.js","../../src/connect-power.js","../../src/initConnectionButtons.js","../../src/getInitState.js","../../src/ui/wakeLock.js","../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/ui/serviceWorker.js","../../src/ui/installPrompt.js","../../src/exposeVariablesDuringTest.js","../../src/main.js"],"sourcesContent":["export const getTimestring = (milliseconds) => {\n    const totalSeconds = Math.floor(milliseconds / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    return (\n        `${hours.toString().padStart(2, '0')}:` +\n        `${minutes.toString().padStart(2, '0')}:` +\n        `${seconds.toString().padStart(2, '0')}`\n    );\n};\n","import { getTimestring } from '../getTimestring.js';\n\nexport const initTimerDisplay = (timeState) => {\n    const startStopButton = document.getElementById('startStop');\n    const timeElement = document.getElementById('time');\n    const metricsTable = document.getElementById('metricsTable');\n\n    setInterval(() => {\n        let nextText = '00:00:00'\n        if (timeState.startTime && timeState.running) {\n            const elapsedMs = Date.now() - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        } else if (timeState.startTime && timeState.endTime) {\n            const elapsedMs = timeState.endTime - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        }\n        if (timeElement.textContent !== nextText) {\n            timeElement.textContent = nextText;\n        }\n\n        const nextStartButtonText = timeState.running ? 'â¹ï¸' : 'â–¶ï¸';\n        if (startStopButton.textContent !== nextStartButtonText) {\n            startStopButton.textContent = nextStartButtonText;\n        }\n\n        // Update metrics table styling based on running state\n        if (timeState.running) {\n            metricsTable.classList.remove('paused');\n        } else {\n            metricsTable.classList.add('paused');\n        }\n    }, 100);\n\n    startStopButton.addEventListener('click', () => {\n        if (timeState.running) {\n            // Stop the workout (pause it, don't reset)\n            timeState.running = false;\n            timeState.endTime = Date.now();\n\n            // Change button to start\n            startStopButton.textContent = 'â–¶ï¸';\n        } else {\n            // Start/Resume the workout\n            if (timeState.endTime) {\n                // Resuming - adjust startTime to account for time stopped\n                const stoppedDuration = Date.now() - timeState.endTime;\n                timeState.startTime += stoppedDuration;\n                timeState.endTime = null;\n            } else {\n                // Starting fresh\n                timeState.startTime = Date.now();\n            }\n            timeState.running = true;\n            startStopButton.textContent = 'â¹ï¸';\n        }\n    });\n}","\nexport const getValuesAtTimestamps = (arr, timestamps) => {\n    const entries = [];\n    let index = 0;\n    for (const ts of timestamps) {\n        while (index < arr.length && arr[index].timestamp < ts) {\n            index++;\n        }\n\n        const prevIndex = index - 1;\n        let suggestedElem = undefined;\n        const isAfterLastPoint = index >= arr.length;\n        if (prevIndex < 0) {\n            suggestedElem = arr?.[index];\n        } else if (isAfterLastPoint) {\n            suggestedElem = arr?.[prevIndex];\n        } else {\n            const prevTime = arr?.[prevIndex]?.timestamp ?? 0;\n            const nextTime = arr?.[index]?.timestamp ?? 0;\n            suggestedElem = (ts - prevTime) <= (nextTime - ts) ? arr?.[prevIndex] : arr?.[index];\n        }\n        if (suggestedElem?.timestamp) {\n            const distance = Math.abs(suggestedElem.timestamp - ts);\n            // Values must be strictly less than 1000ms away\n            if (distance < 1000) {\n                entries.push(suggestedElem.value);\n            } else {\n                entries.push(null);\n            }\n        } else {\n            entries.push(null);\n        }\n    }\n    return entries;\n};\n/**\n * @param {MeasurementsState} measurements - The measurements state object containing workout data\n */\n\nexport const mergeMeasurements = (measurements) => {\n    const sources = [measurements.heartrate, measurements.cadence, measurements.power];\n    const hasData = sources.some(data => data.length > 0);\n    if (!hasData) {\n        return [];\n    }\n    const firstTimestamps = sources.map(data => data.length > 0 ? data[0].timestamp : Infinity);\n    const startTime = Math.min(...firstTimestamps);\n    const endTime = Math.max(...sources.map(data => data.length > 0 ? data[data.length - 1].timestamp : -Infinity));\n    const timeStep = 1000; // 1 second intervals\n    const timestamps = [];\n    let time = startTime;\n    while (time <= endTime) {\n        timestamps.push(time);\n        time += timeStep;\n    }\n    const syncedHR = getValuesAtTimestamps(measurements.heartrate, timestamps);\n    const syncedCadence = getValuesAtTimestamps(measurements.cadence, timestamps);\n    const syncedPower = getValuesAtTimestamps(measurements.power, timestamps);\n\n    const dataPoints = [];\n    for (let i = 0; i < timestamps.length; i++) {\n        const point = {\n            timestamp: timestamps[i],\n            heartrate: syncedHR[i] ?? null,\n            cadence: syncedCadence[i] ?? null,\n            power: syncedPower[i] ?? null,\n        };\n        dataPoints.push(point);\n    }\n    return dataPoints;\n};\n","import { mergeMeasurements } from \"./merge-measurements.js\";\n\n/**\n * Creates a CSV string from merged measurements\n * @param {MeasurementsState} measurements - Merged measurement data points\n * @returns {string} CSV formatted string\n */\nexport const getCsvString = (measurements) => {\n    const dataPoints = mergeMeasurements(measurements);\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    // CSV header\n    const header = 'timestamp,power,cadence,heartrate';\n\n    // Convert each data point to CSV row\n    const rows = dataPoints.map(point => {\n        const timestamp = new Date(point.timestamp).toISOString();\n        const power = point.power !== null ? Math.round(point.power) : '';\n        const cadence = point.cadence !== null ? Math.round(point.cadence) : '';\n        const heartrate = point.heartrate !== null ? Math.round(point.heartrate) : '';\n        return `${timestamp},${power},${cadence},${heartrate}`;\n    });\n\n    return [header, ...rows].join('\\n');\n};\n","class MeasurementsState {\n    constructor() {\n        this.heartrate = [];\n        this.power = [];\n        this.cadence = [];\n    }\n\n    addHeartrate({ timestamp, value }) {\n        if (value <= 0 || value >= 300) {\n            throw new Error('Heartrate must be between 1 and 299');\n        }\n        this.heartrate.push({\n            timestamp: timestamp,\n            value: value\n        });\n    }\n\n    addPower({ timestamp, value }) {\n        if (value <= 0 || value >= 3000) {\n            throw new Error('Power must be between 1 and 2999');\n        }\n        this.power.push({\n            timestamp: timestamp,\n            value: value\n        });\n    }\n\n    addCadence({ timestamp, value }) {\n        if (value <= 0 || value >= 300) {\n            throw new Error('Cadence must be between 1 and 299');\n        }\n        this.cadence.push({\n            timestamp: timestamp,\n            value: value\n        });\n    }\n\n    add(type, entry) {\n        if (type === 'heartrate') {\n            this.addHeartrate(entry);\n        } else if (type === 'power') {\n            this.addPower(entry);\n        } else if (type === 'cadence') {\n            this.addCadence(entry);\n        } else {\n            throw new Error(`Unknown measurement type: ${type}`);\n        }\n    }\n}\n\nexport { MeasurementsState };\n\n\n","import { MeasurementsState } from \"./MeasurementsState.js\"\nimport { mergeMeasurements } from \"./merge-measurements.js\";\n\nconst hrString = (hr) => hr !== null ? `<HeartRateBpm><Value>${Math.round(hr)}</Value></HeartRateBpm>` : '';\nconst cadenceString = (cadence) => cadence !== null ? `<Cadence>${Math.round(cadence)}</Cadence>` : '';\nconst powerString = (power) => {\n    if (power === null) return '';\n    return `<Extensions>\n              <TPX xmlns=\"http://www.garmin.com/xmlschemas/ActivityExtension/v2\">\n                <Watts>${Math.round(power)}</Watts>\n              </TPX>\n            </Extensions>`;\n}\n\nconst getTcxTrackpoint = (point) => {\n    const timestamp = new Date(point.timestamp).toISOString();\n    const keyToString = { heartrate: hrString, cadence: cadenceString, power: powerString };\n    const parts = Object.entries(keyToString).map(([key, toStringFn]) => {\n        const value = point[key];\n        return value !== null ? toStringFn(value) : '';\n    }).filter(part => part !== '');\n    const tcx = `\n<Trackpoint>\n    <Time>${timestamp}</Time>\n    ${parts.join('\\n')}\n</Trackpoint>\n    `.trim();\n    return tcx;\n}\n\n/**\n * Creates a Garmin TCX (Training Center XML) string from merged measurements\n * @param {MeasurementsState} measurements - Merged measurement data points\n * @returns {string} TCX formatted XML string\n */\nexport const getTcxString = (measurements) => {\n    const dataPoints = mergeMeasurements(measurements);\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const totalTimeSeconds = Math.round((lastTimestamp - firstTimestamp) / 1000);\n    const startDate = new Date(firstTimestamp).toISOString();\n\n    const tcx = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <TrainingCenterDatabase xmlns=\"http://www.garmin.com/xmlschemas/TrainingCenterDatabase/v2\">\n        <Activities>\n            <Activity Sport=\"Biking\">\n                <Id>${startDate}</Id>\n                <Lap StartTime=\"${startDate}\">\n                    <TotalTimeSeconds>${totalTimeSeconds}</TotalTimeSeconds>\n                    <Calories>0</Calories>\n                    <Intensity>Active</Intensity>\n                    <TriggerMethod>Manual</TriggerMethod>\n                    <Track>\n${dataPoints.map(getTcxTrackpoint).join('\\n')}\n                    </Track>\n                </Lap>\n            </Activity>\n        </Activities>\n    </TrainingCenterDatabase>`;\n\n    return tcx;\n}","import { getCsvString } from \"../create-csv\";\nimport { getTcxString } from \"../create-tcx\";\n\nexport const initDiscardButton = ({ measurementsState, timeState }) => {\n    // Discard button - in menu with confirmation dialog\n    const discardButton = document.getElementById('discardButton');\n    discardButton.addEventListener('click', () => {\n        // Show confirmation dialog\n        if (confirm('Are you sure you want to discard this workout?')) {\n            // Reset time state\n            timeState.running = false;\n            timeState.startTime = null;\n            timeState.endTime = null;\n\n            // Reset measurements\n            measurementsState.power = [];\n            measurementsState.heartrate = [];\n            measurementsState.cadence = [];\n        }\n    });\n}\n\nexport const initExportButton = (measurementsState) => {\n    const exportDataElem = document.getElementById('exportData');\n    exportDataElem.addEventListener('click', () => {\n        try {\n            const now = new Date();\n            const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;\n\n            // Create export data object with all measurements\n            const exportData = {\n                power: measurementsState.power,\n                heartrate: measurementsState.heartrate,\n                cadence: measurementsState.cadence,\n            };\n\n            // Download JSON file\n            const jsonString = JSON.stringify(exportData, null, 2);\n            const jsonBlob = new Blob([jsonString], { type: 'application/json' });\n            const jsonUrl = URL.createObjectURL(jsonBlob);\n            const jsonLink = document.createElement('a');\n            jsonLink.href = jsonUrl;\n            jsonLink.download = `bike-measurements-${timestamp}.json`;\n            jsonLink.click();\n            URL.revokeObjectURL(jsonUrl);\n\n            // Download TCX file\n            const tcxString = getTcxString(measurementsState);\n            const tcxBlob = new Blob([tcxString], { type: 'application/xml' });\n            const tcxUrl = URL.createObjectURL(tcxBlob);\n            const tcxLink = document.createElement('a');\n            tcxLink.href = tcxUrl;\n            tcxLink.download = `bike-workout-${timestamp}.tcx`;\n            tcxLink.click();\n            URL.revokeObjectURL(tcxUrl);\n\n            // Download CSV file\n            const csvString = getCsvString(measurementsState);\n            const csvBlob = new Blob([csvString], { type: 'text/csv' });\n            const csvUrl = URL.createObjectURL(csvBlob);\n            const csvLink = document.createElement('a');\n            csvLink.href = csvUrl;\n            csvLink.download = `bike-workout-${timestamp}.csv`;\n            csvLink.click();\n            URL.revokeObjectURL(csvUrl);\n        } catch (error) {\n            console.error('Error exporting data:', error);\n        }\n    });\n};","export const connectPowerElem = document.getElementById('connectPower');\nexport const connectHeartrateElem = document.getElementById('connectHeartrate');\nexport const connectCadenceElem = document.getElementById('connectCadence');\n\nexport const powerElement = document.getElementById('power');\nexport const heartrateElement = document.getElementById('heartrate');\nexport const cadenceElement = document.getElementById('cadence');\n\n\nexport const elements = {\n    power: { display: powerElement, connect: connectPowerElem },\n    heartrate: { display: heartrateElement, connect: connectHeartrateElem },\n    cadence: { display: cadenceElement, connect: connectCadenceElem },\n};\n","import { elements } from './elements';\n\nexport const initMetricsDisplay = ({ connectionsState, measurementsState, }) => {\n    const updateMetricDisplay = (key) => {\n        const element = elements?.[key]?.display;\n        if (!element || !connectionsState?.[key]) {\n            return;\n        }\n        const emptyValue = '--';\n        if (!connectionsState?.[key]?.isConnected) {\n            element.textContent = emptyValue;\n            return;\n        }\n        const arr = measurementsState[key];\n        if (!Array.isArray(arr) || arr.length === 0) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        const latestMeasurement = arr[arr.length - 1];\n        if (!latestMeasurement || typeof latestMeasurement.value !== 'number' || typeof latestMeasurement.timestamp !== 'number') {\n            element.textContent = emptyValue;\n            return;\n        }\n        const timeDiff = Date.now() - latestMeasurement.timestamp;\n        // If data is older than 5 seconds, show as disconnected\n        if (timeDiff > 5000) {\n            element.textContent = emptyValue;\n            return;\n        }\n\n        element.textContent = latestMeasurement.value;\n    };\n\n    const metricTypes = ['power', 'heartrate', 'cadence'];\n    // Start the event loop\n    setInterval(() => {\n        metricTypes.forEach(updateMetricDisplay);\n    }, 100);\n};\n","export const connectCadenceMock = async () => {\n    const listeners = [];\n    const cadenceInterval = setInterval(() => {\n        const randomCadence = Math.floor(Math.random() * 40) + 70; // 70-110 rpm\n        const entry = { timestamp: Date.now(), value: randomCadence };\n        listeners.forEach(listener => listener(entry));\n    }, 1000);\n\n    return {\n        disconnect: () => clearInterval(cadenceInterval),\n        addListener: (callback) => {\n            listeners.push(callback);\n        }\n    };\n}\n\nexport const connectCadenceBluetooth = async () => {\n    const listeners = [];\n    let lastCrankRevs = null;\n    let lastCrankTime = null;\n\n    // Request Bluetooth device with cycling speed and cadence service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_speed_and_cadence'] }],\n        optionalServices: ['cycling_speed_and_cadence']\n    });\n\n    // Connect to GATT server\n    const server = await device.gatt.connect();\n\n    // Get cycling speed and cadence service\n    const service = await server.getPrimaryService('cycling_speed_and_cadence');\n\n    // Get CSC measurement characteristic\n    const characteristic = await service.getCharacteristic('csc_measurement');\n\n    // Start notifications\n    await characteristic.startNotifications();\n\n    // Listen for cadence changes\n    characteristic.addEventListener('characteristicvaluechanged', (event) => {\n        const value = event.target.value;\n        const flags = value.getUint8(0);\n\n        // Check if crank revolution data is present (bit 1 of flags)\n        if (flags & 0x02) {\n            // Crank revolution data format:\n            // - Cumulative Crank Revolutions (uint16, bytes 1-2 or 5-6 depending on wheel data)\n            // - Last Crank Event Time (uint16, bytes 3-4 or 7-8, units: 1/1024 seconds)\n\n            let offset = 1; // Start after flags byte\n\n            // If wheel revolution data is present (bit 0), skip it (4 bytes)\n            if (flags & 0x01) {\n                offset = 5;\n            }\n\n            const crankRevs = value.getUint16(offset, true);\n            const crankTime = value.getUint16(offset + 2, true); // Units: 1/1024 seconds\n\n            // Calculate RPM from delta between measurements\n            if (lastCrankRevs !== null && lastCrankTime !== null) {\n                let revDelta = crankRevs - lastCrankRevs;\n                let timeDelta = crankTime - lastCrankTime;\n\n                // Handle rollover (uint16 max is 65535)\n                if (revDelta < 0) revDelta += 65536;\n                if (timeDelta < 0) timeDelta += 65536;\n\n                // Calculate RPM: (revolutions / time_in_seconds) * 60\n                // Time is in 1/1024 seconds, so convert to seconds\n                if (timeDelta > 0) {\n                    const timeInSeconds = timeDelta / 1024;\n                    const rpm = Math.round((revDelta / timeInSeconds) * 60);\n\n                    // Sanity check for reasonable cadence values\n                    if (rpm > 0 && rpm < 300) {\n                        const entry = { timestamp: Date.now(), value: rpm };\n                        listeners.forEach(listener => listener(entry));\n                    }\n                }\n            }\n\n            lastCrankRevs = crankRevs;\n            lastCrankTime = crankTime;\n        }\n    });\n\n    return {\n        disconnect: () => {\n            characteristic.stopNotifications();\n            device.gatt.disconnect();\n        },\n        addListener: (callback) => {\n            listeners.push(callback);\n        }\n    };\n}\n\nexport const connectCadence = async () => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectCadenceMock();\n    }\n    return connectCadenceBluetooth();\n};\n","\nexport const connectHeartRateMock = async () => {\n    const listeners = [];\n    const heartRateInterval = setInterval(() => {\n        const randomHeartRate = Math.floor(Math.random() * 80) + 120; // 120-200 bpm\n        const entry = { timestamp: Date.now(), value: randomHeartRate };\n        listeners.forEach(listener => listener(entry));\n    }, 1000);\n\n    return {\n        disconnect: () => clearInterval(heartRateInterval),\n        addListener: (callback) => {\n            listeners.push(callback);\n        }\n    };\n}\n\nexport const connectHeartRateBluetooth = async () => {\n    const listeners = [];\n\n    // Request Bluetooth device with heart rate service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['heart_rate'] }],\n        optionalServices: ['heart_rate']\n    });\n\n    // Connect to GATT server\n    const server = await device.gatt.connect();\n\n    // Get heart rate service\n    const service = await server.getPrimaryService('heart_rate');\n\n    // Get heart rate measurement characteristic\n    const characteristic = await service.getCharacteristic('heart_rate_measurement');\n\n    // Start notifications\n    await characteristic.startNotifications();\n\n    // Listen for heart rate changes\n    characteristic.addEventListener('characteristicvaluechanged', (event) => {\n        const value = event.target.value;\n        // Heart rate measurement format: first byte contains flags, second byte is heart rate\n        const heartRate = value.getUint8(1);\n        const entry = { timestamp: Date.now(), value: heartRate };\n        listeners.forEach(listener => listener(entry));\n    });\n\n    return {\n        disconnect: () => {\n            characteristic.stopNotifications();\n            device.gatt.disconnect();\n        },\n        addListener: (callback) => {\n            listeners.push(callback);\n        }\n    };\n}\n\nexport const connectHeartRate = async () => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectHeartRateMock();\n    }\n    // Production implementation would go here\n    return connectHeartRateBluetooth();\n};","\nexport const connectPowerMock = async () => {\n    const listeners = [];\n    const powerInterval = setInterval(() => {\n        const randomPower = Math.floor(Math.random() * 300) + 100; // 100-400W\n        const entry = { timestamp: Date.now(), value: randomPower };\n        listeners.forEach(listener => listener(entry));\n    }, 100);\n\n    return {\n        disconnect: () => clearInterval(powerInterval),\n        addListener: (callback) => {\n            listeners.push(callback);\n        }\n    };\n}\n\nexport const connectPowerBluetooth = async () => {\n    const listeners = [];\n\n    // Request Bluetooth device with cycling power service\n    const device = await navigator.bluetooth.requestDevice({\n        filters: [{ services: ['cycling_power'] }],\n        optionalServices: ['cycling_power']\n    });\n\n    // Connect to GATT server\n    const server = await device.gatt.connect();\n\n    // Get cycling power service\n    const service = await server.getPrimaryService('cycling_power');\n\n    // Get cycling power measurement characteristic\n    const characteristic = await service.getCharacteristic('cycling_power_measurement');\n\n    // Start notifications\n    await characteristic.startNotifications();\n\n    // Listen for power changes\n    characteristic.addEventListener('characteristicvaluechanged', (event) => {\n        const value = event.target.value;\n        // Cycling power measurement format: bytes 2-3 contain instantaneous power (little-endian)\n        const power = value.getUint16(2, true);\n        const entry = { timestamp: Date.now(), value: power };\n        listeners.forEach(listener => listener(entry));\n    });\n\n    return {\n        disconnect: () => {\n            characteristic.stopNotifications();\n            device.gatt.disconnect();\n        },\n        addListener: (callback) => {\n            listeners.push(callback);\n        }\n    };\n}\n\n\nexport const connectPower = async () => {\n    if (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') {\n        return connectPowerMock();\n    }\n    return connectPowerBluetooth();\n}","import { connectCadence } from './connect-cadence';\nimport { connectHeartRate } from './connect-heartrate';\nimport { connectPower } from './connect-power';\nimport { elements } from './elements';\n\nexport const initConnectionButtons = ({ connectionsState, measurementsState }) => {\n    const metricTypes = ['power', 'heartrate', 'cadence'];\n    const emojis = {\n        power: 'âš¡',\n        heartrate: 'â¤ï¸',\n        cadence: 'ðŸš´',\n    };\n\n    const disconnectFn = (key) => {\n        if (typeof connectionsState[key].disconnect === 'function') {\n            connectionsState[key].disconnect();\n            connectionsState[key].disconnect = null;\n            connectionsState[key].isConnected = false;\n            const connectElem = elements[key]?.connect;\n            if (connectElem?.textContent) {\n                connectElem.textContent = `${emojis[key]} Connect ${key.charAt(0).toUpperCase() + key.slice(1)}`;\n            }\n            const displayElem = elements?.[key]?.display;\n            if (displayElem?.textContent) {\n                displayElem.textContent = '--';\n            }\n        }\n    };\n\n    const connectFn = async (key) => {\n        const connectFns = {\n            power: connectPower,\n            heartrate: connectHeartRate,\n            cadence: connectCadence,\n        };\n        try {\n            const { disconnect, addListener } = await connectFns[key]();\n\n            connectionsState[key].disconnect = disconnect;\n            connectionsState[key].isConnected = true;\n\n            addListener((entry) => {\n                measurementsState.add(key, entry);\n            });\n\n            const connectElem = elements[key]?.connect;\n            if (connectElem?.textContent) {\n                connectElem.textContent = `${emojis[key]} Disconnect ${key.charAt(0).toUpperCase() + key.slice(1)}`;\n            }\n        } catch (error) {\n            console.error(`Error connecting ${key}:`, error);\n        }\n    };\n\n    metricTypes.forEach((key) => {\n        const connectElem = elements[key]?.connect;\n        if (connectElem) {\n            connectElem.addEventListener('click', async () => {\n                if (connectionsState[key].isConnected) {\n                    disconnectFn(key);\n                } else {\n                    connectFn(key);\n                }\n            });\n        }\n    });\n};\n","import { MeasurementsState } from './MeasurementsState';\n\nexport const getInitState = () => {\n    return {\n        measurementsState: new MeasurementsState(),\n        connectionsState: {\n            power: {\n                isConnected: false,\n                disconnect: null,\n            },\n            heartrate: {\n                isConnected: false,\n                disconnect: null,\n            },\n            cadence: {\n                isConnected: false,\n                disconnect: null,\n            },\n        },\n        timeState: {\n            running: false,\n            startTime: null,\n            endTime: null,\n        },\n    };\n};","\nexport const handleWakeLock = () => {\n    // Keep screen awake during workout\n    let wakeLock = null;\n    const requestWakeLock = async () => {\n        try {\n            if ('wakeLock' in navigator) {\n                wakeLock = await navigator.wakeLock.request('screen');\n                console.log('Screen wake lock activated');\n\n                // Re-request wake lock if page becomes visible again\n                wakeLock.addEventListener('release', () => {\n                    console.log('Screen wake lock released');\n                });\n            }\n        } catch (err) {\n            console.error('Wake lock request failed:', err);\n        }\n    };\n    // Request wake lock when page loads\n    if (document.visibilityState === 'visible') {\n        requestWakeLock();\n    }\n    // Re-request wake lock when page becomes visible\n    document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n            requestWakeLock();\n        }\n    });\n}","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"./sw.js\", { scope: \"./\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"./sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","import { registerSW } from 'virtual:pwa-register'\n\nexport const registerServiceWorker = () => {\n    // Register service worker for PWA functionality using vite-plugin-pwa\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    const updateSW = registerSW({\n        onNeedRefresh() {\n            showUpdateNotification(updateSW);\n        },\n        onOfflineReady() {\n            console.log('App ready to work offline');\n        },\n        onRegisteredSW(swUrl, registration) {\n            console.log('Service Worker registered successfully:', swUrl);\n\n            // Check for updates periodically (every hour)\n            if (registration) {\n                setInterval(() => {\n                    registration.update();\n                }, 60 * 60 * 1000);\n            }\n        },\n        onRegisterError(error) {\n            console.log('Service Worker registration failed:', error);\n        }\n    });\n}\n\nconst showUpdateNotification = (updateSW) => {\n    const updateContainer = document.getElementById('updateNotification');\n    if (updateContainer) {\n        updateContainer.style.display = 'block';\n\n        const updateButton = document.getElementById('updateButton');\n        updateButton.addEventListener('click', () => {\n            updateSW(true); // Force reload after update\n        }, { once: true });\n\n        const dismissUpdateButton = document.getElementById('dismissUpdate');\n        dismissUpdateButton.addEventListener('click', () => {\n            updateContainer.style.display = 'none';\n        }, { once: true });\n    }\n};","let deferredPrompt = null;\n\nexport const initInstallPrompt = () => {\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    // Listen for the beforeinstallprompt event\n    window.addEventListener('beforeinstallprompt', (e) => {\n        // Prevent the mini-infobar from appearing on mobile\n        e.preventDefault();\n\n        // Stash the event so it can be triggered later\n        deferredPrompt = e;\n\n        // Show the install button\n        showInstallButton();\n    });\n\n    // Listen for the app installed event\n    window.addEventListener('appinstalled', () => {\n        console.log('PWA was installed successfully');\n        deferredPrompt = null;\n        hideInstallButton();\n    });\n};\n\nconst showInstallButton = () => {\n    const installContainer = document.getElementById('installPrompt');\n    if (installContainer) {\n        installContainer.style.display = 'block';\n\n        const installButton = document.getElementById('installButton');\n        installButton.addEventListener('click', async () => {\n            if (!deferredPrompt) {\n                return;\n            }\n\n            // Show the install prompt\n            deferredPrompt.prompt();\n\n            // Wait for the user to respond to the prompt\n            const { outcome } = await deferredPrompt.userChoice;\n            console.log(`User response to the install prompt: ${outcome}`);\n\n            // Clear the deferredPrompt\n            deferredPrompt = null;\n            hideInstallButton();\n        });\n\n        const dismissButton = document.getElementById('dismissInstall');\n        dismissButton.addEventListener('click', () => {\n            hideInstallButton();\n        });\n    }\n};\n\nconst hideInstallButton = () => {\n    const installContainer = document.getElementById('installPrompt');\n    if (installContainer) {\n        installContainer.style.display = 'none';\n    }\n};\n","export function exposeVariablesDuringTest({ measurementsState, connectionsState }) {\n    // Always expose in non-production builds for testing purposes\n    if (typeof window !== 'undefined') {\n        window.bike = measurementsState;\n        window.connectionsState = connectionsState;\n    }\n}\n","import './main.css';\nimport { initTimerDisplay } from './ui/time.js';\nimport { initDiscardButton, initExportButton } from './ui/menu.js';\nimport { initMetricsDisplay } from './initMetricsDisplay.js';\nimport { initConnectionButtons } from './initConnectionButtons.js';\nimport { getInitState } from './getInitState.js';\nimport { handleWakeLock } from './ui/wakeLock.js';\nimport { registerServiceWorker } from './ui/serviceWorker.js';\nimport { initInstallPrompt } from './ui/installPrompt.js';\nimport { exposeVariablesDuringTest } from './exposeVariablesDuringTest.js';\n\nconst { measurementsState, connectionsState, timeState } = getInitState();\nexposeVariablesDuringTest({ measurementsState, connectionsState });\n\ninitTimerDisplay(timeState);\ninitMetricsDisplay({ connectionsState, measurementsState });\n\ninitConnectionButtons({ connectionsState, measurementsState });\ninitDiscardButton({ measurementsState, timeState });\ninitExportButton(measurementsState);\n\nhandleWakeLock();\nregisterServiceWorker();\ninitInstallPrompt();\n"],"file":"index-Cvm-TSVO.js"}