{"version":3,"mappings":"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","names":["registry","loaded","observer","registerLazyComponent","tagName","loader","upperTag","startObserver","checkForComponent","mutations","nodesAdded","m","checkAllPending","loadComponent","error","PerformanceMonitor","list","entry","entries","lastEntry","fid","clsValue","e","name","startMark","start","duration","value","summary","metric","data","StateEventBus","event","handler","handlers","stateEventBus","TRACKED_DURATIONS","MeanMaximalPowerCalculator","d","watts","val","updates","indexToRemove","valToRemove","avg","DEFAULT_DATA","DB_NAME","STORE_NAME","RECORD_KEY","PersonalRecordsStore","openDB","db","stored","timestamp","workoutId","isAllTime","isSeason","year","currentAllTime","currentSeason","listener","index","personalRecordsStore","BaseComponent","oldValue","newValue","_name","_oldValue","_newValue","eventName","detail","selector","TYPE_STYLES","Toast","message","type","dismissible","styles","dismissBtn","options","toast","showNotification","notification","backgroundColor","announce","priority","announcer","shortcuts","registerShortcut","shortcut","handleKeydown","target","keyMatch","ctrlMatch","shiftMatch","altMatch","initKeyboardNavigation","startButton","pauseButton","resumeButton","modals","modal","closeBtn","details","firstButton","settingsBtn","router","historyBtn","exportBtn","lapBtn","trapFocus","focusableElements","firstElement","lastElement","updateWorkoutControlsAccessibility","state","stopButton","controlsContainer","generateShareImage","canvas","ctx","bgMain","bgCard","textPrimary","textSecondary","accent","powerColor","hrColor","drawRoundedRect","x","y","w","h","r","fill","drawText","text","fontSize","color","align","bold","drawMetricCard","label","subValue","icon","valueColor","dateStr","timeStr","centerX","centerY","formatDurationLong","gridY","padding","cardW","cardH","row2Y","workKj","stripY","stripH","stats","sectionW","stat","i","resolve","downloadWorkoutImage","blob","url","a","POWER_ZONE_COLORS","createModalElement","titleText","body","footer","btn","button","b","firstFocusable","lastFocusable","handleTabKey","showModal","previousActiveElement","removeFocusTrap","autofocusEl","closeModal","handleEscape","originalOnClose","showConfirmation","title","confirmText","cancelText","confirmVariant","ms","totalSeconds","hours","minutes","seconds","parts","formatSecondsShort","mins","secs","createLapTable","laps","container","html","lap","distStr","ZONE_COLORS","createZoneHistogram","distribution","z","maxTime","zone","percent","timeSeconds","createSummaryContent","newRecords","formatValue","unit","recordsHtml","powerChart","hrChart","lapTable","showWorkoutSummary","callbacks","content","PersonalRecordsManager","durationStr","avgPower20Min","estFtp","currentFtp","settingsStore","durationLabel","personalRecordsManager","VALIDATION_LIMITS","DistanceCalculator","point","distance","timeDelta","maxDistance","p1","p2","lat1","lat2","dLat","dLon","distanceCalculator","calculateCaloriesFromPower","powerWatts","durationSeconds","calculateCaloriesFromHeartRate","heartRate","weightKg","age","termAge","termWeight","termHr","caloriesPerMinute","DEFAULT_CONFIG","AdaptiveUpdater","config","callback","now","timeSinceDataChange","dataFieldsUpdater","MeasurementsState","enablePersistence","isIndexedDBSupported","settings","flushPendingSave","time","_settings","source","method","dt","kcal","throttledSave","min","max","clearPersisted","clearActiveWorkout","startTime","lapNumber","enabled","measurement","appState","initializeState","getState","exposeVariablesDuringTest","measurementsState","connectionsState","App","registerPlugin","__vitePreload","Router","Capacitor","canGoBack","view","viewContainer","viewId","path","replace","hash","matchedRoute","currentView","el","newView","DashboardView","_container","ViewId","NavBar","selectElement","id","element","setupRouter","dashboardView","settingsButton","workoutsButton","plansButton","racePredictorButton","vo2maxButton","aboutButton","getTimestring","milliseconds","generateRampSteps","startWatts","stepWatts","steps","_","RAMP_TEST","FTP_TEST_20MIN","THRESHOLD_2X20","SWEET_SPOT_3X10","VO2_MAX_30_30","RUNNING_EASY_30","RUNNING_TEMPO","RUNNING_INTERVALS_400","RUNNING_LONG_PROGRESSIVE","RUNNING_FARTLEK","WORKOUT_LIBRARY","getWorkoutById","getWorkoutDuration","workout","acc","step","PROFILE_KEY","defaultProfile","loadUserProfile","saveUserProfile","profile","AudioController","buffer","channel","Ctx","muted","freq","osc","gain","utterance","audioManager","WorkoutRunner","totalDuration","cb","nextIndex","startVal","endVal","progress","currentVal","formatDuration","roundedSeconds","formatDate","date","defaultSportSettings","SPORT_SETTINGS_KEY","getSportSettings","saveSportSettings","formatPace","paceSecPerKm","WorkerTimer","interval","workerTimer","calculateTotalDistanceKm","gpsPoints","totalMeters","R","prev","curr","deltaLat","deltaLon","c","VoiceFeedback","timeState","getSettings","voices","v","restoreVolume","timeMs","avgPower","avgSpeed","sportSettings","isRunning","paceSec","sec","zoneName","count","isRecording","isWorkoutRunning","intervalMinutes","elapsedMs","intervalMs","currentInterval","lastInterval","intervalKm","totalKm","powerData","currentPower","targetMin","targetMax","msg","TOLERANCE","metrics","recentThreshold","recentPower","p","recentHr","recentCadence","recentSpeed","s","minPerKm","template","trigger","metricsSettings","smartAnnouncements","isHighIntensity","userSettings","powerThreshold","hrThreshold","addMetric","condition","normal","smart","voiceFeedback","STORAGE_KEY","getCustomWorkouts","raw","saveCustomWorkout","workouts","saveAll","deleteCustomWorkout","filtered","parseErgMrc","fileName","lines","isHeader","isData","mode","description","points","line","trimmed","key","t","current","next","durationMinutes","targetType","avgVal","workoutName","activeRunner","initWorkoutSelectionLogic","initPlayerControls","initImportExport","refreshWorkoutList","importBtn","importInput","files","importWorkoutFile","file","lowerName","err","exportWorkout","dataStr","downloadAnchorNode","custom","h3","renderWorkoutItem","hr","h3lib","isCustom","actionsHtml","actionContainerStyle","startStructuredWorkout","onComplete","completed","updatePlayerUI","overlay","profileEl","minimizeBtn","skipBtn","isHidden","nameEl","descEl","timeEl","durEl","targetEl","nextEl","progressEl","timeRemaining","formatTime","visualizer","power","nextPwr","calculateNextTarget","pct","onWorkoutStart","onWorkoutPause","showCountdown","createCountdownOverlay","currentCount","intervalId","isCancelled","updateDisplay","countElement","playBeep","cancelBtn","handleCancel","isFinal","audioContext","oscillator","gainNode","getLapNumber","getCsvString","measurements","dataPoints","mergeMeasurements","header","rows","cadence","heartrate","speed","altitude","lat","lon","FIT_PROTOCOL_VERSION","FIT_PROFILE_VERSION","FIT_MESG_FILE_ID","FIT_MESG_FILE_CREATOR","FIT_MESG_ACTIVITY","FIT_MESG_SESSION","FIT_MESG_LAP","FIT_MESG_RECORD","FIT_MESG_EVENT","FIT_BASE_TYPE_ENUM","FIT_BASE_TYPE_UINT8","FIT_BASE_TYPE_UINT16","FIT_BASE_TYPE_UINT32","FILE_ID_TYPE","FILE_ID_MANUFACTURER","FILE_ID_PRODUCT","FILE_ID_SERIAL_NUMBER","FILE_ID_TIME_CREATED","RECORD_TIMESTAMP","RECORD_HEART_RATE","RECORD_CADENCE","RECORD_POWER","SESSION_TIMESTAMP","SESSION_START_TIME","SESSION_TOTAL_ELAPSED_TIME","SESSION_TOTAL_TIMER_TIME","SESSION_TOTAL_DISTANCE","SESSION_TOTAL_CALORIES","SESSION_SPORT","SESSION_SUB_SPORT","SESSION_EVENT","SESSION_EVENT_TYPE","LAP_TIMESTAMP","LAP_START_TIME","LAP_TOTAL_ELAPSED_TIME","LAP_TOTAL_TIMER_TIME","LAP_TOTAL_DISTANCE","LAP_TOTAL_CALORIES","LAP_EVENT","LAP_EVENT_TYPE","EVENT_TIMESTAMP","EVENT_EVENT","EVENT_EVENT_TYPE","ACTIVITY_TIMESTAMP","ACTIVITY_TOTAL_TIMER_TIME","ACTIVITY_NUM_SESSIONS","ACTIVITY_TYPE","ACTIVITY_EVENT","ACTIVITY_EVENT_TYPE","ACTIVITY_LOCAL_TIMESTAMP","FILE_TYPE_ACTIVITY","MANUFACTURER_DEVELOPMENT","SPORT_CYCLING","SPORT_RUNNING","SPORT_WALKING","SUB_SPORT_INDOOR_CYCLING","SUB_SPORT_GENERIC","EVENT_TIMER","EVENT_SESSION","EVENT_LAP","EVENT_ACTIVITY","EVENT_TYPE_START","EVENT_TYPE_STOP","ACTIVITY_TYPE_MANUAL","FIT_EPOCH_MS","calculateCrc","end","crcTable","crc","byte","tmp","toFitTimestamp","jsTimestamp","FitBuilder","localMsgType","globalMsgNum","fields","field","values","result","dataSize","headerCrc","dataCrc","finalBuffer","getFitSportValues","sport","getFitData","fitSportValues","fit","firstTimestamp","lastTimestamp","fitStartTime","fitEndTime","totalElapsedTime","totalElapsedTimeMs","validEnergy","totalCalories","validDistance","totalDistance","LOCAL_FILE_ID","LOCAL_FILE_CREATOR","LOCAL_EVENT","LOCAL_RECORD","LOCAL_LAP","LOCAL_SESSION","LOCAL_ACTIVITY","fitTimestamp","getWorkoutState","updateButtonVisibility","elements","workoutControlElements","pauseWorkout","isAutoPause","resumeWorkout","isAutoResume","pausedDuration","initTimerDisplay","timeElement","nextText","addListener","stopEvent","resetWorkout","downloadFile","filename","link","getExportTimestamp","showWorkoutStopSummary","zoneState","endTime","calculateWorkoutSummary","safeTitle","exportData","zoneData","jsonStr","jsonBlob","csvString","csvBlob","tcxString","getTcxString","tcxBlob","fitData","fitBlob","saveCompletedWorkout","addWorkoutToPMC","RPE_DESCRIPTIONS","generateDefaultTitle","timeOfDay","createRpeSelector","selectedValue","info","buttons","rpe","createMetadataFormContent","showNotes","showExertion","titleSection","notesSection","rpeSection","getMetadataFromForm","titleInput","notesInput","selectedRpe","metadata","showWorkoutMetadataModal","promptForNotes","promptForExertion","formContent","shouldShowMetadataModal","DEFAULT_UNDO_TIMEOUT","showUndoNotification","onUndo","onExpire","timeout","timeoutSeconds","remainingSeconds","undoButton","countdownSpan","progressFill","prefersReducedMotion","isUndone","countdownInterval","dismissTimeout","dismiss","executeExpire","createWorkoutBackup","restoreWorkoutBackup","backup","initLapButton","lapButton","lapCounter","lapCountElement","updateLapCounter","updateLapButtonVisibility","handleLapClick","lastLapTime","durationMs","lapPower","sum","elapsedStr","resetLapCounter","PersonalRecordTracker","getSummary","currentBest","newSummary","records","significantDurations","labels","renderLineChart","height","padTop","padBottom","padLeft","padRight","processedData","downsample","xValues","yValues","minX","maxX","minY","maxY","yRange","width","getX","getY","pathD","areaD","gridLines","yStep","startTimeStr","midTimeStr","endTimeStr","svg","renderBarChart","barGap","availableWidth","barWidth","bars","labelStep","xLabels","emptyStats","currentWorkouts","trendMetric","renderPeriodStatistics","containerId","statsContainer","renderSummaryTable","renderTrendsChart","parent","card","startOfWeek","day","startOfLastWeek","endOfLastWeek","startOfMonth","startOfLastMonth","endOfLastMonth","startOfYear","periods","buckets","dur","renderCell","row","updateChart","select","weeks","weekKey","getWeekKey","week","getDateFromWeek","dayNum","yearStart","weekNo","diff","cropWorkout","originalStartTime","newStartTime","newEndTime","filterMeasurements","croppedMeasurements","l","modalSummary","first","last","createIntervalWorkout","createEnduranceWorkout","ftpBuilderPlan","STORAGE_KEY_PLANS","STORAGE_KEY_PROGRESS","PlanRepository","plan","userPlans","plans","existingIndex","planId","startDate","planRepository","getScheduledEvents","endDate","events","planProgress","getPlanEvents","planStartDate","rangeStart","rangeEnd","planStart","weekOffset","diffToSunday","sundayOfStartWeek","targetDate","resolvedWorkout","todayStart","isCompleted","isDayComplete","status","round","lim","p2b","n2b","b2n","n2p","map$1","hex","h1","h2","eq","isShort","hexParse","str","len","ret","alpha","f","hexString","HUE_RE","hsl2rgbn","n","k","hsv2rgbn","hwb2rgbn","rgb","hueValue","g","rgb2hsl","calln","hsl2rgb","hwb2rgb","hsv2rgb","hue","hueParse","rotate","deg","hslString","map","names$1","unpack","unpacked","keys","tkeys","j","ok","nk","names","nameParse","RGB_RE","rgbParse","rgbString","to","from","interpolate","rgb1","rgb2","modHSL","ratio","clone","proto","fromObject","input","functionParse","Color","obj","weight","c1","c2","w2","w1","noop","uid","isNullOrUndef","isArray","isObject","isNumberFinite","finiteOrDefault","defaultValue","valueOrDefault","toPercentage","dimension","toDimension","fn","args","thisArg","each","loopable","reverse","_elementsEqual","a0","a1","ilen","v0","v1","klen","isValidKey","_merger","tval","sval","merge","sources","merger","mergeIf","_mergerIf","keyResolvers","o","_splitKey","part","_getKeyResolver","resolveObjectKey","_capitalize","defined","isFunction","setsEqual","item","_isClickEvent","PI","TAU","PITAU","INFINITY","RAD_PER_DEG","HALF_PI","QUARTER_PI","TWO_THIRDS_PI","log10","sign","almostEquals","epsilon","niceNum","range","roundedRange","niceRange","fraction","_factorize","sqrt","isNonPrimitive","isNumber","almostWhole","rounded","_setMinAndMaxByKey","array","property","toRadians","degrees","toDegrees","radians","_decimalPlaces","getAngleFromPoint","centrePoint","anglePoint","distanceFromXCenter","distanceFromYCenter","radialDistanceFromCenter","angle","distanceBetweenPoints","pt1","pt2","_angleDiff","_normalizeAngle","_angleBetween","sameAngleIsFullCircle","angleToStart","angleToEnd","startToAngle","endToAngle","_limitValue","_int16Range","_isBetween","_lookup","table","cmp","hi","lo","mid","_lookupByKey","ti","_rlookupByKey","_filterBetween","arrayEvents","listenArrayEvents","base","res","object","unlistenArrayEvents","stub","listeners","_arrayUnique","items","set","requestAnimFrame","throttled","argsToUse","ticking","debounce","delay","_toLeftRightCenter","_alignStartEnd","_textX","left","right","rtl","_getStartAndCountOfVisiblePoints","meta","animationsDisabled","pointCount","iScale","vScale","_parsed","spanGaps","axis","minDefined","maxDefined","distanceToDefinedLo","distanceToDefinedHi","_scaleRangesChanged","xScale","yScale","_scaleRanges","newRanges","changed","atEdge","elasticIn","elasticOut","effects","isPatternOrGradient","getHoverColor","numbers","colors","applyAnimationsDefaults","defaults","applyLayoutsDefaults","intlCache","getNumberFormat","locale","cacheKey","formatter","formatNumber","num","formatters","tickValue","ticks","notation","delta","maxTick","calculateDelta","logDelta","numDecimal","remain","Ticks","applyScaleDefaults","_ctx","overrides","descriptors","getScope$1","node","root","scope","Defaults","_descriptors","_appliers","context","targetScope","targetName","scopeObject","targetScopeObject","privateName","local","appliers","apply","toFontString","font","_measureText","gc","longest","string","textWidth","_longestText","arrayOfThings","cache","jlen","thing","nestedThing","gcLen","_alignPixel","chart","pixel","devicePixelRatio","halfWidth","clearCanvas","drawPoint","drawPointLegend","xOffset","yOffset","size","cornerRadius","xOffsetW","yOffsetW","style","rotation","radius","rad","_isPointInArea","area","margin","clipArea","unclipArea","_steppedLineTo","previous","flip","midpoint","_bezierCurveTo","setRenderOpts","opts","decorateText","top","bottom","yDecoration","drawBackdrop","oldColor","renderText","stroke","addRoundedRectPath","rect","LINE_HEIGHT","FONT_STYLE","toLineHeight","matches","numberOrZero","_readValueToProps","props","objProps","read","prop","toTRBL","toTRBLCorners","toPadding","toFont","fallback","inputs","_addGrace","minmax","grace","beginAtZero","change","keepZero","add","createContext","parentContext","_createResolver","scopes","prefixes","rootScopes","getTarget","finalRootScopes","_resolve","_cached","_resolveWithPrefixes","getKeysFromAllScopes","storage","_attachContext","proxy","subProxy","descriptorDefaults","receiver","_resolveWithContext","_scriptable","_indexable","_allKeys","readKey","prefix","needsSubResolver","_proxy","_context","_subProxy","_resolveScriptable","_resolveArray","getValue","_stack","createSubResolver","isIndexable","arr","resolver","resolveFallback","getScope","addScopes","parentScopes","parentFallback","allScopes","addScopesFromKey","subGetTarget","resolveKeysFromAllScopes","_parseObjectDataRadialScale","parsed","EPSILON","getPoint","getValueAxis","indexAxis","splineCurve","firstPoint","middlePoint","afterPoint","d01","d12","s01","s12","fa","fb","monotoneAdjust","deltaK","mK","pointsLen","alphaK","betaK","tauK","squaredMagnitude","pointCurrent","pointAfter","monotoneCompute","valueAxis","pointBefore","iPixel","vPixel","splineCurveMonotone","slopeDelta","capControlPoint","pt","capBezierPoints","inArea","inAreaPrev","inAreaNext","_updateBezierControlPoints","loop","controlPoints","_isDomSupported","_getParentNode","domNode","parseMaxStyle","styleValue","parentProperty","valueInPixels","getComputedStyle","getStyle","positions","getPositionedStyle","suffix","pos","useOffsetPos","getCanvasPosition","touches","offsetX","offsetY","box","getRelativePosition","currentDevicePixelRatio","borderBox","paddings","borders","getContainerSize","maxWidth","maxHeight","containerStyle","containerBorder","containerPadding","round1","getMaximumSize","bbWidth","bbHeight","aspectRatio","margins","containerSize","retinaScale","forceRatio","forceStyle","pixelRatio","deviceHeight","deviceWidth","supportsEventListenerOptions","passiveSupported","readUsedSize","_pointInLine","_steppedInterpolation","_bezierInterpolation","cp1","cp2","getRightToLeftAdapter","rectX","itemWidth","getLeftToRightAdapter","_itemWidth","getRtlAdapter","overrideTextDirection","direction","original","restoreTextDirection","propertyFn","normalizeSegment","getSegment","segment","bounds","startBound","endBound","between","normalize","_boundSegment","compare","inside","subStart","prevValue","startIsBefore","endIsBefore","shouldStart","shouldStop","_boundSegments","segments","sub","findStartAndEnd","solidSegments","cur","_computeSegments","segmentOptions","splitByStyles","completeLoop","doSplitByStyles","chartContext","baseStyle","readStyle","datasetIndex","prevStyle","addStyle","st","dir","styleChanged","replacer","getSizeForArea","scale","chartArea","getDatasetArea","getDatasetClipArea","clip","Animator","anims","numSteps","remaining","draw","charts","animator","transparent","interpolators","factor","c0","Animation","cfg","currentValue","elapsed","promises","rej","resolved","Animations","animationOptions","animatedProps","option","newOptions","resolveTargetOptions","animations","awaitAll","running","animation","properties","anim","scaleClip","allowedOverflow","defaultClip","toClip","getSortedDatasetIndices","filterVisible","metasets","applyStack","stack","dsIndex","singleMode","otherValue","found","convertObjectDataToArray","iAxisKey","vAxisKey","adata","isStacked","stacked","getStackKey","indexScale","valueScale","getUserBounds","getOrCreateStack","stacks","stackKey","indexValue","subStack","getLastIndexInStack","positive","updateStacks","controller","iAxis","vAxis","itemStacks","visualValues","getFirstScaleId","scales","createDatasetContext","createDataContext","clearStacks","isDirectUpdateMode","cloneIfNotShared","cached","shared","createStack","canStack","DatasetController","dataset","chooseId","xid","yid","rid","iid","vid","scaleID","_data","resetNewElements","stackChanged","oldStacked","scopeKeys","_stacked","sorted","isNotInOrderComparedToPrev","singleScale","xAxisKey","yAxisKey","parsedValue","otherScale","otherMin","otherMax","_skip","active","drawActiveElementsOnTop","elementType","sharing","transition","sharedOptions","firstOpts","previouslySharedOptions","includeOptions","arg1","arg2","numMeta","numData","move","removed","newCount","getAllScaleValues","visibleMetas","computeMinSampleSize","updateMinAndPrev","computeFitCategoryTraits","ruler","stackCount","thickness","computeFlexCategoryTraits","pixels","parseFloatBar","startValue","endValue","barStart","barEnd","parseValue","parseArrayOrPrimitive","isFloatBar","barSign","actualBase","borderProps","setBorderSkipped","edge","parseEdge","swap","startEnd","orig","v2","setInflateAmount","inflateAmount","BarController","reset","horizontal","vpixels","ipixels","dataIndex","currentParsed","iScaleValue","skipNull","indexScaleId","firstScaleAxisId","barThickness","baseValue","minBarLength","floating","length","head","startPixel","endPixel","halfGrid","maxBarThickness","center","axisCount","axisID","axisNumber","stackIndex","rects","BubbleController","getRatioAndOffset","circumference","cutout","ratioX","ratioY","startAngle","endAngle","startX","startY","endX","endY","calcMax","calcMin","DoughnutController","pointStyle","textAlign","useBorderRadius","borderRadius","legendItem","legend","getter","arcs","spacing","maxSize","chartWeight","maxRadius","outerRadius","innerRadius","radiusLength","animationOpts","animateScale","arc","metaData","total","ringWeightOffset","LineController","_dataset","maxGapLength","directUpdate","pointsCount","prevParsed","nullData","border","lastPoint","PolarAreaController","minSize","datasetStartAngle","defaultAngle","PieController","RadarController","pointPosition","ScatterController","showLine","controllers","abstract","DateAdapterBase","members","adapters","binarySearch","metaset","intersect","_sorted","lookupMethod","evaluateInteractionItems","position","getDistanceMetricForAxis","useX","useY","deltaX","deltaY","getIntersectItems","useFinalPosition","includeInvisible","getNearestRadialItems","evaluationFunc","getNearestCartesianItems","distanceMetric","minDistance","inRange","getNearestItems","getAxisItems","rangeMethod","intersectsItem","Interaction","STATIC_POSITIONS","filterByPosition","filterDynamicPositionByAxis","sortByWeight","wrapBoxes","boxes","layoutBoxes","stackWeight","buildStacks","layouts","wrap","setLayoutDims","params","vBoxMaxWidth","hBoxMaxHeight","layout","fullSize","buildLayoutBoxes","centerHorizontal","centerVertical","getCombinedMax","maxPadding","updateMaxPadding","boxPadding","updateDims","newWidth","newHeight","widthChanged","heightChanged","handleMaxPadding","updatePos","getMargins","marginForPositions","fitBoxes","refitBoxes","refit","same","other","setBoxDims","placeBoxes","userPadding","layoutItem","minPadding","availableHeight","verticalBoxes","horizontalBoxes","visibleVerticalBoxCount","BasePlatform","BasicPlatform","EXPANDO_KEY","EVENT_TYPES","isNullOrEmpty","initCanvas","renderHeight","renderWidth","displayWidth","displayHeight","eventListenerOptions","removeListener","fromNativeEvent","nodeListContains","nodeList","createAttachObserver","createDetachObserver","drpListeningCharts","oldDevicePixelRatio","onWindowResize","dpr","resize","listenDevicePixelRatioChanges","unlistenDevicePixelRatioChanges","createResizeObserver","releaseObserver","createProxyAndListen","DomPlatform","initial","proxies","_detectPlatform","Element","final","autoSkip","tickOpts","determinedMaxTicks","determineMaxTicks","ticksLimit","majorIndices","getMajorIndices","numMajorIndices","newTicks","skipMajors","calculateSpacing","avgMajorSpacing","skip","offset","tickLength","maxScale","maxChart","evenMajorSpacing","getEvenSpacing","factors","majorStart","majorEnd","reverseAlign","offsetFromEdge","getTicksLimit","ticksLength","maxTicksLimit","sample","numItems","increment","getPixelForGridLine","offsetGridLines","validIndex","lineValue","garbageCollect","caches","getTickMarkLength","getTitleHeight","createScaleContext","createTickContext","tick","titleAlign","titleArgs","titleX","titleY","positionAxisID","Scale","_userMin","_userMax","_suggestedMin","_suggestedMax","metas","sampleSize","samplingEnabled","reversePixels","numTicks","minRotation","maxRotation","labelRotation","tickWidth","maxLabelDiagonal","labelSizes","maxLabelWidth","maxLabelHeight","titleOpts","gridOpts","display","isHorizontal","titleHeight","widest","highest","tickPadding","angleRadians","cos","sin","labelHeight","labelWidth","isRotated","labelsBelowTicks","offsetLeft","offsetRight","paddingLeft","paddingRight","paddingTop","paddingBottom","widths","heights","widestLabelSize","highestLabelSize","tickFont","fontString","lineHeight","nestedLabel","valueAt","idx","decimal","optionTicks","rot","grid","tl","borderOpts","axisWidth","axisHalfWidth","alignBorderValue","borderValue","alignedLineValue","tx1","ty1","tx2","ty2","x1","y1","x2","y2","limit","optsAtIndex","optsAtIndexBorder","lineWidth","lineColor","borderDash","borderDashOffset","tickColor","tickBorderDash","tickBorderDashOffset","crossAlign","mirror","tickAndPadding","hTickAndPadding","lineCount","textOffset","textBaseline","halfCount","strokeColor","strokeWidth","tickTextAlign","backdrop","labelPadding","drawLine","lastLineWidth","renderTextOptions","tz","gz","bz","TypedRegistry","override","parentScope","isIChartComponent","registerDefaults","itemDefaults","routeDefaults","routes","propertyParts","sourceName","sourceScope","Registry","typedRegistry","arg","reg","itemReg","component","camelMethod","PluginService","hook","filter","descriptor","plugin","all","plugins","allPlugins","createDescriptors","previousDescriptors","localIds","getOpts","pluginOpts","getIndexAxis","datasetDefaults","getAxisFromDefaultScaleID","getDefaultScaleIDFromAxis","idMatchesAxis","axisFromPosition","determineAxis","scaleOptions","getAxisFromDataset","retrieveAxisFromDatasets","boundDs","mergeScaleConfig","chartDefaults","configScales","chartIndexAxis","scaleConf","defaultId","defaultScaleOptions","defaultID","initOptions","initData","initConfig","keyCache","keysCached","cachedKeys","generate","addIfFound","Config","datasetType","mainScope","resetCache","_scopeCache","keyLists","subPrefixes","getResolver","needContext","subResolver","resolverCache","hasFunction","isScriptable","scriptable","indexable","version","KNOWN_POSITIONS","positionIsHorizontal","compare2Level","l1","l2","onAnimationsComplete","onAnimationProgress","getCanvas","instances","getChart","moveNumericKeys","intKey","determineLastEvent","lastEvent","inChartArea","isClick","Chart","invalidatePlugins","userConfig","initialCanvas","existingChart","maintainAspectRatio","_aspectRatio","newSize","newRatio","scalesOptions","axisOptions","scaleOpts","updated","isRadial","scaleType","scaleClass","hasUpdated","datasets","newControllers","ControllerClass","datasetElementType","dataElementType","animsDisabled","_active","_lastEvent","existingEvents","newEvents","_hiddenIndices","changes","_dataChanges","datasetCount","makeSet","changeSet","noArea","layers","visible","platform","_add","_remove","detached","attached","activeElements","lastActive","pluginId","replay","hoverOptions","deactivated","activated","eventFilter","clipSelf","borderWidth","borderJoinStyle","outerAngleClip","innerAngleClip","clipWidth","clipArc","pixelMargin","angleMargin","toRadiusCorners","parseBorderRadius$1","angleDelta","halfThickness","innerLimit","computeOuterLimit","outerArcLimit","rThetaToXY","theta","pathArc","circular","innerR","spacingOffset","noSpacingInnerRadius","noSpacingOuterRadius","avNogSpacingRadius","adjustedAngle","beta","angleOffset","outerStart","outerEnd","innerStart","innerEnd","outerStartAdjustedRadius","outerEndAdjustedRadius","outerStartAdjustedAngle","outerEndAdjustedAngle","innerStartAdjustedRadius","innerEndAdjustedRadius","innerStartAdjustedAngle","innerEndAdjustedAngle","outerMidAdjustedAngle","pCenter","p4","innerMidAdjustedAngle","p8","outerStartX","outerStartY","outerEndX","outerEndY","drawArc","fullCircles","drawBorder","inner","ArcElement","chartX","chartY","rAdjust","_circumference","nonZeroBetween","betweenAngles","withinRadius","halfAngle","halfRadius","fix","radiusOffset","setStyle","lineTo","getLineMethod","pathVars","paramsStart","paramsEnd","segmentStart","segmentEnd","outside","pathSegment","lineMethod","fastPathSegment","avgX","countX","prevX","lastY","pointIndex","drawX","truncX","_getSegmentMethod","_getInterpolationMethod","strokePathWithCache","strokePathDirect","segmentMethod","usePath2D","LineElement","_interpolate","interpolated","inRange$1","PointElement","mouseX","mouseY","getBarBounds","bar","half","skipOrLimit","parseBorderWidth","maxW","maxH","parseBorderRadius","enableBorderRadius","maxR","enableBorder","boundingRects","skipX","skipY","hasRadius","addNormalRectPath","inflateRect","amount","refRect","BarElement","borderColor","outer","addRectPath","BORDER_COLORS","BACKGROUND_COLORS","getBorderColor","getBackgroundColor","colorizeDefaultDataset","colorizeDoughnutDataset","colorizePolarAreaDataset","getColorizer","containsColorsDefinitions","containsColorsDefinition","containsDefaultColorsDefenitions","plugin_colors","_args","chartOptions","containsColorDefenition","colorizer","lttbDecimation","samples","decimated","bucketWidth","sampledIndex","endIndex","maxAreaPoint","maxArea","nextA","avgY","avgRangeStart","avgRangeEnd","avgRangeLength","rangeOffs","rangeTo","pointAx","pointAy","minMaxDecimation","minIndex","maxIndex","startIndex","xMin","dx","lastIndex","intermediateIndex1","intermediateIndex2","cleanDecimatedDataset","cleanDecimatedData","getStartAndCountOfVisiblePointsSimplified","plugin_decimation","xAxis","threshold","_segments","tpoints","_findSegmentEnd","_getBounds","targetSegments","tgt","subBounds","fillSources","fillSource","_getEdge","_pointsFromSegments","boundary","linePoints","_createBoundaryLine","_loop","_shouldApplyFill","_resolveTarget","propagate","visited","_decodeFill","parseFillOption","decodeTargetIndex","firstCh","_getTargetPixel","_getTargetValue","fillOption","_buildStackLine","sourcePoints","linesBelow","getLinesBelow","addPointsBelow","below","sourcePoint","postponed","findPoint","pointValue","firstValue","lastValue","simpleArc","_getTarget","getLineByIndex","computeBoundary","computeCircularBoundary","computeLinearBoundary","_drawfill","lineOpts","above","doFill","fillColor","clipVertical","clipHorizontal","clipY","lineLoop","clipX","src","notShape","clipBounds","interpolatedLineTo","targetLoop","interpolatedPoint","getBoxSize","labelOpts","boxHeight","boxWidth","itemsEqual","Legend","legendItems","labelFont","itemHeight","hitboxes","lineWidths","totalHeight","_itemHeight","columnSizes","heightLimit","totalWidth","currentColWidth","currentColHeight","col","calculateItemSize","rtlHelper","hitbox","defaultColor","halfFontSize","cursor","drawLegendBox","drawOptions","yBoxTop","xBoxLeft","fillText","realX","fontLineHeight","calculateLegendItemHeight","titleFont","titlePadding","topPaddingPlusHalfFontSize","hitBox","lh","isListened","hoveredItem","sameItem","calculateItemWidth","calculateItemHeight","legendItemText","plugin_legend","ci","usePointStyle","Title","textSize","fontOpts","createTitle","plugin_title","titleBlock","plugin_subtitle","positioners","xSet","eventPosition","nearestElement","tp","pushOrConcat","toPush","splitNewlines","createTooltipItem","getTooltipSize","tooltip","bodyFont","footerFont","titleLineCount","footerLineCount","bodyLineItemCount","combinedBodyLength","bodyItem","bodyLineHeight","widthPadding","maxLineWidth","determineYAlign","doesNotFitWithAlign","xAlign","caret","determineXAlign","yAlign","chartWidth","determineAlignment","alignX","alignY","paddingAndSize","getBackgroundPoint","alignment","caretSize","caretPadding","topLeft","topRight","bottomLeft","bottomRight","getAlignedX","getBeforeAfterBodyLines","createTooltipContext","tooltipItems","overrideCallbacks","defaultCallbacks","labelCount","tooltipItem","invokeCallbackWithFallback","Tooltip","beforeTitle","afterTitle","bodyItems","scoped","beforeFooter","afterFooter","labelColors","labelPointStyles","labelTextColors","positionAndSize","backgroundPoint","tooltipPoint","caretPosition","ptX","ptY","x3","y3","titleSpacing","labelColor","labelPointStyle","colorX","rtlColorX","yOffSet","colorY","outerX","innerX","bodySpacing","bodyAlign","displayColors","xLinePadding","fillLineOfText","bodyAlignForCalculation","textColor","tooltipSize","animX","animY","opacity","hasTooltipContent","positionChanged","caretX","caretY","plugin_tooltip","addIfString","addedLabels","findOrAddLabel","_getLabelForValue","CategoryScale","added","generateTicks$1","generationOptions","dataRange","precision","maxTicks","maxDigits","includeBounds","maxSpaces","rmin","rmax","countDefined","minSpacing","niceMin","niceMax","numSpaces","decimalPlaces","relativeLabelSize","LinearScaleBase","setMin","setMax","minSign","maxSign","stepSize","numericGeneratorOptions","LinearScale","log10Floor","changeExponent","isMajor","tickVal","rangeExp","rangeStep","startExp","generateTicks","minExp","exp","significand","lastTick","LogarithmicScale","getTickBackdropHeight","measureLabelSize","determineLimits","fitWithPointLabels","limits","valueCount","pointLabelOpts","additionalAngle","plFont","hLimits","vLimits","updateLimits","buildPointLabelItems","createPointLabelItem","itemOpts","outerDistance","extra","pointLabelPosition","yForAngle","getTextAlignForAngle","leftForTextAlign","isNotOverlapped","centerPointLabels","drawPointLabelBox","backdropColor","backdropLeft","backdropTop","backdropWidth","backdropHeight","drawPointLabels","pointLabels","pathRadiusLine","drawRadiusLine","gridLineOpts","createPointLabelContext","RadialLinearScale","leftMovement","rightMovement","topMovement","bottomMovement","angleMultiplier","scalingFactor","scaledDistance","pointLabel","distanceFromCenter","angleLines","INTERVALS","UNITS","sorter","parse","adapter","parser","isoWeekday","determineUnitForAutoTicks","minUnit","capacity","determineUnitForFormatting","determineMajorUnit","addTick","timestamps","setMajorTicks","majorUnit","major","ticksFromTimestamps","TimeScale","_applyBounds","timeOpts","minor","weekday","hasWeekday","format","formats","fmt","minorFormat","majorFormat","offsets","ticksOpts","tickLabelWidth","cosRotation","sinRotation","tickFontSize","exampleTime","displayFormats","exampleLabel","prevSource","nextSource","prevTarget","nextTarget","span","TimeSeriesScale","registerables","renderPowerCurveComparison","canvasId","workoutCurve","allTime","season","workoutDurations","allTimeDurations","seasonDurations","allDurations","workoutData","allTimeData","seasonData","formatDurationLabel","GoalsStore","goal","newGoal","getWorkoutHistory","periodLabel","filteredWorkouts","formattedCurrent","formattedTarget","goalsStore","initialized","initGoalsView","showAddGoalModal","refreshGoalsView","goals","progressPromises","results","statusColor","statusText","updateHint","typeEl","hint","titleEl","periodEl","period","pcChart","initPrView","refreshPrView","renderPrCards","renderPowerCurve","allTimeContainer","seasonContainer","generatePrGridHtml","curve","durations","record","currentPage","totalPages","filterStartDate","filterEndDate","calendarDate","initHistoryLogic","prevBtn","nextBtn","refreshBtn","typeFilter","dateStart","dateEnd","viewListBtn","viewCalendarBtn","viewAnalyticsBtn","viewGoalsBtn","listView","calendarView","analyticsView","goalsView","prevMonthBtn","nextMonthBtn","initHistoryButton","setView","viewPrBtn","prView","loadWorkouts","loadCalendar","loadAnalytics","handleFilterChange","historyButton","hasIndexedDB","storedToWorkout","listContainer","pageInfo","getCompletedWorkouts","renderWorkoutCard","viewWorkoutDetails","confirmDeleteWorkout","statusClass","detailPanel","listPanel","getCompletedWorkout","renderWorkoutDetail","renderZoneChart","renderWorkoutCharts","exportWorkoutData","startCropTool","renderLapsTable","jsonData","jsonUrl","jsonLink","deleteCompletedWorkout","calendarGrid","monthLabel","monthNames","month","allStored","startTimeMs","endTimeMs","scheduled","renderCalendar","renderMonthlyStats","firstDay","daysInMonth","empty","dayCell","dayWorkouts","wDate","dayScheduled","isPast","dot","isSkipped","durStr","today","totalWorkouts","totalEnergy","prList","ftpHistory","ftpHistoryStore","renderAnalytics","renderPersonalRecords","renderTrainingLoad","renderFitnessTrend","renderFtpHistory","renderPrHistory","maxPower","maxHr","longestRide","createRow","weekNum","getWeekNumber","maxLoad","load","bests","pad","maxWatts","tssMap","kCTL","kATL","ctl","atl","tss","chartW","chartH","maxVal","timeSpan","ctlPath","atlPath","history","maxFtp","minFtp","ftpRange","currX","prevY","currY","powerCurveBests","notable","reversedEvents","refreshHistoryView","formatZoneTime","activeZones","totalPercent","telemetryJson","startTimeIso","startTs","powerContainer","hrContainer","cadContainer","altContainer","validPoints","originalStart","originalEnd","currentStart","currentEnd","sliderStart","sliderEnd","displayStart","displayEnd","displayDuration","chartContainer","renderPreview","updateUI","startOffset","endOffset","IntervalsService","formData","athleteId","auth","response","defaultSettings","STRAVA_UPLOAD_URL","StravaService","filePrefix","stravaService","initMetricsToggle","toggleYour","yourMetricsSection","toggleStream","streamMetricsSection","initDiscardButton","discardButton","resetWorkoutState","totalDataPoints","restoreWorkoutUI","initExportButton","exportDataElem","settingsJson","getWorkoutMetadata","isDownload","collectedMetadata","clearWorkoutMetadata","initWorkoutSummaryModal","workoutMetadataModal","archiveWorkout","initMenuInteractions","menu","controls","getFocusableItems","handleKeyDown","focusableItems","currentIndex","closeMenu","openMenu","handleClickOutside","handleToggle","handleSummaryKeyDown","handleMenuItemClick","checkbox","initMenu","ZoneState","newPowerZones","newHrZones","zoneIndex","currentZone","percentInZone","totalTimeMs","CHART_CONFIG","LiveChart","zones","gradient","stops","topZone","boundaryVal","bottomZone","stop","cutoffTime","maxChanged","animate","visibleData","noDataMsg","areaPoints","linePath","firstX","lastX","areaPath","DATA_TIMEOUT_MS","UPDATE_INTERVAL_MS","initLiveCharts","chartsContainer","metricsSection","dataFieldsCarousel","initChartsToggle","chartsVisible","toggleBtn","topBarControls","workoutControls","initMetricsDisplay","updateChartZones","chartsToggle","lastPowerIndex","lastHrIndex","lastPowerZone","lastHrZone","updateLiveCharts","updateZoneTracking","latest","zoneInfo","API_BASE_URL","API_KEY","getHeaders","extraHeaders","headers","createStream","streamName","listStreams","addMessage","author","createFetchSSE","onMessage","onConnected","onError","isActive","connection","reader","decoder","done","messages","dataMatch","parseError","listenToStream","listenToAllStreams","sendWorkoutData","StreamViewer","toggleViewBtn","viewAllBtn","streamsList","streams","stream","streamItem","div","streamTitle","statusEl","reactionPanel","allStreamsStatus","messageData","powerEl","cadenceEl","hrEl","messageStr","lastUpdateEl","heartrateEl","speedEl","distanceEl","altitudeEl","elapsedEl","streamLastUpdate","initStreamViewer","viewer","viewStreamsBtn","ReactionListener","initStreamingControls","streamManager","reactionListener","reactionDisplay","setupReactions","cleanupReactions","startStreamButton","confirmBtn","nameInput","toolbar","toolbarStreamName","playPauseBtn","stopBtn","streamIndicator","updateToolbar","startStreaming","customName","stopStreaming","handleWorkoutPause","currentSteps","initWorkoutBuilder","createBtn","saveBtn","addStepBtn","openBuilder","closeBuilder","saveWorkout","addStepFromForm","targetTypeSelect","valInput","selectionModal","resetForm","renderSteps","targetValStr","nameStr","targetTypeStr","targetValue","capitalize","desc","DARK_MODE_KEY","getStoredThemePreference","saveThemePreference","preference","systemPrefersDark","applyTheme","theme","getEffectiveTheme","initDarkMode","effectiveTheme","systemDark","setupDarkModeToggle","toggleElement","isDark","newTheme","newPreference","onboardingSteps","createOnboardingModal","renderProgressDots","currentStep","totalSteps","renderStep","stepIndex","inputContainer","inputField","inputLabel","inputUnit","helpText","progressDots","showOnboarding","forceShow","saveCurrentInput","render","goNext","goPrev","shouldShowOnboarding","initOnboarding","formatElapsedTime","createRecoveryModal","elapsedTime","addRecoveryStyles","showRecoveryModal","restoreBtn","discardBtn","cleanup","initWorkoutRecovery","connectionManager","hasRecoverableWorkout","loadActiveWorkout","deferredPrompt","initInstallPrompt","updateInstallButtonVisibility","canInstallPwa","triggerInstallPrompt","outcome","installButton","installButtonContainer","handleWakeLock","wakeLock","requestWakeLock","registerSW","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","Workbox","registerServiceWorker","registrations","registration","updateSW","showUpdateNotification","updateContainer","MapComponent","elementId","L","hasData","initialLat","initialLon","initialZoom","gpsData","latLng","initMap","mapContainerId","toggleBtnId","carouselId","mapContainer","carousel","mapComponent","isMapVisible","hasGpsData","AutoPauseService","minTimestamp","recentMeasurements","isAboveThreshold","timeBelow","delayMs","getAutoPauseSourceUnit","calculateTotalDistanceMeters","AutoLapService","lapSpeed","autoLapService","MediaSessionManager","mediaSessionManager","isImperial","DEFAULT_POWER_ZONES","DEFAULT_HR_ZONES","DATA_FIELD_REGISTRY","registrationOrder","registerDataField","getDataField","getAllDataFields","getFieldsByCategory","category","getAllCategories","categories","searchFields","query","lowerQuery","DEFAULT_UPDATE_INTERVALS","CalculationManager","workoutState","frequency","timerId","fieldId","fieldIds","allFields","frequencies","createCalculationManager","slotCounter","slot","resetSlotCounter","createCyclingMainScreen","createCyclingPowerScreen","createCyclingHrScreen","createCyclingClimbScreen","createCyclingLapScreen","createCyclingSimpleScreen","createIndoorMainScreen","createIndoorPowerScreen","createIndoorTrainingScreen","createIndoorZonesScreen","createRunningMainScreen","createRunningPaceScreen","DEFAULT_CYCLING_PROFILE","DEFAULT_INDOOR_PROFILE","DEFAULT_RUNNING_PROFILE","DEFAULT_SIMPLE_PROFILE","DEFAULT_PROFILES","DEFAULT_DATA_FIELD_SETTINGS","createDefaultIndoorProfile","createDefaultSettings","migrateFromLegacySettings","legacySettings","slots","publishFieldValue","fieldListeners","subscribeToFieldValue","SENSOR_FIELD_MAP","DataFieldsManager","screen","connections","powerConnected","hrConnected","cadenceConnected","gpsConnected","lapCount","lapStartTime","createDataFieldsManager","LEGACY_SETTINGS_KEY","SCHEMA_VERSION","loadDataFieldSettings","migrated","migrateStoredSettings","validateSettings","saveDataFieldSettings","legacyStored","legacy","loadActiveProfile","saveProfile","saveActiveScreenIndex","profileId","screenIndex","validateProfile","storageCallbacks","initUi","dataFieldsManager","activeProfile","customEvent","darkModeToggle","autoPauseService","recovered","BackgroundGeolocation","createNativeGpsService","watcherId","location","createWebGpsService","watchId","GpsFactory","connectGps","service","getElement","sensorLabels","sensorIcons","parseBluetoothError","sensorType","sensorLabel","errorMessage","errorName","createErrorContent","errorInfo","messageEl","troubleshootingEl","listEl","suggestion","itemEl","showConnectionError","onRetry","sensorIcon","showReconnectionFailed","tipsEl","tip","emojis","getSensorLabel","CONNECTION_TIMEOUT_MS","connectionTimeouts","initConnectionButtons","connectSensorBtn","sensorModal","closeSensorModalBtn","updateConnectedCount","countElem","disconnectAllBtn","supportedTypes","clearConnectionTimeout","existingTimeout","startConnectionTimeout","timeoutId","connectElem","updateButtonText","deviceName","statusSpan","deviceNameSpan","lastDeviceName","connectionStorage","emoji","disconnectFn","connectionState","displayElem","disconnectAll","connectedTypes","handleStatusChange","connectSensor","deviceId","gpsConnection","BluetoothFactory","disconnect","onStatusChange","reconnectStored","ids","queueConnect","StreamManager","safeName","incline","initHardware","LiveChart$1","Toast$1","initApp"],"ignoreList":[21,54,55,56,57],"sources":["../../src/components/lazyLoader.ts","../../src/monitoring/performance.ts","../../src/state/EventBus.ts","../../src/types/personal-records.ts","../../src/calculations/MeanMaximalPower.ts","../../src/state/PersonalRecordsStore.ts","../../src/components/base/BaseComponent.ts","../../src/components/Toast.ts","../../src/ui/notifications.ts","../../src/ui/accessibility.ts","../../src/ui/shareWithImage.ts","../../src/styles/zone-colors.ts","../../src/ui/modal.ts","../../src/services/PersonalRecordsManager.ts","../../src/config/constants.ts","../../src/state/calculators/DistanceCalculator.ts","../../src/calculations/calories.ts","../../src/data-fields/AdaptiveUpdater.ts","../../src/measurements-state.ts","../../src/state/StateProvider.ts","../../src/exposeVariablesDuringTest.ts","../../../../node_modules/.pnpm/@capacitor+app@8.0.0_@capacitor+core@8.0.0/node_modules/@capacitor/app/dist/esm/index.js","../../src/router/Router.ts","../../src/views/DashboardView.ts","../../src/router/view-ids.ts","../../src/components/NavBar.ts","../../src/utils/dom.ts","../../src/init/router.ts","../../src/getTimestring.ts","../../src/workouts/workoutLibrary.ts","../../src/storage/userSettings.ts","../../src/ui/audio.ts","../../src/workouts/WorkoutRunner.ts","../../src/utils/formatters.ts","../../src/config/sport.ts","../../src/services/WorkerTimer.ts","../../src/services/VoiceFeedback.ts","../../src/storage/customWorkouts.ts","../../src/workouts/parsers/ergMrcParser.ts","../../src/ui/workoutPlayer.ts","../../src/ui/countdown.ts","../../src/create-csv.ts","../../src/create-fit.ts","../../src/ui/time.ts","../../src/ui/workoutMetadataModal.ts","../../src/ui/undoNotification.ts","../../src/ui/lap.ts","../../src/ui/analyticsHelper.ts","../../src/ui/charts.ts","../../src/ui/statistics.ts","../../src/utils/cropWorkout.ts","../../src/plans/library/ftpBuilder.ts","../../src/plans/planRepository.ts","../../src/storage/scheduledWorkoutStorage.ts","../../../../node_modules/.pnpm/@kurkle+color@0.3.4/node_modules/@kurkle/color/dist/color.esm.js","../../../../node_modules/.pnpm/chart.js@4.5.1/node_modules/chart.js/dist/chunks/helpers.dataset.js","../../../../node_modules/.pnpm/chart.js@4.5.1/node_modules/chart.js/dist/chart.js","../../../../node_modules/.pnpm/chart.js@4.5.1/node_modules/chart.js/auto/auto.js","../../src/ui/powerCurveChart.ts","../../src/state/GoalsStore.ts","../../src/ui/goalsView.ts","../../src/ui/prView.ts","../../src/ui/workoutHistory.ts","../../src/services/IntervalsService.ts","../../src/types/settings.ts","../../src/integrations/strava.ts","../../src/ui/menu.ts","../../src/ui/menuInteractions.ts","../../src/zone-state.ts","../../src/components/LiveChart.ts","../../src/initMetricsDisplay.ts","../../src/api/streamClient.ts","../../src/ui/streamViewer.ts","../../src/services/ReactionListener.ts","../../src/initStreamingControls.ts","../../src/ui/workoutBuilder.ts","../../src/ui/darkMode.ts","../../src/ui/onboarding.ts","../../src/ui/workoutRecovery.ts","../../src/ui/installPrompt.ts","../../src/ui/wakeLock.ts","../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../src/ui/serviceWorker.ts","../../src/ui/map-component.ts","../../src/init/map.ts","../../src/services/AutoPauseService.ts","../../src/services/AutoLapService.ts","../../src/services/MediaSessionManager.ts","../../src/data-fields/types.ts","../../src/data-fields/registry.ts","../../src/data-fields/CalculationManager.ts","../../src/data-fields/defaults.ts","../../src/data-fields/live-values.ts","../../src/data-fields/DataFieldsManager.ts","../../src/data-fields/persistence.ts","../../src/init/ui.ts","../../src/services/gps/native-gps.ts","../../src/services/gps/web-gps.ts","../../src/services/gps/factory.ts","../../src/connect-gps.ts","../../src/elements.ts","../../src/ui/connectionError.ts","../../src/initConnectionButtons.ts","../../src/stream-manager.ts","../../src/init/hardware.ts","../../src/main.ts"],"sourcesContent":["/**\n * Component Lazy Loader\n *\n * Facilitates lazy loading of Web Components when they appear in the DOM.\n * This avoids loading unused components and reduces initial bundle size.\n */\n\ntype ComponentLoader = () => Promise<unknown>;\n\nconst registry = new Map<string, ComponentLoader>();\nconst loaded = new Set<string>();\nlet observer: MutationObserver | null = null;\n\n/**\n * Register a component to be lazy loaded when it appears in the DOM.\n *\n * @param tagName - The custom element tag name (e.g., 'bpt-profile-settings')\n * @param loader - Function that imports the component module\n */\nexport function registerLazyComponent(tagName: string, loader: ComponentLoader): void {\n    const upperTag = tagName.toUpperCase();\n\n    if (customElements.get(tagName)) {\n        console.warn(`Component ${tagName} is already defined.`);\n        return;\n    }\n\n    registry.set(upperTag, loader);\n\n    // Start observer if not running\n    if (!observer) {\n        startObserver();\n    }\n\n    // Check if component is already in the DOM\n    checkForComponent(upperTag);\n}\n\nfunction startObserver() {\n    observer = new MutationObserver((mutations) => {\n        // Optimization: check if any nodes were actually added\n        let nodesAdded = false;\n        for (const m of mutations) {\n            if (m.addedNodes.length > 0) {\n                nodesAdded = true;\n                break;\n            }\n        }\n\n        if (nodesAdded) {\n            checkAllPending();\n        }\n    });\n\n    observer.observe(document.body, { childList: true, subtree: true });\n}\n\nfunction checkAllPending() {\n    for (const tagName of registry.keys()) {\n        if (!loaded.has(tagName)) {\n            checkForComponent(tagName);\n        }\n    }\n}\n\nfunction checkForComponent(tagName: string) {\n    // If we find the element in the DOM, trigger load\n    if (document.querySelector(tagName)) {\n        loadComponent(tagName);\n    }\n}\n\nasync function loadComponent(tagName: string) {\n    if (loaded.has(tagName)) return;\n    loaded.add(tagName);\n\n    const loader = registry.get(tagName);\n    if (!loader) return;\n\n    try {\n        await loader();\n        // The component module should call customElements.define()\n    } catch (error) {\n        console.error(`Failed to lazy load component ${tagName}:`, error);\n        loaded.delete(tagName); // Allow retry?\n    }\n}\n","interface PerformanceMetric {\n    name: string;\n    value: number;\n    timestamp: number;\n}\n\ninterface LayoutShiftEntry extends PerformanceEntry {\n    value: number;\n    hadRecentInput: boolean;\n}\n\ninterface PerformanceEventTiming extends PerformanceEntry {\n    processingStart: number;\n}\n\nclass PerformanceMonitor {\n    private metrics: PerformanceMetric[] = [];\n    private marks: Map<string, number> = new Map();\n\n    constructor() {\n        if (typeof window !== 'undefined' && 'PerformanceObserver' in window) {\n            this.observeWebVitals();\n            this.observeLongTasks();\n        }\n    }\n\n    private observeWebVitals(): void {\n        try {\n            // First Contentful Paint\n            new PerformanceObserver((list) => {\n                for (const entry of list.getEntries()) {\n                    if (entry.name === 'first-contentful-paint') {\n                        this.record('FCP', entry.startTime);\n                    }\n                }\n            }).observe({ entryTypes: ['paint'] });\n\n            // Largest Contentful Paint\n            new PerformanceObserver((list) => {\n                const entries = list.getEntries();\n                const lastEntry = entries[entries.length - 1];\n                this.record('LCP', lastEntry.startTime);\n            }).observe({ entryTypes: ['largest-contentful-paint'] });\n\n            // First Input Delay (via event timing)\n            new PerformanceObserver((list) => {\n                for (const entry of list.getEntries() as PerformanceEventTiming[]) {\n                    if (entry.processingStart) {\n                        const fid = entry.processingStart - entry.startTime;\n                        this.record('FID', fid);\n                    }\n                }\n            }).observe({ entryTypes: ['first-input'] });\n\n            // Cumulative Layout Shift\n            let clsValue = 0;\n            new PerformanceObserver((list) => {\n                for (const entry of list.getEntries() as LayoutShiftEntry[]) {\n                    if (!entry.hadRecentInput) {\n                        clsValue += entry.value;\n                        this.record('CLS', clsValue);\n                    }\n                }\n            }).observe({ entryTypes: ['layout-shift'] });\n        } catch (e) {\n            console.warn('PerformanceObserver not supported or failed to start', e);\n        }\n    }\n\n    private observeLongTasks(): void {\n        try {\n            new PerformanceObserver((list) => {\n                for (const entry of list.getEntries()) {\n                    if (entry.duration > 50) {\n                        this.record('LongTask', entry.duration);\n                    }\n                }\n            }).observe({ entryTypes: ['longtask'] });\n        } catch (e) {\n            // Quietly fail for longtask as it might not be supported\n        }\n    }\n\n    mark(name: string): void {\n        if (typeof performance === 'undefined') return;\n        this.marks.set(name, performance.now());\n    }\n\n    measure(name: string, startMark: string): number {\n        if (typeof performance === 'undefined') return 0;\n\n        const start = this.marks.get(startMark);\n        if (start === undefined) {\n            return 0;\n        }\n\n        const duration = performance.now() - start;\n        this.record(name, duration);\n        return duration;\n    }\n\n    record(name: string, value: number): void {\n        this.metrics.push({\n            name,\n            value,\n            timestamp: Date.now(),\n        });\n\n        // Log significant metrics in development\n        if (import.meta.env.DEV && value > 100) {\n            console.log(`[Perf] ${name}: ${value.toFixed(2)}ms`);\n        }\n    }\n\n    getMetrics(): PerformanceMetric[] {\n        return [...this.metrics];\n    }\n\n    getSummary(): Record<string, { avg: number; max: number; count: number }> {\n        const summary: Record<string, { total: number; max: number; count: number }> = {};\n\n        for (const metric of this.metrics) {\n            if (!summary[metric.name]) {\n                summary[metric.name] = { total: 0, max: 0, count: 0 };\n            }\n            summary[metric.name].total += metric.value;\n            summary[metric.name].max = Math.max(summary[metric.name].max, metric.value);\n            summary[metric.name].count++;\n        }\n\n        return Object.fromEntries(\n            Object.entries(summary).map(([name, data]) => [\n                name,\n                {\n                    avg: data.total / data.count,\n                    max: data.max,\n                    count: data.count,\n                },\n            ])\n        );\n    }\n}\n\nexport const performanceMonitor = new PerformanceMonitor();\n\n// Expose in development\nif (typeof window !== 'undefined' && import.meta.env.DEV) {\n    (window as any).__perfMonitor = performanceMonitor;\n}\n","export type EventHandler<T = unknown> = (data: T) => void;\n\ninterface EventMap {\n    'power:update': { timestamp: number; value: number; cadence?: number };\n    'heartrate:update': { timestamp: number; value: number };\n    'cadence:update': { timestamp: number; value: number };\n    'speed:update': { timestamp: number; value: number };\n    'gps:update': { timestamp: number; latitude: number; longitude: number; altitude?: number };\n    'distance:update': { timestamp: number; value: number };\n    'sensor:connected': { type: string; name: string };\n    'sensor:disconnected': { type: string; name: string };\n    'workout:start': { timestamp: number };\n    'workout:pause': { timestamp: number };\n    'workout:resume': { timestamp: number };\n    'workout:stop': { timestamp: number };\n    'lap:complete': { number: number; duration: number };\n    'settings:change': { key: string; value: unknown };\n}\n\nclass StateEventBus {\n    private handlers: Map<string, Set<EventHandler>> = new Map();\n\n    on<K extends keyof EventMap>(event: K, handler: EventHandler<EventMap[K]>): () => void {\n        if (!this.handlers.has(event)) {\n            this.handlers.set(event, new Set());\n        }\n\n        this.handlers.get(event)!.add(handler as EventHandler);\n\n        return () => {\n            this.handlers.get(event)?.delete(handler as EventHandler);\n        };\n    }\n\n    emit<K extends keyof EventMap>(event: K, data: EventMap[K]): void {\n        const handlers = this.handlers.get(event);\n        if (!handlers) return;\n\n        for (const handler of handlers) {\n            try {\n                handler(data);\n            } catch (error) {\n                console.error(`Event handler error for ${event}:`, error);\n            }\n        }\n    }\n\n    off<K extends keyof EventMap>(event: K, handler: EventHandler<EventMap[K]>): void {\n        this.handlers.get(event)?.delete(handler as EventHandler);\n    }\n\n    clear(): void {\n        this.handlers.clear();\n    }\n}\n\nexport const stateEventBus = new StateEventBus();\n","/**\n * Personal Records and Power Curve Types\n */\n\n/**\n * Represents a single personal record entry\n */\nexport interface PersonalRecord {\n    /** Power value in Watts */\n    value: number;\n    /** Date when the record was achieved (timestamp) */\n    date: number;\n    /** Optional identifier for the workout */\n    workoutId?: string;\n}\n\n/**\n * A collection of personal records indexed by duration (in seconds)\n */\nexport type PowerCurve = Record<number, PersonalRecord>;\n\n/**\n * Standard durations to track for power curve (in seconds)\n */\nexport const TRACKED_DURATIONS = [\n    1, // 1 sec - Instantaneous\n    5, // 5 sec - Sprint\n    15, // 15 sec\n    30, // 30 sec\n    60, // 1 min - Anaerobic\n    120, // 2 min\n    300, // 5 min - VO2 Max\n    600, // 10 min\n    1200, // 20 min - FTP Proxy\n    3600, // 60 min - FTP\n    // 7200    // 2 hours ? Maybe too long for typical usage\n] as const;\n\nexport type TrackedDuration = (typeof TRACKED_DURATIONS)[number];\n","import { TRACKED_DURATIONS } from '../types/personal-records.js';\n\n/**\n * Calculates Mean Maximal Power for various durations in real-time.\n * Maintains rolling averages efficiently using a circular buffer.\n */\nexport class MeanMaximalPowerCalculator {\n    private buffer: Float32Array;\n    private maxDuration: number;\n    private head: number = 0;\n    private totalSamples: number = 0;\n    private currentSums: Record<number, number> = {};\n    private currentMax: Record<number, number> = {};\n\n    constructor() {\n        this.maxDuration = Math.max(...TRACKED_DURATIONS);\n        // +1 safety buffer although strict modulo math should work fine\n        this.buffer = new Float32Array(this.maxDuration);\n\n        for (const d of TRACKED_DURATIONS) {\n            this.currentSums[d] = 0;\n            this.currentMax[d] = 0;\n        }\n    }\n\n    /**\n     * Add a new power sample (expected to be 1-second intervals)\n     * @param watts Power value in Watts\n     * @returns A map of updated max values if any record was broken in this step, or null\n     */\n    public addSample(watts: number): Record<number, number> | null {\n        // Filter invalid\n        const val = Math.max(0, isNaN(watts) ? 0 : watts);\n\n        let updates: Record<number, number> | null = null;\n\n        for (const duration of TRACKED_DURATIONS) {\n            // Add new value to running sum\n            this.currentSums[duration] += val;\n\n            // If window is full, subtract the element leaving the window\n            if (this.totalSamples >= duration) {\n                const indexToRemove = (this.head - duration + this.maxDuration) % this.maxDuration;\n                const valToRemove = this.buffer[indexToRemove];\n                this.currentSums[duration] -= valToRemove;\n            }\n\n            // If needed samples collected, calculate average\n            if (this.totalSamples + 1 >= duration) {\n                const avg = this.currentSums[duration] / duration;\n                if (avg > this.currentMax[duration]) {\n                    this.currentMax[duration] = avg;\n                    if (!updates) updates = {};\n                    updates[duration] = avg;\n                }\n            }\n        }\n\n        // Store current value in history buffer\n        this.buffer[this.head] = val;\n\n        // Move head forward\n        this.head = (this.head + 1) % this.maxDuration;\n        this.totalSamples++;\n\n        return updates;\n    }\n\n    public getCurrentMax(): Record<number, number> {\n        return { ...this.currentMax };\n    }\n\n    public reset(): void {\n        this.totalSamples = 0;\n        this.head = 0;\n        this.buffer.fill(0);\n        for (const d of TRACKED_DURATIONS) {\n            this.currentSums[d] = 0;\n            this.currentMax[d] = 0;\n        }\n    }\n}\n","import { openDB, type IDBPDatabase } from 'idb';\nimport type { PersonalRecord, PowerCurve } from '../types/personal-records.js';\n\nexport interface RecordsData {\n    allTime: PowerCurve;\n    /**\n     * Records by year (season)\n     */\n    byYear: Record<number, PowerCurve>;\n}\n\nconst DEFAULT_DATA: RecordsData = {\n    allTime: {},\n    byYear: {},\n};\n\nconst DB_NAME = 'bpt-records';\nconst STORE_NAME = 'personal-records';\nconst RECORD_KEY = 'user-records';\n\nexport class PersonalRecordsStore {\n    private data: RecordsData = JSON.parse(JSON.stringify(DEFAULT_DATA));\n    private dbPromise: Promise<IDBPDatabase> | null = null;\n    private listeners: ((data: RecordsData) => void)[] = [];\n    private initialized = false;\n\n    constructor() {\n        if (typeof window !== 'undefined') {\n            this.init();\n        }\n    }\n\n    private async init() {\n        try {\n            this.dbPromise = openDB(DB_NAME, 1, {\n                upgrade(db) {\n                    db.createObjectStore(STORE_NAME);\n                },\n            });\n            await this.load();\n            this.initialized = true;\n        } catch (error) {\n            console.error('Failed to initialize PersonalRecordsStore:', error);\n        }\n    }\n\n    private async load() {\n        if (!this.dbPromise) return;\n        try {\n            const db = await this.dbPromise;\n            const stored = await db.get(STORE_NAME, RECORD_KEY);\n            if (stored) {\n                this.data = stored;\n                this.notifyListeners();\n            }\n        } catch (error) {\n            console.error('Failed to load records:', error);\n        }\n    }\n\n    private async persist() {\n        if (!this.dbPromise) return;\n        try {\n            const db = await this.dbPromise;\n            await db.put(STORE_NAME, this.data, RECORD_KEY);\n        } catch (error) {\n            console.error('Failed to save records:', error);\n        }\n    }\n\n    /**\n     * Check if a value is a new record and update if so\n     * @returns { isAllTime: boolean, isSeason: boolean }\n     */\n    public async checkAndAddRecord(\n        duration: number,\n        value: number,\n        timestamp: number,\n        workoutId?: string\n    ): Promise<{ isAllTime: boolean; isSeason: boolean }> {\n        let isAllTime = false;\n        let isSeason = false;\n        const year = new Date(timestamp).getFullYear();\n\n        // Check All Time\n        const currentAllTime = this.data.allTime[duration];\n        if (!currentAllTime || value > currentAllTime.value) {\n            this.data.allTime[duration] = { value, date: timestamp, workoutId };\n            isAllTime = true;\n        }\n\n        // Check Season\n        if (!this.data.byYear[year]) {\n            this.data.byYear[year] = {};\n        }\n        const currentSeason = this.data.byYear[year][duration];\n        if (!currentSeason || value > currentSeason.value) {\n            this.data.byYear[year][duration] = { value, date: timestamp, workoutId };\n            isSeason = true;\n        }\n\n        if (isAllTime || isSeason) {\n            await this.persist();\n            this.notifyListeners();\n        }\n\n        return { isAllTime, isSeason };\n    }\n\n    public getRecord(duration: number, year?: number): PersonalRecord | undefined {\n        if (year) {\n            return this.data.byYear[year]?.[duration];\n        }\n        return this.data.allTime[duration];\n    }\n\n    public getAllTimeCurve(): PowerCurve {\n        return { ...this.data.allTime };\n    }\n\n    public getSeasonCurve(year: number = new Date().getFullYear()): PowerCurve {\n        return { ...(this.data.byYear[year] || {}) };\n    }\n\n    public subscribe(listener: (data: RecordsData) => void): () => void {\n        this.listeners.push(listener);\n        // Invoke immediately with current data\n        if (this.initialized) {\n            listener(this.data);\n        }\n        return () => {\n            const index = this.listeners.indexOf(listener);\n            if (index !== -1) {\n                this.listeners.splice(index, 1);\n            }\n        };\n    }\n\n    private notifyListeners() {\n        for (const listener of this.listeners) {\n            listener(this.data);\n        }\n    }\n}\n\nexport const personalRecordsStore = new PersonalRecordsStore();\n","/**\n * Base Component\n *\n * Abstract base class for all Web Components in the application.\n * Provides common functionality like shadow DOM, theming, and lifecycle hooks.\n *\n * @module BaseComponent\n */\n\n/**\n * Base class for all custom elements\n */\nexport abstract class BaseComponent extends HTMLElement {\n    protected shadow: ShadowRoot;\n    private _initialized = false;\n\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n    }\n\n    /**\n     * Called when the element is added to the DOM\n     */\n    connectedCallback(): void {\n        if (!this._initialized) {\n            this.render();\n            this.setupEventListeners();\n            this._initialized = true;\n        }\n        this.onConnected();\n    }\n\n    /**\n     * Called when the element is removed from the DOM\n     */\n    disconnectedCallback(): void {\n        this.onDisconnected();\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null): void {\n        if (oldValue !== newValue && this._initialized) {\n            this.onAttributeChanged(name, oldValue, newValue);\n        }\n    }\n\n    /**\n     * Get base styles that apply to all components\n     */\n    protected getBaseStyles(): string {\n        return `\n            :host {\n                display: block;\n                box-sizing: border-box;\n            }\n            \n            :host([hidden]) {\n                display: none;\n            }\n            \n            *,\n            *::before,\n            *::after {\n                box-sizing: inherit;\n            }\n            \n            /* Respect reduced motion preferences */\n            @media (prefers-reduced-motion: reduce) {\n                *,\n                *::before,\n                *::after {\n                    animation-duration: 0.01ms !important;\n                    animation-iteration-count: 1 !important;\n                    transition-duration: 0.01ms !important;\n                }\n            }\n        `;\n    }\n\n    /**\n     * Get the component's styles - override in subclasses\n     */\n    protected abstract getStyles(): string;\n\n    /**\n     * Get the component's template - override in subclasses\n     */\n    protected abstract getTemplate(): string;\n\n    /**\n     * Render the component\n     */\n    protected render(): void {\n        this.shadow.innerHTML = `\n            <style>\n                ${this.getBaseStyles()}\n                ${this.getStyles()}\n            </style>\n            ${this.getTemplate()}\n        `;\n    }\n\n    /**\n     * Set up event listeners - override in subclasses\n     */\n    protected setupEventListeners(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called after the component is connected to the DOM\n     */\n    protected onConnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when the component is disconnected from the DOM\n     */\n    protected onDisconnected(): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Called when an observed attribute changes\n     */\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Override in subclasses\n    }\n\n    /**\n     * Emit a custom event\n     */\n    protected emit<T>(eventName: string, detail?: T): void {\n        this.dispatchEvent(\n            new CustomEvent(eventName, {\n                detail,\n                bubbles: true,\n                composed: true, // Allows event to cross shadow DOM boundary\n            })\n        );\n    }\n\n    /**\n     * Query an element in the shadow DOM\n     */\n    protected query<T extends Element>(selector: string): T | null {\n        return this.shadow.querySelector<T>(selector);\n    }\n\n    /**\n     * Query all elements in the shadow DOM\n     */\n    protected queryAll<T extends Element>(selector: string): NodeListOf<T> {\n        return this.shadow.querySelectorAll<T>(selector);\n    }\n}\n","/**\n * Notification Toast Component\n *\n * A Web Component for displaying toast-style notifications.\n * Accessible, auto-dismissing, and supports different notification types.\n *\n * @example\n * ```html\n * <bpt-toast\n *   message=\"Workout saved!\"\n *   type=\"success\"\n *   duration=\"3000\">\n * </bpt-toast>\n * ```\n *\n * Or programmatically:\n * ```typescript\n * Toast.show('Workout saved!', 'success');\n * ```\n *\n * @module Toast\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\n\n/**\n * Notification type determines styling\n */\nexport type ToastType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Toast configuration options\n */\nexport interface ToastOptions {\n    message: string;\n    type?: ToastType;\n    duration?: number;\n    dismissible?: boolean;\n}\n\n/**\n * Type-specific colors (WCAG AA compliant)\n */\nconst TYPE_STYLES: Record<ToastType, { bg: string; icon: string }> = {\n    info: { bg: '#1d4ed8', icon: '' },\n    success: { bg: '#15803d', icon: '' },\n    error: { bg: '#b91c1c', icon: '' },\n    warning: { bg: '#a16207', icon: '' },\n};\n\n/**\n * Toast Notification Web Component\n */\nexport class Toast extends BaseComponent {\n    private timeoutId: number | null = null;\n\n    static get observedAttributes(): string[] {\n        return ['message', 'type', 'duration', 'dismissible'];\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                position: fixed;\n                top: 80px;\n                left: 50%;\n                transform: translateX(-50%) translateY(-20px);\n                z-index: 10001;\n                opacity: 0;\n                transition: transform 0.3s ease, opacity 0.3s ease;\n                pointer-events: none;\n            }\n\n            :host(.stacked) {\n                position: relative;\n                top: auto;\n                left: auto;\n                transform: translateX(100%); /* Start from right */\n                margin-bottom: 10px;\n                pointer-events: auto; /* Container handles layout */\n                opacity: 0;\n            }\n            \n            :host(.visible) {\n                transform: translateX(-50%) translateY(0);\n                opacity: 1;\n                pointer-events: auto;\n            }\n\n            :host(.stacked.visible) {\n                transform: translateX(0);\n                opacity: 1;\n            }\n            \n            :host(.hiding) {\n                transform: translateX(-50%) translateY(-20px);\n                opacity: 0;\n            }\n\n            :host(.stacked.hiding) {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            \n            .toast {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 12px 20px;\n                border-radius: 8px;\n                background-color: var(--toast-bg, #1d4ed8);\n                color: white;\n                font-size: 14px;\n                font-weight: 500;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n                max-width: 90vw;\n            }\n            \n            .icon {\n                font-size: 18px;\n                flex-shrink: 0;\n            }\n            \n            .message {\n                flex: 1;\n            }\n            \n            .dismiss-btn {\n                background: none;\n                border: none;\n                color: white;\n                font-size: 18px;\n                cursor: pointer;\n                padding: 0 4px;\n                opacity: 0.8;\n                transition: opacity 0.2s ease;\n                flex-shrink: 0;\n            }\n            \n            .dismiss-btn:hover {\n                opacity: 1;\n            }\n            \n            .dismiss-btn:focus-visible {\n                outline: 2px solid white;\n                outline-offset: 2px;\n            }\n            \n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                :host {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const message = this.getAttribute('message') || '';\n        const type = (this.getAttribute('type') || 'info') as ToastType;\n        const dismissible = this.getAttribute('dismissible') !== 'false';\n        const styles = TYPE_STYLES[type] || TYPE_STYLES.info;\n\n        this.style.setProperty('--toast-bg', styles.bg);\n\n        return `\n            <div class=\"toast\" role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n                <span class=\"icon\" aria-hidden=\"true\">${styles.icon}</span>\n                <span class=\"message\">${message}</span>\n                ${\n                    dismissible\n                        ? `\n                    <button class=\"dismiss-btn\" aria-label=\"Dismiss notification\">&times;</button>\n                `\n                        : ''\n                }\n            </div>\n        `;\n    }\n\n    protected setupEventListeners(): void {\n        const dismissBtn = this.query('.dismiss-btn');\n        if (dismissBtn) {\n            dismissBtn.addEventListener('click', () => this.dismiss());\n        }\n    }\n\n    protected onConnected(): void {\n        // Trigger show animation\n        requestAnimationFrame(() => {\n            requestAnimationFrame(() => {\n                this.classList.add('visible');\n            });\n        });\n\n        // Auto-dismiss after duration\n        const duration = parseInt(this.getAttribute('duration') || '3000', 10);\n        if (duration > 0) {\n            this.timeoutId = window.setTimeout(() => this.dismiss(), duration);\n        }\n    }\n\n    protected onDisconnected(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n    }\n\n    protected onAttributeChanged(_name: string, _oldValue: string | null, _newValue: string | null): void {\n        // Re-render when attributes change\n        this.render();\n        this.setupEventListeners();\n    }\n\n    /**\n     * Dismiss the toast\n     */\n    public dismiss(): void {\n        if (this.timeoutId) {\n            clearTimeout(this.timeoutId);\n        }\n\n        this.classList.remove('visible');\n        this.classList.add('hiding');\n\n        // Remove after animation\n        setTimeout(() => {\n            this.remove();\n        }, 300);\n    }\n\n    /**\n     * Static method to show a toast notification\n     */\n    static show(message: string, type: ToastType = 'info', options: Partial<ToastOptions> = {}): Toast {\n        const toast = document.createElement('bpt-toast') as Toast;\n        toast.setAttribute('message', message);\n        toast.setAttribute('type', type);\n\n        if (options.duration !== undefined) {\n            toast.setAttribute('duration', String(options.duration));\n        }\n        if (options.dismissible !== undefined) {\n            toast.setAttribute('dismissible', String(options.dismissible));\n        }\n\n        document.body.appendChild(toast);\n        return toast;\n    }\n\n    /**\n     * Convenience methods for different types\n     */\n    static info(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'info', options);\n    }\n\n    static success(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'success', options);\n    }\n\n    static error(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'error', options);\n    }\n\n    static warning(message: string, options?: Partial<ToastOptions>): Toast {\n        return Toast.show(message, 'warning', options);\n    }\n}\n\n// Register the custom element\ncustomElements.define('bpt-toast', Toast);\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-toast': Toast;\n    }\n}\n","/**\n * Notification utilities\n *\n * Displays toast-style notifications to the user.\n * Accessible to screen readers via role=\"alert\".\n *\n * Now uses the bpt-toast Web Component when available,\n * with fallback to inline styles for progressive enhancement.\n *\n * @module notifications\n */\n\nimport { Toast } from '../components/Toast.js';\n\n/**\n * Notification types\n */\nexport type NotificationType = 'info' | 'success' | 'error' | 'warning';\n\n/**\n * Show a notification to the user\n *\n * Creates an accessible toast notification that:\n * - Is announced to screen readers via role=\"alert\"\n * - Has proper color contrast (WCAG AA compliant)\n * - Respects reduced motion preferences\n *\n * @param message - The message to display\n * @param type - The type of notification (affects styling)\n * @param duration - How long to show the notification (ms)\n */\nexport function showNotification(message: string, type: NotificationType = 'info', duration = 3000): void {\n    // Use the Web Component if available\n    if (customElements.get('bpt-toast')) {\n        Toast.show(message, type, { duration });\n        return;\n    }\n\n    // Fallback to inline notification (for cases where components aren't loaded)\n    const notification = document.createElement('div');\n\n    // Use WCAG AA compliant colors\n    const backgroundColor =\n        type === 'error' ? '#b91c1c' : type === 'success' ? '#15803d' : type === 'warning' ? '#a16207' : '#1d4ed8';\n\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    notification.style.cssText = `\n    position: fixed;\n    top: 80px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: ${backgroundColor};\n    color: white;\n    padding: 12px 24px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    z-index: 1001;\n    font-size: 14px;\n    max-width: 90%;\n    text-align: center;\n    font-weight: 500;\n  `;\n\n    notification.textContent = message;\n    document.body.appendChild(notification);\n\n    setTimeout(() => {\n        // Check for reduced motion preference\n        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n        if (prefersReducedMotion) {\n            notification.remove();\n        } else {\n            notification.style.opacity = '0';\n            notification.style.transition = 'opacity 0.3s ease';\n            setTimeout(() => notification.remove(), 300);\n        }\n    }, duration);\n}\n","/**\n * Accessibility utilities and keyboard navigation\n *\n * Implements keyboard shortcuts and screen reader announcements.\n *\n * @module accessibility\n */\n\n/**\n * Announce a message to screen readers\n *\n * Uses an aria-live region to announce status changes.\n *\n * @param message - The message to announce\n * @param priority - 'polite' for non-urgent, 'assertive' for urgent\n */\nexport function announce(message: string, priority: 'polite' | 'assertive' = 'polite'): void {\n    const announcer = document.getElementById('srAnnouncements');\n    if (announcer) {\n        announcer.setAttribute('aria-live', priority);\n        announcer.textContent = message;\n\n        // Clear after announcement to allow repeated messages\n        setTimeout(() => {\n            announcer.textContent = '';\n        }, 1000);\n    }\n}\n\n/**\n * Keyboard shortcut definitions\n */\ninterface KeyboardShortcut {\n    key: string;\n    description: string;\n    action: () => void;\n    ctrl?: boolean;\n    shift?: boolean;\n    alt?: boolean;\n}\n\nconst shortcuts: KeyboardShortcut[] = [];\n\n/**\n * Register a keyboard shortcut\n *\n * @param shortcut - The shortcut definition\n */\nexport function registerShortcut(shortcut: KeyboardShortcut): void {\n    shortcuts.push(shortcut);\n}\n\n/**\n * Handle keyboard events for shortcuts\n */\nfunction handleKeydown(event: KeyboardEvent): void {\n    // Don't trigger shortcuts when typing in inputs\n    const target = event.target as HTMLElement;\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n        // Allow Escape in inputs to blur\n        if (event.key === 'Escape') {\n            target.blur();\n        }\n        return;\n    }\n\n    for (const shortcut of shortcuts) {\n        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();\n        const ctrlMatch = shortcut.ctrl ? event.ctrlKey || event.metaKey : !event.ctrlKey && !event.metaKey;\n        const shiftMatch = shortcut.shift ? event.shiftKey : !event.shiftKey;\n        const altMatch = shortcut.alt ? event.altKey : !event.altKey;\n\n        if (keyMatch && ctrlMatch && shiftMatch && altMatch) {\n            event.preventDefault();\n            shortcut.action();\n            return;\n        }\n    }\n}\n\n/**\n * Initialize keyboard navigation\n *\n * Sets up global keyboard shortcuts:\n * - Space: Start/pause/resume recording (context-aware)\n * - Escape: Close modal/menu\n * - M: Toggle menu\n * - S: Open settings\n * - H: Open workout history\n * - L: Mark lap\n * - ?: Show keyboard shortcuts\n */\nexport function initKeyboardNavigation(): void {\n    // Space - Context-aware workout control\n    registerShortcut({\n        key: ' ',\n        description: 'Start/pause/resume workout (context-aware)',\n        action: () => {\n            // Garmin-style: Space toggles between recording and paused\n            const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n            const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n            const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n\n            // Click whichever button is currently visible\n            if (startButton && startButton.style.display !== 'none') {\n                startButton.click();\n            } else if (pauseButton && pauseButton.style.display !== 'none') {\n                pauseButton.click();\n            } else if (resumeButton && resumeButton.style.display !== 'none') {\n                resumeButton.click();\n            }\n        },\n    });\n\n    // Escape - Close modal/menu\n    registerShortcut({\n        key: 'Escape',\n        description: 'Close modal or menu',\n        action: () => {\n            // Close any open modal\n            const modals = document.querySelectorAll<HTMLElement>(\n                '.stream-modal[style*=\"display: block\"], .stream-modal:not([style*=\"display: none\"])'\n            );\n            for (const modal of modals) {\n                if (modal.style.display !== 'none') {\n                    const closeBtn = modal.querySelector<HTMLButtonElement>('.close-button');\n                    if (closeBtn) {\n                        closeBtn.click();\n                        announce('Dialog closed');\n                        return;\n                    }\n                }\n            }\n\n            // Close menu if open\n            const details = document.querySelector('details[open]') as HTMLDetailsElement | null;\n            if (details) {\n                details.removeAttribute('open');\n                announce('Menu closed');\n            }\n        },\n    });\n\n    // M - Toggle menu\n    registerShortcut({\n        key: 'm',\n        description: 'Toggle menu',\n        action: () => {\n            const details = document.querySelector('header details') as HTMLDetailsElement | null;\n            if (details) {\n                const isOpen = details.hasAttribute('open');\n                if (isOpen) {\n                    details.removeAttribute('open');\n                    announce('Menu closed');\n                } else {\n                    details.setAttribute('open', '');\n                    announce('Menu opened');\n                    // Focus first menu item\n                    const firstButton = details.querySelector<HTMLButtonElement>('#controls button');\n                    if (firstButton) {\n                        firstButton.focus();\n                    }\n                }\n            }\n        },\n    });\n\n    // S - Open settings\n    registerShortcut({\n        key: 's',\n        description: 'Open settings',\n        action: () => {\n            const settingsBtn = document.getElementById('settingsButton');\n            if (settingsBtn) {\n                settingsBtn.click();\n                announce('Settings opened');\n            }\n        },\n    });\n\n    // H - Open workout history\n    registerShortcut({\n        key: 'h',\n        description: 'Open workout history',\n        action: () => {\n            const router = window.router;\n            if (router) {\n                router.navigate('/history');\n                announce('Workout history opened');\n            } else {\n                const historyBtn = document.getElementById('workoutHistoryButton');\n                if (historyBtn) {\n                    historyBtn.click();\n                    announce('Workout history opened');\n                }\n            }\n        },\n    });\n\n    // E - Export data\n    registerShortcut({\n        key: 'e',\n        description: 'Export workout data',\n        action: () => {\n            const exportBtn = document.getElementById('exportData');\n            if (exportBtn) {\n                exportBtn.click();\n            }\n        },\n    });\n\n    // L - Mark lap\n    registerShortcut({\n        key: 'l',\n        description: 'Mark lap',\n        action: () => {\n            const lapBtn = document.getElementById('lapButton');\n            if (lapBtn) {\n                lapBtn.click();\n            }\n        },\n    });\n\n    // Add event listener\n    document.addEventListener('keydown', handleKeydown);\n\n    // Update summary element to indicate keyboard accessibility\n    const summary = document.querySelector('header summary');\n    if (summary) {\n        summary.setAttribute('aria-keyshortcuts', 'M');\n    }\n\n    console.log('Keyboard navigation initialized');\n}\n\n/**\n * Trap focus within a modal dialog\n *\n * @param modal - The modal element\n */\nexport function trapFocus(modal: HTMLElement): void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n\n    if (focusableElements.length === 0) return;\n\n    const firstElement = focusableElements[0];\n    const lastElement = focusableElements[focusableElements.length - 1];\n\n    // Focus first element\n    firstElement.focus();\n\n    modal.addEventListener('keydown', (event) => {\n        if (event.key !== 'Tab') return;\n\n        if (event.shiftKey) {\n            // Shift + Tab\n            if (document.activeElement === firstElement) {\n                event.preventDefault();\n                lastElement.focus();\n            }\n        } else {\n            // Tab\n            if (document.activeElement === lastElement) {\n                event.preventDefault();\n                firstElement.focus();\n            }\n        }\n    });\n}\n\n/**\n * Update workout controls accessibility state\n *\n * @param state - The current workout state: 'idle', 'recording', or 'paused'\n */\nexport function updateWorkoutControlsAccessibility(state: 'idle' | 'recording' | 'paused'): void {\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    // Update ARIA labels based on state\n    if (startButton) {\n        startButton.setAttribute('aria-label', 'Start workout');\n    }\n    if (pauseButton) {\n        pauseButton.setAttribute('aria-label', 'Pause workout');\n    }\n    if (resumeButton) {\n        resumeButton.setAttribute('aria-label', 'Resume workout');\n    }\n    if (stopButton) {\n        stopButton.setAttribute('aria-label', 'Stop and save workout');\n    }\n\n    // Update workout controls container with current state\n    const controlsContainer = document.getElementById('workoutControls');\n    if (controlsContainer) {\n        controlsContainer.setAttribute('data-workout-state', state);\n    }\n}\n\n/**\n * Update start/stop button accessibility state\n * @deprecated Use updateWorkoutControlsAccessibility instead\n * @param isRunning - Whether the workout is running\n */\nexport function updateStartStopAccessibility(isRunning: boolean): void {\n    // Backward compatibility - map to new function\n    updateWorkoutControlsAccessibility(isRunning ? 'recording' : 'paused');\n}\n\n/**\n * Announce connection status change\n *\n * @param sensorType - The type of sensor\n * @param isConnected - Whether the sensor is connected\n */\nexport function announceConnectionStatus(sensorType: 'power' | 'cadence' | 'heartrate', isConnected: boolean): void {\n    const sensorNames = {\n        power: 'Power meter',\n        cadence: 'Cadence sensor',\n        heartrate: 'Heart rate monitor',\n    };\n\n    const message = isConnected ? `${sensorNames[sensorType]} connected` : `${sensorNames[sensorType]} disconnected`;\n\n    announce(message, 'assertive');\n}\n","import type { WorkoutSummary } from '../calculations/summary.js';\nimport { formatDurationLong } from './modal.js';\n\n/**\n * Generate a shareable image for the workout summary.\n *\n * Draws the stats onto a canvas and returns a Blob.\n *\n * @param summary - The workout summary data\n * @returns Promise resolving to a Blob representing the PNG image\n */\nexport async function generateShareImage(summary: WorkoutSummary): Promise<Blob | null> {\n    const width = 1080;\n    const height = 1350; // 4:5 aspect ratio (good for Instagram/Socials)\n\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const ctx = canvas.getContext('2d');\n\n    if (!ctx) return null;\n\n    // --- Colors ---\n    const bgMain = '#121212';\n    const bgCard = '#1E1E1E';\n    const textPrimary = '#FFFFFF';\n    const textSecondary = '#AAAAAA';\n    const accent = '#2196F3';\n    const powerColor = '#FFC107'; // Amber\n    const hrColor = '#F44336'; // Red\n\n    // --- Helper Functions ---\n    const drawRoundedRect = (x: number, y: number, w: number, h: number, r: number, fill: string) => {\n        ctx.beginPath();\n        ctx.moveTo(x + r, y);\n        ctx.lineTo(x + w - r, y);\n        ctx.quadraticCurveTo(x + w, y, x + w, y + r);\n        ctx.lineTo(x + w, y + h - r);\n        ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);\n        ctx.lineTo(x + r, y + h);\n        ctx.quadraticCurveTo(x, y + h, x, y + h - r);\n        ctx.lineTo(x, y + r);\n        ctx.quadraticCurveTo(x, y, x + r, y);\n        ctx.closePath();\n        ctx.fillStyle = fill;\n        ctx.fill();\n    };\n\n    const drawText = (\n        text: string,\n        x: number,\n        y: number,\n        fontSize: number,\n        color: string,\n        align: CanvasTextAlign = 'left',\n        bold = false\n    ) => {\n        ctx.fillStyle = color;\n        ctx.font = `${bold ? 'bold ' : ''}${fontSize}px sans-serif`;\n        ctx.textAlign = align;\n        ctx.fillText(text, x, y);\n    };\n\n    const drawMetricCard = (\n        label: string,\n        value: string,\n        subValue: string | null,\n        icon: string,\n        x: number,\n        y: number,\n        w: number,\n        h: number,\n        valueColor: string = textPrimary\n    ) => {\n        drawRoundedRect(x, y, w, h, 20, bgCard);\n\n        // Icon\n        drawText(icon, x + 30, y + 55, 40, textPrimary, 'left');\n\n        // Label\n        drawText(label.toUpperCase(), x + 90, y + 45, 20, textSecondary, 'left', true);\n\n        // Main Value\n        drawText(value, x + w / 2, y + 110, 56, valueColor, 'center', true);\n\n        // Sub Value\n        if (subValue) {\n            drawText(subValue, x + w / 2, y + 150, 24, textSecondary, 'center');\n        }\n    };\n\n    // --- Background ---\n    ctx.fillStyle = bgMain;\n    ctx.fillRect(0, 0, width, height);\n\n    // --- Header ---\n    const dateStr = new Date(summary.startTime).toLocaleDateString(undefined, {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n    });\n    const timeStr = new Date(summary.startTime).toLocaleTimeString(undefined, {\n        hour: '2-digit',\n        minute: '2-digit',\n    });\n\n    // Title\n    drawText('WORKOUT SUMMARY', width / 2, 120, 40, accent, 'center', true);\n    // Date\n    drawText(dateStr, width / 2, 180, 28, textSecondary, 'center');\n    // Time\n    drawText(timeStr, width / 2, 220, 24, textSecondary, 'center');\n\n    // --- Main Circular Stat (Duration/TSS) ---\n    // Let's showcase Duration or Calories or TSS\n    const centerX = width / 2;\n    const centerY = 420;\n\n    // Outer Ring\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, 140, 0, 2 * Math.PI);\n    ctx.lineWidth = 20;\n    ctx.strokeStyle = '#333';\n    ctx.stroke();\n\n    // Active Ring (just visual decoration)\n    ctx.beginPath();\n    ctx.arc(centerX, centerY, 140, -Math.PI / 2, Math.PI, false);\n    ctx.strokeStyle = accent;\n    ctx.stroke();\n\n    // Duration Text\n    drawText(formatDurationLong(summary.duration), centerX, centerY + 15, 70, textPrimary, 'center', true);\n    drawText('DURATION', centerX, centerY - 60, 20, textSecondary, 'center', true);\n\n    // --- Metric Grid ---\n    const gridY = 650;\n    const padding = 40;\n    const cardW = (width - padding * 3) / 2;\n    const cardH = 200;\n\n    // Row 1: Power & HR\n    drawMetricCard(\n        'Avg Power',\n        `${summary.power.avg || 0}W`,\n        summary.normalizedPower ? `NP ${summary.normalizedPower}W` : null,\n        '',\n        padding,\n        gridY,\n        cardW,\n        cardH,\n        powerColor\n    );\n    drawMetricCard(\n        'Avg HR',\n        `${summary.heartrate.avg || '--'} bpm`,\n        summary.heartrate.max ? `Max ${summary.heartrate.max}` : null,\n        '',\n        padding * 2 + cardW,\n        gridY,\n        cardW,\n        cardH,\n        hrColor\n    );\n\n    // Row 2: VO2 & Work\n    const row2Y = gridY + cardH + padding;\n\n    // VO2Max or Cadence\n    if (summary.vo2MaxEstimation) {\n        drawMetricCard(\n            'VO Max',\n            `${summary.vo2MaxEstimation}`,\n            'ml/kg/min',\n            '',\n            padding,\n            row2Y,\n            cardW,\n            cardH,\n            '#E91E63'\n        );\n    } else {\n        drawMetricCard('Avg Cadence', `${summary.cadence.avg || 0} rpm`, null, '', padding, row2Y, cardW, cardH);\n    }\n\n    // Work or Calories\n    // If work is available in kJ.\n    const workKj = summary.work || Math.round(((summary.power.avg || 0) * (summary.duration / 1000)) / 1000);\n    drawMetricCard(\n        'Work',\n        `${workKj} kJ`,\n        summary.power.wattsPerKg ? `${summary.power.wattsPerKg} W/kg` : null,\n        '',\n        padding * 2 + cardW,\n        row2Y,\n        cardW,\n        cardH\n    );\n\n    // --- Advanced Stats Strip ---\n    const stripY = row2Y + cardH + padding;\n    const stripH = 120;\n    drawRoundedRect(padding, stripY, width - padding * 2, stripH, 20, bgCard);\n\n    const stats = [\n        { label: 'IF', value: summary.intensityFactor || '--' },\n        { label: 'TSS', value: summary.trainingLoad || '--' },\n        { label: 'VI', value: summary.variabilityIndex || '--' },\n        { label: 'MAX PWR', value: `${summary.power.max || 0}W` },\n    ];\n\n    const sectionW = (width - padding * 2) / stats.length;\n    stats.forEach((stat, i) => {\n        const x = padding + i * sectionW + sectionW / 2;\n        drawText(stat.label, x, stripY + 50, 24, textSecondary, 'center');\n        drawText(stat.value.toString(), x, stripY + 90, 36, textPrimary, 'center', true);\n\n        // Divider\n        if (i < stats.length - 1) {\n            ctx.beginPath();\n            ctx.moveTo(padding + (i + 1) * sectionW, stripY + 30);\n            ctx.lineTo(padding + (i + 1) * sectionW, stripY + stripH - 30);\n            ctx.strokeStyle = '#333';\n            ctx.lineWidth = 2;\n            ctx.stroke();\n        }\n    });\n\n    // --- Footer ---\n    drawText('Bike Power Tracker', width / 2, height - 50, 24, '#666', 'center');\n\n    // Convert to Blob\n    return new Promise((resolve) => canvas.toBlob(resolve, 'image/png'));\n}\n\n/**\n * Trigger a download of the workout summary image\n */\nexport async function downloadWorkoutImage(summary: WorkoutSummary): Promise<void> {\n    try {\n        const blob = await generateShareImage(summary);\n        if (!blob) throw new Error('Failed to generate image');\n\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        const dateStr = new Date(summary.startTime).toISOString().split('T')[0];\n        a.download = `workout-summary-${dateStr}.png`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    } catch (e) {\n        console.error('Error downloading workout image', e);\n        alert('Could not generate image. Support might be missing in this browser.');\n    }\n}\n","/**\n * Zone Colors - TypeScript constants that match CSS tokens\n *\n * IMPORTANT: These values must stay in sync with tokens/colors.css\n * Consider using a build-time extraction tool in the future\n */\n\nexport const POWER_ZONE_COLORS = {\n    1: '#808080', // Recovery\n    2: '#2196f3', // Endurance\n    3: '#4caf50', // Tempo\n    4: '#ffeb3b', // Threshold\n    5: '#ff9800', // VO2max\n    6: '#f44336', // Anaerobic\n    7: '#9c27b0', // Neuromuscular\n} as const;\n\nexport const HR_ZONE_COLORS = {\n    1: '#808080', // < 60%\n    2: '#2196f3', // 60-70%\n    3: '#4caf50', // 70-80%\n    4: '#ff9800', // 80-90%\n    5: '#f44336', // > 90%\n} as const;\n\nexport type PowerZone = keyof typeof POWER_ZONE_COLORS;\nexport type HRZone = keyof typeof HR_ZONE_COLORS;\n\n/**\n * Get zone color by zone number\n */\nexport function getZoneColor(zone: number, type: 'power' | 'hr' = 'power'): string {\n    if (type === 'hr') {\n        const hrZone = Math.min(Math.max(zone, 1), 5) as HRZone;\n        return HR_ZONE_COLORS[hrZone];\n    }\n\n    const powerZone = Math.min(Math.max(zone, 1), 7) as PowerZone;\n    return POWER_ZONE_COLORS[powerZone];\n}\n\n/**\n * Get CSS variable name for zone\n */\nexport function getZoneCSSVar(zone: number, type: 'power' | 'hr' = 'power'): string {\n    if (type === 'hr') {\n        return `--hr-zone-${Math.min(Math.max(zone, 1), 5)}-color`;\n    }\n    return `--zone-${Math.min(Math.max(zone, 1), 7)}-color`;\n}\n\n/**\n * Calculate power zone from percentage of FTP\n */\nexport function getPowerZone(percentFTP: number): PowerZone {\n    if (percentFTP < 55) return 1;\n    if (percentFTP < 75) return 2;\n    if (percentFTP < 90) return 3;\n    if (percentFTP < 105) return 4;\n    if (percentFTP < 120) return 5;\n    if (percentFTP < 150) return 6;\n    return 7;\n}\n\n/**\n * Calculate HR zone from percentage of max HR\n */\nexport function getHRZone(percentMaxHR: number): HRZone {\n    if (percentMaxHR < 60) return 1;\n    if (percentMaxHR < 70) return 2;\n    if (percentMaxHR < 80) return 3;\n    if (percentMaxHR < 90) return 4;\n    return 5;\n}\n","/**\n * Modal Component\n *\n * Reusable modal dialog system for confirmations and content display.\n * Fully accessible with keyboard navigation and screen reader support.\n *\n * @module modal\n */\n\nimport { announce } from './accessibility.js';\nimport { downloadWorkoutImage } from './shareWithImage.js';\nimport type { ZoneDistribution } from '../zone-state.js';\nimport { POWER_ZONE_COLORS } from '../styles/zone-colors.js';\n\n/**\n * Modal button configuration\n */\nexport interface ModalButton {\n    text: string;\n    variant: 'primary' | 'secondary' | 'danger';\n    onClick: () => void;\n}\n\n/**\n * Modal configuration options\n */\nexport interface ModalOptions {\n    title: string;\n    content: string | HTMLElement;\n    buttons: ModalButton[];\n    icon?: string;\n    onClose?: () => void;\n    closeOnOverlay?: boolean;\n}\n\n/**\n * Create a modal element\n */\nfunction createModalElement(options: ModalOptions): HTMLElement {\n    const modal = document.createElement('div');\n    modal.className = 'custom-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-modal', 'true');\n    modal.setAttribute('aria-labelledby', 'modal-title');\n\n    const titleText = options.icon ? `${options.icon} ${options.title}` : options.title;\n\n    modal.innerHTML = `\n        <div class=\"custom-modal-overlay\"></div>\n        <div class=\"custom-modal-container\">\n            <div class=\"custom-modal-header\">\n                <h2 id=\"modal-title\">${titleText}</h2>\n                <button class=\"modal-close-btn\" aria-label=\"Close dialog\">&times;</button>\n            </div>\n            <div class=\"custom-modal-body\"></div>\n            <div class=\"custom-modal-footer\"></div>\n        </div>\n    `;\n\n    // Add content\n    const body = modal.querySelector('.custom-modal-body') as HTMLElement;\n    if (typeof options.content === 'string') {\n        body.innerHTML = options.content;\n    } else {\n        body.appendChild(options.content);\n    }\n\n    // Add buttons\n    const footer = modal.querySelector('.custom-modal-footer') as HTMLElement;\n    options.buttons.forEach((btn, index) => {\n        const button = document.createElement('button');\n        button.textContent = btn.text;\n        button.className = `modal-btn modal-btn-${btn.variant}`;\n        button.addEventListener('click', btn.onClick);\n\n        // Auto-focus the first primary button, or first button if no primary\n        if (btn.variant === 'primary' || (index === 0 && !options.buttons.some((b) => b.variant === 'primary'))) {\n            button.setAttribute('data-autofocus', 'true');\n        }\n\n        footer.appendChild(button);\n    });\n\n    return modal;\n}\n\n/**\n * Focus trap for modal accessibility\n */\nfunction trapFocus(modal: HTMLElement): () => void {\n    const focusableElements = modal.querySelectorAll<HTMLElement>(\n        'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    const firstFocusable = focusableElements[0];\n    const lastFocusable = focusableElements[focusableElements.length - 1];\n\n    const handleTabKey = (e: KeyboardEvent) => {\n        if (e.key !== 'Tab') return;\n\n        if (e.shiftKey) {\n            if (document.activeElement === firstFocusable) {\n                e.preventDefault();\n                lastFocusable?.focus();\n            }\n        } else {\n            if (document.activeElement === lastFocusable) {\n                e.preventDefault();\n                firstFocusable?.focus();\n            }\n        }\n    };\n\n    modal.addEventListener('keydown', handleTabKey);\n    return () => modal.removeEventListener('keydown', handleTabKey);\n}\n\n/**\n * Show a modal dialog\n *\n * @param options - Modal configuration\n * @returns A function to close the modal\n */\nexport function showModal(options: ModalOptions): () => void {\n    const modal = createModalElement(options);\n    const previousActiveElement = document.activeElement as HTMLElement;\n\n    document.body.appendChild(modal);\n\n    // Force reflow for animation\n    modal.offsetHeight;\n    modal.classList.add('modal-visible');\n\n    // Set up focus trap\n    const removeFocusTrap = trapFocus(modal);\n\n    // Focus the autofocus element or first focusable\n    const autofocusEl = modal.querySelector<HTMLElement>('[data-autofocus]');\n    setTimeout(() => {\n        autofocusEl?.focus();\n    }, 50);\n\n    // Close function\n    const closeModal = () => {\n        modal.classList.remove('modal-visible');\n\n        // Remove after animation\n        setTimeout(() => {\n            modal.remove();\n            removeFocusTrap();\n\n            // Restore focus\n            previousActiveElement?.focus();\n\n            options.onClose?.();\n        }, 200);\n    };\n\n    // Close button\n    const closeBtn = modal.querySelector('.modal-close-btn');\n    closeBtn?.addEventListener('click', closeModal);\n\n    // Overlay click\n    if (options.closeOnOverlay !== false) {\n        const overlay = modal.querySelector('.custom-modal-overlay');\n        overlay?.addEventListener('click', closeModal);\n    }\n\n    // Escape key\n    const handleEscape = (e: KeyboardEvent) => {\n        if (e.key === 'Escape') {\n            e.preventDefault();\n            closeModal();\n        }\n    };\n    document.addEventListener('keydown', handleEscape);\n\n    // Cleanup escape listener when modal closes\n    const originalOnClose = options.onClose;\n    options.onClose = () => {\n        document.removeEventListener('keydown', handleEscape);\n        originalOnClose?.();\n    };\n\n    announce(`${options.title} dialog opened`, 'polite');\n\n    return closeModal;\n}\n\n/**\n * Show a confirmation dialog\n *\n * @param title - Dialog title\n * @param message - Confirmation message\n * @param options - Additional options\n * @returns Promise resolving to true if confirmed, false if cancelled\n */\nexport function showConfirmation(\n    title: string,\n    message: string,\n    options: {\n        confirmText?: string;\n        cancelText?: string;\n        confirmVariant?: 'primary' | 'danger';\n        icon?: string;\n    } = {}\n): Promise<boolean> {\n    return new Promise((resolve) => {\n        const { confirmText = 'Confirm', cancelText = 'Cancel', confirmVariant = 'primary', icon } = options;\n\n        let closeModal: (() => void) | null = null;\n\n        closeModal = showModal({\n            title,\n            content: `<p class=\"modal-message\">${message}</p>`,\n            icon,\n            buttons: [\n                {\n                    text: cancelText,\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(false);\n                    },\n                },\n                {\n                    text: confirmText,\n                    variant: confirmVariant,\n                    onClick: () => {\n                        closeModal?.();\n                        resolve(true);\n                    },\n                },\n            ],\n            onClose: () => resolve(false),\n        });\n    });\n}\n\nimport { type WorkoutSummary, calculateWorkoutSummary } from '../calculations/summary.js';\nimport { type LapSummary } from '../calculations/lap-calculator.js';\nexport { type WorkoutSummary, calculateWorkoutSummary };\n\n/**\n * Format duration in milliseconds to human readable string\n */\nexport function formatDurationLong(ms: number): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n\n    const parts: string[] = [];\n    if (hours > 0) parts.push(`${hours}h`);\n    if (minutes > 0) parts.push(`${minutes}m`);\n    if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);\n\n    return parts.join(' ');\n}\n\n/**\n * Format seconds to MM:SS format\n */\nfunction formatSecondsShort(seconds: number): string {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n}\n\n/**\n * Create a simple lap table\n */\nfunction createLapTable(laps: LapSummary[]): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'summary-laps';\n    container.style.marginTop = '24px';\n    container.style.overflowX = 'auto'; // Horizontal scroll for small screens\n\n    if (laps.length === 0) return container;\n\n    let html = `\n        <h4 style=\"margin-bottom: 8px;\">Laps</h4>\n        <table class=\"lap-table\" style=\"width: 100%; border-collapse: collapse; font-size: 0.9em;\">\n            <thead>\n                <tr style=\"border-bottom: 2px solid var(--color-border);\">\n                    <th style=\"padding: 8px; text-align: left;\">#</th>\n                    <th style=\"padding: 8px; text-align: right;\">Time</th>\n                    <th style=\"padding: 8px; text-align: right;\">Dist</th>\n                    <th style=\"padding: 8px; text-align: right;\">Pwr</th>\n                    <th style=\"padding: 8px; text-align: right;\">HR</th>\n                    <th style=\"padding: 8px; text-align: right;\">Cad</th>\n                </tr>\n            </thead>\n            <tbody>\n    `;\n\n    laps.forEach((lap) => {\n        const timeStr = formatSecondsShort(Math.round(lap.duration / 1000));\n        const distStr = lap.distance > 0 ? `${(lap.distance / 1000).toFixed(2)}` : '-';\n\n        html += `\n            <tr style=\"border-bottom: 1px solid var(--color-border-light);\">\n                <td style=\"padding: 8px; text-align: left;\">${lap.number}</td>\n                <td style=\"padding: 8px; text-align: right;\">${timeStr}</td>\n                <td style=\"padding: 8px; text-align: right;\">${distStr}</td>\n                <td style=\"padding: 8px; text-align: right;\">${lap.avgPower}</td>\n                <td style=\"padding: 8px; text-align: right;\">${lap.avgHeartRate}</td>\n                <td style=\"padding: 8px; text-align: right;\">${lap.avgCadence}</td>\n            </tr>\n        `;\n    });\n\n    html += `\n            </tbody>\n        </table>\n    `;\n\n    container.innerHTML = html;\n    return container;\n}\n\n/**\n * Zone colors for the histogram - uses shared design tokens\n */\nconst ZONE_COLORS: Record<number, string> = POWER_ZONE_COLORS;\n\n/**\n * Create zone distribution histogram chart\n */\nfunction createZoneHistogram(distribution: ZoneDistribution, title: string): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'zone-distribution';\n\n    // Filter zones with time > 0\n    const activeZones = distribution.zones.filter((z) => z.timeInZoneMs > 0);\n\n    if (activeZones.length === 0) {\n        return container; // Return empty if no zone data\n    }\n\n    const maxTime = Math.max(...distribution.zones.map((z) => z.timeInZoneMs));\n\n    container.innerHTML = `\n        <h4 class=\"zone-distribution-title\">${title}</h4>\n        <div class=\"zone-chart\">\n            ${distribution.zones\n            .map((zone) => {\n                const percent = maxTime > 0 ? (zone.timeInZoneMs / maxTime) * 100 : 0;\n                const timeSeconds = Math.round(zone.timeInZoneMs / 1000);\n                const color = zone.color || ZONE_COLORS[zone.zone] || '#888';\n                const timeStr = formatSecondsShort(timeSeconds);\n\n                return `\n                    <div class=\"zone-bar-row\" title=\"${zone.name}: ${timeStr}\">\n                        <span class=\"zone-bar-label\">Z${zone.zone}</span>\n                        <div class=\"zone-bar-container\">\n                            <div class=\"zone-bar\" style=\"width: ${Math.max(percent, 2)}%; background-color: ${color};\" aria-valuenow=\"${timeSeconds}\" aria-label=\"${zone.name}\"></div>\n                        </div>\n                        <span class=\"zone-bar-time\">${timeStr}</span>\n                    </div>\n                `;\n            })\n            .join('')}\n        </div>\n    `;\n\n    return container;\n}\n\n/**\n * Create workout summary content HTML element\n */\nexport function createSummaryContent(summary: WorkoutSummary, newRecords: string[] = []): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'workout-summary';\n\n    const formatValue = (value: number | null, unit: string): string => {\n        return value !== null ? `${value}${unit}` : '--';\n    };\n\n    // New Records Section\n    let recordsHtml = '';\n    if (newRecords.length > 0) {\n        recordsHtml = `\n            <div class=\"summary-records\" style=\"background: rgba(255, 215, 0, 0.1); border: 1px solid var(--color-accent); border-radius: 8px; padding: 12px; margin-bottom: 16px;\">\n                <h4 style=\"margin: 0 0 8px 0; color: var(--color-accent); display: flex; align-items: center; gap: 8px;\">\n                     New Personal Records!\n                </h4>\n                <ul style=\"margin: 0; padding-left: 20px; list-style-type: none;\">\n                    ${newRecords.map((r) => `<li style=\"margin-bottom: 4px;\"> ${r}</li>`).join('')}\n                </ul>\n            </div>\n        `;\n    }\n\n    container.innerHTML = `\n        ${recordsHtml}\n        <div class=\"summary-duration\">\n            <span class=\"summary-label\">Duration</span>\n            <span class=\"summary-value\">${formatDurationLong(summary.duration)}</span>\n        </div>\n        <div class=\"summary-grid\">\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Power</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.power.avg, 'W')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.power.max, 'W')}</span>\n                    ${summary.power.wattsPerKg ? `<span class=\"summary-wkg\" style=\"display:block; font-size:0.85em; margin-top:4px; color:var(--color-text-secondary)\">${summary.power.wattsPerKg} W/kg</span>` : ''}\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Heart Rate</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.heartrate.avg, ' bpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.heartrate.max, ' bpm')}</span>\n                </div>\n            </div>\n            <div class=\"summary-metric\">\n                <span class=\"summary-metric-icon\"></span>\n                <span class=\"summary-metric-label\">Cadence</span>\n                <div class=\"summary-metric-values\">\n                    <span class=\"summary-avg\">Avg: ${formatValue(summary.cadence.avg, ' rpm')}</span>\n                    <span class=\"summary-max\">Max: ${formatValue(summary.cadence.max, ' rpm')}</span>\n                </div>\n            </div>\n        </div>\n        ${summary.normalizedPower ||\n            summary.intensityFactor ||\n            summary.trainingLoad ||\n            summary.variabilityIndex ||\n            summary.work ||\n            summary.vo2MaxEstimation\n            ? `\n        <div class=\"summary-advanced\" style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--color-border); display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center;\">\n             ${summary.normalizedPower\n                ? `\n            <div class=\"advanced-metric\">\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">NP</div>\n                <div style=\"font-weight: bold; font-size: 1.1em;\">${summary.normalizedPower} W</div>\n            </div>`\n                : ''\n            }\n            ${summary.intensityFactor\n                ? `\n            <div class=\"advanced-metric\">\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">IF</div>\n                <div style=\"font-weight: bold; font-size: 1.1em;\">${summary.intensityFactor}</div>\n            </div>`\n                : ''\n            }\n            ${summary.trainingLoad\n                ? `\n            <div class=\"advanced-metric\">\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">TSS</div>\n                <div style=\"font-weight: bold; font-size: 1.1em;\">${summary.trainingLoad}</div>\n            </div>`\n                : ''\n            }\n            ${summary.variabilityIndex\n                ? `\n            <div class=\"advanced-metric\">\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">VI</div>\n                <div style=\"font-weight: bold; font-size: 1.1em;\">${summary.variabilityIndex}</div>\n            </div>`\n                : ''\n            }\n            ${summary.work\n                ? `\n            <div class=\"advanced-metric\">\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Work</div>\n                <div style=\"font-weight: bold; font-size: 1.1em;\">${summary.work} kJ</div>\n            </div>`\n                : ''\n            }\n            ${summary.vo2MaxEstimation\n                ? `\n            <div class=\"advanced-metric\">\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\" title=\"Estimated from Power/HR relationship\">VO Max</div>\n                <div style=\"font-weight: bold; font-size: 1.1em; color: var(--color-heart-rate);\">${summary.vo2MaxEstimation}</div>\n                <div style=\"font-size: 0.7em; color: var(--color-text-secondary);\">ml/kg/min</div>\n            </div>`\n                : ''\n            }\n        </div>\n        `\n            : ''\n        }\n        <div class=\"summary-samples\">\n            <span class=\"summary-samples-text\">\n                ${summary.power.count + summary.heartrate.count + summary.cadence.count} data points recorded\n            </span>\n        </div>\n    `;\n\n    // Add zone distribution charts if available\n    if (summary.powerZoneDistribution && summary.powerZoneDistribution.totalTimeMs > 0) {\n        const powerChart = createZoneHistogram(summary.powerZoneDistribution, ' Power Zone Distribution');\n        container.appendChild(powerChart);\n    }\n\n    if (summary.hrZoneDistribution && summary.hrZoneDistribution.totalTimeMs > 0) {\n        const hrChart = createZoneHistogram(summary.hrZoneDistribution, ' Heart Rate Zone Distribution');\n        container.appendChild(hrChart);\n    }\n\n    // Add laps table\n    if (summary.laps && summary.laps.length > 0) {\n        const lapTable = createLapTable(summary.laps);\n        container.appendChild(lapTable);\n    }\n\n    return container;\n}\n\n/**\n * Show post-workout summary modal\n *\n * @param summary - Workout summary data\n * @param callbacks - Action callbacks\n * @returns Promise resolving to the chosen action\n */\nexport function showWorkoutSummary(\n    summary: WorkoutSummary,\n    callbacks: {\n        onExport: () => void;\n        onDiscard: () => void;\n        onKeepRecording: () => void;\n        onFinish: () => void;\n    },\n    newRecords: string[] = []\n): Promise<'export' | 'discard' | 'keep' | 'finish'> {\n    return new Promise((resolve) => {\n        let closeModal: (() => void) | null = null;\n\n        const content = createSummaryContent(summary, newRecords);\n\n        closeModal = showModal({\n            title: 'Workout Complete',\n            content,\n            icon: '',\n            closeOnOverlay: false,\n            buttons: [\n                {\n                    text: ' Discard',\n                    variant: 'danger',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onDiscard();\n                        resolve('discard');\n                    },\n                },\n                {\n                    text: ' Continue',\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onKeepRecording();\n                        resolve('keep');\n                    },\n                },\n                {\n                    text: ' Export Image',\n                    variant: 'secondary',\n                    onClick: () => {\n                        downloadWorkoutImage(summary);\n                    },\n                },\n                {\n                    text: ' Export Files',\n                    variant: 'secondary',\n                    onClick: () => {\n                        callbacks.onExport();\n                        // Don't limit to resolving 'export', user might want to finish after exporting\n                    },\n                },\n                {\n                    text: ' Finish & Save',\n                    variant: 'primary',\n                    onClick: () => {\n                        closeModal?.();\n                        callbacks.onFinish();\n                        resolve('finish');\n                    },\n                },\n            ],\n            onClose: () => {\n                callbacks.onKeepRecording();\n                resolve('keep');\n            },\n        });\n    });\n}\n","import { stateEventBus } from '../state/EventBus.js';\nimport { MeanMaximalPowerCalculator } from '../calculations/MeanMaximalPower.js';\nimport { personalRecordsStore } from '../state/PersonalRecordsStore.js';\nimport { showNotification } from '../ui/notifications.js';\nimport { settingsStore } from '../state/SettingsStore.js';\nimport { showConfirmation } from '../ui/modal.js';\n\nexport class PersonalRecordsManager {\n    private calculator = new MeanMaximalPowerCalculator();\n    private isListening = false;\n\n    constructor() {\n        this.start();\n    }\n\n    public getCurrentSessionMax(): Record<number, number> {\n        return this.calculator.getCurrentMax();\n    }\n\n    public start() {\n        if (this.isListening) return;\n        this.isListening = true;\n\n        // Reset calculator on workout start\n        stateEventBus.on('workout:start', () => {\n            this.calculator.reset();\n        });\n\n        // Listen for power updates\n        stateEventBus.on('power:update', async (data) => {\n            const updates = this.calculator.addSample(data.value);\n\n            if (updates) {\n                // Check against persistent storage\n                // We do this async to not block the main loop logic\n                for (const [durationStr, value] of Object.entries(updates)) {\n                    const duration = Number(durationStr);\n                    const { isAllTime, isSeason } = await personalRecordsStore.checkAndAddRecord(\n                        duration,\n                        value,\n                        data.timestamp\n                    );\n\n                    if (isAllTime) {\n                        this.notifyNewRecord(duration, value, 'All-Time');\n\n                        // Check for FTP improvemnent (20 min = 1200 sec)\n                        if (duration === 1200) {\n                            this.checkFtpImprovement(value);\n                        }\n                    } else if (isSeason) {\n                        this.notifyNewRecord(duration, value, 'Season');\n                    }\n                }\n            }\n        });\n    }\n\n    private async checkFtpImprovement(avgPower20Min: number) {\n        const estFtp = Math.round(avgPower20Min * 0.95);\n        const currentFtp = settingsStore.getAll().ftp;\n\n        // Only suggest if improvement is significant (e.g. > 2%)\n        if (estFtp > currentFtp * 1.02) {\n            const confirmed = await showConfirmation(\n                'New FTP Detected',\n                `Your recent 20-minute effort of ${Math.round(avgPower20Min)}W suggests a new FTP of ${estFtp}W. (Current: ${currentFtp}W)<br><br>Would you like to update your FTP?`,\n                {\n                    confirmText: 'Update FTP',\n                    confirmVariant: 'primary',\n                    icon: '',\n                }\n            );\n\n            if (confirmed) {\n                await settingsStore.updateFtp(estFtp, 'estimated');\n                showNotification(`FTP updated to ${estFtp}W`, 'success');\n            }\n        }\n    }\n\n    private notifyNewRecord(duration: number, value: number, type: string) {\n        // Format duration\n        let durationLabel = `${duration}s`;\n        if (duration >= 60) durationLabel = `${Math.floor(duration / 60)}m`;\n\n        const message = `New ${type} Record! ${durationLabel} @ ${Math.round(value)}W`;\n\n        showNotification(message, 'success', 5000);\n\n        // Emit event for other UI components (e.g. confetti, special sounds)\n        // We might want to expand EventMap first, but for now this is enough.\n    }\n}\n\n// Singleton instance\nexport const personalRecordsManager = new PersonalRecordsManager();\n","/**\n * Validation limits for measurement values\n */\nexport const VALIDATION_LIMITS = {\n    heartrate: { min: 0, max: 300 },\n    power: { min: 0, max: 3000 },\n    cadence: { min: 0, max: 300 },\n    speed: { min: 0, max: 150 }, // km/h\n    distance: { min: 0, max: 1000000 }, // meters\n    altitude: { min: -500, max: 9000 }, // meters\n} as const;\n","import { stateEventBus } from '../EventBus.js';\n\ninterface GPSPoint {\n    latitude: number;\n    longitude: number;\n    timestamp: number;\n}\n\nexport class DistanceCalculator {\n    private lastPoint: GPSPoint | null = null;\n    private totalDistance = 0;\n    private lapDistance = 0;\n\n    constructor() {\n        // Listen to GPS updates instead of being called directly\n        stateEventBus.on('gps:update', (data) => {\n            this.handleGPSUpdate(data);\n        });\n\n        stateEventBus.on('lap:complete', () => {\n            this.lapDistance = 0;\n        });\n\n        stateEventBus.on('workout:start', () => {\n            this.reset();\n        });\n    }\n\n    private handleGPSUpdate(data: { timestamp: number; latitude: number; longitude: number }): void {\n        const point: GPSPoint = {\n            latitude: data.latitude,\n            longitude: data.longitude,\n            timestamp: data.timestamp,\n        };\n\n        if (this.lastPoint) {\n            const distance = this.calculateDistance(this.lastPoint, point);\n\n            // Filter out unrealistic jumps (> 50m in 1 second would be > 180km/h)\n            const timeDelta = (point.timestamp - this.lastPoint.timestamp) / 1000;\n            // Avoid division by zero, though unlikely with timestamps\n            if (timeDelta > 0) {\n                const maxDistance = 50 * timeDelta; // 50m/s max\n\n                if (distance <= maxDistance) {\n                    this.totalDistance += distance;\n                    this.lapDistance += distance;\n\n                    stateEventBus.emit('distance:update', {\n                        timestamp: point.timestamp,\n                        value: this.totalDistance,\n                    });\n                }\n            }\n        }\n\n        this.lastPoint = point;\n    }\n\n    private calculateDistance(p1: GPSPoint, p2: GPSPoint): number {\n        const R = 6371000; // Earth radius in meters\n        const lat1 = (p1.latitude * Math.PI) / 180;\n        const lat2 = (p2.latitude * Math.PI) / 180;\n        const dLat = ((p2.latitude - p1.latitude) * Math.PI) / 180;\n        const dLon = ((p2.longitude - p1.longitude) * Math.PI) / 180;\n\n        const a =\n            Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n            Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n        return R * c;\n    }\n\n    reset(): void {\n        this.lastPoint = null;\n        this.totalDistance = 0;\n        this.lapDistance = 0;\n    }\n\n    setTotalDistance(distance: number): void {\n        this.totalDistance = distance;\n        // We don't necessarily know the last point, so we can't fully restore continuity check\n        // but we can restore the accumulated value.\n    }\n\n    getTotalDistance(): number {\n        return this.totalDistance;\n    }\n\n    getLapDistance(): number {\n        return this.lapDistance;\n    }\n}\n\nexport const distanceCalculator = new DistanceCalculator();\n","/**\n * Calorie calculation utilities\n *\n * Provides methods to estimate energy expenditure from power (preferred)\n * or heart rate (fallback).\n */\n\n/**\n * Calculate calories burned based on mechanical work (Power).\n * Uses the standard conversion where 1 kJ of mechanical work  1 kcal of energy expenditure.\n * This assumes a mechanical efficiency of ~24% (1 kcal = 4.184 kJ).\n *\n * @param powerWatts - Average power in Watts\n * @param durationSeconds - Duration in seconds\n * @returns Energy expenditure in kcal\n */\nexport function calculateCaloriesFromPower(powerWatts: number, durationSeconds: number): number {\n    if (powerWatts <= 0 || durationSeconds <= 0) return 0;\n\n    // Energy (Joules) = Power (Watts) * Time (Seconds)\n    const joules = powerWatts * durationSeconds;\n\n    // Convert to kJ (which is approx equal to kcal due to human efficiency)\n    return joules / 1000;\n}\n\n/**\n * Calculate calories burned based on Heart Rate.\n * Uses a simplified prediction equation (Keytel et al.) with default assumptions\n * for missing demographic data (Male, 30 years old).\n *\n * @param heartRate - Average heart rate in bpm\n * @param weightKg - User weight in kg\n * @param durationSeconds - Duration in seconds\n * @returns Energy expenditure in kcal\n */\nexport function calculateCaloriesFromHeartRate(heartRate: number, weightKg: number, durationSeconds: number): number {\n    if (heartRate <= 0 || weightKg <= 0 || durationSeconds <= 0) return 0;\n\n    // Default parameters if not provided in settings\n    const age = 30; // Default age\n    // Formula for Male: Cal = [(Age x 0.2017) + (Weight x 0.1988) + (HR x 0.6309)  55.0969] x Time / 4.184\n    // Time in minutes\n\n    const minutes = durationSeconds / 60;\n\n    const termAge = age * 0.2017;\n    const termWeight = weightKg * 0.1988;\n    const termHr = heartRate * 0.6309;\n\n    const caloriesPerMinute = (termAge + termWeight + termHr - 55.0969) / 4.184;\n\n    return Math.max(0, caloriesPerMinute * minutes);\n}\n","interface UpdaterConfig {\n    minInterval: number; // Minimum update interval (ms)\n    maxInterval: number; // Maximum update interval (ms)\n    idleInterval: number; // Interval when no changes detected\n    visibilityAware: boolean; // Reduce updates when page not visible\n}\n\nconst DEFAULT_CONFIG: UpdaterConfig = {\n    minInterval: 100,\n    maxInterval: 1000,\n    idleInterval: 2000,\n    visibilityAware: true,\n};\n\nexport class AdaptiveUpdater {\n    private config: UpdaterConfig;\n    private currentInterval: number;\n    private lastDataChange = 0;\n    private updateTimer: ReturnType<typeof setTimeout> | null = null;\n    private isVisible = true;\n    private subscribers: Set<() => void> = new Set();\n    private cleanupVisibilityListener: (() => void) | null = null;\n\n    constructor(config: Partial<UpdaterConfig> = {}) {\n        this.config = { ...DEFAULT_CONFIG, ...config };\n        this.currentInterval = this.config.minInterval;\n\n        if (this.config.visibilityAware && typeof document !== 'undefined') {\n            const handler = this.handleVisibilityChange.bind(this);\n            document.addEventListener('visibilitychange', handler);\n            this.cleanupVisibilityListener = () => document.removeEventListener('visibilitychange', handler);\n        }\n    }\n\n    private handleVisibilityChange(): void {\n        if (typeof document === 'undefined') return;\n        this.isVisible = document.visibilityState === 'visible';\n\n        if (this.isVisible) {\n            // Resume with fast updates\n            this.currentInterval = this.config.minInterval;\n            this.scheduleUpdate();\n        } else {\n            // Slow down when not visible\n            this.currentInterval = this.config.maxInterval;\n        }\n    }\n\n    /**\n     * Notify that data has changed\n     */\n    notifyDataChange(): void {\n        this.lastDataChange = Date.now();\n\n        // Use fast interval when data is changing\n        if (this.currentInterval > this.config.minInterval) {\n            this.currentInterval = this.config.minInterval;\n            this.scheduleUpdate();\n        }\n    }\n\n    /**\n     * Subscribe to updates\n     */\n    subscribe(callback: () => void): () => void {\n        this.subscribers.add(callback);\n\n        // Start updating if first subscriber\n        if (this.subscribers.size === 1) {\n            this.scheduleUpdate();\n        }\n\n        return () => {\n            this.subscribers.delete(callback);\n\n            // Stop updating if no subscribers\n            if (this.subscribers.size === 0 && this.updateTimer) {\n                clearTimeout(this.updateTimer);\n                this.updateTimer = null;\n            }\n        };\n    }\n\n    private scheduleUpdate(): void {\n        if (this.updateTimer) {\n            clearTimeout(this.updateTimer);\n        }\n\n        this.updateTimer = setTimeout(() => {\n            this.update();\n        }, this.currentInterval);\n\n        if (this.updateTimer && typeof this.updateTimer === 'object' && 'unref' in this.updateTimer) {\n            (this.updateTimer as any).unref();\n        }\n    }\n\n    private update(): void {\n        const now = Date.now();\n\n        // Notify subscribers\n        for (const callback of this.subscribers) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('Update callback error:', e);\n            }\n        }\n\n        // Adapt interval based on data activity\n        const timeSinceDataChange = now - this.lastDataChange;\n\n        if (timeSinceDataChange > 5000) {\n            // No data changes for 5s, slow down\n            this.currentInterval = Math.min(this.currentInterval * 1.5, this.config.idleInterval);\n        } else if (timeSinceDataChange < 1000) {\n            // Recent data changes, speed up\n            this.currentInterval = this.config.minInterval;\n        }\n\n        // Slow down if page not visible\n        if (!this.isVisible) {\n            this.currentInterval = this.config.maxInterval;\n        }\n\n        // Schedule next update\n        if (this.subscribers.size > 0) {\n            this.scheduleUpdate();\n        }\n    }\n\n    destroy(): void {\n        if (this.updateTimer) {\n            clearTimeout(this.updateTimer);\n        }\n        this.subscribers.clear();\n        if (this.cleanupVisibilityListener) {\n            this.cleanupVisibilityListener();\n        }\n    }\n}\n\nexport const dataFieldsUpdater = new AdaptiveUpdater({\n    minInterval: 100,\n    maxInterval: 1000,\n    idleInterval: 2000,\n    visibilityAware: true,\n});\n","/**\n * Measurements State Management\n *\n * Central state container for all workout measurement data.\n * Integrates with IndexedDB for persistent storage and crash recovery.\n *\n * @module MeasurementsState\n */\n\nimport type {\n    Measurement,\n    MeasurementsData,\n    MeasurementType,\n    LapMarker,\n    GpsPoint,\n    TreadmillMeasurement,\n} from './types/measurements.js';\nimport { throttledSave, flushPendingSave, clearActiveWorkout, isIndexedDBSupported } from './storage/workoutStorage.js';\nimport { VALIDATION_LIMITS } from './config/constants.js';\n// import { getSettings } from './config/settings.js'; // Keep for legacy until fully migrated?\n// Actually, I should check if I can remove it. But let's import settingsStore first.\nimport { settingsStore, type UserSettings } from './state/SettingsStore.js';\nimport { stateEventBus } from './state/EventBus.js';\nimport { distanceCalculator } from './state/calculators/DistanceCalculator.js';\nimport { calculateCaloriesFromPower, calculateCaloriesFromHeartRate } from './calculations/calories.js';\nimport { dataFieldsUpdater } from './data-fields/AdaptiveUpdater.js';\n\n/**\n * Callback type for state change notifications\n */\nexport type StateChangeCallback = (state: MeasurementsData) => void;\n\n/**\n * State container for workout measurements.\n *\n * Stores heart rate, power, and cadence measurements with timestamps.\n * Includes validation to reject invalid values.\n * Automatically persists to IndexedDB for crash recovery.\n *\n * @example\n * const state = new MeasurementsState();\n * state.addPower({ timestamp: Date.now(), value: 200 });\n * console.log(state.power); // [{ timestamp: ..., value: 200 }]\n */\nexport class MeasurementsState implements MeasurementsData {\n    heartrate: Measurement[] = [];\n    power: Measurement[] = [];\n    cadence: Measurement[] = [];\n    speed: Measurement[] = [];\n    distance: Measurement[] = [];\n    altitude: Measurement[] = [];\n    energy: Measurement[] = [];\n    gps: GpsPoint[] = [];\n    treadmill: TreadmillMeasurement[] = [];\n    treadmillSpeed: Measurement[] = [];\n    laps: LapMarker[] = [];\n\n    private _persistenceEnabled: boolean;\n    private _startTime: number | null = null;\n    private _onChangeCallbacks: StateChangeCallback[] = [];\n\n    // Energy calculation state\n    private _lastEnergyTime: number = 0;\n    private _lastPowerTime: number = 0;\n    private _totalEnergy: number = 0; // accumulated kcal\n\n    constructor(enablePersistence: boolean = true) {\n        this._persistenceEnabled = enablePersistence && isIndexedDBSupported();\n\n        // Subscribe to adaptive updates\n        dataFieldsUpdater.subscribe(() => {\n            this._dispatchUpdates();\n        });\n\n        // Subscribe to settings changes\n        settingsStore.onChange((settings) => {\n            this.onSettingsChange(settings);\n        });\n\n        // Listen for calculated values\n        stateEventBus.on('distance:update', (data) => {\n            if (this._startTime) {\n                // Ensure timestamp is valid relative to workout?\n                // Or just trust the event?\n                this.addDistance({\n                    timestamp: data.timestamp,\n                    value: data.value,\n                });\n            }\n        });\n\n        if (\n            typeof window !== 'undefined' &&\n            typeof window.addEventListener === 'function' &&\n            typeof document !== 'undefined'\n        ) {\n            // Set up page unload handler to save any pending changes\n            window.addEventListener('beforeunload', () => {\n                flushPendingSave();\n            });\n\n            // Also save on visibility change (mobile browsers)\n            document.addEventListener('visibilitychange', () => {\n                if (document.hidden) {\n                    flushPendingSave();\n                }\n            });\n        }\n    }\n\n    /**\n     * Set the workout start time (used for persistence)\n     */\n    setStartTime(time: number | null): void {\n        this._startTime = time;\n    }\n\n    /**\n     * Get the workout start time\n     */\n    getStartTime(): number | null {\n        return this._startTime;\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: StateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: StateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    private get userWeight(): number {\n        return settingsStore.get('weight');\n    }\n\n    private get gapThreshold(): number {\n        return settingsStore.get('gapThreshold') * 1000; // Convert to ms\n    }\n\n    private onSettingsChange(_settings: UserSettings): void {\n        // Recalculate or handle changes if needed\n        // For now, getters handle the dynamic values\n    }\n\n    /**\n     * Update energy calculation\n     */\n    private _updateEnergy(timestamp: number, value: number, source: 'power' | 'heartrate'): void {\n        const method = settingsStore.get('energyMethod');\n\n        // Only use configured method\n        if (method === 'power' && source !== 'power') return;\n        if (method === 'heartrate' && source !== 'heartrate') return;\n\n        // If combined, we prefer power, but fall back to HR?\n        // Or \"combined\" usually means use power if available, else HR?\n        // For simplicity and to avoid double counting, let's assume 'combined' means smart switching or both contribute to separate buckets?\n        // The original code handled both.\n        // If source is 'heartrate', but we assume power also exists, we shouldn't double add.\n        // Let's implement a simple priority: Power > Heartrate if combined.\n        // But since this method is called per measurement, we need to know context.\n        // If we recently received power, ignore heartrate energy updates?\n\n        // For now, let's stick to the simpler logic of allowing both if 'combined' is set\n        // BUT preventing double counting is hard without knowing implicit state.\n        // Let's assume the user selects one main method or 'combined' means we simply log both if they come in?\n        // Actually, if we use both, we double count calories.\n        // Let's modify logic: If 'combined', use Power. If Power not available (gap), use HR.\n\n        if (method === 'combined') {\n            if (source === 'heartrate') {\n                // If we have recent power data (within gap threshold), ignore HR energy\n                if (timestamp - this._lastPowerTime < this.gapThreshold) {\n                    return;\n                }\n            } else if (source === 'power') {\n                this._lastPowerTime = timestamp;\n            }\n        }\n\n        // Initialize or reset if gap is too large\n        if (this._lastEnergyTime === 0 || timestamp - this._lastEnergyTime > this.gapThreshold) {\n            this._lastEnergyTime = timestamp;\n            return;\n        }\n\n        const dt = (timestamp - this._lastEnergyTime) / 1000;\n        if (dt <= 0) return;\n\n        let kcal = 0;\n        if (source === 'power') {\n            kcal = calculateCaloriesFromPower(value, dt);\n        } else {\n            kcal = calculateCaloriesFromHeartRate(value, this.userWeight, dt);\n        }\n\n        if (kcal > 0) {\n            this._totalEnergy += kcal;\n            // Store cumulative energy point\n            this.energy.push({\n                timestamp,\n                value: this._totalEnergy,\n            });\n        }\n\n        this._lastEnergyTime = timestamp;\n    }\n\n    /**\n     * Dispatch updates to listeners (throttled by AdaptiveUpdater)\n     */\n    private _dispatchUpdates(): void {\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback(this);\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Notify listeners and persist state\n     */\n    private _notifyChange(): void {\n        // Notify adaptive updater\n        dataFieldsUpdater.notifyDataChange();\n\n        // Persist to IndexedDB\n        if (this._persistenceEnabled) {\n            throttledSave(this.toJSON(), this._startTime);\n        }\n    }\n\n    /**\n     * Add a heart rate measurement\n     *\n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 bpm)\n     */\n    addHeartrate(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.heartrate;\n        if (entry.value <= min || entry.value >= max) {\n            console.warn(`Invalid heartrate value: ${entry.value}`);\n            return;\n        }\n        this.heartrate.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n\n        // Calculate energy if power is missing/stale (>5s)\n        if (this._lastPowerTime === 0 || entry.timestamp - this._lastPowerTime > 5000) {\n            this._updateEnergy(entry.timestamp, entry.value, 'heartrate');\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a power measurement\n     *\n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-3000 watts)\n     */\n    addPower(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.power;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid power value: ${entry.value}`);\n            return;\n        }\n        this.power.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n\n        this._lastPowerTime = entry.timestamp;\n        this._updateEnergy(entry.timestamp, entry.value, 'power');\n\n        // Emit granular update for analytics\n        stateEventBus.emit('power:update', {\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a cadence measurement\n     *\n     * @param entry - Measurement with timestamp and value\n     * @throws Logs warning if value is outside valid range (0-300 rpm)\n     */\n    addCadence(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.cadence;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid cadence value: ${entry.value}`);\n            return;\n        }\n        this.cadence.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addSpeed(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid speed value: ${entry.value}`);\n            return;\n        }\n        this.speed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addDistance(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.distance;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid distance value: ${entry.value}`);\n            return;\n        }\n        this.distance.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addAltitude(entry: Measurement): void {\n        const { min, max } = VALIDATION_LIMITS.altitude;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid altitude value: ${entry.value}`);\n            return;\n        }\n        this.altitude.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addTreadmillSpeed(entry: Measurement): void {\n        // Use same limits as speed for now\n        const { min, max } = VALIDATION_LIMITS.speed;\n        if (entry.value < min || entry.value >= max) {\n            console.warn(`Invalid treadmill speed value: ${entry.value}`);\n            return;\n        }\n        this.treadmillSpeed.push({\n            timestamp: entry.timestamp,\n            value: entry.value,\n        });\n        this._notifyChange();\n    }\n\n    addGps(point: GpsPoint): void {\n        this.gps.push(point);\n\n        // Emit for calculators (Distance calculations etc)\n        stateEventBus.emit('gps:update', {\n            timestamp: point.timestamp,\n            latitude: point.lat,\n            longitude: point.lon,\n            altitude: point.altitude !== null ? point.altitude : undefined,\n        });\n\n        // Add speed if available (convert m/s to km/h)\n        if (point.speed !== null) {\n            this.addSpeed({\n                timestamp: point.timestamp,\n                value: point.speed * 3.6,\n            });\n        }\n\n        // Add altitude if available\n        if (point.altitude !== null) {\n            this.addAltitude({\n                timestamp: point.timestamp,\n                value: point.altitude,\n            });\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a measurement of any type\n     *\n     * @param type - The measurement type\n     * @param entry - Measurement with timestamp and value\n     * @throws Error if type is unknown\n     */\n    add(type: MeasurementType, entry: Measurement): void {\n        switch (type) {\n            case 'heartrate':\n                this.addHeartrate(entry);\n                break;\n            case 'power':\n                this.addPower(entry);\n                break;\n            case 'cadence':\n                this.addCadence(entry);\n                break;\n            case 'speed':\n                this.addSpeed(entry);\n                break;\n            case 'distance':\n                this.addDistance(entry);\n                break;\n            case 'altitude':\n                this.addAltitude(entry);\n                break;\n            case 'treadmillSpeed':\n                this.addTreadmillSpeed(entry);\n                break;\n            default:\n                throw new Error(`Unknown measurement type: ${type}`);\n        }\n    }\n\n    /**\n     * Clear all measurements\n     * @param clearPersisted - Also clear persisted data from IndexedDB\n     */\n    async clear(clearPersisted: boolean = true): Promise<void> {\n        this.heartrate = [];\n        this.power = [];\n        this.cadence = [];\n        this.speed = [];\n        this.distance = [];\n        this.altitude = [];\n        this.treadmillSpeed = [];\n        this.laps = [];\n        this._startTime = null;\n\n        if (clearPersisted && this._persistenceEnabled) {\n            await clearActiveWorkout();\n        }\n\n        this._notifyChange();\n    }\n\n    /**\n     * Add a lap marker\n     *\n     * @param startTime - The workout start time for calculating elapsed time\n     * @returns The new lap marker\n     */\n    addLap(startTime: number | null): LapMarker {\n        const timestamp = Date.now();\n        const lapNumber = this.laps.length + 1;\n        const lap: LapMarker = {\n            timestamp,\n            number: lapNumber,\n            elapsedMs: startTime ? timestamp - startTime : undefined,\n        };\n        this.laps.push(lap);\n        this._notifyChange();\n        return lap;\n    }\n\n    /**\n     * Get the current lap count\n     */\n    getLapCount(): number {\n        return this.laps.length;\n    }\n\n    /**\n     * Get all measurements as a plain object\n     */\n    toJSON(): MeasurementsData {\n        return {\n            heartrate: [...this.heartrate],\n            power: [...this.power],\n            cadence: [...this.cadence],\n            speed: [...this.speed],\n            distance: [...this.distance],\n            altitude: [...this.altitude],\n            treadmillSpeed: [...this.treadmillSpeed],\n            gps: [...this.gps],\n            laps: [...this.laps],\n        };\n    }\n\n    /**\n     * Restore state from persisted data\n     * @param data - The measurement data to restore\n     * @param startTime - The workout start time\n     */\n    restore(data: MeasurementsData, startTime: number | null): void {\n        this.heartrate = [...(data.heartrate || [])];\n        this.power = [...(data.power || [])];\n        this.cadence = [...(data.cadence || [])];\n        this.speed = [...(data.speed || [])];\n        this.distance = [...(data.distance || [])];\n        this.altitude = [...(data.altitude || [])];\n        this.treadmillSpeed = [...(data.treadmillSpeed || [])];\n        this.laps = [...(data.laps || [])];\n        this._startTime = startTime;\n\n        // Restore distance calculator state\n        if (this.distance.length > 0) {\n            distanceCalculator.setTotalDistance(this.distance[this.distance.length - 1].value);\n        } else {\n            distanceCalculator.setTotalDistance(0);\n        }\n\n        // Don't persist on restore - data is already persisted\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback(this);\n            } catch (e) {\n                console.error('State change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Enable or disable persistence\n     */\n    setPersistenceEnabled(enabled: boolean): void {\n        this._persistenceEnabled = enabled && isIndexedDBSupported();\n    }\n\n    /**\n     * Check if any measurements have been recorded\n     */\n    hasData(): boolean {\n        return this.heartrate.length > 0 || this.power.length > 0 || this.cadence.length > 0;\n    }\n\n    /**\n     * Get the count of measurements for each type\n     */\n    getCounts(): Record<MeasurementType, number> {\n        return {\n            heartrate: this.heartrate.length,\n            power: this.power.length,\n            cadence: this.cadence.length,\n            speed: this.speed.length,\n            distance: this.distance.length,\n            altitude: this.altitude.length,\n            gps: this.gps.length,\n            treadmillSpeed: this.treadmillSpeed.length,\n            energy: this.energy.length,\n        };\n    }\n\n    /**\n     * Add a treadmill measurement\n     *\n     * @param entry - Treadmill measurement (speed/incline)\n     */\n    addTreadmillData(entry: TreadmillMeasurement): void {\n        this.treadmill.push(entry);\n\n        if (entry.speed != null) {\n            const measurement = {\n                timestamp: entry.timestamp,\n                value: entry.speed,\n            };\n\n            // Add to specific treadmill Speed metric\n            this.addTreadmillSpeed(measurement);\n\n            // Speed from treadmill is already in km/h\n            this.addSpeed(measurement);\n        }\n\n        // Note: We don't explicitly notifyChange here if addSpeed/addTreadmillSpeed was called,\n        // because they call it. But if only incline changed, we must notify.\n        if (entry.speed == null) {\n            this._notifyChange();\n        }\n    }\n}\n","import { MeasurementsState } from '../measurements-state.js';\nimport type { ConnectionsState } from '../types/connections.js';\nimport { settingsStore, type SettingsStore } from './SettingsStore.js';\nimport type { TimeState } from '../getInitState.js';\n\nexport interface AppState {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n    settings: SettingsStore;\n}\n\nlet appState: AppState | null = null;\n\nexport function initializeState(): AppState {\n    if (appState) {\n        console.warn('State already initialized');\n        return appState;\n    }\n\n    appState = {\n        measurementsState: new MeasurementsState(),\n        connectionsState: {\n            power: { isConnected: false, disconnect: null },\n            heartrate: { isConnected: false, disconnect: null },\n            cadence: { isConnected: false, disconnect: null },\n            speed: { isConnected: false, disconnect: null },\n            gps: { isConnected: false, disconnect: null },\n            treadmill: { isConnected: false, disconnect: null },\n        },\n        timeState: {\n            running: false,\n            startTime: null,\n            endTime: null,\n        },\n        // In the plan it says 'typeof settingsStore' but that refers to the class generally in TS if used as type,\n        // here we want the instance type. \"typeof settingsStore\" matches the instance variable type.\n        // Actually, let's just use the instance directly.\n        settings: settingsStore,\n    };\n\n    // Initialize settings\n    settingsStore.initialize();\n\n    return appState;\n}\n\nexport function getState(): AppState {\n    if (!appState) {\n        throw new Error('State not initialized. Call initializeState() first.');\n    }\n    return appState;\n}\n\n// For testing only\nexport function resetState(): void {\n    appState = null;\n}\n\n// Development/testing helpers (only available in dev mode)\nif (import.meta.env.DEV) {\n    (window as any).__getAppState = getState;\n    (window as any).__resetState = resetState;\n}\n","/**\n * Test exposure utilities\n *\n * Exposes application state for end-to-end testing.\n *\n * @module exposeVariablesDuringTest\n */\n\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { ConnectionsState } from './types/connections.js';\n\n/**\n * Extended window interface for test variables\n */\ndeclare global {\n    interface Window {\n        bike?: MeasurementsState;\n        connectionsState?: ConnectionsState;\n    }\n}\n\n/**\n * Parameters for test exposure\n */\ninterface ExposeTestVariablesParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n}\n\n/**\n * Exposes application state variables on the window object for E2E testing.\n *\n * This allows Playwright and other testing frameworks to access and verify\n * application state during tests.\n *\n * @param params - Object containing state objects to expose\n *\n * @example\n * // In test:\n * const state = await page.evaluate(() => window.bike);\n */\nexport function exposeVariablesDuringTest({ measurementsState, connectionsState }: ExposeTestVariablesParams): void {\n    // Always expose in non-production builds for testing purposes\n    if (typeof window !== 'undefined') {\n        window.bike = measurementsState;\n        window.connectionsState = connectionsState;\n    }\n}\n","import { registerPlugin } from '@capacitor/core';\nconst App = registerPlugin('App', {\n    web: () => import('./web').then((m) => new m.AppWeb()),\n});\nexport * from './definitions';\nexport { App };\n//# sourceMappingURL=index.js.map","import { View } from './View.js';\nimport { IRouter } from './types.js';\nimport { Capacitor } from '@capacitor/core';\nimport { App } from '@capacitor/app';\n\ntype ViewLoader = () => Promise<View>;\n\ninterface Route {\n    path: string;\n    viewId: string;\n}\n\nexport class Router implements IRouter {\n    private views: Map<string, View> = new Map();\n    private lazyViews: Map<string, ViewLoader> = new Map();\n    private routes: Route[] = [];\n    private currentViewId: string | null = null;\n    private container: HTMLElement;\n    private isNative: boolean;\n\n    constructor(container: HTMLElement) {\n        this.container = container;\n        this.isNative = Capacitor.isNativePlatform();\n\n        // Handle browser back/forward buttons and hash changes\n        window.addEventListener('popstate', () => {\n            this.handleLocationChange();\n        });\n\n        // Also listen for hash changes (for Capacitor/native)\n        if (this.isNative) {\n            window.addEventListener('hashchange', () => {\n                this.handleLocationChange();\n            });\n        }\n\n        // Hardware back button handling for Capacitor\n        if (this.isNative) {\n            App.addListener('backButton', ({ canGoBack }) => {\n                if (canGoBack) {\n                    window.history.back();\n                } else {\n                    App.exitApp();\n                }\n            });\n        }\n    }\n\n    /**\n     * Register a view with the router.\n     */\n    public registerView(view: View): void {\n        this.views.set(view.id, view);\n\n        // Find existing container or create one\n        let viewContainer = document.getElementById(`page-${view.id}`);\n\n        if (!viewContainer) {\n            viewContainer = document.createElement('div');\n            viewContainer.id = `page-${view.id}`;\n            viewContainer.className = 'page-view';\n            viewContainer.style.display = 'none'; // Hidden by default\n            this.container.appendChild(viewContainer);\n        }\n\n        // Initialize the view with its container\n        view.init(viewContainer);\n    }\n\n    /**\n     * Register a lazy view loader.\n     */\n    public registerLazyView(viewId: string, loader: ViewLoader): void {\n        this.lazyViews.set(viewId, loader);\n    }\n\n    /**\n     * Add a route mapping to a view.\n     */\n    public addRoute(path: string, viewId: string): void {\n        this.routes.push({ path, viewId });\n    }\n\n    /**\n     * Navigate to a specific path.\n     * Uses hash-based routing on native platforms for better compatibility.\n     */\n    public navigate(path: string, replace = false): void {\n        if (this.isNative) {\n            // Use hash-based routing on Capacitor/native for file:// compatibility\n            if (replace) {\n                window.location.replace('#' + path);\n            } else {\n                window.location.hash = path;\n            }\n        } else {\n            // Use History API for web browsers\n            if (replace) {\n                window.history.replaceState({}, '', path);\n            } else {\n                window.history.pushState({}, '', path);\n            }\n            this.handleLocationChange();\n        }\n    }\n\n    /**\n     * Start the router and load the initial view.\n     */\n    public start(): void {\n        if (this.isNative) {\n            // On native, start with initial hash check\n            if (!window.location.hash) {\n                // If no hash, default to root\n                window.location.hash = '/';\n            }\n        }\n        this.handleLocationChange();\n    }\n\n    /**\n     * Go back in history.\n     */\n    public back(): void {\n        window.history.back();\n    }\n\n    /**\n     * Handle location changes (popstate or navigate).\n     */\n    private async handleLocationChange(): Promise<void> {\n        let path: string;\n\n        if (this.isNative) {\n            // On native platforms, use hash-based routing\n            // Hash format: #/path -> extract '/path'\n            const hash = window.location.hash;\n            path = hash ? hash.slice(1) : '/';\n            // Normalize empty hash to root\n            if (!path || path === '') {\n                path = '/';\n            }\n        } else {\n            // On web, use pathname\n            path = window.location.pathname;\n            // Normalize /index.html to /\n            if (path.endsWith('/index.html') || path.endsWith('.html')) {\n                path = '/';\n            }\n        }\n\n        // Simple matching logic\n        let matchedRoute = this.routes.find((r) => r.path === path);\n\n        // Fallback to strict root or first registered route if no match\n        // Useful for initial load if path is just \"/\" or empty\n        if (!matchedRoute) {\n            matchedRoute = this.routes.find((r) => r.path === '/') || this.routes[0];\n        }\n\n        if (matchedRoute) {\n            await this.switchView(matchedRoute.viewId);\n        }\n    }\n\n    /**\n     * Switch the visible view.\n     */\n    private async switchView(viewId: string): Promise<void> {\n        if (this.currentViewId === viewId) return;\n\n        // Check if loading is needed\n        if (!this.views.has(viewId)) {\n            const loader = this.lazyViews.get(viewId);\n            if (loader) {\n                try {\n                    const view = await loader();\n                    this.registerView(view);\n                } catch (error) {\n                    console.error(`Failed to load view for ${viewId}:`, error);\n                    return;\n                }\n            } else {\n                console.warn(`View ${viewId} not registered.`);\n                return;\n            }\n        }\n\n        // Leave current view\n        if (this.currentViewId) {\n            const currentView = this.views.get(this.currentViewId);\n            if (currentView) {\n                currentView.onLeave();\n                const el = document.getElementById(`page-${this.currentViewId}`);\n                if (el) el.style.display = 'none';\n            }\n        }\n\n        // Enter new view\n        const newView = this.views.get(viewId);\n        if (newView) {\n            const el = document.getElementById(`page-${viewId}`);\n            if (el) el.style.display = '';\n            newView.onEnter();\n            this.currentViewId = viewId;\n\n            // Dispatch event for UI updates (e.g. Nav Bar)\n            window.dispatchEvent(new CustomEvent('route-changed', { detail: { viewId } }));\n        }\n    }\n}\n","import { View } from '../router/View.js';\n\nexport class DashboardView implements View {\n    public id = 'dashboard';\n\n    public init(_container: HTMLElement): void {\n        console.log('Dashboard View initialized');\n    }\n\n    public onEnter(): void {\n        console.log('Entered Dashboard View');\n    }\n\n    public onLeave(): void {\n        console.log('Left Dashboard View');\n    }\n}\n","/**\n * View IDs for application navigation\n */\nexport enum ViewId {\n    Dashboard = 'dashboard',\n    History = 'history',\n    Workouts = 'workouts',\n    Fitness = 'fitness',\n    Settings = 'settings',\n    Plans = 'plans',\n    RacePredictor = 'race-predictor',\n    VO2max = 'vo2max',\n    Debug = 'debug',\n    Help = 'help',\n}\n","/**\n * Navigation Bar Component\n *\n * Handles the bottom navigation bar.\n */\n\nimport { IRouter } from '../router/types.js';\nimport { ViewId } from '../router/view-ids.js';\n\nexport class NavBar {\n    private container: HTMLElement;\n    private router: IRouter;\n\n    constructor(router: IRouter) {\n        this.router = router;\n        this.container = document.createElement('nav');\n        this.container.id = 'bottom-nav';\n        this.container.className = 'bottom-nav';\n\n        // Mobile-first styles should be in CSS, but injecting basic structure here\n        this.render();\n        document.body.appendChild(this.container);\n\n        // Listen for route changes\n        window.addEventListener('route-changed', (e: Event) => {\n            const detail = (e as CustomEvent).detail;\n            this.setActive(detail.viewId);\n        });\n    }\n\n    private render(): void {\n        this.container.innerHTML = `\n            <button class=\"nav-item active\" data-target=\"${ViewId.Dashboard}\" data-testid=\"nav-dashboard\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Dashboard</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.History}\" data-testid=\"nav-history\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">History</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Workouts}\" data-testid=\"nav-workouts\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Workouts</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Fitness}\" data-testid=\"nav-fitness\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Fitness</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Plans}\" data-testid=\"nav-plans\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Plans</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Settings}\" data-testid=\"nav-settings\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Settings</span>\n            </button>\n            <button class=\"nav-item\" data-target=\"${ViewId.Debug}\" data-testid=\"nav-debug\">\n                <span class=\"nav-icon\"></span>\n                <span class=\"nav-label\">Debug</span>\n            </button>\n        `;\n\n        this.container.querySelectorAll('.nav-item').forEach((btn) => {\n            btn.addEventListener('click', () => {\n                const target = (btn as HTMLElement).dataset.target;\n                if (target === ViewId.Dashboard) {\n                    this.router.navigate('/');\n                } else if (target) {\n                    this.router.navigate('/' + target);\n                }\n            });\n        });\n    }\n\n    public setActive(viewId: string): void {\n        this.container.querySelectorAll('.nav-item').forEach((btn) => {\n            const target = (btn as HTMLElement).dataset.target;\n            if (target === viewId) {\n                btn.classList.add('active');\n                btn.setAttribute('aria-current', 'page');\n            } else {\n                btn.classList.remove('active');\n                btn.removeAttribute('aria-current');\n            }\n        });\n    }\n}\n","/**\n * Safely select a DOM element by ID.\n * Throws a specific error if the element is not found,\n * allowing for easier debugging than standard null pointer exceptions.\n *\n * @param id The ID of the element to select\n * @returns The selected element\n * @throws Error if element not found\n */\nexport function selectElement<T extends HTMLElement>(id: string): T {\n    const element = document.getElementById(id);\n    if (!element) {\n        throw new Error(`Critical DOM element missing: #${id}. Ensure index.html is correct.`);\n    }\n    return element as T;\n}\n","import { Router } from '../router/Router.js';\nimport { DashboardView } from '../views/DashboardView.js';\nimport { NavBar } from '../components/NavBar.js';\nimport { ViewId } from '../router/view-ids.js';\nimport { selectElement } from '../utils/dom.js';\n\n/**\n * Initializes the Router, registers Views, and sets up the Navigation Bar.\n */\nexport function setupRouter(): Router {\n    const router = new Router(selectElement('mainContent'));\n\n    const dashboardView = new DashboardView();\n    router.registerView(dashboardView);\n\n    // Register Lazy Views\n    router.registerLazyView(ViewId.History, () => import('../views/HistoryView.js').then((m) => new m.HistoryView()));\n    router.registerLazyView(ViewId.Workouts, () =>\n        import('../views/WorkoutsView.js').then((m) => new m.WorkoutsView())\n    );\n    router.registerLazyView(ViewId.Fitness, () => import('../views/FitnessView.js').then((m) => new m.FitnessView()));\n    router.registerLazyView(ViewId.Settings, () =>\n        import('../views/SettingsView.js').then((m) => new m.SettingsView())\n    );\n    router.registerLazyView(ViewId.Plans, () => import('../views/PlansView.js').then((m) => new m.PlansView()));\n    router.registerLazyView(ViewId.RacePredictor, () =>\n        import('../views/RacePredictorView.js').then((m) => new m.RacePredictorView())\n    );\n    router.registerLazyView(ViewId.VO2max, () => import('../views/VO2maxView.js').then((m) => new m.VO2maxView()));\n    router.registerLazyView(ViewId.Debug, () => import('../views/DebugView.js').then((m) => new m.DebugView()));\n    router.registerLazyView(ViewId.Help, () => import('../views/HelpView.js').then((m) => new m.HelpView()));\n\n    router.addRoute('/', ViewId.Dashboard);\n    router.addRoute('/history', ViewId.History);\n    router.addRoute('/workouts', ViewId.Workouts);\n    router.addRoute('/fitness', ViewId.Fitness);\n    router.addRoute('/plans', ViewId.Plans);\n    router.addRoute('/race-predictor', ViewId.RacePredictor);\n    router.addRoute('/vo2max', ViewId.VO2max);\n    router.addRoute('/settings', ViewId.Settings);\n    router.addRoute('/debug', ViewId.Debug);\n    router.addRoute('/help', ViewId.Help);\n\n    // Initialize Navigation Bar\n    new NavBar(router);\n\n    // Wire up Sidebar Settings Button (for mobile/hamburger menu)\n    const settingsButton = document.getElementById('settingsButton');\n    if (settingsButton) {\n        settingsButton.addEventListener('click', () => {\n            router.navigate('/settings');\n            // Close the details menu if open\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar Workouts Button\n    const workoutsButton = document.getElementById('workoutsButton');\n    if (workoutsButton) {\n        workoutsButton.addEventListener('click', () => {\n            router.navigate('/workouts');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar Plans Button\n    const plansButton = document.getElementById('plansButton');\n    if (plansButton) {\n        plansButton.addEventListener('click', () => {\n            router.navigate('/plans');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar Race Predictor Button\n    const racePredictorButton = document.getElementById('racePredictorButton');\n    if (racePredictorButton) {\n        racePredictorButton.addEventListener('click', () => {\n            router.navigate('/race-predictor');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar VO2max Button\n    const vo2maxButton = document.getElementById('vo2maxButton');\n    if (vo2maxButton) {\n        vo2maxButton.addEventListener('click', () => {\n            router.navigate('/vo2max');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    // Wire up Sidebar Help Button\n    const aboutButton = document.getElementById('aboutButton');\n    if (aboutButton) {\n        aboutButton.addEventListener('click', () => {\n            router.navigate('/help');\n            const details = document.querySelector('nav details') as HTMLDetailsElement;\n            if (details) {\n                details.open = false;\n            }\n        });\n    }\n\n    return router;\n}\n","/**\n * Time formatting utilities\n *\n * @module getTimestring\n */\n\n/**\n * Converts milliseconds to a formatted time string (HH:MM:SS)\n *\n * @param milliseconds - Time duration in milliseconds\n * @returns Formatted time string in HH:MM:SS format\n *\n * @example\n * getTimestring(3661000) // \"01:01:01\"\n * getTimestring(0)       // \"00:00:00\"\n */\nexport const getTimestring = (milliseconds: number): string => {\n    const totalSeconds = Math.floor(milliseconds / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    return (\n        `${hours.toString().padStart(2, '0')}:` +\n        `${minutes.toString().padStart(2, '0')}:` +\n        `${seconds.toString().padStart(2, '0')}`\n    );\n};\n","/**\n * Workout Library\n *\n * Pre-built structured workouts.\n */\n\nimport type { StructuredWorkout, WorkoutStep } from './types.js';\n\n// Helper to generate ramp steps\nconst generateRampSteps = (startWatts: number, stepWatts: number, steps: number): WorkoutStep[] => {\n    return Array.from({ length: steps }).map((_, i) => {\n        const watts = startWatts + i * stepWatts;\n        return {\n            type: 'active',\n            duration: 60,\n            target: { type: 'power', unit: 'watts', value: watts },\n            name: `Step ${i + 1}`,\n            description: `${watts} Watts`,\n        };\n    });\n};\n\nconst RAMP_TEST: StructuredWorkout = {\n    id: 'ramp-test',\n    name: 'Ramp Test',\n    description: 'Standard Ramp Test to estimate FTP. Start at 100W, increase by 20W every minute until failure.',\n    tags: ['test', 'ftp'],\n    category: 'Testing',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 300,\n            target: { type: 'open', unit: 'watts', min: 80, max: 120 },\n            description: 'Free warmup',\n        },\n        ...generateRampSteps(100, 20, 25), // Up to 600W\n    ],\n};\n\nconst FTP_TEST_20MIN: StructuredWorkout = {\n    id: 'ftp-test-20min',\n    name: '20 Minute FTP Test',\n    description: 'Standard 20 minute time trial protocol. Includes 5 min blowout efforts.',\n    tags: ['test', 'ftp', 'threshold'],\n    category: 'Testing',\n    steps: [\n        // Warmup 20m\n        {\n            type: 'warmup',\n            duration: 1200,\n            target: { type: 'power', unit: 'percent_ftp', value: 65 },\n            name: 'Warmup',\n            description: 'Endurance pace',\n        },\n        // 3 x 1min fast pedaling\n        {\n            type: 'active',\n            duration: 60,\n            target: { type: 'cadence', unit: 'rpm', value: 100 },\n            name: 'Fast Pedal',\n            description: '100+ RPM',\n        },\n        {\n            type: 'rest',\n            duration: 60,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Easy',\n            description: 'Recover',\n        },\n        {\n            type: 'active',\n            duration: 60,\n            target: { type: 'cadence', unit: 'rpm', value: 100 },\n            name: 'Fast Pedal',\n            description: '100+ RPM',\n        },\n        {\n            type: 'rest',\n            duration: 60,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Easy',\n            description: 'Recover',\n        },\n        {\n            type: 'active',\n            duration: 60,\n            target: { type: 'cadence', unit: 'rpm', value: 100 },\n            name: 'Fast Pedal',\n            description: '100+ RPM',\n        },\n        {\n            type: 'rest',\n            duration: 300,\n            target: { type: 'power', unit: 'percent_ftp', value: 65 },\n            name: 'Easy',\n            description: 'Recover',\n        },\n        // 5 min blowout\n        {\n            type: 'active',\n            duration: 300,\n            target: { type: 'power', unit: 'percent_ftp', value: 110 },\n            name: 'Blowout Effort',\n            description: 'Hard effort (VO2 Max)',\n        },\n        // 10 min easy\n        {\n            type: 'rest',\n            duration: 600,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Recovery',\n            description: 'Establish baseline',\n        },\n        // THE TEST\n        {\n            type: 'active',\n            duration: 1200,\n            target: { type: 'open', unit: 'percent_ftp', min: 90, max: 110 },\n            name: '20 Min Test',\n            description: 'MAXIMUM SUSTAINABLE EFFORT',\n        },\n        // Cooldown\n        {\n            type: 'cooldown',\n            duration: 900,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Cooldown',\n            description: 'Easy spin',\n        },\n    ],\n};\n\nconst THRESHOLD_2X20: StructuredWorkout = {\n    id: 'threshold-2x20',\n    name: '2x20 Threshold',\n    description: 'Classic threshold measurement workout. 2 intervals of 20 minutes at FTP with 5 min recovery.',\n    tags: ['test', 'ftp', 'threshold'],\n    category: 'Threshold',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 900,\n            target: { type: 'power', unit: 'percent_ftp', min: 40, max: 70 },\n            name: 'Warmup',\n            description: 'Progressive warmup',\n        },\n        {\n            type: 'active',\n            duration: 1200,\n            target: { type: 'power', unit: 'percent_ftp', value: 100 },\n            name: 'Interval 1',\n            description: 'Threshold effort',\n        },\n        {\n            type: 'recovery',\n            duration: 300,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Recovery',\n            description: 'Easy spin',\n        },\n        {\n            type: 'active',\n            duration: 1200,\n            target: { type: 'power', unit: 'percent_ftp', value: 100 },\n            name: 'Interval 2',\n            description: 'Threshold effort',\n        },\n        {\n            type: 'cooldown',\n            duration: 900,\n            target: { type: 'power', unit: 'percent_ftp', min: 60, max: 40 },\n            name: 'Cooldown',\n            description: 'Cool down',\n        },\n    ],\n};\n\nconst SWEET_SPOT_3X10: StructuredWorkout = {\n    id: 'sweet-spot-3x10',\n    name: 'Sweet Spot 3x10',\n    description: 'Classic Sweet Spot workout. 3 intervals of 10 minutes at 90% FTP.',\n    tags: ['sweet-spot', 'aerobic'],\n    category: 'Sweet Spot',\n    steps: [\n        { type: 'warmup', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Warmup' },\n        // Interval 1\n        {\n            type: 'active',\n            duration: 600,\n            target: { type: 'power', unit: 'percent_ftp', value: 90 },\n            name: 'Sweet Spot',\n        },\n        {\n            type: 'recovery',\n            duration: 300,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Recovery',\n        },\n        // Interval 2\n        {\n            type: 'active',\n            duration: 600,\n            target: { type: 'power', unit: 'percent_ftp', value: 90 },\n            name: 'Sweet Spot',\n        },\n        {\n            type: 'recovery',\n            duration: 300,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Recovery',\n        },\n        // Interval 3\n        {\n            type: 'active',\n            duration: 600,\n            target: { type: 'power', unit: 'percent_ftp', value: 90 },\n            name: 'Sweet Spot',\n        },\n        {\n            type: 'cooldown',\n            duration: 600,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Cooldown',\n        },\n    ],\n};\n\nconst VO2_MAX_30_30: StructuredWorkout = {\n    id: 'vo2-30-30',\n    name: 'VO2 Max 30/30s',\n    description: 'High intensity intervals. 2 sets of 8x 30s ON / 30s OFF.',\n    tags: ['vo2max', 'hiit'],\n    category: 'VO2 Max',\n    steps: [\n        { type: 'warmup', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Warmup' },\n        { type: 'warmup', duration: 60, target: { type: 'power', unit: 'percent_ftp', value: 100 }, name: 'Opener' },\n        { type: 'rest', duration: 120, target: { type: 'power', unit: 'percent_ftp', value: 50 }, name: 'Recover' },\n\n        // Set 1 (8 reps)\n        ...Array.from({ length: 8 }).flatMap(\n            (_, i) =>\n                [\n                    {\n                        type: 'active',\n                        duration: 30,\n                        target: { type: 'power', unit: 'percent_ftp', value: 120 },\n                        name: `Rep ${i + 1}`,\n                    },\n                    {\n                        type: 'rest',\n                        duration: 30,\n                        target: { type: 'power', unit: 'percent_ftp', value: 50 },\n                        name: 'Float',\n                    },\n                ] as WorkoutStep[]\n        ),\n\n        {\n            type: 'rest',\n            duration: 300,\n            target: { type: 'power', unit: 'percent_ftp', value: 50 },\n            name: 'Set Recovery',\n        },\n\n        // Set 2 (8 reps)\n        ...Array.from({ length: 8 }).flatMap(\n            (_, i) =>\n                [\n                    {\n                        type: 'active',\n                        duration: 30,\n                        target: { type: 'power', unit: 'percent_ftp', value: 120 },\n                        name: `Rep ${i + 1}`,\n                    },\n                    {\n                        type: 'rest',\n                        duration: 30,\n                        target: { type: 'power', unit: 'percent_ftp', value: 50 },\n                        name: 'Float',\n                    },\n                ] as WorkoutStep[]\n        ),\n\n        {\n            type: 'cooldown',\n            duration: 600,\n            target: { type: 'power', unit: 'percent_ftp', value: 40 },\n            name: 'Cooldown',\n        },\n    ],\n};\n\nconst RUNNING_EASY_30: StructuredWorkout = {\n    id: 'run-easy-30',\n    name: 'Easy Run 30min (Run)',\n    description: 'Steady state run at a comfortable aerobic pace (Zone 2).',\n    tags: ['run', 'easy', 'aerobic'],\n    category: 'Running',\n    steps: [\n        {\n            type: 'active',\n            duration: 1800,\n            target: { type: 'pace', unit: 'min_km', min: 5.5, max: 6.5 },\n            description: 'Easy Pace (5:30-6:30)',\n        },\n    ],\n};\n\nconst RUNNING_TEMPO: StructuredWorkout = {\n    id: 'run-tempo-threshold',\n    name: 'Threshold Tempo (Run)',\n    description: 'Warmup, then 20 minutes at Threshold pace.',\n    tags: ['run', 'tempo', 'threshold'],\n    category: 'Running',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 600,\n            target: { type: 'pace', unit: 'min_km', min: 6.0, max: 7.0 },\n            description: 'Easy Jog',\n        },\n        {\n            type: 'active',\n            duration: 1200,\n            target: { type: 'pace', unit: 'min_km', value: 4.5 },\n            description: 'Threshold Pace (4:30)',\n        },\n        {\n            type: 'cooldown',\n            duration: 600,\n            target: { type: 'pace', unit: 'min_km', min: 6.0, max: 7.0 },\n            description: 'Cooldown',\n        },\n    ],\n};\n\nconst RUNNING_INTERVALS_400: StructuredWorkout = {\n    id: 'run-intervals-400',\n    name: 'Track 8x400m (Run)',\n    description: 'Classic speed workout. 8x400m at Interval pace with 90s recovery.',\n    tags: ['run', 'intervals', 'speed'],\n    category: 'Running',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 900,\n            target: { type: 'pace', unit: 'min_km', min: 6.0, max: 7.0 },\n            description: 'Warmup',\n        },\n        ...Array.from({ length: 8 }).flatMap(\n            (_, i) =>\n                [\n                    {\n                        type: 'active' as const,\n                        duration: 90,\n                        target: { type: 'pace', unit: 'min_km', value: 3.75 },\n                        name: `Interval ${i + 1}`,\n                        description: '400m Fast (3:45 pace)',\n                    },\n                    {\n                        type: 'recovery' as const,\n                        duration: 90,\n                        target: { type: 'pace', unit: 'min_km', min: 6.5, max: 7.5 },\n                        description: 'Recovery',\n                    },\n                ] as WorkoutStep[]\n        ),\n        {\n            type: 'cooldown',\n            duration: 600,\n            target: { type: 'pace', unit: 'min_km', min: 6.0, max: 7.0 },\n            description: 'Cooldown',\n        },\n    ],\n};\n\nconst RUNNING_LONG_PROGRESSIVE: StructuredWorkout = {\n    id: 'run-long-progressive',\n    name: 'Long Run Progressive (Run)',\n    description: '60 min run getting faster every 15 mins.',\n    tags: ['run', 'long', 'endurance'],\n    category: 'Running',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 900,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: 'Easy Start (6:00)',\n        },\n        {\n            type: 'active',\n            duration: 900,\n            target: { type: 'pace', unit: 'min_km', value: 5.5 },\n            description: 'Steady (5:30)',\n        },\n        {\n            type: 'active',\n            duration: 900,\n            target: { type: 'pace', unit: 'min_km', value: 5.0 },\n            description: 'Marathon Pace (5:00)',\n        },\n        {\n            type: 'cooldown',\n            duration: 900,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: 'Cooldown (6:00)',\n        },\n    ],\n};\n\nconst RUNNING_FARTLEK: StructuredWorkout = {\n    id: 'run-fartlek',\n    name: 'Fartlek Speed Play (Run)',\n    description: '1 min hard, 1 min easy, 2 min hard, 2 min easy...',\n    tags: ['run', 'fartlek'],\n    category: 'Running',\n    steps: [\n        {\n            type: 'warmup',\n            duration: 600,\n            target: { type: 'pace', unit: 'min_km', min: 6, max: 7 },\n            description: 'Warmup',\n        },\n        {\n            type: 'active',\n            duration: 60,\n            target: { type: 'pace', unit: 'min_km', value: 4.0 },\n            description: '1 min Hard',\n        },\n        {\n            type: 'recovery',\n            duration: 60,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: '1 min Easy',\n        },\n        {\n            type: 'active',\n            duration: 120,\n            target: { type: 'pace', unit: 'min_km', value: 4.0 },\n            description: '2 min Hard',\n        },\n        {\n            type: 'recovery',\n            duration: 120,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: '2 min Easy',\n        },\n        {\n            type: 'active',\n            duration: 180,\n            target: { type: 'pace', unit: 'min_km', value: 4.0 },\n            description: '3 min Hard',\n        },\n        {\n            type: 'recovery',\n            duration: 180,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: '3 min Easy',\n        },\n        {\n            type: 'active',\n            duration: 120,\n            target: { type: 'pace', unit: 'min_km', value: 4.0 },\n            description: '2 min Hard',\n        },\n        {\n            type: 'recovery',\n            duration: 120,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: '2 min Easy',\n        },\n        {\n            type: 'active',\n            duration: 60,\n            target: { type: 'pace', unit: 'min_km', value: 4.0 },\n            description: '1 min Hard',\n        },\n        {\n            type: 'recovery',\n            duration: 60,\n            target: { type: 'pace', unit: 'min_km', value: 6.0 },\n            description: '1 min Easy',\n        },\n        {\n            type: 'cooldown',\n            duration: 600,\n            target: { type: 'pace', unit: 'min_km', min: 6, max: 7 },\n            description: 'Cooldown',\n        },\n    ],\n};\n\nexport const WORKOUT_LIBRARY: StructuredWorkout[] = [\n    RAMP_TEST,\n    FTP_TEST_20MIN,\n    THRESHOLD_2X20,\n    SWEET_SPOT_3X10,\n    VO2_MAX_30_30,\n    RUNNING_EASY_30,\n    RUNNING_TEMPO,\n    RUNNING_INTERVALS_400,\n    RUNNING_LONG_PROGRESSIVE,\n    RUNNING_FARTLEK,\n];\n\nexport function getWorkoutById(id: string): StructuredWorkout | undefined {\n    return WORKOUT_LIBRARY.find((w) => w.id === id);\n}\n\n/**\n * Calculate total duration in seconds\n */\nexport function getWorkoutDuration(workout: StructuredWorkout): number {\n    return workout.steps.reduce((acc, step) => acc + step.duration, 0);\n}\n","/**\n * User Profile Storage\n *\n * Manages persistence of user settings (FTP, Weight, Max HR).\n */\n\n/**\n * User profile settings for training zones\n */\nexport interface UserProfile {\n    /** Functional Threshold Power in watts */\n    ftp: number | null;\n    /** Maximum heart rate in bpm */\n    maxHr: number | null;\n    /** Body weight in kg */\n    weight: number | null;\n    /** Age in years (for VO2max estimation) */\n    age: number | null;\n    /** Resting heart rate in bpm (for VO2max estimation) */\n    restingHr: number | null;\n    /** Biological sex (for VO2max norms) */\n    gender: 'male' | 'female' | null;\n    /** Whether onboarding has been completed */\n    onboardingComplete: boolean;\n    /** Timestamp of last profile update */\n    lastUpdated: number | null;\n}\n\n/** Storage key for user profile */\nexport const PROFILE_KEY = 'bpt-user-profile';\n\n/** Default profile values */\nexport const defaultProfile: UserProfile = {\n    ftp: null,\n    maxHr: null,\n    weight: null,\n    age: null,\n    restingHr: null,\n    gender: null,\n    onboardingComplete: false,\n    lastUpdated: null,\n};\n\n/**\n * Load user profile from localStorage\n */\nexport function loadUserProfile(): UserProfile {\n    try {\n        if (typeof localStorage === 'undefined') {\n            return { ...defaultProfile };\n        }\n        const stored = localStorage.getItem(PROFILE_KEY);\n        if (stored) {\n            return { ...defaultProfile, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load user profile:', e);\n    }\n    return { ...defaultProfile };\n}\n\n/**\n * Save user profile to localStorage\n */\nexport function saveUserProfile(profile: UserProfile): void {\n    try {\n        if (typeof localStorage === 'undefined') {\n            console.warn('localStorage not available, profile not saved');\n            return;\n        }\n        profile.lastUpdated = Date.now();\n        localStorage.setItem(PROFILE_KEY, JSON.stringify(profile));\n    } catch (e) {\n        console.warn('Failed to save user profile:', e);\n    }\n}\n","/**\n * Audio cues for workouts and notifications\n * Using Web Audio API for synthetic sounds (no assets needed)\n * and SpeechSynthesis for voice announcements.\n */\n\nclass AudioController {\n    private audioCtx: AudioContext | null = null;\n    private gainNode: GainNode | null = null;\n    private musicGainNode: GainNode | null = null;\n    private isMuted: boolean = false;\n    private keepAliveSource: AudioBufferSourceNode | null = null;\n\n    constructor() {\n        // Initialize AudioContext on first user interaction if possible\n        // But for now we just prepare it.\n        // Modern browsers require user gesture to resume AudioContext.\n    }\n\n    public init() {\n        this.ensureContext();\n    }\n\n    /**\n     * Start a silent loop to keep the AudioContext active in background (iOS/Android)\n     */\n    public startBackgroundKeepAlive() {\n        this.ensureContext();\n        if (!this.audioCtx || this.keepAliveSource) return;\n\n        // Create a 1-second silent buffer\n        const buffer = this.audioCtx.createBuffer(1, this.audioCtx.sampleRate, this.audioCtx.sampleRate);\n        const channel = buffer.getChannelData(0);\n        for (let i = 0; i < channel.length; i++) {\n            channel[i] = 0; // Silence\n        }\n\n        this.keepAliveSource = this.audioCtx.createBufferSource();\n        this.keepAliveSource.buffer = buffer;\n        this.keepAliveSource.loop = true;\n\n        // Connect to destination (it's silent anyway)\n        this.keepAliveSource.connect(this.audioCtx.destination);\n        this.keepAliveSource.start();\n        console.log('Audio KeepAlive started');\n    }\n\n    /**\n     * Stop the silent loop\n     */\n    public stopBackgroundKeepAlive() {\n        if (this.keepAliveSource) {\n            try {\n                this.keepAliveSource.stop();\n                this.keepAliveSource.disconnect();\n            } catch (e) {\n                // Ignore if already stopped\n            }\n            this.keepAliveSource = null;\n            console.log('Audio KeepAlive stopped');\n        }\n    }\n\n    private ensureContext() {\n        if (!this.audioCtx) {\n            const Ctx = window.AudioContext || window.webkitAudioContext;\n            if (Ctx) {\n                try {\n                    this.audioCtx = new Ctx({ latencyHint: 'playback' });\n                } catch (e) {\n                    // Fallback for older browsers\n                    this.audioCtx = new Ctx();\n                }\n\n                // Master Gain (SFX)\n                this.gainNode = this.audioCtx.createGain();\n                this.gainNode.connect(this.audioCtx.destination);\n                this.gainNode.gain.value = 0.5; // Default volume\n\n                // Music Gain (for auto-generated music)\n                this.musicGainNode = this.audioCtx.createGain();\n                this.musicGainNode.connect(this.audioCtx.destination);\n                this.musicGainNode.gain.value = 0.8; // Music slightly louder by default? Or balanced.\n            }\n        }\n\n        if (this.audioCtx && this.audioCtx.state === 'suspended') {\n            this.audioCtx.resume();\n        }\n    }\n\n    /**\n     * Duck music volume (reduce to 20%)\n     */\n    public duck(): void {\n        if (!this.audioCtx || !this.musicGainNode) return;\n\n        const now = this.audioCtx.currentTime;\n        // Cancel scheduled changes to avoid conflict\n        this.musicGainNode.gain.cancelScheduledValues(now);\n        // Ramp down to 0.2 over 200ms\n        this.musicGainNode.gain.setTargetAtTime(0.2, now, 0.05);\n    }\n\n    /**\n     * Restore music volume\n     */\n    public unduck(): void {\n        if (!this.audioCtx || !this.musicGainNode) return;\n\n        const now = this.audioCtx.currentTime;\n        // Cancel scheduled changes\n        this.musicGainNode.gain.cancelScheduledValues(now);\n        // Ramp up to 0.8 over 500ms\n        this.musicGainNode.gain.setTargetAtTime(0.8, now, 0.1);\n    }\n\n    public setMuted(muted: boolean) {\n        this.isMuted = muted;\n    }\n\n    /**\n     * Play a synthesized beep\n     * @param freq Frequency in Hz\n     * @param duration Duration in ms\n     * @param type Oscillator type\n     */\n    public beep(freq: number = 440, duration: number = 200, type: OscillatorType = 'sine') {\n        if (this.isMuted) return;\n        this.ensureContext();\n\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const osc = this.audioCtx.createOscillator();\n        const gain = this.audioCtx.createGain();\n\n        osc.type = type;\n        osc.frequency.setValueAtTime(freq, this.audioCtx.currentTime);\n\n        // Envelope to avoid clicking\n        gain.gain.setValueAtTime(0, this.audioCtx.currentTime);\n        gain.gain.linearRampToValueAtTime(0.5, this.audioCtx.currentTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.001, this.audioCtx.currentTime + duration / 1000);\n\n        osc.connect(gain);\n        gain.connect(this.gainNode);\n\n        osc.start();\n        osc.stop(this.audioCtx.currentTime + duration / 1000);\n    }\n\n    /**\n     * Play a sequence of beeps (e.g. countdown)\n     * High pitch: 880Hz, Low pitch: 440Hz\n     */\n    public playCountdown() {\n        this.beep(440, 150); // 3\n    }\n\n    public playStart() {\n        this.beep(880, 400); // GO\n    }\n\n    public playSuccess() {\n        if (this.isMuted) return;\n        this.ensureContext();\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const now = this.audioCtx.currentTime;\n\n        // Arpeggio C E G\n        this.scheduleNote(523.25, now, 0.1);\n        this.scheduleNote(659.25, now + 0.1, 0.1);\n        this.scheduleNote(783.99, now + 0.2, 0.2);\n    }\n\n    private scheduleNote(freq: number, startTime: number, duration: number) {\n        if (!this.audioCtx || !this.gainNode) return;\n\n        const osc = this.audioCtx.createOscillator();\n        const gain = this.audioCtx.createGain();\n\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0, startTime);\n        gain.gain.linearRampToValueAtTime(0.3, startTime + 0.01);\n        gain.gain.exponentialRampToValueAtTime(0.001, startTime + duration);\n\n        osc.connect(gain);\n        gain.connect(this.gainNode);\n\n        osc.start(startTime);\n        osc.stop(startTime + duration);\n    }\n\n    /**\n     * Speak text using SpeechSynthesis\n     */\n    public speak(text: string) {\n        if (this.isMuted || !window.speechSynthesis) return;\n\n        // Cancel current utterance\n        window.speechSynthesis.cancel();\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        utterance.rate = 1.0;\n        utterance.pitch = 1.0;\n        utterance.volume = 1.0;\n\n        window.speechSynthesis.speak(utterance);\n    }\n}\n\nexport const audioManager = new AudioController();\n","/**\n * Workout Runner\n *\n * Manages the execution state of a structured workout.\n */\n\nimport type { StructuredWorkout, ActiveWorkoutState, TargetUnit } from './types.js';\nimport { loadUserProfile } from '../storage/userSettings.js';\nimport { audioManager } from '../ui/audio.js';\n\nexport type StateChangeCallback = (state: ActiveWorkoutState) => void;\n\nexport class WorkoutRunner {\n    private state: ActiveWorkoutState;\n    private timerInterval: ReturnType<typeof setInterval> | null = null;\n    private onStateChange: StateChangeCallback | null = null;\n    private userFtp: number = 200; // Default fallback\n\n    constructor(workout: StructuredWorkout, options?: { userFtp?: number }) {\n        // Load User FTP\n        if (options?.userFtp) {\n            this.userFtp = options.userFtp;\n        } else {\n            try {\n                const profile = loadUserProfile();\n                if (profile.ftp) {\n                    this.userFtp = profile.ftp;\n                }\n            } catch (e) {\n                // Ignore error (e.g. ssr/test environment)\n            }\n        }\n\n        // Initialize State\n        const totalDuration = workout.steps.reduce((acc, step) => acc + step.duration, 0);\n\n        this.state = {\n            workout,\n            isRunning: false,\n            isPaused: true,\n            isFinished: false,\n            currentStepIndex: 0,\n            startTime: null,\n            stepElapsedTime: 0,\n            stepTimeRemaining: workout.steps[0].duration,\n            totalElapsedTime: 0,\n            totalDuration,\n            currentStep: workout.steps[0],\n            nextStep: workout.steps.length > 1 ? workout.steps[1] : null,\n            totalSteps: workout.steps.length,\n            currentAbsoluteTarget: undefined,\n        };\n\n        // Initial calculation\n        this.updateCurrentTarget();\n    }\n\n    public getWorkoutName(): string {\n        return this.state.workout.name;\n    }\n\n    /**\n     * Set callback for state updates\n     */\n    public setCallback(cb: StateChangeCallback): void {\n        this.onStateChange = cb;\n        // Emit initial state\n        cb(this.state);\n    }\n\n    /**\n     * Start or Resume the workout\n     */\n    public start(): void {\n        if (this.state.isFinished) return;\n        if (this.state.isRunning && !this.state.isPaused) return;\n\n        if (!this.state.startTime) {\n            this.state.startTime = Date.now();\n        }\n\n        this.state.isRunning = true;\n        this.state.isPaused = false;\n        this.emitState();\n\n        this.timerInterval = setInterval(() => {\n            this.tick();\n        }, 1000);\n    }\n\n    /**\n     * Pause the workout\n     */\n    public pause(): void {\n        this.state.isPaused = true;\n        this.state.isRunning = false;\n        if (this.timerInterval) {\n            clearInterval(this.timerInterval);\n            this.timerInterval = null;\n        }\n        this.emitState();\n    }\n\n    /**\n     * Skip to next step\n     */\n    public nextStep(): void {\n        this.advanceStep();\n    }\n\n    /**\n     * Stop and cleanup\n     */\n    public stop(): void {\n        this.pause();\n        this.onStateChange = null;\n    }\n\n    private tick(): void {\n        if (this.state.isPaused || this.state.isFinished) return;\n\n        this.state.stepElapsedTime++;\n        this.state.totalElapsedTime++;\n        this.state.stepTimeRemaining = Math.max(0, this.state.currentStep.duration - this.state.stepElapsedTime);\n\n        // Update Ramp Targets dynamic calculation\n        this.updateCurrentTarget();\n\n        // Audio Cues (3, 2, 1)\n        if (this.state.stepTimeRemaining <= 3 && this.state.stepTimeRemaining > 0) {\n            this.safePlaySound('countdown');\n        }\n\n        // Check if step is complete\n        if (this.state.stepElapsedTime >= this.state.currentStep.duration) {\n            this.advanceStep();\n        } else {\n            this.emitState();\n        }\n    }\n\n    private advanceStep(): void {\n        const nextIndex = this.state.currentStepIndex + 1;\n\n        if (nextIndex >= this.state.workout.steps.length) {\n            this.finish();\n            return;\n        }\n\n        this.state.currentStepIndex = nextIndex;\n        this.state.currentStep = this.state.workout.steps[nextIndex];\n        this.state.nextStep =\n            nextIndex + 1 < this.state.workout.steps.length ? this.state.workout.steps[nextIndex + 1] : null;\n\n        this.state.stepElapsedTime = 0;\n        this.state.stepTimeRemaining = this.state.currentStep.duration;\n        this.updateCurrentTarget();\n\n        // Play interval start sound\n        this.safePlaySound('start');\n\n        this.emitState();\n    }\n\n    private finish(): void {\n        this.state.isFinished = true;\n        this.state.isRunning = false;\n        this.pause();\n        this.safePlaySound('success');\n        this.emitState();\n    }\n\n    private safePlaySound(type: 'countdown' | 'start' | 'success'): void {\n        try {\n            if (type === 'countdown') audioManager.playCountdown();\n            if (type === 'start') audioManager.playStart();\n            if (type === 'success') audioManager.playSuccess();\n        } catch (e) {\n            // Ignore (test/headless)\n        }\n    }\n\n    private updateCurrentTarget(): void {\n        const step = this.state.currentStep;\n\n        if (step.rampStart && step.rampEnd) {\n            // Ramp Calculation\n            const startVal = this.resolveValue(step.rampStart.value, step.rampStart.unit);\n            const endVal = this.resolveValue(step.rampEnd.value, step.rampEnd.unit);\n\n            if (startVal !== null && endVal !== null) {\n                const progress = this.state.stepElapsedTime / step.duration;\n                const currentVal = startVal + (endVal - startVal) * progress;\n\n                this.state.currentAbsoluteTarget = {\n                    type: step.rampStart.type,\n                    unit: 'watts', // Resolved to watts usually\n                    value: Math.round(currentVal),\n                    min: Math.round(currentVal - 5),\n                    max: Math.round(currentVal + 5),\n                };\n            }\n        } else if (step.target) {\n            // Steady State\n            const val = this.resolveValue(step.target.value, step.target.unit);\n            const min = this.resolveValue(step.target.min, step.target.unit);\n            const max = this.resolveValue(step.target.max, step.target.unit);\n\n            if (val !== null || (min !== null && max !== null)) {\n                this.state.currentAbsoluteTarget = {\n                    type: step.target.type,\n                    unit: 'watts', // Default, overridden below\n                    value: val || (min! + max!) / 2,\n                    min: min || (val ? val - 10 : 0),\n                    max: max || (val ? val + 10 : 999),\n                };\n\n                // Handle specific units\n                if (step.target.type === 'heartrate') {\n                    this.state.currentAbsoluteTarget.unit = 'bpm';\n                } else if (step.target.type === 'pace') {\n                    if (step.target.unit === 'min_km' || step.target.unit === 'min_mile') {\n                        this.state.currentAbsoluteTarget.unit = step.target.unit;\n                    }\n                    // Tighter default ranges for pace if not specified (e.g. +/- 15 sec/km = 0.25 min)\n                    if (min === null && val) {\n                        this.state.currentAbsoluteTarget.min = val - 0.25;\n                        this.state.currentAbsoluteTarget.max = val + 0.25;\n                    }\n                } else if (step.target.type === 'cadence') {\n                    this.state.currentAbsoluteTarget.unit = 'rpm';\n                }\n            } else {\n                this.state.currentAbsoluteTarget = undefined;\n            }\n        } else {\n            this.state.currentAbsoluteTarget = undefined;\n        }\n    }\n\n    // Resolve %FTP to Watts, etc.\n    private resolveValue(value: number | undefined, unit: TargetUnit): number | null {\n        if (value === undefined) return null;\n\n        if (\n            unit === 'watts' ||\n            unit === 'bpm' ||\n            unit === 'rpm' ||\n            unit === 'min_km' ||\n            unit === 'min_mile' ||\n            unit === 'kph' ||\n            unit === 'mph'\n        ) {\n            return value;\n        }\n\n        if (unit === 'percent_ftp') {\n            return Math.round(this.userFtp * (value / 100));\n        }\n\n        return value;\n    }\n\n    private emitState(): void {\n        if (this.onStateChange) {\n            this.onStateChange({ ...this.state });\n        }\n    }\n\n    public getState(): ActiveWorkoutState {\n        return { ...this.state };\n    }\n}\n","/**\n * Format duration in seconds to human readable string\n *\n * @param seconds - Duration in seconds\n * @returns Formatted duration string\n */\nexport function formatDuration(seconds: number | undefined | null): string {\n    if (typeof seconds !== 'number') return '--';\n\n    // Round to integer seconds\n    const roundedSeconds = Math.round(seconds);\n    const hours = Math.floor(roundedSeconds / 3600);\n    const minutes = Math.floor((roundedSeconds % 3600) / 60);\n    const secs = roundedSeconds % 60;\n\n    if (hours > 0) {\n        return `${hours}h ${minutes}m`;\n    }\n    if (minutes > 0) {\n        return `${minutes}m ${secs}s`;\n    }\n    return `${secs}s`;\n}\n\n/**\n * Format date to locale string\n *\n * @param date - Date to format\n * @returns Formatted date string\n */\nexport function formatDate(date: string | Date | undefined | null): string {\n    if (!date) return '--';\n    return new Date(date).toLocaleDateString(undefined, {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit',\n    });\n}\n","/**\n * Sport Configuration\n *\n * Defines sport types and their specific settings, metrics, and zones.\n *\n * @module config/sport\n */\n\n/**\n * Supported sport types\n */\nexport type SportType = 'cycling' | 'running' | 'walking';\n\n/**\n * Running-specific measurement\n */\nexport interface RunningMeasurement {\n    timestamp: number;\n    /** Running cadence in steps per minute (spm) */\n    cadence: number | null;\n    /** Stride length in meters */\n    strideLength: number | null;\n    /** Ground contact time in milliseconds */\n    groundContactTime: number | null;\n}\n\n/**\n * Sport-specific settings\n */\nexport interface SportSettings {\n    /** Current active sport */\n    activeSport: SportType;\n    /** Running-specific settings */\n    running: {\n        /** Target pace zone (min/km) */\n        targetPaceMin: number;\n        targetPaceMax: number;\n        /** Use running cadence sensor (footpod/watch) */\n        useRunningCadence: boolean;\n        /** Show pace instead of speed */\n        showPace: boolean;\n    };\n    /** Cycling-specific settings (default, kept for completeness) */\n    cycling: {\n        /** Show power metrics */\n        showPower: boolean;\n    };\n}\n\n/**\n * Running pace zones based on threshold pace\n * Uses Jack Daniels' VDOT zones model\n */\nexport interface RunningZone {\n    name: string;\n    /** Min pace in seconds per km */\n    minPaceSecPerKm: number;\n    /** Max pace in seconds per km */\n    maxPaceSecPerKm: number;\n    /** Description */\n    description: string;\n}\n\n/**\n * Calculate running zones based on threshold pace (T pace)\n * @param thresholdPaceSecPerKm Threshold pace in seconds per kilometer\n */\nexport function calculateRunningZones(thresholdPaceSecPerKm: number): RunningZone[] {\n    // Jack Daniels style zones relative to threshold (T) pace\n    // E (Easy) = 59-74% of vVO2max -> ~129-141% of T pace\n    // M (Marathon) = 75-84% -> ~105-111% of T pace\n    // T (Threshold) = 83-88% -> ~100-105% of T pace\n    // I (Interval) = 95-100% -> ~93-98% of T pace\n    // R (Repetition) = 105-120% -> ~85-92% of T pace\n\n    const tPace = thresholdPaceSecPerKm;\n\n    return [\n        {\n            name: 'Recovery',\n            minPaceSecPerKm: Math.round(tPace * 1.41),\n            maxPaceSecPerKm: 9999, // Very slow\n            description: 'Very easy, conversational pace',\n        },\n        {\n            name: 'Easy',\n            minPaceSecPerKm: Math.round(tPace * 1.29),\n            maxPaceSecPerKm: Math.round(tPace * 1.41),\n            description: 'Comfortable aerobic pace',\n        },\n        {\n            name: 'Marathon',\n            minPaceSecPerKm: Math.round(tPace * 1.05),\n            maxPaceSecPerKm: Math.round(tPace * 1.11),\n            description: 'Marathon race pace',\n        },\n        {\n            name: 'Threshold',\n            minPaceSecPerKm: Math.round(tPace * 1.0),\n            maxPaceSecPerKm: Math.round(tPace * 1.05),\n            description: 'Comfortably hard, lactate threshold',\n        },\n        {\n            name: 'Interval',\n            minPaceSecPerKm: Math.round(tPace * 0.93),\n            maxPaceSecPerKm: Math.round(tPace * 0.98),\n            description: 'VO2max training pace',\n        },\n        {\n            name: 'Repetition',\n            minPaceSecPerKm: 0,\n            maxPaceSecPerKm: Math.round(tPace * 0.92),\n            description: 'Speed/form work',\n        },\n    ];\n}\n\n/**\n * Default sport settings\n */\nexport const defaultSportSettings: SportSettings = {\n    activeSport: 'cycling',\n    running: {\n        targetPaceMin: 300, // 5:00 min/km\n        targetPaceMax: 360, // 6:00 min/km\n        useRunningCadence: true,\n        showPace: true,\n    },\n    cycling: {\n        showPower: true,\n    },\n};\n\n/** Storage key */\nconst SPORT_SETTINGS_KEY = 'bpt-sport-settings';\n\n/**\n * Get sport settings from localStorage\n */\nexport function getSportSettings(): SportSettings {\n    try {\n        const stored = localStorage.getItem(SPORT_SETTINGS_KEY);\n        if (stored) {\n            return { ...defaultSportSettings, ...JSON.parse(stored) };\n        }\n    } catch (e) {\n        console.warn('Failed to load sport settings:', e);\n    }\n    return { ...defaultSportSettings };\n}\n\n/**\n * Save sport settings to localStorage\n */\nexport function saveSportSettings(settings: SportSettings): void {\n    localStorage.setItem(SPORT_SETTINGS_KEY, JSON.stringify(settings));\n    window.dispatchEvent(new CustomEvent('sport-settings-changed', { detail: settings }));\n}\n\n/**\n * Get active sport\n */\nexport function getActiveSport(): SportType {\n    return getSportSettings().activeSport;\n}\n\n/**\n * Set active sport\n */\nexport function setActiveSport(sport: SportType): void {\n    const settings = getSportSettings();\n    settings.activeSport = sport;\n    saveSportSettings(settings);\n}\n\n/**\n * Convert speed (m/s) to pace (seconds per km)\n */\nexport function speedToPace(speedMs: number): number {\n    if (speedMs <= 0) return 9999;\n    return Math.round(1000 / speedMs);\n}\n\n/**\n * Convert pace (seconds per km) to speed (m/s)\n */\nexport function paceToSpeed(paceSecPerKm: number): number {\n    if (paceSecPerKm <= 0) return 0;\n    return 1000 / paceSecPerKm;\n}\n\n/**\n * Format pace as MM:SS /km\n */\nexport function formatPace(paceSecPerKm: number): string {\n    if (paceSecPerKm >= 9999 || paceSecPerKm <= 0) return '--:--';\n    const minutes = Math.floor(paceSecPerKm / 60);\n    const seconds = Math.round(paceSecPerKm % 60);\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Get sport-specific metric labels\n */\nexport function getSportMetricLabels(sport: SportType): Record<string, string> {\n    if (sport === 'running' || sport === 'walking') {\n        return {\n            speed: 'Pace',\n            cadence: 'Cadence (spm)',\n            power: 'Power',\n            heartrate: 'Heart Rate',\n            distance: 'Distance',\n            altitude: 'Elevation',\n        };\n    }\n    // Cycling (default)\n    return {\n        speed: 'Speed',\n        cadence: 'Cadence (rpm)',\n        power: 'Power',\n        heartrate: 'Heart Rate',\n        distance: 'Distance',\n        altitude: 'Elevation',\n    };\n}\n\n/**\n * Get sport icon emoji\n */\nexport function getSportIcon(sport: SportType): string {\n    switch (sport) {\n        case 'running':\n            return '';\n        case 'walking':\n            return '';\n        case 'cycling':\n        default:\n            return '';\n    }\n}\n","export class WorkerTimer {\n    private worker: Worker;\n    private callbacks: Map<number, () => void> = new Map();\n    private nextId: number = 1;\n\n    constructor() {\n        this.worker = new Worker(new URL('./timer.worker.ts', import.meta.url), {\n            type: 'module',\n        });\n\n        this.worker.onmessage = (e) => {\n            const { type, id } = e.data;\n            if (type === 'tick' && this.callbacks.has(id)) {\n                this.callbacks.get(id)!();\n            }\n        };\n    }\n\n    public setInterval(callback: () => void, interval: number): number {\n        const id = this.nextId++;\n        this.callbacks.set(id, callback);\n        this.worker.postMessage({ type: 'start', id, interval });\n        return id;\n    }\n\n    public clearInterval(id: number): void {\n        if (this.callbacks.has(id)) {\n            this.callbacks.delete(id);\n            this.worker.postMessage({ type: 'stop', id });\n        }\n    }\n\n    public terminate(): void {\n        this.worker.terminate();\n        this.callbacks.clear();\n    }\n}\n\nexport const workerTimer = new WorkerTimer();\n","import { getSettings } from '../config/settings.js';\nimport { settingsStore } from '../state/SettingsStore.js';\nimport { getSportSettings } from '../config/sport.js';\nimport { audioManager } from '../ui/audio.js';\nimport { workerTimer } from './WorkerTimer.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { ActiveWorkoutState } from '../workouts/types.js';\n\n/**\n * Current workout metrics for announcements\n */\ninterface WorkoutMetrics {\n    power: number | null;\n    heartrate: number | null;\n    cadence: number | null;\n    speedKmh: number | null;\n    pace: string | null;\n    distanceKm: number | null;\n    elapsedMs: number;\n}\n\n/**\n * Calculate total distance from GPS points in km\n */\nfunction calculateTotalDistanceKm(gpsPoints: { lat: number; lon: number }[]): number {\n    if (gpsPoints.length < 2) return 0;\n\n    let totalMeters = 0;\n    const R = 6371000; // Earth radius in meters\n\n    for (let i = 1; i < gpsPoints.length; i++) {\n        const prev = gpsPoints[i - 1];\n        const curr = gpsPoints[i];\n\n        // Haversine formula\n        const lat1 = (prev.lat * Math.PI) / 180;\n        const lat2 = (curr.lat * Math.PI) / 180;\n        const deltaLat = ((curr.lat - prev.lat) * Math.PI) / 180;\n        const deltaLon = ((curr.lon - prev.lon) * Math.PI) / 180;\n\n        const a =\n            Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n            Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n        totalMeters += R * c;\n    }\n\n    return totalMeters / 1000;\n}\n\nexport class VoiceFeedback {\n    private synth: SpeechSynthesis | null;\n    private voice: SpeechSynthesisVoice | null = null;\n    private measurementsState: MeasurementsState | null = null;\n    private timeState: TimeState | null = null;\n    private lastTimeIntervalMs: number = 0;\n    private lastDistanceIntervalKm: number = 0;\n    private workoutState: ActiveWorkoutState | null = null;\n    private lastTargetAlertTime: number = 0;\n    private checkInterval: number | null = null;\n    private isActive: boolean = false;\n\n    constructor() {\n        if (typeof window !== 'undefined') {\n            this.synth = window.speechSynthesis || null;\n        } else {\n            this.synth = null;\n        }\n\n        if (!this.synth) {\n            console.warn('Speech Synthesis not supported on this device');\n            return;\n        }\n\n        // Wait for voices to be loaded\n        if (this.synth.onvoiceschanged !== undefined) {\n            this.synth.onvoiceschanged = () => this.loadVoice();\n        }\n        this.loadVoice();\n    }\n\n    /**\n     * Initialize with state references for enhanced announcements\n     */\n    init(measurementsState: MeasurementsState, timeState: TimeState): void {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Update active workout state\n     */\n    updateWorkoutState(state: ActiveWorkoutState | null): void {\n        this.workoutState = state;\n    }\n\n    /**\n     * Start interval-based announcements\n     */\n    startIntervalAnnouncements(): void {\n        if (this.isActive || !this.measurementsState || !this.timeState) {\n            return;\n        }\n\n        const settings = getSettings();\n        if (\n            settings.enhancedVoice.timeIntervalMinutes === 0 &&\n            settings.enhancedVoice.distanceIntervalKm === 0 &&\n            !settings.enhancedVoice.workoutTargetFeedback\n        ) {\n            return;\n        }\n\n        this.isActive = true;\n        this.lastTimeIntervalMs = 0;\n        this.lastDistanceIntervalKm = 0;\n\n        // Check every second using WorkerTimer for background support\n        this.checkInterval = workerTimer.setInterval(() => this.checkIntervalAnnouncements(), 1000);\n\n        // Keep audio context alive for background playback\n        audioManager.startBackgroundKeepAlive();\n\n        console.log('Enhanced voice announcements started (Worker backed)');\n    }\n\n    /**\n     * Stop interval-based announcements\n     */\n    stopIntervalAnnouncements(): void {\n        if (this.checkInterval !== null) {\n            workerTimer.clearInterval(this.checkInterval);\n            this.checkInterval = null;\n        }\n\n        // Stop keep-alive\n        audioManager.stopBackgroundKeepAlive();\n\n        this.isActive = false;\n        this.lastTimeIntervalMs = 0;\n        this.lastDistanceIntervalKm = 0;\n    }\n\n    /**\n     * Reset state\n     */\n    reset(): void {\n        this.stopIntervalAnnouncements();\n    }\n\n    private loadVoice(): void {\n        if (!this.synth) return;\n\n        const voices = this.synth.getVoices();\n        const settings = getSettings();\n\n        if (settings.enhancedVoice.voiceURI) {\n            this.voice = voices.find((v) => v.voiceURI === settings.enhancedVoice.voiceURI) || null;\n        }\n\n        if (!this.voice) {\n            // Prefer English voices\n            this.voice = voices.find((v) => v.lang.startsWith('en')) || voices[0] || null;\n        }\n    }\n\n    /**\n     * Get all available voices\n     */\n    public getAvailableVoices(): SpeechSynthesisVoice[] {\n        if (!this.synth) return [];\n        return this.synth.getVoices().sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    /**\n     * Reload voice from settings\n     */\n    public reloadVoice(): void {\n        this.loadVoice();\n    }\n\n    private formatTimeForSpeech(ms: number): string {\n        const totalSeconds = Math.floor(ms / 1000);\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = totalSeconds % 60;\n\n        const parts = [];\n        if (hours > 0) parts.push(`${hours} hour${hours !== 1 ? 's' : ''}`);\n        if (minutes > 0) parts.push(`${minutes} minute${minutes !== 1 ? 's' : ''}`);\n        if (seconds > 0 || parts.length === 0) parts.push(`${seconds} second${seconds !== 1 ? 's' : ''}`);\n\n        return parts.join(' ');\n    }\n\n    private formatTimeShort(ms: number): string {\n        const totalSeconds = Math.floor(ms / 1000);\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n\n        if (hours > 0) {\n            return `${hours} hour${hours !== 1 ? 's' : ''} ${minutes} minute${minutes !== 1 ? 's' : ''}`;\n        }\n        return `${minutes} minute${minutes !== 1 ? 's' : ''}`;\n    }\n\n    public speak(text: string): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceEnabled) return;\n\n        if (this.synth.speaking) {\n            this.synth.cancel();\n            // If we cancel, ensure we don't leave volume down if the previous onend didn't fire\n            // audioManager.unduck(); // Actually, better to just duck again for the new one\n        }\n\n        const utterance = new SpeechSynthesisUtterance(text);\n        if (this.voice) {\n            utterance.voice = this.voice;\n        }\n\n        // Apply speech rate\n        utterance.rate = settings.enhancedVoice.speechRate;\n\n        // Duck music volume\n        utterance.onstart = () => {\n            audioManager.duck();\n        };\n\n        const restoreVolume = () => {\n            // Only restore if this was the last utterance?\n            // SpeechSynthesis is a queue, but here we cancel previous.\n            // If we cancel, onend runs?\n            audioManager.unduck();\n        };\n\n        utterance.onend = restoreVolume;\n        utterance.onerror = (e) => {\n            console.warn('Speech synthesis error:', e);\n            restoreVolume();\n        };\n\n        this.synth.speak(utterance);\n    }\n\n    public announceLap(lapNumber: number, timeMs: number, avgPower: number, avgSpeed: number = 0): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceLaps) return;\n\n        const sportSettings = getSportSettings();\n        const isRunning = sportSettings.activeSport === 'running' || sportSettings.activeSport === 'walking';\n\n        const timeStr = this.formatTimeForSpeech(timeMs);\n        let text = `Lap ${lapNumber}. Time ${timeStr}.`;\n\n        if (isRunning && avgSpeed > 0) {\n            // Calculate pace in min/km\n            const paceSec = 1000 / avgSpeed;\n            const min = Math.floor(paceSec / 60);\n            const sec = Math.round(paceSec % 60);\n            text += ` Average Pace ${min} ${sec} per kilometer.`;\n        } else {\n            text += ` Average Power ${Math.round(avgPower)} watts.`;\n        }\n\n        this.speak(text);\n    }\n\n    public announceZoneChange(zoneName: string): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.voiceZones) return;\n\n        // Smart announcements: shorter message\n        if (settings.enhancedVoice.smartAnnouncements) {\n            this.speak(zoneName);\n            return;\n        }\n\n        const text = `Entering ${zoneName} Zone`;\n        this.speak(text);\n    }\n\n    public announceCountdown(count: number): void {\n        if (!this.synth) return;\n\n        const settings = getSettings();\n        if (!settings.countdown.enableVoice) return;\n\n        const text = count === 0 ? 'Go!' : `${count}`;\n        this.speak(text);\n    }\n\n    /**\n     * Check if interval-based announcements should be triggered\n     */\n    private checkIntervalAnnouncements(): void {\n        const isRecording = this.timeState?.running ?? false;\n        const isWorkoutRunning = (this.workoutState?.isRunning && !this.workoutState?.isPaused) ?? false;\n\n        if (!this.measurementsState || (!isRecording && !isWorkoutRunning)) {\n            return;\n        }\n\n        const settings = getSettings();\n\n        // Check time-based announcements (only if recording)\n        if (isRecording && settings.enhancedVoice.timeIntervalMinutes > 0) {\n            this.checkTimeAnnouncement(settings.enhancedVoice.timeIntervalMinutes);\n        }\n\n        // Check distance-based announcements (only if recording or we want distance feedback during workout?)\n        // Let's assume distance accumulator works regardless, but keeping it simple: tied to recording usually?\n        // Actually calculateTotalDistanceKm depends on GPS points which are accumulated in MeasurementsState\n        // MeasurementsState.gps is array. Does it accumulate if not recording?\n        // Usually MeasurementsState adds points always? No, MergeMeasurements likely only adds if recording?\n        // Let's stick to restriction: generic intervals only if recording.\n        if (isRecording && settings.enhancedVoice.distanceIntervalKm > 0) {\n            this.checkDistanceAnnouncement(settings.enhancedVoice.distanceIntervalKm);\n        }\n\n        // Check target deviation (if workout is running)\n        if (isWorkoutRunning && settings.enhancedVoice.workoutTargetFeedback && this.workoutState) {\n            this.checkTargetDeviation();\n        }\n    }\n\n    /**\n     * Check for time-based announcements\n     */\n    private checkTimeAnnouncement(intervalMinutes: number): void {\n        if (!this.timeState || !this.timeState.startTime) return;\n\n        const elapsedMs = Date.now() - this.timeState.startTime;\n        const intervalMs = intervalMinutes * 60 * 1000;\n\n        const currentInterval = Math.floor(elapsedMs / intervalMs);\n        const lastInterval = Math.floor(this.lastTimeIntervalMs / intervalMs);\n\n        if (currentInterval > lastInterval && elapsedMs > 0) {\n            this.announceCurrentMetrics('time');\n            this.lastTimeIntervalMs = elapsedMs;\n        }\n    }\n\n    /**\n     * Check for distance-based announcements\n     */\n    private checkDistanceAnnouncement(intervalKm: number): void {\n        if (!this.measurementsState) return;\n\n        const totalKm = calculateTotalDistanceKm(this.measurementsState.gps);\n\n        const currentInterval = Math.floor(totalKm / intervalKm);\n        const lastInterval = Math.floor(this.lastDistanceIntervalKm / intervalKm);\n\n        if (currentInterval > lastInterval && totalKm > 0) {\n            this.announceCurrentMetrics('distance');\n            this.lastDistanceIntervalKm = totalKm;\n        }\n    }\n\n    private checkTargetDeviation(): void {\n        if (!this.workoutState || !this.measurementsState) return;\n\n        const settings = getSettings();\n        const now = Date.now();\n        // Debounce: 10 seconds\n        if (now - this.lastTargetAlertTime < 10000) return;\n\n        const target = this.workoutState.currentAbsoluteTarget;\n        if (!target) return;\n\n        // Only handle power for now\n        if (target.type !== 'power') return;\n\n        // Get latest power value\n        const powerData = this.measurementsState.power;\n        const currentPower = powerData.length > 0 ? powerData[powerData.length - 1].value : 0;\n\n        const targetMin = target.min;\n        const targetMax = target.max;\n\n        // Ignore if stopped or very low power (coasting/stopped)\n        if (currentPower < 10) return;\n\n        let msg = '';\n        // Tolerance buffer (10 Watts) to prevent jitter\n        const TOLERANCE = 10;\n\n        if (currentPower < targetMin - TOLERANCE) {\n            msg = settings.enhancedVoice.smartAnnouncements ? 'Power Low' : 'Power too low';\n        } else if (currentPower > targetMax + TOLERANCE) {\n            msg = settings.enhancedVoice.smartAnnouncements ? 'Power High' : 'Power too high';\n        }\n\n        if (msg) {\n            this.speak(msg);\n            this.lastTargetAlertTime = now;\n        }\n    }\n\n    /**\n     * Get current workout metrics\n     */\n    private getCurrentMetrics(): WorkoutMetrics {\n        const metrics: WorkoutMetrics = {\n            power: null,\n            heartrate: null,\n            cadence: null,\n            speedKmh: null,\n            pace: null,\n            distanceKm: null,\n            elapsedMs: 0,\n        };\n\n        if (!this.measurementsState || !this.timeState) return metrics;\n\n        // Get latest values (within last 5 seconds)\n        const now = Date.now();\n        const recentThreshold = now - 5000;\n\n        // Power\n        const recentPower = this.measurementsState.power.filter((p) => p.timestamp > recentThreshold);\n        if (recentPower.length > 0) {\n            metrics.power = Math.round(recentPower[recentPower.length - 1].value);\n        }\n\n        // Heart rate\n        const recentHr = this.measurementsState.heartrate.filter((h) => h.timestamp > recentThreshold);\n        if (recentHr.length > 0) {\n            metrics.heartrate = Math.round(recentHr[recentHr.length - 1].value);\n        }\n\n        // Cadence\n        const recentCadence = this.measurementsState.cadence.filter((c) => c.timestamp > recentThreshold);\n        if (recentCadence.length > 0) {\n            metrics.cadence = Math.round(recentCadence[recentCadence.length - 1].value);\n        }\n\n        // Speed\n        const recentSpeed = this.measurementsState.speed.filter((s) => s.timestamp > recentThreshold);\n        if (recentSpeed.length > 0) {\n            metrics.speedKmh = Math.round(recentSpeed[recentSpeed.length - 1].value * 10) / 10;\n        }\n\n        // Calculate pace from speed (min/km)\n        if (metrics.speedKmh && metrics.speedKmh > 0.5) {\n            const minPerKm = 60 / metrics.speedKmh;\n            const minutes = Math.floor(minPerKm);\n            const seconds = Math.round((minPerKm - minutes) * 60);\n            metrics.pace = `${minutes} minute${minutes !== 1 ? 's' : ''} ${seconds} per kilometer`;\n        }\n\n        // Distance\n        metrics.distanceKm = Math.round(calculateTotalDistanceKm(this.measurementsState.gps) * 100) / 100;\n\n        // Elapsed time\n        if (this.timeState.startTime) {\n            metrics.elapsedMs = now - this.timeState.startTime;\n        }\n\n        return metrics;\n    }\n\n    private processTemplate(template: string, metrics: WorkoutMetrics): string {\n        let text = template;\n        const val = (v: number | null): string => (v !== null ? v.toString() : 'unavailable');\n\n        text = text.replace(/{power}/gi, val(metrics.power));\n        text = text.replace(/{heartrate}|{hr}/gi, val(metrics.heartrate));\n        text = text.replace(/{cadence}|{rpm}/gi, val(metrics.cadence));\n        text = text.replace(/{speed}/gi, metrics.speedKmh !== null ? metrics.speedKmh.toFixed(1) : 'unavailable');\n        text = text.replace(/{pace}/gi, metrics.pace || 'unavailable');\n        text = text.replace(\n            /{distance}|{dist}/gi,\n            metrics.distanceKm !== null ? metrics.distanceKm.toFixed(1) : 'unavailable'\n        );\n        text = text.replace(/{time}/gi, this.formatTimeShort(metrics.elapsedMs));\n\n        return text;\n    }\n\n    /**\n     * Announce current metrics based on settings\n     */\n    private announceCurrentMetrics(trigger: 'time' | 'distance'): void {\n        const settings = getSettings();\n        const metrics = this.getCurrentMetrics();\n\n        // Check for custom template\n        if (\n            settings.enhancedVoice.announcementTemplate &&\n            settings.enhancedVoice.announcementTemplate.trim().length > 0\n        ) {\n            const text = this.processTemplate(settings.enhancedVoice.announcementTemplate, metrics);\n            this.speak(text);\n            console.log(`Voice announcement (custom): ${text}`);\n            return;\n        }\n\n        const metricsSettings = settings.enhancedVoice.metrics;\n        const { smartAnnouncements } = settings.enhancedVoice;\n        let isHighIntensity = false;\n\n        if (smartAnnouncements) {\n            const userSettings = settingsStore.getAll();\n            const powerThreshold = (userSettings.ftp || 200) * 0.85; // Upper Zone 3 / Zone 4\n            const hrThreshold = (userSettings.maxHeartrate || 190) * 0.85; // Upper Zone 3 / Zone 4\n\n            if (metrics.power !== null && metrics.power >= powerThreshold) isHighIntensity = true;\n            if (metrics.heartrate !== null && metrics.heartrate >= hrThreshold) isHighIntensity = true;\n        }\n\n        const parts: string[] = [];\n\n        // Helper for smart formatting\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        const addMetric = (condition: boolean, normal: string, smart: string) => {\n            if (condition) {\n                parts.push(isHighIntensity ? smart : normal);\n            }\n        };\n\n        // Start with the trigger announcement\n        if (trigger === 'time' && metricsSettings.time) {\n            parts.push(this.formatTimeShort(metrics.elapsedMs));\n        } else if (trigger === 'distance' && metricsSettings.distance && metrics.distanceKm !== null) {\n            parts.push(\n                isHighIntensity ? `${metrics.distanceKm.toFixed(1)}k` : `${metrics.distanceKm.toFixed(1)} kilometers`\n            );\n        }\n\n        // Add other metrics based on settings\n        if (metricsSettings.power && metrics.power !== null) {\n            addMetric(true, `power ${metrics.power} watts`, `${metrics.power} watts`);\n        }\n\n        if (metricsSettings.heartrate && metrics.heartrate !== null) {\n            addMetric(true, `heart rate ${metrics.heartrate}`, `${metrics.heartrate}`);\n        }\n\n        if (metricsSettings.speed && metrics.speedKmh !== null) {\n            if (isHighIntensity) {\n                parts.push(`${metrics.speedKmh.toFixed(1)} kph`);\n            } else {\n                parts.push(`speed ${metrics.speedKmh.toFixed(1)} k p h`);\n            }\n        }\n\n        if (metricsSettings.pace && metrics.pace !== null) {\n            // Simplify pace in high intensity if possible, but the string is pre-formatted.\n            // Keeping as is for now, maybe stripping \"per kilometer\" if smart?\n            if (isHighIntensity) {\n                parts.push(metrics.pace.replace(' per kilometer', ''));\n            } else {\n                parts.push(`pace ${metrics.pace}`);\n            }\n        }\n\n        if (metricsSettings.cadence && metrics.cadence !== null) {\n            addMetric(true, `cadence ${metrics.cadence}`, `${metrics.cadence} rpm`);\n        }\n\n        // Include distance if not already the trigger\n        if (trigger === 'time' && metricsSettings.distance && metrics.distanceKm !== null && metrics.distanceKm > 0) {\n            parts.push(\n                isHighIntensity\n                    ? `${metrics.distanceKm.toFixed(1)}k`\n                    : `distance ${metrics.distanceKm.toFixed(1)} kilometers`\n            );\n        }\n\n        // Include time if not already the trigger\n        if (trigger === 'distance' && metricsSettings.time) {\n            if (isHighIntensity) {\n                parts.push(this.formatTimeShort(metrics.elapsedMs));\n            } else {\n                parts.push(`time ${this.formatTimeShort(metrics.elapsedMs)}`);\n            }\n        }\n\n        if (parts.length > 0) {\n            const text = parts.join('. ') + '.';\n            this.speak(text);\n            console.log(`Voice announcement (${trigger}): ${text}`);\n        }\n    }\n}\n\nexport const voiceFeedback = new VoiceFeedback();\n","/**\n * Custom Workout Storage\n *\n * Manages saving and loading user-created structured workouts in LocalStorage.\n */\n\nimport type { StructuredWorkout } from '../workouts/types.js';\n\nconst STORAGE_KEY = 'bpt_custom_workouts';\n\n/**\n * Get all custom workouts\n */\nexport function getCustomWorkouts(): StructuredWorkout[] {\n    try {\n        const raw = localStorage.getItem(STORAGE_KEY);\n        if (!raw) return [];\n        return JSON.parse(raw);\n    } catch (e) {\n        console.error('Failed to load custom workouts', e);\n        return [];\n    }\n}\n\n/**\n * Save a custom workout\n */\nexport function saveCustomWorkout(workout: StructuredWorkout): void {\n    const workouts = getCustomWorkouts();\n\n    // Check if updating existing\n    const index = workouts.findIndex((w) => w.id === workout.id);\n    if (index >= 0) {\n        workouts[index] = workout;\n    } else {\n        workouts.push(workout);\n    }\n\n    saveAll(workouts);\n}\n\n/**\n * Delete a custom workout\n */\nexport function deleteCustomWorkout(id: string): void {\n    const workouts = getCustomWorkouts();\n    const filtered = workouts.filter((w) => w.id !== id);\n    saveAll(filtered);\n}\n\nfunction saveAll(workouts: StructuredWorkout[]): void {\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(workouts));\n    } catch (e) {\n        console.error('Failed to save custom workouts', e);\n        alert('Failed to save workout. Storage might be full.');\n    }\n}\n","import type { StructuredWorkout, WorkoutStep, TargetType, TargetUnit } from '../types.js';\n\ninterface DataPoint {\n    timeMinutes: number;\n    value: number;\n}\n\nexport function parseErgMrc(content: string, fileName: string): StructuredWorkout {\n    const lines = content.split(/\\r?\\n/);\n    let isHeader = false;\n    let isData = false;\n    let mode: 'percent' | 'watts' | null = null;\n    let description = '';\n\n    const points: DataPoint[] = [];\n\n    for (const line of lines) {\n        const trimmed = line.trim();\n        if (!trimmed) continue;\n\n        if (trimmed.toUpperCase() === '[COURSE HEADER]') {\n            isHeader = true;\n            isData = false;\n            continue;\n        }\n\n        if (trimmed.toUpperCase() === '[END COURSE HEADER]') {\n            isHeader = false;\n            continue;\n        }\n\n        if (trimmed.toUpperCase() === '[COURSE DATA]') {\n            isHeader = false;\n            isData = true;\n            continue;\n        }\n\n        if (trimmed.toUpperCase() === '[END COURSE DATA]') {\n            isData = false;\n            continue;\n        }\n\n        if (isHeader) {\n            if (trimmed.toUpperCase().includes('MINUTES PERCENT')) {\n                mode = 'percent';\n            } else if (trimmed.toUpperCase().includes('MINUTES WATTS')) {\n                mode = 'watts';\n            } else {\n                const parts = trimmed.split('=');\n                if (parts.length === 2) {\n                    const key = parts[0].trim().toUpperCase();\n                    const val = parts[1].trim();\n                    if (key === 'DESCRIPTION') description = val;\n                }\n            }\n        }\n\n        if (isData) {\n            // Split by tab or space\n            const parts = trimmed.split(/[\\s\\t]+/);\n            if (parts.length >= 2) {\n                const t = parseFloat(parts[0]);\n                const v = parseFloat(parts[1]);\n                if (!isNaN(t) && !isNaN(v)) {\n                    points.push({ timeMinutes: t, value: v });\n                }\n            }\n        }\n    }\n\n    if (!mode) {\n        // Fallback detection if header missing\n        if (fileName.toLowerCase().endsWith('.erg')) mode = 'watts';\n        else mode = 'percent';\n    }\n\n    const steps: WorkoutStep[] = [];\n\n    // Process points into steps\n    for (let i = 0; i < points.length - 1; i++) {\n        const current = points[i];\n        const next = points[i + 1];\n\n        const durationMinutes = next.timeMinutes - current.timeMinutes;\n\n        // Skip zero-duration segments (instant jumps)\n        if (durationMinutes <= 0.0001) continue;\n\n        const durationSeconds = Math.round(durationMinutes * 60);\n\n        const typeStr = mode === 'percent' ? 'percent_ftp' : 'watts';\n        const unit: TargetUnit = typeStr;\n        const targetType: TargetType = 'power';\n\n        const step: WorkoutStep = {\n            type: 'active', // Default to active\n            duration: durationSeconds,\n        };\n\n        // Determine if steady state or ramp\n        if (Math.abs(current.value - next.value) < 0.1) {\n            // Steady state\n            step.target = {\n                type: targetType,\n                unit: unit,\n                value: current.value,\n            };\n            step.description = `${current.value} ${unit === 'percent_ftp' ? '%' : 'W'}`;\n        } else {\n            // Ramp\n            step.rampStart = {\n                type: targetType,\n                unit: unit,\n                value: current.value,\n            };\n            step.rampEnd = {\n                type: targetType,\n                unit: unit,\n                value: next.value,\n            };\n            step.description = `Ramp ${current.value} -> ${next.value} ${unit === 'percent_ftp' ? '%' : 'W'}`;\n        }\n\n        // Simple logic to guess interval type\n        if (unit === 'percent_ftp') {\n            const avgVal = (current.value + next.value) / 2;\n            if (avgVal < 55) step.type = 'recovery';\n            else if (avgVal < 76)\n                step.type = 'active'; // Endurance\n            else step.type = 'active';\n\n            // First step often warmup\n            if (i === 0 && avgVal < 75) step.type = 'warmup';\n            // Last step often cooldown\n            if (i >= points.length - 2 && avgVal < 60) step.type = 'cooldown';\n        }\n\n        steps.push(step);\n    }\n\n    // Attempt to clean name from filename if description is empty or generic\n    const workoutName = description || fileName.replace(/\\.[^/.]+$/, '').replace(/_/g, ' ');\n\n    return {\n        id: crypto.randomUUID(),\n        name: workoutName,\n        description: description,\n        steps: steps,\n        tags: ['imported', mode === 'percent' ? 'mrc' : 'erg'],\n    };\n}\n","/**\n * Workout UI Manager\n *\n * Handles the Workout Selection Modal and the Active Workout Player Overlay.\n */\n\nimport { WORKOUT_LIBRARY, getWorkoutDuration } from '../workouts/workoutLibrary.js';\nimport type { StructuredWorkout, WorkoutStep, ActiveWorkoutState } from '../workouts/types.js';\nimport { WorkoutRunner } from '../workouts/WorkoutRunner.js';\nimport { formatDuration } from '../utils/formatters.js';\nimport { announce } from './accessibility.js';\nimport { audioManager } from './audio.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport { getCustomWorkouts, deleteCustomWorkout, saveCustomWorkout } from '../storage/customWorkouts.js';\nimport { getState } from '../state/StateProvider.js';\n\nlet activeRunner: WorkoutRunner | null = null;\n// let playerVisible = false;\n\n// export function initWorkoutUI(): void {\n//     initSelectionModal();\n//     initPlayerControls();\n//     initImportExport();\n// }\n\n/**\n * Initialize Workout Selection Logic\n * Call this from the Workouts View\n */\nexport function initWorkoutSelectionLogic(): void {\n    initPlayerControls(); // Logic only, assuming container exists\n    initImportExport();\n    refreshWorkoutList();\n}\n\n/**\n * Initialize Import/Export controls\n */\nfunction initImportExport(): void {\n    const importBtn = document.getElementById('importWorkoutBtn');\n    const importInput = document.getElementById('importWorkoutInput') as HTMLInputElement;\n\n    if (importBtn && importInput) {\n        importBtn.addEventListener('click', () => {\n            importInput.click();\n        });\n\n        importInput.addEventListener('change', (e) => {\n            const files = (e.target as HTMLInputElement).files;\n            if (files && files.length > 0) {\n                importWorkoutFile(files[0]);\n                // Reset input\n                importInput.value = '';\n            }\n        });\n    }\n}\n\nimport { parseErgMrc } from '../workouts/parsers/ergMrcParser.js';\n\nasync function importWorkoutFile(file: File): Promise<void> {\n    try {\n        const text = await file.text();\n        const lowerName = file.name.toLowerCase();\n        let workout: StructuredWorkout;\n\n        if (lowerName.endsWith('.erg') || lowerName.endsWith('.mrc')) {\n            workout = parseErgMrc(text, file.name);\n        } else {\n            // Assume JSON\n            workout = JSON.parse(text) as StructuredWorkout;\n            // Basic validation for JSON\n            if (!workout.name || !Array.isArray(workout.steps)) {\n                throw new Error('Invalid workout format');\n            }\n        }\n\n        // Ensure unique ID for imported workout\n        if (!workout.id) workout.id = crypto.randomUUID();\n        workout.tags = [...(workout.tags || []), 'imported'];\n\n        saveCustomWorkout(workout);\n        refreshWorkoutList();\n        announce(`Imported workout: ${workout.name}`, 'assertive');\n    } catch (err) {\n        console.error('Import failed', err);\n        alert('Failed to import workout: Invalid file format or parse error.');\n    }\n}\n\nfunction exportWorkout(workout: StructuredWorkout): void {\n    const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(workout, null, 2));\n    const downloadAnchorNode = document.createElement('a');\n    downloadAnchorNode.setAttribute('href', dataStr);\n    downloadAnchorNode.setAttribute('download', `${workout.name.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.json`);\n    document.body.appendChild(downloadAnchorNode); // required for firefox\n    downloadAnchorNode.click();\n    downloadAnchorNode.remove();\n}\n\n// function initSelectionModal(): void {\n//     const btn = document.getElementById('workoutsButton');\n//     const modal = document.getElementById('workoutSelectionModal');\n//     const closeBtn = document.getElementById('closeWorkoutModal');\n//     // const list = document.getElementById('workoutList');\n\n//     if (!btn || !modal || !closeBtn) return;\n\n//     // Open Modal\n//     btn.addEventListener('click', () => {\n//         modal.style.display = 'flex';\n//         refreshWorkoutList();\n//         announce('Workout selection opened', 'polite');\n//     });\n\n//     // Close Modal\n//     closeBtn.addEventListener('click', () => {\n//         modal.style.display = 'none';\n//     });\n// }\n\n/**\n * Render list of workouts (Exported for Builder to update)\n */\nexport function refreshWorkoutList(): void {\n    const container = document.getElementById('workoutList');\n    if (!container) return;\n\n    container.innerHTML = '';\n\n    const custom = getCustomWorkouts();\n\n    if (custom.length > 0) {\n        const h3 = document.createElement('h3');\n        h3.textContent = 'My Workouts';\n        h3.style.margin = '0 0 8px 0';\n        h3.style.fontSize = '1rem';\n        h3.style.color = 'var(--color-text-secondary)';\n        container.appendChild(h3);\n\n        custom.forEach((w) => renderWorkoutItem(w, container, true));\n\n        const hr = document.createElement('hr');\n        hr.style.margin = '16px 0';\n        hr.style.border = '0';\n        hr.style.borderTop = '1px solid var(--color-border)';\n        container.appendChild(hr);\n\n        const h3lib = document.createElement('h3');\n        h3lib.textContent = 'Library';\n        h3lib.style.margin = '0 0 8px 0';\n        h3lib.style.fontSize = '1rem';\n        h3lib.style.color = 'var(--color-text-secondary)';\n        container.appendChild(h3lib);\n    }\n\n    WORKOUT_LIBRARY.forEach((w) => renderWorkoutItem(w, container, false));\n}\n\nfunction renderWorkoutItem(w: StructuredWorkout, container: HTMLElement, isCustom: boolean): void {\n    const duration = getWorkoutDuration(w);\n\n    const el = document.createElement('div');\n    el.className = 'workout-item';\n    el.setAttribute('role', 'button');\n    el.setAttribute('tabindex', '0');\n    el.style.position = 'relative'; // For action buttons\n\n    let actionsHtml = '';\n    // Always allow exporting, but deleting only for custom\n    actionsHtml += `<button class=\"export-workout-btn\" aria-label=\"Export ${w.name}\" title=\"Export JSON\" style=\"background: none; border: none; font-size: 1.2rem; cursor: pointer;\"></button>`;\n\n    if (isCustom) {\n        actionsHtml += `<button class=\"delete-workout-btn\" aria-label=\"Delete ${w.name}\" title=\"Delete\" style=\"background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--color-error);\"></button>`;\n    }\n\n    const actionContainerStyle = 'position: absolute; right: 10px; top: 10px; display: flex; gap: 8px; z-index: 2;';\n\n    el.innerHTML = `\n        <div class=\"workout-item-header\">\n            <span class=\"workout-item-title\">${w.name}</span>\n            <span class=\"workout-item-duration\"> ${formatDuration(duration * 1000)}</span>\n        </div>\n        <div class=\"workout-item-desc\">${w.description}</div>\n        <div class=\"workout-tags\">\n            ${(w.tags || []).map((t) => `<span class=\"workout-tag\">${t}</span>`).join('')}\n        </div>\n        <div style=\"${actionContainerStyle}\">\n            ${actionsHtml}\n        </div>\n    `;\n\n    // Handle Export\n    const exportBtn = el.querySelector('.export-workout-btn');\n    exportBtn?.addEventListener('click', (e) => {\n        e.stopPropagation();\n        exportWorkout(w);\n    });\n\n    // Handle Delete\n    if (isCustom) {\n        const delBtn = el.querySelector('.delete-workout-btn');\n        delBtn?.addEventListener('click', (e) => {\n            e.stopPropagation();\n            if (confirm(`Delete workout \"${w.name}\"?`)) {\n                deleteCustomWorkout(w.id);\n                refreshWorkoutList();\n                announce(`Deleted workout: ${w.name}`, 'assertive');\n            }\n        });\n    }\n\n    // Start workout on click (prevent if clicking actions)\n    el.addEventListener('click', (e) => {\n        // Simple check to ensure we didn't click a button\n        if ((e.target as HTMLElement).tagName === 'BUTTON') return;\n\n        startStructuredWorkout(w);\n        // Navigate to dashboard\n        if ((window as any).router) {\n            (window as any).router.navigate('/');\n        }\n    });\n\n    // Keyboard support\n    el.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            startStructuredWorkout(w);\n            if ((window as any).router) {\n                (window as any).router.navigate('/');\n            }\n        }\n    });\n\n    container.appendChild(el);\n}\n\n/**\n * Select and start a workout\n */\nexport function startStructuredWorkout(workout: StructuredWorkout, onComplete?: () => void): void {\n    if (activeRunner) {\n        if (!confirm('A workout is already active. Stop it and start this one?')) {\n            return;\n        }\n        activeRunner.stop();\n    }\n\n    // Initialize audio on user interaction\n    audioManager.init();\n\n    // Ensure voice feedback loop is running\n    voiceFeedback.startIntervalAnnouncements();\n\n    activeRunner = new WorkoutRunner(workout);\n\n    // Track if we have already called onComplete\n    let completed = false;\n\n    activeRunner.setCallback((state) => {\n        updatePlayerUI(state);\n        voiceFeedback.updateWorkoutState(state);\n\n        if (state.isFinished && !completed && onComplete) {\n            completed = true;\n            onComplete();\n        }\n    });\n\n    // Show player\n    const overlay = document.getElementById('workoutPlayerOverlay');\n    if (overlay) {\n        overlay.style.display = 'block';\n        // playerVisible = true;\n    }\n\n    // specific Setup for Profile\n    const profileEl = document.getElementById('wpWorkoutProfile');\n    if (profileEl) {\n        (profileEl as any).workout = workout;\n    }\n\n    // Announce\n    announce(`Starting workout: ${workout.name}. Ready to start.`, 'assertive');\n}\n\n/**\n * Initialize player controls (Minimize, Close, Skip)\n */\nfunction initPlayerControls(): void {\n    const overlay = document.getElementById('workoutPlayerOverlay');\n    const minimizeBtn = document.getElementById('wpMinimize');\n    const closeBtn = document.getElementById('wpClose');\n    const skipBtn = document.getElementById('wpSkip');\n\n    if (!overlay) return;\n\n    // Close/Stop\n    closeBtn?.addEventListener('click', () => {\n        if (!activeRunner) return;\n        if (confirm('Stop current workout?')) {\n            activeRunner.stop();\n            activeRunner = null;\n            voiceFeedback.updateWorkoutState(null);\n            overlay.style.display = 'none';\n            announce('Workout stopped', 'polite');\n        }\n    });\n\n    // Minimize (Toggle visibility of body)\n    minimizeBtn?.addEventListener('click', () => {\n        const body = overlay.querySelector('.workout-player-body') as HTMLElement;\n        if (body) {\n            const isHidden = body.style.display === 'none';\n            body.style.display = isHidden ? 'block' : 'none';\n            minimizeBtn.textContent = isHidden ? '_' : '';\n        }\n    });\n\n    // Skip\n    skipBtn?.addEventListener('click', () => {\n        if (activeRunner) {\n            activeRunner.nextStep();\n            announce('Skipped to next step', 'polite');\n        }\n    });\n}\n\n/**\n * Update the player UI based on state\n */\n/**\n * Update the player UI based on state\n */\nfunction updatePlayerUI(state: ActiveWorkoutState): void {\n    const nameEl = document.getElementById('wpWorkoutName');\n    const descEl = document.getElementById('wpStepDescription');\n    const timeEl = document.getElementById('wpStepTime');\n    const durEl = document.getElementById('wpStepDuration');\n    const targetEl = document.getElementById('wpTargetPower');\n    const nextEl = document.getElementById('wpNextStep');\n    const progressEl = document.getElementById('wpProgress');\n\n    if (nameEl) nameEl.textContent = state.workout.name;\n\n    if (state.currentStep) {\n        if (descEl)\n            descEl.textContent =\n                state.currentStep.description || state.currentStep.name || state.currentStep.type.toUpperCase();\n\n        // Timer\n        const timeRemaining = state.currentStep.duration - state.stepElapsedTime;\n        if (timeEl) timeEl.textContent = formatTime(Math.max(0, timeRemaining));\n        if (durEl) durEl.textContent = formatTime(state.currentStep.duration);\n\n        // Target\n        if (targetEl) {\n            targetEl.textContent = state.currentAbsoluteTarget?.value\n                ? Math.round(state.currentAbsoluteTarget.value).toString()\n                : '--';\n        }\n\n        // Visualizer\n        const visualizer = document.getElementById('wpTargetVisualizer');\n        if (visualizer && state.currentAbsoluteTarget?.value) {\n            visualizer.setAttribute('target', state.currentAbsoluteTarget.value.toString());\n\n            // Get actual power from global state\n            try {\n                const appState = getState();\n                const power = appState.measurementsState.power;\n                const currentPower = power.length > 0 ? power[power.length - 1].value : 0;\n                visualizer.setAttribute('actual', currentPower.toString());\n            } catch (e) {\n                // Ignore if state not ready\n            }\n        }\n\n        // Profile Update\n        const profileEl = document.getElementById('wpWorkoutProfile');\n        if (profileEl) {\n            profileEl.setAttribute('current-time', state.totalElapsedTime.toString());\n        }\n    }\n\n    // Next Step\n    if (nextEl) {\n        if (state.nextStep) {\n            const nextPwr = calculateNextTarget(state.nextStep);\n            nextEl.textContent = `${state.nextStep.type} (${formatTime(state.nextStep.duration)}${nextPwr})`;\n        } else {\n            nextEl.textContent = 'Finish';\n        }\n    }\n\n    // Progress Bar\n    if (progressEl) {\n        const pct = (state.stepElapsedTime / state.currentStep.duration) * 100;\n        progressEl.style.width = `${Math.min(100, Math.max(0, pct))}%`;\n\n        // Change color based on zone/intensity?\n        // simple: blue for warmup/rest, orange for active\n        if (state.currentStep.type === 'active') {\n            progressEl.style.backgroundColor = '#ff9800'; // Orange\n        } else if (state.currentStep.type === 'rest' || state.currentStep.type === 'warmup') {\n            progressEl.style.backgroundColor = '#2196F3'; // Blue\n        } else {\n            progressEl.style.backgroundColor = '#4CAF50'; // Green\n        }\n    }\n\n    // Finished?\n    if (state.isFinished) {\n        const overlay = document.getElementById('workoutPlayerOverlay');\n        if (overlay) overlay.style.display = 'none';\n        activeRunner = null;\n        alert('Workout Complete!');\n        announce('Workout Complete!', 'assertive');\n    }\n}\n\n/**\n * Basic time formatter (mm:ss)\n */\nfunction formatTime(seconds: number): string {\n    const m = Math.floor(seconds / 60);\n    const s = seconds % 60;\n    return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n}\n\n// Temporary helper until I expose calculation from Runner or pass it in state\nfunction calculateNextTarget(step: WorkoutStep): string {\n    // This logic is duplicated from Runner, improving later\n    const t = step.target;\n    if (!t) return '';\n    return t.value ? ` @ ~${t.value}${t.unit === 'percent_ftp' ? '%' : 'W'}` : '';\n}\n\n/**\n * Hook to link main timer start/pause to workout runner\n * Call this from main.ts or connection logic\n */\nexport function onWorkoutStart(): void {\n    if (activeRunner) {\n        activeRunner.start();\n    }\n}\n\nexport function onWorkoutPause(): void {\n    if (activeRunner) {\n        activeRunner.pause();\n    }\n}\n","/**\n * Workout Countdown Overlay\n *\n * Shows a countdown before starting a workout.\n * Supports visual, audio (beep), and voice announcements.\n *\n * @module ui/countdown\n */\n\nimport { getSettings } from '../config/settings.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport { announce } from './accessibility.js';\n\n/**\n * Show countdown overlay and execute callback when complete\n *\n * @param onComplete - Callback to execute after countdown finishes\n * @returns Promise that resolves when countdown is complete or cancelled\n */\nexport async function showCountdown(onComplete: () => void): Promise<void> {\n    const settings = getSettings();\n    const duration = settings.countdown.duration;\n\n    // If countdown is disabled (duration = 0), immediately execute callback\n    if (duration === 0) {\n        onComplete();\n        return;\n    }\n\n    return new Promise((resolve) => {\n        // Create overlay\n        const overlay = createCountdownOverlay();\n        document.body.appendChild(overlay);\n\n        let currentCount = duration;\n        let intervalId: number;\n        let isCancelled = false;\n\n        // Update display\n        const updateDisplay = (count: number) => {\n            const countElement = overlay.querySelector('.countdown__number') as HTMLElement;\n            if (countElement) {\n                countElement.textContent = count === 0 ? 'GO!' : count.toString();\n                countElement.className = 'countdown__number';\n\n                // Add animation class\n                requestAnimationFrame(() => {\n                    countElement.classList.add('countdown__number--pulse');\n                });\n            }\n\n            // Voice announcement\n            if (settings.countdown.enableVoice) {\n                voiceFeedback.announceCountdown(count);\n            }\n\n            // Beep sound\n            if (settings.countdown.enableBeep) {\n                playBeep(count === 0);\n            }\n\n            // Screen reader announcement\n            const text = count === 0 ? 'Go! Workout starting' : `${count}`;\n            announce(text, 'assertive');\n        };\n\n        // Cancel button handler\n        const cancelBtn = overlay.querySelector('.countdown__cancel') as HTMLButtonElement;\n        const handleCancel = () => {\n            isCancelled = true;\n            clearInterval(intervalId);\n            document.body.removeChild(overlay);\n            announce('Countdown cancelled', 'assertive');\n            resolve();\n        };\n        cancelBtn?.addEventListener('click', handleCancel);\n\n        // ESC key to cancel\n        const handleKeydown = (e: KeyboardEvent) => {\n            if (e.key === 'Escape') {\n                handleCancel();\n                document.removeEventListener('keydown', handleKeydown);\n            }\n        };\n        document.addEventListener('keydown', handleKeydown);\n\n        // Start countdown\n        updateDisplay(currentCount);\n\n        intervalId = window.setInterval(() => {\n            currentCount--;\n\n            if (currentCount >= 0) {\n                updateDisplay(currentCount);\n            }\n\n            if (currentCount < 0) {\n                clearInterval(intervalId);\n                document.removeEventListener('keydown', handleKeydown);\n\n                if (!isCancelled) {\n                    // Remove overlay\n                    document.body.removeChild(overlay);\n\n                    // Execute callback\n                    onComplete();\n                }\n\n                resolve();\n            }\n        }, 1000);\n    });\n}\n\n/**\n * Create countdown overlay DOM element\n */\nfunction createCountdownOverlay(): HTMLElement {\n    const overlay = document.createElement('div');\n    overlay.className = 'countdown-overlay';\n    overlay.setAttribute('role', 'alertdialog');\n    overlay.setAttribute('aria-labelledby', 'countdownTitle');\n    overlay.setAttribute('aria-live', 'assertive');\n\n    overlay.innerHTML = `\n        <div class=\"countdown__backdrop\"></div>\n        <div class=\"countdown__content\">\n            <h2 id=\"countdownTitle\" class=\"countdown__title\">Get Ready!</h2>\n            <div class=\"countdown__number\"></div>\n            <button class=\"countdown__cancel\" aria-label=\"Cancel countdown\">\n                Cancel (ESC)\n            </button>\n        </div>\n    `;\n\n    return overlay;\n}\n\n/**\n * Play a beep sound using Web Audio API\n *\n * @param isFinal - If true, plays a higher-pitched \"go\" beep\n */\nfunction playBeep(isFinal: boolean = false): void {\n    try {\n        const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n        const oscillator = audioContext.createOscillator();\n        const gainNode = audioContext.createGain();\n\n        oscillator.connect(gainNode);\n        gainNode.connect(audioContext.destination);\n\n        // Frequency: Higher for final beep\n        oscillator.frequency.value = isFinal ? 880 : 440; // A5 or A4\n        oscillator.type = 'sine';\n\n        // Volume envelope\n        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\n\n        oscillator.start(audioContext.currentTime);\n        oscillator.stop(audioContext.currentTime + 0.1);\n    } catch (error) {\n        console.warn('Failed to play beep:', error);\n    }\n}\n","/**\n * CSV export utilities\n *\n * @module create-csv\n */\n\nimport { mergeMeasurements, type MergedDataPoint } from './merge-measurements.js';\nimport type { MeasurementsData, LapMarker } from './types/measurements.js';\n\n/**\n * Determines which lap a timestamp belongs to\n */\nfunction getLapNumber(timestamp: number, laps: LapMarker[]): number {\n    if (laps.length === 0) return 1;\n\n    let lapNumber = 1;\n    for (const lap of laps) {\n        if (timestamp >= lap.timestamp) {\n            lapNumber = lap.number + 1;\n        } else {\n            break;\n        }\n    }\n    return lapNumber;\n}\n\n/**\n * Creates a CSV string from workout measurements.\n *\n * Merges all measurement types (heart rate, cadence, power) into synchronized\n * data points and exports them as a CSV file with ISO timestamps.\n * Includes lap number for each data point.\n *\n * @param measurements - The measurements data object containing workout data\n * @returns CSV formatted string with header row\n *\n * @example\n * const csv = getCsvString(measurementsState);\n * // Returns:\n * // \"timestamp,lap,power,cadence,heartrate,speed,distance,altitude,lat,lon\n * //  2024-01-01T00:00:00.000Z,1,200,80,120,25.5,1000,100,52.123456,5.123456\n * //  ...\"\n */\nexport const getCsvString = (measurements: MeasurementsData): string => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return '';\n    }\n\n    const laps = measurements.laps || [];\n\n    // CSV header - now includes lap column\n    const header = 'timestamp,lap,power,cadence,heartrate,speed,distance,altitude,lat,lon';\n\n    // Convert each data point to CSV row\n    const rows = dataPoints.map((point: MergedDataPoint) => {\n        const timestamp = new Date(point.timestamp).toISOString();\n        const lap = getLapNumber(point.timestamp, laps);\n        const power = point.power !== null ? Math.round(point.power) : '';\n        const cadence = point.cadence !== null ? Math.round(point.cadence) : '';\n        const heartrate = point.heartrate !== null ? Math.round(point.heartrate) : '';\n        const speed = point.speed !== null ? point.speed.toFixed(1) : '';\n        const distance = point.distance !== null ? Math.round(point.distance) : '';\n        const altitude = point.altitude !== null ? Math.round(point.altitude) : '';\n        const lat = point.lat !== null ? point.lat.toFixed(6) : '';\n        const lon = point.lon !== null ? point.lon.toFixed(6) : '';\n\n        return `${timestamp},${lap},${power},${cadence},${heartrate},${speed},${distance},${altitude},${lat},${lon}`;\n    });\n\n    return [header, ...rows].join('\\n');\n};\n","/**\n * FIT (Flexible and Interoperable Data Transfer) export utilities\n *\n * Creates Garmin FIT files from workout measurements.\n * FIT is a binary format optimized for storing and sharing fitness data.\n *\n * @module create-fit\n */\n\nimport { mergeMeasurements } from './merge-measurements.js';\nimport type { MeasurementsData } from './types/measurements.js';\nimport type { SportType } from './config/sport.js';\n\n// FIT Protocol Constants\nconst FIT_PROTOCOL_VERSION = 0x20; // 2.0\nconst FIT_PROFILE_VERSION = 0x0813; // 20.83\n\n// FIT Message Numbers\nconst FIT_MESG_FILE_ID = 0;\nconst FIT_MESG_FILE_CREATOR = 1;\nconst FIT_MESG_ACTIVITY = 34;\nconst FIT_MESG_SESSION = 18;\nconst FIT_MESG_LAP = 19;\nconst FIT_MESG_RECORD = 20;\nconst FIT_MESG_EVENT = 21;\n\n// FIT Base Types (only used types are uncommented)\nconst FIT_BASE_TYPE_ENUM = 0x00;\n// const FIT_BASE_TYPE_SINT8 = 0x01;\nconst FIT_BASE_TYPE_UINT8 = 0x02;\n// const FIT_BASE_TYPE_SINT16 = 0x83;\nconst FIT_BASE_TYPE_UINT16 = 0x84;\n// const FIT_BASE_TYPE_SINT32 = 0x85;\nconst FIT_BASE_TYPE_UINT32 = 0x86;\n// const FIT_BASE_TYPE_STRING = 0x07;\n\n// FIT Field IDs for File ID message\nconst FILE_ID_TYPE = 0;\nconst FILE_ID_MANUFACTURER = 1;\nconst FILE_ID_PRODUCT = 2;\nconst FILE_ID_SERIAL_NUMBER = 3;\nconst FILE_ID_TIME_CREATED = 4;\n\n// FIT Field IDs for Record message\nconst RECORD_TIMESTAMP = 253;\nconst RECORD_HEART_RATE = 3;\nconst RECORD_CADENCE = 4;\nconst RECORD_POWER = 7;\n\n// FIT Field IDs for Session message\nconst SESSION_TIMESTAMP = 253;\nconst SESSION_START_TIME = 2;\nconst SESSION_TOTAL_ELAPSED_TIME = 7;\nconst SESSION_TOTAL_TIMER_TIME = 8;\nconst SESSION_TOTAL_DISTANCE = 9;\nconst SESSION_TOTAL_CALORIES = 11;\nconst SESSION_SPORT = 5;\nconst SESSION_SUB_SPORT = 6;\nconst SESSION_EVENT = 0;\nconst SESSION_EVENT_TYPE = 1;\n\n// FIT Field IDs for Lap message\nconst LAP_TIMESTAMP = 253;\nconst LAP_START_TIME = 2;\nconst LAP_TOTAL_ELAPSED_TIME = 7;\nconst LAP_TOTAL_TIMER_TIME = 8;\nconst LAP_TOTAL_DISTANCE = 9;\nconst LAP_TOTAL_CALORIES = 11;\nconst LAP_EVENT = 0;\nconst LAP_EVENT_TYPE = 1;\n\n// FIT Field IDs for Event message\nconst EVENT_TIMESTAMP = 253;\nconst EVENT_EVENT = 0;\nconst EVENT_EVENT_TYPE = 1;\n\n// FIT Field IDs for Activity message\nconst ACTIVITY_TIMESTAMP = 253;\nconst ACTIVITY_TOTAL_TIMER_TIME = 0;\nconst ACTIVITY_NUM_SESSIONS = 1;\nconst ACTIVITY_TYPE = 2;\nconst ACTIVITY_EVENT = 3;\nconst ACTIVITY_EVENT_TYPE = 4;\nconst ACTIVITY_LOCAL_TIMESTAMP = 5;\n\n// FIT Type values\nconst FILE_TYPE_ACTIVITY = 4;\nconst MANUFACTURER_DEVELOPMENT = 255;\nconst SPORT_CYCLING = 2;\nconst SPORT_RUNNING = 1;\nconst SPORT_WALKING = 11;\nconst SUB_SPORT_INDOOR_CYCLING = 6;\nconst SUB_SPORT_GENERIC = 0;\nconst EVENT_TIMER = 0;\nconst EVENT_SESSION = 8;\nconst EVENT_LAP = 9;\nconst EVENT_ACTIVITY = 26;\nconst EVENT_TYPE_START = 0;\nconst EVENT_TYPE_STOP = 1;\nconst ACTIVITY_TYPE_MANUAL = 0;\n\n// FIT timestamp epoch (1989-12-31 00:00:00 UTC)\nconst FIT_EPOCH_MS = Date.UTC(1989, 11, 31, 0, 0, 0);\n\n/**\n * Calculate CRC-16 (CCITT) for FIT file\n */\nfunction calculateCrc(buffer: Uint8Array, start: number, end: number): number {\n    const crcTable = [\n        0x0000, 0xcc01, 0xd801, 0x1400, 0xf001, 0x3c00, 0x2800, 0xe401, 0xa001, 0x6c00, 0x7800, 0xb401, 0x5000, 0x9c01,\n        0x8801, 0x4400,\n    ];\n\n    let crc = 0;\n    for (let i = start; i < end; i++) {\n        const byte = buffer[i];\n        // Low nibble\n        let tmp = crcTable[crc & 0xf];\n        crc = (crc >> 4) & 0x0fff;\n        crc = crc ^ tmp ^ crcTable[byte & 0xf];\n        // High nibble\n        tmp = crcTable[crc & 0xf];\n        crc = (crc >> 4) & 0x0fff;\n        crc = crc ^ tmp ^ crcTable[(byte >> 4) & 0xf];\n    }\n    return crc;\n}\n\n/**\n * Convert JavaScript timestamp to FIT timestamp\n */\nfunction toFitTimestamp(jsTimestamp: number): number {\n    return Math.round((jsTimestamp - FIT_EPOCH_MS) / 1000);\n}\n\n/**\n * FIT file builder class\n */\nclass FitBuilder {\n    private buffer: number[] = [];\n    private definedMessages: Map<number, boolean> = new Map();\n\n    /**\n     * Write header (14 bytes)\n     */\n    writeHeader(): void {\n        // Header size (1 byte)\n        this.buffer.push(14);\n        // Protocol version (1 byte)\n        this.buffer.push(FIT_PROTOCOL_VERSION);\n        // Profile version (2 bytes, little-endian)\n        this.buffer.push(FIT_PROFILE_VERSION & 0xff);\n        this.buffer.push((FIT_PROFILE_VERSION >> 8) & 0xff);\n        // Data size placeholder (4 bytes) - will be updated later\n        this.buffer.push(0, 0, 0, 0);\n        // Data type \".FIT\" (4 bytes)\n        this.buffer.push(0x2e, 0x46, 0x49, 0x54); // \".FIT\"\n        // CRC (2 bytes) - will be updated later\n        this.buffer.push(0, 0);\n    }\n\n    /**\n     * Write definition message\n     */\n    writeDefinition(\n        localMsgType: number,\n        globalMsgNum: number,\n        fields: { fieldDefNum: number; size: number; baseType: number }[]\n    ): void {\n        // Record header: definition message (bit 6 = 1)\n        this.buffer.push(0x40 | (localMsgType & 0x0f));\n        // Reserved byte\n        this.buffer.push(0);\n        // Architecture (0 = little-endian)\n        this.buffer.push(0);\n        // Global message number (2 bytes, little-endian)\n        this.buffer.push(globalMsgNum & 0xff);\n        this.buffer.push((globalMsgNum >> 8) & 0xff);\n        // Number of fields\n        this.buffer.push(fields.length);\n        // Field definitions\n        for (const field of fields) {\n            this.buffer.push(field.fieldDefNum);\n            this.buffer.push(field.size);\n            this.buffer.push(field.baseType);\n        }\n        this.definedMessages.set(localMsgType, true);\n    }\n\n    /**\n     * Write data message\n     */\n    writeData(localMsgType: number, values: (number | null)[]): void {\n        // Record header: data message (bit 6 = 0)\n        this.buffer.push(localMsgType & 0x0f);\n        // Field values\n        for (const value of values) {\n            if (typeof value === 'number') {\n                // Handled by caller based on field size\n            }\n        }\n    }\n\n    /**\n     * Write uint8 value\n     */\n    writeUint8(value: number): void {\n        this.buffer.push(value & 0xff);\n    }\n\n    /**\n     * Write uint16 value (little-endian)\n     */\n    writeUint16(value: number): void {\n        this.buffer.push(value & 0xff);\n        this.buffer.push((value >> 8) & 0xff);\n    }\n\n    /**\n     * Write uint32 value (little-endian)\n     */\n    writeUint32(value: number): void {\n        this.buffer.push(value & 0xff);\n        this.buffer.push((value >> 8) & 0xff);\n        this.buffer.push((value >> 16) & 0xff);\n        this.buffer.push((value >> 24) & 0xff);\n    }\n\n    /**\n     * Write data message header\n     */\n    writeDataHeader(localMsgType: number): void {\n        this.buffer.push(localMsgType & 0x0f);\n    }\n\n    /**\n     * Finalize the FIT file with CRC\n     */\n    finalize(): Uint8Array {\n        const result = new Uint8Array(this.buffer);\n\n        // Update data size in header (bytes 4-7)\n        const dataSize = this.buffer.length - 14; // Exclude header\n        result[4] = dataSize & 0xff;\n        result[5] = (dataSize >> 8) & 0xff;\n        result[6] = (dataSize >> 16) & 0xff;\n        result[7] = (dataSize >> 24) & 0xff;\n\n        // Calculate header CRC (bytes 12-13)\n        const headerCrc = calculateCrc(result, 0, 12);\n        result[12] = headerCrc & 0xff;\n        result[13] = (headerCrc >> 8) & 0xff;\n\n        // Calculate and append data CRC\n        const dataCrc = calculateCrc(result, 0, result.length);\n        const finalBuffer = new Uint8Array(result.length + 2);\n        finalBuffer.set(result);\n        finalBuffer[result.length] = dataCrc & 0xff;\n        finalBuffer[result.length + 1] = (dataCrc >> 8) & 0xff;\n\n        return finalBuffer;\n    }\n\n    /**\n     * Get current buffer as array\n     */\n    getBuffer(): number[] {\n        return this.buffer;\n    }\n}\n\n/**\n * Map internal sport type to FIT sport and sub-sport values\n */\nfunction getFitSportValues(sport?: SportType): { sport: number; subSport: number } {\n    switch (sport) {\n        case 'running':\n            return { sport: SPORT_RUNNING, subSport: SUB_SPORT_GENERIC };\n        case 'walking':\n            return { sport: SPORT_WALKING, subSport: SUB_SPORT_GENERIC };\n        case 'cycling':\n        default:\n            return { sport: SPORT_CYCLING, subSport: SUB_SPORT_INDOOR_CYCLING };\n    }\n}\n\n/**\n * Creates a Garmin FIT binary file from workout measurements.\n *\n * FIT (Flexible and Interoperable Data Transfer) is a binary format\n * used by Garmin devices and supported by most fitness platforms.\n *\n * @param measurements - The measurements data object containing workout data\n * @param sport - Optional sport type for the activity (defaults to cycling)\n * @returns FIT binary data as Uint8Array, or null if no data\n *\n * @example\n * const fitData = getFitData(measurementsState, 'running');\n * if (fitData) {\n *     const blob = new Blob([fitData], { type: 'application/fit' });\n *     // Download or upload the file\n * }\n */\nexport const getFitData = (measurements: MeasurementsData, sport?: SportType): Uint8Array | null => {\n    const dataPoints = mergeMeasurements(measurements);\n\n    if (!dataPoints || dataPoints.length === 0) {\n        return null;\n    }\n\n    const fitSportValues = getFitSportValues(sport);\n    const fit = new FitBuilder();\n    fit.writeHeader();\n\n    const firstTimestamp = dataPoints[0].timestamp;\n    const lastTimestamp = dataPoints[dataPoints.length - 1].timestamp;\n    const fitStartTime = toFitTimestamp(firstTimestamp);\n    const fitEndTime = toFitTimestamp(lastTimestamp);\n    const totalElapsedTime = (lastTimestamp - firstTimestamp) / 1000; // seconds\n    const totalElapsedTimeMs = Math.round(totalElapsedTime * 1000); // milliseconds for FIT\n\n    // Calculate totals\n    const validEnergy = dataPoints.filter((p) => p.energy !== null);\n    const totalCalories =\n        validEnergy.length > 0\n            ? Math.round(validEnergy[validEnergy.length - 1].energy! - (validEnergy[0].energy || 0))\n            : 0;\n\n    const validDistance = dataPoints.filter((p) => p.distance !== null);\n    const totalDistance =\n        validDistance.length > 0 && validDistance[validDistance.length - 1].distance! > (validDistance[0].distance || 0)\n            ? Math.round(validDistance[validDistance.length - 1].distance! - (validDistance[0].distance || 0))\n            : 0;\n\n    // Local message type assignments\n    const LOCAL_FILE_ID = 0;\n    const LOCAL_FILE_CREATOR = 1;\n    const LOCAL_EVENT = 2;\n    const LOCAL_RECORD = 3;\n    const LOCAL_LAP = 4;\n    const LOCAL_SESSION = 5;\n    const LOCAL_ACTIVITY = 6;\n\n    // === File ID Message ===\n    fit.writeDefinition(LOCAL_FILE_ID, FIT_MESG_FILE_ID, [\n        { fieldDefNum: FILE_ID_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: FILE_ID_MANUFACTURER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_PRODUCT, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: FILE_ID_SERIAL_NUMBER, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: FILE_ID_TIME_CREATED, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_ID);\n    fit.writeUint8(FILE_TYPE_ACTIVITY);\n    fit.writeUint16(MANUFACTURER_DEVELOPMENT);\n    fit.writeUint16(1); // Product ID\n    fit.writeUint32(12345678); // Serial number\n    fit.writeUint32(fitStartTime);\n\n    // === File Creator Message ===\n    fit.writeDefinition(LOCAL_FILE_CREATOR, FIT_MESG_FILE_CREATOR, [\n        { fieldDefNum: 0, size: 2, baseType: FIT_BASE_TYPE_UINT16 }, // software_version\n        { fieldDefNum: 1, size: 1, baseType: FIT_BASE_TYPE_UINT8 }, // hardware_version\n    ]);\n    fit.writeDataHeader(LOCAL_FILE_CREATOR);\n    fit.writeUint16(100); // Software version\n    fit.writeUint8(1); // Hardware version\n\n    // === Timer Start Event ===\n    fit.writeDefinition(LOCAL_EVENT, FIT_MESG_EVENT, [\n        { fieldDefNum: EVENT_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: EVENT_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: EVENT_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_START);\n\n    // === Record Messages (one per data point) ===\n    fit.writeDefinition(LOCAL_RECORD, FIT_MESG_RECORD, [\n        { fieldDefNum: RECORD_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: RECORD_HEART_RATE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_CADENCE, size: 1, baseType: FIT_BASE_TYPE_UINT8 },\n        { fieldDefNum: RECORD_POWER, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n    ]);\n\n    for (const point of dataPoints) {\n        const fitTimestamp = toFitTimestamp(point.timestamp);\n        fit.writeDataHeader(LOCAL_RECORD);\n        fit.writeUint32(fitTimestamp);\n        // Heart rate (0xFF = invalid)\n        fit.writeUint8(point.heartrate !== null ? Math.min(255, Math.round(point.heartrate)) : 0xff);\n        // Cadence (0xFF = invalid)\n        fit.writeUint8(point.cadence !== null ? Math.min(255, Math.round(point.cadence)) : 0xff);\n        // Power (0xFFFF = invalid)\n        fit.writeUint16(point.power !== null ? Math.round(point.power) : 0xffff);\n    }\n\n    // === Timer Stop Event ===\n    fit.writeDataHeader(LOCAL_EVENT);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint8(EVENT_TIMER);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Lap Message ===\n    fit.writeDefinition(LOCAL_LAP, FIT_MESG_LAP, [\n        { fieldDefNum: LAP_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_DISTANCE, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: LAP_TOTAL_CALORIES, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: LAP_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: LAP_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_LAP);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs); // Timer time same as elapsed\n    fit.writeUint32(totalDistance);\n    fit.writeUint16(totalCalories);\n    fit.writeUint8(EVENT_LAP);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Session Message ===\n    fit.writeDefinition(LOCAL_SESSION, FIT_MESG_SESSION, [\n        { fieldDefNum: SESSION_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_START_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_ELAPSED_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_DISTANCE, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: SESSION_TOTAL_CALORIES, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: SESSION_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_SUB_SPORT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: SESSION_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n    ]);\n    fit.writeDataHeader(LOCAL_SESSION);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(fitStartTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint32(totalDistance);\n    fit.writeUint16(totalCalories);\n    fit.writeUint8(fitSportValues.sport);\n    fit.writeUint8(fitSportValues.subSport);\n    fit.writeUint8(EVENT_SESSION);\n    fit.writeUint8(EVENT_TYPE_STOP);\n\n    // === Activity Message ===\n    fit.writeDefinition(LOCAL_ACTIVITY, FIT_MESG_ACTIVITY, [\n        { fieldDefNum: ACTIVITY_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_TOTAL_TIMER_TIME, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n        { fieldDefNum: ACTIVITY_NUM_SESSIONS, size: 2, baseType: FIT_BASE_TYPE_UINT16 },\n        { fieldDefNum: ACTIVITY_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_EVENT_TYPE, size: 1, baseType: FIT_BASE_TYPE_ENUM },\n        { fieldDefNum: ACTIVITY_LOCAL_TIMESTAMP, size: 4, baseType: FIT_BASE_TYPE_UINT32 },\n    ]);\n    fit.writeDataHeader(LOCAL_ACTIVITY);\n    fit.writeUint32(fitEndTime);\n    fit.writeUint32(totalElapsedTimeMs);\n    fit.writeUint16(1); // Number of sessions\n    fit.writeUint8(ACTIVITY_TYPE_MANUAL);\n    fit.writeUint8(EVENT_ACTIVITY);\n    fit.writeUint8(EVENT_TYPE_STOP);\n    fit.writeUint32(fitEndTime); // Local timestamp\n\n    return fit.finalize();\n};\n","/**\n * Timer Display Initialization\n *\n * Sets up the workout timer display and Garmin-style workout controls.\n *\n * Workout states:\n * - Idle: Not started, show Start button\n * - Recording: Timer running, show Pause button\n * - Paused: Timer paused, show Resume and Stop buttons\n *\n * @module time\n */\n\nimport { getTimestring } from '../getTimestring.js';\nimport { announce, updateWorkoutControlsAccessibility } from './accessibility.js';\nimport { onWorkoutStart, onWorkoutPause } from './workoutPlayer.js';\nimport { showNotification } from './notifications.js';\nimport { showCountdown } from './countdown.js';\nimport { showWorkoutSummary, calculateWorkoutSummary } from './modal.js';\nimport { saveCompletedWorkout, clearActiveWorkout } from '../storage/workoutStorage.js';\nimport { getCsvString } from '../create-csv.js';\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { ZoneState } from '../zone-state.js';\n\n/**\n * Workout state enum for clarity\n */\nexport type WorkoutState = 'idle' | 'recording' | 'paused';\n\n/**\n * Get the current workout state from time state\n */\nexport function getWorkoutState(timeState: TimeState): WorkoutState {\n    if (!timeState.startTime) {\n        return 'idle';\n    }\n    if (timeState.running) {\n        return 'recording';\n    }\n    return 'paused';\n}\n\n/**\n * Workout control button elements\n */\ninterface WorkoutControlElements {\n    startButton: HTMLButtonElement;\n    pauseButton: HTMLButtonElement;\n    resumeButton: HTMLButtonElement;\n    stopButton: HTMLButtonElement;\n}\n\n/**\n * Update button visibility based on workout state\n */\nfunction updateButtonVisibility(elements: WorkoutControlElements, state: WorkoutState): void {\n    const { startButton, pauseButton, resumeButton, stopButton } = elements;\n\n    // Hide all buttons first\n    startButton.style.display = 'none';\n    pauseButton.style.display = 'none';\n    resumeButton.style.display = 'none';\n    stopButton.style.display = 'none';\n\n    switch (state) {\n        case 'idle':\n            startButton.style.display = 'inline-flex';\n            break;\n        case 'recording':\n            pauseButton.style.display = 'inline-flex';\n            break;\n        case 'paused':\n            resumeButton.style.display = 'inline-flex';\n            stopButton.style.display = 'inline-flex';\n            break;\n    }\n}\n\n/** Module-level reference to control elements for programmatic access */\nlet workoutControlElements: WorkoutControlElements | null = null;\n\n/**\n * Programmatically pause the workout (used by AutoPauseService)\n * @param timeState - The workout time state object\n * @param isAutoPause - Whether this is triggered by auto-pause (shows notification)\n */\nexport function pauseWorkout(timeState: TimeState, isAutoPause = false): void {\n    if (!timeState.running || !timeState.startTime) {\n        return;\n    }\n\n    timeState.running = false;\n    timeState.endTime = Date.now();\n\n    onWorkoutPause();\n\n    if (workoutControlElements) {\n        updateButtonVisibility(workoutControlElements, 'paused');\n    }\n    updateWorkoutControlsAccessibility('paused');\n\n    if (isAutoPause) {\n        showNotification(' Auto-paused', 'info');\n        announce('Auto paused due to low activity', 'polite');\n    } else {\n        announce('Workout paused. Press resume to continue or stop to save.', 'assertive');\n    }\n\n    // Dispatch custom event for media session integration\n    document.dispatchEvent(new CustomEvent('workoutPaused', { detail: { isAutoPause } }));\n}\n\n/**\n * Programmatically resume the workout (used by AutoPauseService)\n * @param timeState - The workout time state object\n * @param isAutoResume - Whether this is triggered by auto-resume (shows notification)\n */\nexport function resumeWorkout(timeState: TimeState, isAutoResume = false): void {\n    if (timeState.running || !timeState.startTime) {\n        return;\n    }\n\n    if (timeState.endTime && timeState.startTime) {\n        // Adjust startTime to account for paused duration\n        const pausedDuration = Date.now() - timeState.endTime;\n        timeState.startTime += pausedDuration;\n    }\n    timeState.endTime = null;\n    timeState.running = true;\n\n    onWorkoutStart();\n\n    if (workoutControlElements) {\n        updateButtonVisibility(workoutControlElements, 'recording');\n    }\n    updateWorkoutControlsAccessibility('recording');\n\n    if (isAutoResume) {\n        showNotification(' Auto-resumed', 'info');\n        announce('Auto resumed', 'polite');\n    } else {\n        announce('Workout resumed', 'assertive');\n    }\n\n    // Dispatch custom event for media session integration\n    document.dispatchEvent(new CustomEvent('workoutResumed', { detail: { isAutoResume } }));\n}\n\n/**\n * Initialize the timer display and Garmin-style workout controls.\n *\n * Sets up:\n * - Timer display that updates every 100ms\n * - Start button to begin a new workout\n * - Pause button to pause recording\n * - Resume button to continue a paused workout\n * - Stop button to end and save the workout\n * - Visual state changes for workout status\n *\n * @param timeState - The workout time state object\n */\nexport const initTimerDisplay = (timeState: TimeState): void => {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n\n    if (!startButton || !pauseButton || !resumeButton || !stopButton || !timeElement) {\n        console.warn('Workout control elements not found in DOM');\n        return;\n    }\n\n    const elements: WorkoutControlElements = {\n        startButton,\n        pauseButton,\n        resumeButton,\n        stopButton,\n    };\n\n    // Store reference for programmatic access\n    workoutControlElements = elements;\n\n    // Update timer display every 100ms\n    setInterval(() => {\n        let nextText = '00:00:00';\n\n        if (timeState.startTime && timeState.running) {\n            const elapsedMs = Date.now() - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        } else if (timeState.startTime && timeState.endTime) {\n            const elapsedMs = timeState.endTime - timeState.startTime;\n            nextText = getTimestring(elapsedMs);\n        }\n\n        if (timeElement.textContent !== nextText) {\n            timeElement.textContent = nextText;\n        }\n    }, 100);\n\n    // Initialize button visibility\n    updateButtonVisibility(elements, getWorkoutState(timeState));\n\n    // Helper to add robust touch/click listeners\n    const addListener = (btn: HTMLButtonElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            e.preventDefault();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    // Handle Start button click - begin new workout with countdown\n    addListener(startButton, () => {\n        console.log('[time.ts] Start button clicked');\n\n        // Show countdown overlay (if enabled), then start workout\n        showCountdown(() => {\n            timeState.startTime = Date.now();\n            timeState.endTime = null;\n            timeState.running = true;\n\n            onWorkoutStart();\n\n            updateButtonVisibility(elements, 'recording');\n            updateWorkoutControlsAccessibility('recording');\n            announce('Workout started', 'assertive');\n\n            // Dispatch event so auto-pause service can start monitoring\n            document.dispatchEvent(new CustomEvent('workoutStarted'));\n        });\n    });\n\n    // Handle Pause button click - pause recording\n    addListener(pauseButton, () => {\n        pauseWorkout(timeState, false);\n    });\n\n    // Handle Resume button click - continue paused workout\n    addListener(resumeButton, () => {\n        resumeWorkout(timeState, false);\n    });\n\n    // Handle Stop button click - show workout summary dialog\n    addListener(stopButton, () => {\n        // Dispatch event to trigger summary dialog with state\n        const stopEvent = new CustomEvent('workoutStopRequested', {\n            detail: {\n                timeState,\n            },\n        });\n        document.dispatchEvent(stopEvent);\n    });\n};\n\n/**\n * Reset workout to idle state\n *\n * @param timeState - The workout time state object\n */\nexport function resetWorkout(timeState: TimeState): void {\n    timeState.startTime = null;\n    timeState.endTime = null;\n    timeState.running = false;\n\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton && pauseButton && resumeButton && stopButton) {\n        updateButtonVisibility({ startButton, pauseButton, resumeButton, stopButton }, 'idle');\n        updateWorkoutControlsAccessibility('idle');\n    }\n\n    announce('Workout reset', 'polite');\n}\n\n/**\n * Download a file\n */\nfunction downloadFile(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n}\n\n/**\n * Get export timestamp for filenames\n */\nfunction getExportTimestamp(): string {\n    const now = new Date();\n    return `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}`;\n}\n\n/**\n * Show workout stop summary dialog\n * This shows a comprehensive summary with options to export files, export image, continue, or discard\n *\n * @param measurementsState - The measurements state\n * @param timeState - The time state\n * @param zoneState - Optional zone state for zone data\n */\nexport async function showWorkoutStopSummary(\n    measurementsState: MeasurementsState,\n    timeState: TimeState,\n    zoneState?: ZoneState\n): Promise<void> {\n    // Calculate workout summary\n    const startTime = timeState.startTime || Date.now();\n    const endTime = timeState.endTime || Date.now();\n    const summary = calculateWorkoutSummary(startTime, endTime, measurementsState, zoneState);\n\n    // Create export files function\n    const exportFiles = () => {\n        try {\n            const timestamp = getExportTimestamp();\n            const safeTitle = 'workout';\n\n            // Export JSON\n            const exportData: Record<string, unknown> = {\n                power: measurementsState.power,\n                heartrate: measurementsState.heartrate,\n                cadence: measurementsState.cadence,\n                speed: measurementsState.speed || [],\n                altitude: measurementsState.altitude || [],\n                distance: measurementsState.distance || [],\n                gps: measurementsState.gps || [],\n            };\n\n            if (zoneState) {\n                const zoneData = zoneState.toJSON();\n                if (\n                    zoneData.powerZones.some((z) => z.timeInZoneMs > 0) ||\n                    zoneData.hrZones.some((z) => z.timeInZoneMs > 0)\n                ) {\n                    exportData.zoneDistribution = {\n                        power: zoneData.powerZones.map((z) => ({\n                            zone: z.zone,\n                            name: z.name,\n                            timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                        })),\n                        hr: zoneData.hrZones.map((z) => ({\n                            zone: z.zone,\n                            name: z.name,\n                            timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                        })),\n                    };\n                }\n            }\n\n            const jsonStr = JSON.stringify(exportData, null, 2);\n            const jsonBlob = new Blob([jsonStr], { type: 'application/json' });\n            downloadFile(jsonBlob, `${safeTitle}-${timestamp}.json`);\n\n            // Export CSV\n            const csvString = getCsvString(measurementsState);\n            const csvBlob = new Blob([csvString], { type: 'text/csv' });\n            downloadFile(csvBlob, `${safeTitle}-${timestamp}.csv`);\n\n            // Export TCX\n            const tcxString = getTcxString(measurementsState);\n            const tcxBlob = new Blob([tcxString], { type: 'application/vnd.garmin.tcx+xml' });\n            downloadFile(tcxBlob, `${safeTitle}-${timestamp}.tcx`);\n\n            // Export FIT\n            try {\n                const fitData = getFitData(measurementsState, undefined);\n                if (fitData) {\n                    const fitBlob = new Blob([fitData as unknown as BlobPart], {\n                        type: 'application/octet-stream',\n                    });\n                    downloadFile(fitBlob, `${safeTitle}-${timestamp}.fit`);\n                }\n            } catch (e) {\n                console.warn('FIT export failed:', e);\n            }\n\n            showNotification(' Workout files downloaded (JSON, CSV, TCX, FIT)', 'success');\n            announce('Workout files downloaded', 'assertive');\n        } catch (error) {\n            console.error('Export failed:', error);\n            showNotification(' Failed to export data', 'error');\n        }\n    };\n\n    // Create discard function\n    const discard = () => {\n        // Reset workout state\n        resetWorkout(timeState);\n\n        // Clear measurements\n        measurementsState.power = [];\n        measurementsState.heartrate = [];\n        measurementsState.cadence = [];\n        measurementsState.speed = [];\n        measurementsState.altitude = [];\n        measurementsState.distance = [];\n        measurementsState.gps = [];\n        measurementsState.laps = [];\n\n        // Clear zone data\n        if (zoneState) {\n            zoneState.reset();\n        }\n\n        showNotification(' Workout discarded', 'info');\n        announce('Workout discarded', 'assertive');\n\n        // Dispatch reset event\n        document.dispatchEvent(new CustomEvent('workoutReset'));\n    };\n\n    // Create continue function\n    const continueWorkout = () => {\n        // Just resume the workout\n        resumeWorkout(timeState, false);\n        showNotification(' Continuing workout', 'info');\n    };\n\n    // Create finish function\n    const finish = async () => {\n        try {\n            await saveCompletedWorkout(measurementsState, startTime, endTime, summary);\n\n            // Update PMC (Performance Management Chart) if TSS is available\n            if (summary && typeof summary.trainingLoad === 'number' && summary.trainingLoad > 0) {\n                try {\n                    const { addWorkoutToPMC } = await import('../services/fitnessService.js');\n                    await addWorkoutToPMC(new Date(startTime), summary.trainingLoad);\n                    console.log(`[PMC] Added workout with TSS ${summary.trainingLoad}`);\n                } catch (e) {\n                    console.error('Failed to update PMC:', e);\n                }\n            }\n\n            await clearActiveWorkout();\n\n            // Cleanup UI\n            resetWorkout(timeState);\n\n            // Clear in-memory measurements\n            measurementsState.power = [];\n            measurementsState.heartrate = [];\n            measurementsState.cadence = [];\n            measurementsState.speed = [];\n            measurementsState.altitude = [];\n            measurementsState.distance = [];\n            measurementsState.gps = [];\n            measurementsState.laps = [];\n\n            if (zoneState) {\n                zoneState.reset();\n            }\n\n            showNotification(' Workout saved to history', 'success');\n            announce('Workout saved to history', 'assertive');\n\n            // Dispatch events\n            document.dispatchEvent(new CustomEvent('workoutSaved'));\n            document.dispatchEvent(new CustomEvent('workoutReset'));\n        } catch (error) {\n            console.error('Failed to save workout:', error);\n            showNotification(' Failed to save workout', 'error');\n        }\n    };\n\n    // Show summary modal with all options\n    await showWorkoutSummary(\n        summary,\n        {\n            onExport: exportFiles,\n            onDiscard: discard,\n            onKeepRecording: continueWorkout,\n            onFinish: finish,\n        },\n        [] // No personal records tracking here\n    );\n}\n","/**\n * Post-Workout Metadata Modal\n *\n * Shows a modal after workout completion to collect:\n * - Workout title (with smart default)\n * - Notes\n * - Perceived exertion (RPE 1-10)\n *\n * Settings control whether notes and/or exertion prompts are shown.\n *\n * @module ui/workoutMetadataModal\n */\n\nimport { showModal } from './modal.js';\nimport { getSettings } from '../config/settings.js';\nimport type { WorkoutMetadata, PerceivedExertion } from '../types/measurements.js';\n\n/**\n * RPE (Rate of Perceived Exertion) scale descriptions\n */\nconst RPE_DESCRIPTIONS: Record<PerceivedExertion, { label: string; description: string; color: string }> = {\n    1: { label: '1 - Very Light', description: 'Barely any effort', color: '#3b82f6' },\n    2: { label: '2 - Light', description: 'Easy breathing', color: '#22c55e' },\n    3: { label: '3 - Light', description: 'Could do this all day', color: '#22c55e' },\n    4: { label: '4 - Moderate', description: 'Comfortable effort', color: '#84cc16' },\n    5: { label: '5 - Moderate', description: 'Starting to breathe harder', color: '#eab308' },\n    6: { label: '6 - Hard', description: 'Can speak in sentences', color: '#eab308' },\n    7: { label: '7 - Hard', description: 'Can only speak in phrases', color: '#f97316' },\n    8: { label: '8 - Very Hard', description: 'Difficult to maintain', color: '#ef4444' },\n    9: { label: '9 - Very Hard', description: 'Almost maximal effort', color: '#dc2626' },\n    10: { label: '10 - Maximum', description: 'All-out effort', color: '#991b1b' },\n};\n\n/**\n * Generate a default workout title based on the date/time\n */\nexport function generateDefaultTitle(startTime?: number): string {\n    const date = startTime ? new Date(startTime) : new Date();\n    const hours = date.getHours();\n\n    let timeOfDay = 'Morning';\n    if (hours >= 12 && hours < 17) {\n        timeOfDay = 'Afternoon';\n    } else if (hours >= 17 && hours < 21) {\n        timeOfDay = 'Evening';\n    } else if (hours >= 21 || hours < 5) {\n        timeOfDay = 'Night';\n    }\n\n    const dateStr = date.toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n    });\n\n    return `${timeOfDay} Ride - ${dateStr}`;\n}\n\n/**\n * Create the RPE selector element\n */\nfunction createRpeSelector(selectedValue?: PerceivedExertion): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'rpe-selector';\n    container.innerHTML = `\n        <label class=\"metadata-label\">Perceived Exertion (RPE)</label>\n        <div class=\"rpe-grid\">\n            ${([1, 2, 3, 4, 5, 6, 7, 8, 9, 10] as PerceivedExertion[])\n                .map((value) => {\n                    const info = RPE_DESCRIPTIONS[value];\n                    const isSelected = selectedValue === value;\n                    return `\n                    <button type=\"button\"\n                        class=\"rpe-button ${isSelected ? 'selected' : ''}\"\n                        data-rpe=\"${value}\"\n                        title=\"${info.label}: ${info.description}\"\n                        style=\"--rpe-color: ${info.color};\">\n                        ${value}\n                    </button>\n                `;\n                })\n                .join('')}\n        </div>\n        <div class=\"rpe-description\" id=\"rpeDescription\">\n            ${selectedValue ? `${RPE_DESCRIPTIONS[selectedValue].label}: ${RPE_DESCRIPTIONS[selectedValue].description}` : 'Select how hard the workout felt'}\n        </div>\n    `;\n\n    // Add click handlers for RPE buttons\n    const buttons = container.querySelectorAll('.rpe-button');\n    buttons.forEach((button) => {\n        button.addEventListener('click', () => {\n            // Remove selected from all\n            buttons.forEach((b) => b.classList.remove('selected'));\n            // Add to clicked\n            button.classList.add('selected');\n\n            // Update description\n            const rpe = parseInt(button.getAttribute('data-rpe') || '5', 10) as PerceivedExertion;\n            const descEl = container.querySelector('#rpeDescription');\n            if (descEl) {\n                descEl.textContent = `${RPE_DESCRIPTIONS[rpe].label}: ${RPE_DESCRIPTIONS[rpe].description}`;\n            }\n        });\n    });\n\n    return container;\n}\n\n/**\n * Create the metadata form content\n */\nfunction createMetadataFormContent(\n    startTime: number | undefined,\n    showNotes: boolean,\n    showExertion: boolean\n): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'workout-metadata-form';\n\n    // Title field (always shown)\n    const titleSection = document.createElement('div');\n    titleSection.className = 'metadata-field';\n    titleSection.innerHTML = `\n        <label class=\"metadata-label\" for=\"workoutTitle\">Workout Title</label>\n        <input type=\"text\"\n            id=\"workoutTitle\"\n            class=\"metadata-input\"\n            value=\"${generateDefaultTitle(startTime)}\"\n            placeholder=\"Enter workout title...\"\n            maxlength=\"100\">\n    `;\n    container.appendChild(titleSection);\n\n    // Notes field (optional based on settings)\n    if (showNotes) {\n        const notesSection = document.createElement('div');\n        notesSection.className = 'metadata-field';\n        notesSection.innerHTML = `\n            <label class=\"metadata-label\" for=\"workoutNotes\">Notes (optional)</label>\n            <textarea\n                id=\"workoutNotes\"\n                class=\"metadata-textarea\"\n                placeholder=\"How did the workout go? Any observations...\"\n                rows=\"3\"\n                maxlength=\"1000\"></textarea>\n        `;\n        container.appendChild(notesSection);\n    }\n\n    // RPE selector (optional based on settings)\n    if (showExertion) {\n        const rpeSection = document.createElement('div');\n        rpeSection.className = 'metadata-field';\n        rpeSection.appendChild(createRpeSelector());\n        container.appendChild(rpeSection);\n    }\n\n    return container;\n}\n\n/**\n * Extract metadata from the form\n */\nfunction getMetadataFromForm(container: HTMLElement): WorkoutMetadata {\n    const titleInput = container.querySelector('#workoutTitle') as HTMLInputElement;\n    const notesInput = container.querySelector('#workoutNotes') as HTMLTextAreaElement;\n    const selectedRpe = container.querySelector('.rpe-button.selected') as HTMLButtonElement;\n\n    const metadata: WorkoutMetadata = {\n        title: titleInput?.value.trim() || generateDefaultTitle(),\n    };\n\n    if (notesInput?.value.trim()) {\n        metadata.notes = notesInput.value.trim();\n    }\n\n    if (selectedRpe) {\n        const rpe = parseInt(selectedRpe.getAttribute('data-rpe') || '0', 10);\n        if (rpe >= 1 && rpe <= 10) {\n            metadata.perceivedExertion = rpe as PerceivedExertion;\n        }\n    }\n\n    return metadata;\n}\n\n/**\n * Show the post-workout metadata collection modal\n *\n * @param startTime - The workout start timestamp for default title generation\n * @returns Promise resolving to the collected metadata, or null if skipped/cancelled\n */\nexport function showWorkoutMetadataModal(startTime?: number): Promise<WorkoutMetadata | null> {\n    const settings = getSettings();\n    const { promptForNotes, promptForExertion } = settings.workoutMetadata;\n\n    // If both prompts are disabled, return default metadata immediately\n    if (!promptForNotes && !promptForExertion) {\n        return Promise.resolve({\n            title: generateDefaultTitle(startTime),\n        });\n    }\n\n    return new Promise((resolve) => {\n        let closeModal: (() => void) | null = null;\n\n        const formContent = createMetadataFormContent(startTime, promptForNotes, promptForExertion);\n\n        closeModal = showModal({\n            title: 'Workout Details',\n            content: formContent,\n            icon: '',\n            closeOnOverlay: false,\n            buttons: [\n                {\n                    text: 'Skip',\n                    variant: 'secondary',\n                    onClick: () => {\n                        closeModal?.();\n                        // Return default metadata even when skipped\n                        resolve({\n                            title: generateDefaultTitle(startTime),\n                        });\n                    },\n                },\n                {\n                    text: 'Save',\n                    variant: 'primary',\n                    onClick: () => {\n                        const metadata = getMetadataFromForm(formContent);\n                        closeModal?.();\n                        resolve(metadata);\n                    },\n                },\n            ],\n            onClose: () => {\n                // Return default if modal is closed via escape/X\n                resolve({\n                    title: generateDefaultTitle(startTime),\n                });\n            },\n        });\n\n        // Focus the title input after modal opens\n        setTimeout(() => {\n            const titleInput = formContent.querySelector('#workoutTitle') as HTMLInputElement;\n            titleInput?.focus();\n            titleInput?.select();\n        }, 100);\n    });\n}\n\n/**\n * Check if metadata modal should be shown based on settings\n */\nexport function shouldShowMetadataModal(): boolean {\n    const settings = getSettings();\n    return settings.workoutMetadata.promptForNotes || settings.workoutMetadata.promptForExertion;\n}\n","/**\n * Undo Notification Module\n *\n * Displays a toast notification with an undo button that allows users\n * to reverse a destructive action within a time limit.\n *\n * @module undoNotification\n */\n\nimport { announce } from './accessibility.js';\n\n/** Default undo timeout in milliseconds */\nconst DEFAULT_UNDO_TIMEOUT = 5000;\n\n/**\n * Undo notification options\n */\nexport interface UndoNotificationOptions {\n    /** The message to display */\n    message: string;\n    /** Callback when undo is clicked */\n    onUndo: () => void;\n    /** Callback when the timeout expires without undo */\n    onExpire?: () => void;\n    /** Time in ms before the notification disappears (default: 5000) */\n    timeout?: number;\n    /** Icon to display (optional) */\n    icon?: string;\n}\n\n/**\n * Show an undo notification toast\n *\n * Displays a notification with a countdown timer and undo button.\n * The notification auto-dismisses after the timeout, executing onExpire.\n * If the user clicks undo, onUndo is called and the notification closes.\n *\n * @param options - Configuration for the undo notification\n * @returns A function to manually dismiss the notification\n */\nexport function showUndoNotification(options: UndoNotificationOptions): () => void {\n    const { message, onUndo, onExpire, timeout = DEFAULT_UNDO_TIMEOUT, icon = '' } = options;\n\n    // Remove any existing undo notifications\n    const existing = document.querySelector('.undo-notification');\n    existing?.remove();\n\n    // Create notification element\n    const notification = document.createElement('div');\n    notification.className = 'undo-notification';\n    notification.setAttribute('role', 'alert');\n    notification.setAttribute('aria-live', 'assertive');\n\n    // Calculate countdown in seconds\n    const timeoutSeconds = Math.ceil(timeout / 1000);\n    let remainingSeconds = timeoutSeconds;\n\n    // Create content\n    notification.innerHTML = `\n        <div class=\"undo-notification-content\">\n            <span class=\"undo-notification-icon\" aria-hidden=\"true\">${icon}</span>\n            <span class=\"undo-notification-message\">${message}</span>\n        </div>\n        <div class=\"undo-notification-actions\">\n            <button class=\"undo-notification-btn\" type=\"button\">\n                Undo <span class=\"undo-countdown\">(${remainingSeconds}s)</span>\n            </button>\n        </div>\n        <div class=\"undo-progress-bar\">\n            <div class=\"undo-progress-fill\"></div>\n        </div>\n    `;\n\n    document.body.appendChild(notification);\n\n    // Get elements\n    const undoButton = notification.querySelector('.undo-notification-btn') as HTMLButtonElement;\n    const countdownSpan = notification.querySelector('.undo-countdown') as HTMLSpanElement;\n    const progressFill = notification.querySelector('.undo-progress-fill') as HTMLDivElement;\n\n    // Check reduced motion preference\n    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n\n    // Set up progress bar animation\n    if (!prefersReducedMotion) {\n        progressFill.style.transition = `width ${timeout}ms linear`;\n        // Force reflow before starting animation\n        progressFill.offsetHeight;\n        progressFill.style.width = '0%';\n    } else {\n        progressFill.style.width = '0%';\n    }\n\n    // Animate in\n    requestAnimationFrame(() => {\n        notification.classList.add('undo-notification-visible');\n    });\n\n    let isUndone = false;\n    let countdownInterval: ReturnType<typeof setInterval> | null = null;\n    let dismissTimeout: ReturnType<typeof setTimeout> | null = null;\n\n    /**\n     * Dismiss the notification with cleanup\n     */\n    const dismiss = (executeExpire = false) => {\n        if (countdownInterval) {\n            clearInterval(countdownInterval);\n            countdownInterval = null;\n        }\n        if (dismissTimeout) {\n            clearTimeout(dismissTimeout);\n            dismissTimeout = null;\n        }\n\n        if (prefersReducedMotion) {\n            notification.remove();\n            if (executeExpire && !isUndone && onExpire) {\n                onExpire();\n            }\n        } else {\n            notification.classList.remove('undo-notification-visible');\n            notification.classList.add('undo-notification-hiding');\n            setTimeout(() => {\n                notification.remove();\n                if (executeExpire && !isUndone && onExpire) {\n                    onExpire();\n                }\n            }, 200);\n        }\n    };\n\n    // Start countdown display\n    countdownInterval = setInterval(() => {\n        remainingSeconds--;\n        if (remainingSeconds > 0) {\n            countdownSpan.textContent = `(${remainingSeconds}s)`;\n        } else {\n            if (countdownInterval) {\n                clearInterval(countdownInterval);\n            }\n        }\n    }, 1000);\n\n    // Set up auto-dismiss\n    dismissTimeout = setTimeout(() => {\n        dismiss(true);\n    }, timeout);\n\n    // Handle undo click\n    undoButton.addEventListener('click', () => {\n        isUndone = true;\n        dismiss(false);\n        onUndo();\n        announce('Action undone', 'assertive');\n    });\n\n    // Focus the undo button for accessibility\n    undoButton.focus();\n\n    // Announce to screen readers\n    announce(`${message} Press undo within ${timeoutSeconds} seconds to restore.`, 'assertive');\n\n    return () => dismiss(false);\n}\n\n/**\n * Data backup for undo functionality\n */\nexport interface WorkoutBackup {\n    power: Array<{ timestamp: number; value: number }>;\n    heartrate: Array<{ timestamp: number; value: number }>;\n    cadence: Array<{ timestamp: number; value: number }>;\n    startTime: number | null;\n    endTime: number | null;\n    running: boolean;\n}\n\n/**\n * Create a backup of workout data for undo\n *\n * @param measurementsState - The measurements state to backup\n * @param timeState - The time state to backup\n * @returns A backup object that can be restored\n */\nexport function createWorkoutBackup(\n    measurementsState: {\n        power: Array<{ timestamp: number; value: number }>;\n        heartrate: Array<{ timestamp: number; value: number }>;\n        cadence: Array<{ timestamp: number; value: number }>;\n    },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): WorkoutBackup {\n    return {\n        power: [...measurementsState.power],\n        heartrate: [...measurementsState.heartrate],\n        cadence: [...measurementsState.cadence],\n        startTime: timeState.startTime,\n        endTime: timeState.endTime,\n        running: timeState.running,\n    };\n}\n\n/**\n * Restore workout data from a backup\n *\n * @param backup - The backup to restore\n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n */\nexport function restoreWorkoutBackup(\n    backup: WorkoutBackup,\n    measurementsState: {\n        power: Array<{ timestamp: number; value: number }>;\n        heartrate: Array<{ timestamp: number; value: number }>;\n        cadence: Array<{ timestamp: number; value: number }>;\n    },\n    timeState: { startTime: number | null; endTime: number | null; running: boolean }\n): void {\n    measurementsState.power = [...backup.power];\n    measurementsState.heartrate = [...backup.heartrate];\n    measurementsState.cadence = [...backup.cadence];\n    timeState.startTime = backup.startTime;\n    timeState.endTime = backup.endTime;\n    timeState.running = backup.running;\n}\n","/**\n * Lap Button Functionality\n *\n * Handles lap marking during workouts.\n * Shows lap button during recording and updates lap counter.\n *\n * @module lap\n */\n\nimport { announce } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { getTimestring } from '../getTimestring.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Parameters for lap button initialization\n */\ninterface InitLapButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n}\n\n/**\n * Initialize the lap button functionality.\n *\n * Sets up:\n * - Lap button visibility based on workout state\n * - Lap counter display\n * - Click handler for marking laps\n *\n * @param params - Object containing state objects\n */\nexport function initLapButton({ measurementsState, timeState }: InitLapButtonParams): void {\n    const lapButton = document.getElementById('lapButton') as HTMLButtonElement | null;\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n    const startButton = document.getElementById('startButton');\n    const pauseButton = document.getElementById('pauseButton');\n    const resumeButton = document.getElementById('resumeButton');\n    const stopButton = document.getElementById('stopButton');\n\n    if (!lapButton || !lapCounter || !lapCountElement) {\n        console.warn('Lap button elements not found in DOM');\n        return;\n    }\n\n    /**\n     * Update lap counter display\n     */\n    const updateLapCounter = (): void => {\n        const count = measurementsState.getLapCount();\n        lapCountElement.textContent = String(count);\n        lapCounter.style.display = count > 0 ? 'block' : 'none';\n    };\n\n    /**\n     * Show/hide lap button based on workout state\n     */\n    const updateLapButtonVisibility = (): void => {\n        const isRecording = timeState.running && timeState.startTime !== null;\n        lapButton.style.display = isRecording ? 'inline-flex' : 'none';\n    };\n\n    /**\n     * Handle lap button click\n     */\n    const handleLapClick = (): void => {\n        if (!timeState.running || !timeState.startTime) {\n            return;\n        }\n\n        // Get previous lap timestamp or start time\n        const laps = measurementsState.laps;\n        const lastLapTime = laps.length > 0 ? laps[laps.length - 1].timestamp : timeState.startTime;\n\n        const lap = measurementsState.addLap(timeState.startTime);\n        updateLapCounter();\n\n        // Calculate stats for the lap that just finished\n        const now = lap.timestamp;\n        const durationMs = now - lastLapTime;\n\n        // Calculate average power\n        const lapPower = measurementsState.power.filter((p) => p.timestamp >= lastLapTime && p.timestamp <= now);\n        const avgPower = lapPower.length > 0 ? lapPower.reduce((sum, p) => sum + p.value, 0) / lapPower.length : 0;\n\n        // Voice announcement\n        voiceFeedback.announceLap(lap.number, durationMs, avgPower);\n\n        // Format elapsed time for the lap\n        const elapsedStr = lap.elapsedMs ? getTimestring(lap.elapsedMs) : '';\n        const message = `Lap ${lap.number}${elapsedStr ? ` at ${elapsedStr}` : ''}`;\n\n        // Show toast notification\n        showNotification(` ${message}`, 'info');\n\n        // Announce for screen readers\n        announce(message, 'assertive');\n\n        console.log(`Lap marked: ${lap.number} at ${new Date(lap.timestamp).toISOString()}`);\n    };\n\n    // Lap button click handler\n    lapButton.addEventListener('click', handleLapClick);\n\n    // Watch for workout state changes by observing button visibility\n    // This is a simple approach - in a more complex app, use events or state management\n    const observer = new MutationObserver(() => {\n        updateLapButtonVisibility();\n    });\n\n    // Observe the start/pause/resume buttons for visibility changes\n    [startButton, pauseButton, resumeButton, stopButton].forEach((btn) => {\n        if (btn) {\n            observer.observe(btn, { attributes: true, attributeFilter: ['style'] });\n        }\n    });\n\n    // Initial state\n    updateLapButtonVisibility();\n    updateLapCounter();\n\n    // Also update when recording starts (observe start button click)\n    startButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    pauseButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    resumeButton?.addEventListener('click', () => {\n        setTimeout(updateLapButtonVisibility, 10);\n    });\n\n    stopButton?.addEventListener('click', () => {\n        setTimeout(() => {\n            updateLapButtonVisibility();\n            // Reset lap counter display after workout stops\n            // (laps are cleared when workout data is discarded)\n        }, 10);\n    });\n\n    console.log('Lap button initialized');\n}\n\n/**\n * Reset lap counter display (called when workout is discarded)\n */\nexport function resetLapCounter(): void {\n    const lapCounter = document.getElementById('lapCounter');\n    const lapCountElement = document.getElementById('lapCount');\n\n    if (lapCounter && lapCountElement) {\n        lapCountElement.textContent = '0';\n        lapCounter.style.display = 'none';\n    }\n}\n","/**\n * Analytics Helper for BPT\n *\n * Shared logic for calculating statistics, parsing summaries, and tracking personal records.\n */\n\nimport type { Workout } from '../types/workout.js';\nimport type { WorkoutSummary } from './modal.js';\n\ninterface PrState {\n    maxPower: number;\n    maxHr: number;\n    longestDuration: number;\n    longestDistance: number;\n    powerCurve: Record<number, number>; // duration -> watts\n}\n\nexport class PersonalRecordTracker {\n    private state: PrState = {\n        maxPower: 0,\n        maxHr: 0,\n        longestDuration: 0,\n        longestDistance: 0,\n        powerCurve: {},\n    };\n\n    /**\n     * Initialize tracker with historical workouts\n     */\n    constructor(workouts: Workout[]) {\n        this.processHistory(workouts);\n    }\n\n    private processHistory(workouts: Workout[]): void {\n        workouts.forEach((w) => {\n            const summary = getSummary(w);\n\n            if (summary.power?.max && summary.power.max > this.state.maxPower) {\n                this.state.maxPower = summary.power.max;\n            }\n            if (summary.heartrate?.max && summary.heartrate.max > this.state.maxHr) {\n                this.state.maxHr = summary.heartrate.max;\n            }\n            if (w.duration && w.duration > this.state.longestDuration) {\n                this.state.longestDuration = w.duration;\n            }\n            /*\n            if (summary.totalDistance && summary.totalDistance > this.state.longestDistance) {\n                this.state.longestDistance = summary.totalDistance;\n            }\n            */\n\n            // Power Curve\n            if (summary.powerCurve) {\n                summary.powerCurve.forEach((p: { duration: number; watts: number }) => {\n                    const currentBest = this.state.powerCurve[p.duration] || 0;\n                    if (p.watts > currentBest) {\n                        this.state.powerCurve[p.duration] = p.watts;\n                    }\n                });\n            }\n        });\n    }\n\n    /**\n     * Check a new workout for records\n     * @returns Array of strings describing any new records\n     */\n    public checkNewRecords(newSummary: WorkoutSummary): string[] {\n        const records: string[] = [];\n\n        if (newSummary.power.max && newSummary.power.max > this.state.maxPower) {\n            records.push(`Max Power: ${newSummary.power.max} W`);\n        }\n\n        if (newSummary.heartrate.max && newSummary.heartrate.max > this.state.maxHr) {\n            records.push(`Max Heart Rate: ${newSummary.heartrate.max} bpm`);\n        }\n\n        // duration is in ms in Workout (DB), but WorkoutSummary.duration might be ms?\n        // Let's verify modal.ts. duration = endTime - startTime (ms).\n        if (newSummary.duration && newSummary.duration > this.state.longestDuration) {\n            // Only report significant duration records (>10% improvement or >1h) to avoid noise?\n            // For now, just simplistic check\n            records.push(`Longest Ride: ${formatDuration(newSummary.duration)}`);\n        }\n\n        // Modal summary doesn't have totalDistance computed yet unfortunately calculateWorkoutSummary doesn't do distance from GPS\n        // We might skip distance for live summary check unless we update calculateWorkoutSummary to include it.\n\n        // Power Curve\n        if (newSummary.powerCurve) {\n            const significantDurations = [1, 5, 60, 300, 1200, 3600]; // 1s, 5s, 1m, 5m, 20m, 1h\n            const labels: Record<number, string> = {\n                1: '1s Power',\n                5: '5s Power',\n                60: '1m Power',\n                300: '5m Power',\n                1200: '20m Power',\n                3600: '1h Power',\n            };\n\n            newSummary.powerCurve.forEach((p) => {\n                if (significantDurations.includes(p.duration)) {\n                    const currentBest = this.state.powerCurve[p.duration] || 0;\n                    if (p.watts > currentBest) {\n                        // Avoid duplicates if multiple durations map to \"Max Power\" (like 1s)\n                        if (p.duration === 1 && records.some((r) => r.startsWith('Max Power'))) return;\n\n                        records.push(`${labels[p.duration]}: ${p.watts} W`);\n                    }\n                }\n            });\n        }\n\n        return records;\n    }\n}\n\n/**\n * Helper to safely parse summary from DB workout\n * Note: Local WorkoutSummary type has different shape than DB text/json summary.\n * We cast to 'any' for reading flexible fields.\n */\nexport function getSummary(workout: Workout): Partial<WorkoutSummary> {\n    if (!workout.summary) return {};\n    if (typeof workout.summary === 'string') {\n        try {\n            return JSON.parse(workout.summary) as Partial<WorkoutSummary>;\n        } catch {\n            return {};\n        }\n    }\n    return workout.summary as unknown as Partial<WorkoutSummary>;\n}\n\nfunction formatDuration(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const h = Math.floor(seconds / 3600);\n    const m = Math.floor((seconds % 3600) / 60);\n    const s = seconds % 60;\n    if (h > 0) return `${h}h ${m}m`;\n    return `${m}m ${s}s`;\n}\n","/**\n * Simple SVG Charting Library for Bike Power Tracker\n *\n * Renders lightweight SVG charts for workout analysis.\n *\n * @module ui/charts\n */\n\nexport interface Point {\n    x: number; // Timestamp or relative time\n    y: number; // Value\n}\n\nexport interface ChartOptions {\n    color?: string;\n    height?: number;\n    title?: string;\n    yLabel?: string;\n    xLabel?: string;\n    yMin?: number;\n    yMax?: number;\n}\n\n/**\n * Render a simple line chart into a container\n */\nexport function renderLineChart(container: HTMLElement, data: Point[], options: ChartOptions = {}): void {\n    if (!container) return;\n\n    // Configuration\n    const height = options.height || 200;\n    const color = options.color || 'var(--color-accent)';\n    const padTop = 20;\n    const padBottom = 30;\n    const padLeft = 40;\n    const padRight = 10;\n\n    // Handle empty data\n    if (!data || data.length < 2) {\n        container.innerHTML = `\n            <div style=\"\n                display:flex; \n                justify-content:center; \n                align-items:center; \n                height:${height}px; \n                color: var(--color-text-secondary);\n                background: var(--card-bg);\n                border-radius: 8px;\n            \">\n                No data available\n            </div>\n        `;\n        return;\n    }\n\n    // Downsample if too many points (limit to ~500 points for performance)\n    const processedData = downsample(data, 500);\n\n    // Get value ranges\n    const xValues = processedData.map((p) => p.x);\n    const yValues = processedData.map((p) => p.y);\n\n    const minX = Math.min(...xValues);\n    const maxX = Math.max(...xValues);\n    let minY = options.yMin ?? Math.min(...yValues);\n    let maxY = options.yMax ?? Math.max(...yValues);\n\n    // Add some headroom to Y axis\n    const yRange = maxY - minY;\n    if (yRange === 0) {\n        maxY += 10;\n        minY -= 10;\n    } else {\n        // If not fixed to 0, add padding. If usually 0-based (like power), kept 0.\n        if (options.yMin === undefined) {\n            // If data is far from 0, don't force 0, but add padding\n            minY -= yRange * 0.1;\n        }\n        maxY += yRange * 0.1;\n    }\n\n    // Get container width\n    const width = container.clientWidth || container.parentElement?.clientWidth || 600;\n\n    // Helper to map values to coordinates\n    const getX = (val: number) => padLeft + ((val - minX) / (maxX - minX)) * (width - padLeft - padRight);\n    const getY = (val: number) => height - padBottom - ((val - minY) / (maxY - minY)) * (height - padTop - padBottom);\n\n    // Generate Path\n    const pathD = `M ${processedData.map((p) => `${getX(p.x).toFixed(1)},${getY(p.y).toFixed(1)}`).join(' L ')}`;\n\n    // Generate Area fill (optional, looks nice)\n    const areaD = `${pathD} L ${getX(processedData[processedData.length - 1].x).toFixed(1)},${height - padBottom} L ${getX(processedData[0].x).toFixed(1)},${height - padBottom} Z`;\n\n    // Generate Grid Lines\n    // Y-Axis: 5 lines\n    const gridLines = [];\n    const yStep = (maxY - minY) / 4;\n    for (let i = 0; i <= 4; i++) {\n        const val = minY + i * yStep;\n        const y = getY(val);\n        gridLines.push(`\n            <line x1=\"${padLeft}\" y1=\"${y}\" x2=\"${width - padRight}\" y2=\"${y}\" stroke=\"var(--color-border)\" stroke-width=\"1\" stroke-dasharray=\"4\" opacity=\"0.5\" />\n            <text x=\"${padLeft - 5}\" y=\"${y + 4}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${Math.round(val)}</text>\n        `);\n    }\n\n    // X-Axis: Time labels (Start, Middle, End)\n    const startTimeStr = formatTime(0); // Relative time 0\n    const midTimeStr = formatTime((maxX - minX) / 2);\n    const endTimeStr = formatTime(maxX - minX);\n\n    // Construct SVG\n    const svg = `\n        <svg width=\"100%\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" style=\"background: var(--card-bg); border-radius: 8px;\">\n            <defs>\n                <linearGradient id=\"chartGradient-${options.title?.replace(/\\s/g, '')}\" x1=\"0\" x2=\"0\" y1=\"0\" y2=\"1\">\n                    <stop offset=\"0%\" stop-color=\"${color}\" stop-opacity=\"0.2\"/>\n                    <stop offset=\"100%\" stop-color=\"${color}\" stop-opacity=\"0\"/>\n                </linearGradient>\n            </defs>\n\n            <!-- Grid -->\n            ${gridLines.join('')}\n\n            <!-- Axis Labels -->\n            <text x=\"${padLeft}\" y=\"${height - 10}\" text-anchor=\"start\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${startTimeStr}</text>\n            <text x=\"${width / 2}\" y=\"${height - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${midTimeStr}</text>\n            <text x=\"${width - padRight}\" y=\"${height - 10}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${endTimeStr}</text>\n\n            <!-- Data Area -->\n            <path d=\"${areaD}\" fill=\"url(#chartGradient-${options.title?.replace(/\\s/g, '')})\" stroke=\"none\" />\n            \n            <!-- Data Line -->\n            <path d=\"${pathD}\" fill=\"none\" stroke=\"${color}\" stroke-width=\"2\" vector-effect=\"non-scaling-stroke\" />\n\n            <!-- Title -->\n            ${options.title ? `<text x=\"${width / 2}\" y=\"${15}\" text-anchor=\"middle\" font-weight=\"bold\" font-size=\"12\" fill=\"var(--color-text-primary)\">${options.title}</text>` : ''}\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n\n/**\n * Reduce approximate number of points to target using simple N-th sampling\n */\nfunction downsample(data: Point[], target: number): Point[] {\n    if (data.length <= target) return data;\n    const step = Math.ceil(data.length / target);\n    const result = [];\n    for (let i = 0; i < data.length; i += step) {\n        result.push(data[i]);\n    }\n    return result;\n}\n\n/**\n * Format milliseconds to HH:MM:SS or MM:SS\n */\nfunction formatTime(ms: number): string {\n    const totalSeconds = Math.floor(ms / 1000);\n    const h = Math.floor(totalSeconds / 3600);\n    const m = Math.floor((totalSeconds % 3600) / 60);\n    const s = totalSeconds % 60;\n\n    if (h > 0) {\n        return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;\n    }\n    return `${m}:${s.toString().padStart(2, '0')}`;\n}\n\n/**\n * Render a simple bar chart into a container\n */\nexport function renderBarChart(container: HTMLElement, data: Point[], options: ChartOptions = {}): void {\n    if (!container) return;\n\n    // Configuration\n    const height = options.height || 200;\n    const color = options.color || 'var(--color-accent)';\n    const padTop = 30;\n    const padBottom = 30;\n    const padLeft = 40;\n    const padRight = 10;\n    const barGap = 4;\n\n    // Handle empty data\n    if (!data || data.length === 0) {\n        container.innerHTML = `\n            <div style=\"\n                display:flex; \n                justify-content:center; \n                align-items:center; \n                height:${height}px; \n                color: var(--color-text-secondary);\n                background: var(--card-bg);\n                border-radius: 8px;\n            \">\n                No data available\n            </div>\n        `;\n        return;\n    }\n\n    // Process Values\n    const yValues = data.map((p) => p.y);\n    let maxY = options.yMax ?? Math.max(...yValues) * 1.1; // 10% headroom\n    let minY = options.yMin ?? 0;\n\n    if (maxY === minY) maxY += 10;\n\n    // Get container width\n    const width = container.clientWidth || container.parentElement?.clientWidth || 600;\n\n    // Calculate bar dimensions\n    const availableWidth = width - padLeft - padRight;\n    // Ensure minimum bar width of 2px\n    const barWidth = Math.max(2, availableWidth / data.length - barGap);\n\n    const getX = (index: number) => padLeft + index * (barWidth + barGap) + barGap / 2; // Center in slot\n    const getY = (val: number) => height - padBottom - ((val - minY) / (maxY - minY)) * (height - padTop - padBottom);\n\n    const bars = data.map((p, i) => {\n        const x = getX(i);\n        const y = getY(p.y);\n        const h = Math.max(0, height - padBottom - y); // Prevent negative height\n\n        // Don't render bars with 0 height or weird coordinates\n        if (h <= 0 || isNaN(y) || isNaN(h)) return '';\n\n        return `<rect x=\"${x.toFixed(1)}\" y=\"${y.toFixed(1)}\" width=\"${barWidth.toFixed(1)}\" height=\"${h.toFixed(1)}\" fill=\"${color}\" rx=\"2\" opacity=\"0.8\" />`;\n    });\n\n    // Generate Labels (simplified X axis labels)\n    // Reduce labels if too many\n    const maxLabels = 7;\n    const labelStep = Math.max(1, Math.floor(data.length / maxLabels));\n\n    const xLabels = data.map((p, i) => {\n        if (i % labelStep !== 0) return '';\n        // Date formatting based on X value (timestamp)\n        const date = new Date(p.x);\n        // Short date format DD/MM\n        const label = `${date.getDate()}/${date.getMonth() + 1}`;\n        const x = getX(i) + barWidth / 2;\n        return `<text x=\"${x.toFixed(1)}\" y=\"${height - 5}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${label}</text>`;\n    });\n\n    // Generate Y Grid and Labels\n    const gridLines = [];\n    const yStep = (maxY - minY) / 4;\n    for (let i = 0; i <= 4; i++) {\n        const val = minY + i * yStep;\n        const y = getY(val);\n        gridLines.push(`\n            <line x1=\"${padLeft}\" y1=\"${y}\" x2=\"${width - padRight}\" y2=\"${y}\" stroke=\"var(--color-border)\" stroke-width=\"1\" stroke-dasharray=\"4\" opacity=\"0.3\" />\n            <text x=\"${padLeft - 5}\" y=\"${y + 4}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${Math.round(val)}</text>\n        `);\n    }\n\n    const svg = `\n        <svg width=\"100%\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" style=\"background: var(--card-bg); border-radius: 8px;\">\n            ${gridLines.join('')}\n            ${bars.join('')}\n            ${xLabels.join('')}\n            <!-- Axis Lines -->\n            <line x1=\"${padLeft}\" y1=\"${padTop}\" x2=\"${padLeft}\" y2=\"${height - padBottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${padLeft}\" y1=\"${height - padBottom}\" x2=\"${width - padRight}\" y2=\"${height - padBottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <!-- Title -->\n             ${options.title ? `<text x=\"${width / 2}\" y=\"15\" text-anchor=\"middle\" font-size=\"12\" font-weight=\"bold\" fill=\"var(--color-text-primary)\">${options.title}</text>` : ''}\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n","/**\n * Statistics View Component\n *\n * Aggregates and renders workout statistics across different time periods.\n *\n * @module ui/statistics\n */\n\nimport type { Workout } from '../types/workout.js';\nimport type { WorkoutSummary } from '../types/measurements.js';\nimport { formatDuration } from '../utils/formatters.js';\nimport { renderBarChart, type Point } from './charts.js';\n\ninterface PeriodStats {\n    count: number;\n    distance: number;\n    duration: number;\n    elevation: number;\n    energy: number;\n\n    avgPower: number;\n    avgHr: number;\n    avgCadence: number;\n\n    weightedPowerSum: number; // for calculating avg power across varying durations\n    weightedHrSum: number;\n    weightedCadenceSum: number;\n    totalDurationForAvg: number;\n}\n\nconst emptyStats = (): PeriodStats => ({\n    count: 0,\n    distance: 0,\n    duration: 0,\n    elevation: 0,\n    energy: 0,\n    avgPower: 0,\n    avgHr: 0,\n    avgCadence: 0,\n    weightedPowerSum: 0,\n    weightedHrSum: 0,\n    weightedCadenceSum: 0,\n    totalDurationForAvg: 0,\n});\n\nfunction getSummary(workout: Workout): Partial<WorkoutSummary> {\n    if (!workout.summary) return {};\n    if (typeof workout.summary === 'string') {\n        try {\n            return JSON.parse(workout.summary);\n        } catch {\n            return {};\n        }\n    }\n    return workout.summary as unknown as WorkoutSummary;\n}\n\n/**\n * State for the statistics view\n */\nlet currentWorkouts: Workout[] = [];\nlet trendMetric: 'distance' | 'duration' | 'energy' | 'count' = 'distance';\n\n/**\n * Main function to render statistics into a container\n */\nexport function renderPeriodStatistics(containerId: string, workouts: Workout[]): void {\n    const container = document.getElementById(containerId);\n    if (!container) return;\n\n    // Update state\n    currentWorkouts = workouts;\n\n    // Check if we already injected our specific container\n    let statsContainer = document.getElementById('periodStatsContainer');\n    if (!statsContainer) {\n        statsContainer = document.createElement('div');\n        statsContainer.id = 'periodStatsContainer';\n        statsContainer.style.display = 'grid';\n        statsContainer.style.gap = '16px';\n        statsContainer.style.marginBottom = '20px';\n\n        // Insert at the top of the analytics view\n        container.insertBefore(statsContainer, container.firstChild);\n    }\n\n    // 1. Render Summary Table Card\n    renderSummaryTable(statsContainer, workouts);\n\n    // 2. Render Trends Chart Card\n    renderTrendsChart(statsContainer);\n}\n\n/**\n * Render the summary comparison table\n */\nfunction renderSummaryTable(parent: HTMLElement, workouts: Workout[]): void {\n    let card = document.getElementById('statsTableCard');\n    if (!card) {\n        card = document.createElement('div');\n        card.id = 'statsTableCard';\n        card.className = 'card';\n        card.style.background = 'var(--card-bg)';\n        card.style.padding = '16px';\n        card.style.borderRadius = '8px';\n        card.style.border = '1px solid var(--color-border)';\n        parent.appendChild(card);\n    }\n\n    // Constants for periods\n    const now = new Date();\n\n    // Define time ranges\n    // This Week (starts Monday)\n    const startOfWeek = new Date(now);\n    const day = startOfWeek.getDay() || 7; // getDay returns 0 for Sunday\n    if (day !== 1) startOfWeek.setHours(-24 * (day - 1));\n    else startOfWeek.setHours(0, 0, 0, 0);\n    startOfWeek.setHours(0, 0, 0, 0);\n\n    const startOfLastWeek = new Date(startOfWeek);\n    startOfLastWeek.setDate(startOfLastWeek.getDate() - 7);\n    const endOfLastWeek = new Date(startOfWeek);\n\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n    const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\n    const endOfLastMonth = new Date(now.getFullYear(), now.getMonth(), 0, 23, 59, 59);\n\n    const startOfYear = new Date(now.getFullYear(), 0, 1);\n\n    // Buckets\n    const periods: Record<'thisWeek' | 'lastWeek' | 'thisMonth' | 'lastMonth' | 'thisYear', PeriodStats> = {\n        thisWeek: emptyStats(),\n        lastWeek: emptyStats(),\n        thisMonth: emptyStats(),\n        lastMonth: emptyStats(),\n        thisYear: emptyStats(),\n    };\n\n    // Aggregate Data\n    workouts.forEach((w) => {\n        const date = new Date(w.startTime);\n        const summary = getSummary(w);\n\n        // Determine which buckets this workout belongs to\n        const buckets: PeriodStats[] = [];\n\n        if (date >= startOfWeek) buckets.push(periods.thisWeek);\n        if (date >= startOfLastWeek && date < endOfLastWeek) buckets.push(periods.lastWeek);\n        if (date >= startOfMonth) buckets.push(periods.thisMonth);\n        if (date >= startOfLastMonth && date <= endOfLastMonth) buckets.push(periods.lastMonth);\n        if (date >= startOfYear) buckets.push(periods.thisYear);\n\n        // Add to buckets\n        buckets.forEach((stat) => {\n            stat.count++;\n            stat.duration += w.duration || 0;\n            stat.distance += summary.totalDistance || 0;\n            stat.elevation += summary.totalElevationGain || 0;\n\n            // Energy\n            if (summary.totalEnergy) {\n                stat.energy += summary.totalEnergy;\n            } else if (summary.avgPower && w.duration) {\n                stat.energy += (summary.avgPower * w.duration) / 1000;\n            }\n\n            // Weighted Averages\n            const dur = w.duration || 0;\n            if (dur > 0) {\n                if (summary.avgPower) stat.weightedPowerSum += summary.avgPower * dur;\n                if (summary.avgHeartrate) stat.weightedHrSum += summary.avgHeartrate * dur;\n                if (summary.avgCadence) stat.weightedCadenceSum += summary.avgCadence * dur;\n                stat.totalDurationForAvg += dur;\n            }\n        });\n    });\n\n    // Finalize Averages\n    Object.values(periods).forEach((stat) => {\n        if (stat.totalDurationForAvg > 0) {\n            stat.avgPower = Math.round(stat.weightedPowerSum / stat.totalDurationForAvg);\n            stat.avgHr = Math.round(stat.weightedHrSum / stat.totalDurationForAvg);\n            stat.avgCadence = Math.round(stat.weightedCadenceSum / stat.totalDurationForAvg);\n        }\n    });\n\n    // Helpers\n    const renderCell = (val: string) =>\n        `<td style=\"padding: 8px; text-align: right; border-bottom: 1px solid var(--color-border);\">${val}</td>`;\n\n    const formatDist = (m: number) => (m / 1000).toFixed(1) + ' km';\n\n    interface RowDef {\n        label: string;\n        key: keyof PeriodStats;\n        fmt: (v: number) => string;\n    }\n\n    const rows: RowDef[] = [\n        { label: 'Workouts', key: 'count', fmt: (v: number) => v.toString() },\n        { label: 'Distance', key: 'distance', fmt: formatDist },\n        { label: 'Time', key: 'duration', fmt: (v: number) => formatDuration(v) },\n        { label: 'Elevation', key: 'elevation', fmt: (v: number) => v + ' m' },\n        { label: 'Avg Power', key: 'avgPower', fmt: (v: number) => v + ' W' },\n        { label: 'Avg HR', key: 'avgHr', fmt: (v: number) => v + ' bpm' },\n        { label: 'Energy', key: 'energy', fmt: (v: number) => Math.round(v) + ' kJ' },\n    ];\n\n    card.innerHTML = `\n        <h4 style=\"margin: 0 0 12px 0;\"> Period Statistics</h4>\n        <div style=\"overflow-x: auto;\">\n            <table style=\"width: 100%; border-collapse: collapse; font-size: 0.9em;\">\n                <thead>\n                    <tr style=\"background: var(--color-bg-secondary);\">\n                        <th style=\"text-align: left; padding: 8px; border-bottom: 2px solid var(--color-border);\">Metric</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border);\">This Week</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border); color: var(--color-text-secondary);\">Last Week</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border);\">This Month</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border); color: var(--color-text-secondary);\">Last Month</th>\n                        <th style=\"text-align: right; padding: 8px; border-bottom: 2px solid var(--color-border);\">This Year</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${rows\n                        .map(\n                            (row) => `\n                        <tr>\n                            <td style=\"padding: 8px; font-weight: 500; border-bottom: 1px solid var(--color-border);\">${row.label}</td>\n                            ${renderCell(row.fmt(periods.thisWeek[row.key] as number))}\n                            ${renderCell(row.fmt(periods.lastWeek[row.key] as number))}\n                            ${renderCell(row.fmt(periods.thisMonth[row.key] as number))}\n                            ${renderCell(row.fmt(periods.lastMonth[row.key] as number))}\n                            ${renderCell(row.fmt(periods.thisYear[row.key] as number))}\n                        </tr>\n                    `\n                        )\n                        .join('')}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Render the weekly trends chart\n */\nfunction renderTrendsChart(parent: HTMLElement): void {\n    let card = document.getElementById('statsChartCard');\n\n    // Create card if not exists\n    if (!card) {\n        card = document.createElement('div');\n        card.id = 'statsChartCard';\n        card.className = 'card';\n        card.style.background = 'var(--card-bg)';\n        card.style.padding = '16px';\n        card.style.borderRadius = '8px';\n        card.style.border = '1px solid var(--color-border)';\n\n        // Initial HTML structure with header and controls\n        card.innerHTML = `\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;\">\n                <h4 style=\"margin: 0;\"> Weekly Trends (Last 12 Weeks)</h4>\n                <select id=\"trendMetricSelect\" style=\"padding: 4px; border-radius: 4px; border: 1px solid var(--color-border);\">\n                    <option value=\"distance\">Distance</option>\n                    <option value=\"duration\">Time</option>\n                    <option value=\"energy\">Energy</option>\n                    <option value=\"count\">Workouts</option>\n                </select>\n            </div>\n            <div id=\"trendChartContainer\" style=\"height: 200px;\"></div>\n        `;\n\n        parent.appendChild(card);\n\n        // Add event listener\n        const select = card.querySelector('#trendMetricSelect') as HTMLSelectElement;\n        select?.addEventListener('change', (e) => {\n            trendMetric = (e.target as HTMLSelectElement).value as typeof trendMetric;\n            updateChart();\n        });\n    }\n\n    updateChart();\n}\n\n/**\n * Update the chart content based on current state\n */\nfunction updateChart(): void {\n    const container = document.getElementById('trendChartContainer');\n    if (!container) return;\n\n    const select = document.getElementById('trendMetricSelect') as HTMLSelectElement | null;\n    if (select) select.value = trendMetric; // Sync UI\n\n    // Aggregate data by week for the last 12 weeks\n    const weeks: Record<string, number> = {};\n    const now = new Date();\n\n    // Initialize 12 weeks with 0\n    for (let i = 11; i >= 0; i--) {\n        const d = new Date(now);\n        d.setDate(d.getDate() - i * 7);\n        const weekKey = getWeekKey(d);\n        weeks[weekKey] = 0;\n    }\n\n    // Fill data\n    currentWorkouts.forEach((w) => {\n        const date = new Date(w.startTime);\n        const weekKey = getWeekKey(date);\n\n        if (weeks.hasOwnProperty(weekKey)) {\n            const summary = getSummary(w);\n\n            switch (trendMetric) {\n                case 'distance':\n                    weeks[weekKey] += (summary.totalDistance || 0) / 1000; // km\n                    break;\n                case 'duration':\n                    weeks[weekKey] += w.duration || 0; // seconds\n                    break;\n                case 'energy':\n                    if (summary.totalEnergy) {\n                        weeks[weekKey] += summary.totalEnergy;\n                    } else if (summary.avgPower && w.duration) {\n                        weeks[weekKey] += (summary.avgPower * w.duration) / 1000;\n                    }\n                    break;\n                case 'count':\n                    weeks[weekKey] += 1;\n                    break;\n            }\n        }\n    });\n\n    // Convert to points\n    const points: Point[] = Object.entries(weeks)\n        .sort((a, b) => a[0].localeCompare(b[0]))\n        .map(([key, val]) => {\n            // weekKey is \"YYYY-Www\", parse to timestamp for x-axis\n            const [year, week] = key.split('-W').map(Number);\n            // Rough approximation of week start date for chart x-axis\n            const d = getDateFromWeek(year, week);\n            return { x: d.getTime(), y: val };\n        });\n\n    // Chart options\n    let title = '';\n\n    switch (trendMetric) {\n        case 'distance':\n            title = 'Distance (km)';\n            break;\n        case 'duration':\n            title = 'Time (hours)';\n            break; // Chart formatter might need update for hours?\n        case 'energy':\n            title = 'Energy (kJ)';\n            break;\n        case 'count':\n            title = 'Number of Workouts';\n            break;\n    }\n\n    // Special formatting for duration\n    if (trendMetric === 'duration') {\n        points.forEach((p) => (p.y = p.y / 3600)); // Convert seconds to hours\n    }\n\n    renderBarChart(container, points, {\n        title,\n        height: 200,\n        color: 'var(--color-accent)',\n    });\n}\n\n/**\n * Get ISO week string \"YYYY-Www\"\n */\nfunction getWeekKey(date: Date): string {\n    const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\n    const dayNum = d.getUTCDay() || 7;\n    d.setUTCDate(d.getUTCDate() + 4 - dayNum);\n    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n    const weekNo = Math.ceil(((d.getTime() - yearStart.getTime()) / 86400000 + 1) / 7);\n    return `${d.getUTCFullYear()}-W${weekNo.toString().padStart(2, '0')}`;\n}\n\n/**\n * Get date object from year and week number\n */\nfunction getDateFromWeek(year: number, week: number): Date {\n    const d = new Date(year, 0, 1 + (week - 1) * 7);\n    const day = d.getDay();\n    const diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday\n    return new Date(d.setDate(diff));\n}\n","/**\n * Workout Cropping Utility\n *\n * Provides functionality to crop workout data (measurements) based on start and end timestamps.\n * Recalculates summary statistics after cropping.\n *\n * @module utils/cropWorkout\n */\n\nimport type {\n    MeasurementsData,\n    Measurement,\n    GpsPoint,\n    TreadmillMeasurement,\n    LapMarker,\n    WorkoutSummary,\n} from '../types/measurements.js';\nimport { calculateWorkoutSummary, type WorkoutSummary as ModalWorkoutSummary } from '../ui/modal.js';\n\n/**\n * Result of a crop operation\n */\nexport interface CroppedWorkoutData {\n    startTime: number;\n    endTime: number;\n    duration: number;\n    measurements: MeasurementsData;\n    summary: WorkoutSummary;\n}\n\n/**\n * Crops workout measurements to a specific time range.\n *\n * @param measurements Original measurement data\n * @param originalStartTime The original start time of the workout (ms)\n * @param newStartTime New start time (ms) - absolute timestamp, must be >= originalStartTime\n * @param newEndTime New end time (ms) - absolute timestamp, must be <= originalEndTime\n * @returns Cropped measurements and recalculated summary\n */\nexport function cropWorkout(\n    measurements: MeasurementsData,\n    originalStartTime: number,\n    newStartTime: number,\n    newEndTime: number\n): CroppedWorkoutData {\n    // Ensure bounds are valid\n    const start = Math.max(originalStartTime, newStartTime);\n    const end = Math.max(start, newEndTime);\n\n    // Filter function for standard Measurement[]\n    const filterMeasurements = (data: Measurement[]) => {\n        return data.filter((m) => m.timestamp >= start && m.timestamp <= end);\n    };\n\n    // Filter specific types\n    const croppedMeasurements: MeasurementsData = {\n        heartrate: filterMeasurements(measurements.heartrate || []),\n        power: filterMeasurements(measurements.power || []),\n        cadence: filterMeasurements(measurements.cadence || []),\n        speed: filterMeasurements(measurements.speed || []),\n        distance: filterMeasurements(measurements.distance || []),\n        altitude: filterMeasurements(measurements.altitude || []),\n        gps: (measurements.gps || []).filter((p: GpsPoint) => p.timestamp >= start && p.timestamp <= end),\n        treadmill: (measurements.treadmill || []).filter(\n            (t: TreadmillMeasurement) => t.timestamp >= start && t.timestamp <= end\n        ),\n        treadmillSpeed: filterMeasurements(measurements.treadmillSpeed || []),\n        laps: (measurements.laps || []).filter((l: LapMarker) => l.timestamp >= start && l.timestamp <= end),\n    };\n\n    // Calculate new duration (seconds)\n    const duration = Math.floor((end - start) / 1000);\n\n    // Recalculate summary using modal's calculator\n    const modalSummary: ModalWorkoutSummary = calculateWorkoutSummary(start, end, {\n        power: croppedMeasurements.power,\n        heartrate: croppedMeasurements.heartrate,\n        cadence: croppedMeasurements.cadence,\n    });\n\n    // Convert to standard flat WorkoutSummary\n    const summary: WorkoutSummary = {\n        startTime: start,\n        endTime: end,\n        totalDuration: duration,\n        avgPower: modalSummary.power.avg ?? undefined,\n        maxPower: modalSummary.power.max ?? undefined,\n        avgHeartrate: modalSummary.heartrate.avg ?? undefined,\n        maxHeartrate: modalSummary.heartrate.max ?? undefined,\n        avgCadence: modalSummary.cadence.avg ?? undefined,\n        maxCadence: modalSummary.cadence.max ?? undefined,\n        // Calculate energy\n        // modalSummary doesn't have energy?\n        // simple calculation: avgPower * duration (seconds) / 1000 = kJ\n        // But better: sum of (watts * delta_time)\n        // For now use avg:\n        // (avgWatts * seconds) / 1000 = kJ\n        // Wait, modalSummary doesn't seem to calculate energy in recent snippet.\n    };\n\n    if (summary.avgPower) {\n        // Estimate energy (kJ)\n        // Power is Watts (J/s). kJ = Watts * seconds / 1000\n        // Approximate using average power\n        // For better accuracy we should integrate, but this matches basic summary often\n        // Check if there is a 'totalEnergy' field in WorkoutSummary (types/measurements.ts doesn't show it but workoutHistory used it)\n        // types/measurements.ts doesn't show totalEnergy.\n        // ui/workoutHistory.ts used summary.totalEnergy.\n        // Let's check ui/workoutHistory.ts getSummary again.\n        // It said \"interface WorkoutSummary { ... totalEnergy?: number ... }\" inside workoutHistory.ts\n        // So the local interface has it.\n        // types/measurements.ts defines WorkoutSummary, does it have totalEnergy?\n        // I read lines 100-127 of types/measurements.ts and it DID NOT have totalEnergy.\n        // But ui/workoutHistory.ts uses it.\n        // So there's a disconnect.\n        // Calculate totalEnergy\n        summary.totalEnergy = Math.round((summary.avgPower * duration) / 1000);\n    }\n\n    // Add distance\n    if (croppedMeasurements.distance.length > 0) {\n        const first = croppedMeasurements.distance[0].value;\n        const last = croppedMeasurements.distance[croppedMeasurements.distance.length - 1].value;\n        summary.totalDistance = Math.max(0, last - first);\n    }\n\n    return {\n        startTime: start,\n        endTime: end,\n        duration,\n        measurements: croppedMeasurements,\n        summary,\n    };\n}\n","import type { TrainingPlan } from '../types.js';\nimport type { StructuredWorkout } from '../../workouts/types.js';\n\n// Helper to create a simple workout for the plan\nconst createIntervalWorkout = (id: string, name: string, description: string): StructuredWorkout => {\n    return {\n        id,\n        name,\n        description,\n        steps: [\n            { type: 'warmup', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 90 } },\n            { type: 'recovery', duration: 180, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 90 } },\n            { type: 'recovery', duration: 180, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 90 } },\n            { type: 'cooldown', duration: 600, target: { type: 'power', unit: 'percent_ftp', value: 40 } },\n        ],\n    };\n};\n\nconst createEnduranceWorkout = (id: string, name: string): StructuredWorkout => {\n    return {\n        id,\n        name,\n        description: 'Steady zone 2 effort',\n        steps: [\n            { type: 'warmup', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n            { type: 'active', duration: 1800, target: { type: 'power', unit: 'percent_ftp', value: 65 } }, // 30 min Z2\n            { type: 'cooldown', duration: 300, target: { type: 'power', unit: 'percent_ftp', value: 50 } },\n        ],\n    };\n};\n\nexport const ftpBuilderPlan: TrainingPlan = {\n    id: 'plan-ftp-builder-1',\n    name: '4-Week FTP Booster',\n    description:\n        'A focused 4-week block designed to raise your functional threshold power through sweet spot and threshold intervals.',\n    difficulty: 'intermediate',\n    created: Date.now(),\n    updated: Date.now(),\n    weeks: [\n        {\n            weekNumber: 1,\n            focus: 'Introduction',\n            days: [\n                { dayOfWeek: 1, isRestDay: true, notes: 'Rest day. Stretch.' },\n                {\n                    dayOfWeek: 2,\n                    isRestDay: false,\n                    workout: createIntervalWorkout('ftp-w1-d2', 'Intro Intervals', 'Basic intervals'),\n                },\n                { dayOfWeek: 3, isRestDay: false, workout: createEnduranceWorkout('ftp-w1-d3', 'Aerobic Base') },\n                { dayOfWeek: 4, isRestDay: true },\n                {\n                    dayOfWeek: 5,\n                    isRestDay: false,\n                    workout: createIntervalWorkout('ftp-w1-d5', 'Tempo Work', 'Harder intervals'),\n                },\n                { dayOfWeek: 6, isRestDay: true },\n                { dayOfWeek: 7, isRestDay: false, workout: createEnduranceWorkout('ftp-w1-d7', 'Long Ride') },\n            ],\n        },\n        {\n            weekNumber: 2,\n            focus: 'Build',\n            days: [\n                { dayOfWeek: 1, isRestDay: true },\n                {\n                    dayOfWeek: 2,\n                    isRestDay: false,\n                    workout: createIntervalWorkout('ftp-w2-d2', 'Threshold Push', 'Pushing limits'),\n                },\n                { dayOfWeek: 3, isRestDay: false, workout: createEnduranceWorkout('ftp-w2-d3', 'Recovery Spin') },\n                { dayOfWeek: 4, isRestDay: true },\n                {\n                    dayOfWeek: 5,\n                    isRestDay: false,\n                    workout: createIntervalWorkout('ftp-w2-d5', 'O/U Intervals', 'Over Unders'),\n                },\n                { dayOfWeek: 6, isRestDay: true },\n                { dayOfWeek: 7, isRestDay: false, workout: createEnduranceWorkout('ftp-w2-d7', 'Sunday Long Ride') },\n            ],\n        },\n    ],\n};\n","import type { TrainingPlan } from './types.js';\nimport { ftpBuilderPlan } from './library/ftpBuilder.js';\n\nexport interface PlanProgress {\n    planId: string;\n    startDate: number; // Timestamp\n    completedDays: Record<string, boolean>; // key format: \"week-day\" e.g. \"1-2\" (Week 1, Tuesday)\n}\n\nconst STORAGE_KEY_PLANS = 'bpt-user-plans';\nconst STORAGE_KEY_PROGRESS = 'bpt-plan-progress';\n\nclass PlanRepository {\n    private systemPlans: TrainingPlan[] = [];\n\n    constructor() {\n        this.registerSystemPlan(ftpBuilderPlan);\n    }\n\n    public registerSystemPlan(plan: TrainingPlan) {\n        this.systemPlans.push(plan);\n    }\n\n    public getAllPlans(): TrainingPlan[] {\n        const userPlans = this.getUserPlans();\n        return [...this.systemPlans, ...userPlans];\n    }\n\n    public getPlan(id: string): TrainingPlan | undefined {\n        return this.getAllPlans().find((p) => p.id === id);\n    }\n\n    public getUserPlans(): TrainingPlan[] {\n        try {\n            const raw = localStorage.getItem(STORAGE_KEY_PLANS);\n            return raw ? JSON.parse(raw) : [];\n        } catch (e) {\n            console.error('Failed to load user plans', e);\n            return [];\n        }\n    }\n\n    public saveUserPlan(plan: TrainingPlan): void {\n        const plans = this.getUserPlans();\n        const existingIndex = plans.findIndex((p) => p.id === plan.id);\n\n        if (existingIndex >= 0) {\n            plans[existingIndex] = plan;\n        } else {\n            plans.push(plan);\n        }\n\n        localStorage.setItem(STORAGE_KEY_PLANS, JSON.stringify(plans));\n    }\n\n    public getActiveProgress(): PlanProgress | null {\n        try {\n            const raw = localStorage.getItem(STORAGE_KEY_PROGRESS);\n            return raw ? JSON.parse(raw) : null;\n        } catch {\n            return null;\n        }\n    }\n\n    public startPlan(planId: string, startDate: number = Date.now()): void {\n        const progress: PlanProgress = {\n            planId,\n            startDate,\n            completedDays: {},\n        };\n        localStorage.setItem(STORAGE_KEY_PROGRESS, JSON.stringify(progress));\n    }\n\n    public markDayComplete(week: number, day: number): void {\n        const progress = this.getActiveProgress();\n        if (!progress) return; // No active plan\n\n        const key = `${week}-${day}`;\n        progress.completedDays[key] = true;\n        localStorage.setItem(STORAGE_KEY_PROGRESS, JSON.stringify(progress));\n    }\n\n    public stopActivePlan(): void {\n        localStorage.removeItem(STORAGE_KEY_PROGRESS);\n    }\n}\n\nexport const planRepository = new PlanRepository();\n","/**\n * Scheduled Workout Storage\n *\n * Manages retrieval of planned workouts from active training plans\n * and manual schedules.\n */\n\nimport { planRepository } from '../plans/planRepository.js';\nimport type { TrainingPlan } from '../plans/types.js';\nimport { getWorkoutById, getWorkoutDuration } from '../workouts/workoutLibrary.js';\nimport { getCustomWorkouts } from '../storage/customWorkouts.js';\n\nexport interface CalendarEvent {\n    id: string;\n    title: string;\n    date: Date;\n    type: 'plan' | 'manual';\n    status: 'planned' | 'completed' | 'skipped';\n    duration?: number;\n    description?: string;\n    planId?: string;\n    week?: number;\n    day?: number;\n}\n\n/**\n * Get all scheduled events within a date range\n */\nexport function getScheduledEvents(startDate: Date, endDate: Date): CalendarEvent[] {\n    const events: CalendarEvent[] = [];\n\n    // 1. Get Plan Events\n    const planProgress = planRepository.getActiveProgress();\n    if (planProgress) {\n        const plan = planRepository.getPlan(planProgress.planId);\n        if (plan) {\n            events.push(...getPlanEvents(plan, planProgress.startDate, startDate, endDate));\n        }\n    }\n\n    // 2. Get Manual Events (TODO: Implement storage for manual events)\n    // const manualEvents = getManualEvents();\n    // events.push(...manualEvents);\n\n    return events.sort((a, b) => a.date.getTime() - b.date.getTime());\n}\n\n/**\n * Project a plan onto a date range\n */\nfunction getPlanEvents(plan: TrainingPlan, planStartDate: number, rangeStart: Date, rangeEnd: Date): CalendarEvent[] {\n    const events: CalendarEvent[] = [];\n    const planStart = new Date(planStartDate);\n\n    // Normalize plan start to the Monday of that week?\n    // Or assume planStart IS the start.\n    // Let's assume planStart is Day 1 of Week 1.\n    // If the plan defines specific days of week (e.g. 0=Sun), we should align.\n\n    // Strategy: Iterate through weeks of the plan.\n    plan.weeks.forEach((week) => {\n        week.days.forEach((day) => {\n            if (day.isRestDay) return;\n\n            // Calculate date\n            // Week is 1-based in types usually? Let's check. planRepository types says \"weekNumber: number\".\n            // Assuming weekNumber starts at 1.\n            const weekOffset = (week.weekNumber - 1) * 7;\n\n            // Day adjustment.\n            // If the plan specifies days (0-6), we want to align with those.\n            // But we don't know if planStart is Monday or Sunday.\n            // Let's assume planStart aligns to the FIRST DAY defined in the plan, or simple day offset.\n\n            // Simple approach:\n            // If planStart is a Monday.\n            // Week 1, Monday (1) = planStart + (1-1) days.\n            // Week 1, Wednesday (3) = planStart + (3-1) days.\n\n            // If we treat planStart as the anchor for \"Week 1, Day 0 (Sunday)? Or Monday?\"\n            // Let's assume planStart is simply the date of \"Week 1, Day 1 (if it exists)\".\n            // BUT PlanDay uses `dayOfWeek` (0-6).\n\n            // Robust approach: Find the start of the week for planStart.\n            // We want Sunday to take us back to Sunday week start, or Monday.\n            // Let's assume standard ISO week (Monday start) or just respect the Date.\n\n            // Let's project relative to the Sunday of the start week.\n            const dayOfStart = planStart.getDay();\n            const diffToSunday = dayOfStart; // 0=Sunday.\n            const sundayOfStartWeek = new Date(planStart);\n            sundayOfStartWeek.setDate(planStart.getDate() - diffToSunday);\n\n            // Target date = SundayOfStartWeek + (Week-1)*7 + DayOfWeek\n            const targetDate = new Date(sundayOfStartWeek);\n            targetDate.setDate(sundayOfStartWeek.getDate() + weekOffset + day.dayOfWeek);\n\n            // Resolve workout details for duration/name\n            let resolvedWorkout = day.workout;\n            if (!resolvedWorkout && day.workoutId) {\n                resolvedWorkout = getWorkoutById(day.workoutId);\n                // Also check custom workouts if not in standard library\n                if (!resolvedWorkout) {\n                    const customs = getCustomWorkouts();\n                    resolvedWorkout = customs.find((w) => w.id === day.workoutId);\n                }\n            }\n\n            // Start of today for calculation\n            const todayStart = new Date();\n            todayStart.setHours(0, 0, 0, 0);\n\n            // Check range\n            if (targetDate >= rangeStart && targetDate <= rangeEnd) {\n                // Determine status\n                // We need to check if it's marked complete in planRepository\n                // Key format: \"week-day\" e.g. \"1-2\" (Week 1, DayOfWeek 2) ??\n                // planRepository.markDayComplete uses week, day args.\n                // It likely uses the values from loop.\n                const isCompleted = isDayComplete(plan.id, week.weekNumber, day.dayOfWeek);\n                const duration = resolvedWorkout ? getWorkoutDuration(resolvedWorkout) : 0;\n                const title =\n                    day.workout?.name || resolvedWorkout?.name || `Week ${week.weekNumber} Day ${day.dayOfWeek}`;\n\n                // Normalize targetDate to ensure correct comparison (it should already be 00:00ish from logic above?)\n                // sundayOfStartWeek was derived from planStart. If planStart had time, targetDate has time.\n                // Let's strip time from targetDate just in case.\n                targetDate.setHours(0, 0, 0, 0);\n\n                let status: CalendarEvent['status'] = 'planned';\n                if (isCompleted) {\n                    status = 'completed';\n                } else if (targetDate < todayStart) {\n                    status = 'skipped';\n                }\n\n                events.push({\n                    id: `plan-${plan.id}-w${week.weekNumber}-d${day.dayOfWeek}`,\n                    title,\n                    date: targetDate,\n                    type: 'plan',\n                    status,\n                    duration,\n                    description: day.notes,\n                    planId: plan.id,\n                    week: week.weekNumber,\n                    day: day.dayOfWeek,\n                });\n            }\n        });\n    });\n\n    return events;\n}\n\nfunction isDayComplete(planId: string, week: number, day: number): boolean {\n    const progress = planRepository.getActiveProgress();\n    if (!progress || progress.planId !== planId) return false;\n    return !!progress.completedDays[`${week}-${day}`];\n}\n","/*!\n * @kurkle/color v0.3.4\n * https://github.com/kurkle/color#readme\n * (c) 2024 Jukka Kurkela\n * Released under the MIT License\n */\nfunction round(v) {\n  return v + 0.5 | 0;\n}\nconst lim = (v, l, h) => Math.max(Math.min(v, h), l);\nfunction p2b(v) {\n  return lim(round(v * 2.55), 0, 255);\n}\nfunction b2p(v) {\n  return lim(round(v / 2.55), 0, 100);\n}\nfunction n2b(v) {\n  return lim(round(v * 255), 0, 255);\n}\nfunction b2n(v) {\n  return lim(round(v / 2.55) / 100, 0, 1);\n}\nfunction n2p(v) {\n  return lim(round(v * 100), 0, 100);\n}\n\nconst map$1 = {0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9, A: 10, B: 11, C: 12, D: 13, E: 14, F: 15, a: 10, b: 11, c: 12, d: 13, e: 14, f: 15};\nconst hex = [...'0123456789ABCDEF'];\nconst h1 = b => hex[b & 0xF];\nconst h2 = b => hex[(b & 0xF0) >> 4] + hex[b & 0xF];\nconst eq = b => ((b & 0xF0) >> 4) === (b & 0xF);\nconst isShort = v => eq(v.r) && eq(v.g) && eq(v.b) && eq(v.a);\nfunction hexParse(str) {\n  var len = str.length;\n  var ret;\n  if (str[0] === '#') {\n    if (len === 4 || len === 5) {\n      ret = {\n        r: 255 & map$1[str[1]] * 17,\n        g: 255 & map$1[str[2]] * 17,\n        b: 255 & map$1[str[3]] * 17,\n        a: len === 5 ? map$1[str[4]] * 17 : 255\n      };\n    } else if (len === 7 || len === 9) {\n      ret = {\n        r: map$1[str[1]] << 4 | map$1[str[2]],\n        g: map$1[str[3]] << 4 | map$1[str[4]],\n        b: map$1[str[5]] << 4 | map$1[str[6]],\n        a: len === 9 ? (map$1[str[7]] << 4 | map$1[str[8]]) : 255\n      };\n    }\n  }\n  return ret;\n}\nconst alpha = (a, f) => a < 255 ? f(a) : '';\nfunction hexString(v) {\n  var f = isShort(v) ? h1 : h2;\n  return v\n    ? '#' + f(v.r) + f(v.g) + f(v.b) + alpha(v.a, f)\n    : undefined;\n}\n\nconst HUE_RE = /^(hsla?|hwb|hsv)\\(\\s*([-+.e\\d]+)(?:deg)?[\\s,]+([-+.e\\d]+)%[\\s,]+([-+.e\\d]+)%(?:[\\s,]+([-+.e\\d]+)(%)?)?\\s*\\)$/;\nfunction hsl2rgbn(h, s, l) {\n  const a = s * Math.min(l, 1 - l);\n  const f = (n, k = (n + h / 30) % 12) => l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n  return [f(0), f(8), f(4)];\n}\nfunction hsv2rgbn(h, s, v) {\n  const f = (n, k = (n + h / 60) % 6) => v - v * s * Math.max(Math.min(k, 4 - k, 1), 0);\n  return [f(5), f(3), f(1)];\n}\nfunction hwb2rgbn(h, w, b) {\n  const rgb = hsl2rgbn(h, 1, 0.5);\n  let i;\n  if (w + b > 1) {\n    i = 1 / (w + b);\n    w *= i;\n    b *= i;\n  }\n  for (i = 0; i < 3; i++) {\n    rgb[i] *= 1 - w - b;\n    rgb[i] += w;\n  }\n  return rgb;\n}\nfunction hueValue(r, g, b, d, max) {\n  if (r === max) {\n    return ((g - b) / d) + (g < b ? 6 : 0);\n  }\n  if (g === max) {\n    return (b - r) / d + 2;\n  }\n  return (r - g) / d + 4;\n}\nfunction rgb2hsl(v) {\n  const range = 255;\n  const r = v.r / range;\n  const g = v.g / range;\n  const b = v.b / range;\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const l = (max + min) / 2;\n  let h, s, d;\n  if (max !== min) {\n    d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n    h = hueValue(r, g, b, d, max);\n    h = h * 60 + 0.5;\n  }\n  return [h | 0, s || 0, l];\n}\nfunction calln(f, a, b, c) {\n  return (\n    Array.isArray(a)\n      ? f(a[0], a[1], a[2])\n      : f(a, b, c)\n  ).map(n2b);\n}\nfunction hsl2rgb(h, s, l) {\n  return calln(hsl2rgbn, h, s, l);\n}\nfunction hwb2rgb(h, w, b) {\n  return calln(hwb2rgbn, h, w, b);\n}\nfunction hsv2rgb(h, s, v) {\n  return calln(hsv2rgbn, h, s, v);\n}\nfunction hue(h) {\n  return (h % 360 + 360) % 360;\n}\nfunction hueParse(str) {\n  const m = HUE_RE.exec(str);\n  let a = 255;\n  let v;\n  if (!m) {\n    return;\n  }\n  if (m[5] !== v) {\n    a = m[6] ? p2b(+m[5]) : n2b(+m[5]);\n  }\n  const h = hue(+m[2]);\n  const p1 = +m[3] / 100;\n  const p2 = +m[4] / 100;\n  if (m[1] === 'hwb') {\n    v = hwb2rgb(h, p1, p2);\n  } else if (m[1] === 'hsv') {\n    v = hsv2rgb(h, p1, p2);\n  } else {\n    v = hsl2rgb(h, p1, p2);\n  }\n  return {\n    r: v[0],\n    g: v[1],\n    b: v[2],\n    a: a\n  };\n}\nfunction rotate(v, deg) {\n  var h = rgb2hsl(v);\n  h[0] = hue(h[0] + deg);\n  h = hsl2rgb(h);\n  v.r = h[0];\n  v.g = h[1];\n  v.b = h[2];\n}\nfunction hslString(v) {\n  if (!v) {\n    return;\n  }\n  const a = rgb2hsl(v);\n  const h = a[0];\n  const s = n2p(a[1]);\n  const l = n2p(a[2]);\n  return v.a < 255\n    ? `hsla(${h}, ${s}%, ${l}%, ${b2n(v.a)})`\n    : `hsl(${h}, ${s}%, ${l}%)`;\n}\n\nconst map = {\n\tx: 'dark',\n\tZ: 'light',\n\tY: 're',\n\tX: 'blu',\n\tW: 'gr',\n\tV: 'medium',\n\tU: 'slate',\n\tA: 'ee',\n\tT: 'ol',\n\tS: 'or',\n\tB: 'ra',\n\tC: 'lateg',\n\tD: 'ights',\n\tR: 'in',\n\tQ: 'turquois',\n\tE: 'hi',\n\tP: 'ro',\n\tO: 'al',\n\tN: 'le',\n\tM: 'de',\n\tL: 'yello',\n\tF: 'en',\n\tK: 'ch',\n\tG: 'arks',\n\tH: 'ea',\n\tI: 'ightg',\n\tJ: 'wh'\n};\nconst names$1 = {\n\tOiceXe: 'f0f8ff',\n\tantiquewEte: 'faebd7',\n\taqua: 'ffff',\n\taquamarRe: '7fffd4',\n\tazuY: 'f0ffff',\n\tbeige: 'f5f5dc',\n\tbisque: 'ffe4c4',\n\tblack: '0',\n\tblanKedOmond: 'ffebcd',\n\tXe: 'ff',\n\tXeviTet: '8a2be2',\n\tbPwn: 'a52a2a',\n\tburlywood: 'deb887',\n\tcaMtXe: '5f9ea0',\n\tKartYuse: '7fff00',\n\tKocTate: 'd2691e',\n\tcSO: 'ff7f50',\n\tcSnflowerXe: '6495ed',\n\tcSnsilk: 'fff8dc',\n\tcrimson: 'dc143c',\n\tcyan: 'ffff',\n\txXe: '8b',\n\txcyan: '8b8b',\n\txgTMnPd: 'b8860b',\n\txWay: 'a9a9a9',\n\txgYF: '6400',\n\txgYy: 'a9a9a9',\n\txkhaki: 'bdb76b',\n\txmagFta: '8b008b',\n\txTivegYF: '556b2f',\n\txSange: 'ff8c00',\n\txScEd: '9932cc',\n\txYd: '8b0000',\n\txsOmon: 'e9967a',\n\txsHgYF: '8fbc8f',\n\txUXe: '483d8b',\n\txUWay: '2f4f4f',\n\txUgYy: '2f4f4f',\n\txQe: 'ced1',\n\txviTet: '9400d3',\n\tdAppRk: 'ff1493',\n\tdApskyXe: 'bfff',\n\tdimWay: '696969',\n\tdimgYy: '696969',\n\tdodgerXe: '1e90ff',\n\tfiYbrick: 'b22222',\n\tflSOwEte: 'fffaf0',\n\tfoYstWAn: '228b22',\n\tfuKsia: 'ff00ff',\n\tgaRsbSo: 'dcdcdc',\n\tghostwEte: 'f8f8ff',\n\tgTd: 'ffd700',\n\tgTMnPd: 'daa520',\n\tWay: '808080',\n\tgYF: '8000',\n\tgYFLw: 'adff2f',\n\tgYy: '808080',\n\thoneyMw: 'f0fff0',\n\thotpRk: 'ff69b4',\n\tRdianYd: 'cd5c5c',\n\tRdigo: '4b0082',\n\tivSy: 'fffff0',\n\tkhaki: 'f0e68c',\n\tlavFMr: 'e6e6fa',\n\tlavFMrXsh: 'fff0f5',\n\tlawngYF: '7cfc00',\n\tNmoncEffon: 'fffacd',\n\tZXe: 'add8e6',\n\tZcSO: 'f08080',\n\tZcyan: 'e0ffff',\n\tZgTMnPdLw: 'fafad2',\n\tZWay: 'd3d3d3',\n\tZgYF: '90ee90',\n\tZgYy: 'd3d3d3',\n\tZpRk: 'ffb6c1',\n\tZsOmon: 'ffa07a',\n\tZsHgYF: '20b2aa',\n\tZskyXe: '87cefa',\n\tZUWay: '778899',\n\tZUgYy: '778899',\n\tZstAlXe: 'b0c4de',\n\tZLw: 'ffffe0',\n\tlime: 'ff00',\n\tlimegYF: '32cd32',\n\tlRF: 'faf0e6',\n\tmagFta: 'ff00ff',\n\tmaPon: '800000',\n\tVaquamarRe: '66cdaa',\n\tVXe: 'cd',\n\tVScEd: 'ba55d3',\n\tVpurpN: '9370db',\n\tVsHgYF: '3cb371',\n\tVUXe: '7b68ee',\n\tVsprRggYF: 'fa9a',\n\tVQe: '48d1cc',\n\tVviTetYd: 'c71585',\n\tmidnightXe: '191970',\n\tmRtcYam: 'f5fffa',\n\tmistyPse: 'ffe4e1',\n\tmoccasR: 'ffe4b5',\n\tnavajowEte: 'ffdead',\n\tnavy: '80',\n\tTdlace: 'fdf5e6',\n\tTive: '808000',\n\tTivedBb: '6b8e23',\n\tSange: 'ffa500',\n\tSangeYd: 'ff4500',\n\tScEd: 'da70d6',\n\tpOegTMnPd: 'eee8aa',\n\tpOegYF: '98fb98',\n\tpOeQe: 'afeeee',\n\tpOeviTetYd: 'db7093',\n\tpapayawEp: 'ffefd5',\n\tpHKpuff: 'ffdab9',\n\tperu: 'cd853f',\n\tpRk: 'ffc0cb',\n\tplum: 'dda0dd',\n\tpowMrXe: 'b0e0e6',\n\tpurpN: '800080',\n\tYbeccapurpN: '663399',\n\tYd: 'ff0000',\n\tPsybrown: 'bc8f8f',\n\tPyOXe: '4169e1',\n\tsaddNbPwn: '8b4513',\n\tsOmon: 'fa8072',\n\tsandybPwn: 'f4a460',\n\tsHgYF: '2e8b57',\n\tsHshell: 'fff5ee',\n\tsiFna: 'a0522d',\n\tsilver: 'c0c0c0',\n\tskyXe: '87ceeb',\n\tUXe: '6a5acd',\n\tUWay: '708090',\n\tUgYy: '708090',\n\tsnow: 'fffafa',\n\tsprRggYF: 'ff7f',\n\tstAlXe: '4682b4',\n\ttan: 'd2b48c',\n\tteO: '8080',\n\ttEstN: 'd8bfd8',\n\ttomato: 'ff6347',\n\tQe: '40e0d0',\n\tviTet: 'ee82ee',\n\tJHt: 'f5deb3',\n\twEte: 'ffffff',\n\twEtesmoke: 'f5f5f5',\n\tLw: 'ffff00',\n\tLwgYF: '9acd32'\n};\nfunction unpack() {\n  const unpacked = {};\n  const keys = Object.keys(names$1);\n  const tkeys = Object.keys(map);\n  let i, j, k, ok, nk;\n  for (i = 0; i < keys.length; i++) {\n    ok = nk = keys[i];\n    for (j = 0; j < tkeys.length; j++) {\n      k = tkeys[j];\n      nk = nk.replace(k, map[k]);\n    }\n    k = parseInt(names$1[ok], 16);\n    unpacked[nk] = [k >> 16 & 0xFF, k >> 8 & 0xFF, k & 0xFF];\n  }\n  return unpacked;\n}\n\nlet names;\nfunction nameParse(str) {\n  if (!names) {\n    names = unpack();\n    names.transparent = [0, 0, 0, 0];\n  }\n  const a = names[str.toLowerCase()];\n  return a && {\n    r: a[0],\n    g: a[1],\n    b: a[2],\n    a: a.length === 4 ? a[3] : 255\n  };\n}\n\nconst RGB_RE = /^rgba?\\(\\s*([-+.\\d]+)(%)?[\\s,]+([-+.e\\d]+)(%)?[\\s,]+([-+.e\\d]+)(%)?(?:[\\s,/]+([-+.e\\d]+)(%)?)?\\s*\\)$/;\nfunction rgbParse(str) {\n  const m = RGB_RE.exec(str);\n  let a = 255;\n  let r, g, b;\n  if (!m) {\n    return;\n  }\n  if (m[7] !== r) {\n    const v = +m[7];\n    a = m[8] ? p2b(v) : lim(v * 255, 0, 255);\n  }\n  r = +m[1];\n  g = +m[3];\n  b = +m[5];\n  r = 255 & (m[2] ? p2b(r) : lim(r, 0, 255));\n  g = 255 & (m[4] ? p2b(g) : lim(g, 0, 255));\n  b = 255 & (m[6] ? p2b(b) : lim(b, 0, 255));\n  return {\n    r: r,\n    g: g,\n    b: b,\n    a: a\n  };\n}\nfunction rgbString(v) {\n  return v && (\n    v.a < 255\n      ? `rgba(${v.r}, ${v.g}, ${v.b}, ${b2n(v.a)})`\n      : `rgb(${v.r}, ${v.g}, ${v.b})`\n  );\n}\n\nconst to = v => v <= 0.0031308 ? v * 12.92 : Math.pow(v, 1.0 / 2.4) * 1.055 - 0.055;\nconst from = v => v <= 0.04045 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);\nfunction interpolate(rgb1, rgb2, t) {\n  const r = from(b2n(rgb1.r));\n  const g = from(b2n(rgb1.g));\n  const b = from(b2n(rgb1.b));\n  return {\n    r: n2b(to(r + t * (from(b2n(rgb2.r)) - r))),\n    g: n2b(to(g + t * (from(b2n(rgb2.g)) - g))),\n    b: n2b(to(b + t * (from(b2n(rgb2.b)) - b))),\n    a: rgb1.a + t * (rgb2.a - rgb1.a)\n  };\n}\n\nfunction modHSL(v, i, ratio) {\n  if (v) {\n    let tmp = rgb2hsl(v);\n    tmp[i] = Math.max(0, Math.min(tmp[i] + tmp[i] * ratio, i === 0 ? 360 : 1));\n    tmp = hsl2rgb(tmp);\n    v.r = tmp[0];\n    v.g = tmp[1];\n    v.b = tmp[2];\n  }\n}\nfunction clone(v, proto) {\n  return v ? Object.assign(proto || {}, v) : v;\n}\nfunction fromObject(input) {\n  var v = {r: 0, g: 0, b: 0, a: 255};\n  if (Array.isArray(input)) {\n    if (input.length >= 3) {\n      v = {r: input[0], g: input[1], b: input[2], a: 255};\n      if (input.length > 3) {\n        v.a = n2b(input[3]);\n      }\n    }\n  } else {\n    v = clone(input, {r: 0, g: 0, b: 0, a: 1});\n    v.a = n2b(v.a);\n  }\n  return v;\n}\nfunction functionParse(str) {\n  if (str.charAt(0) === 'r') {\n    return rgbParse(str);\n  }\n  return hueParse(str);\n}\nclass Color {\n  constructor(input) {\n    if (input instanceof Color) {\n      return input;\n    }\n    const type = typeof input;\n    let v;\n    if (type === 'object') {\n      v = fromObject(input);\n    } else if (type === 'string') {\n      v = hexParse(input) || nameParse(input) || functionParse(input);\n    }\n    this._rgb = v;\n    this._valid = !!v;\n  }\n  get valid() {\n    return this._valid;\n  }\n  get rgb() {\n    var v = clone(this._rgb);\n    if (v) {\n      v.a = b2n(v.a);\n    }\n    return v;\n  }\n  set rgb(obj) {\n    this._rgb = fromObject(obj);\n  }\n  rgbString() {\n    return this._valid ? rgbString(this._rgb) : undefined;\n  }\n  hexString() {\n    return this._valid ? hexString(this._rgb) : undefined;\n  }\n  hslString() {\n    return this._valid ? hslString(this._rgb) : undefined;\n  }\n  mix(color, weight) {\n    if (color) {\n      const c1 = this.rgb;\n      const c2 = color.rgb;\n      let w2;\n      const p = weight === w2 ? 0.5 : weight;\n      const w = 2 * p - 1;\n      const a = c1.a - c2.a;\n      const w1 = ((w * a === -1 ? w : (w + a) / (1 + w * a)) + 1) / 2.0;\n      w2 = 1 - w1;\n      c1.r = 0xFF & w1 * c1.r + w2 * c2.r + 0.5;\n      c1.g = 0xFF & w1 * c1.g + w2 * c2.g + 0.5;\n      c1.b = 0xFF & w1 * c1.b + w2 * c2.b + 0.5;\n      c1.a = p * c1.a + (1 - p) * c2.a;\n      this.rgb = c1;\n    }\n    return this;\n  }\n  interpolate(color, t) {\n    if (color) {\n      this._rgb = interpolate(this._rgb, color._rgb, t);\n    }\n    return this;\n  }\n  clone() {\n    return new Color(this.rgb);\n  }\n  alpha(a) {\n    this._rgb.a = n2b(a);\n    return this;\n  }\n  clearer(ratio) {\n    const rgb = this._rgb;\n    rgb.a *= 1 - ratio;\n    return this;\n  }\n  greyscale() {\n    const rgb = this._rgb;\n    const val = round(rgb.r * 0.3 + rgb.g * 0.59 + rgb.b * 0.11);\n    rgb.r = rgb.g = rgb.b = val;\n    return this;\n  }\n  opaquer(ratio) {\n    const rgb = this._rgb;\n    rgb.a *= 1 + ratio;\n    return this;\n  }\n  negate() {\n    const v = this._rgb;\n    v.r = 255 - v.r;\n    v.g = 255 - v.g;\n    v.b = 255 - v.b;\n    return this;\n  }\n  lighten(ratio) {\n    modHSL(this._rgb, 2, ratio);\n    return this;\n  }\n  darken(ratio) {\n    modHSL(this._rgb, 2, -ratio);\n    return this;\n  }\n  saturate(ratio) {\n    modHSL(this._rgb, 1, ratio);\n    return this;\n  }\n  desaturate(ratio) {\n    modHSL(this._rgb, 1, -ratio);\n    return this;\n  }\n  rotate(deg) {\n    rotate(this._rgb, deg);\n    return this;\n  }\n}\n\nfunction index_esm(input) {\n  return new Color(input);\n}\n\nexport { Color, b2n, b2p, index_esm as default, hexParse, hexString, hsl2rgb, hslString, hsv2rgb, hueParse, hwb2rgb, lim, n2b, n2p, nameParse, p2b, rgb2hsl, rgbParse, rgbString, rotate, round };\n","/*!\n * Chart.js v4.5.1\n * https://www.chartjs.org\n * (c) 2025 Chart.js Contributors\n * Released under the MIT License\n */\nimport { Color } from '@kurkle/color';\n\n/**\n * @namespace Chart.helpers\n */ /**\n * An empty function that can be used, for example, for optional callback.\n */ function noop() {\n/* noop */ }\n/**\n * Returns a unique id, sequentially generated from a global variable.\n */ const uid = (()=>{\n    let id = 0;\n    return ()=>id++;\n})();\n/**\n * Returns true if `value` is neither null nor undefined, else returns false.\n * @param value - The value to test.\n * @since 2.7.0\n */ function isNullOrUndef(value) {\n    return value === null || value === undefined;\n}\n/**\n * Returns true if `value` is an array (including typed arrays), else returns false.\n * @param value - The value to test.\n * @function\n */ function isArray(value) {\n    if (Array.isArray && Array.isArray(value)) {\n        return true;\n    }\n    const type = Object.prototype.toString.call(value);\n    if (type.slice(0, 7) === '[object' && type.slice(-6) === 'Array]') {\n        return true;\n    }\n    return false;\n}\n/**\n * Returns true if `value` is an object (excluding null), else returns false.\n * @param value - The value to test.\n * @since 2.7.0\n */ function isObject(value) {\n    return value !== null && Object.prototype.toString.call(value) === '[object Object]';\n}\n/**\n * Returns true if `value` is a finite number, else returns false\n * @param value  - The value to test.\n */ function isNumberFinite(value) {\n    return (typeof value === 'number' || value instanceof Number) && isFinite(+value);\n}\n/**\n * Returns `value` if finite, else returns `defaultValue`.\n * @param value - The value to return if defined.\n * @param defaultValue - The value to return if `value` is not finite.\n */ function finiteOrDefault(value, defaultValue) {\n    return isNumberFinite(value) ? value : defaultValue;\n}\n/**\n * Returns `value` if defined, else returns `defaultValue`.\n * @param value - The value to return if defined.\n * @param defaultValue - The value to return if `value` is undefined.\n */ function valueOrDefault(value, defaultValue) {\n    return typeof value === 'undefined' ? defaultValue : value;\n}\nconst toPercentage = (value, dimension)=>typeof value === 'string' && value.endsWith('%') ? parseFloat(value) / 100 : +value / dimension;\nconst toDimension = (value, dimension)=>typeof value === 'string' && value.endsWith('%') ? parseFloat(value) / 100 * dimension : +value;\n/**\n * Calls `fn` with the given `args` in the scope defined by `thisArg` and returns the\n * value returned by `fn`. If `fn` is not a function, this method returns undefined.\n * @param fn - The function to call.\n * @param args - The arguments with which `fn` should be called.\n * @param [thisArg] - The value of `this` provided for the call to `fn`.\n */ function callback(fn, args, thisArg) {\n    if (fn && typeof fn.call === 'function') {\n        return fn.apply(thisArg, args);\n    }\n}\nfunction each(loopable, fn, thisArg, reverse) {\n    let i, len, keys;\n    if (isArray(loopable)) {\n        len = loopable.length;\n        if (reverse) {\n            for(i = len - 1; i >= 0; i--){\n                fn.call(thisArg, loopable[i], i);\n            }\n        } else {\n            for(i = 0; i < len; i++){\n                fn.call(thisArg, loopable[i], i);\n            }\n        }\n    } else if (isObject(loopable)) {\n        keys = Object.keys(loopable);\n        len = keys.length;\n        for(i = 0; i < len; i++){\n            fn.call(thisArg, loopable[keys[i]], keys[i]);\n        }\n    }\n}\n/**\n * Returns true if the `a0` and `a1` arrays have the same content, else returns false.\n * @param a0 - The array to compare\n * @param a1 - The array to compare\n * @private\n */ function _elementsEqual(a0, a1) {\n    let i, ilen, v0, v1;\n    if (!a0 || !a1 || a0.length !== a1.length) {\n        return false;\n    }\n    for(i = 0, ilen = a0.length; i < ilen; ++i){\n        v0 = a0[i];\n        v1 = a1[i];\n        if (v0.datasetIndex !== v1.datasetIndex || v0.index !== v1.index) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\n * Returns a deep copy of `source` without keeping references on objects and arrays.\n * @param source - The value to clone.\n */ function clone(source) {\n    if (isArray(source)) {\n        return source.map(clone);\n    }\n    if (isObject(source)) {\n        const target = Object.create(null);\n        const keys = Object.keys(source);\n        const klen = keys.length;\n        let k = 0;\n        for(; k < klen; ++k){\n            target[keys[k]] = clone(source[keys[k]]);\n        }\n        return target;\n    }\n    return source;\n}\nfunction isValidKey(key) {\n    return [\n        '__proto__',\n        'prototype',\n        'constructor'\n    ].indexOf(key) === -1;\n}\n/**\n * The default merger when Chart.helpers.merge is called without merger option.\n * Note(SB): also used by mergeConfig and mergeScaleConfig as fallback.\n * @private\n */ function _merger(key, target, source, options) {\n    if (!isValidKey(key)) {\n        return;\n    }\n    const tval = target[key];\n    const sval = source[key];\n    if (isObject(tval) && isObject(sval)) {\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        merge(tval, sval, options);\n    } else {\n        target[key] = clone(sval);\n    }\n}\nfunction merge(target, source, options) {\n    const sources = isArray(source) ? source : [\n        source\n    ];\n    const ilen = sources.length;\n    if (!isObject(target)) {\n        return target;\n    }\n    options = options || {};\n    const merger = options.merger || _merger;\n    let current;\n    for(let i = 0; i < ilen; ++i){\n        current = sources[i];\n        if (!isObject(current)) {\n            continue;\n        }\n        const keys = Object.keys(current);\n        for(let k = 0, klen = keys.length; k < klen; ++k){\n            merger(keys[k], target, current, options);\n        }\n    }\n    return target;\n}\nfunction mergeIf(target, source) {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return merge(target, source, {\n        merger: _mergerIf\n    });\n}\n/**\n * Merges source[key] in target[key] only if target[key] is undefined.\n * @private\n */ function _mergerIf(key, target, source) {\n    if (!isValidKey(key)) {\n        return;\n    }\n    const tval = target[key];\n    const sval = source[key];\n    if (isObject(tval) && isObject(sval)) {\n        mergeIf(tval, sval);\n    } else if (!Object.prototype.hasOwnProperty.call(target, key)) {\n        target[key] = clone(sval);\n    }\n}\n/**\n * @private\n */ function _deprecated(scope, value, previous, current) {\n    if (value !== undefined) {\n        console.warn(scope + ': \"' + previous + '\" is deprecated. Please use \"' + current + '\" instead');\n    }\n}\n// resolveObjectKey resolver cache\nconst keyResolvers = {\n    // Chart.helpers.core resolveObjectKey should resolve empty key to root object\n    '': (v)=>v,\n    // default resolvers\n    x: (o)=>o.x,\n    y: (o)=>o.y\n};\n/**\n * @private\n */ function _splitKey(key) {\n    const parts = key.split('.');\n    const keys = [];\n    let tmp = '';\n    for (const part of parts){\n        tmp += part;\n        if (tmp.endsWith('\\\\')) {\n            tmp = tmp.slice(0, -1) + '.';\n        } else {\n            keys.push(tmp);\n            tmp = '';\n        }\n    }\n    return keys;\n}\nfunction _getKeyResolver(key) {\n    const keys = _splitKey(key);\n    return (obj)=>{\n        for (const k of keys){\n            if (k === '') {\n                break;\n            }\n            obj = obj && obj[k];\n        }\n        return obj;\n    };\n}\nfunction resolveObjectKey(obj, key) {\n    const resolver = keyResolvers[key] || (keyResolvers[key] = _getKeyResolver(key));\n    return resolver(obj);\n}\n/**\n * @private\n */ function _capitalize(str) {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n}\nconst defined = (value)=>typeof value !== 'undefined';\nconst isFunction = (value)=>typeof value === 'function';\n// Adapted from https://stackoverflow.com/questions/31128855/comparing-ecma6-sets-for-equality#31129384\nconst setsEqual = (a, b)=>{\n    if (a.size !== b.size) {\n        return false;\n    }\n    for (const item of a){\n        if (!b.has(item)) {\n            return false;\n        }\n    }\n    return true;\n};\n/**\n * @param e - The event\n * @private\n */ function _isClickEvent(e) {\n    return e.type === 'mouseup' || e.type === 'click' || e.type === 'contextmenu';\n}\n\n/**\n * @alias Chart.helpers.math\n * @namespace\n */ const PI = Math.PI;\nconst TAU = 2 * PI;\nconst PITAU = TAU + PI;\nconst INFINITY = Number.POSITIVE_INFINITY;\nconst RAD_PER_DEG = PI / 180;\nconst HALF_PI = PI / 2;\nconst QUARTER_PI = PI / 4;\nconst TWO_THIRDS_PI = PI * 2 / 3;\nconst log10 = Math.log10;\nconst sign = Math.sign;\nfunction almostEquals(x, y, epsilon) {\n    return Math.abs(x - y) < epsilon;\n}\n/**\n * Implementation of the nice number algorithm used in determining where axis labels will go\n */ function niceNum(range) {\n    const roundedRange = Math.round(range);\n    range = almostEquals(range, roundedRange, range / 1000) ? roundedRange : range;\n    const niceRange = Math.pow(10, Math.floor(log10(range)));\n    const fraction = range / niceRange;\n    const niceFraction = fraction <= 1 ? 1 : fraction <= 2 ? 2 : fraction <= 5 ? 5 : 10;\n    return niceFraction * niceRange;\n}\n/**\n * Returns an array of factors sorted from 1 to sqrt(value)\n * @private\n */ function _factorize(value) {\n    const result = [];\n    const sqrt = Math.sqrt(value);\n    let i;\n    for(i = 1; i < sqrt; i++){\n        if (value % i === 0) {\n            result.push(i);\n            result.push(value / i);\n        }\n    }\n    if (sqrt === (sqrt | 0)) {\n        result.push(sqrt);\n    }\n    result.sort((a, b)=>a - b).pop();\n    return result;\n}\n/**\n * Verifies that attempting to coerce n to string or number won't throw a TypeError.\n */ function isNonPrimitive(n) {\n    return typeof n === 'symbol' || typeof n === 'object' && n !== null && !(Symbol.toPrimitive in n || 'toString' in n || 'valueOf' in n);\n}\nfunction isNumber(n) {\n    return !isNonPrimitive(n) && !isNaN(parseFloat(n)) && isFinite(n);\n}\nfunction almostWhole(x, epsilon) {\n    const rounded = Math.round(x);\n    return rounded - epsilon <= x && rounded + epsilon >= x;\n}\n/**\n * @private\n */ function _setMinAndMaxByKey(array, target, property) {\n    let i, ilen, value;\n    for(i = 0, ilen = array.length; i < ilen; i++){\n        value = array[i][property];\n        if (!isNaN(value)) {\n            target.min = Math.min(target.min, value);\n            target.max = Math.max(target.max, value);\n        }\n    }\n}\nfunction toRadians(degrees) {\n    return degrees * (PI / 180);\n}\nfunction toDegrees(radians) {\n    return radians * (180 / PI);\n}\n/**\n * Returns the number of decimal places\n * i.e. the number of digits after the decimal point, of the value of this Number.\n * @param x - A number.\n * @returns The number of decimal places.\n * @private\n */ function _decimalPlaces(x) {\n    if (!isNumberFinite(x)) {\n        return;\n    }\n    let e = 1;\n    let p = 0;\n    while(Math.round(x * e) / e !== x){\n        e *= 10;\n        p++;\n    }\n    return p;\n}\n// Gets the angle from vertical upright to the point about a centre.\nfunction getAngleFromPoint(centrePoint, anglePoint) {\n    const distanceFromXCenter = anglePoint.x - centrePoint.x;\n    const distanceFromYCenter = anglePoint.y - centrePoint.y;\n    const radialDistanceFromCenter = Math.sqrt(distanceFromXCenter * distanceFromXCenter + distanceFromYCenter * distanceFromYCenter);\n    let angle = Math.atan2(distanceFromYCenter, distanceFromXCenter);\n    if (angle < -0.5 * PI) {\n        angle += TAU; // make sure the returned angle is in the range of (-PI/2, 3PI/2]\n    }\n    return {\n        angle,\n        distance: radialDistanceFromCenter\n    };\n}\nfunction distanceBetweenPoints(pt1, pt2) {\n    return Math.sqrt(Math.pow(pt2.x - pt1.x, 2) + Math.pow(pt2.y - pt1.y, 2));\n}\n/**\n * Shortest distance between angles, in either direction.\n * @private\n */ function _angleDiff(a, b) {\n    return (a - b + PITAU) % TAU - PI;\n}\n/**\n * Normalize angle to be between 0 and 2*PI\n * @private\n */ function _normalizeAngle(a) {\n    return (a % TAU + TAU) % TAU;\n}\n/**\n * @private\n */ function _angleBetween(angle, start, end, sameAngleIsFullCircle) {\n    const a = _normalizeAngle(angle);\n    const s = _normalizeAngle(start);\n    const e = _normalizeAngle(end);\n    const angleToStart = _normalizeAngle(s - a);\n    const angleToEnd = _normalizeAngle(e - a);\n    const startToAngle = _normalizeAngle(a - s);\n    const endToAngle = _normalizeAngle(a - e);\n    return a === s || a === e || sameAngleIsFullCircle && s === e || angleToStart > angleToEnd && startToAngle < endToAngle;\n}\n/**\n * Limit `value` between `min` and `max`\n * @param value\n * @param min\n * @param max\n * @private\n */ function _limitValue(value, min, max) {\n    return Math.max(min, Math.min(max, value));\n}\n/**\n * @param {number} value\n * @private\n */ function _int16Range(value) {\n    return _limitValue(value, -32768, 32767);\n}\n/**\n * @param value\n * @param start\n * @param end\n * @param [epsilon]\n * @private\n */ function _isBetween(value, start, end, epsilon = 1e-6) {\n    return value >= Math.min(start, end) - epsilon && value <= Math.max(start, end) + epsilon;\n}\n\nfunction _lookup(table, value, cmp) {\n    cmp = cmp || ((index)=>table[index] < value);\n    let hi = table.length - 1;\n    let lo = 0;\n    let mid;\n    while(hi - lo > 1){\n        mid = lo + hi >> 1;\n        if (cmp(mid)) {\n            lo = mid;\n        } else {\n            hi = mid;\n        }\n    }\n    return {\n        lo,\n        hi\n    };\n}\n/**\n * Binary search\n * @param table - the table search. must be sorted!\n * @param key - property name for the value in each entry\n * @param value - value to find\n * @param last - lookup last index\n * @private\n */ const _lookupByKey = (table, key, value, last)=>_lookup(table, value, last ? (index)=>{\n        const ti = table[index][key];\n        return ti < value || ti === value && table[index + 1][key] === value;\n    } : (index)=>table[index][key] < value);\n/**\n * Reverse binary search\n * @param table - the table search. must be sorted!\n * @param key - property name for the value in each entry\n * @param value - value to find\n * @private\n */ const _rlookupByKey = (table, key, value)=>_lookup(table, value, (index)=>table[index][key] >= value);\n/**\n * Return subset of `values` between `min` and `max` inclusive.\n * Values are assumed to be in sorted order.\n * @param values - sorted array of values\n * @param min - min value\n * @param max - max value\n */ function _filterBetween(values, min, max) {\n    let start = 0;\n    let end = values.length;\n    while(start < end && values[start] < min){\n        start++;\n    }\n    while(end > start && values[end - 1] > max){\n        end--;\n    }\n    return start > 0 || end < values.length ? values.slice(start, end) : values;\n}\nconst arrayEvents = [\n    'push',\n    'pop',\n    'shift',\n    'splice',\n    'unshift'\n];\nfunction listenArrayEvents(array, listener) {\n    if (array._chartjs) {\n        array._chartjs.listeners.push(listener);\n        return;\n    }\n    Object.defineProperty(array, '_chartjs', {\n        configurable: true,\n        enumerable: false,\n        value: {\n            listeners: [\n                listener\n            ]\n        }\n    });\n    arrayEvents.forEach((key)=>{\n        const method = '_onData' + _capitalize(key);\n        const base = array[key];\n        Object.defineProperty(array, key, {\n            configurable: true,\n            enumerable: false,\n            value (...args) {\n                const res = base.apply(this, args);\n                array._chartjs.listeners.forEach((object)=>{\n                    if (typeof object[method] === 'function') {\n                        object[method](...args);\n                    }\n                });\n                return res;\n            }\n        });\n    });\n}\nfunction unlistenArrayEvents(array, listener) {\n    const stub = array._chartjs;\n    if (!stub) {\n        return;\n    }\n    const listeners = stub.listeners;\n    const index = listeners.indexOf(listener);\n    if (index !== -1) {\n        listeners.splice(index, 1);\n    }\n    if (listeners.length > 0) {\n        return;\n    }\n    arrayEvents.forEach((key)=>{\n        delete array[key];\n    });\n    delete array._chartjs;\n}\n/**\n * @param items\n */ function _arrayUnique(items) {\n    const set = new Set(items);\n    if (set.size === items.length) {\n        return items;\n    }\n    return Array.from(set);\n}\n\nfunction fontString(pixelSize, fontStyle, fontFamily) {\n    return fontStyle + ' ' + pixelSize + 'px ' + fontFamily;\n}\n/**\n* Request animation polyfill\n*/ const requestAnimFrame = function() {\n    if (typeof window === 'undefined') {\n        return function(callback) {\n            return callback();\n        };\n    }\n    return window.requestAnimationFrame;\n}();\n/**\n * Throttles calling `fn` once per animation frame\n * Latest arguments are used on the actual call\n */ function throttled(fn, thisArg) {\n    let argsToUse = [];\n    let ticking = false;\n    return function(...args) {\n        // Save the args for use later\n        argsToUse = args;\n        if (!ticking) {\n            ticking = true;\n            requestAnimFrame.call(window, ()=>{\n                ticking = false;\n                fn.apply(thisArg, argsToUse);\n            });\n        }\n    };\n}\n/**\n * Debounces calling `fn` for `delay` ms\n */ function debounce(fn, delay) {\n    let timeout;\n    return function(...args) {\n        if (delay) {\n            clearTimeout(timeout);\n            timeout = setTimeout(fn, delay, args);\n        } else {\n            fn.apply(this, args);\n        }\n        return delay;\n    };\n}\n/**\n * Converts 'start' to 'left', 'end' to 'right' and others to 'center'\n * @private\n */ const _toLeftRightCenter = (align)=>align === 'start' ? 'left' : align === 'end' ? 'right' : 'center';\n/**\n * Returns `start`, `end` or `(start + end) / 2` depending on `align`. Defaults to `center`\n * @private\n */ const _alignStartEnd = (align, start, end)=>align === 'start' ? start : align === 'end' ? end : (start + end) / 2;\n/**\n * Returns `left`, `right` or `(left + right) / 2` depending on `align`. Defaults to `left`\n * @private\n */ const _textX = (align, left, right, rtl)=>{\n    const check = rtl ? 'left' : 'right';\n    return align === check ? right : align === 'center' ? (left + right) / 2 : left;\n};\n/**\n * Return start and count of visible points.\n * @private\n */ function _getStartAndCountOfVisiblePoints(meta, points, animationsDisabled) {\n    const pointCount = points.length;\n    let start = 0;\n    let count = pointCount;\n    if (meta._sorted) {\n        const { iScale , vScale , _parsed  } = meta;\n        const spanGaps = meta.dataset ? meta.dataset.options ? meta.dataset.options.spanGaps : null : null;\n        const axis = iScale.axis;\n        const { min , max , minDefined , maxDefined  } = iScale.getUserBounds();\n        if (minDefined) {\n            start = Math.min(// @ts-expect-error Need to type _parsed\n            _lookupByKey(_parsed, axis, min).lo, // @ts-expect-error Need to fix types on _lookupByKey\n            animationsDisabled ? pointCount : _lookupByKey(points, axis, iScale.getPixelForValue(min)).lo);\n            if (spanGaps) {\n                const distanceToDefinedLo = _parsed.slice(0, start + 1).reverse().findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\n                start -= Math.max(0, distanceToDefinedLo);\n            }\n            start = _limitValue(start, 0, pointCount - 1);\n        }\n        if (maxDefined) {\n            let end = Math.max(// @ts-expect-error Need to type _parsed\n            _lookupByKey(_parsed, iScale.axis, max, true).hi + 1, // @ts-expect-error Need to fix types on _lookupByKey\n            animationsDisabled ? 0 : _lookupByKey(points, axis, iScale.getPixelForValue(max), true).hi + 1);\n            if (spanGaps) {\n                const distanceToDefinedHi = _parsed.slice(end - 1).findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\n                end += Math.max(0, distanceToDefinedHi);\n            }\n            count = _limitValue(end, start, pointCount) - start;\n        } else {\n            count = pointCount - start;\n        }\n    }\n    return {\n        start,\n        count\n    };\n}\n/**\n * Checks if the scale ranges have changed.\n * @param {object} meta - dataset meta.\n * @returns {boolean}\n * @private\n */ function _scaleRangesChanged(meta) {\n    const { xScale , yScale , _scaleRanges  } = meta;\n    const newRanges = {\n        xmin: xScale.min,\n        xmax: xScale.max,\n        ymin: yScale.min,\n        ymax: yScale.max\n    };\n    if (!_scaleRanges) {\n        meta._scaleRanges = newRanges;\n        return true;\n    }\n    const changed = _scaleRanges.xmin !== xScale.min || _scaleRanges.xmax !== xScale.max || _scaleRanges.ymin !== yScale.min || _scaleRanges.ymax !== yScale.max;\n    Object.assign(_scaleRanges, newRanges);\n    return changed;\n}\n\nconst atEdge = (t)=>t === 0 || t === 1;\nconst elasticIn = (t, s, p)=>-(Math.pow(2, 10 * (t -= 1)) * Math.sin((t - s) * TAU / p));\nconst elasticOut = (t, s, p)=>Math.pow(2, -10 * t) * Math.sin((t - s) * TAU / p) + 1;\n/**\n * Easing functions adapted from Robert Penner's easing equations.\n * @namespace Chart.helpers.easing.effects\n * @see http://www.robertpenner.com/easing/\n */ const effects = {\n    linear: (t)=>t,\n    easeInQuad: (t)=>t * t,\n    easeOutQuad: (t)=>-t * (t - 2),\n    easeInOutQuad: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t : -0.5 * (--t * (t - 2) - 1),\n    easeInCubic: (t)=>t * t * t,\n    easeOutCubic: (t)=>(t -= 1) * t * t + 1,\n    easeInOutCubic: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t * t : 0.5 * ((t -= 2) * t * t + 2),\n    easeInQuart: (t)=>t * t * t * t,\n    easeOutQuart: (t)=>-((t -= 1) * t * t * t - 1),\n    easeInOutQuart: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t * t * t : -0.5 * ((t -= 2) * t * t * t - 2),\n    easeInQuint: (t)=>t * t * t * t * t,\n    easeOutQuint: (t)=>(t -= 1) * t * t * t * t + 1,\n    easeInOutQuint: (t)=>(t /= 0.5) < 1 ? 0.5 * t * t * t * t * t : 0.5 * ((t -= 2) * t * t * t * t + 2),\n    easeInSine: (t)=>-Math.cos(t * HALF_PI) + 1,\n    easeOutSine: (t)=>Math.sin(t * HALF_PI),\n    easeInOutSine: (t)=>-0.5 * (Math.cos(PI * t) - 1),\n    easeInExpo: (t)=>t === 0 ? 0 : Math.pow(2, 10 * (t - 1)),\n    easeOutExpo: (t)=>t === 1 ? 1 : -Math.pow(2, -10 * t) + 1,\n    easeInOutExpo: (t)=>atEdge(t) ? t : t < 0.5 ? 0.5 * Math.pow(2, 10 * (t * 2 - 1)) : 0.5 * (-Math.pow(2, -10 * (t * 2 - 1)) + 2),\n    easeInCirc: (t)=>t >= 1 ? t : -(Math.sqrt(1 - t * t) - 1),\n    easeOutCirc: (t)=>Math.sqrt(1 - (t -= 1) * t),\n    easeInOutCirc: (t)=>(t /= 0.5) < 1 ? -0.5 * (Math.sqrt(1 - t * t) - 1) : 0.5 * (Math.sqrt(1 - (t -= 2) * t) + 1),\n    easeInElastic: (t)=>atEdge(t) ? t : elasticIn(t, 0.075, 0.3),\n    easeOutElastic: (t)=>atEdge(t) ? t : elasticOut(t, 0.075, 0.3),\n    easeInOutElastic (t) {\n        const s = 0.1125;\n        const p = 0.45;\n        return atEdge(t) ? t : t < 0.5 ? 0.5 * elasticIn(t * 2, s, p) : 0.5 + 0.5 * elasticOut(t * 2 - 1, s, p);\n    },\n    easeInBack (t) {\n        const s = 1.70158;\n        return t * t * ((s + 1) * t - s);\n    },\n    easeOutBack (t) {\n        const s = 1.70158;\n        return (t -= 1) * t * ((s + 1) * t + s) + 1;\n    },\n    easeInOutBack (t) {\n        let s = 1.70158;\n        if ((t /= 0.5) < 1) {\n            return 0.5 * (t * t * (((s *= 1.525) + 1) * t - s));\n        }\n        return 0.5 * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2);\n    },\n    easeInBounce: (t)=>1 - effects.easeOutBounce(1 - t),\n    easeOutBounce (t) {\n        const m = 7.5625;\n        const d = 2.75;\n        if (t < 1 / d) {\n            return m * t * t;\n        }\n        if (t < 2 / d) {\n            return m * (t -= 1.5 / d) * t + 0.75;\n        }\n        if (t < 2.5 / d) {\n            return m * (t -= 2.25 / d) * t + 0.9375;\n        }\n        return m * (t -= 2.625 / d) * t + 0.984375;\n    },\n    easeInOutBounce: (t)=>t < 0.5 ? effects.easeInBounce(t * 2) * 0.5 : effects.easeOutBounce(t * 2 - 1) * 0.5 + 0.5\n};\n\nfunction isPatternOrGradient(value) {\n    if (value && typeof value === 'object') {\n        const type = value.toString();\n        return type === '[object CanvasPattern]' || type === '[object CanvasGradient]';\n    }\n    return false;\n}\nfunction color(value) {\n    return isPatternOrGradient(value) ? value : new Color(value);\n}\nfunction getHoverColor(value) {\n    return isPatternOrGradient(value) ? value : new Color(value).saturate(0.5).darken(0.1).hexString();\n}\n\nconst numbers = [\n    'x',\n    'y',\n    'borderWidth',\n    'radius',\n    'tension'\n];\nconst colors = [\n    'color',\n    'borderColor',\n    'backgroundColor'\n];\nfunction applyAnimationsDefaults(defaults) {\n    defaults.set('animation', {\n        delay: undefined,\n        duration: 1000,\n        easing: 'easeOutQuart',\n        fn: undefined,\n        from: undefined,\n        loop: undefined,\n        to: undefined,\n        type: undefined\n    });\n    defaults.describe('animation', {\n        _fallback: false,\n        _indexable: false,\n        _scriptable: (name)=>name !== 'onProgress' && name !== 'onComplete' && name !== 'fn'\n    });\n    defaults.set('animations', {\n        colors: {\n            type: 'color',\n            properties: colors\n        },\n        numbers: {\n            type: 'number',\n            properties: numbers\n        }\n    });\n    defaults.describe('animations', {\n        _fallback: 'animation'\n    });\n    defaults.set('transitions', {\n        active: {\n            animation: {\n                duration: 400\n            }\n        },\n        resize: {\n            animation: {\n                duration: 0\n            }\n        },\n        show: {\n            animations: {\n                colors: {\n                    from: 'transparent'\n                },\n                visible: {\n                    type: 'boolean',\n                    duration: 0\n                }\n            }\n        },\n        hide: {\n            animations: {\n                colors: {\n                    to: 'transparent'\n                },\n                visible: {\n                    type: 'boolean',\n                    easing: 'linear',\n                    fn: (v)=>v | 0\n                }\n            }\n        }\n    });\n}\n\nfunction applyLayoutsDefaults(defaults) {\n    defaults.set('layout', {\n        autoPadding: true,\n        padding: {\n            top: 0,\n            right: 0,\n            bottom: 0,\n            left: 0\n        }\n    });\n}\n\nconst intlCache = new Map();\nfunction getNumberFormat(locale, options) {\n    options = options || {};\n    const cacheKey = locale + JSON.stringify(options);\n    let formatter = intlCache.get(cacheKey);\n    if (!formatter) {\n        formatter = new Intl.NumberFormat(locale, options);\n        intlCache.set(cacheKey, formatter);\n    }\n    return formatter;\n}\nfunction formatNumber(num, locale, options) {\n    return getNumberFormat(locale, options).format(num);\n}\n\nconst formatters = {\n values (value) {\n        return isArray(value) ?  value : '' + value;\n    },\n numeric (tickValue, index, ticks) {\n        if (tickValue === 0) {\n            return '0';\n        }\n        const locale = this.chart.options.locale;\n        let notation;\n        let delta = tickValue;\n        if (ticks.length > 1) {\n            const maxTick = Math.max(Math.abs(ticks[0].value), Math.abs(ticks[ticks.length - 1].value));\n            if (maxTick < 1e-4 || maxTick > 1e+15) {\n                notation = 'scientific';\n            }\n            delta = calculateDelta(tickValue, ticks);\n        }\n        const logDelta = log10(Math.abs(delta));\n        const numDecimal = isNaN(logDelta) ? 1 : Math.max(Math.min(-1 * Math.floor(logDelta), 20), 0);\n        const options = {\n            notation,\n            minimumFractionDigits: numDecimal,\n            maximumFractionDigits: numDecimal\n        };\n        Object.assign(options, this.options.ticks.format);\n        return formatNumber(tickValue, locale, options);\n    },\n logarithmic (tickValue, index, ticks) {\n        if (tickValue === 0) {\n            return '0';\n        }\n        const remain = ticks[index].significand || tickValue / Math.pow(10, Math.floor(log10(tickValue)));\n        if ([\n            1,\n            2,\n            3,\n            5,\n            10,\n            15\n        ].includes(remain) || index > 0.8 * ticks.length) {\n            return formatters.numeric.call(this, tickValue, index, ticks);\n        }\n        return '';\n    }\n};\nfunction calculateDelta(tickValue, ticks) {\n    let delta = ticks.length > 3 ? ticks[2].value - ticks[1].value : ticks[1].value - ticks[0].value;\n    if (Math.abs(delta) >= 1 && tickValue !== Math.floor(tickValue)) {\n        delta = tickValue - Math.floor(tickValue);\n    }\n    return delta;\n}\n var Ticks = {\n    formatters\n};\n\nfunction applyScaleDefaults(defaults) {\n    defaults.set('scale', {\n        display: true,\n        offset: false,\n        reverse: false,\n        beginAtZero: false,\n bounds: 'ticks',\n        clip: true,\n grace: 0,\n        grid: {\n            display: true,\n            lineWidth: 1,\n            drawOnChartArea: true,\n            drawTicks: true,\n            tickLength: 8,\n            tickWidth: (_ctx, options)=>options.lineWidth,\n            tickColor: (_ctx, options)=>options.color,\n            offset: false\n        },\n        border: {\n            display: true,\n            dash: [],\n            dashOffset: 0.0,\n            width: 1\n        },\n        title: {\n            display: false,\n            text: '',\n            padding: {\n                top: 4,\n                bottom: 4\n            }\n        },\n        ticks: {\n            minRotation: 0,\n            maxRotation: 50,\n            mirror: false,\n            textStrokeWidth: 0,\n            textStrokeColor: '',\n            padding: 3,\n            display: true,\n            autoSkip: true,\n            autoSkipPadding: 3,\n            labelOffset: 0,\n            callback: Ticks.formatters.values,\n            minor: {},\n            major: {},\n            align: 'center',\n            crossAlign: 'near',\n            showLabelBackdrop: false,\n            backdropColor: 'rgba(255, 255, 255, 0.75)',\n            backdropPadding: 2\n        }\n    });\n    defaults.route('scale.ticks', 'color', '', 'color');\n    defaults.route('scale.grid', 'color', '', 'borderColor');\n    defaults.route('scale.border', 'color', '', 'borderColor');\n    defaults.route('scale.title', 'color', '', 'color');\n    defaults.describe('scale', {\n        _fallback: false,\n        _scriptable: (name)=>!name.startsWith('before') && !name.startsWith('after') && name !== 'callback' && name !== 'parser',\n        _indexable: (name)=>name !== 'borderDash' && name !== 'tickBorderDash' && name !== 'dash'\n    });\n    defaults.describe('scales', {\n        _fallback: 'scale'\n    });\n    defaults.describe('scale.ticks', {\n        _scriptable: (name)=>name !== 'backdropPadding' && name !== 'callback',\n        _indexable: (name)=>name !== 'backdropPadding'\n    });\n}\n\nconst overrides = Object.create(null);\nconst descriptors = Object.create(null);\n function getScope$1(node, key) {\n    if (!key) {\n        return node;\n    }\n    const keys = key.split('.');\n    for(let i = 0, n = keys.length; i < n; ++i){\n        const k = keys[i];\n        node = node[k] || (node[k] = Object.create(null));\n    }\n    return node;\n}\nfunction set(root, scope, values) {\n    if (typeof scope === 'string') {\n        return merge(getScope$1(root, scope), values);\n    }\n    return merge(getScope$1(root, ''), scope);\n}\n class Defaults {\n    constructor(_descriptors, _appliers){\n        this.animation = undefined;\n        this.backgroundColor = 'rgba(0,0,0,0.1)';\n        this.borderColor = 'rgba(0,0,0,0.1)';\n        this.color = '#666';\n        this.datasets = {};\n        this.devicePixelRatio = (context)=>context.chart.platform.getDevicePixelRatio();\n        this.elements = {};\n        this.events = [\n            'mousemove',\n            'mouseout',\n            'click',\n            'touchstart',\n            'touchmove'\n        ];\n        this.font = {\n            family: \"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif\",\n            size: 12,\n            style: 'normal',\n            lineHeight: 1.2,\n            weight: null\n        };\n        this.hover = {};\n        this.hoverBackgroundColor = (ctx, options)=>getHoverColor(options.backgroundColor);\n        this.hoverBorderColor = (ctx, options)=>getHoverColor(options.borderColor);\n        this.hoverColor = (ctx, options)=>getHoverColor(options.color);\n        this.indexAxis = 'x';\n        this.interaction = {\n            mode: 'nearest',\n            intersect: true,\n            includeInvisible: false\n        };\n        this.maintainAspectRatio = true;\n        this.onHover = null;\n        this.onClick = null;\n        this.parsing = true;\n        this.plugins = {};\n        this.responsive = true;\n        this.scale = undefined;\n        this.scales = {};\n        this.showLine = true;\n        this.drawActiveElementsOnTop = true;\n        this.describe(_descriptors);\n        this.apply(_appliers);\n    }\n set(scope, values) {\n        return set(this, scope, values);\n    }\n get(scope) {\n        return getScope$1(this, scope);\n    }\n describe(scope, values) {\n        return set(descriptors, scope, values);\n    }\n    override(scope, values) {\n        return set(overrides, scope, values);\n    }\n route(scope, name, targetScope, targetName) {\n        const scopeObject = getScope$1(this, scope);\n        const targetScopeObject = getScope$1(this, targetScope);\n        const privateName = '_' + name;\n        Object.defineProperties(scopeObject, {\n            [privateName]: {\n                value: scopeObject[name],\n                writable: true\n            },\n            [name]: {\n                enumerable: true,\n                get () {\n                    const local = this[privateName];\n                    const target = targetScopeObject[targetName];\n                    if (isObject(local)) {\n                        return Object.assign({}, target, local);\n                    }\n                    return valueOrDefault(local, target);\n                },\n                set (value) {\n                    this[privateName] = value;\n                }\n            }\n        });\n    }\n    apply(appliers) {\n        appliers.forEach((apply)=>apply(this));\n    }\n}\nvar defaults = /* #__PURE__ */ new Defaults({\n    _scriptable: (name)=>!name.startsWith('on'),\n    _indexable: (name)=>name !== 'events',\n    hover: {\n        _fallback: 'interaction'\n    },\n    interaction: {\n        _scriptable: false,\n        _indexable: false\n    }\n}, [\n    applyAnimationsDefaults,\n    applyLayoutsDefaults,\n    applyScaleDefaults\n]);\n\n/**\n * Converts the given font object into a CSS font string.\n * @param font - A font object.\n * @return The CSS font string. See https://developer.mozilla.org/en-US/docs/Web/CSS/font\n * @private\n */ function toFontString(font) {\n    if (!font || isNullOrUndef(font.size) || isNullOrUndef(font.family)) {\n        return null;\n    }\n    return (font.style ? font.style + ' ' : '') + (font.weight ? font.weight + ' ' : '') + font.size + 'px ' + font.family;\n}\n/**\n * @private\n */ function _measureText(ctx, data, gc, longest, string) {\n    let textWidth = data[string];\n    if (!textWidth) {\n        textWidth = data[string] = ctx.measureText(string).width;\n        gc.push(string);\n    }\n    if (textWidth > longest) {\n        longest = textWidth;\n    }\n    return longest;\n}\n/**\n * @private\n */ // eslint-disable-next-line complexity\nfunction _longestText(ctx, font, arrayOfThings, cache) {\n    cache = cache || {};\n    let data = cache.data = cache.data || {};\n    let gc = cache.garbageCollect = cache.garbageCollect || [];\n    if (cache.font !== font) {\n        data = cache.data = {};\n        gc = cache.garbageCollect = [];\n        cache.font = font;\n    }\n    ctx.save();\n    ctx.font = font;\n    let longest = 0;\n    const ilen = arrayOfThings.length;\n    let i, j, jlen, thing, nestedThing;\n    for(i = 0; i < ilen; i++){\n        thing = arrayOfThings[i];\n        // Undefined strings and arrays should not be measured\n        if (thing !== undefined && thing !== null && !isArray(thing)) {\n            longest = _measureText(ctx, data, gc, longest, thing);\n        } else if (isArray(thing)) {\n            // if it is an array lets measure each element\n            // to do maybe simplify this function a bit so we can do this more recursively?\n            for(j = 0, jlen = thing.length; j < jlen; j++){\n                nestedThing = thing[j];\n                // Undefined strings and arrays should not be measured\n                if (nestedThing !== undefined && nestedThing !== null && !isArray(nestedThing)) {\n                    longest = _measureText(ctx, data, gc, longest, nestedThing);\n                }\n            }\n        }\n    }\n    ctx.restore();\n    const gcLen = gc.length / 2;\n    if (gcLen > arrayOfThings.length) {\n        for(i = 0; i < gcLen; i++){\n            delete data[gc[i]];\n        }\n        gc.splice(0, gcLen);\n    }\n    return longest;\n}\n/**\n * Returns the aligned pixel value to avoid anti-aliasing blur\n * @param chart - The chart instance.\n * @param pixel - A pixel value.\n * @param width - The width of the element.\n * @returns The aligned pixel value.\n * @private\n */ function _alignPixel(chart, pixel, width) {\n    const devicePixelRatio = chart.currentDevicePixelRatio;\n    const halfWidth = width !== 0 ? Math.max(width / 2, 0.5) : 0;\n    return Math.round((pixel - halfWidth) * devicePixelRatio) / devicePixelRatio + halfWidth;\n}\n/**\n * Clears the entire canvas.\n */ function clearCanvas(canvas, ctx) {\n    if (!ctx && !canvas) {\n        return;\n    }\n    ctx = ctx || canvas.getContext('2d');\n    ctx.save();\n    // canvas.width and canvas.height do not consider the canvas transform,\n    // while clearRect does\n    ctx.resetTransform();\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.restore();\n}\nfunction drawPoint(ctx, options, x, y) {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    drawPointLegend(ctx, options, x, y, null);\n}\n// eslint-disable-next-line complexity\nfunction drawPointLegend(ctx, options, x, y, w) {\n    let type, xOffset, yOffset, size, cornerRadius, width, xOffsetW, yOffsetW;\n    const style = options.pointStyle;\n    const rotation = options.rotation;\n    const radius = options.radius;\n    let rad = (rotation || 0) * RAD_PER_DEG;\n    if (style && typeof style === 'object') {\n        type = style.toString();\n        if (type === '[object HTMLImageElement]' || type === '[object HTMLCanvasElement]') {\n            ctx.save();\n            ctx.translate(x, y);\n            ctx.rotate(rad);\n            ctx.drawImage(style, -style.width / 2, -style.height / 2, style.width, style.height);\n            ctx.restore();\n            return;\n        }\n    }\n    if (isNaN(radius) || radius <= 0) {\n        return;\n    }\n    ctx.beginPath();\n    switch(style){\n        // Default includes circle\n        default:\n            if (w) {\n                ctx.ellipse(x, y, w / 2, radius, 0, 0, TAU);\n            } else {\n                ctx.arc(x, y, radius, 0, TAU);\n            }\n            ctx.closePath();\n            break;\n        case 'triangle':\n            width = w ? w / 2 : radius;\n            ctx.moveTo(x + Math.sin(rad) * width, y - Math.cos(rad) * radius);\n            rad += TWO_THIRDS_PI;\n            ctx.lineTo(x + Math.sin(rad) * width, y - Math.cos(rad) * radius);\n            rad += TWO_THIRDS_PI;\n            ctx.lineTo(x + Math.sin(rad) * width, y - Math.cos(rad) * radius);\n            ctx.closePath();\n            break;\n        case 'rectRounded':\n            // NOTE: the rounded rect implementation changed to use `arc` instead of\n            // `quadraticCurveTo` since it generates better results when rect is\n            // almost a circle. 0.516 (instead of 0.5) produces results with visually\n            // closer proportion to the previous impl and it is inscribed in the\n            // circle with `radius`. For more details, see the following PRs:\n            // https://github.com/chartjs/Chart.js/issues/5597\n            // https://github.com/chartjs/Chart.js/issues/5858\n            cornerRadius = radius * 0.516;\n            size = radius - cornerRadius;\n            xOffset = Math.cos(rad + QUARTER_PI) * size;\n            xOffsetW = Math.cos(rad + QUARTER_PI) * (w ? w / 2 - cornerRadius : size);\n            yOffset = Math.sin(rad + QUARTER_PI) * size;\n            yOffsetW = Math.sin(rad + QUARTER_PI) * (w ? w / 2 - cornerRadius : size);\n            ctx.arc(x - xOffsetW, y - yOffset, cornerRadius, rad - PI, rad - HALF_PI);\n            ctx.arc(x + yOffsetW, y - xOffset, cornerRadius, rad - HALF_PI, rad);\n            ctx.arc(x + xOffsetW, y + yOffset, cornerRadius, rad, rad + HALF_PI);\n            ctx.arc(x - yOffsetW, y + xOffset, cornerRadius, rad + HALF_PI, rad + PI);\n            ctx.closePath();\n            break;\n        case 'rect':\n            if (!rotation) {\n                size = Math.SQRT1_2 * radius;\n                width = w ? w / 2 : size;\n                ctx.rect(x - width, y - size, 2 * width, 2 * size);\n                break;\n            }\n            rad += QUARTER_PI;\n        /* falls through */ case 'rectRot':\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\n            xOffset = Math.cos(rad) * radius;\n            yOffset = Math.sin(rad) * radius;\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\n            ctx.moveTo(x - xOffsetW, y - yOffset);\n            ctx.lineTo(x + yOffsetW, y - xOffset);\n            ctx.lineTo(x + xOffsetW, y + yOffset);\n            ctx.lineTo(x - yOffsetW, y + xOffset);\n            ctx.closePath();\n            break;\n        case 'crossRot':\n            rad += QUARTER_PI;\n        /* falls through */ case 'cross':\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\n            xOffset = Math.cos(rad) * radius;\n            yOffset = Math.sin(rad) * radius;\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\n            ctx.moveTo(x - xOffsetW, y - yOffset);\n            ctx.lineTo(x + xOffsetW, y + yOffset);\n            ctx.moveTo(x + yOffsetW, y - xOffset);\n            ctx.lineTo(x - yOffsetW, y + xOffset);\n            break;\n        case 'star':\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\n            xOffset = Math.cos(rad) * radius;\n            yOffset = Math.sin(rad) * radius;\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\n            ctx.moveTo(x - xOffsetW, y - yOffset);\n            ctx.lineTo(x + xOffsetW, y + yOffset);\n            ctx.moveTo(x + yOffsetW, y - xOffset);\n            ctx.lineTo(x - yOffsetW, y + xOffset);\n            rad += QUARTER_PI;\n            xOffsetW = Math.cos(rad) * (w ? w / 2 : radius);\n            xOffset = Math.cos(rad) * radius;\n            yOffset = Math.sin(rad) * radius;\n            yOffsetW = Math.sin(rad) * (w ? w / 2 : radius);\n            ctx.moveTo(x - xOffsetW, y - yOffset);\n            ctx.lineTo(x + xOffsetW, y + yOffset);\n            ctx.moveTo(x + yOffsetW, y - xOffset);\n            ctx.lineTo(x - yOffsetW, y + xOffset);\n            break;\n        case 'line':\n            xOffset = w ? w / 2 : Math.cos(rad) * radius;\n            yOffset = Math.sin(rad) * radius;\n            ctx.moveTo(x - xOffset, y - yOffset);\n            ctx.lineTo(x + xOffset, y + yOffset);\n            break;\n        case 'dash':\n            ctx.moveTo(x, y);\n            ctx.lineTo(x + Math.cos(rad) * (w ? w / 2 : radius), y + Math.sin(rad) * radius);\n            break;\n        case false:\n            ctx.closePath();\n            break;\n    }\n    ctx.fill();\n    if (options.borderWidth > 0) {\n        ctx.stroke();\n    }\n}\n/**\n * Returns true if the point is inside the rectangle\n * @param point - The point to test\n * @param area - The rectangle\n * @param margin - allowed margin\n * @private\n */ function _isPointInArea(point, area, margin) {\n    margin = margin || 0.5; // margin - default is to match rounded decimals\n    return !area || point && point.x > area.left - margin && point.x < area.right + margin && point.y > area.top - margin && point.y < area.bottom + margin;\n}\nfunction clipArea(ctx, area) {\n    ctx.save();\n    ctx.beginPath();\n    ctx.rect(area.left, area.top, area.right - area.left, area.bottom - area.top);\n    ctx.clip();\n}\nfunction unclipArea(ctx) {\n    ctx.restore();\n}\n/**\n * @private\n */ function _steppedLineTo(ctx, previous, target, flip, mode) {\n    if (!previous) {\n        return ctx.lineTo(target.x, target.y);\n    }\n    if (mode === 'middle') {\n        const midpoint = (previous.x + target.x) / 2.0;\n        ctx.lineTo(midpoint, previous.y);\n        ctx.lineTo(midpoint, target.y);\n    } else if (mode === 'after' !== !!flip) {\n        ctx.lineTo(previous.x, target.y);\n    } else {\n        ctx.lineTo(target.x, previous.y);\n    }\n    ctx.lineTo(target.x, target.y);\n}\n/**\n * @private\n */ function _bezierCurveTo(ctx, previous, target, flip) {\n    if (!previous) {\n        return ctx.lineTo(target.x, target.y);\n    }\n    ctx.bezierCurveTo(flip ? previous.cp1x : previous.cp2x, flip ? previous.cp1y : previous.cp2y, flip ? target.cp2x : target.cp1x, flip ? target.cp2y : target.cp1y, target.x, target.y);\n}\nfunction setRenderOpts(ctx, opts) {\n    if (opts.translation) {\n        ctx.translate(opts.translation[0], opts.translation[1]);\n    }\n    if (!isNullOrUndef(opts.rotation)) {\n        ctx.rotate(opts.rotation);\n    }\n    if (opts.color) {\n        ctx.fillStyle = opts.color;\n    }\n    if (opts.textAlign) {\n        ctx.textAlign = opts.textAlign;\n    }\n    if (opts.textBaseline) {\n        ctx.textBaseline = opts.textBaseline;\n    }\n}\nfunction decorateText(ctx, x, y, line, opts) {\n    if (opts.strikethrough || opts.underline) {\n        /**\n     * Now that IE11 support has been dropped, we can use more\n     * of the TextMetrics object. The actual bounding boxes\n     * are unflagged in Chrome, Firefox, Edge, and Safari so they\n     * can be safely used.\n     * See https://developer.mozilla.org/en-US/docs/Web/API/TextMetrics#Browser_compatibility\n     */ const metrics = ctx.measureText(line);\n        const left = x - metrics.actualBoundingBoxLeft;\n        const right = x + metrics.actualBoundingBoxRight;\n        const top = y - metrics.actualBoundingBoxAscent;\n        const bottom = y + metrics.actualBoundingBoxDescent;\n        const yDecoration = opts.strikethrough ? (top + bottom) / 2 : bottom;\n        ctx.strokeStyle = ctx.fillStyle;\n        ctx.beginPath();\n        ctx.lineWidth = opts.decorationWidth || 2;\n        ctx.moveTo(left, yDecoration);\n        ctx.lineTo(right, yDecoration);\n        ctx.stroke();\n    }\n}\nfunction drawBackdrop(ctx, opts) {\n    const oldColor = ctx.fillStyle;\n    ctx.fillStyle = opts.color;\n    ctx.fillRect(opts.left, opts.top, opts.width, opts.height);\n    ctx.fillStyle = oldColor;\n}\n/**\n * Render text onto the canvas\n */ function renderText(ctx, text, x, y, font, opts = {}) {\n    const lines = isArray(text) ? text : [\n        text\n    ];\n    const stroke = opts.strokeWidth > 0 && opts.strokeColor !== '';\n    let i, line;\n    ctx.save();\n    ctx.font = font.string;\n    setRenderOpts(ctx, opts);\n    for(i = 0; i < lines.length; ++i){\n        line = lines[i];\n        if (opts.backdrop) {\n            drawBackdrop(ctx, opts.backdrop);\n        }\n        if (stroke) {\n            if (opts.strokeColor) {\n                ctx.strokeStyle = opts.strokeColor;\n            }\n            if (!isNullOrUndef(opts.strokeWidth)) {\n                ctx.lineWidth = opts.strokeWidth;\n            }\n            ctx.strokeText(line, x, y, opts.maxWidth);\n        }\n        ctx.fillText(line, x, y, opts.maxWidth);\n        decorateText(ctx, x, y, line, opts);\n        y += Number(font.lineHeight);\n    }\n    ctx.restore();\n}\n/**\n * Add a path of a rectangle with rounded corners to the current sub-path\n * @param ctx - Context\n * @param rect - Bounding rect\n */ function addRoundedRectPath(ctx, rect) {\n    const { x , y , w , h , radius  } = rect;\n    // top left arc\n    ctx.arc(x + radius.topLeft, y + radius.topLeft, radius.topLeft, 1.5 * PI, PI, true);\n    // line from top left to bottom left\n    ctx.lineTo(x, y + h - radius.bottomLeft);\n    // bottom left arc\n    ctx.arc(x + radius.bottomLeft, y + h - radius.bottomLeft, radius.bottomLeft, PI, HALF_PI, true);\n    // line from bottom left to bottom right\n    ctx.lineTo(x + w - radius.bottomRight, y + h);\n    // bottom right arc\n    ctx.arc(x + w - radius.bottomRight, y + h - radius.bottomRight, radius.bottomRight, HALF_PI, 0, true);\n    // line from bottom right to top right\n    ctx.lineTo(x + w, y + radius.topRight);\n    // top right arc\n    ctx.arc(x + w - radius.topRight, y + radius.topRight, radius.topRight, 0, -HALF_PI, true);\n    // line from top right to top left\n    ctx.lineTo(x + radius.topLeft, y);\n}\n\nconst LINE_HEIGHT = /^(normal|(\\d+(?:\\.\\d+)?)(px|em|%)?)$/;\nconst FONT_STYLE = /^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;\n/**\n * @alias Chart.helpers.options\n * @namespace\n */ /**\n * Converts the given line height `value` in pixels for a specific font `size`.\n * @param value - The lineHeight to parse (eg. 1.6, '14px', '75%', '1.6em').\n * @param size - The font size (in pixels) used to resolve relative `value`.\n * @returns The effective line height in pixels (size * 1.2 if value is invalid).\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/line-height\n * @since 2.7.0\n */ function toLineHeight(value, size) {\n    const matches = ('' + value).match(LINE_HEIGHT);\n    if (!matches || matches[1] === 'normal') {\n        return size * 1.2;\n    }\n    value = +matches[2];\n    switch(matches[3]){\n        case 'px':\n            return value;\n        case '%':\n            value /= 100;\n            break;\n    }\n    return size * value;\n}\nconst numberOrZero = (v)=>+v || 0;\nfunction _readValueToProps(value, props) {\n    const ret = {};\n    const objProps = isObject(props);\n    const keys = objProps ? Object.keys(props) : props;\n    const read = isObject(value) ? objProps ? (prop)=>valueOrDefault(value[prop], value[props[prop]]) : (prop)=>value[prop] : ()=>value;\n    for (const prop of keys){\n        ret[prop] = numberOrZero(read(prop));\n    }\n    return ret;\n}\n/**\n * Converts the given value into a TRBL object.\n * @param value - If a number, set the value to all TRBL component,\n *  else, if an object, use defined properties and sets undefined ones to 0.\n *  x / y are shorthands for same value for left/right and top/bottom.\n * @returns The padding values (top, right, bottom, left)\n * @since 3.0.0\n */ function toTRBL(value) {\n    return _readValueToProps(value, {\n        top: 'y',\n        right: 'x',\n        bottom: 'y',\n        left: 'x'\n    });\n}\n/**\n * Converts the given value into a TRBL corners object (similar with css border-radius).\n * @param value - If a number, set the value to all TRBL corner components,\n *  else, if an object, use defined properties and sets undefined ones to 0.\n * @returns The TRBL corner values (topLeft, topRight, bottomLeft, bottomRight)\n * @since 3.0.0\n */ function toTRBLCorners(value) {\n    return _readValueToProps(value, [\n        'topLeft',\n        'topRight',\n        'bottomLeft',\n        'bottomRight'\n    ]);\n}\n/**\n * Converts the given value into a padding object with pre-computed width/height.\n * @param value - If a number, set the value to all TRBL component,\n *  else, if an object, use defined properties and sets undefined ones to 0.\n *  x / y are shorthands for same value for left/right and top/bottom.\n * @returns The padding values (top, right, bottom, left, width, height)\n * @since 2.7.0\n */ function toPadding(value) {\n    const obj = toTRBL(value);\n    obj.width = obj.left + obj.right;\n    obj.height = obj.top + obj.bottom;\n    return obj;\n}\n/**\n * Parses font options and returns the font object.\n * @param options - A object that contains font options to be parsed.\n * @param fallback - A object that contains fallback font options.\n * @return The font object.\n * @private\n */ function toFont(options, fallback) {\n    options = options || {};\n    fallback = fallback || defaults.font;\n    let size = valueOrDefault(options.size, fallback.size);\n    if (typeof size === 'string') {\n        size = parseInt(size, 10);\n    }\n    let style = valueOrDefault(options.style, fallback.style);\n    if (style && !('' + style).match(FONT_STYLE)) {\n        console.warn('Invalid font style specified: \"' + style + '\"');\n        style = undefined;\n    }\n    const font = {\n        family: valueOrDefault(options.family, fallback.family),\n        lineHeight: toLineHeight(valueOrDefault(options.lineHeight, fallback.lineHeight), size),\n        size,\n        style,\n        weight: valueOrDefault(options.weight, fallback.weight),\n        string: ''\n    };\n    font.string = toFontString(font);\n    return font;\n}\n/**\n * Evaluates the given `inputs` sequentially and returns the first defined value.\n * @param inputs - An array of values, falling back to the last value.\n * @param context - If defined and the current value is a function, the value\n * is called with `context` as first argument and the result becomes the new input.\n * @param index - If defined and the current value is an array, the value\n * at `index` become the new input.\n * @param info - object to return information about resolution in\n * @param info.cacheable - Will be set to `false` if option is not cacheable.\n * @since 2.7.0\n */ function resolve(inputs, context, index, info) {\n    let cacheable = true;\n    let i, ilen, value;\n    for(i = 0, ilen = inputs.length; i < ilen; ++i){\n        value = inputs[i];\n        if (value === undefined) {\n            continue;\n        }\n        if (context !== undefined && typeof value === 'function') {\n            value = value(context);\n            cacheable = false;\n        }\n        if (index !== undefined && isArray(value)) {\n            value = value[index % value.length];\n            cacheable = false;\n        }\n        if (value !== undefined) {\n            if (info && !cacheable) {\n                info.cacheable = false;\n            }\n            return value;\n        }\n    }\n}\n/**\n * @param minmax\n * @param grace\n * @param beginAtZero\n * @private\n */ function _addGrace(minmax, grace, beginAtZero) {\n    const { min , max  } = minmax;\n    const change = toDimension(grace, (max - min) / 2);\n    const keepZero = (value, add)=>beginAtZero && value === 0 ? 0 : value + add;\n    return {\n        min: keepZero(min, -Math.abs(change)),\n        max: keepZero(max, change)\n    };\n}\nfunction createContext(parentContext, context) {\n    return Object.assign(Object.create(parentContext), context);\n}\n\n/**\n * Creates a Proxy for resolving raw values for options.\n * @param scopes - The option scopes to look for values, in resolution order\n * @param prefixes - The prefixes for values, in resolution order.\n * @param rootScopes - The root option scopes\n * @param fallback - Parent scopes fallback\n * @param getTarget - callback for getting the target for changed values\n * @returns Proxy\n * @private\n */ function _createResolver(scopes, prefixes = [\n    ''\n], rootScopes, fallback, getTarget = ()=>scopes[0]) {\n    const finalRootScopes = rootScopes || scopes;\n    if (typeof fallback === 'undefined') {\n        fallback = _resolve('_fallback', scopes);\n    }\n    const cache = {\n        [Symbol.toStringTag]: 'Object',\n        _cacheable: true,\n        _scopes: scopes,\n        _rootScopes: finalRootScopes,\n        _fallback: fallback,\n        _getTarget: getTarget,\n        override: (scope)=>_createResolver([\n                scope,\n                ...scopes\n            ], prefixes, finalRootScopes, fallback)\n    };\n    return new Proxy(cache, {\n        /**\n     * A trap for the delete operator.\n     */ deleteProperty (target, prop) {\n            delete target[prop]; // remove from cache\n            delete target._keys; // remove cached keys\n            delete scopes[0][prop]; // remove from top level scope\n            return true;\n        },\n        /**\n     * A trap for getting property values.\n     */ get (target, prop) {\n            return _cached(target, prop, ()=>_resolveWithPrefixes(prop, prefixes, scopes, target));\n        },\n        /**\n     * A trap for Object.getOwnPropertyDescriptor.\n     * Also used by Object.hasOwnProperty.\n     */ getOwnPropertyDescriptor (target, prop) {\n            return Reflect.getOwnPropertyDescriptor(target._scopes[0], prop);\n        },\n        /**\n     * A trap for Object.getPrototypeOf.\n     */ getPrototypeOf () {\n            return Reflect.getPrototypeOf(scopes[0]);\n        },\n        /**\n     * A trap for the in operator.\n     */ has (target, prop) {\n            return getKeysFromAllScopes(target).includes(prop);\n        },\n        /**\n     * A trap for Object.getOwnPropertyNames and Object.getOwnPropertySymbols.\n     */ ownKeys (target) {\n            return getKeysFromAllScopes(target);\n        },\n        /**\n     * A trap for setting property values.\n     */ set (target, prop, value) {\n            const storage = target._storage || (target._storage = getTarget());\n            target[prop] = storage[prop] = value; // set to top level scope + cache\n            delete target._keys; // remove cached keys\n            return true;\n        }\n    });\n}\n/**\n * Returns an Proxy for resolving option values with context.\n * @param proxy - The Proxy returned by `_createResolver`\n * @param context - Context object for scriptable/indexable options\n * @param subProxy - The proxy provided for scriptable options\n * @param descriptorDefaults - Defaults for descriptors\n * @private\n */ function _attachContext(proxy, context, subProxy, descriptorDefaults) {\n    const cache = {\n        _cacheable: false,\n        _proxy: proxy,\n        _context: context,\n        _subProxy: subProxy,\n        _stack: new Set(),\n        _descriptors: _descriptors(proxy, descriptorDefaults),\n        setContext: (ctx)=>_attachContext(proxy, ctx, subProxy, descriptorDefaults),\n        override: (scope)=>_attachContext(proxy.override(scope), context, subProxy, descriptorDefaults)\n    };\n    return new Proxy(cache, {\n        /**\n     * A trap for the delete operator.\n     */ deleteProperty (target, prop) {\n            delete target[prop]; // remove from cache\n            delete proxy[prop]; // remove from proxy\n            return true;\n        },\n        /**\n     * A trap for getting property values.\n     */ get (target, prop, receiver) {\n            return _cached(target, prop, ()=>_resolveWithContext(target, prop, receiver));\n        },\n        /**\n     * A trap for Object.getOwnPropertyDescriptor.\n     * Also used by Object.hasOwnProperty.\n     */ getOwnPropertyDescriptor (target, prop) {\n            return target._descriptors.allKeys ? Reflect.has(proxy, prop) ? {\n                enumerable: true,\n                configurable: true\n            } : undefined : Reflect.getOwnPropertyDescriptor(proxy, prop);\n        },\n        /**\n     * A trap for Object.getPrototypeOf.\n     */ getPrototypeOf () {\n            return Reflect.getPrototypeOf(proxy);\n        },\n        /**\n     * A trap for the in operator.\n     */ has (target, prop) {\n            return Reflect.has(proxy, prop);\n        },\n        /**\n     * A trap for Object.getOwnPropertyNames and Object.getOwnPropertySymbols.\n     */ ownKeys () {\n            return Reflect.ownKeys(proxy);\n        },\n        /**\n     * A trap for setting property values.\n     */ set (target, prop, value) {\n            proxy[prop] = value; // set to proxy\n            delete target[prop]; // remove from cache\n            return true;\n        }\n    });\n}\n/**\n * @private\n */ function _descriptors(proxy, defaults = {\n    scriptable: true,\n    indexable: true\n}) {\n    const { _scriptable =defaults.scriptable , _indexable =defaults.indexable , _allKeys =defaults.allKeys  } = proxy;\n    return {\n        allKeys: _allKeys,\n        scriptable: _scriptable,\n        indexable: _indexable,\n        isScriptable: isFunction(_scriptable) ? _scriptable : ()=>_scriptable,\n        isIndexable: isFunction(_indexable) ? _indexable : ()=>_indexable\n    };\n}\nconst readKey = (prefix, name)=>prefix ? prefix + _capitalize(name) : name;\nconst needsSubResolver = (prop, value)=>isObject(value) && prop !== 'adapters' && (Object.getPrototypeOf(value) === null || value.constructor === Object);\nfunction _cached(target, prop, resolve) {\n    if (Object.prototype.hasOwnProperty.call(target, prop) || prop === 'constructor') {\n        return target[prop];\n    }\n    const value = resolve();\n    // cache the resolved value\n    target[prop] = value;\n    return value;\n}\nfunction _resolveWithContext(target, prop, receiver) {\n    const { _proxy , _context , _subProxy , _descriptors: descriptors  } = target;\n    let value = _proxy[prop]; // resolve from proxy\n    // resolve with context\n    if (isFunction(value) && descriptors.isScriptable(prop)) {\n        value = _resolveScriptable(prop, value, target, receiver);\n    }\n    if (isArray(value) && value.length) {\n        value = _resolveArray(prop, value, target, descriptors.isIndexable);\n    }\n    if (needsSubResolver(prop, value)) {\n        // if the resolved value is an object, create a sub resolver for it\n        value = _attachContext(value, _context, _subProxy && _subProxy[prop], descriptors);\n    }\n    return value;\n}\nfunction _resolveScriptable(prop, getValue, target, receiver) {\n    const { _proxy , _context , _subProxy , _stack  } = target;\n    if (_stack.has(prop)) {\n        throw new Error('Recursion detected: ' + Array.from(_stack).join('->') + '->' + prop);\n    }\n    _stack.add(prop);\n    let value = getValue(_context, _subProxy || receiver);\n    _stack.delete(prop);\n    if (needsSubResolver(prop, value)) {\n        // When scriptable option returns an object, create a resolver on that.\n        value = createSubResolver(_proxy._scopes, _proxy, prop, value);\n    }\n    return value;\n}\nfunction _resolveArray(prop, value, target, isIndexable) {\n    const { _proxy , _context , _subProxy , _descriptors: descriptors  } = target;\n    if (typeof _context.index !== 'undefined' && isIndexable(prop)) {\n        return value[_context.index % value.length];\n    } else if (isObject(value[0])) {\n        // Array of objects, return array or resolvers\n        const arr = value;\n        const scopes = _proxy._scopes.filter((s)=>s !== arr);\n        value = [];\n        for (const item of arr){\n            const resolver = createSubResolver(scopes, _proxy, prop, item);\n            value.push(_attachContext(resolver, _context, _subProxy && _subProxy[prop], descriptors));\n        }\n    }\n    return value;\n}\nfunction resolveFallback(fallback, prop, value) {\n    return isFunction(fallback) ? fallback(prop, value) : fallback;\n}\nconst getScope = (key, parent)=>key === true ? parent : typeof key === 'string' ? resolveObjectKey(parent, key) : undefined;\nfunction addScopes(set, parentScopes, key, parentFallback, value) {\n    for (const parent of parentScopes){\n        const scope = getScope(key, parent);\n        if (scope) {\n            set.add(scope);\n            const fallback = resolveFallback(scope._fallback, key, value);\n            if (typeof fallback !== 'undefined' && fallback !== key && fallback !== parentFallback) {\n                // When we reach the descriptor that defines a new _fallback, return that.\n                // The fallback will resume to that new scope.\n                return fallback;\n            }\n        } else if (scope === false && typeof parentFallback !== 'undefined' && key !== parentFallback) {\n            // Fallback to `false` results to `false`, when falling back to different key.\n            // For example `interaction` from `hover` or `plugins.tooltip` and `animation` from `animations`\n            return null;\n        }\n    }\n    return false;\n}\nfunction createSubResolver(parentScopes, resolver, prop, value) {\n    const rootScopes = resolver._rootScopes;\n    const fallback = resolveFallback(resolver._fallback, prop, value);\n    const allScopes = [\n        ...parentScopes,\n        ...rootScopes\n    ];\n    const set = new Set();\n    set.add(value);\n    let key = addScopesFromKey(set, allScopes, prop, fallback || prop, value);\n    if (key === null) {\n        return false;\n    }\n    if (typeof fallback !== 'undefined' && fallback !== prop) {\n        key = addScopesFromKey(set, allScopes, fallback, key, value);\n        if (key === null) {\n            return false;\n        }\n    }\n    return _createResolver(Array.from(set), [\n        ''\n    ], rootScopes, fallback, ()=>subGetTarget(resolver, prop, value));\n}\nfunction addScopesFromKey(set, allScopes, key, fallback, item) {\n    while(key){\n        key = addScopes(set, allScopes, key, fallback, item);\n    }\n    return key;\n}\nfunction subGetTarget(resolver, prop, value) {\n    const parent = resolver._getTarget();\n    if (!(prop in parent)) {\n        parent[prop] = {};\n    }\n    const target = parent[prop];\n    if (isArray(target) && isObject(value)) {\n        // For array of objects, the object is used to store updated values\n        return value;\n    }\n    return target || {};\n}\nfunction _resolveWithPrefixes(prop, prefixes, scopes, proxy) {\n    let value;\n    for (const prefix of prefixes){\n        value = _resolve(readKey(prefix, prop), scopes);\n        if (typeof value !== 'undefined') {\n            return needsSubResolver(prop, value) ? createSubResolver(scopes, proxy, prop, value) : value;\n        }\n    }\n}\nfunction _resolve(key, scopes) {\n    for (const scope of scopes){\n        if (!scope) {\n            continue;\n        }\n        const value = scope[key];\n        if (typeof value !== 'undefined') {\n            return value;\n        }\n    }\n}\nfunction getKeysFromAllScopes(target) {\n    let keys = target._keys;\n    if (!keys) {\n        keys = target._keys = resolveKeysFromAllScopes(target._scopes);\n    }\n    return keys;\n}\nfunction resolveKeysFromAllScopes(scopes) {\n    const set = new Set();\n    for (const scope of scopes){\n        for (const key of Object.keys(scope).filter((k)=>!k.startsWith('_'))){\n            set.add(key);\n        }\n    }\n    return Array.from(set);\n}\nfunction _parseObjectDataRadialScale(meta, data, start, count) {\n    const { iScale  } = meta;\n    const { key ='r'  } = this._parsing;\n    const parsed = new Array(count);\n    let i, ilen, index, item;\n    for(i = 0, ilen = count; i < ilen; ++i){\n        index = i + start;\n        item = data[index];\n        parsed[i] = {\n            r: iScale.parse(resolveObjectKey(item, key), index)\n        };\n    }\n    return parsed;\n}\n\nconst EPSILON = Number.EPSILON || 1e-14;\nconst getPoint = (points, i)=>i < points.length && !points[i].skip && points[i];\nconst getValueAxis = (indexAxis)=>indexAxis === 'x' ? 'y' : 'x';\nfunction splineCurve(firstPoint, middlePoint, afterPoint, t) {\n    // Props to Rob Spencer at scaled innovation for his post on splining between points\n    // http://scaledinnovation.com/analytics/splines/aboutSplines.html\n    // This function must also respect \"skipped\" points\n    const previous = firstPoint.skip ? middlePoint : firstPoint;\n    const current = middlePoint;\n    const next = afterPoint.skip ? middlePoint : afterPoint;\n    const d01 = distanceBetweenPoints(current, previous);\n    const d12 = distanceBetweenPoints(next, current);\n    let s01 = d01 / (d01 + d12);\n    let s12 = d12 / (d01 + d12);\n    // If all points are the same, s01 & s02 will be inf\n    s01 = isNaN(s01) ? 0 : s01;\n    s12 = isNaN(s12) ? 0 : s12;\n    const fa = t * s01; // scaling factor for triangle Ta\n    const fb = t * s12;\n    return {\n        previous: {\n            x: current.x - fa * (next.x - previous.x),\n            y: current.y - fa * (next.y - previous.y)\n        },\n        next: {\n            x: current.x + fb * (next.x - previous.x),\n            y: current.y + fb * (next.y - previous.y)\n        }\n    };\n}\n/**\n * Adjust tangents to ensure monotonic properties\n */ function monotoneAdjust(points, deltaK, mK) {\n    const pointsLen = points.length;\n    let alphaK, betaK, tauK, squaredMagnitude, pointCurrent;\n    let pointAfter = getPoint(points, 0);\n    for(let i = 0; i < pointsLen - 1; ++i){\n        pointCurrent = pointAfter;\n        pointAfter = getPoint(points, i + 1);\n        if (!pointCurrent || !pointAfter) {\n            continue;\n        }\n        if (almostEquals(deltaK[i], 0, EPSILON)) {\n            mK[i] = mK[i + 1] = 0;\n            continue;\n        }\n        alphaK = mK[i] / deltaK[i];\n        betaK = mK[i + 1] / deltaK[i];\n        squaredMagnitude = Math.pow(alphaK, 2) + Math.pow(betaK, 2);\n        if (squaredMagnitude <= 9) {\n            continue;\n        }\n        tauK = 3 / Math.sqrt(squaredMagnitude);\n        mK[i] = alphaK * tauK * deltaK[i];\n        mK[i + 1] = betaK * tauK * deltaK[i];\n    }\n}\nfunction monotoneCompute(points, mK, indexAxis = 'x') {\n    const valueAxis = getValueAxis(indexAxis);\n    const pointsLen = points.length;\n    let delta, pointBefore, pointCurrent;\n    let pointAfter = getPoint(points, 0);\n    for(let i = 0; i < pointsLen; ++i){\n        pointBefore = pointCurrent;\n        pointCurrent = pointAfter;\n        pointAfter = getPoint(points, i + 1);\n        if (!pointCurrent) {\n            continue;\n        }\n        const iPixel = pointCurrent[indexAxis];\n        const vPixel = pointCurrent[valueAxis];\n        if (pointBefore) {\n            delta = (iPixel - pointBefore[indexAxis]) / 3;\n            pointCurrent[`cp1${indexAxis}`] = iPixel - delta;\n            pointCurrent[`cp1${valueAxis}`] = vPixel - delta * mK[i];\n        }\n        if (pointAfter) {\n            delta = (pointAfter[indexAxis] - iPixel) / 3;\n            pointCurrent[`cp2${indexAxis}`] = iPixel + delta;\n            pointCurrent[`cp2${valueAxis}`] = vPixel + delta * mK[i];\n        }\n    }\n}\n/**\n * This function calculates Bzier control points in a similar way than |splineCurve|,\n * but preserves monotonicity of the provided data and ensures no local extremums are added\n * between the dataset discrete points due to the interpolation.\n * See : https://en.wikipedia.org/wiki/Monotone_cubic_interpolation\n */ function splineCurveMonotone(points, indexAxis = 'x') {\n    const valueAxis = getValueAxis(indexAxis);\n    const pointsLen = points.length;\n    const deltaK = Array(pointsLen).fill(0);\n    const mK = Array(pointsLen);\n    // Calculate slopes (deltaK) and initialize tangents (mK)\n    let i, pointBefore, pointCurrent;\n    let pointAfter = getPoint(points, 0);\n    for(i = 0; i < pointsLen; ++i){\n        pointBefore = pointCurrent;\n        pointCurrent = pointAfter;\n        pointAfter = getPoint(points, i + 1);\n        if (!pointCurrent) {\n            continue;\n        }\n        if (pointAfter) {\n            const slopeDelta = pointAfter[indexAxis] - pointCurrent[indexAxis];\n            // In the case of two points that appear at the same x pixel, slopeDeltaX is 0\n            deltaK[i] = slopeDelta !== 0 ? (pointAfter[valueAxis] - pointCurrent[valueAxis]) / slopeDelta : 0;\n        }\n        mK[i] = !pointBefore ? deltaK[i] : !pointAfter ? deltaK[i - 1] : sign(deltaK[i - 1]) !== sign(deltaK[i]) ? 0 : (deltaK[i - 1] + deltaK[i]) / 2;\n    }\n    monotoneAdjust(points, deltaK, mK);\n    monotoneCompute(points, mK, indexAxis);\n}\nfunction capControlPoint(pt, min, max) {\n    return Math.max(Math.min(pt, max), min);\n}\nfunction capBezierPoints(points, area) {\n    let i, ilen, point, inArea, inAreaPrev;\n    let inAreaNext = _isPointInArea(points[0], area);\n    for(i = 0, ilen = points.length; i < ilen; ++i){\n        inAreaPrev = inArea;\n        inArea = inAreaNext;\n        inAreaNext = i < ilen - 1 && _isPointInArea(points[i + 1], area);\n        if (!inArea) {\n            continue;\n        }\n        point = points[i];\n        if (inAreaPrev) {\n            point.cp1x = capControlPoint(point.cp1x, area.left, area.right);\n            point.cp1y = capControlPoint(point.cp1y, area.top, area.bottom);\n        }\n        if (inAreaNext) {\n            point.cp2x = capControlPoint(point.cp2x, area.left, area.right);\n            point.cp2y = capControlPoint(point.cp2y, area.top, area.bottom);\n        }\n    }\n}\n/**\n * @private\n */ function _updateBezierControlPoints(points, options, area, loop, indexAxis) {\n    let i, ilen, point, controlPoints;\n    // Only consider points that are drawn in case the spanGaps option is used\n    if (options.spanGaps) {\n        points = points.filter((pt)=>!pt.skip);\n    }\n    if (options.cubicInterpolationMode === 'monotone') {\n        splineCurveMonotone(points, indexAxis);\n    } else {\n        let prev = loop ? points[points.length - 1] : points[0];\n        for(i = 0, ilen = points.length; i < ilen; ++i){\n            point = points[i];\n            controlPoints = splineCurve(prev, point, points[Math.min(i + 1, ilen - (loop ? 0 : 1)) % ilen], options.tension);\n            point.cp1x = controlPoints.previous.x;\n            point.cp1y = controlPoints.previous.y;\n            point.cp2x = controlPoints.next.x;\n            point.cp2y = controlPoints.next.y;\n            prev = point;\n        }\n    }\n    if (options.capBezierPoints) {\n        capBezierPoints(points, area);\n    }\n}\n\n/**\n * @private\n */ function _isDomSupported() {\n    return typeof window !== 'undefined' && typeof document !== 'undefined';\n}\n/**\n * @private\n */ function _getParentNode(domNode) {\n    let parent = domNode.parentNode;\n    if (parent && parent.toString() === '[object ShadowRoot]') {\n        parent = parent.host;\n    }\n    return parent;\n}\n/**\n * convert max-width/max-height values that may be percentages into a number\n * @private\n */ function parseMaxStyle(styleValue, node, parentProperty) {\n    let valueInPixels;\n    if (typeof styleValue === 'string') {\n        valueInPixels = parseInt(styleValue, 10);\n        if (styleValue.indexOf('%') !== -1) {\n            // percentage * size in dimension\n            valueInPixels = valueInPixels / 100 * node.parentNode[parentProperty];\n        }\n    } else {\n        valueInPixels = styleValue;\n    }\n    return valueInPixels;\n}\nconst getComputedStyle = (element)=>element.ownerDocument.defaultView.getComputedStyle(element, null);\nfunction getStyle(el, property) {\n    return getComputedStyle(el).getPropertyValue(property);\n}\nconst positions = [\n    'top',\n    'right',\n    'bottom',\n    'left'\n];\nfunction getPositionedStyle(styles, style, suffix) {\n    const result = {};\n    suffix = suffix ? '-' + suffix : '';\n    for(let i = 0; i < 4; i++){\n        const pos = positions[i];\n        result[pos] = parseFloat(styles[style + '-' + pos + suffix]) || 0;\n    }\n    result.width = result.left + result.right;\n    result.height = result.top + result.bottom;\n    return result;\n}\nconst useOffsetPos = (x, y, target)=>(x > 0 || y > 0) && (!target || !target.shadowRoot);\n/**\n * @param e\n * @param canvas\n * @returns Canvas position\n */ function getCanvasPosition(e, canvas) {\n    const touches = e.touches;\n    const source = touches && touches.length ? touches[0] : e;\n    const { offsetX , offsetY  } = source;\n    let box = false;\n    let x, y;\n    if (useOffsetPos(offsetX, offsetY, e.target)) {\n        x = offsetX;\n        y = offsetY;\n    } else {\n        const rect = canvas.getBoundingClientRect();\n        x = source.clientX - rect.left;\n        y = source.clientY - rect.top;\n        box = true;\n    }\n    return {\n        x,\n        y,\n        box\n    };\n}\n/**\n * Gets an event's x, y coordinates, relative to the chart area\n * @param event\n * @param chart\n * @returns x and y coordinates of the event\n */ function getRelativePosition(event, chart) {\n    if ('native' in event) {\n        return event;\n    }\n    const { canvas , currentDevicePixelRatio  } = chart;\n    const style = getComputedStyle(canvas);\n    const borderBox = style.boxSizing === 'border-box';\n    const paddings = getPositionedStyle(style, 'padding');\n    const borders = getPositionedStyle(style, 'border', 'width');\n    const { x , y , box  } = getCanvasPosition(event, canvas);\n    const xOffset = paddings.left + (box && borders.left);\n    const yOffset = paddings.top + (box && borders.top);\n    let { width , height  } = chart;\n    if (borderBox) {\n        width -= paddings.width + borders.width;\n        height -= paddings.height + borders.height;\n    }\n    return {\n        x: Math.round((x - xOffset) / width * canvas.width / currentDevicePixelRatio),\n        y: Math.round((y - yOffset) / height * canvas.height / currentDevicePixelRatio)\n    };\n}\nfunction getContainerSize(canvas, width, height) {\n    let maxWidth, maxHeight;\n    if (width === undefined || height === undefined) {\n        const container = canvas && _getParentNode(canvas);\n        if (!container) {\n            width = canvas.clientWidth;\n            height = canvas.clientHeight;\n        } else {\n            const rect = container.getBoundingClientRect(); // this is the border box of the container\n            const containerStyle = getComputedStyle(container);\n            const containerBorder = getPositionedStyle(containerStyle, 'border', 'width');\n            const containerPadding = getPositionedStyle(containerStyle, 'padding');\n            width = rect.width - containerPadding.width - containerBorder.width;\n            height = rect.height - containerPadding.height - containerBorder.height;\n            maxWidth = parseMaxStyle(containerStyle.maxWidth, container, 'clientWidth');\n            maxHeight = parseMaxStyle(containerStyle.maxHeight, container, 'clientHeight');\n        }\n    }\n    return {\n        width,\n        height,\n        maxWidth: maxWidth || INFINITY,\n        maxHeight: maxHeight || INFINITY\n    };\n}\nconst round1 = (v)=>Math.round(v * 10) / 10;\n// eslint-disable-next-line complexity\nfunction getMaximumSize(canvas, bbWidth, bbHeight, aspectRatio) {\n    const style = getComputedStyle(canvas);\n    const margins = getPositionedStyle(style, 'margin');\n    const maxWidth = parseMaxStyle(style.maxWidth, canvas, 'clientWidth') || INFINITY;\n    const maxHeight = parseMaxStyle(style.maxHeight, canvas, 'clientHeight') || INFINITY;\n    const containerSize = getContainerSize(canvas, bbWidth, bbHeight);\n    let { width , height  } = containerSize;\n    if (style.boxSizing === 'content-box') {\n        const borders = getPositionedStyle(style, 'border', 'width');\n        const paddings = getPositionedStyle(style, 'padding');\n        width -= paddings.width + borders.width;\n        height -= paddings.height + borders.height;\n    }\n    width = Math.max(0, width - margins.width);\n    height = Math.max(0, aspectRatio ? width / aspectRatio : height - margins.height);\n    width = round1(Math.min(width, maxWidth, containerSize.maxWidth));\n    height = round1(Math.min(height, maxHeight, containerSize.maxHeight));\n    if (width && !height) {\n        // https://github.com/chartjs/Chart.js/issues/4659\n        // If the canvas has width, but no height, default to aspectRatio of 2 (canvas default)\n        height = round1(width / 2);\n    }\n    const maintainHeight = bbWidth !== undefined || bbHeight !== undefined;\n    if (maintainHeight && aspectRatio && containerSize.height && height > containerSize.height) {\n        height = containerSize.height;\n        width = round1(Math.floor(height * aspectRatio));\n    }\n    return {\n        width,\n        height\n    };\n}\n/**\n * @param chart\n * @param forceRatio\n * @param forceStyle\n * @returns True if the canvas context size or transformation has changed.\n */ function retinaScale(chart, forceRatio, forceStyle) {\n    const pixelRatio = forceRatio || 1;\n    const deviceHeight = round1(chart.height * pixelRatio);\n    const deviceWidth = round1(chart.width * pixelRatio);\n    chart.height = round1(chart.height);\n    chart.width = round1(chart.width);\n    const canvas = chart.canvas;\n    // If no style has been set on the canvas, the render size is used as display size,\n    // making the chart visually bigger, so let's enforce it to the \"correct\" values.\n    // See https://github.com/chartjs/Chart.js/issues/3575\n    if (canvas.style && (forceStyle || !canvas.style.height && !canvas.style.width)) {\n        canvas.style.height = `${chart.height}px`;\n        canvas.style.width = `${chart.width}px`;\n    }\n    if (chart.currentDevicePixelRatio !== pixelRatio || canvas.height !== deviceHeight || canvas.width !== deviceWidth) {\n        chart.currentDevicePixelRatio = pixelRatio;\n        canvas.height = deviceHeight;\n        canvas.width = deviceWidth;\n        chart.ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n        return true;\n    }\n    return false;\n}\n/**\n * Detects support for options object argument in addEventListener.\n * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Safely_detecting_option_support\n * @private\n */ const supportsEventListenerOptions = function() {\n    let passiveSupported = false;\n    try {\n        const options = {\n            get passive () {\n                passiveSupported = true;\n                return false;\n            }\n        };\n        if (_isDomSupported()) {\n            window.addEventListener('test', null, options);\n            window.removeEventListener('test', null, options);\n        }\n    } catch (e) {\n    // continue regardless of error\n    }\n    return passiveSupported;\n}();\n/**\n * The \"used\" size is the final value of a dimension property after all calculations have\n * been performed. This method uses the computed style of `element` but returns undefined\n * if the computed style is not expressed in pixels. That can happen in some cases where\n * `element` has a size relative to its parent and this last one is not yet displayed,\n * for example because of `display: none` on a parent node.\n * @see https://developer.mozilla.org/en-US/docs/Web/CSS/used_value\n * @returns Size in pixels or undefined if unknown.\n */ function readUsedSize(element, property) {\n    const value = getStyle(element, property);\n    const matches = value && value.match(/^(\\d+)(\\.\\d+)?px$/);\n    return matches ? +matches[1] : undefined;\n}\n\n/**\n * @private\n */ function _pointInLine(p1, p2, t, mode) {\n    return {\n        x: p1.x + t * (p2.x - p1.x),\n        y: p1.y + t * (p2.y - p1.y)\n    };\n}\n/**\n * @private\n */ function _steppedInterpolation(p1, p2, t, mode) {\n    return {\n        x: p1.x + t * (p2.x - p1.x),\n        y: mode === 'middle' ? t < 0.5 ? p1.y : p2.y : mode === 'after' ? t < 1 ? p1.y : p2.y : t > 0 ? p2.y : p1.y\n    };\n}\n/**\n * @private\n */ function _bezierInterpolation(p1, p2, t, mode) {\n    const cp1 = {\n        x: p1.cp2x,\n        y: p1.cp2y\n    };\n    const cp2 = {\n        x: p2.cp1x,\n        y: p2.cp1y\n    };\n    const a = _pointInLine(p1, cp1, t);\n    const b = _pointInLine(cp1, cp2, t);\n    const c = _pointInLine(cp2, p2, t);\n    const d = _pointInLine(a, b, t);\n    const e = _pointInLine(b, c, t);\n    return _pointInLine(d, e, t);\n}\n\nconst getRightToLeftAdapter = function(rectX, width) {\n    return {\n        x (x) {\n            return rectX + rectX + width - x;\n        },\n        setWidth (w) {\n            width = w;\n        },\n        textAlign (align) {\n            if (align === 'center') {\n                return align;\n            }\n            return align === 'right' ? 'left' : 'right';\n        },\n        xPlus (x, value) {\n            return x - value;\n        },\n        leftForLtr (x, itemWidth) {\n            return x - itemWidth;\n        }\n    };\n};\nconst getLeftToRightAdapter = function() {\n    return {\n        x (x) {\n            return x;\n        },\n        setWidth (w) {},\n        textAlign (align) {\n            return align;\n        },\n        xPlus (x, value) {\n            return x + value;\n        },\n        leftForLtr (x, _itemWidth) {\n            return x;\n        }\n    };\n};\nfunction getRtlAdapter(rtl, rectX, width) {\n    return rtl ? getRightToLeftAdapter(rectX, width) : getLeftToRightAdapter();\n}\nfunction overrideTextDirection(ctx, direction) {\n    let style, original;\n    if (direction === 'ltr' || direction === 'rtl') {\n        style = ctx.canvas.style;\n        original = [\n            style.getPropertyValue('direction'),\n            style.getPropertyPriority('direction')\n        ];\n        style.setProperty('direction', direction, 'important');\n        ctx.prevTextDirection = original;\n    }\n}\nfunction restoreTextDirection(ctx, original) {\n    if (original !== undefined) {\n        delete ctx.prevTextDirection;\n        ctx.canvas.style.setProperty('direction', original[0], original[1]);\n    }\n}\n\nfunction propertyFn(property) {\n    if (property === 'angle') {\n        return {\n            between: _angleBetween,\n            compare: _angleDiff,\n            normalize: _normalizeAngle\n        };\n    }\n    return {\n        between: _isBetween,\n        compare: (a, b)=>a - b,\n        normalize: (x)=>x\n    };\n}\nfunction normalizeSegment({ start , end , count , loop , style  }) {\n    return {\n        start: start % count,\n        end: end % count,\n        loop: loop && (end - start + 1) % count === 0,\n        style\n    };\n}\nfunction getSegment(segment, points, bounds) {\n    const { property , start: startBound , end: endBound  } = bounds;\n    const { between , normalize  } = propertyFn(property);\n    const count = points.length;\n    let { start , end , loop  } = segment;\n    let i, ilen;\n    if (loop) {\n        start += count;\n        end += count;\n        for(i = 0, ilen = count; i < ilen; ++i){\n            if (!between(normalize(points[start % count][property]), startBound, endBound)) {\n                break;\n            }\n            start--;\n            end--;\n        }\n        start %= count;\n        end %= count;\n    }\n    if (end < start) {\n        end += count;\n    }\n    return {\n        start,\n        end,\n        loop,\n        style: segment.style\n    };\n}\n function _boundSegment(segment, points, bounds) {\n    if (!bounds) {\n        return [\n            segment\n        ];\n    }\n    const { property , start: startBound , end: endBound  } = bounds;\n    const count = points.length;\n    const { compare , between , normalize  } = propertyFn(property);\n    const { start , end , loop , style  } = getSegment(segment, points, bounds);\n    const result = [];\n    let inside = false;\n    let subStart = null;\n    let value, point, prevValue;\n    const startIsBefore = ()=>between(startBound, prevValue, value) && compare(startBound, prevValue) !== 0;\n    const endIsBefore = ()=>compare(endBound, value) === 0 || between(endBound, prevValue, value);\n    const shouldStart = ()=>inside || startIsBefore();\n    const shouldStop = ()=>!inside || endIsBefore();\n    for(let i = start, prev = start; i <= end; ++i){\n        point = points[i % count];\n        if (point.skip) {\n            continue;\n        }\n        value = normalize(point[property]);\n        if (value === prevValue) {\n            continue;\n        }\n        inside = between(value, startBound, endBound);\n        if (subStart === null && shouldStart()) {\n            subStart = compare(value, startBound) === 0 ? i : prev;\n        }\n        if (subStart !== null && shouldStop()) {\n            result.push(normalizeSegment({\n                start: subStart,\n                end: i,\n                loop,\n                count,\n                style\n            }));\n            subStart = null;\n        }\n        prev = i;\n        prevValue = value;\n    }\n    if (subStart !== null) {\n        result.push(normalizeSegment({\n            start: subStart,\n            end,\n            loop,\n            count,\n            style\n        }));\n    }\n    return result;\n}\n function _boundSegments(line, bounds) {\n    const result = [];\n    const segments = line.segments;\n    for(let i = 0; i < segments.length; i++){\n        const sub = _boundSegment(segments[i], line.points, bounds);\n        if (sub.length) {\n            result.push(...sub);\n        }\n    }\n    return result;\n}\n function findStartAndEnd(points, count, loop, spanGaps) {\n    let start = 0;\n    let end = count - 1;\n    if (loop && !spanGaps) {\n        while(start < count && !points[start].skip){\n            start++;\n        }\n    }\n    while(start < count && points[start].skip){\n        start++;\n    }\n    start %= count;\n    if (loop) {\n        end += start;\n    }\n    while(end > start && points[end % count].skip){\n        end--;\n    }\n    end %= count;\n    return {\n        start,\n        end\n    };\n}\n function solidSegments(points, start, max, loop) {\n    const count = points.length;\n    const result = [];\n    let last = start;\n    let prev = points[start];\n    let end;\n    for(end = start + 1; end <= max; ++end){\n        const cur = points[end % count];\n        if (cur.skip || cur.stop) {\n            if (!prev.skip) {\n                loop = false;\n                result.push({\n                    start: start % count,\n                    end: (end - 1) % count,\n                    loop\n                });\n                start = last = cur.stop ? end : null;\n            }\n        } else {\n            last = end;\n            if (prev.skip) {\n                start = end;\n            }\n        }\n        prev = cur;\n    }\n    if (last !== null) {\n        result.push({\n            start: start % count,\n            end: last % count,\n            loop\n        });\n    }\n    return result;\n}\n function _computeSegments(line, segmentOptions) {\n    const points = line.points;\n    const spanGaps = line.options.spanGaps;\n    const count = points.length;\n    if (!count) {\n        return [];\n    }\n    const loop = !!line._loop;\n    const { start , end  } = findStartAndEnd(points, count, loop, spanGaps);\n    if (spanGaps === true) {\n        return splitByStyles(line, [\n            {\n                start,\n                end,\n                loop\n            }\n        ], points, segmentOptions);\n    }\n    const max = end < start ? end + count : end;\n    const completeLoop = !!line._fullLoop && start === 0 && end === count - 1;\n    return splitByStyles(line, solidSegments(points, start, max, completeLoop), points, segmentOptions);\n}\n function splitByStyles(line, segments, points, segmentOptions) {\n    if (!segmentOptions || !segmentOptions.setContext || !points) {\n        return segments;\n    }\n    return doSplitByStyles(line, segments, points, segmentOptions);\n}\n function doSplitByStyles(line, segments, points, segmentOptions) {\n    const chartContext = line._chart.getContext();\n    const baseStyle = readStyle(line.options);\n    const { _datasetIndex: datasetIndex , options: { spanGaps  }  } = line;\n    const count = points.length;\n    const result = [];\n    let prevStyle = baseStyle;\n    let start = segments[0].start;\n    let i = start;\n    function addStyle(s, e, l, st) {\n        const dir = spanGaps ? -1 : 1;\n        if (s === e) {\n            return;\n        }\n        s += count;\n        while(points[s % count].skip){\n            s -= dir;\n        }\n        while(points[e % count].skip){\n            e += dir;\n        }\n        if (s % count !== e % count) {\n            result.push({\n                start: s % count,\n                end: e % count,\n                loop: l,\n                style: st\n            });\n            prevStyle = st;\n            start = e % count;\n        }\n    }\n    for (const segment of segments){\n        start = spanGaps ? start : segment.start;\n        let prev = points[start % count];\n        let style;\n        for(i = start + 1; i <= segment.end; i++){\n            const pt = points[i % count];\n            style = readStyle(segmentOptions.setContext(createContext(chartContext, {\n                type: 'segment',\n                p0: prev,\n                p1: pt,\n                p0DataIndex: (i - 1) % count,\n                p1DataIndex: i % count,\n                datasetIndex\n            })));\n            if (styleChanged(style, prevStyle)) {\n                addStyle(start, i - 1, segment.loop, prevStyle);\n            }\n            prev = pt;\n            prevStyle = style;\n        }\n        if (start < i - 1) {\n            addStyle(start, i - 1, segment.loop, prevStyle);\n        }\n    }\n    return result;\n}\nfunction readStyle(options) {\n    return {\n        backgroundColor: options.backgroundColor,\n        borderCapStyle: options.borderCapStyle,\n        borderDash: options.borderDash,\n        borderDashOffset: options.borderDashOffset,\n        borderJoinStyle: options.borderJoinStyle,\n        borderWidth: options.borderWidth,\n        borderColor: options.borderColor\n    };\n}\nfunction styleChanged(style, prevStyle) {\n    if (!prevStyle) {\n        return false;\n    }\n    const cache = [];\n    const replacer = function(key, value) {\n        if (!isPatternOrGradient(value)) {\n            return value;\n        }\n        if (!cache.includes(value)) {\n            cache.push(value);\n        }\n        return cache.indexOf(value);\n    };\n    return JSON.stringify(style, replacer) !== JSON.stringify(prevStyle, replacer);\n}\n\nfunction getSizeForArea(scale, chartArea, field) {\n    return scale.options.clip ? scale[field] : chartArea[field];\n}\nfunction getDatasetArea(meta, chartArea) {\n    const { xScale , yScale  } = meta;\n    if (xScale && yScale) {\n        return {\n            left: getSizeForArea(xScale, chartArea, 'left'),\n            right: getSizeForArea(xScale, chartArea, 'right'),\n            top: getSizeForArea(yScale, chartArea, 'top'),\n            bottom: getSizeForArea(yScale, chartArea, 'bottom')\n        };\n    }\n    return chartArea;\n}\nfunction getDatasetClipArea(chart, meta) {\n    const clip = meta._clip;\n    if (clip.disabled) {\n        return false;\n    }\n    const area = getDatasetArea(meta, chart.chartArea);\n    return {\n        left: clip.left === false ? 0 : area.left - (clip.left === true ? 0 : clip.left),\n        right: clip.right === false ? chart.width : area.right + (clip.right === true ? 0 : clip.right),\n        top: clip.top === false ? 0 : area.top - (clip.top === true ? 0 : clip.top),\n        bottom: clip.bottom === false ? chart.height : area.bottom + (clip.bottom === true ? 0 : clip.bottom)\n    };\n}\n\nexport { unclipArea as $, _rlookupByKey as A, _lookupByKey as B, _isPointInArea as C, getAngleFromPoint as D, toPadding as E, each as F, getMaximumSize as G, HALF_PI as H, _getParentNode as I, readUsedSize as J, supportsEventListenerOptions as K, throttled as L, _isDomSupported as M, _factorize as N, finiteOrDefault as O, PI as P, callback as Q, _addGrace as R, _limitValue as S, TAU as T, toDegrees as U, _measureText as V, _int16Range as W, _alignPixel as X, clipArea as Y, renderText as Z, _arrayUnique as _, resolve as a, getStyle as a$, toFont as a0, _toLeftRightCenter as a1, _alignStartEnd as a2, overrides as a3, merge as a4, _capitalize as a5, descriptors as a6, isFunction as a7, _attachContext as a8, _createResolver as a9, getRtlAdapter as aA, overrideTextDirection as aB, _textX as aC, restoreTextDirection as aD, drawPointLegend as aE, distanceBetweenPoints as aF, noop as aG, _setMinAndMaxByKey as aH, niceNum as aI, almostWhole as aJ, almostEquals as aK, _decimalPlaces as aL, Ticks as aM, log10 as aN, _longestText as aO, _filterBetween as aP, _lookup as aQ, isPatternOrGradient as aR, getHoverColor as aS, clone as aT, _merger as aU, _mergerIf as aV, _deprecated as aW, _splitKey as aX, toFontString as aY, splineCurve as aZ, splineCurveMonotone as a_, _descriptors as aa, mergeIf as ab, uid as ac, debounce as ad, retinaScale as ae, clearCanvas as af, setsEqual as ag, getDatasetClipArea as ah, _elementsEqual as ai, _isClickEvent as aj, _isBetween as ak, _normalizeAngle as al, _readValueToProps as am, _updateBezierControlPoints as an, _computeSegments as ao, _boundSegments as ap, _steppedInterpolation as aq, _bezierInterpolation as ar, _pointInLine as as, _steppedLineTo as at, _bezierCurveTo as au, drawPoint as av, addRoundedRectPath as aw, toTRBL as ax, toTRBLCorners as ay, _boundSegment as az, isArray as b, fontString as b0, toLineHeight as b1, PITAU as b2, INFINITY as b3, RAD_PER_DEG as b4, QUARTER_PI as b5, TWO_THIRDS_PI as b6, _angleDiff as b7, color as c, defaults as d, effects as e, resolveObjectKey as f, isNumberFinite as g, defined as h, isObject as i, createContext as j, isNullOrUndef as k, listenArrayEvents as l, toPercentage as m, toDimension as n, formatNumber as o, _angleBetween as p, _getStartAndCountOfVisiblePoints as q, requestAnimFrame as r, sign as s, toRadians as t, unlistenArrayEvents as u, valueOrDefault as v, _scaleRangesChanged as w, isNumber as x, _parseObjectDataRadialScale as y, getRelativePosition as z };\n//# sourceMappingURL=helpers.dataset.js.map\n","/*!\n * Chart.js v4.5.1\n * https://www.chartjs.org\n * (c) 2025 Chart.js Contributors\n * Released under the MIT License\n */\nimport { r as requestAnimFrame, a as resolve, e as effects, c as color, i as isObject, d as defaults, b as isArray, v as valueOrDefault, u as unlistenArrayEvents, l as listenArrayEvents, f as resolveObjectKey, g as isNumberFinite, h as defined, s as sign, j as createContext, k as isNullOrUndef, _ as _arrayUnique, t as toRadians, m as toPercentage, n as toDimension, T as TAU, o as formatNumber, p as _angleBetween, H as HALF_PI, P as PI, q as _getStartAndCountOfVisiblePoints, w as _scaleRangesChanged, x as isNumber, y as _parseObjectDataRadialScale, z as getRelativePosition, A as _rlookupByKey, B as _lookupByKey, C as _isPointInArea, D as getAngleFromPoint, E as toPadding, F as each, G as getMaximumSize, I as _getParentNode, J as readUsedSize, K as supportsEventListenerOptions, L as throttled, M as _isDomSupported, N as _factorize, O as finiteOrDefault, Q as callback, R as _addGrace, S as _limitValue, U as toDegrees, V as _measureText, W as _int16Range, X as _alignPixel, Y as clipArea, Z as renderText, $ as unclipArea, a0 as toFont, a1 as _toLeftRightCenter, a2 as _alignStartEnd, a3 as overrides, a4 as merge, a5 as _capitalize, a6 as descriptors, a7 as isFunction, a8 as _attachContext, a9 as _createResolver, aa as _descriptors, ab as mergeIf, ac as uid, ad as debounce, ae as retinaScale, af as clearCanvas, ag as setsEqual, ah as getDatasetClipArea, ai as _elementsEqual, aj as _isClickEvent, ak as _isBetween, al as _normalizeAngle, am as _readValueToProps, an as _updateBezierControlPoints, ao as _computeSegments, ap as _boundSegments, aq as _steppedInterpolation, ar as _bezierInterpolation, as as _pointInLine, at as _steppedLineTo, au as _bezierCurveTo, av as drawPoint, aw as addRoundedRectPath, ax as toTRBL, ay as toTRBLCorners, az as _boundSegment, aA as getRtlAdapter, aB as overrideTextDirection, aC as _textX, aD as restoreTextDirection, aE as drawPointLegend, aF as distanceBetweenPoints, aG as noop, aH as _setMinAndMaxByKey, aI as niceNum, aJ as almostWhole, aK as almostEquals, aL as _decimalPlaces, aM as Ticks, aN as log10, aO as _longestText, aP as _filterBetween, aQ as _lookup } from './chunks/helpers.dataset.js';\nimport '@kurkle/color';\n\nclass Animator {\n    constructor(){\n        this._request = null;\n        this._charts = new Map();\n        this._running = false;\n        this._lastDate = undefined;\n    }\n _notify(chart, anims, date, type) {\n        const callbacks = anims.listeners[type];\n        const numSteps = anims.duration;\n        callbacks.forEach((fn)=>fn({\n                chart,\n                initial: anims.initial,\n                numSteps,\n                currentStep: Math.min(date - anims.start, numSteps)\n            }));\n    }\n _refresh() {\n        if (this._request) {\n            return;\n        }\n        this._running = true;\n        this._request = requestAnimFrame.call(window, ()=>{\n            this._update();\n            this._request = null;\n            if (this._running) {\n                this._refresh();\n            }\n        });\n    }\n _update(date = Date.now()) {\n        let remaining = 0;\n        this._charts.forEach((anims, chart)=>{\n            if (!anims.running || !anims.items.length) {\n                return;\n            }\n            const items = anims.items;\n            let i = items.length - 1;\n            let draw = false;\n            let item;\n            for(; i >= 0; --i){\n                item = items[i];\n                if (item._active) {\n                    if (item._total > anims.duration) {\n                        anims.duration = item._total;\n                    }\n                    item.tick(date);\n                    draw = true;\n                } else {\n                    items[i] = items[items.length - 1];\n                    items.pop();\n                }\n            }\n            if (draw) {\n                chart.draw();\n                this._notify(chart, anims, date, 'progress');\n            }\n            if (!items.length) {\n                anims.running = false;\n                this._notify(chart, anims, date, 'complete');\n                anims.initial = false;\n            }\n            remaining += items.length;\n        });\n        this._lastDate = date;\n        if (remaining === 0) {\n            this._running = false;\n        }\n    }\n _getAnims(chart) {\n        const charts = this._charts;\n        let anims = charts.get(chart);\n        if (!anims) {\n            anims = {\n                running: false,\n                initial: true,\n                items: [],\n                listeners: {\n                    complete: [],\n                    progress: []\n                }\n            };\n            charts.set(chart, anims);\n        }\n        return anims;\n    }\n listen(chart, event, cb) {\n        this._getAnims(chart).listeners[event].push(cb);\n    }\n add(chart, items) {\n        if (!items || !items.length) {\n            return;\n        }\n        this._getAnims(chart).items.push(...items);\n    }\n has(chart) {\n        return this._getAnims(chart).items.length > 0;\n    }\n start(chart) {\n        const anims = this._charts.get(chart);\n        if (!anims) {\n            return;\n        }\n        anims.running = true;\n        anims.start = Date.now();\n        anims.duration = anims.items.reduce((acc, cur)=>Math.max(acc, cur._duration), 0);\n        this._refresh();\n    }\n    running(chart) {\n        if (!this._running) {\n            return false;\n        }\n        const anims = this._charts.get(chart);\n        if (!anims || !anims.running || !anims.items.length) {\n            return false;\n        }\n        return true;\n    }\n stop(chart) {\n        const anims = this._charts.get(chart);\n        if (!anims || !anims.items.length) {\n            return;\n        }\n        const items = anims.items;\n        let i = items.length - 1;\n        for(; i >= 0; --i){\n            items[i].cancel();\n        }\n        anims.items = [];\n        this._notify(chart, anims, Date.now(), 'complete');\n    }\n remove(chart) {\n        return this._charts.delete(chart);\n    }\n}\nvar animator = /* #__PURE__ */ new Animator();\n\nconst transparent = 'transparent';\nconst interpolators = {\n    boolean (from, to, factor) {\n        return factor > 0.5 ? to : from;\n    },\n color (from, to, factor) {\n        const c0 = color(from || transparent);\n        const c1 = c0.valid && color(to || transparent);\n        return c1 && c1.valid ? c1.mix(c0, factor).hexString() : to;\n    },\n    number (from, to, factor) {\n        return from + (to - from) * factor;\n    }\n};\nclass Animation {\n    constructor(cfg, target, prop, to){\n        const currentValue = target[prop];\n        to = resolve([\n            cfg.to,\n            to,\n            currentValue,\n            cfg.from\n        ]);\n        const from = resolve([\n            cfg.from,\n            currentValue,\n            to\n        ]);\n        this._active = true;\n        this._fn = cfg.fn || interpolators[cfg.type || typeof from];\n        this._easing = effects[cfg.easing] || effects.linear;\n        this._start = Math.floor(Date.now() + (cfg.delay || 0));\n        this._duration = this._total = Math.floor(cfg.duration);\n        this._loop = !!cfg.loop;\n        this._target = target;\n        this._prop = prop;\n        this._from = from;\n        this._to = to;\n        this._promises = undefined;\n    }\n    active() {\n        return this._active;\n    }\n    update(cfg, to, date) {\n        if (this._active) {\n            this._notify(false);\n            const currentValue = this._target[this._prop];\n            const elapsed = date - this._start;\n            const remain = this._duration - elapsed;\n            this._start = date;\n            this._duration = Math.floor(Math.max(remain, cfg.duration));\n            this._total += elapsed;\n            this._loop = !!cfg.loop;\n            this._to = resolve([\n                cfg.to,\n                to,\n                currentValue,\n                cfg.from\n            ]);\n            this._from = resolve([\n                cfg.from,\n                currentValue,\n                to\n            ]);\n        }\n    }\n    cancel() {\n        if (this._active) {\n            this.tick(Date.now());\n            this._active = false;\n            this._notify(false);\n        }\n    }\n    tick(date) {\n        const elapsed = date - this._start;\n        const duration = this._duration;\n        const prop = this._prop;\n        const from = this._from;\n        const loop = this._loop;\n        const to = this._to;\n        let factor;\n        this._active = from !== to && (loop || elapsed < duration);\n        if (!this._active) {\n            this._target[prop] = to;\n            this._notify(true);\n            return;\n        }\n        if (elapsed < 0) {\n            this._target[prop] = from;\n            return;\n        }\n        factor = elapsed / duration % 2;\n        factor = loop && factor > 1 ? 2 - factor : factor;\n        factor = this._easing(Math.min(1, Math.max(0, factor)));\n        this._target[prop] = this._fn(from, to, factor);\n    }\n    wait() {\n        const promises = this._promises || (this._promises = []);\n        return new Promise((res, rej)=>{\n            promises.push({\n                res,\n                rej\n            });\n        });\n    }\n    _notify(resolved) {\n        const method = resolved ? 'res' : 'rej';\n        const promises = this._promises || [];\n        for(let i = 0; i < promises.length; i++){\n            promises[i][method]();\n        }\n    }\n}\n\nclass Animations {\n    constructor(chart, config){\n        this._chart = chart;\n        this._properties = new Map();\n        this.configure(config);\n    }\n    configure(config) {\n        if (!isObject(config)) {\n            return;\n        }\n        const animationOptions = Object.keys(defaults.animation);\n        const animatedProps = this._properties;\n        Object.getOwnPropertyNames(config).forEach((key)=>{\n            const cfg = config[key];\n            if (!isObject(cfg)) {\n                return;\n            }\n            const resolved = {};\n            for (const option of animationOptions){\n                resolved[option] = cfg[option];\n            }\n            (isArray(cfg.properties) && cfg.properties || [\n                key\n            ]).forEach((prop)=>{\n                if (prop === key || !animatedProps.has(prop)) {\n                    animatedProps.set(prop, resolved);\n                }\n            });\n        });\n    }\n _animateOptions(target, values) {\n        const newOptions = values.options;\n        const options = resolveTargetOptions(target, newOptions);\n        if (!options) {\n            return [];\n        }\n        const animations = this._createAnimations(options, newOptions);\n        if (newOptions.$shared) {\n            awaitAll(target.options.$animations, newOptions).then(()=>{\n                target.options = newOptions;\n            }, ()=>{\n            });\n        }\n        return animations;\n    }\n _createAnimations(target, values) {\n        const animatedProps = this._properties;\n        const animations = [];\n        const running = target.$animations || (target.$animations = {});\n        const props = Object.keys(values);\n        const date = Date.now();\n        let i;\n        for(i = props.length - 1; i >= 0; --i){\n            const prop = props[i];\n            if (prop.charAt(0) === '$') {\n                continue;\n            }\n            if (prop === 'options') {\n                animations.push(...this._animateOptions(target, values));\n                continue;\n            }\n            const value = values[prop];\n            let animation = running[prop];\n            const cfg = animatedProps.get(prop);\n            if (animation) {\n                if (cfg && animation.active()) {\n                    animation.update(cfg, value, date);\n                    continue;\n                } else {\n                    animation.cancel();\n                }\n            }\n            if (!cfg || !cfg.duration) {\n                target[prop] = value;\n                continue;\n            }\n            running[prop] = animation = new Animation(cfg, target, prop, value);\n            animations.push(animation);\n        }\n        return animations;\n    }\n update(target, values) {\n        if (this._properties.size === 0) {\n            Object.assign(target, values);\n            return;\n        }\n        const animations = this._createAnimations(target, values);\n        if (animations.length) {\n            animator.add(this._chart, animations);\n            return true;\n        }\n    }\n}\nfunction awaitAll(animations, properties) {\n    const running = [];\n    const keys = Object.keys(properties);\n    for(let i = 0; i < keys.length; i++){\n        const anim = animations[keys[i]];\n        if (anim && anim.active()) {\n            running.push(anim.wait());\n        }\n    }\n    return Promise.all(running);\n}\nfunction resolveTargetOptions(target, newOptions) {\n    if (!newOptions) {\n        return;\n    }\n    let options = target.options;\n    if (!options) {\n        target.options = newOptions;\n        return;\n    }\n    if (options.$shared) {\n        target.options = options = Object.assign({}, options, {\n            $shared: false,\n            $animations: {}\n        });\n    }\n    return options;\n}\n\nfunction scaleClip(scale, allowedOverflow) {\n    const opts = scale && scale.options || {};\n    const reverse = opts.reverse;\n    const min = opts.min === undefined ? allowedOverflow : 0;\n    const max = opts.max === undefined ? allowedOverflow : 0;\n    return {\n        start: reverse ? max : min,\n        end: reverse ? min : max\n    };\n}\nfunction defaultClip(xScale, yScale, allowedOverflow) {\n    if (allowedOverflow === false) {\n        return false;\n    }\n    const x = scaleClip(xScale, allowedOverflow);\n    const y = scaleClip(yScale, allowedOverflow);\n    return {\n        top: y.end,\n        right: x.end,\n        bottom: y.start,\n        left: x.start\n    };\n}\nfunction toClip(value) {\n    let t, r, b, l;\n    if (isObject(value)) {\n        t = value.top;\n        r = value.right;\n        b = value.bottom;\n        l = value.left;\n    } else {\n        t = r = b = l = value;\n    }\n    return {\n        top: t,\n        right: r,\n        bottom: b,\n        left: l,\n        disabled: value === false\n    };\n}\nfunction getSortedDatasetIndices(chart, filterVisible) {\n    const keys = [];\n    const metasets = chart._getSortedDatasetMetas(filterVisible);\n    let i, ilen;\n    for(i = 0, ilen = metasets.length; i < ilen; ++i){\n        keys.push(metasets[i].index);\n    }\n    return keys;\n}\nfunction applyStack(stack, value, dsIndex, options = {}) {\n    const keys = stack.keys;\n    const singleMode = options.mode === 'single';\n    let i, ilen, datasetIndex, otherValue;\n    if (value === null) {\n        return;\n    }\n    let found = false;\n    for(i = 0, ilen = keys.length; i < ilen; ++i){\n        datasetIndex = +keys[i];\n        if (datasetIndex === dsIndex) {\n            found = true;\n            if (options.all) {\n                continue;\n            }\n            break;\n        }\n        otherValue = stack.values[datasetIndex];\n        if (isNumberFinite(otherValue) && (singleMode || value === 0 || sign(value) === sign(otherValue))) {\n            value += otherValue;\n        }\n    }\n    if (!found && !options.all) {\n        return 0;\n    }\n    return value;\n}\nfunction convertObjectDataToArray(data, meta) {\n    const { iScale , vScale  } = meta;\n    const iAxisKey = iScale.axis === 'x' ? 'x' : 'y';\n    const vAxisKey = vScale.axis === 'x' ? 'x' : 'y';\n    const keys = Object.keys(data);\n    const adata = new Array(keys.length);\n    let i, ilen, key;\n    for(i = 0, ilen = keys.length; i < ilen; ++i){\n        key = keys[i];\n        adata[i] = {\n            [iAxisKey]: key,\n            [vAxisKey]: data[key]\n        };\n    }\n    return adata;\n}\nfunction isStacked(scale, meta) {\n    const stacked = scale && scale.options.stacked;\n    return stacked || stacked === undefined && meta.stack !== undefined;\n}\nfunction getStackKey(indexScale, valueScale, meta) {\n    return `${indexScale.id}.${valueScale.id}.${meta.stack || meta.type}`;\n}\nfunction getUserBounds(scale) {\n    const { min , max , minDefined , maxDefined  } = scale.getUserBounds();\n    return {\n        min: minDefined ? min : Number.NEGATIVE_INFINITY,\n        max: maxDefined ? max : Number.POSITIVE_INFINITY\n    };\n}\nfunction getOrCreateStack(stacks, stackKey, indexValue) {\n    const subStack = stacks[stackKey] || (stacks[stackKey] = {});\n    return subStack[indexValue] || (subStack[indexValue] = {});\n}\nfunction getLastIndexInStack(stack, vScale, positive, type) {\n    for (const meta of vScale.getMatchingVisibleMetas(type).reverse()){\n        const value = stack[meta.index];\n        if (positive && value > 0 || !positive && value < 0) {\n            return meta.index;\n        }\n    }\n    return null;\n}\nfunction updateStacks(controller, parsed) {\n    const { chart , _cachedMeta: meta  } = controller;\n    const stacks = chart._stacks || (chart._stacks = {});\n    const { iScale , vScale , index: datasetIndex  } = meta;\n    const iAxis = iScale.axis;\n    const vAxis = vScale.axis;\n    const key = getStackKey(iScale, vScale, meta);\n    const ilen = parsed.length;\n    let stack;\n    for(let i = 0; i < ilen; ++i){\n        const item = parsed[i];\n        const { [iAxis]: index , [vAxis]: value  } = item;\n        const itemStacks = item._stacks || (item._stacks = {});\n        stack = itemStacks[vAxis] = getOrCreateStack(stacks, key, index);\n        stack[datasetIndex] = value;\n        stack._top = getLastIndexInStack(stack, vScale, true, meta.type);\n        stack._bottom = getLastIndexInStack(stack, vScale, false, meta.type);\n        const visualValues = stack._visualValues || (stack._visualValues = {});\n        visualValues[datasetIndex] = value;\n    }\n}\nfunction getFirstScaleId(chart, axis) {\n    const scales = chart.scales;\n    return Object.keys(scales).filter((key)=>scales[key].axis === axis).shift();\n}\nfunction createDatasetContext(parent, index) {\n    return createContext(parent, {\n        active: false,\n        dataset: undefined,\n        datasetIndex: index,\n        index,\n        mode: 'default',\n        type: 'dataset'\n    });\n}\nfunction createDataContext(parent, index, element) {\n    return createContext(parent, {\n        active: false,\n        dataIndex: index,\n        parsed: undefined,\n        raw: undefined,\n        element,\n        index,\n        mode: 'default',\n        type: 'data'\n    });\n}\nfunction clearStacks(meta, items) {\n    const datasetIndex = meta.controller.index;\n    const axis = meta.vScale && meta.vScale.axis;\n    if (!axis) {\n        return;\n    }\n    items = items || meta._parsed;\n    for (const parsed of items){\n        const stacks = parsed._stacks;\n        if (!stacks || stacks[axis] === undefined || stacks[axis][datasetIndex] === undefined) {\n            return;\n        }\n        delete stacks[axis][datasetIndex];\n        if (stacks[axis]._visualValues !== undefined && stacks[axis]._visualValues[datasetIndex] !== undefined) {\n            delete stacks[axis]._visualValues[datasetIndex];\n        }\n    }\n}\nconst isDirectUpdateMode = (mode)=>mode === 'reset' || mode === 'none';\nconst cloneIfNotShared = (cached, shared)=>shared ? cached : Object.assign({}, cached);\nconst createStack = (canStack, meta, chart)=>canStack && !meta.hidden && meta._stacked && {\n        keys: getSortedDatasetIndices(chart, true),\n        values: null\n    };\nclass DatasetController {\n static defaults = {};\n static datasetElementType = null;\n static dataElementType = null;\n constructor(chart, datasetIndex){\n        this.chart = chart;\n        this._ctx = chart.ctx;\n        this.index = datasetIndex;\n        this._cachedDataOpts = {};\n        this._cachedMeta = this.getMeta();\n        this._type = this._cachedMeta.type;\n        this.options = undefined;\n         this._parsing = false;\n        this._data = undefined;\n        this._objectData = undefined;\n        this._sharedOptions = undefined;\n        this._drawStart = undefined;\n        this._drawCount = undefined;\n        this.enableOptionSharing = false;\n        this.supportsDecimation = false;\n        this.$context = undefined;\n        this._syncList = [];\n        this.datasetElementType = new.target.datasetElementType;\n        this.dataElementType = new.target.dataElementType;\n        this.initialize();\n    }\n    initialize() {\n        const meta = this._cachedMeta;\n        this.configure();\n        this.linkScales();\n        meta._stacked = isStacked(meta.vScale, meta);\n        this.addElements();\n        if (this.options.fill && !this.chart.isPluginEnabled('filler')) {\n            console.warn(\"Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options\");\n        }\n    }\n    updateIndex(datasetIndex) {\n        if (this.index !== datasetIndex) {\n            clearStacks(this._cachedMeta);\n        }\n        this.index = datasetIndex;\n    }\n    linkScales() {\n        const chart = this.chart;\n        const meta = this._cachedMeta;\n        const dataset = this.getDataset();\n        const chooseId = (axis, x, y, r)=>axis === 'x' ? x : axis === 'r' ? r : y;\n        const xid = meta.xAxisID = valueOrDefault(dataset.xAxisID, getFirstScaleId(chart, 'x'));\n        const yid = meta.yAxisID = valueOrDefault(dataset.yAxisID, getFirstScaleId(chart, 'y'));\n        const rid = meta.rAxisID = valueOrDefault(dataset.rAxisID, getFirstScaleId(chart, 'r'));\n        const indexAxis = meta.indexAxis;\n        const iid = meta.iAxisID = chooseId(indexAxis, xid, yid, rid);\n        const vid = meta.vAxisID = chooseId(indexAxis, yid, xid, rid);\n        meta.xScale = this.getScaleForId(xid);\n        meta.yScale = this.getScaleForId(yid);\n        meta.rScale = this.getScaleForId(rid);\n        meta.iScale = this.getScaleForId(iid);\n        meta.vScale = this.getScaleForId(vid);\n    }\n    getDataset() {\n        return this.chart.data.datasets[this.index];\n    }\n    getMeta() {\n        return this.chart.getDatasetMeta(this.index);\n    }\n getScaleForId(scaleID) {\n        return this.chart.scales[scaleID];\n    }\n _getOtherScale(scale) {\n        const meta = this._cachedMeta;\n        return scale === meta.iScale ? meta.vScale : meta.iScale;\n    }\n    reset() {\n        this._update('reset');\n    }\n _destroy() {\n        const meta = this._cachedMeta;\n        if (this._data) {\n            unlistenArrayEvents(this._data, this);\n        }\n        if (meta._stacked) {\n            clearStacks(meta);\n        }\n    }\n _dataCheck() {\n        const dataset = this.getDataset();\n        const data = dataset.data || (dataset.data = []);\n        const _data = this._data;\n        if (isObject(data)) {\n            const meta = this._cachedMeta;\n            this._data = convertObjectDataToArray(data, meta);\n        } else if (_data !== data) {\n            if (_data) {\n                unlistenArrayEvents(_data, this);\n                const meta = this._cachedMeta;\n                clearStacks(meta);\n                meta._parsed = [];\n            }\n            if (data && Object.isExtensible(data)) {\n                listenArrayEvents(data, this);\n            }\n            this._syncList = [];\n            this._data = data;\n        }\n    }\n    addElements() {\n        const meta = this._cachedMeta;\n        this._dataCheck();\n        if (this.datasetElementType) {\n            meta.dataset = new this.datasetElementType();\n        }\n    }\n    buildOrUpdateElements(resetNewElements) {\n        const meta = this._cachedMeta;\n        const dataset = this.getDataset();\n        let stackChanged = false;\n        this._dataCheck();\n        const oldStacked = meta._stacked;\n        meta._stacked = isStacked(meta.vScale, meta);\n        if (meta.stack !== dataset.stack) {\n            stackChanged = true;\n            clearStacks(meta);\n            meta.stack = dataset.stack;\n        }\n        this._resyncElements(resetNewElements);\n        if (stackChanged || oldStacked !== meta._stacked) {\n            updateStacks(this, meta._parsed);\n            meta._stacked = isStacked(meta.vScale, meta);\n        }\n    }\n configure() {\n        const config = this.chart.config;\n        const scopeKeys = config.datasetScopeKeys(this._type);\n        const scopes = config.getOptionScopes(this.getDataset(), scopeKeys, true);\n        this.options = config.createResolver(scopes, this.getContext());\n        this._parsing = this.options.parsing;\n        this._cachedDataOpts = {};\n    }\n parse(start, count) {\n        const { _cachedMeta: meta , _data: data  } = this;\n        const { iScale , _stacked  } = meta;\n        const iAxis = iScale.axis;\n        let sorted = start === 0 && count === data.length ? true : meta._sorted;\n        let prev = start > 0 && meta._parsed[start - 1];\n        let i, cur, parsed;\n        if (this._parsing === false) {\n            meta._parsed = data;\n            meta._sorted = true;\n            parsed = data;\n        } else {\n            if (isArray(data[start])) {\n                parsed = this.parseArrayData(meta, data, start, count);\n            } else if (isObject(data[start])) {\n                parsed = this.parseObjectData(meta, data, start, count);\n            } else {\n                parsed = this.parsePrimitiveData(meta, data, start, count);\n            }\n            const isNotInOrderComparedToPrev = ()=>cur[iAxis] === null || prev && cur[iAxis] < prev[iAxis];\n            for(i = 0; i < count; ++i){\n                meta._parsed[i + start] = cur = parsed[i];\n                if (sorted) {\n                    if (isNotInOrderComparedToPrev()) {\n                        sorted = false;\n                    }\n                    prev = cur;\n                }\n            }\n            meta._sorted = sorted;\n        }\n        if (_stacked) {\n            updateStacks(this, parsed);\n        }\n    }\n parsePrimitiveData(meta, data, start, count) {\n        const { iScale , vScale  } = meta;\n        const iAxis = iScale.axis;\n        const vAxis = vScale.axis;\n        const labels = iScale.getLabels();\n        const singleScale = iScale === vScale;\n        const parsed = new Array(count);\n        let i, ilen, index;\n        for(i = 0, ilen = count; i < ilen; ++i){\n            index = i + start;\n            parsed[i] = {\n                [iAxis]: singleScale || iScale.parse(labels[index], index),\n                [vAxis]: vScale.parse(data[index], index)\n            };\n        }\n        return parsed;\n    }\n parseArrayData(meta, data, start, count) {\n        const { xScale , yScale  } = meta;\n        const parsed = new Array(count);\n        let i, ilen, index, item;\n        for(i = 0, ilen = count; i < ilen; ++i){\n            index = i + start;\n            item = data[index];\n            parsed[i] = {\n                x: xScale.parse(item[0], index),\n                y: yScale.parse(item[1], index)\n            };\n        }\n        return parsed;\n    }\n parseObjectData(meta, data, start, count) {\n        const { xScale , yScale  } = meta;\n        const { xAxisKey ='x' , yAxisKey ='y'  } = this._parsing;\n        const parsed = new Array(count);\n        let i, ilen, index, item;\n        for(i = 0, ilen = count; i < ilen; ++i){\n            index = i + start;\n            item = data[index];\n            parsed[i] = {\n                x: xScale.parse(resolveObjectKey(item, xAxisKey), index),\n                y: yScale.parse(resolveObjectKey(item, yAxisKey), index)\n            };\n        }\n        return parsed;\n    }\n getParsed(index) {\n        return this._cachedMeta._parsed[index];\n    }\n getDataElement(index) {\n        return this._cachedMeta.data[index];\n    }\n applyStack(scale, parsed, mode) {\n        const chart = this.chart;\n        const meta = this._cachedMeta;\n        const value = parsed[scale.axis];\n        const stack = {\n            keys: getSortedDatasetIndices(chart, true),\n            values: parsed._stacks[scale.axis]._visualValues\n        };\n        return applyStack(stack, value, meta.index, {\n            mode\n        });\n    }\n updateRangeFromParsed(range, scale, parsed, stack) {\n        const parsedValue = parsed[scale.axis];\n        let value = parsedValue === null ? NaN : parsedValue;\n        const values = stack && parsed._stacks[scale.axis];\n        if (stack && values) {\n            stack.values = values;\n            value = applyStack(stack, parsedValue, this._cachedMeta.index);\n        }\n        range.min = Math.min(range.min, value);\n        range.max = Math.max(range.max, value);\n    }\n getMinMax(scale, canStack) {\n        const meta = this._cachedMeta;\n        const _parsed = meta._parsed;\n        const sorted = meta._sorted && scale === meta.iScale;\n        const ilen = _parsed.length;\n        const otherScale = this._getOtherScale(scale);\n        const stack = createStack(canStack, meta, this.chart);\n        const range = {\n            min: Number.POSITIVE_INFINITY,\n            max: Number.NEGATIVE_INFINITY\n        };\n        const { min: otherMin , max: otherMax  } = getUserBounds(otherScale);\n        let i, parsed;\n        function _skip() {\n            parsed = _parsed[i];\n            const otherValue = parsed[otherScale.axis];\n            return !isNumberFinite(parsed[scale.axis]) || otherMin > otherValue || otherMax < otherValue;\n        }\n        for(i = 0; i < ilen; ++i){\n            if (_skip()) {\n                continue;\n            }\n            this.updateRangeFromParsed(range, scale, parsed, stack);\n            if (sorted) {\n                break;\n            }\n        }\n        if (sorted) {\n            for(i = ilen - 1; i >= 0; --i){\n                if (_skip()) {\n                    continue;\n                }\n                this.updateRangeFromParsed(range, scale, parsed, stack);\n                break;\n            }\n        }\n        return range;\n    }\n    getAllParsedValues(scale) {\n        const parsed = this._cachedMeta._parsed;\n        const values = [];\n        let i, ilen, value;\n        for(i = 0, ilen = parsed.length; i < ilen; ++i){\n            value = parsed[i][scale.axis];\n            if (isNumberFinite(value)) {\n                values.push(value);\n            }\n        }\n        return values;\n    }\n getMaxOverflow() {\n        return false;\n    }\n getLabelAndValue(index) {\n        const meta = this._cachedMeta;\n        const iScale = meta.iScale;\n        const vScale = meta.vScale;\n        const parsed = this.getParsed(index);\n        return {\n            label: iScale ? '' + iScale.getLabelForValue(parsed[iScale.axis]) : '',\n            value: vScale ? '' + vScale.getLabelForValue(parsed[vScale.axis]) : ''\n        };\n    }\n _update(mode) {\n        const meta = this._cachedMeta;\n        this.update(mode || 'default');\n        meta._clip = toClip(valueOrDefault(this.options.clip, defaultClip(meta.xScale, meta.yScale, this.getMaxOverflow())));\n    }\n update(mode) {}\n    draw() {\n        const ctx = this._ctx;\n        const chart = this.chart;\n        const meta = this._cachedMeta;\n        const elements = meta.data || [];\n        const area = chart.chartArea;\n        const active = [];\n        const start = this._drawStart || 0;\n        const count = this._drawCount || elements.length - start;\n        const drawActiveElementsOnTop = this.options.drawActiveElementsOnTop;\n        let i;\n        if (meta.dataset) {\n            meta.dataset.draw(ctx, area, start, count);\n        }\n        for(i = start; i < start + count; ++i){\n            const element = elements[i];\n            if (element.hidden) {\n                continue;\n            }\n            if (element.active && drawActiveElementsOnTop) {\n                active.push(element);\n            } else {\n                element.draw(ctx, area);\n            }\n        }\n        for(i = 0; i < active.length; ++i){\n            active[i].draw(ctx, area);\n        }\n    }\n getStyle(index, active) {\n        const mode = active ? 'active' : 'default';\n        return index === undefined && this._cachedMeta.dataset ? this.resolveDatasetElementOptions(mode) : this.resolveDataElementOptions(index || 0, mode);\n    }\n getContext(index, active, mode) {\n        const dataset = this.getDataset();\n        let context;\n        if (index >= 0 && index < this._cachedMeta.data.length) {\n            const element = this._cachedMeta.data[index];\n            context = element.$context || (element.$context = createDataContext(this.getContext(), index, element));\n            context.parsed = this.getParsed(index);\n            context.raw = dataset.data[index];\n            context.index = context.dataIndex = index;\n        } else {\n            context = this.$context || (this.$context = createDatasetContext(this.chart.getContext(), this.index));\n            context.dataset = dataset;\n            context.index = context.datasetIndex = this.index;\n        }\n        context.active = !!active;\n        context.mode = mode;\n        return context;\n    }\n resolveDatasetElementOptions(mode) {\n        return this._resolveElementOptions(this.datasetElementType.id, mode);\n    }\n resolveDataElementOptions(index, mode) {\n        return this._resolveElementOptions(this.dataElementType.id, mode, index);\n    }\n _resolveElementOptions(elementType, mode = 'default', index) {\n        const active = mode === 'active';\n        const cache = this._cachedDataOpts;\n        const cacheKey = elementType + '-' + mode;\n        const cached = cache[cacheKey];\n        const sharing = this.enableOptionSharing && defined(index);\n        if (cached) {\n            return cloneIfNotShared(cached, sharing);\n        }\n        const config = this.chart.config;\n        const scopeKeys = config.datasetElementScopeKeys(this._type, elementType);\n        const prefixes = active ? [\n            `${elementType}Hover`,\n            'hover',\n            elementType,\n            ''\n        ] : [\n            elementType,\n            ''\n        ];\n        const scopes = config.getOptionScopes(this.getDataset(), scopeKeys);\n        const names = Object.keys(defaults.elements[elementType]);\n        const context = ()=>this.getContext(index, active, mode);\n        const values = config.resolveNamedOptions(scopes, names, context, prefixes);\n        if (values.$shared) {\n            values.$shared = sharing;\n            cache[cacheKey] = Object.freeze(cloneIfNotShared(values, sharing));\n        }\n        return values;\n    }\n _resolveAnimations(index, transition, active) {\n        const chart = this.chart;\n        const cache = this._cachedDataOpts;\n        const cacheKey = `animation-${transition}`;\n        const cached = cache[cacheKey];\n        if (cached) {\n            return cached;\n        }\n        let options;\n        if (chart.options.animation !== false) {\n            const config = this.chart.config;\n            const scopeKeys = config.datasetAnimationScopeKeys(this._type, transition);\n            const scopes = config.getOptionScopes(this.getDataset(), scopeKeys);\n            options = config.createResolver(scopes, this.getContext(index, active, transition));\n        }\n        const animations = new Animations(chart, options && options.animations);\n        if (options && options._cacheable) {\n            cache[cacheKey] = Object.freeze(animations);\n        }\n        return animations;\n    }\n getSharedOptions(options) {\n        if (!options.$shared) {\n            return;\n        }\n        return this._sharedOptions || (this._sharedOptions = Object.assign({}, options));\n    }\n includeOptions(mode, sharedOptions) {\n        return !sharedOptions || isDirectUpdateMode(mode) || this.chart._animationsDisabled;\n    }\n _getSharedOptions(start, mode) {\n        const firstOpts = this.resolveDataElementOptions(start, mode);\n        const previouslySharedOptions = this._sharedOptions;\n        const sharedOptions = this.getSharedOptions(firstOpts);\n        const includeOptions = this.includeOptions(mode, sharedOptions) || sharedOptions !== previouslySharedOptions;\n        this.updateSharedOptions(sharedOptions, mode, firstOpts);\n        return {\n            sharedOptions,\n            includeOptions\n        };\n    }\n updateElement(element, index, properties, mode) {\n        if (isDirectUpdateMode(mode)) {\n            Object.assign(element, properties);\n        } else {\n            this._resolveAnimations(index, mode).update(element, properties);\n        }\n    }\n updateSharedOptions(sharedOptions, mode, newOptions) {\n        if (sharedOptions && !isDirectUpdateMode(mode)) {\n            this._resolveAnimations(undefined, mode).update(sharedOptions, newOptions);\n        }\n    }\n _setStyle(element, index, mode, active) {\n        element.active = active;\n        const options = this.getStyle(index, active);\n        this._resolveAnimations(index, mode, active).update(element, {\n            options: !active && this.getSharedOptions(options) || options\n        });\n    }\n    removeHoverStyle(element, datasetIndex, index) {\n        this._setStyle(element, index, 'active', false);\n    }\n    setHoverStyle(element, datasetIndex, index) {\n        this._setStyle(element, index, 'active', true);\n    }\n _removeDatasetHoverStyle() {\n        const element = this._cachedMeta.dataset;\n        if (element) {\n            this._setStyle(element, undefined, 'active', false);\n        }\n    }\n _setDatasetHoverStyle() {\n        const element = this._cachedMeta.dataset;\n        if (element) {\n            this._setStyle(element, undefined, 'active', true);\n        }\n    }\n _resyncElements(resetNewElements) {\n        const data = this._data;\n        const elements = this._cachedMeta.data;\n        for (const [method, arg1, arg2] of this._syncList){\n            this[method](arg1, arg2);\n        }\n        this._syncList = [];\n        const numMeta = elements.length;\n        const numData = data.length;\n        const count = Math.min(numData, numMeta);\n        if (count) {\n            this.parse(0, count);\n        }\n        if (numData > numMeta) {\n            this._insertElements(numMeta, numData - numMeta, resetNewElements);\n        } else if (numData < numMeta) {\n            this._removeElements(numData, numMeta - numData);\n        }\n    }\n _insertElements(start, count, resetNewElements = true) {\n        const meta = this._cachedMeta;\n        const data = meta.data;\n        const end = start + count;\n        let i;\n        const move = (arr)=>{\n            arr.length += count;\n            for(i = arr.length - 1; i >= end; i--){\n                arr[i] = arr[i - count];\n            }\n        };\n        move(data);\n        for(i = start; i < end; ++i){\n            data[i] = new this.dataElementType();\n        }\n        if (this._parsing) {\n            move(meta._parsed);\n        }\n        this.parse(start, count);\n        if (resetNewElements) {\n            this.updateElements(data, start, count, 'reset');\n        }\n    }\n    updateElements(element, start, count, mode) {}\n _removeElements(start, count) {\n        const meta = this._cachedMeta;\n        if (this._parsing) {\n            const removed = meta._parsed.splice(start, count);\n            if (meta._stacked) {\n                clearStacks(meta, removed);\n            }\n        }\n        meta.data.splice(start, count);\n    }\n _sync(args) {\n        if (this._parsing) {\n            this._syncList.push(args);\n        } else {\n            const [method, arg1, arg2] = args;\n            this[method](arg1, arg2);\n        }\n        this.chart._dataChanges.push([\n            this.index,\n            ...args\n        ]);\n    }\n    _onDataPush() {\n        const count = arguments.length;\n        this._sync([\n            '_insertElements',\n            this.getDataset().data.length - count,\n            count\n        ]);\n    }\n    _onDataPop() {\n        this._sync([\n            '_removeElements',\n            this._cachedMeta.data.length - 1,\n            1\n        ]);\n    }\n    _onDataShift() {\n        this._sync([\n            '_removeElements',\n            0,\n            1\n        ]);\n    }\n    _onDataSplice(start, count) {\n        if (count) {\n            this._sync([\n                '_removeElements',\n                start,\n                count\n            ]);\n        }\n        const newCount = arguments.length - 2;\n        if (newCount) {\n            this._sync([\n                '_insertElements',\n                start,\n                newCount\n            ]);\n        }\n    }\n    _onDataUnshift() {\n        this._sync([\n            '_insertElements',\n            0,\n            arguments.length\n        ]);\n    }\n}\n\nfunction getAllScaleValues(scale, type) {\n    if (!scale._cache.$bar) {\n        const visibleMetas = scale.getMatchingVisibleMetas(type);\n        let values = [];\n        for(let i = 0, ilen = visibleMetas.length; i < ilen; i++){\n            values = values.concat(visibleMetas[i].controller.getAllParsedValues(scale));\n        }\n        scale._cache.$bar = _arrayUnique(values.sort((a, b)=>a - b));\n    }\n    return scale._cache.$bar;\n}\n function computeMinSampleSize(meta) {\n    const scale = meta.iScale;\n    const values = getAllScaleValues(scale, meta.type);\n    let min = scale._length;\n    let i, ilen, curr, prev;\n    const updateMinAndPrev = ()=>{\n        if (curr === 32767 || curr === -32768) {\n            return;\n        }\n        if (defined(prev)) {\n            min = Math.min(min, Math.abs(curr - prev) || min);\n        }\n        prev = curr;\n    };\n    for(i = 0, ilen = values.length; i < ilen; ++i){\n        curr = scale.getPixelForValue(values[i]);\n        updateMinAndPrev();\n    }\n    prev = undefined;\n    for(i = 0, ilen = scale.ticks.length; i < ilen; ++i){\n        curr = scale.getPixelForTick(i);\n        updateMinAndPrev();\n    }\n    return min;\n}\n function computeFitCategoryTraits(index, ruler, options, stackCount) {\n    const thickness = options.barThickness;\n    let size, ratio;\n    if (isNullOrUndef(thickness)) {\n        size = ruler.min * options.categoryPercentage;\n        ratio = options.barPercentage;\n    } else {\n        size = thickness * stackCount;\n        ratio = 1;\n    }\n    return {\n        chunk: size / stackCount,\n        ratio,\n        start: ruler.pixels[index] - size / 2\n    };\n}\n function computeFlexCategoryTraits(index, ruler, options, stackCount) {\n    const pixels = ruler.pixels;\n    const curr = pixels[index];\n    let prev = index > 0 ? pixels[index - 1] : null;\n    let next = index < pixels.length - 1 ? pixels[index + 1] : null;\n    const percent = options.categoryPercentage;\n    if (prev === null) {\n        prev = curr - (next === null ? ruler.end - ruler.start : next - curr);\n    }\n    if (next === null) {\n        next = curr + curr - prev;\n    }\n    const start = curr - (curr - Math.min(prev, next)) / 2 * percent;\n    const size = Math.abs(next - prev) / 2 * percent;\n    return {\n        chunk: size / stackCount,\n        ratio: options.barPercentage,\n        start\n    };\n}\nfunction parseFloatBar(entry, item, vScale, i) {\n    const startValue = vScale.parse(entry[0], i);\n    const endValue = vScale.parse(entry[1], i);\n    const min = Math.min(startValue, endValue);\n    const max = Math.max(startValue, endValue);\n    let barStart = min;\n    let barEnd = max;\n    if (Math.abs(min) > Math.abs(max)) {\n        barStart = max;\n        barEnd = min;\n    }\n    item[vScale.axis] = barEnd;\n    item._custom = {\n        barStart,\n        barEnd,\n        start: startValue,\n        end: endValue,\n        min,\n        max\n    };\n}\nfunction parseValue(entry, item, vScale, i) {\n    if (isArray(entry)) {\n        parseFloatBar(entry, item, vScale, i);\n    } else {\n        item[vScale.axis] = vScale.parse(entry, i);\n    }\n    return item;\n}\nfunction parseArrayOrPrimitive(meta, data, start, count) {\n    const iScale = meta.iScale;\n    const vScale = meta.vScale;\n    const labels = iScale.getLabels();\n    const singleScale = iScale === vScale;\n    const parsed = [];\n    let i, ilen, item, entry;\n    for(i = start, ilen = start + count; i < ilen; ++i){\n        entry = data[i];\n        item = {};\n        item[iScale.axis] = singleScale || iScale.parse(labels[i], i);\n        parsed.push(parseValue(entry, item, vScale, i));\n    }\n    return parsed;\n}\nfunction isFloatBar(custom) {\n    return custom && custom.barStart !== undefined && custom.barEnd !== undefined;\n}\nfunction barSign(size, vScale, actualBase) {\n    if (size !== 0) {\n        return sign(size);\n    }\n    return (vScale.isHorizontal() ? 1 : -1) * (vScale.min >= actualBase ? 1 : -1);\n}\nfunction borderProps(properties) {\n    let reverse, start, end, top, bottom;\n    if (properties.horizontal) {\n        reverse = properties.base > properties.x;\n        start = 'left';\n        end = 'right';\n    } else {\n        reverse = properties.base < properties.y;\n        start = 'bottom';\n        end = 'top';\n    }\n    if (reverse) {\n        top = 'end';\n        bottom = 'start';\n    } else {\n        top = 'start';\n        bottom = 'end';\n    }\n    return {\n        start,\n        end,\n        reverse,\n        top,\n        bottom\n    };\n}\nfunction setBorderSkipped(properties, options, stack, index) {\n    let edge = options.borderSkipped;\n    const res = {};\n    if (!edge) {\n        properties.borderSkipped = res;\n        return;\n    }\n    if (edge === true) {\n        properties.borderSkipped = {\n            top: true,\n            right: true,\n            bottom: true,\n            left: true\n        };\n        return;\n    }\n    const { start , end , reverse , top , bottom  } = borderProps(properties);\n    if (edge === 'middle' && stack) {\n        properties.enableBorderRadius = true;\n        if ((stack._top || 0) === index) {\n            edge = top;\n        } else if ((stack._bottom || 0) === index) {\n            edge = bottom;\n        } else {\n            res[parseEdge(bottom, start, end, reverse)] = true;\n            edge = top;\n        }\n    }\n    res[parseEdge(edge, start, end, reverse)] = true;\n    properties.borderSkipped = res;\n}\nfunction parseEdge(edge, a, b, reverse) {\n    if (reverse) {\n        edge = swap(edge, a, b);\n        edge = startEnd(edge, b, a);\n    } else {\n        edge = startEnd(edge, a, b);\n    }\n    return edge;\n}\nfunction swap(orig, v1, v2) {\n    return orig === v1 ? v2 : orig === v2 ? v1 : orig;\n}\nfunction startEnd(v, start, end) {\n    return v === 'start' ? start : v === 'end' ? end : v;\n}\nfunction setInflateAmount(properties, { inflateAmount  }, ratio) {\n    properties.inflateAmount = inflateAmount === 'auto' ? ratio === 1 ? 0.33 : 0 : inflateAmount;\n}\nclass BarController extends DatasetController {\n    static id = 'bar';\n static defaults = {\n        datasetElementType: false,\n        dataElementType: 'bar',\n        categoryPercentage: 0.8,\n        barPercentage: 0.9,\n        grouped: true,\n        animations: {\n            numbers: {\n                type: 'number',\n                properties: [\n                    'x',\n                    'y',\n                    'base',\n                    'width',\n                    'height'\n                ]\n            }\n        }\n    };\n static overrides = {\n        scales: {\n            _index_: {\n                type: 'category',\n                offset: true,\n                grid: {\n                    offset: true\n                }\n            },\n            _value_: {\n                type: 'linear',\n                beginAtZero: true\n            }\n        }\n    };\n parsePrimitiveData(meta, data, start, count) {\n        return parseArrayOrPrimitive(meta, data, start, count);\n    }\n parseArrayData(meta, data, start, count) {\n        return parseArrayOrPrimitive(meta, data, start, count);\n    }\n parseObjectData(meta, data, start, count) {\n        const { iScale , vScale  } = meta;\n        const { xAxisKey ='x' , yAxisKey ='y'  } = this._parsing;\n        const iAxisKey = iScale.axis === 'x' ? xAxisKey : yAxisKey;\n        const vAxisKey = vScale.axis === 'x' ? xAxisKey : yAxisKey;\n        const parsed = [];\n        let i, ilen, item, obj;\n        for(i = start, ilen = start + count; i < ilen; ++i){\n            obj = data[i];\n            item = {};\n            item[iScale.axis] = iScale.parse(resolveObjectKey(obj, iAxisKey), i);\n            parsed.push(parseValue(resolveObjectKey(obj, vAxisKey), item, vScale, i));\n        }\n        return parsed;\n    }\n updateRangeFromParsed(range, scale, parsed, stack) {\n        super.updateRangeFromParsed(range, scale, parsed, stack);\n        const custom = parsed._custom;\n        if (custom && scale === this._cachedMeta.vScale) {\n            range.min = Math.min(range.min, custom.min);\n            range.max = Math.max(range.max, custom.max);\n        }\n    }\n getMaxOverflow() {\n        return 0;\n    }\n getLabelAndValue(index) {\n        const meta = this._cachedMeta;\n        const { iScale , vScale  } = meta;\n        const parsed = this.getParsed(index);\n        const custom = parsed._custom;\n        const value = isFloatBar(custom) ? '[' + custom.start + ', ' + custom.end + ']' : '' + vScale.getLabelForValue(parsed[vScale.axis]);\n        return {\n            label: '' + iScale.getLabelForValue(parsed[iScale.axis]),\n            value\n        };\n    }\n    initialize() {\n        this.enableOptionSharing = true;\n        super.initialize();\n        const meta = this._cachedMeta;\n        meta.stack = this.getDataset().stack;\n    }\n    update(mode) {\n        const meta = this._cachedMeta;\n        this.updateElements(meta.data, 0, meta.data.length, mode);\n    }\n    updateElements(bars, start, count, mode) {\n        const reset = mode === 'reset';\n        const { index , _cachedMeta: { vScale  }  } = this;\n        const base = vScale.getBasePixel();\n        const horizontal = vScale.isHorizontal();\n        const ruler = this._getRuler();\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\n        for(let i = start; i < start + count; i++){\n            const parsed = this.getParsed(i);\n            const vpixels = reset || isNullOrUndef(parsed[vScale.axis]) ? {\n                base,\n                head: base\n            } : this._calculateBarValuePixels(i);\n            const ipixels = this._calculateBarIndexPixels(i, ruler);\n            const stack = (parsed._stacks || {})[vScale.axis];\n            const properties = {\n                horizontal,\n                base: vpixels.base,\n                enableBorderRadius: !stack || isFloatBar(parsed._custom) || index === stack._top || index === stack._bottom,\n                x: horizontal ? vpixels.head : ipixels.center,\n                y: horizontal ? ipixels.center : vpixels.head,\n                height: horizontal ? ipixels.size : Math.abs(vpixels.size),\n                width: horizontal ? Math.abs(vpixels.size) : ipixels.size\n            };\n            if (includeOptions) {\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, bars[i].active ? 'active' : mode);\n            }\n            const options = properties.options || bars[i].options;\n            setBorderSkipped(properties, options, stack, index);\n            setInflateAmount(properties, options, ruler.ratio);\n            this.updateElement(bars[i], i, properties, mode);\n        }\n    }\n _getStacks(last, dataIndex) {\n        const { iScale  } = this._cachedMeta;\n        const metasets = iScale.getMatchingVisibleMetas(this._type).filter((meta)=>meta.controller.options.grouped);\n        const stacked = iScale.options.stacked;\n        const stacks = [];\n        const currentParsed = this._cachedMeta.controller.getParsed(dataIndex);\n        const iScaleValue = currentParsed && currentParsed[iScale.axis];\n        const skipNull = (meta)=>{\n            const parsed = meta._parsed.find((item)=>item[iScale.axis] === iScaleValue);\n            const val = parsed && parsed[meta.vScale.axis];\n            if (isNullOrUndef(val) || isNaN(val)) {\n                return true;\n            }\n        };\n        for (const meta of metasets){\n            if (dataIndex !== undefined && skipNull(meta)) {\n                continue;\n            }\n            if (stacked === false || stacks.indexOf(meta.stack) === -1 || stacked === undefined && meta.stack === undefined) {\n                stacks.push(meta.stack);\n            }\n            if (meta.index === last) {\n                break;\n            }\n        }\n        if (!stacks.length) {\n            stacks.push(undefined);\n        }\n        return stacks;\n    }\n _getStackCount(index) {\n        return this._getStacks(undefined, index).length;\n    }\n    _getAxisCount() {\n        return this._getAxis().length;\n    }\n    getFirstScaleIdForIndexAxis() {\n        const scales = this.chart.scales;\n        const indexScaleId = this.chart.options.indexAxis;\n        return Object.keys(scales).filter((key)=>scales[key].axis === indexScaleId).shift();\n    }\n    _getAxis() {\n        const axis = {};\n        const firstScaleAxisId = this.getFirstScaleIdForIndexAxis();\n        for (const dataset of this.chart.data.datasets){\n            axis[valueOrDefault(this.chart.options.indexAxis === 'x' ? dataset.xAxisID : dataset.yAxisID, firstScaleAxisId)] = true;\n        }\n        return Object.keys(axis);\n    }\n _getStackIndex(datasetIndex, name, dataIndex) {\n        const stacks = this._getStacks(datasetIndex, dataIndex);\n        const index = name !== undefined ? stacks.indexOf(name) : -1;\n        return index === -1 ? stacks.length - 1 : index;\n    }\n _getRuler() {\n        const opts = this.options;\n        const meta = this._cachedMeta;\n        const iScale = meta.iScale;\n        const pixels = [];\n        let i, ilen;\n        for(i = 0, ilen = meta.data.length; i < ilen; ++i){\n            pixels.push(iScale.getPixelForValue(this.getParsed(i)[iScale.axis], i));\n        }\n        const barThickness = opts.barThickness;\n        const min = barThickness || computeMinSampleSize(meta);\n        return {\n            min,\n            pixels,\n            start: iScale._startPixel,\n            end: iScale._endPixel,\n            stackCount: this._getStackCount(),\n            scale: iScale,\n            grouped: opts.grouped,\n            ratio: barThickness ? 1 : opts.categoryPercentage * opts.barPercentage\n        };\n    }\n _calculateBarValuePixels(index) {\n        const { _cachedMeta: { vScale , _stacked , index: datasetIndex  } , options: { base: baseValue , minBarLength  }  } = this;\n        const actualBase = baseValue || 0;\n        const parsed = this.getParsed(index);\n        const custom = parsed._custom;\n        const floating = isFloatBar(custom);\n        let value = parsed[vScale.axis];\n        let start = 0;\n        let length = _stacked ? this.applyStack(vScale, parsed, _stacked) : value;\n        let head, size;\n        if (length !== value) {\n            start = length - value;\n            length = value;\n        }\n        if (floating) {\n            value = custom.barStart;\n            length = custom.barEnd - custom.barStart;\n            if (value !== 0 && sign(value) !== sign(custom.barEnd)) {\n                start = 0;\n            }\n            start += value;\n        }\n        const startValue = !isNullOrUndef(baseValue) && !floating ? baseValue : start;\n        let base = vScale.getPixelForValue(startValue);\n        if (this.chart.getDataVisibility(index)) {\n            head = vScale.getPixelForValue(start + length);\n        } else {\n            head = base;\n        }\n        size = head - base;\n        if (Math.abs(size) < minBarLength) {\n            size = barSign(size, vScale, actualBase) * minBarLength;\n            if (value === actualBase) {\n                base -= size / 2;\n            }\n            const startPixel = vScale.getPixelForDecimal(0);\n            const endPixel = vScale.getPixelForDecimal(1);\n            const min = Math.min(startPixel, endPixel);\n            const max = Math.max(startPixel, endPixel);\n            base = Math.max(Math.min(base, max), min);\n            head = base + size;\n            if (_stacked && !floating) {\n                parsed._stacks[vScale.axis]._visualValues[datasetIndex] = vScale.getValueForPixel(head) - vScale.getValueForPixel(base);\n            }\n        }\n        if (base === vScale.getPixelForValue(actualBase)) {\n            const halfGrid = sign(size) * vScale.getLineWidthForValue(actualBase) / 2;\n            base += halfGrid;\n            size -= halfGrid;\n        }\n        return {\n            size,\n            base,\n            head,\n            center: head + size / 2\n        };\n    }\n _calculateBarIndexPixels(index, ruler) {\n        const scale = ruler.scale;\n        const options = this.options;\n        const skipNull = options.skipNull;\n        const maxBarThickness = valueOrDefault(options.maxBarThickness, Infinity);\n        let center, size;\n        const axisCount = this._getAxisCount();\n        if (ruler.grouped) {\n            const stackCount = skipNull ? this._getStackCount(index) : ruler.stackCount;\n            const range = options.barThickness === 'flex' ? computeFlexCategoryTraits(index, ruler, options, stackCount * axisCount) : computeFitCategoryTraits(index, ruler, options, stackCount * axisCount);\n            const axisID = this.chart.options.indexAxis === 'x' ? this.getDataset().xAxisID : this.getDataset().yAxisID;\n            const axisNumber = this._getAxis().indexOf(valueOrDefault(axisID, this.getFirstScaleIdForIndexAxis()));\n            const stackIndex = this._getStackIndex(this.index, this._cachedMeta.stack, skipNull ? index : undefined) + axisNumber;\n            center = range.start + range.chunk * stackIndex + range.chunk / 2;\n            size = Math.min(maxBarThickness, range.chunk * range.ratio);\n        } else {\n            center = scale.getPixelForValue(this.getParsed(index)[scale.axis], index);\n            size = Math.min(maxBarThickness, ruler.min * ruler.ratio);\n        }\n        return {\n            base: center - size / 2,\n            head: center + size / 2,\n            center,\n            size\n        };\n    }\n    draw() {\n        const meta = this._cachedMeta;\n        const vScale = meta.vScale;\n        const rects = meta.data;\n        const ilen = rects.length;\n        let i = 0;\n        for(; i < ilen; ++i){\n            if (this.getParsed(i)[vScale.axis] !== null && !rects[i].hidden) {\n                rects[i].draw(this._ctx);\n            }\n        }\n    }\n}\n\nclass BubbleController extends DatasetController {\n    static id = 'bubble';\n static defaults = {\n        datasetElementType: false,\n        dataElementType: 'point',\n        animations: {\n            numbers: {\n                type: 'number',\n                properties: [\n                    'x',\n                    'y',\n                    'borderWidth',\n                    'radius'\n                ]\n            }\n        }\n    };\n static overrides = {\n        scales: {\n            x: {\n                type: 'linear'\n            },\n            y: {\n                type: 'linear'\n            }\n        }\n    };\n    initialize() {\n        this.enableOptionSharing = true;\n        super.initialize();\n    }\n parsePrimitiveData(meta, data, start, count) {\n        const parsed = super.parsePrimitiveData(meta, data, start, count);\n        for(let i = 0; i < parsed.length; i++){\n            parsed[i]._custom = this.resolveDataElementOptions(i + start).radius;\n        }\n        return parsed;\n    }\n parseArrayData(meta, data, start, count) {\n        const parsed = super.parseArrayData(meta, data, start, count);\n        for(let i = 0; i < parsed.length; i++){\n            const item = data[start + i];\n            parsed[i]._custom = valueOrDefault(item[2], this.resolveDataElementOptions(i + start).radius);\n        }\n        return parsed;\n    }\n parseObjectData(meta, data, start, count) {\n        const parsed = super.parseObjectData(meta, data, start, count);\n        for(let i = 0; i < parsed.length; i++){\n            const item = data[start + i];\n            parsed[i]._custom = valueOrDefault(item && item.r && +item.r, this.resolveDataElementOptions(i + start).radius);\n        }\n        return parsed;\n    }\n getMaxOverflow() {\n        const data = this._cachedMeta.data;\n        let max = 0;\n        for(let i = data.length - 1; i >= 0; --i){\n            max = Math.max(max, data[i].size(this.resolveDataElementOptions(i)) / 2);\n        }\n        return max > 0 && max;\n    }\n getLabelAndValue(index) {\n        const meta = this._cachedMeta;\n        const labels = this.chart.data.labels || [];\n        const { xScale , yScale  } = meta;\n        const parsed = this.getParsed(index);\n        const x = xScale.getLabelForValue(parsed.x);\n        const y = yScale.getLabelForValue(parsed.y);\n        const r = parsed._custom;\n        return {\n            label: labels[index] || '',\n            value: '(' + x + ', ' + y + (r ? ', ' + r : '') + ')'\n        };\n    }\n    update(mode) {\n        const points = this._cachedMeta.data;\n        this.updateElements(points, 0, points.length, mode);\n    }\n    updateElements(points, start, count, mode) {\n        const reset = mode === 'reset';\n        const { iScale , vScale  } = this._cachedMeta;\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\n        const iAxis = iScale.axis;\n        const vAxis = vScale.axis;\n        for(let i = start; i < start + count; i++){\n            const point = points[i];\n            const parsed = !reset && this.getParsed(i);\n            const properties = {};\n            const iPixel = properties[iAxis] = reset ? iScale.getPixelForDecimal(0.5) : iScale.getPixelForValue(parsed[iAxis]);\n            const vPixel = properties[vAxis] = reset ? vScale.getBasePixel() : vScale.getPixelForValue(parsed[vAxis]);\n            properties.skip = isNaN(iPixel) || isNaN(vPixel);\n            if (includeOptions) {\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, point.active ? 'active' : mode);\n                if (reset) {\n                    properties.options.radius = 0;\n                }\n            }\n            this.updateElement(point, i, properties, mode);\n        }\n    }\n resolveDataElementOptions(index, mode) {\n        const parsed = this.getParsed(index);\n        let values = super.resolveDataElementOptions(index, mode);\n        if (values.$shared) {\n            values = Object.assign({}, values, {\n                $shared: false\n            });\n        }\n        const radius = values.radius;\n        if (mode !== 'active') {\n            values.radius = 0;\n        }\n        values.radius += valueOrDefault(parsed && parsed._custom, radius);\n        return values;\n    }\n}\n\nfunction getRatioAndOffset(rotation, circumference, cutout) {\n    let ratioX = 1;\n    let ratioY = 1;\n    let offsetX = 0;\n    let offsetY = 0;\n    if (circumference < TAU) {\n        const startAngle = rotation;\n        const endAngle = startAngle + circumference;\n        const startX = Math.cos(startAngle);\n        const startY = Math.sin(startAngle);\n        const endX = Math.cos(endAngle);\n        const endY = Math.sin(endAngle);\n        const calcMax = (angle, a, b)=>_angleBetween(angle, startAngle, endAngle, true) ? 1 : Math.max(a, a * cutout, b, b * cutout);\n        const calcMin = (angle, a, b)=>_angleBetween(angle, startAngle, endAngle, true) ? -1 : Math.min(a, a * cutout, b, b * cutout);\n        const maxX = calcMax(0, startX, endX);\n        const maxY = calcMax(HALF_PI, startY, endY);\n        const minX = calcMin(PI, startX, endX);\n        const minY = calcMin(PI + HALF_PI, startY, endY);\n        ratioX = (maxX - minX) / 2;\n        ratioY = (maxY - minY) / 2;\n        offsetX = -(maxX + minX) / 2;\n        offsetY = -(maxY + minY) / 2;\n    }\n    return {\n        ratioX,\n        ratioY,\n        offsetX,\n        offsetY\n    };\n}\nclass DoughnutController extends DatasetController {\n    static id = 'doughnut';\n static defaults = {\n        datasetElementType: false,\n        dataElementType: 'arc',\n        animation: {\n            animateRotate: true,\n            animateScale: false\n        },\n        animations: {\n            numbers: {\n                type: 'number',\n                properties: [\n                    'circumference',\n                    'endAngle',\n                    'innerRadius',\n                    'outerRadius',\n                    'startAngle',\n                    'x',\n                    'y',\n                    'offset',\n                    'borderWidth',\n                    'spacing'\n                ]\n            }\n        },\n        cutout: '50%',\n        rotation: 0,\n        circumference: 360,\n        radius: '100%',\n        spacing: 0,\n        indexAxis: 'r'\n    };\n    static descriptors = {\n        _scriptable: (name)=>name !== 'spacing',\n        _indexable: (name)=>name !== 'spacing' && !name.startsWith('borderDash') && !name.startsWith('hoverBorderDash')\n    };\n static overrides = {\n        aspectRatio: 1,\n        plugins: {\n            legend: {\n                labels: {\n                    generateLabels (chart) {\n                        const data = chart.data;\n                        const { labels: { pointStyle , textAlign , color , useBorderRadius , borderRadius  }  } = chart.legend.options;\n                        if (data.labels.length && data.datasets.length) {\n                            return data.labels.map((label, i)=>{\n                                const meta = chart.getDatasetMeta(0);\n                                const style = meta.controller.getStyle(i);\n                                return {\n                                    text: label,\n                                    fillStyle: style.backgroundColor,\n                                    fontColor: color,\n                                    hidden: !chart.getDataVisibility(i),\n                                    lineDash: style.borderDash,\n                                    lineDashOffset: style.borderDashOffset,\n                                    lineJoin: style.borderJoinStyle,\n                                    lineWidth: style.borderWidth,\n                                    strokeStyle: style.borderColor,\n                                    textAlign: textAlign,\n                                    pointStyle: pointStyle,\n                                    borderRadius: useBorderRadius && (borderRadius || style.borderRadius),\n                                    index: i\n                                };\n                            });\n                        }\n                        return [];\n                    }\n                },\n                onClick (e, legendItem, legend) {\n                    legend.chart.toggleDataVisibility(legendItem.index);\n                    legend.chart.update();\n                }\n            }\n        }\n    };\n    constructor(chart, datasetIndex){\n        super(chart, datasetIndex);\n        this.enableOptionSharing = true;\n        this.innerRadius = undefined;\n        this.outerRadius = undefined;\n        this.offsetX = undefined;\n        this.offsetY = undefined;\n    }\n    linkScales() {}\n parse(start, count) {\n        const data = this.getDataset().data;\n        const meta = this._cachedMeta;\n        if (this._parsing === false) {\n            meta._parsed = data;\n        } else {\n            let getter = (i)=>+data[i];\n            if (isObject(data[start])) {\n                const { key ='value'  } = this._parsing;\n                getter = (i)=>+resolveObjectKey(data[i], key);\n            }\n            let i, ilen;\n            for(i = start, ilen = start + count; i < ilen; ++i){\n                meta._parsed[i] = getter(i);\n            }\n        }\n    }\n _getRotation() {\n        return toRadians(this.options.rotation - 90);\n    }\n _getCircumference() {\n        return toRadians(this.options.circumference);\n    }\n _getRotationExtents() {\n        let min = TAU;\n        let max = -TAU;\n        for(let i = 0; i < this.chart.data.datasets.length; ++i){\n            if (this.chart.isDatasetVisible(i) && this.chart.getDatasetMeta(i).type === this._type) {\n                const controller = this.chart.getDatasetMeta(i).controller;\n                const rotation = controller._getRotation();\n                const circumference = controller._getCircumference();\n                min = Math.min(min, rotation);\n                max = Math.max(max, rotation + circumference);\n            }\n        }\n        return {\n            rotation: min,\n            circumference: max - min\n        };\n    }\n update(mode) {\n        const chart = this.chart;\n        const { chartArea  } = chart;\n        const meta = this._cachedMeta;\n        const arcs = meta.data;\n        const spacing = this.getMaxBorderWidth() + this.getMaxOffset(arcs) + this.options.spacing;\n        const maxSize = Math.max((Math.min(chartArea.width, chartArea.height) - spacing) / 2, 0);\n        const cutout = Math.min(toPercentage(this.options.cutout, maxSize), 1);\n        const chartWeight = this._getRingWeight(this.index);\n        const { circumference , rotation  } = this._getRotationExtents();\n        const { ratioX , ratioY , offsetX , offsetY  } = getRatioAndOffset(rotation, circumference, cutout);\n        const maxWidth = (chartArea.width - spacing) / ratioX;\n        const maxHeight = (chartArea.height - spacing) / ratioY;\n        const maxRadius = Math.max(Math.min(maxWidth, maxHeight) / 2, 0);\n        const outerRadius = toDimension(this.options.radius, maxRadius);\n        const innerRadius = Math.max(outerRadius * cutout, 0);\n        const radiusLength = (outerRadius - innerRadius) / this._getVisibleDatasetWeightTotal();\n        this.offsetX = offsetX * outerRadius;\n        this.offsetY = offsetY * outerRadius;\n        meta.total = this.calculateTotal();\n        this.outerRadius = outerRadius - radiusLength * this._getRingWeightOffset(this.index);\n        this.innerRadius = Math.max(this.outerRadius - radiusLength * chartWeight, 0);\n        this.updateElements(arcs, 0, arcs.length, mode);\n    }\n _circumference(i, reset) {\n        const opts = this.options;\n        const meta = this._cachedMeta;\n        const circumference = this._getCircumference();\n        if (reset && opts.animation.animateRotate || !this.chart.getDataVisibility(i) || meta._parsed[i] === null || meta.data[i].hidden) {\n            return 0;\n        }\n        return this.calculateCircumference(meta._parsed[i] * circumference / TAU);\n    }\n    updateElements(arcs, start, count, mode) {\n        const reset = mode === 'reset';\n        const chart = this.chart;\n        const chartArea = chart.chartArea;\n        const opts = chart.options;\n        const animationOpts = opts.animation;\n        const centerX = (chartArea.left + chartArea.right) / 2;\n        const centerY = (chartArea.top + chartArea.bottom) / 2;\n        const animateScale = reset && animationOpts.animateScale;\n        const innerRadius = animateScale ? 0 : this.innerRadius;\n        const outerRadius = animateScale ? 0 : this.outerRadius;\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\n        let startAngle = this._getRotation();\n        let i;\n        for(i = 0; i < start; ++i){\n            startAngle += this._circumference(i, reset);\n        }\n        for(i = start; i < start + count; ++i){\n            const circumference = this._circumference(i, reset);\n            const arc = arcs[i];\n            const properties = {\n                x: centerX + this.offsetX,\n                y: centerY + this.offsetY,\n                startAngle,\n                endAngle: startAngle + circumference,\n                circumference,\n                outerRadius,\n                innerRadius\n            };\n            if (includeOptions) {\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, arc.active ? 'active' : mode);\n            }\n            startAngle += circumference;\n            this.updateElement(arc, i, properties, mode);\n        }\n    }\n    calculateTotal() {\n        const meta = this._cachedMeta;\n        const metaData = meta.data;\n        let total = 0;\n        let i;\n        for(i = 0; i < metaData.length; i++){\n            const value = meta._parsed[i];\n            if (value !== null && !isNaN(value) && this.chart.getDataVisibility(i) && !metaData[i].hidden) {\n                total += Math.abs(value);\n            }\n        }\n        return total;\n    }\n    calculateCircumference(value) {\n        const total = this._cachedMeta.total;\n        if (total > 0 && !isNaN(value)) {\n            return TAU * (Math.abs(value) / total);\n        }\n        return 0;\n    }\n    getLabelAndValue(index) {\n        const meta = this._cachedMeta;\n        const chart = this.chart;\n        const labels = chart.data.labels || [];\n        const value = formatNumber(meta._parsed[index], chart.options.locale);\n        return {\n            label: labels[index] || '',\n            value\n        };\n    }\n    getMaxBorderWidth(arcs) {\n        let max = 0;\n        const chart = this.chart;\n        let i, ilen, meta, controller, options;\n        if (!arcs) {\n            for(i = 0, ilen = chart.data.datasets.length; i < ilen; ++i){\n                if (chart.isDatasetVisible(i)) {\n                    meta = chart.getDatasetMeta(i);\n                    arcs = meta.data;\n                    controller = meta.controller;\n                    break;\n                }\n            }\n        }\n        if (!arcs) {\n            return 0;\n        }\n        for(i = 0, ilen = arcs.length; i < ilen; ++i){\n            options = controller.resolveDataElementOptions(i);\n            if (options.borderAlign !== 'inner') {\n                max = Math.max(max, options.borderWidth || 0, options.hoverBorderWidth || 0);\n            }\n        }\n        return max;\n    }\n    getMaxOffset(arcs) {\n        let max = 0;\n        for(let i = 0, ilen = arcs.length; i < ilen; ++i){\n            const options = this.resolveDataElementOptions(i);\n            max = Math.max(max, options.offset || 0, options.hoverOffset || 0);\n        }\n        return max;\n    }\n _getRingWeightOffset(datasetIndex) {\n        let ringWeightOffset = 0;\n        for(let i = 0; i < datasetIndex; ++i){\n            if (this.chart.isDatasetVisible(i)) {\n                ringWeightOffset += this._getRingWeight(i);\n            }\n        }\n        return ringWeightOffset;\n    }\n _getRingWeight(datasetIndex) {\n        return Math.max(valueOrDefault(this.chart.data.datasets[datasetIndex].weight, 1), 0);\n    }\n _getVisibleDatasetWeightTotal() {\n        return this._getRingWeightOffset(this.chart.data.datasets.length) || 1;\n    }\n}\n\nclass LineController extends DatasetController {\n    static id = 'line';\n static defaults = {\n        datasetElementType: 'line',\n        dataElementType: 'point',\n        showLine: true,\n        spanGaps: false\n    };\n static overrides = {\n        scales: {\n            _index_: {\n                type: 'category'\n            },\n            _value_: {\n                type: 'linear'\n            }\n        }\n    };\n    initialize() {\n        this.enableOptionSharing = true;\n        this.supportsDecimation = true;\n        super.initialize();\n    }\n    update(mode) {\n        const meta = this._cachedMeta;\n        const { dataset: line , data: points = [] , _dataset  } = meta;\n        const animationsDisabled = this.chart._animationsDisabled;\n        let { start , count  } = _getStartAndCountOfVisiblePoints(meta, points, animationsDisabled);\n        this._drawStart = start;\n        this._drawCount = count;\n        if (_scaleRangesChanged(meta)) {\n            start = 0;\n            count = points.length;\n        }\n        line._chart = this.chart;\n        line._datasetIndex = this.index;\n        line._decimated = !!_dataset._decimated;\n        line.points = points;\n        const options = this.resolveDatasetElementOptions(mode);\n        if (!this.options.showLine) {\n            options.borderWidth = 0;\n        }\n        options.segment = this.options.segment;\n        this.updateElement(line, undefined, {\n            animated: !animationsDisabled,\n            options\n        }, mode);\n        this.updateElements(points, start, count, mode);\n    }\n    updateElements(points, start, count, mode) {\n        const reset = mode === 'reset';\n        const { iScale , vScale , _stacked , _dataset  } = this._cachedMeta;\n        const { sharedOptions , includeOptions  } = this._getSharedOptions(start, mode);\n        const iAxis = iScale.axis;\n        const vAxis = vScale.axis;\n        const { spanGaps , segment  } = this.options;\n        const maxGapLength = isNumber(spanGaps) ? spanGaps : Number.POSITIVE_INFINITY;\n        const directUpdate = this.chart._animationsDisabled || reset || mode === 'none';\n        const end = start + count;\n        const pointsCount = points.length;\n        let prevParsed = start > 0 && this.getParsed(start - 1);\n        for(let i = 0; i < pointsCount; ++i){\n            const point = points[i];\n            const properties = directUpdate ? point : {};\n            if (i < start || i >= end) {\n                properties.skip = true;\n                continue;\n            }\n            const parsed = this.getParsed(i);\n            const nullData = isNullOrUndef(parsed[vAxis]);\n            const iPixel = properties[iAxis] = iScale.getPixelForValue(parsed[iAxis], i);\n            const vPixel = properties[vAxis] = reset || nullData ? vScale.getBasePixel() : vScale.getPixelForValue(_stacked ? this.applyStack(vScale, parsed, _stacked) : parsed[vAxis], i);\n            properties.skip = isNaN(iPixel) || isNaN(vPixel) || nullData;\n            properties.stop = i > 0 && Math.abs(parsed[iAxis] - prevParsed[iAxis]) > maxGapLength;\n            if (segment) {\n                properties.parsed = parsed;\n                properties.raw = _dataset.data[i];\n            }\n            if (includeOptions) {\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, point.active ? 'active' : mode);\n            }\n            if (!directUpdate) {\n                this.updateElement(point, i, properties, mode);\n            }\n            prevParsed = parsed;\n        }\n    }\n getMaxOverflow() {\n        const meta = this._cachedMeta;\n        const dataset = meta.dataset;\n        const border = dataset.options && dataset.options.borderWidth || 0;\n        const data = meta.data || [];\n        if (!data.length) {\n            return border;\n        }\n        const firstPoint = data[0].size(this.resolveDataElementOptions(0));\n        const lastPoint = data[data.length - 1].size(this.resolveDataElementOptions(data.length - 1));\n        return Math.max(border, firstPoint, lastPoint) / 2;\n    }\n    draw() {\n        const meta = this._cachedMeta;\n        meta.dataset.updateControlPoints(this.chart.chartArea, meta.iScale.axis);\n        super.draw();\n    }\n}\n\nclass PolarAreaController extends DatasetController {\n    static id = 'polarArea';\n static defaults = {\n        dataElementType: 'arc',\n        animation: {\n            animateRotate: true,\n            animateScale: true\n        },\n        animations: {\n            numbers: {\n                type: 'number',\n                properties: [\n                    'x',\n                    'y',\n                    'startAngle',\n                    'endAngle',\n                    'innerRadius',\n                    'outerRadius'\n                ]\n            }\n        },\n        indexAxis: 'r',\n        startAngle: 0\n    };\n static overrides = {\n        aspectRatio: 1,\n        plugins: {\n            legend: {\n                labels: {\n                    generateLabels (chart) {\n                        const data = chart.data;\n                        if (data.labels.length && data.datasets.length) {\n                            const { labels: { pointStyle , color  }  } = chart.legend.options;\n                            return data.labels.map((label, i)=>{\n                                const meta = chart.getDatasetMeta(0);\n                                const style = meta.controller.getStyle(i);\n                                return {\n                                    text: label,\n                                    fillStyle: style.backgroundColor,\n                                    strokeStyle: style.borderColor,\n                                    fontColor: color,\n                                    lineWidth: style.borderWidth,\n                                    pointStyle: pointStyle,\n                                    hidden: !chart.getDataVisibility(i),\n                                    index: i\n                                };\n                            });\n                        }\n                        return [];\n                    }\n                },\n                onClick (e, legendItem, legend) {\n                    legend.chart.toggleDataVisibility(legendItem.index);\n                    legend.chart.update();\n                }\n            }\n        },\n        scales: {\n            r: {\n                type: 'radialLinear',\n                angleLines: {\n                    display: false\n                },\n                beginAtZero: true,\n                grid: {\n                    circular: true\n                },\n                pointLabels: {\n                    display: false\n                },\n                startAngle: 0\n            }\n        }\n    };\n    constructor(chart, datasetIndex){\n        super(chart, datasetIndex);\n        this.innerRadius = undefined;\n        this.outerRadius = undefined;\n    }\n    getLabelAndValue(index) {\n        const meta = this._cachedMeta;\n        const chart = this.chart;\n        const labels = chart.data.labels || [];\n        const value = formatNumber(meta._parsed[index].r, chart.options.locale);\n        return {\n            label: labels[index] || '',\n            value\n        };\n    }\n    parseObjectData(meta, data, start, count) {\n        return _parseObjectDataRadialScale.bind(this)(meta, data, start, count);\n    }\n    update(mode) {\n        const arcs = this._cachedMeta.data;\n        this._updateRadius();\n        this.updateElements(arcs, 0, arcs.length, mode);\n    }\n getMinMax() {\n        const meta = this._cachedMeta;\n        const range = {\n            min: Number.POSITIVE_INFINITY,\n            max: Number.NEGATIVE_INFINITY\n        };\n        meta.data.forEach((element, index)=>{\n            const parsed = this.getParsed(index).r;\n            if (!isNaN(parsed) && this.chart.getDataVisibility(index)) {\n                if (parsed < range.min) {\n                    range.min = parsed;\n                }\n                if (parsed > range.max) {\n                    range.max = parsed;\n                }\n            }\n        });\n        return range;\n    }\n _updateRadius() {\n        const chart = this.chart;\n        const chartArea = chart.chartArea;\n        const opts = chart.options;\n        const minSize = Math.min(chartArea.right - chartArea.left, chartArea.bottom - chartArea.top);\n        const outerRadius = Math.max(minSize / 2, 0);\n        const innerRadius = Math.max(opts.cutoutPercentage ? outerRadius / 100 * opts.cutoutPercentage : 1, 0);\n        const radiusLength = (outerRadius - innerRadius) / chart.getVisibleDatasetCount();\n        this.outerRadius = outerRadius - radiusLength * this.index;\n        this.innerRadius = this.outerRadius - radiusLength;\n    }\n    updateElements(arcs, start, count, mode) {\n        const reset = mode === 'reset';\n        const chart = this.chart;\n        const opts = chart.options;\n        const animationOpts = opts.animation;\n        const scale = this._cachedMeta.rScale;\n        const centerX = scale.xCenter;\n        const centerY = scale.yCenter;\n        const datasetStartAngle = scale.getIndexAngle(0) - 0.5 * PI;\n        let angle = datasetStartAngle;\n        let i;\n        const defaultAngle = 360 / this.countVisibleElements();\n        for(i = 0; i < start; ++i){\n            angle += this._computeAngle(i, mode, defaultAngle);\n        }\n        for(i = start; i < start + count; i++){\n            const arc = arcs[i];\n            let startAngle = angle;\n            let endAngle = angle + this._computeAngle(i, mode, defaultAngle);\n            let outerRadius = chart.getDataVisibility(i) ? scale.getDistanceFromCenterForValue(this.getParsed(i).r) : 0;\n            angle = endAngle;\n            if (reset) {\n                if (animationOpts.animateScale) {\n                    outerRadius = 0;\n                }\n                if (animationOpts.animateRotate) {\n                    startAngle = endAngle = datasetStartAngle;\n                }\n            }\n            const properties = {\n                x: centerX,\n                y: centerY,\n                innerRadius: 0,\n                outerRadius,\n                startAngle,\n                endAngle,\n                options: this.resolveDataElementOptions(i, arc.active ? 'active' : mode)\n            };\n            this.updateElement(arc, i, properties, mode);\n        }\n    }\n    countVisibleElements() {\n        const meta = this._cachedMeta;\n        let count = 0;\n        meta.data.forEach((element, index)=>{\n            if (!isNaN(this.getParsed(index).r) && this.chart.getDataVisibility(index)) {\n                count++;\n            }\n        });\n        return count;\n    }\n _computeAngle(index, mode, defaultAngle) {\n        return this.chart.getDataVisibility(index) ? toRadians(this.resolveDataElementOptions(index, mode).angle || defaultAngle) : 0;\n    }\n}\n\nclass PieController extends DoughnutController {\n    static id = 'pie';\n static defaults = {\n        cutout: 0,\n        rotation: 0,\n        circumference: 360,\n        radius: '100%'\n    };\n}\n\nclass RadarController extends DatasetController {\n    static id = 'radar';\n static defaults = {\n        datasetElementType: 'line',\n        dataElementType: 'point',\n        indexAxis: 'r',\n        showLine: true,\n        elements: {\n            line: {\n                fill: 'start'\n            }\n        }\n    };\n static overrides = {\n        aspectRatio: 1,\n        scales: {\n            r: {\n                type: 'radialLinear'\n            }\n        }\n    };\n getLabelAndValue(index) {\n        const vScale = this._cachedMeta.vScale;\n        const parsed = this.getParsed(index);\n        return {\n            label: vScale.getLabels()[index],\n            value: '' + vScale.getLabelForValue(parsed[vScale.axis])\n        };\n    }\n    parseObjectData(meta, data, start, count) {\n        return _parseObjectDataRadialScale.bind(this)(meta, data, start, count);\n    }\n    update(mode) {\n        const meta = this._cachedMeta;\n        const line = meta.dataset;\n        const points = meta.data || [];\n        const labels = meta.iScale.getLabels();\n        line.points = points;\n        if (mode !== 'resize') {\n            const options = this.resolveDatasetElementOptions(mode);\n            if (!this.options.showLine) {\n                options.borderWidth = 0;\n            }\n            const properties = {\n                _loop: true,\n                _fullLoop: labels.length === points.length,\n                options\n            };\n            this.updateElement(line, undefined, properties, mode);\n        }\n        this.updateElements(points, 0, points.length, mode);\n    }\n    updateElements(points, start, count, mode) {\n        const scale = this._cachedMeta.rScale;\n        const reset = mode === 'reset';\n        for(let i = start; i < start + count; i++){\n            const point = points[i];\n            const options = this.resolveDataElementOptions(i, point.active ? 'active' : mode);\n            const pointPosition = scale.getPointPositionForValue(i, this.getParsed(i).r);\n            const x = reset ? scale.xCenter : pointPosition.x;\n            const y = reset ? scale.yCenter : pointPosition.y;\n            const properties = {\n                x,\n                y,\n                angle: pointPosition.angle,\n                skip: isNaN(x) || isNaN(y),\n                options\n            };\n            this.updateElement(point, i, properties, mode);\n        }\n    }\n}\n\nclass ScatterController extends DatasetController {\n    static id = 'scatter';\n static defaults = {\n        datasetElementType: false,\n        dataElementType: 'point',\n        showLine: false,\n        fill: false\n    };\n static overrides = {\n        interaction: {\n            mode: 'point'\n        },\n        scales: {\n            x: {\n                type: 'linear'\n            },\n            y: {\n                type: 'linear'\n            }\n        }\n    };\n getLabelAndValue(index) {\n        const meta = this._cachedMeta;\n        const labels = this.chart.data.labels || [];\n        const { xScale , yScale  } = meta;\n        const parsed = this.getParsed(index);\n        const x = xScale.getLabelForValue(parsed.x);\n        const y = yScale.getLabelForValue(parsed.y);\n        return {\n            label: labels[index] || '',\n            value: '(' + x + ', ' + y + ')'\n        };\n    }\n    update(mode) {\n        const meta = this._cachedMeta;\n        const { data: points = []  } = meta;\n        const animationsDisabled = this.chart._animationsDisabled;\n        let { start , count  } = _getStartAndCountOfVisiblePoints(meta, points, animationsDisabled);\n        this._drawStart = start;\n        this._drawCount = count;\n        if (_scaleRangesChanged(meta)) {\n            start = 0;\n            count = points.length;\n        }\n        if (this.options.showLine) {\n            if (!this.datasetElementType) {\n                this.addElements();\n            }\n            const { dataset: line , _dataset  } = meta;\n            line._chart = this.chart;\n            line._datasetIndex = this.index;\n            line._decimated = !!_dataset._decimated;\n            line.points = points;\n            const options = this.resolveDatasetElementOptions(mode);\n            options.segment = this.options.segment;\n            this.updateElement(line, undefined, {\n                animated: !animationsDisabled,\n                options\n            }, mode);\n        } else if (this.datasetElementType) {\n            delete meta.dataset;\n            this.datasetElementType = false;\n        }\n        this.updateElements(points, start, count, mode);\n    }\n    addElements() {\n        const { showLine  } = this.options;\n        if (!this.datasetElementType && showLine) {\n            this.datasetElementType = this.chart.registry.getElement('line');\n        }\n        super.addElements();\n    }\n    updateElements(points, start, count, mode) {\n        const reset = mode === 'reset';\n        const { iScale , vScale , _stacked , _dataset  } = this._cachedMeta;\n        const firstOpts = this.resolveDataElementOptions(start, mode);\n        const sharedOptions = this.getSharedOptions(firstOpts);\n        const includeOptions = this.includeOptions(mode, sharedOptions);\n        const iAxis = iScale.axis;\n        const vAxis = vScale.axis;\n        const { spanGaps , segment  } = this.options;\n        const maxGapLength = isNumber(spanGaps) ? spanGaps : Number.POSITIVE_INFINITY;\n        const directUpdate = this.chart._animationsDisabled || reset || mode === 'none';\n        let prevParsed = start > 0 && this.getParsed(start - 1);\n        for(let i = start; i < start + count; ++i){\n            const point = points[i];\n            const parsed = this.getParsed(i);\n            const properties = directUpdate ? point : {};\n            const nullData = isNullOrUndef(parsed[vAxis]);\n            const iPixel = properties[iAxis] = iScale.getPixelForValue(parsed[iAxis], i);\n            const vPixel = properties[vAxis] = reset || nullData ? vScale.getBasePixel() : vScale.getPixelForValue(_stacked ? this.applyStack(vScale, parsed, _stacked) : parsed[vAxis], i);\n            properties.skip = isNaN(iPixel) || isNaN(vPixel) || nullData;\n            properties.stop = i > 0 && Math.abs(parsed[iAxis] - prevParsed[iAxis]) > maxGapLength;\n            if (segment) {\n                properties.parsed = parsed;\n                properties.raw = _dataset.data[i];\n            }\n            if (includeOptions) {\n                properties.options = sharedOptions || this.resolveDataElementOptions(i, point.active ? 'active' : mode);\n            }\n            if (!directUpdate) {\n                this.updateElement(point, i, properties, mode);\n            }\n            prevParsed = parsed;\n        }\n        this.updateSharedOptions(sharedOptions, mode, firstOpts);\n    }\n getMaxOverflow() {\n        const meta = this._cachedMeta;\n        const data = meta.data || [];\n        if (!this.options.showLine) {\n            let max = 0;\n            for(let i = data.length - 1; i >= 0; --i){\n                max = Math.max(max, data[i].size(this.resolveDataElementOptions(i)) / 2);\n            }\n            return max > 0 && max;\n        }\n        const dataset = meta.dataset;\n        const border = dataset.options && dataset.options.borderWidth || 0;\n        if (!data.length) {\n            return border;\n        }\n        const firstPoint = data[0].size(this.resolveDataElementOptions(0));\n        const lastPoint = data[data.length - 1].size(this.resolveDataElementOptions(data.length - 1));\n        return Math.max(border, firstPoint, lastPoint) / 2;\n    }\n}\n\nvar controllers = /*#__PURE__*/Object.freeze({\n__proto__: null,\nBarController: BarController,\nBubbleController: BubbleController,\nDoughnutController: DoughnutController,\nLineController: LineController,\nPieController: PieController,\nPolarAreaController: PolarAreaController,\nRadarController: RadarController,\nScatterController: ScatterController\n});\n\n/**\n * @namespace Chart._adapters\n * @since 2.8.0\n * @private\n */ function abstract() {\n    throw new Error('This method is not implemented: Check that a complete date adapter is provided.');\n}\n/**\n * Date adapter (current used by the time scale)\n * @namespace Chart._adapters._date\n * @memberof Chart._adapters\n * @private\n */ class DateAdapterBase {\n    /**\n   * Override default date adapter methods.\n   * Accepts type parameter to define options type.\n   * @example\n   * Chart._adapters._date.override<{myAdapterOption: string}>({\n   *   init() {\n   *     console.log(this.options.myAdapterOption);\n   *   }\n   * })\n   */ static override(members) {\n        Object.assign(DateAdapterBase.prototype, members);\n    }\n    options;\n    constructor(options){\n        this.options = options || {};\n    }\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    init() {}\n    formats() {\n        return abstract();\n    }\n    parse() {\n        return abstract();\n    }\n    format() {\n        return abstract();\n    }\n    add() {\n        return abstract();\n    }\n    diff() {\n        return abstract();\n    }\n    startOf() {\n        return abstract();\n    }\n    endOf() {\n        return abstract();\n    }\n}\nvar adapters = {\n    _date: DateAdapterBase\n};\n\nfunction binarySearch(metaset, axis, value, intersect) {\n    const { controller , data , _sorted  } = metaset;\n    const iScale = controller._cachedMeta.iScale;\n    const spanGaps = metaset.dataset ? metaset.dataset.options ? metaset.dataset.options.spanGaps : null : null;\n    if (iScale && axis === iScale.axis && axis !== 'r' && _sorted && data.length) {\n        const lookupMethod = iScale._reversePixels ? _rlookupByKey : _lookupByKey;\n        if (!intersect) {\n            const result = lookupMethod(data, axis, value);\n            if (spanGaps) {\n                const { vScale  } = controller._cachedMeta;\n                const { _parsed  } = metaset;\n                const distanceToDefinedLo = _parsed.slice(0, result.lo + 1).reverse().findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\n                result.lo -= Math.max(0, distanceToDefinedLo);\n                const distanceToDefinedHi = _parsed.slice(result.hi).findIndex((point)=>!isNullOrUndef(point[vScale.axis]));\n                result.hi += Math.max(0, distanceToDefinedHi);\n            }\n            return result;\n        } else if (controller._sharedOptions) {\n            const el = data[0];\n            const range = typeof el.getRange === 'function' && el.getRange(axis);\n            if (range) {\n                const start = lookupMethod(data, axis, value - range);\n                const end = lookupMethod(data, axis, value + range);\n                return {\n                    lo: start.lo,\n                    hi: end.hi\n                };\n            }\n        }\n    }\n    return {\n        lo: 0,\n        hi: data.length - 1\n    };\n}\n function evaluateInteractionItems(chart, axis, position, handler, intersect) {\n    const metasets = chart.getSortedVisibleDatasetMetas();\n    const value = position[axis];\n    for(let i = 0, ilen = metasets.length; i < ilen; ++i){\n        const { index , data  } = metasets[i];\n        const { lo , hi  } = binarySearch(metasets[i], axis, value, intersect);\n        for(let j = lo; j <= hi; ++j){\n            const element = data[j];\n            if (!element.skip) {\n                handler(element, index, j);\n            }\n        }\n    }\n}\n function getDistanceMetricForAxis(axis) {\n    const useX = axis.indexOf('x') !== -1;\n    const useY = axis.indexOf('y') !== -1;\n    return function(pt1, pt2) {\n        const deltaX = useX ? Math.abs(pt1.x - pt2.x) : 0;\n        const deltaY = useY ? Math.abs(pt1.y - pt2.y) : 0;\n        return Math.sqrt(Math.pow(deltaX, 2) + Math.pow(deltaY, 2));\n    };\n}\n function getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible) {\n    const items = [];\n    if (!includeInvisible && !chart.isPointInArea(position)) {\n        return items;\n    }\n    const evaluationFunc = function(element, datasetIndex, index) {\n        if (!includeInvisible && !_isPointInArea(element, chart.chartArea, 0)) {\n            return;\n        }\n        if (element.inRange(position.x, position.y, useFinalPosition)) {\n            items.push({\n                element,\n                datasetIndex,\n                index\n            });\n        }\n    };\n    evaluateInteractionItems(chart, axis, position, evaluationFunc, true);\n    return items;\n}\n function getNearestRadialItems(chart, position, axis, useFinalPosition) {\n    let items = [];\n    function evaluationFunc(element, datasetIndex, index) {\n        const { startAngle , endAngle  } = element.getProps([\n            'startAngle',\n            'endAngle'\n        ], useFinalPosition);\n        const { angle  } = getAngleFromPoint(element, {\n            x: position.x,\n            y: position.y\n        });\n        if (_angleBetween(angle, startAngle, endAngle)) {\n            items.push({\n                element,\n                datasetIndex,\n                index\n            });\n        }\n    }\n    evaluateInteractionItems(chart, axis, position, evaluationFunc);\n    return items;\n}\n function getNearestCartesianItems(chart, position, axis, intersect, useFinalPosition, includeInvisible) {\n    let items = [];\n    const distanceMetric = getDistanceMetricForAxis(axis);\n    let minDistance = Number.POSITIVE_INFINITY;\n    function evaluationFunc(element, datasetIndex, index) {\n        const inRange = element.inRange(position.x, position.y, useFinalPosition);\n        if (intersect && !inRange) {\n            return;\n        }\n        const center = element.getCenterPoint(useFinalPosition);\n        const pointInArea = !!includeInvisible || chart.isPointInArea(center);\n        if (!pointInArea && !inRange) {\n            return;\n        }\n        const distance = distanceMetric(position, center);\n        if (distance < minDistance) {\n            items = [\n                {\n                    element,\n                    datasetIndex,\n                    index\n                }\n            ];\n            minDistance = distance;\n        } else if (distance === minDistance) {\n            items.push({\n                element,\n                datasetIndex,\n                index\n            });\n        }\n    }\n    evaluateInteractionItems(chart, axis, position, evaluationFunc);\n    return items;\n}\n function getNearestItems(chart, position, axis, intersect, useFinalPosition, includeInvisible) {\n    if (!includeInvisible && !chart.isPointInArea(position)) {\n        return [];\n    }\n    return axis === 'r' && !intersect ? getNearestRadialItems(chart, position, axis, useFinalPosition) : getNearestCartesianItems(chart, position, axis, intersect, useFinalPosition, includeInvisible);\n}\n function getAxisItems(chart, position, axis, intersect, useFinalPosition) {\n    const items = [];\n    const rangeMethod = axis === 'x' ? 'inXRange' : 'inYRange';\n    let intersectsItem = false;\n    evaluateInteractionItems(chart, axis, position, (element, datasetIndex, index)=>{\n        if (element[rangeMethod] && element[rangeMethod](position[axis], useFinalPosition)) {\n            items.push({\n                element,\n                datasetIndex,\n                index\n            });\n            intersectsItem = intersectsItem || element.inRange(position.x, position.y, useFinalPosition);\n        }\n    });\n    if (intersect && !intersectsItem) {\n        return [];\n    }\n    return items;\n}\n var Interaction = {\n    evaluateInteractionItems,\n    modes: {\n index (chart, e, options, useFinalPosition) {\n            const position = getRelativePosition(e, chart);\n            const axis = options.axis || 'x';\n            const includeInvisible = options.includeInvisible || false;\n            const items = options.intersect ? getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible) : getNearestItems(chart, position, axis, false, useFinalPosition, includeInvisible);\n            const elements = [];\n            if (!items.length) {\n                return [];\n            }\n            chart.getSortedVisibleDatasetMetas().forEach((meta)=>{\n                const index = items[0].index;\n                const element = meta.data[index];\n                if (element && !element.skip) {\n                    elements.push({\n                        element,\n                        datasetIndex: meta.index,\n                        index\n                    });\n                }\n            });\n            return elements;\n        },\n dataset (chart, e, options, useFinalPosition) {\n            const position = getRelativePosition(e, chart);\n            const axis = options.axis || 'xy';\n            const includeInvisible = options.includeInvisible || false;\n            let items = options.intersect ? getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible) : getNearestItems(chart, position, axis, false, useFinalPosition, includeInvisible);\n            if (items.length > 0) {\n                const datasetIndex = items[0].datasetIndex;\n                const data = chart.getDatasetMeta(datasetIndex).data;\n                items = [];\n                for(let i = 0; i < data.length; ++i){\n                    items.push({\n                        element: data[i],\n                        datasetIndex,\n                        index: i\n                    });\n                }\n            }\n            return items;\n        },\n point (chart, e, options, useFinalPosition) {\n            const position = getRelativePosition(e, chart);\n            const axis = options.axis || 'xy';\n            const includeInvisible = options.includeInvisible || false;\n            return getIntersectItems(chart, position, axis, useFinalPosition, includeInvisible);\n        },\n nearest (chart, e, options, useFinalPosition) {\n            const position = getRelativePosition(e, chart);\n            const axis = options.axis || 'xy';\n            const includeInvisible = options.includeInvisible || false;\n            return getNearestItems(chart, position, axis, options.intersect, useFinalPosition, includeInvisible);\n        },\n x (chart, e, options, useFinalPosition) {\n            const position = getRelativePosition(e, chart);\n            return getAxisItems(chart, position, 'x', options.intersect, useFinalPosition);\n        },\n y (chart, e, options, useFinalPosition) {\n            const position = getRelativePosition(e, chart);\n            return getAxisItems(chart, position, 'y', options.intersect, useFinalPosition);\n        }\n    }\n};\n\nconst STATIC_POSITIONS = [\n    'left',\n    'top',\n    'right',\n    'bottom'\n];\nfunction filterByPosition(array, position) {\n    return array.filter((v)=>v.pos === position);\n}\nfunction filterDynamicPositionByAxis(array, axis) {\n    return array.filter((v)=>STATIC_POSITIONS.indexOf(v.pos) === -1 && v.box.axis === axis);\n}\nfunction sortByWeight(array, reverse) {\n    return array.sort((a, b)=>{\n        const v0 = reverse ? b : a;\n        const v1 = reverse ? a : b;\n        return v0.weight === v1.weight ? v0.index - v1.index : v0.weight - v1.weight;\n    });\n}\nfunction wrapBoxes(boxes) {\n    const layoutBoxes = [];\n    let i, ilen, box, pos, stack, stackWeight;\n    for(i = 0, ilen = (boxes || []).length; i < ilen; ++i){\n        box = boxes[i];\n        ({ position: pos , options: { stack , stackWeight =1  }  } = box);\n        layoutBoxes.push({\n            index: i,\n            box,\n            pos,\n            horizontal: box.isHorizontal(),\n            weight: box.weight,\n            stack: stack && pos + stack,\n            stackWeight\n        });\n    }\n    return layoutBoxes;\n}\nfunction buildStacks(layouts) {\n    const stacks = {};\n    for (const wrap of layouts){\n        const { stack , pos , stackWeight  } = wrap;\n        if (!stack || !STATIC_POSITIONS.includes(pos)) {\n            continue;\n        }\n        const _stack = stacks[stack] || (stacks[stack] = {\n            count: 0,\n            placed: 0,\n            weight: 0,\n            size: 0\n        });\n        _stack.count++;\n        _stack.weight += stackWeight;\n    }\n    return stacks;\n}\n function setLayoutDims(layouts, params) {\n    const stacks = buildStacks(layouts);\n    const { vBoxMaxWidth , hBoxMaxHeight  } = params;\n    let i, ilen, layout;\n    for(i = 0, ilen = layouts.length; i < ilen; ++i){\n        layout = layouts[i];\n        const { fullSize  } = layout.box;\n        const stack = stacks[layout.stack];\n        const factor = stack && layout.stackWeight / stack.weight;\n        if (layout.horizontal) {\n            layout.width = factor ? factor * vBoxMaxWidth : fullSize && params.availableWidth;\n            layout.height = hBoxMaxHeight;\n        } else {\n            layout.width = vBoxMaxWidth;\n            layout.height = factor ? factor * hBoxMaxHeight : fullSize && params.availableHeight;\n        }\n    }\n    return stacks;\n}\nfunction buildLayoutBoxes(boxes) {\n    const layoutBoxes = wrapBoxes(boxes);\n    const fullSize = sortByWeight(layoutBoxes.filter((wrap)=>wrap.box.fullSize), true);\n    const left = sortByWeight(filterByPosition(layoutBoxes, 'left'), true);\n    const right = sortByWeight(filterByPosition(layoutBoxes, 'right'));\n    const top = sortByWeight(filterByPosition(layoutBoxes, 'top'), true);\n    const bottom = sortByWeight(filterByPosition(layoutBoxes, 'bottom'));\n    const centerHorizontal = filterDynamicPositionByAxis(layoutBoxes, 'x');\n    const centerVertical = filterDynamicPositionByAxis(layoutBoxes, 'y');\n    return {\n        fullSize,\n        leftAndTop: left.concat(top),\n        rightAndBottom: right.concat(centerVertical).concat(bottom).concat(centerHorizontal),\n        chartArea: filterByPosition(layoutBoxes, 'chartArea'),\n        vertical: left.concat(right).concat(centerVertical),\n        horizontal: top.concat(bottom).concat(centerHorizontal)\n    };\n}\nfunction getCombinedMax(maxPadding, chartArea, a, b) {\n    return Math.max(maxPadding[a], chartArea[a]) + Math.max(maxPadding[b], chartArea[b]);\n}\nfunction updateMaxPadding(maxPadding, boxPadding) {\n    maxPadding.top = Math.max(maxPadding.top, boxPadding.top);\n    maxPadding.left = Math.max(maxPadding.left, boxPadding.left);\n    maxPadding.bottom = Math.max(maxPadding.bottom, boxPadding.bottom);\n    maxPadding.right = Math.max(maxPadding.right, boxPadding.right);\n}\nfunction updateDims(chartArea, params, layout, stacks) {\n    const { pos , box  } = layout;\n    const maxPadding = chartArea.maxPadding;\n    if (!isObject(pos)) {\n        if (layout.size) {\n            chartArea[pos] -= layout.size;\n        }\n        const stack = stacks[layout.stack] || {\n            size: 0,\n            count: 1\n        };\n        stack.size = Math.max(stack.size, layout.horizontal ? box.height : box.width);\n        layout.size = stack.size / stack.count;\n        chartArea[pos] += layout.size;\n    }\n    if (box.getPadding) {\n        updateMaxPadding(maxPadding, box.getPadding());\n    }\n    const newWidth = Math.max(0, params.outerWidth - getCombinedMax(maxPadding, chartArea, 'left', 'right'));\n    const newHeight = Math.max(0, params.outerHeight - getCombinedMax(maxPadding, chartArea, 'top', 'bottom'));\n    const widthChanged = newWidth !== chartArea.w;\n    const heightChanged = newHeight !== chartArea.h;\n    chartArea.w = newWidth;\n    chartArea.h = newHeight;\n    return layout.horizontal ? {\n        same: widthChanged,\n        other: heightChanged\n    } : {\n        same: heightChanged,\n        other: widthChanged\n    };\n}\nfunction handleMaxPadding(chartArea) {\n    const maxPadding = chartArea.maxPadding;\n    function updatePos(pos) {\n        const change = Math.max(maxPadding[pos] - chartArea[pos], 0);\n        chartArea[pos] += change;\n        return change;\n    }\n    chartArea.y += updatePos('top');\n    chartArea.x += updatePos('left');\n    updatePos('right');\n    updatePos('bottom');\n}\nfunction getMargins(horizontal, chartArea) {\n    const maxPadding = chartArea.maxPadding;\n    function marginForPositions(positions) {\n        const margin = {\n            left: 0,\n            top: 0,\n            right: 0,\n            bottom: 0\n        };\n        positions.forEach((pos)=>{\n            margin[pos] = Math.max(chartArea[pos], maxPadding[pos]);\n        });\n        return margin;\n    }\n    return horizontal ? marginForPositions([\n        'left',\n        'right'\n    ]) : marginForPositions([\n        'top',\n        'bottom'\n    ]);\n}\nfunction fitBoxes(boxes, chartArea, params, stacks) {\n    const refitBoxes = [];\n    let i, ilen, layout, box, refit, changed;\n    for(i = 0, ilen = boxes.length, refit = 0; i < ilen; ++i){\n        layout = boxes[i];\n        box = layout.box;\n        box.update(layout.width || chartArea.w, layout.height || chartArea.h, getMargins(layout.horizontal, chartArea));\n        const { same , other  } = updateDims(chartArea, params, layout, stacks);\n        refit |= same && refitBoxes.length;\n        changed = changed || other;\n        if (!box.fullSize) {\n            refitBoxes.push(layout);\n        }\n    }\n    return refit && fitBoxes(refitBoxes, chartArea, params, stacks) || changed;\n}\nfunction setBoxDims(box, left, top, width, height) {\n    box.top = top;\n    box.left = left;\n    box.right = left + width;\n    box.bottom = top + height;\n    box.width = width;\n    box.height = height;\n}\nfunction placeBoxes(boxes, chartArea, params, stacks) {\n    const userPadding = params.padding;\n    let { x , y  } = chartArea;\n    for (const layout of boxes){\n        const box = layout.box;\n        const stack = stacks[layout.stack] || {\n            count: 1,\n            placed: 0,\n            weight: 1\n        };\n        const weight = layout.stackWeight / stack.weight || 1;\n        if (layout.horizontal) {\n            const width = chartArea.w * weight;\n            const height = stack.size || box.height;\n            if (defined(stack.start)) {\n                y = stack.start;\n            }\n            if (box.fullSize) {\n                setBoxDims(box, userPadding.left, y, params.outerWidth - userPadding.right - userPadding.left, height);\n            } else {\n                setBoxDims(box, chartArea.left + stack.placed, y, width, height);\n            }\n            stack.start = y;\n            stack.placed += width;\n            y = box.bottom;\n        } else {\n            const height = chartArea.h * weight;\n            const width = stack.size || box.width;\n            if (defined(stack.start)) {\n                x = stack.start;\n            }\n            if (box.fullSize) {\n                setBoxDims(box, x, userPadding.top, width, params.outerHeight - userPadding.bottom - userPadding.top);\n            } else {\n                setBoxDims(box, x, chartArea.top + stack.placed, width, height);\n            }\n            stack.start = x;\n            stack.placed += height;\n            x = box.right;\n        }\n    }\n    chartArea.x = x;\n    chartArea.y = y;\n}\nvar layouts = {\n addBox (chart, item) {\n        if (!chart.boxes) {\n            chart.boxes = [];\n        }\n        item.fullSize = item.fullSize || false;\n        item.position = item.position || 'top';\n        item.weight = item.weight || 0;\n        item._layers = item._layers || function() {\n            return [\n                {\n                    z: 0,\n                    draw (chartArea) {\n                        item.draw(chartArea);\n                    }\n                }\n            ];\n        };\n        chart.boxes.push(item);\n    },\n removeBox (chart, layoutItem) {\n        const index = chart.boxes ? chart.boxes.indexOf(layoutItem) : -1;\n        if (index !== -1) {\n            chart.boxes.splice(index, 1);\n        }\n    },\n configure (chart, item, options) {\n        item.fullSize = options.fullSize;\n        item.position = options.position;\n        item.weight = options.weight;\n    },\n update (chart, width, height, minPadding) {\n        if (!chart) {\n            return;\n        }\n        const padding = toPadding(chart.options.layout.padding);\n        const availableWidth = Math.max(width - padding.width, 0);\n        const availableHeight = Math.max(height - padding.height, 0);\n        const boxes = buildLayoutBoxes(chart.boxes);\n        const verticalBoxes = boxes.vertical;\n        const horizontalBoxes = boxes.horizontal;\n        each(chart.boxes, (box)=>{\n            if (typeof box.beforeLayout === 'function') {\n                box.beforeLayout();\n            }\n        });\n        const visibleVerticalBoxCount = verticalBoxes.reduce((total, wrap)=>wrap.box.options && wrap.box.options.display === false ? total : total + 1, 0) || 1;\n        const params = Object.freeze({\n            outerWidth: width,\n            outerHeight: height,\n            padding,\n            availableWidth,\n            availableHeight,\n            vBoxMaxWidth: availableWidth / 2 / visibleVerticalBoxCount,\n            hBoxMaxHeight: availableHeight / 2\n        });\n        const maxPadding = Object.assign({}, padding);\n        updateMaxPadding(maxPadding, toPadding(minPadding));\n        const chartArea = Object.assign({\n            maxPadding,\n            w: availableWidth,\n            h: availableHeight,\n            x: padding.left,\n            y: padding.top\n        }, padding);\n        const stacks = setLayoutDims(verticalBoxes.concat(horizontalBoxes), params);\n        fitBoxes(boxes.fullSize, chartArea, params, stacks);\n        fitBoxes(verticalBoxes, chartArea, params, stacks);\n        if (fitBoxes(horizontalBoxes, chartArea, params, stacks)) {\n            fitBoxes(verticalBoxes, chartArea, params, stacks);\n        }\n        handleMaxPadding(chartArea);\n        placeBoxes(boxes.leftAndTop, chartArea, params, stacks);\n        chartArea.x += chartArea.w;\n        chartArea.y += chartArea.h;\n        placeBoxes(boxes.rightAndBottom, chartArea, params, stacks);\n        chart.chartArea = {\n            left: chartArea.left,\n            top: chartArea.top,\n            right: chartArea.left + chartArea.w,\n            bottom: chartArea.top + chartArea.h,\n            height: chartArea.h,\n            width: chartArea.w\n        };\n        each(boxes.chartArea, (layout)=>{\n            const box = layout.box;\n            Object.assign(box, chart.chartArea);\n            box.update(chartArea.w, chartArea.h, {\n                left: 0,\n                top: 0,\n                right: 0,\n                bottom: 0\n            });\n        });\n    }\n};\n\nclass BasePlatform {\n acquireContext(canvas, aspectRatio) {}\n releaseContext(context) {\n        return false;\n    }\n addEventListener(chart, type, listener) {}\n removeEventListener(chart, type, listener) {}\n getDevicePixelRatio() {\n        return 1;\n    }\n getMaximumSize(element, width, height, aspectRatio) {\n        width = Math.max(0, width || element.width);\n        height = height || element.height;\n        return {\n            width,\n            height: Math.max(0, aspectRatio ? Math.floor(width / aspectRatio) : height)\n        };\n    }\n isAttached(canvas) {\n        return true;\n    }\n updateConfig(config) {\n    }\n}\n\nclass BasicPlatform extends BasePlatform {\n    acquireContext(item) {\n        return item && item.getContext && item.getContext('2d') || null;\n    }\n    updateConfig(config) {\n        config.options.animation = false;\n    }\n}\n\nconst EXPANDO_KEY = '$chartjs';\n const EVENT_TYPES = {\n    touchstart: 'mousedown',\n    touchmove: 'mousemove',\n    touchend: 'mouseup',\n    pointerenter: 'mouseenter',\n    pointerdown: 'mousedown',\n    pointermove: 'mousemove',\n    pointerup: 'mouseup',\n    pointerleave: 'mouseout',\n    pointerout: 'mouseout'\n};\nconst isNullOrEmpty = (value)=>value === null || value === '';\n function initCanvas(canvas, aspectRatio) {\n    const style = canvas.style;\n    const renderHeight = canvas.getAttribute('height');\n    const renderWidth = canvas.getAttribute('width');\n    canvas[EXPANDO_KEY] = {\n        initial: {\n            height: renderHeight,\n            width: renderWidth,\n            style: {\n                display: style.display,\n                height: style.height,\n                width: style.width\n            }\n        }\n    };\n    style.display = style.display || 'block';\n    style.boxSizing = style.boxSizing || 'border-box';\n    if (isNullOrEmpty(renderWidth)) {\n        const displayWidth = readUsedSize(canvas, 'width');\n        if (displayWidth !== undefined) {\n            canvas.width = displayWidth;\n        }\n    }\n    if (isNullOrEmpty(renderHeight)) {\n        if (canvas.style.height === '') {\n            canvas.height = canvas.width / (aspectRatio || 2);\n        } else {\n            const displayHeight = readUsedSize(canvas, 'height');\n            if (displayHeight !== undefined) {\n                canvas.height = displayHeight;\n            }\n        }\n    }\n    return canvas;\n}\nconst eventListenerOptions = supportsEventListenerOptions ? {\n    passive: true\n} : false;\nfunction addListener(node, type, listener) {\n    if (node) {\n        node.addEventListener(type, listener, eventListenerOptions);\n    }\n}\nfunction removeListener(chart, type, listener) {\n    if (chart && chart.canvas) {\n        chart.canvas.removeEventListener(type, listener, eventListenerOptions);\n    }\n}\nfunction fromNativeEvent(event, chart) {\n    const type = EVENT_TYPES[event.type] || event.type;\n    const { x , y  } = getRelativePosition(event, chart);\n    return {\n        type,\n        chart,\n        native: event,\n        x: x !== undefined ? x : null,\n        y: y !== undefined ? y : null\n    };\n}\nfunction nodeListContains(nodeList, canvas) {\n    for (const node of nodeList){\n        if (node === canvas || node.contains(canvas)) {\n            return true;\n        }\n    }\n}\nfunction createAttachObserver(chart, type, listener) {\n    const canvas = chart.canvas;\n    const observer = new MutationObserver((entries)=>{\n        let trigger = false;\n        for (const entry of entries){\n            trigger = trigger || nodeListContains(entry.addedNodes, canvas);\n            trigger = trigger && !nodeListContains(entry.removedNodes, canvas);\n        }\n        if (trigger) {\n            listener();\n        }\n    });\n    observer.observe(document, {\n        childList: true,\n        subtree: true\n    });\n    return observer;\n}\nfunction createDetachObserver(chart, type, listener) {\n    const canvas = chart.canvas;\n    const observer = new MutationObserver((entries)=>{\n        let trigger = false;\n        for (const entry of entries){\n            trigger = trigger || nodeListContains(entry.removedNodes, canvas);\n            trigger = trigger && !nodeListContains(entry.addedNodes, canvas);\n        }\n        if (trigger) {\n            listener();\n        }\n    });\n    observer.observe(document, {\n        childList: true,\n        subtree: true\n    });\n    return observer;\n}\nconst drpListeningCharts = new Map();\nlet oldDevicePixelRatio = 0;\nfunction onWindowResize() {\n    const dpr = window.devicePixelRatio;\n    if (dpr === oldDevicePixelRatio) {\n        return;\n    }\n    oldDevicePixelRatio = dpr;\n    drpListeningCharts.forEach((resize, chart)=>{\n        if (chart.currentDevicePixelRatio !== dpr) {\n            resize();\n        }\n    });\n}\nfunction listenDevicePixelRatioChanges(chart, resize) {\n    if (!drpListeningCharts.size) {\n        window.addEventListener('resize', onWindowResize);\n    }\n    drpListeningCharts.set(chart, resize);\n}\nfunction unlistenDevicePixelRatioChanges(chart) {\n    drpListeningCharts.delete(chart);\n    if (!drpListeningCharts.size) {\n        window.removeEventListener('resize', onWindowResize);\n    }\n}\nfunction createResizeObserver(chart, type, listener) {\n    const canvas = chart.canvas;\n    const container = canvas && _getParentNode(canvas);\n    if (!container) {\n        return;\n    }\n    const resize = throttled((width, height)=>{\n        const w = container.clientWidth;\n        listener(width, height);\n        if (w < container.clientWidth) {\n            listener();\n        }\n    }, window);\n    const observer = new ResizeObserver((entries)=>{\n        const entry = entries[0];\n        const width = entry.contentRect.width;\n        const height = entry.contentRect.height;\n        if (width === 0 && height === 0) {\n            return;\n        }\n        resize(width, height);\n    });\n    observer.observe(container);\n    listenDevicePixelRatioChanges(chart, resize);\n    return observer;\n}\nfunction releaseObserver(chart, type, observer) {\n    if (observer) {\n        observer.disconnect();\n    }\n    if (type === 'resize') {\n        unlistenDevicePixelRatioChanges(chart);\n    }\n}\nfunction createProxyAndListen(chart, type, listener) {\n    const canvas = chart.canvas;\n    const proxy = throttled((event)=>{\n        if (chart.ctx !== null) {\n            listener(fromNativeEvent(event, chart));\n        }\n    }, chart);\n    addListener(canvas, type, proxy);\n    return proxy;\n}\n class DomPlatform extends BasePlatform {\n acquireContext(canvas, aspectRatio) {\n        const context = canvas && canvas.getContext && canvas.getContext('2d');\n        if (context && context.canvas === canvas) {\n            initCanvas(canvas, aspectRatio);\n            return context;\n        }\n        return null;\n    }\n releaseContext(context) {\n        const canvas = context.canvas;\n        if (!canvas[EXPANDO_KEY]) {\n            return false;\n        }\n        const initial = canvas[EXPANDO_KEY].initial;\n        [\n            'height',\n            'width'\n        ].forEach((prop)=>{\n            const value = initial[prop];\n            if (isNullOrUndef(value)) {\n                canvas.removeAttribute(prop);\n            } else {\n                canvas.setAttribute(prop, value);\n            }\n        });\n        const style = initial.style || {};\n        Object.keys(style).forEach((key)=>{\n            canvas.style[key] = style[key];\n        });\n        canvas.width = canvas.width;\n        delete canvas[EXPANDO_KEY];\n        return true;\n    }\n addEventListener(chart, type, listener) {\n        this.removeEventListener(chart, type);\n        const proxies = chart.$proxies || (chart.$proxies = {});\n        const handlers = {\n            attach: createAttachObserver,\n            detach: createDetachObserver,\n            resize: createResizeObserver\n        };\n        const handler = handlers[type] || createProxyAndListen;\n        proxies[type] = handler(chart, type, listener);\n    }\n removeEventListener(chart, type) {\n        const proxies = chart.$proxies || (chart.$proxies = {});\n        const proxy = proxies[type];\n        if (!proxy) {\n            return;\n        }\n        const handlers = {\n            attach: releaseObserver,\n            detach: releaseObserver,\n            resize: releaseObserver\n        };\n        const handler = handlers[type] || removeListener;\n        handler(chart, type, proxy);\n        proxies[type] = undefined;\n    }\n    getDevicePixelRatio() {\n        return window.devicePixelRatio;\n    }\n getMaximumSize(canvas, width, height, aspectRatio) {\n        return getMaximumSize(canvas, width, height, aspectRatio);\n    }\n isAttached(canvas) {\n        const container = canvas && _getParentNode(canvas);\n        return !!(container && container.isConnected);\n    }\n}\n\nfunction _detectPlatform(canvas) {\n    if (!_isDomSupported() || typeof OffscreenCanvas !== 'undefined' && canvas instanceof OffscreenCanvas) {\n        return BasicPlatform;\n    }\n    return DomPlatform;\n}\n\nclass Element {\n    static defaults = {};\n    static defaultRoutes = undefined;\n    x;\n    y;\n    active = false;\n    options;\n    $animations;\n    tooltipPosition(useFinalPosition) {\n        const { x , y  } = this.getProps([\n            'x',\n            'y'\n        ], useFinalPosition);\n        return {\n            x,\n            y\n        };\n    }\n    hasValue() {\n        return isNumber(this.x) && isNumber(this.y);\n    }\n    getProps(props, final) {\n        const anims = this.$animations;\n        if (!final || !anims) {\n            // let's not create an object, if not needed\n            return this;\n        }\n        const ret = {};\n        props.forEach((prop)=>{\n            ret[prop] = anims[prop] && anims[prop].active() ? anims[prop]._to : this[prop];\n        });\n        return ret;\n    }\n}\n\nfunction autoSkip(scale, ticks) {\n    const tickOpts = scale.options.ticks;\n    const determinedMaxTicks = determineMaxTicks(scale);\n    const ticksLimit = Math.min(tickOpts.maxTicksLimit || determinedMaxTicks, determinedMaxTicks);\n    const majorIndices = tickOpts.major.enabled ? getMajorIndices(ticks) : [];\n    const numMajorIndices = majorIndices.length;\n    const first = majorIndices[0];\n    const last = majorIndices[numMajorIndices - 1];\n    const newTicks = [];\n    if (numMajorIndices > ticksLimit) {\n        skipMajors(ticks, newTicks, majorIndices, numMajorIndices / ticksLimit);\n        return newTicks;\n    }\n    const spacing = calculateSpacing(majorIndices, ticks, ticksLimit);\n    if (numMajorIndices > 0) {\n        let i, ilen;\n        const avgMajorSpacing = numMajorIndices > 1 ? Math.round((last - first) / (numMajorIndices - 1)) : null;\n        skip(ticks, newTicks, spacing, isNullOrUndef(avgMajorSpacing) ? 0 : first - avgMajorSpacing, first);\n        for(i = 0, ilen = numMajorIndices - 1; i < ilen; i++){\n            skip(ticks, newTicks, spacing, majorIndices[i], majorIndices[i + 1]);\n        }\n        skip(ticks, newTicks, spacing, last, isNullOrUndef(avgMajorSpacing) ? ticks.length : last + avgMajorSpacing);\n        return newTicks;\n    }\n    skip(ticks, newTicks, spacing);\n    return newTicks;\n}\nfunction determineMaxTicks(scale) {\n    const offset = scale.options.offset;\n    const tickLength = scale._tickSize();\n    const maxScale = scale._length / tickLength + (offset ? 0 : 1);\n    const maxChart = scale._maxLength / tickLength;\n    return Math.floor(Math.min(maxScale, maxChart));\n}\n function calculateSpacing(majorIndices, ticks, ticksLimit) {\n    const evenMajorSpacing = getEvenSpacing(majorIndices);\n    const spacing = ticks.length / ticksLimit;\n    if (!evenMajorSpacing) {\n        return Math.max(spacing, 1);\n    }\n    const factors = _factorize(evenMajorSpacing);\n    for(let i = 0, ilen = factors.length - 1; i < ilen; i++){\n        const factor = factors[i];\n        if (factor > spacing) {\n            return factor;\n        }\n    }\n    return Math.max(spacing, 1);\n}\n function getMajorIndices(ticks) {\n    const result = [];\n    let i, ilen;\n    for(i = 0, ilen = ticks.length; i < ilen; i++){\n        if (ticks[i].major) {\n            result.push(i);\n        }\n    }\n    return result;\n}\n function skipMajors(ticks, newTicks, majorIndices, spacing) {\n    let count = 0;\n    let next = majorIndices[0];\n    let i;\n    spacing = Math.ceil(spacing);\n    for(i = 0; i < ticks.length; i++){\n        if (i === next) {\n            newTicks.push(ticks[i]);\n            count++;\n            next = majorIndices[count * spacing];\n        }\n    }\n}\n function skip(ticks, newTicks, spacing, majorStart, majorEnd) {\n    const start = valueOrDefault(majorStart, 0);\n    const end = Math.min(valueOrDefault(majorEnd, ticks.length), ticks.length);\n    let count = 0;\n    let length, i, next;\n    spacing = Math.ceil(spacing);\n    if (majorEnd) {\n        length = majorEnd - majorStart;\n        spacing = length / Math.floor(length / spacing);\n    }\n    next = start;\n    while(next < 0){\n        count++;\n        next = Math.round(start + count * spacing);\n    }\n    for(i = Math.max(start, 0); i < end; i++){\n        if (i === next) {\n            newTicks.push(ticks[i]);\n            count++;\n            next = Math.round(start + count * spacing);\n        }\n    }\n}\n function getEvenSpacing(arr) {\n    const len = arr.length;\n    let i, diff;\n    if (len < 2) {\n        return false;\n    }\n    for(diff = arr[0], i = 1; i < len; ++i){\n        if (arr[i] - arr[i - 1] !== diff) {\n            return false;\n        }\n    }\n    return diff;\n}\n\nconst reverseAlign = (align)=>align === 'left' ? 'right' : align === 'right' ? 'left' : align;\nconst offsetFromEdge = (scale, edge, offset)=>edge === 'top' || edge === 'left' ? scale[edge] + offset : scale[edge] - offset;\nconst getTicksLimit = (ticksLength, maxTicksLimit)=>Math.min(maxTicksLimit || ticksLength, ticksLength);\n function sample(arr, numItems) {\n    const result = [];\n    const increment = arr.length / numItems;\n    const len = arr.length;\n    let i = 0;\n    for(; i < len; i += increment){\n        result.push(arr[Math.floor(i)]);\n    }\n    return result;\n}\n function getPixelForGridLine(scale, index, offsetGridLines) {\n    const length = scale.ticks.length;\n    const validIndex = Math.min(index, length - 1);\n    const start = scale._startPixel;\n    const end = scale._endPixel;\n    const epsilon = 1e-6;\n    let lineValue = scale.getPixelForTick(validIndex);\n    let offset;\n    if (offsetGridLines) {\n        if (length === 1) {\n            offset = Math.max(lineValue - start, end - lineValue);\n        } else if (index === 0) {\n            offset = (scale.getPixelForTick(1) - lineValue) / 2;\n        } else {\n            offset = (lineValue - scale.getPixelForTick(validIndex - 1)) / 2;\n        }\n        lineValue += validIndex < index ? offset : -offset;\n        if (lineValue < start - epsilon || lineValue > end + epsilon) {\n            return;\n        }\n    }\n    return lineValue;\n}\n function garbageCollect(caches, length) {\n    each(caches, (cache)=>{\n        const gc = cache.gc;\n        const gcLen = gc.length / 2;\n        let i;\n        if (gcLen > length) {\n            for(i = 0; i < gcLen; ++i){\n                delete cache.data[gc[i]];\n            }\n            gc.splice(0, gcLen);\n        }\n    });\n}\n function getTickMarkLength(options) {\n    return options.drawTicks ? options.tickLength : 0;\n}\n function getTitleHeight(options, fallback) {\n    if (!options.display) {\n        return 0;\n    }\n    const font = toFont(options.font, fallback);\n    const padding = toPadding(options.padding);\n    const lines = isArray(options.text) ? options.text.length : 1;\n    return lines * font.lineHeight + padding.height;\n}\nfunction createScaleContext(parent, scale) {\n    return createContext(parent, {\n        scale,\n        type: 'scale'\n    });\n}\nfunction createTickContext(parent, index, tick) {\n    return createContext(parent, {\n        tick,\n        index,\n        type: 'tick'\n    });\n}\nfunction titleAlign(align, position, reverse) {\n     let ret = _toLeftRightCenter(align);\n    if (reverse && position !== 'right' || !reverse && position === 'right') {\n        ret = reverseAlign(ret);\n    }\n    return ret;\n}\nfunction titleArgs(scale, offset, position, align) {\n    const { top , left , bottom , right , chart  } = scale;\n    const { chartArea , scales  } = chart;\n    let rotation = 0;\n    let maxWidth, titleX, titleY;\n    const height = bottom - top;\n    const width = right - left;\n    if (scale.isHorizontal()) {\n        titleX = _alignStartEnd(align, left, right);\n        if (isObject(position)) {\n            const positionAxisID = Object.keys(position)[0];\n            const value = position[positionAxisID];\n            titleY = scales[positionAxisID].getPixelForValue(value) + height - offset;\n        } else if (position === 'center') {\n            titleY = (chartArea.bottom + chartArea.top) / 2 + height - offset;\n        } else {\n            titleY = offsetFromEdge(scale, position, offset);\n        }\n        maxWidth = right - left;\n    } else {\n        if (isObject(position)) {\n            const positionAxisID = Object.keys(position)[0];\n            const value = position[positionAxisID];\n            titleX = scales[positionAxisID].getPixelForValue(value) - width + offset;\n        } else if (position === 'center') {\n            titleX = (chartArea.left + chartArea.right) / 2 - width + offset;\n        } else {\n            titleX = offsetFromEdge(scale, position, offset);\n        }\n        titleY = _alignStartEnd(align, bottom, top);\n        rotation = position === 'left' ? -HALF_PI : HALF_PI;\n    }\n    return {\n        titleX,\n        titleY,\n        maxWidth,\n        rotation\n    };\n}\nclass Scale extends Element {\n    constructor(cfg){\n        super();\n         this.id = cfg.id;\n         this.type = cfg.type;\n         this.options = undefined;\n         this.ctx = cfg.ctx;\n         this.chart = cfg.chart;\n         this.top = undefined;\n         this.bottom = undefined;\n         this.left = undefined;\n         this.right = undefined;\n         this.width = undefined;\n         this.height = undefined;\n        this._margins = {\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0\n        };\n         this.maxWidth = undefined;\n         this.maxHeight = undefined;\n         this.paddingTop = undefined;\n         this.paddingBottom = undefined;\n         this.paddingLeft = undefined;\n         this.paddingRight = undefined;\n         this.axis = undefined;\n         this.labelRotation = undefined;\n        this.min = undefined;\n        this.max = undefined;\n        this._range = undefined;\n         this.ticks = [];\n         this._gridLineItems = null;\n         this._labelItems = null;\n         this._labelSizes = null;\n        this._length = 0;\n        this._maxLength = 0;\n        this._longestTextCache = {};\n         this._startPixel = undefined;\n         this._endPixel = undefined;\n        this._reversePixels = false;\n        this._userMax = undefined;\n        this._userMin = undefined;\n        this._suggestedMax = undefined;\n        this._suggestedMin = undefined;\n        this._ticksLength = 0;\n        this._borderValue = 0;\n        this._cache = {};\n        this._dataLimitsCached = false;\n        this.$context = undefined;\n    }\n init(options) {\n        this.options = options.setContext(this.getContext());\n        this.axis = options.axis;\n        this._userMin = this.parse(options.min);\n        this._userMax = this.parse(options.max);\n        this._suggestedMin = this.parse(options.suggestedMin);\n        this._suggestedMax = this.parse(options.suggestedMax);\n    }\n parse(raw, index) {\n        return raw;\n    }\n getUserBounds() {\n        let { _userMin , _userMax , _suggestedMin , _suggestedMax  } = this;\n        _userMin = finiteOrDefault(_userMin, Number.POSITIVE_INFINITY);\n        _userMax = finiteOrDefault(_userMax, Number.NEGATIVE_INFINITY);\n        _suggestedMin = finiteOrDefault(_suggestedMin, Number.POSITIVE_INFINITY);\n        _suggestedMax = finiteOrDefault(_suggestedMax, Number.NEGATIVE_INFINITY);\n        return {\n            min: finiteOrDefault(_userMin, _suggestedMin),\n            max: finiteOrDefault(_userMax, _suggestedMax),\n            minDefined: isNumberFinite(_userMin),\n            maxDefined: isNumberFinite(_userMax)\n        };\n    }\n getMinMax(canStack) {\n        let { min , max , minDefined , maxDefined  } = this.getUserBounds();\n        let range;\n        if (minDefined && maxDefined) {\n            return {\n                min,\n                max\n            };\n        }\n        const metas = this.getMatchingVisibleMetas();\n        for(let i = 0, ilen = metas.length; i < ilen; ++i){\n            range = metas[i].controller.getMinMax(this, canStack);\n            if (!minDefined) {\n                min = Math.min(min, range.min);\n            }\n            if (!maxDefined) {\n                max = Math.max(max, range.max);\n            }\n        }\n        min = maxDefined && min > max ? max : min;\n        max = minDefined && min > max ? min : max;\n        return {\n            min: finiteOrDefault(min, finiteOrDefault(max, min)),\n            max: finiteOrDefault(max, finiteOrDefault(min, max))\n        };\n    }\n getPadding() {\n        return {\n            left: this.paddingLeft || 0,\n            top: this.paddingTop || 0,\n            right: this.paddingRight || 0,\n            bottom: this.paddingBottom || 0\n        };\n    }\n getTicks() {\n        return this.ticks;\n    }\n getLabels() {\n        const data = this.chart.data;\n        return this.options.labels || (this.isHorizontal() ? data.xLabels : data.yLabels) || data.labels || [];\n    }\n getLabelItems(chartArea = this.chart.chartArea) {\n        const items = this._labelItems || (this._labelItems = this._computeLabelItems(chartArea));\n        return items;\n    }\n    beforeLayout() {\n        this._cache = {};\n        this._dataLimitsCached = false;\n    }\n    beforeUpdate() {\n        callback(this.options.beforeUpdate, [\n            this\n        ]);\n    }\n update(maxWidth, maxHeight, margins) {\n        const { beginAtZero , grace , ticks: tickOpts  } = this.options;\n        const sampleSize = tickOpts.sampleSize;\n        this.beforeUpdate();\n        this.maxWidth = maxWidth;\n        this.maxHeight = maxHeight;\n        this._margins = margins = Object.assign({\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0\n        }, margins);\n        this.ticks = null;\n        this._labelSizes = null;\n        this._gridLineItems = null;\n        this._labelItems = null;\n        this.beforeSetDimensions();\n        this.setDimensions();\n        this.afterSetDimensions();\n        this._maxLength = this.isHorizontal() ? this.width + margins.left + margins.right : this.height + margins.top + margins.bottom;\n        if (!this._dataLimitsCached) {\n            this.beforeDataLimits();\n            this.determineDataLimits();\n            this.afterDataLimits();\n            this._range = _addGrace(this, grace, beginAtZero);\n            this._dataLimitsCached = true;\n        }\n        this.beforeBuildTicks();\n        this.ticks = this.buildTicks() || [];\n        this.afterBuildTicks();\n        const samplingEnabled = sampleSize < this.ticks.length;\n        this._convertTicksToLabels(samplingEnabled ? sample(this.ticks, sampleSize) : this.ticks);\n        this.configure();\n        this.beforeCalculateLabelRotation();\n        this.calculateLabelRotation();\n        this.afterCalculateLabelRotation();\n        if (tickOpts.display && (tickOpts.autoSkip || tickOpts.source === 'auto')) {\n            this.ticks = autoSkip(this, this.ticks);\n            this._labelSizes = null;\n            this.afterAutoSkip();\n        }\n        if (samplingEnabled) {\n            this._convertTicksToLabels(this.ticks);\n        }\n        this.beforeFit();\n        this.fit();\n        this.afterFit();\n        this.afterUpdate();\n    }\n configure() {\n        let reversePixels = this.options.reverse;\n        let startPixel, endPixel;\n        if (this.isHorizontal()) {\n            startPixel = this.left;\n            endPixel = this.right;\n        } else {\n            startPixel = this.top;\n            endPixel = this.bottom;\n            reversePixels = !reversePixels;\n        }\n        this._startPixel = startPixel;\n        this._endPixel = endPixel;\n        this._reversePixels = reversePixels;\n        this._length = endPixel - startPixel;\n        this._alignToPixels = this.options.alignToPixels;\n    }\n    afterUpdate() {\n        callback(this.options.afterUpdate, [\n            this\n        ]);\n    }\n    beforeSetDimensions() {\n        callback(this.options.beforeSetDimensions, [\n            this\n        ]);\n    }\n    setDimensions() {\n        if (this.isHorizontal()) {\n            this.width = this.maxWidth;\n            this.left = 0;\n            this.right = this.width;\n        } else {\n            this.height = this.maxHeight;\n            this.top = 0;\n            this.bottom = this.height;\n        }\n        this.paddingLeft = 0;\n        this.paddingTop = 0;\n        this.paddingRight = 0;\n        this.paddingBottom = 0;\n    }\n    afterSetDimensions() {\n        callback(this.options.afterSetDimensions, [\n            this\n        ]);\n    }\n    _callHooks(name) {\n        this.chart.notifyPlugins(name, this.getContext());\n        callback(this.options[name], [\n            this\n        ]);\n    }\n    beforeDataLimits() {\n        this._callHooks('beforeDataLimits');\n    }\n    determineDataLimits() {}\n    afterDataLimits() {\n        this._callHooks('afterDataLimits');\n    }\n    beforeBuildTicks() {\n        this._callHooks('beforeBuildTicks');\n    }\n buildTicks() {\n        return [];\n    }\n    afterBuildTicks() {\n        this._callHooks('afterBuildTicks');\n    }\n    beforeTickToLabelConversion() {\n        callback(this.options.beforeTickToLabelConversion, [\n            this\n        ]);\n    }\n generateTickLabels(ticks) {\n        const tickOpts = this.options.ticks;\n        let i, ilen, tick;\n        for(i = 0, ilen = ticks.length; i < ilen; i++){\n            tick = ticks[i];\n            tick.label = callback(tickOpts.callback, [\n                tick.value,\n                i,\n                ticks\n            ], this);\n        }\n    }\n    afterTickToLabelConversion() {\n        callback(this.options.afterTickToLabelConversion, [\n            this\n        ]);\n    }\n    beforeCalculateLabelRotation() {\n        callback(this.options.beforeCalculateLabelRotation, [\n            this\n        ]);\n    }\n    calculateLabelRotation() {\n        const options = this.options;\n        const tickOpts = options.ticks;\n        const numTicks = getTicksLimit(this.ticks.length, options.ticks.maxTicksLimit);\n        const minRotation = tickOpts.minRotation || 0;\n        const maxRotation = tickOpts.maxRotation;\n        let labelRotation = minRotation;\n        let tickWidth, maxHeight, maxLabelDiagonal;\n        if (!this._isVisible() || !tickOpts.display || minRotation >= maxRotation || numTicks <= 1 || !this.isHorizontal()) {\n            this.labelRotation = minRotation;\n            return;\n        }\n        const labelSizes = this._getLabelSizes();\n        const maxLabelWidth = labelSizes.widest.width;\n        const maxLabelHeight = labelSizes.highest.height;\n        const maxWidth = _limitValue(this.chart.width - maxLabelWidth, 0, this.maxWidth);\n        tickWidth = options.offset ? this.maxWidth / numTicks : maxWidth / (numTicks - 1);\n        if (maxLabelWidth + 6 > tickWidth) {\n            tickWidth = maxWidth / (numTicks - (options.offset ? 0.5 : 1));\n            maxHeight = this.maxHeight - getTickMarkLength(options.grid) - tickOpts.padding - getTitleHeight(options.title, this.chart.options.font);\n            maxLabelDiagonal = Math.sqrt(maxLabelWidth * maxLabelWidth + maxLabelHeight * maxLabelHeight);\n            labelRotation = toDegrees(Math.min(Math.asin(_limitValue((labelSizes.highest.height + 6) / tickWidth, -1, 1)), Math.asin(_limitValue(maxHeight / maxLabelDiagonal, -1, 1)) - Math.asin(_limitValue(maxLabelHeight / maxLabelDiagonal, -1, 1))));\n            labelRotation = Math.max(minRotation, Math.min(maxRotation, labelRotation));\n        }\n        this.labelRotation = labelRotation;\n    }\n    afterCalculateLabelRotation() {\n        callback(this.options.afterCalculateLabelRotation, [\n            this\n        ]);\n    }\n    afterAutoSkip() {}\n    beforeFit() {\n        callback(this.options.beforeFit, [\n            this\n        ]);\n    }\n    fit() {\n        const minSize = {\n            width: 0,\n            height: 0\n        };\n        const { chart , options: { ticks: tickOpts , title: titleOpts , grid: gridOpts  }  } = this;\n        const display = this._isVisible();\n        const isHorizontal = this.isHorizontal();\n        if (display) {\n            const titleHeight = getTitleHeight(titleOpts, chart.options.font);\n            if (isHorizontal) {\n                minSize.width = this.maxWidth;\n                minSize.height = getTickMarkLength(gridOpts) + titleHeight;\n            } else {\n                minSize.height = this.maxHeight;\n                minSize.width = getTickMarkLength(gridOpts) + titleHeight;\n            }\n            if (tickOpts.display && this.ticks.length) {\n                const { first , last , widest , highest  } = this._getLabelSizes();\n                const tickPadding = tickOpts.padding * 2;\n                const angleRadians = toRadians(this.labelRotation);\n                const cos = Math.cos(angleRadians);\n                const sin = Math.sin(angleRadians);\n                if (isHorizontal) {\n                    const labelHeight = tickOpts.mirror ? 0 : sin * widest.width + cos * highest.height;\n                    minSize.height = Math.min(this.maxHeight, minSize.height + labelHeight + tickPadding);\n                } else {\n                    const labelWidth = tickOpts.mirror ? 0 : cos * widest.width + sin * highest.height;\n                    minSize.width = Math.min(this.maxWidth, minSize.width + labelWidth + tickPadding);\n                }\n                this._calculatePadding(first, last, sin, cos);\n            }\n        }\n        this._handleMargins();\n        if (isHorizontal) {\n            this.width = this._length = chart.width - this._margins.left - this._margins.right;\n            this.height = minSize.height;\n        } else {\n            this.width = minSize.width;\n            this.height = this._length = chart.height - this._margins.top - this._margins.bottom;\n        }\n    }\n    _calculatePadding(first, last, sin, cos) {\n        const { ticks: { align , padding  } , position  } = this.options;\n        const isRotated = this.labelRotation !== 0;\n        const labelsBelowTicks = position !== 'top' && this.axis === 'x';\n        if (this.isHorizontal()) {\n            const offsetLeft = this.getPixelForTick(0) - this.left;\n            const offsetRight = this.right - this.getPixelForTick(this.ticks.length - 1);\n            let paddingLeft = 0;\n            let paddingRight = 0;\n            if (isRotated) {\n                if (labelsBelowTicks) {\n                    paddingLeft = cos * first.width;\n                    paddingRight = sin * last.height;\n                } else {\n                    paddingLeft = sin * first.height;\n                    paddingRight = cos * last.width;\n                }\n            } else if (align === 'start') {\n                paddingRight = last.width;\n            } else if (align === 'end') {\n                paddingLeft = first.width;\n            } else if (align !== 'inner') {\n                paddingLeft = first.width / 2;\n                paddingRight = last.width / 2;\n            }\n            this.paddingLeft = Math.max((paddingLeft - offsetLeft + padding) * this.width / (this.width - offsetLeft), 0);\n            this.paddingRight = Math.max((paddingRight - offsetRight + padding) * this.width / (this.width - offsetRight), 0);\n        } else {\n            let paddingTop = last.height / 2;\n            let paddingBottom = first.height / 2;\n            if (align === 'start') {\n                paddingTop = 0;\n                paddingBottom = first.height;\n            } else if (align === 'end') {\n                paddingTop = last.height;\n                paddingBottom = 0;\n            }\n            this.paddingTop = paddingTop + padding;\n            this.paddingBottom = paddingBottom + padding;\n        }\n    }\n _handleMargins() {\n        if (this._margins) {\n            this._margins.left = Math.max(this.paddingLeft, this._margins.left);\n            this._margins.top = Math.max(this.paddingTop, this._margins.top);\n            this._margins.right = Math.max(this.paddingRight, this._margins.right);\n            this._margins.bottom = Math.max(this.paddingBottom, this._margins.bottom);\n        }\n    }\n    afterFit() {\n        callback(this.options.afterFit, [\n            this\n        ]);\n    }\n isHorizontal() {\n        const { axis , position  } = this.options;\n        return position === 'top' || position === 'bottom' || axis === 'x';\n    }\n isFullSize() {\n        return this.options.fullSize;\n    }\n _convertTicksToLabels(ticks) {\n        this.beforeTickToLabelConversion();\n        this.generateTickLabels(ticks);\n        let i, ilen;\n        for(i = 0, ilen = ticks.length; i < ilen; i++){\n            if (isNullOrUndef(ticks[i].label)) {\n                ticks.splice(i, 1);\n                ilen--;\n                i--;\n            }\n        }\n        this.afterTickToLabelConversion();\n    }\n _getLabelSizes() {\n        let labelSizes = this._labelSizes;\n        if (!labelSizes) {\n            const sampleSize = this.options.ticks.sampleSize;\n            let ticks = this.ticks;\n            if (sampleSize < ticks.length) {\n                ticks = sample(ticks, sampleSize);\n            }\n            this._labelSizes = labelSizes = this._computeLabelSizes(ticks, ticks.length, this.options.ticks.maxTicksLimit);\n        }\n        return labelSizes;\n    }\n _computeLabelSizes(ticks, length, maxTicksLimit) {\n        const { ctx , _longestTextCache: caches  } = this;\n        const widths = [];\n        const heights = [];\n        const increment = Math.floor(length / getTicksLimit(length, maxTicksLimit));\n        let widestLabelSize = 0;\n        let highestLabelSize = 0;\n        let i, j, jlen, label, tickFont, fontString, cache, lineHeight, width, height, nestedLabel;\n        for(i = 0; i < length; i += increment){\n            label = ticks[i].label;\n            tickFont = this._resolveTickFontOptions(i);\n            ctx.font = fontString = tickFont.string;\n            cache = caches[fontString] = caches[fontString] || {\n                data: {},\n                gc: []\n            };\n            lineHeight = tickFont.lineHeight;\n            width = height = 0;\n            if (!isNullOrUndef(label) && !isArray(label)) {\n                width = _measureText(ctx, cache.data, cache.gc, width, label);\n                height = lineHeight;\n            } else if (isArray(label)) {\n                for(j = 0, jlen = label.length; j < jlen; ++j){\n                    nestedLabel =  label[j];\n                    if (!isNullOrUndef(nestedLabel) && !isArray(nestedLabel)) {\n                        width = _measureText(ctx, cache.data, cache.gc, width, nestedLabel);\n                        height += lineHeight;\n                    }\n                }\n            }\n            widths.push(width);\n            heights.push(height);\n            widestLabelSize = Math.max(width, widestLabelSize);\n            highestLabelSize = Math.max(height, highestLabelSize);\n        }\n        garbageCollect(caches, length);\n        const widest = widths.indexOf(widestLabelSize);\n        const highest = heights.indexOf(highestLabelSize);\n        const valueAt = (idx)=>({\n                width: widths[idx] || 0,\n                height: heights[idx] || 0\n            });\n        return {\n            first: valueAt(0),\n            last: valueAt(length - 1),\n            widest: valueAt(widest),\n            highest: valueAt(highest),\n            widths,\n            heights\n        };\n    }\n getLabelForValue(value) {\n        return value;\n    }\n getPixelForValue(value, index) {\n        return NaN;\n    }\n getValueForPixel(pixel) {}\n getPixelForTick(index) {\n        const ticks = this.ticks;\n        if (index < 0 || index > ticks.length - 1) {\n            return null;\n        }\n        return this.getPixelForValue(ticks[index].value);\n    }\n getPixelForDecimal(decimal) {\n        if (this._reversePixels) {\n            decimal = 1 - decimal;\n        }\n        const pixel = this._startPixel + decimal * this._length;\n        return _int16Range(this._alignToPixels ? _alignPixel(this.chart, pixel, 0) : pixel);\n    }\n getDecimalForPixel(pixel) {\n        const decimal = (pixel - this._startPixel) / this._length;\n        return this._reversePixels ? 1 - decimal : decimal;\n    }\n getBasePixel() {\n        return this.getPixelForValue(this.getBaseValue());\n    }\n getBaseValue() {\n        const { min , max  } = this;\n        return min < 0 && max < 0 ? max : min > 0 && max > 0 ? min : 0;\n    }\n getContext(index) {\n        const ticks = this.ticks || [];\n        if (index >= 0 && index < ticks.length) {\n            const tick = ticks[index];\n            return tick.$context || (tick.$context = createTickContext(this.getContext(), index, tick));\n        }\n        return this.$context || (this.$context = createScaleContext(this.chart.getContext(), this));\n    }\n _tickSize() {\n        const optionTicks = this.options.ticks;\n        const rot = toRadians(this.labelRotation);\n        const cos = Math.abs(Math.cos(rot));\n        const sin = Math.abs(Math.sin(rot));\n        const labelSizes = this._getLabelSizes();\n        const padding = optionTicks.autoSkipPadding || 0;\n        const w = labelSizes ? labelSizes.widest.width + padding : 0;\n        const h = labelSizes ? labelSizes.highest.height + padding : 0;\n        return this.isHorizontal() ? h * cos > w * sin ? w / cos : h / sin : h * sin < w * cos ? h / cos : w / sin;\n    }\n _isVisible() {\n        const display = this.options.display;\n        if (display !== 'auto') {\n            return !!display;\n        }\n        return this.getMatchingVisibleMetas().length > 0;\n    }\n _computeGridLineItems(chartArea) {\n        const axis = this.axis;\n        const chart = this.chart;\n        const options = this.options;\n        const { grid , position , border  } = options;\n        const offset = grid.offset;\n        const isHorizontal = this.isHorizontal();\n        const ticks = this.ticks;\n        const ticksLength = ticks.length + (offset ? 1 : 0);\n        const tl = getTickMarkLength(grid);\n        const items = [];\n        const borderOpts = border.setContext(this.getContext());\n        const axisWidth = borderOpts.display ? borderOpts.width : 0;\n        const axisHalfWidth = axisWidth / 2;\n        const alignBorderValue = function(pixel) {\n            return _alignPixel(chart, pixel, axisWidth);\n        };\n        let borderValue, i, lineValue, alignedLineValue;\n        let tx1, ty1, tx2, ty2, x1, y1, x2, y2;\n        if (position === 'top') {\n            borderValue = alignBorderValue(this.bottom);\n            ty1 = this.bottom - tl;\n            ty2 = borderValue - axisHalfWidth;\n            y1 = alignBorderValue(chartArea.top) + axisHalfWidth;\n            y2 = chartArea.bottom;\n        } else if (position === 'bottom') {\n            borderValue = alignBorderValue(this.top);\n            y1 = chartArea.top;\n            y2 = alignBorderValue(chartArea.bottom) - axisHalfWidth;\n            ty1 = borderValue + axisHalfWidth;\n            ty2 = this.top + tl;\n        } else if (position === 'left') {\n            borderValue = alignBorderValue(this.right);\n            tx1 = this.right - tl;\n            tx2 = borderValue - axisHalfWidth;\n            x1 = alignBorderValue(chartArea.left) + axisHalfWidth;\n            x2 = chartArea.right;\n        } else if (position === 'right') {\n            borderValue = alignBorderValue(this.left);\n            x1 = chartArea.left;\n            x2 = alignBorderValue(chartArea.right) - axisHalfWidth;\n            tx1 = borderValue + axisHalfWidth;\n            tx2 = this.left + tl;\n        } else if (axis === 'x') {\n            if (position === 'center') {\n                borderValue = alignBorderValue((chartArea.top + chartArea.bottom) / 2 + 0.5);\n            } else if (isObject(position)) {\n                const positionAxisID = Object.keys(position)[0];\n                const value = position[positionAxisID];\n                borderValue = alignBorderValue(this.chart.scales[positionAxisID].getPixelForValue(value));\n            }\n            y1 = chartArea.top;\n            y2 = chartArea.bottom;\n            ty1 = borderValue + axisHalfWidth;\n            ty2 = ty1 + tl;\n        } else if (axis === 'y') {\n            if (position === 'center') {\n                borderValue = alignBorderValue((chartArea.left + chartArea.right) / 2);\n            } else if (isObject(position)) {\n                const positionAxisID = Object.keys(position)[0];\n                const value = position[positionAxisID];\n                borderValue = alignBorderValue(this.chart.scales[positionAxisID].getPixelForValue(value));\n            }\n            tx1 = borderValue - axisHalfWidth;\n            tx2 = tx1 - tl;\n            x1 = chartArea.left;\n            x2 = chartArea.right;\n        }\n        const limit = valueOrDefault(options.ticks.maxTicksLimit, ticksLength);\n        const step = Math.max(1, Math.ceil(ticksLength / limit));\n        for(i = 0; i < ticksLength; i += step){\n            const context = this.getContext(i);\n            const optsAtIndex = grid.setContext(context);\n            const optsAtIndexBorder = border.setContext(context);\n            const lineWidth = optsAtIndex.lineWidth;\n            const lineColor = optsAtIndex.color;\n            const borderDash = optsAtIndexBorder.dash || [];\n            const borderDashOffset = optsAtIndexBorder.dashOffset;\n            const tickWidth = optsAtIndex.tickWidth;\n            const tickColor = optsAtIndex.tickColor;\n            const tickBorderDash = optsAtIndex.tickBorderDash || [];\n            const tickBorderDashOffset = optsAtIndex.tickBorderDashOffset;\n            lineValue = getPixelForGridLine(this, i, offset);\n            if (lineValue === undefined) {\n                continue;\n            }\n            alignedLineValue = _alignPixel(chart, lineValue, lineWidth);\n            if (isHorizontal) {\n                tx1 = tx2 = x1 = x2 = alignedLineValue;\n            } else {\n                ty1 = ty2 = y1 = y2 = alignedLineValue;\n            }\n            items.push({\n                tx1,\n                ty1,\n                tx2,\n                ty2,\n                x1,\n                y1,\n                x2,\n                y2,\n                width: lineWidth,\n                color: lineColor,\n                borderDash,\n                borderDashOffset,\n                tickWidth,\n                tickColor,\n                tickBorderDash,\n                tickBorderDashOffset\n            });\n        }\n        this._ticksLength = ticksLength;\n        this._borderValue = borderValue;\n        return items;\n    }\n _computeLabelItems(chartArea) {\n        const axis = this.axis;\n        const options = this.options;\n        const { position , ticks: optionTicks  } = options;\n        const isHorizontal = this.isHorizontal();\n        const ticks = this.ticks;\n        const { align , crossAlign , padding , mirror  } = optionTicks;\n        const tl = getTickMarkLength(options.grid);\n        const tickAndPadding = tl + padding;\n        const hTickAndPadding = mirror ? -padding : tickAndPadding;\n        const rotation = -toRadians(this.labelRotation);\n        const items = [];\n        let i, ilen, tick, label, x, y, textAlign, pixel, font, lineHeight, lineCount, textOffset;\n        let textBaseline = 'middle';\n        if (position === 'top') {\n            y = this.bottom - hTickAndPadding;\n            textAlign = this._getXAxisLabelAlignment();\n        } else if (position === 'bottom') {\n            y = this.top + hTickAndPadding;\n            textAlign = this._getXAxisLabelAlignment();\n        } else if (position === 'left') {\n            const ret = this._getYAxisLabelAlignment(tl);\n            textAlign = ret.textAlign;\n            x = ret.x;\n        } else if (position === 'right') {\n            const ret = this._getYAxisLabelAlignment(tl);\n            textAlign = ret.textAlign;\n            x = ret.x;\n        } else if (axis === 'x') {\n            if (position === 'center') {\n                y = (chartArea.top + chartArea.bottom) / 2 + tickAndPadding;\n            } else if (isObject(position)) {\n                const positionAxisID = Object.keys(position)[0];\n                const value = position[positionAxisID];\n                y = this.chart.scales[positionAxisID].getPixelForValue(value) + tickAndPadding;\n            }\n            textAlign = this._getXAxisLabelAlignment();\n        } else if (axis === 'y') {\n            if (position === 'center') {\n                x = (chartArea.left + chartArea.right) / 2 - tickAndPadding;\n            } else if (isObject(position)) {\n                const positionAxisID = Object.keys(position)[0];\n                const value = position[positionAxisID];\n                x = this.chart.scales[positionAxisID].getPixelForValue(value);\n            }\n            textAlign = this._getYAxisLabelAlignment(tl).textAlign;\n        }\n        if (axis === 'y') {\n            if (align === 'start') {\n                textBaseline = 'top';\n            } else if (align === 'end') {\n                textBaseline = 'bottom';\n            }\n        }\n        const labelSizes = this._getLabelSizes();\n        for(i = 0, ilen = ticks.length; i < ilen; ++i){\n            tick = ticks[i];\n            label = tick.label;\n            const optsAtIndex = optionTicks.setContext(this.getContext(i));\n            pixel = this.getPixelForTick(i) + optionTicks.labelOffset;\n            font = this._resolveTickFontOptions(i);\n            lineHeight = font.lineHeight;\n            lineCount = isArray(label) ? label.length : 1;\n            const halfCount = lineCount / 2;\n            const color = optsAtIndex.color;\n            const strokeColor = optsAtIndex.textStrokeColor;\n            const strokeWidth = optsAtIndex.textStrokeWidth;\n            let tickTextAlign = textAlign;\n            if (isHorizontal) {\n                x = pixel;\n                if (textAlign === 'inner') {\n                    if (i === ilen - 1) {\n                        tickTextAlign = !this.options.reverse ? 'right' : 'left';\n                    } else if (i === 0) {\n                        tickTextAlign = !this.options.reverse ? 'left' : 'right';\n                    } else {\n                        tickTextAlign = 'center';\n                    }\n                }\n                if (position === 'top') {\n                    if (crossAlign === 'near' || rotation !== 0) {\n                        textOffset = -lineCount * lineHeight + lineHeight / 2;\n                    } else if (crossAlign === 'center') {\n                        textOffset = -labelSizes.highest.height / 2 - halfCount * lineHeight + lineHeight;\n                    } else {\n                        textOffset = -labelSizes.highest.height + lineHeight / 2;\n                    }\n                } else {\n                    if (crossAlign === 'near' || rotation !== 0) {\n                        textOffset = lineHeight / 2;\n                    } else if (crossAlign === 'center') {\n                        textOffset = labelSizes.highest.height / 2 - halfCount * lineHeight;\n                    } else {\n                        textOffset = labelSizes.highest.height - lineCount * lineHeight;\n                    }\n                }\n                if (mirror) {\n                    textOffset *= -1;\n                }\n                if (rotation !== 0 && !optsAtIndex.showLabelBackdrop) {\n                    x += lineHeight / 2 * Math.sin(rotation);\n                }\n            } else {\n                y = pixel;\n                textOffset = (1 - lineCount) * lineHeight / 2;\n            }\n            let backdrop;\n            if (optsAtIndex.showLabelBackdrop) {\n                const labelPadding = toPadding(optsAtIndex.backdropPadding);\n                const height = labelSizes.heights[i];\n                const width = labelSizes.widths[i];\n                let top = textOffset - labelPadding.top;\n                let left = 0 - labelPadding.left;\n                switch(textBaseline){\n                    case 'middle':\n                        top -= height / 2;\n                        break;\n                    case 'bottom':\n                        top -= height;\n                        break;\n                }\n                switch(textAlign){\n                    case 'center':\n                        left -= width / 2;\n                        break;\n                    case 'right':\n                        left -= width;\n                        break;\n                    case 'inner':\n                        if (i === ilen - 1) {\n                            left -= width;\n                        } else if (i > 0) {\n                            left -= width / 2;\n                        }\n                        break;\n                }\n                backdrop = {\n                    left,\n                    top,\n                    width: width + labelPadding.width,\n                    height: height + labelPadding.height,\n                    color: optsAtIndex.backdropColor\n                };\n            }\n            items.push({\n                label,\n                font,\n                textOffset,\n                options: {\n                    rotation,\n                    color,\n                    strokeColor,\n                    strokeWidth,\n                    textAlign: tickTextAlign,\n                    textBaseline,\n                    translation: [\n                        x,\n                        y\n                    ],\n                    backdrop\n                }\n            });\n        }\n        return items;\n    }\n    _getXAxisLabelAlignment() {\n        const { position , ticks  } = this.options;\n        const rotation = -toRadians(this.labelRotation);\n        if (rotation) {\n            return position === 'top' ? 'left' : 'right';\n        }\n        let align = 'center';\n        if (ticks.align === 'start') {\n            align = 'left';\n        } else if (ticks.align === 'end') {\n            align = 'right';\n        } else if (ticks.align === 'inner') {\n            align = 'inner';\n        }\n        return align;\n    }\n    _getYAxisLabelAlignment(tl) {\n        const { position , ticks: { crossAlign , mirror , padding  }  } = this.options;\n        const labelSizes = this._getLabelSizes();\n        const tickAndPadding = tl + padding;\n        const widest = labelSizes.widest.width;\n        let textAlign;\n        let x;\n        if (position === 'left') {\n            if (mirror) {\n                x = this.right + padding;\n                if (crossAlign === 'near') {\n                    textAlign = 'left';\n                } else if (crossAlign === 'center') {\n                    textAlign = 'center';\n                    x += widest / 2;\n                } else {\n                    textAlign = 'right';\n                    x += widest;\n                }\n            } else {\n                x = this.right - tickAndPadding;\n                if (crossAlign === 'near') {\n                    textAlign = 'right';\n                } else if (crossAlign === 'center') {\n                    textAlign = 'center';\n                    x -= widest / 2;\n                } else {\n                    textAlign = 'left';\n                    x = this.left;\n                }\n            }\n        } else if (position === 'right') {\n            if (mirror) {\n                x = this.left + padding;\n                if (crossAlign === 'near') {\n                    textAlign = 'right';\n                } else if (crossAlign === 'center') {\n                    textAlign = 'center';\n                    x -= widest / 2;\n                } else {\n                    textAlign = 'left';\n                    x -= widest;\n                }\n            } else {\n                x = this.left + tickAndPadding;\n                if (crossAlign === 'near') {\n                    textAlign = 'left';\n                } else if (crossAlign === 'center') {\n                    textAlign = 'center';\n                    x += widest / 2;\n                } else {\n                    textAlign = 'right';\n                    x = this.right;\n                }\n            }\n        } else {\n            textAlign = 'right';\n        }\n        return {\n            textAlign,\n            x\n        };\n    }\n _computeLabelArea() {\n        if (this.options.ticks.mirror) {\n            return;\n        }\n        const chart = this.chart;\n        const position = this.options.position;\n        if (position === 'left' || position === 'right') {\n            return {\n                top: 0,\n                left: this.left,\n                bottom: chart.height,\n                right: this.right\n            };\n        }\n        if (position === 'top' || position === 'bottom') {\n            return {\n                top: this.top,\n                left: 0,\n                bottom: this.bottom,\n                right: chart.width\n            };\n        }\n    }\n drawBackground() {\n        const { ctx , options: { backgroundColor  } , left , top , width , height  } = this;\n        if (backgroundColor) {\n            ctx.save();\n            ctx.fillStyle = backgroundColor;\n            ctx.fillRect(left, top, width, height);\n            ctx.restore();\n        }\n    }\n    getLineWidthForValue(value) {\n        const grid = this.options.grid;\n        if (!this._isVisible() || !grid.display) {\n            return 0;\n        }\n        const ticks = this.ticks;\n        const index = ticks.findIndex((t)=>t.value === value);\n        if (index >= 0) {\n            const opts = grid.setContext(this.getContext(index));\n            return opts.lineWidth;\n        }\n        return 0;\n    }\n drawGrid(chartArea) {\n        const grid = this.options.grid;\n        const ctx = this.ctx;\n        const items = this._gridLineItems || (this._gridLineItems = this._computeGridLineItems(chartArea));\n        let i, ilen;\n        const drawLine = (p1, p2, style)=>{\n            if (!style.width || !style.color) {\n                return;\n            }\n            ctx.save();\n            ctx.lineWidth = style.width;\n            ctx.strokeStyle = style.color;\n            ctx.setLineDash(style.borderDash || []);\n            ctx.lineDashOffset = style.borderDashOffset;\n            ctx.beginPath();\n            ctx.moveTo(p1.x, p1.y);\n            ctx.lineTo(p2.x, p2.y);\n            ctx.stroke();\n            ctx.restore();\n        };\n        if (grid.display) {\n            for(i = 0, ilen = items.length; i < ilen; ++i){\n                const item = items[i];\n                if (grid.drawOnChartArea) {\n                    drawLine({\n                        x: item.x1,\n                        y: item.y1\n                    }, {\n                        x: item.x2,\n                        y: item.y2\n                    }, item);\n                }\n                if (grid.drawTicks) {\n                    drawLine({\n                        x: item.tx1,\n                        y: item.ty1\n                    }, {\n                        x: item.tx2,\n                        y: item.ty2\n                    }, {\n                        color: item.tickColor,\n                        width: item.tickWidth,\n                        borderDash: item.tickBorderDash,\n                        borderDashOffset: item.tickBorderDashOffset\n                    });\n                }\n            }\n        }\n    }\n drawBorder() {\n        const { chart , ctx , options: { border , grid  }  } = this;\n        const borderOpts = border.setContext(this.getContext());\n        const axisWidth = border.display ? borderOpts.width : 0;\n        if (!axisWidth) {\n            return;\n        }\n        const lastLineWidth = grid.setContext(this.getContext(0)).lineWidth;\n        const borderValue = this._borderValue;\n        let x1, x2, y1, y2;\n        if (this.isHorizontal()) {\n            x1 = _alignPixel(chart, this.left, axisWidth) - axisWidth / 2;\n            x2 = _alignPixel(chart, this.right, lastLineWidth) + lastLineWidth / 2;\n            y1 = y2 = borderValue;\n        } else {\n            y1 = _alignPixel(chart, this.top, axisWidth) - axisWidth / 2;\n            y2 = _alignPixel(chart, this.bottom, lastLineWidth) + lastLineWidth / 2;\n            x1 = x2 = borderValue;\n        }\n        ctx.save();\n        ctx.lineWidth = borderOpts.width;\n        ctx.strokeStyle = borderOpts.color;\n        ctx.beginPath();\n        ctx.moveTo(x1, y1);\n        ctx.lineTo(x2, y2);\n        ctx.stroke();\n        ctx.restore();\n    }\n drawLabels(chartArea) {\n        const optionTicks = this.options.ticks;\n        if (!optionTicks.display) {\n            return;\n        }\n        const ctx = this.ctx;\n        const area = this._computeLabelArea();\n        if (area) {\n            clipArea(ctx, area);\n        }\n        const items = this.getLabelItems(chartArea);\n        for (const item of items){\n            const renderTextOptions = item.options;\n            const tickFont = item.font;\n            const label = item.label;\n            const y = item.textOffset;\n            renderText(ctx, label, 0, y, tickFont, renderTextOptions);\n        }\n        if (area) {\n            unclipArea(ctx);\n        }\n    }\n drawTitle() {\n        const { ctx , options: { position , title , reverse  }  } = this;\n        if (!title.display) {\n            return;\n        }\n        const font = toFont(title.font);\n        const padding = toPadding(title.padding);\n        const align = title.align;\n        let offset = font.lineHeight / 2;\n        if (position === 'bottom' || position === 'center' || isObject(position)) {\n            offset += padding.bottom;\n            if (isArray(title.text)) {\n                offset += font.lineHeight * (title.text.length - 1);\n            }\n        } else {\n            offset += padding.top;\n        }\n        const { titleX , titleY , maxWidth , rotation  } = titleArgs(this, offset, position, align);\n        renderText(ctx, title.text, 0, 0, font, {\n            color: title.color,\n            maxWidth,\n            rotation,\n            textAlign: titleAlign(align, position, reverse),\n            textBaseline: 'middle',\n            translation: [\n                titleX,\n                titleY\n            ]\n        });\n    }\n    draw(chartArea) {\n        if (!this._isVisible()) {\n            return;\n        }\n        this.drawBackground();\n        this.drawGrid(chartArea);\n        this.drawBorder();\n        this.drawTitle();\n        this.drawLabels(chartArea);\n    }\n _layers() {\n        const opts = this.options;\n        const tz = opts.ticks && opts.ticks.z || 0;\n        const gz = valueOrDefault(opts.grid && opts.grid.z, -1);\n        const bz = valueOrDefault(opts.border && opts.border.z, 0);\n        if (!this._isVisible() || this.draw !== Scale.prototype.draw) {\n            return [\n                {\n                    z: tz,\n                    draw: (chartArea)=>{\n                        this.draw(chartArea);\n                    }\n                }\n            ];\n        }\n        return [\n            {\n                z: gz,\n                draw: (chartArea)=>{\n                    this.drawBackground();\n                    this.drawGrid(chartArea);\n                    this.drawTitle();\n                }\n            },\n            {\n                z: bz,\n                draw: ()=>{\n                    this.drawBorder();\n                }\n            },\n            {\n                z: tz,\n                draw: (chartArea)=>{\n                    this.drawLabels(chartArea);\n                }\n            }\n        ];\n    }\n getMatchingVisibleMetas(type) {\n        const metas = this.chart.getSortedVisibleDatasetMetas();\n        const axisID = this.axis + 'AxisID';\n        const result = [];\n        let i, ilen;\n        for(i = 0, ilen = metas.length; i < ilen; ++i){\n            const meta = metas[i];\n            if (meta[axisID] === this.id && (!type || meta.type === type)) {\n                result.push(meta);\n            }\n        }\n        return result;\n    }\n _resolveTickFontOptions(index) {\n        const opts = this.options.ticks.setContext(this.getContext(index));\n        return toFont(opts.font);\n    }\n _maxDigits() {\n        const fontSize = this._resolveTickFontOptions(0).lineHeight;\n        return (this.isHorizontal() ? this.width : this.height) / fontSize;\n    }\n}\n\nclass TypedRegistry {\n    constructor(type, scope, override){\n        this.type = type;\n        this.scope = scope;\n        this.override = override;\n        this.items = Object.create(null);\n    }\n    isForType(type) {\n        return Object.prototype.isPrototypeOf.call(this.type.prototype, type.prototype);\n    }\n register(item) {\n        const proto = Object.getPrototypeOf(item);\n        let parentScope;\n        if (isIChartComponent(proto)) {\n            parentScope = this.register(proto);\n        }\n        const items = this.items;\n        const id = item.id;\n        const scope = this.scope + '.' + id;\n        if (!id) {\n            throw new Error('class does not have id: ' + item);\n        }\n        if (id in items) {\n            return scope;\n        }\n        items[id] = item;\n        registerDefaults(item, scope, parentScope);\n        if (this.override) {\n            defaults.override(item.id, item.overrides);\n        }\n        return scope;\n    }\n get(id) {\n        return this.items[id];\n    }\n unregister(item) {\n        const items = this.items;\n        const id = item.id;\n        const scope = this.scope;\n        if (id in items) {\n            delete items[id];\n        }\n        if (scope && id in defaults[scope]) {\n            delete defaults[scope][id];\n            if (this.override) {\n                delete overrides[id];\n            }\n        }\n    }\n}\nfunction registerDefaults(item, scope, parentScope) {\n    const itemDefaults = merge(Object.create(null), [\n        parentScope ? defaults.get(parentScope) : {},\n        defaults.get(scope),\n        item.defaults\n    ]);\n    defaults.set(scope, itemDefaults);\n    if (item.defaultRoutes) {\n        routeDefaults(scope, item.defaultRoutes);\n    }\n    if (item.descriptors) {\n        defaults.describe(scope, item.descriptors);\n    }\n}\nfunction routeDefaults(scope, routes) {\n    Object.keys(routes).forEach((property)=>{\n        const propertyParts = property.split('.');\n        const sourceName = propertyParts.pop();\n        const sourceScope = [\n            scope\n        ].concat(propertyParts).join('.');\n        const parts = routes[property].split('.');\n        const targetName = parts.pop();\n        const targetScope = parts.join('.');\n        defaults.route(sourceScope, sourceName, targetScope, targetName);\n    });\n}\nfunction isIChartComponent(proto) {\n    return 'id' in proto && 'defaults' in proto;\n}\n\nclass Registry {\n    constructor(){\n        this.controllers = new TypedRegistry(DatasetController, 'datasets', true);\n        this.elements = new TypedRegistry(Element, 'elements');\n        this.plugins = new TypedRegistry(Object, 'plugins');\n        this.scales = new TypedRegistry(Scale, 'scales');\n        this._typedRegistries = [\n            this.controllers,\n            this.scales,\n            this.elements\n        ];\n    }\n add(...args) {\n        this._each('register', args);\n    }\n    remove(...args) {\n        this._each('unregister', args);\n    }\n addControllers(...args) {\n        this._each('register', args, this.controllers);\n    }\n addElements(...args) {\n        this._each('register', args, this.elements);\n    }\n addPlugins(...args) {\n        this._each('register', args, this.plugins);\n    }\n addScales(...args) {\n        this._each('register', args, this.scales);\n    }\n getController(id) {\n        return this._get(id, this.controllers, 'controller');\n    }\n getElement(id) {\n        return this._get(id, this.elements, 'element');\n    }\n getPlugin(id) {\n        return this._get(id, this.plugins, 'plugin');\n    }\n getScale(id) {\n        return this._get(id, this.scales, 'scale');\n    }\n removeControllers(...args) {\n        this._each('unregister', args, this.controllers);\n    }\n removeElements(...args) {\n        this._each('unregister', args, this.elements);\n    }\n removePlugins(...args) {\n        this._each('unregister', args, this.plugins);\n    }\n removeScales(...args) {\n        this._each('unregister', args, this.scales);\n    }\n _each(method, args, typedRegistry) {\n        [\n            ...args\n        ].forEach((arg)=>{\n            const reg = typedRegistry || this._getRegistryForType(arg);\n            if (typedRegistry || reg.isForType(arg) || reg === this.plugins && arg.id) {\n                this._exec(method, reg, arg);\n            } else {\n                each(arg, (item)=>{\n                    const itemReg = typedRegistry || this._getRegistryForType(item);\n                    this._exec(method, itemReg, item);\n                });\n            }\n        });\n    }\n _exec(method, registry, component) {\n        const camelMethod = _capitalize(method);\n        callback(component['before' + camelMethod], [], component);\n        registry[method](component);\n        callback(component['after' + camelMethod], [], component);\n    }\n _getRegistryForType(type) {\n        for(let i = 0; i < this._typedRegistries.length; i++){\n            const reg = this._typedRegistries[i];\n            if (reg.isForType(type)) {\n                return reg;\n            }\n        }\n        return this.plugins;\n    }\n _get(id, typedRegistry, type) {\n        const item = typedRegistry.get(id);\n        if (item === undefined) {\n            throw new Error('\"' + id + '\" is not a registered ' + type + '.');\n        }\n        return item;\n    }\n}\nvar registry = /* #__PURE__ */ new Registry();\n\nclass PluginService {\n    constructor(){\n        this._init = undefined;\n    }\n notify(chart, hook, args, filter) {\n        if (hook === 'beforeInit') {\n            this._init = this._createDescriptors(chart, true);\n            this._notify(this._init, chart, 'install');\n        }\n        if (this._init === undefined) {\n            return;\n        }\n        const descriptors = filter ? this._descriptors(chart).filter(filter) : this._descriptors(chart);\n        const result = this._notify(descriptors, chart, hook, args);\n        if (hook === 'afterDestroy') {\n            this._notify(descriptors, chart, 'stop');\n            this._notify(this._init, chart, 'uninstall');\n            this._init = undefined;\n        }\n        return result;\n    }\n _notify(descriptors, chart, hook, args) {\n        args = args || {};\n        for (const descriptor of descriptors){\n            const plugin = descriptor.plugin;\n            const method = plugin[hook];\n            const params = [\n                chart,\n                args,\n                descriptor.options\n            ];\n            if (callback(method, params, plugin) === false && args.cancelable) {\n                return false;\n            }\n        }\n        return true;\n    }\n    invalidate() {\n        if (!isNullOrUndef(this._cache)) {\n            this._oldCache = this._cache;\n            this._cache = undefined;\n        }\n    }\n _descriptors(chart) {\n        if (this._cache) {\n            return this._cache;\n        }\n        const descriptors = this._cache = this._createDescriptors(chart);\n        this._notifyStateChanges(chart);\n        return descriptors;\n    }\n    _createDescriptors(chart, all) {\n        const config = chart && chart.config;\n        const options = valueOrDefault(config.options && config.options.plugins, {});\n        const plugins = allPlugins(config);\n        return options === false && !all ? [] : createDescriptors(chart, plugins, options, all);\n    }\n _notifyStateChanges(chart) {\n        const previousDescriptors = this._oldCache || [];\n        const descriptors = this._cache;\n        const diff = (a, b)=>a.filter((x)=>!b.some((y)=>x.plugin.id === y.plugin.id));\n        this._notify(diff(previousDescriptors, descriptors), chart, 'stop');\n        this._notify(diff(descriptors, previousDescriptors), chart, 'start');\n    }\n}\n function allPlugins(config) {\n    const localIds = {};\n    const plugins = [];\n    const keys = Object.keys(registry.plugins.items);\n    for(let i = 0; i < keys.length; i++){\n        plugins.push(registry.getPlugin(keys[i]));\n    }\n    const local = config.plugins || [];\n    for(let i = 0; i < local.length; i++){\n        const plugin = local[i];\n        if (plugins.indexOf(plugin) === -1) {\n            plugins.push(plugin);\n            localIds[plugin.id] = true;\n        }\n    }\n    return {\n        plugins,\n        localIds\n    };\n}\nfunction getOpts(options, all) {\n    if (!all && options === false) {\n        return null;\n    }\n    if (options === true) {\n        return {};\n    }\n    return options;\n}\nfunction createDescriptors(chart, { plugins , localIds  }, options, all) {\n    const result = [];\n    const context = chart.getContext();\n    for (const plugin of plugins){\n        const id = plugin.id;\n        const opts = getOpts(options[id], all);\n        if (opts === null) {\n            continue;\n        }\n        result.push({\n            plugin,\n            options: pluginOpts(chart.config, {\n                plugin,\n                local: localIds[id]\n            }, opts, context)\n        });\n    }\n    return result;\n}\nfunction pluginOpts(config, { plugin , local  }, opts, context) {\n    const keys = config.pluginScopeKeys(plugin);\n    const scopes = config.getOptionScopes(opts, keys);\n    if (local && plugin.defaults) {\n        scopes.push(plugin.defaults);\n    }\n    return config.createResolver(scopes, context, [\n        ''\n    ], {\n        scriptable: false,\n        indexable: false,\n        allKeys: true\n    });\n}\n\nfunction getIndexAxis(type, options) {\n    const datasetDefaults = defaults.datasets[type] || {};\n    const datasetOptions = (options.datasets || {})[type] || {};\n    return datasetOptions.indexAxis || options.indexAxis || datasetDefaults.indexAxis || 'x';\n}\nfunction getAxisFromDefaultScaleID(id, indexAxis) {\n    let axis = id;\n    if (id === '_index_') {\n        axis = indexAxis;\n    } else if (id === '_value_') {\n        axis = indexAxis === 'x' ? 'y' : 'x';\n    }\n    return axis;\n}\nfunction getDefaultScaleIDFromAxis(axis, indexAxis) {\n    return axis === indexAxis ? '_index_' : '_value_';\n}\nfunction idMatchesAxis(id) {\n    if (id === 'x' || id === 'y' || id === 'r') {\n        return id;\n    }\n}\nfunction axisFromPosition(position) {\n    if (position === 'top' || position === 'bottom') {\n        return 'x';\n    }\n    if (position === 'left' || position === 'right') {\n        return 'y';\n    }\n}\nfunction determineAxis(id, ...scaleOptions) {\n    if (idMatchesAxis(id)) {\n        return id;\n    }\n    for (const opts of scaleOptions){\n        const axis = opts.axis || axisFromPosition(opts.position) || id.length > 1 && idMatchesAxis(id[0].toLowerCase());\n        if (axis) {\n            return axis;\n        }\n    }\n    throw new Error(`Cannot determine type of '${id}' axis. Please provide 'axis' or 'position' option.`);\n}\nfunction getAxisFromDataset(id, axis, dataset) {\n    if (dataset[axis + 'AxisID'] === id) {\n        return {\n            axis\n        };\n    }\n}\nfunction retrieveAxisFromDatasets(id, config) {\n    if (config.data && config.data.datasets) {\n        const boundDs = config.data.datasets.filter((d)=>d.xAxisID === id || d.yAxisID === id);\n        if (boundDs.length) {\n            return getAxisFromDataset(id, 'x', boundDs[0]) || getAxisFromDataset(id, 'y', boundDs[0]);\n        }\n    }\n    return {};\n}\nfunction mergeScaleConfig(config, options) {\n    const chartDefaults = overrides[config.type] || {\n        scales: {}\n    };\n    const configScales = options.scales || {};\n    const chartIndexAxis = getIndexAxis(config.type, options);\n    const scales = Object.create(null);\n    Object.keys(configScales).forEach((id)=>{\n        const scaleConf = configScales[id];\n        if (!isObject(scaleConf)) {\n            return console.error(`Invalid scale configuration for scale: ${id}`);\n        }\n        if (scaleConf._proxy) {\n            return console.warn(`Ignoring resolver passed as options for scale: ${id}`);\n        }\n        const axis = determineAxis(id, scaleConf, retrieveAxisFromDatasets(id, config), defaults.scales[scaleConf.type]);\n        const defaultId = getDefaultScaleIDFromAxis(axis, chartIndexAxis);\n        const defaultScaleOptions = chartDefaults.scales || {};\n        scales[id] = mergeIf(Object.create(null), [\n            {\n                axis\n            },\n            scaleConf,\n            defaultScaleOptions[axis],\n            defaultScaleOptions[defaultId]\n        ]);\n    });\n    config.data.datasets.forEach((dataset)=>{\n        const type = dataset.type || config.type;\n        const indexAxis = dataset.indexAxis || getIndexAxis(type, options);\n        const datasetDefaults = overrides[type] || {};\n        const defaultScaleOptions = datasetDefaults.scales || {};\n        Object.keys(defaultScaleOptions).forEach((defaultID)=>{\n            const axis = getAxisFromDefaultScaleID(defaultID, indexAxis);\n            const id = dataset[axis + 'AxisID'] || axis;\n            scales[id] = scales[id] || Object.create(null);\n            mergeIf(scales[id], [\n                {\n                    axis\n                },\n                configScales[id],\n                defaultScaleOptions[defaultID]\n            ]);\n        });\n    });\n    Object.keys(scales).forEach((key)=>{\n        const scale = scales[key];\n        mergeIf(scale, [\n            defaults.scales[scale.type],\n            defaults.scale\n        ]);\n    });\n    return scales;\n}\nfunction initOptions(config) {\n    const options = config.options || (config.options = {});\n    options.plugins = valueOrDefault(options.plugins, {});\n    options.scales = mergeScaleConfig(config, options);\n}\nfunction initData(data) {\n    data = data || {};\n    data.datasets = data.datasets || [];\n    data.labels = data.labels || [];\n    return data;\n}\nfunction initConfig(config) {\n    config = config || {};\n    config.data = initData(config.data);\n    initOptions(config);\n    return config;\n}\nconst keyCache = new Map();\nconst keysCached = new Set();\nfunction cachedKeys(cacheKey, generate) {\n    let keys = keyCache.get(cacheKey);\n    if (!keys) {\n        keys = generate();\n        keyCache.set(cacheKey, keys);\n        keysCached.add(keys);\n    }\n    return keys;\n}\nconst addIfFound = (set, obj, key)=>{\n    const opts = resolveObjectKey(obj, key);\n    if (opts !== undefined) {\n        set.add(opts);\n    }\n};\nclass Config {\n    constructor(config){\n        this._config = initConfig(config);\n        this._scopeCache = new Map();\n        this._resolverCache = new Map();\n    }\n    get platform() {\n        return this._config.platform;\n    }\n    get type() {\n        return this._config.type;\n    }\n    set type(type) {\n        this._config.type = type;\n    }\n    get data() {\n        return this._config.data;\n    }\n    set data(data) {\n        this._config.data = initData(data);\n    }\n    get options() {\n        return this._config.options;\n    }\n    set options(options) {\n        this._config.options = options;\n    }\n    get plugins() {\n        return this._config.plugins;\n    }\n    update() {\n        const config = this._config;\n        this.clearCache();\n        initOptions(config);\n    }\n    clearCache() {\n        this._scopeCache.clear();\n        this._resolverCache.clear();\n    }\n datasetScopeKeys(datasetType) {\n        return cachedKeys(datasetType, ()=>[\n                [\n                    `datasets.${datasetType}`,\n                    ''\n                ]\n            ]);\n    }\n datasetAnimationScopeKeys(datasetType, transition) {\n        return cachedKeys(`${datasetType}.transition.${transition}`, ()=>[\n                [\n                    `datasets.${datasetType}.transitions.${transition}`,\n                    `transitions.${transition}`\n                ],\n                [\n                    `datasets.${datasetType}`,\n                    ''\n                ]\n            ]);\n    }\n datasetElementScopeKeys(datasetType, elementType) {\n        return cachedKeys(`${datasetType}-${elementType}`, ()=>[\n                [\n                    `datasets.${datasetType}.elements.${elementType}`,\n                    `datasets.${datasetType}`,\n                    `elements.${elementType}`,\n                    ''\n                ]\n            ]);\n    }\n pluginScopeKeys(plugin) {\n        const id = plugin.id;\n        const type = this.type;\n        return cachedKeys(`${type}-plugin-${id}`, ()=>[\n                [\n                    `plugins.${id}`,\n                    ...plugin.additionalOptionScopes || []\n                ]\n            ]);\n    }\n _cachedScopes(mainScope, resetCache) {\n        const _scopeCache = this._scopeCache;\n        let cache = _scopeCache.get(mainScope);\n        if (!cache || resetCache) {\n            cache = new Map();\n            _scopeCache.set(mainScope, cache);\n        }\n        return cache;\n    }\n getOptionScopes(mainScope, keyLists, resetCache) {\n        const { options , type  } = this;\n        const cache = this._cachedScopes(mainScope, resetCache);\n        const cached = cache.get(keyLists);\n        if (cached) {\n            return cached;\n        }\n        const scopes = new Set();\n        keyLists.forEach((keys)=>{\n            if (mainScope) {\n                scopes.add(mainScope);\n                keys.forEach((key)=>addIfFound(scopes, mainScope, key));\n            }\n            keys.forEach((key)=>addIfFound(scopes, options, key));\n            keys.forEach((key)=>addIfFound(scopes, overrides[type] || {}, key));\n            keys.forEach((key)=>addIfFound(scopes, defaults, key));\n            keys.forEach((key)=>addIfFound(scopes, descriptors, key));\n        });\n        const array = Array.from(scopes);\n        if (array.length === 0) {\n            array.push(Object.create(null));\n        }\n        if (keysCached.has(keyLists)) {\n            cache.set(keyLists, array);\n        }\n        return array;\n    }\n chartOptionScopes() {\n        const { options , type  } = this;\n        return [\n            options,\n            overrides[type] || {},\n            defaults.datasets[type] || {},\n            {\n                type\n            },\n            defaults,\n            descriptors\n        ];\n    }\n resolveNamedOptions(scopes, names, context, prefixes = [\n        ''\n    ]) {\n        const result = {\n            $shared: true\n        };\n        const { resolver , subPrefixes  } = getResolver(this._resolverCache, scopes, prefixes);\n        let options = resolver;\n        if (needContext(resolver, names)) {\n            result.$shared = false;\n            context = isFunction(context) ? context() : context;\n            const subResolver = this.createResolver(scopes, context, subPrefixes);\n            options = _attachContext(resolver, context, subResolver);\n        }\n        for (const prop of names){\n            result[prop] = options[prop];\n        }\n        return result;\n    }\n createResolver(scopes, context, prefixes = [\n        ''\n    ], descriptorDefaults) {\n        const { resolver  } = getResolver(this._resolverCache, scopes, prefixes);\n        return isObject(context) ? _attachContext(resolver, context, undefined, descriptorDefaults) : resolver;\n    }\n}\nfunction getResolver(resolverCache, scopes, prefixes) {\n    let cache = resolverCache.get(scopes);\n    if (!cache) {\n        cache = new Map();\n        resolverCache.set(scopes, cache);\n    }\n    const cacheKey = prefixes.join();\n    let cached = cache.get(cacheKey);\n    if (!cached) {\n        const resolver = _createResolver(scopes, prefixes);\n        cached = {\n            resolver,\n            subPrefixes: prefixes.filter((p)=>!p.toLowerCase().includes('hover'))\n        };\n        cache.set(cacheKey, cached);\n    }\n    return cached;\n}\nconst hasFunction = (value)=>isObject(value) && Object.getOwnPropertyNames(value).some((key)=>isFunction(value[key]));\nfunction needContext(proxy, names) {\n    const { isScriptable , isIndexable  } = _descriptors(proxy);\n    for (const prop of names){\n        const scriptable = isScriptable(prop);\n        const indexable = isIndexable(prop);\n        const value = (indexable || scriptable) && proxy[prop];\n        if (scriptable && (isFunction(value) || hasFunction(value)) || indexable && isArray(value)) {\n            return true;\n        }\n    }\n    return false;\n}\n\nvar version = \"4.5.1\";\n\nconst KNOWN_POSITIONS = [\n    'top',\n    'bottom',\n    'left',\n    'right',\n    'chartArea'\n];\nfunction positionIsHorizontal(position, axis) {\n    return position === 'top' || position === 'bottom' || KNOWN_POSITIONS.indexOf(position) === -1 && axis === 'x';\n}\nfunction compare2Level(l1, l2) {\n    return function(a, b) {\n        return a[l1] === b[l1] ? a[l2] - b[l2] : a[l1] - b[l1];\n    };\n}\nfunction onAnimationsComplete(context) {\n    const chart = context.chart;\n    const animationOptions = chart.options.animation;\n    chart.notifyPlugins('afterRender');\n    callback(animationOptions && animationOptions.onComplete, [\n        context\n    ], chart);\n}\nfunction onAnimationProgress(context) {\n    const chart = context.chart;\n    const animationOptions = chart.options.animation;\n    callback(animationOptions && animationOptions.onProgress, [\n        context\n    ], chart);\n}\n function getCanvas(item) {\n    if (_isDomSupported() && typeof item === 'string') {\n        item = document.getElementById(item);\n    } else if (item && item.length) {\n        item = item[0];\n    }\n    if (item && item.canvas) {\n        item = item.canvas;\n    }\n    return item;\n}\nconst instances = {};\nconst getChart = (key)=>{\n    const canvas = getCanvas(key);\n    return Object.values(instances).filter((c)=>c.canvas === canvas).pop();\n};\nfunction moveNumericKeys(obj, start, move) {\n    const keys = Object.keys(obj);\n    for (const key of keys){\n        const intKey = +key;\n        if (intKey >= start) {\n            const value = obj[key];\n            delete obj[key];\n            if (move > 0 || intKey > start) {\n                obj[intKey + move] = value;\n            }\n        }\n    }\n}\n function determineLastEvent(e, lastEvent, inChartArea, isClick) {\n    if (!inChartArea || e.type === 'mouseout') {\n        return null;\n    }\n    if (isClick) {\n        return lastEvent;\n    }\n    return e;\n}\nclass Chart {\n    static defaults = defaults;\n    static instances = instances;\n    static overrides = overrides;\n    static registry = registry;\n    static version = version;\n    static getChart = getChart;\n    static register(...items) {\n        registry.add(...items);\n        invalidatePlugins();\n    }\n    static unregister(...items) {\n        registry.remove(...items);\n        invalidatePlugins();\n    }\n    constructor(item, userConfig){\n        const config = this.config = new Config(userConfig);\n        const initialCanvas = getCanvas(item);\n        const existingChart = getChart(initialCanvas);\n        if (existingChart) {\n            throw new Error('Canvas is already in use. Chart with ID \\'' + existingChart.id + '\\'' + ' must be destroyed before the canvas with ID \\'' + existingChart.canvas.id + '\\' can be reused.');\n        }\n        const options = config.createResolver(config.chartOptionScopes(), this.getContext());\n        this.platform = new (config.platform || _detectPlatform(initialCanvas))();\n        this.platform.updateConfig(config);\n        const context = this.platform.acquireContext(initialCanvas, options.aspectRatio);\n        const canvas = context && context.canvas;\n        const height = canvas && canvas.height;\n        const width = canvas && canvas.width;\n        this.id = uid();\n        this.ctx = context;\n        this.canvas = canvas;\n        this.width = width;\n        this.height = height;\n        this._options = options;\n        this._aspectRatio = this.aspectRatio;\n        this._layers = [];\n        this._metasets = [];\n        this._stacks = undefined;\n        this.boxes = [];\n        this.currentDevicePixelRatio = undefined;\n        this.chartArea = undefined;\n        this._active = [];\n        this._lastEvent = undefined;\n        this._listeners = {};\n         this._responsiveListeners = undefined;\n        this._sortedMetasets = [];\n        this.scales = {};\n        this._plugins = new PluginService();\n        this.$proxies = {};\n        this._hiddenIndices = {};\n        this.attached = false;\n        this._animationsDisabled = undefined;\n        this.$context = undefined;\n        this._doResize = debounce((mode)=>this.update(mode), options.resizeDelay || 0);\n        this._dataChanges = [];\n        instances[this.id] = this;\n        if (!context || !canvas) {\n            console.error(\"Failed to create chart: can't acquire context from the given item\");\n            return;\n        }\n        animator.listen(this, 'complete', onAnimationsComplete);\n        animator.listen(this, 'progress', onAnimationProgress);\n        this._initialize();\n        if (this.attached) {\n            this.update();\n        }\n    }\n    get aspectRatio() {\n        const { options: { aspectRatio , maintainAspectRatio  } , width , height , _aspectRatio  } = this;\n        if (!isNullOrUndef(aspectRatio)) {\n            return aspectRatio;\n        }\n        if (maintainAspectRatio && _aspectRatio) {\n            return _aspectRatio;\n        }\n        return height ? width / height : null;\n    }\n    get data() {\n        return this.config.data;\n    }\n    set data(data) {\n        this.config.data = data;\n    }\n    get options() {\n        return this._options;\n    }\n    set options(options) {\n        this.config.options = options;\n    }\n    get registry() {\n        return registry;\n    }\n _initialize() {\n        this.notifyPlugins('beforeInit');\n        if (this.options.responsive) {\n            this.resize();\n        } else {\n            retinaScale(this, this.options.devicePixelRatio);\n        }\n        this.bindEvents();\n        this.notifyPlugins('afterInit');\n        return this;\n    }\n    clear() {\n        clearCanvas(this.canvas, this.ctx);\n        return this;\n    }\n    stop() {\n        animator.stop(this);\n        return this;\n    }\n resize(width, height) {\n        if (!animator.running(this)) {\n            this._resize(width, height);\n        } else {\n            this._resizeBeforeDraw = {\n                width,\n                height\n            };\n        }\n    }\n    _resize(width, height) {\n        const options = this.options;\n        const canvas = this.canvas;\n        const aspectRatio = options.maintainAspectRatio && this.aspectRatio;\n        const newSize = this.platform.getMaximumSize(canvas, width, height, aspectRatio);\n        const newRatio = options.devicePixelRatio || this.platform.getDevicePixelRatio();\n        const mode = this.width ? 'resize' : 'attach';\n        this.width = newSize.width;\n        this.height = newSize.height;\n        this._aspectRatio = this.aspectRatio;\n        if (!retinaScale(this, newRatio, true)) {\n            return;\n        }\n        this.notifyPlugins('resize', {\n            size: newSize\n        });\n        callback(options.onResize, [\n            this,\n            newSize\n        ], this);\n        if (this.attached) {\n            if (this._doResize(mode)) {\n                this.render();\n            }\n        }\n    }\n    ensureScalesHaveIDs() {\n        const options = this.options;\n        const scalesOptions = options.scales || {};\n        each(scalesOptions, (axisOptions, axisID)=>{\n            axisOptions.id = axisID;\n        });\n    }\n buildOrUpdateScales() {\n        const options = this.options;\n        const scaleOpts = options.scales;\n        const scales = this.scales;\n        const updated = Object.keys(scales).reduce((obj, id)=>{\n            obj[id] = false;\n            return obj;\n        }, {});\n        let items = [];\n        if (scaleOpts) {\n            items = items.concat(Object.keys(scaleOpts).map((id)=>{\n                const scaleOptions = scaleOpts[id];\n                const axis = determineAxis(id, scaleOptions);\n                const isRadial = axis === 'r';\n                const isHorizontal = axis === 'x';\n                return {\n                    options: scaleOptions,\n                    dposition: isRadial ? 'chartArea' : isHorizontal ? 'bottom' : 'left',\n                    dtype: isRadial ? 'radialLinear' : isHorizontal ? 'category' : 'linear'\n                };\n            }));\n        }\n        each(items, (item)=>{\n            const scaleOptions = item.options;\n            const id = scaleOptions.id;\n            const axis = determineAxis(id, scaleOptions);\n            const scaleType = valueOrDefault(scaleOptions.type, item.dtype);\n            if (scaleOptions.position === undefined || positionIsHorizontal(scaleOptions.position, axis) !== positionIsHorizontal(item.dposition)) {\n                scaleOptions.position = item.dposition;\n            }\n            updated[id] = true;\n            let scale = null;\n            if (id in scales && scales[id].type === scaleType) {\n                scale = scales[id];\n            } else {\n                const scaleClass = registry.getScale(scaleType);\n                scale = new scaleClass({\n                    id,\n                    type: scaleType,\n                    ctx: this.ctx,\n                    chart: this\n                });\n                scales[scale.id] = scale;\n            }\n            scale.init(scaleOptions, options);\n        });\n        each(updated, (hasUpdated, id)=>{\n            if (!hasUpdated) {\n                delete scales[id];\n            }\n        });\n        each(scales, (scale)=>{\n            layouts.configure(this, scale, scale.options);\n            layouts.addBox(this, scale);\n        });\n    }\n _updateMetasets() {\n        const metasets = this._metasets;\n        const numData = this.data.datasets.length;\n        const numMeta = metasets.length;\n        metasets.sort((a, b)=>a.index - b.index);\n        if (numMeta > numData) {\n            for(let i = numData; i < numMeta; ++i){\n                this._destroyDatasetMeta(i);\n            }\n            metasets.splice(numData, numMeta - numData);\n        }\n        this._sortedMetasets = metasets.slice(0).sort(compare2Level('order', 'index'));\n    }\n _removeUnreferencedMetasets() {\n        const { _metasets: metasets , data: { datasets  }  } = this;\n        if (metasets.length > datasets.length) {\n            delete this._stacks;\n        }\n        metasets.forEach((meta, index)=>{\n            if (datasets.filter((x)=>x === meta._dataset).length === 0) {\n                this._destroyDatasetMeta(index);\n            }\n        });\n    }\n    buildOrUpdateControllers() {\n        const newControllers = [];\n        const datasets = this.data.datasets;\n        let i, ilen;\n        this._removeUnreferencedMetasets();\n        for(i = 0, ilen = datasets.length; i < ilen; i++){\n            const dataset = datasets[i];\n            let meta = this.getDatasetMeta(i);\n            const type = dataset.type || this.config.type;\n            if (meta.type && meta.type !== type) {\n                this._destroyDatasetMeta(i);\n                meta = this.getDatasetMeta(i);\n            }\n            meta.type = type;\n            meta.indexAxis = dataset.indexAxis || getIndexAxis(type, this.options);\n            meta.order = dataset.order || 0;\n            meta.index = i;\n            meta.label = '' + dataset.label;\n            meta.visible = this.isDatasetVisible(i);\n            if (meta.controller) {\n                meta.controller.updateIndex(i);\n                meta.controller.linkScales();\n            } else {\n                const ControllerClass = registry.getController(type);\n                const { datasetElementType , dataElementType  } = defaults.datasets[type];\n                Object.assign(ControllerClass, {\n                    dataElementType: registry.getElement(dataElementType),\n                    datasetElementType: datasetElementType && registry.getElement(datasetElementType)\n                });\n                meta.controller = new ControllerClass(this, i);\n                newControllers.push(meta.controller);\n            }\n        }\n        this._updateMetasets();\n        return newControllers;\n    }\n _resetElements() {\n        each(this.data.datasets, (dataset, datasetIndex)=>{\n            this.getDatasetMeta(datasetIndex).controller.reset();\n        }, this);\n    }\n reset() {\n        this._resetElements();\n        this.notifyPlugins('reset');\n    }\n    update(mode) {\n        const config = this.config;\n        config.update();\n        const options = this._options = config.createResolver(config.chartOptionScopes(), this.getContext());\n        const animsDisabled = this._animationsDisabled = !options.animation;\n        this._updateScales();\n        this._checkEventBindings();\n        this._updateHiddenIndices();\n        this._plugins.invalidate();\n        if (this.notifyPlugins('beforeUpdate', {\n            mode,\n            cancelable: true\n        }) === false) {\n            return;\n        }\n        const newControllers = this.buildOrUpdateControllers();\n        this.notifyPlugins('beforeElementsUpdate');\n        let minPadding = 0;\n        for(let i = 0, ilen = this.data.datasets.length; i < ilen; i++){\n            const { controller  } = this.getDatasetMeta(i);\n            const reset = !animsDisabled && newControllers.indexOf(controller) === -1;\n            controller.buildOrUpdateElements(reset);\n            minPadding = Math.max(+controller.getMaxOverflow(), minPadding);\n        }\n        minPadding = this._minPadding = options.layout.autoPadding ? minPadding : 0;\n        this._updateLayout(minPadding);\n        if (!animsDisabled) {\n            each(newControllers, (controller)=>{\n                controller.reset();\n            });\n        }\n        this._updateDatasets(mode);\n        this.notifyPlugins('afterUpdate', {\n            mode\n        });\n        this._layers.sort(compare2Level('z', '_idx'));\n        const { _active , _lastEvent  } = this;\n        if (_lastEvent) {\n            this._eventHandler(_lastEvent, true);\n        } else if (_active.length) {\n            this._updateHoverStyles(_active, _active, true);\n        }\n        this.render();\n    }\n _updateScales() {\n        each(this.scales, (scale)=>{\n            layouts.removeBox(this, scale);\n        });\n        this.ensureScalesHaveIDs();\n        this.buildOrUpdateScales();\n    }\n _checkEventBindings() {\n        const options = this.options;\n        const existingEvents = new Set(Object.keys(this._listeners));\n        const newEvents = new Set(options.events);\n        if (!setsEqual(existingEvents, newEvents) || !!this._responsiveListeners !== options.responsive) {\n            this.unbindEvents();\n            this.bindEvents();\n        }\n    }\n _updateHiddenIndices() {\n        const { _hiddenIndices  } = this;\n        const changes = this._getUniformDataChanges() || [];\n        for (const { method , start , count  } of changes){\n            const move = method === '_removeElements' ? -count : count;\n            moveNumericKeys(_hiddenIndices, start, move);\n        }\n    }\n _getUniformDataChanges() {\n        const _dataChanges = this._dataChanges;\n        if (!_dataChanges || !_dataChanges.length) {\n            return;\n        }\n        this._dataChanges = [];\n        const datasetCount = this.data.datasets.length;\n        const makeSet = (idx)=>new Set(_dataChanges.filter((c)=>c[0] === idx).map((c, i)=>i + ',' + c.splice(1).join(',')));\n        const changeSet = makeSet(0);\n        for(let i = 1; i < datasetCount; i++){\n            if (!setsEqual(changeSet, makeSet(i))) {\n                return;\n            }\n        }\n        return Array.from(changeSet).map((c)=>c.split(',')).map((a)=>({\n                method: a[1],\n                start: +a[2],\n                count: +a[3]\n            }));\n    }\n _updateLayout(minPadding) {\n        if (this.notifyPlugins('beforeLayout', {\n            cancelable: true\n        }) === false) {\n            return;\n        }\n        layouts.update(this, this.width, this.height, minPadding);\n        const area = this.chartArea;\n        const noArea = area.width <= 0 || area.height <= 0;\n        this._layers = [];\n        each(this.boxes, (box)=>{\n            if (noArea && box.position === 'chartArea') {\n                return;\n            }\n            if (box.configure) {\n                box.configure();\n            }\n            this._layers.push(...box._layers());\n        }, this);\n        this._layers.forEach((item, index)=>{\n            item._idx = index;\n        });\n        this.notifyPlugins('afterLayout');\n    }\n _updateDatasets(mode) {\n        if (this.notifyPlugins('beforeDatasetsUpdate', {\n            mode,\n            cancelable: true\n        }) === false) {\n            return;\n        }\n        for(let i = 0, ilen = this.data.datasets.length; i < ilen; ++i){\n            this.getDatasetMeta(i).controller.configure();\n        }\n        for(let i = 0, ilen = this.data.datasets.length; i < ilen; ++i){\n            this._updateDataset(i, isFunction(mode) ? mode({\n                datasetIndex: i\n            }) : mode);\n        }\n        this.notifyPlugins('afterDatasetsUpdate', {\n            mode\n        });\n    }\n _updateDataset(index, mode) {\n        const meta = this.getDatasetMeta(index);\n        const args = {\n            meta,\n            index,\n            mode,\n            cancelable: true\n        };\n        if (this.notifyPlugins('beforeDatasetUpdate', args) === false) {\n            return;\n        }\n        meta.controller._update(mode);\n        args.cancelable = false;\n        this.notifyPlugins('afterDatasetUpdate', args);\n    }\n    render() {\n        if (this.notifyPlugins('beforeRender', {\n            cancelable: true\n        }) === false) {\n            return;\n        }\n        if (animator.has(this)) {\n            if (this.attached && !animator.running(this)) {\n                animator.start(this);\n            }\n        } else {\n            this.draw();\n            onAnimationsComplete({\n                chart: this\n            });\n        }\n    }\n    draw() {\n        let i;\n        if (this._resizeBeforeDraw) {\n            const { width , height  } = this._resizeBeforeDraw;\n            this._resizeBeforeDraw = null;\n            this._resize(width, height);\n        }\n        this.clear();\n        if (this.width <= 0 || this.height <= 0) {\n            return;\n        }\n        if (this.notifyPlugins('beforeDraw', {\n            cancelable: true\n        }) === false) {\n            return;\n        }\n        const layers = this._layers;\n        for(i = 0; i < layers.length && layers[i].z <= 0; ++i){\n            layers[i].draw(this.chartArea);\n        }\n        this._drawDatasets();\n        for(; i < layers.length; ++i){\n            layers[i].draw(this.chartArea);\n        }\n        this.notifyPlugins('afterDraw');\n    }\n _getSortedDatasetMetas(filterVisible) {\n        const metasets = this._sortedMetasets;\n        const result = [];\n        let i, ilen;\n        for(i = 0, ilen = metasets.length; i < ilen; ++i){\n            const meta = metasets[i];\n            if (!filterVisible || meta.visible) {\n                result.push(meta);\n            }\n        }\n        return result;\n    }\n getSortedVisibleDatasetMetas() {\n        return this._getSortedDatasetMetas(true);\n    }\n _drawDatasets() {\n        if (this.notifyPlugins('beforeDatasetsDraw', {\n            cancelable: true\n        }) === false) {\n            return;\n        }\n        const metasets = this.getSortedVisibleDatasetMetas();\n        for(let i = metasets.length - 1; i >= 0; --i){\n            this._drawDataset(metasets[i]);\n        }\n        this.notifyPlugins('afterDatasetsDraw');\n    }\n _drawDataset(meta) {\n        const ctx = this.ctx;\n        const args = {\n            meta,\n            index: meta.index,\n            cancelable: true\n        };\n        const clip = getDatasetClipArea(this, meta);\n        if (this.notifyPlugins('beforeDatasetDraw', args) === false) {\n            return;\n        }\n        if (clip) {\n            clipArea(ctx, clip);\n        }\n        meta.controller.draw();\n        if (clip) {\n            unclipArea(ctx);\n        }\n        args.cancelable = false;\n        this.notifyPlugins('afterDatasetDraw', args);\n    }\n isPointInArea(point) {\n        return _isPointInArea(point, this.chartArea, this._minPadding);\n    }\n    getElementsAtEventForMode(e, mode, options, useFinalPosition) {\n        const method = Interaction.modes[mode];\n        if (typeof method === 'function') {\n            return method(this, e, options, useFinalPosition);\n        }\n        return [];\n    }\n    getDatasetMeta(datasetIndex) {\n        const dataset = this.data.datasets[datasetIndex];\n        const metasets = this._metasets;\n        let meta = metasets.filter((x)=>x && x._dataset === dataset).pop();\n        if (!meta) {\n            meta = {\n                type: null,\n                data: [],\n                dataset: null,\n                controller: null,\n                hidden: null,\n                xAxisID: null,\n                yAxisID: null,\n                order: dataset && dataset.order || 0,\n                index: datasetIndex,\n                _dataset: dataset,\n                _parsed: [],\n                _sorted: false\n            };\n            metasets.push(meta);\n        }\n        return meta;\n    }\n    getContext() {\n        return this.$context || (this.$context = createContext(null, {\n            chart: this,\n            type: 'chart'\n        }));\n    }\n    getVisibleDatasetCount() {\n        return this.getSortedVisibleDatasetMetas().length;\n    }\n    isDatasetVisible(datasetIndex) {\n        const dataset = this.data.datasets[datasetIndex];\n        if (!dataset) {\n            return false;\n        }\n        const meta = this.getDatasetMeta(datasetIndex);\n        return typeof meta.hidden === 'boolean' ? !meta.hidden : !dataset.hidden;\n    }\n    setDatasetVisibility(datasetIndex, visible) {\n        const meta = this.getDatasetMeta(datasetIndex);\n        meta.hidden = !visible;\n    }\n    toggleDataVisibility(index) {\n        this._hiddenIndices[index] = !this._hiddenIndices[index];\n    }\n    getDataVisibility(index) {\n        return !this._hiddenIndices[index];\n    }\n _updateVisibility(datasetIndex, dataIndex, visible) {\n        const mode = visible ? 'show' : 'hide';\n        const meta = this.getDatasetMeta(datasetIndex);\n        const anims = meta.controller._resolveAnimations(undefined, mode);\n        if (defined(dataIndex)) {\n            meta.data[dataIndex].hidden = !visible;\n            this.update();\n        } else {\n            this.setDatasetVisibility(datasetIndex, visible);\n            anims.update(meta, {\n                visible\n            });\n            this.update((ctx)=>ctx.datasetIndex === datasetIndex ? mode : undefined);\n        }\n    }\n    hide(datasetIndex, dataIndex) {\n        this._updateVisibility(datasetIndex, dataIndex, false);\n    }\n    show(datasetIndex, dataIndex) {\n        this._updateVisibility(datasetIndex, dataIndex, true);\n    }\n _destroyDatasetMeta(datasetIndex) {\n        const meta = this._metasets[datasetIndex];\n        if (meta && meta.controller) {\n            meta.controller._destroy();\n        }\n        delete this._metasets[datasetIndex];\n    }\n    _stop() {\n        let i, ilen;\n        this.stop();\n        animator.remove(this);\n        for(i = 0, ilen = this.data.datasets.length; i < ilen; ++i){\n            this._destroyDatasetMeta(i);\n        }\n    }\n    destroy() {\n        this.notifyPlugins('beforeDestroy');\n        const { canvas , ctx  } = this;\n        this._stop();\n        this.config.clearCache();\n        if (canvas) {\n            this.unbindEvents();\n            clearCanvas(canvas, ctx);\n            this.platform.releaseContext(ctx);\n            this.canvas = null;\n            this.ctx = null;\n        }\n        delete instances[this.id];\n        this.notifyPlugins('afterDestroy');\n    }\n    toBase64Image(...args) {\n        return this.canvas.toDataURL(...args);\n    }\n bindEvents() {\n        this.bindUserEvents();\n        if (this.options.responsive) {\n            this.bindResponsiveEvents();\n        } else {\n            this.attached = true;\n        }\n    }\n bindUserEvents() {\n        const listeners = this._listeners;\n        const platform = this.platform;\n        const _add = (type, listener)=>{\n            platform.addEventListener(this, type, listener);\n            listeners[type] = listener;\n        };\n        const listener = (e, x, y)=>{\n            e.offsetX = x;\n            e.offsetY = y;\n            this._eventHandler(e);\n        };\n        each(this.options.events, (type)=>_add(type, listener));\n    }\n bindResponsiveEvents() {\n        if (!this._responsiveListeners) {\n            this._responsiveListeners = {};\n        }\n        const listeners = this._responsiveListeners;\n        const platform = this.platform;\n        const _add = (type, listener)=>{\n            platform.addEventListener(this, type, listener);\n            listeners[type] = listener;\n        };\n        const _remove = (type, listener)=>{\n            if (listeners[type]) {\n                platform.removeEventListener(this, type, listener);\n                delete listeners[type];\n            }\n        };\n        const listener = (width, height)=>{\n            if (this.canvas) {\n                this.resize(width, height);\n            }\n        };\n        let detached;\n        const attached = ()=>{\n            _remove('attach', attached);\n            this.attached = true;\n            this.resize();\n            _add('resize', listener);\n            _add('detach', detached);\n        };\n        detached = ()=>{\n            this.attached = false;\n            _remove('resize', listener);\n            this._stop();\n            this._resize(0, 0);\n            _add('attach', attached);\n        };\n        if (platform.isAttached(this.canvas)) {\n            attached();\n        } else {\n            detached();\n        }\n    }\n unbindEvents() {\n        each(this._listeners, (listener, type)=>{\n            this.platform.removeEventListener(this, type, listener);\n        });\n        this._listeners = {};\n        each(this._responsiveListeners, (listener, type)=>{\n            this.platform.removeEventListener(this, type, listener);\n        });\n        this._responsiveListeners = undefined;\n    }\n    updateHoverStyle(items, mode, enabled) {\n        const prefix = enabled ? 'set' : 'remove';\n        let meta, item, i, ilen;\n        if (mode === 'dataset') {\n            meta = this.getDatasetMeta(items[0].datasetIndex);\n            meta.controller['_' + prefix + 'DatasetHoverStyle']();\n        }\n        for(i = 0, ilen = items.length; i < ilen; ++i){\n            item = items[i];\n            const controller = item && this.getDatasetMeta(item.datasetIndex).controller;\n            if (controller) {\n                controller[prefix + 'HoverStyle'](item.element, item.datasetIndex, item.index);\n            }\n        }\n    }\n getActiveElements() {\n        return this._active || [];\n    }\n setActiveElements(activeElements) {\n        const lastActive = this._active || [];\n        const active = activeElements.map(({ datasetIndex , index  })=>{\n            const meta = this.getDatasetMeta(datasetIndex);\n            if (!meta) {\n                throw new Error('No dataset found at index ' + datasetIndex);\n            }\n            return {\n                datasetIndex,\n                element: meta.data[index],\n                index\n            };\n        });\n        const changed = !_elementsEqual(active, lastActive);\n        if (changed) {\n            this._active = active;\n            this._lastEvent = null;\n            this._updateHoverStyles(active, lastActive);\n        }\n    }\n notifyPlugins(hook, args, filter) {\n        return this._plugins.notify(this, hook, args, filter);\n    }\n isPluginEnabled(pluginId) {\n        return this._plugins._cache.filter((p)=>p.plugin.id === pluginId).length === 1;\n    }\n _updateHoverStyles(active, lastActive, replay) {\n        const hoverOptions = this.options.hover;\n        const diff = (a, b)=>a.filter((x)=>!b.some((y)=>x.datasetIndex === y.datasetIndex && x.index === y.index));\n        const deactivated = diff(lastActive, active);\n        const activated = replay ? active : diff(active, lastActive);\n        if (deactivated.length) {\n            this.updateHoverStyle(deactivated, hoverOptions.mode, false);\n        }\n        if (activated.length && hoverOptions.mode) {\n            this.updateHoverStyle(activated, hoverOptions.mode, true);\n        }\n    }\n _eventHandler(e, replay) {\n        const args = {\n            event: e,\n            replay,\n            cancelable: true,\n            inChartArea: this.isPointInArea(e)\n        };\n        const eventFilter = (plugin)=>(plugin.options.events || this.options.events).includes(e.native.type);\n        if (this.notifyPlugins('beforeEvent', args, eventFilter) === false) {\n            return;\n        }\n        const changed = this._handleEvent(e, replay, args.inChartArea);\n        args.cancelable = false;\n        this.notifyPlugins('afterEvent', args, eventFilter);\n        if (changed || args.changed) {\n            this.render();\n        }\n        return this;\n    }\n _handleEvent(e, replay, inChartArea) {\n        const { _active: lastActive = [] , options  } = this;\n        const useFinalPosition = replay;\n        const active = this._getActiveElements(e, lastActive, inChartArea, useFinalPosition);\n        const isClick = _isClickEvent(e);\n        const lastEvent = determineLastEvent(e, this._lastEvent, inChartArea, isClick);\n        if (inChartArea) {\n            this._lastEvent = null;\n            callback(options.onHover, [\n                e,\n                active,\n                this\n            ], this);\n            if (isClick) {\n                callback(options.onClick, [\n                    e,\n                    active,\n                    this\n                ], this);\n            }\n        }\n        const changed = !_elementsEqual(active, lastActive);\n        if (changed || replay) {\n            this._active = active;\n            this._updateHoverStyles(active, lastActive, replay);\n        }\n        this._lastEvent = lastEvent;\n        return changed;\n    }\n _getActiveElements(e, lastActive, inChartArea, useFinalPosition) {\n        if (e.type === 'mouseout') {\n            return [];\n        }\n        if (!inChartArea) {\n            return lastActive;\n        }\n        const hoverOptions = this.options.hover;\n        return this.getElementsAtEventForMode(e, hoverOptions.mode, hoverOptions, useFinalPosition);\n    }\n}\nfunction invalidatePlugins() {\n    return each(Chart.instances, (chart)=>chart._plugins.invalidate());\n}\n\nfunction clipSelf(ctx, element, endAngle) {\n    const { startAngle , x , y , outerRadius , innerRadius , options  } = element;\n    const { borderWidth , borderJoinStyle  } = options;\n    const outerAngleClip = Math.min(borderWidth / outerRadius, _normalizeAngle(startAngle - endAngle));\n    ctx.beginPath();\n    ctx.arc(x, y, outerRadius - borderWidth / 2, startAngle + outerAngleClip / 2, endAngle - outerAngleClip / 2);\n    if (innerRadius > 0) {\n        const innerAngleClip = Math.min(borderWidth / innerRadius, _normalizeAngle(startAngle - endAngle));\n        ctx.arc(x, y, innerRadius + borderWidth / 2, endAngle - innerAngleClip / 2, startAngle + innerAngleClip / 2, true);\n    } else {\n        const clipWidth = Math.min(borderWidth / 2, outerRadius * _normalizeAngle(startAngle - endAngle));\n        if (borderJoinStyle === 'round') {\n            ctx.arc(x, y, clipWidth, endAngle - PI / 2, startAngle + PI / 2, true);\n        } else if (borderJoinStyle === 'bevel') {\n            const r = 2 * clipWidth * clipWidth;\n            const endX = -r * Math.cos(endAngle + PI / 2) + x;\n            const endY = -r * Math.sin(endAngle + PI / 2) + y;\n            const startX = r * Math.cos(startAngle + PI / 2) + x;\n            const startY = r * Math.sin(startAngle + PI / 2) + y;\n            ctx.lineTo(endX, endY);\n            ctx.lineTo(startX, startY);\n        }\n    }\n    ctx.closePath();\n    ctx.moveTo(0, 0);\n    ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    ctx.clip('evenodd');\n}\nfunction clipArc(ctx, element, endAngle) {\n    const { startAngle , pixelMargin , x , y , outerRadius , innerRadius  } = element;\n    let angleMargin = pixelMargin / outerRadius;\n    // Draw an inner border by clipping the arc and drawing a double-width border\n    // Enlarge the clipping arc by 0.33 pixels to eliminate glitches between borders\n    ctx.beginPath();\n    ctx.arc(x, y, outerRadius, startAngle - angleMargin, endAngle + angleMargin);\n    if (innerRadius > pixelMargin) {\n        angleMargin = pixelMargin / innerRadius;\n        ctx.arc(x, y, innerRadius, endAngle + angleMargin, startAngle - angleMargin, true);\n    } else {\n        ctx.arc(x, y, pixelMargin, endAngle + HALF_PI, startAngle - HALF_PI);\n    }\n    ctx.closePath();\n    ctx.clip();\n}\nfunction toRadiusCorners(value) {\n    return _readValueToProps(value, [\n        'outerStart',\n        'outerEnd',\n        'innerStart',\n        'innerEnd'\n    ]);\n}\n/**\n * Parse border radius from the provided options\n */ function parseBorderRadius$1(arc, innerRadius, outerRadius, angleDelta) {\n    const o = toRadiusCorners(arc.options.borderRadius);\n    const halfThickness = (outerRadius - innerRadius) / 2;\n    const innerLimit = Math.min(halfThickness, angleDelta * innerRadius / 2);\n    // Outer limits are complicated. We want to compute the available angular distance at\n    // a radius of outerRadius - borderRadius because for small angular distances, this term limits.\n    // We compute at r = outerRadius - borderRadius because this circle defines the center of the border corners.\n    //\n    // If the borderRadius is large, that value can become negative.\n    // This causes the outer borders to lose their radius entirely, which is rather unexpected. To solve that, if borderRadius > outerRadius\n    // we know that the thickness term will dominate and compute the limits at that point\n    const computeOuterLimit = (val)=>{\n        const outerArcLimit = (outerRadius - Math.min(halfThickness, val)) * angleDelta / 2;\n        return _limitValue(val, 0, Math.min(halfThickness, outerArcLimit));\n    };\n    return {\n        outerStart: computeOuterLimit(o.outerStart),\n        outerEnd: computeOuterLimit(o.outerEnd),\n        innerStart: _limitValue(o.innerStart, 0, innerLimit),\n        innerEnd: _limitValue(o.innerEnd, 0, innerLimit)\n    };\n}\n/**\n * Convert (r, ) to (x, y)\n */ function rThetaToXY(r, theta, x, y) {\n    return {\n        x: x + r * Math.cos(theta),\n        y: y + r * Math.sin(theta)\n    };\n}\n/**\n * Path the arc, respecting border radius by separating into left and right halves.\n *\n *   Start      End\n *\n *    1--->a--->2    Outer\n *   /           \\\n *   8           3\n *   |           |\n *   |           |\n *   7           4\n *   \\           /\n *    6<---b<---5    Inner\n */ function pathArc(ctx, element, offset, spacing, end, circular) {\n    const { x , y , startAngle: start , pixelMargin , innerRadius: innerR  } = element;\n    const outerRadius = Math.max(element.outerRadius + spacing + offset - pixelMargin, 0);\n    const innerRadius = innerR > 0 ? innerR + spacing + offset + pixelMargin : 0;\n    let spacingOffset = 0;\n    const alpha = end - start;\n    if (spacing) {\n        // When spacing is present, it is the same for all items\n        // So we adjust the start and end angle of the arc such that\n        // the distance is the same as it would be without the spacing\n        const noSpacingInnerRadius = innerR > 0 ? innerR - spacing : 0;\n        const noSpacingOuterRadius = outerRadius > 0 ? outerRadius - spacing : 0;\n        const avNogSpacingRadius = (noSpacingInnerRadius + noSpacingOuterRadius) / 2;\n        const adjustedAngle = avNogSpacingRadius !== 0 ? alpha * avNogSpacingRadius / (avNogSpacingRadius + spacing) : alpha;\n        spacingOffset = (alpha - adjustedAngle) / 2;\n    }\n    const beta = Math.max(0.001, alpha * outerRadius - offset / PI) / outerRadius;\n    const angleOffset = (alpha - beta) / 2;\n    const startAngle = start + angleOffset + spacingOffset;\n    const endAngle = end - angleOffset - spacingOffset;\n    const { outerStart , outerEnd , innerStart , innerEnd  } = parseBorderRadius$1(element, innerRadius, outerRadius, endAngle - startAngle);\n    const outerStartAdjustedRadius = outerRadius - outerStart;\n    const outerEndAdjustedRadius = outerRadius - outerEnd;\n    const outerStartAdjustedAngle = startAngle + outerStart / outerStartAdjustedRadius;\n    const outerEndAdjustedAngle = endAngle - outerEnd / outerEndAdjustedRadius;\n    const innerStartAdjustedRadius = innerRadius + innerStart;\n    const innerEndAdjustedRadius = innerRadius + innerEnd;\n    const innerStartAdjustedAngle = startAngle + innerStart / innerStartAdjustedRadius;\n    const innerEndAdjustedAngle = endAngle - innerEnd / innerEndAdjustedRadius;\n    ctx.beginPath();\n    if (circular) {\n        // The first arc segments from point 1 to point a to point 2\n        const outerMidAdjustedAngle = (outerStartAdjustedAngle + outerEndAdjustedAngle) / 2;\n        ctx.arc(x, y, outerRadius, outerStartAdjustedAngle, outerMidAdjustedAngle);\n        ctx.arc(x, y, outerRadius, outerMidAdjustedAngle, outerEndAdjustedAngle);\n        // The corner segment from point 2 to point 3\n        if (outerEnd > 0) {\n            const pCenter = rThetaToXY(outerEndAdjustedRadius, outerEndAdjustedAngle, x, y);\n            ctx.arc(pCenter.x, pCenter.y, outerEnd, outerEndAdjustedAngle, endAngle + HALF_PI);\n        }\n        // The line from point 3 to point 4\n        const p4 = rThetaToXY(innerEndAdjustedRadius, endAngle, x, y);\n        ctx.lineTo(p4.x, p4.y);\n        // The corner segment from point 4 to point 5\n        if (innerEnd > 0) {\n            const pCenter = rThetaToXY(innerEndAdjustedRadius, innerEndAdjustedAngle, x, y);\n            ctx.arc(pCenter.x, pCenter.y, innerEnd, endAngle + HALF_PI, innerEndAdjustedAngle + Math.PI);\n        }\n        // The inner arc from point 5 to point b to point 6\n        const innerMidAdjustedAngle = (endAngle - innerEnd / innerRadius + (startAngle + innerStart / innerRadius)) / 2;\n        ctx.arc(x, y, innerRadius, endAngle - innerEnd / innerRadius, innerMidAdjustedAngle, true);\n        ctx.arc(x, y, innerRadius, innerMidAdjustedAngle, startAngle + innerStart / innerRadius, true);\n        // The corner segment from point 6 to point 7\n        if (innerStart > 0) {\n            const pCenter = rThetaToXY(innerStartAdjustedRadius, innerStartAdjustedAngle, x, y);\n            ctx.arc(pCenter.x, pCenter.y, innerStart, innerStartAdjustedAngle + Math.PI, startAngle - HALF_PI);\n        }\n        // The line from point 7 to point 8\n        const p8 = rThetaToXY(outerStartAdjustedRadius, startAngle, x, y);\n        ctx.lineTo(p8.x, p8.y);\n        // The corner segment from point 8 to point 1\n        if (outerStart > 0) {\n            const pCenter = rThetaToXY(outerStartAdjustedRadius, outerStartAdjustedAngle, x, y);\n            ctx.arc(pCenter.x, pCenter.y, outerStart, startAngle - HALF_PI, outerStartAdjustedAngle);\n        }\n    } else {\n        ctx.moveTo(x, y);\n        const outerStartX = Math.cos(outerStartAdjustedAngle) * outerRadius + x;\n        const outerStartY = Math.sin(outerStartAdjustedAngle) * outerRadius + y;\n        ctx.lineTo(outerStartX, outerStartY);\n        const outerEndX = Math.cos(outerEndAdjustedAngle) * outerRadius + x;\n        const outerEndY = Math.sin(outerEndAdjustedAngle) * outerRadius + y;\n        ctx.lineTo(outerEndX, outerEndY);\n    }\n    ctx.closePath();\n}\nfunction drawArc(ctx, element, offset, spacing, circular) {\n    const { fullCircles , startAngle , circumference  } = element;\n    let endAngle = element.endAngle;\n    if (fullCircles) {\n        pathArc(ctx, element, offset, spacing, endAngle, circular);\n        for(let i = 0; i < fullCircles; ++i){\n            ctx.fill();\n        }\n        if (!isNaN(circumference)) {\n            endAngle = startAngle + (circumference % TAU || TAU);\n        }\n    }\n    pathArc(ctx, element, offset, spacing, endAngle, circular);\n    ctx.fill();\n    return endAngle;\n}\nfunction drawBorder(ctx, element, offset, spacing, circular) {\n    const { fullCircles , startAngle , circumference , options  } = element;\n    const { borderWidth , borderJoinStyle , borderDash , borderDashOffset , borderRadius  } = options;\n    const inner = options.borderAlign === 'inner';\n    if (!borderWidth) {\n        return;\n    }\n    ctx.setLineDash(borderDash || []);\n    ctx.lineDashOffset = borderDashOffset;\n    if (inner) {\n        ctx.lineWidth = borderWidth * 2;\n        ctx.lineJoin = borderJoinStyle || 'round';\n    } else {\n        ctx.lineWidth = borderWidth;\n        ctx.lineJoin = borderJoinStyle || 'bevel';\n    }\n    let endAngle = element.endAngle;\n    if (fullCircles) {\n        pathArc(ctx, element, offset, spacing, endAngle, circular);\n        for(let i = 0; i < fullCircles; ++i){\n            ctx.stroke();\n        }\n        if (!isNaN(circumference)) {\n            endAngle = startAngle + (circumference % TAU || TAU);\n        }\n    }\n    if (inner) {\n        clipArc(ctx, element, endAngle);\n    }\n    if (options.selfJoin && endAngle - startAngle >= PI && borderRadius === 0 && borderJoinStyle !== 'miter') {\n        clipSelf(ctx, element, endAngle);\n    }\n    if (!fullCircles) {\n        pathArc(ctx, element, offset, spacing, endAngle, circular);\n        ctx.stroke();\n    }\n}\nclass ArcElement extends Element {\n    static id = 'arc';\n    static defaults = {\n        borderAlign: 'center',\n        borderColor: '#fff',\n        borderDash: [],\n        borderDashOffset: 0,\n        borderJoinStyle: undefined,\n        borderRadius: 0,\n        borderWidth: 2,\n        offset: 0,\n        spacing: 0,\n        angle: undefined,\n        circular: true,\n        selfJoin: false\n    };\n    static defaultRoutes = {\n        backgroundColor: 'backgroundColor'\n    };\n    static descriptors = {\n        _scriptable: true,\n        _indexable: (name)=>name !== 'borderDash'\n    };\n    circumference;\n    endAngle;\n    fullCircles;\n    innerRadius;\n    outerRadius;\n    pixelMargin;\n    startAngle;\n    constructor(cfg){\n        super();\n        this.options = undefined;\n        this.circumference = undefined;\n        this.startAngle = undefined;\n        this.endAngle = undefined;\n        this.innerRadius = undefined;\n        this.outerRadius = undefined;\n        this.pixelMargin = 0;\n        this.fullCircles = 0;\n        if (cfg) {\n            Object.assign(this, cfg);\n        }\n    }\n    inRange(chartX, chartY, useFinalPosition) {\n        const point = this.getProps([\n            'x',\n            'y'\n        ], useFinalPosition);\n        const { angle , distance  } = getAngleFromPoint(point, {\n            x: chartX,\n            y: chartY\n        });\n        const { startAngle , endAngle , innerRadius , outerRadius , circumference  } = this.getProps([\n            'startAngle',\n            'endAngle',\n            'innerRadius',\n            'outerRadius',\n            'circumference'\n        ], useFinalPosition);\n        const rAdjust = (this.options.spacing + this.options.borderWidth) / 2;\n        const _circumference = valueOrDefault(circumference, endAngle - startAngle);\n        const nonZeroBetween = _angleBetween(angle, startAngle, endAngle) && startAngle !== endAngle;\n        const betweenAngles = _circumference >= TAU || nonZeroBetween;\n        const withinRadius = _isBetween(distance, innerRadius + rAdjust, outerRadius + rAdjust);\n        return betweenAngles && withinRadius;\n    }\n    getCenterPoint(useFinalPosition) {\n        const { x , y , startAngle , endAngle , innerRadius , outerRadius  } = this.getProps([\n            'x',\n            'y',\n            'startAngle',\n            'endAngle',\n            'innerRadius',\n            'outerRadius'\n        ], useFinalPosition);\n        const { offset , spacing  } = this.options;\n        const halfAngle = (startAngle + endAngle) / 2;\n        const halfRadius = (innerRadius + outerRadius + spacing + offset) / 2;\n        return {\n            x: x + Math.cos(halfAngle) * halfRadius,\n            y: y + Math.sin(halfAngle) * halfRadius\n        };\n    }\n    tooltipPosition(useFinalPosition) {\n        return this.getCenterPoint(useFinalPosition);\n    }\n    draw(ctx) {\n        const { options , circumference  } = this;\n        const offset = (options.offset || 0) / 4;\n        const spacing = (options.spacing || 0) / 2;\n        const circular = options.circular;\n        this.pixelMargin = options.borderAlign === 'inner' ? 0.33 : 0;\n        this.fullCircles = circumference > TAU ? Math.floor(circumference / TAU) : 0;\n        if (circumference === 0 || this.innerRadius < 0 || this.outerRadius < 0) {\n            return;\n        }\n        ctx.save();\n        const halfAngle = (this.startAngle + this.endAngle) / 2;\n        ctx.translate(Math.cos(halfAngle) * offset, Math.sin(halfAngle) * offset);\n        const fix = 1 - Math.sin(Math.min(PI, circumference || 0));\n        const radiusOffset = offset * fix;\n        ctx.fillStyle = options.backgroundColor;\n        ctx.strokeStyle = options.borderColor;\n        drawArc(ctx, this, radiusOffset, spacing, circular);\n        drawBorder(ctx, this, radiusOffset, spacing, circular);\n        ctx.restore();\n    }\n}\n\nfunction setStyle(ctx, options, style = options) {\n    ctx.lineCap = valueOrDefault(style.borderCapStyle, options.borderCapStyle);\n    ctx.setLineDash(valueOrDefault(style.borderDash, options.borderDash));\n    ctx.lineDashOffset = valueOrDefault(style.borderDashOffset, options.borderDashOffset);\n    ctx.lineJoin = valueOrDefault(style.borderJoinStyle, options.borderJoinStyle);\n    ctx.lineWidth = valueOrDefault(style.borderWidth, options.borderWidth);\n    ctx.strokeStyle = valueOrDefault(style.borderColor, options.borderColor);\n}\nfunction lineTo(ctx, previous, target) {\n    ctx.lineTo(target.x, target.y);\n}\n function getLineMethod(options) {\n    if (options.stepped) {\n        return _steppedLineTo;\n    }\n    if (options.tension || options.cubicInterpolationMode === 'monotone') {\n        return _bezierCurveTo;\n    }\n    return lineTo;\n}\nfunction pathVars(points, segment, params = {}) {\n    const count = points.length;\n    const { start: paramsStart = 0 , end: paramsEnd = count - 1  } = params;\n    const { start: segmentStart , end: segmentEnd  } = segment;\n    const start = Math.max(paramsStart, segmentStart);\n    const end = Math.min(paramsEnd, segmentEnd);\n    const outside = paramsStart < segmentStart && paramsEnd < segmentStart || paramsStart > segmentEnd && paramsEnd > segmentEnd;\n    return {\n        count,\n        start,\n        loop: segment.loop,\n        ilen: end < start && !outside ? count + end - start : end - start\n    };\n}\n function pathSegment(ctx, line, segment, params) {\n    const { points , options  } = line;\n    const { count , start , loop , ilen  } = pathVars(points, segment, params);\n    const lineMethod = getLineMethod(options);\n    let { move =true , reverse  } = params || {};\n    let i, point, prev;\n    for(i = 0; i <= ilen; ++i){\n        point = points[(start + (reverse ? ilen - i : i)) % count];\n        if (point.skip) {\n            continue;\n        } else if (move) {\n            ctx.moveTo(point.x, point.y);\n            move = false;\n        } else {\n            lineMethod(ctx, prev, point, reverse, options.stepped);\n        }\n        prev = point;\n    }\n    if (loop) {\n        point = points[(start + (reverse ? ilen : 0)) % count];\n        lineMethod(ctx, prev, point, reverse, options.stepped);\n    }\n    return !!loop;\n}\n function fastPathSegment(ctx, line, segment, params) {\n    const points = line.points;\n    const { count , start , ilen  } = pathVars(points, segment, params);\n    const { move =true , reverse  } = params || {};\n    let avgX = 0;\n    let countX = 0;\n    let i, point, prevX, minY, maxY, lastY;\n    const pointIndex = (index)=>(start + (reverse ? ilen - index : index)) % count;\n    const drawX = ()=>{\n        if (minY !== maxY) {\n            ctx.lineTo(avgX, maxY);\n            ctx.lineTo(avgX, minY);\n            ctx.lineTo(avgX, lastY);\n        }\n    };\n    if (move) {\n        point = points[pointIndex(0)];\n        ctx.moveTo(point.x, point.y);\n    }\n    for(i = 0; i <= ilen; ++i){\n        point = points[pointIndex(i)];\n        if (point.skip) {\n            continue;\n        }\n        const x = point.x;\n        const y = point.y;\n        const truncX = x | 0;\n        if (truncX === prevX) {\n            if (y < minY) {\n                minY = y;\n            } else if (y > maxY) {\n                maxY = y;\n            }\n            avgX = (countX * avgX + x) / ++countX;\n        } else {\n            drawX();\n            ctx.lineTo(x, y);\n            prevX = truncX;\n            countX = 0;\n            minY = maxY = y;\n        }\n        lastY = y;\n    }\n    drawX();\n}\n function _getSegmentMethod(line) {\n    const opts = line.options;\n    const borderDash = opts.borderDash && opts.borderDash.length;\n    const useFastPath = !line._decimated && !line._loop && !opts.tension && opts.cubicInterpolationMode !== 'monotone' && !opts.stepped && !borderDash;\n    return useFastPath ? fastPathSegment : pathSegment;\n}\n function _getInterpolationMethod(options) {\n    if (options.stepped) {\n        return _steppedInterpolation;\n    }\n    if (options.tension || options.cubicInterpolationMode === 'monotone') {\n        return _bezierInterpolation;\n    }\n    return _pointInLine;\n}\nfunction strokePathWithCache(ctx, line, start, count) {\n    let path = line._path;\n    if (!path) {\n        path = line._path = new Path2D();\n        if (line.path(path, start, count)) {\n            path.closePath();\n        }\n    }\n    setStyle(ctx, line.options);\n    ctx.stroke(path);\n}\nfunction strokePathDirect(ctx, line, start, count) {\n    const { segments , options  } = line;\n    const segmentMethod = _getSegmentMethod(line);\n    for (const segment of segments){\n        setStyle(ctx, options, segment.style);\n        ctx.beginPath();\n        if (segmentMethod(ctx, line, segment, {\n            start,\n            end: start + count - 1\n        })) {\n            ctx.closePath();\n        }\n        ctx.stroke();\n    }\n}\nconst usePath2D = typeof Path2D === 'function';\nfunction draw(ctx, line, start, count) {\n    if (usePath2D && !line.options.segment) {\n        strokePathWithCache(ctx, line, start, count);\n    } else {\n        strokePathDirect(ctx, line, start, count);\n    }\n}\nclass LineElement extends Element {\n    static id = 'line';\n static defaults = {\n        borderCapStyle: 'butt',\n        borderDash: [],\n        borderDashOffset: 0,\n        borderJoinStyle: 'miter',\n        borderWidth: 3,\n        capBezierPoints: true,\n        cubicInterpolationMode: 'default',\n        fill: false,\n        spanGaps: false,\n        stepped: false,\n        tension: 0\n    };\n static defaultRoutes = {\n        backgroundColor: 'backgroundColor',\n        borderColor: 'borderColor'\n    };\n    static descriptors = {\n        _scriptable: true,\n        _indexable: (name)=>name !== 'borderDash' && name !== 'fill'\n    };\n    constructor(cfg){\n        super();\n        this.animated = true;\n        this.options = undefined;\n        this._chart = undefined;\n        this._loop = undefined;\n        this._fullLoop = undefined;\n        this._path = undefined;\n        this._points = undefined;\n        this._segments = undefined;\n        this._decimated = false;\n        this._pointsUpdated = false;\n        this._datasetIndex = undefined;\n        if (cfg) {\n            Object.assign(this, cfg);\n        }\n    }\n    updateControlPoints(chartArea, indexAxis) {\n        const options = this.options;\n        if ((options.tension || options.cubicInterpolationMode === 'monotone') && !options.stepped && !this._pointsUpdated) {\n            const loop = options.spanGaps ? this._loop : this._fullLoop;\n            _updateBezierControlPoints(this._points, options, chartArea, loop, indexAxis);\n            this._pointsUpdated = true;\n        }\n    }\n    set points(points) {\n        this._points = points;\n        delete this._segments;\n        delete this._path;\n        this._pointsUpdated = false;\n    }\n    get points() {\n        return this._points;\n    }\n    get segments() {\n        return this._segments || (this._segments = _computeSegments(this, this.options.segment));\n    }\n first() {\n        const segments = this.segments;\n        const points = this.points;\n        return segments.length && points[segments[0].start];\n    }\n last() {\n        const segments = this.segments;\n        const points = this.points;\n        const count = segments.length;\n        return count && points[segments[count - 1].end];\n    }\n interpolate(point, property) {\n        const options = this.options;\n        const value = point[property];\n        const points = this.points;\n        const segments = _boundSegments(this, {\n            property,\n            start: value,\n            end: value\n        });\n        if (!segments.length) {\n            return;\n        }\n        const result = [];\n        const _interpolate = _getInterpolationMethod(options);\n        let i, ilen;\n        for(i = 0, ilen = segments.length; i < ilen; ++i){\n            const { start , end  } = segments[i];\n            const p1 = points[start];\n            const p2 = points[end];\n            if (p1 === p2) {\n                result.push(p1);\n                continue;\n            }\n            const t = Math.abs((value - p1[property]) / (p2[property] - p1[property]));\n            const interpolated = _interpolate(p1, p2, t, options.stepped);\n            interpolated[property] = point[property];\n            result.push(interpolated);\n        }\n        return result.length === 1 ? result[0] : result;\n    }\n pathSegment(ctx, segment, params) {\n        const segmentMethod = _getSegmentMethod(this);\n        return segmentMethod(ctx, this, segment, params);\n    }\n path(ctx, start, count) {\n        const segments = this.segments;\n        const segmentMethod = _getSegmentMethod(this);\n        let loop = this._loop;\n        start = start || 0;\n        count = count || this.points.length - start;\n        for (const segment of segments){\n            loop &= segmentMethod(ctx, this, segment, {\n                start,\n                end: start + count - 1\n            });\n        }\n        return !!loop;\n    }\n draw(ctx, chartArea, start, count) {\n        const options = this.options || {};\n        const points = this.points || [];\n        if (points.length && options.borderWidth) {\n            ctx.save();\n            draw(ctx, this, start, count);\n            ctx.restore();\n        }\n        if (this.animated) {\n            this._pointsUpdated = false;\n            this._path = undefined;\n        }\n    }\n}\n\nfunction inRange$1(el, pos, axis, useFinalPosition) {\n    const options = el.options;\n    const { [axis]: value  } = el.getProps([\n        axis\n    ], useFinalPosition);\n    return Math.abs(pos - value) < options.radius + options.hitRadius;\n}\nclass PointElement extends Element {\n    static id = 'point';\n    parsed;\n    skip;\n    stop;\n    /**\n   * @type {any}\n   */ static defaults = {\n        borderWidth: 1,\n        hitRadius: 1,\n        hoverBorderWidth: 1,\n        hoverRadius: 4,\n        pointStyle: 'circle',\n        radius: 3,\n        rotation: 0\n    };\n    /**\n   * @type {any}\n   */ static defaultRoutes = {\n        backgroundColor: 'backgroundColor',\n        borderColor: 'borderColor'\n    };\n    constructor(cfg){\n        super();\n        this.options = undefined;\n        this.parsed = undefined;\n        this.skip = undefined;\n        this.stop = undefined;\n        if (cfg) {\n            Object.assign(this, cfg);\n        }\n    }\n    inRange(mouseX, mouseY, useFinalPosition) {\n        const options = this.options;\n        const { x , y  } = this.getProps([\n            'x',\n            'y'\n        ], useFinalPosition);\n        return Math.pow(mouseX - x, 2) + Math.pow(mouseY - y, 2) < Math.pow(options.hitRadius + options.radius, 2);\n    }\n    inXRange(mouseX, useFinalPosition) {\n        return inRange$1(this, mouseX, 'x', useFinalPosition);\n    }\n    inYRange(mouseY, useFinalPosition) {\n        return inRange$1(this, mouseY, 'y', useFinalPosition);\n    }\n    getCenterPoint(useFinalPosition) {\n        const { x , y  } = this.getProps([\n            'x',\n            'y'\n        ], useFinalPosition);\n        return {\n            x,\n            y\n        };\n    }\n    size(options) {\n        options = options || this.options || {};\n        let radius = options.radius || 0;\n        radius = Math.max(radius, radius && options.hoverRadius || 0);\n        const borderWidth = radius && options.borderWidth || 0;\n        return (radius + borderWidth) * 2;\n    }\n    draw(ctx, area) {\n        const options = this.options;\n        if (this.skip || options.radius < 0.1 || !_isPointInArea(this, area, this.size(options) / 2)) {\n            return;\n        }\n        ctx.strokeStyle = options.borderColor;\n        ctx.lineWidth = options.borderWidth;\n        ctx.fillStyle = options.backgroundColor;\n        drawPoint(ctx, options, this.x, this.y);\n    }\n    getRange() {\n        const options = this.options || {};\n        // @ts-expect-error Fallbacks should never be hit in practice\n        return options.radius + options.hitRadius;\n    }\n}\n\nfunction getBarBounds(bar, useFinalPosition) {\n    const { x , y , base , width , height  } =  bar.getProps([\n        'x',\n        'y',\n        'base',\n        'width',\n        'height'\n    ], useFinalPosition);\n    let left, right, top, bottom, half;\n    if (bar.horizontal) {\n        half = height / 2;\n        left = Math.min(x, base);\n        right = Math.max(x, base);\n        top = y - half;\n        bottom = y + half;\n    } else {\n        half = width / 2;\n        left = x - half;\n        right = x + half;\n        top = Math.min(y, base);\n        bottom = Math.max(y, base);\n    }\n    return {\n        left,\n        top,\n        right,\n        bottom\n    };\n}\nfunction skipOrLimit(skip, value, min, max) {\n    return skip ? 0 : _limitValue(value, min, max);\n}\nfunction parseBorderWidth(bar, maxW, maxH) {\n    const value = bar.options.borderWidth;\n    const skip = bar.borderSkipped;\n    const o = toTRBL(value);\n    return {\n        t: skipOrLimit(skip.top, o.top, 0, maxH),\n        r: skipOrLimit(skip.right, o.right, 0, maxW),\n        b: skipOrLimit(skip.bottom, o.bottom, 0, maxH),\n        l: skipOrLimit(skip.left, o.left, 0, maxW)\n    };\n}\nfunction parseBorderRadius(bar, maxW, maxH) {\n    const { enableBorderRadius  } = bar.getProps([\n        'enableBorderRadius'\n    ]);\n    const value = bar.options.borderRadius;\n    const o = toTRBLCorners(value);\n    const maxR = Math.min(maxW, maxH);\n    const skip = bar.borderSkipped;\n    const enableBorder = enableBorderRadius || isObject(value);\n    return {\n        topLeft: skipOrLimit(!enableBorder || skip.top || skip.left, o.topLeft, 0, maxR),\n        topRight: skipOrLimit(!enableBorder || skip.top || skip.right, o.topRight, 0, maxR),\n        bottomLeft: skipOrLimit(!enableBorder || skip.bottom || skip.left, o.bottomLeft, 0, maxR),\n        bottomRight: skipOrLimit(!enableBorder || skip.bottom || skip.right, o.bottomRight, 0, maxR)\n    };\n}\nfunction boundingRects(bar) {\n    const bounds = getBarBounds(bar);\n    const width = bounds.right - bounds.left;\n    const height = bounds.bottom - bounds.top;\n    const border = parseBorderWidth(bar, width / 2, height / 2);\n    const radius = parseBorderRadius(bar, width / 2, height / 2);\n    return {\n        outer: {\n            x: bounds.left,\n            y: bounds.top,\n            w: width,\n            h: height,\n            radius\n        },\n        inner: {\n            x: bounds.left + border.l,\n            y: bounds.top + border.t,\n            w: width - border.l - border.r,\n            h: height - border.t - border.b,\n            radius: {\n                topLeft: Math.max(0, radius.topLeft - Math.max(border.t, border.l)),\n                topRight: Math.max(0, radius.topRight - Math.max(border.t, border.r)),\n                bottomLeft: Math.max(0, radius.bottomLeft - Math.max(border.b, border.l)),\n                bottomRight: Math.max(0, radius.bottomRight - Math.max(border.b, border.r))\n            }\n        }\n    };\n}\nfunction inRange(bar, x, y, useFinalPosition) {\n    const skipX = x === null;\n    const skipY = y === null;\n    const skipBoth = skipX && skipY;\n    const bounds = bar && !skipBoth && getBarBounds(bar, useFinalPosition);\n    return bounds && (skipX || _isBetween(x, bounds.left, bounds.right)) && (skipY || _isBetween(y, bounds.top, bounds.bottom));\n}\nfunction hasRadius(radius) {\n    return radius.topLeft || radius.topRight || radius.bottomLeft || radius.bottomRight;\n}\n function addNormalRectPath(ctx, rect) {\n    ctx.rect(rect.x, rect.y, rect.w, rect.h);\n}\nfunction inflateRect(rect, amount, refRect = {}) {\n    const x = rect.x !== refRect.x ? -amount : 0;\n    const y = rect.y !== refRect.y ? -amount : 0;\n    const w = (rect.x + rect.w !== refRect.x + refRect.w ? amount : 0) - x;\n    const h = (rect.y + rect.h !== refRect.y + refRect.h ? amount : 0) - y;\n    return {\n        x: rect.x + x,\n        y: rect.y + y,\n        w: rect.w + w,\n        h: rect.h + h,\n        radius: rect.radius\n    };\n}\nclass BarElement extends Element {\n    static id = 'bar';\n static defaults = {\n        borderSkipped: 'start',\n        borderWidth: 0,\n        borderRadius: 0,\n        inflateAmount: 'auto',\n        pointStyle: undefined\n    };\n static defaultRoutes = {\n        backgroundColor: 'backgroundColor',\n        borderColor: 'borderColor'\n    };\n    constructor(cfg){\n        super();\n        this.options = undefined;\n        this.horizontal = undefined;\n        this.base = undefined;\n        this.width = undefined;\n        this.height = undefined;\n        this.inflateAmount = undefined;\n        if (cfg) {\n            Object.assign(this, cfg);\n        }\n    }\n    draw(ctx) {\n        const { inflateAmount , options: { borderColor , backgroundColor  }  } = this;\n        const { inner , outer  } = boundingRects(this);\n        const addRectPath = hasRadius(outer.radius) ? addRoundedRectPath : addNormalRectPath;\n        ctx.save();\n        if (outer.w !== inner.w || outer.h !== inner.h) {\n            ctx.beginPath();\n            addRectPath(ctx, inflateRect(outer, inflateAmount, inner));\n            ctx.clip();\n            addRectPath(ctx, inflateRect(inner, -inflateAmount, outer));\n            ctx.fillStyle = borderColor;\n            ctx.fill('evenodd');\n        }\n        ctx.beginPath();\n        addRectPath(ctx, inflateRect(inner, inflateAmount));\n        ctx.fillStyle = backgroundColor;\n        ctx.fill();\n        ctx.restore();\n    }\n    inRange(mouseX, mouseY, useFinalPosition) {\n        return inRange(this, mouseX, mouseY, useFinalPosition);\n    }\n    inXRange(mouseX, useFinalPosition) {\n        return inRange(this, mouseX, null, useFinalPosition);\n    }\n    inYRange(mouseY, useFinalPosition) {\n        return inRange(this, null, mouseY, useFinalPosition);\n    }\n    getCenterPoint(useFinalPosition) {\n        const { x , y , base , horizontal  } =  this.getProps([\n            'x',\n            'y',\n            'base',\n            'horizontal'\n        ], useFinalPosition);\n        return {\n            x: horizontal ? (x + base) / 2 : x,\n            y: horizontal ? y : (y + base) / 2\n        };\n    }\n    getRange(axis) {\n        return axis === 'x' ? this.width / 2 : this.height / 2;\n    }\n}\n\nvar elements = /*#__PURE__*/Object.freeze({\n__proto__: null,\nArcElement: ArcElement,\nBarElement: BarElement,\nLineElement: LineElement,\nPointElement: PointElement\n});\n\nconst BORDER_COLORS = [\n    'rgb(54, 162, 235)',\n    'rgb(255, 99, 132)',\n    'rgb(255, 159, 64)',\n    'rgb(255, 205, 86)',\n    'rgb(75, 192, 192)',\n    'rgb(153, 102, 255)',\n    'rgb(201, 203, 207)' // grey\n];\n// Border colors with 50% transparency\nconst BACKGROUND_COLORS = /* #__PURE__ */ BORDER_COLORS.map((color)=>color.replace('rgb(', 'rgba(').replace(')', ', 0.5)'));\nfunction getBorderColor(i) {\n    return BORDER_COLORS[i % BORDER_COLORS.length];\n}\nfunction getBackgroundColor(i) {\n    return BACKGROUND_COLORS[i % BACKGROUND_COLORS.length];\n}\nfunction colorizeDefaultDataset(dataset, i) {\n    dataset.borderColor = getBorderColor(i);\n    dataset.backgroundColor = getBackgroundColor(i);\n    return ++i;\n}\nfunction colorizeDoughnutDataset(dataset, i) {\n    dataset.backgroundColor = dataset.data.map(()=>getBorderColor(i++));\n    return i;\n}\nfunction colorizePolarAreaDataset(dataset, i) {\n    dataset.backgroundColor = dataset.data.map(()=>getBackgroundColor(i++));\n    return i;\n}\nfunction getColorizer(chart) {\n    let i = 0;\n    return (dataset, datasetIndex)=>{\n        const controller = chart.getDatasetMeta(datasetIndex).controller;\n        if (controller instanceof DoughnutController) {\n            i = colorizeDoughnutDataset(dataset, i);\n        } else if (controller instanceof PolarAreaController) {\n            i = colorizePolarAreaDataset(dataset, i);\n        } else if (controller) {\n            i = colorizeDefaultDataset(dataset, i);\n        }\n    };\n}\nfunction containsColorsDefinitions(descriptors) {\n    let k;\n    for(k in descriptors){\n        if (descriptors[k].borderColor || descriptors[k].backgroundColor) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction containsColorsDefinition(descriptor) {\n    return descriptor && (descriptor.borderColor || descriptor.backgroundColor);\n}\nfunction containsDefaultColorsDefenitions() {\n    return defaults.borderColor !== 'rgba(0,0,0,0.1)' || defaults.backgroundColor !== 'rgba(0,0,0,0.1)';\n}\nvar plugin_colors = {\n    id: 'colors',\n    defaults: {\n        enabled: true,\n        forceOverride: false\n    },\n    beforeLayout (chart, _args, options) {\n        if (!options.enabled) {\n            return;\n        }\n        const { data: { datasets  } , options: chartOptions  } = chart.config;\n        const { elements  } = chartOptions;\n        const containsColorDefenition = containsColorsDefinitions(datasets) || containsColorsDefinition(chartOptions) || elements && containsColorsDefinitions(elements) || containsDefaultColorsDefenitions();\n        if (!options.forceOverride && containsColorDefenition) {\n            return;\n        }\n        const colorizer = getColorizer(chart);\n        datasets.forEach(colorizer);\n    }\n};\n\nfunction lttbDecimation(data, start, count, availableWidth, options) {\n const samples = options.samples || availableWidth;\n    if (samples >= count) {\n        return data.slice(start, start + count);\n    }\n    const decimated = [];\n    const bucketWidth = (count - 2) / (samples - 2);\n    let sampledIndex = 0;\n    const endIndex = start + count - 1;\n    let a = start;\n    let i, maxAreaPoint, maxArea, area, nextA;\n    decimated[sampledIndex++] = data[a];\n    for(i = 0; i < samples - 2; i++){\n        let avgX = 0;\n        let avgY = 0;\n        let j;\n        const avgRangeStart = Math.floor((i + 1) * bucketWidth) + 1 + start;\n        const avgRangeEnd = Math.min(Math.floor((i + 2) * bucketWidth) + 1, count) + start;\n        const avgRangeLength = avgRangeEnd - avgRangeStart;\n        for(j = avgRangeStart; j < avgRangeEnd; j++){\n            avgX += data[j].x;\n            avgY += data[j].y;\n        }\n        avgX /= avgRangeLength;\n        avgY /= avgRangeLength;\n        const rangeOffs = Math.floor(i * bucketWidth) + 1 + start;\n        const rangeTo = Math.min(Math.floor((i + 1) * bucketWidth) + 1, count) + start;\n        const { x: pointAx , y: pointAy  } = data[a];\n        maxArea = area = -1;\n        for(j = rangeOffs; j < rangeTo; j++){\n            area = 0.5 * Math.abs((pointAx - avgX) * (data[j].y - pointAy) - (pointAx - data[j].x) * (avgY - pointAy));\n            if (area > maxArea) {\n                maxArea = area;\n                maxAreaPoint = data[j];\n                nextA = j;\n            }\n        }\n        decimated[sampledIndex++] = maxAreaPoint;\n        a = nextA;\n    }\n    decimated[sampledIndex++] = data[endIndex];\n    return decimated;\n}\nfunction minMaxDecimation(data, start, count, availableWidth) {\n    let avgX = 0;\n    let countX = 0;\n    let i, point, x, y, prevX, minIndex, maxIndex, startIndex, minY, maxY;\n    const decimated = [];\n    const endIndex = start + count - 1;\n    const xMin = data[start].x;\n    const xMax = data[endIndex].x;\n    const dx = xMax - xMin;\n    for(i = start; i < start + count; ++i){\n        point = data[i];\n        x = (point.x - xMin) / dx * availableWidth;\n        y = point.y;\n        const truncX = x | 0;\n        if (truncX === prevX) {\n            if (y < minY) {\n                minY = y;\n                minIndex = i;\n            } else if (y > maxY) {\n                maxY = y;\n                maxIndex = i;\n            }\n            avgX = (countX * avgX + point.x) / ++countX;\n        } else {\n            const lastIndex = i - 1;\n            if (!isNullOrUndef(minIndex) && !isNullOrUndef(maxIndex)) {\n                const intermediateIndex1 = Math.min(minIndex, maxIndex);\n                const intermediateIndex2 = Math.max(minIndex, maxIndex);\n                if (intermediateIndex1 !== startIndex && intermediateIndex1 !== lastIndex) {\n                    decimated.push({\n                        ...data[intermediateIndex1],\n                        x: avgX\n                    });\n                }\n                if (intermediateIndex2 !== startIndex && intermediateIndex2 !== lastIndex) {\n                    decimated.push({\n                        ...data[intermediateIndex2],\n                        x: avgX\n                    });\n                }\n            }\n            if (i > 0 && lastIndex !== startIndex) {\n                decimated.push(data[lastIndex]);\n            }\n            decimated.push(point);\n            prevX = truncX;\n            countX = 0;\n            minY = maxY = y;\n            minIndex = maxIndex = startIndex = i;\n        }\n    }\n    return decimated;\n}\nfunction cleanDecimatedDataset(dataset) {\n    if (dataset._decimated) {\n        const data = dataset._data;\n        delete dataset._decimated;\n        delete dataset._data;\n        Object.defineProperty(dataset, 'data', {\n            configurable: true,\n            enumerable: true,\n            writable: true,\n            value: data\n        });\n    }\n}\nfunction cleanDecimatedData(chart) {\n    chart.data.datasets.forEach((dataset)=>{\n        cleanDecimatedDataset(dataset);\n    });\n}\nfunction getStartAndCountOfVisiblePointsSimplified(meta, points) {\n    const pointCount = points.length;\n    let start = 0;\n    let count;\n    const { iScale  } = meta;\n    const { min , max , minDefined , maxDefined  } = iScale.getUserBounds();\n    if (minDefined) {\n        start = _limitValue(_lookupByKey(points, iScale.axis, min).lo, 0, pointCount - 1);\n    }\n    if (maxDefined) {\n        count = _limitValue(_lookupByKey(points, iScale.axis, max).hi + 1, start, pointCount) - start;\n    } else {\n        count = pointCount - start;\n    }\n    return {\n        start,\n        count\n    };\n}\nvar plugin_decimation = {\n    id: 'decimation',\n    defaults: {\n        algorithm: 'min-max',\n        enabled: false\n    },\n    beforeElementsUpdate: (chart, args, options)=>{\n        if (!options.enabled) {\n            cleanDecimatedData(chart);\n            return;\n        }\n        const availableWidth = chart.width;\n        chart.data.datasets.forEach((dataset, datasetIndex)=>{\n            const { _data , indexAxis  } = dataset;\n            const meta = chart.getDatasetMeta(datasetIndex);\n            const data = _data || dataset.data;\n            if (resolve([\n                indexAxis,\n                chart.options.indexAxis\n            ]) === 'y') {\n                return;\n            }\n            if (!meta.controller.supportsDecimation) {\n                return;\n            }\n            const xAxis = chart.scales[meta.xAxisID];\n            if (xAxis.type !== 'linear' && xAxis.type !== 'time') {\n                return;\n            }\n            if (chart.options.parsing) {\n                return;\n            }\n            let { start , count  } = getStartAndCountOfVisiblePointsSimplified(meta, data);\n            const threshold = options.threshold || 4 * availableWidth;\n            if (count <= threshold) {\n                cleanDecimatedDataset(dataset);\n                return;\n            }\n            if (isNullOrUndef(_data)) {\n                dataset._data = data;\n                delete dataset.data;\n                Object.defineProperty(dataset, 'data', {\n                    configurable: true,\n                    enumerable: true,\n                    get: function() {\n                        return this._decimated;\n                    },\n                    set: function(d) {\n                        this._data = d;\n                    }\n                });\n            }\n            let decimated;\n            switch(options.algorithm){\n                case 'lttb':\n                    decimated = lttbDecimation(data, start, count, availableWidth, options);\n                    break;\n                case 'min-max':\n                    decimated = minMaxDecimation(data, start, count, availableWidth);\n                    break;\n                default:\n                    throw new Error(`Unsupported decimation algorithm '${options.algorithm}'`);\n            }\n            dataset._decimated = decimated;\n        });\n    },\n    destroy (chart) {\n        cleanDecimatedData(chart);\n    }\n};\n\nfunction _segments(line, target, property) {\n    const segments = line.segments;\n    const points = line.points;\n    const tpoints = target.points;\n    const parts = [];\n    for (const segment of segments){\n        let { start , end  } = segment;\n        end = _findSegmentEnd(start, end, points);\n        const bounds = _getBounds(property, points[start], points[end], segment.loop);\n        if (!target.segments) {\n            parts.push({\n                source: segment,\n                target: bounds,\n                start: points[start],\n                end: points[end]\n            });\n            continue;\n        }\n        const targetSegments = _boundSegments(target, bounds);\n        for (const tgt of targetSegments){\n            const subBounds = _getBounds(property, tpoints[tgt.start], tpoints[tgt.end], tgt.loop);\n            const fillSources = _boundSegment(segment, points, subBounds);\n            for (const fillSource of fillSources){\n                parts.push({\n                    source: fillSource,\n                    target: tgt,\n                    start: {\n                        [property]: _getEdge(bounds, subBounds, 'start', Math.max)\n                    },\n                    end: {\n                        [property]: _getEdge(bounds, subBounds, 'end', Math.min)\n                    }\n                });\n            }\n        }\n    }\n    return parts;\n}\nfunction _getBounds(property, first, last, loop) {\n    if (loop) {\n        return;\n    }\n    let start = first[property];\n    let end = last[property];\n    if (property === 'angle') {\n        start = _normalizeAngle(start);\n        end = _normalizeAngle(end);\n    }\n    return {\n        property,\n        start,\n        end\n    };\n}\nfunction _pointsFromSegments(boundary, line) {\n    const { x =null , y =null  } = boundary || {};\n    const linePoints = line.points;\n    const points = [];\n    line.segments.forEach(({ start , end  })=>{\n        end = _findSegmentEnd(start, end, linePoints);\n        const first = linePoints[start];\n        const last = linePoints[end];\n        if (y !== null) {\n            points.push({\n                x: first.x,\n                y\n            });\n            points.push({\n                x: last.x,\n                y\n            });\n        } else if (x !== null) {\n            points.push({\n                x,\n                y: first.y\n            });\n            points.push({\n                x,\n                y: last.y\n            });\n        }\n    });\n    return points;\n}\nfunction _findSegmentEnd(start, end, points) {\n    for(; end > start; end--){\n        const point = points[end];\n        if (!isNaN(point.x) && !isNaN(point.y)) {\n            break;\n        }\n    }\n    return end;\n}\nfunction _getEdge(a, b, prop, fn) {\n    if (a && b) {\n        return fn(a[prop], b[prop]);\n    }\n    return a ? a[prop] : b ? b[prop] : 0;\n}\n\nfunction _createBoundaryLine(boundary, line) {\n    let points = [];\n    let _loop = false;\n    if (isArray(boundary)) {\n        _loop = true;\n        points = boundary;\n    } else {\n        points = _pointsFromSegments(boundary, line);\n    }\n    return points.length ? new LineElement({\n        points,\n        options: {\n            tension: 0\n        },\n        _loop,\n        _fullLoop: _loop\n    }) : null;\n}\nfunction _shouldApplyFill(source) {\n    return source && source.fill !== false;\n}\n\nfunction _resolveTarget(sources, index, propagate) {\n    const source = sources[index];\n    let fill = source.fill;\n    const visited = [\n        index\n    ];\n    let target;\n    if (!propagate) {\n        return fill;\n    }\n    while(fill !== false && visited.indexOf(fill) === -1){\n        if (!isNumberFinite(fill)) {\n            return fill;\n        }\n        target = sources[fill];\n        if (!target) {\n            return false;\n        }\n        if (target.visible) {\n            return fill;\n        }\n        visited.push(fill);\n        fill = target.fill;\n    }\n    return false;\n}\n function _decodeFill(line, index, count) {\n     const fill = parseFillOption(line);\n    if (isObject(fill)) {\n        return isNaN(fill.value) ? false : fill;\n    }\n    let target = parseFloat(fill);\n    if (isNumberFinite(target) && Math.floor(target) === target) {\n        return decodeTargetIndex(fill[0], index, target, count);\n    }\n    return [\n        'origin',\n        'start',\n        'end',\n        'stack',\n        'shape'\n    ].indexOf(fill) >= 0 && fill;\n}\nfunction decodeTargetIndex(firstCh, index, target, count) {\n    if (firstCh === '-' || firstCh === '+') {\n        target = index + target;\n    }\n    if (target === index || target < 0 || target >= count) {\n        return false;\n    }\n    return target;\n}\n function _getTargetPixel(fill, scale) {\n    let pixel = null;\n    if (fill === 'start') {\n        pixel = scale.bottom;\n    } else if (fill === 'end') {\n        pixel = scale.top;\n    } else if (isObject(fill)) {\n        pixel = scale.getPixelForValue(fill.value);\n    } else if (scale.getBasePixel) {\n        pixel = scale.getBasePixel();\n    }\n    return pixel;\n}\n function _getTargetValue(fill, scale, startValue) {\n    let value;\n    if (fill === 'start') {\n        value = startValue;\n    } else if (fill === 'end') {\n        value = scale.options.reverse ? scale.min : scale.max;\n    } else if (isObject(fill)) {\n        value = fill.value;\n    } else {\n        value = scale.getBaseValue();\n    }\n    return value;\n}\n function parseFillOption(line) {\n    const options = line.options;\n    const fillOption = options.fill;\n    let fill = valueOrDefault(fillOption && fillOption.target, fillOption);\n    if (fill === undefined) {\n        fill = !!options.backgroundColor;\n    }\n    if (fill === false || fill === null) {\n        return false;\n    }\n    if (fill === true) {\n        return 'origin';\n    }\n    return fill;\n}\n\nfunction _buildStackLine(source) {\n    const { scale , index , line  } = source;\n    const points = [];\n    const segments = line.segments;\n    const sourcePoints = line.points;\n    const linesBelow = getLinesBelow(scale, index);\n    linesBelow.push(_createBoundaryLine({\n        x: null,\n        y: scale.bottom\n    }, line));\n    for(let i = 0; i < segments.length; i++){\n        const segment = segments[i];\n        for(let j = segment.start; j <= segment.end; j++){\n            addPointsBelow(points, sourcePoints[j], linesBelow);\n        }\n    }\n    return new LineElement({\n        points,\n        options: {}\n    });\n}\n function getLinesBelow(scale, index) {\n    const below = [];\n    const metas = scale.getMatchingVisibleMetas('line');\n    for(let i = 0; i < metas.length; i++){\n        const meta = metas[i];\n        if (meta.index === index) {\n            break;\n        }\n        if (!meta.hidden) {\n            below.unshift(meta.dataset);\n        }\n    }\n    return below;\n}\n function addPointsBelow(points, sourcePoint, linesBelow) {\n    const postponed = [];\n    for(let j = 0; j < linesBelow.length; j++){\n        const line = linesBelow[j];\n        const { first , last , point  } = findPoint(line, sourcePoint, 'x');\n        if (!point || first && last) {\n            continue;\n        }\n        if (first) {\n            postponed.unshift(point);\n        } else {\n            points.push(point);\n            if (!last) {\n                break;\n            }\n        }\n    }\n    points.push(...postponed);\n}\n function findPoint(line, sourcePoint, property) {\n    const point = line.interpolate(sourcePoint, property);\n    if (!point) {\n        return {};\n    }\n    const pointValue = point[property];\n    const segments = line.segments;\n    const linePoints = line.points;\n    let first = false;\n    let last = false;\n    for(let i = 0; i < segments.length; i++){\n        const segment = segments[i];\n        const firstValue = linePoints[segment.start][property];\n        const lastValue = linePoints[segment.end][property];\n        if (_isBetween(pointValue, firstValue, lastValue)) {\n            first = pointValue === firstValue;\n            last = pointValue === lastValue;\n            break;\n        }\n    }\n    return {\n        first,\n        last,\n        point\n    };\n}\n\nclass simpleArc {\n    constructor(opts){\n        this.x = opts.x;\n        this.y = opts.y;\n        this.radius = opts.radius;\n    }\n    pathSegment(ctx, bounds, opts) {\n        const { x , y , radius  } = this;\n        bounds = bounds || {\n            start: 0,\n            end: TAU\n        };\n        ctx.arc(x, y, radius, bounds.end, bounds.start, true);\n        return !opts.bounds;\n    }\n    interpolate(point) {\n        const { x , y , radius  } = this;\n        const angle = point.angle;\n        return {\n            x: x + Math.cos(angle) * radius,\n            y: y + Math.sin(angle) * radius,\n            angle\n        };\n    }\n}\n\nfunction _getTarget(source) {\n    const { chart , fill , line  } = source;\n    if (isNumberFinite(fill)) {\n        return getLineByIndex(chart, fill);\n    }\n    if (fill === 'stack') {\n        return _buildStackLine(source);\n    }\n    if (fill === 'shape') {\n        return true;\n    }\n    const boundary = computeBoundary(source);\n    if (boundary instanceof simpleArc) {\n        return boundary;\n    }\n    return _createBoundaryLine(boundary, line);\n}\n function getLineByIndex(chart, index) {\n    const meta = chart.getDatasetMeta(index);\n    const visible = meta && chart.isDatasetVisible(index);\n    return visible ? meta.dataset : null;\n}\nfunction computeBoundary(source) {\n    const scale = source.scale || {};\n    if (scale.getPointPositionForValue) {\n        return computeCircularBoundary(source);\n    }\n    return computeLinearBoundary(source);\n}\nfunction computeLinearBoundary(source) {\n    const { scale ={} , fill  } = source;\n    const pixel = _getTargetPixel(fill, scale);\n    if (isNumberFinite(pixel)) {\n        const horizontal = scale.isHorizontal();\n        return {\n            x: horizontal ? pixel : null,\n            y: horizontal ? null : pixel\n        };\n    }\n    return null;\n}\nfunction computeCircularBoundary(source) {\n    const { scale , fill  } = source;\n    const options = scale.options;\n    const length = scale.getLabels().length;\n    const start = options.reverse ? scale.max : scale.min;\n    const value = _getTargetValue(fill, scale, start);\n    const target = [];\n    if (options.grid.circular) {\n        const center = scale.getPointPositionForValue(0, start);\n        return new simpleArc({\n            x: center.x,\n            y: center.y,\n            radius: scale.getDistanceFromCenterForValue(value)\n        });\n    }\n    for(let i = 0; i < length; ++i){\n        target.push(scale.getPointPositionForValue(i, value));\n    }\n    return target;\n}\n\nfunction _drawfill(ctx, source, area) {\n    const target = _getTarget(source);\n    const { chart , index , line , scale , axis  } = source;\n    const lineOpts = line.options;\n    const fillOption = lineOpts.fill;\n    const color = lineOpts.backgroundColor;\n    const { above =color , below =color  } = fillOption || {};\n    const meta = chart.getDatasetMeta(index);\n    const clip = getDatasetClipArea(chart, meta);\n    if (target && line.points.length) {\n        clipArea(ctx, area);\n        doFill(ctx, {\n            line,\n            target,\n            above,\n            below,\n            area,\n            scale,\n            axis,\n            clip\n        });\n        unclipArea(ctx);\n    }\n}\nfunction doFill(ctx, cfg) {\n    const { line , target , above , below , area , scale , clip  } = cfg;\n    const property = line._loop ? 'angle' : cfg.axis;\n    ctx.save();\n    let fillColor = below;\n    if (below !== above) {\n        if (property === 'x') {\n            clipVertical(ctx, target, area.top);\n            fill(ctx, {\n                line,\n                target,\n                color: above,\n                scale,\n                property,\n                clip\n            });\n            ctx.restore();\n            ctx.save();\n            clipVertical(ctx, target, area.bottom);\n        } else if (property === 'y') {\n            clipHorizontal(ctx, target, area.left);\n            fill(ctx, {\n                line,\n                target,\n                color: below,\n                scale,\n                property,\n                clip\n            });\n            ctx.restore();\n            ctx.save();\n            clipHorizontal(ctx, target, area.right);\n            fillColor = above;\n        }\n    }\n    fill(ctx, {\n        line,\n        target,\n        color: fillColor,\n        scale,\n        property,\n        clip\n    });\n    ctx.restore();\n}\nfunction clipVertical(ctx, target, clipY) {\n    const { segments , points  } = target;\n    let first = true;\n    let lineLoop = false;\n    ctx.beginPath();\n    for (const segment of segments){\n        const { start , end  } = segment;\n        const firstPoint = points[start];\n        const lastPoint = points[_findSegmentEnd(start, end, points)];\n        if (first) {\n            ctx.moveTo(firstPoint.x, firstPoint.y);\n            first = false;\n        } else {\n            ctx.lineTo(firstPoint.x, clipY);\n            ctx.lineTo(firstPoint.x, firstPoint.y);\n        }\n        lineLoop = !!target.pathSegment(ctx, segment, {\n            move: lineLoop\n        });\n        if (lineLoop) {\n            ctx.closePath();\n        } else {\n            ctx.lineTo(lastPoint.x, clipY);\n        }\n    }\n    ctx.lineTo(target.first().x, clipY);\n    ctx.closePath();\n    ctx.clip();\n}\nfunction clipHorizontal(ctx, target, clipX) {\n    const { segments , points  } = target;\n    let first = true;\n    let lineLoop = false;\n    ctx.beginPath();\n    for (const segment of segments){\n        const { start , end  } = segment;\n        const firstPoint = points[start];\n        const lastPoint = points[_findSegmentEnd(start, end, points)];\n        if (first) {\n            ctx.moveTo(firstPoint.x, firstPoint.y);\n            first = false;\n        } else {\n            ctx.lineTo(clipX, firstPoint.y);\n            ctx.lineTo(firstPoint.x, firstPoint.y);\n        }\n        lineLoop = !!target.pathSegment(ctx, segment, {\n            move: lineLoop\n        });\n        if (lineLoop) {\n            ctx.closePath();\n        } else {\n            ctx.lineTo(clipX, lastPoint.y);\n        }\n    }\n    ctx.lineTo(clipX, target.first().y);\n    ctx.closePath();\n    ctx.clip();\n}\nfunction fill(ctx, cfg) {\n    const { line , target , property , color , scale , clip  } = cfg;\n    const segments = _segments(line, target, property);\n    for (const { source: src , target: tgt , start , end  } of segments){\n        const { style: { backgroundColor =color  } = {}  } = src;\n        const notShape = target !== true;\n        ctx.save();\n        ctx.fillStyle = backgroundColor;\n        clipBounds(ctx, scale, clip, notShape && _getBounds(property, start, end));\n        ctx.beginPath();\n        const lineLoop = !!line.pathSegment(ctx, src);\n        let loop;\n        if (notShape) {\n            if (lineLoop) {\n                ctx.closePath();\n            } else {\n                interpolatedLineTo(ctx, target, end, property);\n            }\n            const targetLoop = !!target.pathSegment(ctx, tgt, {\n                move: lineLoop,\n                reverse: true\n            });\n            loop = lineLoop && targetLoop;\n            if (!loop) {\n                interpolatedLineTo(ctx, target, start, property);\n            }\n        }\n        ctx.closePath();\n        ctx.fill(loop ? 'evenodd' : 'nonzero');\n        ctx.restore();\n    }\n}\nfunction clipBounds(ctx, scale, clip, bounds) {\n    const chartArea = scale.chart.chartArea;\n    const { property , start , end  } = bounds || {};\n    if (property === 'x' || property === 'y') {\n        let left, top, right, bottom;\n        if (property === 'x') {\n            left = start;\n            top = chartArea.top;\n            right = end;\n            bottom = chartArea.bottom;\n        } else {\n            left = chartArea.left;\n            top = start;\n            right = chartArea.right;\n            bottom = end;\n        }\n        ctx.beginPath();\n        if (clip) {\n            left = Math.max(left, clip.left);\n            right = Math.min(right, clip.right);\n            top = Math.max(top, clip.top);\n            bottom = Math.min(bottom, clip.bottom);\n        }\n        ctx.rect(left, top, right - left, bottom - top);\n        ctx.clip();\n    }\n}\nfunction interpolatedLineTo(ctx, target, point, property) {\n    const interpolatedPoint = target.interpolate(point, property);\n    if (interpolatedPoint) {\n        ctx.lineTo(interpolatedPoint.x, interpolatedPoint.y);\n    }\n}\n\nvar index = {\n    id: 'filler',\n    afterDatasetsUpdate (chart, _args, options) {\n        const count = (chart.data.datasets || []).length;\n        const sources = [];\n        let meta, i, line, source;\n        for(i = 0; i < count; ++i){\n            meta = chart.getDatasetMeta(i);\n            line = meta.dataset;\n            source = null;\n            if (line && line.options && line instanceof LineElement) {\n                source = {\n                    visible: chart.isDatasetVisible(i),\n                    index: i,\n                    fill: _decodeFill(line, i, count),\n                    chart,\n                    axis: meta.controller.options.indexAxis,\n                    scale: meta.vScale,\n                    line\n                };\n            }\n            meta.$filler = source;\n            sources.push(source);\n        }\n        for(i = 0; i < count; ++i){\n            source = sources[i];\n            if (!source || source.fill === false) {\n                continue;\n            }\n            source.fill = _resolveTarget(sources, i, options.propagate);\n        }\n    },\n    beforeDraw (chart, _args, options) {\n        const draw = options.drawTime === 'beforeDraw';\n        const metasets = chart.getSortedVisibleDatasetMetas();\n        const area = chart.chartArea;\n        for(let i = metasets.length - 1; i >= 0; --i){\n            const source = metasets[i].$filler;\n            if (!source) {\n                continue;\n            }\n            source.line.updateControlPoints(area, source.axis);\n            if (draw && source.fill) {\n                _drawfill(chart.ctx, source, area);\n            }\n        }\n    },\n    beforeDatasetsDraw (chart, _args, options) {\n        if (options.drawTime !== 'beforeDatasetsDraw') {\n            return;\n        }\n        const metasets = chart.getSortedVisibleDatasetMetas();\n        for(let i = metasets.length - 1; i >= 0; --i){\n            const source = metasets[i].$filler;\n            if (_shouldApplyFill(source)) {\n                _drawfill(chart.ctx, source, chart.chartArea);\n            }\n        }\n    },\n    beforeDatasetDraw (chart, args, options) {\n        const source = args.meta.$filler;\n        if (!_shouldApplyFill(source) || options.drawTime !== 'beforeDatasetDraw') {\n            return;\n        }\n        _drawfill(chart.ctx, source, chart.chartArea);\n    },\n    defaults: {\n        propagate: true,\n        drawTime: 'beforeDatasetDraw'\n    }\n};\n\nconst getBoxSize = (labelOpts, fontSize)=>{\n    let { boxHeight =fontSize , boxWidth =fontSize  } = labelOpts;\n    if (labelOpts.usePointStyle) {\n        boxHeight = Math.min(boxHeight, fontSize);\n        boxWidth = labelOpts.pointStyleWidth || Math.min(boxWidth, fontSize);\n    }\n    return {\n        boxWidth,\n        boxHeight,\n        itemHeight: Math.max(fontSize, boxHeight)\n    };\n};\nconst itemsEqual = (a, b)=>a !== null && b !== null && a.datasetIndex === b.datasetIndex && a.index === b.index;\nclass Legend extends Element {\n constructor(config){\n        super();\n        this._added = false;\n        this.legendHitBoxes = [];\n this._hoveredItem = null;\n        this.doughnutMode = false;\n        this.chart = config.chart;\n        this.options = config.options;\n        this.ctx = config.ctx;\n        this.legendItems = undefined;\n        this.columnSizes = undefined;\n        this.lineWidths = undefined;\n        this.maxHeight = undefined;\n        this.maxWidth = undefined;\n        this.top = undefined;\n        this.bottom = undefined;\n        this.left = undefined;\n        this.right = undefined;\n        this.height = undefined;\n        this.width = undefined;\n        this._margins = undefined;\n        this.position = undefined;\n        this.weight = undefined;\n        this.fullSize = undefined;\n    }\n    update(maxWidth, maxHeight, margins) {\n        this.maxWidth = maxWidth;\n        this.maxHeight = maxHeight;\n        this._margins = margins;\n        this.setDimensions();\n        this.buildLabels();\n        this.fit();\n    }\n    setDimensions() {\n        if (this.isHorizontal()) {\n            this.width = this.maxWidth;\n            this.left = this._margins.left;\n            this.right = this.width;\n        } else {\n            this.height = this.maxHeight;\n            this.top = this._margins.top;\n            this.bottom = this.height;\n        }\n    }\n    buildLabels() {\n        const labelOpts = this.options.labels || {};\n        let legendItems = callback(labelOpts.generateLabels, [\n            this.chart\n        ], this) || [];\n        if (labelOpts.filter) {\n            legendItems = legendItems.filter((item)=>labelOpts.filter(item, this.chart.data));\n        }\n        if (labelOpts.sort) {\n            legendItems = legendItems.sort((a, b)=>labelOpts.sort(a, b, this.chart.data));\n        }\n        if (this.options.reverse) {\n            legendItems.reverse();\n        }\n        this.legendItems = legendItems;\n    }\n    fit() {\n        const { options , ctx  } = this;\n        if (!options.display) {\n            this.width = this.height = 0;\n            return;\n        }\n        const labelOpts = options.labels;\n        const labelFont = toFont(labelOpts.font);\n        const fontSize = labelFont.size;\n        const titleHeight = this._computeTitleHeight();\n        const { boxWidth , itemHeight  } = getBoxSize(labelOpts, fontSize);\n        let width, height;\n        ctx.font = labelFont.string;\n        if (this.isHorizontal()) {\n            width = this.maxWidth;\n            height = this._fitRows(titleHeight, fontSize, boxWidth, itemHeight) + 10;\n        } else {\n            height = this.maxHeight;\n            width = this._fitCols(titleHeight, labelFont, boxWidth, itemHeight) + 10;\n        }\n        this.width = Math.min(width, options.maxWidth || this.maxWidth);\n        this.height = Math.min(height, options.maxHeight || this.maxHeight);\n    }\n _fitRows(titleHeight, fontSize, boxWidth, itemHeight) {\n        const { ctx , maxWidth , options: { labels: { padding  }  }  } = this;\n        const hitboxes = this.legendHitBoxes = [];\n        const lineWidths = this.lineWidths = [\n            0\n        ];\n        const lineHeight = itemHeight + padding;\n        let totalHeight = titleHeight;\n        ctx.textAlign = 'left';\n        ctx.textBaseline = 'middle';\n        let row = -1;\n        let top = -lineHeight;\n        this.legendItems.forEach((legendItem, i)=>{\n            const itemWidth = boxWidth + fontSize / 2 + ctx.measureText(legendItem.text).width;\n            if (i === 0 || lineWidths[lineWidths.length - 1] + itemWidth + 2 * padding > maxWidth) {\n                totalHeight += lineHeight;\n                lineWidths[lineWidths.length - (i > 0 ? 0 : 1)] = 0;\n                top += lineHeight;\n                row++;\n            }\n            hitboxes[i] = {\n                left: 0,\n                top,\n                row,\n                width: itemWidth,\n                height: itemHeight\n            };\n            lineWidths[lineWidths.length - 1] += itemWidth + padding;\n        });\n        return totalHeight;\n    }\n    _fitCols(titleHeight, labelFont, boxWidth, _itemHeight) {\n        const { ctx , maxHeight , options: { labels: { padding  }  }  } = this;\n        const hitboxes = this.legendHitBoxes = [];\n        const columnSizes = this.columnSizes = [];\n        const heightLimit = maxHeight - titleHeight;\n        let totalWidth = padding;\n        let currentColWidth = 0;\n        let currentColHeight = 0;\n        let left = 0;\n        let col = 0;\n        this.legendItems.forEach((legendItem, i)=>{\n            const { itemWidth , itemHeight  } = calculateItemSize(boxWidth, labelFont, ctx, legendItem, _itemHeight);\n            if (i > 0 && currentColHeight + itemHeight + 2 * padding > heightLimit) {\n                totalWidth += currentColWidth + padding;\n                columnSizes.push({\n                    width: currentColWidth,\n                    height: currentColHeight\n                });\n                left += currentColWidth + padding;\n                col++;\n                currentColWidth = currentColHeight = 0;\n            }\n            hitboxes[i] = {\n                left,\n                top: currentColHeight,\n                col,\n                width: itemWidth,\n                height: itemHeight\n            };\n            currentColWidth = Math.max(currentColWidth, itemWidth);\n            currentColHeight += itemHeight + padding;\n        });\n        totalWidth += currentColWidth;\n        columnSizes.push({\n            width: currentColWidth,\n            height: currentColHeight\n        });\n        return totalWidth;\n    }\n    adjustHitBoxes() {\n        if (!this.options.display) {\n            return;\n        }\n        const titleHeight = this._computeTitleHeight();\n        const { legendHitBoxes: hitboxes , options: { align , labels: { padding  } , rtl  }  } = this;\n        const rtlHelper = getRtlAdapter(rtl, this.left, this.width);\n        if (this.isHorizontal()) {\n            let row = 0;\n            let left = _alignStartEnd(align, this.left + padding, this.right - this.lineWidths[row]);\n            for (const hitbox of hitboxes){\n                if (row !== hitbox.row) {\n                    row = hitbox.row;\n                    left = _alignStartEnd(align, this.left + padding, this.right - this.lineWidths[row]);\n                }\n                hitbox.top += this.top + titleHeight + padding;\n                hitbox.left = rtlHelper.leftForLtr(rtlHelper.x(left), hitbox.width);\n                left += hitbox.width + padding;\n            }\n        } else {\n            let col = 0;\n            let top = _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - this.columnSizes[col].height);\n            for (const hitbox of hitboxes){\n                if (hitbox.col !== col) {\n                    col = hitbox.col;\n                    top = _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - this.columnSizes[col].height);\n                }\n                hitbox.top = top;\n                hitbox.left += this.left + padding;\n                hitbox.left = rtlHelper.leftForLtr(rtlHelper.x(hitbox.left), hitbox.width);\n                top += hitbox.height + padding;\n            }\n        }\n    }\n    isHorizontal() {\n        return this.options.position === 'top' || this.options.position === 'bottom';\n    }\n    draw() {\n        if (this.options.display) {\n            const ctx = this.ctx;\n            clipArea(ctx, this);\n            this._draw();\n            unclipArea(ctx);\n        }\n    }\n _draw() {\n        const { options: opts , columnSizes , lineWidths , ctx  } = this;\n        const { align , labels: labelOpts  } = opts;\n        const defaultColor = defaults.color;\n        const rtlHelper = getRtlAdapter(opts.rtl, this.left, this.width);\n        const labelFont = toFont(labelOpts.font);\n        const { padding  } = labelOpts;\n        const fontSize = labelFont.size;\n        const halfFontSize = fontSize / 2;\n        let cursor;\n        this.drawTitle();\n        ctx.textAlign = rtlHelper.textAlign('left');\n        ctx.textBaseline = 'middle';\n        ctx.lineWidth = 0.5;\n        ctx.font = labelFont.string;\n        const { boxWidth , boxHeight , itemHeight  } = getBoxSize(labelOpts, fontSize);\n        const drawLegendBox = function(x, y, legendItem) {\n            if (isNaN(boxWidth) || boxWidth <= 0 || isNaN(boxHeight) || boxHeight < 0) {\n                return;\n            }\n            ctx.save();\n            const lineWidth = valueOrDefault(legendItem.lineWidth, 1);\n            ctx.fillStyle = valueOrDefault(legendItem.fillStyle, defaultColor);\n            ctx.lineCap = valueOrDefault(legendItem.lineCap, 'butt');\n            ctx.lineDashOffset = valueOrDefault(legendItem.lineDashOffset, 0);\n            ctx.lineJoin = valueOrDefault(legendItem.lineJoin, 'miter');\n            ctx.lineWidth = lineWidth;\n            ctx.strokeStyle = valueOrDefault(legendItem.strokeStyle, defaultColor);\n            ctx.setLineDash(valueOrDefault(legendItem.lineDash, []));\n            if (labelOpts.usePointStyle) {\n                const drawOptions = {\n                    radius: boxHeight * Math.SQRT2 / 2,\n                    pointStyle: legendItem.pointStyle,\n                    rotation: legendItem.rotation,\n                    borderWidth: lineWidth\n                };\n                const centerX = rtlHelper.xPlus(x, boxWidth / 2);\n                const centerY = y + halfFontSize;\n                drawPointLegend(ctx, drawOptions, centerX, centerY, labelOpts.pointStyleWidth && boxWidth);\n            } else {\n                const yBoxTop = y + Math.max((fontSize - boxHeight) / 2, 0);\n                const xBoxLeft = rtlHelper.leftForLtr(x, boxWidth);\n                const borderRadius = toTRBLCorners(legendItem.borderRadius);\n                ctx.beginPath();\n                if (Object.values(borderRadius).some((v)=>v !== 0)) {\n                    addRoundedRectPath(ctx, {\n                        x: xBoxLeft,\n                        y: yBoxTop,\n                        w: boxWidth,\n                        h: boxHeight,\n                        radius: borderRadius\n                    });\n                } else {\n                    ctx.rect(xBoxLeft, yBoxTop, boxWidth, boxHeight);\n                }\n                ctx.fill();\n                if (lineWidth !== 0) {\n                    ctx.stroke();\n                }\n            }\n            ctx.restore();\n        };\n        const fillText = function(x, y, legendItem) {\n            renderText(ctx, legendItem.text, x, y + itemHeight / 2, labelFont, {\n                strikethrough: legendItem.hidden,\n                textAlign: rtlHelper.textAlign(legendItem.textAlign)\n            });\n        };\n        const isHorizontal = this.isHorizontal();\n        const titleHeight = this._computeTitleHeight();\n        if (isHorizontal) {\n            cursor = {\n                x: _alignStartEnd(align, this.left + padding, this.right - lineWidths[0]),\n                y: this.top + padding + titleHeight,\n                line: 0\n            };\n        } else {\n            cursor = {\n                x: this.left + padding,\n                y: _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - columnSizes[0].height),\n                line: 0\n            };\n        }\n        overrideTextDirection(this.ctx, opts.textDirection);\n        const lineHeight = itemHeight + padding;\n        this.legendItems.forEach((legendItem, i)=>{\n            ctx.strokeStyle = legendItem.fontColor;\n            ctx.fillStyle = legendItem.fontColor;\n            const textWidth = ctx.measureText(legendItem.text).width;\n            const textAlign = rtlHelper.textAlign(legendItem.textAlign || (legendItem.textAlign = labelOpts.textAlign));\n            const width = boxWidth + halfFontSize + textWidth;\n            let x = cursor.x;\n            let y = cursor.y;\n            rtlHelper.setWidth(this.width);\n            if (isHorizontal) {\n                if (i > 0 && x + width + padding > this.right) {\n                    y = cursor.y += lineHeight;\n                    cursor.line++;\n                    x = cursor.x = _alignStartEnd(align, this.left + padding, this.right - lineWidths[cursor.line]);\n                }\n            } else if (i > 0 && y + lineHeight > this.bottom) {\n                x = cursor.x = x + columnSizes[cursor.line].width + padding;\n                cursor.line++;\n                y = cursor.y = _alignStartEnd(align, this.top + titleHeight + padding, this.bottom - columnSizes[cursor.line].height);\n            }\n            const realX = rtlHelper.x(x);\n            drawLegendBox(realX, y, legendItem);\n            x = _textX(textAlign, x + boxWidth + halfFontSize, isHorizontal ? x + width : this.right, opts.rtl);\n            fillText(rtlHelper.x(x), y, legendItem);\n            if (isHorizontal) {\n                cursor.x += width + padding;\n            } else if (typeof legendItem.text !== 'string') {\n                const fontLineHeight = labelFont.lineHeight;\n                cursor.y += calculateLegendItemHeight(legendItem, fontLineHeight) + padding;\n            } else {\n                cursor.y += lineHeight;\n            }\n        });\n        restoreTextDirection(this.ctx, opts.textDirection);\n    }\n drawTitle() {\n        const opts = this.options;\n        const titleOpts = opts.title;\n        const titleFont = toFont(titleOpts.font);\n        const titlePadding = toPadding(titleOpts.padding);\n        if (!titleOpts.display) {\n            return;\n        }\n        const rtlHelper = getRtlAdapter(opts.rtl, this.left, this.width);\n        const ctx = this.ctx;\n        const position = titleOpts.position;\n        const halfFontSize = titleFont.size / 2;\n        const topPaddingPlusHalfFontSize = titlePadding.top + halfFontSize;\n        let y;\n        let left = this.left;\n        let maxWidth = this.width;\n        if (this.isHorizontal()) {\n            maxWidth = Math.max(...this.lineWidths);\n            y = this.top + topPaddingPlusHalfFontSize;\n            left = _alignStartEnd(opts.align, left, this.right - maxWidth);\n        } else {\n            const maxHeight = this.columnSizes.reduce((acc, size)=>Math.max(acc, size.height), 0);\n            y = topPaddingPlusHalfFontSize + _alignStartEnd(opts.align, this.top, this.bottom - maxHeight - opts.labels.padding - this._computeTitleHeight());\n        }\n        const x = _alignStartEnd(position, left, left + maxWidth);\n        ctx.textAlign = rtlHelper.textAlign(_toLeftRightCenter(position));\n        ctx.textBaseline = 'middle';\n        ctx.strokeStyle = titleOpts.color;\n        ctx.fillStyle = titleOpts.color;\n        ctx.font = titleFont.string;\n        renderText(ctx, titleOpts.text, x, y, titleFont);\n    }\n _computeTitleHeight() {\n        const titleOpts = this.options.title;\n        const titleFont = toFont(titleOpts.font);\n        const titlePadding = toPadding(titleOpts.padding);\n        return titleOpts.display ? titleFont.lineHeight + titlePadding.height : 0;\n    }\n _getLegendItemAt(x, y) {\n        let i, hitBox, lh;\n        if (_isBetween(x, this.left, this.right) && _isBetween(y, this.top, this.bottom)) {\n            lh = this.legendHitBoxes;\n            for(i = 0; i < lh.length; ++i){\n                hitBox = lh[i];\n                if (_isBetween(x, hitBox.left, hitBox.left + hitBox.width) && _isBetween(y, hitBox.top, hitBox.top + hitBox.height)) {\n                    return this.legendItems[i];\n                }\n            }\n        }\n        return null;\n    }\n handleEvent(e) {\n        const opts = this.options;\n        if (!isListened(e.type, opts)) {\n            return;\n        }\n        const hoveredItem = this._getLegendItemAt(e.x, e.y);\n        if (e.type === 'mousemove' || e.type === 'mouseout') {\n            const previous = this._hoveredItem;\n            const sameItem = itemsEqual(previous, hoveredItem);\n            if (previous && !sameItem) {\n                callback(opts.onLeave, [\n                    e,\n                    previous,\n                    this\n                ], this);\n            }\n            this._hoveredItem = hoveredItem;\n            if (hoveredItem && !sameItem) {\n                callback(opts.onHover, [\n                    e,\n                    hoveredItem,\n                    this\n                ], this);\n            }\n        } else if (hoveredItem) {\n            callback(opts.onClick, [\n                e,\n                hoveredItem,\n                this\n            ], this);\n        }\n    }\n}\nfunction calculateItemSize(boxWidth, labelFont, ctx, legendItem, _itemHeight) {\n    const itemWidth = calculateItemWidth(legendItem, boxWidth, labelFont, ctx);\n    const itemHeight = calculateItemHeight(_itemHeight, legendItem, labelFont.lineHeight);\n    return {\n        itemWidth,\n        itemHeight\n    };\n}\nfunction calculateItemWidth(legendItem, boxWidth, labelFont, ctx) {\n    let legendItemText = legendItem.text;\n    if (legendItemText && typeof legendItemText !== 'string') {\n        legendItemText = legendItemText.reduce((a, b)=>a.length > b.length ? a : b);\n    }\n    return boxWidth + labelFont.size / 2 + ctx.measureText(legendItemText).width;\n}\nfunction calculateItemHeight(_itemHeight, legendItem, fontLineHeight) {\n    let itemHeight = _itemHeight;\n    if (typeof legendItem.text !== 'string') {\n        itemHeight = calculateLegendItemHeight(legendItem, fontLineHeight);\n    }\n    return itemHeight;\n}\nfunction calculateLegendItemHeight(legendItem, fontLineHeight) {\n    const labelHeight = legendItem.text ? legendItem.text.length : 0;\n    return fontLineHeight * labelHeight;\n}\nfunction isListened(type, opts) {\n    if ((type === 'mousemove' || type === 'mouseout') && (opts.onHover || opts.onLeave)) {\n        return true;\n    }\n    if (opts.onClick && (type === 'click' || type === 'mouseup')) {\n        return true;\n    }\n    return false;\n}\nvar plugin_legend = {\n    id: 'legend',\n _element: Legend,\n    start (chart, _args, options) {\n        const legend = chart.legend = new Legend({\n            ctx: chart.ctx,\n            options,\n            chart\n        });\n        layouts.configure(chart, legend, options);\n        layouts.addBox(chart, legend);\n    },\n    stop (chart) {\n        layouts.removeBox(chart, chart.legend);\n        delete chart.legend;\n    },\n    beforeUpdate (chart, _args, options) {\n        const legend = chart.legend;\n        layouts.configure(chart, legend, options);\n        legend.options = options;\n    },\n    afterUpdate (chart) {\n        const legend = chart.legend;\n        legend.buildLabels();\n        legend.adjustHitBoxes();\n    },\n    afterEvent (chart, args) {\n        if (!args.replay) {\n            chart.legend.handleEvent(args.event);\n        }\n    },\n    defaults: {\n        display: true,\n        position: 'top',\n        align: 'center',\n        fullSize: true,\n        reverse: false,\n        weight: 1000,\n        onClick (e, legendItem, legend) {\n            const index = legendItem.datasetIndex;\n            const ci = legend.chart;\n            if (ci.isDatasetVisible(index)) {\n                ci.hide(index);\n                legendItem.hidden = true;\n            } else {\n                ci.show(index);\n                legendItem.hidden = false;\n            }\n        },\n        onHover: null,\n        onLeave: null,\n        labels: {\n            color: (ctx)=>ctx.chart.options.color,\n            boxWidth: 40,\n            padding: 10,\n            generateLabels (chart) {\n                const datasets = chart.data.datasets;\n                const { labels: { usePointStyle , pointStyle , textAlign , color , useBorderRadius , borderRadius  }  } = chart.legend.options;\n                return chart._getSortedDatasetMetas().map((meta)=>{\n                    const style = meta.controller.getStyle(usePointStyle ? 0 : undefined);\n                    const borderWidth = toPadding(style.borderWidth);\n                    return {\n                        text: datasets[meta.index].label,\n                        fillStyle: style.backgroundColor,\n                        fontColor: color,\n                        hidden: !meta.visible,\n                        lineCap: style.borderCapStyle,\n                        lineDash: style.borderDash,\n                        lineDashOffset: style.borderDashOffset,\n                        lineJoin: style.borderJoinStyle,\n                        lineWidth: (borderWidth.width + borderWidth.height) / 4,\n                        strokeStyle: style.borderColor,\n                        pointStyle: pointStyle || style.pointStyle,\n                        rotation: style.rotation,\n                        textAlign: textAlign || style.textAlign,\n                        borderRadius: useBorderRadius && (borderRadius || style.borderRadius),\n                        datasetIndex: meta.index\n                    };\n                }, this);\n            }\n        },\n        title: {\n            color: (ctx)=>ctx.chart.options.color,\n            display: false,\n            position: 'center',\n            text: ''\n        }\n    },\n    descriptors: {\n        _scriptable: (name)=>!name.startsWith('on'),\n        labels: {\n            _scriptable: (name)=>![\n                    'generateLabels',\n                    'filter',\n                    'sort'\n                ].includes(name)\n        }\n    }\n};\n\nclass Title extends Element {\n constructor(config){\n        super();\n        this.chart = config.chart;\n        this.options = config.options;\n        this.ctx = config.ctx;\n        this._padding = undefined;\n        this.top = undefined;\n        this.bottom = undefined;\n        this.left = undefined;\n        this.right = undefined;\n        this.width = undefined;\n        this.height = undefined;\n        this.position = undefined;\n        this.weight = undefined;\n        this.fullSize = undefined;\n    }\n    update(maxWidth, maxHeight) {\n        const opts = this.options;\n        this.left = 0;\n        this.top = 0;\n        if (!opts.display) {\n            this.width = this.height = this.right = this.bottom = 0;\n            return;\n        }\n        this.width = this.right = maxWidth;\n        this.height = this.bottom = maxHeight;\n        const lineCount = isArray(opts.text) ? opts.text.length : 1;\n        this._padding = toPadding(opts.padding);\n        const textSize = lineCount * toFont(opts.font).lineHeight + this._padding.height;\n        if (this.isHorizontal()) {\n            this.height = textSize;\n        } else {\n            this.width = textSize;\n        }\n    }\n    isHorizontal() {\n        const pos = this.options.position;\n        return pos === 'top' || pos === 'bottom';\n    }\n    _drawArgs(offset) {\n        const { top , left , bottom , right , options  } = this;\n        const align = options.align;\n        let rotation = 0;\n        let maxWidth, titleX, titleY;\n        if (this.isHorizontal()) {\n            titleX = _alignStartEnd(align, left, right);\n            titleY = top + offset;\n            maxWidth = right - left;\n        } else {\n            if (options.position === 'left') {\n                titleX = left + offset;\n                titleY = _alignStartEnd(align, bottom, top);\n                rotation = PI * -0.5;\n            } else {\n                titleX = right - offset;\n                titleY = _alignStartEnd(align, top, bottom);\n                rotation = PI * 0.5;\n            }\n            maxWidth = bottom - top;\n        }\n        return {\n            titleX,\n            titleY,\n            maxWidth,\n            rotation\n        };\n    }\n    draw() {\n        const ctx = this.ctx;\n        const opts = this.options;\n        if (!opts.display) {\n            return;\n        }\n        const fontOpts = toFont(opts.font);\n        const lineHeight = fontOpts.lineHeight;\n        const offset = lineHeight / 2 + this._padding.top;\n        const { titleX , titleY , maxWidth , rotation  } = this._drawArgs(offset);\n        renderText(ctx, opts.text, 0, 0, fontOpts, {\n            color: opts.color,\n            maxWidth,\n            rotation,\n            textAlign: _toLeftRightCenter(opts.align),\n            textBaseline: 'middle',\n            translation: [\n                titleX,\n                titleY\n            ]\n        });\n    }\n}\nfunction createTitle(chart, titleOpts) {\n    const title = new Title({\n        ctx: chart.ctx,\n        options: titleOpts,\n        chart\n    });\n    layouts.configure(chart, title, titleOpts);\n    layouts.addBox(chart, title);\n    chart.titleBlock = title;\n}\nvar plugin_title = {\n    id: 'title',\n _element: Title,\n    start (chart, _args, options) {\n        createTitle(chart, options);\n    },\n    stop (chart) {\n        const titleBlock = chart.titleBlock;\n        layouts.removeBox(chart, titleBlock);\n        delete chart.titleBlock;\n    },\n    beforeUpdate (chart, _args, options) {\n        const title = chart.titleBlock;\n        layouts.configure(chart, title, options);\n        title.options = options;\n    },\n    defaults: {\n        align: 'center',\n        display: false,\n        font: {\n            weight: 'bold'\n        },\n        fullSize: true,\n        padding: 10,\n        position: 'top',\n        text: '',\n        weight: 2000\n    },\n    defaultRoutes: {\n        color: 'color'\n    },\n    descriptors: {\n        _scriptable: true,\n        _indexable: false\n    }\n};\n\nconst map = new WeakMap();\nvar plugin_subtitle = {\n    id: 'subtitle',\n    start (chart, _args, options) {\n        const title = new Title({\n            ctx: chart.ctx,\n            options,\n            chart\n        });\n        layouts.configure(chart, title, options);\n        layouts.addBox(chart, title);\n        map.set(chart, title);\n    },\n    stop (chart) {\n        layouts.removeBox(chart, map.get(chart));\n        map.delete(chart);\n    },\n    beforeUpdate (chart, _args, options) {\n        const title = map.get(chart);\n        layouts.configure(chart, title, options);\n        title.options = options;\n    },\n    defaults: {\n        align: 'center',\n        display: false,\n        font: {\n            weight: 'normal'\n        },\n        fullSize: true,\n        padding: 0,\n        position: 'top',\n        text: '',\n        weight: 1500\n    },\n    defaultRoutes: {\n        color: 'color'\n    },\n    descriptors: {\n        _scriptable: true,\n        _indexable: false\n    }\n};\n\nconst positioners = {\n average (items) {\n        if (!items.length) {\n            return false;\n        }\n        let i, len;\n        let xSet = new Set();\n        let y = 0;\n        let count = 0;\n        for(i = 0, len = items.length; i < len; ++i){\n            const el = items[i].element;\n            if (el && el.hasValue()) {\n                const pos = el.tooltipPosition();\n                xSet.add(pos.x);\n                y += pos.y;\n                ++count;\n            }\n        }\n        if (count === 0 || xSet.size === 0) {\n            return false;\n        }\n        const xAverage = [\n            ...xSet\n        ].reduce((a, b)=>a + b) / xSet.size;\n        return {\n            x: xAverage,\n            y: y / count\n        };\n    },\n nearest (items, eventPosition) {\n        if (!items.length) {\n            return false;\n        }\n        let x = eventPosition.x;\n        let y = eventPosition.y;\n        let minDistance = Number.POSITIVE_INFINITY;\n        let i, len, nearestElement;\n        for(i = 0, len = items.length; i < len; ++i){\n            const el = items[i].element;\n            if (el && el.hasValue()) {\n                const center = el.getCenterPoint();\n                const d = distanceBetweenPoints(eventPosition, center);\n                if (d < minDistance) {\n                    minDistance = d;\n                    nearestElement = el;\n                }\n            }\n        }\n        if (nearestElement) {\n            const tp = nearestElement.tooltipPosition();\n            x = tp.x;\n            y = tp.y;\n        }\n        return {\n            x,\n            y\n        };\n    }\n};\nfunction pushOrConcat(base, toPush) {\n    if (toPush) {\n        if (isArray(toPush)) {\n            Array.prototype.push.apply(base, toPush);\n        } else {\n            base.push(toPush);\n        }\n    }\n    return base;\n}\n function splitNewlines(str) {\n    if ((typeof str === 'string' || str instanceof String) && str.indexOf('\\n') > -1) {\n        return str.split('\\n');\n    }\n    return str;\n}\n function createTooltipItem(chart, item) {\n    const { element , datasetIndex , index  } = item;\n    const controller = chart.getDatasetMeta(datasetIndex).controller;\n    const { label , value  } = controller.getLabelAndValue(index);\n    return {\n        chart,\n        label,\n        parsed: controller.getParsed(index),\n        raw: chart.data.datasets[datasetIndex].data[index],\n        formattedValue: value,\n        dataset: controller.getDataset(),\n        dataIndex: index,\n        datasetIndex,\n        element\n    };\n}\n function getTooltipSize(tooltip, options) {\n    const ctx = tooltip.chart.ctx;\n    const { body , footer , title  } = tooltip;\n    const { boxWidth , boxHeight  } = options;\n    const bodyFont = toFont(options.bodyFont);\n    const titleFont = toFont(options.titleFont);\n    const footerFont = toFont(options.footerFont);\n    const titleLineCount = title.length;\n    const footerLineCount = footer.length;\n    const bodyLineItemCount = body.length;\n    const padding = toPadding(options.padding);\n    let height = padding.height;\n    let width = 0;\n    let combinedBodyLength = body.reduce((count, bodyItem)=>count + bodyItem.before.length + bodyItem.lines.length + bodyItem.after.length, 0);\n    combinedBodyLength += tooltip.beforeBody.length + tooltip.afterBody.length;\n    if (titleLineCount) {\n        height += titleLineCount * titleFont.lineHeight + (titleLineCount - 1) * options.titleSpacing + options.titleMarginBottom;\n    }\n    if (combinedBodyLength) {\n        const bodyLineHeight = options.displayColors ? Math.max(boxHeight, bodyFont.lineHeight) : bodyFont.lineHeight;\n        height += bodyLineItemCount * bodyLineHeight + (combinedBodyLength - bodyLineItemCount) * bodyFont.lineHeight + (combinedBodyLength - 1) * options.bodySpacing;\n    }\n    if (footerLineCount) {\n        height += options.footerMarginTop + footerLineCount * footerFont.lineHeight + (footerLineCount - 1) * options.footerSpacing;\n    }\n    let widthPadding = 0;\n    const maxLineWidth = function(line) {\n        width = Math.max(width, ctx.measureText(line).width + widthPadding);\n    };\n    ctx.save();\n    ctx.font = titleFont.string;\n    each(tooltip.title, maxLineWidth);\n    ctx.font = bodyFont.string;\n    each(tooltip.beforeBody.concat(tooltip.afterBody), maxLineWidth);\n    widthPadding = options.displayColors ? boxWidth + 2 + options.boxPadding : 0;\n    each(body, (bodyItem)=>{\n        each(bodyItem.before, maxLineWidth);\n        each(bodyItem.lines, maxLineWidth);\n        each(bodyItem.after, maxLineWidth);\n    });\n    widthPadding = 0;\n    ctx.font = footerFont.string;\n    each(tooltip.footer, maxLineWidth);\n    ctx.restore();\n    width += padding.width;\n    return {\n        width,\n        height\n    };\n}\nfunction determineYAlign(chart, size) {\n    const { y , height  } = size;\n    if (y < height / 2) {\n        return 'top';\n    } else if (y > chart.height - height / 2) {\n        return 'bottom';\n    }\n    return 'center';\n}\nfunction doesNotFitWithAlign(xAlign, chart, options, size) {\n    const { x , width  } = size;\n    const caret = options.caretSize + options.caretPadding;\n    if (xAlign === 'left' && x + width + caret > chart.width) {\n        return true;\n    }\n    if (xAlign === 'right' && x - width - caret < 0) {\n        return true;\n    }\n}\nfunction determineXAlign(chart, options, size, yAlign) {\n    const { x , width  } = size;\n    const { width: chartWidth , chartArea: { left , right  }  } = chart;\n    let xAlign = 'center';\n    if (yAlign === 'center') {\n        xAlign = x <= (left + right) / 2 ? 'left' : 'right';\n    } else if (x <= width / 2) {\n        xAlign = 'left';\n    } else if (x >= chartWidth - width / 2) {\n        xAlign = 'right';\n    }\n    if (doesNotFitWithAlign(xAlign, chart, options, size)) {\n        xAlign = 'center';\n    }\n    return xAlign;\n}\n function determineAlignment(chart, options, size) {\n    const yAlign = size.yAlign || options.yAlign || determineYAlign(chart, size);\n    return {\n        xAlign: size.xAlign || options.xAlign || determineXAlign(chart, options, size, yAlign),\n        yAlign\n    };\n}\nfunction alignX(size, xAlign) {\n    let { x , width  } = size;\n    if (xAlign === 'right') {\n        x -= width;\n    } else if (xAlign === 'center') {\n        x -= width / 2;\n    }\n    return x;\n}\nfunction alignY(size, yAlign, paddingAndSize) {\n    let { y , height  } = size;\n    if (yAlign === 'top') {\n        y += paddingAndSize;\n    } else if (yAlign === 'bottom') {\n        y -= height + paddingAndSize;\n    } else {\n        y -= height / 2;\n    }\n    return y;\n}\n function getBackgroundPoint(options, size, alignment, chart) {\n    const { caretSize , caretPadding , cornerRadius  } = options;\n    const { xAlign , yAlign  } = alignment;\n    const paddingAndSize = caretSize + caretPadding;\n    const { topLeft , topRight , bottomLeft , bottomRight  } = toTRBLCorners(cornerRadius);\n    let x = alignX(size, xAlign);\n    const y = alignY(size, yAlign, paddingAndSize);\n    if (yAlign === 'center') {\n        if (xAlign === 'left') {\n            x += paddingAndSize;\n        } else if (xAlign === 'right') {\n            x -= paddingAndSize;\n        }\n    } else if (xAlign === 'left') {\n        x -= Math.max(topLeft, bottomLeft) + caretSize;\n    } else if (xAlign === 'right') {\n        x += Math.max(topRight, bottomRight) + caretSize;\n    }\n    return {\n        x: _limitValue(x, 0, chart.width - size.width),\n        y: _limitValue(y, 0, chart.height - size.height)\n    };\n}\nfunction getAlignedX(tooltip, align, options) {\n    const padding = toPadding(options.padding);\n    return align === 'center' ? tooltip.x + tooltip.width / 2 : align === 'right' ? tooltip.x + tooltip.width - padding.right : tooltip.x + padding.left;\n}\n function getBeforeAfterBodyLines(callback) {\n    return pushOrConcat([], splitNewlines(callback));\n}\nfunction createTooltipContext(parent, tooltip, tooltipItems) {\n    return createContext(parent, {\n        tooltip,\n        tooltipItems,\n        type: 'tooltip'\n    });\n}\nfunction overrideCallbacks(callbacks, context) {\n    const override = context && context.dataset && context.dataset.tooltip && context.dataset.tooltip.callbacks;\n    return override ? callbacks.override(override) : callbacks;\n}\nconst defaultCallbacks = {\n    beforeTitle: noop,\n    title (tooltipItems) {\n        if (tooltipItems.length > 0) {\n            const item = tooltipItems[0];\n            const labels = item.chart.data.labels;\n            const labelCount = labels ? labels.length : 0;\n            if (this && this.options && this.options.mode === 'dataset') {\n                return item.dataset.label || '';\n            } else if (item.label) {\n                return item.label;\n            } else if (labelCount > 0 && item.dataIndex < labelCount) {\n                return labels[item.dataIndex];\n            }\n        }\n        return '';\n    },\n    afterTitle: noop,\n    beforeBody: noop,\n    beforeLabel: noop,\n    label (tooltipItem) {\n        if (this && this.options && this.options.mode === 'dataset') {\n            return tooltipItem.label + ': ' + tooltipItem.formattedValue || tooltipItem.formattedValue;\n        }\n        let label = tooltipItem.dataset.label || '';\n        if (label) {\n            label += ': ';\n        }\n        const value = tooltipItem.formattedValue;\n        if (!isNullOrUndef(value)) {\n            label += value;\n        }\n        return label;\n    },\n    labelColor (tooltipItem) {\n        const meta = tooltipItem.chart.getDatasetMeta(tooltipItem.datasetIndex);\n        const options = meta.controller.getStyle(tooltipItem.dataIndex);\n        return {\n            borderColor: options.borderColor,\n            backgroundColor: options.backgroundColor,\n            borderWidth: options.borderWidth,\n            borderDash: options.borderDash,\n            borderDashOffset: options.borderDashOffset,\n            borderRadius: 0\n        };\n    },\n    labelTextColor () {\n        return this.options.bodyColor;\n    },\n    labelPointStyle (tooltipItem) {\n        const meta = tooltipItem.chart.getDatasetMeta(tooltipItem.datasetIndex);\n        const options = meta.controller.getStyle(tooltipItem.dataIndex);\n        return {\n            pointStyle: options.pointStyle,\n            rotation: options.rotation\n        };\n    },\n    afterLabel: noop,\n    afterBody: noop,\n    beforeFooter: noop,\n    footer: noop,\n    afterFooter: noop\n};\n function invokeCallbackWithFallback(callbacks, name, ctx, arg) {\n    const result = callbacks[name].call(ctx, arg);\n    if (typeof result === 'undefined') {\n        return defaultCallbacks[name].call(ctx, arg);\n    }\n    return result;\n}\nclass Tooltip extends Element {\n static positioners = positioners;\n    constructor(config){\n        super();\n        this.opacity = 0;\n        this._active = [];\n        this._eventPosition = undefined;\n        this._size = undefined;\n        this._cachedAnimations = undefined;\n        this._tooltipItems = [];\n        this.$animations = undefined;\n        this.$context = undefined;\n        this.chart = config.chart;\n        this.options = config.options;\n        this.dataPoints = undefined;\n        this.title = undefined;\n        this.beforeBody = undefined;\n        this.body = undefined;\n        this.afterBody = undefined;\n        this.footer = undefined;\n        this.xAlign = undefined;\n        this.yAlign = undefined;\n        this.x = undefined;\n        this.y = undefined;\n        this.height = undefined;\n        this.width = undefined;\n        this.caretX = undefined;\n        this.caretY = undefined;\n        this.labelColors = undefined;\n        this.labelPointStyles = undefined;\n        this.labelTextColors = undefined;\n    }\n    initialize(options) {\n        this.options = options;\n        this._cachedAnimations = undefined;\n        this.$context = undefined;\n    }\n _resolveAnimations() {\n        const cached = this._cachedAnimations;\n        if (cached) {\n            return cached;\n        }\n        const chart = this.chart;\n        const options = this.options.setContext(this.getContext());\n        const opts = options.enabled && chart.options.animation && options.animations;\n        const animations = new Animations(this.chart, opts);\n        if (opts._cacheable) {\n            this._cachedAnimations = Object.freeze(animations);\n        }\n        return animations;\n    }\n getContext() {\n        return this.$context || (this.$context = createTooltipContext(this.chart.getContext(), this, this._tooltipItems));\n    }\n    getTitle(context, options) {\n        const { callbacks  } = options;\n        const beforeTitle = invokeCallbackWithFallback(callbacks, 'beforeTitle', this, context);\n        const title = invokeCallbackWithFallback(callbacks, 'title', this, context);\n        const afterTitle = invokeCallbackWithFallback(callbacks, 'afterTitle', this, context);\n        let lines = [];\n        lines = pushOrConcat(lines, splitNewlines(beforeTitle));\n        lines = pushOrConcat(lines, splitNewlines(title));\n        lines = pushOrConcat(lines, splitNewlines(afterTitle));\n        return lines;\n    }\n    getBeforeBody(tooltipItems, options) {\n        return getBeforeAfterBodyLines(invokeCallbackWithFallback(options.callbacks, 'beforeBody', this, tooltipItems));\n    }\n    getBody(tooltipItems, options) {\n        const { callbacks  } = options;\n        const bodyItems = [];\n        each(tooltipItems, (context)=>{\n            const bodyItem = {\n                before: [],\n                lines: [],\n                after: []\n            };\n            const scoped = overrideCallbacks(callbacks, context);\n            pushOrConcat(bodyItem.before, splitNewlines(invokeCallbackWithFallback(scoped, 'beforeLabel', this, context)));\n            pushOrConcat(bodyItem.lines, invokeCallbackWithFallback(scoped, 'label', this, context));\n            pushOrConcat(bodyItem.after, splitNewlines(invokeCallbackWithFallback(scoped, 'afterLabel', this, context)));\n            bodyItems.push(bodyItem);\n        });\n        return bodyItems;\n    }\n    getAfterBody(tooltipItems, options) {\n        return getBeforeAfterBodyLines(invokeCallbackWithFallback(options.callbacks, 'afterBody', this, tooltipItems));\n    }\n    getFooter(tooltipItems, options) {\n        const { callbacks  } = options;\n        const beforeFooter = invokeCallbackWithFallback(callbacks, 'beforeFooter', this, tooltipItems);\n        const footer = invokeCallbackWithFallback(callbacks, 'footer', this, tooltipItems);\n        const afterFooter = invokeCallbackWithFallback(callbacks, 'afterFooter', this, tooltipItems);\n        let lines = [];\n        lines = pushOrConcat(lines, splitNewlines(beforeFooter));\n        lines = pushOrConcat(lines, splitNewlines(footer));\n        lines = pushOrConcat(lines, splitNewlines(afterFooter));\n        return lines;\n    }\n _createItems(options) {\n        const active = this._active;\n        const data = this.chart.data;\n        const labelColors = [];\n        const labelPointStyles = [];\n        const labelTextColors = [];\n        let tooltipItems = [];\n        let i, len;\n        for(i = 0, len = active.length; i < len; ++i){\n            tooltipItems.push(createTooltipItem(this.chart, active[i]));\n        }\n        if (options.filter) {\n            tooltipItems = tooltipItems.filter((element, index, array)=>options.filter(element, index, array, data));\n        }\n        if (options.itemSort) {\n            tooltipItems = tooltipItems.sort((a, b)=>options.itemSort(a, b, data));\n        }\n        each(tooltipItems, (context)=>{\n            const scoped = overrideCallbacks(options.callbacks, context);\n            labelColors.push(invokeCallbackWithFallback(scoped, 'labelColor', this, context));\n            labelPointStyles.push(invokeCallbackWithFallback(scoped, 'labelPointStyle', this, context));\n            labelTextColors.push(invokeCallbackWithFallback(scoped, 'labelTextColor', this, context));\n        });\n        this.labelColors = labelColors;\n        this.labelPointStyles = labelPointStyles;\n        this.labelTextColors = labelTextColors;\n        this.dataPoints = tooltipItems;\n        return tooltipItems;\n    }\n    update(changed, replay) {\n        const options = this.options.setContext(this.getContext());\n        const active = this._active;\n        let properties;\n        let tooltipItems = [];\n        if (!active.length) {\n            if (this.opacity !== 0) {\n                properties = {\n                    opacity: 0\n                };\n            }\n        } else {\n            const position = positioners[options.position].call(this, active, this._eventPosition);\n            tooltipItems = this._createItems(options);\n            this.title = this.getTitle(tooltipItems, options);\n            this.beforeBody = this.getBeforeBody(tooltipItems, options);\n            this.body = this.getBody(tooltipItems, options);\n            this.afterBody = this.getAfterBody(tooltipItems, options);\n            this.footer = this.getFooter(tooltipItems, options);\n            const size = this._size = getTooltipSize(this, options);\n            const positionAndSize = Object.assign({}, position, size);\n            const alignment = determineAlignment(this.chart, options, positionAndSize);\n            const backgroundPoint = getBackgroundPoint(options, positionAndSize, alignment, this.chart);\n            this.xAlign = alignment.xAlign;\n            this.yAlign = alignment.yAlign;\n            properties = {\n                opacity: 1,\n                x: backgroundPoint.x,\n                y: backgroundPoint.y,\n                width: size.width,\n                height: size.height,\n                caretX: position.x,\n                caretY: position.y\n            };\n        }\n        this._tooltipItems = tooltipItems;\n        this.$context = undefined;\n        if (properties) {\n            this._resolveAnimations().update(this, properties);\n        }\n        if (changed && options.external) {\n            options.external.call(this, {\n                chart: this.chart,\n                tooltip: this,\n                replay\n            });\n        }\n    }\n    drawCaret(tooltipPoint, ctx, size, options) {\n        const caretPosition = this.getCaretPosition(tooltipPoint, size, options);\n        ctx.lineTo(caretPosition.x1, caretPosition.y1);\n        ctx.lineTo(caretPosition.x2, caretPosition.y2);\n        ctx.lineTo(caretPosition.x3, caretPosition.y3);\n    }\n    getCaretPosition(tooltipPoint, size, options) {\n        const { xAlign , yAlign  } = this;\n        const { caretSize , cornerRadius  } = options;\n        const { topLeft , topRight , bottomLeft , bottomRight  } = toTRBLCorners(cornerRadius);\n        const { x: ptX , y: ptY  } = tooltipPoint;\n        const { width , height  } = size;\n        let x1, x2, x3, y1, y2, y3;\n        if (yAlign === 'center') {\n            y2 = ptY + height / 2;\n            if (xAlign === 'left') {\n                x1 = ptX;\n                x2 = x1 - caretSize;\n                y1 = y2 + caretSize;\n                y3 = y2 - caretSize;\n            } else {\n                x1 = ptX + width;\n                x2 = x1 + caretSize;\n                y1 = y2 - caretSize;\n                y3 = y2 + caretSize;\n            }\n            x3 = x1;\n        } else {\n            if (xAlign === 'left') {\n                x2 = ptX + Math.max(topLeft, bottomLeft) + caretSize;\n            } else if (xAlign === 'right') {\n                x2 = ptX + width - Math.max(topRight, bottomRight) - caretSize;\n            } else {\n                x2 = this.caretX;\n            }\n            if (yAlign === 'top') {\n                y1 = ptY;\n                y2 = y1 - caretSize;\n                x1 = x2 - caretSize;\n                x3 = x2 + caretSize;\n            } else {\n                y1 = ptY + height;\n                y2 = y1 + caretSize;\n                x1 = x2 + caretSize;\n                x3 = x2 - caretSize;\n            }\n            y3 = y1;\n        }\n        return {\n            x1,\n            x2,\n            x3,\n            y1,\n            y2,\n            y3\n        };\n    }\n    drawTitle(pt, ctx, options) {\n        const title = this.title;\n        const length = title.length;\n        let titleFont, titleSpacing, i;\n        if (length) {\n            const rtlHelper = getRtlAdapter(options.rtl, this.x, this.width);\n            pt.x = getAlignedX(this, options.titleAlign, options);\n            ctx.textAlign = rtlHelper.textAlign(options.titleAlign);\n            ctx.textBaseline = 'middle';\n            titleFont = toFont(options.titleFont);\n            titleSpacing = options.titleSpacing;\n            ctx.fillStyle = options.titleColor;\n            ctx.font = titleFont.string;\n            for(i = 0; i < length; ++i){\n                ctx.fillText(title[i], rtlHelper.x(pt.x), pt.y + titleFont.lineHeight / 2);\n                pt.y += titleFont.lineHeight + titleSpacing;\n                if (i + 1 === length) {\n                    pt.y += options.titleMarginBottom - titleSpacing;\n                }\n            }\n        }\n    }\n _drawColorBox(ctx, pt, i, rtlHelper, options) {\n        const labelColor = this.labelColors[i];\n        const labelPointStyle = this.labelPointStyles[i];\n        const { boxHeight , boxWidth  } = options;\n        const bodyFont = toFont(options.bodyFont);\n        const colorX = getAlignedX(this, 'left', options);\n        const rtlColorX = rtlHelper.x(colorX);\n        const yOffSet = boxHeight < bodyFont.lineHeight ? (bodyFont.lineHeight - boxHeight) / 2 : 0;\n        const colorY = pt.y + yOffSet;\n        if (options.usePointStyle) {\n            const drawOptions = {\n                radius: Math.min(boxWidth, boxHeight) / 2,\n                pointStyle: labelPointStyle.pointStyle,\n                rotation: labelPointStyle.rotation,\n                borderWidth: 1\n            };\n            const centerX = rtlHelper.leftForLtr(rtlColorX, boxWidth) + boxWidth / 2;\n            const centerY = colorY + boxHeight / 2;\n            ctx.strokeStyle = options.multiKeyBackground;\n            ctx.fillStyle = options.multiKeyBackground;\n            drawPoint(ctx, drawOptions, centerX, centerY);\n            ctx.strokeStyle = labelColor.borderColor;\n            ctx.fillStyle = labelColor.backgroundColor;\n            drawPoint(ctx, drawOptions, centerX, centerY);\n        } else {\n            ctx.lineWidth = isObject(labelColor.borderWidth) ? Math.max(...Object.values(labelColor.borderWidth)) : labelColor.borderWidth || 1;\n            ctx.strokeStyle = labelColor.borderColor;\n            ctx.setLineDash(labelColor.borderDash || []);\n            ctx.lineDashOffset = labelColor.borderDashOffset || 0;\n            const outerX = rtlHelper.leftForLtr(rtlColorX, boxWidth);\n            const innerX = rtlHelper.leftForLtr(rtlHelper.xPlus(rtlColorX, 1), boxWidth - 2);\n            const borderRadius = toTRBLCorners(labelColor.borderRadius);\n            if (Object.values(borderRadius).some((v)=>v !== 0)) {\n                ctx.beginPath();\n                ctx.fillStyle = options.multiKeyBackground;\n                addRoundedRectPath(ctx, {\n                    x: outerX,\n                    y: colorY,\n                    w: boxWidth,\n                    h: boxHeight,\n                    radius: borderRadius\n                });\n                ctx.fill();\n                ctx.stroke();\n                ctx.fillStyle = labelColor.backgroundColor;\n                ctx.beginPath();\n                addRoundedRectPath(ctx, {\n                    x: innerX,\n                    y: colorY + 1,\n                    w: boxWidth - 2,\n                    h: boxHeight - 2,\n                    radius: borderRadius\n                });\n                ctx.fill();\n            } else {\n                ctx.fillStyle = options.multiKeyBackground;\n                ctx.fillRect(outerX, colorY, boxWidth, boxHeight);\n                ctx.strokeRect(outerX, colorY, boxWidth, boxHeight);\n                ctx.fillStyle = labelColor.backgroundColor;\n                ctx.fillRect(innerX, colorY + 1, boxWidth - 2, boxHeight - 2);\n            }\n        }\n        ctx.fillStyle = this.labelTextColors[i];\n    }\n    drawBody(pt, ctx, options) {\n        const { body  } = this;\n        const { bodySpacing , bodyAlign , displayColors , boxHeight , boxWidth , boxPadding  } = options;\n        const bodyFont = toFont(options.bodyFont);\n        let bodyLineHeight = bodyFont.lineHeight;\n        let xLinePadding = 0;\n        const rtlHelper = getRtlAdapter(options.rtl, this.x, this.width);\n        const fillLineOfText = function(line) {\n            ctx.fillText(line, rtlHelper.x(pt.x + xLinePadding), pt.y + bodyLineHeight / 2);\n            pt.y += bodyLineHeight + bodySpacing;\n        };\n        const bodyAlignForCalculation = rtlHelper.textAlign(bodyAlign);\n        let bodyItem, textColor, lines, i, j, ilen, jlen;\n        ctx.textAlign = bodyAlign;\n        ctx.textBaseline = 'middle';\n        ctx.font = bodyFont.string;\n        pt.x = getAlignedX(this, bodyAlignForCalculation, options);\n        ctx.fillStyle = options.bodyColor;\n        each(this.beforeBody, fillLineOfText);\n        xLinePadding = displayColors && bodyAlignForCalculation !== 'right' ? bodyAlign === 'center' ? boxWidth / 2 + boxPadding : boxWidth + 2 + boxPadding : 0;\n        for(i = 0, ilen = body.length; i < ilen; ++i){\n            bodyItem = body[i];\n            textColor = this.labelTextColors[i];\n            ctx.fillStyle = textColor;\n            each(bodyItem.before, fillLineOfText);\n            lines = bodyItem.lines;\n            if (displayColors && lines.length) {\n                this._drawColorBox(ctx, pt, i, rtlHelper, options);\n                bodyLineHeight = Math.max(bodyFont.lineHeight, boxHeight);\n            }\n            for(j = 0, jlen = lines.length; j < jlen; ++j){\n                fillLineOfText(lines[j]);\n                bodyLineHeight = bodyFont.lineHeight;\n            }\n            each(bodyItem.after, fillLineOfText);\n        }\n        xLinePadding = 0;\n        bodyLineHeight = bodyFont.lineHeight;\n        each(this.afterBody, fillLineOfText);\n        pt.y -= bodySpacing;\n    }\n    drawFooter(pt, ctx, options) {\n        const footer = this.footer;\n        const length = footer.length;\n        let footerFont, i;\n        if (length) {\n            const rtlHelper = getRtlAdapter(options.rtl, this.x, this.width);\n            pt.x = getAlignedX(this, options.footerAlign, options);\n            pt.y += options.footerMarginTop;\n            ctx.textAlign = rtlHelper.textAlign(options.footerAlign);\n            ctx.textBaseline = 'middle';\n            footerFont = toFont(options.footerFont);\n            ctx.fillStyle = options.footerColor;\n            ctx.font = footerFont.string;\n            for(i = 0; i < length; ++i){\n                ctx.fillText(footer[i], rtlHelper.x(pt.x), pt.y + footerFont.lineHeight / 2);\n                pt.y += footerFont.lineHeight + options.footerSpacing;\n            }\n        }\n    }\n    drawBackground(pt, ctx, tooltipSize, options) {\n        const { xAlign , yAlign  } = this;\n        const { x , y  } = pt;\n        const { width , height  } = tooltipSize;\n        const { topLeft , topRight , bottomLeft , bottomRight  } = toTRBLCorners(options.cornerRadius);\n        ctx.fillStyle = options.backgroundColor;\n        ctx.strokeStyle = options.borderColor;\n        ctx.lineWidth = options.borderWidth;\n        ctx.beginPath();\n        ctx.moveTo(x + topLeft, y);\n        if (yAlign === 'top') {\n            this.drawCaret(pt, ctx, tooltipSize, options);\n        }\n        ctx.lineTo(x + width - topRight, y);\n        ctx.quadraticCurveTo(x + width, y, x + width, y + topRight);\n        if (yAlign === 'center' && xAlign === 'right') {\n            this.drawCaret(pt, ctx, tooltipSize, options);\n        }\n        ctx.lineTo(x + width, y + height - bottomRight);\n        ctx.quadraticCurveTo(x + width, y + height, x + width - bottomRight, y + height);\n        if (yAlign === 'bottom') {\n            this.drawCaret(pt, ctx, tooltipSize, options);\n        }\n        ctx.lineTo(x + bottomLeft, y + height);\n        ctx.quadraticCurveTo(x, y + height, x, y + height - bottomLeft);\n        if (yAlign === 'center' && xAlign === 'left') {\n            this.drawCaret(pt, ctx, tooltipSize, options);\n        }\n        ctx.lineTo(x, y + topLeft);\n        ctx.quadraticCurveTo(x, y, x + topLeft, y);\n        ctx.closePath();\n        ctx.fill();\n        if (options.borderWidth > 0) {\n            ctx.stroke();\n        }\n    }\n _updateAnimationTarget(options) {\n        const chart = this.chart;\n        const anims = this.$animations;\n        const animX = anims && anims.x;\n        const animY = anims && anims.y;\n        if (animX || animY) {\n            const position = positioners[options.position].call(this, this._active, this._eventPosition);\n            if (!position) {\n                return;\n            }\n            const size = this._size = getTooltipSize(this, options);\n            const positionAndSize = Object.assign({}, position, this._size);\n            const alignment = determineAlignment(chart, options, positionAndSize);\n            const point = getBackgroundPoint(options, positionAndSize, alignment, chart);\n            if (animX._to !== point.x || animY._to !== point.y) {\n                this.xAlign = alignment.xAlign;\n                this.yAlign = alignment.yAlign;\n                this.width = size.width;\n                this.height = size.height;\n                this.caretX = position.x;\n                this.caretY = position.y;\n                this._resolveAnimations().update(this, point);\n            }\n        }\n    }\n _willRender() {\n        return !!this.opacity;\n    }\n    draw(ctx) {\n        const options = this.options.setContext(this.getContext());\n        let opacity = this.opacity;\n        if (!opacity) {\n            return;\n        }\n        this._updateAnimationTarget(options);\n        const tooltipSize = {\n            width: this.width,\n            height: this.height\n        };\n        const pt = {\n            x: this.x,\n            y: this.y\n        };\n        opacity = Math.abs(opacity) < 1e-3 ? 0 : opacity;\n        const padding = toPadding(options.padding);\n        const hasTooltipContent = this.title.length || this.beforeBody.length || this.body.length || this.afterBody.length || this.footer.length;\n        if (options.enabled && hasTooltipContent) {\n            ctx.save();\n            ctx.globalAlpha = opacity;\n            this.drawBackground(pt, ctx, tooltipSize, options);\n            overrideTextDirection(ctx, options.textDirection);\n            pt.y += padding.top;\n            this.drawTitle(pt, ctx, options);\n            this.drawBody(pt, ctx, options);\n            this.drawFooter(pt, ctx, options);\n            restoreTextDirection(ctx, options.textDirection);\n            ctx.restore();\n        }\n    }\n getActiveElements() {\n        return this._active || [];\n    }\n setActiveElements(activeElements, eventPosition) {\n        const lastActive = this._active;\n        const active = activeElements.map(({ datasetIndex , index  })=>{\n            const meta = this.chart.getDatasetMeta(datasetIndex);\n            if (!meta) {\n                throw new Error('Cannot find a dataset at index ' + datasetIndex);\n            }\n            return {\n                datasetIndex,\n                element: meta.data[index],\n                index\n            };\n        });\n        const changed = !_elementsEqual(lastActive, active);\n        const positionChanged = this._positionChanged(active, eventPosition);\n        if (changed || positionChanged) {\n            this._active = active;\n            this._eventPosition = eventPosition;\n            this._ignoreReplayEvents = true;\n            this.update(true);\n        }\n    }\n handleEvent(e, replay, inChartArea = true) {\n        if (replay && this._ignoreReplayEvents) {\n            return false;\n        }\n        this._ignoreReplayEvents = false;\n        const options = this.options;\n        const lastActive = this._active || [];\n        const active = this._getActiveElements(e, lastActive, replay, inChartArea);\n        const positionChanged = this._positionChanged(active, e);\n        const changed = replay || !_elementsEqual(active, lastActive) || positionChanged;\n        if (changed) {\n            this._active = active;\n            if (options.enabled || options.external) {\n                this._eventPosition = {\n                    x: e.x,\n                    y: e.y\n                };\n                this.update(true, replay);\n            }\n        }\n        return changed;\n    }\n _getActiveElements(e, lastActive, replay, inChartArea) {\n        const options = this.options;\n        if (e.type === 'mouseout') {\n            return [];\n        }\n        if (!inChartArea) {\n            return lastActive.filter((i)=>this.chart.data.datasets[i.datasetIndex] && this.chart.getDatasetMeta(i.datasetIndex).controller.getParsed(i.index) !== undefined);\n        }\n        const active = this.chart.getElementsAtEventForMode(e, options.mode, options, replay);\n        if (options.reverse) {\n            active.reverse();\n        }\n        return active;\n    }\n _positionChanged(active, e) {\n        const { caretX , caretY , options  } = this;\n        const position = positioners[options.position].call(this, active, e);\n        return position !== false && (caretX !== position.x || caretY !== position.y);\n    }\n}\nvar plugin_tooltip = {\n    id: 'tooltip',\n    _element: Tooltip,\n    positioners,\n    afterInit (chart, _args, options) {\n        if (options) {\n            chart.tooltip = new Tooltip({\n                chart,\n                options\n            });\n        }\n    },\n    beforeUpdate (chart, _args, options) {\n        if (chart.tooltip) {\n            chart.tooltip.initialize(options);\n        }\n    },\n    reset (chart, _args, options) {\n        if (chart.tooltip) {\n            chart.tooltip.initialize(options);\n        }\n    },\n    afterDraw (chart) {\n        const tooltip = chart.tooltip;\n        if (tooltip && tooltip._willRender()) {\n            const args = {\n                tooltip\n            };\n            if (chart.notifyPlugins('beforeTooltipDraw', {\n                ...args,\n                cancelable: true\n            }) === false) {\n                return;\n            }\n            tooltip.draw(chart.ctx);\n            chart.notifyPlugins('afterTooltipDraw', args);\n        }\n    },\n    afterEvent (chart, args) {\n        if (chart.tooltip) {\n            const useFinalPosition = args.replay;\n            if (chart.tooltip.handleEvent(args.event, useFinalPosition, args.inChartArea)) {\n                args.changed = true;\n            }\n        }\n    },\n    defaults: {\n        enabled: true,\n        external: null,\n        position: 'average',\n        backgroundColor: 'rgba(0,0,0,0.8)',\n        titleColor: '#fff',\n        titleFont: {\n            weight: 'bold'\n        },\n        titleSpacing: 2,\n        titleMarginBottom: 6,\n        titleAlign: 'left',\n        bodyColor: '#fff',\n        bodySpacing: 2,\n        bodyFont: {},\n        bodyAlign: 'left',\n        footerColor: '#fff',\n        footerSpacing: 2,\n        footerMarginTop: 6,\n        footerFont: {\n            weight: 'bold'\n        },\n        footerAlign: 'left',\n        padding: 6,\n        caretPadding: 2,\n        caretSize: 5,\n        cornerRadius: 6,\n        boxHeight: (ctx, opts)=>opts.bodyFont.size,\n        boxWidth: (ctx, opts)=>opts.bodyFont.size,\n        multiKeyBackground: '#fff',\n        displayColors: true,\n        boxPadding: 0,\n        borderColor: 'rgba(0,0,0,0)',\n        borderWidth: 0,\n        animation: {\n            duration: 400,\n            easing: 'easeOutQuart'\n        },\n        animations: {\n            numbers: {\n                type: 'number',\n                properties: [\n                    'x',\n                    'y',\n                    'width',\n                    'height',\n                    'caretX',\n                    'caretY'\n                ]\n            },\n            opacity: {\n                easing: 'linear',\n                duration: 200\n            }\n        },\n        callbacks: defaultCallbacks\n    },\n    defaultRoutes: {\n        bodyFont: 'font',\n        footerFont: 'font',\n        titleFont: 'font'\n    },\n    descriptors: {\n        _scriptable: (name)=>name !== 'filter' && name !== 'itemSort' && name !== 'external',\n        _indexable: false,\n        callbacks: {\n            _scriptable: false,\n            _indexable: false\n        },\n        animation: {\n            _fallback: false\n        },\n        animations: {\n            _fallback: 'animation'\n        }\n    },\n    additionalOptionScopes: [\n        'interaction'\n    ]\n};\n\nvar plugins = /*#__PURE__*/Object.freeze({\n__proto__: null,\nColors: plugin_colors,\nDecimation: plugin_decimation,\nFiller: index,\nLegend: plugin_legend,\nSubTitle: plugin_subtitle,\nTitle: plugin_title,\nTooltip: plugin_tooltip\n});\n\nconst addIfString = (labels, raw, index, addedLabels)=>{\n    if (typeof raw === 'string') {\n        index = labels.push(raw) - 1;\n        addedLabels.unshift({\n            index,\n            label: raw\n        });\n    } else if (isNaN(raw)) {\n        index = null;\n    }\n    return index;\n};\nfunction findOrAddLabel(labels, raw, index, addedLabels) {\n    const first = labels.indexOf(raw);\n    if (first === -1) {\n        return addIfString(labels, raw, index, addedLabels);\n    }\n    const last = labels.lastIndexOf(raw);\n    return first !== last ? index : first;\n}\nconst validIndex = (index, max)=>index === null ? null : _limitValue(Math.round(index), 0, max);\nfunction _getLabelForValue(value) {\n    const labels = this.getLabels();\n    if (value >= 0 && value < labels.length) {\n        return labels[value];\n    }\n    return value;\n}\nclass CategoryScale extends Scale {\n    static id = 'category';\n static defaults = {\n        ticks: {\n            callback: _getLabelForValue\n        }\n    };\n    constructor(cfg){\n        super(cfg);\n         this._startValue = undefined;\n        this._valueRange = 0;\n        this._addedLabels = [];\n    }\n    init(scaleOptions) {\n        const added = this._addedLabels;\n        if (added.length) {\n            const labels = this.getLabels();\n            for (const { index , label  } of added){\n                if (labels[index] === label) {\n                    labels.splice(index, 1);\n                }\n            }\n            this._addedLabels = [];\n        }\n        super.init(scaleOptions);\n    }\n    parse(raw, index) {\n        if (isNullOrUndef(raw)) {\n            return null;\n        }\n        const labels = this.getLabels();\n        index = isFinite(index) && labels[index] === raw ? index : findOrAddLabel(labels, raw, valueOrDefault(index, raw), this._addedLabels);\n        return validIndex(index, labels.length - 1);\n    }\n    determineDataLimits() {\n        const { minDefined , maxDefined  } = this.getUserBounds();\n        let { min , max  } = this.getMinMax(true);\n        if (this.options.bounds === 'ticks') {\n            if (!minDefined) {\n                min = 0;\n            }\n            if (!maxDefined) {\n                max = this.getLabels().length - 1;\n            }\n        }\n        this.min = min;\n        this.max = max;\n    }\n    buildTicks() {\n        const min = this.min;\n        const max = this.max;\n        const offset = this.options.offset;\n        const ticks = [];\n        let labels = this.getLabels();\n        labels = min === 0 && max === labels.length - 1 ? labels : labels.slice(min, max + 1);\n        this._valueRange = Math.max(labels.length - (offset ? 0 : 1), 1);\n        this._startValue = this.min - (offset ? 0.5 : 0);\n        for(let value = min; value <= max; value++){\n            ticks.push({\n                value\n            });\n        }\n        return ticks;\n    }\n    getLabelForValue(value) {\n        return _getLabelForValue.call(this, value);\n    }\n configure() {\n        super.configure();\n        if (!this.isHorizontal()) {\n            this._reversePixels = !this._reversePixels;\n        }\n    }\n    getPixelForValue(value) {\n        if (typeof value !== 'number') {\n            value = this.parse(value);\n        }\n        return value === null ? NaN : this.getPixelForDecimal((value - this._startValue) / this._valueRange);\n    }\n    getPixelForTick(index) {\n        const ticks = this.ticks;\n        if (index < 0 || index > ticks.length - 1) {\n            return null;\n        }\n        return this.getPixelForValue(ticks[index].value);\n    }\n    getValueForPixel(pixel) {\n        return Math.round(this._startValue + this.getDecimalForPixel(pixel) * this._valueRange);\n    }\n    getBasePixel() {\n        return this.bottom;\n    }\n}\n\nfunction generateTicks$1(generationOptions, dataRange) {\n    const ticks = [];\n    const MIN_SPACING = 1e-14;\n    const { bounds , step , min , max , precision , count , maxTicks , maxDigits , includeBounds  } = generationOptions;\n    const unit = step || 1;\n    const maxSpaces = maxTicks - 1;\n    const { min: rmin , max: rmax  } = dataRange;\n    const minDefined = !isNullOrUndef(min);\n    const maxDefined = !isNullOrUndef(max);\n    const countDefined = !isNullOrUndef(count);\n    const minSpacing = (rmax - rmin) / (maxDigits + 1);\n    let spacing = niceNum((rmax - rmin) / maxSpaces / unit) * unit;\n    let factor, niceMin, niceMax, numSpaces;\n    if (spacing < MIN_SPACING && !minDefined && !maxDefined) {\n        return [\n            {\n                value: rmin\n            },\n            {\n                value: rmax\n            }\n        ];\n    }\n    numSpaces = Math.ceil(rmax / spacing) - Math.floor(rmin / spacing);\n    if (numSpaces > maxSpaces) {\n        spacing = niceNum(numSpaces * spacing / maxSpaces / unit) * unit;\n    }\n    if (!isNullOrUndef(precision)) {\n        factor = Math.pow(10, precision);\n        spacing = Math.ceil(spacing * factor) / factor;\n    }\n    if (bounds === 'ticks') {\n        niceMin = Math.floor(rmin / spacing) * spacing;\n        niceMax = Math.ceil(rmax / spacing) * spacing;\n    } else {\n        niceMin = rmin;\n        niceMax = rmax;\n    }\n    if (minDefined && maxDefined && step && almostWhole((max - min) / step, spacing / 1000)) {\n        numSpaces = Math.round(Math.min((max - min) / spacing, maxTicks));\n        spacing = (max - min) / numSpaces;\n        niceMin = min;\n        niceMax = max;\n    } else if (countDefined) {\n        niceMin = minDefined ? min : niceMin;\n        niceMax = maxDefined ? max : niceMax;\n        numSpaces = count - 1;\n        spacing = (niceMax - niceMin) / numSpaces;\n    } else {\n        numSpaces = (niceMax - niceMin) / spacing;\n        if (almostEquals(numSpaces, Math.round(numSpaces), spacing / 1000)) {\n            numSpaces = Math.round(numSpaces);\n        } else {\n            numSpaces = Math.ceil(numSpaces);\n        }\n    }\n    const decimalPlaces = Math.max(_decimalPlaces(spacing), _decimalPlaces(niceMin));\n    factor = Math.pow(10, isNullOrUndef(precision) ? decimalPlaces : precision);\n    niceMin = Math.round(niceMin * factor) / factor;\n    niceMax = Math.round(niceMax * factor) / factor;\n    let j = 0;\n    if (minDefined) {\n        if (includeBounds && niceMin !== min) {\n            ticks.push({\n                value: min\n            });\n            if (niceMin < min) {\n                j++;\n            }\n            if (almostEquals(Math.round((niceMin + j * spacing) * factor) / factor, min, relativeLabelSize(min, minSpacing, generationOptions))) {\n                j++;\n            }\n        } else if (niceMin < min) {\n            j++;\n        }\n    }\n    for(; j < numSpaces; ++j){\n        const tickValue = Math.round((niceMin + j * spacing) * factor) / factor;\n        if (maxDefined && tickValue > max) {\n            break;\n        }\n        ticks.push({\n            value: tickValue\n        });\n    }\n    if (maxDefined && includeBounds && niceMax !== max) {\n        if (ticks.length && almostEquals(ticks[ticks.length - 1].value, max, relativeLabelSize(max, minSpacing, generationOptions))) {\n            ticks[ticks.length - 1].value = max;\n        } else {\n            ticks.push({\n                value: max\n            });\n        }\n    } else if (!maxDefined || niceMax === max) {\n        ticks.push({\n            value: niceMax\n        });\n    }\n    return ticks;\n}\nfunction relativeLabelSize(value, minSpacing, { horizontal , minRotation  }) {\n    const rad = toRadians(minRotation);\n    const ratio = (horizontal ? Math.sin(rad) : Math.cos(rad)) || 0.001;\n    const length = 0.75 * minSpacing * ('' + value).length;\n    return Math.min(minSpacing / ratio, length);\n}\nclass LinearScaleBase extends Scale {\n    constructor(cfg){\n        super(cfg);\n         this.start = undefined;\n         this.end = undefined;\n         this._startValue = undefined;\n         this._endValue = undefined;\n        this._valueRange = 0;\n    }\n    parse(raw, index) {\n        if (isNullOrUndef(raw)) {\n            return null;\n        }\n        if ((typeof raw === 'number' || raw instanceof Number) && !isFinite(+raw)) {\n            return null;\n        }\n        return +raw;\n    }\n    handleTickRangeOptions() {\n        const { beginAtZero  } = this.options;\n        const { minDefined , maxDefined  } = this.getUserBounds();\n        let { min , max  } = this;\n        const setMin = (v)=>min = minDefined ? min : v;\n        const setMax = (v)=>max = maxDefined ? max : v;\n        if (beginAtZero) {\n            const minSign = sign(min);\n            const maxSign = sign(max);\n            if (minSign < 0 && maxSign < 0) {\n                setMax(0);\n            } else if (minSign > 0 && maxSign > 0) {\n                setMin(0);\n            }\n        }\n        if (min === max) {\n            let offset = max === 0 ? 1 : Math.abs(max * 0.05);\n            setMax(max + offset);\n            if (!beginAtZero) {\n                setMin(min - offset);\n            }\n        }\n        this.min = min;\n        this.max = max;\n    }\n    getTickLimit() {\n        const tickOpts = this.options.ticks;\n        let { maxTicksLimit , stepSize  } = tickOpts;\n        let maxTicks;\n        if (stepSize) {\n            maxTicks = Math.ceil(this.max / stepSize) - Math.floor(this.min / stepSize) + 1;\n            if (maxTicks > 1000) {\n                console.warn(`scales.${this.id}.ticks.stepSize: ${stepSize} would result generating up to ${maxTicks} ticks. Limiting to 1000.`);\n                maxTicks = 1000;\n            }\n        } else {\n            maxTicks = this.computeTickLimit();\n            maxTicksLimit = maxTicksLimit || 11;\n        }\n        if (maxTicksLimit) {\n            maxTicks = Math.min(maxTicksLimit, maxTicks);\n        }\n        return maxTicks;\n    }\n computeTickLimit() {\n        return Number.POSITIVE_INFINITY;\n    }\n    buildTicks() {\n        const opts = this.options;\n        const tickOpts = opts.ticks;\n        let maxTicks = this.getTickLimit();\n        maxTicks = Math.max(2, maxTicks);\n        const numericGeneratorOptions = {\n            maxTicks,\n            bounds: opts.bounds,\n            min: opts.min,\n            max: opts.max,\n            precision: tickOpts.precision,\n            step: tickOpts.stepSize,\n            count: tickOpts.count,\n            maxDigits: this._maxDigits(),\n            horizontal: this.isHorizontal(),\n            minRotation: tickOpts.minRotation || 0,\n            includeBounds: tickOpts.includeBounds !== false\n        };\n        const dataRange = this._range || this;\n        const ticks = generateTicks$1(numericGeneratorOptions, dataRange);\n        if (opts.bounds === 'ticks') {\n            _setMinAndMaxByKey(ticks, this, 'value');\n        }\n        if (opts.reverse) {\n            ticks.reverse();\n            this.start = this.max;\n            this.end = this.min;\n        } else {\n            this.start = this.min;\n            this.end = this.max;\n        }\n        return ticks;\n    }\n configure() {\n        const ticks = this.ticks;\n        let start = this.min;\n        let end = this.max;\n        super.configure();\n        if (this.options.offset && ticks.length) {\n            const offset = (end - start) / Math.max(ticks.length - 1, 1) / 2;\n            start -= offset;\n            end += offset;\n        }\n        this._startValue = start;\n        this._endValue = end;\n        this._valueRange = end - start;\n    }\n    getLabelForValue(value) {\n        return formatNumber(value, this.chart.options.locale, this.options.ticks.format);\n    }\n}\n\nclass LinearScale extends LinearScaleBase {\n    static id = 'linear';\n static defaults = {\n        ticks: {\n            callback: Ticks.formatters.numeric\n        }\n    };\n    determineDataLimits() {\n        const { min , max  } = this.getMinMax(true);\n        this.min = isNumberFinite(min) ? min : 0;\n        this.max = isNumberFinite(max) ? max : 1;\n        this.handleTickRangeOptions();\n    }\n computeTickLimit() {\n        const horizontal = this.isHorizontal();\n        const length = horizontal ? this.width : this.height;\n        const minRotation = toRadians(this.options.ticks.minRotation);\n        const ratio = (horizontal ? Math.sin(minRotation) : Math.cos(minRotation)) || 0.001;\n        const tickFont = this._resolveTickFontOptions(0);\n        return Math.ceil(length / Math.min(40, tickFont.lineHeight / ratio));\n    }\n    getPixelForValue(value) {\n        return value === null ? NaN : this.getPixelForDecimal((value - this._startValue) / this._valueRange);\n    }\n    getValueForPixel(pixel) {\n        return this._startValue + this.getDecimalForPixel(pixel) * this._valueRange;\n    }\n}\n\nconst log10Floor = (v)=>Math.floor(log10(v));\nconst changeExponent = (v, m)=>Math.pow(10, log10Floor(v) + m);\nfunction isMajor(tickVal) {\n    const remain = tickVal / Math.pow(10, log10Floor(tickVal));\n    return remain === 1;\n}\nfunction steps(min, max, rangeExp) {\n    const rangeStep = Math.pow(10, rangeExp);\n    const start = Math.floor(min / rangeStep);\n    const end = Math.ceil(max / rangeStep);\n    return end - start;\n}\nfunction startExp(min, max) {\n    const range = max - min;\n    let rangeExp = log10Floor(range);\n    while(steps(min, max, rangeExp) > 10){\n        rangeExp++;\n    }\n    while(steps(min, max, rangeExp) < 10){\n        rangeExp--;\n    }\n    return Math.min(rangeExp, log10Floor(min));\n}\n function generateTicks(generationOptions, { min , max  }) {\n    min = finiteOrDefault(generationOptions.min, min);\n    const ticks = [];\n    const minExp = log10Floor(min);\n    let exp = startExp(min, max);\n    let precision = exp < 0 ? Math.pow(10, Math.abs(exp)) : 1;\n    const stepSize = Math.pow(10, exp);\n    const base = minExp > exp ? Math.pow(10, minExp) : 0;\n    const start = Math.round((min - base) * precision) / precision;\n    const offset = Math.floor((min - base) / stepSize / 10) * stepSize * 10;\n    let significand = Math.floor((start - offset) / Math.pow(10, exp));\n    let value = finiteOrDefault(generationOptions.min, Math.round((base + offset + significand * Math.pow(10, exp)) * precision) / precision);\n    while(value < max){\n        ticks.push({\n            value,\n            major: isMajor(value),\n            significand\n        });\n        if (significand >= 10) {\n            significand = significand < 15 ? 15 : 20;\n        } else {\n            significand++;\n        }\n        if (significand >= 20) {\n            exp++;\n            significand = 2;\n            precision = exp >= 0 ? 1 : precision;\n        }\n        value = Math.round((base + offset + significand * Math.pow(10, exp)) * precision) / precision;\n    }\n    const lastTick = finiteOrDefault(generationOptions.max, value);\n    ticks.push({\n        value: lastTick,\n        major: isMajor(lastTick),\n        significand\n    });\n    return ticks;\n}\nclass LogarithmicScale extends Scale {\n    static id = 'logarithmic';\n static defaults = {\n        ticks: {\n            callback: Ticks.formatters.logarithmic,\n            major: {\n                enabled: true\n            }\n        }\n    };\n    constructor(cfg){\n        super(cfg);\n         this.start = undefined;\n         this.end = undefined;\n         this._startValue = undefined;\n        this._valueRange = 0;\n    }\n    parse(raw, index) {\n        const value = LinearScaleBase.prototype.parse.apply(this, [\n            raw,\n            index\n        ]);\n        if (value === 0) {\n            this._zero = true;\n            return undefined;\n        }\n        return isNumberFinite(value) && value > 0 ? value : null;\n    }\n    determineDataLimits() {\n        const { min , max  } = this.getMinMax(true);\n        this.min = isNumberFinite(min) ? Math.max(0, min) : null;\n        this.max = isNumberFinite(max) ? Math.max(0, max) : null;\n        if (this.options.beginAtZero) {\n            this._zero = true;\n        }\n        if (this._zero && this.min !== this._suggestedMin && !isNumberFinite(this._userMin)) {\n            this.min = min === changeExponent(this.min, 0) ? changeExponent(this.min, -1) : changeExponent(this.min, 0);\n        }\n        this.handleTickRangeOptions();\n    }\n    handleTickRangeOptions() {\n        const { minDefined , maxDefined  } = this.getUserBounds();\n        let min = this.min;\n        let max = this.max;\n        const setMin = (v)=>min = minDefined ? min : v;\n        const setMax = (v)=>max = maxDefined ? max : v;\n        if (min === max) {\n            if (min <= 0) {\n                setMin(1);\n                setMax(10);\n            } else {\n                setMin(changeExponent(min, -1));\n                setMax(changeExponent(max, +1));\n            }\n        }\n        if (min <= 0) {\n            setMin(changeExponent(max, -1));\n        }\n        if (max <= 0) {\n            setMax(changeExponent(min, +1));\n        }\n        this.min = min;\n        this.max = max;\n    }\n    buildTicks() {\n        const opts = this.options;\n        const generationOptions = {\n            min: this._userMin,\n            max: this._userMax\n        };\n        const ticks = generateTicks(generationOptions, this);\n        if (opts.bounds === 'ticks') {\n            _setMinAndMaxByKey(ticks, this, 'value');\n        }\n        if (opts.reverse) {\n            ticks.reverse();\n            this.start = this.max;\n            this.end = this.min;\n        } else {\n            this.start = this.min;\n            this.end = this.max;\n        }\n        return ticks;\n    }\n getLabelForValue(value) {\n        return value === undefined ? '0' : formatNumber(value, this.chart.options.locale, this.options.ticks.format);\n    }\n configure() {\n        const start = this.min;\n        super.configure();\n        this._startValue = log10(start);\n        this._valueRange = log10(this.max) - log10(start);\n    }\n    getPixelForValue(value) {\n        if (value === undefined || value === 0) {\n            value = this.min;\n        }\n        if (value === null || isNaN(value)) {\n            return NaN;\n        }\n        return this.getPixelForDecimal(value === this.min ? 0 : (log10(value) - this._startValue) / this._valueRange);\n    }\n    getValueForPixel(pixel) {\n        const decimal = this.getDecimalForPixel(pixel);\n        return Math.pow(10, this._startValue + decimal * this._valueRange);\n    }\n}\n\nfunction getTickBackdropHeight(opts) {\n    const tickOpts = opts.ticks;\n    if (tickOpts.display && opts.display) {\n        const padding = toPadding(tickOpts.backdropPadding);\n        return valueOrDefault(tickOpts.font && tickOpts.font.size, defaults.font.size) + padding.height;\n    }\n    return 0;\n}\nfunction measureLabelSize(ctx, font, label) {\n    label = isArray(label) ? label : [\n        label\n    ];\n    return {\n        w: _longestText(ctx, font.string, label),\n        h: label.length * font.lineHeight\n    };\n}\nfunction determineLimits(angle, pos, size, min, max) {\n    if (angle === min || angle === max) {\n        return {\n            start: pos - size / 2,\n            end: pos + size / 2\n        };\n    } else if (angle < min || angle > max) {\n        return {\n            start: pos - size,\n            end: pos\n        };\n    }\n    return {\n        start: pos,\n        end: pos + size\n    };\n}\n function fitWithPointLabels(scale) {\n    const orig = {\n        l: scale.left + scale._padding.left,\n        r: scale.right - scale._padding.right,\n        t: scale.top + scale._padding.top,\n        b: scale.bottom - scale._padding.bottom\n    };\n    const limits = Object.assign({}, orig);\n    const labelSizes = [];\n    const padding = [];\n    const valueCount = scale._pointLabels.length;\n    const pointLabelOpts = scale.options.pointLabels;\n    const additionalAngle = pointLabelOpts.centerPointLabels ? PI / valueCount : 0;\n    for(let i = 0; i < valueCount; i++){\n        const opts = pointLabelOpts.setContext(scale.getPointLabelContext(i));\n        padding[i] = opts.padding;\n        const pointPosition = scale.getPointPosition(i, scale.drawingArea + padding[i], additionalAngle);\n        const plFont = toFont(opts.font);\n        const textSize = measureLabelSize(scale.ctx, plFont, scale._pointLabels[i]);\n        labelSizes[i] = textSize;\n        const angleRadians = _normalizeAngle(scale.getIndexAngle(i) + additionalAngle);\n        const angle = Math.round(toDegrees(angleRadians));\n        const hLimits = determineLimits(angle, pointPosition.x, textSize.w, 0, 180);\n        const vLimits = determineLimits(angle, pointPosition.y, textSize.h, 90, 270);\n        updateLimits(limits, orig, angleRadians, hLimits, vLimits);\n    }\n    scale.setCenterPoint(orig.l - limits.l, limits.r - orig.r, orig.t - limits.t, limits.b - orig.b);\n    scale._pointLabelItems = buildPointLabelItems(scale, labelSizes, padding);\n}\nfunction updateLimits(limits, orig, angle, hLimits, vLimits) {\n    const sin = Math.abs(Math.sin(angle));\n    const cos = Math.abs(Math.cos(angle));\n    let x = 0;\n    let y = 0;\n    if (hLimits.start < orig.l) {\n        x = (orig.l - hLimits.start) / sin;\n        limits.l = Math.min(limits.l, orig.l - x);\n    } else if (hLimits.end > orig.r) {\n        x = (hLimits.end - orig.r) / sin;\n        limits.r = Math.max(limits.r, orig.r + x);\n    }\n    if (vLimits.start < orig.t) {\n        y = (orig.t - vLimits.start) / cos;\n        limits.t = Math.min(limits.t, orig.t - y);\n    } else if (vLimits.end > orig.b) {\n        y = (vLimits.end - orig.b) / cos;\n        limits.b = Math.max(limits.b, orig.b + y);\n    }\n}\nfunction createPointLabelItem(scale, index, itemOpts) {\n    const outerDistance = scale.drawingArea;\n    const { extra , additionalAngle , padding , size  } = itemOpts;\n    const pointLabelPosition = scale.getPointPosition(index, outerDistance + extra + padding, additionalAngle);\n    const angle = Math.round(toDegrees(_normalizeAngle(pointLabelPosition.angle + HALF_PI)));\n    const y = yForAngle(pointLabelPosition.y, size.h, angle);\n    const textAlign = getTextAlignForAngle(angle);\n    const left = leftForTextAlign(pointLabelPosition.x, size.w, textAlign);\n    return {\n        visible: true,\n        x: pointLabelPosition.x,\n        y,\n        textAlign,\n        left,\n        top: y,\n        right: left + size.w,\n        bottom: y + size.h\n    };\n}\nfunction isNotOverlapped(item, area) {\n    if (!area) {\n        return true;\n    }\n    const { left , top , right , bottom  } = item;\n    const apexesInArea = _isPointInArea({\n        x: left,\n        y: top\n    }, area) || _isPointInArea({\n        x: left,\n        y: bottom\n    }, area) || _isPointInArea({\n        x: right,\n        y: top\n    }, area) || _isPointInArea({\n        x: right,\n        y: bottom\n    }, area);\n    return !apexesInArea;\n}\nfunction buildPointLabelItems(scale, labelSizes, padding) {\n    const items = [];\n    const valueCount = scale._pointLabels.length;\n    const opts = scale.options;\n    const { centerPointLabels , display  } = opts.pointLabels;\n    const itemOpts = {\n        extra: getTickBackdropHeight(opts) / 2,\n        additionalAngle: centerPointLabels ? PI / valueCount : 0\n    };\n    let area;\n    for(let i = 0; i < valueCount; i++){\n        itemOpts.padding = padding[i];\n        itemOpts.size = labelSizes[i];\n        const item = createPointLabelItem(scale, i, itemOpts);\n        items.push(item);\n        if (display === 'auto') {\n            item.visible = isNotOverlapped(item, area);\n            if (item.visible) {\n                area = item;\n            }\n        }\n    }\n    return items;\n}\nfunction getTextAlignForAngle(angle) {\n    if (angle === 0 || angle === 180) {\n        return 'center';\n    } else if (angle < 180) {\n        return 'left';\n    }\n    return 'right';\n}\nfunction leftForTextAlign(x, w, align) {\n    if (align === 'right') {\n        x -= w;\n    } else if (align === 'center') {\n        x -= w / 2;\n    }\n    return x;\n}\nfunction yForAngle(y, h, angle) {\n    if (angle === 90 || angle === 270) {\n        y -= h / 2;\n    } else if (angle > 270 || angle < 90) {\n        y -= h;\n    }\n    return y;\n}\nfunction drawPointLabelBox(ctx, opts, item) {\n    const { left , top , right , bottom  } = item;\n    const { backdropColor  } = opts;\n    if (!isNullOrUndef(backdropColor)) {\n        const borderRadius = toTRBLCorners(opts.borderRadius);\n        const padding = toPadding(opts.backdropPadding);\n        ctx.fillStyle = backdropColor;\n        const backdropLeft = left - padding.left;\n        const backdropTop = top - padding.top;\n        const backdropWidth = right - left + padding.width;\n        const backdropHeight = bottom - top + padding.height;\n        if (Object.values(borderRadius).some((v)=>v !== 0)) {\n            ctx.beginPath();\n            addRoundedRectPath(ctx, {\n                x: backdropLeft,\n                y: backdropTop,\n                w: backdropWidth,\n                h: backdropHeight,\n                radius: borderRadius\n            });\n            ctx.fill();\n        } else {\n            ctx.fillRect(backdropLeft, backdropTop, backdropWidth, backdropHeight);\n        }\n    }\n}\nfunction drawPointLabels(scale, labelCount) {\n    const { ctx , options: { pointLabels  }  } = scale;\n    for(let i = labelCount - 1; i >= 0; i--){\n        const item = scale._pointLabelItems[i];\n        if (!item.visible) {\n            continue;\n        }\n        const optsAtIndex = pointLabels.setContext(scale.getPointLabelContext(i));\n        drawPointLabelBox(ctx, optsAtIndex, item);\n        const plFont = toFont(optsAtIndex.font);\n        const { x , y , textAlign  } = item;\n        renderText(ctx, scale._pointLabels[i], x, y + plFont.lineHeight / 2, plFont, {\n            color: optsAtIndex.color,\n            textAlign: textAlign,\n            textBaseline: 'middle'\n        });\n    }\n}\nfunction pathRadiusLine(scale, radius, circular, labelCount) {\n    const { ctx  } = scale;\n    if (circular) {\n        ctx.arc(scale.xCenter, scale.yCenter, radius, 0, TAU);\n    } else {\n        let pointPosition = scale.getPointPosition(0, radius);\n        ctx.moveTo(pointPosition.x, pointPosition.y);\n        for(let i = 1; i < labelCount; i++){\n            pointPosition = scale.getPointPosition(i, radius);\n            ctx.lineTo(pointPosition.x, pointPosition.y);\n        }\n    }\n}\nfunction drawRadiusLine(scale, gridLineOpts, radius, labelCount, borderOpts) {\n    const ctx = scale.ctx;\n    const circular = gridLineOpts.circular;\n    const { color , lineWidth  } = gridLineOpts;\n    if (!circular && !labelCount || !color || !lineWidth || radius < 0) {\n        return;\n    }\n    ctx.save();\n    ctx.strokeStyle = color;\n    ctx.lineWidth = lineWidth;\n    ctx.setLineDash(borderOpts.dash || []);\n    ctx.lineDashOffset = borderOpts.dashOffset;\n    ctx.beginPath();\n    pathRadiusLine(scale, radius, circular, labelCount);\n    ctx.closePath();\n    ctx.stroke();\n    ctx.restore();\n}\nfunction createPointLabelContext(parent, index, label) {\n    return createContext(parent, {\n        label,\n        index,\n        type: 'pointLabel'\n    });\n}\nclass RadialLinearScale extends LinearScaleBase {\n    static id = 'radialLinear';\n static defaults = {\n        display: true,\n        animate: true,\n        position: 'chartArea',\n        angleLines: {\n            display: true,\n            lineWidth: 1,\n            borderDash: [],\n            borderDashOffset: 0.0\n        },\n        grid: {\n            circular: false\n        },\n        startAngle: 0,\n        ticks: {\n            showLabelBackdrop: true,\n            callback: Ticks.formatters.numeric\n        },\n        pointLabels: {\n            backdropColor: undefined,\n            backdropPadding: 2,\n            display: true,\n            font: {\n                size: 10\n            },\n            callback (label) {\n                return label;\n            },\n            padding: 5,\n            centerPointLabels: false\n        }\n    };\n    static defaultRoutes = {\n        'angleLines.color': 'borderColor',\n        'pointLabels.color': 'color',\n        'ticks.color': 'color'\n    };\n    static descriptors = {\n        angleLines: {\n            _fallback: 'grid'\n        }\n    };\n    constructor(cfg){\n        super(cfg);\n         this.xCenter = undefined;\n         this.yCenter = undefined;\n         this.drawingArea = undefined;\n         this._pointLabels = [];\n        this._pointLabelItems = [];\n    }\n    setDimensions() {\n        const padding = this._padding = toPadding(getTickBackdropHeight(this.options) / 2);\n        const w = this.width = this.maxWidth - padding.width;\n        const h = this.height = this.maxHeight - padding.height;\n        this.xCenter = Math.floor(this.left + w / 2 + padding.left);\n        this.yCenter = Math.floor(this.top + h / 2 + padding.top);\n        this.drawingArea = Math.floor(Math.min(w, h) / 2);\n    }\n    determineDataLimits() {\n        const { min , max  } = this.getMinMax(false);\n        this.min = isNumberFinite(min) && !isNaN(min) ? min : 0;\n        this.max = isNumberFinite(max) && !isNaN(max) ? max : 0;\n        this.handleTickRangeOptions();\n    }\n computeTickLimit() {\n        return Math.ceil(this.drawingArea / getTickBackdropHeight(this.options));\n    }\n    generateTickLabels(ticks) {\n        LinearScaleBase.prototype.generateTickLabels.call(this, ticks);\n        this._pointLabels = this.getLabels().map((value, index)=>{\n            const label = callback(this.options.pointLabels.callback, [\n                value,\n                index\n            ], this);\n            return label || label === 0 ? label : '';\n        }).filter((v, i)=>this.chart.getDataVisibility(i));\n    }\n    fit() {\n        const opts = this.options;\n        if (opts.display && opts.pointLabels.display) {\n            fitWithPointLabels(this);\n        } else {\n            this.setCenterPoint(0, 0, 0, 0);\n        }\n    }\n    setCenterPoint(leftMovement, rightMovement, topMovement, bottomMovement) {\n        this.xCenter += Math.floor((leftMovement - rightMovement) / 2);\n        this.yCenter += Math.floor((topMovement - bottomMovement) / 2);\n        this.drawingArea -= Math.min(this.drawingArea / 2, Math.max(leftMovement, rightMovement, topMovement, bottomMovement));\n    }\n    getIndexAngle(index) {\n        const angleMultiplier = TAU / (this._pointLabels.length || 1);\n        const startAngle = this.options.startAngle || 0;\n        return _normalizeAngle(index * angleMultiplier + toRadians(startAngle));\n    }\n    getDistanceFromCenterForValue(value) {\n        if (isNullOrUndef(value)) {\n            return NaN;\n        }\n        const scalingFactor = this.drawingArea / (this.max - this.min);\n        if (this.options.reverse) {\n            return (this.max - value) * scalingFactor;\n        }\n        return (value - this.min) * scalingFactor;\n    }\n    getValueForDistanceFromCenter(distance) {\n        if (isNullOrUndef(distance)) {\n            return NaN;\n        }\n        const scaledDistance = distance / (this.drawingArea / (this.max - this.min));\n        return this.options.reverse ? this.max - scaledDistance : this.min + scaledDistance;\n    }\n    getPointLabelContext(index) {\n        const pointLabels = this._pointLabels || [];\n        if (index >= 0 && index < pointLabels.length) {\n            const pointLabel = pointLabels[index];\n            return createPointLabelContext(this.getContext(), index, pointLabel);\n        }\n    }\n    getPointPosition(index, distanceFromCenter, additionalAngle = 0) {\n        const angle = this.getIndexAngle(index) - HALF_PI + additionalAngle;\n        return {\n            x: Math.cos(angle) * distanceFromCenter + this.xCenter,\n            y: Math.sin(angle) * distanceFromCenter + this.yCenter,\n            angle\n        };\n    }\n    getPointPositionForValue(index, value) {\n        return this.getPointPosition(index, this.getDistanceFromCenterForValue(value));\n    }\n    getBasePosition(index) {\n        return this.getPointPositionForValue(index || 0, this.getBaseValue());\n    }\n    getPointLabelPosition(index) {\n        const { left , top , right , bottom  } = this._pointLabelItems[index];\n        return {\n            left,\n            top,\n            right,\n            bottom\n        };\n    }\n drawBackground() {\n        const { backgroundColor , grid: { circular  }  } = this.options;\n        if (backgroundColor) {\n            const ctx = this.ctx;\n            ctx.save();\n            ctx.beginPath();\n            pathRadiusLine(this, this.getDistanceFromCenterForValue(this._endValue), circular, this._pointLabels.length);\n            ctx.closePath();\n            ctx.fillStyle = backgroundColor;\n            ctx.fill();\n            ctx.restore();\n        }\n    }\n drawGrid() {\n        const ctx = this.ctx;\n        const opts = this.options;\n        const { angleLines , grid , border  } = opts;\n        const labelCount = this._pointLabels.length;\n        let i, offset, position;\n        if (opts.pointLabels.display) {\n            drawPointLabels(this, labelCount);\n        }\n        if (grid.display) {\n            this.ticks.forEach((tick, index)=>{\n                if (index !== 0 || index === 0 && this.min < 0) {\n                    offset = this.getDistanceFromCenterForValue(tick.value);\n                    const context = this.getContext(index);\n                    const optsAtIndex = grid.setContext(context);\n                    const optsAtIndexBorder = border.setContext(context);\n                    drawRadiusLine(this, optsAtIndex, offset, labelCount, optsAtIndexBorder);\n                }\n            });\n        }\n        if (angleLines.display) {\n            ctx.save();\n            for(i = labelCount - 1; i >= 0; i--){\n                const optsAtIndex = angleLines.setContext(this.getPointLabelContext(i));\n                const { color , lineWidth  } = optsAtIndex;\n                if (!lineWidth || !color) {\n                    continue;\n                }\n                ctx.lineWidth = lineWidth;\n                ctx.strokeStyle = color;\n                ctx.setLineDash(optsAtIndex.borderDash);\n                ctx.lineDashOffset = optsAtIndex.borderDashOffset;\n                offset = this.getDistanceFromCenterForValue(opts.reverse ? this.min : this.max);\n                position = this.getPointPosition(i, offset);\n                ctx.beginPath();\n                ctx.moveTo(this.xCenter, this.yCenter);\n                ctx.lineTo(position.x, position.y);\n                ctx.stroke();\n            }\n            ctx.restore();\n        }\n    }\n drawBorder() {}\n drawLabels() {\n        const ctx = this.ctx;\n        const opts = this.options;\n        const tickOpts = opts.ticks;\n        if (!tickOpts.display) {\n            return;\n        }\n        const startAngle = this.getIndexAngle(0);\n        let offset, width;\n        ctx.save();\n        ctx.translate(this.xCenter, this.yCenter);\n        ctx.rotate(startAngle);\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        this.ticks.forEach((tick, index)=>{\n            if (index === 0 && this.min >= 0 && !opts.reverse) {\n                return;\n            }\n            const optsAtIndex = tickOpts.setContext(this.getContext(index));\n            const tickFont = toFont(optsAtIndex.font);\n            offset = this.getDistanceFromCenterForValue(this.ticks[index].value);\n            if (optsAtIndex.showLabelBackdrop) {\n                ctx.font = tickFont.string;\n                width = ctx.measureText(tick.label).width;\n                ctx.fillStyle = optsAtIndex.backdropColor;\n                const padding = toPadding(optsAtIndex.backdropPadding);\n                ctx.fillRect(-width / 2 - padding.left, -offset - tickFont.size / 2 - padding.top, width + padding.width, tickFont.size + padding.height);\n            }\n            renderText(ctx, tick.label, 0, -offset, tickFont, {\n                color: optsAtIndex.color,\n                strokeColor: optsAtIndex.textStrokeColor,\n                strokeWidth: optsAtIndex.textStrokeWidth\n            });\n        });\n        ctx.restore();\n    }\n drawTitle() {}\n}\n\nconst INTERVALS = {\n    millisecond: {\n        common: true,\n        size: 1,\n        steps: 1000\n    },\n    second: {\n        common: true,\n        size: 1000,\n        steps: 60\n    },\n    minute: {\n        common: true,\n        size: 60000,\n        steps: 60\n    },\n    hour: {\n        common: true,\n        size: 3600000,\n        steps: 24\n    },\n    day: {\n        common: true,\n        size: 86400000,\n        steps: 30\n    },\n    week: {\n        common: false,\n        size: 604800000,\n        steps: 4\n    },\n    month: {\n        common: true,\n        size: 2.628e9,\n        steps: 12\n    },\n    quarter: {\n        common: false,\n        size: 7.884e9,\n        steps: 4\n    },\n    year: {\n        common: true,\n        size: 3.154e10\n    }\n};\n const UNITS =  /* #__PURE__ */ Object.keys(INTERVALS);\n function sorter(a, b) {\n    return a - b;\n}\n function parse(scale, input) {\n    if (isNullOrUndef(input)) {\n        return null;\n    }\n    const adapter = scale._adapter;\n    const { parser , round , isoWeekday  } = scale._parseOpts;\n    let value = input;\n    if (typeof parser === 'function') {\n        value = parser(value);\n    }\n    if (!isNumberFinite(value)) {\n        value = typeof parser === 'string' ? adapter.parse(value, parser) : adapter.parse(value);\n    }\n    if (value === null) {\n        return null;\n    }\n    if (round) {\n        value = round === 'week' && (isNumber(isoWeekday) || isoWeekday === true) ? adapter.startOf(value, 'isoWeek', isoWeekday) : adapter.startOf(value, round);\n    }\n    return +value;\n}\n function determineUnitForAutoTicks(minUnit, min, max, capacity) {\n    const ilen = UNITS.length;\n    for(let i = UNITS.indexOf(minUnit); i < ilen - 1; ++i){\n        const interval = INTERVALS[UNITS[i]];\n        const factor = interval.steps ? interval.steps : Number.MAX_SAFE_INTEGER;\n        if (interval.common && Math.ceil((max - min) / (factor * interval.size)) <= capacity) {\n            return UNITS[i];\n        }\n    }\n    return UNITS[ilen - 1];\n}\n function determineUnitForFormatting(scale, numTicks, minUnit, min, max) {\n    for(let i = UNITS.length - 1; i >= UNITS.indexOf(minUnit); i--){\n        const unit = UNITS[i];\n        if (INTERVALS[unit].common && scale._adapter.diff(max, min, unit) >= numTicks - 1) {\n            return unit;\n        }\n    }\n    return UNITS[minUnit ? UNITS.indexOf(minUnit) : 0];\n}\n function determineMajorUnit(unit) {\n    for(let i = UNITS.indexOf(unit) + 1, ilen = UNITS.length; i < ilen; ++i){\n        if (INTERVALS[UNITS[i]].common) {\n            return UNITS[i];\n        }\n    }\n}\n function addTick(ticks, time, timestamps) {\n    if (!timestamps) {\n        ticks[time] = true;\n    } else if (timestamps.length) {\n        const { lo , hi  } = _lookup(timestamps, time);\n        const timestamp = timestamps[lo] >= time ? timestamps[lo] : timestamps[hi];\n        ticks[timestamp] = true;\n    }\n}\n function setMajorTicks(scale, ticks, map, majorUnit) {\n    const adapter = scale._adapter;\n    const first = +adapter.startOf(ticks[0].value, majorUnit);\n    const last = ticks[ticks.length - 1].value;\n    let major, index;\n    for(major = first; major <= last; major = +adapter.add(major, 1, majorUnit)){\n        index = map[major];\n        if (index >= 0) {\n            ticks[index].major = true;\n        }\n    }\n    return ticks;\n}\n function ticksFromTimestamps(scale, values, majorUnit) {\n    const ticks = [];\n     const map = {};\n    const ilen = values.length;\n    let i, value;\n    for(i = 0; i < ilen; ++i){\n        value = values[i];\n        map[value] = i;\n        ticks.push({\n            value,\n            major: false\n        });\n    }\n    return ilen === 0 || !majorUnit ? ticks : setMajorTicks(scale, ticks, map, majorUnit);\n}\nclass TimeScale extends Scale {\n    static id = 'time';\n static defaults = {\n bounds: 'data',\n        adapters: {},\n        time: {\n            parser: false,\n            unit: false,\n            round: false,\n            isoWeekday: false,\n            minUnit: 'millisecond',\n            displayFormats: {}\n        },\n        ticks: {\n source: 'auto',\n            callback: false,\n            major: {\n                enabled: false\n            }\n        }\n    };\n constructor(props){\n        super(props);\n         this._cache = {\n            data: [],\n            labels: [],\n            all: []\n        };\n         this._unit = 'day';\n         this._majorUnit = undefined;\n        this._offsets = {};\n        this._normalized = false;\n        this._parseOpts = undefined;\n    }\n    init(scaleOpts, opts = {}) {\n        const time = scaleOpts.time || (scaleOpts.time = {});\n         const adapter = this._adapter = new adapters._date(scaleOpts.adapters.date);\n        adapter.init(opts);\n        mergeIf(time.displayFormats, adapter.formats());\n        this._parseOpts = {\n            parser: time.parser,\n            round: time.round,\n            isoWeekday: time.isoWeekday\n        };\n        super.init(scaleOpts);\n        this._normalized = opts.normalized;\n    }\n parse(raw, index) {\n        if (raw === undefined) {\n            return null;\n        }\n        return parse(this, raw);\n    }\n    beforeLayout() {\n        super.beforeLayout();\n        this._cache = {\n            data: [],\n            labels: [],\n            all: []\n        };\n    }\n    determineDataLimits() {\n        const options = this.options;\n        const adapter = this._adapter;\n        const unit = options.time.unit || 'day';\n        let { min , max , minDefined , maxDefined  } = this.getUserBounds();\n function _applyBounds(bounds) {\n            if (!minDefined && !isNaN(bounds.min)) {\n                min = Math.min(min, bounds.min);\n            }\n            if (!maxDefined && !isNaN(bounds.max)) {\n                max = Math.max(max, bounds.max);\n            }\n        }\n        if (!minDefined || !maxDefined) {\n            _applyBounds(this._getLabelBounds());\n            if (options.bounds !== 'ticks' || options.ticks.source !== 'labels') {\n                _applyBounds(this.getMinMax(false));\n            }\n        }\n        min = isNumberFinite(min) && !isNaN(min) ? min : +adapter.startOf(Date.now(), unit);\n        max = isNumberFinite(max) && !isNaN(max) ? max : +adapter.endOf(Date.now(), unit) + 1;\n        this.min = Math.min(min, max - 1);\n        this.max = Math.max(min + 1, max);\n    }\n _getLabelBounds() {\n        const arr = this.getLabelTimestamps();\n        let min = Number.POSITIVE_INFINITY;\n        let max = Number.NEGATIVE_INFINITY;\n        if (arr.length) {\n            min = arr[0];\n            max = arr[arr.length - 1];\n        }\n        return {\n            min,\n            max\n        };\n    }\n buildTicks() {\n        const options = this.options;\n        const timeOpts = options.time;\n        const tickOpts = options.ticks;\n        const timestamps = tickOpts.source === 'labels' ? this.getLabelTimestamps() : this._generate();\n        if (options.bounds === 'ticks' && timestamps.length) {\n            this.min = this._userMin || timestamps[0];\n            this.max = this._userMax || timestamps[timestamps.length - 1];\n        }\n        const min = this.min;\n        const max = this.max;\n        const ticks = _filterBetween(timestamps, min, max);\n        this._unit = timeOpts.unit || (tickOpts.autoSkip ? determineUnitForAutoTicks(timeOpts.minUnit, this.min, this.max, this._getLabelCapacity(min)) : determineUnitForFormatting(this, ticks.length, timeOpts.minUnit, this.min, this.max));\n        this._majorUnit = !tickOpts.major.enabled || this._unit === 'year' ? undefined : determineMajorUnit(this._unit);\n        this.initOffsets(timestamps);\n        if (options.reverse) {\n            ticks.reverse();\n        }\n        return ticksFromTimestamps(this, ticks, this._majorUnit);\n    }\n    afterAutoSkip() {\n        if (this.options.offsetAfterAutoskip) {\n            this.initOffsets(this.ticks.map((tick)=>+tick.value));\n        }\n    }\n initOffsets(timestamps = []) {\n        let start = 0;\n        let end = 0;\n        let first, last;\n        if (this.options.offset && timestamps.length) {\n            first = this.getDecimalForValue(timestamps[0]);\n            if (timestamps.length === 1) {\n                start = 1 - first;\n            } else {\n                start = (this.getDecimalForValue(timestamps[1]) - first) / 2;\n            }\n            last = this.getDecimalForValue(timestamps[timestamps.length - 1]);\n            if (timestamps.length === 1) {\n                end = last;\n            } else {\n                end = (last - this.getDecimalForValue(timestamps[timestamps.length - 2])) / 2;\n            }\n        }\n        const limit = timestamps.length < 3 ? 0.5 : 0.25;\n        start = _limitValue(start, 0, limit);\n        end = _limitValue(end, 0, limit);\n        this._offsets = {\n            start,\n            end,\n            factor: 1 / (start + 1 + end)\n        };\n    }\n _generate() {\n        const adapter = this._adapter;\n        const min = this.min;\n        const max = this.max;\n        const options = this.options;\n        const timeOpts = options.time;\n        const minor = timeOpts.unit || determineUnitForAutoTicks(timeOpts.minUnit, min, max, this._getLabelCapacity(min));\n        const stepSize = valueOrDefault(options.ticks.stepSize, 1);\n        const weekday = minor === 'week' ? timeOpts.isoWeekday : false;\n        const hasWeekday = isNumber(weekday) || weekday === true;\n        const ticks = {};\n        let first = min;\n        let time, count;\n        if (hasWeekday) {\n            first = +adapter.startOf(first, 'isoWeek', weekday);\n        }\n        first = +adapter.startOf(first, hasWeekday ? 'day' : minor);\n        if (adapter.diff(max, min, minor) > 100000 * stepSize) {\n            throw new Error(min + ' and ' + max + ' are too far apart with stepSize of ' + stepSize + ' ' + minor);\n        }\n        const timestamps = options.ticks.source === 'data' && this.getDataTimestamps();\n        for(time = first, count = 0; time < max; time = +adapter.add(time, stepSize, minor), count++){\n            addTick(ticks, time, timestamps);\n        }\n        if (time === max || options.bounds === 'ticks' || count === 1) {\n            addTick(ticks, time, timestamps);\n        }\n        return Object.keys(ticks).sort(sorter).map((x)=>+x);\n    }\n getLabelForValue(value) {\n        const adapter = this._adapter;\n        const timeOpts = this.options.time;\n        if (timeOpts.tooltipFormat) {\n            return adapter.format(value, timeOpts.tooltipFormat);\n        }\n        return adapter.format(value, timeOpts.displayFormats.datetime);\n    }\n format(value, format) {\n        const options = this.options;\n        const formats = options.time.displayFormats;\n        const unit = this._unit;\n        const fmt = format || formats[unit];\n        return this._adapter.format(value, fmt);\n    }\n _tickFormatFunction(time, index, ticks, format) {\n        const options = this.options;\n        const formatter = options.ticks.callback;\n        if (formatter) {\n            return callback(formatter, [\n                time,\n                index,\n                ticks\n            ], this);\n        }\n        const formats = options.time.displayFormats;\n        const unit = this._unit;\n        const majorUnit = this._majorUnit;\n        const minorFormat = unit && formats[unit];\n        const majorFormat = majorUnit && formats[majorUnit];\n        const tick = ticks[index];\n        const major = majorUnit && majorFormat && tick && tick.major;\n        return this._adapter.format(time, format || (major ? majorFormat : minorFormat));\n    }\n generateTickLabels(ticks) {\n        let i, ilen, tick;\n        for(i = 0, ilen = ticks.length; i < ilen; ++i){\n            tick = ticks[i];\n            tick.label = this._tickFormatFunction(tick.value, i, ticks);\n        }\n    }\n getDecimalForValue(value) {\n        return value === null ? NaN : (value - this.min) / (this.max - this.min);\n    }\n getPixelForValue(value) {\n        const offsets = this._offsets;\n        const pos = this.getDecimalForValue(value);\n        return this.getPixelForDecimal((offsets.start + pos) * offsets.factor);\n    }\n getValueForPixel(pixel) {\n        const offsets = this._offsets;\n        const pos = this.getDecimalForPixel(pixel) / offsets.factor - offsets.end;\n        return this.min + pos * (this.max - this.min);\n    }\n _getLabelSize(label) {\n        const ticksOpts = this.options.ticks;\n        const tickLabelWidth = this.ctx.measureText(label).width;\n        const angle = toRadians(this.isHorizontal() ? ticksOpts.maxRotation : ticksOpts.minRotation);\n        const cosRotation = Math.cos(angle);\n        const sinRotation = Math.sin(angle);\n        const tickFontSize = this._resolveTickFontOptions(0).size;\n        return {\n            w: tickLabelWidth * cosRotation + tickFontSize * sinRotation,\n            h: tickLabelWidth * sinRotation + tickFontSize * cosRotation\n        };\n    }\n _getLabelCapacity(exampleTime) {\n        const timeOpts = this.options.time;\n        const displayFormats = timeOpts.displayFormats;\n        const format = displayFormats[timeOpts.unit] || displayFormats.millisecond;\n        const exampleLabel = this._tickFormatFunction(exampleTime, 0, ticksFromTimestamps(this, [\n            exampleTime\n        ], this._majorUnit), format);\n        const size = this._getLabelSize(exampleLabel);\n        const capacity = Math.floor(this.isHorizontal() ? this.width / size.w : this.height / size.h) - 1;\n        return capacity > 0 ? capacity : 1;\n    }\n getDataTimestamps() {\n        let timestamps = this._cache.data || [];\n        let i, ilen;\n        if (timestamps.length) {\n            return timestamps;\n        }\n        const metas = this.getMatchingVisibleMetas();\n        if (this._normalized && metas.length) {\n            return this._cache.data = metas[0].controller.getAllParsedValues(this);\n        }\n        for(i = 0, ilen = metas.length; i < ilen; ++i){\n            timestamps = timestamps.concat(metas[i].controller.getAllParsedValues(this));\n        }\n        return this._cache.data = this.normalize(timestamps);\n    }\n getLabelTimestamps() {\n        const timestamps = this._cache.labels || [];\n        let i, ilen;\n        if (timestamps.length) {\n            return timestamps;\n        }\n        const labels = this.getLabels();\n        for(i = 0, ilen = labels.length; i < ilen; ++i){\n            timestamps.push(parse(this, labels[i]));\n        }\n        return this._cache.labels = this._normalized ? timestamps : this.normalize(timestamps);\n    }\n normalize(values) {\n        return _arrayUnique(values.sort(sorter));\n    }\n}\n\nfunction interpolate(table, val, reverse) {\n    let lo = 0;\n    let hi = table.length - 1;\n    let prevSource, nextSource, prevTarget, nextTarget;\n    if (reverse) {\n        if (val >= table[lo].pos && val <= table[hi].pos) {\n            ({ lo , hi  } = _lookupByKey(table, 'pos', val));\n        }\n        ({ pos: prevSource , time: prevTarget  } = table[lo]);\n        ({ pos: nextSource , time: nextTarget  } = table[hi]);\n    } else {\n        if (val >= table[lo].time && val <= table[hi].time) {\n            ({ lo , hi  } = _lookupByKey(table, 'time', val));\n        }\n        ({ time: prevSource , pos: prevTarget  } = table[lo]);\n        ({ time: nextSource , pos: nextTarget  } = table[hi]);\n    }\n    const span = nextSource - prevSource;\n    return span ? prevTarget + (nextTarget - prevTarget) * (val - prevSource) / span : prevTarget;\n}\nclass TimeSeriesScale extends TimeScale {\n    static id = 'timeseries';\n static defaults = TimeScale.defaults;\n constructor(props){\n        super(props);\n         this._table = [];\n         this._minPos = undefined;\n         this._tableRange = undefined;\n    }\n initOffsets() {\n        const timestamps = this._getTimestampsForTable();\n        const table = this._table = this.buildLookupTable(timestamps);\n        this._minPos = interpolate(table, this.min);\n        this._tableRange = interpolate(table, this.max) - this._minPos;\n        super.initOffsets(timestamps);\n    }\n buildLookupTable(timestamps) {\n        const { min , max  } = this;\n        const items = [];\n        const table = [];\n        let i, ilen, prev, curr, next;\n        for(i = 0, ilen = timestamps.length; i < ilen; ++i){\n            curr = timestamps[i];\n            if (curr >= min && curr <= max) {\n                items.push(curr);\n            }\n        }\n        if (items.length < 2) {\n            return [\n                {\n                    time: min,\n                    pos: 0\n                },\n                {\n                    time: max,\n                    pos: 1\n                }\n            ];\n        }\n        for(i = 0, ilen = items.length; i < ilen; ++i){\n            next = items[i + 1];\n            prev = items[i - 1];\n            curr = items[i];\n            if (Math.round((next + prev) / 2) !== curr) {\n                table.push({\n                    time: curr,\n                    pos: i / (ilen - 1)\n                });\n            }\n        }\n        return table;\n    }\n _generate() {\n        const min = this.min;\n        const max = this.max;\n        let timestamps = super.getDataTimestamps();\n        if (!timestamps.includes(min) || !timestamps.length) {\n            timestamps.splice(0, 0, min);\n        }\n        if (!timestamps.includes(max) || timestamps.length === 1) {\n            timestamps.push(max);\n        }\n        return timestamps.sort((a, b)=>a - b);\n    }\n _getTimestampsForTable() {\n        let timestamps = this._cache.all || [];\n        if (timestamps.length) {\n            return timestamps;\n        }\n        const data = this.getDataTimestamps();\n        const label = this.getLabelTimestamps();\n        if (data.length && label.length) {\n            timestamps = this.normalize(data.concat(label));\n        } else {\n            timestamps = data.length ? data : label;\n        }\n        timestamps = this._cache.all = timestamps;\n        return timestamps;\n    }\n getDecimalForValue(value) {\n        return (interpolate(this._table, value) - this._minPos) / this._tableRange;\n    }\n getValueForPixel(pixel) {\n        const offsets = this._offsets;\n        const decimal = this.getDecimalForPixel(pixel) / offsets.factor - offsets.end;\n        return interpolate(this._table, decimal * this._tableRange + this._minPos, true);\n    }\n}\n\nvar scales = /*#__PURE__*/Object.freeze({\n__proto__: null,\nCategoryScale: CategoryScale,\nLinearScale: LinearScale,\nLogarithmicScale: LogarithmicScale,\nRadialLinearScale: RadialLinearScale,\nTimeScale: TimeScale,\nTimeSeriesScale: TimeSeriesScale\n});\n\nconst registerables = [\n    controllers,\n    elements,\n    plugins,\n    scales\n];\n\nexport { Animation, Animations, ArcElement, BarController, BarElement, BasePlatform, BasicPlatform, BubbleController, CategoryScale, Chart, plugin_colors as Colors, DatasetController, plugin_decimation as Decimation, DomPlatform, DoughnutController, Element, index as Filler, Interaction, plugin_legend as Legend, LineController, LineElement, LinearScale, LogarithmicScale, PieController, PointElement, PolarAreaController, RadarController, RadialLinearScale, Scale, ScatterController, plugin_subtitle as SubTitle, Ticks, TimeScale, TimeSeriesScale, plugin_title as Title, plugin_tooltip as Tooltip, adapters as _adapters, _detectPlatform, animator, controllers, defaults, elements, layouts, plugins, registerables, registry, scales };\n//# sourceMappingURL=chart.js.map\n","import {Chart, registerables} from '../dist/chart.js';\n\nChart.register(...registerables);\n\nexport * from '../dist/chart.js';\nexport default Chart;\n","import { Chart, type ChartConfiguration } from 'chart.js/auto';\nimport { personalRecordsStore } from '../state/PersonalRecordsStore.js';\n\n/**\n * Render Power Curve Comparison Chart\n * Compares specific workout curve against All-Time and Season bests\n */\nexport function renderPowerCurveComparison(\n    canvasId: string,\n    workoutCurve: { duration: number; watts: number }[]\n): Chart | null {\n    const canvas = document.getElementById(canvasId) as HTMLCanvasElement;\n    if (!canvas) return null;\n\n    // Get comparison data\n    const allTime = personalRecordsStore.getAllTimeCurve();\n    const season = personalRecordsStore.getSeasonCurve();\n\n    // Collect all unique durations to ensure x-axis covers everything\n    const workoutDurations = workoutCurve.map((p) => p.duration);\n    const allTimeDurations = Object.keys(allTime).map(Number);\n    const seasonDurations = Object.keys(season).map(Number);\n\n    const allDurations = Array.from(new Set([...workoutDurations, ...allTimeDurations, ...seasonDurations])).sort(\n        (a, b) => a - b\n    );\n\n    // Filter to relevant range (e.g. up to workout max duration + a bit, or just standard set)\n    // We only care about durations that exist in the workout or correspond to standard points\n    // But displaying the full curve context is nice.\n\n    // Map data to the sorted durations\n    const workoutData = allDurations.map((d) => {\n        const point = workoutCurve.find((p) => p.duration === d);\n        return point ? point.watts : null;\n    });\n\n    const allTimeData = allDurations.map((d) => allTime[d]?.value || null);\n    const seasonData = allDurations.map((d) => season[d]?.value || null);\n\n    const formatDurationLabel = (seconds: number): string => {\n        if (seconds < 60) return `${seconds}s`;\n        if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;\n        return `${(seconds / 3600).toFixed(1)}h`;\n    };\n\n    const labels = allDurations.map(formatDurationLabel);\n\n    // Destroy existing chart content if any (though typically we create fresh canvas in modal/view)\n    // If reusing canvas, we'd need to destroy old chart instance.\n    // Ideally the calling code handles cleanup or we attach it to the canvas element.\n    const existingChart = Chart.getChart(canvas);\n    if (existingChart) {\n        existingChart.destroy();\n    }\n\n    const config: ChartConfiguration = {\n        type: 'line',\n        data: {\n            labels,\n            datasets: [\n                {\n                    label: 'This Workout',\n                    data: workoutData,\n                    borderColor: '#ef4444', // Red-500\n                    backgroundColor: 'rgba(239, 68, 68, 0.1)',\n                    borderWidth: 3,\n                    tension: 0.1,\n                    pointRadius: 4,\n                    fill: false,\n                    order: 1, // Top layer\n                },\n                {\n                    label: 'Season Best',\n                    data: seasonData,\n                    borderColor: '#3b82f6', // Blue-500\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    borderWidth: 2,\n                    borderDash: [5, 5],\n                    tension: 0.1,\n                    pointRadius: 3,\n                    fill: false,\n                    order: 2,\n                },\n                {\n                    label: 'All-Time Best',\n                    data: allTimeData,\n                    borderColor: '#f59e0b', // Amber-500\n                    backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                    borderWidth: 2,\n                    borderDash: [2, 2],\n                    tension: 0.1,\n                    pointRadius: 2,\n                    fill: false,\n                    order: 3,\n                },\n            ],\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                    labels: { color: getComputedStyle(document.body).getPropertyValue('--color-text-primary') },\n                },\n                tooltip: {\n                    callbacks: {\n                        label: (ctx: any) => {\n                            if (ctx.raw === null) return '';\n                            return `${ctx.dataset.label}: ${Math.round(ctx.parsed.y)}W`;\n                        },\n                    },\n                },\n                title: {\n                    display: true,\n                    text: 'Power Curve Comparison',\n                    color: getComputedStyle(document.body).getPropertyValue('--color-text-primary'),\n                },\n            },\n            scales: {\n                x: {\n                    grid: { color: 'rgba(128, 128, 128, 0.1)' },\n                    ticks: { color: getComputedStyle(document.body).getPropertyValue('--color-text-secondary') },\n                    title: { display: true, text: 'Duration' },\n                },\n                y: {\n                    beginAtZero: true,\n                    title: { display: true, text: 'Power (Watts)' },\n                    grid: { color: 'rgba(128, 128, 128, 0.1)' },\n                    ticks: { color: getComputedStyle(document.body).getPropertyValue('--color-text-secondary') },\n                },\n            },\n        },\n    };\n\n    return new Chart(canvas, config);\n}\n","import { openDB, type IDBPDatabase } from 'idb';\nimport type { Goal, GoalProgress } from '../types/goals.js';\nimport { getWorkoutHistory } from '../storage/workoutStorage.js';\nimport { calculateWorkoutSummary } from '../calculations/summary.js'; // Fallback\nimport { settingsStore } from './SettingsStore.js';\n\nconst DB_NAME = 'bpt-goals';\nconst STORE_NAME = 'goals';\n\nexport class GoalsStore {\n    private dbPromise: Promise<IDBPDatabase> | null = null;\n    private listeners: (() => void)[] = [];\n\n    constructor() {\n        if (typeof window !== 'undefined') {\n            this.init();\n        }\n    }\n\n    private async init() {\n        this.dbPromise = openDB(DB_NAME, 1, {\n            upgrade(db) {\n                if (!db.objectStoreNames.contains(STORE_NAME)) {\n                    db.createObjectStore(STORE_NAME, { keyPath: 'id' });\n                }\n            },\n        });\n    }\n\n    public async addGoal(goal: Omit<Goal, 'id' | 'createdAt'>): Promise<string> {\n        const db = await this.dbPromise;\n        if (!db) throw new Error('DB not initialized');\n\n        const newGoal: Goal = {\n            ...goal,\n            id: crypto.randomUUID(),\n            createdAt: Date.now(),\n        };\n\n        await db.put(STORE_NAME, newGoal);\n        this.notifyListeners();\n        return newGoal.id;\n    }\n\n    public async updateGoal(goal: Goal): Promise<void> {\n        const db = await this.dbPromise;\n        if (!db) return;\n        await db.put(STORE_NAME, goal);\n        this.notifyListeners();\n    }\n\n    public async deleteGoal(id: string): Promise<void> {\n        const db = await this.dbPromise;\n        if (!db) return;\n        await db.delete(STORE_NAME, id);\n        this.notifyListeners();\n    }\n\n    public async getGoals(): Promise<Goal[]> {\n        const db = await this.dbPromise;\n        if (!db) return [];\n        return db.getAll(STORE_NAME);\n    }\n\n    public async getProgress(goal: Goal): Promise<GoalProgress> {\n        const workouts = await getWorkoutHistory(); // This gets all.\n\n        // Define period boundaries\n        const now = new Date();\n        let start: Date;\n        let end: Date;\n        let periodLabel = '';\n\n        if (goal.period === 'weekly') {\n            // Start of week (Monday)\n            const day = now.getDay();\n            const diff = now.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday\n            start = new Date(now.setDate(diff));\n            start.setHours(0, 0, 0, 0);\n\n            end = new Date(start);\n            end.setDate(start.getDate() + 7);\n            periodLabel = 'This Week';\n        } else {\n            // Monthly\n            start = new Date(now.getFullYear(), now.getMonth(), 1);\n            end = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n            end.setHours(23, 59, 59, 999);\n            periodLabel = start.toLocaleString('default', { month: 'long', year: 'numeric' });\n        }\n\n        const filteredWorkouts = workouts.filter((w) => {\n            return w.startTime >= start.getTime() && w.startTime <= end.getTime();\n        });\n\n        let current = 0;\n\n        for (const w of filteredWorkouts) {\n            let val = 0;\n            const settings = settingsStore.getAll();\n            const summary =\n                w.summary ||\n                calculateWorkoutSummary(w.startTime, w.lastUpdated, w.measurements, undefined, settings.weight);\n\n            switch (goal.type) {\n                case 'distance':\n                    // distance in meters in DB? summary.totalDistance usually?\n                    // Let's check summary structure again.\n                    // StoredWorkout -> summary (WorkoutSummary) -> doesn't have totalDistance explicit in interface sometimes?\n                    // measurements.distance is array.\n                    // Let's assume summary has something or we calc.\n                    // Re-checking calculateWorkoutSummary return type:\n                    // It returns: duration, power, heartrate, cadence, etc.\n                    // It does NOT explicitly return totalDistance in the interface I read earlier!\n                    // Wait, `calculateWorkoutSummary` in `summary.ts` uses `measurements` input.\n                    // If `measurements.distance` exists, we can sum it or get last value?\n                    // `distance` is usually cumulative.\n\n                    if (summary.totalDistance) {\n                        val = summary.totalDistance;\n                    } else if (w.measurements?.distance && w.measurements.distance.length > 0) {\n                        // Last point value is total distance\n                        val = w.measurements.distance[w.measurements.distance.length - 1].value;\n                    }\n                    // Val is in meters. Target usually km.\n                    val = val / 1000;\n                    break;\n                case 'duration':\n                    // duration in ms. Target usually hours.\n                    val = (w.lastUpdated - w.startTime) / 1000 / 3600;\n                    break;\n                case 'tss':\n                    val = summary.trainingLoad || 0;\n                    break;\n                case 'count':\n                    val = 1;\n                    break;\n            }\n            current += val;\n        }\n\n        // Formatting\n        let formattedCurrent = '';\n        let formattedTarget = '';\n\n        if (goal.type === 'distance') {\n            formattedCurrent = `${current.toFixed(1)} km`;\n            formattedTarget = `${goal.target} km`;\n        } else if (goal.type === 'duration') {\n            formattedCurrent = `${current.toFixed(1)} hrs`;\n            formattedTarget = `${goal.target} hrs`;\n        } else if (goal.type === 'tss') {\n            formattedCurrent = Math.round(current).toString();\n            formattedTarget = goal.target.toString();\n        } else {\n            formattedCurrent = Math.round(current).toString();\n            formattedTarget = goal.target.toString();\n        }\n\n        return {\n            goalId: goal.id,\n            current,\n            target: goal.target,\n            percent: Math.min(100, (current / goal.target) * 100),\n            formattedCurrent,\n            formattedTarget,\n            periodLabel,\n            remaining: Math.max(0, goal.target - current),\n            isCompleted: current >= goal.target,\n            periodStart: start.getTime(),\n            periodEnd: end.getTime(),\n        };\n    }\n\n    public subscribe(listener: () => void): () => void {\n        this.listeners.push(listener);\n        return () => {\n            this.listeners = this.listeners.filter((l) => l !== listener);\n        };\n    }\n\n    private notifyListeners() {\n        this.listeners.forEach((l) => l());\n    }\n}\n\nexport const goalsStore = new GoalsStore();\n","import { goalsStore } from '../state/GoalsStore.js';\nimport { showModal } from './modal.js';\nimport { showNotification } from './notifications.js';\n\nlet initialized = false;\n\nexport function initGoalsView() {\n    if (initialized) return;\n\n    const addBtn = document.getElementById('addGoalBtn');\n    addBtn?.addEventListener('click', showAddGoalModal);\n\n    goalsStore.subscribe(() => {\n        refreshGoalsView();\n    });\n\n    initialized = true;\n}\n\nexport async function refreshGoalsView() {\n    const list = document.getElementById('goalsList');\n    if (!list) return;\n\n    const goals = await goalsStore.getGoals();\n\n    if (goals.length === 0) {\n        list.innerHTML = `\n            <div style=\"grid-column: 1/-1; text-align: center; padding: 40px; color: var(--color-text-secondary); background: var(--card-bg); border-radius: 8px;\">\n                <p style=\"margin-bottom: 12px; font-size: 1.2em;\">No goals set yet</p>\n                <p>Create a goal to track your progress!</p>\n            </div>\n        `;\n        return;\n    }\n\n    list.innerHTML = '<div style=\"grid-column: 1/-1; text-align: center; padding: 20px;\">Loading progress...</div>';\n\n    try {\n        // Calculate progress for all\n        const progressPromises = goals.map((g) => goalsStore.getProgress(g));\n        const results = await Promise.all(progressPromises);\n\n        list.innerHTML = results\n            .map((p, index) => {\n                const goal = goals[index];\n                const statusColor = p.isCompleted ? 'var(--color-success)' : 'var(--color-accent)';\n                const statusText = p.isCompleted ? 'Completed' : 'In Progress';\n\n                return `\n                <div class=\"goal-card\" style=\"\n                    background: var(--card-bg);\n                    padding: 16px;\n                    border-radius: 8px;\n                    border: 1px solid var(--color-border);\n                    position: relative;\n                \">\n                    <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;\">\n                        <div>\n                            <h4 style=\"margin: 0; font-size: 1.1em; color: var(--color-text-primary);\">${goal.title}</h4>\n                            <div style=\"font-size: 0.85em; color: var(--color-text-secondary); margin-top: 4px;\">\n                                ${p.periodLabel}\n                            </div>\n                        </div>\n                        <button class=\"goal-delete-btn\" data-id=\"${goal.id}\" aria-label=\"Delete Goal\" style=\"\n                            background: none; border: none; font-size: 1.2em; cursor: pointer; opacity: 0.5; color: var(--color-text-secondary);\n                        \">&times;</button>\n                    </div>\n\n                    <div style=\"display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px;\">\n                        <span style=\"font-size: 1.5em; font-weight: bold; color: var(--color-text-primary);\">${p.formattedCurrent}</span>\n                        <span style=\"color: var(--color-text-secondary); padding-bottom: 4px;\">of ${p.formattedTarget}</span>\n                    </div>\n\n                    <div style=\"\n                        height: 8px;\n                        background: rgba(128,128,128,0.2);\n                        border-radius: 4px;\n                        overflow: hidden;\n                    \">\n                        <div style=\"\n                            width: ${p.percent}%;\n                            height: 100%;\n                            background: ${statusColor};\n                            transition: width 0.5s ease;\n                        \"></div>\n                    </div>\n\n                    ${\n                        p.isCompleted\n                            ? `\n                        <div style=\"margin-top: 12px; font-size: 0.9em; color: var(--color-success); display: flex; align-items: center; gap: 6px;\">\n                            <span></span> Goal Completed!\n                        </div>\n                    `\n                            : `\n                        <div style=\"margin-top: 12px; font-size: 0.85em; color: var(--color-text-secondary); display: flex; justify-content: space-between;\">\n                            <span>${statusText}</span>\n                            <span>${p.remaining > 0 ? (goal.type === 'distance' ? `${p.remaining.toFixed(1)} km left` : '') : ''}</span>\n                        </div>\n                    `\n                    }\n                </div>\n            `;\n            })\n            .join('');\n\n        // Attach delete handlers\n        list.querySelectorAll('.goal-delete-btn').forEach((btn) => {\n            btn.addEventListener('click', (e) => {\n                e.stopPropagation();\n                const id = (e.currentTarget as HTMLElement).dataset.id;\n                if (id && confirm('Delete this goal?')) {\n                    goalsStore.deleteGoal(id);\n                }\n            });\n        });\n    } catch (e) {\n        console.error('Error rendering goals:', e);\n        list.innerHTML = `<div style=\"grid-column: 1/-1; color: red;\">Error loading goals</div>`;\n    }\n}\n\nfunction showAddGoalModal() {\n    const content = document.createElement('div');\n    content.innerHTML = `\n        <div class=\"form-group\" style=\"margin-bottom: 16px;\">\n            <label style=\"display: block; margin-bottom: 6px; font-weight: 500;\">Goal Title</label>\n            <input type=\"text\" id=\"goalTitle\" placeholder=\"e.g. Weekly Distance\" style=\"width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background: var(--input-bg); color: var(--color-text-primary);\">\n        </div>\n        \n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;\">\n            <div class=\"form-group\">\n                <label style=\"display: block; margin-bottom: 6px; font-weight: 500;\">Type</label>\n                <select id=\"goalType\" style=\"width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background: var(--input-bg); color: var(--color-text-primary);\">\n                    <option value=\"distance\">Distance (km)</option>\n                    <option value=\"duration\">Duration (hours)</option>\n                    <option value=\"tss\">TSS</option>\n                    <option value=\"count\">Ride Count</option>\n                </select>\n            </div>\n            <div class=\"form-group\">\n                <label style=\"display: block; margin-bottom: 6px; font-weight: 500;\">Period</label>\n                <select id=\"goalPeriod\" style=\"width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background: var(--input-bg); color: var(--color-text-primary);\">\n                    <option value=\"weekly\">Weekly</option>\n                    <option value=\"monthly\">Monthly</option>\n                </select>\n            </div>\n        </div>\n\n        <div class=\"form-group\" style=\"margin-bottom: 16px;\">\n            <label style=\"display: block; margin-bottom: 6px; font-weight: 500;\">Target Value</label>\n            <input type=\"number\" id=\"goalTarget\" placeholder=\"e.g. 100\" style=\"width: 100%; padding: 8px; border: 1px solid var(--color-border); border-radius: 4px; background: var(--input-bg); color: var(--color-text-primary);\">\n            <div id=\"goalTargetHint\" style=\"font-size: 0.85em; color: var(--color-text-secondary); margin-top: 4px;\">Target in km</div>\n        </div>\n    `;\n\n    // Hint update logic\n    const updateHint = () => {\n        const typeEl = content.querySelector('#goalType') as HTMLSelectElement;\n        const hint = content.querySelector('#goalTargetHint');\n        const type = typeEl?.value;\n        if (!hint || !type) return;\n\n        switch (type) {\n            case 'distance':\n                hint.textContent = 'Target in km';\n                break;\n            case 'duration':\n                hint.textContent = 'Target in hours';\n                break;\n            case 'tss':\n                hint.textContent = 'Training Stress Score points';\n                break;\n            case 'count':\n                hint.textContent = 'Number of rides';\n                break;\n        }\n    };\n    content.querySelector('#goalType')?.addEventListener('change', updateHint);\n\n    let closeModal: () => void;\n\n    const save = async () => {\n        const titleEl = content.querySelector('#goalTitle') as HTMLInputElement;\n        const typeEl = content.querySelector('#goalType') as HTMLSelectElement;\n        const periodEl = content.querySelector('#goalPeriod') as HTMLSelectElement;\n        const targetEl = content.querySelector('#goalTarget') as HTMLInputElement;\n\n        const title = titleEl.value;\n        const type = typeEl.value as any;\n        const period = periodEl.value as any;\n        const target = parseFloat(targetEl.value);\n\n        if (!title || !target) {\n            alert('Please fill in all fields');\n            return;\n        }\n\n        try {\n            await goalsStore.addGoal({\n                title,\n                type,\n                period,\n                target,\n            });\n\n            showNotification('Goal created!', 'success');\n            if (closeModal) closeModal();\n        } catch (e) {\n            console.error(e);\n            alert('Failed to save goal');\n        }\n    };\n\n    closeModal = showModal({\n        title: 'Add New Goal',\n        content,\n        buttons: [\n            {\n                text: 'Cancel',\n                variant: 'secondary',\n                onClick: () => {\n                    if (closeModal) closeModal();\n                },\n            },\n            { text: 'Save Goal', variant: 'primary', onClick: save },\n        ],\n    });\n}\n","/**\n * Logic for Personal Records view in History tab\n */\nimport { personalRecordsStore } from '../state/PersonalRecordsStore.js';\nimport type { PersonalRecord } from '../types/personal-records.js';\n// Using Chart from window/global instead of import to reuse existing library (it might be loaded globally or similar)\n// If not, we should use the same import method as charts.ts.\n// Let's check charts.ts to see how it imports Chart.js\nimport { Chart, type ChartConfiguration } from 'chart.js/auto';\n\nlet pcChart: Chart | null = null;\nlet initialized = false;\n\nexport function initPrView() {\n    if (initialized) return;\n\n    personalRecordsStore.subscribe(() => {\n        refreshPrView();\n    });\n\n    initialized = true;\n}\n\nexport function refreshPrView() {\n    renderPrCards();\n    renderPowerCurve();\n}\n\n/**\n * Render PR Cards (All-Time and Season)\n */\nfunction renderPrCards() {\n    const allTimeContainer = document.getElementById('prListAllTime');\n    const seasonContainer = document.getElementById('prListSeason');\n\n    if (!allTimeContainer || !seasonContainer) return;\n\n    const allTime = personalRecordsStore.getAllTimeCurve();\n    const season = personalRecordsStore.getSeasonCurve();\n\n    allTimeContainer.innerHTML = generatePrGridHtml(allTime);\n    seasonContainer.innerHTML = generatePrGridHtml(season);\n}\n\nfunction generatePrGridHtml(curve: Record<number, PersonalRecord>): string {\n    const durations = Object.keys(curve)\n        .map(Number)\n        .sort((a, b) => a - b);\n\n    if (durations.length === 0) {\n        return '<div style=\"grid-column: 1/-1; color: var(--color-text-secondary); text-align: center; padding: 20px;\">No records yet</div>';\n    }\n\n    return durations\n        .map((d) => {\n            const record = curve[d];\n            const label = formatDurationLabel(d);\n            const dateStr = new Date(record.date).toLocaleDateString();\n\n            return `\n            <div class=\"pr-card\" style=\"\n                background: var(--card-bg); \n                padding: 12px; \n                border-radius: 8px; \n                border: 1px solid var(--color-border);\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 4px;\n            \">\n                <span style=\"font-size: 0.9em; color: var(--color-text-secondary);\">${label}</span>\n                <span style=\"font-size: 1.4em; font-weight: bold; color: var(--color-accent);\">${Math.round(record.value)}W</span>\n                <span style=\"font-size: 0.75em; color: var(--color-text-muted);\">${dateStr}</span>\n            </div>\n        `;\n        })\n        .join('');\n}\n\nfunction formatDurationLabel(seconds: number): string {\n    if (seconds < 60) return `${seconds}s`;\n    return `${Math.floor(seconds / 60)}m`;\n}\n\n/**\n * Render Power Curve Chart\n */\nfunction renderPowerCurve() {\n    const canvas = document.getElementById('powerCurveHistoryChart') as HTMLCanvasElement;\n    if (!canvas) return;\n\n    const allTime = personalRecordsStore.getAllTimeCurve();\n    const season = personalRecordsStore.getSeasonCurve();\n\n    // Sort durations\n    const durations = Array.from(\n        new Set([...Object.keys(allTime).map(Number), ...Object.keys(season).map(Number)])\n    ).sort((a, b) => a - b);\n\n    if (durations.length === 0) return;\n\n    const labels = durations.map(formatDurationLabel);\n    const allTimeData = durations.map((d) => allTime[d]?.value || null);\n    const seasonData = durations.map((d) => season[d]?.value || null);\n\n    if (pcChart) {\n        pcChart.destroy();\n    }\n\n    const config: ChartConfiguration = {\n        type: 'line',\n        data: {\n            labels,\n            datasets: [\n                {\n                    label: 'All-Time Best',\n                    data: allTimeData,\n                    borderColor: '#f59e0b', // Amber-500\n                    backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                    borderWidth: 2,\n                    tension: 0.3,\n                    pointRadius: 4,\n                    fill: false,\n                },\n                {\n                    label: 'Season Best',\n                    data: seasonData,\n                    borderColor: '#3b82f6', // Blue-500\n                    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                    borderWidth: 2,\n                    tension: 0.3,\n                    pointRadius: 4,\n                    fill: true,\n                },\n            ],\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    position: 'top',\n                    labels: { color: getComputedStyle(document.body).getPropertyValue('--color-text-primary') },\n                },\n                tooltip: {\n                    callbacks: {\n                        label: (ctx: any) => `${ctx.dataset.label}: ${Math.round(ctx.parsed.y)}W`,\n                    },\n                },\n            },\n            scales: {\n                x: {\n                    grid: { color: 'rgba(128, 128, 128, 0.1)' },\n                    ticks: { color: getComputedStyle(document.body).getPropertyValue('--color-text-secondary') },\n                },\n                y: {\n                    beginAtZero: true,\n                    title: { display: true, text: 'Power (Watts)' },\n                    grid: { color: 'rgba(128, 128, 128, 0.1)' },\n                    ticks: { color: getComputedStyle(document.body).getPropertyValue('--color-text-secondary') },\n                },\n            },\n        },\n    };\n\n    pcChart = new Chart(canvas, config);\n}\n","/**\n * Workout History UI\n *\n * Displays saved workouts and allows viewing details.\n *\n * @module workoutHistory\n */\n\nimport {\n    getCompletedWorkouts,\n    getCompletedWorkout,\n    deleteCompletedWorkout,\n    isIndexedDBSupported,\n    type StoredWorkout,\n} from '../storage/workoutStorage.js';\nimport { formatDuration, formatDate } from '../utils/formatters.js';\nimport type { Workout } from '../types/workout.js';\nimport { ftpHistoryStore, type FtpHistoryEntry } from '../state/FtpHistoryStore.js';\nimport { calculateWorkoutSummary } from './modal.js';\nimport { settingsStore } from '../state/SettingsStore.js';\nimport { POWER_ZONE_COLORS } from '../styles/zone-colors.js';\nimport { renderLineChart } from './charts.js';\nimport { renderPeriodStatistics } from './statistics.js';\nimport { cropWorkout } from '../utils/cropWorkout.js';\nimport type { MeasurementsData } from '../types/measurements.js';\n\nimport { getScheduledEvents, type CalendarEvent } from '../storage/scheduledWorkoutStorage.js';\nimport { type LapSummary } from '../calculations/lap-calculator.js';\nimport { renderPowerCurveComparison } from './powerCurveChart.js';\nimport { initGoalsView, refreshGoalsView } from './goalsView.js';\n\n/** Current pagination page */\nlet currentPage = 1;\n/** Total number of pages */\nlet totalPages = 1;\n\n/* Filter State */\n// let filterType = '';\nlet filterStartDate = '';\nlet filterEndDate = '';\n\n/* View State */\nlet currentView: 'list' | 'calendar' | 'analytics' | 'pr' | 'goals' = 'list';\nimport { initPrView, refreshPrView } from './prView.js';\nlet calendarDate = new Date(); // Points to current month\n\n/**\n * Workout summary data from API\n */\ninterface WorkoutSummary {\n    avgPower?: number;\n    maxPower?: number;\n    normalizedPower?: number;\n    avgCadence?: number;\n    maxCadence?: number;\n    avgHeartrate?: number;\n    maxHeartrate?: number;\n    totalEnergy?: number;\n    totalDistance?: number;\n    sampleCount?: number;\n    powerCurve?: { duration: number; watts: number }[];\n    trainingLoad?: number;\n    intensityFactor?: number;\n    powerZoneDistribution?: {\n        zones: {\n            zone: number;\n            name: string;\n            min: number;\n            max: number;\n            timeInZoneMs: number;\n        }[];\n        totalTimeMs: number;\n    };\n    hrZoneDistribution?: {\n        zones: {\n            zone: number;\n            name: string;\n            min: number;\n            max: number;\n            timeInZoneMs: number;\n        }[];\n        totalTimeMs: number;\n    };\n    laps?: LapSummary[];\n}\n\n/**\n * Helper to safely parse summary\n */\nfunction getSummary(workout: Workout): WorkoutSummary {\n    if (!workout.summary) return {};\n    if (typeof workout.summary === 'string') {\n        try {\n            return JSON.parse(workout.summary);\n        } catch {\n            return {};\n        }\n    }\n    return workout.summary as unknown as WorkoutSummary;\n}\n\n/**\n * Initialize the workout history feature logic\n * NOTE: This should be called after the History View is mounted to DOM.\n */\nexport function initHistoryLogic(): void {\n    const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n    const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n    const refreshBtn = document.getElementById('historyRefresh');\n\n    // Filters & Views\n    const typeFilter = document.getElementById('workoutTypeFilter') as HTMLSelectElement | null;\n    const dateStart = document.getElementById('workoutDateStart') as HTMLInputElement | null;\n    const dateEnd = document.getElementById('workoutDateEnd') as HTMLInputElement | null;\n    const viewListBtn = document.getElementById('viewListBtn');\n    const viewCalendarBtn = document.getElementById('viewCalendarBtn');\n    const viewAnalyticsBtn = document.getElementById('viewAnalyticsBtn');\n    const viewGoalsBtn = document.getElementById('viewGoalsBtn');\n\n    const listView = document.getElementById('workoutListView');\n    const calendarView = document.getElementById('workoutCalendarView');\n    const analyticsView = document.getElementById('workoutAnalyticsView');\n    const goalsView = document.getElementById('workoutGoalsView');\n\n    // Calendar Controls\n    const prevMonthBtn = document.getElementById('calendarPrevMonth');\n    const nextMonthBtn = document.getElementById('calendarNextMonth');\n\n    // Check if database is available on load\n    initHistoryButton();\n\n    // Toggle Views\n    const setView = (view: 'list' | 'calendar' | 'analytics' | 'pr' | 'goals') => {\n        currentView = view;\n\n        // Buttons\n        if (viewListBtn) {\n            viewListBtn.classList.toggle('active', view === 'list');\n            viewListBtn.setAttribute('aria-pressed', (view === 'list').toString());\n            viewListBtn.style.background = view === 'list' ? 'var(--color-bg-active)' : 'transparent';\n        }\n        if (viewCalendarBtn) {\n            viewCalendarBtn.classList.toggle('active', view === 'calendar');\n            viewCalendarBtn.setAttribute('aria-pressed', (view === 'calendar').toString());\n            viewCalendarBtn.style.background = view === 'calendar' ? 'var(--color-bg-active)' : 'transparent';\n        }\n        if (viewAnalyticsBtn) {\n            viewAnalyticsBtn.classList.toggle('active', view === 'analytics');\n            viewAnalyticsBtn.setAttribute('aria-pressed', (view === 'analytics').toString());\n            viewAnalyticsBtn.style.background = view === 'analytics' ? 'var(--color-bg-active)' : 'transparent';\n        }\n        const viewPrBtn = document.getElementById('viewPrBtn');\n        if (viewPrBtn) {\n            viewPrBtn.classList.toggle('active', view === 'pr');\n            viewPrBtn.setAttribute('aria-pressed', (view === 'pr').toString());\n            viewPrBtn.style.background = view === 'pr' ? 'var(--color-bg-active)' : 'transparent';\n        }\n        if (viewGoalsBtn) {\n            viewGoalsBtn.classList.toggle('active', view === 'goals');\n            viewGoalsBtn.setAttribute('aria-pressed', (view === 'goals').toString());\n            viewGoalsBtn.style.background = view === 'goals' ? 'var(--color-bg-active)' : 'transparent';\n        }\n\n        // Panels\n        if (listView) listView.style.display = view === 'list' ? 'block' : 'none';\n        if (calendarView) calendarView.style.display = view === 'calendar' ? 'block' : 'none';\n        if (analyticsView) analyticsView.style.display = view === 'analytics' ? 'block' : 'none';\n        if (goalsView) goalsView.style.display = view === 'goals' ? 'block' : 'none';\n\n        const prView = document.getElementById('workoutPrView');\n        if (prView) prView.style.display = view === 'pr' ? 'block' : 'none';\n\n        // Filters visibility (hide generic filters for analytics maybe? Keeping for now)\n    };\n\n    viewListBtn?.addEventListener('click', () => {\n        setView('list');\n        loadWorkouts();\n    });\n\n    viewCalendarBtn?.addEventListener('click', () => {\n        setView('calendar');\n        loadCalendar();\n    });\n    viewGoalsBtn?.addEventListener('click', () => {\n        setView('goals');\n        initGoalsView();\n        refreshGoalsView();\n    });\n\n    viewAnalyticsBtn?.addEventListener('click', () => {\n        setView('analytics');\n        loadAnalytics();\n    });\n\n    const viewPrBtn = document.getElementById('viewPrBtn');\n    viewPrBtn?.addEventListener('click', () => {\n        setView('pr');\n        initPrView();\n        refreshPrView();\n    });\n\n    // Filter Change Listeners\n    const handleFilterChange = () => {\n        // if (typeFilter) filterType = typeFilter.value;\n        if (dateStart) filterStartDate = dateStart.value;\n        if (dateEnd) filterEndDate = dateEnd.value;\n\n        currentPage = 1;\n\n        if (currentView === 'list') {\n            loadWorkouts();\n        } else if (currentView === 'calendar') {\n            loadCalendar();\n        } else if (currentView === 'analytics') {\n            loadAnalytics();\n        }\n    };\n\n    typeFilter?.addEventListener('change', handleFilterChange);\n    dateStart?.addEventListener('change', handleFilterChange);\n    dateEnd?.addEventListener('change', handleFilterChange);\n\n    // Calendar Navigation\n    prevMonthBtn?.addEventListener('click', () => {\n        calendarDate.setMonth(calendarDate.getMonth() - 1);\n        loadCalendar();\n    });\n\n    nextMonthBtn?.addEventListener('click', () => {\n        calendarDate.setMonth(calendarDate.getMonth() + 1);\n        loadCalendar();\n    });\n\n    // Pagination\n    prevBtn?.addEventListener('click', async () => {\n        if (currentPage > 1) {\n            currentPage--;\n            await loadWorkouts();\n        }\n    });\n\n    nextBtn?.addEventListener('click', async () => {\n        if (currentPage < totalPages) {\n            currentPage++;\n            await loadWorkouts();\n        }\n    });\n\n    // Refresh\n    refreshBtn?.addEventListener('click', async () => {\n        await loadWorkouts();\n    });\n}\n\n/**\n * Enable history button if IndexedDB is supported\n */\nfunction initHistoryButton(): void {\n    const historyButton = document.getElementById('workoutHistoryButton') as HTMLButtonElement | null;\n    const hasIndexedDB = isIndexedDBSupported();\n\n    if (historyButton) {\n        historyButton.disabled = !hasIndexedDB;\n        historyButton.title = hasIndexedDB ? 'View workout history' : 'History not available (IndexedDB not supported)';\n    }\n}\n\n/**\n * Convert locally stored workout to Workout interface\n */\nexport function storedToWorkout(stored: StoredWorkout): Workout & { _synced?: boolean } {\n    const settings = settingsStore.getAll();\n    const summary = calculateWorkoutSummary(\n        stored.startTime,\n        stored.lastUpdated,\n        stored.measurements,\n        undefined,\n        settings.weight\n    );\n\n    return {\n        id: stored.id,\n        title: 'Local Workout',\n        sport: 'cycling',\n        startTime: new Date(stored.startTime).toISOString(),\n        endTime: new Date(stored.lastUpdated).toISOString(),\n        duration: Math.round((stored.lastUpdated - stored.startTime) / 1000),\n        status: 'COMPLETED', // API status enum\n        summary: JSON.stringify(summary),\n        telemetry: JSON.stringify(stored.measurements),\n        createdAt: new Date(stored.startTime).toISOString(),\n        updatedAt: new Date(stored.lastUpdated).toISOString(),\n        _synced: stored.synced,\n    };\n}\n\n/**\n * Load and display workouts\n */\nasync function loadWorkouts(): Promise<void> {\n    const listContainer = document.getElementById('workoutList');\n    const pageInfo = document.getElementById('historyPageInfo');\n    const prevBtn = document.getElementById('historyPrevPage') as HTMLButtonElement | null;\n    const nextBtn = document.getElementById('historyNextPage') as HTMLButtonElement | null;\n\n    if (!listContainer) return;\n\n    // Show loading state\n    listContainer.innerHTML = '<div class=\"workout-loading\">Loading workouts...</div>';\n\n    try {\n        let workouts: (Workout & { _synced?: boolean })[] = [];\n\n        const stored = await getCompletedWorkouts();\n        // TODO: Apply filters locally if needed\n        stored.sort((a, b) => b.startTime - a.startTime);\n\n        const total = stored.length;\n        totalPages = Math.ceil(total / 10) || 1;\n        const start = (currentPage - 1) * 10;\n        const pageItems = stored.slice(start, start + 10);\n\n        workouts = pageItems.map(storedToWorkout);\n\n        if (pageInfo) {\n            pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${total} workouts)`;\n        }\n\n        // Update pagination buttons\n        if (prevBtn) prevBtn.disabled = currentPage <= 1;\n        if (nextBtn) nextBtn.disabled = currentPage >= totalPages;\n\n        // Render workouts\n        if (workouts.length === 0) {\n            listContainer.innerHTML = `\n        <div class=\"workout-empty\">\n          <p>No workouts found</p>\n          <p class=\"workout-empty-hint\">Start a workout to see it here!</p>\n        </div>\n      `;\n            return;\n        }\n\n        listContainer.innerHTML = workouts.map((workout) => renderWorkoutCard(workout)).join('');\n\n        // Add event listeners for workout cards\n        listContainer.querySelectorAll('.workout-card').forEach((card) => {\n            const workoutId = (card as HTMLElement).dataset.workoutId;\n            if (!workoutId) return;\n\n            // View details\n            card.querySelector('.workout-view-btn')?.addEventListener('click', (e: Event) => {\n                e.stopPropagation();\n                viewWorkoutDetails(workoutId);\n            });\n\n            // Delete\n            card.querySelector('.workout-delete-btn')?.addEventListener('click', (e: Event) => {\n                e.stopPropagation();\n                confirmDeleteWorkout(workoutId);\n            });\n        });\n    } catch (error) {\n        console.error('Failed to load workouts:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        listContainer.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workouts</p>\n        <p class=\"workout-error-detail\">${message}</p>\n      </div>\n    `;\n    }\n}\n\n/**\n * Render a workout card\n */\nfunction renderWorkoutCard(workout: Workout & { _synced?: boolean }): string {\n    const statusClass = workout.status.toLowerCase();\n    const summary = getSummary(workout);\n\n    // Synced status hidden as we are moving to offline-only\n\n    return `\n    <div class=\"workout-card\" data-workout-id=\"${workout.id}\">\n      <div class=\"workout-card-header\">\n        <span class=\"workout-title\">${workout.title || 'Untitled Workout'}</span>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n      <div class=\"workout-card-body\">\n        <div class=\"workout-date\">\n           ${formatDate(workout.startTime)}\n        </div>\n        <div class=\"workout-stats\">\n          ${workout.duration ? `<span class=\"workout-stat\"> ${formatDuration(workout.duration)}</span>` : ''}\n          ${summary.avgPower ? `<span class=\"workout-stat\"> ${summary.avgPower}W avg</span>` : ''}\n          ${summary.maxPower ? `<span class=\"workout-stat\"> ${summary.maxPower}W max</span>` : ''}\n          ${summary.avgHeartrate ? `<span class=\"workout-stat\"> ${summary.avgHeartrate} bpm</span>` : ''}\n          ${summary.totalEnergy ? `<span class=\"workout-stat\"> ${summary.totalEnergy} kJ</span>` : ''}\n        </div>\n      </div>\n      <div class=\"workout-card-actions\">\n        <button class=\"workout-view-btn\" title=\"View details\"> View</button>\n        <button class=\"workout-delete-btn\" title=\"Delete workout\"></button>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * View workout details in a detail panel\n */\nasync function viewWorkoutDetails(workoutId: string): Promise<void> {\n    const detailPanel = document.getElementById('workoutDetailPanel');\n    const listPanel = document.getElementById('workoutListPanel');\n\n    if (!detailPanel || !listPanel) return;\n\n    // Show detail panel\n    listPanel.style.display = 'none';\n    detailPanel.style.display = 'block';\n    detailPanel.innerHTML = '<div class=\"workout-loading\">Loading workout details...</div>';\n\n    try {\n        const stored = await getCompletedWorkout(workoutId);\n        if (!stored) throw new Error('Workout not found');\n        const workout = storedToWorkout(stored);\n\n        detailPanel.innerHTML = renderWorkoutDetail(workout);\n\n        // Render Zone Charts\n        const summary = getSummary(workout);\n        if (summary.powerZoneDistribution) {\n            renderZoneChart('wd-chart-power-zones', summary.powerZoneDistribution, 'Power Zones');\n        }\n        if (summary.hrZoneDistribution) {\n            renderZoneChart('wd-chart-hr-zones', summary.hrZoneDistribution, 'Heart Rate Zones');\n        }\n\n        // Render Power Curve\n        if (summary.powerCurve && summary.powerCurve.length > 0) {\n            requestAnimationFrame(() => {\n                renderPowerCurveComparison('wd-chart-power-curve', summary.powerCurve!);\n            });\n        }\n\n        // Render Charts if telemetry exists\n        if (workout.telemetry) {\n            // Allow DOM to update first\n            requestAnimationFrame(() => {\n                renderWorkoutCharts(workout.telemetry!, workout.startTime);\n            });\n        }\n\n        // Back button\n        detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n            detailPanel.style.display = 'none';\n            listPanel.style.display = 'block';\n        });\n\n        // Export button\n        detailPanel.querySelector('.workout-export-btn')?.addEventListener('click', () => {\n            exportWorkoutData(workout);\n        });\n\n        // Crop button\n        detailPanel.querySelector('.workout-crop-btn')?.addEventListener('click', () => {\n            startCropTool(workout);\n        });\n    } catch (error) {\n        console.error('Failed to load workout details:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        detailPanel.innerHTML = `\n      <div class=\"workout-error\">\n        <p>Failed to load workout</p>\n        <p class=\"workout-error-detail\">${message}</p>\n        <button class=\"workout-back-btn\"> Back to list</button>\n      </div>\n    `;\n        detailPanel.querySelector('.workout-back-btn')?.addEventListener('click', () => {\n            detailPanel.style.display = 'none';\n            listPanel.style.display = 'block';\n        });\n    }\n}\n\n/**\n * Render workout detail view\n */\nfunction renderLapsTable(laps: LapSummary[]): string {\n    if (!laps || laps.length === 0) return '';\n\n    const rows = laps\n        .map((lap) => {\n            const timeStr = formatSecondsShort(Math.round(lap.duration / 1000));\n            const distStr = lap.distance > 0 ? `${(lap.distance / 1000).toFixed(2)}` : '-';\n            return `\n      <tr>\n        <td>${lap.number}</td>\n        <td class=\"text-right\">${timeStr}</td>\n        <td class=\"text-right\">${distStr}</td>\n        <td class=\"text-right\">${lap.avgPower}</td>\n        <td class=\"text-right\">${lap.avgHeartRate}</td>\n        <td class=\"text-right\">${lap.avgCadence}</td>\n      </tr>\n    `;\n        })\n        .join('');\n\n    return `\n    <div class=\"workout-detail-laps\" style=\"margin-top: 24px;\">\n      <h4>Laps</h4>\n      <div style=\"overflow-x: auto;\">\n        <table style=\"width: 100%; border-collapse: collapse; font-size: 0.9em;\">\n          <thead>\n            <tr style=\"border-bottom: 2px solid var(--color-border); text-align: left;\">\n              <th style=\"padding: 8px;\">#</th>\n              <th style=\"padding: 8px; text-align: right;\">Time</th>\n              <th style=\"padding: 8px; text-align: right;\">Dist (km)</th>\n              <th style=\"padding: 8px; text-align: right;\">Pwr (W)</th>\n              <th style=\"padding: 8px; text-align: right;\">HR (bpm)</th>\n              <th style=\"padding: 8px; text-align: right;\">Cad (rpm)</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${rows}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Format seconds to MM:SS format\n */\nfunction formatSecondsShort(seconds: number): string {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${String(secs).padStart(2, '0')}`;\n}\n\n/**\n * Render details of a single workout\n */\nfunction renderWorkoutDetail(workout: Workout): string {\n    const summary = getSummary(workout);\n    const statusClass = workout.status.toLowerCase();\n\n    return `\n    <div class=\"workout-detail\">\n      <div class=\"workout-detail-header\">\n        <button class=\"workout-back-btn\"> Back</button>\n        <h3>${workout.title || 'Untitled Workout'}</h3>\n        <span class=\"workout-status workout-status-${statusClass}\">${workout.status}</span>\n      </div>\n\n      <div class=\"workout-detail-meta\">\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Sport</span>\n          <span class=\"meta-value\">${workout.sport || 'cycling'}</span>\n        </div>\n        <div class=\"meta-item\">\n          <span class=\"meta-label\">Start Time</span>\n          <span class=\"meta-value\">${formatDate(workout.startTime)}</span>\n        </div>\n        ${\n            workout.endTime\n                ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">End Time</span>\n            <span class=\"meta-value\">${formatDate(workout.endTime)}</span>\n          </div>\n        `\n                : ''\n        }\n        ${\n            workout.duration\n                ? `\n          <div class=\"meta-item\">\n            <span class=\"meta-label\">Duration</span>\n            <span class=\"meta-value\">${formatDuration(workout.duration)}</span>\n          </div>\n        `\n                : ''\n        }\n      </div>\n\n      ${\n          Object.keys(summary).length > 0\n              ? `\n        <div class=\"workout-detail-summary\">\n          <h4>Summary</h4>\n          <div class=\"summary-grid\">\n            ${\n                summary.avgPower\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Power</span>\n                <span class=\"summary-value\">${summary.avgPower} W</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.maxPower\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Max Power</span>\n                <span class=\"summary-value\">${summary.maxPower} W</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.normalizedPower\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Normalized Power</span>\n                <span class=\"summary-value\">${summary.normalizedPower} W</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.intensityFactor\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Intensity Factor</span>\n                <span class=\"summary-value\">${summary.intensityFactor}</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.trainingLoad\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">TSS</span>\n                <span class=\"summary-value\">${summary.trainingLoad}</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.avgCadence\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Cadence</span>\n                <span class=\"summary-value\">${summary.avgCadence} rpm</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.avgHeartrate\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Avg Heart Rate</span>\n                <span class=\"summary-value\">${summary.avgHeartrate} bpm</span>\n              </div>\n            `\n                    : ''\n            }\n            ${\n                summary.totalEnergy\n                    ? `\n              <div class=\"summary-item\">\n                <span class=\"summary-label\">Total Energy</span>\n                <span class=\"summary-value\">${summary.totalEnergy} kJ</span>\n              </div>\n            `\n                    : ''\n            }\n          </div>\n        </div>\n      `\n              : ''\n      }\n      \n      ${summary.laps && summary.laps.length > 0 ? renderLapsTable(summary.laps) : ''}\n\n      ${\n          summary.powerCurve && summary.powerCurve.length > 0\n              ? `\n        <div class=\"workout-detail-power-curve\" style=\"margin-top: 24px;\">\n            <h4>Power Curve</h4>\n            <div style=\"position: relative; height: 300px; width: 100%;\">\n            <canvas id=\"wd-chart-power-curve\"></canvas>\n            </div>\n        </div>\n      `\n              : ''\n      }\n\n      ${\n          workout.telemetry\n              ? `\n        <div class=\"workout-detail-charts\">\n            <h4>Charts</h4>\n            <div id=\"wd-chart-power\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-hr\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-cadence\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-altitude\" class=\"chart-container\" style=\"height: 200px; margin-bottom: 20px;\"></div>\n            \n            <h4>Zone Distribution</h4>\n            <div id=\"wd-chart-power-zones\" class=\"chart-container\" style=\"margin-bottom: 20px;\"></div>\n            <div id=\"wd-chart-hr-zones\" class=\"chart-container\" style=\"margin-bottom: 20px;\"></div>\n        </div>\n      `\n              : ''\n      }\n\n      ${\n          workout.description\n              ? `\n        <div class=\"workout-detail-description\">\n          <h4>Notes</h4>\n          <p>${workout.description}</p>\n        </div>\n      `\n              : ''\n      }\n\n      <div class=\"workout-detail-actions\">\n        ${\n            workout.telemetry\n                ? `\n          <button class=\"workout-action-btn workout-crop-btn\"> Crop</button>\n          <button class=\"workout-export-btn\"> Export Data</button>\n        `\n                : ''\n        }\n      </div>\n    </div>\n  `;\n}\n\n/**\n * Export workout data to files\n */\nfunction exportWorkoutData(workout: Workout): void {\n    const timestamp = new Date(workout.startTime).toISOString().replace(/[:.]/g, '-').slice(0, 19);\n    const filename = `workout-${timestamp}`;\n\n    const jsonData = {\n        id: workout.id,\n        title: workout.title,\n        sport: workout.sport,\n        startTime: workout.startTime,\n        endTime: workout.endTime,\n        duration: workout.duration,\n        summary: workout.summary,\n        telemetry: workout.telemetry,\n    };\n\n    const jsonBlob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });\n    const jsonUrl = URL.createObjectURL(jsonBlob);\n    const jsonLink = document.createElement('a');\n    jsonLink.href = jsonUrl;\n    jsonLink.download = `${filename}.json`;\n    jsonLink.click();\n    URL.revokeObjectURL(jsonUrl);\n}\n\n/**\n * Confirm and delete a workout\n */\nasync function confirmDeleteWorkout(workoutId: string): Promise<void> {\n    if (!confirm('Are you sure you want to delete this workout? This cannot be undone.')) {\n        return;\n    }\n\n    try {\n        await deleteCompletedWorkout(workoutId);\n        await loadWorkouts();\n    } catch (error) {\n        console.error('Failed to delete workout:', error);\n        const message = error instanceof Error ? error.message : 'Unknown error';\n        alert(`Failed to delete workout: ${message}`);\n    }\n}\n\n/**\n * Load and display calendar view\n */\nasync function loadCalendar(): Promise<void> {\n    const calendarGrid = document.getElementById('workoutCalendarGrid');\n    const monthLabel = document.getElementById('calendarMonthLabel');\n\n    if (!calendarGrid || !monthLabel) return;\n\n    // Set month label\n    const monthNames = [\n        'January',\n        'February',\n        'March',\n        'April',\n        'May',\n        'June',\n        'July',\n        'August',\n        'September',\n        'October',\n        'November',\n        'December',\n    ];\n    monthLabel.textContent = `${monthNames[calendarDate.getMonth()]} ${calendarDate.getFullYear()}`;\n\n    // Show loading\n    calendarGrid.innerHTML =\n        '<div style=\"grid-column: 1 / -1; text-align: center; padding: 20px;\">Loading calendar...</div>';\n\n    // Calculate start and end of month\n    const year = calendarDate.getFullYear();\n    const month = calendarDate.getMonth();\n    const startDate = new Date(year, month, 1);\n    const endDate = new Date(year, month + 1, 0, 23, 59, 59, 999);\n\n    try {\n        const allStored = await getCompletedWorkouts();\n\n        // Filter by date\n        const startTimeMs = startDate.getTime();\n        const endTimeMs = endDate.getTime();\n\n        const stored = allStored.filter((w) => w.startTime >= startTimeMs && w.startTime <= endTimeMs);\n\n        const workouts = stored.map(storedToWorkout);\n\n        // Fetch planned workouts\n        const scheduled = getScheduledEvents(startDate, endDate);\n\n        renderCalendar(workouts, scheduled);\n        renderMonthlyStats(workouts);\n    } catch (error) {\n        console.error('Failed to load calendar:', error);\n        calendarGrid.innerHTML =\n            '<div style=\"grid-column: 1 / -1; text-align: center; color: var(--color-error);\">Failed to load calendar data</div>';\n    }\n}\n\n/**\n * Render the calendar grid\n */\nfunction renderCalendar(workouts: Workout[], scheduled: CalendarEvent[] = []): void {\n    const calendarGrid = document.getElementById('workoutCalendarGrid');\n    if (!calendarGrid) return;\n\n    calendarGrid.innerHTML = '';\n\n    // Add day headers\n    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n    days.forEach((day) => {\n        const d = document.createElement('div');\n        d.textContent = day;\n        d.style.textAlign = 'center';\n        d.style.fontWeight = 'bold';\n        d.style.padding = '4px';\n        d.style.fontSize = '0.9em';\n        d.style.color = 'var(--color-text-secondary)';\n        calendarGrid.appendChild(d);\n    });\n\n    const year = calendarDate.getFullYear();\n    const month = calendarDate.getMonth();\n\n    // First day of the month\n    const firstDay = new Date(year, month, 1).getDay();\n    // Days in month\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\n\n    // Empty cells for days before first of month\n    for (let i = 0; i < firstDay; i++) {\n        const empty = document.createElement('div');\n        calendarGrid.appendChild(empty);\n    }\n\n    // Days\n    for (let day = 1; day <= daysInMonth; day++) {\n        const dayCell = document.createElement('div');\n        dayCell.style.border = '1px solid var(--color-border)';\n        dayCell.style.borderRadius = '4px';\n        dayCell.style.minHeight = '60px';\n        dayCell.style.padding = '4px';\n        dayCell.style.background = 'var(--card-bg)';\n        dayCell.style.position = 'relative';\n\n        const dayNum = document.createElement('div');\n        dayNum.textContent = day.toString();\n        dayNum.style.fontSize = '0.8em';\n        dayNum.style.marginBottom = '4px';\n        dayCell.appendChild(dayNum);\n\n        // Find workouts for this day\n        const dayWorkouts = workouts.filter((w) => {\n            const wDate = new Date(w.startTime);\n            return wDate.getDate() === day && wDate.getMonth() === month && wDate.getFullYear() === year;\n        });\n\n        // Find scheduled events for this day\n        const dayScheduled = scheduled.filter((s) => {\n            return s.date.getDate() === day && s.date.getMonth() === month && s.date.getFullYear() === year;\n        });\n\n        // Combined unique items... wait.\n        // We want to show \"Matched\" items or separate.\n        // Strategy:\n        // 1. Render all completed workouts.\n        // 2. Render all scheduled workouts, BUT:\n        //    If a scheduled workout is 'completed' (by status), render it as such or let the completed workout represent it?\n        //    Ideally we link them. But link logic is hard without specific ID refs.\n        //    Existing \"completed\" workouts are actual data.\n        //    \"Scheduled\" are intention.\n\n        // Simplification: Render both. If scheduled is \"completed\" status (from plan repo), give it a checkmark.\n        // If not completed and date < now, mark as missed?\n\n        const now = new Date();\n        const isPast = new Date(year, month, day, 23, 59, 59) < now;\n\n        // Render scheduled items first? Or last?\n        dayScheduled.forEach((s) => {\n            const dot = document.createElement('div');\n            const isCompleted = s.status === 'completed'; // From plan repo\n            const isSkipped = !isCompleted && isPast && s.status !== 'skipped'; // implicit skip\n\n            // If we have a completed workout today, maybe we assume it matches?\n            // Only if the plan status is NOT completed, but we see a workout?\n            // That's complex. Let's stick to explicit status.\n\n            const durStr = s.duration ? `(${formatDuration(s.duration * 1000)})` : '';\n            dot.title = `Plan: ${s.title} ${durStr}`;\n            dot.style.fontSize = '0.7em';\n            dot.style.whiteSpace = 'nowrap';\n            dot.style.overflow = 'hidden';\n            dot.style.textOverflow = 'ellipsis';\n            dot.style.cursor = 'pointer';\n            dot.style.padding = '2px';\n            dot.style.marginTop = '2px';\n            dot.style.borderRadius = '2px';\n            dot.style.border = '1px dashed var(--color-disabled)';\n            dot.style.color = 'var(--color-text-secondary)';\n            dot.textContent = ` ${s.title} ${durStr}`;\n\n            if (isCompleted) {\n                dot.textContent = ` ${s.title} ${durStr}`;\n                dot.style.border = '1px solid var(--color-success)';\n                dot.style.background = 'rgba(0, 255, 0, 0.1)';\n                dot.style.color = 'var(--color-success)';\n            } else if (isSkipped) {\n                dot.style.textDecoration = 'line-through';\n                dot.style.opacity = '0.6';\n            }\n\n            dayCell.appendChild(dot);\n        });\n\n        dayWorkouts.forEach((w) => {\n            const dot = document.createElement('div');\n            dot.title = `${w.title || 'Workout'} (${formatDuration(w.duration || 0)})`;\n            dot.style.fontSize = '0.7em';\n            dot.style.whiteSpace = 'nowrap';\n            dot.style.overflow = 'hidden';\n            dot.style.textOverflow = 'ellipsis';\n            dot.style.cursor = 'pointer';\n            dot.style.padding = '2px';\n            dot.style.marginTop = '2px';\n            dot.style.borderRadius = '2px';\n            dot.style.background = 'var(--color-bg-active)';\n            dot.style.color = 'var(--color-text-primary)';\n\n            // Icon based on sport\n            const icon = w.sport === 'running' ? '' : '';\n            dot.textContent = `${icon} ${formatDuration(w.duration || 0)}`;\n\n            dot.addEventListener('click', (e) => {\n                e.stopPropagation();\n                viewWorkoutDetails(w.id);\n            });\n\n            dayCell.appendChild(dot);\n        });\n\n        // Highlight today\n        const today = new Date();\n        if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {\n            dayCell.style.borderColor = 'var(--color-accent)';\n            dayNum.style.fontWeight = 'bold';\n            dayNum.style.color = 'var(--color-accent)';\n        }\n\n        calendarGrid.appendChild(dayCell);\n    }\n}\n\n/**\n * Render monthly statistics\n */\nfunction renderMonthlyStats(workouts: Workout[]): void {\n    const statsContainer = document.getElementById('monthlyStats');\n    if (!statsContainer) return;\n\n    const totalWorkouts = workouts.length;\n    const totalDuration = workouts.reduce((acc, w) => acc + (w.duration || 0), 0);\n    const totalDistance = workouts.reduce((acc, w) => {\n        const summary = getSummary(w);\n        return acc + (summary.totalDistance || 0);\n    }, 0);\n    const totalEnergy = workouts.reduce((acc, w) => {\n        const summary = getSummary(w);\n        return acc + (summary.totalEnergy || 0);\n    }, 0);\n\n    statsContainer.innerHTML = `\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Workouts</div>\n            <div style=\"font-weight: bold;\">${totalWorkouts}</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Duration</div>\n            <div style=\"font-weight: bold;\">${formatDuration(totalDuration)}</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Distance</div>\n            <div style=\"font-weight: bold;\">${(totalDistance / 1000).toFixed(1)} km</div>\n        </div>\n        <div class=\"stat-item\" style=\"background: var(--card-bg); padding: 8px; border-radius: 4px; text-align: center;\">\n            <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">Energy</div>\n            <div style=\"font-weight: bold;\">${totalEnergy.toFixed(0)} kJ</div>\n        </div>\n    `;\n}\n\n/**\n * Load and display analytics\n */\nasync function loadAnalytics(): Promise<void> {\n    const analyticsView = document.getElementById('workoutAnalyticsView');\n    if (!analyticsView) return;\n\n    // Show loading\n    const prList = document.getElementById('prList');\n    if (prList) prList.innerHTML = '<div style=\"padding: 12px; text-align: center;\">Loading records...</div>';\n\n    try {\n        const allStored = await getCompletedWorkouts();\n        let workouts = allStored.map(storedToWorkout);\n\n        // Apply filters\n        if (filterStartDate) {\n            const start = new Date(filterStartDate).getTime();\n            workouts = workouts.filter((w) => new Date(w.startTime).getTime() >= start);\n        }\n        if (filterEndDate) {\n            const end = new Date(filterEndDate).getTime();\n            workouts = workouts.filter((w) => new Date(w.startTime).getTime() <= end);\n        }\n\n        // Fetch FTP History\n        let ftpHistory: FtpHistoryEntry[] = [];\n        try {\n            ftpHistory = await ftpHistoryStore.getHistory();\n        } catch (e) {\n            console.warn('Failed to load FTP history', e);\n        }\n\n        renderAnalytics(workouts, ftpHistory);\n    } catch (error) {\n        console.error('Failed to load analytics:', error);\n        if (prList)\n            prList.innerHTML = '<div style=\"color: var(--color-error); text-align: center;\">Failed to load data</div>';\n    }\n}\n\n/**\n * Render all analytics charts and stats\n */\nfunction renderAnalytics(workouts: Workout[], ftpHistory: FtpHistoryEntry[] = []): void {\n    renderPeriodStatistics('workoutAnalyticsView', workouts);\n    renderPersonalRecords(workouts);\n    renderTrainingLoad(workouts);\n    renderPowerCurve(workouts);\n    renderFitnessTrend(workouts);\n    renderFtpHistory(ftpHistory);\n    renderPrHistory(workouts);\n}\n\n/**\n * Render Personal Records\n */\nfunction renderPersonalRecords(workouts: Workout[]): void {\n    const container = document.getElementById('prList');\n    if (!container) return;\n\n    let maxPower = { val: 0, date: '', id: '' };\n    let maxHr = { val: 0, date: '', id: '' };\n    let longestRide = { val: 0, date: '', id: '' }; // Duration\n    let maxDistance = { val: 0, date: '', id: '' };\n\n    workouts.forEach((w) => {\n        const summary = getSummary(w);\n        const dateStr = formatDate(w.startTime);\n\n        if (summary.maxPower && summary.maxPower > maxPower.val) {\n            maxPower = { val: summary.maxPower, date: dateStr, id: w.id };\n        }\n        if (summary.maxHeartrate && summary.maxHeartrate > maxHr.val) {\n            maxHr = { val: summary.maxHeartrate, date: dateStr, id: w.id };\n        }\n        if (w.duration && w.duration > longestRide.val) {\n            longestRide = { val: w.duration, date: dateStr, id: w.id };\n        }\n        if (summary.totalDistance && summary.totalDistance > maxDistance.val) {\n            maxDistance = { val: summary.totalDistance, date: dateStr, id: w.id };\n        }\n    });\n\n    const createRow = (label: string, value: string, date: string, id: string) => `\n        <div class=\"pr-row\" data-id=\"${id}\" style=\"display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--color-border); cursor: pointer;\">\n            <div style=\"font-weight: 500;\">${label}</div>\n            <div style=\"text-align: right;\">\n                <div style=\"font-weight: bold; color: var(--color-accent);\">${value}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">${date}</div>\n            </div>\n        </div>\n    `;\n\n    container.innerHTML = `\n        ${maxPower.val > 0 ? createRow('Max Power (1s)', `${maxPower.val} W`, maxPower.date, maxPower.id) : ''}\n        ${maxHr.val > 0 ? createRow('Max Heart Rate', `${maxHr.val} bpm`, maxHr.date, maxHr.id) : ''}\n        ${longestRide.val > 0 ? createRow('Longest Duration', formatDuration(longestRide.val), longestRide.date, longestRide.id) : ''}\n        ${maxDistance.val > 0 ? createRow('Longest Distance', `${(maxDistance.val / 1000).toFixed(1)} km`, maxDistance.date, maxDistance.id) : ''}\n    `;\n\n    // Re-attach click listeners\n    container.querySelectorAll('.pr-row').forEach((row) => {\n        row.addEventListener('click', () => {\n            const id = (row as HTMLElement).dataset.id;\n            if (id) viewWorkoutDetails(id);\n        });\n    });\n}\n\n/**\n * Render Training Load (Weekly TSS)\n */\nfunction renderTrainingLoad(workouts: Workout[]): void {\n    const container = document.getElementById('trainingLoadChart');\n    if (!container) return;\n\n    // Group by week\n    const weeks: Record<string, number> = {};\n    // Generate last 4 weeks keys\n    for (let i = 3; i >= 0; i--) {\n        const d = new Date();\n        d.setDate(d.getDate() - i * 7);\n        const weekNum = getWeekNumber(d);\n        weeks[`${d.getFullYear()}-W${weekNum}`] = 0;\n    }\n\n    workouts.forEach((w) => {\n        const summary = getSummary(w);\n        if (summary.trainingLoad) {\n            const date = new Date(w.startTime);\n            const key = `${date.getFullYear()}-W${getWeekNumber(date)}`;\n            if (weeks[key] !== undefined) {\n                weeks[key] += summary.trainingLoad;\n            }\n        }\n    });\n\n    const maxLoad = Math.max(...Object.values(weeks), 100); // Scale max\n\n    container.innerHTML = Object.entries(weeks)\n        .map(([week, load]) => {\n            const height = (load / maxLoad) * 100;\n            return `\n            <div style=\"display: flex; flex-direction: column; align-items: center; width: 20%;\">\n                <div style=\"font-size: 0.8em; font-weight: bold; margin-bottom: 4px;\">${Math.round(load)}</div>\n                <div style=\"width: 100%; height: 100px; display: flex; align-items: flex-end; justify-content: center;\">\n                    <div style=\"width: 80%; background: var(--color-accent); height: ${height}%; border-radius: 4px 4px 0 0; min-height: 4px;\"></div>\n                </div>\n                <div style=\"font-size: 0.7em; color: var(--color-text-secondary); margin-top: 4px;\">${week.split('-')[1]}</div>\n            </div>\n        `;\n        })\n        .join('');\n}\n\nfunction getWeekNumber(d: Date): number {\n    d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));\n    d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));\n    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\n    return Math.ceil(((d.getTime() - yearStart.getTime()) / 86400000 + 1) / 7);\n}\n\n/**\n * Render Power Curve (SVG Chart)\n */\nfunction renderPowerCurve(workouts: Workout[]): void {\n    const container = document.getElementById('powerCurveChart');\n    if (!container) return;\n\n    // Aggregate best power for each duration\n    const bests: Record<number, number> = {};\n    const durations = [1, 5, 10, 30, 60, 300, 1200, 3600];\n\n    workouts.forEach((w) => {\n        const summary = getSummary(w);\n        if (summary.powerCurve) {\n            summary.powerCurve.forEach((p) => {\n                if (!bests[p.duration] || p.watts > bests[p.duration]) {\n                    bests[p.duration] = p.watts;\n                }\n            });\n        }\n        // Fallback for older workouts if we have maxPower (1s)\n        if (summary.maxPower && (!bests[1] || summary.maxPower > bests[1])) {\n            bests[1] = summary.maxPower;\n        }\n    });\n\n    if (Object.keys(bests).length === 0) {\n        container.innerHTML =\n            '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">No power data available</div>';\n        return;\n    }\n\n    // Chart Dimensions\n    const width = container.clientWidth || 300;\n    const height = 200;\n    const pad = 30;\n\n    // Scales\n    const maxWatts = Math.max(...Object.values(bests)) * 1.1; // 10% overhead\n\n    const points = durations\n        .map((d, i) => {\n            if (!bests[d]) return null;\n            const x = pad + i * ((width - pad * 2) / (durations.length - 1));\n            const y = height - pad - (bests[d] / maxWatts) * (height - pad * 2);\n            return { x, y, val: bests[d], duration: d };\n        })\n        .filter((p) => p !== null);\n\n    if (points.length < 2) {\n        container.innerHTML =\n            '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">Insufficient data points</div>';\n        return;\n    }\n\n    const pathD = `M ${points.map((p) => `${p!.x},${p!.y}`).join(' L ')}`;\n\n    // SVG Content\n    const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad}\" y1=\"${pad}\" x2=\"${pad}\" y2=\"${height - pad}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad}\" y1=\"${height - pad}\" x2=\"${width - pad}\" y2=\"${height - pad}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- Path -->\n            <path d=\"${pathD}\" fill=\"none\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n            \n            <!-- Points -->\n            ${points\n                .map(\n                    (p) => `\n                <circle cx=\"${p!.x}\" cy=\"${p!.y}\" r=\"4\" fill=\"var(--card-bg)\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n                <text x=\"${p!.x}\" y=\"${p!.y - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-primary)\">${p!.val}W</text>\n                <text x=\"${p!.x}\" y=\"${height - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${formatDurationLabel(p!.duration)}</text>\n            `\n                )\n                .join('')}\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n\nfunction formatDurationLabel(sec: number): string {\n    if (sec < 60) return `${sec}s`;\n    if (sec < 3600) return `${sec / 60}m`;\n    return `${sec / 3600}h`;\n}\n\n/**\n * Render Fitness Trend (CTL/ATL)\n */\nfunction renderFitnessTrend(workouts: Workout[]): void {\n    const container = document.getElementById('fitnessTrendChart');\n    if (!container) return;\n\n    // Sort workouts by date ascending\n    const sorted = [...workouts].sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n\n    if (sorted.length < 2) {\n        container.innerHTML =\n            '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">Not enough data for trend analysis</div>';\n        return;\n    }\n\n    // Daily TSS Map\n    const tssMap = new Map<string, number>();\n    sorted.forEach((w) => {\n        const summary = getSummary(w);\n        if (summary.trainingLoad) {\n            const dateStr = new Date(w.startTime).toISOString().split('T')[0];\n            const current = tssMap.get(dateStr) || 0;\n            tssMap.set(dateStr, current + summary.trainingLoad);\n        }\n    });\n\n    // Calculate CTL/ATL day by day\n    const dataPoints: { date: Date; ctl: number; atl: number; tsb: number }[] = [];\n    const startDate = new Date(sorted[0].startTime);\n    const endDate = new Date(); // Today\n\n    // Constants\n    const kCTL = Math.exp(-1 / 42);\n    const kATL = Math.exp(-1 / 7);\n\n    let ctl = 0;\n    let atl = 0;\n\n    // Iterate day by day\n    for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {\n        const dateStr = d.toISOString().split('T')[0];\n        const tss = tssMap.get(dateStr) || 0;\n\n        ctl = ctl * kCTL + tss * (1 - kCTL);\n        atl = atl * kATL + tss * (1 - kATL);\n\n        dataPoints.push({\n            date: new Date(d),\n            ctl,\n            atl,\n            tsb: ctl - atl,\n        });\n    }\n\n    // Chart Dimensions\n    const width = container.clientWidth || 600;\n    const height = 250;\n    const pad = { top: 20, right: 30, bottom: 30, left: 40 };\n    const chartW = width - pad.left - pad.right;\n    const chartH = height - pad.top - pad.bottom;\n\n    // Scales\n    const maxVal = Math.max(...dataPoints.map((p) => Math.max(p.ctl, p.atl))) * 1.1;\n\n    const timeSpan = endDate.getTime() - startDate.getTime();\n    if (timeSpan === 0) return;\n\n    const getX = (date: Date) => pad.left + ((date.getTime() - startDate.getTime()) / timeSpan) * chartW;\n    const getY = (val: number) => pad.top + chartH - (val / maxVal) * chartH;\n\n    // Generate Paths\n    const ctlPath = 'M ' + dataPoints.map((p) => `${getX(p.date)},${getY(p.ctl)}`).join(' L ');\n    const atlPath = 'M ' + dataPoints.map((p) => `${getX(p.date)},${getY(p.atl)}`).join(' L ');\n\n    // SVG Content\n    const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad.left}\" y1=\"${pad.top}\" x2=\"${pad.left}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad.left}\" y1=\"${height - pad.bottom}\" x2=\"${width - pad.right}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- CTL Line (Fitness) - Blue -->\n            <path d=\"${ctlPath}\" fill=\"none\" stroke=\"#3b82f6\" stroke-width=\"2\" />\n            \n            <!-- ATL Line (Fatigue) - Pink/Purple -->\n            <path d=\"${atlPath}\" fill=\"none\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n            \n            <!-- Legend -->\n            <g transform=\"translate(${pad.left + 10}, ${pad.top})\">\n                <rect x=\"0\" y=\"0\" width=\"10\" height=\"10\" fill=\"#3b82f6\" />\n                <text x=\"15\" y=\"10\" font-size=\"12\" fill=\"var(--color-text-secondary)\">Fitness (CTL)</text>\n                \n                <rect x=\"100\" y=\"0\" width=\"10\" height=\"10\" fill=\"none\" stroke=\"#ec4899\" stroke-width=\"2\" stroke-dasharray=\"4\" />\n                <text x=\"115\" y=\"10\" font-size=\"12\" fill=\"var(--color-text-secondary)\">Fatigue (ATL)</text>\n            </g>\n\n            <!-- Latest Stats -->\n             <text x=\"${width - pad.right}\" y=\"${pad.top}\" text-anchor=\"end\" font-size=\"12\" fill=\"var(--color-text-primary)\">\n                CTL: ${Math.round(ctl)} | ATL: ${Math.round(atl)} | TSB: ${Math.round(ctl - atl)}\n            </text>\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n\n/**\n * Render FTP History Chart\n */\nfunction renderFtpHistory(history: FtpHistoryEntry[]): void {\n    const container = document.getElementById('ftpHistoryChart');\n    if (!container) return;\n\n    if (history.length === 0) {\n        container.innerHTML =\n            '<div style=\"display:flex; justify-content:center; align-items:center; height:100%; color: var(--color-text-secondary);\">No FTP history available</div>';\n        return;\n    }\n\n    // Sort by date ascending\n    const sorted = [...history].sort((a, b) => a.date - b.date);\n\n    // Chart Dimensions\n    const width = container.clientWidth || 600;\n    const height = 200;\n    const pad = { top: 20, right: 30, bottom: 30, left: 40 };\n    const chartW = width - pad.left - pad.right;\n    const chartH = height - pad.top - pad.bottom;\n\n    // Scales\n    const maxFtp = Math.max(...sorted.map((h) => h.ftp)) * 1.1;\n    const minFtp = Math.max(0, Math.min(...sorted.map((h) => h.ftp)) * 0.9);\n    const ftpRange = maxFtp - minFtp || 100; // avoid div by zero\n\n    const startDate = new Date(sorted[0].date);\n    const endDate = new Date();\n    const timeSpan = endDate.getTime() - startDate.getTime();\n\n    const getX = (timestamp: number | string | Date) => {\n        const d = new Date(timestamp);\n        return pad.left + ((d.getTime() - startDate.getTime()) / timeSpan) * chartW;\n    };\n    const getY = (val: number) => pad.top + chartH - ((val - minFtp) / ftpRange) * chartH;\n\n    // Generate Path\n    let d = '';\n    if (sorted.length > 0) {\n        d = `M ${getX(sorted[0].date)},${getY(sorted[0].ftp)}`;\n        for (let i = 1; i < sorted.length; i++) {\n            const currX = getX(sorted[i].date);\n            const prevY = getY(sorted[i - 1].ftp);\n            const currY = getY(sorted[i].ftp);\n\n            // Step line: Horizontal then Vertical\n            d += ` L ${currX},${prevY} L ${currX},${currY}`;\n        }\n        // Extend to now\n        d += ` L ${width - pad.right},${getY(sorted[sorted.length - 1].ftp)}`;\n    }\n\n    // SVG Content\n    const svg = `\n        <svg width=\"100%\" height=\"100%\" viewBox=\"0 0 ${width} ${height}\" preserveAspectRatio=\"none\">\n            <!-- Grid Lines -->\n            <line x1=\"${pad.left}\" y1=\"${pad.top}\" x2=\"${pad.left}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            <line x1=\"${pad.left}\" y1=\"${height - pad.bottom}\" x2=\"${width - pad.right}\" y2=\"${height - pad.bottom}\" stroke=\"var(--color-border)\" stroke-width=\"1\" />\n            \n            <!-- FTP Line -->\n            <path d=\"${d}\" fill=\"none\" stroke=\"var(--color-accent)\" stroke-width=\"2\" />\n            \n            <!-- Points -->\n            ${sorted\n                .map(\n                    (h) => `\n                <circle cx=\"${getX(h.date)}\" cy=\"${getY(h.ftp)}\" r=\"4\" fill=\"var(--card-bg)\" stroke=\"var(--color-accent)\" stroke-width=\"2\">\n                    <title>${h.ftp} W (${formatDate(new Date(h.date))})</title>\n                </circle>\n                <text x=\"${getX(h.date)}\" y=\"${getY(h.ftp) - 10}\" text-anchor=\"middle\" font-size=\"10\" fill=\"var(--color-text-primary)\">${h.ftp}</text>\n            `\n                )\n                .join('')}\n\n            <!-- Axis Labels (simplified) -->\n            <text x=\"${pad.left}\" y=\"${height - 10}\" font-size=\"10\" fill=\"var(--color-text-secondary)\">${formatDate(startDate)}</text>\n            <text x=\"${width - pad.right}\" y=\"${height - 10}\" text-anchor=\"end\" font-size=\"10\" fill=\"var(--color-text-secondary)\">Today</text>\n        </svg>\n    `;\n\n    container.innerHTML = svg;\n}\n\n/**\n * Render PR History (Chronological improvements)\n */\nfunction renderPrHistory(workouts: Workout[]): void {\n    const container = document.getElementById('prHistoryList');\n    if (!container) return;\n\n    // Sort strictly chronological\n    const sorted = [...workouts].sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n\n    interface RecordEvent {\n        date: string;\n        metric: string;\n        value: string;\n        improvement: string;\n        workoutId: string;\n    }\n\n    const events: RecordEvent[] = [];\n\n    // State to track maxes\n    let maxPower = 0;\n    let maxHr = 0;\n    const powerCurveBests: Record<number, number> = {};\n\n    sorted.forEach((w) => {\n        const summary = getSummary(w);\n        const dateStr = formatDate(w.startTime);\n\n        // Power (1s)\n        if (summary.maxPower && summary.maxPower > maxPower) {\n            if (maxPower > 0) {\n                const diff = summary.maxPower - maxPower;\n                events.push({\n                    date: dateStr,\n                    metric: 'Max Power',\n                    value: `${summary.maxPower} W`,\n                    improvement: `+${diff} W`,\n                    workoutId: w.id,\n                });\n            } else {\n                events.push({\n                    date: dateStr,\n                    metric: 'Max Power',\n                    value: `${summary.maxPower} W`,\n                    improvement: 'New!',\n                    workoutId: w.id,\n                });\n            }\n            maxPower = summary.maxPower;\n        }\n\n        // HR\n        if (summary.maxHeartrate && summary.maxHeartrate > maxHr) {\n            if (maxHr > 0) {\n                const diff = summary.maxHeartrate - maxHr;\n                events.push({\n                    date: dateStr,\n                    metric: 'Max Heart Rate',\n                    value: `${summary.maxHeartrate} bpm`,\n                    improvement: `+${diff} bpm`,\n                    workoutId: w.id,\n                });\n            } else {\n                events.push({\n                    date: dateStr,\n                    metric: 'Max Heart Rate',\n                    value: `${summary.maxHeartrate} bpm`,\n                    improvement: 'New!',\n                    workoutId: w.id,\n                });\n            }\n            maxHr = summary.maxHeartrate;\n        }\n\n        // Power Curve - Notable durations (1m, 5m, 20m)\n        if (summary.powerCurve) {\n            const notable = [60, 300, 1200];\n            const labels: Record<number, string> = { 60: '1m Power', 300: '5m Power', 1200: '20m Power' };\n            summary.powerCurve.forEach((p: { duration: number; watts: number }) => {\n                if (notable.includes(p.duration)) {\n                    const current = powerCurveBests[p.duration] || 0;\n                    if (p.watts > current) {\n                        if (current > 0) {\n                            events.push({\n                                date: dateStr,\n                                metric: labels[p.duration],\n                                value: `${p.watts} W`,\n                                improvement: `+${p.watts - current} W`,\n                                workoutId: w.id,\n                            });\n                        } else {\n                            events.push({\n                                date: dateStr,\n                                metric: labels[p.duration],\n                                value: `${p.watts} W`,\n                                improvement: 'New!',\n                                workoutId: w.id,\n                            });\n                        }\n                        powerCurveBests[p.duration] = p.watts;\n                    }\n                }\n            });\n        }\n    });\n\n    if (events.length === 0) {\n        container.innerHTML =\n            '<div style=\"text-align: center; color: var(--color-text-secondary); padding: 20px;\">No records found</div>';\n        return;\n    }\n\n    // Sort events reverse chronological (newest first)\n    const reversedEvents = events.reverse();\n\n    container.innerHTML = reversedEvents\n        .map(\n            (e) => `\n        <div class=\"pr-history-row\" data-id=\"${e.workoutId}\" style=\"display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--color-border); cursor: pointer;\">\n            <div style=\"flex: 1;\">\n                <div style=\"font-weight: 500;\">${e.metric}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-text-secondary);\">${e.date}</div>\n            </div>\n            <div style=\"text-align: right;\">\n                <div style=\"font-weight: bold; color: var(--color-accent);\">${e.value}</div>\n                <div style=\"font-size: 0.8em; color: var(--color-success);\">${e.improvement}</div>\n            </div>\n        </div>\n    `\n        )\n        .join('');\n\n    container.querySelectorAll('.pr-history-row').forEach((row) => {\n        row.addEventListener('click', () => {\n            const id = (row as HTMLElement).dataset.id;\n            if (id) viewWorkoutDetails(id);\n        });\n    });\n}\n// Exported helper for the View\nexport async function refreshHistoryView(): Promise<void> {\n    // Reset to today if needed, or just refresh current view\n    if (currentView === 'list') {\n        await loadWorkouts();\n    } else if (currentView === 'calendar') {\n        await loadCalendar();\n    } else if (currentView === 'analytics') {\n        await loadAnalytics();\n    }\n}\n\nconst ZONE_COLORS: Record<number, string> = POWER_ZONE_COLORS;\n\n/**\n * Format seconds to MM:SS or Xh Ym\n */\nfunction formatZoneTime(ms: number): string {\n    const seconds = Math.round(ms / 1000);\n    if (seconds < 3600) {\n        const mins = Math.floor(seconds / 60);\n        const secs = seconds % 60;\n        return `${mins}m ${secs}s`;\n    } else {\n        const hours = Math.floor(seconds / 3600);\n        const mins = Math.floor((seconds % 3600) / 60);\n        return `${hours}h ${mins}m`;\n    }\n}\n\n/**\n * Render Zone Distribution Chart\n */\nfunction renderZoneChart(containerId: string, distribution: any, title: string): void {\n    const container = document.getElementById(containerId);\n    if (!container || !distribution || !distribution.zones) return;\n\n    // Filter zones that have any time\n    const activeZones = distribution.zones; // Show all zones for consistency, or filter? typical is all.\n    const maxTime = Math.max(...activeZones.map((z: any) => z.timeInZoneMs));\n\n    if (maxTime === 0) {\n        container.style.display = 'none';\n        return;\n    }\n\n    const html = `\n    <div style=\"display: flex; flex-direction: column; gap: 8px;\">\n      <div style=\"font-weight: bold; margin-bottom: 8px;\">${title}</div>\n      ${activeZones\n          .map((zone: any) => {\n              const percent = maxTime > 0 ? (zone.timeInZoneMs / maxTime) * 100 : 0;\n              const totalPercent =\n                  distribution.totalTimeMs > 0 ? (zone.timeInZoneMs / distribution.totalTimeMs) * 100 : 0;\n              const color = ZONE_COLORS[zone.zone] || '#888';\n              const timeStr = formatZoneTime(zone.timeInZoneMs);\n\n              return `\n          <div style=\"display: flex; align-items: center; gap: 10px; font-size: 0.9em;\">\n            <div style=\"width: 30px; font-weight: bold; color: var(--color-text-secondary);\">Z${zone.zone}</div>\n            <div style=\"flex: 1; background: var(--color-bg-tertiary); height: 24px; border-radius: 4px; overflow: hidden; position: relative;\">\n               <div style=\"width: ${percent}%; height: 100%; background-color: ${color}; transition: width 0.5s;\"></div>\n               <span style=\"position: absolute; left: 8px; top: 0; bottom: 0; display: flex; align-items: center; color: var(--color-text-inverse); text-shadow: 0 0 2px rgba(0,0,0,0.5); font-size: 0.8em;\">\n                 ${Math.round(totalPercent)}%\n               </span>\n            </div>\n            <div style=\"width: 60px; text-align: right; font-family: monospace;\">${timeStr}</div>\n          </div>\n        `;\n          })\n          .join('')}\n    </div>\n  `;\n\n    container.innerHTML = html;\n}\n\n/**\n * Parses telemetry and renders charts for workout detail\n */\nfunction renderWorkoutCharts(telemetryJson: string, startTimeIso: string | number): void {\n    try {\n        const data = JSON.parse(telemetryJson) as MeasurementsData;\n        const startTs = typeof startTimeIso === 'string' ? new Date(startTimeIso).getTime() : startTimeIso;\n\n        // Power Chart\n        const powerContainer = document.getElementById('wd-chart-power');\n        if (powerContainer && data.power && data.power.length > 0) {\n            const points = data.power.map((p) => ({ x: p.timestamp - startTs, y: p.value }));\n            renderLineChart(powerContainer, points, {\n                title: 'Power',\n                color: '#fbbf24', // Amber 400\n                yLabel: 'Watts',\n                yMin: 0,\n            });\n        } else if (powerContainer) {\n            powerContainer.style.display = 'none';\n        }\n\n        // Heart Rate Chart\n        const hrContainer = document.getElementById('wd-chart-hr');\n        if (hrContainer && data.heartrate && data.heartrate.length > 0) {\n            const points = data.heartrate.map((p) => ({ x: p.timestamp - startTs, y: p.value }));\n            renderLineChart(hrContainer, points, {\n                title: 'Heart Rate',\n                color: '#f87171', // Red 400\n                yLabel: 'BPM',\n                yMin: 40,\n            });\n        } else if (hrContainer) {\n            hrContainer.style.display = 'none';\n        }\n\n        // Cadence Chart\n        const cadContainer = document.getElementById('wd-chart-cadence');\n        if (cadContainer && data.cadence && data.cadence.length > 0) {\n            const points = data.cadence.map((p) => ({ x: p.timestamp - startTs, y: p.value }));\n            renderLineChart(cadContainer, points, {\n                title: 'Cadence',\n                color: '#60a5fa', // Blue 400\n                yLabel: 'RPM',\n                yMin: 0,\n            });\n        } else if (cadContainer) {\n            cadContainer.style.display = 'none';\n        }\n\n        // Altitude Chart\n        const altContainer = document.getElementById('wd-chart-altitude');\n        if (altContainer && data.altitude && data.altitude.length > 0) {\n            const points = data.altitude.map((p) => ({ x: p.timestamp - startTs, y: p.value }));\n            // Filter out zero altitudes if unlikely\n            const validPoints = points.filter((p) => p.y !== 0);\n\n            if (validPoints.length > 0) {\n                renderLineChart(altContainer, validPoints, {\n                    title: 'Altitude',\n                    color: '#34d399', // Emerald 400\n                    yLabel: 'Meters',\n                });\n            } else {\n                altContainer.style.display = 'none';\n            }\n        } else if (altContainer) {\n            altContainer.style.display = 'none';\n        }\n    } catch (e) {\n        console.error('Failed to parse telemetry for charts', e);\n    }\n}\n\n/**\n * Start the Crop Tool for a workout\n */\nfunction startCropTool(workout: Workout): void {\n    if (!workout.telemetry || !workout.startTime) {\n        alert('No telemetry data available for cropping');\n        return;\n    }\n\n    const detailPanel = document.getElementById('workoutDetailPanel');\n    if (!detailPanel) return;\n\n    let measurements: MeasurementsData | null = null;\n    try {\n        measurements = JSON.parse(workout.telemetry) as MeasurementsData;\n    } catch (e) {\n        console.error('Invalid telemetry', e);\n        alert('Failed to parse workout data');\n        return;\n    }\n\n    if (!measurements) return;\n\n    const originalStart = new Date(workout.startTime).getTime();\n    const originalEnd = workout.endTime\n        ? new Date(workout.endTime).getTime()\n        : originalStart + (workout.duration || 0) * 1000;\n\n    // Initial state\n    let currentStart = originalStart;\n    let currentEnd = originalEnd;\n    const durationMs = originalEnd - originalStart;\n\n    // Render Crop UI\n    detailPanel.innerHTML = `\n    <div class=\"workout-crop-tool\">\n      <div class=\"workout-detail-header\">\n        <button id=\"cancelCropBtn\" class=\"workout-back-btn\">Cancel</button>\n        <h3>Crop Workout</h3>\n        <button id=\"saveCropBtn\" class=\"workout-action-btn workout-status-completed\">Save Changes</button>\n      </div>\n\n      <div class=\"crop-controls\" style=\"margin: 20px 0; padding: 20px; background: var(--color-bg-secondary); border-radius: 8px;\">\n         <div style=\"display: flex; justify-content: space-between; margin-bottom: 20px;\">\n             <div>\n                 <label>Start Time offset</label>\n                 <div class=\"value-display\" id=\"cropStartDisplay\">00:00</div>\n                 <input type=\"range\" id=\"cropStartSlider\" min=\"0\" max=\"${durationMs}\" value=\"0\" style=\"width: 100%\">\n             </div>\n             <div style=\"text-align: right;\">\n                 <label>End Time offset</label>\n                 <div class=\"value-display\" id=\"cropEndDisplay\">${formatDuration(durationMs / 1000)}</div>\n                 <input type=\"range\" id=\"cropEndSlider\" min=\"0\" max=\"${durationMs}\" value=\"${durationMs}\" style=\"width: 100%\">\n             </div>\n         </div>\n         \n         <div style=\"text-align: center; font-weight: bold; margin-bottom: 10px;\">\n            New Duration: <span id=\"cropDurationDisplay\">${formatDuration(durationMs / 1000)}</span>\n         </div>\n         \n         <div id=\"cropPreviewChart\" style=\"height: 150px; background: var(--card-bg); border-radius: 8px;\"></div>\n      </div>\n      \n      <div class=\"crop-info\" style=\"font-size: 0.9em; color: var(--color-text-secondary); margin-top: 10px;\">\n          <p> Saving will overwrite the original workout data. This cannot be undone.</p>\n      </div>\n    </div>\n  `;\n\n    // Init interaction\n    const sliderStart = document.getElementById('cropStartSlider') as HTMLInputElement;\n    const sliderEnd = document.getElementById('cropEndSlider') as HTMLInputElement;\n    const displayStart = document.getElementById('cropStartDisplay');\n    const displayEnd = document.getElementById('cropEndDisplay');\n    const displayDuration = document.getElementById('cropDurationDisplay');\n    const chartContainer = document.getElementById('cropPreviewChart')!;\n\n    // Render preview chart (using Power as reference)\n    const renderPreview = () => {\n        if (measurements && measurements.power) {\n            const cropped = cropWorkout(measurements, originalStart, currentStart, currentEnd);\n            const points = cropped.measurements.power.map((p) => ({ x: p.timestamp - currentStart, y: p.value }));\n\n            renderLineChart(chartContainer, points, {\n                title: 'Preview (Power)',\n                color: '#fbbf24',\n                yMin: 0,\n                height: 150,\n            });\n        }\n    };\n\n    const updateUI = () => {\n        const startOffset = parseInt(sliderStart.value);\n        const endOffset = parseInt(sliderEnd.value);\n\n        // Enforce constraints\n        if (startOffset >= endOffset) {\n            // Prevent crossing\n            if (document.activeElement === sliderStart) {\n                sliderStart.value = (endOffset - 10000).toString(); // Keep 10s gap\n            } else {\n                sliderEnd.value = (startOffset + 10000).toString();\n            }\n            return;\n        }\n\n        currentStart = originalStart + parseInt(sliderStart.value);\n        currentEnd = originalStart + parseInt(sliderEnd.value);\n\n        if (displayStart) displayStart.textContent = formatDuration(parseInt(sliderStart.value) / 1000);\n        if (displayEnd) displayEnd.textContent = formatDuration(parseInt(sliderEnd.value) / 1000);\n        if (displayDuration) displayDuration.textContent = formatDuration((currentEnd - currentStart) / 1000);\n\n        renderPreview();\n    };\n\n    sliderStart.addEventListener('input', updateUI);\n    sliderEnd.addEventListener('input', updateUI);\n\n    // Initial render\n    setTimeout(renderPreview, 0);\n\n    // Cancel Action\n    document.getElementById('cancelCropBtn')?.addEventListener('click', () => {\n        viewWorkoutDetails(workout.id);\n    });\n\n    // Save Action\n    document.getElementById('saveCropBtn')?.addEventListener('click', async () => {\n        const btn = document.getElementById('saveCropBtn') as HTMLButtonElement;\n        btn.disabled = true;\n        btn.textContent = 'Saving...';\n\n        try {\n            const result = cropWorkout(measurements!, originalStart, currentStart, currentEnd);\n\n            // Construct updated workout object (for future API syncing)\n            // const updatedWorkout = {\n            //     ...workout,\n            //     startTime: new Date(result.startTime).toISOString(),\n            //     endTime: new Date(result.endTime).toISOString(),\n            //     duration: result.duration,\n            //     summary: JSON.stringify(result.summary),\n            //     telemetry: JSON.stringify(result.measurements)\n            // };\n\n            // Save methods\n            if (isIndexedDBSupported()) {\n                // Always update local storage if available\n                const { saveCompletedWorkout } = await import('../storage/workoutStorage.js');\n                await saveCompletedWorkout(result.measurements, result.startTime, result.endTime);\n\n                // If we are renaming/replacing, we might need to delete the old one if the ID depends on start time.\n                // ID is 'workout_' + startTime.\n                // If start time changes, ID changes!\n                if (result.startTime !== originalStart) {\n                    // We created a new record. Should we delete the old one?\n                    // Yes, to avoid duplicates.\n                    // But wait, if it came from API, ID is a UUID usually.\n                }\n            }\n\n            // Always local\n            if (true) {\n                if (result.startTime !== originalStart) {\n                    // TODO: Implement local cleanup for renamed/moved workouts\n                }\n                alert('Workout cropped and saved locally.');\n            }\n\n            // Return to details\n            // If ID changed, we might need to go to list\n            if (result.startTime !== originalStart && workout.id.startsWith('workout_')) {\n                // Go to list\n                const listPanel = document.getElementById('workoutListPanel');\n                if (detailPanel && listPanel) {\n                    detailPanel.style.display = 'none';\n                    listPanel.style.display = 'block';\n                    // Trigger refresh mechanism?\n                    document.getElementById('historyRefresh')?.click();\n                }\n            } else {\n                viewWorkoutDetails(workout.id);\n            }\n        } catch (e) {\n            console.error('Failed to save crop', e);\n            alert('Error saving cropped workout');\n            btn.disabled = false;\n            btn.textContent = 'Save Changes';\n        }\n    });\n}\n","import { getSettings } from '../config/settings.js';\nimport type { MeasurementsData } from '../types/measurements.js';\nimport { getFitData } from '../create-fit.js';\nimport { showNotification } from '../ui/notifications.js';\n\n/**\n * Service for integrating with Intervals.icu API\n */\nexport class IntervalsService {\n    private static API_BASE = 'https://intervals.icu/api/v1';\n\n    /**\n     * Upload a workout to Intervals.icu\n     *\n     * @param measurements - The workout measurements data\n     * @param workoutName - Name for the file (e.g. \"BikePowerTracker_2024-01-01.fit\")\n     */\n    static async uploadWorkout(measurements: MeasurementsData, workoutName: string): Promise<void> {\n        const settings = getSettings();\n\n        // Basic check before processing\n        if (!settings.intervals.enabled || !settings.intervals.apiKey) {\n            return;\n        }\n\n        try {\n            const fitData = getFitData(measurements);\n            if (!fitData) {\n                console.warn('[Intervals] No data to upload');\n                return;\n            }\n\n            const blob = new Blob([fitData as unknown as BlobPart], { type: 'application/fit' });\n            const formData = new FormData();\n            // Append the file. 'file' is the key expected by standard multipart uploads,\n            // though Intervals.icu endpoint documentation should be checked.\n            // Most fit upload endpoints accept a 'file' parameter.\n            formData.append('file', blob, workoutName);\n\n            const athleteId = settings.intervals.athleteId || 'i';\n            const url = `${this.API_BASE}/athlete/${athleteId}/activities`;\n\n            // Authorization: Basic <base64(\"API_KEY:\" + api_key)>\n            const auth = btoa(`API_KEY:${settings.intervals.apiKey}`);\n\n            showNotification('Uploading to Intervals.icu...', 'info');\n\n            const response = await fetch(url, {\n                method: 'POST',\n                headers: {\n                    Authorization: `Basic ${auth}`,\n                },\n                body: formData,\n            });\n\n            if (response.ok) {\n                const result = await response.json();\n                console.log('[Intervals] Upload success:', result);\n                showNotification('Uploaded to Intervals.icu! ', 'success');\n            } else {\n                const text = await response.text();\n                console.error('[Intervals] Upload failed:', response.status, text);\n                showNotification(`Upload failed: ${response.status}`, 'error');\n            }\n        } catch (error) {\n            console.error('[Intervals] Network error:', error);\n            showNotification('Upload network error', 'error');\n        }\n    }\n}\n","/**\n * Application settings stored in localStorage\n */\nexport interface AppSettings {\n    power: boolean;\n    cadence: boolean;\n    heartrate: boolean;\n    exportTcx: boolean;\n    exportCsv: boolean;\n    exportJson: boolean;\n    exportFit: boolean;\n}\n\n/**\n * Default settings\n */\nexport const defaultSettings: AppSettings = {\n    power: true,\n    cadence: true,\n    heartrate: true,\n    exportTcx: true,\n    exportCsv: true,\n    exportJson: false,\n    exportFit: false,\n};\n","/**\n * Strava Integration Module\n *\n * Handles Strava connectivity and upload options.\n *\n * Current Implementation:\n * - Option 1: Manual Upload (Generates TCX and opens Strava upload page)\n *\n * @module strava\n */\n\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js'; // Prefer FIT if possible\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { WorkoutMetadata } from '../types/measurements.js';\nimport { announce } from '../ui/accessibility.js';\n\n/**\n * Base URL for Strava's manual upload page\n */\nexport const STRAVA_UPLOAD_URL = 'https://www.strava.com/upload/select';\n\n/**\n * Strava Integration Service\n */\nexport class StravaService {\n    private static instance: StravaService;\n\n    // Future expansion: OAuth tokens\n    private accessToken: string | null = null;\n\n    private constructor() {}\n\n    public static getInstance(): StravaService {\n        if (!StravaService.instance) {\n            StravaService.instance = new StravaService();\n        }\n        return StravaService.instance;\n    }\n\n    /**\n     * Check if Strava is \"connected\" (meaning we have tokens)\n     * For now, returns false as we are doing manual upload\n     */\n    public isConnected(): boolean {\n        return !!this.accessToken;\n    }\n\n    /**\n     * Initiate Strava Upload Flow\n     *\n     * If not connected:\n     * 1. Generates workout file (FIT preferred, TCX fallback)\n     * 2. Triggers download\n     * 3. Opens Strava Upload page in new tab\n     */\n    public async handleUpload(\n        measurementsState: MeasurementsState,\n        // @ts-ignore: metadata currently unused until we add real metadata to export\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        metadata?: WorkoutMetadata\n    ): Promise<void> {\n        try {\n            // 1. Generate Data\n            // We use FIT because it's binary, smaller, and preferred by Strava\n            // But we need to check if getFitData works (it might be async in some implementations, though here likely sync)\n\n            let blob: Blob;\n            let filename: string;\n\n            const dateStr = new Date().toISOString().slice(0, 10);\n            const timeStr = new Date().toISOString().slice(11, 16).replace(':', '-');\n            const filePrefix = `bike-power-tracker-${dateStr}-${timeStr}`;\n\n            try {\n                // Try FIT first\n                // IMPORTANT: getFitData expects SportType | undefined, but metadata passes title/notes\n                // We should extract sport type from metadata or valid source.\n                // Assuming metadata doesn't have sport yet, defaulting to undefined (cycling)\n                const fitData = getFitData(measurementsState, undefined);\n                if (fitData) {\n                    blob = new Blob([fitData as unknown as BlobPart], { type: 'application/octet-stream' });\n                    filename = `${filePrefix}.fit`;\n                } else {\n                    throw new Error('No FIT data generated');\n                }\n            } catch (e) {\n                console.warn('FIT generation failed, falling back to TCX', e);\n                const tcxString = getTcxString(measurementsState);\n                blob = new Blob([tcxString], { type: 'application/vnd.garmin.tcx+xml' });\n                filename = `${filePrefix}.tcx`;\n            }\n\n            // 2. Trigger Download\n            this.downloadFile(blob, filename);\n\n            // 3. Open Strava\n            this.openStravaUpload();\n\n            announce('Workout file downloaded. Please upload closely in the new Strava tab.', 'assertive');\n        } catch (error) {\n            console.error('Strava upload preparation failed:', error);\n            alert('Failed to prepare Strava upload.');\n        }\n    }\n\n    private downloadFile(blob: Blob, filename: string): void {\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        setTimeout(() => URL.revokeObjectURL(url), 100);\n    }\n\n    private openStravaUpload(): void {\n        window.open(STRAVA_UPLOAD_URL, '_blank');\n    }\n}\n\nexport const stravaService = StravaService.getInstance();\n","/**\n * Menu Controls\n *\n * Initializes menu buttons for export, discard, and settings toggle.\n *\n * @module menu\n */\n\nimport { getCsvString } from '../create-csv.js';\nimport { getTcxString } from '../create-tcx.js';\nimport { getFitData } from '../create-fit.js';\nimport { showConfirmation, showWorkoutSummary, calculateWorkoutSummary } from './modal.js';\nimport { showWorkoutMetadataModal, shouldShowMetadataModal } from './workoutMetadataModal.js';\nimport { announce } from './accessibility.js';\nimport {\n    showUndoNotification,\n    createWorkoutBackup,\n    restoreWorkoutBackup,\n    type WorkoutBackup,\n} from './undoNotification.js';\nimport { resetLapCounter } from './lap.js';\nimport { PersonalRecordTracker } from './analyticsHelper.js';\nimport { getCompletedWorkouts } from '../storage/workoutStorage.js';\nimport { storedToWorkout } from './workoutHistory.js';\nimport { archiveWorkout } from '../storage/workoutStorage.js';\nimport { IntervalsService } from '../services/IntervalsService.js';\nimport { getSettings } from '../config/settings.js';\nimport { settingsStore } from '../state/SettingsStore.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { ZoneState } from '../zone-state.js';\nimport type { WorkoutMetadata } from '../types/measurements.js';\nimport { type AppSettings, defaultSettings } from '../types/settings.js';\n\n/**\n * Initialize the metrics visibility toggles.\n *\n * Sets up toggle switches for showing/hiding \"Your Metrics\" and \"Stream Metrics\" sections.\n */\nexport const initMetricsToggle = (): void => {\n    // Your Metrics Toggle\n    const toggleYour = document.getElementById('toggleYourMetrics') as HTMLInputElement | null;\n    const yourMetricsSection = document.getElementById('yourMetrics');\n\n    if (toggleYour && yourMetricsSection) {\n        // Initial state check\n        toggleYour.checked = yourMetricsSection.style.display !== 'none';\n\n        toggleYour.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            yourMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n\n    // Stream Metrics Toggle\n    const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n    const streamMetricsSection = document.getElementById('streamMetrics');\n\n    if (toggleStream && streamMetricsSection) {\n        // Initial state check\n        toggleStream.checked = streamMetricsSection.style.display !== 'none';\n\n        toggleStream.addEventListener('change', (e: Event) => {\n            const target = e.target as HTMLInputElement;\n            streamMetricsSection.style.display = target.checked ? 'flex' : 'none';\n        });\n    }\n};\n\n/**\n * Parameters for discard button initialization\n */\ninterface InitDiscardButtonParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/**\n * Initialize the discard button.\n *\n * Shows a custom confirmation dialog before clearing all workout data.\n * After discard, shows an undo notification for 5 seconds allowing\n * the user to restore their data.\n *\n * @param params - Object containing state objects\n */\nexport const initDiscardButton = ({ measurementsState, timeState, zoneState }: InitDiscardButtonParams): void => {\n    const discardButton = document.getElementById('discardButton');\n\n    if (!discardButton) {\n        console.warn('Discard button not found in DOM');\n        return;\n    }\n\n    const addListener = (btn: HTMLElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    addListener(discardButton, async () => {\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0 ||\n            timeState.startTime !== null;\n\n        // If no data, just reset silently\n        if (!hasData) {\n            resetWorkoutState(measurementsState, timeState);\n            return;\n        }\n\n        // Count data points for the warning message\n        const totalDataPoints =\n            measurementsState.power.length + measurementsState.heartrate.length + measurementsState.cadence.length;\n\n        const confirmed = await showConfirmation(\n            'Discard Workout',\n            `Are you sure you want to discard this workout? You have ${totalDataPoints} data points that will be deleted. You'll have 5 seconds to undo this action.`,\n            {\n                confirmText: 'Discard',\n                cancelText: 'Keep Data',\n                confirmVariant: 'danger',\n                icon: '',\n            }\n        );\n\n        if (confirmed) {\n            // Create backup before clearing\n            const backup = createWorkoutBackup(measurementsState, timeState);\n\n            // Clear the workout data\n            resetWorkoutState(measurementsState, timeState);\n\n            // Reset zone tracking\n            if (zoneState) {\n                zoneState.reset();\n            }\n\n            // Dispatch event for zone state to reset\n            document.dispatchEvent(new CustomEvent('workout-discarded'));\n\n            // Reset lap counter display\n            resetLapCounter();\n\n            // Show undo notification\n            showUndoNotification({\n                message: 'Workout data discarded',\n                icon: '',\n                timeout: 5000,\n                onUndo: () => {\n                    // Restore the backup\n                    restoreWorkoutBackup(backup, measurementsState, timeState);\n\n                    // Restore UI state based on the backup\n                    restoreWorkoutUI(backup);\n\n                    announce('Workout data restored', 'polite');\n                },\n                onExpire: () => {\n                    // Data is already cleared, nothing more to do\n                    announce('Discard complete', 'polite');\n                },\n            });\n        }\n    });\n};\n\n/**\n * Restore the workout UI based on backed up state\n */\nfunction restoreWorkoutUI(backup: WorkoutBackup): void {\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n    const timeElement = document.getElementById('time');\n\n    if (backup.running) {\n        // Was running when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'inline-flex';\n        if (resumeButton) resumeButton.style.display = 'none';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    } else if (backup.startTime !== null) {\n        // Was paused when discarded\n        if (startButton) startButton.style.display = 'none';\n        if (pauseButton) pauseButton.style.display = 'none';\n        if (resumeButton) resumeButton.style.display = 'inline-flex';\n        if (stopButton) stopButton.style.display = 'inline-flex';\n    }\n\n    // Restore timer display if there was a start time\n    if (timeElement && backup.startTime !== null) {\n        const elapsed = (backup.endTime || Date.now()) - backup.startTime;\n        const seconds = Math.floor(elapsed / 1000);\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        const secs = seconds % 60;\n        timeElement.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;\n    }\n}\n\n/**\n * Reset workout state to initial values\n */\nfunction resetWorkoutState(measurementsState: MeasurementsState, timeState: TimeState): void {\n    // Reset time state\n    timeState.running = false;\n    timeState.startTime = null;\n    timeState.endTime = null;\n\n    // Reset measurements\n    measurementsState.power = [];\n    measurementsState.heartrate = [];\n    measurementsState.cadence = [];\n\n    // Reset workout controls to idle state\n    const startButton = document.getElementById('startButton') as HTMLButtonElement | null;\n    const pauseButton = document.getElementById('pauseButton') as HTMLButtonElement | null;\n    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n    const stopButton = document.getElementById('stopButton') as HTMLButtonElement | null;\n\n    if (startButton) startButton.style.display = 'inline-flex';\n    if (pauseButton) pauseButton.style.display = 'none';\n    if (resumeButton) resumeButton.style.display = 'none';\n    if (stopButton) stopButton.style.display = 'none';\n\n    // Reset timer display\n    const timeElement = document.getElementById('time');\n    if (timeElement) timeElement.textContent = '00:00:00';\n}\n\n/**\n * Generate a timestamp string for filenames.\n */\nfunction getExportTimestamp(): string {\n    const now = new Date();\n    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}-${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}-${String(now.getSeconds()).padStart(2, '0')}`;\n}\n\n/**\n * Download a file by creating a temporary link element.\n */\nfunction downloadFile(blob: Blob, filename: string): void {\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = filename;\n    link.click();\n    URL.revokeObjectURL(url);\n}\n\nimport { showNotification } from './notifications.js';\nimport { stravaService } from '../integrations/strava.js';\n\n/**\n * Initialize the export button.\n *\n * Exports workout data in configured formats (TCX, CSV, JSON).\n *\n * @param measurementsState - The measurements state object\n * @param zoneState - Optional zone state for including zone data in exports\n */\nexport const initExportButton = (measurementsState: MeasurementsState, zoneState?: ZoneState): void => {\n    const exportDataElem = document.getElementById('exportData');\n\n    if (!exportDataElem) {\n        console.warn('Export button not found in DOM');\n        return;\n    }\n\n    const addListener = (btn: HTMLElement, callback: () => void) => {\n        const handler = (e: Event) => {\n            e.stopPropagation();\n            callback();\n        };\n        btn.addEventListener('click', handler);\n    };\n\n    addListener(exportDataElem, () => {\n        try {\n            // Get export format settings\n            const settingsJson = localStorage.getItem('bpt-settings');\n            const settings: AppSettings = settingsJson\n                ? { ...defaultSettings, ...JSON.parse(settingsJson) }\n                : defaultSettings;\n\n            const timestamp = getExportTimestamp();\n            const metadata = getWorkoutMetadata();\n\n            // Create a safe filename from metadata title\n            const safeTitle = metadata?.title\n                ? metadata.title\n                    .replace(/[^a-z0-9]+/gi, '-')\n                    .substring(0, 30)\n                    .toLowerCase()\n                : 'workout';\n\n            // Show options modal\n            showConfirmation('Export Options', 'Choose an action for your workout data:', {\n                confirmText: 'Download Files',\n                confirmVariant: 'primary',\n                cancelText: 'Upload to Strava',\n                icon: '',\n            }).then((isDownload) => {\n                if (isDownload) {\n                    // Download JSON file (includes zone data and metadata)\n                    if (settings.exportJson) {\n                        const exportData: Record<string, unknown> = {\n                            metadata: metadata\n                                ? {\n                                    title: metadata.title,\n                                    notes: metadata.notes || null,\n                                    perceivedExertion: metadata.perceivedExertion || null,\n                                }\n                                : null,\n                            power: measurementsState.power,\n                            heartrate: measurementsState.heartrate,\n                            cadence: measurementsState.cadence,\n                        };\n                        // ... (zone data logic)\n                        if (zoneState) {\n                            const zoneData = zoneState.toJSON();\n                            if (\n                                zoneData.powerZones.some((z) => z.timeInZoneMs > 0) ||\n                                zoneData.hrZones.some((z) => z.timeInZoneMs > 0)\n                            ) {\n                                exportData.zoneDistribution = {\n                                    power: zoneData.powerZones.map((z) => ({\n                                        zone: z.zone,\n                                        name: z.name,\n                                        timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                                    })),\n                                    hr: zoneData.hrZones.map((z) => ({\n                                        zone: z.zone,\n                                        name: z.name,\n                                        timeSeconds: Math.round(z.timeInZoneMs / 1000),\n                                    })),\n                                };\n                            }\n                        }\n\n                        const jsonStr = JSON.stringify(exportData, null, 2);\n                        const blob = new Blob([jsonStr], { type: 'application/json' });\n                        downloadFile(blob, `${safeTitle}-${timestamp}.json`);\n                    }\n\n                    // Download CSV\n                    if (settings.exportCsv) {\n                        const csvString = getCsvString(measurementsState);\n                        const blob = new Blob([csvString], { type: 'text/csv' });\n                        downloadFile(blob, `${safeTitle}-${timestamp}.csv`);\n                    }\n\n                    // Download TCX\n                    if (settings.exportTcx) {\n                        const tcxString = getTcxString(measurementsState);\n                        const blob = new Blob([tcxString], { type: 'application/vnd.garmin.tcx+xml' });\n                        downloadFile(blob, `${safeTitle}-${timestamp}.tcx`);\n                    }\n\n                    // Download FIT (if enabled or default?) - let's add it if settings allow or default\n                    // Assuming FIT is better, let's include it if settings don't explicitly disable it\n                    // For now, adhere to existing logical flow but consider asking settings\n                    try {\n                        // Pass undefined for sport unless we have it in metadata or settings\n                        const fitData = getFitData(measurementsState, undefined);\n                        if (fitData) {\n                            const fitBlob = new Blob([fitData as unknown as BlobPart], {\n                                type: 'application/octet-stream',\n                            });\n                            downloadFile(fitBlob, `${safeTitle}-${timestamp}.fit`);\n                        }\n                    } catch (e) {\n                        // ignore\n                    }\n\n                    announce('Workout files downloaded', 'assertive');\n                } else {\n                    // Upload to Strava\n                    stravaService.handleUpload(measurementsState, metadata || undefined);\n                }\n            });\n        } catch (error) {\n            console.error('Export failed:', error);\n            showNotification('Failed to export data', 'error');\n        }\n    });\n};\n\n/**\n * Parameters for workout summary initialization\n */\ninterface InitWorkoutSummaryParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    zoneState?: ZoneState;\n}\n\n/** Module-level storage for collected workout metadata */\nlet collectedMetadata: WorkoutMetadata | null = null;\n\n/**\n * Get the collected workout metadata (for use in exports)\n */\nexport function getWorkoutMetadata(): WorkoutMetadata | null {\n    return collectedMetadata;\n}\n\n/**\n * Clear the collected workout metadata\n */\nexport function clearWorkoutMetadata(): void {\n    collectedMetadata = null;\n}\n\n/**\n * Initialize the post-workout summary modal.\n *\n * Listens for the 'workoutComplete' event and shows a summary modal\n * with workout statistics and export options.\n *\n * @param params - Object containing state objects\n */\nexport const initWorkoutSummaryModal = ({\n    measurementsState,\n    timeState,\n    zoneState,\n}: InitWorkoutSummaryParams): void => {\n    document.addEventListener('workoutComplete', async (event) => {\n        const detail = (event as CustomEvent).detail;\n\n        // Only show summary if we have data\n        const hasData =\n            measurementsState.power.length > 0 ||\n            measurementsState.heartrate.length > 0 ||\n            measurementsState.cadence.length > 0;\n\n        if (!hasData && !detail.startTime) {\n            return;\n        }\n\n        const settings = settingsStore.getAll();\n        const summary = calculateWorkoutSummary(\n            detail.startTime || timeState.startTime || Date.now(),\n            detail.endTime || timeState.endTime || Date.now(),\n            measurementsState,\n            zoneState,\n            settings.weight\n        );\n\n        // Check for Personal Records\n        let newRecords: string[] = [];\n        try {\n            const stored = await getCompletedWorkouts();\n            const workouts = stored.map(storedToWorkout);\n            const tracker = new PersonalRecordTracker(workouts);\n            newRecords = tracker.checkNewRecords(summary);\n\n            if (newRecords.length > 0) {\n                announce(`Congratulations! You set ${newRecords.length} new personal records!`, 'assertive');\n            }\n        } catch (e) {\n            console.warn('Failed to check for PRs:', e);\n        }\n\n        await showWorkoutSummary(\n            summary,\n            {\n                onExport: async () => {\n                    // Collect metadata if settings allow\n                    if (shouldShowMetadataModal()) {\n                        collectedMetadata = await showWorkoutMetadataModal(detail.startTime || timeState.startTime);\n                    } else {\n                        // Use default metadata if prompts are disabled\n                        const { generateDefaultTitle } = await import('./workoutMetadataModal.js');\n                        collectedMetadata = {\n                            title: generateDefaultTitle(detail.startTime || timeState.startTime),\n                        };\n                    }\n\n                    try {\n                        // Archive to IndexedDB\n                        await archiveWorkout();\n                        announce('Workout saved to local history', 'polite');\n\n                        // Auto-upload to Intervals.icu\n                        const settings = getSettings();\n                        if (settings.intervals && settings.intervals.enabled && settings.intervals.autoUpload) {\n                            try {\n                                const metadata = getWorkoutMetadata();\n                                const safeTitle = metadata?.title\n                                    ? metadata.title\n                                        .replace(/[^a-z0-9]+/gi, '-')\n                                        .substring(0, 30)\n                                        .toLowerCase()\n                                    : 'workout';\n                                const timestamp = getExportTimestamp();\n\n                                // Don't await the upload so we don't block the UI reset?\n                                // Or better: await it so user sees notification before reset?\n                                // But resetWorkoutState clears data. we passed measurementsState to service?\n                                // The service generates fitData immediately.\n                                // Let's await to be safe, or start it before reset.\n                                await IntervalsService.uploadWorkout(\n                                    measurementsState,\n                                    `${safeTitle}-${timestamp}.fit`\n                                );\n                            } catch (e) {\n                                console.error('Intervals auto-upload failed', e);\n                            }\n                        }\n                    } catch (err) {\n                        console.error('Failed to save to local history', err);\n                        announce('Failed to save to local history', 'assertive');\n                    }\n\n                    // Trigger the export button click\n                    const exportButton = document.getElementById('exportData');\n                    exportButton?.click();\n\n                    // Reset state after export\n                    resetWorkoutState(measurementsState, timeState);\n                    clearWorkoutMetadata();\n                },\n                onFinish: async () => {\n                    try {\n                        // Archive to IndexedDB\n                        await archiveWorkout();\n                        announce('Workout saved to local history', 'polite');\n\n                        // Reset state\n                        resetWorkoutState(measurementsState, timeState);\n                        clearWorkoutMetadata();\n                    } catch (err) {\n                        console.error('Failed to save to local history', err);\n                        announce('Failed to save to local history', 'assertive');\n                    }\n                },\n                onDiscard: () => {\n                    resetWorkoutState(measurementsState, timeState);\n                    clearWorkoutMetadata();\n                    announce('Workout discarded', 'polite');\n                },\n                onKeepRecording: () => {\n                    // Resume the workout\n                    const resumeButton = document.getElementById('resumeButton') as HTMLButtonElement | null;\n                    resumeButton?.click();\n                },\n            },\n            newRecords\n        );\n    });\n};\n","/**\n * Menu Interactions\n *\n * Provides enhanced keyboard navigation and click-outside-to-close\n * functionality for the main navigation menu.\n *\n * @module menuInteractions\n */\n\n/**\n * Initialize menu keyboard navigation and click-outside behavior.\n *\n * Features:\n * - Arrow key navigation (Up/Down)\n * - Escape key to close menu\n * - Click outside to close menu\n * - Focus management\n */\nexport function initMenuInteractions(): void {\n    const menu = document.getElementById('mainMenu') as HTMLDetailsElement | null;\n    const summary = menu?.querySelector('summary');\n    const controls = document.getElementById('controls');\n\n    if (!menu || !summary || !controls) {\n        return;\n    }\n\n    // Get all focusable menu items\n    const getFocusableItems = (): HTMLElement[] => {\n        return Array.from(\n            controls.querySelectorAll<HTMLElement>(\n                'button.menu-btn, .menu-toggle-container'\n            )\n        );\n    };\n\n    // Handle keyboard navigation within the menu\n    const handleKeyDown = (event: KeyboardEvent): void => {\n        if (!menu.open) return;\n\n        const focusableItems = getFocusableItems();\n        const currentIndex = focusableItems.findIndex(\n            (item) => item === document.activeElement || item.contains(document.activeElement as Node)\n        );\n\n        switch (event.key) {\n            case 'Escape':\n                event.preventDefault();\n                closeMenu();\n                summary.focus();\n                break;\n\n            case 'ArrowDown':\n                event.preventDefault();\n                if (currentIndex < focusableItems.length - 1) {\n                    focusableItems[currentIndex + 1].focus();\n                } else {\n                    // Wrap to first item\n                    focusableItems[0]?.focus();\n                }\n                break;\n\n            case 'ArrowUp':\n                event.preventDefault();\n                if (currentIndex > 0) {\n                    focusableItems[currentIndex - 1].focus();\n                } else {\n                    // Wrap to last item\n                    focusableItems[focusableItems.length - 1]?.focus();\n                }\n                break;\n\n            case 'Home':\n                event.preventDefault();\n                focusableItems[0]?.focus();\n                break;\n\n            case 'End':\n                event.preventDefault();\n                focusableItems[focusableItems.length - 1]?.focus();\n                break;\n\n            case 'Tab':\n                // Allow tab but trap within menu\n                if (event.shiftKey && currentIndex === 0) {\n                    event.preventDefault();\n                    focusableItems[focusableItems.length - 1]?.focus();\n                } else if (!event.shiftKey && currentIndex === focusableItems.length - 1) {\n                    event.preventDefault();\n                    focusableItems[0]?.focus();\n                }\n                break;\n        }\n    };\n\n    // Close the menu\n    const closeMenu = (): void => {\n        menu.open = false;\n        summary.setAttribute('aria-expanded', 'false');\n    };\n\n    // Open the menu\n    const openMenu = (): void => {\n        menu.open = true;\n        summary.setAttribute('aria-expanded', 'true');\n        // Focus first menu item after a short delay for animation\n        requestAnimationFrame(() => {\n            const focusableItems = getFocusableItems();\n            focusableItems[0]?.focus();\n        });\n    };\n\n    // Handle click outside to close\n    const handleClickOutside = (event: MouseEvent): void => {\n        if (!menu.open) return;\n\n        const target = event.target as Node;\n        if (!menu.contains(target)) {\n            closeMenu();\n        }\n    };\n\n    // Update aria-expanded when details toggles\n    const handleToggle = (): void => {\n        summary.setAttribute('aria-expanded', menu.open ? 'true' : 'false');\n\n        if (menu.open) {\n            // Add click outside listener\n            // Use setTimeout to prevent immediate close from the click that opened it\n            setTimeout(() => {\n                document.addEventListener('click', handleClickOutside);\n            }, 0);\n\n            // Focus first item\n            requestAnimationFrame(() => {\n                const focusableItems = getFocusableItems();\n                focusableItems[0]?.focus();\n            });\n        } else {\n            document.removeEventListener('click', handleClickOutside);\n        }\n    };\n\n    // Handle keyboard on summary element\n    const handleSummaryKeyDown = (event: KeyboardEvent): void => {\n        if (event.key === 'Enter' || event.key === ' ') {\n            // Let the default behavior handle opening\n            return;\n        }\n\n        if (event.key === 'ArrowDown' && !menu.open) {\n            event.preventDefault();\n            openMenu();\n        }\n    };\n\n    // Close menu when a menu item is clicked\n    const handleMenuItemClick = (event: Event): void => {\n        const target = event.target as HTMLElement;\n\n        // Don't close for toggle switches (let them toggle)\n        if (target.closest('.menu-toggle-container')) {\n            return;\n        }\n\n        // Close menu for regular buttons\n        if (target.closest('.menu-btn')) {\n            // Small delay to allow the button's action to process\n            setTimeout(() => {\n                closeMenu();\n            }, 50);\n        }\n    };\n\n    // Attach event listeners\n    menu.addEventListener('toggle', handleToggle);\n    menu.addEventListener('keydown', handleKeyDown);\n    summary.addEventListener('keydown', handleSummaryKeyDown);\n    controls.addEventListener('click', handleMenuItemClick);\n\n    // Handle toggle container keyboard activation\n    const toggleContainers = controls.querySelectorAll<HTMLElement>('.menu-toggle-container');\n    toggleContainers.forEach((container) => {\n        container.addEventListener('keydown', (event: KeyboardEvent) => {\n            if (event.key === 'Enter' || event.key === ' ') {\n                event.preventDefault();\n                const checkbox = container.querySelector('input[type=\"checkbox\"]') as HTMLInputElement | null;\n                if (checkbox) {\n                    checkbox.checked = !checkbox.checked;\n                    checkbox.dispatchEvent(new Event('change', { bubbles: true }));\n\n                    // Update aria-checked\n                    container.setAttribute('aria-checked', checkbox.checked ? 'true' : 'false');\n                }\n            }\n        });\n\n        // Sync aria-checked with checkbox state\n        const checkbox = container.querySelector('input[type=\"checkbox\"]') as HTMLInputElement | null;\n        if (checkbox) {\n            checkbox.addEventListener('change', () => {\n                container.setAttribute('aria-checked', checkbox.checked ? 'true' : 'false');\n            });\n        }\n    });\n\n    // Initial aria-expanded state\n    summary.setAttribute('aria-expanded', 'false');\n}\n\n/**\n * Initialize all menu-related functionality.\n * Call this from the main initialization.\n */\nexport function initMenu(): void {\n    initMenuInteractions();\n}\n","/**\n * Zone State Management\n *\n * Tracks time spent in each power and heart rate zone during a workout.\n * Integrates with SettingsStore for zone thresholds.\n *\n * @module ZoneState\n */\n\nimport { settingsStore } from './state/SettingsStore.js';\nimport type { ZoneDefinition } from './types/zones.js';\n\n/**\n * Zone information with time tracking\n */\nexport interface ZoneInfo extends ZoneDefinition {\n    zone: number;\n    timeInZoneMs: number;\n}\n\n/**\n * Current zone status for real-time display\n */\nexport interface CurrentZoneStatus {\n    zone: number;\n    name: string;\n    percentInZone: number; // 0-100, position within zone range\n    color: string;\n}\n\n/**\n * Zone distribution data for summary\n */\nexport interface ZoneDistribution {\n    zones: ZoneInfo[];\n    totalTimeMs: number;\n}\n\n/**\n * State change callback type\n */\nexport type ZoneStateChangeCallback = () => void;\n\n/**\n * Zone State class for tracking time in zones\n */\nexport class ZoneState {\n    private _powerZones: ZoneInfo[] = [];\n    private _hrZones: ZoneInfo[] = [];\n    private _lastPowerZone: number | null = null;\n    private _lastHrZone: number | null = null;\n    private _lastUpdateTime: number | null = null;\n    private _ftp: number = 200;\n    private _maxHr: number = 190;\n    private _currentPowerZone: CurrentZoneStatus | null = null;\n    private _currentHrZone: CurrentZoneStatus | null = null;\n    private _onChangeCallbacks: ZoneStateChangeCallback[] = [];\n    private _unsubscribeSettings: (() => void) | null = null;\n\n    constructor() {\n        this.init();\n    }\n\n    private init() {\n        // Initial load\n        this.updateFromSettings();\n\n        // Subscribe to changes\n        this._unsubscribeSettings = settingsStore.onChange(() => {\n            this.updateFromSettings();\n        });\n    }\n\n    /**\n     * Update zones from settings store\n     * Note: This resets accumulation if zones change structure\n     */\n    public updateFromSettings(): void {\n        const settings = settingsStore.getAll();\n\n        // Check if FTP or MaxHR changed significantly or if zone definitions changed\n        // For simplicity, we re-calculate absolute zones.\n        // We TRY to preserve timeInZone if the number of zones matches, but strictly speaking\n        // changing FTP changes the bin meaning, so resetting is theoretically more correct for a \"new\" distribution.\n        // However, users might adjust FTP slightly and not want to lose data.\n        // Let's preserve times if array length matches for now, ensuring smooth UX.\n\n        this._ftp = settings.ftp;\n        this._maxHr = settings.maxHeartrate;\n\n        const newPowerZones = settings.powerZones.map((z, i) => ({\n            ...z,\n            zone: i + 1,\n            // Convert percentage to absolute watts\n            min: Math.round((z.min * this._ftp) / 100),\n            max: z.max >= 1000 ? 9999 : Math.round((z.max * this._ftp) / 100), // Handle open-ended\n            timeInZoneMs:\n                this._powerZones[i] && this._powerZones[i].name === z.name ? this._powerZones[i].timeInZoneMs : 0,\n        }));\n\n        const newHrZones = settings.heartrateZones.map((z, i) => ({\n            ...z,\n            zone: i + 1,\n            // Convert percentage to absolute bpm\n            min: Math.round((z.min * this._maxHr) / 100),\n            max:\n                z.max >= 1000 || i === settings.heartrateZones.length - 1\n                    ? this._maxHr\n                    : Math.round((z.max * this._maxHr) / 100),\n            // Note: settings.heartrateZones[last].max usually is 100% or close.\n            // We clamp max of last zone to maxHr if it's close to 100%\n            timeInZoneMs: this._hrZones[i] && this._hrZones[i].name === z.name ? this._hrZones[i].timeInZoneMs : 0,\n        }));\n\n        // Ensure last HR zone max is MaxHR just to be safe if definition is exactly 100%\n        if (newHrZones.length > 0) {\n            newHrZones[newHrZones.length - 1].max = Math.max(newHrZones[newHrZones.length - 1].max, this._maxHr);\n        }\n\n        this._powerZones = newPowerZones;\n        this._hrZones = newHrZones;\n\n        this._notifyChange();\n    }\n\n    /**\n     * Load profile and update zones (Compatibility alias)\n     */\n    loadProfile(): void {\n        this.updateFromSettings();\n    }\n\n    /**\n     * Register a callback for state changes\n     */\n    onChange(callback: ZoneStateChangeCallback): void {\n        this._onChangeCallbacks.push(callback);\n    }\n\n    /**\n     * Remove a state change callback\n     */\n    offChange(callback: ZoneStateChangeCallback): void {\n        const index = this._onChangeCallbacks.indexOf(callback);\n        if (index > -1) {\n            this._onChangeCallbacks.splice(index, 1);\n        }\n    }\n\n    /**\n     * Notify listeners of state change\n     */\n    private _notifyChange(): void {\n        for (const callback of this._onChangeCallbacks) {\n            try {\n                callback();\n            } catch (e) {\n                console.error('Zone state change callback error:', e);\n            }\n        }\n    }\n\n    /**\n     * Update power value and track zone time\n     */\n    updatePower(power: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._powerZones.length) return null;\n\n        // Find zone\n        let zoneIndex = -1;\n        for (let i = 0; i < this._powerZones.length; i++) {\n            if (power >= this._powerZones[i].min && power < this._powerZones[i].max) {\n                zoneIndex = i;\n                break;\n            }\n        }\n\n        // Handle out of bounds (above max)\n        if (zoneIndex === -1 && power >= this._powerZones[this._powerZones.length - 1].max) {\n            zoneIndex = this._powerZones.length - 1;\n        }\n\n        if (zoneIndex === -1) return null;\n\n        const currentZone = zoneIndex + 1;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastPowerZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._powerZones[this._lastPowerZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                // Only count if less than 5 seconds (avoid large gaps)\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastPowerZone = currentZone;\n        this._lastUpdateTime = timestamp;\n\n        // Calculate position within zone\n        const zoneData = this._powerZones[zoneIndex];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0 ? Math.min(100, Math.max(0, ((power - zoneData.min) / range) * 100)) : 50;\n\n        this._currentPowerZone = {\n            zone: currentZone,\n            name: zoneData.name,\n            percentInZone,\n            color: zoneData.color,\n        };\n\n        this._notifyChange();\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Update heart rate value and track zone time\n     */\n    updateHeartRate(hr: number, timestamp: number = Date.now()): CurrentZoneStatus | null {\n        if (!this._hrZones.length) return null;\n\n        let zoneIndex = -1;\n        for (let i = 0; i < this._hrZones.length; i++) {\n            if (hr >= this._hrZones[i].min && hr <= this._hrZones[i].max) {\n                zoneIndex = i;\n                break;\n            }\n        }\n\n        // Handle out of bounds\n        if (zoneIndex === -1 && hr > this._hrZones[this._hrZones.length - 1].max) {\n            zoneIndex = this._hrZones.length - 1;\n        }\n\n        if (zoneIndex === -1) return null;\n\n        const currentZone = zoneIndex + 1;\n\n        // Track time in zone\n        if (this._lastUpdateTime !== null && this._lastHrZone !== null) {\n            const timeDelta = timestamp - this._lastUpdateTime;\n            const zoneData = this._hrZones[this._lastHrZone - 1];\n            if (zoneData && timeDelta > 0 && timeDelta < 5000) {\n                zoneData.timeInZoneMs += timeDelta;\n            }\n        }\n\n        this._lastHrZone = currentZone;\n        // Only update if no power update occurred (prevent double counting)\n        if (this._lastUpdateTime === null || timestamp - this._lastUpdateTime > 50) {\n            this._lastUpdateTime = timestamp;\n        }\n\n        // Calculate position within zone\n        const zoneData = this._hrZones[zoneIndex];\n        const range = zoneData.max - zoneData.min;\n        const percentInZone = range > 0 ? Math.min(100, Math.max(0, ((hr - zoneData.min) / range) * 100)) : 50;\n\n        this._currentHrZone = {\n            zone: currentZone,\n            name: zoneData.name,\n            percentInZone,\n            color: zoneData.color,\n        };\n\n        this._notifyChange();\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get current power zone status\n     */\n    getCurrentPowerZone(): CurrentZoneStatus | null {\n        return this._currentPowerZone;\n    }\n\n    /**\n     * Get current HR zone status\n     */\n    getCurrentHrZone(): CurrentZoneStatus | null {\n        return this._currentHrZone;\n    }\n\n    /**\n     * Get power zone distribution for summary\n     */\n    getPowerZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._powerZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._powerZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Get HR zone distribution for summary\n     */\n    getHrZoneDistribution(): ZoneDistribution {\n        const totalTimeMs = this._hrZones.reduce((sum, z) => sum + z.timeInZoneMs, 0);\n        return {\n            zones: [...this._hrZones],\n            totalTimeMs,\n        };\n    }\n\n    /**\n     * Check if power zones are configured\n     */\n    hasPowerZones(): boolean {\n        return this._ftp !== null && this._ftp > 0;\n    }\n\n    /**\n     * Check if HR zones are configured\n     */\n    hasHrZones(): boolean {\n        return this._maxHr !== null && this._maxHr > 0;\n    }\n\n    /**\n     * Get FTP value\n     */\n    getFtp(): number | null {\n        return this._ftp;\n    }\n\n    /**\n     * Get Max HR value\n     */\n    getMaxHr(): number | null {\n        return this._maxHr;\n    }\n\n    /**\n     * Reset all zone tracking data\n     */\n    reset(): void {\n        this._powerZones.forEach((z) => (z.timeInZoneMs = 0));\n        this._hrZones.forEach((z) => (z.timeInZoneMs = 0));\n        this._lastPowerZone = null;\n        this._lastHrZone = null;\n        this._lastUpdateTime = null;\n        this._currentPowerZone = null;\n        this._currentHrZone = null;\n        this._notifyChange();\n    }\n\n    /**\n     * Dispose resources\n     */\n    dispose(): void {\n        if (this._unsubscribeSettings) {\n            this._unsubscribeSettings();\n            this._unsubscribeSettings = null;\n        }\n    }\n\n    /**\n     * Export zone data as JSON (for exports/summary)\n     */\n    toJSON(): {\n        powerZones: ZoneInfo[];\n        hrZones: ZoneInfo[];\n        ftp: number | null;\n        maxHr: number | null;\n    } {\n        return {\n            powerZones: [...this._powerZones],\n            hrZones: [...this._hrZones],\n            ftp: this._ftp,\n            maxHr: this._maxHr,\n        };\n    }\n}\n","/**\n * Live Chart Component\n *\n * A Web Component for displaying real-time rolling charts of workout metrics.\n * Uses SVG for rendering and requestAnimationFrame for smooth 60fps updates.\n * Optimized for mobile performance with minimal DOM operations.\n *\n * @example\n *\n *\n * @module LiveChart\n */\n\nimport { BaseComponent } from './base/BaseComponent.js';\nimport type { ZoneInfo } from '../zone-state.js';\n\n/**\n * Data point for the chart\n */\ninterface DataPoint {\n    timestamp: number;\n    value: number;\n}\n\n/**\n * Chart configuration by type\n */\nconst CHART_CONFIG: Record<\n    string,\n    { color: string; gradientStart: string; gradientEnd: string; label: string; unit: string; defaultMax: number }\n> = {\n    power: {\n        color: '#f97316',\n        gradientStart: 'rgba(249, 115, 22, 0.4)',\n        gradientEnd: 'rgba(249, 115, 22, 0.05)',\n        label: 'Power',\n        unit: 'W',\n        defaultMax: 400,\n    },\n    heartrate: {\n        color: '#ef4444',\n        gradientStart: 'rgba(239, 68, 68, 0.4)',\n        gradientEnd: 'rgba(239, 68, 68, 0.05)',\n        label: 'Heart Rate',\n        unit: 'bpm',\n        defaultMax: 200,\n    },\n};\n\n/**\n * Live Chart Web Component\n */\nexport class LiveChart extends BaseComponent {\n    private _data: DataPoint[] = [];\n    private _animationId: number | null = null;\n    private _lastRenderTime = 0;\n    private _isVisible = true;\n    private _duration = 60; // seconds\n    private _maxValue: number;\n    private _type: string;\n    private _svgPath: SVGPathElement | null = null;\n    private _svgArea: SVGPathElement | null = null;\n    private _currentValueEl: HTMLElement | null = null;\n    private _avgValueEl: HTMLElement | null = null;\n    private _zones: ZoneInfo[] = [];\n\n    static get observedAttributes(): string[] {\n        return ['type', 'duration', 'max-value', 'hidden'];\n    }\n\n    constructor() {\n        super();\n        this._type = 'power';\n        this._maxValue = CHART_CONFIG.power.defaultMax;\n    }\n\n    protected getStyles(): string {\n        return `\n            :host {\n                display: block;\n                width: 100%;\n                background: var(--color-bg-secondary, #f6f8fa);\n                border-radius: 8px;\n                overflow: hidden;\n                contain: layout style paint;\n            }\n\n            :host([hidden]) {\n                display: none;\n            }\n\n            .chart-container {\n                position: relative;\n                width: 100%;\n                height: 120px;\n                padding: 8px;\n            }\n\n            .chart-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 0 4px 4px 4px;\n                font-size: 11px;\n                color: var(--color-text-secondary, #656d76);\n            }\n\n            .chart-label {\n                font-weight: 600;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .chart-values {\n                display: flex;\n                gap: 12px;\n            }\n\n            .chart-value {\n                display: flex;\n                align-items: baseline;\n                gap: 2px;\n            }\n\n            .chart-value-number {\n                font-size: 14px;\n                font-weight: 700;\n                color: var(--chart-color, #f97316);\n            }\n\n            .chart-value-label {\n                font-size: 10px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            .chart-svg-container {\n                position: relative;\n                width: 100%;\n                height: 80px;\n            }\n\n            svg {\n                width: 100%;\n                height: 100%;\n                display: block;\n            }\n\n            .chart-line {\n                fill: none;\n                stroke: var(--chart-color, #f97316);\n                stroke-width: 2;\n                stroke-linecap: round;\n                stroke-linejoin: round;\n                vector-effect: non-scaling-stroke;\n            }\n\n            .chart-area {\n                fill: url(#chartGradient-${this._type});\n                opacity: 0.8;\n            }\n\n            .chart-grid-line {\n                stroke: var(--color-border, #d0d7de);\n                stroke-width: 1;\n                stroke-dasharray: 4 4;\n                opacity: 0.5;\n            }\n\n            .chart-axis-label {\n                font-size: 9px;\n                fill: var(--color-text-muted, #8b949e);\n            }\n\n            .no-data-message {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 12px;\n                color: var(--color-text-muted, #8b949e);\n            }\n\n            /* Reduced motion */\n            @media (prefers-reduced-motion: reduce) {\n                .chart-line,\n                .chart-area {\n                    transition: none;\n                }\n            }\n        `;\n    }\n\n    protected getTemplate(): string {\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n\n        return `\n            <div class=\"chart-container\">\n                <div class=\"chart-header\">\n                    <span class=\"chart-label\">\n                        <span>${config.label}</span>\n                        <span style=\"font-weight: normal; font-size: 10px;\">(${this._duration}s)</span>\n                    </span>\n                    <div class=\"chart-values\">\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"currentValue\">--</span>\n                            <span class=\"chart-value-label\">${config.unit}</span>\n                        </div>\n                        <div class=\"chart-value\">\n                            <span class=\"chart-value-number\" id=\"avgValue\" style=\"opacity: 0.7;\">--</span>\n                            <span class=\"chart-value-label\">avg</span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"chart-svg-container\">\n                    <svg viewBox=\"0 0 300 80\" preserveAspectRatio=\"none\" aria-hidden=\"true\">\n                        <defs>\n                            <linearGradient id=\"chartGradient-${this._type}\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                                <stop offset=\"0%\" stop-color=\"${config.gradientStart}\" />\n                                <stop offset=\"100%\" stop-color=\"${config.gradientEnd}\" />\n                            </linearGradient>\n                            <linearGradient id=\"strokeGradient-${this._type}\" gradientUnits=\"userSpaceOnUse\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"80\">\n                                <!-- Stops will be injected dynamically -->\n                                <stop offset=\"0%\" stop-color=\"${config.color}\" />\n                                <stop offset=\"100%\" stop-color=\"${config.color}\" />\n                            </linearGradient>\n                        </defs>\n                        <!-- Grid lines -->\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"20\" x2=\"300\" y2=\"20\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"40\" x2=\"300\" y2=\"40\" />\n                        <line class=\"chart-grid-line\" x1=\"0\" y1=\"60\" x2=\"300\" y2=\"60\" />\n                        <!-- Axis labels -->\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"18\">${this._maxValue}</text>\n                        <text class=\"chart-axis-label\" x=\"2\" y=\"78\">0</text>\n                        <!-- Chart paths -->\n                        <path class=\"chart-area\" id=\"chartArea\" d=\"M0,80 L300,80\" style=\"fill: url(#chartGradient-${this._type});\" />\n                        <path class=\"chart-line\" id=\"chartLine\" d=\"\" style=\"stroke: url(#strokeGradient-${this._type});\" />\n                    </svg>\n                    <div class=\"no-data-message\" id=\"noDataMessage\">Waiting for data...</div>\n                </div>\n            </div>\n        `;\n    }\n\n    protected onConnected(): void {\n        // Cache DOM references\n        this._svgPath = this.shadow.getElementById('chartLine') as SVGPathElement | null;\n        this._svgArea = this.shadow.getElementById('chartArea') as SVGPathElement | null;\n        this._currentValueEl = this.shadow.getElementById('currentValue');\n        this._avgValueEl = this.shadow.getElementById('avgValue');\n\n        // Set CSS variable for chart color\n        const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n        this.style.setProperty('--chart-color', config.color);\n\n        // Start animation loop\n        this.startAnimation();\n\n        // Listen for visibility changes to save battery\n        document.addEventListener('visibilitychange', this.handleVisibilityChange);\n\n        // Initial gradient update\n        this.updateZoneGradient();\n    }\n\n    protected onDisconnected(): void {\n        this.stopAnimation();\n        document.removeEventListener('visibilitychange', this.handleVisibilityChange);\n    }\n\n    protected onAttributeChanged(name: string, _oldValue: string | null, newValue: string | null): void {\n        switch (name) {\n            case 'type':\n                this._type = newValue || 'power';\n                this._maxValue = CHART_CONFIG[this._type]?.defaultMax || 400;\n                this.render();\n                this.onConnected(); // Re-cache DOM refs\n                break;\n            case 'duration':\n                this._duration = parseInt(newValue || '60', 10);\n                this.render();\n                break;\n            case 'max-value':\n                this._maxValue = parseInt(newValue || '400', 10);\n                this.render();\n                break;\n            case 'hidden':\n                this._isVisible = newValue === null;\n                if (this._isVisible) {\n                    this.startAnimation();\n                } else {\n                    this.stopAnimation();\n                }\n                break;\n        }\n    }\n\n    private handleVisibilityChange = (): void => {\n        if (document.hidden) {\n            this.stopAnimation();\n        } else if (this._isVisible) {\n            this.startAnimation();\n        }\n    };\n\n    /**\n     * Set zones for dynamic coloring\n     */\n    public setZones(zones: ZoneInfo[]): void {\n        this._zones = zones;\n        this.updateZoneGradient();\n    }\n\n    /**\n     * Update the stroke gradient based on zones and current max value\n     */\n    private updateZoneGradient(): void {\n        const gradient = this.shadow.getElementById(`strokeGradient-${this._type}`);\n        if (!gradient) return; // Not ready yet\n\n        if (this._zones.length === 0) {\n            // Restore default color\n            const config = CHART_CONFIG[this._type] || CHART_CONFIG.power;\n            gradient.innerHTML = `\n                <stop offset=\"0%\" stop-color=\"${config.color}\" />\n                <stop offset=\"100%\" stop-color=\"${config.color}\" />\n            `;\n            return;\n        }\n\n        // Clear existing stops\n        while (gradient.firstChild) {\n            gradient.removeChild(gradient.firstChild);\n        }\n\n        // Gradient logic:\n        // userSpaceOnUse: y1=0 (Top, MaxValue), y2=80 (Bottom, 0)\n        // Offset 0 (Top) -> Max Value\n        // Offset 1 (Bottom) -> 0 Value\n\n        // We iterate zones from High to Low (Top to Bottom) to add stops in order?\n        // Actually, SVG gradient stops should be ordered by offset (0 to 1).\n        // Offset 0 = Top = MaxValue.\n        // Offset 1 = Bottom = 0.\n\n        // Zones are usually ordered Low (Zone 1) to High (Zone N).\n        // Zone N (High): [Z_N_Min, Z_N_Max].\n        //   Top of Zone N corresponds to Min(Z_N_Max, MaxVal). Offset = (1 - val/MaxVal)\n        //   Bottom of Zone N is Z_N_Min. Offset = (1 - Min/MaxVal).\n\n        // Stops need to cover 0% to 100%.\n        // 0% (Top, MaxValue).\n        // If MaxValue > Highest Zone Max (Open ended zone): Color = Last Zone Color.\n\n        const stops: { offset: number; color: string }[] = [];\n\n        // Add start (0% - Top)\n        // Find which zone covers MaxValue\n        const topZone =\n            this._zones.find((z) => this._maxValue >= z.min && this._maxValue < z.max) ||\n            this._zones[this._zones.length - 1]; // Fallback to last zone\n\n        if (topZone) stops.push({ offset: 0, color: topZone.color });\n\n        // For each zone boundary (between zones)\n        // Boundaries are values where color changes.\n        // Iterate zones High to Low.\n        // Boundary = Zone[i].min.\n        // It's also Zone[i-1].max.\n        // At this boundary, we transition from Zone i color to Zone i-1 color.\n        // Offset = 1 - (Boundary / MaxValue).\n\n        for (let i = this._zones.length - 1; i >= 0; i--) {\n            const z = this._zones[i];\n            const boundaryVal = z.min;\n            if (boundaryVal <= 0) continue; // Bottom is handled by 100%\n            if (boundaryVal >= this._maxValue) continue; // Above graph\n\n            const offset = 1 - boundaryVal / this._maxValue;\n\n            // Add Sharp Transition\n            // Stop at offset-epsilon with Zone i color\n            // Stop at offset+epsilon with Zone i-1 color (if exists)\n\n            stops.push({ offset: offset, color: z.color });\n\n            if (i > 0) {\n                stops.push({ offset: offset, color: this._zones[i - 1].color });\n            } else {\n                // Below lowest zone min? Should be 0.\n                stops.push({ offset: offset, color: z.color });\n            }\n        }\n\n        // Add end (100% - Bottom)\n        const bottomZone = this._zones[0];\n        if (bottomZone) stops.push({ offset: 1, color: bottomZone.color });\n\n        // Generate SVG stops\n        stops.forEach((s) => {\n            const stop = document.createElementNS('http://www.w3.org/2000/svg', 'stop');\n            stop.setAttribute('offset', `${s.offset * 100}%`);\n            stop.setAttribute('stop-color', s.color);\n            gradient.appendChild(stop);\n        });\n    }\n\n    /**\n     * Add a data point to the chart\n     */\n    public addDataPoint(value: number, timestamp: number = Date.now()): void {\n        this._data.push({ timestamp, value });\n\n        // Remove old data points (keep duration + 5s buffer)\n        const cutoffTime = timestamp - (this._duration + 5) * 1000;\n        while (this._data.length > 0 && this._data[0].timestamp < cutoffTime) {\n            this._data.shift();\n        }\n\n        // Auto-adjust max value if needed\n        let maxChanged = false;\n        if (value > this._maxValue * 0.9) {\n            this._maxValue = Math.ceil((value * 1.2) / 50) * 50; // Round to nearest 50\n            maxChanged = true;\n        }\n\n        // Also ease down max value if data is consistently low? (optional enhancement, skip for now)\n\n        if (maxChanged) {\n            // Need to update gradient because stops depend on maxValue\n            this.updateZoneGradient();\n        }\n    }\n\n    /**\n     * Clear all data points\n     */\n    public clear(): void {\n        this._data = [];\n        this.renderChart();\n    }\n\n    /**\n     * Start the animation loop\n     */\n    private startAnimation(): void {\n        if (this._animationId !== null) return;\n\n        const animate = (time: number): void => {\n            // Throttle to ~30fps for better performance\n            if (time - this._lastRenderTime >= 33) {\n                this.renderChart();\n                this._lastRenderTime = time;\n            }\n            this._animationId = requestAnimationFrame(animate);\n        };\n\n        this._animationId = requestAnimationFrame(animate);\n    }\n\n    /**\n     * Stop the animation loop\n     */\n    private stopAnimation(): void {\n        if (this._animationId !== null) {\n            cancelAnimationFrame(this._animationId);\n            this._animationId = null;\n        }\n    }\n\n    /**\n     * Render the chart paths\n     */\n    private renderChart(): void {\n        if (!this._svgPath || !this._svgArea) return;\n\n        const now = Date.now();\n        const startTime = now - this._duration * 1000;\n\n        // Filter data to visible range\n        const visibleData = this._data.filter((d) => d.timestamp >= startTime);\n\n        // Update no-data message\n        const noDataMsg = this.shadow.getElementById('noDataMessage');\n        if (noDataMsg) {\n            noDataMsg.style.display = visibleData.length === 0 ? 'block' : 'none';\n        }\n\n        if (visibleData.length === 0) {\n            this._svgPath.setAttribute('d', '');\n            this._svgArea.setAttribute('d', 'M0,80 L300,80');\n            return;\n        }\n\n        // Calculate path\n        const width = 300;\n        const height = 80;\n        const points: string[] = [];\n        const areaPoints: string[] = [];\n\n        visibleData.forEach((point) => {\n            const x = ((point.timestamp - startTime) / (this._duration * 1000)) * width;\n            const y = height - (Math.min(point.value, this._maxValue) / this._maxValue) * height;\n            points.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n            areaPoints.push(`${x.toFixed(1)},${y.toFixed(1)}`);\n        });\n\n        // Build path strings\n        if (points.length > 0) {\n            const linePath = 'M' + points.join(' L');\n            this._svgPath.setAttribute('d', linePath);\n\n            // Area path: line + close to bottom\n            const firstX = ((visibleData[0].timestamp - startTime) / (this._duration * 1000)) * width;\n            const lastX =\n                ((visibleData[visibleData.length - 1].timestamp - startTime) / (this._duration * 1000)) * width;\n            const areaPath =\n                `M${firstX.toFixed(1)},${height} L` + areaPoints.join(' L') + ` L${lastX.toFixed(1)},${height} Z`;\n            this._svgArea.setAttribute('d', areaPath);\n        }\n\n        // Update current and average values\n        if (this._currentValueEl && visibleData.length > 0) {\n            const currentValue = visibleData[visibleData.length - 1].value;\n            this._currentValueEl.textContent = Math.round(currentValue).toString();\n        }\n\n        if (this._avgValueEl && visibleData.length > 0) {\n            const avg = visibleData.reduce((sum, p) => sum + p.value, 0) / visibleData.length;\n            this._avgValueEl.textContent = Math.round(avg).toString();\n        }\n    }\n\n    /**\n     * Get current data for debugging/testing\n     */\n    public getData(): DataPoint[] {\n        return [...this._data];\n    }\n}\n\n// Register the custom element\nif (!customElements.get('bpt-live-chart')) {\n    customElements.define('bpt-live-chart', LiveChart);\n}\n\n// Export for type-safe usage\ndeclare global {\n    interface HTMLElementTagNameMap {\n        'bpt-live-chart': LiveChart;\n    }\n}\n","/**\n * Metrics Display Initialization\n *\n * Sets up zone tracking and live charts for workout metrics.\n * The actual data field display is handled by DataFieldsManager.\n *\n * @module initMetricsDisplay\n */\n\nimport type { MeasurementsState } from './measurements-state.js';\nimport { ZoneState } from './zone-state.js';\nimport { settingsStore } from './state/SettingsStore.js';\nimport './components/LiveChart.js'; // Side effect: Register web component\nimport type { LiveChart } from './components/LiveChart.js';\nimport { voiceFeedback } from './services/VoiceFeedback.js';\n\n/**\n * Parameters for metrics display initialization\n */\ninterface InitMetricsDisplayParams {\n    measurementsState: MeasurementsState;\n}\n\n/** Maximum age of measurement data before showing as disconnected (ms) */\nconst DATA_TIMEOUT_MS = 5000;\n\n/** Update interval for display refresh (ms) */\nconst UPDATE_INTERVAL_MS = 100;\n\n/** Zone state instance - exported for use in summary/exports */\nexport let zoneState: ZoneState;\n\n/**\n * Initialize live charts for power and heart rate\n */\nfunction initLiveCharts(): { powerChart: LiveChart | null; hrChart: LiveChart | null } {\n    let powerChart = document.getElementById('powerLiveChart') as LiveChart | null;\n    let hrChart = document.getElementById('hrLiveChart') as LiveChart | null;\n\n    // Create charts container if it doesn't exist\n    let chartsContainer = document.getElementById('liveChartsContainer');\n    if (!chartsContainer) {\n        const metricsSection = document.getElementById('yourMetrics');\n        if (metricsSection) {\n            chartsContainer = document.createElement('div');\n            chartsContainer.id = 'liveChartsContainer';\n            chartsContainer.className = 'live-charts-container';\n            chartsContainer.style.display = 'none'; // Hidden by default\n\n            // Insert after data fields carousel\n            const dataFieldsCarousel = document.getElementById('dataFieldsCarousel');\n            if (dataFieldsCarousel && dataFieldsCarousel.nextSibling) {\n                metricsSection.insertBefore(chartsContainer, dataFieldsCarousel.nextSibling);\n            } else {\n                metricsSection.appendChild(chartsContainer);\n            }\n        }\n    }\n\n    if (chartsContainer) {\n        // Create power chart if it doesn't exist\n        if (!powerChart) {\n            powerChart = document.createElement('bpt-live-chart') as LiveChart;\n            powerChart.id = 'powerLiveChart';\n            powerChart.setAttribute('type', 'power');\n            powerChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(powerChart);\n        }\n\n        // Create HR chart if it doesn't exist\n        if (!hrChart) {\n            hrChart = document.createElement('bpt-live-chart') as LiveChart;\n            hrChart.id = 'hrLiveChart';\n            hrChart.setAttribute('type', 'heartrate');\n            hrChart.setAttribute('duration', '60');\n            chartsContainer.appendChild(hrChart);\n        }\n    }\n\n    return { powerChart, hrChart };\n}\n\n/**\n * Get or create the charts toggle button\n */\nfunction initChartsToggle(chartsVisible: boolean): HTMLButtonElement | null {\n    let toggleBtn = document.getElementById('toggleLiveCharts') as HTMLButtonElement | null;\n\n    if (!toggleBtn) {\n        const topBarControls = document.getElementById('topBarControls');\n        if (topBarControls) {\n            toggleBtn = document.createElement('button');\n            toggleBtn.id = 'toggleLiveCharts';\n            toggleBtn.className = 'workout-btn workout-btn-chart';\n            toggleBtn.setAttribute('aria-label', 'Toggle live charts');\n            toggleBtn.setAttribute('title', 'Toggle Charts');\n            toggleBtn.innerHTML = '';\n            toggleBtn.style.display = 'none'; // Hidden until workout starts\n\n            // Insert before workout controls\n            const workoutControls = document.querySelector('.workout-controls');\n            if (workoutControls) {\n                topBarControls.insertBefore(toggleBtn, workoutControls);\n            } else {\n                topBarControls.appendChild(toggleBtn);\n            }\n        }\n    }\n\n    if (toggleBtn) {\n        toggleBtn.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n    }\n\n    return toggleBtn;\n}\n\n/**\n * Initialize the metrics display update loop.\n *\n * Sets up zone tracking and live charts. The actual data field display\n * is handled by DataFieldsManager.\n *\n * @param params - Object containing state objects\n * @returns The ZoneState instance for external use\n */\nexport const initMetricsDisplay = ({ measurementsState }: InitMetricsDisplayParams): ZoneState => {\n    // Initialize zone state\n    zoneState = new ZoneState();\n\n    // Initialize live charts\n    const { powerChart, hrChart } = initLiveCharts();\n\n    // Setup chart zones and listen for changes\n    const updateChartZones = () => {\n        if (powerChart) {\n            powerChart.setZones(zoneState.getPowerZoneDistribution().zones);\n        }\n        if (hrChart) {\n            hrChart.setZones(zoneState.getHrZoneDistribution().zones);\n        }\n    };\n\n    // Initial setup\n    updateChartZones();\n\n    // Update charts when settings change (Zones/FTP/MaxHR)\n    settingsStore.onChange(() => {\n        // ZoneState updates its internal zones first (registered in constructor)\n        // Then we update the charts\n        updateChartZones();\n    });\n\n    let chartsVisible = localStorage.getItem('bpt-charts-visible') === 'true';\n\n    // Initialize charts toggle button\n    const chartsToggle = initChartsToggle(chartsVisible);\n    const chartsContainer = document.getElementById('liveChartsContainer');\n\n    // Set initial visibility\n    if (chartsContainer) {\n        chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n    }\n\n    // Charts toggle click handler\n    if (chartsToggle) {\n        chartsToggle.addEventListener('click', () => {\n            chartsVisible = !chartsVisible;\n            localStorage.setItem('bpt-charts-visible', chartsVisible ? 'true' : 'false');\n            chartsToggle.setAttribute('aria-pressed', chartsVisible ? 'true' : 'false');\n            if (chartsContainer) {\n                chartsContainer.style.display = chartsVisible ? 'flex' : 'none';\n            }\n        });\n    }\n\n    // Track last data index to only push new data points\n    let lastPowerIndex = 0;\n    let lastHrIndex = 0;\n\n    // Track last zones for voice feedback\n    let lastPowerZone: number | null = null;\n    let lastHrZone: number | null = null;\n\n    /**\n     * Update live charts with new data\n     */\n    const updateLiveCharts = (): void => {\n        // Update power chart\n        if (powerChart && measurementsState.power.length > lastPowerIndex) {\n            for (let i = lastPowerIndex; i < measurementsState.power.length; i++) {\n                const point = measurementsState.power[i];\n                powerChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastPowerIndex = measurementsState.power.length;\n        }\n\n        // Update HR chart\n        if (hrChart && measurementsState.heartrate.length > lastHrIndex) {\n            for (let i = lastHrIndex; i < measurementsState.heartrate.length; i++) {\n                const point = measurementsState.heartrate[i];\n                hrChart.addDataPoint(point.value, point.timestamp);\n            }\n            lastHrIndex = measurementsState.heartrate.length;\n        }\n    };\n\n    /**\n     * Update zone tracking and trigger voice announcements\n     */\n    const updateZoneTracking = (): void => {\n        // Update power zones\n        if (measurementsState.power.length > 0) {\n            const latest = measurementsState.power[measurementsState.power.length - 1];\n            if (Date.now() - latest.timestamp < DATA_TIMEOUT_MS) {\n                const zoneInfo = zoneState.updatePower(latest.value, latest.timestamp);\n                const currentZone = zoneInfo?.zone ?? null;\n\n                if (currentZone !== lastPowerZone) {\n                    if (currentZone !== null && lastPowerZone !== null) {\n                        voiceFeedback.announceZoneChange(zoneInfo!.name);\n                    }\n                    lastPowerZone = currentZone;\n                }\n            }\n        }\n\n        // Update HR zones\n        if (measurementsState.heartrate.length > 0) {\n            const latest = measurementsState.heartrate[measurementsState.heartrate.length - 1];\n            if (Date.now() - latest.timestamp < DATA_TIMEOUT_MS) {\n                const zoneInfo = zoneState.updateHeartRate(latest.value, latest.timestamp);\n                const currentZone = zoneInfo?.zone ?? null;\n\n                if (currentZone !== lastHrZone) {\n                    if (currentZone !== null && lastHrZone !== null) {\n                        voiceFeedback.announceZoneChange(zoneInfo!.name);\n                    }\n                    lastHrZone = currentZone;\n                }\n            }\n        }\n    };\n\n    // Start the update loop for charts and zone tracking\n    setInterval(() => {\n        updateZoneTracking();\n        updateLiveCharts();\n    }, UPDATE_INTERVAL_MS);\n\n    // Show/hide charts toggle based on workout state\n    document.addEventListener('workoutStarted', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'inline-flex';\n        }\n    });\n\n    document.addEventListener('workoutStopped', () => {\n        if (chartsToggle) {\n            chartsToggle.style.display = 'none';\n        }\n    });\n\n    // Listen for profile updates to reload zones\n    window.addEventListener('storage', (e) => {\n        if (e.key === 'bpt-user-profile') {\n            zoneState.loadProfile();\n        }\n    });\n\n    // Listen for workout discard to reset zones and charts\n    document.addEventListener('workout-discarded', () => {\n        zoneState.reset();\n        lastPowerIndex = 0;\n        lastHrIndex = 0;\n        if (powerChart) powerChart.clear();\n        if (hrChart) hrChart.clear();\n    });\n\n    return zoneState;\n};\n","/**\n * API client for the BPT streaming service\n * Handles communication with the Redis Streams API\n *\n * @module streamClient\n */\n\n// Use relative path for proxy in development, or custom URL in production\nconst API_BASE_URL: string = import.meta.env.VITE_API_URL || '';\nconst API_KEY: string | undefined = import.meta.env.VITE_API_KEY;\n\n/**\n * Stream information\n */\nexport interface StreamInfo {\n    name: string;\n    length: number;\n    firstMessageId: string;\n    lastMessageId: string;\n}\n\n/**\n * Stream creation response\n */\nexport interface CreateStreamResponse {\n    success: boolean;\n    streamName: string;\n    messageId: string;\n}\n\n/**\n * Message response\n */\nexport interface MessageResponse {\n    success: boolean;\n    messageId: string;\n    streamName: string;\n}\n\n/**\n * Messages query options\n */\nexport interface GetMessagesOptions {\n    start?: string;\n    end?: string;\n    count?: number;\n}\n\n/**\n * Stream messages response\n */\nexport interface StreamMessagesResponse {\n    streamName: string;\n    messages: StreamMessageData[];\n}\n\n/**\n * Message data from stream\n */\nexport interface StreamMessageData {\n    id: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE message callback\n */\nexport type SSEMessageCallback = (data: SSEMessageData) => void;\n\n/**\n * SSE connected callback\n */\nexport type SSEConnectedCallback = (data: SSEConnectedData) => void;\n\n/**\n * SSE error callback\n */\nexport type SSEErrorCallback = (error: Error | Event) => void;\n\n/**\n * SSE message data\n */\nexport interface SSEMessageData {\n    type: 'message';\n    id: string;\n    streamName: string;\n    fields: Record<string, string>;\n}\n\n/**\n * SSE connected data\n */\nexport interface SSEConnectedData {\n    type: 'connected';\n    streamName: string;\n    listenerId: string;\n}\n\n/**\n * Workout data to send\n */\nexport interface WorkoutDataPayload {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    incline?: number | null;\n    timestamp: number;\n    elapsed: string; // usually seconds as string, or mm:ss\n}\n\n/**\n * Delete stream response\n */\nexport interface DeleteStreamResponse {\n    success: boolean;\n    message: string;\n}\n\n/**\n * Helper to get headers with authentication\n */\nfunction getHeaders(extraHeaders: Record<string, string> = {}): Record<string, string> {\n    const headers: Record<string, string> = { ...extraHeaders };\n    if (API_KEY) {\n        headers['X-API-Key'] = API_KEY;\n    }\n    return headers;\n}\n\n/**\n * Create a new stream\n *\n * @param streamName - Unique name for the stream\n * @returns Promise with stream creation result\n */\nexport async function createStream(streamName: string): Promise<CreateStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/create`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ streamName }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to create stream');\n    }\n\n    return response.json();\n}\n\n/**\n * List all available streams\n *\n * @returns Promise with list of streams\n */\nexport async function listStreams(): Promise<{ streams: StreamInfo[] }> {\n    const response = await fetch(`${API_BASE_URL}/api/streams`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(error || 'Failed to list streams');\n    }\n\n    return response.json();\n}\n\n/**\n * Add a message to a stream\n *\n * @param streamName - Name of the stream\n * @param message - Message content\n * @param author - Message author\n * @returns Promise with message result\n */\nexport async function addMessage(\n    streamName: string,\n    message: string,\n    author: string = 'anonymous'\n): Promise<MessageResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({ message, author }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to add message');\n    }\n\n    return response.json();\n}\n\n/**\n * Get messages from a stream\n *\n * @param streamName - Name of the stream\n * @param options - Query options\n * @returns Promise with stream messages\n */\nexport async function getMessages(\n    streamName: string,\n    options: GetMessagesOptions = {}\n): Promise<StreamMessagesResponse> {\n    const { start = '-', end = '+', count = 100 } = options;\n    const params = new URLSearchParams({ start, end, count: count.toString() });\n\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}/messages?${params}`, {\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to get messages');\n    }\n\n    return response.json();\n}\n\n/**\n * SSE Connection interface for fetch-based SSE\n * Provides a consistent API similar to EventSource\n */\nexport interface SSEConnection {\n    /** Close the SSE connection */\n    close: () => void;\n    /** Whether the connection is active */\n    readonly active: boolean;\n}\n\n/**\n * Create a fetch-based SSE connection that supports custom headers\n * Unlike EventSource, this allows sending authentication via headers\n *\n * @param url - The SSE endpoint URL\n * @param onMessage - Callback for each SSE message\n * @param onConnected - Callback when connection is established\n * @param onError - Callback for errors\n * @returns SSEConnection object with close() method\n */\nexport function createFetchSSE(\n    url: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const controller = new AbortController();\n    let isActive = true;\n\n    const connection: SSEConnection = {\n        close: () => {\n            isActive = false;\n            controller.abort();\n        },\n        get active() {\n            return isActive;\n        },\n    };\n\n    // Start the fetch in the background\n    (async () => {\n        try {\n            const response = await fetch(url, {\n                method: 'GET',\n                headers: getHeaders({\n                    Accept: 'text/event-stream',\n                    'Cache-Control': 'no-cache',\n                }),\n                signal: controller.signal,\n            });\n\n            if (!response.ok) {\n                throw new Error(`SSE connection failed: ${response.status} ${response.statusText}`);\n            }\n\n            if (!response.body) {\n                throw new Error('SSE response has no body');\n            }\n\n            const reader = response.body.getReader();\n            const decoder = new TextDecoder();\n            let buffer = '';\n\n            while (isActive) {\n                const { done, value } = await reader.read();\n\n                if (done) {\n                    break;\n                }\n\n                buffer += decoder.decode(value, { stream: true });\n\n                // Process complete SSE messages (separated by double newlines)\n                const messages = buffer.split('\\n\\n');\n                buffer = messages.pop() || ''; // Keep incomplete message in buffer\n\n                for (const message of messages) {\n                    if (!message.trim()) continue;\n\n                    // Parse SSE format: \"data: {...}\\n\"\n                    const dataMatch = message.match(/^data:\\s*(.+)$/m);\n                    if (dataMatch) {\n                        try {\n                            const data = JSON.parse(dataMatch[1]);\n\n                            if (data.type === 'connected' && onConnected) {\n                                onConnected(data);\n                            } else if (data.type === 'message') {\n                                onMessage(data);\n                            }\n                        } catch (parseError) {\n                            console.error('Error parsing SSE data:', parseError);\n                        }\n                    }\n                }\n            }\n        } catch (error) {\n            if ((error as Error).name === 'AbortError') {\n                // Connection was intentionally closed\n                return;\n            }\n            console.error('SSE connection error:', error);\n            if (onError) {\n                onError(error as Error);\n            }\n        } finally {\n            isActive = false;\n        }\n    })();\n\n    return connection;\n}\n\n/**\n * Connect to a stream and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n *\n * @param streamName - Name of the stream to listen to\n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToStream(\n    streamName: string,\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/${streamName}/listen`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Connect to all streams and listen for real-time messages via SSE\n * Uses fetch-based SSE to support authentication headers\n *\n * @param onMessage - Callback function for new messages\n * @param onConnected - Callback function when connected\n * @param onError - Callback function for errors\n * @returns SSEConnection object (call .close() to disconnect)\n */\nexport function listenToAllStreams(\n    onMessage: SSEMessageCallback,\n    onConnected?: SSEConnectedCallback,\n    onError?: SSEErrorCallback\n): SSEConnection {\n    const url = `${API_BASE_URL}/api/streams/listenAll`;\n    return createFetchSSE(url, onMessage, onConnected, onError);\n}\n\n/**\n * Send workout data to a stream\n *\n * @param streamName - Name of the stream\n * @param workoutData - Workout data to send\n * @returns Promise with message result\n */\nexport async function sendWorkoutData(streamName: string, workoutData: WorkoutDataPayload): Promise<MessageResponse> {\n    const message = JSON.stringify({\n        power: workoutData.power ?? null,\n        cadence: workoutData.cadence ?? null,\n        heartrate: workoutData.heartrate ?? null,\n        speed: workoutData.speed ?? null,\n        distance: workoutData.distance ?? null,\n        altitude: workoutData.altitude ?? null,\n        incline: workoutData.incline ?? null,\n        timestamp: workoutData.timestamp,\n        elapsed: workoutData.elapsed,\n        dataType: 'workout_metrics',\n    });\n\n    return addMessage(streamName, message, 'bike-power-tracker');\n}\n\n/**\n * Delete a stream\n *\n * @param streamName - Name of the stream to delete\n * @returns Promise with deletion result\n */\nexport async function deleteStream(streamName: string): Promise<DeleteStreamResponse> {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${streamName}`, {\n        method: 'DELETE',\n        headers: getHeaders(),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to delete stream');\n    }\n\n    return response.json();\n}\n\n/**\n * Parameters for sending a reaction\n */\nexport interface SendReactionParams {\n    streamName: string;\n    type: 'reaction' | 'text';\n    content: string;\n    viewerId: string;\n    viewerName?: string;\n}\n\n/**\n * Send a reaction or message to a stream\n *\n * @param params - Reaction parameters\n * @returns Promise with reaction result\n */\nexport const sendReaction = async (params: SendReactionParams): Promise<{ success: boolean; id?: string }> => {\n    const response = await fetch(`${API_BASE_URL}/api/streams/${params.streamName}/reactions`, {\n        method: 'POST',\n        headers: getHeaders({\n            'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify({\n            type: params.type,\n            content: params.content,\n            viewerId: params.viewerId,\n            viewerName: params.viewerName,\n        }),\n    });\n\n    if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || 'Failed to send reaction');\n    }\n\n    return response.json();\n};\n","/**\n * Stream Viewer UI\n *\n * Displays available streams and allows viewing live workout data.\n *\n * @module streamViewer\n */\n\nimport { listStreams, listenToStream, listenToAllStreams } from '../api/streamClient.js';\nimport type { StreamInfo, SSEMessageData, SSEConnection } from '../api/streamClient.js';\nimport { ReactionPanel } from '../components/ReactionPanel.js';\n\n/**\n * Workout metrics data from stream message\n */\ninterface WorkoutMetrics {\n    power?: number | null;\n    cadence?: number | null;\n    heartrate?: number | null;\n    speed?: number | null;\n    distance?: number | null;\n    altitude?: number | null;\n    elapsed?: string;\n    dataType?: string;\n}\n\n/**\n * All streams message data\n */\ninterface AllStreamsMessageData {\n    stream: string;\n    data:\n        | {\n              message: string;\n          }\n        | WorkoutMetrics;\n}\n\n/**\n * Stream viewer class that manages the stream viewing UI\n */\nexport class StreamViewer {\n    private modal: HTMLDivElement | null = null;\n    private currentConnection: SSEConnection | null = null;\n    private streamMetricsSection: HTMLElement | null = null;\n    private allStreamsMetricsSection: HTMLElement | null = null;\n    private allStreamsConnection: SSEConnection | null = null;\n    private streamCards: Map<string, HTMLElement> = new Map();\n    private streamRows: Map<string, HTMLElement> = new Map();\n    private isCompactView: boolean = false;\n\n    constructor() {\n        this.initModal();\n        this.initInlineViewer();\n        this.initAllStreamsViewer();\n    }\n\n    /**\n     * Initialize the inline stream viewer in main content\n     */\n    private initInlineViewer(): void {\n        this.streamMetricsSection = document.getElementById('streamMetrics');\n        if (!this.streamMetricsSection) {\n            console.warn('Stream metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeStreamView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromStream());\n        }\n    }\n\n    /**\n     * Initialize the all streams viewer\n     */\n    private initAllStreamsViewer(): void {\n        this.allStreamsMetricsSection = document.getElementById('allStreamsMetrics');\n        if (!this.allStreamsMetricsSection) {\n            console.warn('All streams metrics section not found in DOM');\n            return;\n        }\n\n        const closeBtn = document.getElementById('closeAllStreamsView');\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.disconnectFromAllStreams());\n        }\n\n        const toggleViewBtn = document.getElementById('toggleViewBtn');\n        if (toggleViewBtn) {\n            toggleViewBtn.addEventListener('click', () => this.toggleAllStreamsView());\n        }\n    }\n\n    /**\n     * Toggle between grid and compact list view\n     */\n    private toggleAllStreamsView(): void {\n        this.isCompactView = !this.isCompactView;\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        const toggleBtn = document.getElementById('toggleViewBtn');\n\n        if (this.isCompactView) {\n            if (grid) grid.style.display = 'none';\n            if (list) list.style.display = 'flex';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle grid view';\n                toggleBtn.classList.add('active');\n            }\n        } else {\n            if (grid) grid.style.display = 'grid';\n            if (list) list.style.display = 'none';\n            if (toggleBtn) {\n                toggleBtn.textContent = '';\n                toggleBtn.title = 'Toggle compact view';\n                toggleBtn.classList.remove('active');\n            }\n        }\n    }\n\n    /**\n     * Initialize the stream viewer modal\n     */\n    private initModal(): void {\n        const modal = document.createElement('div');\n        modal.id = 'streamViewerModal';\n        modal.className = 'stream-modal';\n        modal.innerHTML = `\n      <div class=\"stream-modal-content\">\n        <div class=\"stream-modal-header\">\n          <h2> Live Streams</h2>\n          <button id=\"closeStreamModal\" class=\"close-button\">&times;</button>\n        </div>\n        <div class=\"stream-modal-body\">\n          <div class=\"stream-list-container\">\n            <div class=\"stream-list-controls\" style=\"display: flex; justify-content: space-between; margin-bottom: 10px;\">\n              <button id=\"refreshStreamList\" class=\"refresh-button\"> Refresh List</button>\n              <button id=\"viewAllStreamsBtn\" class=\"connect-button\" style=\"background-color: #4CAF50;\"> View All Streams</button>\n            </div>\n            <div id=\"streamsList\" class=\"streams-list\">\n              <p class=\"loading\">Loading streams...</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n\n        document.body.appendChild(modal);\n        this.modal = modal;\n        this.setupEventListeners();\n    }\n\n    /**\n     * Set up event listeners for modal controls\n     */\n    private setupEventListeners(): void {\n        const closeBtn = document.getElementById('closeStreamModal');\n        const refreshBtn = document.getElementById('refreshStreamList');\n        const viewAllBtn = document.getElementById('viewAllStreamsBtn');\n\n        if (closeBtn) {\n            closeBtn.addEventListener('click', () => this.close());\n        }\n        if (refreshBtn) {\n            refreshBtn.addEventListener('click', () => this.refreshStreamList());\n        }\n        if (viewAllBtn) {\n            viewAllBtn.addEventListener('click', () => this.connectToAllStreams());\n        }\n\n        if (this.modal) {\n            this.modal.addEventListener('click', (e: MouseEvent) => {\n                if (e.target === this.modal) {\n                    this.close();\n                }\n            });\n        }\n    }\n\n    /**\n     * Open the stream viewer modal\n     */\n    async open(): Promise<void> {\n        if (this.modal) {\n            this.modal.style.display = 'flex';\n        }\n        await this.refreshStreamList();\n    }\n\n    /**\n     * Close the stream viewer modal\n     */\n    close(): void {\n        if (this.modal) {\n            this.modal.style.display = 'none';\n        }\n    }\n\n    /**\n     * Refresh the list of available streams\n     */\n    async refreshStreamList(): Promise<void> {\n        const streamsList = document.getElementById('streamsList');\n        if (!streamsList) return;\n\n        streamsList.innerHTML = '<p class=\"loading\">Loading streams...</p>';\n\n        try {\n            const { streams } = await listStreams();\n\n            if (streams.length === 0) {\n                streamsList.innerHTML = '<p class=\"no-streams\">No active streams found</p>';\n                return;\n            }\n\n            streamsList.innerHTML = '';\n            streams.forEach((stream: StreamInfo) => {\n                const streamItem = this.createStreamItem(stream);\n                streamsList.appendChild(streamItem);\n            });\n        } catch (error) {\n            console.error('Failed to load streams:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            streamsList.innerHTML = `<p class=\"error\">Failed to load streams: ${message}</p>`;\n        }\n    }\n\n    /**\n     * Create a stream list item element\n     */\n    private createStreamItem(stream: StreamInfo): HTMLElement {\n        const div = document.createElement('div');\n        div.className = 'stream-item';\n\n        const isWorkoutStream = stream.name.startsWith('workout-');\n        const icon = isWorkoutStream ? '' : '';\n\n        div.innerHTML = `\n      <div class=\"stream-item-info\">\n        <div class=\"stream-item-name\">${icon} ${stream.name}</div>\n        <div class=\"stream-item-meta\">\n          ${stream.length} message${stream.length !== 1 ? 's' : ''}\n        </div>\n      </div>\n      <button class=\"connect-button\" data-stream=\"${stream.name}\">\n         View\n      </button>\n    `;\n\n        const connectBtn = div.querySelector('.connect-button');\n        connectBtn?.addEventListener('click', () => {\n            this.connectToStream(stream.name);\n        });\n\n        return div;\n    }\n\n    /**\n     * Connect to a stream and view live data\n     */\n    connectToStream(streamName: string): void {\n        this.disconnectFromStream();\n\n        if (!this.streamMetricsSection) {\n            console.error('Stream metrics section not available');\n            return;\n        }\n\n        this.streamMetricsSection.style.display = 'flex';\n\n        const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n        if (toggleStream) toggleStream.checked = true;\n\n        const streamTitle = document.getElementById('streamTitle');\n        const statusEl = document.getElementById('streamStatus');\n\n        if (streamTitle) streamTitle.textContent = streamName;\n        if (statusEl) {\n            statusEl.textContent = 'Connecting...';\n            statusEl.className = 'status-badge connecting';\n        }\n\n        this.close();\n\n        // Initialize reaction panel\n        const reactionPanel = this.streamMetricsSection.querySelector('reaction-panel') as ReactionPanel | null;\n        if (reactionPanel) {\n            reactionPanel.stream = streamName;\n        }\n\n        this.currentConnection = listenToStream(\n            streamName,\n            (data: SSEMessageData) => this.handleStreamMessage(data),\n            () => this.handleStreamConnected(),\n            (error: Error | Event) => this.handleStreamError(error)\n        );\n    }\n\n    /**\n     * Connect to all streams\n     */\n    connectToAllStreams(): void {\n        this.disconnectFromStream();\n        this.disconnectFromAllStreams();\n\n        if (!this.allStreamsMetricsSection) {\n            console.error('All streams metrics section not available');\n            return;\n        }\n\n        this.allStreamsMetricsSection.style.display = 'flex';\n        this.close();\n\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n        if (grid) grid.innerHTML = '';\n        if (list) list.innerHTML = '';\n        this.streamCards.clear();\n        this.streamRows.clear();\n\n        const allStreamsStatus = document.getElementById('allStreamsStatus');\n        if (allStreamsStatus) {\n            allStreamsStatus.textContent = 'Connecting...';\n            allStreamsStatus.className = 'status-badge connecting';\n        }\n\n        this.allStreamsConnection = listenToAllStreams(\n            (data: SSEMessageData) => this.handleAllStreamsMessage(data as unknown as AllStreamsMessageData),\n            () => this.handleAllStreamsConnected(),\n            (error: Error | Event) => this.handleAllStreamsError(error)\n        );\n    }\n\n    /**\n     * Handle all streams connected event\n     */\n    private handleAllStreamsConnected(): void {\n        console.log('Connected to all streams');\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle all streams error\n     */\n    private handleAllStreamsError(error: Error | Event): void {\n        console.error('All streams error:', error);\n        const statusEl = document.getElementById('allStreamsStatus');\n        if (!statusEl) return;\n\n        if (this.allStreamsConnection && this.allStreamsConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Disconnect from all streams\n     */\n    disconnectFromAllStreams(): void {\n        if (this.allStreamsConnection) {\n            this.allStreamsConnection.close();\n            this.allStreamsConnection = null;\n        }\n\n        if (this.allStreamsMetricsSection) {\n            this.allStreamsMetricsSection.style.display = 'none';\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n    }\n\n    /**\n     * Handle incoming message for all streams view\n     */\n    private handleAllStreamsMessage(data: AllStreamsMessageData): void {\n        try {\n            const streamName = data.stream;\n            const messageData = typeof data.data === 'string' ? JSON.parse(data.data) : data.data;\n\n            this.updateStreamCard(streamName, messageData);\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update or create a stream card\n     */\n    private updateStreamCard(streamName: string, data: { message?: string } & WorkoutMetrics): void {\n        const grid = document.getElementById('allStreamsGrid');\n        const list = document.getElementById('allStreamsList');\n\n        let messageData: WorkoutMetrics = {};\n        try {\n            if (data.message) {\n                messageData = JSON.parse(data.message);\n            } else {\n                messageData = data;\n            }\n        } catch {\n            // Ignore parse errors\n        }\n\n        if (grid) {\n            let card = this.streamCards.get(streamName);\n\n            if (!card) {\n                card = document.createElement('div');\n                card.className = 'stream-card';\n                card.innerHTML = `\n          <div class=\"stream-card-name\" title=\"${streamName}\">${streamName}</div>\n          <div class=\"stream-card-power\">--</div>\n          <div class=\"stream-card-secondary\">\n            <div class=\"stream-card-metric\">\n              <span>CAD</span>\n              <span class=\"card-cadence\">--</span>\n            </div>\n            <div class=\"stream-card-metric\">\n              <span>HR</span>\n              <span class=\"card-heartrate\">--</span>\n            </div>\n          </div>\n        `;\n                grid.appendChild(card);\n                this.streamCards.set(streamName, card);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = card.querySelector('.stream-card-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n\n            if (messageData.cadence !== undefined && messageData.cadence !== null) {\n                const cadenceEl = card.querySelector('.card-cadence');\n                if (cadenceEl) cadenceEl.textContent = String(messageData.cadence);\n            }\n\n            if (messageData.heartrate !== undefined && messageData.heartrate !== null) {\n                const hrEl = card.querySelector('.card-heartrate');\n                if (hrEl) hrEl.textContent = String(messageData.heartrate);\n            }\n        }\n\n        if (list) {\n            let row = this.streamRows.get(streamName);\n\n            if (!row) {\n                row = document.createElement('div');\n                row.className = 'stream-row';\n                row.innerHTML = `\n          <span class=\"stream-row-name\" title=\"${streamName}\">${streamName}</span>\n          <span class=\"stream-row-power\">--</span>\n        `;\n                list.appendChild(row);\n                this.streamRows.set(streamName, row);\n            }\n\n            if (messageData.power !== undefined && messageData.power !== null) {\n                const powerEl = row.querySelector('.stream-row-power');\n                if (powerEl) powerEl.textContent = String(messageData.power);\n            }\n        }\n    }\n\n    /**\n     * Disconnect from the current stream\n     */\n    disconnectFromStream(): void {\n        this.disconnectFromAllStreams();\n\n        if (this.currentConnection) {\n            this.currentConnection.close();\n            this.currentConnection = null;\n        }\n\n        if (this.streamMetricsSection) {\n            this.streamMetricsSection.style.display = 'none';\n\n            const toggleStream = document.getElementById('toggleStreamMetrics') as HTMLInputElement | null;\n            if (toggleStream) toggleStream.checked = false;\n        }\n\n        const yourMetricsSection = document.getElementById('yourMetrics');\n        if (yourMetricsSection) {\n            yourMetricsSection.style.display = 'flex';\n        }\n\n        this.resetViewer();\n    }\n\n    /**\n     * Handle stream connected event\n     */\n    private handleStreamConnected(): void {\n        const statusEl = document.getElementById('streamStatus');\n        if (statusEl) {\n            statusEl.textContent = ' Connected';\n            statusEl.className = 'status-badge connected';\n        }\n    }\n\n    /**\n     * Handle incoming stream message\n     */\n    private handleStreamMessage(data: SSEMessageData): void {\n        try {\n            const messageStr = (data as unknown as { data: { message: string } }).data?.message;\n            const messageData: WorkoutMetrics =\n                typeof messageStr === 'string'\n                    ? JSON.parse(messageStr)\n                    : (data as unknown as { data: WorkoutMetrics }).data;\n\n            if (\n                messageData.dataType === 'workout_metrics' ||\n                messageData.power !== undefined ||\n                messageData.cadence !== undefined ||\n                messageData.heartrate !== undefined\n            ) {\n                this.updateMetrics(messageData);\n            }\n\n            const lastUpdateEl = document.getElementById('streamLastUpdate');\n            if (lastUpdateEl) {\n                const now = new Date();\n                lastUpdateEl.textContent = `Last update: ${now.toLocaleTimeString()}`;\n            }\n        } catch (error) {\n            console.error('Error parsing stream message:', error, data);\n        }\n    }\n\n    /**\n     * Update metrics display with new data\n     */\n    private updateMetrics(data: WorkoutMetrics): void {\n        const powerEl = document.getElementById('streamPower');\n        const cadenceEl = document.getElementById('streamCadence');\n        const heartrateEl = document.getElementById('streamHeartrate');\n        const speedEl = document.getElementById('streamSpeed');\n        const distanceEl = document.getElementById('streamDistance');\n        const altitudeEl = document.getElementById('streamAltitude');\n        const elapsedEl = document.getElementById('streamElapsed');\n\n        if (powerEl && data.power !== null && data.power !== undefined) {\n            powerEl.textContent = String(data.power);\n        }\n        if (cadenceEl && data.cadence !== null && data.cadence !== undefined) {\n            cadenceEl.textContent = String(data.cadence);\n        }\n        if (heartrateEl && data.heartrate !== null && data.heartrate !== undefined) {\n            heartrateEl.textContent = String(data.heartrate);\n        }\n        if (speedEl && data.speed !== null && data.speed !== undefined) {\n            speedEl.textContent = String(data.speed);\n        }\n        if (distanceEl && data.distance !== null && data.distance !== undefined) {\n            distanceEl.textContent = String(data.distance);\n        }\n        if (altitudeEl && data.altitude !== null && data.altitude !== undefined) {\n            altitudeEl.textContent = String(data.altitude);\n        }\n        if (elapsedEl && data.elapsed) {\n            elapsedEl.textContent = data.elapsed;\n        }\n    }\n\n    /**\n     * Handle stream error\n     */\n    private handleStreamError(error: Error | Event): void {\n        console.error('Stream error:', error);\n        const statusEl = document.getElementById('streamStatus');\n        if (!statusEl) return;\n\n        if (this.currentConnection && this.currentConnection.active) {\n            statusEl.textContent = ' Reconnecting...';\n            statusEl.className = 'status-badge reconnecting';\n        } else {\n            statusEl.textContent = ' Error';\n            statusEl.className = 'status-badge error';\n        }\n    }\n\n    /**\n     * Reset viewer display\n     */\n    private resetViewer(): void {\n        const elements = [\n            'streamPower',\n            'streamCadence',\n            'streamHeartrate',\n            'streamSpeed',\n            'streamDistance',\n            'streamAltitude',\n            'streamElapsed',\n        ];\n\n        elements.forEach((id) => {\n            const el = document.getElementById(id);\n            if (el) el.textContent = '--';\n        });\n\n        const streamLastUpdate = document.getElementById('streamLastUpdate');\n        if (streamLastUpdate) streamLastUpdate.textContent = 'Waiting for data...';\n    }\n}\n\n/**\n * Initialize stream viewer UI\n */\nexport function initStreamViewer(): StreamViewer {\n    const viewer = new StreamViewer();\n\n    const viewStreamsBtn = document.getElementById('viewStreamsButton');\n    if (viewStreamsBtn) {\n        viewStreamsBtn.addEventListener('click', () => viewer.open());\n    }\n\n    return viewer;\n}\n","import { createFetchSSE, type SSEConnection } from '../api/streamClient.js';\nimport type { StreamerNotification } from '../types/stream.js';\n\ntype ReactionCallback = (notification: StreamerNotification) => void;\n\nexport class ReactionListener {\n    private connection: SSEConnection | null = null;\n    private callbacks: Set<ReactionCallback> = new Set();\n    private streamName: string | null = null;\n    private reconnectAttempts: number = 0;\n    private maxReconnectAttempts: number = 5;\n    private reconnectDelay: number = 2000;\n\n    async start(streamName: string): Promise<void> {\n        this.streamName = streamName;\n        this.reconnectAttempts = 0;\n        await this.connect();\n    }\n\n    stop(): void {\n        if (this.connection) {\n            this.connection.close();\n            this.connection = null;\n        }\n        this.streamName = null;\n        this.reconnectAttempts = 0;\n    }\n\n    onReaction(callback: ReactionCallback): () => void {\n        this.callbacks.add(callback);\n        return () => this.callbacks.delete(callback);\n    }\n\n    private async connect(): Promise<void> {\n        if (!this.streamName) return;\n\n        const apiUrl = import.meta.env.VITE_API_URL || '';\n        const url = `${apiUrl}/api/streams/${this.streamName}/reactions/listen`;\n\n        this.connection = createFetchSSE(\n            url,\n            (data: any) => this.handleMessage(data),\n            () => console.log('Connected to reaction stream'),\n            (error: unknown) => this.handleError(error as Error)\n        );\n    }\n\n    private handleMessage(data: unknown): void {\n        const message = data as {\n            type: string;\n            id: string;\n            data: {\n                type: 'reaction' | 'text';\n                content: string;\n                viewerId: string;\n                viewerName?: string;\n                timestamp: string;\n            };\n        };\n\n        if (message.type === 'reaction') {\n            const notification: StreamerNotification = {\n                id: message.id,\n                type: message.data.type,\n                content: message.data.content,\n                viewerId: message.data.viewerId,\n                viewerName: message.data.viewerName,\n                timestamp: parseInt(message.data.timestamp),\n            };\n\n            this.callbacks.forEach((cb) => cb(notification));\n        }\n    }\n\n    private handleError(error: Error): void {\n        console.error('Reaction listener error:', error);\n\n        if (this.reconnectAttempts < this.maxReconnectAttempts && this.streamName) {\n            this.reconnectAttempts++;\n            const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1);\n            setTimeout(() => this.connect(), delay);\n        }\n    }\n}\n","/**\n * Streaming Controls Initialization\n *\n * Sets up UI controls for starting, pausing, and stopping workout streaming.\n *\n * @module initStreamingControls\n */\n\nimport { showNotification } from './ui/notifications.js';\nimport type { StreamManager, StreamStatus } from './stream-manager.js';\nimport type { TimeState } from './getInitState.js';\nimport { ReactionListener } from './services/ReactionListener.js';\nimport { ReactionDisplay } from './components/ReactionDisplay.js';\n\n/**\n * Initialize streaming controls.\n *\n * Sets up event handlers for:\n * - Start/stop streaming button\n * - Stream name modal\n * - Toolbar play/pause/stop buttons\n * - Auto-stop when workout ends\n *\n * @param streamManager - The stream manager instance\n * @param timeState - The workout time state\n */\nexport function initStreamingControls(streamManager: StreamManager, timeState: TimeState): void {\n    let reactionListener: ReactionListener | null = null;\n    let reactionDisplay: ReactionDisplay | null = null;\n\n    const setupReactions = async (streamName: string) => {\n        if (reactionListener) reactionListener.stop();\n        reactionListener = new ReactionListener();\n        await reactionListener.start(streamName);\n\n        if (reactionDisplay) reactionDisplay.remove();\n        reactionDisplay = document.createElement('reaction-display') as ReactionDisplay;\n        document.body.appendChild(reactionDisplay);\n\n        reactionListener.onReaction((n) => reactionDisplay?.addNotification(n));\n    };\n\n    const cleanupReactions = () => {\n        if (reactionListener) {\n            reactionListener.stop();\n            reactionListener = null;\n        }\n        if (reactionDisplay) {\n            reactionDisplay.remove();\n            reactionDisplay = null;\n        }\n    };\n\n    // Main button\n    const startStreamButton = document.getElementById('startStreamButton') as HTMLButtonElement | null;\n\n    // Modal elements\n    const modal = document.getElementById('streamNameModal') as HTMLDivElement | null;\n    const closeBtn = document.getElementById('closeStreamNameModal') as HTMLButtonElement | null;\n    const cancelBtn = document.getElementById('cancelStreamName') as HTMLButtonElement | null;\n    const confirmBtn = document.getElementById('confirmStreamName') as HTMLButtonElement | null;\n    const nameInput = document.getElementById('streamNameInput') as HTMLInputElement | null;\n\n    // Toolbar elements\n    const toolbar = document.getElementById('activeStreamToolbar') as HTMLDivElement | null;\n    const toolbarStreamName = document.getElementById('toolbarStreamName') as HTMLSpanElement | null;\n    const playPauseBtn = document.getElementById('streamPlayPauseBtn') as HTMLButtonElement | null;\n    const stopBtn = document.getElementById('streamStopBtn') as HTMLButtonElement | null;\n    const streamIndicator = document.querySelector('.stream-indicator') as HTMLElement | null;\n\n    /**\n     * Update toolbar visibility and state\n     */\n    const updateToolbar = (status: StreamStatus): void => {\n        if (!toolbar) return;\n\n        if (status.isStreaming) {\n            toolbar.style.display = 'flex';\n            document.body.classList.add('has-stream-toolbar');\n\n            if (toolbarStreamName) {\n                toolbarStreamName.textContent = status.streamName;\n            }\n\n            // Update Play/Pause button\n            if (playPauseBtn) {\n                if (status.isPaused) {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Resume Stream';\n                    streamIndicator?.classList.add('paused');\n                } else {\n                    playPauseBtn.textContent = '';\n                    playPauseBtn.title = 'Pause Stream';\n                    streamIndicator?.classList.remove('paused');\n                }\n            }\n        } else {\n            toolbar.style.display = 'none';\n            document.body.classList.remove('has-stream-toolbar');\n        }\n    };\n\n    if (!startStreamButton) {\n        console.warn('Start stream button not found in DOM');\n        return;\n    }\n\n    /**\n     * Close the stream name modal\n     */\n    const closeModal = (): void => {\n        if (modal) modal.style.display = 'none';\n        if (nameInput) nameInput.value = '';\n    };\n\n    /**\n     * Start streaming with optional custom name\n     */\n    const startStreaming = async (): Promise<void> => {\n        const customName = nameInput?.value.trim() || '';\n\n        try {\n            const streamName = await streamManager.startStreaming(customName || undefined);\n            startStreamButton.textContent = ' Stop Streaming';\n            startStreamButton.classList.add('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification(`Streaming to: ${streamName}`, 'success');\n            await setupReactions(streamName);\n            closeModal();\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            const message = error instanceof Error ? error.message : 'Unknown error';\n            showNotification('Failed to start streaming: ' + message, 'error');\n        }\n    };\n\n    /**\n     * Stop streaming\n     */\n    const stopStreaming = async (): Promise<void> => {\n        try {\n            await streamManager.stopStreaming();\n            cleanupReactions();\n            startStreamButton.textContent = ' Start Streaming';\n            startStreamButton.classList.remove('streaming');\n\n            updateToolbar(streamManager.getStatus());\n            showNotification('Streaming stopped', 'info');\n        } catch (error) {\n            console.error(error);\n            showNotification('Error stopping stream', 'error');\n        }\n    };\n\n    // Wire up toolbar buttons\n    if (playPauseBtn) {\n        playPauseBtn.addEventListener('click', () => {\n            const status = streamManager.getStatus();\n            if (status.isPaused) {\n                streamManager.resumeStreaming();\n                showNotification('Stream Resumed', 'success');\n            } else {\n                streamManager.pauseStreaming();\n                showNotification('Stream Paused', 'info');\n            }\n            updateToolbar(streamManager.getStatus());\n        });\n    }\n\n    if (stopBtn) {\n        stopBtn.addEventListener('click', async () => {\n            if (confirm('Stop streaming?')) {\n                await stopStreaming();\n            }\n        });\n    }\n\n    // Event listeners for modal\n    if (closeBtn) closeBtn.addEventListener('click', closeModal);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeModal);\n\n    if (confirmBtn) {\n        confirmBtn.addEventListener('click', startStreaming);\n    }\n\n    if (nameInput) {\n        nameInput.addEventListener('keypress', (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n                startStreaming();\n            }\n        });\n    }\n\n    // Close on click outside\n    if (modal) {\n        modal.addEventListener('click', (e: MouseEvent) => {\n            if (e.target === modal) closeModal();\n        });\n    }\n\n    // Main button click handler\n    startStreamButton.addEventListener('click', async () => {\n        if (streamManager.isStreaming) {\n            await stopStreaming();\n        } else {\n            if (modal) {\n                modal.style.display = 'flex';\n                nameInput?.focus();\n            } else {\n                // Fallback if modal missing\n                try {\n                    const streamName = await streamManager.startStreaming();\n                    startStreamButton.textContent = ' Stop Streaming';\n                    startStreamButton.classList.add('streaming');\n                    updateToolbar(streamManager.getStatus());\n                    showNotification(`Streaming to: ${streamName}`, 'success');\n                    await setupReactions(streamName);\n                } catch (error) {\n                    console.error('Failed to start streaming:', error);\n                    const message = error instanceof Error ? error.message : 'Unknown error';\n                    showNotification('Failed to start streaming: ' + message, 'error');\n                }\n            }\n        }\n    });\n\n    // Auto-stop streaming when workout is stopped (Pause or Stop buttons)\n    const pauseButton = document.getElementById('pauseButton');\n    const stopButton = document.getElementById('stopButton');\n\n    const handleWorkoutPause = () => {\n        if (timeState.running === false && streamManager.isStreaming) {\n            // Workout was just paused\n            setTimeout(() => {\n                if (!timeState.running && streamManager.isStreaming) {\n                    streamManager.stopStreaming();\n                    startStreamButton.textContent = ' Start Streaming';\n                    startStreamButton.classList.remove('streaming');\n                    updateToolbar(streamManager.getStatus());\n                }\n            }, 100);\n        }\n    };\n\n    if (pauseButton) {\n        pauseButton.addEventListener('click', handleWorkoutPause);\n    }\n    if (stopButton) {\n        stopButton.addEventListener('click', handleWorkoutPause);\n    }\n}\n","/**\n * Workout Builder UI\n *\n * Manages the UI for creating custom structured workouts.\n */\n\nimport type { StructuredWorkout, WorkoutStep, WorkoutTarget, IntervalType, TargetType } from '../workouts/types.js';\nimport { saveCustomWorkout } from '../storage/customWorkouts.js';\nimport { announce } from './accessibility.js';\nimport { refreshWorkoutList } from './workoutPlayer.js';\n\nlet currentSteps: WorkoutStep[] = [];\n\n/**\n * Initialize Builder UI\n */\nexport function initWorkoutBuilder(): void {\n    const createBtn = document.getElementById('createWorkoutBtn');\n    const closeBtn = document.getElementById('closeBuilderModal');\n    const cancelBtn = document.getElementById('wbCancel');\n    const saveBtn = document.getElementById('wbSave');\n    const addStepBtn = document.getElementById('wbAddStepRef');\n\n    if (createBtn) {\n        createBtn.addEventListener('click', openBuilder);\n    }\n\n    if (closeBtn) closeBtn.addEventListener('click', closeBuilder);\n    if (cancelBtn) cancelBtn.addEventListener('click', closeBuilder);\n\n    if (saveBtn) {\n        saveBtn.addEventListener('click', saveWorkout);\n    }\n\n    if (addStepBtn) {\n        addStepBtn.addEventListener('click', addStepFromForm);\n    }\n\n    // Toggle target value visibility based on type\n    const targetTypeSelect = document.getElementById('wbTargetType') as HTMLSelectElement;\n    if (targetTypeSelect) {\n        targetTypeSelect.addEventListener('change', () => {\n            const valInput = document.getElementById('wbTargetValue') as HTMLInputElement;\n            if (valInput) {\n                valInput.parentElement!.style.display = targetTypeSelect.value === 'open' ? 'none' : 'block';\n            }\n        });\n    }\n}\n\nfunction openBuilder(): void {\n    const modal = document.getElementById('workoutBuilderModal');\n    const selectionModal = document.getElementById('workoutSelectionModal');\n\n    if (selectionModal) selectionModal.style.display = 'none';\n    if (modal) {\n        modal.style.display = 'flex';\n        resetForm();\n    }\n}\n\nfunction closeBuilder(): void {\n    const modal = document.getElementById('workoutBuilderModal');\n    if (modal) modal.style.display = 'none';\n}\n\nfunction resetForm(): void {\n    currentSteps = [];\n    (document.getElementById('wbName') as HTMLInputElement).value = '';\n    (document.getElementById('wbDesc') as HTMLTextAreaElement).value = '';\n    renderSteps();\n}\n\nfunction addStepFromForm(): void {\n    const type = (document.getElementById('wbStepType') as HTMLSelectElement).value as IntervalType;\n    const durationStr = (document.getElementById('wbStepDuration') as HTMLInputElement).value;\n    const targetType = (document.getElementById('wbTargetType') as HTMLSelectElement).value as TargetType;\n    const targetValStr = (document.getElementById('wbTargetValue') as HTMLInputElement).value;\n    const nameStr = (document.getElementById('wbStepName') as HTMLInputElement).value;\n\n    const duration = parseInt(durationStr, 10);\n    // Explicitly treat as string because it can contain unit-mixed values like 'percent_ftp'\n    const targetTypeStr = targetType as unknown as string;\n\n    if (isNaN(duration) || duration <= 0) {\n        alert('Invalid duration');\n        return;\n    }\n\n    let targetValue: number | undefined = undefined;\n    if (targetTypeStr !== 'open') {\n        // Checks against string from DOM\n        targetValue = parseInt(targetValStr, 10);\n        if (isNaN(targetValue)) {\n            alert('Invalid target value');\n            return;\n        }\n    }\n\n    // Adapt to new WorkoutTarget structure\n    const target: WorkoutTarget = {\n        type: targetTypeStr === 'open' ? 'open' : 'power',\n        unit: targetTypeStr === 'percent_ftp' ? 'percent_ftp' : 'watts',\n        value: targetValue,\n    };\n\n    const step: WorkoutStep = {\n        type,\n        duration,\n        target,\n        name: nameStr ? nameStr : undefined,\n        description: nameStr || `${capitalize(type)} (${formatDuration(duration)})`,\n    };\n\n    currentSteps.push(step);\n    // clear Name input after add\n    (document.getElementById('wbStepName') as HTMLInputElement).value = '';\n\n    renderSteps();\n    announce(`Added step: ${step.description}`, 'polite');\n}\n\nfunction renderSteps(): void {\n    const list = document.getElementById('wbStepsList');\n    if (!list) return;\n\n    if (currentSteps.length === 0) {\n        list.innerHTML = `<div class=\"wb-step-empty\" style=\"text-align: center; color: var(--color-text-secondary); padding: 1rem; border: 1px dashed var(--color-border);\">\n                        No steps added yet.\n                    </div>`;\n        return;\n    }\n\n    list.innerHTML = '';\n\n    currentSteps.forEach((step, index) => {\n        const row = document.createElement('div');\n        row.className = 'wb-step-item';\n        // Add minimal styles inline for now, ideally strictly in CSS\n        row.style.background = 'var(--card-bg-hover)';\n        row.style.padding = '8px';\n        row.style.borderRadius = '4px';\n        row.style.display = 'flex';\n        row.style.justifyContent = 'space-between';\n        row.style.alignItems = 'center';\n        row.style.border = '1px solid var(--color-border)';\n\n        const t = step.target;\n        const desc = !t || t.type === 'open' ? 'Open effort' : `${t.value} ${t.unit === 'percent_ftp' ? '%' : 'W'}`;\n\n        row.innerHTML = `\n            <div>\n                <strong>${index + 1}. ${capitalize(step.type)}</strong> - ${formatDuration(step.duration)}\n                <div style=\"font-size: 0.85em; color: var(--color-text-secondary)\">${desc}</div>\n            </div>\n            <button class=\"remove-step-btn\" data-index=\"${index}\" style=\"color: var(--color-error); background: none; border: none; cursor: pointer;\"></button>\n        `;\n\n        list.appendChild(row);\n    });\n\n    // Add event listeners for remove buttons\n    list.querySelectorAll('.remove-step-btn').forEach((btn) => {\n        btn.addEventListener('click', (e) => {\n            const idx = parseInt((e.target as HTMLElement).getAttribute('data-index') || '-1', 10);\n            if (idx >= 0) {\n                currentSteps.splice(idx, 1);\n                renderSteps();\n            }\n        });\n    });\n}\n\nfunction saveWorkout(): void {\n    const name = (document.getElementById('wbName') as HTMLInputElement).value.trim();\n    const desc = (document.getElementById('wbDesc') as HTMLTextAreaElement).value.trim();\n\n    if (!name) {\n        alert('Please enter a workout name');\n        return;\n    }\n\n    if (currentSteps.length === 0) {\n        alert('Please add at least one step');\n        return;\n    }\n\n    const workout: StructuredWorkout = {\n        id: crypto.randomUUID(), // Native UUID\n        name,\n        description: desc,\n        steps: currentSteps,\n        tags: ['custom'],\n    };\n\n    saveCustomWorkout(workout);\n    refreshWorkoutList(); // Note: need to export this from workoutPlayer\n    closeBuilder();\n    announce(`Workout saved: ${name}`, 'assertive');\n}\n\nfunction capitalize(s: string): string {\n    return s.charAt(0).toUpperCase() + s.slice(1);\n}\n\nfunction formatDuration(sec: number): string {\n    const m = Math.floor(sec / 60);\n    const s = sec % 60;\n    if (m > 0) return `${m}m ${s}s`;\n    return `${s}s`;\n}\n","/**\n * Dark Mode Module\n * Handles theme switching and persistence for the app\n */\n\nimport { announce } from './accessibility.js';\n\nconst DARK_MODE_KEY = 'bpt-dark-mode';\n\nexport type ThemePreference = 'light' | 'dark' | 'system';\n\n/**\n * Get the stored theme preference from localStorage\n */\nexport function getStoredThemePreference(): ThemePreference | null {\n    try {\n        const stored = localStorage.getItem(DARK_MODE_KEY);\n        if (stored === 'light' || stored === 'dark' || stored === 'system') {\n            return stored;\n        }\n        return null;\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Save theme preference to localStorage\n */\nexport function saveThemePreference(preference: ThemePreference): void {\n    try {\n        localStorage.setItem(DARK_MODE_KEY, preference);\n    } catch {\n        // localStorage might not be available\n    }\n}\n\n/**\n * Check if the system prefers dark mode\n */\nexport function systemPrefersDark(): boolean {\n    return window.matchMedia('(prefers-color-scheme: dark)').matches;\n}\n\n/**\n * Apply the theme to the document\n */\nexport function applyTheme(theme: 'light' | 'dark'): void {\n    document.documentElement.setAttribute('data-theme', theme);\n}\n\n/**\n * Get the effective theme based on preference\n */\nexport function getEffectiveTheme(preference: ThemePreference): 'light' | 'dark' {\n    if (preference === 'system') {\n        return systemPrefersDark() ? 'dark' : 'light';\n    }\n    return preference;\n}\n\n/**\n * Check if dark mode is currently active\n */\nexport function isDarkMode(): boolean {\n    return document.documentElement.getAttribute('data-theme') === 'dark';\n}\n\n/**\n * Toggle dark mode on/off\n */\nexport function toggleDarkMode(): boolean {\n    const currentlyDark = isDarkMode();\n    const newTheme = currentlyDark ? 'light' : 'dark';\n    applyTheme(newTheme);\n    saveThemePreference(newTheme);\n    return !currentlyDark;\n}\n\n/**\n * Initialize dark mode based on stored preference or system preference\n */\nexport function initDarkMode(): boolean {\n    const stored = getStoredThemePreference();\n\n    if (stored) {\n        const effectiveTheme = getEffectiveTheme(stored);\n        applyTheme(effectiveTheme);\n        return effectiveTheme === 'dark';\n    }\n\n    // Default to system preference if no stored preference\n    const systemDark = systemPrefersDark();\n    if (systemDark) {\n        applyTheme('dark');\n    }\n    // Note: Don't save preference when using system default\n    return systemDark;\n}\n\n/**\n * Set up the dark mode toggle checkbox\n */\nexport function setupDarkModeToggle(toggleElement: HTMLInputElement): void {\n    // Initialize toggle state\n    const isDark = initDarkMode();\n    toggleElement.checked = isDark;\n\n    // Handle toggle changes\n    toggleElement.addEventListener('change', () => {\n        const newTheme = toggleElement.checked ? 'dark' : 'light';\n        applyTheme(newTheme);\n        saveThemePreference(newTheme);\n        announce(`Dark mode ${toggleElement.checked ? 'enabled' : 'disabled'}`);\n    });\n\n    // Listen for system preference changes (when using system theme)\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    mediaQuery.addEventListener('change', (e) => {\n        // Only auto-switch if user hasn't set a preference\n        const stored = getStoredThemePreference();\n        if (!stored || stored === 'system') {\n            const newTheme = e.matches ? 'dark' : 'light';\n            applyTheme(newTheme);\n            toggleElement.checked = e.matches;\n            announce(`Dark mode ${e.matches ? 'enabled' : 'disabled'}`);\n        }\n    });\n\n    // Listen for storage changes (sync across tabs)\n    window.addEventListener('storage', (e) => {\n        if (e.key === DARK_MODE_KEY) {\n            const newPreference = e.newValue as ThemePreference | null;\n            if (newPreference) {\n                const effectiveTheme = getEffectiveTheme(newPreference);\n                applyTheme(effectiveTheme);\n                toggleElement.checked = effectiveTheme === 'dark';\n            } else {\n                // If cleared, revert to system\n                const systemDark = systemPrefersDark();\n                applyTheme(systemDark ? 'dark' : 'light');\n                toggleElement.checked = systemDark;\n            }\n        }\n    });\n}\n","/**\n * Onboarding Flow\n *\n * First-run setup wizard for new users.\n * Guides users through:\n * - FTP (Functional Threshold Power) entry\n * - Max Heart Rate entry\n * - Weight entry\n * - Sensor pairing guide\n * - Feature tour\n *\n * @module onboarding\n */\n\nimport { announce, trapFocus } from './accessibility.js';\nimport { showNotification } from './notifications.js';\nimport { selectElement } from '../utils/dom.js';\n\nimport { type UserProfile, loadUserProfile, saveUserProfile } from '../storage/userSettings.js';\n\nexport { loadUserProfile, saveUserProfile };\nexport type { UserProfile };\n\n/**\n * Onboarding step configuration\n */\ninterface OnboardingStep {\n    id: string;\n    title: string;\n    icon: string;\n    content: string;\n    inputType?: 'number' | 'none';\n    inputLabel?: string;\n    inputPlaceholder?: string;\n    inputUnit?: string;\n    inputMin?: number;\n    inputMax?: number;\n    profileKey?: keyof UserProfile;\n    helpText?: string;\n}\n\n/**\n * Onboarding steps configuration\n */\nconst onboardingSteps: OnboardingStep[] = [\n    {\n        id: 'welcome',\n        title: 'Welcome to Bike Power Tracker!',\n        icon: '',\n        content: `\n            <p>Let's set up your profile for personalized training zones and better workout analysis.</p>\n            <p>This will only take a minute, and you can update these settings anytime.</p>\n        `,\n    },\n    {\n        id: 'ftp',\n        title: 'Functional Threshold Power (FTP)',\n        icon: '',\n        content: `\n            <p>Your FTP is the highest power you can sustain for about an hour.</p>\n            <p>If you don't know your FTP, you can skip this and do an FTP test later.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your FTP',\n        inputPlaceholder: 'e.g., 200',\n        inputUnit: 'watts',\n        inputMin: 50,\n        inputMax: 500,\n        profileKey: 'ftp',\n        helpText: 'Typical range: 100-400W for recreational to elite cyclists',\n    },\n    {\n        id: 'maxhr',\n        title: 'Maximum Heart Rate',\n        icon: '',\n        content: `\n            <p>Your max HR is used to calculate heart rate training zones.</p>\n            <p>A common estimate is 220 minus your age, but actual max HR varies.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Max HR',\n        inputPlaceholder: 'e.g., 185',\n        inputUnit: 'bpm',\n        inputMin: 100,\n        inputMax: 230,\n        profileKey: 'maxHr',\n        helpText: 'If unsure, use 220 - your age as a starting point',\n    },\n    {\n        id: 'weight',\n        title: 'Body Weight',\n        icon: '',\n        content: `\n            <p>Your weight is used to calculate power-to-weight ratio (W/kg), an important metric for climbing.</p>\n        `,\n        inputType: 'number',\n        inputLabel: 'Your Weight',\n        inputPlaceholder: 'e.g., 70',\n        inputUnit: 'kg',\n        inputMin: 30,\n        inputMax: 200,\n        profileKey: 'weight',\n        helpText: 'Used for calculating watts per kilogram (W/kg)',\n    },\n    {\n        id: 'sensors',\n        title: 'Connect Your Sensors',\n        icon: '',\n        content: `\n            <p>Bike Power Tracker works with Bluetooth cycling sensors:</p>\n            <ul style=\"text-align: left; margin: 16px auto; max-width: 280px;\">\n                <li><strong> Power Meter</strong> - Measures your power output in watts</li>\n                <li><strong> Cadence Sensor</strong> - Tracks your pedaling speed (RPM)</li>\n                <li><strong> Heart Rate Monitor</strong> - Monitors your heart rate</li>\n            </ul>\n            <p>Use the menu () to connect your sensors before starting a workout.</p>\n        `,\n    },\n    {\n        id: 'shortcuts',\n        title: 'Keyboard Shortcuts',\n        icon: '',\n        content: `\n            <p>Quick access to common actions:</p>\n            <table style=\"margin: 16px auto; text-align: left; border-collapse: collapse;\">\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Space</kbd></td><td>Start/pause workout</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>L</kbd></td><td>Mark lap</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>M</kbd></td><td>Open menu</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>S</kbd></td><td>Open settings</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>E</kbd></td><td>Export data</td></tr>\n                <tr><td style=\"padding: 4px 12px;\"><kbd>Escape</kbd></td><td>Close modal</td></tr>\n            </table>\n        `,\n    },\n    {\n        id: 'done',\n        title: \"You're All Set!\",\n        icon: '',\n        content: `\n            <p>Your profile has been saved. You can update your settings anytime from the menu.</p>\n            <p>Ready to start your first workout? Connect a sensor and press the <strong> Start</strong> button!</p>\n        `,\n    },\n];\n\n/**\n * Create the onboarding modal element\n */\nfunction createOnboardingModal(): HTMLElement {\n    const modal = document.createElement('div');\n    modal.id = 'onboardingModal';\n    modal.className = 'stream-modal';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-labelledby', 'onboardingTitle');\n    modal.setAttribute('aria-modal', 'true');\n    modal.style.display = 'none';\n\n    modal.innerHTML = `\n        <div class=\"stream-modal-content onboarding-modal\" style=\"max-width: 480px;\">\n            <div class=\"stream-modal-header\">\n                <h2 id=\"onboardingTitle\">\n                    <span id=\"onboardingIcon\"></span>\n                    <span id=\"onboardingStepTitle\">Welcome</span>\n                </h2>\n                <button id=\"skipOnboarding\" class=\"close-button\" aria-label=\"Skip onboarding\">&times;</button>\n            </div>\n            <div class=\"stream-modal-body\" style=\"text-align: center; padding: 24px;\">\n                <div id=\"onboardingContent\"></div>\n                <div id=\"onboardingInput\" style=\"margin: 20px 0; display: none;\">\n                    <label for=\"onboardingInputField\" id=\"onboardingInputLabel\" style=\"display: block; margin-bottom: 8px; font-weight: bold;\"></label>\n                    <div style=\"display: flex; align-items: center; justify-content: center; gap: 8px;\">\n                        <input type=\"number\" id=\"onboardingInputField\" \n                            style=\"width: 120px; padding: 12px; font-size: 18px; text-align: center; border: 2px solid #d0d7de; border-radius: 8px;\"\n                            aria-describedby=\"onboardingHelpText\">\n                        <span id=\"onboardingInputUnit\" style=\"font-size: 16px; color: #666;\"></span>\n                    </div>\n                    <p id=\"onboardingHelpText\" style=\"margin-top: 8px; font-size: 12px; color: #666;\"></p>\n                </div>\n                <div class=\"onboarding-progress\" style=\"margin: 24px 0;\">\n                    <div id=\"onboardingProgressDots\" style=\"display: flex; justify-content: center; gap: 8px;\"></div>\n                </div>\n                <div class=\"onboarding-buttons\" style=\"display: flex; justify-content: center; gap: 12px; margin-top: 20px;\">\n                    <button id=\"onboardingPrev\" style=\"padding: 12px 24px; border: 1px solid #d0d7de; background: white; border-radius: 8px; cursor: pointer; font-size: 16px;\">\n                         Back\n                    </button>\n                    <button id=\"onboardingNext\" style=\"padding: 12px 24px; border: none; background: #2196F3; color: white; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold;\">\n                        Next \n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Render progress dots\n */\nfunction renderProgressDots(container: HTMLElement, currentStep: number, totalSteps: number): void {\n    container.innerHTML = '';\n    for (let i = 0; i < totalSteps; i++) {\n        const dot = document.createElement('span');\n        dot.style.cssText = `\n            width: 10px;\n            height: 10px;\n            border-radius: 50%;\n            background: ${i === currentStep ? '#2196F3' : '#d0d7de'};\n            transition: background 0.3s ease;\n        `;\n        dot.setAttribute('aria-hidden', 'true');\n        container.appendChild(dot);\n    }\n}\n\n/**\n * Render a step in the onboarding flow\n */\nfunction renderStep(\n    step: OnboardingStep,\n    stepIndex: number,\n    profile: UserProfile,\n    elements: {\n        icon: HTMLElement;\n        title: HTMLElement;\n        content: HTMLElement;\n        inputContainer: HTMLElement;\n        inputField: HTMLInputElement;\n        inputLabel: HTMLElement;\n        inputUnit: HTMLElement;\n        helpText: HTMLElement;\n        prevBtn: HTMLButtonElement;\n        nextBtn: HTMLButtonElement;\n        progressDots: HTMLElement;\n    }\n): void {\n    const {\n        icon,\n        title,\n        content,\n        inputContainer,\n        inputField,\n        inputLabel,\n        inputUnit,\n        helpText,\n        prevBtn,\n        nextBtn,\n        progressDots,\n    } = elements;\n\n    // Update header\n    icon.textContent = step.icon;\n    title.textContent = step.title;\n\n    // Update content\n    content.innerHTML = step.content;\n\n    // Handle input\n    if (step.inputType === 'number' && step.profileKey) {\n        inputContainer.style.display = 'block';\n        inputLabel.textContent = step.inputLabel || '';\n        inputField.placeholder = step.inputPlaceholder || '';\n        inputField.min = String(step.inputMin || 0);\n        inputField.max = String(step.inputMax || 9999);\n        inputUnit.textContent = step.inputUnit || '';\n        helpText.textContent = step.helpText || '';\n\n        // Load existing value\n        const currentValue = profile[step.profileKey];\n        inputField.value = currentValue ? String(currentValue) : '';\n        inputField.focus();\n    } else {\n        inputContainer.style.display = 'none';\n    }\n\n    // Update buttons\n    prevBtn.style.display = stepIndex === 0 ? 'none' : 'inline-block';\n\n    if (stepIndex === onboardingSteps.length - 1) {\n        nextBtn.textContent = 'Get Started! ';\n    } else if (step.inputType === 'number') {\n        nextBtn.textContent = 'Next ';\n    } else {\n        nextBtn.textContent = 'Next ';\n    }\n\n    // Update progress dots\n    renderProgressDots(progressDots, stepIndex, onboardingSteps.length);\n\n    // Announce for screen readers\n    announce(`Step ${stepIndex + 1} of ${onboardingSteps.length}: ${step.title}`);\n}\n\n/**\n * Show the onboarding flow\n */\nexport function showOnboarding(forceShow = false): Promise<UserProfile> {\n    return new Promise((resolve) => {\n        const profile = loadUserProfile();\n\n        // Check if onboarding should be shown\n        if (!forceShow && profile.onboardingComplete) {\n            resolve(profile);\n            return;\n        }\n\n        // Create modal if it doesn't exist\n        let modal = document.getElementById('onboardingModal');\n        if (!modal) {\n            modal = createOnboardingModal();\n            document.body.appendChild(modal);\n        }\n\n        // Get elements\n        const icon = selectElement('onboardingIcon');\n        const title = selectElement('onboardingStepTitle');\n        const content = selectElement('onboardingContent');\n        const inputContainer = selectElement('onboardingInput');\n        const inputField = selectElement<HTMLInputElement>('onboardingInputField');\n        const inputLabel = selectElement('onboardingInputLabel');\n        const inputUnit = selectElement('onboardingInputUnit');\n        const helpText = selectElement('onboardingHelpText');\n        const prevBtn = selectElement<HTMLButtonElement>('onboardingPrev');\n        const nextBtn = selectElement<HTMLButtonElement>('onboardingNext');\n        const skipBtn = selectElement<HTMLButtonElement>('skipOnboarding');\n        const progressDots = selectElement('onboardingProgressDots');\n\n        const elements = {\n            icon,\n            title,\n            content,\n            inputContainer,\n            inputField,\n            inputLabel,\n            inputUnit,\n            helpText,\n            prevBtn,\n            nextBtn,\n            progressDots,\n        };\n\n        let currentStep = 0;\n\n        // Save input value for current step\n        const saveCurrentInput = (): void => {\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number' && step.profileKey) {\n                const value = inputField.value ? parseFloat(inputField.value) : null;\n                if (step.profileKey !== 'onboardingComplete' && step.profileKey !== 'lastUpdated') {\n                    // Type assertion since we know these are number | null fields\n                    (profile[step.profileKey] as number | null) = value;\n                }\n            }\n        };\n\n        // Render current step\n        const render = (): void => {\n            renderStep(onboardingSteps[currentStep], currentStep, profile, elements);\n        };\n\n        // Navigation handlers\n        const goNext = (): void => {\n            // Validate input if it's a number step\n            const step = onboardingSteps[currentStep];\n            if (step.inputType === 'number') {\n                if (!inputField.checkValidity()) {\n                    inputField.reportValidity();\n                    return;\n                }\n            }\n\n            saveCurrentInput();\n\n            if (currentStep < onboardingSteps.length - 1) {\n                currentStep++;\n                render();\n            } else {\n                // Complete onboarding\n                profile.onboardingComplete = true;\n                saveUserProfile(profile);\n                modal!.style.display = 'none';\n                showNotification('Profile saved! Ready to ride ', 'success');\n                announce('Onboarding complete. Profile saved.');\n                resolve(profile);\n            }\n        };\n\n        const goPrev = (): void => {\n            saveCurrentInput();\n            if (currentStep > 0) {\n                currentStep--;\n                render();\n            }\n        };\n\n        const skip = (): void => {\n            profile.onboardingComplete = true;\n            saveUserProfile(profile);\n            modal!.style.display = 'none';\n            announce('Onboarding skipped');\n            resolve(profile);\n        };\n\n        // Event listeners\n        nextBtn.addEventListener('click', goNext);\n        prevBtn.addEventListener('click', goPrev);\n        skipBtn.addEventListener('click', skip);\n\n        // Enter key advances\n        inputField.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                goNext();\n            }\n        });\n\n        // Show modal\n        modal.style.display = 'flex';\n        render();\n        trapFocus(modal.querySelector('.stream-modal-content')!);\n    });\n}\n\n/**\n * Check if user should see onboarding\n */\nexport function shouldShowOnboarding(): boolean {\n    const profile = loadUserProfile();\n    return !profile.onboardingComplete;\n}\n\n/**\n * Initialize onboarding - shows wizard if first run\n */\nexport function initOnboarding(): void {\n    if (shouldShowOnboarding()) {\n        // Small delay to let the app render first\n        setTimeout(() => {\n            showOnboarding();\n        }, 500);\n    }\n}\n\n/**\n * Calculate power zones based on FTP (Coggan 7-zone model)\n */\nexport function calculatePowerZones(ftp: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Active Recovery', min: 0, max: Math.round(ftp * 0.55) },\n        { name: 'Endurance', min: Math.round(ftp * 0.55), max: Math.round(ftp * 0.75) },\n        { name: 'Tempo', min: Math.round(ftp * 0.75), max: Math.round(ftp * 0.9) },\n        { name: 'Threshold', min: Math.round(ftp * 0.9), max: Math.round(ftp * 1.05) },\n        { name: 'VO2max', min: Math.round(ftp * 1.05), max: Math.round(ftp * 1.2) },\n        { name: 'Anaerobic', min: Math.round(ftp * 1.2), max: Math.round(ftp * 1.5) },\n        { name: 'Neuromuscular', min: Math.round(ftp * 1.5), max: 9999 },\n    ];\n}\n\n/**\n * Calculate heart rate zones based on max HR (5-zone model)\n */\nexport function calculateHrZones(maxHr: number): { name: string; min: number; max: number }[] {\n    return [\n        { name: 'Recovery', min: Math.round(maxHr * 0.5), max: Math.round(maxHr * 0.6) },\n        { name: 'Aerobic', min: Math.round(maxHr * 0.6), max: Math.round(maxHr * 0.7) },\n        { name: 'Tempo', min: Math.round(maxHr * 0.7), max: Math.round(maxHr * 0.8) },\n        { name: 'Threshold', min: Math.round(maxHr * 0.8), max: Math.round(maxHr * 0.9) },\n        { name: 'Anaerobic', min: Math.round(maxHr * 0.9), max: maxHr },\n    ];\n}\n\n/**\n * Get current power zone for a given wattage\n */\nexport function getPowerZone(power: number, ftp: number): { zone: number; name: string } | null {\n    const zones = calculatePowerZones(ftp);\n    for (let i = 0; i < zones.length; i++) {\n        if (power >= zones[i].min && power < zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n\n/**\n * Get current HR zone for a given heart rate\n */\nexport function getHrZone(hr: number, maxHr: number): { zone: number; name: string } | null {\n    const zones = calculateHrZones(maxHr);\n    for (let i = 0; i < zones.length; i++) {\n        if (hr >= zones[i].min && hr <= zones[i].max) {\n            return { zone: i + 1, name: zones[i].name };\n        }\n    }\n    return null;\n}\n","/**\n * Workout Recovery\n *\n * Handles detection and recovery of interrupted workouts from IndexedDB.\n * Shows a modal to the user when a recoverable workout is found.\n *\n * @module ui/workoutRecovery\n */\n\nimport {\n    loadActiveWorkout,\n    clearActiveWorkout,\n    hasRecoverableWorkout,\n    type ActiveWorkoutRecord,\n} from '../storage/workoutStorage.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport type { ConnectionManager } from '../initConnectionButtons.js';\n\n/**\n * Format elapsed time as human-readable string\n */\nfunction formatElapsedTime(ms: number): string {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n\n    if (hours > 0) {\n        return `${hours}h ${minutes % 60}m`;\n    } else if (minutes > 0) {\n        return `${minutes}m ${seconds % 60}s`;\n    }\n    return `${seconds}s`;\n}\n\n/**\n * Format timestamp as human-readable date/time\n */\nfunction formatTime(timestamp: number): string {\n    return new Date(timestamp).toLocaleString();\n}\n\n/**\n * Create the recovery modal HTML\n */\nfunction createRecoveryModal(workout: ActiveWorkoutRecord): HTMLDialogElement {\n    const modal = document.createElement('dialog');\n    modal.id = 'workout-recovery-modal';\n    modal.className = 'modal';\n    modal.setAttribute('aria-labelledby', 'recovery-modal-title');\n\n    const dataPoints = workout.power.length + workout.heartrate.length + workout.cadence.length;\n    const elapsedTime = workout.lastUpdated - workout.startTime;\n\n    modal.innerHTML = `\n        <div class=\"modal-content\">\n            <h2 id=\"recovery-modal-title\"> Recover Workout?</h2>\n            <p>An interrupted workout was found from your last session.</p>\n            \n            <div class=\"recovery-summary\">\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Started</span>\n                    <span class=\"recovery-stat-value\">${formatTime(workout.startTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Duration</span>\n                    <span class=\"recovery-stat-value\">${formatElapsedTime(elapsedTime)}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Data Points</span>\n                    <span class=\"recovery-stat-value\">${dataPoints.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Power Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.power.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Heart Rate Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.heartrate.length.toLocaleString()}</span>\n                </div>\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Cadence Readings</span>\n                    <span class=\"recovery-stat-value\">${workout.cadence.length.toLocaleString()}</span>\n                </div>\n                ${workout.laps.length > 0\n            ? `\n                <div class=\"recovery-stat\">\n                    <span class=\"recovery-stat-label\">Laps</span>\n                    <span class=\"recovery-stat-value\">${workout.laps.length}</span>\n                </div>\n                `\n            : ''\n        }\n            </div>\n            \n            <div class=\"modal-actions\">\n                <button type=\"button\" id=\"recovery-restore-btn\" class=\"btn btn-primary\">\n                     Restore Workout\n                </button>\n                <button type=\"button\" id=\"recovery-discard-btn\" class=\"btn btn-secondary\">\n                     Start Fresh\n                </button>\n            </div>\n        </div>\n    `;\n\n    return modal;\n}\n\n/**\n * Add styles for the recovery modal\n */\nfunction addRecoveryStyles(): void {\n    if (document.getElementById('recovery-modal-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'recovery-modal-styles';\n    style.textContent = `\n        #workout-recovery-modal {\n            max-width: 400px;\n        }\n        \n        .recovery-summary {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 0.75rem;\n            margin: 1.5rem 0;\n            padding: 1rem;\n            background: var(--surface-2, #2a2a2a);\n            border-radius: 8px;\n        }\n        \n        .recovery-stat {\n            display: flex;\n            flex-direction: column;\n            gap: 0.25rem;\n        }\n        \n        .recovery-stat-label {\n            font-size: 0.75rem;\n            color: var(--text-muted, #888);\n            text-transform: uppercase;\n            letter-spacing: 0.05em;\n        }\n        \n        .recovery-stat-value {\n            font-size: 1rem;\n            font-weight: 600;\n            color: var(--text-primary, #fff);\n        }\n        \n        #workout-recovery-modal .modal-actions {\n            display: flex;\n            flex-direction: column;\n            gap: 0.75rem;\n            margin-top: 1.5rem;\n        }\n        \n        #workout-recovery-modal .btn {\n            width: 100%;\n            padding: 0.875rem 1.5rem;\n            font-size: 1rem;\n        }\n    `;\n\n    document.head.appendChild(style);\n}\n\n/**\n * Show the recovery modal and wait for user decision\n */\nasync function showRecoveryModal(workout: ActiveWorkoutRecord): Promise<'restore' | 'discard'> {\n    addRecoveryStyles();\n\n    const modal = createRecoveryModal(workout);\n    document.body.appendChild(modal);\n\n    return new Promise((resolve) => {\n        const restoreBtn = modal.querySelector('#recovery-restore-btn') as HTMLButtonElement;\n        const discardBtn = modal.querySelector('#recovery-discard-btn') as HTMLButtonElement;\n\n        const cleanup = () => {\n            modal.close();\n            modal.remove();\n        };\n\n        restoreBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('restore');\n        });\n\n        discardBtn.addEventListener('click', () => {\n            cleanup();\n            resolve('discard');\n        });\n\n        // Handle escape key\n        modal.addEventListener('cancel', (e) => {\n            e.preventDefault(); // Don't close on escape - force user to choose\n        });\n\n        modal.showModal();\n    });\n}\n\n/**\n * Check for and handle workout recovery\n *\n * @param measurementsState - The measurements state to restore to\n * @param timeState - The time state to restore to\n * @param connectionManager - Manager for reconnecting sensors\n * @returns True if a workout was recovered\n */\nexport async function initWorkoutRecovery(\n    measurementsState: MeasurementsState,\n    timeState: TimeState,\n    connectionManager: ConnectionManager\n): Promise<boolean> {\n    try {\n        // Check if there's a recoverable workout\n        if (!(await hasRecoverableWorkout())) {\n            return false;\n        }\n\n        // Load the workout data\n        const workout = await loadActiveWorkout();\n        if (!workout) {\n            return false;\n        }\n\n        // Show recovery modal and get user choice\n        const choice = await showRecoveryModal(workout);\n\n        if (choice === 'restore') {\n            // Restore the workout data\n            measurementsState.restore(\n                {\n                    heartrate: workout.heartrate,\n                    power: workout.power,\n                    cadence: workout.cadence,\n                    speed: workout.speed,\n                    distance: workout.distance,\n                    altitude: workout.altitude,\n                    laps: workout.laps,\n                    gps: workout.gps || [],\n                },\n                workout.startTime\n            );\n\n            // Restore time state\n            timeState.startTime = workout.startTime;\n            timeState.running = false; // Don't auto-resume - let user reconnect sensors\n\n            console.log(`Restored workout with ${workout.power.length} power readings`);\n\n            // Auto-reconnect sensors\n            console.log('Attempting to reconnect sensors...');\n            connectionManager.reconnectStored().catch(console.error);\n\n            return true;\n        } else {\n            // User chose to discard\n            await clearActiveWorkout();\n            console.log('User discarded recovered workout');\n            return false;\n        }\n    } catch (error) {\n        console.error('Error during workout recovery:', error);\n        return false;\n    }\n}\n\n/**\n * Clear any pending workout data (for testing or manual cleanup)\n */\nexport async function clearRecoverableWorkout(): Promise<void> {\n    await clearActiveWorkout();\n}\n","/**\n * PWA Install Prompt\n *\n * Handles the PWA installation prompt for supported browsers.\n *\n * @module installPrompt\n */\n\n/**\n * Deferred install prompt event\n */\nlet deferredPrompt: BeforeInstallPromptEvent | null = null;\n\n/**\n * Extended event interface for beforeinstallprompt\n */\ninterface BeforeInstallPromptEvent extends Event {\n    prompt(): Promise<void>;\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\n/**\n * Initialize the PWA install prompt handler.\n *\n * Listens for the beforeinstallprompt event and captures it for later use.\n */\nexport const initInstallPrompt = (): void => {\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    // Listen for the beforeinstallprompt event\n    window.addEventListener('beforeinstallprompt', (e: Event) => {\n        // Prevent the mini-infobar from appearing on mobile\n        e.preventDefault();\n\n        // Stash the event so it can be triggered later\n        deferredPrompt = e as BeforeInstallPromptEvent;\n\n        // Update install button visibility in settings\n        updateInstallButtonVisibility();\n    });\n\n    // Listen for the app installed event\n    window.addEventListener('appinstalled', () => {\n        console.log('PWA was installed successfully');\n        deferredPrompt = null;\n        updateInstallButtonVisibility();\n    });\n};\n\n/**\n * Check if the app can be installed.\n * @returns true if install is available\n */\nexport const canInstallPwa = (): boolean => {\n    return deferredPrompt !== null;\n};\n\n/**\n * Trigger the PWA install prompt.\n * @returns Promise that resolves to the user's choice outcome\n */\nexport const triggerInstallPrompt = async (): Promise<'accepted' | 'dismissed' | 'unavailable'> => {\n    if (!deferredPrompt) {\n        return 'unavailable';\n    }\n\n    try {\n        // Show the install prompt\n        await deferredPrompt.prompt();\n\n        // Wait for the user to respond to the prompt\n        const { outcome } = await deferredPrompt.userChoice;\n        console.log(`User response to the install prompt: ${outcome}`);\n\n        // Clear the deferredPrompt\n        deferredPrompt = null;\n        updateInstallButtonVisibility();\n\n        return outcome;\n    } catch (error) {\n        console.error('Error triggering install prompt:', error);\n        return 'unavailable';\n    }\n};\n\n/**\n * Update the visibility of install buttons based on availability.\n */\nconst updateInstallButtonVisibility = (): void => {\n    const installButton = document.getElementById('installPwaButton');\n    const installButtonContainer = document.getElementById('installPwaContainer');\n\n    if (installButton) {\n        installButton.style.display = canInstallPwa() ? 'block' : 'none';\n    }\n\n    if (installButtonContainer) {\n        installButtonContainer.style.display = canInstallPwa() ? 'block' : 'none';\n    }\n};\n","/**\n * Wake Lock Handler\n *\n * Keeps the screen awake during workouts using the Screen Wake Lock API.\n *\n * @module wakeLock\n */\n\n/**\n * Initialize wake lock to keep the screen awake.\n *\n * Requests a screen wake lock when the page is visible,\n * and re-requests it if the page visibility changes.\n */\nexport const handleWakeLock = (): void => {\n    let wakeLock: WakeLockSentinel | null = null;\n\n    /**\n     * Request a screen wake lock\n     */\n    const requestWakeLock = async (): Promise<void> => {\n        try {\n            if ('wakeLock' in navigator) {\n                wakeLock = await navigator.wakeLock.request('screen');\n                console.log('Screen wake lock activated');\n\n                // Re-request wake lock if page becomes visible again\n                wakeLock.addEventListener('release', () => {\n                    console.log('Screen wake lock released');\n                });\n            }\n        } catch (err) {\n            console.error('Wake lock request failed:', err);\n        }\n    };\n\n    // Request wake lock when page loads\n    if (document.visibilityState === 'visible') {\n        requestWakeLock();\n    }\n\n    // Re-request wake lock when page becomes visible\n    document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n            requestWakeLock();\n        }\n    });\n};\n","// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = () => {\n        wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","/**\n * Service Worker Registration\n *\n * Handles PWA service worker registration using vite-plugin-pwa.\n *\n * @module serviceWorker\n */\n\nimport { registerSW } from 'virtual:pwa-register';\nimport { Capacitor } from '@capacitor/core';\n\n/**\n * Update callback type\n */\ntype UpdateCallback = (reloadPage?: boolean) => Promise<void>;\n\n/**\n * Register the service worker for PWA functionality.\n *\n * In development mode, service workers are disabled to avoid caching issues.\n * In production, registers the service worker and handles updates.\n */\nexport const registerServiceWorker = (): void => {\n    // Capacitor apps should not use service workers. They can cause hard-to-debug\n    // caching and asset-loading issues in Android WebView.\n    if (Capacitor.isNativePlatform()) {\n        console.log('Service Worker disabled on native platform');\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                }\n            });\n        }\n        return;\n    }\n\n    // Don't register service worker in development to avoid caching issues\n    if (import.meta.env.DEV) {\n        console.log('Service Worker disabled in development mode');\n        // Unregister existing service workers if any to ensure fresh content\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.getRegistrations().then((registrations) => {\n                for (const registration of registrations) {\n                    registration.unregister();\n                    console.log('Unregistered existing service worker');\n                }\n            });\n        }\n        return;\n    }\n\n    // Skip in test mode\n    if (import.meta.env.MODE === 'test') {\n        return;\n    }\n\n    const updateSW = registerSW({\n        onNeedRefresh() {\n            showUpdateNotification(updateSW);\n        },\n        onOfflineReady() {\n            console.log('App ready to work offline');\n        },\n        onRegistered(registration?: ServiceWorkerRegistration) {\n            console.log('Service Worker registered successfully');\n\n            // Check for updates periodically (every hour)\n            if (registration) {\n                setInterval(\n                    () => {\n                        registration.update();\n                    },\n                    60 * 60 * 1000\n                );\n            }\n        },\n        onRegisterError(error: Error) {\n            console.log('Service Worker registration failed:', error);\n        },\n    });\n};\n\n/**\n * Show update notification when a new version is available.\n *\n * @param updateSW - Function to trigger the update\n */\nconst showUpdateNotification = (updateSW: UpdateCallback): void => {\n    const updateContainer = document.getElementById('updateNotification');\n    if (!updateContainer) return;\n\n    updateContainer.style.display = 'block';\n\n    const updateButton = document.getElementById('updateButton');\n    updateButton?.addEventListener(\n        'click',\n        () => {\n            updateSW(true); // Force reload after update\n        },\n        { once: true }\n    );\n\n    const dismissUpdateButton = document.getElementById('dismissUpdate');\n    dismissUpdateButton?.addEventListener(\n        'click',\n        () => {\n            updateContainer.style.display = 'none';\n        },\n        { once: true }\n    );\n};\n","import L from 'leaflet';\nimport type { MeasurementsState } from '../measurements-state.js';\n\nexport class MapComponent {\n    private state: MeasurementsState;\n    private map: L.Map | null = null;\n    private routeLine: L.Polyline | null = null;\n    private currentPosMarker: L.CircleMarker | null = null;\n    private mounted: boolean = false;\n    private animationFrameId: number | null = null;\n    private lastGpsCount: number = 0;\n\n    // Configuration\n    private readonly defaultZoom = 15;\n    private readonly followUser = true;\n\n    constructor(state: MeasurementsState) {\n        this.state = state;\n    }\n\n    public mount(elementId: string): void {\n        const element = document.getElementById(elementId);\n        if (!element) {\n            console.warn(`MapComponent: Element with ID \"${elementId}\" not found.`);\n            return;\n        }\n\n        // Initialize Leaflet map\n        // Start with a world view, will center on GPS update\n        this.map = L.map(elementId);\n\n        // If we have GPS data, use the last point, otherwise 0,0\n        const hasData = this.state.gps.length > 0;\n        const initialLat = hasData ? this.state.gps[this.state.gps.length - 1].lat : 0;\n        const initialLon = hasData ? this.state.gps[this.state.gps.length - 1].lon : 0;\n        const initialZoom = hasData ? this.defaultZoom : 2;\n\n        this.map.setView([initialLat, initialLon], initialZoom);\n\n        // Add OpenStreetMap tile layer\n        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n        }).addTo(this.map);\n\n        // Create route polyline\n        this.routeLine = L.polyline([], {\n            color: 'var(--color-primary, #007bff)', // Use CSS var if available\n            weight: 5,\n            opacity: 0.7,\n        }).addTo(this.map);\n\n        // Create current position marker (using CircleMarker to avoid icon issues)\n        this.currentPosMarker = L.circleMarker([initialLat, initialLon], {\n            radius: 8,\n            fillColor: 'var(--color-accent, #28a745)',\n            color: '#ffffff',\n            weight: 2,\n            opacity: 1,\n            fillOpacity: 0.8,\n        });\n\n        // Only add marker if we actually have data\n        if (hasData) {\n            this.currentPosMarker.addTo(this.map);\n        }\n\n        this.mounted = true;\n        this.lastGpsCount = 0;\n\n        // Start update loop\n        this.startLoop();\n\n        // Force an immediate update to draw existing path\n        this.update();\n\n        // Handle Map Resize issues\n        setTimeout(() => {\n            this.map?.invalidateSize();\n        }, 100);\n    }\n\n    public unmount(): void {\n        this.mounted = false;\n        if (this.animationFrameId !== null) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n\n        if (this.map) {\n            this.map.remove();\n            this.map = null;\n        }\n        this.routeLine = null;\n        this.currentPosMarker = null;\n    }\n\n    public update(): void {\n        if (!this.mounted || !this.map || !this.routeLine || !this.currentPosMarker) {\n            return;\n        }\n\n        const gpsData = this.state.gps;\n\n        // Optimization: only update if data changed or we haven't drawn fully\n        if (gpsData.length === this.lastGpsCount) {\n            return;\n        }\n\n        const points = gpsData.map((p) => [p.lat, p.lon] as [number, number]);\n\n        // Update polyline\n        this.routeLine.setLatLngs(points);\n\n        if (gpsData.length > 0) {\n            const lastPoint = gpsData[gpsData.length - 1];\n            const latLng: [number, number] = [lastPoint.lat, lastPoint.lon];\n\n            // Update marker\n            this.currentPosMarker.setLatLng(latLng);\n\n            // Ensure marker is on map\n            if (!this.map.hasLayer(this.currentPosMarker)) {\n                this.currentPosMarker.addTo(this.map);\n            }\n\n            // Follow user logic\n            if (this.followUser) {\n                // Only pan if we are reasonably far from center to avoid jitter\n                // Or just use setView if it's the first few points\n                if (this.lastGpsCount === 0) {\n                    this.map.setView(latLng, this.defaultZoom);\n                } else {\n                    // Maybe check distance before panning?\n                    // For now, keep it simple and just pan to keep user in view\n                    // But avoid blocking UI if it updates too fast.\n                    // Since update() is in Raf this should be ok.\n                    this.map.panTo(latLng, { animate: true });\n                }\n            }\n        }\n\n        this.lastGpsCount = gpsData.length;\n    }\n\n    private startLoop(): void {\n        const loop = () => {\n            if (!this.mounted) return;\n            this.update();\n            this.animationFrameId = requestAnimationFrame(loop);\n        };\n        this.animationFrameId = requestAnimationFrame(loop);\n    }\n\n    /**\n     * Call this when container is resized\n     */\n    public resize(): void {\n        this.map?.invalidateSize();\n    }\n}\n","import { MapComponent } from '../ui/map-component.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { ConnectionsState } from '../types/connections.js';\n\n/**\n * Initialize the GPS Map component and toggle controls\n */\nexport function initMap(measurementsState: MeasurementsState, connectionsState: ConnectionsState) {\n    const mapContainerId = 'gpsMap';\n    const toggleBtnId = 'toggleMapBtn';\n    const carouselId = 'dataFieldsCarousel';\n\n    const toggleBtn = document.getElementById(toggleBtnId);\n    const mapContainer = document.getElementById(mapContainerId);\n    const carousel = document.getElementById(carouselId);\n\n    if (!toggleBtn || !mapContainer || !carousel) {\n        console.warn('Map initialization failed: Missing elements');\n        return;\n    }\n\n    const mapComponent = new MapComponent(measurementsState);\n    let isMapVisible = false;\n\n    // Initially hidden\n    toggleBtn.style.display = 'none';\n\n    // Toggle logic\n    toggleBtn.addEventListener('click', () => {\n        isMapVisible = !isMapVisible;\n\n        if (isMapVisible) {\n            // Show Map\n            carousel.style.display = 'none';\n            mapContainer.style.display = 'block';\n            toggleBtn.classList.add('active');\n            toggleBtn.style.background = '#ccc'; // Visual feedback\n\n            // Mount if first time, or just update visibility logic handled internally\n            // Note: MapComponent.mount checks if already mounted\n            mapComponent.mount(mapContainerId);\n\n            // Force resize calculation since it was hidden\n            setTimeout(() => {\n                mapComponent.resize();\n            }, 100);\n        } else {\n            // Show Metrics\n            mapContainer.style.display = 'none';\n            carousel.style.display = 'block';\n            toggleBtn.classList.remove('active');\n            toggleBtn.style.background = ''; // Reset\n\n            // mapComponent.unmount(); // Optional: keep state\n        }\n    });\n\n    // Monitor GPS status to enable the button\n    // Simple polling since ConnectionState doesn't emit events directly in this architecture (yet)\n    setInterval(() => {\n        const hasGpsData = measurementsState.gps.length > 0;\n        const isConnected = connectionsState.gps?.isConnected;\n\n        if (isConnected || hasGpsData) {\n            if (toggleBtn.style.display === 'none') {\n                toggleBtn.style.display = 'inline-block';\n            }\n        }\n    }, 2000);\n}\n","/**\n * Auto-Pause Service\n *\n * Automatically pauses workout recording when the monitored metric\n * (speed, power, or cadence) drops below a configurable threshold.\n * Automatically resumes when the metric exceeds the threshold.\n *\n * @module AutoPauseService\n */\n\nimport { getSettings, type AutoPauseSource } from '../config/settings.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\n\n/**\n * Callbacks for auto-pause/resume actions\n */\nexport interface AutoPauseCallbacks {\n    /** Called when auto-pause triggers */\n    onAutoPause: () => void;\n    /** Called when auto-resume triggers */\n    onAutoResume: () => void;\n}\n\n/**\n * Auto-pause state\n */\ninterface AutoPauseState {\n    /** Whether currently auto-paused */\n    isAutoPaused: boolean;\n    /** Timestamp when metric dropped below threshold */\n    belowThresholdSince: number | null;\n    /** Timer ID for delayed pause */\n    delayTimer: ReturnType<typeof setTimeout> | null;\n}\n\n/**\n * Service that monitors metrics and auto-pauses/resumes workouts\n */\nexport class AutoPauseService {\n    private measurementsState: MeasurementsState;\n    private timeState: TimeState;\n    private callbacks: AutoPauseCallbacks;\n    private state: AutoPauseState;\n    private changeCallback: (() => void) | null = null;\n\n    constructor(measurementsState: MeasurementsState, timeState: TimeState, callbacks: AutoPauseCallbacks) {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n        this.callbacks = callbacks;\n        this.state = {\n            isAutoPaused: false,\n            belowThresholdSince: null,\n            delayTimer: null,\n        };\n    }\n\n    /**\n     * Start monitoring for auto-pause\n     */\n    start(): void {\n        this.stop(); // Clean up any existing subscription\n\n        const settings = getSettings();\n        if (!settings.autoPause.enabled) {\n            console.log('[AutoPause] Disabled, not starting');\n            return;\n        }\n\n        console.log('[AutoPause] Starting with settings:', settings.autoPause);\n\n        // Subscribe to measurement changes\n        this.changeCallback = () => this.checkMetric();\n        this.measurementsState.onChange(this.changeCallback);\n\n        // Also check periodically in case no measurements come in\n        this.startPeriodicCheck();\n    }\n\n    /**\n     * Stop monitoring\n     */\n    stop(): void {\n        if (this.changeCallback) {\n            this.measurementsState.offChange(this.changeCallback);\n            this.changeCallback = null;\n        }\n        this.clearDelayTimer();\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n        this.state = {\n            isAutoPaused: false,\n            belowThresholdSince: null,\n            delayTimer: null,\n        };\n        console.log('[AutoPause] Stopped');\n    }\n\n    /**\n     * Check if we're currently auto-paused\n     */\n    get isAutoPaused(): boolean {\n        return this.state.isAutoPaused;\n    }\n\n    /**\n     * Get the current metric value based on source setting\n     */\n    private getCurrentValue(source: AutoPauseSource): number | null {\n        const now = Date.now();\n        const lookbackMs = 5000; // Look at last 5 seconds of data\n        const minTimestamp = now - lookbackMs;\n\n        let measurements: { timestamp: number; value: number }[];\n        switch (source) {\n            case 'speed':\n                measurements = this.measurementsState.speed;\n                break;\n            case 'power':\n                measurements = this.measurementsState.power;\n                break;\n            case 'cadence':\n                measurements = this.measurementsState.cadence;\n                break;\n            default:\n                return null;\n        }\n\n        // Get recent measurements\n        const recentMeasurements = measurements.filter((m) => m.timestamp >= minTimestamp);\n\n        if (recentMeasurements.length === 0) {\n            return null; // No recent data\n        }\n\n        // Use the most recent value\n        const latest = recentMeasurements[recentMeasurements.length - 1];\n        return latest.value;\n    }\n\n    /**\n     * Check the metric and trigger pause/resume if needed\n     */\n    private checkMetric(): void {\n        const settings = getSettings();\n        if (!settings.autoPause.enabled) {\n            return;\n        }\n\n        // Only check when workout is in a valid state\n        if (!this.timeState.startTime) {\n            return; // Workout not started\n        }\n\n        const { source, threshold, delay } = settings.autoPause;\n        const currentValue = this.getCurrentValue(source);\n\n        // Handle case where no data is available\n        if (currentValue === null) {\n            // If we haven't received any data yet, don't auto-pause\n            // This prevents pausing immediately when starting a workout\n            return;\n        }\n\n        const isAboveThreshold = currentValue >= threshold;\n        const now = Date.now();\n\n        if (isAboveThreshold) {\n            // Metric is above threshold\n            this.clearDelayTimer();\n            this.state.belowThresholdSince = null;\n\n            if (this.state.isAutoPaused && !this.timeState.running) {\n                // Resume the workout\n                console.log(`[AutoPause] Resuming - ${source} at ${currentValue.toFixed(1)} (threshold: ${threshold})`);\n                this.state.isAutoPaused = false;\n                this.callbacks.onAutoResume();\n            }\n        } else {\n            // Metric is below threshold\n            if (!this.state.belowThresholdSince) {\n                this.state.belowThresholdSince = now;\n            }\n\n            const timeBelow = now - this.state.belowThresholdSince;\n            const delayMs = delay * 1000;\n\n            if (!this.state.isAutoPaused && this.timeState.running && timeBelow >= delayMs) {\n                // Pause the workout\n                console.log(\n                    `[AutoPause] Pausing - ${source} at ${currentValue.toFixed(1)} (threshold: ${threshold}) for ${(timeBelow / 1000).toFixed(1)}s`\n                );\n                this.state.isAutoPaused = true;\n                this.callbacks.onAutoPause();\n            }\n        }\n    }\n\n    /**\n     * Clear the delay timer\n     */\n    private clearDelayTimer(): void {\n        if (this.state.delayTimer) {\n            clearTimeout(this.state.delayTimer);\n            this.state.delayTimer = null;\n        }\n    }\n\n    /**\n     * Start periodic check (in case no new measurements come in)\n     */\n    private intervalId: ReturnType<typeof setInterval> | null = null;\n\n    private startPeriodicCheck(): void {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n        }\n        // Check every second\n        this.intervalId = setInterval(() => {\n            this.checkMetric();\n        }, 1000);\n    }\n\n    /**\n     * Reset the auto-pause state (call when workout is reset)\n     */\n    reset(): void {\n        this.stop();\n        this.state = {\n            isAutoPaused: false,\n            belowThresholdSince: null,\n            delayTimer: null,\n        };\n    }\n\n    /**\n     * Get status info for debugging/display\n     */\n    getStatus(): {\n        enabled: boolean;\n        isAutoPaused: boolean;\n        source: AutoPauseSource;\n        threshold: number;\n        currentValue: number | null;\n    } {\n        const settings = getSettings();\n        return {\n            enabled: settings.autoPause.enabled,\n            isAutoPaused: this.state.isAutoPaused,\n            source: settings.autoPause.source,\n            threshold: settings.autoPause.threshold,\n            currentValue: this.getCurrentValue(settings.autoPause.source),\n        };\n    }\n}\n\n/**\n * Get unit label for auto-pause source\n */\nexport function getAutoPauseSourceUnit(source: AutoPauseSource): string {\n    switch (source) {\n        case 'speed':\n            return 'km/h';\n        case 'power':\n            return 'W';\n        case 'cadence':\n            return 'rpm';\n        default:\n            return '';\n    }\n}\n\n/**\n * Get label for auto-pause source\n */\nexport function getAutoPauseSourceLabel(source: AutoPauseSource): string {\n    switch (source) {\n        case 'speed':\n            return 'Speed';\n        case 'power':\n            return 'Power';\n        case 'cadence':\n            return 'Cadence';\n        default:\n            return source;\n    }\n}\n","/**\n * Auto-Lap Service\n *\n * Automatically marks laps based on distance or time intervals.\n * Integrates with VoiceFeedback for lap announcements.\n *\n * @module AutoLapService\n */\n\nimport { getSettings } from '../config/settings.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState } from '../getInitState.js';\nimport { voiceFeedback } from './VoiceFeedback.js';\n\n/**\n * Calculate total distance from GPS points in meters\n */\nfunction calculateTotalDistanceMeters(gpsPoints: { lat: number; lon: number }[]): number {\n    if (gpsPoints.length < 2) return 0;\n\n    let totalMeters = 0;\n    const R = 6371000; // Earth radius in meters\n\n    for (let i = 1; i < gpsPoints.length; i++) {\n        const prev = gpsPoints[i - 1];\n        const curr = gpsPoints[i];\n\n        // Haversine formula\n        const lat1 = (prev.lat * Math.PI) / 180;\n        const lat2 = (curr.lat * Math.PI) / 180;\n        const deltaLat = ((curr.lat - prev.lat) * Math.PI) / 180;\n        const deltaLon = ((curr.lon - prev.lon) * Math.PI) / 180;\n\n        const a =\n            Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +\n            Math.cos(lat1) * Math.cos(lat2) * Math.sin(deltaLon / 2) * Math.sin(deltaLon / 2);\n        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n\n        totalMeters += R * c;\n    }\n\n    return totalMeters;\n}\n\n/**\n * AutoLapService class for automatic lap marking\n */\nexport class AutoLapService {\n    private measurementsState: MeasurementsState | null = null;\n    private timeState: TimeState | null = null;\n    private lastLapDistanceKm: number = 0;\n    private lastLapTimeMs: number = 0;\n    private checkInterval: ReturnType<typeof setInterval> | null = null;\n    private isActive: boolean = false;\n    private onLapCallback: ((lapNumber: number) => void) | null = null;\n\n    /**\n     * Initialize the service with state references\n     */\n    init(measurementsState: MeasurementsState, timeState: TimeState): void {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Set callback for when a lap is automatically marked\n     */\n    onLap(callback: (lapNumber: number) => void): void {\n        this.onLapCallback = callback;\n    }\n\n    /**\n     * Start monitoring for auto-lap triggers\n     */\n    start(): void {\n        if (this.isActive || !this.measurementsState || !this.timeState) {\n            return;\n        }\n\n        const settings = getSettings();\n        if (!settings.autoLap.enabled) {\n            return;\n        }\n\n        this.isActive = true;\n        this.lastLapDistanceKm = 0;\n        this.lastLapTimeMs = 0;\n\n        // Check every second\n        this.checkInterval = setInterval(() => this.checkAutoLap(), 1000);\n\n        console.log(`AutoLap started: ${settings.autoLap.source} mode`);\n    }\n\n    /**\n     * Stop monitoring for auto-lap triggers\n     */\n    stop(): void {\n        if (this.checkInterval) {\n            clearInterval(this.checkInterval);\n            this.checkInterval = null;\n        }\n        this.isActive = false;\n        this.lastLapDistanceKm = 0;\n        this.lastLapTimeMs = 0;\n    }\n\n    /**\n     * Reset state (called when workout is discarded)\n     */\n    reset(): void {\n        this.stop();\n    }\n\n    /**\n     * Check if an auto-lap should be triggered\n     */\n    private checkAutoLap(): void {\n        if (!this.measurementsState || !this.timeState || !this.timeState.running) {\n            return;\n        }\n\n        const settings = getSettings();\n        if (!settings.autoLap.enabled) {\n            this.stop();\n            return;\n        }\n\n        if (settings.autoLap.source === 'distance') {\n            this.checkDistanceAutoLap(settings.autoLap.distanceKm);\n        } else if (settings.autoLap.source === 'time') {\n            this.checkTimeAutoLap(settings.autoLap.timeMinutes);\n        }\n    }\n\n    /**\n     * Check for distance-based auto-lap\n     */\n    private checkDistanceAutoLap(intervalKm: number): void {\n        if (!this.measurementsState) return;\n\n        const totalMeters = calculateTotalDistanceMeters(this.measurementsState.gps);\n        const totalKm = totalMeters / 1000;\n\n        // Calculate which km mark we're at\n        const currentInterval = Math.floor(totalKm / intervalKm);\n        const lastInterval = Math.floor(this.lastLapDistanceKm / intervalKm);\n\n        if (currentInterval > lastInterval && totalKm > 0) {\n            this.triggerAutoLap();\n            this.lastLapDistanceKm = totalKm;\n        }\n    }\n\n    /**\n     * Check for time-based auto-lap\n     */\n    private checkTimeAutoLap(intervalMinutes: number): void {\n        if (!this.timeState || !this.timeState.startTime) return;\n\n        const elapsedMs = Date.now() - this.timeState.startTime;\n        const intervalMs = intervalMinutes * 60 * 1000;\n\n        // Calculate which time interval we're at\n        const currentInterval = Math.floor(elapsedMs / intervalMs);\n        const lastInterval = Math.floor(this.lastLapTimeMs / intervalMs);\n\n        if (currentInterval > lastInterval && elapsedMs > 0) {\n            this.triggerAutoLap();\n            this.lastLapTimeMs = elapsedMs;\n        }\n    }\n\n    /**\n     * Trigger an automatic lap\n     */\n    private triggerAutoLap(): void {\n        if (!this.measurementsState || !this.timeState) return;\n\n        // Get previous lap timestamp or start time\n        const laps = this.measurementsState.laps;\n        const lastLapTime = laps.length > 0 ? laps[laps.length - 1].timestamp : this.timeState.startTime || Date.now();\n\n        // Add the lap\n        const lap = this.measurementsState.addLap(this.timeState.startTime);\n\n        // Calculate lap duration\n        const now = lap.timestamp;\n        const durationMs = now - lastLapTime;\n\n        // Calculate average power for the lap\n        const lapPower = this.measurementsState.power.filter((p) => p.timestamp >= lastLapTime && p.timestamp <= now);\n        const avgPower = lapPower.length > 0 ? lapPower.reduce((sum, p) => sum + p.value, 0) / lapPower.length : 0;\n\n        // Calculate average speed for the lap\n        const lapSpeed = this.measurementsState.speed.filter((p) => p.timestamp >= lastLapTime && p.timestamp <= now);\n        const avgSpeed = lapSpeed.length > 0 ? lapSpeed.reduce((sum, p) => sum + p.value, 0) / lapSpeed.length : 0;\n\n        // Voice announcement\n        voiceFeedback.announceLap(lap.number, durationMs, avgPower, avgSpeed);\n\n        console.log(`Auto-lap marked: ${lap.number} at ${new Date(lap.timestamp).toISOString()}`);\n\n        // Notify callback\n        if (this.onLapCallback) {\n            this.onLapCallback(lap.number);\n        }\n    }\n\n    /**\n     * Get whether auto-lap is currently active\n     */\n    isAutoLapActive(): boolean {\n        return this.isActive;\n    }\n}\n\n/** Singleton instance */\nexport const autoLapService = new AutoLapService();\n","import { pauseWorkout, resumeWorkout } from '../ui/time.js';\nimport type { TimeState } from '../getInitState.js';\n\nexport class MediaSessionManager {\n    private timeState: TimeState | null = null;\n    private hasInitialized = false;\n\n    /**\n     * Initialize Media Session API integration\n     */\n    public init(timeState: TimeState): void {\n        if (typeof navigator === 'undefined' || !('mediaSession' in navigator)) {\n            console.log('Media Session API not supported');\n            return;\n        }\n\n        if (this.hasInitialized) return;\n        this.hasInitialized = true;\n        this.timeState = timeState;\n\n        this.setupMetadata();\n        this.setupActionHandlers();\n        this.setupEventListeners();\n\n        console.log('Media Session Manager initialized');\n    }\n\n    private setupMetadata(): void {\n        navigator.mediaSession.metadata = new MediaMetadata({\n            title: 'No Workout Active',\n            artist: 'Bike Power Tracker',\n            album: 'Ready to Start',\n            artwork: [\n                { src: 'assets/icons/icon-96.png', sizes: '96x96', type: 'image/png' },\n                { src: 'assets/icons/icon-128.png', sizes: '128x128', type: 'image/png' },\n                { src: 'assets/icons/icon-180.png', sizes: '180x180', type: 'image/png' },\n                { src: 'assets/icons/icon-192.png', sizes: '192x192', type: 'image/png' },\n                { src: 'assets/icons/icon-512.png', sizes: '512x512', type: 'image/png' },\n            ],\n        });\n    }\n\n    private updateMetadata(status: string): void {\n        if (!navigator.mediaSession.metadata) return;\n\n        navigator.mediaSession.metadata.title = status;\n        navigator.mediaSession.metadata.album = 'Bike Power Tracker';\n    }\n\n    private setupActionHandlers(): void {\n        try {\n            // Play -> Resume\n            navigator.mediaSession.setActionHandler('play', () => {\n                if (this.timeState && !this.timeState.running && this.timeState.startTime) {\n                    resumeWorkout(this.timeState);\n                }\n            });\n\n            // Pause -> Pause\n            navigator.mediaSession.setActionHandler('pause', () => {\n                if (this.timeState && this.timeState.running) {\n                    pauseWorkout(this.timeState);\n                }\n            });\n\n            // Stop -> Pause (safer)\n            navigator.mediaSession.setActionHandler('stop', () => {\n                if (this.timeState && this.timeState.running) {\n                    pauseWorkout(this.timeState);\n                }\n            });\n        } catch (e) {\n            console.warn('Error setting up media session handlers', e);\n        }\n    }\n\n    private setupEventListeners(): void {\n        document.addEventListener('workoutStarted', () => {\n            if (navigator.mediaSession) {\n                navigator.mediaSession.playbackState = 'playing';\n                this.updateMetadata('Workout Active');\n            }\n        });\n\n        document.addEventListener('workoutPaused', () => {\n            if (navigator.mediaSession) {\n                navigator.mediaSession.playbackState = 'paused';\n                this.updateMetadata('Workout Paused');\n            }\n        });\n\n        document.addEventListener('workoutResumed', () => {\n            if (navigator.mediaSession) {\n                navigator.mediaSession.playbackState = 'playing';\n                this.updateMetadata('Workout Active');\n            }\n        });\n\n        document.addEventListener('workoutComplete', () => {\n            if (navigator.mediaSession) {\n                navigator.mediaSession.playbackState = 'none';\n                this.updateMetadata('Workout Finished');\n            }\n        });\n    }\n}\n\nexport const mediaSessionManager = new MediaSessionManager();\n","/**\n * Data Fields Type System\n *\n * Core type definitions for the customizable data fields system.\n * Based on industry standards from Garmin, Wahoo, and Hammerhead devices.\n *\n * @module data-fields/types\n */\n\nimport type { MeasurementsState } from '../measurements-state.js';\n\n// ============================================================================\n// Category Types\n// ============================================================================\n\n/** Data field category for organization and filtering */\nexport type DataFieldCategory =\n    | 'power'\n    | 'cadence'\n    | 'heartrate'\n    | 'speed'\n    | 'distance'\n    | 'elevation'\n    | 'time'\n    | 'laps'\n    | 'energy'\n    | 'environment'\n    | 'device'\n    | 'charts'\n    | 'map';\n\n/** Category metadata for UI display */\nexport interface CategoryInfo {\n    id: DataFieldCategory;\n    name: string;\n    icon: string;\n    description: string;\n}\n\n/** All category metadata */\nexport const CATEGORY_INFO: Record<DataFieldCategory, CategoryInfo> = {\n    power: { id: 'power', name: 'Power', icon: '', description: 'Power meter data and calculations' },\n    cadence: { id: 'cadence', name: 'Cadence', icon: '', description: 'Pedaling cadence metrics' },\n    heartrate: { id: 'heartrate', name: 'Heart Rate', icon: '', description: 'Heart rate monitoring' },\n    speed: { id: 'speed', name: 'Speed & Pace', icon: '', description: 'Speed and pace metrics' },\n    distance: { id: 'distance', name: 'Distance', icon: '', description: 'Distance tracking' },\n    elevation: { id: 'elevation', name: 'Elevation', icon: '', description: 'Altitude and climbing' },\n    time: { id: 'time', name: 'Time', icon: '', description: 'Time and duration' },\n    laps: { id: 'laps', name: 'Laps', icon: '', description: 'Lap-specific metrics' },\n    energy: { id: 'energy', name: 'Energy', icon: '', description: 'Calories and Work' },\n    environment: { id: 'environment', name: 'Environment', icon: '', description: 'Weather and conditions' },\n    device: { id: 'device', name: 'Device', icon: '', description: 'Device and sensor status' },\n    charts: { id: 'charts', name: 'Charts', icon: '', description: 'Graphical data displays' },\n    map: { id: 'map', name: 'Map', icon: '', description: 'Route and location' },\n};\n\n// ============================================================================\n// Size Types\n// ============================================================================\n\n/** Data field size options for layout */\nexport type DataFieldSize =\n    | 'small' // 1x1 - compact, value only (no label)\n    | 'medium' // 1x1 - label + value (default)\n    | 'large' // 2x1 - label + large value\n    | 'wide' // 2x1 - for charts/graphs\n    | 'tall' // 1x2 - vertical layout\n    | 'full' // 2x2 - maps, large charts\n    | 'xlarge' // 2x2 - extra large single value display\n    | 'xxlarge' // 4x2 - full width, double height, huge value\n    | 'jumbo'; // 4x3 - full width, triple height, maximum size\n\n/** Size metadata for UI */\nexport interface SizeInfo {\n    id: DataFieldSize;\n    name: string;\n    gridSpan: { cols: number; rows: number };\n    showLabel: boolean;\n}\n\n/** All size metadata */\nexport const SIZE_INFO: Record<DataFieldSize, SizeInfo> = {\n    small: { id: 'small', name: 'Small', gridSpan: { cols: 1, rows: 1 }, showLabel: false },\n    medium: { id: 'medium', name: 'Medium', gridSpan: { cols: 1, rows: 1 }, showLabel: true },\n    large: { id: 'large', name: 'Large', gridSpan: { cols: 2, rows: 1 }, showLabel: true },\n    wide: { id: 'wide', name: 'Wide', gridSpan: { cols: 2, rows: 1 }, showLabel: true },\n    tall: { id: 'tall', name: 'Tall', gridSpan: { cols: 1, rows: 2 }, showLabel: true },\n    full: { id: 'full', name: 'Full', gridSpan: { cols: 2, rows: 2 }, showLabel: true },\n    xlarge: { id: 'xlarge', name: 'Extra Large', gridSpan: { cols: 2, rows: 2 }, showLabel: true },\n    xxlarge: { id: 'xxlarge', name: 'XX-Large', gridSpan: { cols: 4, rows: 2 }, showLabel: true },\n    jumbo: { id: 'jumbo', name: 'Jumbo', gridSpan: { cols: 4, rows: 3 }, showLabel: true },\n};\n\n// ============================================================================\n// Source & Update Types\n// ============================================================================\n\n/** Data source type - where the data comes from */\nexport type DataSourceType =\n    | 'sensor' // Direct from Bluetooth sensor\n    | 'gps' // From GPS/location services\n    | 'calculated' // Derived from other data\n    | 'system' // Device info (battery, etc.)\n    | 'workout' // From workout state (laps, time, etc.)\n    | 'external'; // Weather API, etc.\n\n/** Update frequency - how often the field refreshes */\nexport type UpdateFrequency =\n    | 'realtime' // Every measurement (~100ms)\n    | 'second' // Once per second\n    | 'periodic' // Every few seconds (5s)\n    | 'on-change' // Only when value changes\n    | 'manual'; // User triggered\n\n// ============================================================================\n// Workout State Interface (for calculators)\n// ============================================================================\n\n/** Workout state passed to calculators */\nexport interface WorkoutState {\n    isActive: boolean;\n    isPaused: boolean;\n    startTime: number | null;\n    elapsedTime: number; // ms\n    movingTime: number; // ms (excluding paused/stopped)\n    pausedTime: number; // ms\n    currentLap: number;\n    lapStartTime: number | null;\n    lapElapsedTime: number; // ms\n    laps: LapData[];\n}\n\n/** Individual lap data */\nexport interface LapData {\n    lapNumber: number;\n    startTime: number;\n    endTime: number;\n    duration: number; // ms\n    distance: number; // meters\n    avgPower: number | null;\n    avgHeartrate: number | null;\n    avgCadence: number | null;\n    avgSpeed: number | null; // m/s\n    elevationGain: number; // meters\n}\n\n// ============================================================================\n// User Settings Interface (for formatters/colorizers)\n// ============================================================================\n\n/** User settings passed to formatters and colorizers */\nexport interface UserSettings {\n    unitSystem: 'metric' | 'imperial';\n    ftp: number | null; // Functional Threshold Power (watts)\n    maxHr: number | null; // Maximum heart rate (bpm)\n    weight: number | null; // User weight (kg)\n    restingHr: number | null; // Resting heart rate (bpm)\n    showCalories: boolean; // Show calorie estimation\n    targetDistance?: number | null; // Target distance in user units (km/mi)\n\n    // Zone configurations\n    powerZones: ZoneConfig[];\n    hrZones: ZoneConfig[];\n}\n\n/** Check if user is using imperial units */\nexport const isImperial = (settings: UserSettings): boolean => settings.unitSystem === 'imperial';\n\n/** Zone configuration */\nexport interface ZoneConfig {\n    zone: number;\n    name: string;\n    minPercent: number; // % of FTP or MaxHR\n    maxPercent: number;\n    color: string; // CSS color\n}\n\n/** Default power zones (based on Coggan) */\nexport const DEFAULT_POWER_ZONES: ZoneConfig[] = [\n    { zone: 1, name: 'Recovery', minPercent: 0, maxPercent: 55, color: '#808080' },\n    { zone: 2, name: 'Endurance', minPercent: 55, maxPercent: 75, color: '#2196f3' },\n    { zone: 3, name: 'Tempo', minPercent: 75, maxPercent: 90, color: '#4caf50' },\n    { zone: 4, name: 'Threshold', minPercent: 90, maxPercent: 105, color: '#ffeb3b' },\n    { zone: 5, name: 'VO2max', minPercent: 105, maxPercent: 120, color: '#ff9800' },\n    { zone: 6, name: 'Anaerobic', minPercent: 120, maxPercent: 150, color: '#f44336' },\n    { zone: 7, name: 'Neuromuscular', minPercent: 150, maxPercent: 999, color: '#9c27b0' },\n];\n\n/** Default HR zones (5-zone model) */\nexport const DEFAULT_HR_ZONES: ZoneConfig[] = [\n    { zone: 1, name: 'Recovery', minPercent: 50, maxPercent: 60, color: '#808080' },\n    { zone: 2, name: 'Aerobic', minPercent: 60, maxPercent: 70, color: '#2196f3' },\n    { zone: 3, name: 'Tempo', minPercent: 70, maxPercent: 80, color: '#4caf50' },\n    { zone: 4, name: 'Threshold', minPercent: 80, maxPercent: 90, color: '#ff9800' },\n    { zone: 5, name: 'VO2max', minPercent: 90, maxPercent: 100, color: '#f44336' },\n];\n\n// ============================================================================\n// Calculator & Formatter Types\n// ============================================================================\n\n/** Calculator function for derived/calculated fields */\nexport type DataFieldCalculator = (\n    measurements: MeasurementsState,\n    workoutState: WorkoutState,\n    settings: UserSettings\n) => number | null;\n\n/** Formatter function to convert value to display string */\nexport type DataFieldFormatter = (value: number | null, settings: UserSettings) => string;\n\n/** Zone color result */\nexport interface ZoneColor {\n    bg: string;\n    text: string;\n    border: string;\n    zone: number;\n    zoneName: string;\n}\n\n/** Colorizer function for zone-based coloring */\nexport type DataFieldColorizer = (value: number | null, settings: UserSettings) => ZoneColor | null;\n\n// ============================================================================\n// Data Field Definition\n// ============================================================================\n\n/** Complete data field definition */\nexport interface DataFieldDefinition {\n    /** Unique identifier: 'power-current', 'heartrate-avg', etc. */\n    id: string;\n\n    /** Display name: 'Power', 'Avg Heart Rate', etc. */\n    name: string;\n\n    /** Abbreviated name for small displays: 'PWR', 'Avg HR', etc. */\n    shortName: string;\n\n    /** Category for organization */\n    category: DataFieldCategory;\n\n    /** Description for field picker */\n    description: string;\n\n    /** Unit string (metric): 'W', 'bpm', 'km/h', null for unitless */\n    unit: string | null;\n\n    /** Unit string for imperial: 'mph', 'ft', etc. */\n    unitImperial?: string;\n\n    /** Where the data comes from */\n    sourceType: DataSourceType;\n\n    /** How often the field updates */\n    updateFrequency: UpdateFrequency;\n\n    /** Default size when added to a screen */\n    defaultSize: DataFieldSize;\n\n    /** Sizes this field supports */\n    supportedSizes: DataFieldSize[];\n\n    /** Icon (emoji or class) for display */\n    icon: string;\n\n    /** Required sensors to show this field */\n    requiresSensor?: string[];\n\n    /** Requires GPS to be active */\n    requiresGps?: boolean;\n\n    /** Only available during active workout */\n    requiresWorkoutActive?: boolean;\n\n    /** Calculator for derived fields (optional) */\n    calculator?: DataFieldCalculator;\n\n    /** Formatter to convert value to display string */\n    formatter: DataFieldFormatter;\n\n    /** Colorizer for zone-based coloring (optional) */\n    colorizer?: DataFieldColorizer;\n\n    /** Number of decimal places for default formatting */\n    decimals?: number;\n\n    /** Minimum valid value (for sanity checking) */\n    minValue?: number;\n\n    /** Maximum valid value (for sanity checking) */\n    maxValue?: number;\n}\n\n// ============================================================================\n// Screen & Layout Types\n// ============================================================================\n\n/** A configured data field slot in a screen */\nexport interface DataFieldSlot {\n    /** Unique slot ID within the screen */\n    id: string;\n\n    /** Reference to DataFieldDefinition.id */\n    fieldId: string;\n\n    /** Size override (or default from field) */\n    size: DataFieldSize;\n\n    /** Position/order in the grid (1-based) */\n    position: number;\n}\n\n/** Screen layout options */\nexport type ScreenLayout =\n    | 'auto' // Automatic grid based on field count\n    | 'grid-2' // 2 columns\n    | 'grid-3' // 3 columns\n    | 'grid-4' // 4 columns\n    | 'list' // Vertical list (1 column)\n    | 'custom'; // User-defined positions\n\n/** A complete data screen configuration */\nexport interface DataScreen {\n    /** Unique screen ID */\n    id: string;\n\n    /** Screen name for display */\n    name: string;\n\n    /** Screen icon */\n    icon: string;\n\n    /** Field slots on this screen */\n    slots: DataFieldSlot[];\n\n    /** Layout mode */\n    layout: ScreenLayout;\n}\n\n/** Activity type for profiles */\nexport type ActivityType = 'cycling' | 'running' | 'indoor' | 'custom';\n\n/** Activity profile containing multiple screens */\nexport interface ActivityProfile {\n    /** Unique profile ID */\n    id: string;\n\n    /** Profile name */\n    name: string;\n\n    /** Profile icon */\n    icon: string;\n\n    /** Activity type */\n    activityType: ActivityType;\n\n    /** Screens in this profile */\n    screens: DataScreen[];\n\n    /** Currently active screen index */\n    activeScreenIndex: number;\n}\n\n// ============================================================================\n// Settings Types\n// ============================================================================\n\n/** Data field settings stored in localStorage */\nexport interface DataFieldSettings {\n    /** User's activity profiles */\n    profiles: ActivityProfile[];\n\n    /** Currently active profile ID */\n    activeProfileId: string;\n\n    /** Unit system preference */\n    unitSystem: 'metric' | 'imperial';\n\n    /** Per-field preferences */\n    fieldPreferences: Record<string, FieldPreference>;\n}\n\n/** Per-field user preferences */\nexport interface FieldPreference {\n    /** Show this field in workout summary */\n    showInSummary: boolean;\n\n    /** Announce this field via voice */\n    voiceAnnounce: boolean;\n\n    /** Alert threshold value */\n    alertThreshold?: number;\n\n    /** Alert when above or below threshold */\n    alertType?: 'above' | 'below';\n}\n\n// ============================================================================\n// Event Types\n// ============================================================================\n\n/** Event dispatched when a data field value updates */\nexport interface DataFieldUpdateEvent {\n    fieldId: string;\n    value: number | null;\n    formattedValue: string;\n    timestamp: number;\n}\n\n/** Event dispatched when screen changes */\nexport interface ScreenChangeEvent {\n    profileId: string;\n    screenIndex: number;\n    screen: DataScreen;\n}\n\n// ============================================================================\n// User Settings & State Types\n// ============================================================================\n","/**\n * Data Field Registry\n *\n * Central registry for all data field definitions.\n * Provides lookup, filtering, and category organization.\n *\n * @module data-fields/registry\n */\n\nimport type { DataFieldDefinition, DataFieldCategory, CategoryInfo } from './types.js';\nimport { CATEGORY_INFO } from './types.js';\n\n// ============================================================================\n// Registry Storage\n// ============================================================================\n\n/** Central registry of all data fields */\nconst DATA_FIELD_REGISTRY: Map<string, DataFieldDefinition> = new Map();\n\n/** Track registration order for consistent iteration */\nconst registrationOrder: string[] = [];\n\n// ============================================================================\n// Registration Functions\n// ============================================================================\n\n/**\n * Register a new data field definition\n * @param field - The field definition to register\n * @throws Error if field with same ID already exists\n */\nexport function registerDataField(field: DataFieldDefinition): void {\n    if (DATA_FIELD_REGISTRY.has(field.id)) {\n        console.warn(`Data field '${field.id}' is already registered. Skipping duplicate.`);\n        return;\n    }\n\n    // Validate required properties\n    if (!field.id || !field.name || !field.category || !field.formatter) {\n        throw new Error(`Invalid data field definition: missing required properties for '${field.id}'`);\n    }\n\n    DATA_FIELD_REGISTRY.set(field.id, field);\n    registrationOrder.push(field.id);\n}\n\n/**\n * Register multiple data fields at once\n * @param fields - Array of field definitions\n */\nexport function registerDataFields(fields: DataFieldDefinition[]): void {\n    for (const field of fields) {\n        registerDataField(field);\n    }\n}\n\n/**\n * Unregister a data field (for testing or dynamic removal)\n * @param fieldId - The field ID to remove\n */\nexport function unregisterDataField(fieldId: string): boolean {\n    const removed = DATA_FIELD_REGISTRY.delete(fieldId);\n    if (removed) {\n        const index = registrationOrder.indexOf(fieldId);\n        if (index > -1) {\n            registrationOrder.splice(index, 1);\n        }\n    }\n    return removed;\n}\n\n/**\n * Clear all registered fields (for testing)\n */\nexport function clearRegistry(): void {\n    DATA_FIELD_REGISTRY.clear();\n    registrationOrder.length = 0;\n}\n\n// ============================================================================\n// Lookup Functions\n// ============================================================================\n\n/**\n * Get a data field by ID\n * @param id - The field ID to look up\n * @returns The field definition or undefined\n */\nexport function getDataField(id: string): DataFieldDefinition | undefined {\n    return DATA_FIELD_REGISTRY.get(id);\n}\n\n/**\n * Check if a field exists\n * @param id - The field ID to check\n */\nexport function hasDataField(id: string): boolean {\n    return DATA_FIELD_REGISTRY.has(id);\n}\n\n/**\n * Get all registered data fields\n * @returns Array of all field definitions in registration order\n */\nexport function getAllDataFields(): DataFieldDefinition[] {\n    return registrationOrder.map((id) => DATA_FIELD_REGISTRY.get(id)!);\n}\n\n/**\n * Get the total count of registered fields\n */\nexport function getFieldCount(): number {\n    return DATA_FIELD_REGISTRY.size;\n}\n\n// ============================================================================\n// Category Functions\n// ============================================================================\n\n/**\n * Get all fields in a specific category\n * @param category - The category to filter by\n * @returns Array of field definitions in that category\n */\nexport function getFieldsByCategory(category: DataFieldCategory): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => f.category === category);\n}\n\n/**\n * Get all categories that have registered fields\n * @returns Map of category to field definitions\n */\nexport function getAllCategories(): Map<DataFieldCategory, DataFieldDefinition[]> {\n    const categories = new Map<DataFieldCategory, DataFieldDefinition[]>();\n\n    for (const field of getAllDataFields()) {\n        const list = categories.get(field.category) || [];\n        list.push(field);\n        categories.set(field.category, list);\n    }\n\n    return categories;\n}\n\n/**\n * Get category info with field counts\n * @returns Array of categories with their field counts\n */\nexport function getCategoriesWithCounts(): Array<CategoryInfo & { count: number }> {\n    const categoryMap = getAllCategories();\n\n    return Object.values(CATEGORY_INFO)\n        .map((info) => ({\n            ...info,\n            count: categoryMap.get(info.id)?.length || 0,\n        }))\n        .filter((c) => c.count > 0);\n}\n\n// ============================================================================\n// Filtering Functions\n// ============================================================================\n\n/**\n * Get fields that require specific sensors\n * @param sensorType - The sensor type ('power', 'heartrate', 'cadence', 'gps')\n */\nexport function getFieldsRequiringSensor(sensorType: string): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => f.requiresSensor?.includes(sensorType));\n}\n\n/**\n * Get fields that require GPS\n */\nexport function getFieldsRequiringGps(): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => f.requiresGps === true);\n}\n\n/**\n * Get fields that are always available (no sensor requirements)\n */\nexport function getAlwaysAvailableFields(): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => !f.requiresSensor?.length && !f.requiresGps);\n}\n\n/**\n * Get calculated fields (have a calculator function)\n */\nexport function getCalculatedFields(): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => f.calculator !== undefined);\n}\n\n/**\n * Get real-time sensor fields (direct from sensors)\n */\nexport function getSensorFields(): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => f.sourceType === 'sensor');\n}\n\n/**\n * Get fields that require an active workout\n */\nexport function getFieldsRequiringWorkout(): DataFieldDefinition[] {\n    return getAllDataFields().filter((f) => f.requiresWorkoutActive === true);\n}\n\n/**\n * Get fields by their IDs\n */\nexport function getFieldsByIds(ids: string[]): DataFieldDefinition[] {\n    return ids.map((id) => getDataField(id)).filter((f): f is DataFieldDefinition => f !== undefined);\n}\n\n// ============================================================================\n// Search Functions\n// ============================================================================\n\n/**\n * Search fields by name or description\n * @param query - Search query string\n * @returns Matching field definitions\n */\nexport function searchFields(query: string): DataFieldDefinition[] {\n    const lowerQuery = query.toLowerCase().trim();\n    if (!lowerQuery) {\n        return getAllDataFields();\n    }\n\n    return getAllDataFields().filter(\n        (f) =>\n            f.name.toLowerCase().includes(lowerQuery) ||\n            f.shortName.toLowerCase().includes(lowerQuery) ||\n            f.description.toLowerCase().includes(lowerQuery) ||\n            f.id.toLowerCase().includes(lowerQuery)\n    );\n}\n\n// ============================================================================\n// Validation Functions\n// ============================================================================\n\n/**\n * Validate a field ID exists\n * @param fieldId - The field ID to validate\n * @throws Error if field doesn't exist\n */\nexport function validateFieldId(fieldId: string): DataFieldDefinition {\n    const field = getDataField(fieldId);\n    if (!field) {\n        throw new Error(`Unknown data field: '${fieldId}'`);\n    }\n    return field;\n}\n\n/**\n * Validate multiple field IDs\n * @param fieldIds - Array of field IDs to validate\n * @returns Array of valid field definitions\n */\nexport function validateFieldIds(fieldIds: string[]): DataFieldDefinition[] {\n    return fieldIds.map((id) => validateFieldId(id));\n}\n\n// ============================================================================\n// Debug/Development Helpers\n// ============================================================================\n\n/**\n * Get registry statistics for debugging\n */\nexport function getRegistryStats(): {\n    totalFields: number;\n    byCategory: Record<string, number>;\n    bySensor: Record<string, number>;\n    calculated: number;\n    gpsRequired: number;\n} {\n    const fields = getAllDataFields();\n\n    const byCategory: Record<string, number> = {};\n    const bySensor: Record<string, number> = {};\n    let calculated = 0;\n    let gpsRequired = 0;\n\n    for (const field of fields) {\n        // Count by category\n        byCategory[field.category] = (byCategory[field.category] || 0) + 1;\n\n        // Count by required sensor\n        for (const sensor of field.requiresSensor || []) {\n            bySensor[sensor] = (bySensor[sensor] || 0) + 1;\n        }\n\n        // Count calculated\n        if (field.calculator) {\n            calculated++;\n        }\n\n        // Count GPS required\n        if (field.requiresGps) {\n            gpsRequired++;\n        }\n    }\n\n    return {\n        totalFields: fields.length,\n        byCategory,\n        bySensor,\n        calculated,\n        gpsRequired,\n    };\n}\n\n/**\n * Log registry contents for debugging\n */\nexport function debugLogRegistry(): void {\n    const stats = getRegistryStats();\n    console.group(' Data Field Registry');\n    console.log(`Total fields: ${stats.totalFields}`);\n    console.log('By category:', stats.byCategory);\n    console.log('By sensor:', stats.bySensor);\n    console.log(`Calculated fields: ${stats.calculated}`);\n    console.log(`GPS required: ${stats.gpsRequired}`);\n    console.groupEnd();\n}\n","/**\n * Calculation Manager\n *\n * Manages the calculation and updates of derived data fields.\n * Handles update scheduling based on field requirements and\n * efficiently batches calculations to minimize performance impact.\n *\n * @module data-fields/CalculationManager\n */\n\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { DataFieldDefinition, WorkoutState, UserSettings, UpdateFrequency } from './types.js';\nimport { getAllDataFields, getDataField } from './registry.js';\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/** Callback for field value updates */\nexport type FieldUpdateCallback = (fieldId: string, value: number | null) => void;\n\n/** Configuration for the calculation manager */\nexport interface CalculationManagerConfig {\n    /** Enable/disable real-time updates (default: true) */\n    enableRealtime?: boolean;\n    /** Override update intervals in ms (for testing) */\n    updateIntervals?: Partial<Record<UpdateFrequency, number>>;\n}\n\n/** Field calculation result */\ninterface CalculationResult {\n    fieldId: string;\n    value: number | null;\n    timestamp: number;\n}\n\n// ============================================================================\n// Default Update Intervals\n// ============================================================================\n\nconst DEFAULT_UPDATE_INTERVALS: Record<UpdateFrequency, number> = {\n    realtime: 100, // 10Hz - for critical real-time data\n    second: 1000, // 1Hz - once per second\n    periodic: 5000, // Every 5 seconds\n    'on-change': 0, // Manual trigger only\n    manual: 0, // Manual trigger only\n};\n\n// ============================================================================\n// Calculation Manager Class\n// ============================================================================\n\n/**\n * Manages calculated data field updates\n *\n * The CalculationManager schedules and executes calculations for\n * derived data fields (NP, TSS, rolling averages, etc.) based on\n * their update frequency requirements.\n *\n * @example\n * ```typescript\n * const manager = new CalculationManager(measurements, workoutState, settings);\n * manager.onUpdate((fieldId, value) => {\n *     updateUIField(fieldId, value);\n * });\n * manager.start();\n * // ... during workout ...\n * manager.stop();\n * ```\n */\nexport class CalculationManager {\n    private calculatedValues: Map<string, number | null> = new Map();\n    private updateTimers: Map<UpdateFrequency, number> = new Map();\n    private listeners: Set<FieldUpdateCallback> = new Set();\n    private isRunning = false;\n    private config: Required<CalculationManagerConfig>;\n    private fieldsByFrequency: Map<UpdateFrequency, DataFieldDefinition[]> = new Map();\n\n    constructor(\n        private measurements: MeasurementsState,\n        private workoutState: WorkoutState,\n        private settings: UserSettings,\n        config: CalculationManagerConfig = {}\n    ) {\n        this.config = {\n            enableRealtime: config.enableRealtime ?? true,\n            updateIntervals: {\n                ...DEFAULT_UPDATE_INTERVALS,\n                ...config.updateIntervals,\n            },\n        };\n\n        this.categorizeFieldsByFrequency();\n    }\n\n    // ========================================================================\n    // Lifecycle Methods\n    // ========================================================================\n\n    /**\n     * Start the calculation manager\n     *\n     * Sets up update timers for each frequency group and begins\n     * calculating field values.\n     */\n    public start(): void {\n        if (this.isRunning) return;\n        this.isRunning = true;\n\n        // Initial calculation of all fields\n        this.calculateAllFields();\n\n        // Set up timers for each frequency\n        for (const [frequency, fields] of this.fieldsByFrequency) {\n            if (fields.length === 0) continue;\n\n            const interval = this.config.updateIntervals[frequency];\n            if (interval === undefined || interval <= 0) continue; // Skip manual/on-change\n\n            // Skip realtime if disabled\n            if (frequency === 'realtime' && !this.config.enableRealtime) continue;\n\n            const timerId = window.setInterval(() => {\n                this.calculateFieldsForFrequency(frequency);\n            }, interval);\n\n            this.updateTimers.set(frequency, timerId);\n        }\n    }\n\n    /**\n     * Stop the calculation manager\n     *\n     * Clears all update timers and stops calculations.\n     */\n    public stop(): void {\n        if (!this.isRunning) return;\n        this.isRunning = false;\n\n        // Clear all timers\n        for (const timerId of this.updateTimers.values()) {\n            clearInterval(timerId);\n        }\n        this.updateTimers.clear();\n    }\n\n    /**\n     * Pause calculations temporarily\n     */\n    public pause(): void {\n        this.stop();\n    }\n\n    /**\n     * Resume calculations after pause\n     */\n    public resume(): void {\n        if (!this.isRunning) {\n            this.start();\n        }\n    }\n\n    /**\n     * Check if the manager is currently running\n     */\n    public isActive(): boolean {\n        return this.isRunning;\n    }\n\n    // ========================================================================\n    // Update Methods\n    // ========================================================================\n\n    /**\n     * Update the measurements state reference\n     *\n     * Call this when the measurements state is replaced or updated.\n     */\n    public updateMeasurements(measurements: MeasurementsState): void {\n        this.measurements = measurements;\n    }\n\n    /**\n     * Update the workout state reference\n     */\n    public updateWorkoutState(workoutState: WorkoutState): void {\n        this.workoutState = workoutState;\n    }\n\n    /**\n     * Update user settings\n     */\n    public updateSettings(settings: UserSettings): void {\n        this.settings = settings;\n        // Recalculate all fields when settings change\n        if (this.isRunning) {\n            this.calculateAllFields();\n        }\n    }\n\n    // ========================================================================\n    // Event Handling\n    // ========================================================================\n\n    /**\n     * Register a callback for field updates\n     *\n     * @param callback Function called when a field value changes\n     * @returns Unsubscribe function\n     */\n    public onUpdate(callback: FieldUpdateCallback): () => void {\n        this.listeners.add(callback);\n        return () => this.listeners.delete(callback);\n    }\n\n    /**\n     * Remove all update listeners\n     */\n    public removeAllListeners(): void {\n        this.listeners.clear();\n    }\n\n    // ========================================================================\n    // Value Access\n    // ========================================================================\n\n    /**\n     * Get the current calculated value for a field\n     */\n    public getValue(fieldId: string): number | null {\n        return this.calculatedValues.get(fieldId) ?? null;\n    }\n\n    /**\n     * Get all calculated values\n     */\n    public getAllValues(): Map<string, number | null> {\n        return new Map(this.calculatedValues);\n    }\n\n    /**\n     * Get values for specific fields\n     */\n    public getValues(fieldIds: string[]): Map<string, number | null> {\n        const result = new Map<string, number | null>();\n        for (const id of fieldIds) {\n            result.set(id, this.calculatedValues.get(id) ?? null);\n        }\n        return result;\n    }\n\n    // ========================================================================\n    // Manual Calculation\n    // ========================================================================\n\n    /**\n     * Force calculation of a specific field\n     *\n     * Use for 'on-change' or 'manual' fields, or to refresh a value.\n     */\n    public calculateField(fieldId: string): number | null {\n        const field = getDataField(fieldId);\n        if (!field) return null;\n\n        const value = this.executeCalculation(field);\n        this.updateValue(fieldId, value);\n        return value;\n    }\n\n    /**\n     * Force calculation of all fields\n     */\n    public calculateAllFields(): void {\n        const allFields = getAllDataFields();\n        const results: CalculationResult[] = [];\n\n        for (const field of allFields) {\n            if (field.calculator) {\n                const value = this.executeCalculation(field);\n                results.push({\n                    fieldId: field.id,\n                    value,\n                    timestamp: Date.now(),\n                });\n            }\n        }\n\n        // Batch update all values\n        for (const result of results) {\n            this.updateValue(result.fieldId, result.value);\n        }\n    }\n\n    /**\n     * Calculate fields that match a specific frequency\n     */\n    public calculateFieldsForFrequency(frequency: UpdateFrequency): void {\n        const fields = this.fieldsByFrequency.get(frequency);\n        if (!fields) return;\n\n        for (const field of fields) {\n            if (field.calculator) {\n                const value = this.executeCalculation(field);\n                this.updateValue(field.id, value);\n            }\n        }\n    }\n\n    // ========================================================================\n    // Private Methods\n    // ========================================================================\n\n    /**\n     * Categorize all fields by their update frequency\n     */\n    private categorizeFieldsByFrequency(): void {\n        this.fieldsByFrequency.clear();\n\n        // Initialize all frequency buckets\n        const frequencies: UpdateFrequency[] = ['realtime', 'second', 'periodic', 'on-change', 'manual'];\n        for (const freq of frequencies) {\n            this.fieldsByFrequency.set(freq, []);\n        }\n\n        // Categorize fields with calculators\n        const allFields = getAllDataFields();\n        for (const field of allFields) {\n            if (field.calculator) {\n                const list = this.fieldsByFrequency.get(field.updateFrequency);\n                if (list) {\n                    list.push(field);\n                }\n            }\n        }\n    }\n\n    /**\n     * Execute a field's calculator function\n     */\n    private executeCalculation(field: DataFieldDefinition): number | null {\n        if (!field.calculator) return null;\n\n        try {\n            return field.calculator(this.measurements, this.workoutState, this.settings);\n        } catch (error) {\n            console.warn(`Calculation error for field ${field.id}:`, error);\n            return null;\n        }\n    }\n\n    /**\n     * Update a field value and notify listeners\n     */\n    private updateValue(fieldId: string, value: number | null): void {\n        const previousValue = this.calculatedValues.get(fieldId);\n\n        // Only notify if value actually changed\n        if (previousValue !== value) {\n            this.calculatedValues.set(fieldId, value);\n            this.notifyListeners(fieldId, value);\n        }\n    }\n\n    /**\n     * Notify all listeners of a field update\n     */\n    private notifyListeners(fieldId: string, value: number | null): void {\n        for (const listener of this.listeners) {\n            try {\n                listener(fieldId, value);\n            } catch (error) {\n                console.warn(`Error in field update listener:`, error);\n            }\n        }\n    }\n}\n\n// ============================================================================\n// Factory Function\n// ============================================================================\n\n/**\n * Create a new CalculationManager instance\n */\nexport function createCalculationManager(\n    measurements: MeasurementsState,\n    workoutState: WorkoutState,\n    settings: UserSettings,\n    config?: CalculationManagerConfig\n): CalculationManager {\n    return new CalculationManager(measurements, workoutState, settings, config);\n}\n\n// ============================================================================\n// Singleton Instance (optional)\n// ============================================================================\n\nlet globalManager: CalculationManager | null = null;\n\n/**\n * Get or create a global CalculationManager instance\n *\n * Use this for app-wide access to calculated field values.\n */\nexport function getGlobalCalculationManager(): CalculationManager | null {\n    return globalManager;\n}\n\n/**\n * Initialize the global CalculationManager\n */\nexport function initGlobalCalculationManager(\n    measurements: MeasurementsState,\n    workoutState: WorkoutState,\n    settings: UserSettings,\n    config?: CalculationManagerConfig\n): CalculationManager {\n    if (globalManager) {\n        globalManager.stop();\n    }\n    globalManager = createCalculationManager(measurements, workoutState, settings, config);\n    return globalManager;\n}\n\n/**\n * Destroy the global CalculationManager\n */\nexport function destroyGlobalCalculationManager(): void {\n    if (globalManager) {\n        globalManager.stop();\n        globalManager.removeAllListeners();\n        globalManager = null;\n    }\n}\n","/**\n * Default Screen Configurations\n *\n * Pre-configured data screens and activity profiles for common use cases.\n * Users can use these as starting points and customize them.\n *\n * @module data-fields/defaults\n */\n\nimport type { DataScreen, DataFieldSlot, ActivityProfile, DataFieldSettings } from './screens.js';\n\n// ============================================================================\n// Helper to create slots\n// ============================================================================\n\nlet slotCounter = 0;\n\nfunction slot(fieldId: string, size: 'small' | 'medium' | 'large' | 'jumbo' = 'medium'): DataFieldSlot {\n    slotCounter++;\n    return {\n        id: `default-slot-${slotCounter}`,\n        fieldId,\n        size,\n        position: slotCounter,\n    };\n}\n\nfunction resetSlotCounter(): void {\n    slotCounter = 0;\n}\n\n// ============================================================================\n// Default Cycling Screens\n// ============================================================================\n\n/** Main cycling screen - overview of key metrics */\nfunction createCyclingMainScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-main',\n        name: 'Main',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'jumbo'),\n            slot('heartrate-current', 'medium'),\n            slot('cadence-current', 'medium'),\n        ],\n    };\n}\n\n/** Power-focused screen for training */\nfunction createCyclingPowerScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-power',\n        name: 'Power',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('power-3s', 'medium'),\n            slot('power-avg', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('power-max', 'medium'),\n            slot('power-zone', 'medium'),\n        ],\n    };\n}\n\n/** Heart rate focused screen */\nfunction createCyclingHrScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-hr',\n        name: 'Heart Rate',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('heartrate-current', 'large'),\n            slot('heartrate-avg', 'medium'),\n            slot('heartrate-max', 'medium'),\n            slot('heartrate-zone', 'medium'),\n            slot('heartrate-percent-max', 'medium'),\n            slot('calories-burned', 'medium'),\n        ],\n    };\n}\n\n/** Climbing/elevation focused screen */\nfunction createCyclingClimbScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-climb',\n        name: 'Climbing',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('grade-current', 'large'),\n            slot('elevation-current', 'medium'),\n            slot('elevation-gain', 'medium'),\n            slot('elevation-loss', 'medium'),\n            slot('vertical-speed', 'medium'),\n            slot('power-current', 'medium'),\n        ],\n    };\n}\n\n/** Lap-focused screen */\nfunction createCyclingLapScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-laps',\n        name: 'Laps',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('time-lap-number', 'medium'),\n            slot('time-lap', 'large'),\n            slot('distance-lap', 'medium'),\n            slot('power-lap-avg', 'medium'),\n            slot('hr-lap-avg', 'medium'),\n            slot('speed-lap-avg', 'medium'),\n        ],\n    };\n}\n\n/** Minimal screen for casual riding */\nfunction createCyclingSimpleScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'cycling-simple',\n        name: 'Simple',\n        icon: '',\n        layout: 'grid-2',\n        slots: [\n            slot('speed-current', 'large'),\n            slot('distance-total', 'large'),\n            slot('time-elapsed', 'large'),\n            slot('elevation-gain', 'large'),\n        ],\n    };\n}\n\n// ============================================================================\n// Default Indoor/Trainer Screens\n// ============================================================================\n\n/** Main indoor training screen */\nfunction createIndoorMainScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-main',\n        name: 'Main',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('heartrate-current', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('time-elapsed', 'medium'),\n            slot('power-avg', 'medium'),\n            slot('kilojoules', 'medium'),\n        ],\n    };\n}\n\n/** Indoor power screen */\nfunction createIndoorPowerScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-power',\n        name: 'Power',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('power-3s', 'medium'),\n            slot('power-10s', 'medium'),\n            slot('power-30s', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('intensity-factor', 'medium'),\n        ],\n    };\n}\n\n/** TSS/training load screen */\nfunction createIndoorTrainingScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-training',\n        name: 'Training',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('tss', 'large'),\n            slot('intensity-factor', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('kilojoules', 'medium'),\n            slot('time-elapsed', 'medium'),\n            slot('power-avg', 'medium'),\n        ],\n    };\n}\n\n/** Zone-focused screen for structured training */\nfunction createIndoorZonesScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'indoor-zones',\n        name: 'Zones',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-zone', 'large'),\n            slot('heartrate-zone', 'large'),\n            slot('power-percent-ftp', 'medium'),\n            slot('heartrate-percent-max', 'medium'),\n            slot('cadence-zone', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n}\n\n// ============================================================================\n// Default Running Screens\n// ============================================================================\n\n/** Main running screen */\nfunction createRunningMainScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'running-main',\n        name: 'Main',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('pace-current', 'large'),\n            slot('heartrate-current', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('time-elapsed', 'medium'),\n            slot('pace-avg', 'medium'),\n        ],\n    };\n}\n\n/** Running pace screen */\nfunction createRunningPaceScreen(): DataScreen {\n    resetSlotCounter();\n    return {\n        id: 'running-pace',\n        name: 'Pace',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('pace-current', 'large'),\n            slot('pace-avg', 'medium'),\n            slot('speed-current', 'medium'),\n            slot('speed-avg', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n}\n\n// ============================================================================\n// Default Activity Profiles\n// ============================================================================\n\n/** Default outdoor cycling profile */\nexport const DEFAULT_CYCLING_PROFILE: ActivityProfile = {\n    id: 'default-cycling',\n    name: 'Outdoor Cycling',\n    activityType: 'cycling',\n    icon: '',\n    screens: [\n        createCyclingMainScreen(),\n        createCyclingPowerScreen(),\n        createCyclingHrScreen(),\n        createCyclingClimbScreen(),\n        createCyclingLapScreen(),\n    ],\n    activeScreenIndex: 0,\n};\n\n/** Default indoor/trainer profile */\nexport const DEFAULT_INDOOR_PROFILE: ActivityProfile = {\n    id: 'default-indoor',\n    name: 'Indoor Training',\n    activityType: 'indoor',\n    icon: '',\n    screens: [\n        createIndoorMainScreen(),\n        createIndoorPowerScreen(),\n        createIndoorTrainingScreen(),\n        createIndoorZonesScreen(),\n    ],\n    activeScreenIndex: 0,\n};\n\n/** Default running profile */\nexport const DEFAULT_RUNNING_PROFILE: ActivityProfile = {\n    id: 'default-running',\n    name: 'Running',\n    activityType: 'running',\n    icon: '',\n    screens: [createRunningMainScreen(), createRunningPaceScreen()],\n    activeScreenIndex: 0,\n};\n\n/** Simple cycling profile for casual users */\nexport const DEFAULT_SIMPLE_PROFILE: ActivityProfile = {\n    id: 'default-simple',\n    name: 'Simple',\n    activityType: 'cycling',\n    icon: '',\n    screens: [createCyclingSimpleScreen()],\n    activeScreenIndex: 0,\n};\n\n// ============================================================================\n// All Default Profiles\n// ============================================================================\n\n/** All default profiles */\nexport const DEFAULT_PROFILES: ActivityProfile[] = [\n    DEFAULT_CYCLING_PROFILE,\n    DEFAULT_INDOOR_PROFILE,\n    DEFAULT_RUNNING_PROFILE,\n    DEFAULT_SIMPLE_PROFILE,\n];\n\n// ============================================================================\n// Default Settings\n// ============================================================================\n\n/** Default data field settings for new users */\nexport const DEFAULT_DATA_FIELD_SETTINGS: DataFieldSettings = {\n    profiles: [\n        // Clone the default profiles so users can modify them\n        JSON.parse(JSON.stringify(DEFAULT_CYCLING_PROFILE)),\n        JSON.parse(JSON.stringify(DEFAULT_INDOOR_PROFILE)),\n    ],\n    activeProfileId: 'default-cycling',\n    unitSystem: 'metric',\n    fieldPreferences: {},\n    version: 1,\n};\n\n// ============================================================================\n// Profile Factory Functions\n// ============================================================================\n\n/**\n * Create a fresh copy of the default cycling profile\n */\nexport function createDefaultCyclingProfile(): ActivityProfile {\n    return JSON.parse(JSON.stringify(DEFAULT_CYCLING_PROFILE));\n}\n\n/**\n * Create a fresh copy of the default indoor profile\n */\nexport function createDefaultIndoorProfile(): ActivityProfile {\n    return JSON.parse(JSON.stringify(DEFAULT_INDOOR_PROFILE));\n}\n\n/**\n * Create a fresh copy of the default running profile\n */\nexport function createDefaultRunningProfile(): ActivityProfile {\n    return JSON.parse(JSON.stringify(DEFAULT_RUNNING_PROFILE));\n}\n\n/**\n * Get a default profile by activity type\n */\nexport function getDefaultProfileForActivity(activityType: string): ActivityProfile {\n    switch (activityType) {\n        case 'cycling':\n            return createDefaultCyclingProfile();\n        case 'indoor':\n            return createDefaultIndoorProfile();\n        case 'running':\n            return createDefaultRunningProfile();\n        default:\n            return createDefaultCyclingProfile();\n    }\n}\n\n/**\n * Create default settings for a new user\n */\nexport function createDefaultSettings(): DataFieldSettings {\n    return JSON.parse(JSON.stringify(DEFAULT_DATA_FIELD_SETTINGS));\n}\n\n// ============================================================================\n// Migration from Legacy Settings\n// ============================================================================\n\n/**\n * Legacy settings structure (for migration)\n */\ninterface LegacyDisplaySettings {\n    power?: boolean;\n    cadence?: boolean;\n    heartrate?: boolean;\n    speed?: boolean;\n    distance?: boolean;\n    altitude?: boolean;\n}\n\n/**\n * Migrate from legacy display settings to new data field settings\n */\nexport function migrateFromLegacySettings(legacySettings: LegacyDisplaySettings): DataFieldSettings {\n    resetSlotCounter();\n\n    // Build slots based on which fields were enabled\n    const slots: DataFieldSlot[] = [];\n\n    if (legacySettings.power !== false) {\n        slots.push(slot('power-current', 'large'));\n    }\n    if (legacySettings.heartrate !== false) {\n        slots.push(slot('heartrate-current', 'medium'));\n    }\n    if (legacySettings.cadence !== false) {\n        slots.push(slot('cadence-current', 'medium'));\n    }\n    if (legacySettings.speed !== false) {\n        slots.push(slot('speed-current', 'medium'));\n    }\n    if (legacySettings.distance !== false) {\n        slots.push(slot('distance-total', 'medium'));\n    }\n    if (legacySettings.altitude !== false) {\n        slots.push(slot('elevation-current', 'medium'));\n    }\n\n    // If no fields were enabled, use defaults\n    if (slots.length === 0) {\n        return createDefaultSettings();\n    }\n\n    // Create a migrated profile\n    const migratedProfile: ActivityProfile = {\n        id: 'migrated-profile',\n        name: 'Migrated',\n        activityType: 'cycling',\n        icon: '',\n        screens: [\n            {\n                id: 'migrated-main',\n                name: 'Main',\n                icon: '',\n                layout: 'auto',\n                slots: slots.map((s, i) => ({ ...s, position: i + 1 })),\n            },\n        ],\n        activeScreenIndex: 0,\n    };\n\n    return {\n        profiles: [migratedProfile, createDefaultIndoorProfile()],\n        activeProfileId: 'migrated-profile',\n        unitSystem: 'metric',\n        fieldPreferences: {},\n        version: 1,\n    };\n}\n\n// ============================================================================\n// Quick Presets\n// ============================================================================\n\n/** Quick preset: Power-focused 6-field screen */\nexport const PRESET_POWER_FOCUS: DataScreen = (() => {\n    resetSlotCounter();\n    return {\n        id: 'preset-power',\n        name: 'Power Focus',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-3s', 'large'),\n            slot('power-avg', 'medium'),\n            slot('power-normalized', 'medium'),\n            slot('watts-per-kg', 'medium'),\n            slot('cadence-current', 'medium'),\n            slot('heartrate-current', 'medium'),\n        ],\n    };\n})();\n\n/** Quick preset: Endurance ride */\nexport const PRESET_ENDURANCE: DataScreen = (() => {\n    resetSlotCounter();\n    return {\n        id: 'preset-endurance',\n        name: 'Endurance',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('heartrate-zone', 'large'),\n            slot('time-elapsed', 'medium'),\n            slot('distance-total', 'medium'),\n            slot('speed-avg', 'medium'),\n            slot('elevation-gain', 'medium'),\n            slot('calories-burned', 'medium'),\n        ],\n    };\n})();\n\n/** Quick preset: Interval training */\nexport const PRESET_INTERVALS: DataScreen = (() => {\n    resetSlotCounter();\n    return {\n        id: 'preset-intervals',\n        name: 'Intervals',\n        icon: '',\n        layout: 'auto',\n        slots: [\n            slot('power-current', 'large'),\n            slot('time-lap', 'large'),\n            slot('power-lap-avg', 'medium'),\n            slot('heartrate-current', 'medium'),\n            slot('time-lap-number', 'medium'),\n            slot('time-elapsed', 'medium'),\n        ],\n    };\n})();\n\n/** All quick presets */\nexport const SCREEN_PRESETS: DataScreen[] = [PRESET_POWER_FOCUS, PRESET_ENDURANCE, PRESET_INTERVALS];\n","/**\n * Live Data Values Bus\n *\n * Lightweight event bus for streaming live data field values to UI components\n * that don't have direct access to the DataFieldsManager (like the FieldPicker).\n *\n * @module data-fields/live-values\n */\n\ntype ValueListener = (value: number | null) => void;\n\n// Store listeners by field ID\nconst listeners = new Map<string, Set<ValueListener>>();\n\n/**\n * Publish a new value for a data field\n * @param fieldId - The ID of the field\n * @param value - The new value (number or null)\n */\nexport function publishFieldValue(fieldId: string, value: number | null): void {\n    const fieldListeners = listeners.get(fieldId);\n    if (fieldListeners) {\n        for (const listener of fieldListeners) {\n            try {\n                listener(value);\n            } catch (err) {\n                console.error(`Error in value listener for ${fieldId}:`, err);\n            }\n        }\n    }\n}\n\n/**\n * Subscribe to updates for a specific data field\n * @param fieldId - The ID of the field to observe\n * @param listener - Callback function receiving new values\n * @returns Unsubscribe function\n */\nexport function subscribeToFieldValue(fieldId: string, listener: ValueListener): () => void {\n    if (!listeners.has(fieldId)) {\n        listeners.set(fieldId, new Set());\n    }\n\n    const fieldListeners = listeners.get(fieldId)!;\n    fieldListeners.add(listener);\n\n    // Return cleanup function\n    return () => {\n        fieldListeners.delete(listener);\n        if (fieldListeners.size === 0) {\n            listeners.delete(fieldId);\n        }\n    };\n}\n","/**\n * Data Fields Manager\n *\n * Integration layer that connects the data fields system with the app's\n * MeasurementsState and UI components. Handles:\n * - Real-time data updates from sensors\n * - Calculated field scheduling\n * - UI component synchronization\n * - Profile/screen management\n *\n * @module DataFieldsManager\n */\n\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { ConnectionsState, TimeState } from '../getInitState.js';\nimport {\n    DEFAULT_HR_ZONES,\n    DEFAULT_POWER_ZONES,\n    type ActivityProfile,\n    type UserSettings,\n    type WorkoutState,\n} from './types.js';\nimport type { ScreenCarouselComponent } from '../components/data-fields/ScreenCarouselComponent.js';\nimport { getDataField } from './registry.js';\nimport { createCalculationManager, type CalculationManager } from './CalculationManager.js';\nimport { DEFAULT_CYCLING_PROFILE } from './defaults.js';\nimport { dataFieldsUpdater } from './AdaptiveUpdater.js';\nimport { publishFieldValue } from './live-values.js';\n\n/**\n * Maps MeasurementsState properties to data field IDs\n */\nconst SENSOR_FIELD_MAP: Record<string, string> = {\n    power: 'power-current',\n    heartrate: 'heartrate-current',\n    cadence: 'cadence-current',\n    speed: 'speed-current',\n    distance: 'distance-total',\n    altitude: 'elevation-current',\n};\n\n/**\n * Data fields manager configuration\n */\nexport interface DataFieldsManagerConfig {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState?: TimeState;\n    initialProfile?: ActivityProfile;\n}\n\n/**\n * Data Fields Manager\n *\n * Orchestrates the data fields system, connecting sensor data\n * with UI components and calculated fields.\n */\nexport class DataFieldsManager {\n    private measurementsState: MeasurementsState;\n    private connectionsState: ConnectionsState;\n    private timeState?: TimeState;\n    private calculationManager: CalculationManager;\n    private activeProfile: ActivityProfile;\n    private carouselComponent: ScreenCarouselComponent | null = null;\n    private unsubscribeUpdater: (() => void) | null = null;\n    private listeners: Map<string, Set<(value: number | null) => void>> = new Map();\n\n    constructor(config: DataFieldsManagerConfig) {\n        this.measurementsState = config.measurementsState;\n        this.connectionsState = config.connectionsState;\n        this.timeState = config.timeState;\n        this.activeProfile = config.initialProfile ?? DEFAULT_CYCLING_PROFILE;\n\n        // Create calculation manager\n        this.calculationManager = createCalculationManager(\n            this.measurementsState,\n            this.createWorkoutState(),\n            this.createUserSettings()\n        );\n\n        // Listen to calculation updates\n        this.calculationManager.onUpdate((fieldId, value) => {\n            this.notifyFieldUpdate(fieldId, value);\n            this.updateCarouselField(fieldId, value);\n            // Notify adaptive updater of activity\n            dataFieldsUpdater.notifyDataChange();\n        });\n    }\n\n    /**\n     * Start the data fields manager\n     */\n    public start(): void {\n        // Start calculation manager\n        this.calculationManager.start();\n\n        // Start UI update loop\n        this.startUpdateLoop();\n\n        console.log('[DataFieldsManager] Started');\n    }\n\n    /**\n     * Stop the data fields manager\n     */\n    public stop(): void {\n        // Stop calculation manager\n        this.calculationManager.stop();\n\n        // Stop UI update loop\n        this.stopUpdateLoop();\n\n        console.log('[DataFieldsManager] Stopped');\n    }\n\n    /**\n     * Set the active profile\n     */\n    public setProfile(profile: ActivityProfile): void {\n        this.activeProfile = profile;\n        if (this.carouselComponent) {\n            this.carouselComponent.setProfile(profile);\n        }\n    }\n\n    /**\n     * Get the active profile\n     */\n    public getProfile(): ActivityProfile {\n        return this.activeProfile;\n    }\n\n    /**\n     * Attach to a screen carousel component\n     */\n    public attachToCarousel(carousel: ScreenCarouselComponent): void {\n        this.carouselComponent = carousel;\n        carousel.setProfile(this.activeProfile);\n\n        // Update connection states\n        this.updateSensorConnections();\n    }\n\n    /**\n     * Detach from carousel\n     */\n    public detachFromCarousel(): void {\n        this.carouselComponent = null;\n    }\n\n    /**\n     * Get current value for a data field\n     */\n    public getFieldValue(fieldId: string): number | null {\n        const field = getDataField(fieldId);\n        if (!field) return null;\n\n        // Check if it's a direct sensor field\n        for (const [prop, id] of Object.entries(SENSOR_FIELD_MAP)) {\n            if (id === fieldId) {\n                return this.getSensorValue(prop);\n            }\n        }\n\n        // Otherwise try to calculate it\n        return this.calculationManager.calculateField(fieldId);\n    }\n\n    /**\n     * Subscribe to field value updates\n     */\n    public onFieldUpdate(fieldId: string, callback: (value: number | null) => void): () => void {\n        if (!this.listeners.has(fieldId)) {\n            this.listeners.set(fieldId, new Set());\n        }\n        this.listeners.get(fieldId)!.add(callback);\n\n        // Return unsubscribe function\n        return () => {\n            const set = this.listeners.get(fieldId);\n            if (set) {\n                set.delete(callback);\n                if (set.size === 0) {\n                    this.listeners.delete(fieldId);\n                }\n            }\n        };\n    }\n\n    /**\n     * Get all fields used in the current profile\n     */\n    public getActiveFields(): string[] {\n        const fields = new Set<string>();\n        for (const screen of this.activeProfile.screens) {\n            for (const slot of screen.slots) {\n                fields.add(slot.fieldId);\n            }\n        }\n        return Array.from(fields);\n    }\n\n    // ========================================================================\n    // Private Methods\n    // ========================================================================\n\n    private startUpdateLoop(): void {\n        if (this.unsubscribeUpdater) return;\n\n        this.unsubscribeUpdater = dataFieldsUpdater.subscribe(() => {\n            this.updateSensorFields();\n            this.updateSensorConnections();\n        });\n    }\n\n    private stopUpdateLoop(): void {\n        if (this.unsubscribeUpdater) {\n            this.unsubscribeUpdater();\n            this.unsubscribeUpdater = null;\n        }\n    }\n\n    private updateSensorFields(): void {\n        // Update direct sensor readings\n        for (const [prop, fieldId] of Object.entries(SENSOR_FIELD_MAP)) {\n            const value = this.getSensorValue(prop);\n            this.notifyFieldUpdate(fieldId, value);\n            this.updateCarouselField(fieldId, value);\n        }\n\n        // Update time-based fields\n        if (this.timeState) {\n            const elapsed = this.getElapsedTime();\n            this.notifyFieldUpdate('time-elapsed', elapsed);\n            this.updateCarouselField('time-elapsed', elapsed);\n        }\n    }\n\n    private updateSensorConnections(): void {\n        if (!this.carouselComponent) return;\n\n        // Update connection states based on ConnectionsState\n        const connections = this.connectionsState;\n\n        // Power\n        const powerConnected = connections.power?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('power', powerConnected);\n\n        // Heart rate\n        const hrConnected = connections.heartrate?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('heartrate', hrConnected);\n\n        // Cadence\n        const cadenceConnected = connections.cadence?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('cadence', cadenceConnected);\n\n        // Speed (from GPS or calculated)\n        const gpsConnected = connections.gps?.isConnected ?? false;\n        this.carouselComponent.setSensorConnected('speed', gpsConnected);\n    }\n\n    /**\n     * Get the latest sensor value from measurement arrays\n     */\n    private getSensorValue(property: string): number | null {\n        const state = this.measurementsState;\n\n        switch (property) {\n            case 'power':\n                return this.getLatestValue(state.power);\n            case 'heartrate':\n                return this.getLatestValue(state.heartrate);\n            case 'cadence':\n                return this.getLatestValue(state.cadence);\n            case 'speed':\n                return this.getLatestValue(state.speed);\n            case 'distance':\n                return this.getLatestValue(state.distance);\n            case 'altitude':\n                return this.getLatestValue(state.altitude);\n            default:\n                return null;\n        }\n    }\n\n    /**\n     * Get the latest value from a measurement array\n     */\n    private getLatestValue(measurements: Array<{ value: number; timestamp: number }> | undefined): number | null {\n        if (!measurements || measurements.length === 0) {\n            return null;\n        }\n        return measurements[measurements.length - 1].value;\n    }\n\n    private notifyFieldUpdate(fieldId: string, value: number | null): void {\n        const callbacks = this.listeners.get(fieldId);\n        if (callbacks) {\n            for (const cb of callbacks) {\n                cb(value);\n            }\n        }\n        // Publish to global bus for components like FieldPicker\n        publishFieldValue(fieldId, value);\n    }\n\n    private updateCarouselField(fieldId: string, value: number | null): void {\n        if (this.carouselComponent) {\n            this.carouselComponent.updateFieldValue(fieldId, value);\n        }\n    }\n\n    private createWorkoutState(): WorkoutState {\n        const laps = this.measurementsState.laps || [];\n        const lapCount = laps.length;\n        const lastLapTimestamp = lapCount > 0 ? laps[lapCount - 1].timestamp : null;\n        const lapStartTime = lastLapTimestamp ?? this.timeState?.startTime ?? null;\n\n        return {\n            isActive: this.timeState?.running ?? false,\n            isPaused: false,\n            startTime: this.timeState?.startTime ?? null,\n            elapsedTime: this.getElapsedTime(),\n            movingTime: this.getElapsedTime(),\n            pausedTime: 0,\n            currentLap: lapCount + 1,\n            lapStartTime,\n            lapElapsedTime: lapStartTime ? Date.now() - lapStartTime : 0,\n            laps: laps.map((lap, idx) => ({\n                lapNumber: lap.number,\n                startTime: idx === 0 ? (this.timeState?.startTime ?? lap.timestamp) : laps[idx - 1].timestamp,\n                endTime: lap.timestamp,\n                duration: lap.elapsedMs ?? 0,\n                distance: 0,\n                avgPower: null,\n                avgHeartrate: null,\n                avgCadence: null,\n                avgSpeed: null,\n                elevationGain: 0,\n            })),\n        };\n    }\n\n    private getElapsedTime(): number {\n        if (!this.timeState?.running || !this.timeState.startTime) {\n            return 0;\n        }\n        return Date.now() - this.timeState.startTime;\n    }\n\n    /**\n     * Create user settings for data field calculations.\n     * These settings are currently hardcoded defaults since\n     * the AppSettings interface doesn't include training zones.\n     * TODO: Add these to settings UI and persist them.\n     */\n    private createUserSettings(): UserSettings {\n        // AppSettings doesn't have training-specific settings yet,\n        // so we use reasonable defaults\n        return {\n            unitSystem: 'metric' as const,\n            ftp: 200, // Functional Threshold Power (watts)\n            maxHr: 190, // Maximum heart rate (bpm)\n            weight: 70, // Rider weight (kg)\n            restingHr: 60, // Resting heart rate (bpm)\n            showCalories: true,\n            // Power zones as percentage of FTP\n            powerZones: DEFAULT_POWER_ZONES,\n            // HR zones as percentage of max HR\n            hrZones: DEFAULT_HR_ZONES,\n        };\n    }\n}\n\n/**\n * Create a new DataFieldsManager instance\n */\nexport function createDataFieldsManager(config: DataFieldsManagerConfig): DataFieldsManager {\n    return new DataFieldsManager(config);\n}\n\n/**\n * Global data fields manager instance\n */\nlet globalManager: DataFieldsManager | null = null;\n\n/**\n * Initialize the global data fields manager\n */\nexport function initGlobalDataFieldsManager(config: DataFieldsManagerConfig): DataFieldsManager {\n    if (globalManager) {\n        globalManager.stop();\n    }\n    globalManager = new DataFieldsManager(config);\n    return globalManager;\n}\n\n/**\n * Get the global data fields manager\n */\nexport function getGlobalDataFieldsManager(): DataFieldsManager | null {\n    return globalManager;\n}\n","/**\n * Data Fields Persistence\n *\n * Handles saving and loading data field configurations to localStorage.\n * Supports:\n * - Activity profiles with custom screens\n * - Field preferences (alerts, voice announcements)\n * - Migration from legacy settings\n *\n * @module data-fields/persistence\n */\n\nimport type { ActivityProfile, DataFieldSettings, FieldPreference } from './types.js';\nimport {\n    DEFAULT_CYCLING_PROFILE,\n    DEFAULT_INDOOR_PROFILE,\n    DEFAULT_RUNNING_PROFILE,\n    DEFAULT_DATA_FIELD_SETTINGS,\n    migrateFromLegacySettings,\n} from './defaults.js';\n\n/** LocalStorage key for data field settings */\nconst STORAGE_KEY = 'bpt-data-fields';\n\n/** LocalStorage key for legacy settings (for migration) */\nconst LEGACY_SETTINGS_KEY = 'bpt-settings';\n\n/** Current schema version for data migration */\nconst SCHEMA_VERSION = 1;\n\n/**\n * Stored settings format with version for migrations\n */\ninterface StoredSettings {\n    version: number;\n    settings: DataFieldSettings;\n}\n\n// ============================================================================\n// Load Functions\n// ============================================================================\n\n/**\n * Load data field settings from localStorage\n *\n * @returns The loaded settings or defaults if none exist\n */\nexport function loadDataFieldSettings(): DataFieldSettings {\n    try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n\n        if (stored) {\n            const parsed = JSON.parse(stored) as StoredSettings;\n\n            // Handle version migrations\n            const migrated = migrateStoredSettings(parsed);\n\n            // Validate loaded settings\n            if (validateSettings(migrated)) {\n                return migrated;\n            }\n\n            console.warn('[DataFields] Invalid stored settings, using defaults');\n            // Overwrite invalid settings to prevent persistent errors\n            saveDataFieldSettings({ ...DEFAULT_DATA_FIELD_SETTINGS });\n            return { ...DEFAULT_DATA_FIELD_SETTINGS };\n        }\n\n        // Try to migrate from legacy settings\n        const legacyStored = localStorage.getItem(LEGACY_SETTINGS_KEY);\n        if (legacyStored) {\n            try {\n                const legacy = JSON.parse(legacyStored);\n                const migrated = migrateFromLegacySettings(legacy);\n                saveDataFieldSettings(migrated);\n                return migrated;\n            } catch {\n                console.warn('[DataFields] Failed to migrate legacy settings');\n            }\n        }\n\n        return { ...DEFAULT_DATA_FIELD_SETTINGS };\n    } catch (error) {\n        console.error('[DataFields] Error loading settings:', error);\n        return { ...DEFAULT_DATA_FIELD_SETTINGS };\n    }\n}\n\n/**\n * Load a specific profile by ID\n */\nexport function loadProfile(profileId: string): ActivityProfile | null {\n    const settings = loadDataFieldSettings();\n    return settings.profiles.find((p) => p.id === profileId) ?? null;\n}\n\n/**\n * Load the currently active profile\n */\nexport function loadActiveProfile(): ActivityProfile {\n    const settings = loadDataFieldSettings();\n    const active = settings.profiles.find((p) => p.id === settings.activeProfileId);\n    return active ?? settings.profiles[0] ?? DEFAULT_CYCLING_PROFILE;\n}\n\n/**\n * Load field preferences for a specific field\n */\nexport function loadFieldPreference(fieldId: string): FieldPreference | null {\n    const settings = loadDataFieldSettings();\n    return settings.fieldPreferences[fieldId] ?? null;\n}\n\n// ============================================================================\n// Save Functions\n// ============================================================================\n\n/**\n * Save data field settings to localStorage\n */\nexport function saveDataFieldSettings(settings: DataFieldSettings): boolean {\n    try {\n        const stored: StoredSettings = {\n            version: SCHEMA_VERSION,\n            settings,\n        };\n\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(stored));\n        return true;\n    } catch (error) {\n        console.error('[DataFields] Error saving settings:', error);\n        return false;\n    }\n}\n\n/**\n * Save a single profile (creates or updates)\n */\nexport function saveProfile(profile: ActivityProfile): boolean {\n    const settings = loadDataFieldSettings();\n\n    const existingIndex = settings.profiles.findIndex((p) => p.id === profile.id);\n    if (existingIndex >= 0) {\n        settings.profiles[existingIndex] = profile;\n    } else {\n        settings.profiles.push(profile);\n    }\n\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Delete a profile by ID\n *\n * @returns false if trying to delete the last profile\n */\nexport function deleteProfile(profileId: string): boolean {\n    const settings = loadDataFieldSettings();\n\n    // Don't allow deleting the last profile\n    if (settings.profiles.length <= 1) {\n        console.warn('[DataFields] Cannot delete the last profile');\n        return false;\n    }\n\n    const index = settings.profiles.findIndex((p) => p.id === profileId);\n    if (index < 0) {\n        return false;\n    }\n\n    settings.profiles.splice(index, 1);\n\n    // If we deleted the active profile, set a new one\n    if (settings.activeProfileId === profileId) {\n        settings.activeProfileId = settings.profiles[0].id;\n    }\n\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Set the active profile by ID\n */\nexport function setActiveProfile(profileId: string): boolean {\n    const settings = loadDataFieldSettings();\n\n    const exists = settings.profiles.some((p) => p.id === profileId);\n    if (!exists) {\n        console.warn('[DataFields] Profile not found:', profileId);\n        return false;\n    }\n\n    settings.activeProfileId = profileId;\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Save field preferences for a specific field\n */\nexport function saveFieldPreference(fieldId: string, preference: FieldPreference): boolean {\n    const settings = loadDataFieldSettings();\n    settings.fieldPreferences[fieldId] = preference;\n    return saveDataFieldSettings(settings);\n}\n\n/**\n * Update the active screen index for a profile\n */\nexport function saveActiveScreenIndex(profileId: string, screenIndex: number): boolean {\n    const settings = loadDataFieldSettings();\n\n    const profile = settings.profiles.find((p) => p.id === profileId);\n    if (!profile) {\n        return false;\n    }\n\n    profile.activeScreenIndex = Math.max(0, Math.min(screenIndex, profile.screens.length - 1));\n    return saveDataFieldSettings(settings);\n}\n\n// ============================================================================\n// Reset Functions\n// ============================================================================\n\n/**\n * Reset all settings to defaults\n */\nexport function resetToDefaults(): boolean {\n    try {\n        localStorage.removeItem(STORAGE_KEY);\n        return true;\n    } catch (error) {\n        console.error('[DataFields] Error resetting settings:', error);\n        return false;\n    }\n}\n\n/**\n * Reset a specific profile to its default configuration\n */\nexport function resetProfileToDefault(profileId: string): boolean {\n    const settings = loadDataFieldSettings();\n\n    const profile = settings.profiles.find((p) => p.id === profileId);\n    if (!profile) {\n        return false;\n    }\n\n    // Find the default profile that matches this activity type\n    const defaults = getDefaultProfileForType(profile.activityType);\n    if (defaults) {\n        const index = settings.profiles.findIndex((p) => p.id === profileId);\n        settings.profiles[index] = { ...defaults, id: profileId };\n        return saveDataFieldSettings(settings);\n    }\n\n    return false;\n}\n\n// ============================================================================\n// Export/Import Functions\n// ============================================================================\n\n/**\n * Export settings as JSON string for backup\n */\nexport function exportSettings(): string {\n    const settings = loadDataFieldSettings();\n    return JSON.stringify(settings, null, 2);\n}\n\n/**\n * Import settings from JSON string\n *\n * @returns true if import was successful\n */\nexport function importSettings(jsonString: string): boolean {\n    try {\n        const parsed = JSON.parse(jsonString) as DataFieldSettings;\n\n        if (!validateSettings(parsed)) {\n            console.error('[DataFields] Invalid settings format');\n            return false;\n        }\n\n        return saveDataFieldSettings(parsed);\n    } catch (error) {\n        console.error('[DataFields] Error importing settings:', error);\n        return false;\n    }\n}\n\n/**\n * Export a single profile as JSON\n */\nexport function exportProfile(profileId: string): string | null {\n    const profile = loadProfile(profileId);\n    if (!profile) {\n        return null;\n    }\n    return JSON.stringify(profile, null, 2);\n}\n\n/**\n * Import a profile from JSON string\n */\nexport function importProfile(jsonString: string): ActivityProfile | null {\n    try {\n        const parsed = JSON.parse(jsonString) as ActivityProfile;\n\n        if (!validateProfile(parsed)) {\n            console.error('[DataFields] Invalid profile format');\n            return null;\n        }\n\n        // Generate new ID to avoid conflicts\n        parsed.id = generateUniqueId();\n\n        // Save the imported profile\n        if (saveProfile(parsed)) {\n            return parsed;\n        }\n\n        return null;\n    } catch (error) {\n        console.error('[DataFields] Error importing profile:', error);\n        return null;\n    }\n}\n\n// ============================================================================\n// Migration Functions\n// ============================================================================\n\n/**\n * Migrate stored settings to current schema version\n */\nfunction migrateStoredSettings(stored: StoredSettings): DataFieldSettings {\n    let settings = stored.settings;\n    let version = stored.version;\n\n    // Apply migrations in order\n    while (version < SCHEMA_VERSION) {\n        switch (version) {\n            case 0:\n                // v0 -> v1: Add fieldPreferences if missing\n                settings.fieldPreferences = settings.fieldPreferences ?? {};\n                break;\n            // Add future migrations here\n        }\n        version++;\n    }\n\n    return settings;\n}\n\n// ============================================================================\n// Validation Functions\n// ============================================================================\n\n/**\n * Validate complete settings object\n */\nfunction validateSettings(settings: unknown): settings is DataFieldSettings {\n    if (!settings || typeof settings !== 'object') {\n        return false;\n    }\n\n    const s = settings as DataFieldSettings; // Safe to cast for property checking after object check\n\n    if (!Array.isArray(s.profiles) || s.profiles.length === 0) {\n        return false;\n    }\n\n    if (typeof s.activeProfileId !== 'string') {\n        return false;\n    }\n\n    if (!['metric', 'imperial'].includes(s.unitSystem)) {\n        return false;\n    }\n\n    // Validate each profile\n    return s.profiles.every(validateProfile);\n}\n\n/**\n * Validate a single profile\n */\nfunction validateProfile(profile: unknown): profile is ActivityProfile {\n    if (!profile || typeof profile !== 'object') {\n        return false;\n    }\n\n    const p = profile as { id?: unknown; name?: unknown; screens?: unknown };\n\n    if (typeof p.id !== 'string' || p.id.length === 0) {\n        return false;\n    }\n\n    if (typeof p.name !== 'string' || p.name.length === 0) {\n        return false;\n    }\n\n    if (!Array.isArray(p.screens) || p.screens.length === 0) {\n        return false;\n    }\n\n    return true;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/**\n * Generate a unique ID for new profiles\n */\nfunction generateUniqueId(): string {\n    return `profile-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n}\n\n/**\n * Get default profile for an activity type\n */\nfunction getDefaultProfileForType(activityType: string): ActivityProfile | null {\n    switch (activityType) {\n        case 'cycling':\n            return DEFAULT_CYCLING_PROFILE;\n        case 'indoor':\n            return DEFAULT_INDOOR_PROFILE;\n        case 'running':\n            return DEFAULT_RUNNING_PROFILE;\n        default:\n            return DEFAULT_CYCLING_PROFILE;\n    }\n}\n\n// ============================================================================\n// Storage Event Handling\n// ============================================================================\n\n/** Callbacks for storage change events */\ntype StorageChangeCallback = (settings: DataFieldSettings) => void;\nconst storageCallbacks: Set<StorageChangeCallback> = new Set();\n\n/**\n * Subscribe to storage changes (useful for syncing across tabs)\n */\nexport function onStorageChange(callback: StorageChangeCallback): () => void {\n    storageCallbacks.add(callback);\n\n    // Return unsubscribe function\n    return () => {\n        storageCallbacks.delete(callback);\n    };\n}\n\n// Listen for storage events from other tabs\nif (typeof window !== 'undefined') {\n    window.addEventListener('storage', (event) => {\n        if (event.key === STORAGE_KEY && event.newValue) {\n            try {\n                const stored = JSON.parse(event.newValue) as StoredSettings;\n                for (const callback of storageCallbacks) {\n                    callback(stored.settings);\n                }\n            } catch {\n                // Ignore parse errors\n            }\n        }\n    });\n}\n","import { initTimerDisplay, pauseWorkout, resumeWorkout, showWorkoutStopSummary } from '../ui/time.js';\nimport { initDiscardButton, initExportButton, initMetricsToggle, initWorkoutSummaryModal } from '../ui/menu.js';\nimport { initMenu } from '../ui/menuInteractions.js';\nimport { showNotification } from '../ui/notifications.js';\nimport { announce } from '../ui/accessibility.js';\nimport { getTimestring } from '../getTimestring.js';\nimport { initMetricsDisplay } from '../initMetricsDisplay.js';\nimport { initStreamViewer } from '../ui/streamViewer.js';\nimport { initStreamingControls } from '../initStreamingControls.js';\nimport { initWorkoutBuilder } from '../ui/workoutBuilder.js';\nimport { initKeyboardNavigation } from '../ui/accessibility.js';\nimport { setupDarkModeToggle } from '../ui/darkMode.js';\nimport { initOnboarding } from '../ui/onboarding.js';\nimport { initLapButton } from '../ui/lap.js';\nimport { initWorkoutRecovery } from '../ui/workoutRecovery.js';\nimport { initInstallPrompt } from '../ui/installPrompt.js';\nimport { handleWakeLock } from '../ui/wakeLock.js';\nimport { registerServiceWorker } from '../ui/serviceWorker.js';\nimport { initMap } from './map.js';\nimport { AutoPauseService } from '../services/AutoPauseService.js';\nimport { autoLapService } from '../services/AutoLapService.js';\nimport { voiceFeedback } from '../services/VoiceFeedback.js';\nimport { mediaSessionManager } from '../services/MediaSessionManager.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState, ConnectionsState } from '../getInitState.js';\nimport type { ZoneState } from '../zone-state.js';\nimport type { StreamManager } from '../stream-manager.js';\nimport { createDataFieldsManager } from '../data-fields/DataFieldsManager.js';\nimport { DEFAULT_CYCLING_PROFILE } from '../data-fields/defaults.js';\nimport { loadActiveProfile, saveActiveScreenIndex } from '../data-fields/persistence.js';\nimport type { ActivityProfile } from '../data-fields/types.js';\nimport type { ScreenCarouselComponent } from '../components/data-fields/ScreenCarouselComponent.js';\nimport type { ConnectionManager } from '../initConnectionButtons.js';\n\n/**\n * Parameters for UI initialization\n */\ninterface UiInitParams {\n    measurementsState: MeasurementsState;\n    timeState: TimeState;\n    connectionsState: ConnectionsState;\n    streamManager: StreamManager;\n    connectionManager: ConnectionManager;\n}\n\n/**\n * Initialize all User Interface components\n *\n * Sets up:\n * - Metrics displays (Power, HR, Cadence)\n * - Navigation and Menus\n * - Streaming controls and viewer\n * - Workout builder\n * - System features (Wake lock, PWA install, Service Worker)\n * - Accessibility features\n *\n * @param params - State objects and dependencies\n * @returns The initialized ZoneState for zone distribution tracking\n */\nexport function initUi({\n    measurementsState,\n    timeState,\n    connectionsState,\n    streamManager,\n    connectionManager,\n}: UiInitParams): ZoneState {\n    // Initialize UI components\n    initTimerDisplay(timeState);\n    const zoneState = initMetricsDisplay({ measurementsState });\n\n    // Initialize Map\n    initMap(measurementsState, connectionsState);\n\n    // Initialize Media Session Manager (Headset controls)\n    mediaSessionManager.init(timeState);\n\n    // Initialize Data Fields System\n    const dataFieldsCarousel = document.getElementById('dataFieldsCarousel') as HTMLElement | null;\n    let dataFieldsManager: ReturnType<typeof createDataFieldsManager> | null = null;\n\n    if (dataFieldsCarousel) {\n        try {\n            let activeProfile = loadActiveProfile();\n\n            // Safety check: ensure profile has screens\n            if (!activeProfile.screens || activeProfile.screens.length === 0) {\n                console.warn('[DataFields] Active profile has no screens, using default');\n                // Use default cycling profile as fallback\n                activeProfile = DEFAULT_CYCLING_PROFILE;\n            }\n\n            dataFieldsManager = createDataFieldsManager({\n                measurementsState,\n                connectionsState,\n                timeState,\n                initialProfile: activeProfile,\n            });\n\n            // Start manager immediately to begin calculations\n            dataFieldsManager.start();\n            console.log('[DataFields] Manager initialized with profile:', activeProfile.name);\n\n            // Wait for component upgrade before attaching\n            customElements.whenDefined('bpt-screen-carousel').then(() => {\n                if (dataFieldsManager && dataFieldsCarousel) {\n                    dataFieldsManager.attachToCarousel(dataFieldsCarousel as ScreenCarouselComponent);\n                }\n            });\n\n            // Listen for profile changes from settings\n            document.addEventListener('data-fields-profile-changed', (e: Event) => {\n                const customEvent = e as CustomEvent<{ profile: ActivityProfile }>;\n                if (dataFieldsManager && customEvent.detail?.profile) {\n                    dataFieldsManager.setProfile(customEvent.detail.profile);\n                    console.log('[DataFields] Profile updated from settings');\n                }\n            });\n\n            // Listen for screen changes to persist active screen index\n            dataFieldsCarousel.addEventListener('screen-change', (e: Event) => {\n                const customEvent = e as CustomEvent<{ screenIndex: number }>;\n                if (customEvent.detail && activeProfile) {\n                    saveActiveScreenIndex(activeProfile.id, customEvent.detail.screenIndex);\n                }\n            });\n        } catch (error) {\n            console.error('[DataFields] Failed to initialize:', error);\n        }\n    }\n\n    // PWA & System features\n    handleWakeLock();\n    registerServiceWorker();\n    initInstallPrompt();\n\n    // UI Modules\n    initStreamViewer();\n    initStreamingControls(streamManager, timeState);\n    initWorkoutBuilder();\n    initKeyboardNavigation();\n\n    const darkModeToggle = document.getElementById('toggleDarkMode') as HTMLInputElement | null;\n    if (darkModeToggle) {\n        setupDarkModeToggle(darkModeToggle);\n    }\n\n    initOnboarding();\n    initLapButton({ measurementsState, timeState });\n\n    // Initialize Auto-Pause Service\n    const autoPauseService = new AutoPauseService(measurementsState, timeState, {\n        onAutoPause: () => pauseWorkout(timeState, true),\n        onAutoResume: () => resumeWorkout(timeState, true),\n    });\n\n    // Initialize Auto-Lap Service\n    autoLapService.init(measurementsState, timeState);\n    autoLapService.onLap((lapNumber) => {\n        const laps = measurementsState.laps;\n        const lap = laps.find((l) => l.number === lapNumber);\n\n        if (lap) {\n            const elapsedStr = lap.elapsedMs ? getTimestring(lap.elapsedMs) : '';\n            const message = `Auto Lap ${lap.number}${elapsedStr ? ` at ${elapsedStr}` : ''}`;\n\n            showNotification(` ${message}`, 'info');\n            announce(message, 'assertive');\n        }\n    });\n\n    // Initialize Enhanced Voice Feedback\n    voiceFeedback.init(measurementsState, timeState);\n\n    // Start auto-pause monitoring when workout starts\n    document.addEventListener('workoutStarted', () => {\n        autoPauseService.start();\n        autoLapService.start();\n        voiceFeedback.startIntervalAnnouncements();\n    });\n\n    // Stop auto-pause monitoring when workout is discarded\n    document.addEventListener('workoutDiscarded', () => {\n        autoPauseService.reset();\n        autoLapService.reset();\n        voiceFeedback.reset();\n    });\n\n    // Handle workout stop request - show comprehensive summary dialog\n    document.addEventListener('workoutStopRequested', (() => {\n        showWorkoutStopSummary(measurementsState, timeState, zoneState);\n    }) as EventListener);\n\n    // Re-initialize auto-pause when settings change\n    window.addEventListener('settings-changed', () => {\n        if (timeState.running) {\n            autoPauseService.stop();\n            autoPauseService.start();\n            autoLapService.stop();\n            autoLapService.start();\n            voiceFeedback.stopIntervalAnnouncements();\n            voiceFeedback.startIntervalAnnouncements();\n        }\n    });\n\n    initWorkoutRecovery(measurementsState, timeState, connectionManager).then((recovered) => {\n        if (recovered) {\n            console.log('Workout recovered from previous session');\n            // Update UI to reflect recovered data\n            document.dispatchEvent(new CustomEvent('workout-recovered'));\n        }\n    });\n\n    // Initialize menu controls\n    // Note: Some of these were at the bottom of main.ts before\n    initMenu(); // Enhanced menu interactions (keyboard nav, click-outside-close)\n    initDiscardButton({ measurementsState, timeState, zoneState });\n    initExportButton(measurementsState, zoneState);\n    initMetricsToggle();\n    initWorkoutSummaryModal({ measurementsState, timeState, zoneState });\n\n    return zoneState;\n}\n","import { registerPlugin } from '@capacitor/core';\nimport type { BackgroundGeolocationPlugin, Location, CallbackError } from '@capacitor-community/background-geolocation';\nimport type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nconst BackgroundGeolocation = registerPlugin<BackgroundGeolocationPlugin>('BackgroundGeolocation');\n\nexport const createNativeGpsService = (): GpsService => {\n    let watcherId: string | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            try {\n                watcherId = await BackgroundGeolocation.addWatcher(\n                    {\n                        backgroundMessage: 'Tracking your ride.',\n                        backgroundTitle: 'Bike Power Tracker',\n                        requestPermissions: true,\n                        stale: false,\n                        distanceFilter: 10,\n                    },\n                    (location: Location | null | undefined, error?: CallbackError | null) => {\n                        if (error) {\n                            if (error.code === 'NOT_AUTHORIZED') {\n                                if (\n                                    window.confirm(\n                                        'This app needs your location, ' +\n                                            'but does not have permission.\\n\\n' +\n                                            'Open settings now?'\n                                    )\n                                ) {\n                                    BackgroundGeolocation.openSettings();\n                                }\n                            }\n                            return console.error(error);\n                        }\n\n                        if (location) {\n                            const point: GpsPoint = {\n                                timestamp: location.time || Date.now(),\n                                lat: location.latitude,\n                                lon: location.longitude,\n                                accuracy: location.accuracy,\n                                altitude: location.altitude,\n                                speed: location.speed,\n                                heading: location.bearing,\n                            };\n                            listener(point);\n                        }\n                    }\n                );\n            } catch (e) {\n                console.error('Error starting native GPS:', e);\n            }\n        },\n        stop: async () => {\n            if (watcherId) {\n                await BackgroundGeolocation.removeWatcher({\n                    id: watcherId,\n                });\n                watcherId = null;\n            }\n        },\n    };\n};\n","import type { GpsService, GpsListener } from './types.js';\nimport type { GpsPoint } from '../../types/measurements.js';\n\nexport const createWebGpsService = (): GpsService => {\n    let watchId: number | null = null;\n\n    return {\n        start: async (listener: GpsListener) => {\n            if (!('geolocation' in navigator)) {\n                console.warn('Geolocation is not supported by this browser.');\n                return;\n            }\n\n            watchId = navigator.geolocation.watchPosition(\n                (position) => {\n                    const point: GpsPoint = {\n                        timestamp: position.timestamp,\n                        lat: position.coords.latitude,\n                        lon: position.coords.longitude,\n                        accuracy: position.coords.accuracy,\n                        altitude: position.coords.altitude,\n                        speed: position.coords.speed,\n                        heading: position.coords.heading,\n                    };\n                    listener(point);\n                },\n                (error) => {\n                    console.error('Error watching position:', error);\n                },\n                {\n                    enableHighAccuracy: true,\n                    timeout: 5000,\n                    maximumAge: 0,\n                }\n            );\n        },\n        stop: async () => {\n            if (watchId !== null) {\n                navigator.geolocation.clearWatch(watchId);\n                watchId = null;\n            }\n        },\n    };\n};\n","import { Capacitor } from '@capacitor/core';\nimport type { GpsService } from './types.js';\nimport { createNativeGpsService } from './native-gps.js';\nimport { createWebGpsService } from './web-gps.js';\n\nexport const GpsFactory = {\n    create: (): GpsService => {\n        if (Capacitor.isNativePlatform()) {\n            return createNativeGpsService();\n        } else {\n            return createWebGpsService();\n        }\n    },\n};\n","import type { GpsPoint } from './types/measurements.js';\nimport { GpsFactory } from './services/gps/factory.js';\nimport type { GpsListener } from './services/gps/types.js';\nimport { Capacitor } from '@capacitor/core';\n\nexport interface GpsConnection {\n    stop: () => Promise<void>;\n    deviceName?: string;\n}\n\nexport const connectGpsMock = async (listener: GpsListener): Promise<GpsConnection> => {\n    const interval = setInterval(() => {\n        const point: GpsPoint = {\n            timestamp: Date.now(),\n            lat: 52.52 + (Math.random() - 0.5) * 0.01,\n            lon: 13.405 + (Math.random() - 0.5) * 0.01,\n            accuracy: 5,\n            speed: (25 + (Math.random() - 0.5) * 5) / 3.6, // ~25 km/h in m/s\n            altitude: 50,\n            heading: 0,\n        };\n        listener(point);\n    }, 1000);\n\n    return {\n        stop: async () => clearInterval(interval),\n        deviceName: 'Mock GPS',\n    };\n};\n\nexport const connectGps = async (listener: GpsListener): Promise<GpsConnection> => {\n    // Use mock GPS only in development/test mode AND when not on native platform\n    // Native platforms should always use real GPS regardless of build mode\n    const useMock =\n        (import.meta.env.MODE === 'development' || import.meta.env.MODE === 'test') && !Capacitor.isNativePlatform();\n\n    if (useMock) {\n        return connectGpsMock(listener);\n    }\n\n    const service = GpsFactory.create();\n    await service.start(listener);\n\n    return {\n        stop: async () => service.stop(),\n        deviceName: 'GPS Sensor',\n    };\n};\n","/**\n * DOM Element References\n *\n * Centralized access to DOM elements used throughout the application.\n *\n * @module elements\n */\n\nimport type { SensorType } from './types/connections.js';\n\n/**\n * Sensor element configuration\n */\nexport interface SensorElements {\n    display: HTMLElement | null;\n    connect: HTMLElement | null;\n}\n\n/**\n * All sensor elements by type\n */\nexport type SensorElementsMap = Record<SensorType, SensorElements>;\n\n/**\n * Get DOM element by ID with null check\n *\n * @param id - Element ID\n * @returns The element or null if not found\n */\nfunction getElement<T extends HTMLElement = HTMLElement>(id: string): T | null {\n    const el = document.getElementById(id) as T | null;\n    if (!el) {\n        // console.warn(`Element with ID \"${id}\" not found`);\n    }\n    return el;\n}\n\n/**\n * Grouped elements by sensor type.\n * Uses getters to lazily retrieve elements from the DOM, ensuring they are found\n * even if this module is imported before the DOM is fully constructed.\n */\nexport const elements: SensorElementsMap = {\n    get power() {\n        return { display: getElement('power'), connect: getElement('connectPower') };\n    },\n    get heartrate() {\n        return { display: getElement('heartrate'), connect: getElement('connectHeartrate') };\n    },\n    get cadence() {\n        return { display: getElement('cadence'), connect: getElement('connectCadence') };\n    },\n    get gps() {\n        return { display: null, connect: getElement('connectGps') };\n    },\n    get speed() {\n        return { display: getElement('speed'), connect: getElement('connectSpeed') };\n    },\n    get distance() {\n        return { display: getElement('distance'), connect: null };\n    },\n    get altitude() {\n        return { display: getElement('altitude'), connect: null };\n    },\n    get treadmill() {\n        return { display: getElement('value-incline'), connect: getElement('connectTreadmill') };\n    },\n    get treadmillSpeed() {\n        return { display: getElement('treadmillSpeed'), connect: null };\n    },\n    get indoorBike() {\n        return { display: null, connect: getElement('connectIndoorBike') };\n    },\n    get rower() {\n        return { display: null, connect: getElement('connectRower') };\n    },\n    get crossTrainer() {\n        return { display: null, connect: getElement('connectCrossTrainer') };\n    },\n    get stepClimber() {\n        return { display: null, connect: getElement('connectStepClimber') };\n    },\n    get weightScale() {\n        return { display: null, connect: getElement('connectWeightScale') };\n    },\n    get rsc() {\n        return { display: null, connect: getElement('connectRsc') };\n    },\n    get concept2() {\n        return { display: null, connect: getElement('connectConcept2') };\n    },\n    get skiErg() {\n        return { display: null, connect: getElement('connectSkiErg') };\n    },\n};\n\n/**\n * Get element by ID (type-safe helper)\n */\nexport { getElement };\n","/**\n * Connection Error UI Module\n *\n * Displays user-friendly error messages for Bluetooth connection failures\n * with troubleshooting suggestions and retry functionality.\n *\n * @module connectionError\n */\n\nimport { showModal } from './modal.js';\nimport { announce } from './accessibility.js';\nimport type { SensorType } from '../types/connections.js';\n\n/**\n * Bluetooth error codes and their user-friendly messages\n */\ninterface ErrorInfo {\n    title: string;\n    message: string;\n    suggestions: string[];\n    canRetry: boolean;\n}\n\n/**\n * Sensor type display names\n */\nconst sensorLabels: Record<SensorType, string> = {\n    power: 'Power Meter',\n    heartrate: 'Heart Rate Monitor',\n    cadence: 'Cadence Sensor',\n    speed: 'Speed Sensor',\n    distance: 'Distance Sensor',\n    altitude: 'Altimeter',\n    gps: 'GPS',\n    treadmill: 'Treadmill',\n    treadmillSpeed: 'Treadmill Speed',\n    indoorBike: 'Indoor Bike',\n    rower: 'Rower',\n    crossTrainer: 'Cross Trainer',\n    stepClimber: 'Step Climber',\n    weightScale: 'Weight Scale',\n    rsc: 'Running Speed',\n    concept2: 'Concept2',\n    skiErg: 'Ski Erg',\n};\n\n/**\n * Sensor type icons\n */\nconst sensorIcons: Record<SensorType, string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n    treadmill: '',\n    treadmillSpeed: '',\n    indoorBike: '',\n    rower: '',\n    crossTrainer: '',\n    stepClimber: '',\n    weightScale: '',\n    rsc: '',\n    concept2: '',\n    skiErg: '',\n};\n\n/**\n * Parse a Bluetooth error and return user-friendly information\n */\nfunction parseBluetoothError(error: unknown, sensorType: SensorType): ErrorInfo {\n    const sensorLabel = sensorLabels[sensorType] || sensorType;\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorName = error instanceof Error ? error.name : '';\n\n    // User cancelled the device selection\n    if (errorMessage.includes('User cancelled') || errorMessage.includes('cancelled the requestDevice')) {\n        return {\n            title: 'Connection Cancelled',\n            message: `${sensorLabel} pairing was cancelled.`,\n            suggestions: ['Click the connect button to try again', 'Make sure your sensor is powered on and in range'],\n            canRetry: true,\n        };\n    }\n\n    // Bluetooth not available\n    if (\n        errorMessage.includes('Bluetooth adapter not available') ||\n        errorMessage.includes('Web Bluetooth API is not available') ||\n        (errorName === 'NotFoundError' && errorMessage.includes('Bluetooth'))\n    ) {\n        return {\n            title: 'Bluetooth Unavailable',\n            message: 'Bluetooth is not available on this device or browser.',\n            suggestions: [\n                'Check that Bluetooth is enabled in your device settings',\n                'Try using Chrome, Edge, or another browser that supports Web Bluetooth',\n                'On macOS, ensure Bluetooth permissions are granted in System Preferences',\n                'On Windows, check that your Bluetooth adapter is working',\n            ],\n            canRetry: false,\n        };\n    }\n\n    // No devices found\n    if (\n        errorMessage.includes('No Bluetooth devices') ||\n        errorMessage.includes('No devices found') ||\n        (errorName === 'NotFoundError' && !errorMessage.includes('Bluetooth'))\n    ) {\n        return {\n            title: 'No Sensors Found',\n            message: `No compatible ${sensorLabel.toLowerCase()} was found nearby.`,\n            suggestions: [\n                'Make sure your sensor is powered on',\n                'Wake up the sensor by spinning the pedals or moving',\n                'Bring the sensor closer to your device',\n                'Check that the sensor battery is not depleted',\n                'Ensure the sensor is not connected to another device',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // GATT connection failed\n    if (\n        errorMessage.includes('GATT') ||\n        errorMessage.includes('Connection failed') ||\n        (errorMessage.includes('connect') && errorMessage.includes('fail'))\n    ) {\n        return {\n            title: 'Connection Failed',\n            message: `Could not connect to the ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Try moving closer to the sensor',\n                'Power cycle the sensor (turn off and on again)',\n                'Check that no other device is connected to this sensor',\n                'Restart Bluetooth on your device',\n                'If using a phone, try closing other Bluetooth apps',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Security/permission error\n    if (\n        errorMessage.includes('SecurityError') ||\n        errorMessage.includes('permission') ||\n        errorName === 'SecurityError'\n    ) {\n        return {\n            title: 'Permission Denied',\n            message: 'Bluetooth permission was denied.',\n            suggestions: [\n                'Check your browser settings to allow Bluetooth access',\n                'If prompted, click \"Allow\" to grant Bluetooth permission',\n                'Try refreshing the page and connecting again',\n                'On some browsers, you may need to access this site over HTTPS',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Network/timeout error\n    if (errorMessage.includes('NetworkError') || errorMessage.includes('timeout') || errorName === 'NetworkError') {\n        return {\n            title: 'Connection Timed Out',\n            message: `The connection to your ${sensorLabel.toLowerCase()} timed out.`,\n            suggestions: [\n                'Make sure the sensor is in range and powered on',\n                'Try moving closer to the sensor',\n                'Power cycle the sensor and try again',\n                'Check for interference from other wireless devices',\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Service not found\n    if (errorMessage.includes('Service') && errorMessage.includes('not found')) {\n        return {\n            title: 'Incompatible Sensor',\n            message: `This device doesn't appear to be a compatible ${sensorLabel.toLowerCase()}.`,\n            suggestions: [\n                'Make sure you selected the correct sensor type',\n                'Check that your sensor supports standard Bluetooth protocols',\n                'Some sensors may require a firmware update',\n                \"Consult your sensor's documentation for compatibility\",\n            ],\n            canRetry: true,\n        };\n    }\n\n    // Generic/unknown error\n    return {\n        title: 'Connection Error',\n        message: `Failed to connect to ${sensorLabel.toLowerCase()}.`,\n        suggestions: [\n            'Make sure the sensor is powered on and nearby',\n            'Try power cycling the sensor',\n            'Restart Bluetooth on your device',\n            'Refresh the page and try again',\n        ],\n        canRetry: true,\n    };\n}\n\n/**\n * Create the error content HTML element\n */\nfunction createErrorContent(errorInfo: ErrorInfo): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'connection-error-content';\n\n    // Error message\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = errorInfo.message;\n    container.appendChild(messageEl);\n\n    // Troubleshooting section\n    if (errorInfo.suggestions.length > 0) {\n        const troubleshootingEl = document.createElement('div');\n        troubleshootingEl.className = 'connection-error-troubleshooting';\n\n        const titleEl = document.createElement('h3');\n        titleEl.textContent = ' Troubleshooting Tips';\n        troubleshootingEl.appendChild(titleEl);\n\n        const listEl = document.createElement('ul');\n        listEl.setAttribute('role', 'list');\n        errorInfo.suggestions.forEach((suggestion) => {\n            const itemEl = document.createElement('li');\n            itemEl.textContent = suggestion;\n            listEl.appendChild(itemEl);\n        });\n        troubleshootingEl.appendChild(listEl);\n\n        container.appendChild(troubleshootingEl);\n    }\n\n    return container;\n}\n\n/**\n * Show a connection error dialog with troubleshooting suggestions\n *\n * @param error - The error that occurred\n * @param sensorType - The type of sensor that failed to connect\n * @param onRetry - Optional callback for retry button\n * @returns Promise resolving to true if user wants to retry, false otherwise\n */\nexport function showConnectionError(error: unknown, sensorType: SensorType, onRetry?: () => void): Promise<boolean> {\n    return new Promise((resolve) => {\n        const errorInfo = parseBluetoothError(error, sensorType);\n        const sensorIcon = sensorIcons[sensorType];\n        const content = createErrorContent(errorInfo);\n\n        // Log the actual error for debugging\n        console.error(`[${sensorType}] Connection error:`, error);\n\n        // Announce to screen readers\n        announce(`${errorInfo.title}. ${errorInfo.message}`, 'assertive');\n\n        let closeModal: (() => void) | null = null;\n\n        const buttons = [];\n\n        // Always add a dismiss button\n        buttons.push({\n            text: 'Dismiss',\n            variant: 'secondary' as const,\n            onClick: () => {\n                closeModal?.();\n                resolve(false);\n            },\n        });\n\n        // Add retry button if applicable\n        if (errorInfo.canRetry) {\n            buttons.push({\n                text: 'Try Again',\n                variant: 'primary' as const,\n                onClick: () => {\n                    closeModal?.();\n                    if (onRetry) {\n                        onRetry();\n                    }\n                    resolve(true);\n                },\n            });\n        }\n\n        closeModal = showModal({\n            title: errorInfo.title,\n            icon: sensorIcon,\n            content,\n            buttons,\n            closeOnOverlay: true,\n            onClose: () => resolve(false),\n        });\n    });\n}\n\n/**\n * Show a reconnection failure notification\n *\n * Called when auto-reconnect has exhausted all attempts.\n *\n * @param sensorType - The type of sensor that failed to reconnect\n * @param onRetry - Optional callback to manually retry connection\n */\nexport function showReconnectionFailed(sensorType: SensorType, onRetry?: () => void): void {\n    const sensorLabel = sensorLabels[sensorType];\n    const sensorIcon = sensorIcons[sensorType];\n\n    const content = document.createElement('div');\n\n    content.className = 'connection-error-content';\n\n    const messageEl = document.createElement('p');\n    messageEl.className = 'connection-error-message';\n    messageEl.textContent = `Lost connection to your ${sensorLabel.toLowerCase()} and automatic reconnection failed.`;\n    content.appendChild(messageEl);\n\n    const tipsEl = document.createElement('div');\n    tipsEl.className = 'connection-error-troubleshooting';\n\n    const titleEl = document.createElement('h3');\n    titleEl.textContent = ' To reconnect:';\n    tipsEl.appendChild(titleEl);\n\n    const listEl = document.createElement('ul');\n    listEl.setAttribute('role', 'list');\n    [\n        'Make sure the sensor is still powered on',\n        'Move closer to the sensor',\n        'Click \"Try Again\" to reconnect manually',\n    ].forEach((tip) => {\n        const itemEl = document.createElement('li');\n        itemEl.textContent = tip;\n        listEl.appendChild(itemEl);\n    });\n    tipsEl.appendChild(listEl);\n    content.appendChild(tipsEl);\n\n    announce(`${sensorLabel} connection lost. Automatic reconnection failed.`, 'assertive');\n\n    let closeModal: (() => void) | null = null;\n\n    closeModal = showModal({\n        title: 'Connection Lost',\n        icon: sensorIcon,\n        content,\n        buttons: [\n            {\n                text: 'Dismiss',\n                variant: 'secondary',\n                onClick: () => {\n                    closeModal?.();\n                },\n            },\n            {\n                text: 'Try Again',\n                variant: 'primary',\n                onClick: () => {\n                    closeModal?.();\n                    onRetry?.();\n                },\n            },\n        ],\n        closeOnOverlay: true,\n    });\n}\n","/**\n * Connection Button Initialization\n *\n * Sets up Bluetooth sensor connection buttons with connect/disconnect functionality.\n *\n * @module initConnectionButtons\n */\n\nimport { connectGps } from './connect-gps.js';\nimport { BluetoothFactory } from './services/bluetooth/factory.js';\nimport { elements } from './elements.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { Measurement, TreadmillMeasurement } from './types/measurements.js';\nimport type { ConnectionsState } from './getInitState.js';\nimport type { SensorType } from './types/connections.js';\nimport type { ConnectionStatus } from './types/bluetooth.js';\nimport { showNotification } from './ui/notifications.js';\nimport { showConnectionError, showReconnectionFailed } from './ui/connectionError.js';\nimport { connectionStorage } from './storage/connectionStorage.js';\n\nexport interface ConnectionManager {\n    reconnectStored: () => Promise<void>;\n}\n\n/**\n * Parameters for connection button initialization\n */\ninterface InitConnectionButtonsParams {\n    connectionsState: ConnectionsState;\n    measurementsState: MeasurementsState;\n}\n\n/**\n * Emoji icons for each sensor type\n */\nconst emojis: Record<SensorType, string> = {\n    power: '',\n    heartrate: '',\n    cadence: '',\n    speed: '',\n    distance: '',\n    altitude: '',\n    gps: '',\n    treadmill: '',\n    treadmillSpeed: '',\n    indoorBike: '',\n    rower: '',\n    crossTrainer: '',\n    stepClimber: '',\n    weightScale: '',\n    rsc: '',\n    concept2: '',\n    skiErg: '',\n};\n\n/**\n * Get formatted sensor type label\n */\nconst getSensorLabel = (key: SensorType): string => {\n    return (\n        key.charAt(0).toUpperCase() +\n        key\n            .replace(/([A-Z])/g, ' $1')\n            .trim()\n            .slice(1)\n    );\n};\n\n/**\n * Initialize connection buttons for all sensor types.\n *\n * Sets up click handlers for connect/disconnect buttons that:\n * - Connect to Bluetooth sensors\n * - Update connection state\n * - Register measurement listeners\n * - Update UI to reflect connection status\n * - Display device name when connected\n * - Handle auto-reconnect status updates\n *\n * @param params - Object containing state objects\n */\n/** Timeout duration before showing \"taking too long\" indicator (ms) */\nconst CONNECTION_TIMEOUT_MS = 10000;\n\n/** Map to track connection timeout timers */\nconst connectionTimeouts: Map<SensorType, ReturnType<typeof setTimeout>> = new Map();\n\nexport const initConnectionButtons = ({\n    connectionsState,\n    measurementsState,\n}: InitConnectionButtonsParams): ConnectionManager => {\n    // Initialize Modal Logic\n    const connectSensorBtn = document.getElementById('connectSensorBtn');\n    const sensorModal = document.getElementById('sensorModal') as HTMLDialogElement | null;\n    const closeSensorModalBtn = document.getElementById('closeSensorModal');\n\n    if (connectSensorBtn && sensorModal) {\n        connectSensorBtn.addEventListener('click', () => {\n            if (typeof sensorModal.showModal === 'function') {\n                sensorModal.showModal();\n            } else {\n                sensorModal.setAttribute('open', '');\n            }\n        });\n    }\n\n    if (closeSensorModalBtn && sensorModal) {\n        closeSensorModalBtn.addEventListener('click', () => {\n            if (typeof sensorModal.close === 'function') {\n                sensorModal.close();\n            } else {\n                sensorModal.removeAttribute('open');\n            }\n        });\n    }\n\n    if (sensorModal) {\n        sensorModal.addEventListener('click', (event) => {\n            if (event.target === sensorModal) {\n                if (typeof sensorModal.close === 'function') {\n                    sensorModal.close();\n                } else {\n                    sensorModal.removeAttribute('open');\n                }\n            }\n        });\n    }\n\n    /**\n     * Update the connected count badge in the modal header\n     */\n    const updateConnectedCount = (): void => {\n        const countElem = document.getElementById('connectedCount');\n        const disconnectAllBtn = document.getElementById('disconnectAllBtn');\n\n        const connectedTypes = supportedTypes.filter((type) => connectionsState[type]?.isConnected);\n        const count = connectedTypes.length;\n\n        if (countElem) {\n            countElem.textContent = count === 0 ? '0 connected' : count === 1 ? '1 connected' : `${count} connected`;\n\n            if (count > 0) {\n                countElem.classList.add('has-connections');\n            } else {\n                countElem.classList.remove('has-connections');\n            }\n        }\n\n        // Show/hide Disconnect All button based on connection count\n        if (disconnectAllBtn) {\n            if (count > 0) {\n                disconnectAllBtn.classList.add('visible');\n            } else {\n                disconnectAllBtn.classList.remove('visible');\n            }\n        }\n    };\n\n    /**\n     * Clear connection timeout for a sensor\n     */\n    const clearConnectionTimeout = (key: SensorType): void => {\n        const existingTimeout = connectionTimeouts.get(key);\n        if (existingTimeout) {\n            clearTimeout(existingTimeout);\n            connectionTimeouts.delete(key);\n        }\n    };\n\n    /**\n     * Start connection timeout timer for a sensor\n     */\n    const startConnectionTimeout = (key: SensorType): void => {\n        clearConnectionTimeout(key);\n\n        const timeoutId = setTimeout(() => {\n            const connectElem = elements[key]?.connect;\n            if (connectElem?.classList.contains('connecting')) {\n                connectElem.classList.add('timeout');\n            }\n        }, CONNECTION_TIMEOUT_MS);\n\n        connectionTimeouts.set(key, timeoutId);\n    };\n\n    /**\n     * Update button visual state based on connection status\n     */\n    const updateButtonText = (\n        key: SensorType,\n        status: 'connected' | 'disconnected' | 'reconnecting' | 'connecting',\n        deviceName?: string\n    ): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const statusSpan = connectElem.querySelector('.sensor-status');\n        const deviceNameSpan = connectElem.querySelector('.sensor-device-name');\n\n        // Remove all state classes first\n        connectElem.classList.remove('connected', 'connecting', 'timeout');\n        connectElem.style.borderColor = '';\n\n        // Clear any existing timeout when status changes\n        if (status !== 'connecting' && status !== 'reconnecting') {\n            clearConnectionTimeout(key);\n        }\n\n        if (statusSpan) {\n            switch (status) {\n                case 'connected':\n                    statusSpan.textContent = 'Connected';\n                    connectElem.classList.add('connected');\n                    if (deviceNameSpan && deviceName) {\n                        deviceNameSpan.textContent = deviceName;\n                    }\n                    break;\n                case 'connecting':\n                case 'reconnecting':\n                    statusSpan.textContent = status === 'connecting' ? 'Connecting...' : 'Reconnecting...';\n                    connectElem.classList.add('connecting');\n                    // Start timeout timer\n                    startConnectionTimeout(key);\n                    break;\n                case 'disconnected': {\n                    statusSpan.textContent = 'Disconnected';\n                    // Show last connected device name if available\n                    const lastDeviceName = connectionStorage.getDeviceName(key);\n                    if (deviceNameSpan) {\n                        deviceNameSpan.textContent = lastDeviceName || '';\n                    }\n                    break;\n                }\n            }\n        } else {\n            // Fallback for old buttons if any exist\n            const emoji = emojis[key];\n            const label = getSensorLabel(key);\n            switch (status) {\n                case 'connected':\n                    if (deviceName) {\n                        connectElem.textContent = `${emoji} Disconnect ${label} (${deviceName})`;\n                    } else {\n                        connectElem.textContent = `${emoji} Disconnect ${label}`;\n                    }\n                    break;\n                case 'connecting':\n                case 'reconnecting':\n                    connectElem.textContent = `${emoji} ${status === 'connecting' ? 'Connecting' : 'Reconnecting'} ${label}...`;\n                    break;\n                case 'disconnected':\n                    connectElem.textContent = `${emoji} Connect ${label}`;\n                    break;\n            }\n        }\n\n        // Update connected count after state change\n        updateConnectedCount();\n    };\n\n    /**\n     * Disconnect from a sensor\n     */\n    const disconnectFn = (key: SensorType): void => {\n        const connectionState = connectionsState[key];\n        if (!connectionState) return;\n\n        if (typeof connectionState.disconnect === 'function') {\n            connectionState.disconnect();\n            connectionState.disconnect = null;\n            connectionState.isConnected = false;\n\n            updateButtonText(key, 'disconnected');\n\n            const displayElem = elements[key]?.display;\n            if (displayElem) {\n                displayElem.textContent = '--';\n            }\n        }\n    };\n\n    /**\n     * Disconnect all connected sensors\n     */\n    const disconnectAll = (): void => {\n        const connectedTypes = supportedTypes.filter((type) => connectionsState[type]?.isConnected);\n\n        if (connectedTypes.length === 0) return;\n\n        connectedTypes.forEach((type) => {\n            disconnectFn(type);\n        });\n\n        showNotification(`Disconnected ${connectedTypes.length} sensor${connectedTypes.length > 1 ? 's' : ''}`, 'info');\n    };\n\n    // Set up Disconnect All button handler\n    const disconnectAllBtn = document.getElementById('disconnectAllBtn');\n    if (disconnectAllBtn) {\n        disconnectAllBtn.addEventListener('click', disconnectAll);\n    }\n\n    /**\n     * Handle connection status changes from auto-reconnect\n     */\n    const handleStatusChange =\n        (key: SensorType, deviceName: string) =>\n        (status: ConnectionStatus): void => {\n            const label = getSensorLabel(key);\n\n            switch (status) {\n                case 'connected':\n                    updateButtonText(key, 'connected', deviceName);\n                    showNotification(`${label} sensor reconnected`, 'success');\n                    break;\n                case 'reconnecting':\n                    updateButtonText(key, 'reconnecting');\n                    break;\n                case 'failed':\n                    if (connectionsState[key]) {\n                        connectionsState[key]!.isConnected = false;\n                        connectionsState[key]!.disconnect = null;\n                    }\n                    updateButtonText(key, 'disconnected');\n                    // Show reconnection failed dialog with retry option\n                    showReconnectionFailed(key, () => connectSensor(key));\n                    break;\n                case 'disconnected':\n                    // Initial disconnect event, wait for reconnect attempt\n                    break;\n            }\n        };\n\n    /**\n     * Connect to a sensor\n     */\n    const connectSensor = async (key: SensorType, deviceId?: string): Promise<void> => {\n        try {\n            updateButtonText(key, 'connecting'); // Show connecting state\n\n            let connection: any;\n\n            if (key === 'gps') {\n                // GPS has a different interface\n                const gpsConnection = await connectGps((point) => {\n                    measurementsState.addGps(point);\n                });\n\n                // Manually adapt\n                const state = connectionsState[key];\n                if (state) {\n                    state.disconnect = async () => {\n                        await gpsConnection.stop();\n                    };\n                    state.isConnected = true;\n                }\n                updateButtonText(key, 'connected', gpsConnection.deviceName);\n                showNotification(`Connected to ${getSensorLabel(key)}`, 'success');\n                connectionStorage.saveId('gps', 'enabled');\n                if (gpsConnection.deviceName) {\n                    connectionStorage.saveDeviceName('gps', gpsConnection.deviceName);\n                }\n                return;\n            }\n\n            // General Factory Connection\n            switch (key) {\n                case 'power':\n                    connection = await BluetoothFactory.connectPower(deviceId);\n                    connection.addListener((entry: Measurement) => measurementsState.addPower(entry));\n                    break;\n                case 'heartrate':\n                    connection = await BluetoothFactory.connectHeartRate(deviceId);\n                    connection.addListener((entry: Measurement) => measurementsState.addHeartrate(entry));\n                    break;\n                case 'cadence':\n                    connection = await BluetoothFactory.connectCadence(deviceId);\n                    connection.addListener((entry: Measurement) => measurementsState.addCadence(entry));\n                    break;\n                case 'speed':\n                    connection = await BluetoothFactory.connectSpeed();\n                    // Connect speed listener\n                    connection.addSpeedListener((entry: Measurement) => measurementsState.addSpeed(entry));\n                    // Also connect cadence listener if available (CSCS supports both)\n                    connection.addCadenceListener((entry: Measurement) => measurementsState.addCadence(entry));\n                    break;\n                case 'treadmill':\n                    connection = await BluetoothFactory.connectTreadmill(deviceId);\n                    connection.addListener((entry: TreadmillMeasurement) => measurementsState.addTreadmillData(entry));\n                    break;\n                case 'indoorBike':\n                    connection = await BluetoothFactory.connectIndoorBike();\n                    connection.addListener((entry: any) => {\n                        if (entry.power !== null)\n                            measurementsState.addPower({ timestamp: entry.timestamp, value: entry.power });\n                        if (entry.cadence !== null)\n                            measurementsState.addCadence({ timestamp: entry.timestamp, value: entry.cadence });\n                    });\n                    break;\n                case 'rower':\n                    connection = await BluetoothFactory.connectRowing(); // or connectRower depending on factory name\n                    connection.addListener((entry: any) => {\n                        if (entry.power !== null)\n                            measurementsState.addPower({ timestamp: entry.timestamp, value: entry.power });\n                        // Rower stroke rate -> cadence?\n                        if (entry.strokeRate !== null)\n                            measurementsState.addCadence({ timestamp: entry.timestamp, value: entry.strokeRate });\n                    });\n                    break;\n                case 'crossTrainer':\n                    connection = await BluetoothFactory.connectCrossTrainer();\n                    connection.addListener((entry: any) => {\n                        if (entry.power !== null)\n                            measurementsState.addPower({ timestamp: entry.timestamp, value: entry.power });\n                        if (entry.stepRate !== null)\n                            measurementsState.addCadence({ timestamp: entry.timestamp, value: entry.stepRate });\n                    });\n                    break;\n                case 'stepClimber':\n                    connection = await BluetoothFactory.connectStepClimber();\n                    connection.addListener((entry: any) => {\n                        if (entry.power !== null)\n                            measurementsState.addPower({ timestamp: entry.timestamp, value: entry.power });\n                        if (entry.stepRate !== null)\n                            measurementsState.addCadence({ timestamp: entry.timestamp, value: entry.stepRate });\n                    });\n                    break;\n                case 'rsc':\n                    connection = await BluetoothFactory.connectRunningSensor();\n                    connection.addListener((entry: any) => {\n                        if (entry.cadence !== null)\n                            measurementsState.addCadence({ timestamp: entry.timestamp, value: entry.cadence });\n                        if (entry.speed !== null)\n                            measurementsState.addSpeed({ timestamp: entry.timestamp, value: entry.speed });\n                    });\n                    break;\n                case 'weightScale':\n                    connection = await BluetoothFactory.connectWeightScale();\n                    connection.addListener((entry: any) => {\n                        // TODO: Support weight in measurements state\n                        console.log('Weight measurement:', entry);\n                        showNotification(`Weight: ${entry.weight} kg`, 'success');\n                    });\n                    break;\n                default:\n                    throw new Error(`Unsupported sensor type: ${key}`);\n            }\n\n            const { disconnect, deviceName, onStatusChange } = connection;\n\n            // Update state\n            const state = connectionsState[key];\n            if (state) {\n                state.disconnect = disconnect;\n                state.isConnected = true;\n            }\n\n            // Update UI\n            updateButtonText(key, 'connected', deviceName);\n            showNotification(`Connected to ${getSensorLabel(key)}`, 'success');\n\n            // Save device name for display when disconnected\n            if (deviceName) {\n                connectionStorage.saveDeviceName(key, deviceName);\n            }\n\n            // Subscribe to status changes for auto-reconnect feedback\n            if (onStatusChange) {\n                onStatusChange(handleStatusChange(key, deviceName || 'Sensor'));\n            }\n        } catch (error) {\n            updateButtonText(key, 'disconnected');\n\n            // Check if user wants to retry\n            const shouldRetry = await showConnectionError(error, key, () => connectSensor(key));\n            if (!shouldRetry) {\n                // Reset state just in case\n                if (connectionsState[key]) {\n                    connectionsState[key]!.isConnected = false;\n                }\n            }\n        }\n    };\n\n    /**\n     * Add click listener to a button\n     */\n    const addListener = (key: SensorType): void => {\n        const connectElem = elements[key]?.connect;\n        if (!connectElem) return;\n\n        const handler = (e: Event) => {\n            // Prevent propagation\n            e.stopPropagation();\n\n            const isConnected = connectionsState[key]?.isConnected;\n            if (isConnected) {\n                disconnectFn(key);\n            } else {\n                connectSensor(key);\n            }\n        };\n\n        // Add click listener\n        connectElem.addEventListener('click', handler);\n    };\n\n    // Initialize all supported buttons\n    const supportedTypes: SensorType[] = [\n        'power',\n        'heartrate',\n        'cadence',\n        'speed',\n        'gps',\n        'treadmill',\n        'indoorBike',\n        'rower',\n        'crossTrainer',\n        'stepClimber',\n        'weightScale',\n        'rsc',\n        'concept2',\n        'skiErg',\n    ];\n    supportedTypes.forEach(addListener);\n\n    const reconnectStored = async (): Promise<void> => {\n        const ids = connectionStorage.getIds();\n        const promises: Promise<void>[] = [];\n\n        const queueConnect = (type: SensorType) => {\n            if (!ids[type] && ids[type] !== 'enabled') return;\n\n            // Filter supported types\n            if (!supportedTypes.includes(type)) return;\n\n            const id = ids[type];\n            if (type === 'gps' && id === 'enabled') {\n                promises.push(connectSensor('gps'));\n            } else if (id) {\n                promises.push(connectSensor(type, id));\n            }\n        };\n\n        supportedTypes.forEach(queueConnect);\n        await Promise.allSettled(promises);\n    };\n\n    /**\n     * Initialize last device names display for disconnected sensors\n     */\n    const initLastDeviceNames = (): void => {\n        supportedTypes.forEach((type) => {\n            const connectElem = elements[type]?.connect;\n            if (!connectElem) return;\n\n            const deviceNameSpan = connectElem.querySelector('.sensor-device-name');\n            if (deviceNameSpan) {\n                const lastDeviceName = connectionStorage.getDeviceName(type);\n                if (lastDeviceName) {\n                    deviceNameSpan.textContent = lastDeviceName;\n                }\n            }\n        });\n    };\n\n    // Initialize last device names display on page load\n    initLastDeviceNames();\n\n    return { reconnectStored };\n};\n","/**\n * Stream Manager\n * Handles streaming workout data to the backend service.\n * Used for live sharing of workout metrics.\n *\n * @module StreamManager\n */\n\nimport { createStream, sendWorkoutData, type CreateStreamResponse } from './api/streamClient.js';\nimport type { MeasurementsState } from './measurements-state.js';\nimport type { TimeState } from './getInitState.js';\nimport type { MeasurementType } from './types/measurements.js';\n\nexport interface StreamStatus {\n    isStreaming: boolean;\n    isPaused: boolean;\n    streamName: string | null;\n}\n\nexport class StreamManager {\n    // Made public readonly to support access from UI checks (temporary fix for existing code)\n    // In a future refactor, prefer getStatus()\n    public isStreaming = false;\n    private isPaused = false;\n    private streamName: string | null = null;\n    private streamInterval: ReturnType<typeof setInterval> | null = null;\n    private measurementsState: MeasurementsState;\n    private timeState: TimeState;\n\n    constructor(measurementsState: MeasurementsState, timeState: TimeState) {\n        this.measurementsState = measurementsState;\n        this.timeState = timeState;\n    }\n\n    /**\n     * Start streaming workout data\n     * @param streamName - Optional custom stream name\n     * @returns Promise resolving to the stream name\n     */\n    async startStreaming(name?: string): Promise<string> {\n        if (this.isStreaming) {\n            return this.streamName!;\n        }\n\n        try {\n            const safeName = name || `workout-${Date.now()}`;\n            const response: CreateStreamResponse = await createStream(safeName);\n\n            if (!response.success) {\n                throw new Error('Failed to create stream');\n            }\n\n            this.streamName = response.streamName;\n            this.isStreaming = true;\n            this.isPaused = false;\n\n            this._startStreamingLoop();\n\n            return this.streamName;\n        } catch (error) {\n            console.error('Failed to start streaming:', error);\n            this.streamName = null;\n            throw error;\n        }\n    }\n\n    /**\n     * Pause the stream (stop sending data but keep stream alive)\n     */\n    pauseStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = true;\n        }\n    }\n\n    /**\n     * Resume the stream\n     */\n    resumeStreaming(): void {\n        if (this.isStreaming) {\n            this.isPaused = false;\n        }\n    }\n\n    /**\n     * Stop streaming workout data\n     */\n    async stopStreaming(): Promise<void> {\n        if (!this.isStreaming) {\n            return;\n        }\n\n        this.isStreaming = false;\n        this.isPaused = false;\n\n        if (this.streamInterval) {\n            clearInterval(this.streamInterval);\n            this.streamInterval = null;\n        }\n\n        // We don't delete the stream here so that data persists for a while (handled by server cleanup)\n        this.streamName = null;\n    }\n\n    /**\n     * Get current streaming status\n     */\n    getStatus(): StreamStatus {\n        return {\n            isStreaming: this.isStreaming,\n            isPaused: this.isPaused,\n            streamName: this.streamName,\n        };\n    }\n\n    /**\n     * Start the streaming loop\n     * @private\n     */\n    private _startStreamingLoop(): void {\n        // Send data every 1 second\n        this.streamInterval = setInterval(async () => {\n            if (!this.isStreaming || this.isPaused || !this.timeState.running) {\n                return;\n            }\n\n            try {\n                await this._sendCurrentData();\n            } catch (error) {\n                console.error('Error sending workout data:', error);\n            }\n        }, 1000);\n    }\n\n    /**\n     * Send current workout data\n     * @private\n     */\n    private async _sendCurrentData(): Promise<void> {\n        if (!this.streamName) return;\n\n        const power = this._getLatestValue('power');\n        const cadence = this._getLatestValue('cadence');\n        const heartrate = this._getLatestValue('heartrate');\n        const speed = this._getLatestValue('speed');\n        const distance = this._getLatestValue('distance');\n        const altitude = this._getLatestValue('altitude');\n        const incline = this._getLatestTreadmillIncline();\n\n        // Only send if we have at least one measurement\n        if (\n            power === null &&\n            cadence === null &&\n            heartrate === null &&\n            speed === null &&\n            distance === null &&\n            altitude === null &&\n            incline === null\n        ) {\n            return;\n        }\n\n        const elapsedMs =\n            this.timeState.running && this.timeState.startTime\n                ? Date.now() - this.timeState.startTime\n                : this.timeState.endTime && this.timeState.startTime\n                  ? this.timeState.endTime - this.timeState.startTime\n                  : 0;\n\n        await sendWorkoutData(this.streamName, {\n            timestamp: Date.now(),\n            elapsed: Math.floor(elapsedMs / 1000).toString(),\n            power,\n            cadence,\n            heartrate,\n            speed,\n            distance,\n            altitude,\n            incline,\n        });\n    }\n\n    /**\n     * Get latest value for a measurement type\n     * @private\n     */\n    private _getLatestValue(type: Exclude<MeasurementType, 'gps'>): number | null {\n        // @ts-ignore - dynamic access\n        const array = this.measurementsState[type];\n        if (!Array.isArray(array) || array.length === 0) {\n            return null;\n        }\n\n        // Only send data newer than 5 seconds\n        const latest = array[array.length - 1];\n        if (Date.now() - latest.timestamp > 5000) {\n            return null;\n        }\n\n        return latest.value;\n    }\n\n    /**\n     * Get latest treadmill incline value\n     * @private\n     */\n    private _getLatestTreadmillIncline(): number | null {\n        const array = this.measurementsState.treadmill;\n        if (!Array.isArray(array) || array.length === 0) {\n            return null;\n        }\n\n        // Only send data newer than 5 seconds\n        const latest = array[array.length - 1];\n        if (Date.now() - latest.timestamp > 5000) {\n            return null;\n        }\n\n        return latest.incline;\n    }\n}\n","import { initConnectionButtons } from '../initConnectionButtons.js';\nimport { StreamManager } from '../stream-manager.js';\nimport type { MeasurementsState } from '../measurements-state.js';\nimport type { TimeState, ConnectionsState } from '../getInitState.js';\n\ninterface HardwareInitParams {\n    measurementsState: MeasurementsState;\n    connectionsState: ConnectionsState;\n    timeState: TimeState;\n}\n\nexport function initHardware({ measurementsState, connectionsState, timeState }: HardwareInitParams) {\n    // Initialize Bluetooth connection buttons\n    const connectionManager = initConnectionButtons({ connectionsState, measurementsState });\n\n    // Stream manager for live workout streaming\n    const streamManager = new StreamManager(measurementsState, timeState);\n\n    return { streamManager, connectionManager };\n}\n","/**\n * BPT Client - Main Entry Point\n *\n * Progressive Web App for tracking cycling workouts with Bluetooth sensors.\n *\n * This module initializes all application features:\n * - Bluetooth sensor connections (power, cadence, heart rate)\n * - Real-time metrics display\n * - Workout timer\n * - Data export (JSON, TCX, CSV)\n * - Live streaming\n * - PWA features (service worker, install prompt)\n *\n * @module main\n *\n * @description\n * The app uses a state-based architecture with three main state objects:\n * - measurementsState: Tracks workout data (power, cadence, HR measurements)\n * - connectionsState: Tracks Bluetooth connection status\n * - timeState: Tracks recording state and elapsed time\n *\n * @example\n * // State is initialized automatically on app load\n * // Access exposed state in tests:\n * window.measurementsState\n * window.connectionsState\n */\n\nimport './styles/main.css';\nimport './styles/race-predictor.css';\nimport './styles/vo2max.css';\n\n// Register Web Components using lazy loader\nimport { registerLazyComponent } from './components/lazyLoader.js';\n\n// Base Components\nregisterLazyComponent('bpt-metric-display', () => import('./components/MetricDisplay.js'));\nregisterLazyComponent('bpt-power-gauge', () => import('./components/PowerGauge.js'));\nregisterLazyComponent('bpt-zone-gauge', () => import('./components/ZoneGauge.js'));\nregisterLazyComponent('bpt-live-chart', () => import('./components/LiveChart.js'));\nregisterLazyComponent('bpt-workout-timer', () => import('./components/WorkoutTimer.js'));\nregisterLazyComponent('bpt-toast', () => import('./components/Toast.js'));\nregisterLazyComponent('bpt-modal', () => import('./components/Modal.js'));\nregisterLazyComponent('bpt-target-visualizer', () => import('./components/TargetVisualizer.js'));\nregisterLazyComponent('bpt-workout-profile', () => import('./components/WorkoutProfile.js'));\n\n// Data Fields Components\nregisterLazyComponent('bpt-data-field', () => import('./components/data-fields/DataFieldComponent.js'));\nregisterLazyComponent('bpt-data-screen', () => import('./components/data-fields/DataScreenComponent.js'));\nregisterLazyComponent('bpt-screen-carousel', () => import('./components/data-fields/ScreenCarouselComponent.js'));\nregisterLazyComponent('bpt-field-picker', () => import('./components/data-fields/FieldPickerComponent.js'));\nregisterLazyComponent('bpt-screen-editor', () => import('./components/data-fields/ScreenEditorComponent.js'));\nregisterLazyComponent('bpt-profile-settings', () => import('./components/data-fields/ProfileSettingsComponent.js'));\n\nimport './monitoring/performance.js';\nimport './services/PersonalRecordsManager.js';\nimport { initializeState } from './state/StateProvider.js';\nimport { exposeVariablesDuringTest } from './exposeVariablesDuringTest.js';\nimport { setupRouter } from './init/router.js';\nimport { initUi } from './init/ui.js';\nimport { initHardware } from './init/hardware.js';\nimport { getSettings } from './config/settings.js';\nimport './ui/navbar.css';\nimport './ui/map.css';\n\nconst initApp = (): void => {\n    try {\n        // Performance monitoring initialized via import\n\n        // Sync mockSensors setting with window flag for bluetooth factory\n        // This must happen before any sensor connections are attempted\n        const settings = getSettings();\n        (window as any).useMockSensors = settings.mockSensors;\n\n        /**\n         * Initialize application state\n         */\n        const appState = initializeState();\n        const { measurementsState, connectionsState, timeState } = appState;\n\n        // Expose state for E2E testing\n        exposeVariablesDuringTest({ measurementsState, connectionsState });\n\n        // Initialize Hardware (Sensors & Streaming)\n        const { streamManager, connectionManager } = initHardware({ measurementsState, connectionsState, timeState });\n\n        // Initialize UI\n        initUi({ measurementsState, timeState, connectionsState, streamManager, connectionManager });\n\n        // Initialize Navigation Logic\n        const router = setupRouter();\n        router.start();\n\n        // Expose router to window for global access (navigation)\n        // Using explicit type compatible with window expansion\n        (window as unknown as { router: typeof router }).router = router;\n    } catch (error: unknown) {\n        console.error('Failed to initialize app:', error);\n    }\n};\n\n// Initialize app when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp, { once: true });\n} else {\n    initApp();\n}\n\nconsole.log('Bike Power Tracker initialized');\n"],"file":"index-WoRBJzVU.js"}