<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Clear Service Worker - Bike Power Tracker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }

        h1 {
            color: #2196F3;
        }

        .status {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success {
            color: #4CAF50;
        }

        .info {
            color: #2196F3;
        }

        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }

        button:hover {
            background: #1976D2;
        }

        .log {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <h1>üßπ Clear Service Worker Cache</h1>

    <div class="status">
        <p>This page will help you clear the service worker and caches from your browser.</p>
        <p><strong>Use this if:</strong></p>
        <ul>
            <li>You're not seeing the latest changes in development</li>
            <li>You want to completely reset the PWA</li>
            <li>You're switching from production to development</li>
        </ul>
    </div>

    <button onclick="clearEverything()">üóëÔ∏è Clear All (Recommended)</button>
    <button onclick="window.location.href='/'">‚Üê Back to App</button>

    <div class="log" id="log"></div>

    <script>
        const log = document.getElementById('log');

        function logMessage(message, isSuccess = false) {
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + (isSuccess ? 'success' : 'info');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        async function clearEverything() {
            logMessage('üöÄ Starting cleanup process...');

            // Unregister all service workers
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    logMessage(`Found ${registrations.length} service worker registration(s)`);

                    for (let registration of registrations) {
                        const success = await registration.unregister();
                        if (success) {
                            logMessage(`‚úì Service Worker unregistered: ${registration.scope}`, true);
                        }
                    }
                } catch (error) {
                    logMessage(`‚ùå Error unregistering service workers: ${error.message}`);
                }
            } else {
                logMessage('‚ÑπÔ∏è Service Worker API not available');
            }

            // Clear all caches
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    logMessage(`Found ${cacheNames.length} cache(s)`);

                    for (let cacheName of cacheNames) {
                        await caches.delete(cacheName);
                        logMessage(`‚úì Cache deleted: ${cacheName}`, true);
                    }
                } catch (error) {
                    logMessage(`‚ùå Error clearing caches: ${error.message}`);
                }
            } else {
                logMessage('‚ÑπÔ∏è Cache API not available');
            }

            // Clear localStorage (optional - uncomment if needed)
            // localStorage.clear();
            // logMessage('‚úì localStorage cleared', true);

            // Clear sessionStorage (optional - uncomment if needed)
            // sessionStorage.clear();
            // logMessage('‚úì sessionStorage cleared', true);

            logMessage('‚úÖ Cleanup complete!', true);
            logMessage('üìå Please reload the page to see changes');

            setTimeout(() => {
                if (confirm('Cleanup complete! Reload the page now?')) {
                    window.location.reload();
                }
            }, 1000);
        }

        // Auto-log on page load
        logMessage('Ready to clear service worker and caches');
        logMessage('Click "Clear All" button to proceed');
    </script>
</body>

</html>